// version: 0.17.0
// date: Fri Jun 14 2019 11:33:30 GMT+0100 (GMT+01:00)
// licence: 
/**
* Copyright 2016 PT Inovação e Sistemas SA
* Copyright 2016 INESC-ID
* Copyright 2016 QUOBIS NETWORKS SL
* Copyright 2016 FRAUNHOFER-GESELLSCHAFT ZUR FOERDERUNG DER ANGEWANDTEN FORSCHUNG E.V
* Copyright 2016 ORANGE SA
* Copyright 2016 Deutsche Telekom AG
* Copyright 2016 Apizee
* Copyright 2016 TECHNISCHE UNIVERSITAT BERLIN
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
**/


// version: 0.17.0
// date: Fri Jun 14 2019 11:33:30 GMT+0100 (GMT+01:00)
// licence: 
/**
* Copyright 2016 PT Inovação e Sistemas SA
* Copyright 2016 INESC-ID
* Copyright 2016 QUOBIS NETWORKS SL
* Copyright 2016 FRAUNHOFER-GESELLSCHAFT ZUR FOERDERUNG DER ANGEWANDTEN FORSCHUNG E.V
* Copyright 2016 ORANGE SA
* Copyright 2016 Deutsche Telekom AG
* Copyright 2016 Apizee
* Copyright 2016 TECHNISCHE UNIVERSITAT BERLIN
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
**/


System.register("[name]",[],function(__WEBPACK_DYNAMIC_EXPORT__){return{execute:function(){__WEBPACK_DYNAMIC_EXPORT__(function(c){var e={};function n(t){if(e[t])return e[t].exports;var g=e[t]={i:t,l:!1,exports:{}};return c[t].call(g.exports,g,g.exports,n),g.l=!0,g.exports}return n.m=c,n.c=e,n.d=function(c,e,t){n.o(c,e)||Object.defineProperty(c,e,{enumerable:!0,get:t})},n.r=function(c){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(c,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(c,"__esModule",{value:!0})},n.t=function(c,e){if(1&e&&(c=n(c)),8&e)return c;if(4&e&&"object"==typeof c&&c&&c.__esModule)return c;var t=Object.create(null);if(n.r(t),Object.defineProperty(t,"default",{enumerable:!0,value:c}),2&e&&"string"!=typeof c)for(var g in c)n.d(t,g,function(e){return c[e]}.bind(null,g));return t},n.n=function(c){var e=c&&c.__esModule?function(){return c.default}:function(){return c};return n.d(e,"a",e),e},n.o=function(c,e){return Object.prototype.hasOwnProperty.call(c,e)},n.p="",n(n.s=124)}([function(module,exports,__webpack_require__){eval('var __WEBPACK_AMD_DEFINE_FACTORY__, __WEBPACK_AMD_DEFINE_RESULT__;/*\n* loglevel - https://github.com/pimterry/loglevel\n*\n* Copyright (c) 2013 Tim Perry\n* Licensed under the MIT license.\n*/\n(function (root, definition) {\n    "use strict";\n    if (true) {\n        !(__WEBPACK_AMD_DEFINE_FACTORY__ = (definition),\n\t\t\t\t__WEBPACK_AMD_DEFINE_RESULT__ = (typeof __WEBPACK_AMD_DEFINE_FACTORY__ === \'function\' ?\n\t\t\t\t(__WEBPACK_AMD_DEFINE_FACTORY__.call(exports, __webpack_require__, exports, module)) :\n\t\t\t\t__WEBPACK_AMD_DEFINE_FACTORY__),\n\t\t\t\t__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n    } else {}\n}(this, function () {\n    "use strict";\n\n    // Slightly dubious tricks to cut down minimized file size\n    var noop = function() {};\n    var undefinedType = "undefined";\n\n    var logMethods = [\n        "trace",\n        "debug",\n        "info",\n        "warn",\n        "error"\n    ];\n\n    // Cross-browser bind equivalent that works at least back to IE6\n    function bindMethod(obj, methodName) {\n        var method = obj[methodName];\n        if (typeof method.bind === \'function\') {\n            return method.bind(obj);\n        } else {\n            try {\n                return Function.prototype.bind.call(method, obj);\n            } catch (e) {\n                // Missing bind shim or IE8 + Modernizr, fallback to wrapping\n                return function() {\n                    return Function.prototype.apply.apply(method, [obj, arguments]);\n                };\n            }\n        }\n    }\n\n    // Build the best logging method possible for this env\n    // Wherever possible we want to bind, not wrap, to preserve stack traces\n    function realMethod(methodName) {\n        if (methodName === \'debug\') {\n            methodName = \'log\';\n        }\n\n        if (typeof console === undefinedType) {\n            return false; // No method possible, for now - fixed later by enableLoggingWhenConsoleArrives\n        } else if (console[methodName] !== undefined) {\n            return bindMethod(console, methodName);\n        } else if (console.log !== undefined) {\n            return bindMethod(console, \'log\');\n        } else {\n            return noop;\n        }\n    }\n\n    // These private functions always need `this` to be set properly\n\n    function replaceLoggingMethods(level, loggerName) {\n        /*jshint validthis:true */\n        for (var i = 0; i < logMethods.length; i++) {\n            var methodName = logMethods[i];\n            this[methodName] = (i < level) ?\n                noop :\n                this.methodFactory(methodName, level, loggerName);\n        }\n\n        // Define log.log as an alias for log.debug\n        this.log = this.debug;\n    }\n\n    // In old IE versions, the console isn\'t present until you first open it.\n    // We build realMethod() replacements here that regenerate logging methods\n    function enableLoggingWhenConsoleArrives(methodName, level, loggerName) {\n        return function () {\n            if (typeof console !== undefinedType) {\n                replaceLoggingMethods.call(this, level, loggerName);\n                this[methodName].apply(this, arguments);\n            }\n        };\n    }\n\n    // By default, we use closely bound real methods wherever possible, and\n    // otherwise we wait for a console to appear, and then try again.\n    function defaultMethodFactory(methodName, level, loggerName) {\n        /*jshint validthis:true */\n        return realMethod(methodName) ||\n               enableLoggingWhenConsoleArrives.apply(this, arguments);\n    }\n\n    function Logger(name, defaultLevel, factory) {\n      var self = this;\n      var currentLevel;\n      var storageKey = "loglevel";\n      if (name) {\n        storageKey += ":" + name;\n      }\n\n      function persistLevelIfPossible(levelNum) {\n          var levelName = (logMethods[levelNum] || \'silent\').toUpperCase();\n\n          if (typeof window === undefinedType) return;\n\n          // Use localStorage if available\n          try {\n              window.localStorage[storageKey] = levelName;\n              return;\n          } catch (ignore) {}\n\n          // Use session cookie as fallback\n          try {\n              window.document.cookie =\n                encodeURIComponent(storageKey) + "=" + levelName + ";";\n          } catch (ignore) {}\n      }\n\n      function getPersistedLevel() {\n          var storedLevel;\n\n          if (typeof window === undefinedType) return;\n\n          try {\n              storedLevel = window.localStorage[storageKey];\n          } catch (ignore) {}\n\n          // Fallback to cookies if local storage gives us nothing\n          if (typeof storedLevel === undefinedType) {\n              try {\n                  var cookie = window.document.cookie;\n                  var location = cookie.indexOf(\n                      encodeURIComponent(storageKey) + "=");\n                  if (location !== -1) {\n                      storedLevel = /^([^;]+)/.exec(cookie.slice(location))[1];\n                  }\n              } catch (ignore) {}\n          }\n\n          // If the stored level is not valid, treat it as if nothing was stored.\n          if (self.levels[storedLevel] === undefined) {\n              storedLevel = undefined;\n          }\n\n          return storedLevel;\n      }\n\n      /*\n       *\n       * Public logger API - see https://github.com/pimterry/loglevel for details\n       *\n       */\n\n      self.name = name;\n\n      self.levels = { "TRACE": 0, "DEBUG": 1, "INFO": 2, "WARN": 3,\n          "ERROR": 4, "SILENT": 5};\n\n      self.methodFactory = factory || defaultMethodFactory;\n\n      self.getLevel = function () {\n          return currentLevel;\n      };\n\n      self.setLevel = function (level, persist) {\n          if (typeof level === "string" && self.levels[level.toUpperCase()] !== undefined) {\n              level = self.levels[level.toUpperCase()];\n          }\n          if (typeof level === "number" && level >= 0 && level <= self.levels.SILENT) {\n              currentLevel = level;\n              if (persist !== false) {  // defaults to true\n                  persistLevelIfPossible(level);\n              }\n              replaceLoggingMethods.call(self, level, name);\n              if (typeof console === undefinedType && level < self.levels.SILENT) {\n                  return "No console available for logging";\n              }\n          } else {\n              throw "log.setLevel() called with invalid level: " + level;\n          }\n      };\n\n      self.setDefaultLevel = function (level) {\n          if (!getPersistedLevel()) {\n              self.setLevel(level, false);\n          }\n      };\n\n      self.enableAll = function(persist) {\n          self.setLevel(self.levels.TRACE, persist);\n      };\n\n      self.disableAll = function(persist) {\n          self.setLevel(self.levels.SILENT, persist);\n      };\n\n      // Initialize with the right level\n      var initialLevel = getPersistedLevel();\n      if (initialLevel == null) {\n          initialLevel = defaultLevel == null ? "WARN" : defaultLevel;\n      }\n      self.setLevel(initialLevel, false);\n    }\n\n    /*\n     *\n     * Top-level API\n     *\n     */\n\n    var defaultLogger = new Logger();\n\n    var _loggersByName = {};\n    defaultLogger.getLogger = function getLogger(name) {\n        if (typeof name !== "string" || name === "") {\n          throw new TypeError("You must supply a name when creating a logger.");\n        }\n\n        var logger = _loggersByName[name];\n        if (!logger) {\n          logger = _loggersByName[name] = new Logger(\n            name, defaultLogger.getLevel(), defaultLogger.methodFactory);\n        }\n        return logger;\n    };\n\n    // Grab the current global log variable in case of overwrite\n    var _log = (typeof window !== undefinedType) ? window.log : undefined;\n    defaultLogger.noConflict = function() {\n        if (typeof window !== undefinedType &&\n               window.log === defaultLogger) {\n            window.log = _log;\n        }\n\n        return defaultLogger;\n    };\n\n    defaultLogger.getLoggers = function getLoggers() {\n        return _loggersByName;\n    };\n\n    return defaultLogger;\n}));\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMC5qcyIsInNvdXJjZXMiOlsid2VicGFjazovL1tuYW1lXS8uL25vZGVfbW9kdWxlcy9sb2dsZXZlbC9saWIvbG9nbGV2ZWwuanM/NWM3ZCJdLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuKiBsb2dsZXZlbCAtIGh0dHBzOi8vZ2l0aHViLmNvbS9waW10ZXJyeS9sb2dsZXZlbFxuKlxuKiBDb3B5cmlnaHQgKGMpIDIwMTMgVGltIFBlcnJ5XG4qIExpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgbGljZW5zZS5cbiovXG4oZnVuY3Rpb24gKHJvb3QsIGRlZmluaXRpb24pIHtcbiAgICBcInVzZSBzdHJpY3RcIjtcbiAgICBpZiAodHlwZW9mIGRlZmluZSA9PT0gJ2Z1bmN0aW9uJyAmJiBkZWZpbmUuYW1kKSB7XG4gICAgICAgIGRlZmluZShkZWZpbml0aW9uKTtcbiAgICB9IGVsc2UgaWYgKHR5cGVvZiBtb2R1bGUgPT09ICdvYmplY3QnICYmIG1vZHVsZS5leHBvcnRzKSB7XG4gICAgICAgIG1vZHVsZS5leHBvcnRzID0gZGVmaW5pdGlvbigpO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIHJvb3QubG9nID0gZGVmaW5pdGlvbigpO1xuICAgIH1cbn0odGhpcywgZnVuY3Rpb24gKCkge1xuICAgIFwidXNlIHN0cmljdFwiO1xuXG4gICAgLy8gU2xpZ2h0bHkgZHViaW91cyB0cmlja3MgdG8gY3V0IGRvd24gbWluaW1pemVkIGZpbGUgc2l6ZVxuICAgIHZhciBub29wID0gZnVuY3Rpb24oKSB7fTtcbiAgICB2YXIgdW5kZWZpbmVkVHlwZSA9IFwidW5kZWZpbmVkXCI7XG5cbiAgICB2YXIgbG9nTWV0aG9kcyA9IFtcbiAgICAgICAgXCJ0cmFjZVwiLFxuICAgICAgICBcImRlYnVnXCIsXG4gICAgICAgIFwiaW5mb1wiLFxuICAgICAgICBcIndhcm5cIixcbiAgICAgICAgXCJlcnJvclwiXG4gICAgXTtcblxuICAgIC8vIENyb3NzLWJyb3dzZXIgYmluZCBlcXVpdmFsZW50IHRoYXQgd29ya3MgYXQgbGVhc3QgYmFjayB0byBJRTZcbiAgICBmdW5jdGlvbiBiaW5kTWV0aG9kKG9iaiwgbWV0aG9kTmFtZSkge1xuICAgICAgICB2YXIgbWV0aG9kID0gb2JqW21ldGhvZE5hbWVdO1xuICAgICAgICBpZiAodHlwZW9mIG1ldGhvZC5iaW5kID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICByZXR1cm4gbWV0aG9kLmJpbmQob2JqKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIEZ1bmN0aW9uLnByb3RvdHlwZS5iaW5kLmNhbGwobWV0aG9kLCBvYmopO1xuICAgICAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICAgICAgIC8vIE1pc3NpbmcgYmluZCBzaGltIG9yIElFOCArIE1vZGVybml6ciwgZmFsbGJhY2sgdG8gd3JhcHBpbmdcbiAgICAgICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBGdW5jdGlvbi5wcm90b3R5cGUuYXBwbHkuYXBwbHkobWV0aG9kLCBbb2JqLCBhcmd1bWVudHNdKTtcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgLy8gQnVpbGQgdGhlIGJlc3QgbG9nZ2luZyBtZXRob2QgcG9zc2libGUgZm9yIHRoaXMgZW52XG4gICAgLy8gV2hlcmV2ZXIgcG9zc2libGUgd2Ugd2FudCB0byBiaW5kLCBub3Qgd3JhcCwgdG8gcHJlc2VydmUgc3RhY2sgdHJhY2VzXG4gICAgZnVuY3Rpb24gcmVhbE1ldGhvZChtZXRob2ROYW1lKSB7XG4gICAgICAgIGlmIChtZXRob2ROYW1lID09PSAnZGVidWcnKSB7XG4gICAgICAgICAgICBtZXRob2ROYW1lID0gJ2xvZyc7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodHlwZW9mIGNvbnNvbGUgPT09IHVuZGVmaW5lZFR5cGUpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTsgLy8gTm8gbWV0aG9kIHBvc3NpYmxlLCBmb3Igbm93IC0gZml4ZWQgbGF0ZXIgYnkgZW5hYmxlTG9nZ2luZ1doZW5Db25zb2xlQXJyaXZlc1xuICAgICAgICB9IGVsc2UgaWYgKGNvbnNvbGVbbWV0aG9kTmFtZV0gIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgcmV0dXJuIGJpbmRNZXRob2QoY29uc29sZSwgbWV0aG9kTmFtZSk7XG4gICAgICAgIH0gZWxzZSBpZiAoY29uc29sZS5sb2cgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgcmV0dXJuIGJpbmRNZXRob2QoY29uc29sZSwgJ2xvZycpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIG5vb3A7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBUaGVzZSBwcml2YXRlIGZ1bmN0aW9ucyBhbHdheXMgbmVlZCBgdGhpc2AgdG8gYmUgc2V0IHByb3Blcmx5XG5cbiAgICBmdW5jdGlvbiByZXBsYWNlTG9nZ2luZ01ldGhvZHMobGV2ZWwsIGxvZ2dlck5hbWUpIHtcbiAgICAgICAgLypqc2hpbnQgdmFsaWR0aGlzOnRydWUgKi9cbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsb2dNZXRob2RzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICB2YXIgbWV0aG9kTmFtZSA9IGxvZ01ldGhvZHNbaV07XG4gICAgICAgICAgICB0aGlzW21ldGhvZE5hbWVdID0gKGkgPCBsZXZlbCkgP1xuICAgICAgICAgICAgICAgIG5vb3AgOlxuICAgICAgICAgICAgICAgIHRoaXMubWV0aG9kRmFjdG9yeShtZXRob2ROYW1lLCBsZXZlbCwgbG9nZ2VyTmFtZSk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBEZWZpbmUgbG9nLmxvZyBhcyBhbiBhbGlhcyBmb3IgbG9nLmRlYnVnXG4gICAgICAgIHRoaXMubG9nID0gdGhpcy5kZWJ1ZztcbiAgICB9XG5cbiAgICAvLyBJbiBvbGQgSUUgdmVyc2lvbnMsIHRoZSBjb25zb2xlIGlzbid0IHByZXNlbnQgdW50aWwgeW91IGZpcnN0IG9wZW4gaXQuXG4gICAgLy8gV2UgYnVpbGQgcmVhbE1ldGhvZCgpIHJlcGxhY2VtZW50cyBoZXJlIHRoYXQgcmVnZW5lcmF0ZSBsb2dnaW5nIG1ldGhvZHNcbiAgICBmdW5jdGlvbiBlbmFibGVMb2dnaW5nV2hlbkNvbnNvbGVBcnJpdmVzKG1ldGhvZE5hbWUsIGxldmVsLCBsb2dnZXJOYW1lKSB7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBpZiAodHlwZW9mIGNvbnNvbGUgIT09IHVuZGVmaW5lZFR5cGUpIHtcbiAgICAgICAgICAgICAgICByZXBsYWNlTG9nZ2luZ01ldGhvZHMuY2FsbCh0aGlzLCBsZXZlbCwgbG9nZ2VyTmFtZSk7XG4gICAgICAgICAgICAgICAgdGhpc1ttZXRob2ROYW1lXS5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgIH1cblxuICAgIC8vIEJ5IGRlZmF1bHQsIHdlIHVzZSBjbG9zZWx5IGJvdW5kIHJlYWwgbWV0aG9kcyB3aGVyZXZlciBwb3NzaWJsZSwgYW5kXG4gICAgLy8gb3RoZXJ3aXNlIHdlIHdhaXQgZm9yIGEgY29uc29sZSB0byBhcHBlYXIsIGFuZCB0aGVuIHRyeSBhZ2Fpbi5cbiAgICBmdW5jdGlvbiBkZWZhdWx0TWV0aG9kRmFjdG9yeShtZXRob2ROYW1lLCBsZXZlbCwgbG9nZ2VyTmFtZSkge1xuICAgICAgICAvKmpzaGludCB2YWxpZHRoaXM6dHJ1ZSAqL1xuICAgICAgICByZXR1cm4gcmVhbE1ldGhvZChtZXRob2ROYW1lKSB8fFxuICAgICAgICAgICAgICAgZW5hYmxlTG9nZ2luZ1doZW5Db25zb2xlQXJyaXZlcy5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIExvZ2dlcihuYW1lLCBkZWZhdWx0TGV2ZWwsIGZhY3RvcnkpIHtcbiAgICAgIHZhciBzZWxmID0gdGhpcztcbiAgICAgIHZhciBjdXJyZW50TGV2ZWw7XG4gICAgICB2YXIgc3RvcmFnZUtleSA9IFwibG9nbGV2ZWxcIjtcbiAgICAgIGlmIChuYW1lKSB7XG4gICAgICAgIHN0b3JhZ2VLZXkgKz0gXCI6XCIgKyBuYW1lO1xuICAgICAgfVxuXG4gICAgICBmdW5jdGlvbiBwZXJzaXN0TGV2ZWxJZlBvc3NpYmxlKGxldmVsTnVtKSB7XG4gICAgICAgICAgdmFyIGxldmVsTmFtZSA9IChsb2dNZXRob2RzW2xldmVsTnVtXSB8fCAnc2lsZW50JykudG9VcHBlckNhc2UoKTtcblxuICAgICAgICAgIGlmICh0eXBlb2Ygd2luZG93ID09PSB1bmRlZmluZWRUeXBlKSByZXR1cm47XG5cbiAgICAgICAgICAvLyBVc2UgbG9jYWxTdG9yYWdlIGlmIGF2YWlsYWJsZVxuICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgIHdpbmRvdy5sb2NhbFN0b3JhZ2Vbc3RvcmFnZUtleV0gPSBsZXZlbE5hbWU7XG4gICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICB9IGNhdGNoIChpZ25vcmUpIHt9XG5cbiAgICAgICAgICAvLyBVc2Ugc2Vzc2lvbiBjb29raWUgYXMgZmFsbGJhY2tcbiAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICB3aW5kb3cuZG9jdW1lbnQuY29va2llID1cbiAgICAgICAgICAgICAgICBlbmNvZGVVUklDb21wb25lbnQoc3RvcmFnZUtleSkgKyBcIj1cIiArIGxldmVsTmFtZSArIFwiO1wiO1xuICAgICAgICAgIH0gY2F0Y2ggKGlnbm9yZSkge31cbiAgICAgIH1cblxuICAgICAgZnVuY3Rpb24gZ2V0UGVyc2lzdGVkTGV2ZWwoKSB7XG4gICAgICAgICAgdmFyIHN0b3JlZExldmVsO1xuXG4gICAgICAgICAgaWYgKHR5cGVvZiB3aW5kb3cgPT09IHVuZGVmaW5lZFR5cGUpIHJldHVybjtcblxuICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgIHN0b3JlZExldmVsID0gd2luZG93LmxvY2FsU3RvcmFnZVtzdG9yYWdlS2V5XTtcbiAgICAgICAgICB9IGNhdGNoIChpZ25vcmUpIHt9XG5cbiAgICAgICAgICAvLyBGYWxsYmFjayB0byBjb29raWVzIGlmIGxvY2FsIHN0b3JhZ2UgZ2l2ZXMgdXMgbm90aGluZ1xuICAgICAgICAgIGlmICh0eXBlb2Ygc3RvcmVkTGV2ZWwgPT09IHVuZGVmaW5lZFR5cGUpIHtcbiAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgIHZhciBjb29raWUgPSB3aW5kb3cuZG9jdW1lbnQuY29va2llO1xuICAgICAgICAgICAgICAgICAgdmFyIGxvY2F0aW9uID0gY29va2llLmluZGV4T2YoXG4gICAgICAgICAgICAgICAgICAgICAgZW5jb2RlVVJJQ29tcG9uZW50KHN0b3JhZ2VLZXkpICsgXCI9XCIpO1xuICAgICAgICAgICAgICAgICAgaWYgKGxvY2F0aW9uICE9PSAtMSkge1xuICAgICAgICAgICAgICAgICAgICAgIHN0b3JlZExldmVsID0gL14oW147XSspLy5leGVjKGNvb2tpZS5zbGljZShsb2NhdGlvbikpWzFdO1xuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9IGNhdGNoIChpZ25vcmUpIHt9XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgLy8gSWYgdGhlIHN0b3JlZCBsZXZlbCBpcyBub3QgdmFsaWQsIHRyZWF0IGl0IGFzIGlmIG5vdGhpbmcgd2FzIHN0b3JlZC5cbiAgICAgICAgICBpZiAoc2VsZi5sZXZlbHNbc3RvcmVkTGV2ZWxdID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgc3RvcmVkTGV2ZWwgPSB1bmRlZmluZWQ7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgcmV0dXJuIHN0b3JlZExldmVsO1xuICAgICAgfVxuXG4gICAgICAvKlxuICAgICAgICpcbiAgICAgICAqIFB1YmxpYyBsb2dnZXIgQVBJIC0gc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9waW10ZXJyeS9sb2dsZXZlbCBmb3IgZGV0YWlsc1xuICAgICAgICpcbiAgICAgICAqL1xuXG4gICAgICBzZWxmLm5hbWUgPSBuYW1lO1xuXG4gICAgICBzZWxmLmxldmVscyA9IHsgXCJUUkFDRVwiOiAwLCBcIkRFQlVHXCI6IDEsIFwiSU5GT1wiOiAyLCBcIldBUk5cIjogMyxcbiAgICAgICAgICBcIkVSUk9SXCI6IDQsIFwiU0lMRU5UXCI6IDV9O1xuXG4gICAgICBzZWxmLm1ldGhvZEZhY3RvcnkgPSBmYWN0b3J5IHx8IGRlZmF1bHRNZXRob2RGYWN0b3J5O1xuXG4gICAgICBzZWxmLmdldExldmVsID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHJldHVybiBjdXJyZW50TGV2ZWw7XG4gICAgICB9O1xuXG4gICAgICBzZWxmLnNldExldmVsID0gZnVuY3Rpb24gKGxldmVsLCBwZXJzaXN0KSB7XG4gICAgICAgICAgaWYgKHR5cGVvZiBsZXZlbCA9PT0gXCJzdHJpbmdcIiAmJiBzZWxmLmxldmVsc1tsZXZlbC50b1VwcGVyQ2FzZSgpXSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgIGxldmVsID0gc2VsZi5sZXZlbHNbbGV2ZWwudG9VcHBlckNhc2UoKV07XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmICh0eXBlb2YgbGV2ZWwgPT09IFwibnVtYmVyXCIgJiYgbGV2ZWwgPj0gMCAmJiBsZXZlbCA8PSBzZWxmLmxldmVscy5TSUxFTlQpIHtcbiAgICAgICAgICAgICAgY3VycmVudExldmVsID0gbGV2ZWw7XG4gICAgICAgICAgICAgIGlmIChwZXJzaXN0ICE9PSBmYWxzZSkgeyAgLy8gZGVmYXVsdHMgdG8gdHJ1ZVxuICAgICAgICAgICAgICAgICAgcGVyc2lzdExldmVsSWZQb3NzaWJsZShsZXZlbCk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgcmVwbGFjZUxvZ2dpbmdNZXRob2RzLmNhbGwoc2VsZiwgbGV2ZWwsIG5hbWUpO1xuICAgICAgICAgICAgICBpZiAodHlwZW9mIGNvbnNvbGUgPT09IHVuZGVmaW5lZFR5cGUgJiYgbGV2ZWwgPCBzZWxmLmxldmVscy5TSUxFTlQpIHtcbiAgICAgICAgICAgICAgICAgIHJldHVybiBcIk5vIGNvbnNvbGUgYXZhaWxhYmxlIGZvciBsb2dnaW5nXCI7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICB0aHJvdyBcImxvZy5zZXRMZXZlbCgpIGNhbGxlZCB3aXRoIGludmFsaWQgbGV2ZWw6IFwiICsgbGV2ZWw7XG4gICAgICAgICAgfVxuICAgICAgfTtcblxuICAgICAgc2VsZi5zZXREZWZhdWx0TGV2ZWwgPSBmdW5jdGlvbiAobGV2ZWwpIHtcbiAgICAgICAgICBpZiAoIWdldFBlcnNpc3RlZExldmVsKCkpIHtcbiAgICAgICAgICAgICAgc2VsZi5zZXRMZXZlbChsZXZlbCwgZmFsc2UpO1xuICAgICAgICAgIH1cbiAgICAgIH07XG5cbiAgICAgIHNlbGYuZW5hYmxlQWxsID0gZnVuY3Rpb24ocGVyc2lzdCkge1xuICAgICAgICAgIHNlbGYuc2V0TGV2ZWwoc2VsZi5sZXZlbHMuVFJBQ0UsIHBlcnNpc3QpO1xuICAgICAgfTtcblxuICAgICAgc2VsZi5kaXNhYmxlQWxsID0gZnVuY3Rpb24ocGVyc2lzdCkge1xuICAgICAgICAgIHNlbGYuc2V0TGV2ZWwoc2VsZi5sZXZlbHMuU0lMRU5ULCBwZXJzaXN0KTtcbiAgICAgIH07XG5cbiAgICAgIC8vIEluaXRpYWxpemUgd2l0aCB0aGUgcmlnaHQgbGV2ZWxcbiAgICAgIHZhciBpbml0aWFsTGV2ZWwgPSBnZXRQZXJzaXN0ZWRMZXZlbCgpO1xuICAgICAgaWYgKGluaXRpYWxMZXZlbCA9PSBudWxsKSB7XG4gICAgICAgICAgaW5pdGlhbExldmVsID0gZGVmYXVsdExldmVsID09IG51bGwgPyBcIldBUk5cIiA6IGRlZmF1bHRMZXZlbDtcbiAgICAgIH1cbiAgICAgIHNlbGYuc2V0TGV2ZWwoaW5pdGlhbExldmVsLCBmYWxzZSk7XG4gICAgfVxuXG4gICAgLypcbiAgICAgKlxuICAgICAqIFRvcC1sZXZlbCBBUElcbiAgICAgKlxuICAgICAqL1xuXG4gICAgdmFyIGRlZmF1bHRMb2dnZXIgPSBuZXcgTG9nZ2VyKCk7XG5cbiAgICB2YXIgX2xvZ2dlcnNCeU5hbWUgPSB7fTtcbiAgICBkZWZhdWx0TG9nZ2VyLmdldExvZ2dlciA9IGZ1bmN0aW9uIGdldExvZ2dlcihuYW1lKSB7XG4gICAgICAgIGlmICh0eXBlb2YgbmFtZSAhPT0gXCJzdHJpbmdcIiB8fCBuYW1lID09PSBcIlwiKSB7XG4gICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcIllvdSBtdXN0IHN1cHBseSBhIG5hbWUgd2hlbiBjcmVhdGluZyBhIGxvZ2dlci5cIik7XG4gICAgICAgIH1cblxuICAgICAgICB2YXIgbG9nZ2VyID0gX2xvZ2dlcnNCeU5hbWVbbmFtZV07XG4gICAgICAgIGlmICghbG9nZ2VyKSB7XG4gICAgICAgICAgbG9nZ2VyID0gX2xvZ2dlcnNCeU5hbWVbbmFtZV0gPSBuZXcgTG9nZ2VyKFxuICAgICAgICAgICAgbmFtZSwgZGVmYXVsdExvZ2dlci5nZXRMZXZlbCgpLCBkZWZhdWx0TG9nZ2VyLm1ldGhvZEZhY3RvcnkpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBsb2dnZXI7XG4gICAgfTtcblxuICAgIC8vIEdyYWIgdGhlIGN1cnJlbnQgZ2xvYmFsIGxvZyB2YXJpYWJsZSBpbiBjYXNlIG9mIG92ZXJ3cml0ZVxuICAgIHZhciBfbG9nID0gKHR5cGVvZiB3aW5kb3cgIT09IHVuZGVmaW5lZFR5cGUpID8gd2luZG93LmxvZyA6IHVuZGVmaW5lZDtcbiAgICBkZWZhdWx0TG9nZ2VyLm5vQ29uZmxpY3QgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgaWYgKHR5cGVvZiB3aW5kb3cgIT09IHVuZGVmaW5lZFR5cGUgJiZcbiAgICAgICAgICAgICAgIHdpbmRvdy5sb2cgPT09IGRlZmF1bHRMb2dnZXIpIHtcbiAgICAgICAgICAgIHdpbmRvdy5sb2cgPSBfbG9nO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGRlZmF1bHRMb2dnZXI7XG4gICAgfTtcblxuICAgIGRlZmF1bHRMb2dnZXIuZ2V0TG9nZ2VycyA9IGZ1bmN0aW9uIGdldExvZ2dlcnMoKSB7XG4gICAgICAgIHJldHVybiBfbG9nZ2Vyc0J5TmFtZTtcbiAgICB9O1xuXG4gICAgcmV0dXJuIGRlZmF1bHRMb2dnZXI7XG59KSk7XG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQSxhQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Iiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///0\n')},function(module,exports,__webpack_require__){eval("var global = __webpack_require__(2);\nvar core = __webpack_require__(8);\nvar hide = __webpack_require__(15);\nvar redefine = __webpack_require__(12);\nvar ctx = __webpack_require__(18);\nvar PROTOTYPE = 'prototype';\n\nvar $export = function (type, name, source) {\n  var IS_FORCED = type & $export.F;\n  var IS_GLOBAL = type & $export.G;\n  var IS_STATIC = type & $export.S;\n  var IS_PROTO = type & $export.P;\n  var IS_BIND = type & $export.B;\n  var target = IS_GLOBAL ? global : IS_STATIC ? global[name] || (global[name] = {}) : (global[name] || {})[PROTOTYPE];\n  var exports = IS_GLOBAL ? core : core[name] || (core[name] = {});\n  var expProto = exports[PROTOTYPE] || (exports[PROTOTYPE] = {});\n  var key, own, out, exp;\n  if (IS_GLOBAL) source = name;\n  for (key in source) {\n    // contains in native\n    own = !IS_FORCED && target && target[key] !== undefined;\n    // export native or passed\n    out = (own ? target : source)[key];\n    // bind timers to global for call from export context\n    exp = IS_BIND && own ? ctx(out, global) : IS_PROTO && typeof out == 'function' ? ctx(Function.call, out) : out;\n    // extend global\n    if (target) redefine(target, key, out, type & $export.U);\n    // export\n    if (exports[key] != out) hide(exports, key, exp);\n    if (IS_PROTO && expProto[key] != out) expProto[key] = out;\n  }\n};\nglobal.core = core;\n// type bitmap\n$export.F = 1;   // forced\n$export.G = 2;   // global\n$export.S = 4;   // static\n$export.P = 8;   // proto\n$export.B = 16;  // bind\n$export.W = 32;  // wrap\n$export.U = 64;  // safe\n$export.R = 128; // real proto method for `library`\nmodule.exports = $export;\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMS5qcyIsInNvdXJjZXMiOlsid2VicGFjazovL1tuYW1lXS8uL25vZGVfbW9kdWxlcy9jb3JlLWpzL21vZHVsZXMvX2V4cG9ydC5qcz81Y2ExIl0sInNvdXJjZXNDb250ZW50IjpbInZhciBnbG9iYWwgPSByZXF1aXJlKCcuL19nbG9iYWwnKTtcbnZhciBjb3JlID0gcmVxdWlyZSgnLi9fY29yZScpO1xudmFyIGhpZGUgPSByZXF1aXJlKCcuL19oaWRlJyk7XG52YXIgcmVkZWZpbmUgPSByZXF1aXJlKCcuL19yZWRlZmluZScpO1xudmFyIGN0eCA9IHJlcXVpcmUoJy4vX2N0eCcpO1xudmFyIFBST1RPVFlQRSA9ICdwcm90b3R5cGUnO1xuXG52YXIgJGV4cG9ydCA9IGZ1bmN0aW9uICh0eXBlLCBuYW1lLCBzb3VyY2UpIHtcbiAgdmFyIElTX0ZPUkNFRCA9IHR5cGUgJiAkZXhwb3J0LkY7XG4gIHZhciBJU19HTE9CQUwgPSB0eXBlICYgJGV4cG9ydC5HO1xuICB2YXIgSVNfU1RBVElDID0gdHlwZSAmICRleHBvcnQuUztcbiAgdmFyIElTX1BST1RPID0gdHlwZSAmICRleHBvcnQuUDtcbiAgdmFyIElTX0JJTkQgPSB0eXBlICYgJGV4cG9ydC5CO1xuICB2YXIgdGFyZ2V0ID0gSVNfR0xPQkFMID8gZ2xvYmFsIDogSVNfU1RBVElDID8gZ2xvYmFsW25hbWVdIHx8IChnbG9iYWxbbmFtZV0gPSB7fSkgOiAoZ2xvYmFsW25hbWVdIHx8IHt9KVtQUk9UT1RZUEVdO1xuICB2YXIgZXhwb3J0cyA9IElTX0dMT0JBTCA/IGNvcmUgOiBjb3JlW25hbWVdIHx8IChjb3JlW25hbWVdID0ge30pO1xuICB2YXIgZXhwUHJvdG8gPSBleHBvcnRzW1BST1RPVFlQRV0gfHwgKGV4cG9ydHNbUFJPVE9UWVBFXSA9IHt9KTtcbiAgdmFyIGtleSwgb3duLCBvdXQsIGV4cDtcbiAgaWYgKElTX0dMT0JBTCkgc291cmNlID0gbmFtZTtcbiAgZm9yIChrZXkgaW4gc291cmNlKSB7XG4gICAgLy8gY29udGFpbnMgaW4gbmF0aXZlXG4gICAgb3duID0gIUlTX0ZPUkNFRCAmJiB0YXJnZXQgJiYgdGFyZ2V0W2tleV0gIT09IHVuZGVmaW5lZDtcbiAgICAvLyBleHBvcnQgbmF0aXZlIG9yIHBhc3NlZFxuICAgIG91dCA9IChvd24gPyB0YXJnZXQgOiBzb3VyY2UpW2tleV07XG4gICAgLy8gYmluZCB0aW1lcnMgdG8gZ2xvYmFsIGZvciBjYWxsIGZyb20gZXhwb3J0IGNvbnRleHRcbiAgICBleHAgPSBJU19CSU5EICYmIG93biA/IGN0eChvdXQsIGdsb2JhbCkgOiBJU19QUk9UTyAmJiB0eXBlb2Ygb3V0ID09ICdmdW5jdGlvbicgPyBjdHgoRnVuY3Rpb24uY2FsbCwgb3V0KSA6IG91dDtcbiAgICAvLyBleHRlbmQgZ2xvYmFsXG4gICAgaWYgKHRhcmdldCkgcmVkZWZpbmUodGFyZ2V0LCBrZXksIG91dCwgdHlwZSAmICRleHBvcnQuVSk7XG4gICAgLy8gZXhwb3J0XG4gICAgaWYgKGV4cG9ydHNba2V5XSAhPSBvdXQpIGhpZGUoZXhwb3J0cywga2V5LCBleHApO1xuICAgIGlmIChJU19QUk9UTyAmJiBleHBQcm90b1trZXldICE9IG91dCkgZXhwUHJvdG9ba2V5XSA9IG91dDtcbiAgfVxufTtcbmdsb2JhbC5jb3JlID0gY29yZTtcbi8vIHR5cGUgYml0bWFwXG4kZXhwb3J0LkYgPSAxOyAgIC8vIGZvcmNlZFxuJGV4cG9ydC5HID0gMjsgICAvLyBnbG9iYWxcbiRleHBvcnQuUyA9IDQ7ICAgLy8gc3RhdGljXG4kZXhwb3J0LlAgPSA4OyAgIC8vIHByb3RvXG4kZXhwb3J0LkIgPSAxNjsgIC8vIGJpbmRcbiRleHBvcnQuVyA9IDMyOyAgLy8gd3JhcFxuJGV4cG9ydC5VID0gNjQ7ICAvLyBzYWZlXG4kZXhwb3J0LlIgPSAxMjg7IC8vIHJlYWwgcHJvdG8gbWV0aG9kIGZvciBgbGlicmFyeWBcbm1vZHVsZS5leHBvcnRzID0gJGV4cG9ydDtcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Iiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///1\n")},function(module,exports){eval("// https://github.com/zloirock/core-js/issues/86#issuecomment-115759028\nvar global = module.exports = typeof window != 'undefined' && window.Math == Math\n  ? window : typeof self != 'undefined' && self.Math == Math ? self\n  // eslint-disable-next-line no-new-func\n  : Function('return this')();\nif (typeof __g == 'number') __g = global; // eslint-disable-line no-undef\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMi5qcyIsInNvdXJjZXMiOlsid2VicGFjazovL1tuYW1lXS8uL25vZGVfbW9kdWxlcy9jb3JlLWpzL21vZHVsZXMvX2dsb2JhbC5qcz83NzI2Il0sInNvdXJjZXNDb250ZW50IjpbIi8vIGh0dHBzOi8vZ2l0aHViLmNvbS96bG9pcm9jay9jb3JlLWpzL2lzc3Vlcy84NiNpc3N1ZWNvbW1lbnQtMTE1NzU5MDI4XG52YXIgZ2xvYmFsID0gbW9kdWxlLmV4cG9ydHMgPSB0eXBlb2Ygd2luZG93ICE9ICd1bmRlZmluZWQnICYmIHdpbmRvdy5NYXRoID09IE1hdGhcbiAgPyB3aW5kb3cgOiB0eXBlb2Ygc2VsZiAhPSAndW5kZWZpbmVkJyAmJiBzZWxmLk1hdGggPT0gTWF0aCA/IHNlbGZcbiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLW5ldy1mdW5jXG4gIDogRnVuY3Rpb24oJ3JldHVybiB0aGlzJykoKTtcbmlmICh0eXBlb2YgX19nID09ICdudW1iZXInKSBfX2cgPSBnbG9iYWw7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgbm8tdW5kZWZcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///2\n")},function(module,exports){eval("module.exports = function (exec) {\n  try {\n    return !!exec();\n  } catch (e) {\n    return true;\n  }\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMy5qcyIsInNvdXJjZXMiOlsid2VicGFjazovL1tuYW1lXS8uL25vZGVfbW9kdWxlcy9jb3JlLWpzL21vZHVsZXMvX2ZhaWxzLmpzPzc5ZTUiXSwic291cmNlc0NvbnRlbnQiOlsibW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoZXhlYykge1xuICB0cnkge1xuICAgIHJldHVybiAhIWV4ZWMoKTtcbiAgfSBjYXRjaCAoZSkge1xuICAgIHJldHVybiB0cnVlO1xuICB9XG59O1xuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///3\n")},function(module,exports,__webpack_require__){eval("var isObject = __webpack_require__(5);\nmodule.exports = function (it) {\n  if (!isObject(it)) throw TypeError(it + ' is not an object!');\n  return it;\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNC5qcyIsInNvdXJjZXMiOlsid2VicGFjazovL1tuYW1lXS8uL25vZGVfbW9kdWxlcy9jb3JlLWpzL21vZHVsZXMvX2FuLW9iamVjdC5qcz9jYjdjIl0sInNvdXJjZXNDb250ZW50IjpbInZhciBpc09iamVjdCA9IHJlcXVpcmUoJy4vX2lzLW9iamVjdCcpO1xubW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoaXQpIHtcbiAgaWYgKCFpc09iamVjdChpdCkpIHRocm93IFR5cGVFcnJvcihpdCArICcgaXMgbm90IGFuIG9iamVjdCEnKTtcbiAgcmV0dXJuIGl0O1xufTtcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///4\n")},function(module,exports){eval("module.exports = function (it) {\n  return typeof it === 'object' ? it !== null : typeof it === 'function';\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNS5qcyIsInNvdXJjZXMiOlsid2VicGFjazovL1tuYW1lXS8uL25vZGVfbW9kdWxlcy9jb3JlLWpzL21vZHVsZXMvX2lzLW9iamVjdC5qcz9kM2Y0Il0sInNvdXJjZXNDb250ZW50IjpbIm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKGl0KSB7XG4gIHJldHVybiB0eXBlb2YgaXQgPT09ICdvYmplY3QnID8gaXQgIT09IG51bGwgOiB0eXBlb2YgaXQgPT09ICdmdW5jdGlvbic7XG59O1xuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7Iiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///5\n")},function(module,exports,__webpack_require__){eval("var store = __webpack_require__(49)('wks');\nvar uid = __webpack_require__(30);\nvar Symbol = __webpack_require__(2).Symbol;\nvar USE_SYMBOL = typeof Symbol == 'function';\n\nvar $exports = module.exports = function (name) {\n  return store[name] || (store[name] =\n    USE_SYMBOL && Symbol[name] || (USE_SYMBOL ? Symbol : uid)('Symbol.' + name));\n};\n\n$exports.store = store;\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNi5qcyIsInNvdXJjZXMiOlsid2VicGFjazovL1tuYW1lXS8uL25vZGVfbW9kdWxlcy9jb3JlLWpzL21vZHVsZXMvX3drcy5qcz8yYjRjIl0sInNvdXJjZXNDb250ZW50IjpbInZhciBzdG9yZSA9IHJlcXVpcmUoJy4vX3NoYXJlZCcpKCd3a3MnKTtcbnZhciB1aWQgPSByZXF1aXJlKCcuL191aWQnKTtcbnZhciBTeW1ib2wgPSByZXF1aXJlKCcuL19nbG9iYWwnKS5TeW1ib2w7XG52YXIgVVNFX1NZTUJPTCA9IHR5cGVvZiBTeW1ib2wgPT0gJ2Z1bmN0aW9uJztcblxudmFyICRleHBvcnRzID0gbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAobmFtZSkge1xuICByZXR1cm4gc3RvcmVbbmFtZV0gfHwgKHN0b3JlW25hbWVdID1cbiAgICBVU0VfU1lNQk9MICYmIFN5bWJvbFtuYW1lXSB8fCAoVVNFX1NZTUJPTCA/IFN5bWJvbCA6IHVpZCkoJ1N5bWJvbC4nICsgbmFtZSkpO1xufTtcblxuJGV4cG9ydHMuc3RvcmUgPSBzdG9yZTtcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///6\n")},function(module,exports,__webpack_require__){eval("// 7.1.15 ToLength\nvar toInteger = __webpack_require__(20);\nvar min = Math.min;\nmodule.exports = function (it) {\n  return it > 0 ? min(toInteger(it), 0x1fffffffffffff) : 0; // pow(2, 53) - 1 == 9007199254740991\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNy5qcyIsInNvdXJjZXMiOlsid2VicGFjazovL1tuYW1lXS8uL25vZGVfbW9kdWxlcy9jb3JlLWpzL21vZHVsZXMvX3RvLWxlbmd0aC5qcz85ZGVmIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIDcuMS4xNSBUb0xlbmd0aFxudmFyIHRvSW50ZWdlciA9IHJlcXVpcmUoJy4vX3RvLWludGVnZXInKTtcbnZhciBtaW4gPSBNYXRoLm1pbjtcbm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKGl0KSB7XG4gIHJldHVybiBpdCA+IDAgPyBtaW4odG9JbnRlZ2VyKGl0KSwgMHgxZmZmZmZmZmZmZmZmZikgOiAwOyAvLyBwb3coMiwgNTMpIC0gMSA9PSA5MDA3MTk5MjU0NzQwOTkxXG59O1xuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Iiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///7\n")},function(module,exports){eval("var core = module.exports = { version: '2.6.8' };\nif (typeof __e == 'number') __e = core; // eslint-disable-line no-undef\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiOC5qcyIsInNvdXJjZXMiOlsid2VicGFjazovL1tuYW1lXS8uL25vZGVfbW9kdWxlcy9jb3JlLWpzL21vZHVsZXMvX2NvcmUuanM/ODM3OCJdLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgY29yZSA9IG1vZHVsZS5leHBvcnRzID0geyB2ZXJzaW9uOiAnMi42LjgnIH07XG5pZiAodHlwZW9mIF9fZSA9PSAnbnVtYmVyJykgX19lID0gY29yZTsgLy8gZXNsaW50LWRpc2FibGUtbGluZSBuby11bmRlZlxuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///8\n")},function(module,exports,__webpack_require__){eval("// Thank's IE8 for his funny defineProperty\nmodule.exports = !__webpack_require__(3)(function () {\n  return Object.defineProperty({}, 'a', { get: function () { return 7; } }).a != 7;\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiOS5qcyIsInNvdXJjZXMiOlsid2VicGFjazovL1tuYW1lXS8uL25vZGVfbW9kdWxlcy9jb3JlLWpzL21vZHVsZXMvX2Rlc2NyaXB0b3JzLmpzPzllMWUiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gVGhhbmsncyBJRTggZm9yIGhpcyBmdW5ueSBkZWZpbmVQcm9wZXJ0eVxubW9kdWxlLmV4cG9ydHMgPSAhcmVxdWlyZSgnLi9fZmFpbHMnKShmdW5jdGlvbiAoKSB7XG4gIHJldHVybiBPYmplY3QuZGVmaW5lUHJvcGVydHkoe30sICdhJywgeyBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIDc7IH0gfSkuYSAhPSA3O1xufSk7XG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///9\n")},function(module,exports,__webpack_require__){eval("var anObject = __webpack_require__(4);\nvar IE8_DOM_DEFINE = __webpack_require__(91);\nvar toPrimitive = __webpack_require__(27);\nvar dP = Object.defineProperty;\n\nexports.f = __webpack_require__(9) ? Object.defineProperty : function defineProperty(O, P, Attributes) {\n  anObject(O);\n  P = toPrimitive(P, true);\n  anObject(Attributes);\n  if (IE8_DOM_DEFINE) try {\n    return dP(O, P, Attributes);\n  } catch (e) { /* empty */ }\n  if ('get' in Attributes || 'set' in Attributes) throw TypeError('Accessors not supported!');\n  if ('value' in Attributes) O[P] = Attributes.value;\n  return O;\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTAuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9bbmFtZV0vLi9ub2RlX21vZHVsZXMvY29yZS1qcy9tb2R1bGVzL19vYmplY3QtZHAuanM/ODZjYyJdLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgYW5PYmplY3QgPSByZXF1aXJlKCcuL19hbi1vYmplY3QnKTtcbnZhciBJRThfRE9NX0RFRklORSA9IHJlcXVpcmUoJy4vX2llOC1kb20tZGVmaW5lJyk7XG52YXIgdG9QcmltaXRpdmUgPSByZXF1aXJlKCcuL190by1wcmltaXRpdmUnKTtcbnZhciBkUCA9IE9iamVjdC5kZWZpbmVQcm9wZXJ0eTtcblxuZXhwb3J0cy5mID0gcmVxdWlyZSgnLi9fZGVzY3JpcHRvcnMnKSA/IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSA6IGZ1bmN0aW9uIGRlZmluZVByb3BlcnR5KE8sIFAsIEF0dHJpYnV0ZXMpIHtcbiAgYW5PYmplY3QoTyk7XG4gIFAgPSB0b1ByaW1pdGl2ZShQLCB0cnVlKTtcbiAgYW5PYmplY3QoQXR0cmlidXRlcyk7XG4gIGlmIChJRThfRE9NX0RFRklORSkgdHJ5IHtcbiAgICByZXR1cm4gZFAoTywgUCwgQXR0cmlidXRlcyk7XG4gIH0gY2F0Y2ggKGUpIHsgLyogZW1wdHkgKi8gfVxuICBpZiAoJ2dldCcgaW4gQXR0cmlidXRlcyB8fCAnc2V0JyBpbiBBdHRyaWJ1dGVzKSB0aHJvdyBUeXBlRXJyb3IoJ0FjY2Vzc29ycyBub3Qgc3VwcG9ydGVkIScpO1xuICBpZiAoJ3ZhbHVlJyBpbiBBdHRyaWJ1dGVzKSBPW1BdID0gQXR0cmlidXRlcy52YWx1ZTtcbiAgcmV0dXJuIE87XG59O1xuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///10\n")},function(module,exports,__webpack_require__){eval("// 7.1.13 ToObject(argument)\nvar defined = __webpack_require__(25);\nmodule.exports = function (it) {\n  return Object(defined(it));\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTEuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9bbmFtZV0vLi9ub2RlX21vZHVsZXMvY29yZS1qcy9tb2R1bGVzL190by1vYmplY3QuanM/NGJmOCJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyA3LjEuMTMgVG9PYmplY3QoYXJndW1lbnQpXG52YXIgZGVmaW5lZCA9IHJlcXVpcmUoJy4vX2RlZmluZWQnKTtcbm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKGl0KSB7XG4gIHJldHVybiBPYmplY3QoZGVmaW5lZChpdCkpO1xufTtcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///11\n")},function(module,exports,__webpack_require__){eval("var global = __webpack_require__(2);\nvar hide = __webpack_require__(15);\nvar has = __webpack_require__(14);\nvar SRC = __webpack_require__(30)('src');\nvar $toString = __webpack_require__(129);\nvar TO_STRING = 'toString';\nvar TPL = ('' + $toString).split(TO_STRING);\n\n__webpack_require__(8).inspectSource = function (it) {\n  return $toString.call(it);\n};\n\n(module.exports = function (O, key, val, safe) {\n  var isFunction = typeof val == 'function';\n  if (isFunction) has(val, 'name') || hide(val, 'name', key);\n  if (O[key] === val) return;\n  if (isFunction) has(val, SRC) || hide(val, SRC, O[key] ? '' + O[key] : TPL.join(String(key)));\n  if (O === global) {\n    O[key] = val;\n  } else if (!safe) {\n    delete O[key];\n    hide(O, key, val);\n  } else if (O[key]) {\n    O[key] = val;\n  } else {\n    hide(O, key, val);\n  }\n// add fake Function#toString for correct work wrapped methods / constructors with methods like LoDash isNative\n})(Function.prototype, TO_STRING, function toString() {\n  return typeof this == 'function' && this[SRC] || $toString.call(this);\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTIuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9bbmFtZV0vLi9ub2RlX21vZHVsZXMvY29yZS1qcy9tb2R1bGVzL19yZWRlZmluZS5qcz8yYWJhIl0sInNvdXJjZXNDb250ZW50IjpbInZhciBnbG9iYWwgPSByZXF1aXJlKCcuL19nbG9iYWwnKTtcbnZhciBoaWRlID0gcmVxdWlyZSgnLi9faGlkZScpO1xudmFyIGhhcyA9IHJlcXVpcmUoJy4vX2hhcycpO1xudmFyIFNSQyA9IHJlcXVpcmUoJy4vX3VpZCcpKCdzcmMnKTtcbnZhciAkdG9TdHJpbmcgPSByZXF1aXJlKCcuL19mdW5jdGlvbi10by1zdHJpbmcnKTtcbnZhciBUT19TVFJJTkcgPSAndG9TdHJpbmcnO1xudmFyIFRQTCA9ICgnJyArICR0b1N0cmluZykuc3BsaXQoVE9fU1RSSU5HKTtcblxucmVxdWlyZSgnLi9fY29yZScpLmluc3BlY3RTb3VyY2UgPSBmdW5jdGlvbiAoaXQpIHtcbiAgcmV0dXJuICR0b1N0cmluZy5jYWxsKGl0KTtcbn07XG5cbihtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChPLCBrZXksIHZhbCwgc2FmZSkge1xuICB2YXIgaXNGdW5jdGlvbiA9IHR5cGVvZiB2YWwgPT0gJ2Z1bmN0aW9uJztcbiAgaWYgKGlzRnVuY3Rpb24pIGhhcyh2YWwsICduYW1lJykgfHwgaGlkZSh2YWwsICduYW1lJywga2V5KTtcbiAgaWYgKE9ba2V5XSA9PT0gdmFsKSByZXR1cm47XG4gIGlmIChpc0Z1bmN0aW9uKSBoYXModmFsLCBTUkMpIHx8IGhpZGUodmFsLCBTUkMsIE9ba2V5XSA/ICcnICsgT1trZXldIDogVFBMLmpvaW4oU3RyaW5nKGtleSkpKTtcbiAgaWYgKE8gPT09IGdsb2JhbCkge1xuICAgIE9ba2V5XSA9IHZhbDtcbiAgfSBlbHNlIGlmICghc2FmZSkge1xuICAgIGRlbGV0ZSBPW2tleV07XG4gICAgaGlkZShPLCBrZXksIHZhbCk7XG4gIH0gZWxzZSBpZiAoT1trZXldKSB7XG4gICAgT1trZXldID0gdmFsO1xuICB9IGVsc2Uge1xuICAgIGhpZGUoTywga2V5LCB2YWwpO1xuICB9XG4vLyBhZGQgZmFrZSBGdW5jdGlvbiN0b1N0cmluZyBmb3IgY29ycmVjdCB3b3JrIHdyYXBwZWQgbWV0aG9kcyAvIGNvbnN0cnVjdG9ycyB3aXRoIG1ldGhvZHMgbGlrZSBMb0Rhc2ggaXNOYXRpdmVcbn0pKEZ1bmN0aW9uLnByb3RvdHlwZSwgVE9fU1RSSU5HLCBmdW5jdGlvbiB0b1N0cmluZygpIHtcbiAgcmV0dXJuIHR5cGVvZiB0aGlzID09ICdmdW5jdGlvbicgJiYgdGhpc1tTUkNdIHx8ICR0b1N0cmluZy5jYWxsKHRoaXMpO1xufSk7XG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///12\n")},function(module,exports,__webpack_require__){eval("var $export = __webpack_require__(1);\nvar fails = __webpack_require__(3);\nvar defined = __webpack_require__(25);\nvar quot = /\"/g;\n// B.2.3.2.1 CreateHTML(string, tag, attribute, value)\nvar createHTML = function (string, tag, attribute, value) {\n  var S = String(defined(string));\n  var p1 = '<' + tag;\n  if (attribute !== '') p1 += ' ' + attribute + '=\"' + String(value).replace(quot, '&quot;') + '\"';\n  return p1 + '>' + S + '</' + tag + '>';\n};\nmodule.exports = function (NAME, exec) {\n  var O = {};\n  O[NAME] = exec(createHTML);\n  $export($export.P + $export.F * fails(function () {\n    var test = ''[NAME]('\"');\n    return test !== test.toLowerCase() || test.split('\"').length > 3;\n  }), 'String', O);\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTMuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9bbmFtZV0vLi9ub2RlX21vZHVsZXMvY29yZS1qcy9tb2R1bGVzL19zdHJpbmctaHRtbC5qcz8zODZiIl0sInNvdXJjZXNDb250ZW50IjpbInZhciAkZXhwb3J0ID0gcmVxdWlyZSgnLi9fZXhwb3J0Jyk7XG52YXIgZmFpbHMgPSByZXF1aXJlKCcuL19mYWlscycpO1xudmFyIGRlZmluZWQgPSByZXF1aXJlKCcuL19kZWZpbmVkJyk7XG52YXIgcXVvdCA9IC9cIi9nO1xuLy8gQi4yLjMuMi4xIENyZWF0ZUhUTUwoc3RyaW5nLCB0YWcsIGF0dHJpYnV0ZSwgdmFsdWUpXG52YXIgY3JlYXRlSFRNTCA9IGZ1bmN0aW9uIChzdHJpbmcsIHRhZywgYXR0cmlidXRlLCB2YWx1ZSkge1xuICB2YXIgUyA9IFN0cmluZyhkZWZpbmVkKHN0cmluZykpO1xuICB2YXIgcDEgPSAnPCcgKyB0YWc7XG4gIGlmIChhdHRyaWJ1dGUgIT09ICcnKSBwMSArPSAnICcgKyBhdHRyaWJ1dGUgKyAnPVwiJyArIFN0cmluZyh2YWx1ZSkucmVwbGFjZShxdW90LCAnJnF1b3Q7JykgKyAnXCInO1xuICByZXR1cm4gcDEgKyAnPicgKyBTICsgJzwvJyArIHRhZyArICc+Jztcbn07XG5tb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChOQU1FLCBleGVjKSB7XG4gIHZhciBPID0ge307XG4gIE9bTkFNRV0gPSBleGVjKGNyZWF0ZUhUTUwpO1xuICAkZXhwb3J0KCRleHBvcnQuUCArICRleHBvcnQuRiAqIGZhaWxzKGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgdGVzdCA9ICcnW05BTUVdKCdcIicpO1xuICAgIHJldHVybiB0ZXN0ICE9PSB0ZXN0LnRvTG93ZXJDYXNlKCkgfHwgdGVzdC5zcGxpdCgnXCInKS5sZW5ndGggPiAzO1xuICB9KSwgJ1N0cmluZycsIE8pO1xufTtcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Iiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///13\n")},function(module,exports){eval("var hasOwnProperty = {}.hasOwnProperty;\nmodule.exports = function (it, key) {\n  return hasOwnProperty.call(it, key);\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTQuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9bbmFtZV0vLi9ub2RlX21vZHVsZXMvY29yZS1qcy9tb2R1bGVzL19oYXMuanM/NjlhOCJdLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgaGFzT3duUHJvcGVydHkgPSB7fS5oYXNPd25Qcm9wZXJ0eTtcbm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKGl0LCBrZXkpIHtcbiAgcmV0dXJuIGhhc093blByb3BlcnR5LmNhbGwoaXQsIGtleSk7XG59O1xuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///14\n")},function(module,exports,__webpack_require__){eval("var dP = __webpack_require__(10);\nvar createDesc = __webpack_require__(29);\nmodule.exports = __webpack_require__(9) ? function (object, key, value) {\n  return dP.f(object, key, createDesc(1, value));\n} : function (object, key, value) {\n  object[key] = value;\n  return object;\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTUuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9bbmFtZV0vLi9ub2RlX21vZHVsZXMvY29yZS1qcy9tb2R1bGVzL19oaWRlLmpzPzMyZTkiXSwic291cmNlc0NvbnRlbnQiOlsidmFyIGRQID0gcmVxdWlyZSgnLi9fb2JqZWN0LWRwJyk7XG52YXIgY3JlYXRlRGVzYyA9IHJlcXVpcmUoJy4vX3Byb3BlcnR5LWRlc2MnKTtcbm1vZHVsZS5leHBvcnRzID0gcmVxdWlyZSgnLi9fZGVzY3JpcHRvcnMnKSA/IGZ1bmN0aW9uIChvYmplY3QsIGtleSwgdmFsdWUpIHtcbiAgcmV0dXJuIGRQLmYob2JqZWN0LCBrZXksIGNyZWF0ZURlc2MoMSwgdmFsdWUpKTtcbn0gOiBmdW5jdGlvbiAob2JqZWN0LCBrZXksIHZhbHVlKSB7XG4gIG9iamVjdFtrZXldID0gdmFsdWU7XG4gIHJldHVybiBvYmplY3Q7XG59O1xuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///15\n")},function(module,exports,__webpack_require__){eval("// to indexed object, toObject with fallback for non-array-like ES3 strings\nvar IObject = __webpack_require__(45);\nvar defined = __webpack_require__(25);\nmodule.exports = function (it) {\n  return IObject(defined(it));\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTYuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9bbmFtZV0vLi9ub2RlX21vZHVsZXMvY29yZS1qcy9tb2R1bGVzL190by1pb2JqZWN0LmpzPzY4MjEiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gdG8gaW5kZXhlZCBvYmplY3QsIHRvT2JqZWN0IHdpdGggZmFsbGJhY2sgZm9yIG5vbi1hcnJheS1saWtlIEVTMyBzdHJpbmdzXG52YXIgSU9iamVjdCA9IHJlcXVpcmUoJy4vX2lvYmplY3QnKTtcbnZhciBkZWZpbmVkID0gcmVxdWlyZSgnLi9fZGVmaW5lZCcpO1xubW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoaXQpIHtcbiAgcmV0dXJuIElPYmplY3QoZGVmaW5lZChpdCkpO1xufTtcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///16\n")},function(module,exports,__webpack_require__){"use strict";eval("\nvar fails = __webpack_require__(3);\n\nmodule.exports = function (method, arg) {\n  return !!method && fails(function () {\n    // eslint-disable-next-line no-useless-call\n    arg ? method.call(null, function () { /* empty */ }, 1) : method.call(null);\n  });\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTcuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9bbmFtZV0vLi9ub2RlX21vZHVsZXMvY29yZS1qcy9tb2R1bGVzL19zdHJpY3QtbWV0aG9kLmpzPzJmMjEiXSwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xudmFyIGZhaWxzID0gcmVxdWlyZSgnLi9fZmFpbHMnKTtcblxubW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAobWV0aG9kLCBhcmcpIHtcbiAgcmV0dXJuICEhbWV0aG9kICYmIGZhaWxzKGZ1bmN0aW9uICgpIHtcbiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tdXNlbGVzcy1jYWxsXG4gICAgYXJnID8gbWV0aG9kLmNhbGwobnVsbCwgZnVuY3Rpb24gKCkgeyAvKiBlbXB0eSAqLyB9LCAxKSA6IG1ldGhvZC5jYWxsKG51bGwpO1xuICB9KTtcbn07XG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///17\n")},function(module,exports,__webpack_require__){eval("// optional / simple context binding\nvar aFunction = __webpack_require__(19);\nmodule.exports = function (fn, that, length) {\n  aFunction(fn);\n  if (that === undefined) return fn;\n  switch (length) {\n    case 1: return function (a) {\n      return fn.call(that, a);\n    };\n    case 2: return function (a, b) {\n      return fn.call(that, a, b);\n    };\n    case 3: return function (a, b, c) {\n      return fn.call(that, a, b, c);\n    };\n  }\n  return function (/* ...args */) {\n    return fn.apply(that, arguments);\n  };\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTguanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9bbmFtZV0vLi9ub2RlX21vZHVsZXMvY29yZS1qcy9tb2R1bGVzL19jdHguanM/OWI0MyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBvcHRpb25hbCAvIHNpbXBsZSBjb250ZXh0IGJpbmRpbmdcbnZhciBhRnVuY3Rpb24gPSByZXF1aXJlKCcuL19hLWZ1bmN0aW9uJyk7XG5tb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChmbiwgdGhhdCwgbGVuZ3RoKSB7XG4gIGFGdW5jdGlvbihmbik7XG4gIGlmICh0aGF0ID09PSB1bmRlZmluZWQpIHJldHVybiBmbjtcbiAgc3dpdGNoIChsZW5ndGgpIHtcbiAgICBjYXNlIDE6IHJldHVybiBmdW5jdGlvbiAoYSkge1xuICAgICAgcmV0dXJuIGZuLmNhbGwodGhhdCwgYSk7XG4gICAgfTtcbiAgICBjYXNlIDI6IHJldHVybiBmdW5jdGlvbiAoYSwgYikge1xuICAgICAgcmV0dXJuIGZuLmNhbGwodGhhdCwgYSwgYik7XG4gICAgfTtcbiAgICBjYXNlIDM6IHJldHVybiBmdW5jdGlvbiAoYSwgYiwgYykge1xuICAgICAgcmV0dXJuIGZuLmNhbGwodGhhdCwgYSwgYiwgYyk7XG4gICAgfTtcbiAgfVxuICByZXR1cm4gZnVuY3Rpb24gKC8qIC4uLmFyZ3MgKi8pIHtcbiAgICByZXR1cm4gZm4uYXBwbHkodGhhdCwgYXJndW1lbnRzKTtcbiAgfTtcbn07XG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Iiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///18\n")},function(module,exports){eval("module.exports = function (it) {\n  if (typeof it != 'function') throw TypeError(it + ' is not a function!');\n  return it;\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTkuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9bbmFtZV0vLi9ub2RlX21vZHVsZXMvY29yZS1qcy9tb2R1bGVzL19hLWZ1bmN0aW9uLmpzP2Q4ZTgiXSwic291cmNlc0NvbnRlbnQiOlsibW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoaXQpIHtcbiAgaWYgKHR5cGVvZiBpdCAhPSAnZnVuY3Rpb24nKSB0aHJvdyBUeXBlRXJyb3IoaXQgKyAnIGlzIG5vdCBhIGZ1bmN0aW9uIScpO1xuICByZXR1cm4gaXQ7XG59O1xuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///19\n")},function(module,exports){eval("// 7.1.4 ToInteger\nvar ceil = Math.ceil;\nvar floor = Math.floor;\nmodule.exports = function (it) {\n  return isNaN(it = +it) ? 0 : (it > 0 ? floor : ceil)(it);\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMjAuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9bbmFtZV0vLi9ub2RlX21vZHVsZXMvY29yZS1qcy9tb2R1bGVzL190by1pbnRlZ2VyLmpzPzQ1ODgiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gNy4xLjQgVG9JbnRlZ2VyXG52YXIgY2VpbCA9IE1hdGguY2VpbDtcbnZhciBmbG9vciA9IE1hdGguZmxvb3I7XG5tb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChpdCkge1xuICByZXR1cm4gaXNOYU4oaXQgPSAraXQpID8gMCA6IChpdCA+IDAgPyBmbG9vciA6IGNlaWwpKGl0KTtcbn07XG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///20\n")},function(module,exports,__webpack_require__){eval("var pIE = __webpack_require__(46);\nvar createDesc = __webpack_require__(29);\nvar toIObject = __webpack_require__(16);\nvar toPrimitive = __webpack_require__(27);\nvar has = __webpack_require__(14);\nvar IE8_DOM_DEFINE = __webpack_require__(91);\nvar gOPD = Object.getOwnPropertyDescriptor;\n\nexports.f = __webpack_require__(9) ? gOPD : function getOwnPropertyDescriptor(O, P) {\n  O = toIObject(O);\n  P = toPrimitive(P, true);\n  if (IE8_DOM_DEFINE) try {\n    return gOPD(O, P);\n  } catch (e) { /* empty */ }\n  if (has(O, P)) return createDesc(!pIE.f.call(O, P), O[P]);\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMjEuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9bbmFtZV0vLi9ub2RlX21vZHVsZXMvY29yZS1qcy9tb2R1bGVzL19vYmplY3QtZ29wZC5qcz8xMWU5Il0sInNvdXJjZXNDb250ZW50IjpbInZhciBwSUUgPSByZXF1aXJlKCcuL19vYmplY3QtcGllJyk7XG52YXIgY3JlYXRlRGVzYyA9IHJlcXVpcmUoJy4vX3Byb3BlcnR5LWRlc2MnKTtcbnZhciB0b0lPYmplY3QgPSByZXF1aXJlKCcuL190by1pb2JqZWN0Jyk7XG52YXIgdG9QcmltaXRpdmUgPSByZXF1aXJlKCcuL190by1wcmltaXRpdmUnKTtcbnZhciBoYXMgPSByZXF1aXJlKCcuL19oYXMnKTtcbnZhciBJRThfRE9NX0RFRklORSA9IHJlcXVpcmUoJy4vX2llOC1kb20tZGVmaW5lJyk7XG52YXIgZ09QRCA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3I7XG5cbmV4cG9ydHMuZiA9IHJlcXVpcmUoJy4vX2Rlc2NyaXB0b3JzJykgPyBnT1BEIDogZnVuY3Rpb24gZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKE8sIFApIHtcbiAgTyA9IHRvSU9iamVjdChPKTtcbiAgUCA9IHRvUHJpbWl0aXZlKFAsIHRydWUpO1xuICBpZiAoSUU4X0RPTV9ERUZJTkUpIHRyeSB7XG4gICAgcmV0dXJuIGdPUEQoTywgUCk7XG4gIH0gY2F0Y2ggKGUpIHsgLyogZW1wdHkgKi8gfVxuICBpZiAoaGFzKE8sIFApKSByZXR1cm4gY3JlYXRlRGVzYyghcElFLmYuY2FsbChPLCBQKSwgT1tQXSk7XG59O1xuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///21\n")},function(module,exports,__webpack_require__){eval("// most Object methods by ES6 should accept primitives\nvar $export = __webpack_require__(1);\nvar core = __webpack_require__(8);\nvar fails = __webpack_require__(3);\nmodule.exports = function (KEY, exec) {\n  var fn = (core.Object || {})[KEY] || Object[KEY];\n  var exp = {};\n  exp[KEY] = exec(fn);\n  $export($export.S + $export.F * fails(function () { fn(1); }), 'Object', exp);\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMjIuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9bbmFtZV0vLi9ub2RlX21vZHVsZXMvY29yZS1qcy9tb2R1bGVzL19vYmplY3Qtc2FwLmpzPzVlZGEiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gbW9zdCBPYmplY3QgbWV0aG9kcyBieSBFUzYgc2hvdWxkIGFjY2VwdCBwcmltaXRpdmVzXG52YXIgJGV4cG9ydCA9IHJlcXVpcmUoJy4vX2V4cG9ydCcpO1xudmFyIGNvcmUgPSByZXF1aXJlKCcuL19jb3JlJyk7XG52YXIgZmFpbHMgPSByZXF1aXJlKCcuL19mYWlscycpO1xubW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoS0VZLCBleGVjKSB7XG4gIHZhciBmbiA9IChjb3JlLk9iamVjdCB8fCB7fSlbS0VZXSB8fCBPYmplY3RbS0VZXTtcbiAgdmFyIGV4cCA9IHt9O1xuICBleHBbS0VZXSA9IGV4ZWMoZm4pO1xuICAkZXhwb3J0KCRleHBvcnQuUyArICRleHBvcnQuRiAqIGZhaWxzKGZ1bmN0aW9uICgpIHsgZm4oMSk7IH0pLCAnT2JqZWN0JywgZXhwKTtcbn07XG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///22\n")},function(module,exports,__webpack_require__){eval("// 0 -> Array#forEach\n// 1 -> Array#map\n// 2 -> Array#filter\n// 3 -> Array#some\n// 4 -> Array#every\n// 5 -> Array#find\n// 6 -> Array#findIndex\nvar ctx = __webpack_require__(18);\nvar IObject = __webpack_require__(45);\nvar toObject = __webpack_require__(11);\nvar toLength = __webpack_require__(7);\nvar asc = __webpack_require__(107);\nmodule.exports = function (TYPE, $create) {\n  var IS_MAP = TYPE == 1;\n  var IS_FILTER = TYPE == 2;\n  var IS_SOME = TYPE == 3;\n  var IS_EVERY = TYPE == 4;\n  var IS_FIND_INDEX = TYPE == 6;\n  var NO_HOLES = TYPE == 5 || IS_FIND_INDEX;\n  var create = $create || asc;\n  return function ($this, callbackfn, that) {\n    var O = toObject($this);\n    var self = IObject(O);\n    var f = ctx(callbackfn, that, 3);\n    var length = toLength(self.length);\n    var index = 0;\n    var result = IS_MAP ? create($this, length) : IS_FILTER ? create($this, 0) : undefined;\n    var val, res;\n    for (;length > index; index++) if (NO_HOLES || index in self) {\n      val = self[index];\n      res = f(val, index, O);\n      if (TYPE) {\n        if (IS_MAP) result[index] = res;   // map\n        else if (res) switch (TYPE) {\n          case 3: return true;             // some\n          case 5: return val;              // find\n          case 6: return index;            // findIndex\n          case 2: result.push(val);        // filter\n        } else if (IS_EVERY) return false; // every\n      }\n    }\n    return IS_FIND_INDEX ? -1 : IS_SOME || IS_EVERY ? IS_EVERY : result;\n  };\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMjMuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9bbmFtZV0vLi9ub2RlX21vZHVsZXMvY29yZS1qcy9tb2R1bGVzL19hcnJheS1tZXRob2RzLmpzPzBhNDkiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gMCAtPiBBcnJheSNmb3JFYWNoXG4vLyAxIC0+IEFycmF5I21hcFxuLy8gMiAtPiBBcnJheSNmaWx0ZXJcbi8vIDMgLT4gQXJyYXkjc29tZVxuLy8gNCAtPiBBcnJheSNldmVyeVxuLy8gNSAtPiBBcnJheSNmaW5kXG4vLyA2IC0+IEFycmF5I2ZpbmRJbmRleFxudmFyIGN0eCA9IHJlcXVpcmUoJy4vX2N0eCcpO1xudmFyIElPYmplY3QgPSByZXF1aXJlKCcuL19pb2JqZWN0Jyk7XG52YXIgdG9PYmplY3QgPSByZXF1aXJlKCcuL190by1vYmplY3QnKTtcbnZhciB0b0xlbmd0aCA9IHJlcXVpcmUoJy4vX3RvLWxlbmd0aCcpO1xudmFyIGFzYyA9IHJlcXVpcmUoJy4vX2FycmF5LXNwZWNpZXMtY3JlYXRlJyk7XG5tb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChUWVBFLCAkY3JlYXRlKSB7XG4gIHZhciBJU19NQVAgPSBUWVBFID09IDE7XG4gIHZhciBJU19GSUxURVIgPSBUWVBFID09IDI7XG4gIHZhciBJU19TT01FID0gVFlQRSA9PSAzO1xuICB2YXIgSVNfRVZFUlkgPSBUWVBFID09IDQ7XG4gIHZhciBJU19GSU5EX0lOREVYID0gVFlQRSA9PSA2O1xuICB2YXIgTk9fSE9MRVMgPSBUWVBFID09IDUgfHwgSVNfRklORF9JTkRFWDtcbiAgdmFyIGNyZWF0ZSA9ICRjcmVhdGUgfHwgYXNjO1xuICByZXR1cm4gZnVuY3Rpb24gKCR0aGlzLCBjYWxsYmFja2ZuLCB0aGF0KSB7XG4gICAgdmFyIE8gPSB0b09iamVjdCgkdGhpcyk7XG4gICAgdmFyIHNlbGYgPSBJT2JqZWN0KE8pO1xuICAgIHZhciBmID0gY3R4KGNhbGxiYWNrZm4sIHRoYXQsIDMpO1xuICAgIHZhciBsZW5ndGggPSB0b0xlbmd0aChzZWxmLmxlbmd0aCk7XG4gICAgdmFyIGluZGV4ID0gMDtcbiAgICB2YXIgcmVzdWx0ID0gSVNfTUFQID8gY3JlYXRlKCR0aGlzLCBsZW5ndGgpIDogSVNfRklMVEVSID8gY3JlYXRlKCR0aGlzLCAwKSA6IHVuZGVmaW5lZDtcbiAgICB2YXIgdmFsLCByZXM7XG4gICAgZm9yICg7bGVuZ3RoID4gaW5kZXg7IGluZGV4KyspIGlmIChOT19IT0xFUyB8fCBpbmRleCBpbiBzZWxmKSB7XG4gICAgICB2YWwgPSBzZWxmW2luZGV4XTtcbiAgICAgIHJlcyA9IGYodmFsLCBpbmRleCwgTyk7XG4gICAgICBpZiAoVFlQRSkge1xuICAgICAgICBpZiAoSVNfTUFQKSByZXN1bHRbaW5kZXhdID0gcmVzOyAgIC8vIG1hcFxuICAgICAgICBlbHNlIGlmIChyZXMpIHN3aXRjaCAoVFlQRSkge1xuICAgICAgICAgIGNhc2UgMzogcmV0dXJuIHRydWU7ICAgICAgICAgICAgIC8vIHNvbWVcbiAgICAgICAgICBjYXNlIDU6IHJldHVybiB2YWw7ICAgICAgICAgICAgICAvLyBmaW5kXG4gICAgICAgICAgY2FzZSA2OiByZXR1cm4gaW5kZXg7ICAgICAgICAgICAgLy8gZmluZEluZGV4XG4gICAgICAgICAgY2FzZSAyOiByZXN1bHQucHVzaCh2YWwpOyAgICAgICAgLy8gZmlsdGVyXG4gICAgICAgIH0gZWxzZSBpZiAoSVNfRVZFUlkpIHJldHVybiBmYWxzZTsgLy8gZXZlcnlcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIElTX0ZJTkRfSU5ERVggPyAtMSA6IElTX1NPTUUgfHwgSVNfRVZFUlkgPyBJU19FVkVSWSA6IHJlc3VsdDtcbiAgfTtcbn07XG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Iiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///23\n")},function(module,exports){eval("var toString = {}.toString;\n\nmodule.exports = function (it) {\n  return toString.call(it).slice(8, -1);\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMjQuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9bbmFtZV0vLi9ub2RlX21vZHVsZXMvY29yZS1qcy9tb2R1bGVzL19jb2YuanM/MmQ5NSJdLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgdG9TdHJpbmcgPSB7fS50b1N0cmluZztcblxubW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoaXQpIHtcbiAgcmV0dXJuIHRvU3RyaW5nLmNhbGwoaXQpLnNsaWNlKDgsIC0xKTtcbn07XG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Iiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///24\n")},function(module,exports){eval('// 7.2.1 RequireObjectCoercible(argument)\nmodule.exports = function (it) {\n  if (it == undefined) throw TypeError("Can\'t call method on  " + it);\n  return it;\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMjUuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9bbmFtZV0vLi9ub2RlX21vZHVsZXMvY29yZS1qcy9tb2R1bGVzL19kZWZpbmVkLmpzP2JlMTMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gNy4yLjEgUmVxdWlyZU9iamVjdENvZXJjaWJsZShhcmd1bWVudClcbm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKGl0KSB7XG4gIGlmIChpdCA9PSB1bmRlZmluZWQpIHRocm93IFR5cGVFcnJvcihcIkNhbid0IGNhbGwgbWV0aG9kIG9uICBcIiArIGl0KTtcbiAgcmV0dXJuIGl0O1xufTtcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///25\n')},function(module,exports,__webpack_require__){"use strict";eval("\nif (__webpack_require__(9)) {\n  var LIBRARY = __webpack_require__(31);\n  var global = __webpack_require__(2);\n  var fails = __webpack_require__(3);\n  var $export = __webpack_require__(1);\n  var $typed = __webpack_require__(60);\n  var $buffer = __webpack_require__(85);\n  var ctx = __webpack_require__(18);\n  var anInstance = __webpack_require__(43);\n  var propertyDesc = __webpack_require__(29);\n  var hide = __webpack_require__(15);\n  var redefineAll = __webpack_require__(44);\n  var toInteger = __webpack_require__(20);\n  var toLength = __webpack_require__(7);\n  var toIndex = __webpack_require__(118);\n  var toAbsoluteIndex = __webpack_require__(33);\n  var toPrimitive = __webpack_require__(27);\n  var has = __webpack_require__(14);\n  var classof = __webpack_require__(47);\n  var isObject = __webpack_require__(5);\n  var toObject = __webpack_require__(11);\n  var isArrayIter = __webpack_require__(77);\n  var create = __webpack_require__(34);\n  var getPrototypeOf = __webpack_require__(36);\n  var gOPN = __webpack_require__(35).f;\n  var getIterFn = __webpack_require__(79);\n  var uid = __webpack_require__(30);\n  var wks = __webpack_require__(6);\n  var createArrayMethod = __webpack_require__(23);\n  var createArrayIncludes = __webpack_require__(50);\n  var speciesConstructor = __webpack_require__(48);\n  var ArrayIterators = __webpack_require__(81);\n  var Iterators = __webpack_require__(41);\n  var $iterDetect = __webpack_require__(53);\n  var setSpecies = __webpack_require__(42);\n  var arrayFill = __webpack_require__(80);\n  var arrayCopyWithin = __webpack_require__(109);\n  var $DP = __webpack_require__(10);\n  var $GOPD = __webpack_require__(21);\n  var dP = $DP.f;\n  var gOPD = $GOPD.f;\n  var RangeError = global.RangeError;\n  var TypeError = global.TypeError;\n  var Uint8Array = global.Uint8Array;\n  var ARRAY_BUFFER = 'ArrayBuffer';\n  var SHARED_BUFFER = 'Shared' + ARRAY_BUFFER;\n  var BYTES_PER_ELEMENT = 'BYTES_PER_ELEMENT';\n  var PROTOTYPE = 'prototype';\n  var ArrayProto = Array[PROTOTYPE];\n  var $ArrayBuffer = $buffer.ArrayBuffer;\n  var $DataView = $buffer.DataView;\n  var arrayForEach = createArrayMethod(0);\n  var arrayFilter = createArrayMethod(2);\n  var arraySome = createArrayMethod(3);\n  var arrayEvery = createArrayMethod(4);\n  var arrayFind = createArrayMethod(5);\n  var arrayFindIndex = createArrayMethod(6);\n  var arrayIncludes = createArrayIncludes(true);\n  var arrayIndexOf = createArrayIncludes(false);\n  var arrayValues = ArrayIterators.values;\n  var arrayKeys = ArrayIterators.keys;\n  var arrayEntries = ArrayIterators.entries;\n  var arrayLastIndexOf = ArrayProto.lastIndexOf;\n  var arrayReduce = ArrayProto.reduce;\n  var arrayReduceRight = ArrayProto.reduceRight;\n  var arrayJoin = ArrayProto.join;\n  var arraySort = ArrayProto.sort;\n  var arraySlice = ArrayProto.slice;\n  var arrayToString = ArrayProto.toString;\n  var arrayToLocaleString = ArrayProto.toLocaleString;\n  var ITERATOR = wks('iterator');\n  var TAG = wks('toStringTag');\n  var TYPED_CONSTRUCTOR = uid('typed_constructor');\n  var DEF_CONSTRUCTOR = uid('def_constructor');\n  var ALL_CONSTRUCTORS = $typed.CONSTR;\n  var TYPED_ARRAY = $typed.TYPED;\n  var VIEW = $typed.VIEW;\n  var WRONG_LENGTH = 'Wrong length!';\n\n  var $map = createArrayMethod(1, function (O, length) {\n    return allocate(speciesConstructor(O, O[DEF_CONSTRUCTOR]), length);\n  });\n\n  var LITTLE_ENDIAN = fails(function () {\n    // eslint-disable-next-line no-undef\n    return new Uint8Array(new Uint16Array([1]).buffer)[0] === 1;\n  });\n\n  var FORCED_SET = !!Uint8Array && !!Uint8Array[PROTOTYPE].set && fails(function () {\n    new Uint8Array(1).set({});\n  });\n\n  var toOffset = function (it, BYTES) {\n    var offset = toInteger(it);\n    if (offset < 0 || offset % BYTES) throw RangeError('Wrong offset!');\n    return offset;\n  };\n\n  var validate = function (it) {\n    if (isObject(it) && TYPED_ARRAY in it) return it;\n    throw TypeError(it + ' is not a typed array!');\n  };\n\n  var allocate = function (C, length) {\n    if (!(isObject(C) && TYPED_CONSTRUCTOR in C)) {\n      throw TypeError('It is not a typed array constructor!');\n    } return new C(length);\n  };\n\n  var speciesFromList = function (O, list) {\n    return fromList(speciesConstructor(O, O[DEF_CONSTRUCTOR]), list);\n  };\n\n  var fromList = function (C, list) {\n    var index = 0;\n    var length = list.length;\n    var result = allocate(C, length);\n    while (length > index) result[index] = list[index++];\n    return result;\n  };\n\n  var addGetter = function (it, key, internal) {\n    dP(it, key, { get: function () { return this._d[internal]; } });\n  };\n\n  var $from = function from(source /* , mapfn, thisArg */) {\n    var O = toObject(source);\n    var aLen = arguments.length;\n    var mapfn = aLen > 1 ? arguments[1] : undefined;\n    var mapping = mapfn !== undefined;\n    var iterFn = getIterFn(O);\n    var i, length, values, result, step, iterator;\n    if (iterFn != undefined && !isArrayIter(iterFn)) {\n      for (iterator = iterFn.call(O), values = [], i = 0; !(step = iterator.next()).done; i++) {\n        values.push(step.value);\n      } O = values;\n    }\n    if (mapping && aLen > 2) mapfn = ctx(mapfn, arguments[2], 2);\n    for (i = 0, length = toLength(O.length), result = allocate(this, length); length > i; i++) {\n      result[i] = mapping ? mapfn(O[i], i) : O[i];\n    }\n    return result;\n  };\n\n  var $of = function of(/* ...items */) {\n    var index = 0;\n    var length = arguments.length;\n    var result = allocate(this, length);\n    while (length > index) result[index] = arguments[index++];\n    return result;\n  };\n\n  // iOS Safari 6.x fails here\n  var TO_LOCALE_BUG = !!Uint8Array && fails(function () { arrayToLocaleString.call(new Uint8Array(1)); });\n\n  var $toLocaleString = function toLocaleString() {\n    return arrayToLocaleString.apply(TO_LOCALE_BUG ? arraySlice.call(validate(this)) : validate(this), arguments);\n  };\n\n  var proto = {\n    copyWithin: function copyWithin(target, start /* , end */) {\n      return arrayCopyWithin.call(validate(this), target, start, arguments.length > 2 ? arguments[2] : undefined);\n    },\n    every: function every(callbackfn /* , thisArg */) {\n      return arrayEvery(validate(this), callbackfn, arguments.length > 1 ? arguments[1] : undefined);\n    },\n    fill: function fill(value /* , start, end */) { // eslint-disable-line no-unused-vars\n      return arrayFill.apply(validate(this), arguments);\n    },\n    filter: function filter(callbackfn /* , thisArg */) {\n      return speciesFromList(this, arrayFilter(validate(this), callbackfn,\n        arguments.length > 1 ? arguments[1] : undefined));\n    },\n    find: function find(predicate /* , thisArg */) {\n      return arrayFind(validate(this), predicate, arguments.length > 1 ? arguments[1] : undefined);\n    },\n    findIndex: function findIndex(predicate /* , thisArg */) {\n      return arrayFindIndex(validate(this), predicate, arguments.length > 1 ? arguments[1] : undefined);\n    },\n    forEach: function forEach(callbackfn /* , thisArg */) {\n      arrayForEach(validate(this), callbackfn, arguments.length > 1 ? arguments[1] : undefined);\n    },\n    indexOf: function indexOf(searchElement /* , fromIndex */) {\n      return arrayIndexOf(validate(this), searchElement, arguments.length > 1 ? arguments[1] : undefined);\n    },\n    includes: function includes(searchElement /* , fromIndex */) {\n      return arrayIncludes(validate(this), searchElement, arguments.length > 1 ? arguments[1] : undefined);\n    },\n    join: function join(separator) { // eslint-disable-line no-unused-vars\n      return arrayJoin.apply(validate(this), arguments);\n    },\n    lastIndexOf: function lastIndexOf(searchElement /* , fromIndex */) { // eslint-disable-line no-unused-vars\n      return arrayLastIndexOf.apply(validate(this), arguments);\n    },\n    map: function map(mapfn /* , thisArg */) {\n      return $map(validate(this), mapfn, arguments.length > 1 ? arguments[1] : undefined);\n    },\n    reduce: function reduce(callbackfn /* , initialValue */) { // eslint-disable-line no-unused-vars\n      return arrayReduce.apply(validate(this), arguments);\n    },\n    reduceRight: function reduceRight(callbackfn /* , initialValue */) { // eslint-disable-line no-unused-vars\n      return arrayReduceRight.apply(validate(this), arguments);\n    },\n    reverse: function reverse() {\n      var that = this;\n      var length = validate(that).length;\n      var middle = Math.floor(length / 2);\n      var index = 0;\n      var value;\n      while (index < middle) {\n        value = that[index];\n        that[index++] = that[--length];\n        that[length] = value;\n      } return that;\n    },\n    some: function some(callbackfn /* , thisArg */) {\n      return arraySome(validate(this), callbackfn, arguments.length > 1 ? arguments[1] : undefined);\n    },\n    sort: function sort(comparefn) {\n      return arraySort.call(validate(this), comparefn);\n    },\n    subarray: function subarray(begin, end) {\n      var O = validate(this);\n      var length = O.length;\n      var $begin = toAbsoluteIndex(begin, length);\n      return new (speciesConstructor(O, O[DEF_CONSTRUCTOR]))(\n        O.buffer,\n        O.byteOffset + $begin * O.BYTES_PER_ELEMENT,\n        toLength((end === undefined ? length : toAbsoluteIndex(end, length)) - $begin)\n      );\n    }\n  };\n\n  var $slice = function slice(start, end) {\n    return speciesFromList(this, arraySlice.call(validate(this), start, end));\n  };\n\n  var $set = function set(arrayLike /* , offset */) {\n    validate(this);\n    var offset = toOffset(arguments[1], 1);\n    var length = this.length;\n    var src = toObject(arrayLike);\n    var len = toLength(src.length);\n    var index = 0;\n    if (len + offset > length) throw RangeError(WRONG_LENGTH);\n    while (index < len) this[offset + index] = src[index++];\n  };\n\n  var $iterators = {\n    entries: function entries() {\n      return arrayEntries.call(validate(this));\n    },\n    keys: function keys() {\n      return arrayKeys.call(validate(this));\n    },\n    values: function values() {\n      return arrayValues.call(validate(this));\n    }\n  };\n\n  var isTAIndex = function (target, key) {\n    return isObject(target)\n      && target[TYPED_ARRAY]\n      && typeof key != 'symbol'\n      && key in target\n      && String(+key) == String(key);\n  };\n  var $getDesc = function getOwnPropertyDescriptor(target, key) {\n    return isTAIndex(target, key = toPrimitive(key, true))\n      ? propertyDesc(2, target[key])\n      : gOPD(target, key);\n  };\n  var $setDesc = function defineProperty(target, key, desc) {\n    if (isTAIndex(target, key = toPrimitive(key, true))\n      && isObject(desc)\n      && has(desc, 'value')\n      && !has(desc, 'get')\n      && !has(desc, 'set')\n      // TODO: add validation descriptor w/o calling accessors\n      && !desc.configurable\n      && (!has(desc, 'writable') || desc.writable)\n      && (!has(desc, 'enumerable') || desc.enumerable)\n    ) {\n      target[key] = desc.value;\n      return target;\n    } return dP(target, key, desc);\n  };\n\n  if (!ALL_CONSTRUCTORS) {\n    $GOPD.f = $getDesc;\n    $DP.f = $setDesc;\n  }\n\n  $export($export.S + $export.F * !ALL_CONSTRUCTORS, 'Object', {\n    getOwnPropertyDescriptor: $getDesc,\n    defineProperty: $setDesc\n  });\n\n  if (fails(function () { arrayToString.call({}); })) {\n    arrayToString = arrayToLocaleString = function toString() {\n      return arrayJoin.call(this);\n    };\n  }\n\n  var $TypedArrayPrototype$ = redefineAll({}, proto);\n  redefineAll($TypedArrayPrototype$, $iterators);\n  hide($TypedArrayPrototype$, ITERATOR, $iterators.values);\n  redefineAll($TypedArrayPrototype$, {\n    slice: $slice,\n    set: $set,\n    constructor: function () { /* noop */ },\n    toString: arrayToString,\n    toLocaleString: $toLocaleString\n  });\n  addGetter($TypedArrayPrototype$, 'buffer', 'b');\n  addGetter($TypedArrayPrototype$, 'byteOffset', 'o');\n  addGetter($TypedArrayPrototype$, 'byteLength', 'l');\n  addGetter($TypedArrayPrototype$, 'length', 'e');\n  dP($TypedArrayPrototype$, TAG, {\n    get: function () { return this[TYPED_ARRAY]; }\n  });\n\n  // eslint-disable-next-line max-statements\n  module.exports = function (KEY, BYTES, wrapper, CLAMPED) {\n    CLAMPED = !!CLAMPED;\n    var NAME = KEY + (CLAMPED ? 'Clamped' : '') + 'Array';\n    var GETTER = 'get' + KEY;\n    var SETTER = 'set' + KEY;\n    var TypedArray = global[NAME];\n    var Base = TypedArray || {};\n    var TAC = TypedArray && getPrototypeOf(TypedArray);\n    var FORCED = !TypedArray || !$typed.ABV;\n    var O = {};\n    var TypedArrayPrototype = TypedArray && TypedArray[PROTOTYPE];\n    var getter = function (that, index) {\n      var data = that._d;\n      return data.v[GETTER](index * BYTES + data.o, LITTLE_ENDIAN);\n    };\n    var setter = function (that, index, value) {\n      var data = that._d;\n      if (CLAMPED) value = (value = Math.round(value)) < 0 ? 0 : value > 0xff ? 0xff : value & 0xff;\n      data.v[SETTER](index * BYTES + data.o, value, LITTLE_ENDIAN);\n    };\n    var addElement = function (that, index) {\n      dP(that, index, {\n        get: function () {\n          return getter(this, index);\n        },\n        set: function (value) {\n          return setter(this, index, value);\n        },\n        enumerable: true\n      });\n    };\n    if (FORCED) {\n      TypedArray = wrapper(function (that, data, $offset, $length) {\n        anInstance(that, TypedArray, NAME, '_d');\n        var index = 0;\n        var offset = 0;\n        var buffer, byteLength, length, klass;\n        if (!isObject(data)) {\n          length = toIndex(data);\n          byteLength = length * BYTES;\n          buffer = new $ArrayBuffer(byteLength);\n        } else if (data instanceof $ArrayBuffer || (klass = classof(data)) == ARRAY_BUFFER || klass == SHARED_BUFFER) {\n          buffer = data;\n          offset = toOffset($offset, BYTES);\n          var $len = data.byteLength;\n          if ($length === undefined) {\n            if ($len % BYTES) throw RangeError(WRONG_LENGTH);\n            byteLength = $len - offset;\n            if (byteLength < 0) throw RangeError(WRONG_LENGTH);\n          } else {\n            byteLength = toLength($length) * BYTES;\n            if (byteLength + offset > $len) throw RangeError(WRONG_LENGTH);\n          }\n          length = byteLength / BYTES;\n        } else if (TYPED_ARRAY in data) {\n          return fromList(TypedArray, data);\n        } else {\n          return $from.call(TypedArray, data);\n        }\n        hide(that, '_d', {\n          b: buffer,\n          o: offset,\n          l: byteLength,\n          e: length,\n          v: new $DataView(buffer)\n        });\n        while (index < length) addElement(that, index++);\n      });\n      TypedArrayPrototype = TypedArray[PROTOTYPE] = create($TypedArrayPrototype$);\n      hide(TypedArrayPrototype, 'constructor', TypedArray);\n    } else if (!fails(function () {\n      TypedArray(1);\n    }) || !fails(function () {\n      new TypedArray(-1); // eslint-disable-line no-new\n    }) || !$iterDetect(function (iter) {\n      new TypedArray(); // eslint-disable-line no-new\n      new TypedArray(null); // eslint-disable-line no-new\n      new TypedArray(1.5); // eslint-disable-line no-new\n      new TypedArray(iter); // eslint-disable-line no-new\n    }, true)) {\n      TypedArray = wrapper(function (that, data, $offset, $length) {\n        anInstance(that, TypedArray, NAME);\n        var klass;\n        // `ws` module bug, temporarily remove validation length for Uint8Array\n        // https://github.com/websockets/ws/pull/645\n        if (!isObject(data)) return new Base(toIndex(data));\n        if (data instanceof $ArrayBuffer || (klass = classof(data)) == ARRAY_BUFFER || klass == SHARED_BUFFER) {\n          return $length !== undefined\n            ? new Base(data, toOffset($offset, BYTES), $length)\n            : $offset !== undefined\n              ? new Base(data, toOffset($offset, BYTES))\n              : new Base(data);\n        }\n        if (TYPED_ARRAY in data) return fromList(TypedArray, data);\n        return $from.call(TypedArray, data);\n      });\n      arrayForEach(TAC !== Function.prototype ? gOPN(Base).concat(gOPN(TAC)) : gOPN(Base), function (key) {\n        if (!(key in TypedArray)) hide(TypedArray, key, Base[key]);\n      });\n      TypedArray[PROTOTYPE] = TypedArrayPrototype;\n      if (!LIBRARY) TypedArrayPrototype.constructor = TypedArray;\n    }\n    var $nativeIterator = TypedArrayPrototype[ITERATOR];\n    var CORRECT_ITER_NAME = !!$nativeIterator\n      && ($nativeIterator.name == 'values' || $nativeIterator.name == undefined);\n    var $iterator = $iterators.values;\n    hide(TypedArray, TYPED_CONSTRUCTOR, true);\n    hide(TypedArrayPrototype, TYPED_ARRAY, NAME);\n    hide(TypedArrayPrototype, VIEW, true);\n    hide(TypedArrayPrototype, DEF_CONSTRUCTOR, TypedArray);\n\n    if (CLAMPED ? new TypedArray(1)[TAG] != NAME : !(TAG in TypedArrayPrototype)) {\n      dP(TypedArrayPrototype, TAG, {\n        get: function () { return NAME; }\n      });\n    }\n\n    O[NAME] = TypedArray;\n\n    $export($export.G + $export.W + $export.F * (TypedArray != Base), O);\n\n    $export($export.S, NAME, {\n      BYTES_PER_ELEMENT: BYTES\n    });\n\n    $export($export.S + $export.F * fails(function () { Base.of.call(TypedArray, 1); }), NAME, {\n      from: $from,\n      of: $of\n    });\n\n    if (!(BYTES_PER_ELEMENT in TypedArrayPrototype)) hide(TypedArrayPrototype, BYTES_PER_ELEMENT, BYTES);\n\n    $export($export.P, NAME, proto);\n\n    setSpecies(NAME);\n\n    $export($export.P + $export.F * FORCED_SET, NAME, { set: $set });\n\n    $export($export.P + $export.F * !CORRECT_ITER_NAME, NAME, $iterators);\n\n    if (!LIBRARY && TypedArrayPrototype.toString != arrayToString) TypedArrayPrototype.toString = arrayToString;\n\n    $export($export.P + $export.F * fails(function () {\n      new TypedArray(1).slice();\n    }), NAME, { slice: $slice });\n\n    $export($export.P + $export.F * (fails(function () {\n      return [1, 2].toLocaleString() != new TypedArray([1, 2]).toLocaleString();\n    }) || !fails(function () {\n      TypedArrayPrototype.toLocaleString.call([1, 2]);\n    })), NAME, { toLocaleString: $toLocaleString });\n\n    Iterators[NAME] = CORRECT_ITER_NAME ? $nativeIterator : $iterator;\n    if (!LIBRARY && !CORRECT_ITER_NAME) hide(TypedArrayPrototype, ITERATOR, $iterator);\n  };\n} else module.exports = function () { /* empty */ };\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMjYuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9bbmFtZV0vLi9ub2RlX21vZHVsZXMvY29yZS1qcy9tb2R1bGVzL190eXBlZC1hcnJheS5qcz9lYzMwIl0sInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcbmlmIChyZXF1aXJlKCcuL19kZXNjcmlwdG9ycycpKSB7XG4gIHZhciBMSUJSQVJZID0gcmVxdWlyZSgnLi9fbGlicmFyeScpO1xuICB2YXIgZ2xvYmFsID0gcmVxdWlyZSgnLi9fZ2xvYmFsJyk7XG4gIHZhciBmYWlscyA9IHJlcXVpcmUoJy4vX2ZhaWxzJyk7XG4gIHZhciAkZXhwb3J0ID0gcmVxdWlyZSgnLi9fZXhwb3J0Jyk7XG4gIHZhciAkdHlwZWQgPSByZXF1aXJlKCcuL190eXBlZCcpO1xuICB2YXIgJGJ1ZmZlciA9IHJlcXVpcmUoJy4vX3R5cGVkLWJ1ZmZlcicpO1xuICB2YXIgY3R4ID0gcmVxdWlyZSgnLi9fY3R4Jyk7XG4gIHZhciBhbkluc3RhbmNlID0gcmVxdWlyZSgnLi9fYW4taW5zdGFuY2UnKTtcbiAgdmFyIHByb3BlcnR5RGVzYyA9IHJlcXVpcmUoJy4vX3Byb3BlcnR5LWRlc2MnKTtcbiAgdmFyIGhpZGUgPSByZXF1aXJlKCcuL19oaWRlJyk7XG4gIHZhciByZWRlZmluZUFsbCA9IHJlcXVpcmUoJy4vX3JlZGVmaW5lLWFsbCcpO1xuICB2YXIgdG9JbnRlZ2VyID0gcmVxdWlyZSgnLi9fdG8taW50ZWdlcicpO1xuICB2YXIgdG9MZW5ndGggPSByZXF1aXJlKCcuL190by1sZW5ndGgnKTtcbiAgdmFyIHRvSW5kZXggPSByZXF1aXJlKCcuL190by1pbmRleCcpO1xuICB2YXIgdG9BYnNvbHV0ZUluZGV4ID0gcmVxdWlyZSgnLi9fdG8tYWJzb2x1dGUtaW5kZXgnKTtcbiAgdmFyIHRvUHJpbWl0aXZlID0gcmVxdWlyZSgnLi9fdG8tcHJpbWl0aXZlJyk7XG4gIHZhciBoYXMgPSByZXF1aXJlKCcuL19oYXMnKTtcbiAgdmFyIGNsYXNzb2YgPSByZXF1aXJlKCcuL19jbGFzc29mJyk7XG4gIHZhciBpc09iamVjdCA9IHJlcXVpcmUoJy4vX2lzLW9iamVjdCcpO1xuICB2YXIgdG9PYmplY3QgPSByZXF1aXJlKCcuL190by1vYmplY3QnKTtcbiAgdmFyIGlzQXJyYXlJdGVyID0gcmVxdWlyZSgnLi9faXMtYXJyYXktaXRlcicpO1xuICB2YXIgY3JlYXRlID0gcmVxdWlyZSgnLi9fb2JqZWN0LWNyZWF0ZScpO1xuICB2YXIgZ2V0UHJvdG90eXBlT2YgPSByZXF1aXJlKCcuL19vYmplY3QtZ3BvJyk7XG4gIHZhciBnT1BOID0gcmVxdWlyZSgnLi9fb2JqZWN0LWdvcG4nKS5mO1xuICB2YXIgZ2V0SXRlckZuID0gcmVxdWlyZSgnLi9jb3JlLmdldC1pdGVyYXRvci1tZXRob2QnKTtcbiAgdmFyIHVpZCA9IHJlcXVpcmUoJy4vX3VpZCcpO1xuICB2YXIgd2tzID0gcmVxdWlyZSgnLi9fd2tzJyk7XG4gIHZhciBjcmVhdGVBcnJheU1ldGhvZCA9IHJlcXVpcmUoJy4vX2FycmF5LW1ldGhvZHMnKTtcbiAgdmFyIGNyZWF0ZUFycmF5SW5jbHVkZXMgPSByZXF1aXJlKCcuL19hcnJheS1pbmNsdWRlcycpO1xuICB2YXIgc3BlY2llc0NvbnN0cnVjdG9yID0gcmVxdWlyZSgnLi9fc3BlY2llcy1jb25zdHJ1Y3RvcicpO1xuICB2YXIgQXJyYXlJdGVyYXRvcnMgPSByZXF1aXJlKCcuL2VzNi5hcnJheS5pdGVyYXRvcicpO1xuICB2YXIgSXRlcmF0b3JzID0gcmVxdWlyZSgnLi9faXRlcmF0b3JzJyk7XG4gIHZhciAkaXRlckRldGVjdCA9IHJlcXVpcmUoJy4vX2l0ZXItZGV0ZWN0Jyk7XG4gIHZhciBzZXRTcGVjaWVzID0gcmVxdWlyZSgnLi9fc2V0LXNwZWNpZXMnKTtcbiAgdmFyIGFycmF5RmlsbCA9IHJlcXVpcmUoJy4vX2FycmF5LWZpbGwnKTtcbiAgdmFyIGFycmF5Q29weVdpdGhpbiA9IHJlcXVpcmUoJy4vX2FycmF5LWNvcHktd2l0aGluJyk7XG4gIHZhciAkRFAgPSByZXF1aXJlKCcuL19vYmplY3QtZHAnKTtcbiAgdmFyICRHT1BEID0gcmVxdWlyZSgnLi9fb2JqZWN0LWdvcGQnKTtcbiAgdmFyIGRQID0gJERQLmY7XG4gIHZhciBnT1BEID0gJEdPUEQuZjtcbiAgdmFyIFJhbmdlRXJyb3IgPSBnbG9iYWwuUmFuZ2VFcnJvcjtcbiAgdmFyIFR5cGVFcnJvciA9IGdsb2JhbC5UeXBlRXJyb3I7XG4gIHZhciBVaW50OEFycmF5ID0gZ2xvYmFsLlVpbnQ4QXJyYXk7XG4gIHZhciBBUlJBWV9CVUZGRVIgPSAnQXJyYXlCdWZmZXInO1xuICB2YXIgU0hBUkVEX0JVRkZFUiA9ICdTaGFyZWQnICsgQVJSQVlfQlVGRkVSO1xuICB2YXIgQllURVNfUEVSX0VMRU1FTlQgPSAnQllURVNfUEVSX0VMRU1FTlQnO1xuICB2YXIgUFJPVE9UWVBFID0gJ3Byb3RvdHlwZSc7XG4gIHZhciBBcnJheVByb3RvID0gQXJyYXlbUFJPVE9UWVBFXTtcbiAgdmFyICRBcnJheUJ1ZmZlciA9ICRidWZmZXIuQXJyYXlCdWZmZXI7XG4gIHZhciAkRGF0YVZpZXcgPSAkYnVmZmVyLkRhdGFWaWV3O1xuICB2YXIgYXJyYXlGb3JFYWNoID0gY3JlYXRlQXJyYXlNZXRob2QoMCk7XG4gIHZhciBhcnJheUZpbHRlciA9IGNyZWF0ZUFycmF5TWV0aG9kKDIpO1xuICB2YXIgYXJyYXlTb21lID0gY3JlYXRlQXJyYXlNZXRob2QoMyk7XG4gIHZhciBhcnJheUV2ZXJ5ID0gY3JlYXRlQXJyYXlNZXRob2QoNCk7XG4gIHZhciBhcnJheUZpbmQgPSBjcmVhdGVBcnJheU1ldGhvZCg1KTtcbiAgdmFyIGFycmF5RmluZEluZGV4ID0gY3JlYXRlQXJyYXlNZXRob2QoNik7XG4gIHZhciBhcnJheUluY2x1ZGVzID0gY3JlYXRlQXJyYXlJbmNsdWRlcyh0cnVlKTtcbiAgdmFyIGFycmF5SW5kZXhPZiA9IGNyZWF0ZUFycmF5SW5jbHVkZXMoZmFsc2UpO1xuICB2YXIgYXJyYXlWYWx1ZXMgPSBBcnJheUl0ZXJhdG9ycy52YWx1ZXM7XG4gIHZhciBhcnJheUtleXMgPSBBcnJheUl0ZXJhdG9ycy5rZXlzO1xuICB2YXIgYXJyYXlFbnRyaWVzID0gQXJyYXlJdGVyYXRvcnMuZW50cmllcztcbiAgdmFyIGFycmF5TGFzdEluZGV4T2YgPSBBcnJheVByb3RvLmxhc3RJbmRleE9mO1xuICB2YXIgYXJyYXlSZWR1Y2UgPSBBcnJheVByb3RvLnJlZHVjZTtcbiAgdmFyIGFycmF5UmVkdWNlUmlnaHQgPSBBcnJheVByb3RvLnJlZHVjZVJpZ2h0O1xuICB2YXIgYXJyYXlKb2luID0gQXJyYXlQcm90by5qb2luO1xuICB2YXIgYXJyYXlTb3J0ID0gQXJyYXlQcm90by5zb3J0O1xuICB2YXIgYXJyYXlTbGljZSA9IEFycmF5UHJvdG8uc2xpY2U7XG4gIHZhciBhcnJheVRvU3RyaW5nID0gQXJyYXlQcm90by50b1N0cmluZztcbiAgdmFyIGFycmF5VG9Mb2NhbGVTdHJpbmcgPSBBcnJheVByb3RvLnRvTG9jYWxlU3RyaW5nO1xuICB2YXIgSVRFUkFUT1IgPSB3a3MoJ2l0ZXJhdG9yJyk7XG4gIHZhciBUQUcgPSB3a3MoJ3RvU3RyaW5nVGFnJyk7XG4gIHZhciBUWVBFRF9DT05TVFJVQ1RPUiA9IHVpZCgndHlwZWRfY29uc3RydWN0b3InKTtcbiAgdmFyIERFRl9DT05TVFJVQ1RPUiA9IHVpZCgnZGVmX2NvbnN0cnVjdG9yJyk7XG4gIHZhciBBTExfQ09OU1RSVUNUT1JTID0gJHR5cGVkLkNPTlNUUjtcbiAgdmFyIFRZUEVEX0FSUkFZID0gJHR5cGVkLlRZUEVEO1xuICB2YXIgVklFVyA9ICR0eXBlZC5WSUVXO1xuICB2YXIgV1JPTkdfTEVOR1RIID0gJ1dyb25nIGxlbmd0aCEnO1xuXG4gIHZhciAkbWFwID0gY3JlYXRlQXJyYXlNZXRob2QoMSwgZnVuY3Rpb24gKE8sIGxlbmd0aCkge1xuICAgIHJldHVybiBhbGxvY2F0ZShzcGVjaWVzQ29uc3RydWN0b3IoTywgT1tERUZfQ09OU1RSVUNUT1JdKSwgbGVuZ3RoKTtcbiAgfSk7XG5cbiAgdmFyIExJVFRMRV9FTkRJQU4gPSBmYWlscyhmdW5jdGlvbiAoKSB7XG4gICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLXVuZGVmXG4gICAgcmV0dXJuIG5ldyBVaW50OEFycmF5KG5ldyBVaW50MTZBcnJheShbMV0pLmJ1ZmZlcilbMF0gPT09IDE7XG4gIH0pO1xuXG4gIHZhciBGT1JDRURfU0VUID0gISFVaW50OEFycmF5ICYmICEhVWludDhBcnJheVtQUk9UT1RZUEVdLnNldCAmJiBmYWlscyhmdW5jdGlvbiAoKSB7XG4gICAgbmV3IFVpbnQ4QXJyYXkoMSkuc2V0KHt9KTtcbiAgfSk7XG5cbiAgdmFyIHRvT2Zmc2V0ID0gZnVuY3Rpb24gKGl0LCBCWVRFUykge1xuICAgIHZhciBvZmZzZXQgPSB0b0ludGVnZXIoaXQpO1xuICAgIGlmIChvZmZzZXQgPCAwIHx8IG9mZnNldCAlIEJZVEVTKSB0aHJvdyBSYW5nZUVycm9yKCdXcm9uZyBvZmZzZXQhJyk7XG4gICAgcmV0dXJuIG9mZnNldDtcbiAgfTtcblxuICB2YXIgdmFsaWRhdGUgPSBmdW5jdGlvbiAoaXQpIHtcbiAgICBpZiAoaXNPYmplY3QoaXQpICYmIFRZUEVEX0FSUkFZIGluIGl0KSByZXR1cm4gaXQ7XG4gICAgdGhyb3cgVHlwZUVycm9yKGl0ICsgJyBpcyBub3QgYSB0eXBlZCBhcnJheSEnKTtcbiAgfTtcblxuICB2YXIgYWxsb2NhdGUgPSBmdW5jdGlvbiAoQywgbGVuZ3RoKSB7XG4gICAgaWYgKCEoaXNPYmplY3QoQykgJiYgVFlQRURfQ09OU1RSVUNUT1IgaW4gQykpIHtcbiAgICAgIHRocm93IFR5cGVFcnJvcignSXQgaXMgbm90IGEgdHlwZWQgYXJyYXkgY29uc3RydWN0b3IhJyk7XG4gICAgfSByZXR1cm4gbmV3IEMobGVuZ3RoKTtcbiAgfTtcblxuICB2YXIgc3BlY2llc0Zyb21MaXN0ID0gZnVuY3Rpb24gKE8sIGxpc3QpIHtcbiAgICByZXR1cm4gZnJvbUxpc3Qoc3BlY2llc0NvbnN0cnVjdG9yKE8sIE9bREVGX0NPTlNUUlVDVE9SXSksIGxpc3QpO1xuICB9O1xuXG4gIHZhciBmcm9tTGlzdCA9IGZ1bmN0aW9uIChDLCBsaXN0KSB7XG4gICAgdmFyIGluZGV4ID0gMDtcbiAgICB2YXIgbGVuZ3RoID0gbGlzdC5sZW5ndGg7XG4gICAgdmFyIHJlc3VsdCA9IGFsbG9jYXRlKEMsIGxlbmd0aCk7XG4gICAgd2hpbGUgKGxlbmd0aCA+IGluZGV4KSByZXN1bHRbaW5kZXhdID0gbGlzdFtpbmRleCsrXTtcbiAgICByZXR1cm4gcmVzdWx0O1xuICB9O1xuXG4gIHZhciBhZGRHZXR0ZXIgPSBmdW5jdGlvbiAoaXQsIGtleSwgaW50ZXJuYWwpIHtcbiAgICBkUChpdCwga2V5LCB7IGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gdGhpcy5fZFtpbnRlcm5hbF07IH0gfSk7XG4gIH07XG5cbiAgdmFyICRmcm9tID0gZnVuY3Rpb24gZnJvbShzb3VyY2UgLyogLCBtYXBmbiwgdGhpc0FyZyAqLykge1xuICAgIHZhciBPID0gdG9PYmplY3Qoc291cmNlKTtcbiAgICB2YXIgYUxlbiA9IGFyZ3VtZW50cy5sZW5ndGg7XG4gICAgdmFyIG1hcGZuID0gYUxlbiA+IDEgPyBhcmd1bWVudHNbMV0gOiB1bmRlZmluZWQ7XG4gICAgdmFyIG1hcHBpbmcgPSBtYXBmbiAhPT0gdW5kZWZpbmVkO1xuICAgIHZhciBpdGVyRm4gPSBnZXRJdGVyRm4oTyk7XG4gICAgdmFyIGksIGxlbmd0aCwgdmFsdWVzLCByZXN1bHQsIHN0ZXAsIGl0ZXJhdG9yO1xuICAgIGlmIChpdGVyRm4gIT0gdW5kZWZpbmVkICYmICFpc0FycmF5SXRlcihpdGVyRm4pKSB7XG4gICAgICBmb3IgKGl0ZXJhdG9yID0gaXRlckZuLmNhbGwoTyksIHZhbHVlcyA9IFtdLCBpID0gMDsgIShzdGVwID0gaXRlcmF0b3IubmV4dCgpKS5kb25lOyBpKyspIHtcbiAgICAgICAgdmFsdWVzLnB1c2goc3RlcC52YWx1ZSk7XG4gICAgICB9IE8gPSB2YWx1ZXM7XG4gICAgfVxuICAgIGlmIChtYXBwaW5nICYmIGFMZW4gPiAyKSBtYXBmbiA9IGN0eChtYXBmbiwgYXJndW1lbnRzWzJdLCAyKTtcbiAgICBmb3IgKGkgPSAwLCBsZW5ndGggPSB0b0xlbmd0aChPLmxlbmd0aCksIHJlc3VsdCA9IGFsbG9jYXRlKHRoaXMsIGxlbmd0aCk7IGxlbmd0aCA+IGk7IGkrKykge1xuICAgICAgcmVzdWx0W2ldID0gbWFwcGluZyA/IG1hcGZuKE9baV0sIGkpIDogT1tpXTtcbiAgICB9XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfTtcblxuICB2YXIgJG9mID0gZnVuY3Rpb24gb2YoLyogLi4uaXRlbXMgKi8pIHtcbiAgICB2YXIgaW5kZXggPSAwO1xuICAgIHZhciBsZW5ndGggPSBhcmd1bWVudHMubGVuZ3RoO1xuICAgIHZhciByZXN1bHQgPSBhbGxvY2F0ZSh0aGlzLCBsZW5ndGgpO1xuICAgIHdoaWxlIChsZW5ndGggPiBpbmRleCkgcmVzdWx0W2luZGV4XSA9IGFyZ3VtZW50c1tpbmRleCsrXTtcbiAgICByZXR1cm4gcmVzdWx0O1xuICB9O1xuXG4gIC8vIGlPUyBTYWZhcmkgNi54IGZhaWxzIGhlcmVcbiAgdmFyIFRPX0xPQ0FMRV9CVUcgPSAhIVVpbnQ4QXJyYXkgJiYgZmFpbHMoZnVuY3Rpb24gKCkgeyBhcnJheVRvTG9jYWxlU3RyaW5nLmNhbGwobmV3IFVpbnQ4QXJyYXkoMSkpOyB9KTtcblxuICB2YXIgJHRvTG9jYWxlU3RyaW5nID0gZnVuY3Rpb24gdG9Mb2NhbGVTdHJpbmcoKSB7XG4gICAgcmV0dXJuIGFycmF5VG9Mb2NhbGVTdHJpbmcuYXBwbHkoVE9fTE9DQUxFX0JVRyA/IGFycmF5U2xpY2UuY2FsbCh2YWxpZGF0ZSh0aGlzKSkgOiB2YWxpZGF0ZSh0aGlzKSwgYXJndW1lbnRzKTtcbiAgfTtcblxuICB2YXIgcHJvdG8gPSB7XG4gICAgY29weVdpdGhpbjogZnVuY3Rpb24gY29weVdpdGhpbih0YXJnZXQsIHN0YXJ0IC8qICwgZW5kICovKSB7XG4gICAgICByZXR1cm4gYXJyYXlDb3B5V2l0aGluLmNhbGwodmFsaWRhdGUodGhpcyksIHRhcmdldCwgc3RhcnQsIGFyZ3VtZW50cy5sZW5ndGggPiAyID8gYXJndW1lbnRzWzJdIDogdW5kZWZpbmVkKTtcbiAgICB9LFxuICAgIGV2ZXJ5OiBmdW5jdGlvbiBldmVyeShjYWxsYmFja2ZuIC8qICwgdGhpc0FyZyAqLykge1xuICAgICAgcmV0dXJuIGFycmF5RXZlcnkodmFsaWRhdGUodGhpcyksIGNhbGxiYWNrZm4sIGFyZ3VtZW50cy5sZW5ndGggPiAxID8gYXJndW1lbnRzWzFdIDogdW5kZWZpbmVkKTtcbiAgICB9LFxuICAgIGZpbGw6IGZ1bmN0aW9uIGZpbGwodmFsdWUgLyogLCBzdGFydCwgZW5kICovKSB7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgbm8tdW51c2VkLXZhcnNcbiAgICAgIHJldHVybiBhcnJheUZpbGwuYXBwbHkodmFsaWRhdGUodGhpcyksIGFyZ3VtZW50cyk7XG4gICAgfSxcbiAgICBmaWx0ZXI6IGZ1bmN0aW9uIGZpbHRlcihjYWxsYmFja2ZuIC8qICwgdGhpc0FyZyAqLykge1xuICAgICAgcmV0dXJuIHNwZWNpZXNGcm9tTGlzdCh0aGlzLCBhcnJheUZpbHRlcih2YWxpZGF0ZSh0aGlzKSwgY2FsbGJhY2tmbixcbiAgICAgICAgYXJndW1lbnRzLmxlbmd0aCA+IDEgPyBhcmd1bWVudHNbMV0gOiB1bmRlZmluZWQpKTtcbiAgICB9LFxuICAgIGZpbmQ6IGZ1bmN0aW9uIGZpbmQocHJlZGljYXRlIC8qICwgdGhpc0FyZyAqLykge1xuICAgICAgcmV0dXJuIGFycmF5RmluZCh2YWxpZGF0ZSh0aGlzKSwgcHJlZGljYXRlLCBhcmd1bWVudHMubGVuZ3RoID4gMSA/IGFyZ3VtZW50c1sxXSA6IHVuZGVmaW5lZCk7XG4gICAgfSxcbiAgICBmaW5kSW5kZXg6IGZ1bmN0aW9uIGZpbmRJbmRleChwcmVkaWNhdGUgLyogLCB0aGlzQXJnICovKSB7XG4gICAgICByZXR1cm4gYXJyYXlGaW5kSW5kZXgodmFsaWRhdGUodGhpcyksIHByZWRpY2F0ZSwgYXJndW1lbnRzLmxlbmd0aCA+IDEgPyBhcmd1bWVudHNbMV0gOiB1bmRlZmluZWQpO1xuICAgIH0sXG4gICAgZm9yRWFjaDogZnVuY3Rpb24gZm9yRWFjaChjYWxsYmFja2ZuIC8qICwgdGhpc0FyZyAqLykge1xuICAgICAgYXJyYXlGb3JFYWNoKHZhbGlkYXRlKHRoaXMpLCBjYWxsYmFja2ZuLCBhcmd1bWVudHMubGVuZ3RoID4gMSA/IGFyZ3VtZW50c1sxXSA6IHVuZGVmaW5lZCk7XG4gICAgfSxcbiAgICBpbmRleE9mOiBmdW5jdGlvbiBpbmRleE9mKHNlYXJjaEVsZW1lbnQgLyogLCBmcm9tSW5kZXggKi8pIHtcbiAgICAgIHJldHVybiBhcnJheUluZGV4T2YodmFsaWRhdGUodGhpcyksIHNlYXJjaEVsZW1lbnQsIGFyZ3VtZW50cy5sZW5ndGggPiAxID8gYXJndW1lbnRzWzFdIDogdW5kZWZpbmVkKTtcbiAgICB9LFxuICAgIGluY2x1ZGVzOiBmdW5jdGlvbiBpbmNsdWRlcyhzZWFyY2hFbGVtZW50IC8qICwgZnJvbUluZGV4ICovKSB7XG4gICAgICByZXR1cm4gYXJyYXlJbmNsdWRlcyh2YWxpZGF0ZSh0aGlzKSwgc2VhcmNoRWxlbWVudCwgYXJndW1lbnRzLmxlbmd0aCA+IDEgPyBhcmd1bWVudHNbMV0gOiB1bmRlZmluZWQpO1xuICAgIH0sXG4gICAgam9pbjogZnVuY3Rpb24gam9pbihzZXBhcmF0b3IpIHsgLy8gZXNsaW50LWRpc2FibGUtbGluZSBuby11bnVzZWQtdmFyc1xuICAgICAgcmV0dXJuIGFycmF5Sm9pbi5hcHBseSh2YWxpZGF0ZSh0aGlzKSwgYXJndW1lbnRzKTtcbiAgICB9LFxuICAgIGxhc3RJbmRleE9mOiBmdW5jdGlvbiBsYXN0SW5kZXhPZihzZWFyY2hFbGVtZW50IC8qICwgZnJvbUluZGV4ICovKSB7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgbm8tdW51c2VkLXZhcnNcbiAgICAgIHJldHVybiBhcnJheUxhc3RJbmRleE9mLmFwcGx5KHZhbGlkYXRlKHRoaXMpLCBhcmd1bWVudHMpO1xuICAgIH0sXG4gICAgbWFwOiBmdW5jdGlvbiBtYXAobWFwZm4gLyogLCB0aGlzQXJnICovKSB7XG4gICAgICByZXR1cm4gJG1hcCh2YWxpZGF0ZSh0aGlzKSwgbWFwZm4sIGFyZ3VtZW50cy5sZW5ndGggPiAxID8gYXJndW1lbnRzWzFdIDogdW5kZWZpbmVkKTtcbiAgICB9LFxuICAgIHJlZHVjZTogZnVuY3Rpb24gcmVkdWNlKGNhbGxiYWNrZm4gLyogLCBpbml0aWFsVmFsdWUgKi8pIHsgLy8gZXNsaW50LWRpc2FibGUtbGluZSBuby11bnVzZWQtdmFyc1xuICAgICAgcmV0dXJuIGFycmF5UmVkdWNlLmFwcGx5KHZhbGlkYXRlKHRoaXMpLCBhcmd1bWVudHMpO1xuICAgIH0sXG4gICAgcmVkdWNlUmlnaHQ6IGZ1bmN0aW9uIHJlZHVjZVJpZ2h0KGNhbGxiYWNrZm4gLyogLCBpbml0aWFsVmFsdWUgKi8pIHsgLy8gZXNsaW50LWRpc2FibGUtbGluZSBuby11bnVzZWQtdmFyc1xuICAgICAgcmV0dXJuIGFycmF5UmVkdWNlUmlnaHQuYXBwbHkodmFsaWRhdGUodGhpcyksIGFyZ3VtZW50cyk7XG4gICAgfSxcbiAgICByZXZlcnNlOiBmdW5jdGlvbiByZXZlcnNlKCkge1xuICAgICAgdmFyIHRoYXQgPSB0aGlzO1xuICAgICAgdmFyIGxlbmd0aCA9IHZhbGlkYXRlKHRoYXQpLmxlbmd0aDtcbiAgICAgIHZhciBtaWRkbGUgPSBNYXRoLmZsb29yKGxlbmd0aCAvIDIpO1xuICAgICAgdmFyIGluZGV4ID0gMDtcbiAgICAgIHZhciB2YWx1ZTtcbiAgICAgIHdoaWxlIChpbmRleCA8IG1pZGRsZSkge1xuICAgICAgICB2YWx1ZSA9IHRoYXRbaW5kZXhdO1xuICAgICAgICB0aGF0W2luZGV4KytdID0gdGhhdFstLWxlbmd0aF07XG4gICAgICAgIHRoYXRbbGVuZ3RoXSA9IHZhbHVlO1xuICAgICAgfSByZXR1cm4gdGhhdDtcbiAgICB9LFxuICAgIHNvbWU6IGZ1bmN0aW9uIHNvbWUoY2FsbGJhY2tmbiAvKiAsIHRoaXNBcmcgKi8pIHtcbiAgICAgIHJldHVybiBhcnJheVNvbWUodmFsaWRhdGUodGhpcyksIGNhbGxiYWNrZm4sIGFyZ3VtZW50cy5sZW5ndGggPiAxID8gYXJndW1lbnRzWzFdIDogdW5kZWZpbmVkKTtcbiAgICB9LFxuICAgIHNvcnQ6IGZ1bmN0aW9uIHNvcnQoY29tcGFyZWZuKSB7XG4gICAgICByZXR1cm4gYXJyYXlTb3J0LmNhbGwodmFsaWRhdGUodGhpcyksIGNvbXBhcmVmbik7XG4gICAgfSxcbiAgICBzdWJhcnJheTogZnVuY3Rpb24gc3ViYXJyYXkoYmVnaW4sIGVuZCkge1xuICAgICAgdmFyIE8gPSB2YWxpZGF0ZSh0aGlzKTtcbiAgICAgIHZhciBsZW5ndGggPSBPLmxlbmd0aDtcbiAgICAgIHZhciAkYmVnaW4gPSB0b0Fic29sdXRlSW5kZXgoYmVnaW4sIGxlbmd0aCk7XG4gICAgICByZXR1cm4gbmV3IChzcGVjaWVzQ29uc3RydWN0b3IoTywgT1tERUZfQ09OU1RSVUNUT1JdKSkoXG4gICAgICAgIE8uYnVmZmVyLFxuICAgICAgICBPLmJ5dGVPZmZzZXQgKyAkYmVnaW4gKiBPLkJZVEVTX1BFUl9FTEVNRU5ULFxuICAgICAgICB0b0xlbmd0aCgoZW5kID09PSB1bmRlZmluZWQgPyBsZW5ndGggOiB0b0Fic29sdXRlSW5kZXgoZW5kLCBsZW5ndGgpKSAtICRiZWdpbilcbiAgICAgICk7XG4gICAgfVxuICB9O1xuXG4gIHZhciAkc2xpY2UgPSBmdW5jdGlvbiBzbGljZShzdGFydCwgZW5kKSB7XG4gICAgcmV0dXJuIHNwZWNpZXNGcm9tTGlzdCh0aGlzLCBhcnJheVNsaWNlLmNhbGwodmFsaWRhdGUodGhpcyksIHN0YXJ0LCBlbmQpKTtcbiAgfTtcblxuICB2YXIgJHNldCA9IGZ1bmN0aW9uIHNldChhcnJheUxpa2UgLyogLCBvZmZzZXQgKi8pIHtcbiAgICB2YWxpZGF0ZSh0aGlzKTtcbiAgICB2YXIgb2Zmc2V0ID0gdG9PZmZzZXQoYXJndW1lbnRzWzFdLCAxKTtcbiAgICB2YXIgbGVuZ3RoID0gdGhpcy5sZW5ndGg7XG4gICAgdmFyIHNyYyA9IHRvT2JqZWN0KGFycmF5TGlrZSk7XG4gICAgdmFyIGxlbiA9IHRvTGVuZ3RoKHNyYy5sZW5ndGgpO1xuICAgIHZhciBpbmRleCA9IDA7XG4gICAgaWYgKGxlbiArIG9mZnNldCA+IGxlbmd0aCkgdGhyb3cgUmFuZ2VFcnJvcihXUk9OR19MRU5HVEgpO1xuICAgIHdoaWxlIChpbmRleCA8IGxlbikgdGhpc1tvZmZzZXQgKyBpbmRleF0gPSBzcmNbaW5kZXgrK107XG4gIH07XG5cbiAgdmFyICRpdGVyYXRvcnMgPSB7XG4gICAgZW50cmllczogZnVuY3Rpb24gZW50cmllcygpIHtcbiAgICAgIHJldHVybiBhcnJheUVudHJpZXMuY2FsbCh2YWxpZGF0ZSh0aGlzKSk7XG4gICAgfSxcbiAgICBrZXlzOiBmdW5jdGlvbiBrZXlzKCkge1xuICAgICAgcmV0dXJuIGFycmF5S2V5cy5jYWxsKHZhbGlkYXRlKHRoaXMpKTtcbiAgICB9LFxuICAgIHZhbHVlczogZnVuY3Rpb24gdmFsdWVzKCkge1xuICAgICAgcmV0dXJuIGFycmF5VmFsdWVzLmNhbGwodmFsaWRhdGUodGhpcykpO1xuICAgIH1cbiAgfTtcblxuICB2YXIgaXNUQUluZGV4ID0gZnVuY3Rpb24gKHRhcmdldCwga2V5KSB7XG4gICAgcmV0dXJuIGlzT2JqZWN0KHRhcmdldClcbiAgICAgICYmIHRhcmdldFtUWVBFRF9BUlJBWV1cbiAgICAgICYmIHR5cGVvZiBrZXkgIT0gJ3N5bWJvbCdcbiAgICAgICYmIGtleSBpbiB0YXJnZXRcbiAgICAgICYmIFN0cmluZygra2V5KSA9PSBTdHJpbmcoa2V5KTtcbiAgfTtcbiAgdmFyICRnZXREZXNjID0gZnVuY3Rpb24gZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKHRhcmdldCwga2V5KSB7XG4gICAgcmV0dXJuIGlzVEFJbmRleCh0YXJnZXQsIGtleSA9IHRvUHJpbWl0aXZlKGtleSwgdHJ1ZSkpXG4gICAgICA/IHByb3BlcnR5RGVzYygyLCB0YXJnZXRba2V5XSlcbiAgICAgIDogZ09QRCh0YXJnZXQsIGtleSk7XG4gIH07XG4gIHZhciAkc2V0RGVzYyA9IGZ1bmN0aW9uIGRlZmluZVByb3BlcnR5KHRhcmdldCwga2V5LCBkZXNjKSB7XG4gICAgaWYgKGlzVEFJbmRleCh0YXJnZXQsIGtleSA9IHRvUHJpbWl0aXZlKGtleSwgdHJ1ZSkpXG4gICAgICAmJiBpc09iamVjdChkZXNjKVxuICAgICAgJiYgaGFzKGRlc2MsICd2YWx1ZScpXG4gICAgICAmJiAhaGFzKGRlc2MsICdnZXQnKVxuICAgICAgJiYgIWhhcyhkZXNjLCAnc2V0JylcbiAgICAgIC8vIFRPRE86IGFkZCB2YWxpZGF0aW9uIGRlc2NyaXB0b3Igdy9vIGNhbGxpbmcgYWNjZXNzb3JzXG4gICAgICAmJiAhZGVzYy5jb25maWd1cmFibGVcbiAgICAgICYmICghaGFzKGRlc2MsICd3cml0YWJsZScpIHx8IGRlc2Mud3JpdGFibGUpXG4gICAgICAmJiAoIWhhcyhkZXNjLCAnZW51bWVyYWJsZScpIHx8IGRlc2MuZW51bWVyYWJsZSlcbiAgICApIHtcbiAgICAgIHRhcmdldFtrZXldID0gZGVzYy52YWx1ZTtcbiAgICAgIHJldHVybiB0YXJnZXQ7XG4gICAgfSByZXR1cm4gZFAodGFyZ2V0LCBrZXksIGRlc2MpO1xuICB9O1xuXG4gIGlmICghQUxMX0NPTlNUUlVDVE9SUykge1xuICAgICRHT1BELmYgPSAkZ2V0RGVzYztcbiAgICAkRFAuZiA9ICRzZXREZXNjO1xuICB9XG5cbiAgJGV4cG9ydCgkZXhwb3J0LlMgKyAkZXhwb3J0LkYgKiAhQUxMX0NPTlNUUlVDVE9SUywgJ09iamVjdCcsIHtcbiAgICBnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3I6ICRnZXREZXNjLFxuICAgIGRlZmluZVByb3BlcnR5OiAkc2V0RGVzY1xuICB9KTtcblxuICBpZiAoZmFpbHMoZnVuY3Rpb24gKCkgeyBhcnJheVRvU3RyaW5nLmNhbGwoe30pOyB9KSkge1xuICAgIGFycmF5VG9TdHJpbmcgPSBhcnJheVRvTG9jYWxlU3RyaW5nID0gZnVuY3Rpb24gdG9TdHJpbmcoKSB7XG4gICAgICByZXR1cm4gYXJyYXlKb2luLmNhbGwodGhpcyk7XG4gICAgfTtcbiAgfVxuXG4gIHZhciAkVHlwZWRBcnJheVByb3RvdHlwZSQgPSByZWRlZmluZUFsbCh7fSwgcHJvdG8pO1xuICByZWRlZmluZUFsbCgkVHlwZWRBcnJheVByb3RvdHlwZSQsICRpdGVyYXRvcnMpO1xuICBoaWRlKCRUeXBlZEFycmF5UHJvdG90eXBlJCwgSVRFUkFUT1IsICRpdGVyYXRvcnMudmFsdWVzKTtcbiAgcmVkZWZpbmVBbGwoJFR5cGVkQXJyYXlQcm90b3R5cGUkLCB7XG4gICAgc2xpY2U6ICRzbGljZSxcbiAgICBzZXQ6ICRzZXQsXG4gICAgY29uc3RydWN0b3I6IGZ1bmN0aW9uICgpIHsgLyogbm9vcCAqLyB9LFxuICAgIHRvU3RyaW5nOiBhcnJheVRvU3RyaW5nLFxuICAgIHRvTG9jYWxlU3RyaW5nOiAkdG9Mb2NhbGVTdHJpbmdcbiAgfSk7XG4gIGFkZEdldHRlcigkVHlwZWRBcnJheVByb3RvdHlwZSQsICdidWZmZXInLCAnYicpO1xuICBhZGRHZXR0ZXIoJFR5cGVkQXJyYXlQcm90b3R5cGUkLCAnYnl0ZU9mZnNldCcsICdvJyk7XG4gIGFkZEdldHRlcigkVHlwZWRBcnJheVByb3RvdHlwZSQsICdieXRlTGVuZ3RoJywgJ2wnKTtcbiAgYWRkR2V0dGVyKCRUeXBlZEFycmF5UHJvdG90eXBlJCwgJ2xlbmd0aCcsICdlJyk7XG4gIGRQKCRUeXBlZEFycmF5UHJvdG90eXBlJCwgVEFHLCB7XG4gICAgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiB0aGlzW1RZUEVEX0FSUkFZXTsgfVxuICB9KTtcblxuICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbWF4LXN0YXRlbWVudHNcbiAgbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoS0VZLCBCWVRFUywgd3JhcHBlciwgQ0xBTVBFRCkge1xuICAgIENMQU1QRUQgPSAhIUNMQU1QRUQ7XG4gICAgdmFyIE5BTUUgPSBLRVkgKyAoQ0xBTVBFRCA/ICdDbGFtcGVkJyA6ICcnKSArICdBcnJheSc7XG4gICAgdmFyIEdFVFRFUiA9ICdnZXQnICsgS0VZO1xuICAgIHZhciBTRVRURVIgPSAnc2V0JyArIEtFWTtcbiAgICB2YXIgVHlwZWRBcnJheSA9IGdsb2JhbFtOQU1FXTtcbiAgICB2YXIgQmFzZSA9IFR5cGVkQXJyYXkgfHwge307XG4gICAgdmFyIFRBQyA9IFR5cGVkQXJyYXkgJiYgZ2V0UHJvdG90eXBlT2YoVHlwZWRBcnJheSk7XG4gICAgdmFyIEZPUkNFRCA9ICFUeXBlZEFycmF5IHx8ICEkdHlwZWQuQUJWO1xuICAgIHZhciBPID0ge307XG4gICAgdmFyIFR5cGVkQXJyYXlQcm90b3R5cGUgPSBUeXBlZEFycmF5ICYmIFR5cGVkQXJyYXlbUFJPVE9UWVBFXTtcbiAgICB2YXIgZ2V0dGVyID0gZnVuY3Rpb24gKHRoYXQsIGluZGV4KSB7XG4gICAgICB2YXIgZGF0YSA9IHRoYXQuX2Q7XG4gICAgICByZXR1cm4gZGF0YS52W0dFVFRFUl0oaW5kZXggKiBCWVRFUyArIGRhdGEubywgTElUVExFX0VORElBTik7XG4gICAgfTtcbiAgICB2YXIgc2V0dGVyID0gZnVuY3Rpb24gKHRoYXQsIGluZGV4LCB2YWx1ZSkge1xuICAgICAgdmFyIGRhdGEgPSB0aGF0Ll9kO1xuICAgICAgaWYgKENMQU1QRUQpIHZhbHVlID0gKHZhbHVlID0gTWF0aC5yb3VuZCh2YWx1ZSkpIDwgMCA/IDAgOiB2YWx1ZSA+IDB4ZmYgPyAweGZmIDogdmFsdWUgJiAweGZmO1xuICAgICAgZGF0YS52W1NFVFRFUl0oaW5kZXggKiBCWVRFUyArIGRhdGEubywgdmFsdWUsIExJVFRMRV9FTkRJQU4pO1xuICAgIH07XG4gICAgdmFyIGFkZEVsZW1lbnQgPSBmdW5jdGlvbiAodGhhdCwgaW5kZXgpIHtcbiAgICAgIGRQKHRoYXQsIGluZGV4LCB7XG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHJldHVybiBnZXR0ZXIodGhpcywgaW5kZXgpO1xuICAgICAgICB9LFxuICAgICAgICBzZXQ6IGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgICAgIHJldHVybiBzZXR0ZXIodGhpcywgaW5kZXgsIHZhbHVlKTtcbiAgICAgICAgfSxcbiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZVxuICAgICAgfSk7XG4gICAgfTtcbiAgICBpZiAoRk9SQ0VEKSB7XG4gICAgICBUeXBlZEFycmF5ID0gd3JhcHBlcihmdW5jdGlvbiAodGhhdCwgZGF0YSwgJG9mZnNldCwgJGxlbmd0aCkge1xuICAgICAgICBhbkluc3RhbmNlKHRoYXQsIFR5cGVkQXJyYXksIE5BTUUsICdfZCcpO1xuICAgICAgICB2YXIgaW5kZXggPSAwO1xuICAgICAgICB2YXIgb2Zmc2V0ID0gMDtcbiAgICAgICAgdmFyIGJ1ZmZlciwgYnl0ZUxlbmd0aCwgbGVuZ3RoLCBrbGFzcztcbiAgICAgICAgaWYgKCFpc09iamVjdChkYXRhKSkge1xuICAgICAgICAgIGxlbmd0aCA9IHRvSW5kZXgoZGF0YSk7XG4gICAgICAgICAgYnl0ZUxlbmd0aCA9IGxlbmd0aCAqIEJZVEVTO1xuICAgICAgICAgIGJ1ZmZlciA9IG5ldyAkQXJyYXlCdWZmZXIoYnl0ZUxlbmd0aCk7XG4gICAgICAgIH0gZWxzZSBpZiAoZGF0YSBpbnN0YW5jZW9mICRBcnJheUJ1ZmZlciB8fCAoa2xhc3MgPSBjbGFzc29mKGRhdGEpKSA9PSBBUlJBWV9CVUZGRVIgfHwga2xhc3MgPT0gU0hBUkVEX0JVRkZFUikge1xuICAgICAgICAgIGJ1ZmZlciA9IGRhdGE7XG4gICAgICAgICAgb2Zmc2V0ID0gdG9PZmZzZXQoJG9mZnNldCwgQllURVMpO1xuICAgICAgICAgIHZhciAkbGVuID0gZGF0YS5ieXRlTGVuZ3RoO1xuICAgICAgICAgIGlmICgkbGVuZ3RoID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIGlmICgkbGVuICUgQllURVMpIHRocm93IFJhbmdlRXJyb3IoV1JPTkdfTEVOR1RIKTtcbiAgICAgICAgICAgIGJ5dGVMZW5ndGggPSAkbGVuIC0gb2Zmc2V0O1xuICAgICAgICAgICAgaWYgKGJ5dGVMZW5ndGggPCAwKSB0aHJvdyBSYW5nZUVycm9yKFdST05HX0xFTkdUSCk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGJ5dGVMZW5ndGggPSB0b0xlbmd0aCgkbGVuZ3RoKSAqIEJZVEVTO1xuICAgICAgICAgICAgaWYgKGJ5dGVMZW5ndGggKyBvZmZzZXQgPiAkbGVuKSB0aHJvdyBSYW5nZUVycm9yKFdST05HX0xFTkdUSCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGxlbmd0aCA9IGJ5dGVMZW5ndGggLyBCWVRFUztcbiAgICAgICAgfSBlbHNlIGlmIChUWVBFRF9BUlJBWSBpbiBkYXRhKSB7XG4gICAgICAgICAgcmV0dXJuIGZyb21MaXN0KFR5cGVkQXJyYXksIGRhdGEpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJldHVybiAkZnJvbS5jYWxsKFR5cGVkQXJyYXksIGRhdGEpO1xuICAgICAgICB9XG4gICAgICAgIGhpZGUodGhhdCwgJ19kJywge1xuICAgICAgICAgIGI6IGJ1ZmZlcixcbiAgICAgICAgICBvOiBvZmZzZXQsXG4gICAgICAgICAgbDogYnl0ZUxlbmd0aCxcbiAgICAgICAgICBlOiBsZW5ndGgsXG4gICAgICAgICAgdjogbmV3ICREYXRhVmlldyhidWZmZXIpXG4gICAgICAgIH0pO1xuICAgICAgICB3aGlsZSAoaW5kZXggPCBsZW5ndGgpIGFkZEVsZW1lbnQodGhhdCwgaW5kZXgrKyk7XG4gICAgICB9KTtcbiAgICAgIFR5cGVkQXJyYXlQcm90b3R5cGUgPSBUeXBlZEFycmF5W1BST1RPVFlQRV0gPSBjcmVhdGUoJFR5cGVkQXJyYXlQcm90b3R5cGUkKTtcbiAgICAgIGhpZGUoVHlwZWRBcnJheVByb3RvdHlwZSwgJ2NvbnN0cnVjdG9yJywgVHlwZWRBcnJheSk7XG4gICAgfSBlbHNlIGlmICghZmFpbHMoZnVuY3Rpb24gKCkge1xuICAgICAgVHlwZWRBcnJheSgxKTtcbiAgICB9KSB8fCAhZmFpbHMoZnVuY3Rpb24gKCkge1xuICAgICAgbmV3IFR5cGVkQXJyYXkoLTEpOyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIG5vLW5ld1xuICAgIH0pIHx8ICEkaXRlckRldGVjdChmdW5jdGlvbiAoaXRlcikge1xuICAgICAgbmV3IFR5cGVkQXJyYXkoKTsgLy8gZXNsaW50LWRpc2FibGUtbGluZSBuby1uZXdcbiAgICAgIG5ldyBUeXBlZEFycmF5KG51bGwpOyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIG5vLW5ld1xuICAgICAgbmV3IFR5cGVkQXJyYXkoMS41KTsgLy8gZXNsaW50LWRpc2FibGUtbGluZSBuby1uZXdcbiAgICAgIG5ldyBUeXBlZEFycmF5KGl0ZXIpOyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIG5vLW5ld1xuICAgIH0sIHRydWUpKSB7XG4gICAgICBUeXBlZEFycmF5ID0gd3JhcHBlcihmdW5jdGlvbiAodGhhdCwgZGF0YSwgJG9mZnNldCwgJGxlbmd0aCkge1xuICAgICAgICBhbkluc3RhbmNlKHRoYXQsIFR5cGVkQXJyYXksIE5BTUUpO1xuICAgICAgICB2YXIga2xhc3M7XG4gICAgICAgIC8vIGB3c2AgbW9kdWxlIGJ1ZywgdGVtcG9yYXJpbHkgcmVtb3ZlIHZhbGlkYXRpb24gbGVuZ3RoIGZvciBVaW50OEFycmF5XG4gICAgICAgIC8vIGh0dHBzOi8vZ2l0aHViLmNvbS93ZWJzb2NrZXRzL3dzL3B1bGwvNjQ1XG4gICAgICAgIGlmICghaXNPYmplY3QoZGF0YSkpIHJldHVybiBuZXcgQmFzZSh0b0luZGV4KGRhdGEpKTtcbiAgICAgICAgaWYgKGRhdGEgaW5zdGFuY2VvZiAkQXJyYXlCdWZmZXIgfHwgKGtsYXNzID0gY2xhc3NvZihkYXRhKSkgPT0gQVJSQVlfQlVGRkVSIHx8IGtsYXNzID09IFNIQVJFRF9CVUZGRVIpIHtcbiAgICAgICAgICByZXR1cm4gJGxlbmd0aCAhPT0gdW5kZWZpbmVkXG4gICAgICAgICAgICA/IG5ldyBCYXNlKGRhdGEsIHRvT2Zmc2V0KCRvZmZzZXQsIEJZVEVTKSwgJGxlbmd0aClcbiAgICAgICAgICAgIDogJG9mZnNldCAhPT0gdW5kZWZpbmVkXG4gICAgICAgICAgICAgID8gbmV3IEJhc2UoZGF0YSwgdG9PZmZzZXQoJG9mZnNldCwgQllURVMpKVxuICAgICAgICAgICAgICA6IG5ldyBCYXNlKGRhdGEpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChUWVBFRF9BUlJBWSBpbiBkYXRhKSByZXR1cm4gZnJvbUxpc3QoVHlwZWRBcnJheSwgZGF0YSk7XG4gICAgICAgIHJldHVybiAkZnJvbS5jYWxsKFR5cGVkQXJyYXksIGRhdGEpO1xuICAgICAgfSk7XG4gICAgICBhcnJheUZvckVhY2goVEFDICE9PSBGdW5jdGlvbi5wcm90b3R5cGUgPyBnT1BOKEJhc2UpLmNvbmNhdChnT1BOKFRBQykpIDogZ09QTihCYXNlKSwgZnVuY3Rpb24gKGtleSkge1xuICAgICAgICBpZiAoIShrZXkgaW4gVHlwZWRBcnJheSkpIGhpZGUoVHlwZWRBcnJheSwga2V5LCBCYXNlW2tleV0pO1xuICAgICAgfSk7XG4gICAgICBUeXBlZEFycmF5W1BST1RPVFlQRV0gPSBUeXBlZEFycmF5UHJvdG90eXBlO1xuICAgICAgaWYgKCFMSUJSQVJZKSBUeXBlZEFycmF5UHJvdG90eXBlLmNvbnN0cnVjdG9yID0gVHlwZWRBcnJheTtcbiAgICB9XG4gICAgdmFyICRuYXRpdmVJdGVyYXRvciA9IFR5cGVkQXJyYXlQcm90b3R5cGVbSVRFUkFUT1JdO1xuICAgIHZhciBDT1JSRUNUX0lURVJfTkFNRSA9ICEhJG5hdGl2ZUl0ZXJhdG9yXG4gICAgICAmJiAoJG5hdGl2ZUl0ZXJhdG9yLm5hbWUgPT0gJ3ZhbHVlcycgfHwgJG5hdGl2ZUl0ZXJhdG9yLm5hbWUgPT0gdW5kZWZpbmVkKTtcbiAgICB2YXIgJGl0ZXJhdG9yID0gJGl0ZXJhdG9ycy52YWx1ZXM7XG4gICAgaGlkZShUeXBlZEFycmF5LCBUWVBFRF9DT05TVFJVQ1RPUiwgdHJ1ZSk7XG4gICAgaGlkZShUeXBlZEFycmF5UHJvdG90eXBlLCBUWVBFRF9BUlJBWSwgTkFNRSk7XG4gICAgaGlkZShUeXBlZEFycmF5UHJvdG90eXBlLCBWSUVXLCB0cnVlKTtcbiAgICBoaWRlKFR5cGVkQXJyYXlQcm90b3R5cGUsIERFRl9DT05TVFJVQ1RPUiwgVHlwZWRBcnJheSk7XG5cbiAgICBpZiAoQ0xBTVBFRCA/IG5ldyBUeXBlZEFycmF5KDEpW1RBR10gIT0gTkFNRSA6ICEoVEFHIGluIFR5cGVkQXJyYXlQcm90b3R5cGUpKSB7XG4gICAgICBkUChUeXBlZEFycmF5UHJvdG90eXBlLCBUQUcsIHtcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiBOQU1FOyB9XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICBPW05BTUVdID0gVHlwZWRBcnJheTtcblxuICAgICRleHBvcnQoJGV4cG9ydC5HICsgJGV4cG9ydC5XICsgJGV4cG9ydC5GICogKFR5cGVkQXJyYXkgIT0gQmFzZSksIE8pO1xuXG4gICAgJGV4cG9ydCgkZXhwb3J0LlMsIE5BTUUsIHtcbiAgICAgIEJZVEVTX1BFUl9FTEVNRU5UOiBCWVRFU1xuICAgIH0pO1xuXG4gICAgJGV4cG9ydCgkZXhwb3J0LlMgKyAkZXhwb3J0LkYgKiBmYWlscyhmdW5jdGlvbiAoKSB7IEJhc2Uub2YuY2FsbChUeXBlZEFycmF5LCAxKTsgfSksIE5BTUUsIHtcbiAgICAgIGZyb206ICRmcm9tLFxuICAgICAgb2Y6ICRvZlxuICAgIH0pO1xuXG4gICAgaWYgKCEoQllURVNfUEVSX0VMRU1FTlQgaW4gVHlwZWRBcnJheVByb3RvdHlwZSkpIGhpZGUoVHlwZWRBcnJheVByb3RvdHlwZSwgQllURVNfUEVSX0VMRU1FTlQsIEJZVEVTKTtcblxuICAgICRleHBvcnQoJGV4cG9ydC5QLCBOQU1FLCBwcm90byk7XG5cbiAgICBzZXRTcGVjaWVzKE5BTUUpO1xuXG4gICAgJGV4cG9ydCgkZXhwb3J0LlAgKyAkZXhwb3J0LkYgKiBGT1JDRURfU0VULCBOQU1FLCB7IHNldDogJHNldCB9KTtcblxuICAgICRleHBvcnQoJGV4cG9ydC5QICsgJGV4cG9ydC5GICogIUNPUlJFQ1RfSVRFUl9OQU1FLCBOQU1FLCAkaXRlcmF0b3JzKTtcblxuICAgIGlmICghTElCUkFSWSAmJiBUeXBlZEFycmF5UHJvdG90eXBlLnRvU3RyaW5nICE9IGFycmF5VG9TdHJpbmcpIFR5cGVkQXJyYXlQcm90b3R5cGUudG9TdHJpbmcgPSBhcnJheVRvU3RyaW5nO1xuXG4gICAgJGV4cG9ydCgkZXhwb3J0LlAgKyAkZXhwb3J0LkYgKiBmYWlscyhmdW5jdGlvbiAoKSB7XG4gICAgICBuZXcgVHlwZWRBcnJheSgxKS5zbGljZSgpO1xuICAgIH0pLCBOQU1FLCB7IHNsaWNlOiAkc2xpY2UgfSk7XG5cbiAgICAkZXhwb3J0KCRleHBvcnQuUCArICRleHBvcnQuRiAqIChmYWlscyhmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gWzEsIDJdLnRvTG9jYWxlU3RyaW5nKCkgIT0gbmV3IFR5cGVkQXJyYXkoWzEsIDJdKS50b0xvY2FsZVN0cmluZygpO1xuICAgIH0pIHx8ICFmYWlscyhmdW5jdGlvbiAoKSB7XG4gICAgICBUeXBlZEFycmF5UHJvdG90eXBlLnRvTG9jYWxlU3RyaW5nLmNhbGwoWzEsIDJdKTtcbiAgICB9KSksIE5BTUUsIHsgdG9Mb2NhbGVTdHJpbmc6ICR0b0xvY2FsZVN0cmluZyB9KTtcblxuICAgIEl0ZXJhdG9yc1tOQU1FXSA9IENPUlJFQ1RfSVRFUl9OQU1FID8gJG5hdGl2ZUl0ZXJhdG9yIDogJGl0ZXJhdG9yO1xuICAgIGlmICghTElCUkFSWSAmJiAhQ09SUkVDVF9JVEVSX05BTUUpIGhpZGUoVHlwZWRBcnJheVByb3RvdHlwZSwgSVRFUkFUT1IsICRpdGVyYXRvcik7XG4gIH07XG59IGVsc2UgbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoKSB7IC8qIGVtcHR5ICovIH07XG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///26\n")},function(module,exports,__webpack_require__){eval("// 7.1.1 ToPrimitive(input [, PreferredType])\nvar isObject = __webpack_require__(5);\n// instead of the ES6 spec version, we didn't implement @@toPrimitive case\n// and the second argument - flag - preferred type is a string\nmodule.exports = function (it, S) {\n  if (!isObject(it)) return it;\n  var fn, val;\n  if (S && typeof (fn = it.toString) == 'function' && !isObject(val = fn.call(it))) return val;\n  if (typeof (fn = it.valueOf) == 'function' && !isObject(val = fn.call(it))) return val;\n  if (!S && typeof (fn = it.toString) == 'function' && !isObject(val = fn.call(it))) return val;\n  throw TypeError(\"Can't convert object to primitive value\");\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMjcuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9bbmFtZV0vLi9ub2RlX21vZHVsZXMvY29yZS1qcy9tb2R1bGVzL190by1wcmltaXRpdmUuanM/NmE5OSJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyA3LjEuMSBUb1ByaW1pdGl2ZShpbnB1dCBbLCBQcmVmZXJyZWRUeXBlXSlcbnZhciBpc09iamVjdCA9IHJlcXVpcmUoJy4vX2lzLW9iamVjdCcpO1xuLy8gaW5zdGVhZCBvZiB0aGUgRVM2IHNwZWMgdmVyc2lvbiwgd2UgZGlkbid0IGltcGxlbWVudCBAQHRvUHJpbWl0aXZlIGNhc2Vcbi8vIGFuZCB0aGUgc2Vjb25kIGFyZ3VtZW50IC0gZmxhZyAtIHByZWZlcnJlZCB0eXBlIGlzIGEgc3RyaW5nXG5tb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChpdCwgUykge1xuICBpZiAoIWlzT2JqZWN0KGl0KSkgcmV0dXJuIGl0O1xuICB2YXIgZm4sIHZhbDtcbiAgaWYgKFMgJiYgdHlwZW9mIChmbiA9IGl0LnRvU3RyaW5nKSA9PSAnZnVuY3Rpb24nICYmICFpc09iamVjdCh2YWwgPSBmbi5jYWxsKGl0KSkpIHJldHVybiB2YWw7XG4gIGlmICh0eXBlb2YgKGZuID0gaXQudmFsdWVPZikgPT0gJ2Z1bmN0aW9uJyAmJiAhaXNPYmplY3QodmFsID0gZm4uY2FsbChpdCkpKSByZXR1cm4gdmFsO1xuICBpZiAoIVMgJiYgdHlwZW9mIChmbiA9IGl0LnRvU3RyaW5nKSA9PSAnZnVuY3Rpb24nICYmICFpc09iamVjdCh2YWwgPSBmbi5jYWxsKGl0KSkpIHJldHVybiB2YWw7XG4gIHRocm93IFR5cGVFcnJvcihcIkNhbid0IGNvbnZlcnQgb2JqZWN0IHRvIHByaW1pdGl2ZSB2YWx1ZVwiKTtcbn07XG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///27\n")},function(module,exports,__webpack_require__){eval("var META = __webpack_require__(30)('meta');\nvar isObject = __webpack_require__(5);\nvar has = __webpack_require__(14);\nvar setDesc = __webpack_require__(10).f;\nvar id = 0;\nvar isExtensible = Object.isExtensible || function () {\n  return true;\n};\nvar FREEZE = !__webpack_require__(3)(function () {\n  return isExtensible(Object.preventExtensions({}));\n});\nvar setMeta = function (it) {\n  setDesc(it, META, { value: {\n    i: 'O' + ++id, // object ID\n    w: {}          // weak collections IDs\n  } });\n};\nvar fastKey = function (it, create) {\n  // return primitive with prefix\n  if (!isObject(it)) return typeof it == 'symbol' ? it : (typeof it == 'string' ? 'S' : 'P') + it;\n  if (!has(it, META)) {\n    // can't set metadata to uncaught frozen object\n    if (!isExtensible(it)) return 'F';\n    // not necessary to add metadata\n    if (!create) return 'E';\n    // add missing metadata\n    setMeta(it);\n  // return object ID\n  } return it[META].i;\n};\nvar getWeak = function (it, create) {\n  if (!has(it, META)) {\n    // can't set metadata to uncaught frozen object\n    if (!isExtensible(it)) return true;\n    // not necessary to add metadata\n    if (!create) return false;\n    // add missing metadata\n    setMeta(it);\n  // return hash weak collections IDs\n  } return it[META].w;\n};\n// add metadata on freeze-family methods calling\nvar onFreeze = function (it) {\n  if (FREEZE && meta.NEED && isExtensible(it) && !has(it, META)) setMeta(it);\n  return it;\n};\nvar meta = module.exports = {\n  KEY: META,\n  NEED: false,\n  fastKey: fastKey,\n  getWeak: getWeak,\n  onFreeze: onFreeze\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMjguanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9bbmFtZV0vLi9ub2RlX21vZHVsZXMvY29yZS1qcy9tb2R1bGVzL19tZXRhLmpzPzY3YWIiXSwic291cmNlc0NvbnRlbnQiOlsidmFyIE1FVEEgPSByZXF1aXJlKCcuL191aWQnKSgnbWV0YScpO1xudmFyIGlzT2JqZWN0ID0gcmVxdWlyZSgnLi9faXMtb2JqZWN0Jyk7XG52YXIgaGFzID0gcmVxdWlyZSgnLi9faGFzJyk7XG52YXIgc2V0RGVzYyA9IHJlcXVpcmUoJy4vX29iamVjdC1kcCcpLmY7XG52YXIgaWQgPSAwO1xudmFyIGlzRXh0ZW5zaWJsZSA9IE9iamVjdC5pc0V4dGVuc2libGUgfHwgZnVuY3Rpb24gKCkge1xuICByZXR1cm4gdHJ1ZTtcbn07XG52YXIgRlJFRVpFID0gIXJlcXVpcmUoJy4vX2ZhaWxzJykoZnVuY3Rpb24gKCkge1xuICByZXR1cm4gaXNFeHRlbnNpYmxlKE9iamVjdC5wcmV2ZW50RXh0ZW5zaW9ucyh7fSkpO1xufSk7XG52YXIgc2V0TWV0YSA9IGZ1bmN0aW9uIChpdCkge1xuICBzZXREZXNjKGl0LCBNRVRBLCB7IHZhbHVlOiB7XG4gICAgaTogJ08nICsgKytpZCwgLy8gb2JqZWN0IElEXG4gICAgdzoge30gICAgICAgICAgLy8gd2VhayBjb2xsZWN0aW9ucyBJRHNcbiAgfSB9KTtcbn07XG52YXIgZmFzdEtleSA9IGZ1bmN0aW9uIChpdCwgY3JlYXRlKSB7XG4gIC8vIHJldHVybiBwcmltaXRpdmUgd2l0aCBwcmVmaXhcbiAgaWYgKCFpc09iamVjdChpdCkpIHJldHVybiB0eXBlb2YgaXQgPT0gJ3N5bWJvbCcgPyBpdCA6ICh0eXBlb2YgaXQgPT0gJ3N0cmluZycgPyAnUycgOiAnUCcpICsgaXQ7XG4gIGlmICghaGFzKGl0LCBNRVRBKSkge1xuICAgIC8vIGNhbid0IHNldCBtZXRhZGF0YSB0byB1bmNhdWdodCBmcm96ZW4gb2JqZWN0XG4gICAgaWYgKCFpc0V4dGVuc2libGUoaXQpKSByZXR1cm4gJ0YnO1xuICAgIC8vIG5vdCBuZWNlc3NhcnkgdG8gYWRkIG1ldGFkYXRhXG4gICAgaWYgKCFjcmVhdGUpIHJldHVybiAnRSc7XG4gICAgLy8gYWRkIG1pc3NpbmcgbWV0YWRhdGFcbiAgICBzZXRNZXRhKGl0KTtcbiAgLy8gcmV0dXJuIG9iamVjdCBJRFxuICB9IHJldHVybiBpdFtNRVRBXS5pO1xufTtcbnZhciBnZXRXZWFrID0gZnVuY3Rpb24gKGl0LCBjcmVhdGUpIHtcbiAgaWYgKCFoYXMoaXQsIE1FVEEpKSB7XG4gICAgLy8gY2FuJ3Qgc2V0IG1ldGFkYXRhIHRvIHVuY2F1Z2h0IGZyb3plbiBvYmplY3RcbiAgICBpZiAoIWlzRXh0ZW5zaWJsZShpdCkpIHJldHVybiB0cnVlO1xuICAgIC8vIG5vdCBuZWNlc3NhcnkgdG8gYWRkIG1ldGFkYXRhXG4gICAgaWYgKCFjcmVhdGUpIHJldHVybiBmYWxzZTtcbiAgICAvLyBhZGQgbWlzc2luZyBtZXRhZGF0YVxuICAgIHNldE1ldGEoaXQpO1xuICAvLyByZXR1cm4gaGFzaCB3ZWFrIGNvbGxlY3Rpb25zIElEc1xuICB9IHJldHVybiBpdFtNRVRBXS53O1xufTtcbi8vIGFkZCBtZXRhZGF0YSBvbiBmcmVlemUtZmFtaWx5IG1ldGhvZHMgY2FsbGluZ1xudmFyIG9uRnJlZXplID0gZnVuY3Rpb24gKGl0KSB7XG4gIGlmIChGUkVFWkUgJiYgbWV0YS5ORUVEICYmIGlzRXh0ZW5zaWJsZShpdCkgJiYgIWhhcyhpdCwgTUVUQSkpIHNldE1ldGEoaXQpO1xuICByZXR1cm4gaXQ7XG59O1xudmFyIG1ldGEgPSBtb2R1bGUuZXhwb3J0cyA9IHtcbiAgS0VZOiBNRVRBLFxuICBORUVEOiBmYWxzZSxcbiAgZmFzdEtleTogZmFzdEtleSxcbiAgZ2V0V2VhazogZ2V0V2VhayxcbiAgb25GcmVlemU6IG9uRnJlZXplXG59O1xuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///28\n")},function(module,exports){eval("module.exports = function (bitmap, value) {\n  return {\n    enumerable: !(bitmap & 1),\n    configurable: !(bitmap & 2),\n    writable: !(bitmap & 4),\n    value: value\n  };\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMjkuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9bbmFtZV0vLi9ub2RlX21vZHVsZXMvY29yZS1qcy9tb2R1bGVzL19wcm9wZXJ0eS1kZXNjLmpzPzQ2MzAiXSwic291cmNlc0NvbnRlbnQiOlsibW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoYml0bWFwLCB2YWx1ZSkge1xuICByZXR1cm4ge1xuICAgIGVudW1lcmFibGU6ICEoYml0bWFwICYgMSksXG4gICAgY29uZmlndXJhYmxlOiAhKGJpdG1hcCAmIDIpLFxuICAgIHdyaXRhYmxlOiAhKGJpdG1hcCAmIDQpLFxuICAgIHZhbHVlOiB2YWx1ZVxuICB9O1xufTtcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///29\n")},function(module,exports){eval("var id = 0;\nvar px = Math.random();\nmodule.exports = function (key) {\n  return 'Symbol('.concat(key === undefined ? '' : key, ')_', (++id + px).toString(36));\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMzAuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9bbmFtZV0vLi9ub2RlX21vZHVsZXMvY29yZS1qcy9tb2R1bGVzL191aWQuanM/Y2E1YSJdLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgaWQgPSAwO1xudmFyIHB4ID0gTWF0aC5yYW5kb20oKTtcbm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKGtleSkge1xuICByZXR1cm4gJ1N5bWJvbCgnLmNvbmNhdChrZXkgPT09IHVuZGVmaW5lZCA/ICcnIDoga2V5LCAnKV8nLCAoKytpZCArIHB4KS50b1N0cmluZygzNikpO1xufTtcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///30\n")},function(module,exports){eval("module.exports = false;\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMzEuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9bbmFtZV0vLi9ub2RlX21vZHVsZXMvY29yZS1qcy9tb2R1bGVzL19saWJyYXJ5LmpzPzJkMDAiXSwic291cmNlc0NvbnRlbnQiOlsibW9kdWxlLmV4cG9ydHMgPSBmYWxzZTtcbiJdLCJtYXBwaW5ncyI6IkFBQUE7Iiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///31\n")},function(module,exports,__webpack_require__){eval("// 19.1.2.14 / 15.2.3.14 Object.keys(O)\nvar $keys = __webpack_require__(93);\nvar enumBugKeys = __webpack_require__(64);\n\nmodule.exports = Object.keys || function keys(O) {\n  return $keys(O, enumBugKeys);\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMzIuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9bbmFtZV0vLi9ub2RlX21vZHVsZXMvY29yZS1qcy9tb2R1bGVzL19vYmplY3Qta2V5cy5qcz8wZDU4Il0sInNvdXJjZXNDb250ZW50IjpbIi8vIDE5LjEuMi4xNCAvIDE1LjIuMy4xNCBPYmplY3Qua2V5cyhPKVxudmFyICRrZXlzID0gcmVxdWlyZSgnLi9fb2JqZWN0LWtleXMtaW50ZXJuYWwnKTtcbnZhciBlbnVtQnVnS2V5cyA9IHJlcXVpcmUoJy4vX2VudW0tYnVnLWtleXMnKTtcblxubW9kdWxlLmV4cG9ydHMgPSBPYmplY3Qua2V5cyB8fCBmdW5jdGlvbiBrZXlzKE8pIHtcbiAgcmV0dXJuICRrZXlzKE8sIGVudW1CdWdLZXlzKTtcbn07XG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///32\n")},function(module,exports,__webpack_require__){eval("var toInteger = __webpack_require__(20);\nvar max = Math.max;\nvar min = Math.min;\nmodule.exports = function (index, length) {\n  index = toInteger(index);\n  return index < 0 ? max(index + length, 0) : min(index, length);\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMzMuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9bbmFtZV0vLi9ub2RlX21vZHVsZXMvY29yZS1qcy9tb2R1bGVzL190by1hYnNvbHV0ZS1pbmRleC5qcz83N2YxIl0sInNvdXJjZXNDb250ZW50IjpbInZhciB0b0ludGVnZXIgPSByZXF1aXJlKCcuL190by1pbnRlZ2VyJyk7XG52YXIgbWF4ID0gTWF0aC5tYXg7XG52YXIgbWluID0gTWF0aC5taW47XG5tb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChpbmRleCwgbGVuZ3RoKSB7XG4gIGluZGV4ID0gdG9JbnRlZ2VyKGluZGV4KTtcbiAgcmV0dXJuIGluZGV4IDwgMCA/IG1heChpbmRleCArIGxlbmd0aCwgMCkgOiBtaW4oaW5kZXgsIGxlbmd0aCk7XG59O1xuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///33\n")},function(module,exports,__webpack_require__){eval("// 19.1.2.2 / 15.2.3.5 Object.create(O [, Properties])\nvar anObject = __webpack_require__(4);\nvar dPs = __webpack_require__(94);\nvar enumBugKeys = __webpack_require__(64);\nvar IE_PROTO = __webpack_require__(63)('IE_PROTO');\nvar Empty = function () { /* empty */ };\nvar PROTOTYPE = 'prototype';\n\n// Create object with fake `null` prototype: use iframe Object with cleared prototype\nvar createDict = function () {\n  // Thrash, waste and sodomy: IE GC bug\n  var iframe = __webpack_require__(61)('iframe');\n  var i = enumBugKeys.length;\n  var lt = '<';\n  var gt = '>';\n  var iframeDocument;\n  iframe.style.display = 'none';\n  __webpack_require__(65).appendChild(iframe);\n  iframe.src = 'javascript:'; // eslint-disable-line no-script-url\n  // createDict = iframe.contentWindow.Object;\n  // html.removeChild(iframe);\n  iframeDocument = iframe.contentWindow.document;\n  iframeDocument.open();\n  iframeDocument.write(lt + 'script' + gt + 'document.F=Object' + lt + '/script' + gt);\n  iframeDocument.close();\n  createDict = iframeDocument.F;\n  while (i--) delete createDict[PROTOTYPE][enumBugKeys[i]];\n  return createDict();\n};\n\nmodule.exports = Object.create || function create(O, Properties) {\n  var result;\n  if (O !== null) {\n    Empty[PROTOTYPE] = anObject(O);\n    result = new Empty();\n    Empty[PROTOTYPE] = null;\n    // add \"__proto__\" for Object.getPrototypeOf polyfill\n    result[IE_PROTO] = O;\n  } else result = createDict();\n  return Properties === undefined ? result : dPs(result, Properties);\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMzQuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9bbmFtZV0vLi9ub2RlX21vZHVsZXMvY29yZS1qcy9tb2R1bGVzL19vYmplY3QtY3JlYXRlLmpzPzJhZWIiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gMTkuMS4yLjIgLyAxNS4yLjMuNSBPYmplY3QuY3JlYXRlKE8gWywgUHJvcGVydGllc10pXG52YXIgYW5PYmplY3QgPSByZXF1aXJlKCcuL19hbi1vYmplY3QnKTtcbnZhciBkUHMgPSByZXF1aXJlKCcuL19vYmplY3QtZHBzJyk7XG52YXIgZW51bUJ1Z0tleXMgPSByZXF1aXJlKCcuL19lbnVtLWJ1Zy1rZXlzJyk7XG52YXIgSUVfUFJPVE8gPSByZXF1aXJlKCcuL19zaGFyZWQta2V5JykoJ0lFX1BST1RPJyk7XG52YXIgRW1wdHkgPSBmdW5jdGlvbiAoKSB7IC8qIGVtcHR5ICovIH07XG52YXIgUFJPVE9UWVBFID0gJ3Byb3RvdHlwZSc7XG5cbi8vIENyZWF0ZSBvYmplY3Qgd2l0aCBmYWtlIGBudWxsYCBwcm90b3R5cGU6IHVzZSBpZnJhbWUgT2JqZWN0IHdpdGggY2xlYXJlZCBwcm90b3R5cGVcbnZhciBjcmVhdGVEaWN0ID0gZnVuY3Rpb24gKCkge1xuICAvLyBUaHJhc2gsIHdhc3RlIGFuZCBzb2RvbXk6IElFIEdDIGJ1Z1xuICB2YXIgaWZyYW1lID0gcmVxdWlyZSgnLi9fZG9tLWNyZWF0ZScpKCdpZnJhbWUnKTtcbiAgdmFyIGkgPSBlbnVtQnVnS2V5cy5sZW5ndGg7XG4gIHZhciBsdCA9ICc8JztcbiAgdmFyIGd0ID0gJz4nO1xuICB2YXIgaWZyYW1lRG9jdW1lbnQ7XG4gIGlmcmFtZS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnO1xuICByZXF1aXJlKCcuL19odG1sJykuYXBwZW5kQ2hpbGQoaWZyYW1lKTtcbiAgaWZyYW1lLnNyYyA9ICdqYXZhc2NyaXB0Oic7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgbm8tc2NyaXB0LXVybFxuICAvLyBjcmVhdGVEaWN0ID0gaWZyYW1lLmNvbnRlbnRXaW5kb3cuT2JqZWN0O1xuICAvLyBodG1sLnJlbW92ZUNoaWxkKGlmcmFtZSk7XG4gIGlmcmFtZURvY3VtZW50ID0gaWZyYW1lLmNvbnRlbnRXaW5kb3cuZG9jdW1lbnQ7XG4gIGlmcmFtZURvY3VtZW50Lm9wZW4oKTtcbiAgaWZyYW1lRG9jdW1lbnQud3JpdGUobHQgKyAnc2NyaXB0JyArIGd0ICsgJ2RvY3VtZW50LkY9T2JqZWN0JyArIGx0ICsgJy9zY3JpcHQnICsgZ3QpO1xuICBpZnJhbWVEb2N1bWVudC5jbG9zZSgpO1xuICBjcmVhdGVEaWN0ID0gaWZyYW1lRG9jdW1lbnQuRjtcbiAgd2hpbGUgKGktLSkgZGVsZXRlIGNyZWF0ZURpY3RbUFJPVE9UWVBFXVtlbnVtQnVnS2V5c1tpXV07XG4gIHJldHVybiBjcmVhdGVEaWN0KCk7XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IE9iamVjdC5jcmVhdGUgfHwgZnVuY3Rpb24gY3JlYXRlKE8sIFByb3BlcnRpZXMpIHtcbiAgdmFyIHJlc3VsdDtcbiAgaWYgKE8gIT09IG51bGwpIHtcbiAgICBFbXB0eVtQUk9UT1RZUEVdID0gYW5PYmplY3QoTyk7XG4gICAgcmVzdWx0ID0gbmV3IEVtcHR5KCk7XG4gICAgRW1wdHlbUFJPVE9UWVBFXSA9IG51bGw7XG4gICAgLy8gYWRkIFwiX19wcm90b19fXCIgZm9yIE9iamVjdC5nZXRQcm90b3R5cGVPZiBwb2x5ZmlsbFxuICAgIHJlc3VsdFtJRV9QUk9UT10gPSBPO1xuICB9IGVsc2UgcmVzdWx0ID0gY3JlYXRlRGljdCgpO1xuICByZXR1cm4gUHJvcGVydGllcyA9PT0gdW5kZWZpbmVkID8gcmVzdWx0IDogZFBzKHJlc3VsdCwgUHJvcGVydGllcyk7XG59O1xuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///34\n")},function(module,exports,__webpack_require__){eval("// 19.1.2.7 / 15.2.3.4 Object.getOwnPropertyNames(O)\nvar $keys = __webpack_require__(93);\nvar hiddenKeys = __webpack_require__(64).concat('length', 'prototype');\n\nexports.f = Object.getOwnPropertyNames || function getOwnPropertyNames(O) {\n  return $keys(O, hiddenKeys);\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMzUuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9bbmFtZV0vLi9ub2RlX21vZHVsZXMvY29yZS1qcy9tb2R1bGVzL19vYmplY3QtZ29wbi5qcz85MDkzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIDE5LjEuMi43IC8gMTUuMi4zLjQgT2JqZWN0LmdldE93blByb3BlcnR5TmFtZXMoTylcbnZhciAka2V5cyA9IHJlcXVpcmUoJy4vX29iamVjdC1rZXlzLWludGVybmFsJyk7XG52YXIgaGlkZGVuS2V5cyA9IHJlcXVpcmUoJy4vX2VudW0tYnVnLWtleXMnKS5jb25jYXQoJ2xlbmd0aCcsICdwcm90b3R5cGUnKTtcblxuZXhwb3J0cy5mID0gT2JqZWN0LmdldE93blByb3BlcnR5TmFtZXMgfHwgZnVuY3Rpb24gZ2V0T3duUHJvcGVydHlOYW1lcyhPKSB7XG4gIHJldHVybiAka2V5cyhPLCBoaWRkZW5LZXlzKTtcbn07XG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///35\n")},function(module,exports,__webpack_require__){eval("// 19.1.2.9 / 15.2.3.2 Object.getPrototypeOf(O)\nvar has = __webpack_require__(14);\nvar toObject = __webpack_require__(11);\nvar IE_PROTO = __webpack_require__(63)('IE_PROTO');\nvar ObjectProto = Object.prototype;\n\nmodule.exports = Object.getPrototypeOf || function (O) {\n  O = toObject(O);\n  if (has(O, IE_PROTO)) return O[IE_PROTO];\n  if (typeof O.constructor == 'function' && O instanceof O.constructor) {\n    return O.constructor.prototype;\n  } return O instanceof Object ? ObjectProto : null;\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMzYuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9bbmFtZV0vLi9ub2RlX21vZHVsZXMvY29yZS1qcy9tb2R1bGVzL19vYmplY3QtZ3BvLmpzPzM4ZmQiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gMTkuMS4yLjkgLyAxNS4yLjMuMiBPYmplY3QuZ2V0UHJvdG90eXBlT2YoTylcbnZhciBoYXMgPSByZXF1aXJlKCcuL19oYXMnKTtcbnZhciB0b09iamVjdCA9IHJlcXVpcmUoJy4vX3RvLW9iamVjdCcpO1xudmFyIElFX1BST1RPID0gcmVxdWlyZSgnLi9fc2hhcmVkLWtleScpKCdJRV9QUk9UTycpO1xudmFyIE9iamVjdFByb3RvID0gT2JqZWN0LnByb3RvdHlwZTtcblxubW9kdWxlLmV4cG9ydHMgPSBPYmplY3QuZ2V0UHJvdG90eXBlT2YgfHwgZnVuY3Rpb24gKE8pIHtcbiAgTyA9IHRvT2JqZWN0KE8pO1xuICBpZiAoaGFzKE8sIElFX1BST1RPKSkgcmV0dXJuIE9bSUVfUFJPVE9dO1xuICBpZiAodHlwZW9mIE8uY29uc3RydWN0b3IgPT0gJ2Z1bmN0aW9uJyAmJiBPIGluc3RhbmNlb2YgTy5jb25zdHJ1Y3Rvcikge1xuICAgIHJldHVybiBPLmNvbnN0cnVjdG9yLnByb3RvdHlwZTtcbiAgfSByZXR1cm4gTyBpbnN0YW5jZW9mIE9iamVjdCA/IE9iamVjdFByb3RvIDogbnVsbDtcbn07XG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///36\n")},function(module,exports,__webpack_require__){eval("// 22.1.3.31 Array.prototype[@@unscopables]\nvar UNSCOPABLES = __webpack_require__(6)('unscopables');\nvar ArrayProto = Array.prototype;\nif (ArrayProto[UNSCOPABLES] == undefined) __webpack_require__(15)(ArrayProto, UNSCOPABLES, {});\nmodule.exports = function (key) {\n  ArrayProto[UNSCOPABLES][key] = true;\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMzcuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9bbmFtZV0vLi9ub2RlX21vZHVsZXMvY29yZS1qcy9tb2R1bGVzL19hZGQtdG8tdW5zY29wYWJsZXMuanM/OWM2YyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyAyMi4xLjMuMzEgQXJyYXkucHJvdG90eXBlW0BAdW5zY29wYWJsZXNdXG52YXIgVU5TQ09QQUJMRVMgPSByZXF1aXJlKCcuL193a3MnKSgndW5zY29wYWJsZXMnKTtcbnZhciBBcnJheVByb3RvID0gQXJyYXkucHJvdG90eXBlO1xuaWYgKEFycmF5UHJvdG9bVU5TQ09QQUJMRVNdID09IHVuZGVmaW5lZCkgcmVxdWlyZSgnLi9faGlkZScpKEFycmF5UHJvdG8sIFVOU0NPUEFCTEVTLCB7fSk7XG5tb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChrZXkpIHtcbiAgQXJyYXlQcm90b1tVTlNDT1BBQkxFU11ba2V5XSA9IHRydWU7XG59O1xuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///37\n")},function(module,exports,__webpack_require__){eval("var isObject = __webpack_require__(5);\nmodule.exports = function (it, TYPE) {\n  if (!isObject(it) || it._t !== TYPE) throw TypeError('Incompatible receiver, ' + TYPE + ' required!');\n  return it;\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMzguanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9bbmFtZV0vLi9ub2RlX21vZHVsZXMvY29yZS1qcy9tb2R1bGVzL192YWxpZGF0ZS1jb2xsZWN0aW9uLmpzP2IzOWEiXSwic291cmNlc0NvbnRlbnQiOlsidmFyIGlzT2JqZWN0ID0gcmVxdWlyZSgnLi9faXMtb2JqZWN0Jyk7XG5tb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChpdCwgVFlQRSkge1xuICBpZiAoIWlzT2JqZWN0KGl0KSB8fCBpdC5fdCAhPT0gVFlQRSkgdGhyb3cgVHlwZUVycm9yKCdJbmNvbXBhdGlibGUgcmVjZWl2ZXIsICcgKyBUWVBFICsgJyByZXF1aXJlZCEnKTtcbiAgcmV0dXJuIGl0O1xufTtcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///38\n")},function(module,exports,__webpack_require__){eval("var def = __webpack_require__(10).f;\nvar has = __webpack_require__(14);\nvar TAG = __webpack_require__(6)('toStringTag');\n\nmodule.exports = function (it, tag, stat) {\n  if (it && !has(it = stat ? it : it.prototype, TAG)) def(it, TAG, { configurable: true, value: tag });\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMzkuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9bbmFtZV0vLi9ub2RlX21vZHVsZXMvY29yZS1qcy9tb2R1bGVzL19zZXQtdG8tc3RyaW5nLXRhZy5qcz83ZjIwIl0sInNvdXJjZXNDb250ZW50IjpbInZhciBkZWYgPSByZXF1aXJlKCcuL19vYmplY3QtZHAnKS5mO1xudmFyIGhhcyA9IHJlcXVpcmUoJy4vX2hhcycpO1xudmFyIFRBRyA9IHJlcXVpcmUoJy4vX3drcycpKCd0b1N0cmluZ1RhZycpO1xuXG5tb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChpdCwgdGFnLCBzdGF0KSB7XG4gIGlmIChpdCAmJiAhaGFzKGl0ID0gc3RhdCA/IGl0IDogaXQucHJvdG90eXBlLCBUQUcpKSBkZWYoaXQsIFRBRywgeyBjb25maWd1cmFibGU6IHRydWUsIHZhbHVlOiB0YWcgfSk7XG59O1xuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///39\n")},function(module,exports,__webpack_require__){eval("var $export = __webpack_require__(1);\nvar defined = __webpack_require__(25);\nvar fails = __webpack_require__(3);\nvar spaces = __webpack_require__(67);\nvar space = '[' + spaces + ']';\nvar non = '\\u200b\\u0085';\nvar ltrim = RegExp('^' + space + space + '*');\nvar rtrim = RegExp(space + space + '*$');\n\nvar exporter = function (KEY, exec, ALIAS) {\n  var exp = {};\n  var FORCE = fails(function () {\n    return !!spaces[KEY]() || non[KEY]() != non;\n  });\n  var fn = exp[KEY] = FORCE ? exec(trim) : spaces[KEY];\n  if (ALIAS) exp[ALIAS] = fn;\n  $export($export.P + $export.F * FORCE, 'String', exp);\n};\n\n// 1 -> String#trimLeft\n// 2 -> String#trimRight\n// 3 -> String#trim\nvar trim = exporter.trim = function (string, TYPE) {\n  string = String(defined(string));\n  if (TYPE & 1) string = string.replace(ltrim, '');\n  if (TYPE & 2) string = string.replace(rtrim, '');\n  return string;\n};\n\nmodule.exports = exporter;\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNDAuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9bbmFtZV0vLi9ub2RlX21vZHVsZXMvY29yZS1qcy9tb2R1bGVzL19zdHJpbmctdHJpbS5qcz9hYTc3Il0sInNvdXJjZXNDb250ZW50IjpbInZhciAkZXhwb3J0ID0gcmVxdWlyZSgnLi9fZXhwb3J0Jyk7XG52YXIgZGVmaW5lZCA9IHJlcXVpcmUoJy4vX2RlZmluZWQnKTtcbnZhciBmYWlscyA9IHJlcXVpcmUoJy4vX2ZhaWxzJyk7XG52YXIgc3BhY2VzID0gcmVxdWlyZSgnLi9fc3RyaW5nLXdzJyk7XG52YXIgc3BhY2UgPSAnWycgKyBzcGFjZXMgKyAnXSc7XG52YXIgbm9uID0gJ1xcdTIwMGJcXHUwMDg1JztcbnZhciBsdHJpbSA9IFJlZ0V4cCgnXicgKyBzcGFjZSArIHNwYWNlICsgJyonKTtcbnZhciBydHJpbSA9IFJlZ0V4cChzcGFjZSArIHNwYWNlICsgJyokJyk7XG5cbnZhciBleHBvcnRlciA9IGZ1bmN0aW9uIChLRVksIGV4ZWMsIEFMSUFTKSB7XG4gIHZhciBleHAgPSB7fTtcbiAgdmFyIEZPUkNFID0gZmFpbHMoZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiAhIXNwYWNlc1tLRVldKCkgfHwgbm9uW0tFWV0oKSAhPSBub247XG4gIH0pO1xuICB2YXIgZm4gPSBleHBbS0VZXSA9IEZPUkNFID8gZXhlYyh0cmltKSA6IHNwYWNlc1tLRVldO1xuICBpZiAoQUxJQVMpIGV4cFtBTElBU10gPSBmbjtcbiAgJGV4cG9ydCgkZXhwb3J0LlAgKyAkZXhwb3J0LkYgKiBGT1JDRSwgJ1N0cmluZycsIGV4cCk7XG59O1xuXG4vLyAxIC0+IFN0cmluZyN0cmltTGVmdFxuLy8gMiAtPiBTdHJpbmcjdHJpbVJpZ2h0XG4vLyAzIC0+IFN0cmluZyN0cmltXG52YXIgdHJpbSA9IGV4cG9ydGVyLnRyaW0gPSBmdW5jdGlvbiAoc3RyaW5nLCBUWVBFKSB7XG4gIHN0cmluZyA9IFN0cmluZyhkZWZpbmVkKHN0cmluZykpO1xuICBpZiAoVFlQRSAmIDEpIHN0cmluZyA9IHN0cmluZy5yZXBsYWNlKGx0cmltLCAnJyk7XG4gIGlmIChUWVBFICYgMikgc3RyaW5nID0gc3RyaW5nLnJlcGxhY2UocnRyaW0sICcnKTtcbiAgcmV0dXJuIHN0cmluZztcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gZXhwb3J0ZXI7XG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///40\n")},function(module,exports){eval("module.exports = {};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNDEuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9bbmFtZV0vLi9ub2RlX21vZHVsZXMvY29yZS1qcy9tb2R1bGVzL19pdGVyYXRvcnMuanM/ODRmMiJdLCJzb3VyY2VzQ29udGVudCI6WyJtb2R1bGUuZXhwb3J0cyA9IHt9O1xuIl0sIm1hcHBpbmdzIjoiQUFBQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///41\n")},function(module,exports,__webpack_require__){"use strict";eval("\nvar global = __webpack_require__(2);\nvar dP = __webpack_require__(10);\nvar DESCRIPTORS = __webpack_require__(9);\nvar SPECIES = __webpack_require__(6)('species');\n\nmodule.exports = function (KEY) {\n  var C = global[KEY];\n  if (DESCRIPTORS && C && !C[SPECIES]) dP.f(C, SPECIES, {\n    configurable: true,\n    get: function () { return this; }\n  });\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNDIuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9bbmFtZV0vLi9ub2RlX21vZHVsZXMvY29yZS1qcy9tb2R1bGVzL19zZXQtc3BlY2llcy5qcz83YTU2Il0sInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcbnZhciBnbG9iYWwgPSByZXF1aXJlKCcuL19nbG9iYWwnKTtcbnZhciBkUCA9IHJlcXVpcmUoJy4vX29iamVjdC1kcCcpO1xudmFyIERFU0NSSVBUT1JTID0gcmVxdWlyZSgnLi9fZGVzY3JpcHRvcnMnKTtcbnZhciBTUEVDSUVTID0gcmVxdWlyZSgnLi9fd2tzJykoJ3NwZWNpZXMnKTtcblxubW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoS0VZKSB7XG4gIHZhciBDID0gZ2xvYmFsW0tFWV07XG4gIGlmIChERVNDUklQVE9SUyAmJiBDICYmICFDW1NQRUNJRVNdKSBkUC5mKEMsIFNQRUNJRVMsIHtcbiAgICBjb25maWd1cmFibGU6IHRydWUsXG4gICAgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiB0aGlzOyB9XG4gIH0pO1xufTtcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Iiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///42\n")},function(module,exports){eval("module.exports = function (it, Constructor, name, forbiddenField) {\n  if (!(it instanceof Constructor) || (forbiddenField !== undefined && forbiddenField in it)) {\n    throw TypeError(name + ': incorrect invocation!');\n  } return it;\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNDMuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9bbmFtZV0vLi9ub2RlX21vZHVsZXMvY29yZS1qcy9tb2R1bGVzL19hbi1pbnN0YW5jZS5qcz9mNjA1Il0sInNvdXJjZXNDb250ZW50IjpbIm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKGl0LCBDb25zdHJ1Y3RvciwgbmFtZSwgZm9yYmlkZGVuRmllbGQpIHtcbiAgaWYgKCEoaXQgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikgfHwgKGZvcmJpZGRlbkZpZWxkICE9PSB1bmRlZmluZWQgJiYgZm9yYmlkZGVuRmllbGQgaW4gaXQpKSB7XG4gICAgdGhyb3cgVHlwZUVycm9yKG5hbWUgKyAnOiBpbmNvcnJlY3QgaW52b2NhdGlvbiEnKTtcbiAgfSByZXR1cm4gaXQ7XG59O1xuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///43\n")},function(module,exports,__webpack_require__){eval("var redefine = __webpack_require__(12);\nmodule.exports = function (target, src, safe) {\n  for (var key in src) redefine(target, key, src[key], safe);\n  return target;\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNDQuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9bbmFtZV0vLi9ub2RlX21vZHVsZXMvY29yZS1qcy9tb2R1bGVzL19yZWRlZmluZS1hbGwuanM/ZGNiYyJdLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgcmVkZWZpbmUgPSByZXF1aXJlKCcuL19yZWRlZmluZScpO1xubW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAodGFyZ2V0LCBzcmMsIHNhZmUpIHtcbiAgZm9yICh2YXIga2V5IGluIHNyYykgcmVkZWZpbmUodGFyZ2V0LCBrZXksIHNyY1trZXldLCBzYWZlKTtcbiAgcmV0dXJuIHRhcmdldDtcbn07XG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Iiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///44\n")},function(module,exports,__webpack_require__){eval("// fallback for non-array-like ES3 and non-enumerable old V8 strings\nvar cof = __webpack_require__(24);\n// eslint-disable-next-line no-prototype-builtins\nmodule.exports = Object('z').propertyIsEnumerable(0) ? Object : function (it) {\n  return cof(it) == 'String' ? it.split('') : Object(it);\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNDUuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9bbmFtZV0vLi9ub2RlX21vZHVsZXMvY29yZS1qcy9tb2R1bGVzL19pb2JqZWN0LmpzPzYyNmEiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gZmFsbGJhY2sgZm9yIG5vbi1hcnJheS1saWtlIEVTMyBhbmQgbm9uLWVudW1lcmFibGUgb2xkIFY4IHN0cmluZ3NcbnZhciBjb2YgPSByZXF1aXJlKCcuL19jb2YnKTtcbi8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1wcm90b3R5cGUtYnVpbHRpbnNcbm1vZHVsZS5leHBvcnRzID0gT2JqZWN0KCd6JykucHJvcGVydHlJc0VudW1lcmFibGUoMCkgPyBPYmplY3QgOiBmdW5jdGlvbiAoaXQpIHtcbiAgcmV0dXJuIGNvZihpdCkgPT0gJ1N0cmluZycgPyBpdC5zcGxpdCgnJykgOiBPYmplY3QoaXQpO1xufTtcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///45\n")},function(module,exports){eval("exports.f = {}.propertyIsEnumerable;\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNDYuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9bbmFtZV0vLi9ub2RlX21vZHVsZXMvY29yZS1qcy9tb2R1bGVzL19vYmplY3QtcGllLmpzPzUyYTciXSwic291cmNlc0NvbnRlbnQiOlsiZXhwb3J0cy5mID0ge30ucHJvcGVydHlJc0VudW1lcmFibGU7XG4iXSwibWFwcGluZ3MiOiJBQUFBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///46\n")},function(module,exports,__webpack_require__){eval("// getting tag from 19.1.3.6 Object.prototype.toString()\nvar cof = __webpack_require__(24);\nvar TAG = __webpack_require__(6)('toStringTag');\n// ES3 wrong here\nvar ARG = cof(function () { return arguments; }()) == 'Arguments';\n\n// fallback for IE11 Script Access Denied error\nvar tryGet = function (it, key) {\n  try {\n    return it[key];\n  } catch (e) { /* empty */ }\n};\n\nmodule.exports = function (it) {\n  var O, T, B;\n  return it === undefined ? 'Undefined' : it === null ? 'Null'\n    // @@toStringTag case\n    : typeof (T = tryGet(O = Object(it), TAG)) == 'string' ? T\n    // builtinTag case\n    : ARG ? cof(O)\n    // ES3 arguments fallback\n    : (B = cof(O)) == 'Object' && typeof O.callee == 'function' ? 'Arguments' : B;\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNDcuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9bbmFtZV0vLi9ub2RlX21vZHVsZXMvY29yZS1qcy9tb2R1bGVzL19jbGFzc29mLmpzPzIzYzYiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gZ2V0dGluZyB0YWcgZnJvbSAxOS4xLjMuNiBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nKClcbnZhciBjb2YgPSByZXF1aXJlKCcuL19jb2YnKTtcbnZhciBUQUcgPSByZXF1aXJlKCcuL193a3MnKSgndG9TdHJpbmdUYWcnKTtcbi8vIEVTMyB3cm9uZyBoZXJlXG52YXIgQVJHID0gY29mKGZ1bmN0aW9uICgpIHsgcmV0dXJuIGFyZ3VtZW50czsgfSgpKSA9PSAnQXJndW1lbnRzJztcblxuLy8gZmFsbGJhY2sgZm9yIElFMTEgU2NyaXB0IEFjY2VzcyBEZW5pZWQgZXJyb3JcbnZhciB0cnlHZXQgPSBmdW5jdGlvbiAoaXQsIGtleSkge1xuICB0cnkge1xuICAgIHJldHVybiBpdFtrZXldO1xuICB9IGNhdGNoIChlKSB7IC8qIGVtcHR5ICovIH1cbn07XG5cbm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKGl0KSB7XG4gIHZhciBPLCBULCBCO1xuICByZXR1cm4gaXQgPT09IHVuZGVmaW5lZCA/ICdVbmRlZmluZWQnIDogaXQgPT09IG51bGwgPyAnTnVsbCdcbiAgICAvLyBAQHRvU3RyaW5nVGFnIGNhc2VcbiAgICA6IHR5cGVvZiAoVCA9IHRyeUdldChPID0gT2JqZWN0KGl0KSwgVEFHKSkgPT0gJ3N0cmluZycgPyBUXG4gICAgLy8gYnVpbHRpblRhZyBjYXNlXG4gICAgOiBBUkcgPyBjb2YoTylcbiAgICAvLyBFUzMgYXJndW1lbnRzIGZhbGxiYWNrXG4gICAgOiAoQiA9IGNvZihPKSkgPT0gJ09iamVjdCcgJiYgdHlwZW9mIE8uY2FsbGVlID09ICdmdW5jdGlvbicgPyAnQXJndW1lbnRzJyA6IEI7XG59O1xuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///47\n")},function(module,exports,__webpack_require__){eval("// 7.3.20 SpeciesConstructor(O, defaultConstructor)\nvar anObject = __webpack_require__(4);\nvar aFunction = __webpack_require__(19);\nvar SPECIES = __webpack_require__(6)('species');\nmodule.exports = function (O, D) {\n  var C = anObject(O).constructor;\n  var S;\n  return C === undefined || (S = anObject(C)[SPECIES]) == undefined ? D : aFunction(S);\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNDguanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9bbmFtZV0vLi9ub2RlX21vZHVsZXMvY29yZS1qcy9tb2R1bGVzL19zcGVjaWVzLWNvbnN0cnVjdG9yLmpzP2ViZDYiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gNy4zLjIwIFNwZWNpZXNDb25zdHJ1Y3RvcihPLCBkZWZhdWx0Q29uc3RydWN0b3IpXG52YXIgYW5PYmplY3QgPSByZXF1aXJlKCcuL19hbi1vYmplY3QnKTtcbnZhciBhRnVuY3Rpb24gPSByZXF1aXJlKCcuL19hLWZ1bmN0aW9uJyk7XG52YXIgU1BFQ0lFUyA9IHJlcXVpcmUoJy4vX3drcycpKCdzcGVjaWVzJyk7XG5tb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChPLCBEKSB7XG4gIHZhciBDID0gYW5PYmplY3QoTykuY29uc3RydWN0b3I7XG4gIHZhciBTO1xuICByZXR1cm4gQyA9PT0gdW5kZWZpbmVkIHx8IChTID0gYW5PYmplY3QoQylbU1BFQ0lFU10pID09IHVuZGVmaW5lZCA/IEQgOiBhRnVuY3Rpb24oUyk7XG59O1xuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Iiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///48\n")},function(module,exports,__webpack_require__){eval("var core = __webpack_require__(8);\nvar global = __webpack_require__(2);\nvar SHARED = '__core-js_shared__';\nvar store = global[SHARED] || (global[SHARED] = {});\n\n(module.exports = function (key, value) {\n  return store[key] || (store[key] = value !== undefined ? value : {});\n})('versions', []).push({\n  version: core.version,\n  mode: __webpack_require__(31) ? 'pure' : 'global',\n  copyright: '© 2019 Denis Pushkarev (zloirock.ru)'\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNDkuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9bbmFtZV0vLi9ub2RlX21vZHVsZXMvY29yZS1qcy9tb2R1bGVzL19zaGFyZWQuanM/NTUzNyJdLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgY29yZSA9IHJlcXVpcmUoJy4vX2NvcmUnKTtcbnZhciBnbG9iYWwgPSByZXF1aXJlKCcuL19nbG9iYWwnKTtcbnZhciBTSEFSRUQgPSAnX19jb3JlLWpzX3NoYXJlZF9fJztcbnZhciBzdG9yZSA9IGdsb2JhbFtTSEFSRURdIHx8IChnbG9iYWxbU0hBUkVEXSA9IHt9KTtcblxuKG1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKGtleSwgdmFsdWUpIHtcbiAgcmV0dXJuIHN0b3JlW2tleV0gfHwgKHN0b3JlW2tleV0gPSB2YWx1ZSAhPT0gdW5kZWZpbmVkID8gdmFsdWUgOiB7fSk7XG59KSgndmVyc2lvbnMnLCBbXSkucHVzaCh7XG4gIHZlcnNpb246IGNvcmUudmVyc2lvbixcbiAgbW9kZTogcmVxdWlyZSgnLi9fbGlicmFyeScpID8gJ3B1cmUnIDogJ2dsb2JhbCcsXG4gIGNvcHlyaWdodDogJ8KpIDIwMTkgRGVuaXMgUHVzaGthcmV2ICh6bG9pcm9jay5ydSknXG59KTtcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///49\n")},function(module,exports,__webpack_require__){eval("// false -> Array#indexOf\n// true  -> Array#includes\nvar toIObject = __webpack_require__(16);\nvar toLength = __webpack_require__(7);\nvar toAbsoluteIndex = __webpack_require__(33);\nmodule.exports = function (IS_INCLUDES) {\n  return function ($this, el, fromIndex) {\n    var O = toIObject($this);\n    var length = toLength(O.length);\n    var index = toAbsoluteIndex(fromIndex, length);\n    var value;\n    // Array#includes uses SameValueZero equality algorithm\n    // eslint-disable-next-line no-self-compare\n    if (IS_INCLUDES && el != el) while (length > index) {\n      value = O[index++];\n      // eslint-disable-next-line no-self-compare\n      if (value != value) return true;\n    // Array#indexOf ignores holes, Array#includes - not\n    } else for (;length > index; index++) if (IS_INCLUDES || index in O) {\n      if (O[index] === el) return IS_INCLUDES || index || 0;\n    } return !IS_INCLUDES && -1;\n  };\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNTAuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9bbmFtZV0vLi9ub2RlX21vZHVsZXMvY29yZS1qcy9tb2R1bGVzL19hcnJheS1pbmNsdWRlcy5qcz9jMzY2Il0sInNvdXJjZXNDb250ZW50IjpbIi8vIGZhbHNlIC0+IEFycmF5I2luZGV4T2Zcbi8vIHRydWUgIC0+IEFycmF5I2luY2x1ZGVzXG52YXIgdG9JT2JqZWN0ID0gcmVxdWlyZSgnLi9fdG8taW9iamVjdCcpO1xudmFyIHRvTGVuZ3RoID0gcmVxdWlyZSgnLi9fdG8tbGVuZ3RoJyk7XG52YXIgdG9BYnNvbHV0ZUluZGV4ID0gcmVxdWlyZSgnLi9fdG8tYWJzb2x1dGUtaW5kZXgnKTtcbm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKElTX0lOQ0xVREVTKSB7XG4gIHJldHVybiBmdW5jdGlvbiAoJHRoaXMsIGVsLCBmcm9tSW5kZXgpIHtcbiAgICB2YXIgTyA9IHRvSU9iamVjdCgkdGhpcyk7XG4gICAgdmFyIGxlbmd0aCA9IHRvTGVuZ3RoKE8ubGVuZ3RoKTtcbiAgICB2YXIgaW5kZXggPSB0b0Fic29sdXRlSW5kZXgoZnJvbUluZGV4LCBsZW5ndGgpO1xuICAgIHZhciB2YWx1ZTtcbiAgICAvLyBBcnJheSNpbmNsdWRlcyB1c2VzIFNhbWVWYWx1ZVplcm8gZXF1YWxpdHkgYWxnb3JpdGhtXG4gICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLXNlbGYtY29tcGFyZVxuICAgIGlmIChJU19JTkNMVURFUyAmJiBlbCAhPSBlbCkgd2hpbGUgKGxlbmd0aCA+IGluZGV4KSB7XG4gICAgICB2YWx1ZSA9IE9baW5kZXgrK107XG4gICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tc2VsZi1jb21wYXJlXG4gICAgICBpZiAodmFsdWUgIT0gdmFsdWUpIHJldHVybiB0cnVlO1xuICAgIC8vIEFycmF5I2luZGV4T2YgaWdub3JlcyBob2xlcywgQXJyYXkjaW5jbHVkZXMgLSBub3RcbiAgICB9IGVsc2UgZm9yICg7bGVuZ3RoID4gaW5kZXg7IGluZGV4KyspIGlmIChJU19JTkNMVURFUyB8fCBpbmRleCBpbiBPKSB7XG4gICAgICBpZiAoT1tpbmRleF0gPT09IGVsKSByZXR1cm4gSVNfSU5DTFVERVMgfHwgaW5kZXggfHwgMDtcbiAgICB9IHJldHVybiAhSVNfSU5DTFVERVMgJiYgLTE7XG4gIH07XG59O1xuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///50\n")},function(module,exports){eval("exports.f = Object.getOwnPropertySymbols;\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNTEuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9bbmFtZV0vLi9ub2RlX21vZHVsZXMvY29yZS1qcy9tb2R1bGVzL19vYmplY3QtZ29wcy5qcz8yNjIxIl0sInNvdXJjZXNDb250ZW50IjpbImV4cG9ydHMuZiA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHM7XG4iXSwibWFwcGluZ3MiOiJBQUFBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///51\n")},function(module,exports,__webpack_require__){eval("// 7.2.2 IsArray(argument)\nvar cof = __webpack_require__(24);\nmodule.exports = Array.isArray || function isArray(arg) {\n  return cof(arg) == 'Array';\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNTIuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9bbmFtZV0vLi9ub2RlX21vZHVsZXMvY29yZS1qcy9tb2R1bGVzL19pcy1hcnJheS5qcz8xMTY5Il0sInNvdXJjZXNDb250ZW50IjpbIi8vIDcuMi4yIElzQXJyYXkoYXJndW1lbnQpXG52YXIgY29mID0gcmVxdWlyZSgnLi9fY29mJyk7XG5tb2R1bGUuZXhwb3J0cyA9IEFycmF5LmlzQXJyYXkgfHwgZnVuY3Rpb24gaXNBcnJheShhcmcpIHtcbiAgcmV0dXJuIGNvZihhcmcpID09ICdBcnJheSc7XG59O1xuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///52\n")},function(module,exports,__webpack_require__){eval("var ITERATOR = __webpack_require__(6)('iterator');\nvar SAFE_CLOSING = false;\n\ntry {\n  var riter = [7][ITERATOR]();\n  riter['return'] = function () { SAFE_CLOSING = true; };\n  // eslint-disable-next-line no-throw-literal\n  Array.from(riter, function () { throw 2; });\n} catch (e) { /* empty */ }\n\nmodule.exports = function (exec, skipClosing) {\n  if (!skipClosing && !SAFE_CLOSING) return false;\n  var safe = false;\n  try {\n    var arr = [7];\n    var iter = arr[ITERATOR]();\n    iter.next = function () { return { done: safe = true }; };\n    arr[ITERATOR] = function () { return iter; };\n    exec(arr);\n  } catch (e) { /* empty */ }\n  return safe;\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNTMuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9bbmFtZV0vLi9ub2RlX21vZHVsZXMvY29yZS1qcy9tb2R1bGVzL19pdGVyLWRldGVjdC5qcz81Y2M1Il0sInNvdXJjZXNDb250ZW50IjpbInZhciBJVEVSQVRPUiA9IHJlcXVpcmUoJy4vX3drcycpKCdpdGVyYXRvcicpO1xudmFyIFNBRkVfQ0xPU0lORyA9IGZhbHNlO1xuXG50cnkge1xuICB2YXIgcml0ZXIgPSBbN11bSVRFUkFUT1JdKCk7XG4gIHJpdGVyWydyZXR1cm4nXSA9IGZ1bmN0aW9uICgpIHsgU0FGRV9DTE9TSU5HID0gdHJ1ZTsgfTtcbiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLXRocm93LWxpdGVyYWxcbiAgQXJyYXkuZnJvbShyaXRlciwgZnVuY3Rpb24gKCkgeyB0aHJvdyAyOyB9KTtcbn0gY2F0Y2ggKGUpIHsgLyogZW1wdHkgKi8gfVxuXG5tb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChleGVjLCBza2lwQ2xvc2luZykge1xuICBpZiAoIXNraXBDbG9zaW5nICYmICFTQUZFX0NMT1NJTkcpIHJldHVybiBmYWxzZTtcbiAgdmFyIHNhZmUgPSBmYWxzZTtcbiAgdHJ5IHtcbiAgICB2YXIgYXJyID0gWzddO1xuICAgIHZhciBpdGVyID0gYXJyW0lURVJBVE9SXSgpO1xuICAgIGl0ZXIubmV4dCA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHsgZG9uZTogc2FmZSA9IHRydWUgfTsgfTtcbiAgICBhcnJbSVRFUkFUT1JdID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gaXRlcjsgfTtcbiAgICBleGVjKGFycik7XG4gIH0gY2F0Y2ggKGUpIHsgLyogZW1wdHkgKi8gfVxuICByZXR1cm4gc2FmZTtcbn07XG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///53\n")},function(module,exports,__webpack_require__){"use strict";eval("\n// 21.2.5.3 get RegExp.prototype.flags\nvar anObject = __webpack_require__(4);\nmodule.exports = function () {\n  var that = anObject(this);\n  var result = '';\n  if (that.global) result += 'g';\n  if (that.ignoreCase) result += 'i';\n  if (that.multiline) result += 'm';\n  if (that.unicode) result += 'u';\n  if (that.sticky) result += 'y';\n  return result;\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNTQuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9bbmFtZV0vLi9ub2RlX21vZHVsZXMvY29yZS1qcy9tb2R1bGVzL19mbGFncy5qcz8wYmZiIl0sInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0Jztcbi8vIDIxLjIuNS4zIGdldCBSZWdFeHAucHJvdG90eXBlLmZsYWdzXG52YXIgYW5PYmplY3QgPSByZXF1aXJlKCcuL19hbi1vYmplY3QnKTtcbm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKCkge1xuICB2YXIgdGhhdCA9IGFuT2JqZWN0KHRoaXMpO1xuICB2YXIgcmVzdWx0ID0gJyc7XG4gIGlmICh0aGF0Lmdsb2JhbCkgcmVzdWx0ICs9ICdnJztcbiAgaWYgKHRoYXQuaWdub3JlQ2FzZSkgcmVzdWx0ICs9ICdpJztcbiAgaWYgKHRoYXQubXVsdGlsaW5lKSByZXN1bHQgKz0gJ20nO1xuICBpZiAodGhhdC51bmljb2RlKSByZXN1bHQgKz0gJ3UnO1xuICBpZiAodGhhdC5zdGlja3kpIHJlc3VsdCArPSAneSc7XG4gIHJldHVybiByZXN1bHQ7XG59O1xuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///54\n")},function(module,exports,__webpack_require__){"use strict";eval("\n\nvar classof = __webpack_require__(47);\nvar builtinExec = RegExp.prototype.exec;\n\n // `RegExpExec` abstract operation\n// https://tc39.github.io/ecma262/#sec-regexpexec\nmodule.exports = function (R, S) {\n  var exec = R.exec;\n  if (typeof exec === 'function') {\n    var result = exec.call(R, S);\n    if (typeof result !== 'object') {\n      throw new TypeError('RegExp exec method returned something other than an Object or null');\n    }\n    return result;\n  }\n  if (classof(R) !== 'RegExp') {\n    throw new TypeError('RegExp#exec called on incompatible receiver');\n  }\n  return builtinExec.call(R, S);\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNTUuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9bbmFtZV0vLi9ub2RlX21vZHVsZXMvY29yZS1qcy9tb2R1bGVzL19yZWdleHAtZXhlYy1hYnN0cmFjdC5qcz81ZjFiIl0sInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcblxudmFyIGNsYXNzb2YgPSByZXF1aXJlKCcuL19jbGFzc29mJyk7XG52YXIgYnVpbHRpbkV4ZWMgPSBSZWdFeHAucHJvdG90eXBlLmV4ZWM7XG5cbiAvLyBgUmVnRXhwRXhlY2AgYWJzdHJhY3Qgb3BlcmF0aW9uXG4vLyBodHRwczovL3RjMzkuZ2l0aHViLmlvL2VjbWEyNjIvI3NlYy1yZWdleHBleGVjXG5tb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChSLCBTKSB7XG4gIHZhciBleGVjID0gUi5leGVjO1xuICBpZiAodHlwZW9mIGV4ZWMgPT09ICdmdW5jdGlvbicpIHtcbiAgICB2YXIgcmVzdWx0ID0gZXhlYy5jYWxsKFIsIFMpO1xuICAgIGlmICh0eXBlb2YgcmVzdWx0ICE9PSAnb2JqZWN0Jykge1xuICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcignUmVnRXhwIGV4ZWMgbWV0aG9kIHJldHVybmVkIHNvbWV0aGluZyBvdGhlciB0aGFuIGFuIE9iamVjdCBvciBudWxsJyk7XG4gICAgfVxuICAgIHJldHVybiByZXN1bHQ7XG4gIH1cbiAgaWYgKGNsYXNzb2YoUikgIT09ICdSZWdFeHAnKSB7XG4gICAgdGhyb3cgbmV3IFR5cGVFcnJvcignUmVnRXhwI2V4ZWMgY2FsbGVkIG9uIGluY29tcGF0aWJsZSByZWNlaXZlcicpO1xuICB9XG4gIHJldHVybiBidWlsdGluRXhlYy5jYWxsKFIsIFMpO1xufTtcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///55\n")},function(module,exports,__webpack_require__){"use strict";eval("\n__webpack_require__(111);\nvar redefine = __webpack_require__(12);\nvar hide = __webpack_require__(15);\nvar fails = __webpack_require__(3);\nvar defined = __webpack_require__(25);\nvar wks = __webpack_require__(6);\nvar regexpExec = __webpack_require__(82);\n\nvar SPECIES = wks('species');\n\nvar REPLACE_SUPPORTS_NAMED_GROUPS = !fails(function () {\n  // #replace needs built-in support for named groups.\n  // #match works fine because it just return the exec results, even if it has\n  // a \"grops\" property.\n  var re = /./;\n  re.exec = function () {\n    var result = [];\n    result.groups = { a: '7' };\n    return result;\n  };\n  return ''.replace(re, '$<a>') !== '7';\n});\n\nvar SPLIT_WORKS_WITH_OVERWRITTEN_EXEC = (function () {\n  // Chrome 51 has a buggy \"split\" implementation when RegExp#exec !== nativeExec\n  var re = /(?:)/;\n  var originalExec = re.exec;\n  re.exec = function () { return originalExec.apply(this, arguments); };\n  var result = 'ab'.split(re);\n  return result.length === 2 && result[0] === 'a' && result[1] === 'b';\n})();\n\nmodule.exports = function (KEY, length, exec) {\n  var SYMBOL = wks(KEY);\n\n  var DELEGATES_TO_SYMBOL = !fails(function () {\n    // String methods call symbol-named RegEp methods\n    var O = {};\n    O[SYMBOL] = function () { return 7; };\n    return ''[KEY](O) != 7;\n  });\n\n  var DELEGATES_TO_EXEC = DELEGATES_TO_SYMBOL ? !fails(function () {\n    // Symbol-named RegExp methods call .exec\n    var execCalled = false;\n    var re = /a/;\n    re.exec = function () { execCalled = true; return null; };\n    if (KEY === 'split') {\n      // RegExp[@@split] doesn't call the regex's exec method, but first creates\n      // a new one. We need to return the patched regex when creating the new one.\n      re.constructor = {};\n      re.constructor[SPECIES] = function () { return re; };\n    }\n    re[SYMBOL]('');\n    return !execCalled;\n  }) : undefined;\n\n  if (\n    !DELEGATES_TO_SYMBOL ||\n    !DELEGATES_TO_EXEC ||\n    (KEY === 'replace' && !REPLACE_SUPPORTS_NAMED_GROUPS) ||\n    (KEY === 'split' && !SPLIT_WORKS_WITH_OVERWRITTEN_EXEC)\n  ) {\n    var nativeRegExpMethod = /./[SYMBOL];\n    var fns = exec(\n      defined,\n      SYMBOL,\n      ''[KEY],\n      function maybeCallNative(nativeMethod, regexp, str, arg2, forceStringMethod) {\n        if (regexp.exec === regexpExec) {\n          if (DELEGATES_TO_SYMBOL && !forceStringMethod) {\n            // The native String method already delegates to @@method (this\n            // polyfilled function), leasing to infinite recursion.\n            // We avoid it by directly calling the native @@method method.\n            return { done: true, value: nativeRegExpMethod.call(regexp, str, arg2) };\n          }\n          return { done: true, value: nativeMethod.call(str, regexp, arg2) };\n        }\n        return { done: false };\n      }\n    );\n    var strfn = fns[0];\n    var rxfn = fns[1];\n\n    redefine(String.prototype, KEY, strfn);\n    hide(RegExp.prototype, SYMBOL, length == 2\n      // 21.2.5.8 RegExp.prototype[@@replace](string, replaceValue)\n      // 21.2.5.11 RegExp.prototype[@@split](string, limit)\n      ? function (string, arg) { return rxfn.call(string, this, arg); }\n      // 21.2.5.6 RegExp.prototype[@@match](string)\n      // 21.2.5.9 RegExp.prototype[@@search](string)\n      : function (string) { return rxfn.call(string, this); }\n    );\n  }\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNTYuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9bbmFtZV0vLi9ub2RlX21vZHVsZXMvY29yZS1qcy9tb2R1bGVzL19maXgtcmUtd2tzLmpzPzIxNGYiXSwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xucmVxdWlyZSgnLi9lczYucmVnZXhwLmV4ZWMnKTtcbnZhciByZWRlZmluZSA9IHJlcXVpcmUoJy4vX3JlZGVmaW5lJyk7XG52YXIgaGlkZSA9IHJlcXVpcmUoJy4vX2hpZGUnKTtcbnZhciBmYWlscyA9IHJlcXVpcmUoJy4vX2ZhaWxzJyk7XG52YXIgZGVmaW5lZCA9IHJlcXVpcmUoJy4vX2RlZmluZWQnKTtcbnZhciB3a3MgPSByZXF1aXJlKCcuL193a3MnKTtcbnZhciByZWdleHBFeGVjID0gcmVxdWlyZSgnLi9fcmVnZXhwLWV4ZWMnKTtcblxudmFyIFNQRUNJRVMgPSB3a3MoJ3NwZWNpZXMnKTtcblxudmFyIFJFUExBQ0VfU1VQUE9SVFNfTkFNRURfR1JPVVBTID0gIWZhaWxzKGZ1bmN0aW9uICgpIHtcbiAgLy8gI3JlcGxhY2UgbmVlZHMgYnVpbHQtaW4gc3VwcG9ydCBmb3IgbmFtZWQgZ3JvdXBzLlxuICAvLyAjbWF0Y2ggd29ya3MgZmluZSBiZWNhdXNlIGl0IGp1c3QgcmV0dXJuIHRoZSBleGVjIHJlc3VsdHMsIGV2ZW4gaWYgaXQgaGFzXG4gIC8vIGEgXCJncm9wc1wiIHByb3BlcnR5LlxuICB2YXIgcmUgPSAvLi87XG4gIHJlLmV4ZWMgPSBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIHJlc3VsdCA9IFtdO1xuICAgIHJlc3VsdC5ncm91cHMgPSB7IGE6ICc3JyB9O1xuICAgIHJldHVybiByZXN1bHQ7XG4gIH07XG4gIHJldHVybiAnJy5yZXBsYWNlKHJlLCAnJDxhPicpICE9PSAnNyc7XG59KTtcblxudmFyIFNQTElUX1dPUktTX1dJVEhfT1ZFUldSSVRURU5fRVhFQyA9IChmdW5jdGlvbiAoKSB7XG4gIC8vIENocm9tZSA1MSBoYXMgYSBidWdneSBcInNwbGl0XCIgaW1wbGVtZW50YXRpb24gd2hlbiBSZWdFeHAjZXhlYyAhPT0gbmF0aXZlRXhlY1xuICB2YXIgcmUgPSAvKD86KS87XG4gIHZhciBvcmlnaW5hbEV4ZWMgPSByZS5leGVjO1xuICByZS5leGVjID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gb3JpZ2luYWxFeGVjLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7IH07XG4gIHZhciByZXN1bHQgPSAnYWInLnNwbGl0KHJlKTtcbiAgcmV0dXJuIHJlc3VsdC5sZW5ndGggPT09IDIgJiYgcmVzdWx0WzBdID09PSAnYScgJiYgcmVzdWx0WzFdID09PSAnYic7XG59KSgpO1xuXG5tb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChLRVksIGxlbmd0aCwgZXhlYykge1xuICB2YXIgU1lNQk9MID0gd2tzKEtFWSk7XG5cbiAgdmFyIERFTEVHQVRFU19UT19TWU1CT0wgPSAhZmFpbHMoZnVuY3Rpb24gKCkge1xuICAgIC8vIFN0cmluZyBtZXRob2RzIGNhbGwgc3ltYm9sLW5hbWVkIFJlZ0VwIG1ldGhvZHNcbiAgICB2YXIgTyA9IHt9O1xuICAgIE9bU1lNQk9MXSA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIDc7IH07XG4gICAgcmV0dXJuICcnW0tFWV0oTykgIT0gNztcbiAgfSk7XG5cbiAgdmFyIERFTEVHQVRFU19UT19FWEVDID0gREVMRUdBVEVTX1RPX1NZTUJPTCA/ICFmYWlscyhmdW5jdGlvbiAoKSB7XG4gICAgLy8gU3ltYm9sLW5hbWVkIFJlZ0V4cCBtZXRob2RzIGNhbGwgLmV4ZWNcbiAgICB2YXIgZXhlY0NhbGxlZCA9IGZhbHNlO1xuICAgIHZhciByZSA9IC9hLztcbiAgICByZS5leGVjID0gZnVuY3Rpb24gKCkgeyBleGVjQ2FsbGVkID0gdHJ1ZTsgcmV0dXJuIG51bGw7IH07XG4gICAgaWYgKEtFWSA9PT0gJ3NwbGl0Jykge1xuICAgICAgLy8gUmVnRXhwW0BAc3BsaXRdIGRvZXNuJ3QgY2FsbCB0aGUgcmVnZXgncyBleGVjIG1ldGhvZCwgYnV0IGZpcnN0IGNyZWF0ZXNcbiAgICAgIC8vIGEgbmV3IG9uZS4gV2UgbmVlZCB0byByZXR1cm4gdGhlIHBhdGNoZWQgcmVnZXggd2hlbiBjcmVhdGluZyB0aGUgbmV3IG9uZS5cbiAgICAgIHJlLmNvbnN0cnVjdG9yID0ge307XG4gICAgICByZS5jb25zdHJ1Y3RvcltTUEVDSUVTXSA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHJlOyB9O1xuICAgIH1cbiAgICByZVtTWU1CT0xdKCcnKTtcbiAgICByZXR1cm4gIWV4ZWNDYWxsZWQ7XG4gIH0pIDogdW5kZWZpbmVkO1xuXG4gIGlmIChcbiAgICAhREVMRUdBVEVTX1RPX1NZTUJPTCB8fFxuICAgICFERUxFR0FURVNfVE9fRVhFQyB8fFxuICAgIChLRVkgPT09ICdyZXBsYWNlJyAmJiAhUkVQTEFDRV9TVVBQT1JUU19OQU1FRF9HUk9VUFMpIHx8XG4gICAgKEtFWSA9PT0gJ3NwbGl0JyAmJiAhU1BMSVRfV09SS1NfV0lUSF9PVkVSV1JJVFRFTl9FWEVDKVxuICApIHtcbiAgICB2YXIgbmF0aXZlUmVnRXhwTWV0aG9kID0gLy4vW1NZTUJPTF07XG4gICAgdmFyIGZucyA9IGV4ZWMoXG4gICAgICBkZWZpbmVkLFxuICAgICAgU1lNQk9MLFxuICAgICAgJydbS0VZXSxcbiAgICAgIGZ1bmN0aW9uIG1heWJlQ2FsbE5hdGl2ZShuYXRpdmVNZXRob2QsIHJlZ2V4cCwgc3RyLCBhcmcyLCBmb3JjZVN0cmluZ01ldGhvZCkge1xuICAgICAgICBpZiAocmVnZXhwLmV4ZWMgPT09IHJlZ2V4cEV4ZWMpIHtcbiAgICAgICAgICBpZiAoREVMRUdBVEVTX1RPX1NZTUJPTCAmJiAhZm9yY2VTdHJpbmdNZXRob2QpIHtcbiAgICAgICAgICAgIC8vIFRoZSBuYXRpdmUgU3RyaW5nIG1ldGhvZCBhbHJlYWR5IGRlbGVnYXRlcyB0byBAQG1ldGhvZCAodGhpc1xuICAgICAgICAgICAgLy8gcG9seWZpbGxlZCBmdW5jdGlvbiksIGxlYXNpbmcgdG8gaW5maW5pdGUgcmVjdXJzaW9uLlxuICAgICAgICAgICAgLy8gV2UgYXZvaWQgaXQgYnkgZGlyZWN0bHkgY2FsbGluZyB0aGUgbmF0aXZlIEBAbWV0aG9kIG1ldGhvZC5cbiAgICAgICAgICAgIHJldHVybiB7IGRvbmU6IHRydWUsIHZhbHVlOiBuYXRpdmVSZWdFeHBNZXRob2QuY2FsbChyZWdleHAsIHN0ciwgYXJnMikgfTtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIHsgZG9uZTogdHJ1ZSwgdmFsdWU6IG5hdGl2ZU1ldGhvZC5jYWxsKHN0ciwgcmVnZXhwLCBhcmcyKSB9O1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB7IGRvbmU6IGZhbHNlIH07XG4gICAgICB9XG4gICAgKTtcbiAgICB2YXIgc3RyZm4gPSBmbnNbMF07XG4gICAgdmFyIHJ4Zm4gPSBmbnNbMV07XG5cbiAgICByZWRlZmluZShTdHJpbmcucHJvdG90eXBlLCBLRVksIHN0cmZuKTtcbiAgICBoaWRlKFJlZ0V4cC5wcm90b3R5cGUsIFNZTUJPTCwgbGVuZ3RoID09IDJcbiAgICAgIC8vIDIxLjIuNS44IFJlZ0V4cC5wcm90b3R5cGVbQEByZXBsYWNlXShzdHJpbmcsIHJlcGxhY2VWYWx1ZSlcbiAgICAgIC8vIDIxLjIuNS4xMSBSZWdFeHAucHJvdG90eXBlW0BAc3BsaXRdKHN0cmluZywgbGltaXQpXG4gICAgICA/IGZ1bmN0aW9uIChzdHJpbmcsIGFyZykgeyByZXR1cm4gcnhmbi5jYWxsKHN0cmluZywgdGhpcywgYXJnKTsgfVxuICAgICAgLy8gMjEuMi41LjYgUmVnRXhwLnByb3RvdHlwZVtAQG1hdGNoXShzdHJpbmcpXG4gICAgICAvLyAyMS4yLjUuOSBSZWdFeHAucHJvdG90eXBlW0BAc2VhcmNoXShzdHJpbmcpXG4gICAgICA6IGZ1bmN0aW9uIChzdHJpbmcpIHsgcmV0dXJuIHJ4Zm4uY2FsbChzdHJpbmcsIHRoaXMpOyB9XG4gICAgKTtcbiAgfVxufTtcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///56\n")},function(module,exports,__webpack_require__){eval("var ctx = __webpack_require__(18);\nvar call = __webpack_require__(106);\nvar isArrayIter = __webpack_require__(77);\nvar anObject = __webpack_require__(4);\nvar toLength = __webpack_require__(7);\nvar getIterFn = __webpack_require__(79);\nvar BREAK = {};\nvar RETURN = {};\nvar exports = module.exports = function (iterable, entries, fn, that, ITERATOR) {\n  var iterFn = ITERATOR ? function () { return iterable; } : getIterFn(iterable);\n  var f = ctx(fn, that, entries ? 2 : 1);\n  var index = 0;\n  var length, step, iterator, result;\n  if (typeof iterFn != 'function') throw TypeError(iterable + ' is not iterable!');\n  // fast case for arrays with default iterator\n  if (isArrayIter(iterFn)) for (length = toLength(iterable.length); length > index; index++) {\n    result = entries ? f(anObject(step = iterable[index])[0], step[1]) : f(iterable[index]);\n    if (result === BREAK || result === RETURN) return result;\n  } else for (iterator = iterFn.call(iterable); !(step = iterator.next()).done;) {\n    result = call(iterator, f, step.value, entries);\n    if (result === BREAK || result === RETURN) return result;\n  }\n};\nexports.BREAK = BREAK;\nexports.RETURN = RETURN;\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNTcuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9bbmFtZV0vLi9ub2RlX21vZHVsZXMvY29yZS1qcy9tb2R1bGVzL19mb3Itb2YuanM/NGE1OSJdLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgY3R4ID0gcmVxdWlyZSgnLi9fY3R4Jyk7XG52YXIgY2FsbCA9IHJlcXVpcmUoJy4vX2l0ZXItY2FsbCcpO1xudmFyIGlzQXJyYXlJdGVyID0gcmVxdWlyZSgnLi9faXMtYXJyYXktaXRlcicpO1xudmFyIGFuT2JqZWN0ID0gcmVxdWlyZSgnLi9fYW4tb2JqZWN0Jyk7XG52YXIgdG9MZW5ndGggPSByZXF1aXJlKCcuL190by1sZW5ndGgnKTtcbnZhciBnZXRJdGVyRm4gPSByZXF1aXJlKCcuL2NvcmUuZ2V0LWl0ZXJhdG9yLW1ldGhvZCcpO1xudmFyIEJSRUFLID0ge307XG52YXIgUkVUVVJOID0ge307XG52YXIgZXhwb3J0cyA9IG1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKGl0ZXJhYmxlLCBlbnRyaWVzLCBmbiwgdGhhdCwgSVRFUkFUT1IpIHtcbiAgdmFyIGl0ZXJGbiA9IElURVJBVE9SID8gZnVuY3Rpb24gKCkgeyByZXR1cm4gaXRlcmFibGU7IH0gOiBnZXRJdGVyRm4oaXRlcmFibGUpO1xuICB2YXIgZiA9IGN0eChmbiwgdGhhdCwgZW50cmllcyA/IDIgOiAxKTtcbiAgdmFyIGluZGV4ID0gMDtcbiAgdmFyIGxlbmd0aCwgc3RlcCwgaXRlcmF0b3IsIHJlc3VsdDtcbiAgaWYgKHR5cGVvZiBpdGVyRm4gIT0gJ2Z1bmN0aW9uJykgdGhyb3cgVHlwZUVycm9yKGl0ZXJhYmxlICsgJyBpcyBub3QgaXRlcmFibGUhJyk7XG4gIC8vIGZhc3QgY2FzZSBmb3IgYXJyYXlzIHdpdGggZGVmYXVsdCBpdGVyYXRvclxuICBpZiAoaXNBcnJheUl0ZXIoaXRlckZuKSkgZm9yIChsZW5ndGggPSB0b0xlbmd0aChpdGVyYWJsZS5sZW5ndGgpOyBsZW5ndGggPiBpbmRleDsgaW5kZXgrKykge1xuICAgIHJlc3VsdCA9IGVudHJpZXMgPyBmKGFuT2JqZWN0KHN0ZXAgPSBpdGVyYWJsZVtpbmRleF0pWzBdLCBzdGVwWzFdKSA6IGYoaXRlcmFibGVbaW5kZXhdKTtcbiAgICBpZiAocmVzdWx0ID09PSBCUkVBSyB8fCByZXN1bHQgPT09IFJFVFVSTikgcmV0dXJuIHJlc3VsdDtcbiAgfSBlbHNlIGZvciAoaXRlcmF0b3IgPSBpdGVyRm4uY2FsbChpdGVyYWJsZSk7ICEoc3RlcCA9IGl0ZXJhdG9yLm5leHQoKSkuZG9uZTspIHtcbiAgICByZXN1bHQgPSBjYWxsKGl0ZXJhdG9yLCBmLCBzdGVwLnZhbHVlLCBlbnRyaWVzKTtcbiAgICBpZiAocmVzdWx0ID09PSBCUkVBSyB8fCByZXN1bHQgPT09IFJFVFVSTikgcmV0dXJuIHJlc3VsdDtcbiAgfVxufTtcbmV4cG9ydHMuQlJFQUsgPSBCUkVBSztcbmV4cG9ydHMuUkVUVVJOID0gUkVUVVJOO1xuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///57\n")},function(module,exports,__webpack_require__){eval("var global = __webpack_require__(2);\nvar navigator = global.navigator;\n\nmodule.exports = navigator && navigator.userAgent || '';\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNTguanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9bbmFtZV0vLi9ub2RlX21vZHVsZXMvY29yZS1qcy9tb2R1bGVzL191c2VyLWFnZW50LmpzP2EyNWYiXSwic291cmNlc0NvbnRlbnQiOlsidmFyIGdsb2JhbCA9IHJlcXVpcmUoJy4vX2dsb2JhbCcpO1xudmFyIG5hdmlnYXRvciA9IGdsb2JhbC5uYXZpZ2F0b3I7XG5cbm1vZHVsZS5leHBvcnRzID0gbmF2aWdhdG9yICYmIG5hdmlnYXRvci51c2VyQWdlbnQgfHwgJyc7XG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///58\n")},function(module,exports,__webpack_require__){"use strict";eval("\nvar global = __webpack_require__(2);\nvar $export = __webpack_require__(1);\nvar redefine = __webpack_require__(12);\nvar redefineAll = __webpack_require__(44);\nvar meta = __webpack_require__(28);\nvar forOf = __webpack_require__(57);\nvar anInstance = __webpack_require__(43);\nvar isObject = __webpack_require__(5);\nvar fails = __webpack_require__(3);\nvar $iterDetect = __webpack_require__(53);\nvar setToStringTag = __webpack_require__(39);\nvar inheritIfRequired = __webpack_require__(68);\n\nmodule.exports = function (NAME, wrapper, methods, common, IS_MAP, IS_WEAK) {\n  var Base = global[NAME];\n  var C = Base;\n  var ADDER = IS_MAP ? 'set' : 'add';\n  var proto = C && C.prototype;\n  var O = {};\n  var fixMethod = function (KEY) {\n    var fn = proto[KEY];\n    redefine(proto, KEY,\n      KEY == 'delete' ? function (a) {\n        return IS_WEAK && !isObject(a) ? false : fn.call(this, a === 0 ? 0 : a);\n      } : KEY == 'has' ? function has(a) {\n        return IS_WEAK && !isObject(a) ? false : fn.call(this, a === 0 ? 0 : a);\n      } : KEY == 'get' ? function get(a) {\n        return IS_WEAK && !isObject(a) ? undefined : fn.call(this, a === 0 ? 0 : a);\n      } : KEY == 'add' ? function add(a) { fn.call(this, a === 0 ? 0 : a); return this; }\n        : function set(a, b) { fn.call(this, a === 0 ? 0 : a, b); return this; }\n    );\n  };\n  if (typeof C != 'function' || !(IS_WEAK || proto.forEach && !fails(function () {\n    new C().entries().next();\n  }))) {\n    // create collection constructor\n    C = common.getConstructor(wrapper, NAME, IS_MAP, ADDER);\n    redefineAll(C.prototype, methods);\n    meta.NEED = true;\n  } else {\n    var instance = new C();\n    // early implementations not supports chaining\n    var HASNT_CHAINING = instance[ADDER](IS_WEAK ? {} : -0, 1) != instance;\n    // V8 ~  Chromium 40- weak-collections throws on primitives, but should return false\n    var THROWS_ON_PRIMITIVES = fails(function () { instance.has(1); });\n    // most early implementations doesn't supports iterables, most modern - not close it correctly\n    var ACCEPT_ITERABLES = $iterDetect(function (iter) { new C(iter); }); // eslint-disable-line no-new\n    // for early implementations -0 and +0 not the same\n    var BUGGY_ZERO = !IS_WEAK && fails(function () {\n      // V8 ~ Chromium 42- fails only with 5+ elements\n      var $instance = new C();\n      var index = 5;\n      while (index--) $instance[ADDER](index, index);\n      return !$instance.has(-0);\n    });\n    if (!ACCEPT_ITERABLES) {\n      C = wrapper(function (target, iterable) {\n        anInstance(target, C, NAME);\n        var that = inheritIfRequired(new Base(), target, C);\n        if (iterable != undefined) forOf(iterable, IS_MAP, that[ADDER], that);\n        return that;\n      });\n      C.prototype = proto;\n      proto.constructor = C;\n    }\n    if (THROWS_ON_PRIMITIVES || BUGGY_ZERO) {\n      fixMethod('delete');\n      fixMethod('has');\n      IS_MAP && fixMethod('get');\n    }\n    if (BUGGY_ZERO || HASNT_CHAINING) fixMethod(ADDER);\n    // weak collections should not contains .clear method\n    if (IS_WEAK && proto.clear) delete proto.clear;\n  }\n\n  setToStringTag(C, NAME);\n\n  O[NAME] = C;\n  $export($export.G + $export.W + $export.F * (C != Base), O);\n\n  if (!IS_WEAK) common.setStrong(C, NAME, IS_MAP);\n\n  return C;\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNTkuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9bbmFtZV0vLi9ub2RlX21vZHVsZXMvY29yZS1qcy9tb2R1bGVzL19jb2xsZWN0aW9uLmpzP2UwYjgiXSwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xudmFyIGdsb2JhbCA9IHJlcXVpcmUoJy4vX2dsb2JhbCcpO1xudmFyICRleHBvcnQgPSByZXF1aXJlKCcuL19leHBvcnQnKTtcbnZhciByZWRlZmluZSA9IHJlcXVpcmUoJy4vX3JlZGVmaW5lJyk7XG52YXIgcmVkZWZpbmVBbGwgPSByZXF1aXJlKCcuL19yZWRlZmluZS1hbGwnKTtcbnZhciBtZXRhID0gcmVxdWlyZSgnLi9fbWV0YScpO1xudmFyIGZvck9mID0gcmVxdWlyZSgnLi9fZm9yLW9mJyk7XG52YXIgYW5JbnN0YW5jZSA9IHJlcXVpcmUoJy4vX2FuLWluc3RhbmNlJyk7XG52YXIgaXNPYmplY3QgPSByZXF1aXJlKCcuL19pcy1vYmplY3QnKTtcbnZhciBmYWlscyA9IHJlcXVpcmUoJy4vX2ZhaWxzJyk7XG52YXIgJGl0ZXJEZXRlY3QgPSByZXF1aXJlKCcuL19pdGVyLWRldGVjdCcpO1xudmFyIHNldFRvU3RyaW5nVGFnID0gcmVxdWlyZSgnLi9fc2V0LXRvLXN0cmluZy10YWcnKTtcbnZhciBpbmhlcml0SWZSZXF1aXJlZCA9IHJlcXVpcmUoJy4vX2luaGVyaXQtaWYtcmVxdWlyZWQnKTtcblxubW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoTkFNRSwgd3JhcHBlciwgbWV0aG9kcywgY29tbW9uLCBJU19NQVAsIElTX1dFQUspIHtcbiAgdmFyIEJhc2UgPSBnbG9iYWxbTkFNRV07XG4gIHZhciBDID0gQmFzZTtcbiAgdmFyIEFEREVSID0gSVNfTUFQID8gJ3NldCcgOiAnYWRkJztcbiAgdmFyIHByb3RvID0gQyAmJiBDLnByb3RvdHlwZTtcbiAgdmFyIE8gPSB7fTtcbiAgdmFyIGZpeE1ldGhvZCA9IGZ1bmN0aW9uIChLRVkpIHtcbiAgICB2YXIgZm4gPSBwcm90b1tLRVldO1xuICAgIHJlZGVmaW5lKHByb3RvLCBLRVksXG4gICAgICBLRVkgPT0gJ2RlbGV0ZScgPyBmdW5jdGlvbiAoYSkge1xuICAgICAgICByZXR1cm4gSVNfV0VBSyAmJiAhaXNPYmplY3QoYSkgPyBmYWxzZSA6IGZuLmNhbGwodGhpcywgYSA9PT0gMCA/IDAgOiBhKTtcbiAgICAgIH0gOiBLRVkgPT0gJ2hhcycgPyBmdW5jdGlvbiBoYXMoYSkge1xuICAgICAgICByZXR1cm4gSVNfV0VBSyAmJiAhaXNPYmplY3QoYSkgPyBmYWxzZSA6IGZuLmNhbGwodGhpcywgYSA9PT0gMCA/IDAgOiBhKTtcbiAgICAgIH0gOiBLRVkgPT0gJ2dldCcgPyBmdW5jdGlvbiBnZXQoYSkge1xuICAgICAgICByZXR1cm4gSVNfV0VBSyAmJiAhaXNPYmplY3QoYSkgPyB1bmRlZmluZWQgOiBmbi5jYWxsKHRoaXMsIGEgPT09IDAgPyAwIDogYSk7XG4gICAgICB9IDogS0VZID09ICdhZGQnID8gZnVuY3Rpb24gYWRkKGEpIHsgZm4uY2FsbCh0aGlzLCBhID09PSAwID8gMCA6IGEpOyByZXR1cm4gdGhpczsgfVxuICAgICAgICA6IGZ1bmN0aW9uIHNldChhLCBiKSB7IGZuLmNhbGwodGhpcywgYSA9PT0gMCA/IDAgOiBhLCBiKTsgcmV0dXJuIHRoaXM7IH1cbiAgICApO1xuICB9O1xuICBpZiAodHlwZW9mIEMgIT0gJ2Z1bmN0aW9uJyB8fCAhKElTX1dFQUsgfHwgcHJvdG8uZm9yRWFjaCAmJiAhZmFpbHMoZnVuY3Rpb24gKCkge1xuICAgIG5ldyBDKCkuZW50cmllcygpLm5leHQoKTtcbiAgfSkpKSB7XG4gICAgLy8gY3JlYXRlIGNvbGxlY3Rpb24gY29uc3RydWN0b3JcbiAgICBDID0gY29tbW9uLmdldENvbnN0cnVjdG9yKHdyYXBwZXIsIE5BTUUsIElTX01BUCwgQURERVIpO1xuICAgIHJlZGVmaW5lQWxsKEMucHJvdG90eXBlLCBtZXRob2RzKTtcbiAgICBtZXRhLk5FRUQgPSB0cnVlO1xuICB9IGVsc2Uge1xuICAgIHZhciBpbnN0YW5jZSA9IG5ldyBDKCk7XG4gICAgLy8gZWFybHkgaW1wbGVtZW50YXRpb25zIG5vdCBzdXBwb3J0cyBjaGFpbmluZ1xuICAgIHZhciBIQVNOVF9DSEFJTklORyA9IGluc3RhbmNlW0FEREVSXShJU19XRUFLID8ge30gOiAtMCwgMSkgIT0gaW5zdGFuY2U7XG4gICAgLy8gVjggfiAgQ2hyb21pdW0gNDAtIHdlYWstY29sbGVjdGlvbnMgdGhyb3dzIG9uIHByaW1pdGl2ZXMsIGJ1dCBzaG91bGQgcmV0dXJuIGZhbHNlXG4gICAgdmFyIFRIUk9XU19PTl9QUklNSVRJVkVTID0gZmFpbHMoZnVuY3Rpb24gKCkgeyBpbnN0YW5jZS5oYXMoMSk7IH0pO1xuICAgIC8vIG1vc3QgZWFybHkgaW1wbGVtZW50YXRpb25zIGRvZXNuJ3Qgc3VwcG9ydHMgaXRlcmFibGVzLCBtb3N0IG1vZGVybiAtIG5vdCBjbG9zZSBpdCBjb3JyZWN0bHlcbiAgICB2YXIgQUNDRVBUX0lURVJBQkxFUyA9ICRpdGVyRGV0ZWN0KGZ1bmN0aW9uIChpdGVyKSB7IG5ldyBDKGl0ZXIpOyB9KTsgLy8gZXNsaW50LWRpc2FibGUtbGluZSBuby1uZXdcbiAgICAvLyBmb3IgZWFybHkgaW1wbGVtZW50YXRpb25zIC0wIGFuZCArMCBub3QgdGhlIHNhbWVcbiAgICB2YXIgQlVHR1lfWkVSTyA9ICFJU19XRUFLICYmIGZhaWxzKGZ1bmN0aW9uICgpIHtcbiAgICAgIC8vIFY4IH4gQ2hyb21pdW0gNDItIGZhaWxzIG9ubHkgd2l0aCA1KyBlbGVtZW50c1xuICAgICAgdmFyICRpbnN0YW5jZSA9IG5ldyBDKCk7XG4gICAgICB2YXIgaW5kZXggPSA1O1xuICAgICAgd2hpbGUgKGluZGV4LS0pICRpbnN0YW5jZVtBRERFUl0oaW5kZXgsIGluZGV4KTtcbiAgICAgIHJldHVybiAhJGluc3RhbmNlLmhhcygtMCk7XG4gICAgfSk7XG4gICAgaWYgKCFBQ0NFUFRfSVRFUkFCTEVTKSB7XG4gICAgICBDID0gd3JhcHBlcihmdW5jdGlvbiAodGFyZ2V0LCBpdGVyYWJsZSkge1xuICAgICAgICBhbkluc3RhbmNlKHRhcmdldCwgQywgTkFNRSk7XG4gICAgICAgIHZhciB0aGF0ID0gaW5oZXJpdElmUmVxdWlyZWQobmV3IEJhc2UoKSwgdGFyZ2V0LCBDKTtcbiAgICAgICAgaWYgKGl0ZXJhYmxlICE9IHVuZGVmaW5lZCkgZm9yT2YoaXRlcmFibGUsIElTX01BUCwgdGhhdFtBRERFUl0sIHRoYXQpO1xuICAgICAgICByZXR1cm4gdGhhdDtcbiAgICAgIH0pO1xuICAgICAgQy5wcm90b3R5cGUgPSBwcm90bztcbiAgICAgIHByb3RvLmNvbnN0cnVjdG9yID0gQztcbiAgICB9XG4gICAgaWYgKFRIUk9XU19PTl9QUklNSVRJVkVTIHx8IEJVR0dZX1pFUk8pIHtcbiAgICAgIGZpeE1ldGhvZCgnZGVsZXRlJyk7XG4gICAgICBmaXhNZXRob2QoJ2hhcycpO1xuICAgICAgSVNfTUFQICYmIGZpeE1ldGhvZCgnZ2V0Jyk7XG4gICAgfVxuICAgIGlmIChCVUdHWV9aRVJPIHx8IEhBU05UX0NIQUlOSU5HKSBmaXhNZXRob2QoQURERVIpO1xuICAgIC8vIHdlYWsgY29sbGVjdGlvbnMgc2hvdWxkIG5vdCBjb250YWlucyAuY2xlYXIgbWV0aG9kXG4gICAgaWYgKElTX1dFQUsgJiYgcHJvdG8uY2xlYXIpIGRlbGV0ZSBwcm90by5jbGVhcjtcbiAgfVxuXG4gIHNldFRvU3RyaW5nVGFnKEMsIE5BTUUpO1xuXG4gIE9bTkFNRV0gPSBDO1xuICAkZXhwb3J0KCRleHBvcnQuRyArICRleHBvcnQuVyArICRleHBvcnQuRiAqIChDICE9IEJhc2UpLCBPKTtcblxuICBpZiAoIUlTX1dFQUspIGNvbW1vbi5zZXRTdHJvbmcoQywgTkFNRSwgSVNfTUFQKTtcblxuICByZXR1cm4gQztcbn07XG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///59\n")},function(module,exports,__webpack_require__){eval("var global = __webpack_require__(2);\nvar hide = __webpack_require__(15);\nvar uid = __webpack_require__(30);\nvar TYPED = uid('typed_array');\nvar VIEW = uid('view');\nvar ABV = !!(global.ArrayBuffer && global.DataView);\nvar CONSTR = ABV;\nvar i = 0;\nvar l = 9;\nvar Typed;\n\nvar TypedArrayConstructors = (\n  'Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array'\n).split(',');\n\nwhile (i < l) {\n  if (Typed = global[TypedArrayConstructors[i++]]) {\n    hide(Typed.prototype, TYPED, true);\n    hide(Typed.prototype, VIEW, true);\n  } else CONSTR = false;\n}\n\nmodule.exports = {\n  ABV: ABV,\n  CONSTR: CONSTR,\n  TYPED: TYPED,\n  VIEW: VIEW\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNjAuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9bbmFtZV0vLi9ub2RlX21vZHVsZXMvY29yZS1qcy9tb2R1bGVzL190eXBlZC5qcz8wZjg4Il0sInNvdXJjZXNDb250ZW50IjpbInZhciBnbG9iYWwgPSByZXF1aXJlKCcuL19nbG9iYWwnKTtcbnZhciBoaWRlID0gcmVxdWlyZSgnLi9faGlkZScpO1xudmFyIHVpZCA9IHJlcXVpcmUoJy4vX3VpZCcpO1xudmFyIFRZUEVEID0gdWlkKCd0eXBlZF9hcnJheScpO1xudmFyIFZJRVcgPSB1aWQoJ3ZpZXcnKTtcbnZhciBBQlYgPSAhIShnbG9iYWwuQXJyYXlCdWZmZXIgJiYgZ2xvYmFsLkRhdGFWaWV3KTtcbnZhciBDT05TVFIgPSBBQlY7XG52YXIgaSA9IDA7XG52YXIgbCA9IDk7XG52YXIgVHlwZWQ7XG5cbnZhciBUeXBlZEFycmF5Q29uc3RydWN0b3JzID0gKFxuICAnSW50OEFycmF5LFVpbnQ4QXJyYXksVWludDhDbGFtcGVkQXJyYXksSW50MTZBcnJheSxVaW50MTZBcnJheSxJbnQzMkFycmF5LFVpbnQzMkFycmF5LEZsb2F0MzJBcnJheSxGbG9hdDY0QXJyYXknXG4pLnNwbGl0KCcsJyk7XG5cbndoaWxlIChpIDwgbCkge1xuICBpZiAoVHlwZWQgPSBnbG9iYWxbVHlwZWRBcnJheUNvbnN0cnVjdG9yc1tpKytdXSkge1xuICAgIGhpZGUoVHlwZWQucHJvdG90eXBlLCBUWVBFRCwgdHJ1ZSk7XG4gICAgaGlkZShUeXBlZC5wcm90b3R5cGUsIFZJRVcsIHRydWUpO1xuICB9IGVsc2UgQ09OU1RSID0gZmFsc2U7XG59XG5cbm1vZHVsZS5leHBvcnRzID0ge1xuICBBQlY6IEFCVixcbiAgQ09OU1RSOiBDT05TVFIsXG4gIFRZUEVEOiBUWVBFRCxcbiAgVklFVzogVklFV1xufTtcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Iiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///60\n")},function(module,exports,__webpack_require__){eval("var isObject = __webpack_require__(5);\nvar document = __webpack_require__(2).document;\n// typeof document.createElement is 'object' in old IE\nvar is = isObject(document) && isObject(document.createElement);\nmodule.exports = function (it) {\n  return is ? document.createElement(it) : {};\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNjEuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9bbmFtZV0vLi9ub2RlX21vZHVsZXMvY29yZS1qcy9tb2R1bGVzL19kb20tY3JlYXRlLmpzPzIzMGUiXSwic291cmNlc0NvbnRlbnQiOlsidmFyIGlzT2JqZWN0ID0gcmVxdWlyZSgnLi9faXMtb2JqZWN0Jyk7XG52YXIgZG9jdW1lbnQgPSByZXF1aXJlKCcuL19nbG9iYWwnKS5kb2N1bWVudDtcbi8vIHR5cGVvZiBkb2N1bWVudC5jcmVhdGVFbGVtZW50IGlzICdvYmplY3QnIGluIG9sZCBJRVxudmFyIGlzID0gaXNPYmplY3QoZG9jdW1lbnQpICYmIGlzT2JqZWN0KGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQpO1xubW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoaXQpIHtcbiAgcmV0dXJuIGlzID8gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChpdCkgOiB7fTtcbn07XG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///61\n")},function(module,exports,__webpack_require__){eval("exports.f = __webpack_require__(6);\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNjIuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9bbmFtZV0vLi9ub2RlX21vZHVsZXMvY29yZS1qcy9tb2R1bGVzL193a3MtZXh0LmpzPzM3YzgiXSwic291cmNlc0NvbnRlbnQiOlsiZXhwb3J0cy5mID0gcmVxdWlyZSgnLi9fd2tzJyk7XG4iXSwibWFwcGluZ3MiOiJBQUFBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///62\n")},function(module,exports,__webpack_require__){eval("var shared = __webpack_require__(49)('keys');\nvar uid = __webpack_require__(30);\nmodule.exports = function (key) {\n  return shared[key] || (shared[key] = uid(key));\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNjMuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9bbmFtZV0vLi9ub2RlX21vZHVsZXMvY29yZS1qcy9tb2R1bGVzL19zaGFyZWQta2V5LmpzPzYxM2IiXSwic291cmNlc0NvbnRlbnQiOlsidmFyIHNoYXJlZCA9IHJlcXVpcmUoJy4vX3NoYXJlZCcpKCdrZXlzJyk7XG52YXIgdWlkID0gcmVxdWlyZSgnLi9fdWlkJyk7XG5tb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChrZXkpIHtcbiAgcmV0dXJuIHNoYXJlZFtrZXldIHx8IChzaGFyZWRba2V5XSA9IHVpZChrZXkpKTtcbn07XG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Iiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///63\n")},function(module,exports){eval("// IE 8- don't enum bug keys\nmodule.exports = (\n  'constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf'\n).split(',');\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNjQuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9bbmFtZV0vLi9ub2RlX21vZHVsZXMvY29yZS1qcy9tb2R1bGVzL19lbnVtLWJ1Zy1rZXlzLmpzP2UxMWUiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gSUUgOC0gZG9uJ3QgZW51bSBidWcga2V5c1xubW9kdWxlLmV4cG9ydHMgPSAoXG4gICdjb25zdHJ1Y3RvcixoYXNPd25Qcm9wZXJ0eSxpc1Byb3RvdHlwZU9mLHByb3BlcnR5SXNFbnVtZXJhYmxlLHRvTG9jYWxlU3RyaW5nLHRvU3RyaW5nLHZhbHVlT2YnXG4pLnNwbGl0KCcsJyk7XG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///64\n")},function(module,exports,__webpack_require__){eval("var document = __webpack_require__(2).document;\nmodule.exports = document && document.documentElement;\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNjUuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9bbmFtZV0vLi9ub2RlX21vZHVsZXMvY29yZS1qcy9tb2R1bGVzL19odG1sLmpzP2ZhYjIiXSwic291cmNlc0NvbnRlbnQiOlsidmFyIGRvY3VtZW50ID0gcmVxdWlyZSgnLi9fZ2xvYmFsJykuZG9jdW1lbnQ7XG5tb2R1bGUuZXhwb3J0cyA9IGRvY3VtZW50ICYmIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudDtcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///65\n")},function(module,exports,__webpack_require__){eval("// Works with __proto__ only. Old v8 can't work with null proto objects.\n/* eslint-disable no-proto */\nvar isObject = __webpack_require__(5);\nvar anObject = __webpack_require__(4);\nvar check = function (O, proto) {\n  anObject(O);\n  if (!isObject(proto) && proto !== null) throw TypeError(proto + \": can't set as prototype!\");\n};\nmodule.exports = {\n  set: Object.setPrototypeOf || ('__proto__' in {} ? // eslint-disable-line\n    function (test, buggy, set) {\n      try {\n        set = __webpack_require__(18)(Function.call, __webpack_require__(21).f(Object.prototype, '__proto__').set, 2);\n        set(test, []);\n        buggy = !(test instanceof Array);\n      } catch (e) { buggy = true; }\n      return function setPrototypeOf(O, proto) {\n        check(O, proto);\n        if (buggy) O.__proto__ = proto;\n        else set(O, proto);\n        return O;\n      };\n    }({}, false) : undefined),\n  check: check\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNjYuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9bbmFtZV0vLi9ub2RlX21vZHVsZXMvY29yZS1qcy9tb2R1bGVzL19zZXQtcHJvdG8uanM/OGI5NyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBXb3JrcyB3aXRoIF9fcHJvdG9fXyBvbmx5LiBPbGQgdjggY2FuJ3Qgd29yayB3aXRoIG51bGwgcHJvdG8gb2JqZWN0cy5cbi8qIGVzbGludC1kaXNhYmxlIG5vLXByb3RvICovXG52YXIgaXNPYmplY3QgPSByZXF1aXJlKCcuL19pcy1vYmplY3QnKTtcbnZhciBhbk9iamVjdCA9IHJlcXVpcmUoJy4vX2FuLW9iamVjdCcpO1xudmFyIGNoZWNrID0gZnVuY3Rpb24gKE8sIHByb3RvKSB7XG4gIGFuT2JqZWN0KE8pO1xuICBpZiAoIWlzT2JqZWN0KHByb3RvKSAmJiBwcm90byAhPT0gbnVsbCkgdGhyb3cgVHlwZUVycm9yKHByb3RvICsgXCI6IGNhbid0IHNldCBhcyBwcm90b3R5cGUhXCIpO1xufTtcbm1vZHVsZS5leHBvcnRzID0ge1xuICBzZXQ6IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fCAoJ19fcHJvdG9fXycgaW4ge30gPyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lXG4gICAgZnVuY3Rpb24gKHRlc3QsIGJ1Z2d5LCBzZXQpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIHNldCA9IHJlcXVpcmUoJy4vX2N0eCcpKEZ1bmN0aW9uLmNhbGwsIHJlcXVpcmUoJy4vX29iamVjdC1nb3BkJykuZihPYmplY3QucHJvdG90eXBlLCAnX19wcm90b19fJykuc2V0LCAyKTtcbiAgICAgICAgc2V0KHRlc3QsIFtdKTtcbiAgICAgICAgYnVnZ3kgPSAhKHRlc3QgaW5zdGFuY2VvZiBBcnJheSk7XG4gICAgICB9IGNhdGNoIChlKSB7IGJ1Z2d5ID0gdHJ1ZTsgfVxuICAgICAgcmV0dXJuIGZ1bmN0aW9uIHNldFByb3RvdHlwZU9mKE8sIHByb3RvKSB7XG4gICAgICAgIGNoZWNrKE8sIHByb3RvKTtcbiAgICAgICAgaWYgKGJ1Z2d5KSBPLl9fcHJvdG9fXyA9IHByb3RvO1xuICAgICAgICBlbHNlIHNldChPLCBwcm90byk7XG4gICAgICAgIHJldHVybiBPO1xuICAgICAgfTtcbiAgICB9KHt9LCBmYWxzZSkgOiB1bmRlZmluZWQpLFxuICBjaGVjazogY2hlY2tcbn07XG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///66\n")},function(module,exports){eval("module.exports = '\\x09\\x0A\\x0B\\x0C\\x0D\\x20\\xA0\\u1680\\u180E\\u2000\\u2001\\u2002\\u2003' +\n  '\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200A\\u202F\\u205F\\u3000\\u2028\\u2029\\uFEFF';\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNjcuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9bbmFtZV0vLi9ub2RlX21vZHVsZXMvY29yZS1qcy9tb2R1bGVzL19zdHJpbmctd3MuanM/ZmRlZiJdLCJzb3VyY2VzQ29udGVudCI6WyJtb2R1bGUuZXhwb3J0cyA9ICdcXHgwOVxceDBBXFx4MEJcXHgwQ1xceDBEXFx4MjBcXHhBMFxcdTE2ODBcXHUxODBFXFx1MjAwMFxcdTIwMDFcXHUyMDAyXFx1MjAwMycgK1xuICAnXFx1MjAwNFxcdTIwMDVcXHUyMDA2XFx1MjAwN1xcdTIwMDhcXHUyMDA5XFx1MjAwQVxcdTIwMkZcXHUyMDVGXFx1MzAwMFxcdTIwMjhcXHUyMDI5XFx1RkVGRic7XG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7Iiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///67\n")},function(module,exports,__webpack_require__){eval("var isObject = __webpack_require__(5);\nvar setPrototypeOf = __webpack_require__(66).set;\nmodule.exports = function (that, target, C) {\n  var S = target.constructor;\n  var P;\n  if (S !== C && typeof S == 'function' && (P = S.prototype) !== C.prototype && isObject(P) && setPrototypeOf) {\n    setPrototypeOf(that, P);\n  } return that;\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNjguanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9bbmFtZV0vLi9ub2RlX21vZHVsZXMvY29yZS1qcy9tb2R1bGVzL19pbmhlcml0LWlmLXJlcXVpcmVkLmpzPzVkYmMiXSwic291cmNlc0NvbnRlbnQiOlsidmFyIGlzT2JqZWN0ID0gcmVxdWlyZSgnLi9faXMtb2JqZWN0Jyk7XG52YXIgc2V0UHJvdG90eXBlT2YgPSByZXF1aXJlKCcuL19zZXQtcHJvdG8nKS5zZXQ7XG5tb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uICh0aGF0LCB0YXJnZXQsIEMpIHtcbiAgdmFyIFMgPSB0YXJnZXQuY29uc3RydWN0b3I7XG4gIHZhciBQO1xuICBpZiAoUyAhPT0gQyAmJiB0eXBlb2YgUyA9PSAnZnVuY3Rpb24nICYmIChQID0gUy5wcm90b3R5cGUpICE9PSBDLnByb3RvdHlwZSAmJiBpc09iamVjdChQKSAmJiBzZXRQcm90b3R5cGVPZikge1xuICAgIHNldFByb3RvdHlwZU9mKHRoYXQsIFApO1xuICB9IHJldHVybiB0aGF0O1xufTtcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///68\n")},function(module,exports,__webpack_require__){"use strict";eval("\nvar toInteger = __webpack_require__(20);\nvar defined = __webpack_require__(25);\n\nmodule.exports = function repeat(count) {\n  var str = String(defined(this));\n  var res = '';\n  var n = toInteger(count);\n  if (n < 0 || n == Infinity) throw RangeError(\"Count can't be negative\");\n  for (;n > 0; (n >>>= 1) && (str += str)) if (n & 1) res += str;\n  return res;\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNjkuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9bbmFtZV0vLi9ub2RlX21vZHVsZXMvY29yZS1qcy9tb2R1bGVzL19zdHJpbmctcmVwZWF0LmpzPzk3NDQiXSwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xudmFyIHRvSW50ZWdlciA9IHJlcXVpcmUoJy4vX3RvLWludGVnZXInKTtcbnZhciBkZWZpbmVkID0gcmVxdWlyZSgnLi9fZGVmaW5lZCcpO1xuXG5tb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIHJlcGVhdChjb3VudCkge1xuICB2YXIgc3RyID0gU3RyaW5nKGRlZmluZWQodGhpcykpO1xuICB2YXIgcmVzID0gJyc7XG4gIHZhciBuID0gdG9JbnRlZ2VyKGNvdW50KTtcbiAgaWYgKG4gPCAwIHx8IG4gPT0gSW5maW5pdHkpIHRocm93IFJhbmdlRXJyb3IoXCJDb3VudCBjYW4ndCBiZSBuZWdhdGl2ZVwiKTtcbiAgZm9yICg7biA+IDA7IChuID4+Pj0gMSkgJiYgKHN0ciArPSBzdHIpKSBpZiAobiAmIDEpIHJlcyArPSBzdHI7XG4gIHJldHVybiByZXM7XG59O1xuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Iiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///69\n")},function(module,exports){eval("// 20.2.2.28 Math.sign(x)\nmodule.exports = Math.sign || function sign(x) {\n  // eslint-disable-next-line no-self-compare\n  return (x = +x) == 0 || x != x ? x : x < 0 ? -1 : 1;\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNzAuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9bbmFtZV0vLi9ub2RlX21vZHVsZXMvY29yZS1qcy9tb2R1bGVzL19tYXRoLXNpZ24uanM/OTZmYiJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyAyMC4yLjIuMjggTWF0aC5zaWduKHgpXG5tb2R1bGUuZXhwb3J0cyA9IE1hdGguc2lnbiB8fCBmdW5jdGlvbiBzaWduKHgpIHtcbiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLXNlbGYtY29tcGFyZVxuICByZXR1cm4gKHggPSAreCkgPT0gMCB8fCB4ICE9IHggPyB4IDogeCA8IDAgPyAtMSA6IDE7XG59O1xuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///70\n")},function(module,exports){eval("// 20.2.2.14 Math.expm1(x)\nvar $expm1 = Math.expm1;\nmodule.exports = (!$expm1\n  // Old FF bug\n  || $expm1(10) > 22025.465794806719 || $expm1(10) < 22025.4657948067165168\n  // Tor Browser bug\n  || $expm1(-2e-17) != -2e-17\n) ? function expm1(x) {\n  return (x = +x) == 0 ? x : x > -1e-6 && x < 1e-6 ? x + x * x / 2 : Math.exp(x) - 1;\n} : $expm1;\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNzEuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9bbmFtZV0vLi9ub2RlX21vZHVsZXMvY29yZS1qcy9tb2R1bGVzL19tYXRoLWV4cG0xLmpzPzJkNWMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gMjAuMi4yLjE0IE1hdGguZXhwbTEoeClcbnZhciAkZXhwbTEgPSBNYXRoLmV4cG0xO1xubW9kdWxlLmV4cG9ydHMgPSAoISRleHBtMVxuICAvLyBPbGQgRkYgYnVnXG4gIHx8ICRleHBtMSgxMCkgPiAyMjAyNS40NjU3OTQ4MDY3MTkgfHwgJGV4cG0xKDEwKSA8IDIyMDI1LjQ2NTc5NDgwNjcxNjUxNjhcbiAgLy8gVG9yIEJyb3dzZXIgYnVnXG4gIHx8ICRleHBtMSgtMmUtMTcpICE9IC0yZS0xN1xuKSA/IGZ1bmN0aW9uIGV4cG0xKHgpIHtcbiAgcmV0dXJuICh4ID0gK3gpID09IDAgPyB4IDogeCA+IC0xZS02ICYmIHggPCAxZS02ID8geCArIHggKiB4IC8gMiA6IE1hdGguZXhwKHgpIC0gMTtcbn0gOiAkZXhwbTE7XG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///71\n")},function(module,exports,__webpack_require__){eval("var toInteger = __webpack_require__(20);\nvar defined = __webpack_require__(25);\n// true  -> String#at\n// false -> String#codePointAt\nmodule.exports = function (TO_STRING) {\n  return function (that, pos) {\n    var s = String(defined(that));\n    var i = toInteger(pos);\n    var l = s.length;\n    var a, b;\n    if (i < 0 || i >= l) return TO_STRING ? '' : undefined;\n    a = s.charCodeAt(i);\n    return a < 0xd800 || a > 0xdbff || i + 1 === l || (b = s.charCodeAt(i + 1)) < 0xdc00 || b > 0xdfff\n      ? TO_STRING ? s.charAt(i) : a\n      : TO_STRING ? s.slice(i, i + 2) : (a - 0xd800 << 10) + (b - 0xdc00) + 0x10000;\n  };\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNzIuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9bbmFtZV0vLi9ub2RlX21vZHVsZXMvY29yZS1qcy9tb2R1bGVzL19zdHJpbmctYXQuanM/MDJmNCJdLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgdG9JbnRlZ2VyID0gcmVxdWlyZSgnLi9fdG8taW50ZWdlcicpO1xudmFyIGRlZmluZWQgPSByZXF1aXJlKCcuL19kZWZpbmVkJyk7XG4vLyB0cnVlICAtPiBTdHJpbmcjYXRcbi8vIGZhbHNlIC0+IFN0cmluZyNjb2RlUG9pbnRBdFxubW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoVE9fU1RSSU5HKSB7XG4gIHJldHVybiBmdW5jdGlvbiAodGhhdCwgcG9zKSB7XG4gICAgdmFyIHMgPSBTdHJpbmcoZGVmaW5lZCh0aGF0KSk7XG4gICAgdmFyIGkgPSB0b0ludGVnZXIocG9zKTtcbiAgICB2YXIgbCA9IHMubGVuZ3RoO1xuICAgIHZhciBhLCBiO1xuICAgIGlmIChpIDwgMCB8fCBpID49IGwpIHJldHVybiBUT19TVFJJTkcgPyAnJyA6IHVuZGVmaW5lZDtcbiAgICBhID0gcy5jaGFyQ29kZUF0KGkpO1xuICAgIHJldHVybiBhIDwgMHhkODAwIHx8IGEgPiAweGRiZmYgfHwgaSArIDEgPT09IGwgfHwgKGIgPSBzLmNoYXJDb2RlQXQoaSArIDEpKSA8IDB4ZGMwMCB8fCBiID4gMHhkZmZmXG4gICAgICA/IFRPX1NUUklORyA/IHMuY2hhckF0KGkpIDogYVxuICAgICAgOiBUT19TVFJJTkcgPyBzLnNsaWNlKGksIGkgKyAyKSA6IChhIC0gMHhkODAwIDw8IDEwKSArIChiIC0gMHhkYzAwKSArIDB4MTAwMDA7XG4gIH07XG59O1xuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///72\n")},function(module,exports,__webpack_require__){"use strict";eval("\nvar LIBRARY = __webpack_require__(31);\nvar $export = __webpack_require__(1);\nvar redefine = __webpack_require__(12);\nvar hide = __webpack_require__(15);\nvar Iterators = __webpack_require__(41);\nvar $iterCreate = __webpack_require__(105);\nvar setToStringTag = __webpack_require__(39);\nvar getPrototypeOf = __webpack_require__(36);\nvar ITERATOR = __webpack_require__(6)('iterator');\nvar BUGGY = !([].keys && 'next' in [].keys()); // Safari has buggy iterators w/o `next`\nvar FF_ITERATOR = '@@iterator';\nvar KEYS = 'keys';\nvar VALUES = 'values';\n\nvar returnThis = function () { return this; };\n\nmodule.exports = function (Base, NAME, Constructor, next, DEFAULT, IS_SET, FORCED) {\n  $iterCreate(Constructor, NAME, next);\n  var getMethod = function (kind) {\n    if (!BUGGY && kind in proto) return proto[kind];\n    switch (kind) {\n      case KEYS: return function keys() { return new Constructor(this, kind); };\n      case VALUES: return function values() { return new Constructor(this, kind); };\n    } return function entries() { return new Constructor(this, kind); };\n  };\n  var TAG = NAME + ' Iterator';\n  var DEF_VALUES = DEFAULT == VALUES;\n  var VALUES_BUG = false;\n  var proto = Base.prototype;\n  var $native = proto[ITERATOR] || proto[FF_ITERATOR] || DEFAULT && proto[DEFAULT];\n  var $default = $native || getMethod(DEFAULT);\n  var $entries = DEFAULT ? !DEF_VALUES ? $default : getMethod('entries') : undefined;\n  var $anyNative = NAME == 'Array' ? proto.entries || $native : $native;\n  var methods, key, IteratorPrototype;\n  // Fix native\n  if ($anyNative) {\n    IteratorPrototype = getPrototypeOf($anyNative.call(new Base()));\n    if (IteratorPrototype !== Object.prototype && IteratorPrototype.next) {\n      // Set @@toStringTag to native iterators\n      setToStringTag(IteratorPrototype, TAG, true);\n      // fix for some old engines\n      if (!LIBRARY && typeof IteratorPrototype[ITERATOR] != 'function') hide(IteratorPrototype, ITERATOR, returnThis);\n    }\n  }\n  // fix Array#{values, @@iterator}.name in V8 / FF\n  if (DEF_VALUES && $native && $native.name !== VALUES) {\n    VALUES_BUG = true;\n    $default = function values() { return $native.call(this); };\n  }\n  // Define iterator\n  if ((!LIBRARY || FORCED) && (BUGGY || VALUES_BUG || !proto[ITERATOR])) {\n    hide(proto, ITERATOR, $default);\n  }\n  // Plug for library\n  Iterators[NAME] = $default;\n  Iterators[TAG] = returnThis;\n  if (DEFAULT) {\n    methods = {\n      values: DEF_VALUES ? $default : getMethod(VALUES),\n      keys: IS_SET ? $default : getMethod(KEYS),\n      entries: $entries\n    };\n    if (FORCED) for (key in methods) {\n      if (!(key in proto)) redefine(proto, key, methods[key]);\n    } else $export($export.P + $export.F * (BUGGY || VALUES_BUG), NAME, methods);\n  }\n  return methods;\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNzMuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9bbmFtZV0vLi9ub2RlX21vZHVsZXMvY29yZS1qcy9tb2R1bGVzL19pdGVyLWRlZmluZS5qcz8wMWY5Il0sInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcbnZhciBMSUJSQVJZID0gcmVxdWlyZSgnLi9fbGlicmFyeScpO1xudmFyICRleHBvcnQgPSByZXF1aXJlKCcuL19leHBvcnQnKTtcbnZhciByZWRlZmluZSA9IHJlcXVpcmUoJy4vX3JlZGVmaW5lJyk7XG52YXIgaGlkZSA9IHJlcXVpcmUoJy4vX2hpZGUnKTtcbnZhciBJdGVyYXRvcnMgPSByZXF1aXJlKCcuL19pdGVyYXRvcnMnKTtcbnZhciAkaXRlckNyZWF0ZSA9IHJlcXVpcmUoJy4vX2l0ZXItY3JlYXRlJyk7XG52YXIgc2V0VG9TdHJpbmdUYWcgPSByZXF1aXJlKCcuL19zZXQtdG8tc3RyaW5nLXRhZycpO1xudmFyIGdldFByb3RvdHlwZU9mID0gcmVxdWlyZSgnLi9fb2JqZWN0LWdwbycpO1xudmFyIElURVJBVE9SID0gcmVxdWlyZSgnLi9fd2tzJykoJ2l0ZXJhdG9yJyk7XG52YXIgQlVHR1kgPSAhKFtdLmtleXMgJiYgJ25leHQnIGluIFtdLmtleXMoKSk7IC8vIFNhZmFyaSBoYXMgYnVnZ3kgaXRlcmF0b3JzIHcvbyBgbmV4dGBcbnZhciBGRl9JVEVSQVRPUiA9ICdAQGl0ZXJhdG9yJztcbnZhciBLRVlTID0gJ2tleXMnO1xudmFyIFZBTFVFUyA9ICd2YWx1ZXMnO1xuXG52YXIgcmV0dXJuVGhpcyA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRoaXM7IH07XG5cbm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKEJhc2UsIE5BTUUsIENvbnN0cnVjdG9yLCBuZXh0LCBERUZBVUxULCBJU19TRVQsIEZPUkNFRCkge1xuICAkaXRlckNyZWF0ZShDb25zdHJ1Y3RvciwgTkFNRSwgbmV4dCk7XG4gIHZhciBnZXRNZXRob2QgPSBmdW5jdGlvbiAoa2luZCkge1xuICAgIGlmICghQlVHR1kgJiYga2luZCBpbiBwcm90bykgcmV0dXJuIHByb3RvW2tpbmRdO1xuICAgIHN3aXRjaCAoa2luZCkge1xuICAgICAgY2FzZSBLRVlTOiByZXR1cm4gZnVuY3Rpb24ga2V5cygpIHsgcmV0dXJuIG5ldyBDb25zdHJ1Y3Rvcih0aGlzLCBraW5kKTsgfTtcbiAgICAgIGNhc2UgVkFMVUVTOiByZXR1cm4gZnVuY3Rpb24gdmFsdWVzKCkgeyByZXR1cm4gbmV3IENvbnN0cnVjdG9yKHRoaXMsIGtpbmQpOyB9O1xuICAgIH0gcmV0dXJuIGZ1bmN0aW9uIGVudHJpZXMoKSB7IHJldHVybiBuZXcgQ29uc3RydWN0b3IodGhpcywga2luZCk7IH07XG4gIH07XG4gIHZhciBUQUcgPSBOQU1FICsgJyBJdGVyYXRvcic7XG4gIHZhciBERUZfVkFMVUVTID0gREVGQVVMVCA9PSBWQUxVRVM7XG4gIHZhciBWQUxVRVNfQlVHID0gZmFsc2U7XG4gIHZhciBwcm90byA9IEJhc2UucHJvdG90eXBlO1xuICB2YXIgJG5hdGl2ZSA9IHByb3RvW0lURVJBVE9SXSB8fCBwcm90b1tGRl9JVEVSQVRPUl0gfHwgREVGQVVMVCAmJiBwcm90b1tERUZBVUxUXTtcbiAgdmFyICRkZWZhdWx0ID0gJG5hdGl2ZSB8fCBnZXRNZXRob2QoREVGQVVMVCk7XG4gIHZhciAkZW50cmllcyA9IERFRkFVTFQgPyAhREVGX1ZBTFVFUyA/ICRkZWZhdWx0IDogZ2V0TWV0aG9kKCdlbnRyaWVzJykgOiB1bmRlZmluZWQ7XG4gIHZhciAkYW55TmF0aXZlID0gTkFNRSA9PSAnQXJyYXknID8gcHJvdG8uZW50cmllcyB8fCAkbmF0aXZlIDogJG5hdGl2ZTtcbiAgdmFyIG1ldGhvZHMsIGtleSwgSXRlcmF0b3JQcm90b3R5cGU7XG4gIC8vIEZpeCBuYXRpdmVcbiAgaWYgKCRhbnlOYXRpdmUpIHtcbiAgICBJdGVyYXRvclByb3RvdHlwZSA9IGdldFByb3RvdHlwZU9mKCRhbnlOYXRpdmUuY2FsbChuZXcgQmFzZSgpKSk7XG4gICAgaWYgKEl0ZXJhdG9yUHJvdG90eXBlICE9PSBPYmplY3QucHJvdG90eXBlICYmIEl0ZXJhdG9yUHJvdG90eXBlLm5leHQpIHtcbiAgICAgIC8vIFNldCBAQHRvU3RyaW5nVGFnIHRvIG5hdGl2ZSBpdGVyYXRvcnNcbiAgICAgIHNldFRvU3RyaW5nVGFnKEl0ZXJhdG9yUHJvdG90eXBlLCBUQUcsIHRydWUpO1xuICAgICAgLy8gZml4IGZvciBzb21lIG9sZCBlbmdpbmVzXG4gICAgICBpZiAoIUxJQlJBUlkgJiYgdHlwZW9mIEl0ZXJhdG9yUHJvdG90eXBlW0lURVJBVE9SXSAhPSAnZnVuY3Rpb24nKSBoaWRlKEl0ZXJhdG9yUHJvdG90eXBlLCBJVEVSQVRPUiwgcmV0dXJuVGhpcyk7XG4gICAgfVxuICB9XG4gIC8vIGZpeCBBcnJheSN7dmFsdWVzLCBAQGl0ZXJhdG9yfS5uYW1lIGluIFY4IC8gRkZcbiAgaWYgKERFRl9WQUxVRVMgJiYgJG5hdGl2ZSAmJiAkbmF0aXZlLm5hbWUgIT09IFZBTFVFUykge1xuICAgIFZBTFVFU19CVUcgPSB0cnVlO1xuICAgICRkZWZhdWx0ID0gZnVuY3Rpb24gdmFsdWVzKCkgeyByZXR1cm4gJG5hdGl2ZS5jYWxsKHRoaXMpOyB9O1xuICB9XG4gIC8vIERlZmluZSBpdGVyYXRvclxuICBpZiAoKCFMSUJSQVJZIHx8IEZPUkNFRCkgJiYgKEJVR0dZIHx8IFZBTFVFU19CVUcgfHwgIXByb3RvW0lURVJBVE9SXSkpIHtcbiAgICBoaWRlKHByb3RvLCBJVEVSQVRPUiwgJGRlZmF1bHQpO1xuICB9XG4gIC8vIFBsdWcgZm9yIGxpYnJhcnlcbiAgSXRlcmF0b3JzW05BTUVdID0gJGRlZmF1bHQ7XG4gIEl0ZXJhdG9yc1tUQUddID0gcmV0dXJuVGhpcztcbiAgaWYgKERFRkFVTFQpIHtcbiAgICBtZXRob2RzID0ge1xuICAgICAgdmFsdWVzOiBERUZfVkFMVUVTID8gJGRlZmF1bHQgOiBnZXRNZXRob2QoVkFMVUVTKSxcbiAgICAgIGtleXM6IElTX1NFVCA/ICRkZWZhdWx0IDogZ2V0TWV0aG9kKEtFWVMpLFxuICAgICAgZW50cmllczogJGVudHJpZXNcbiAgICB9O1xuICAgIGlmIChGT1JDRUQpIGZvciAoa2V5IGluIG1ldGhvZHMpIHtcbiAgICAgIGlmICghKGtleSBpbiBwcm90bykpIHJlZGVmaW5lKHByb3RvLCBrZXksIG1ldGhvZHNba2V5XSk7XG4gICAgfSBlbHNlICRleHBvcnQoJGV4cG9ydC5QICsgJGV4cG9ydC5GICogKEJVR0dZIHx8IFZBTFVFU19CVUcpLCBOQU1FLCBtZXRob2RzKTtcbiAgfVxuICByZXR1cm4gbWV0aG9kcztcbn07XG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///73\n")},function(module,exports,__webpack_require__){eval("// helper for String#{startsWith, endsWith, includes}\nvar isRegExp = __webpack_require__(75);\nvar defined = __webpack_require__(25);\n\nmodule.exports = function (that, searchString, NAME) {\n  if (isRegExp(searchString)) throw TypeError('String#' + NAME + \" doesn't accept regex!\");\n  return String(defined(that));\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNzQuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9bbmFtZV0vLi9ub2RlX21vZHVsZXMvY29yZS1qcy9tb2R1bGVzL19zdHJpbmctY29udGV4dC5qcz9kMmM4Il0sInNvdXJjZXNDb250ZW50IjpbIi8vIGhlbHBlciBmb3IgU3RyaW5nI3tzdGFydHNXaXRoLCBlbmRzV2l0aCwgaW5jbHVkZXN9XG52YXIgaXNSZWdFeHAgPSByZXF1aXJlKCcuL19pcy1yZWdleHAnKTtcbnZhciBkZWZpbmVkID0gcmVxdWlyZSgnLi9fZGVmaW5lZCcpO1xuXG5tb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uICh0aGF0LCBzZWFyY2hTdHJpbmcsIE5BTUUpIHtcbiAgaWYgKGlzUmVnRXhwKHNlYXJjaFN0cmluZykpIHRocm93IFR5cGVFcnJvcignU3RyaW5nIycgKyBOQU1FICsgXCIgZG9lc24ndCBhY2NlcHQgcmVnZXghXCIpO1xuICByZXR1cm4gU3RyaW5nKGRlZmluZWQodGhhdCkpO1xufTtcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///74\n")},function(module,exports,__webpack_require__){eval("// 7.2.8 IsRegExp(argument)\nvar isObject = __webpack_require__(5);\nvar cof = __webpack_require__(24);\nvar MATCH = __webpack_require__(6)('match');\nmodule.exports = function (it) {\n  var isRegExp;\n  return isObject(it) && ((isRegExp = it[MATCH]) !== undefined ? !!isRegExp : cof(it) == 'RegExp');\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNzUuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9bbmFtZV0vLi9ub2RlX21vZHVsZXMvY29yZS1qcy9tb2R1bGVzL19pcy1yZWdleHAuanM/YWFlMyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyA3LjIuOCBJc1JlZ0V4cChhcmd1bWVudClcbnZhciBpc09iamVjdCA9IHJlcXVpcmUoJy4vX2lzLW9iamVjdCcpO1xudmFyIGNvZiA9IHJlcXVpcmUoJy4vX2NvZicpO1xudmFyIE1BVENIID0gcmVxdWlyZSgnLi9fd2tzJykoJ21hdGNoJyk7XG5tb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChpdCkge1xuICB2YXIgaXNSZWdFeHA7XG4gIHJldHVybiBpc09iamVjdChpdCkgJiYgKChpc1JlZ0V4cCA9IGl0W01BVENIXSkgIT09IHVuZGVmaW5lZCA/ICEhaXNSZWdFeHAgOiBjb2YoaXQpID09ICdSZWdFeHAnKTtcbn07XG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Iiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///75\n")},function(module,exports,__webpack_require__){eval("var MATCH = __webpack_require__(6)('match');\nmodule.exports = function (KEY) {\n  var re = /./;\n  try {\n    '/./'[KEY](re);\n  } catch (e) {\n    try {\n      re[MATCH] = false;\n      return !'/./'[KEY](re);\n    } catch (f) { /* empty */ }\n  } return true;\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNzYuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9bbmFtZV0vLi9ub2RlX21vZHVsZXMvY29yZS1qcy9tb2R1bGVzL19mYWlscy1pcy1yZWdleHAuanM/NTE0NyJdLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgTUFUQ0ggPSByZXF1aXJlKCcuL193a3MnKSgnbWF0Y2gnKTtcbm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKEtFWSkge1xuICB2YXIgcmUgPSAvLi87XG4gIHRyeSB7XG4gICAgJy8uLydbS0VZXShyZSk7XG4gIH0gY2F0Y2ggKGUpIHtcbiAgICB0cnkge1xuICAgICAgcmVbTUFUQ0hdID0gZmFsc2U7XG4gICAgICByZXR1cm4gIScvLi8nW0tFWV0ocmUpO1xuICAgIH0gY2F0Y2ggKGYpIHsgLyogZW1wdHkgKi8gfVxuICB9IHJldHVybiB0cnVlO1xufTtcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///76\n")},function(module,exports,__webpack_require__){eval("// check on default Array iterator\nvar Iterators = __webpack_require__(41);\nvar ITERATOR = __webpack_require__(6)('iterator');\nvar ArrayProto = Array.prototype;\n\nmodule.exports = function (it) {\n  return it !== undefined && (Iterators.Array === it || ArrayProto[ITERATOR] === it);\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNzcuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9bbmFtZV0vLi9ub2RlX21vZHVsZXMvY29yZS1qcy9tb2R1bGVzL19pcy1hcnJheS1pdGVyLmpzPzMzYTQiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gY2hlY2sgb24gZGVmYXVsdCBBcnJheSBpdGVyYXRvclxudmFyIEl0ZXJhdG9ycyA9IHJlcXVpcmUoJy4vX2l0ZXJhdG9ycycpO1xudmFyIElURVJBVE9SID0gcmVxdWlyZSgnLi9fd2tzJykoJ2l0ZXJhdG9yJyk7XG52YXIgQXJyYXlQcm90byA9IEFycmF5LnByb3RvdHlwZTtcblxubW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoaXQpIHtcbiAgcmV0dXJuIGl0ICE9PSB1bmRlZmluZWQgJiYgKEl0ZXJhdG9ycy5BcnJheSA9PT0gaXQgfHwgQXJyYXlQcm90b1tJVEVSQVRPUl0gPT09IGl0KTtcbn07XG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Iiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///77\n")},function(module,exports,__webpack_require__){"use strict";eval("\nvar $defineProperty = __webpack_require__(10);\nvar createDesc = __webpack_require__(29);\n\nmodule.exports = function (object, index, value) {\n  if (index in object) $defineProperty.f(object, index, createDesc(0, value));\n  else object[index] = value;\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNzguanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9bbmFtZV0vLi9ub2RlX21vZHVsZXMvY29yZS1qcy9tb2R1bGVzL19jcmVhdGUtcHJvcGVydHkuanM/ZjFhZSJdLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XG52YXIgJGRlZmluZVByb3BlcnR5ID0gcmVxdWlyZSgnLi9fb2JqZWN0LWRwJyk7XG52YXIgY3JlYXRlRGVzYyA9IHJlcXVpcmUoJy4vX3Byb3BlcnR5LWRlc2MnKTtcblxubW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAob2JqZWN0LCBpbmRleCwgdmFsdWUpIHtcbiAgaWYgKGluZGV4IGluIG9iamVjdCkgJGRlZmluZVByb3BlcnR5LmYob2JqZWN0LCBpbmRleCwgY3JlYXRlRGVzYygwLCB2YWx1ZSkpO1xuICBlbHNlIG9iamVjdFtpbmRleF0gPSB2YWx1ZTtcbn07XG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Iiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///78\n")},function(module,exports,__webpack_require__){eval("var classof = __webpack_require__(47);\nvar ITERATOR = __webpack_require__(6)('iterator');\nvar Iterators = __webpack_require__(41);\nmodule.exports = __webpack_require__(8).getIteratorMethod = function (it) {\n  if (it != undefined) return it[ITERATOR]\n    || it['@@iterator']\n    || Iterators[classof(it)];\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNzkuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9bbmFtZV0vLi9ub2RlX21vZHVsZXMvY29yZS1qcy9tb2R1bGVzL2NvcmUuZ2V0LWl0ZXJhdG9yLW1ldGhvZC5qcz8yN2VlIl0sInNvdXJjZXNDb250ZW50IjpbInZhciBjbGFzc29mID0gcmVxdWlyZSgnLi9fY2xhc3NvZicpO1xudmFyIElURVJBVE9SID0gcmVxdWlyZSgnLi9fd2tzJykoJ2l0ZXJhdG9yJyk7XG52YXIgSXRlcmF0b3JzID0gcmVxdWlyZSgnLi9faXRlcmF0b3JzJyk7XG5tb2R1bGUuZXhwb3J0cyA9IHJlcXVpcmUoJy4vX2NvcmUnKS5nZXRJdGVyYXRvck1ldGhvZCA9IGZ1bmN0aW9uIChpdCkge1xuICBpZiAoaXQgIT0gdW5kZWZpbmVkKSByZXR1cm4gaXRbSVRFUkFUT1JdXG4gICAgfHwgaXRbJ0BAaXRlcmF0b3InXVxuICAgIHx8IEl0ZXJhdG9yc1tjbGFzc29mKGl0KV07XG59O1xuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///79\n")},function(module,exports,__webpack_require__){"use strict";eval("// 22.1.3.6 Array.prototype.fill(value, start = 0, end = this.length)\n\nvar toObject = __webpack_require__(11);\nvar toAbsoluteIndex = __webpack_require__(33);\nvar toLength = __webpack_require__(7);\nmodule.exports = function fill(value /* , start = 0, end = @length */) {\n  var O = toObject(this);\n  var length = toLength(O.length);\n  var aLen = arguments.length;\n  var index = toAbsoluteIndex(aLen > 1 ? arguments[1] : undefined, length);\n  var end = aLen > 2 ? arguments[2] : undefined;\n  var endPos = end === undefined ? length : toAbsoluteIndex(end, length);\n  while (endPos > index) O[index++] = value;\n  return O;\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiODAuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9bbmFtZV0vLi9ub2RlX21vZHVsZXMvY29yZS1qcy9tb2R1bGVzL19hcnJheS1maWxsLmpzPzM2YmQiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gMjIuMS4zLjYgQXJyYXkucHJvdG90eXBlLmZpbGwodmFsdWUsIHN0YXJ0ID0gMCwgZW5kID0gdGhpcy5sZW5ndGgpXG4ndXNlIHN0cmljdCc7XG52YXIgdG9PYmplY3QgPSByZXF1aXJlKCcuL190by1vYmplY3QnKTtcbnZhciB0b0Fic29sdXRlSW5kZXggPSByZXF1aXJlKCcuL190by1hYnNvbHV0ZS1pbmRleCcpO1xudmFyIHRvTGVuZ3RoID0gcmVxdWlyZSgnLi9fdG8tbGVuZ3RoJyk7XG5tb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIGZpbGwodmFsdWUgLyogLCBzdGFydCA9IDAsIGVuZCA9IEBsZW5ndGggKi8pIHtcbiAgdmFyIE8gPSB0b09iamVjdCh0aGlzKTtcbiAgdmFyIGxlbmd0aCA9IHRvTGVuZ3RoKE8ubGVuZ3RoKTtcbiAgdmFyIGFMZW4gPSBhcmd1bWVudHMubGVuZ3RoO1xuICB2YXIgaW5kZXggPSB0b0Fic29sdXRlSW5kZXgoYUxlbiA+IDEgPyBhcmd1bWVudHNbMV0gOiB1bmRlZmluZWQsIGxlbmd0aCk7XG4gIHZhciBlbmQgPSBhTGVuID4gMiA/IGFyZ3VtZW50c1syXSA6IHVuZGVmaW5lZDtcbiAgdmFyIGVuZFBvcyA9IGVuZCA9PT0gdW5kZWZpbmVkID8gbGVuZ3RoIDogdG9BYnNvbHV0ZUluZGV4KGVuZCwgbGVuZ3RoKTtcbiAgd2hpbGUgKGVuZFBvcyA+IGluZGV4KSBPW2luZGV4KytdID0gdmFsdWU7XG4gIHJldHVybiBPO1xufTtcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///80\n")},function(module,exports,__webpack_require__){"use strict";eval("\nvar addToUnscopables = __webpack_require__(37);\nvar step = __webpack_require__(110);\nvar Iterators = __webpack_require__(41);\nvar toIObject = __webpack_require__(16);\n\n// 22.1.3.4 Array.prototype.entries()\n// 22.1.3.13 Array.prototype.keys()\n// 22.1.3.29 Array.prototype.values()\n// 22.1.3.30 Array.prototype[@@iterator]()\nmodule.exports = __webpack_require__(73)(Array, 'Array', function (iterated, kind) {\n  this._t = toIObject(iterated); // target\n  this._i = 0;                   // next index\n  this._k = kind;                // kind\n// 22.1.5.2.1 %ArrayIteratorPrototype%.next()\n}, function () {\n  var O = this._t;\n  var kind = this._k;\n  var index = this._i++;\n  if (!O || index >= O.length) {\n    this._t = undefined;\n    return step(1);\n  }\n  if (kind == 'keys') return step(0, index);\n  if (kind == 'values') return step(0, O[index]);\n  return step(0, [index, O[index]]);\n}, 'values');\n\n// argumentsList[@@iterator] is %ArrayProto_values% (9.4.4.6, 9.4.4.7)\nIterators.Arguments = Iterators.Array;\n\naddToUnscopables('keys');\naddToUnscopables('values');\naddToUnscopables('entries');\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiODEuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9bbmFtZV0vLi9ub2RlX21vZHVsZXMvY29yZS1qcy9tb2R1bGVzL2VzNi5hcnJheS5pdGVyYXRvci5qcz9jYWRmIl0sInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcbnZhciBhZGRUb1Vuc2NvcGFibGVzID0gcmVxdWlyZSgnLi9fYWRkLXRvLXVuc2NvcGFibGVzJyk7XG52YXIgc3RlcCA9IHJlcXVpcmUoJy4vX2l0ZXItc3RlcCcpO1xudmFyIEl0ZXJhdG9ycyA9IHJlcXVpcmUoJy4vX2l0ZXJhdG9ycycpO1xudmFyIHRvSU9iamVjdCA9IHJlcXVpcmUoJy4vX3RvLWlvYmplY3QnKTtcblxuLy8gMjIuMS4zLjQgQXJyYXkucHJvdG90eXBlLmVudHJpZXMoKVxuLy8gMjIuMS4zLjEzIEFycmF5LnByb3RvdHlwZS5rZXlzKClcbi8vIDIyLjEuMy4yOSBBcnJheS5wcm90b3R5cGUudmFsdWVzKClcbi8vIDIyLjEuMy4zMCBBcnJheS5wcm90b3R5cGVbQEBpdGVyYXRvcl0oKVxubW9kdWxlLmV4cG9ydHMgPSByZXF1aXJlKCcuL19pdGVyLWRlZmluZScpKEFycmF5LCAnQXJyYXknLCBmdW5jdGlvbiAoaXRlcmF0ZWQsIGtpbmQpIHtcbiAgdGhpcy5fdCA9IHRvSU9iamVjdChpdGVyYXRlZCk7IC8vIHRhcmdldFxuICB0aGlzLl9pID0gMDsgICAgICAgICAgICAgICAgICAgLy8gbmV4dCBpbmRleFxuICB0aGlzLl9rID0ga2luZDsgICAgICAgICAgICAgICAgLy8ga2luZFxuLy8gMjIuMS41LjIuMSAlQXJyYXlJdGVyYXRvclByb3RvdHlwZSUubmV4dCgpXG59LCBmdW5jdGlvbiAoKSB7XG4gIHZhciBPID0gdGhpcy5fdDtcbiAgdmFyIGtpbmQgPSB0aGlzLl9rO1xuICB2YXIgaW5kZXggPSB0aGlzLl9pKys7XG4gIGlmICghTyB8fCBpbmRleCA+PSBPLmxlbmd0aCkge1xuICAgIHRoaXMuX3QgPSB1bmRlZmluZWQ7XG4gICAgcmV0dXJuIHN0ZXAoMSk7XG4gIH1cbiAgaWYgKGtpbmQgPT0gJ2tleXMnKSByZXR1cm4gc3RlcCgwLCBpbmRleCk7XG4gIGlmIChraW5kID09ICd2YWx1ZXMnKSByZXR1cm4gc3RlcCgwLCBPW2luZGV4XSk7XG4gIHJldHVybiBzdGVwKDAsIFtpbmRleCwgT1tpbmRleF1dKTtcbn0sICd2YWx1ZXMnKTtcblxuLy8gYXJndW1lbnRzTGlzdFtAQGl0ZXJhdG9yXSBpcyAlQXJyYXlQcm90b192YWx1ZXMlICg5LjQuNC42LCA5LjQuNC43KVxuSXRlcmF0b3JzLkFyZ3VtZW50cyA9IEl0ZXJhdG9ycy5BcnJheTtcblxuYWRkVG9VbnNjb3BhYmxlcygna2V5cycpO1xuYWRkVG9VbnNjb3BhYmxlcygndmFsdWVzJyk7XG5hZGRUb1Vuc2NvcGFibGVzKCdlbnRyaWVzJyk7XG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///81\n")},function(module,exports,__webpack_require__){"use strict";eval("\n\nvar regexpFlags = __webpack_require__(54);\n\nvar nativeExec = RegExp.prototype.exec;\n// This always refers to the native implementation, because the\n// String#replace polyfill uses ./fix-regexp-well-known-symbol-logic.js,\n// which loads this file before patching the method.\nvar nativeReplace = String.prototype.replace;\n\nvar patchedExec = nativeExec;\n\nvar LAST_INDEX = 'lastIndex';\n\nvar UPDATES_LAST_INDEX_WRONG = (function () {\n  var re1 = /a/,\n      re2 = /b*/g;\n  nativeExec.call(re1, 'a');\n  nativeExec.call(re2, 'a');\n  return re1[LAST_INDEX] !== 0 || re2[LAST_INDEX] !== 0;\n})();\n\n// nonparticipating capturing group, copied from es5-shim's String#split patch.\nvar NPCG_INCLUDED = /()??/.exec('')[1] !== undefined;\n\nvar PATCH = UPDATES_LAST_INDEX_WRONG || NPCG_INCLUDED;\n\nif (PATCH) {\n  patchedExec = function exec(str) {\n    var re = this;\n    var lastIndex, reCopy, match, i;\n\n    if (NPCG_INCLUDED) {\n      reCopy = new RegExp('^' + re.source + '$(?!\\\\s)', regexpFlags.call(re));\n    }\n    if (UPDATES_LAST_INDEX_WRONG) lastIndex = re[LAST_INDEX];\n\n    match = nativeExec.call(re, str);\n\n    if (UPDATES_LAST_INDEX_WRONG && match) {\n      re[LAST_INDEX] = re.global ? match.index + match[0].length : lastIndex;\n    }\n    if (NPCG_INCLUDED && match && match.length > 1) {\n      // Fix browsers whose `exec` methods don't consistently return `undefined`\n      // for NPCG, like IE8. NOTE: This doesn' work for /(.?)?/\n      // eslint-disable-next-line no-loop-func\n      nativeReplace.call(match[0], reCopy, function () {\n        for (i = 1; i < arguments.length - 2; i++) {\n          if (arguments[i] === undefined) match[i] = undefined;\n        }\n      });\n    }\n\n    return match;\n  };\n}\n\nmodule.exports = patchedExec;\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiODIuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9bbmFtZV0vLi9ub2RlX21vZHVsZXMvY29yZS1qcy9tb2R1bGVzL19yZWdleHAtZXhlYy5qcz81MjBhIl0sInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcblxudmFyIHJlZ2V4cEZsYWdzID0gcmVxdWlyZSgnLi9fZmxhZ3MnKTtcblxudmFyIG5hdGl2ZUV4ZWMgPSBSZWdFeHAucHJvdG90eXBlLmV4ZWM7XG4vLyBUaGlzIGFsd2F5cyByZWZlcnMgdG8gdGhlIG5hdGl2ZSBpbXBsZW1lbnRhdGlvbiwgYmVjYXVzZSB0aGVcbi8vIFN0cmluZyNyZXBsYWNlIHBvbHlmaWxsIHVzZXMgLi9maXgtcmVnZXhwLXdlbGwta25vd24tc3ltYm9sLWxvZ2ljLmpzLFxuLy8gd2hpY2ggbG9hZHMgdGhpcyBmaWxlIGJlZm9yZSBwYXRjaGluZyB0aGUgbWV0aG9kLlxudmFyIG5hdGl2ZVJlcGxhY2UgPSBTdHJpbmcucHJvdG90eXBlLnJlcGxhY2U7XG5cbnZhciBwYXRjaGVkRXhlYyA9IG5hdGl2ZUV4ZWM7XG5cbnZhciBMQVNUX0lOREVYID0gJ2xhc3RJbmRleCc7XG5cbnZhciBVUERBVEVTX0xBU1RfSU5ERVhfV1JPTkcgPSAoZnVuY3Rpb24gKCkge1xuICB2YXIgcmUxID0gL2EvLFxuICAgICAgcmUyID0gL2IqL2c7XG4gIG5hdGl2ZUV4ZWMuY2FsbChyZTEsICdhJyk7XG4gIG5hdGl2ZUV4ZWMuY2FsbChyZTIsICdhJyk7XG4gIHJldHVybiByZTFbTEFTVF9JTkRFWF0gIT09IDAgfHwgcmUyW0xBU1RfSU5ERVhdICE9PSAwO1xufSkoKTtcblxuLy8gbm9ucGFydGljaXBhdGluZyBjYXB0dXJpbmcgZ3JvdXAsIGNvcGllZCBmcm9tIGVzNS1zaGltJ3MgU3RyaW5nI3NwbGl0IHBhdGNoLlxudmFyIE5QQ0dfSU5DTFVERUQgPSAvKCk/Py8uZXhlYygnJylbMV0gIT09IHVuZGVmaW5lZDtcblxudmFyIFBBVENIID0gVVBEQVRFU19MQVNUX0lOREVYX1dST05HIHx8IE5QQ0dfSU5DTFVERUQ7XG5cbmlmIChQQVRDSCkge1xuICBwYXRjaGVkRXhlYyA9IGZ1bmN0aW9uIGV4ZWMoc3RyKSB7XG4gICAgdmFyIHJlID0gdGhpcztcbiAgICB2YXIgbGFzdEluZGV4LCByZUNvcHksIG1hdGNoLCBpO1xuXG4gICAgaWYgKE5QQ0dfSU5DTFVERUQpIHtcbiAgICAgIHJlQ29weSA9IG5ldyBSZWdFeHAoJ14nICsgcmUuc291cmNlICsgJyQoPyFcXFxccyknLCByZWdleHBGbGFncy5jYWxsKHJlKSk7XG4gICAgfVxuICAgIGlmIChVUERBVEVTX0xBU1RfSU5ERVhfV1JPTkcpIGxhc3RJbmRleCA9IHJlW0xBU1RfSU5ERVhdO1xuXG4gICAgbWF0Y2ggPSBuYXRpdmVFeGVjLmNhbGwocmUsIHN0cik7XG5cbiAgICBpZiAoVVBEQVRFU19MQVNUX0lOREVYX1dST05HICYmIG1hdGNoKSB7XG4gICAgICByZVtMQVNUX0lOREVYXSA9IHJlLmdsb2JhbCA/IG1hdGNoLmluZGV4ICsgbWF0Y2hbMF0ubGVuZ3RoIDogbGFzdEluZGV4O1xuICAgIH1cbiAgICBpZiAoTlBDR19JTkNMVURFRCAmJiBtYXRjaCAmJiBtYXRjaC5sZW5ndGggPiAxKSB7XG4gICAgICAvLyBGaXggYnJvd3NlcnMgd2hvc2UgYGV4ZWNgIG1ldGhvZHMgZG9uJ3QgY29uc2lzdGVudGx5IHJldHVybiBgdW5kZWZpbmVkYFxuICAgICAgLy8gZm9yIE5QQ0csIGxpa2UgSUU4LiBOT1RFOiBUaGlzIGRvZXNuJyB3b3JrIGZvciAvKC4/KT8vXG4gICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tbG9vcC1mdW5jXG4gICAgICBuYXRpdmVSZXBsYWNlLmNhbGwobWF0Y2hbMF0sIHJlQ29weSwgZnVuY3Rpb24gKCkge1xuICAgICAgICBmb3IgKGkgPSAxOyBpIDwgYXJndW1lbnRzLmxlbmd0aCAtIDI7IGkrKykge1xuICAgICAgICAgIGlmIChhcmd1bWVudHNbaV0gPT09IHVuZGVmaW5lZCkgbWF0Y2hbaV0gPSB1bmRlZmluZWQ7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cblxuICAgIHJldHVybiBtYXRjaDtcbiAgfTtcbn1cblxubW9kdWxlLmV4cG9ydHMgPSBwYXRjaGVkRXhlYztcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Iiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///82\n")},function(module,exports,__webpack_require__){"use strict";eval("\nvar at = __webpack_require__(72)(true);\n\n // `AdvanceStringIndex` abstract operation\n// https://tc39.github.io/ecma262/#sec-advancestringindex\nmodule.exports = function (S, index, unicode) {\n  return index + (unicode ? at(S, index).length : 1);\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiODMuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9bbmFtZV0vLi9ub2RlX21vZHVsZXMvY29yZS1qcy9tb2R1bGVzL19hZHZhbmNlLXN0cmluZy1pbmRleC5qcz8wMzkwIl0sInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcbnZhciBhdCA9IHJlcXVpcmUoJy4vX3N0cmluZy1hdCcpKHRydWUpO1xuXG4gLy8gYEFkdmFuY2VTdHJpbmdJbmRleGAgYWJzdHJhY3Qgb3BlcmF0aW9uXG4vLyBodHRwczovL3RjMzkuZ2l0aHViLmlvL2VjbWEyNjIvI3NlYy1hZHZhbmNlc3RyaW5naW5kZXhcbm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKFMsIGluZGV4LCB1bmljb2RlKSB7XG4gIHJldHVybiBpbmRleCArICh1bmljb2RlID8gYXQoUywgaW5kZXgpLmxlbmd0aCA6IDEpO1xufTtcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///83\n")},function(module,exports,__webpack_require__){eval("var ctx = __webpack_require__(18);\nvar invoke = __webpack_require__(99);\nvar html = __webpack_require__(65);\nvar cel = __webpack_require__(61);\nvar global = __webpack_require__(2);\nvar process = global.process;\nvar setTask = global.setImmediate;\nvar clearTask = global.clearImmediate;\nvar MessageChannel = global.MessageChannel;\nvar Dispatch = global.Dispatch;\nvar counter = 0;\nvar queue = {};\nvar ONREADYSTATECHANGE = 'onreadystatechange';\nvar defer, channel, port;\nvar run = function () {\n  var id = +this;\n  // eslint-disable-next-line no-prototype-builtins\n  if (queue.hasOwnProperty(id)) {\n    var fn = queue[id];\n    delete queue[id];\n    fn();\n  }\n};\nvar listener = function (event) {\n  run.call(event.data);\n};\n// Node.js 0.9+ & IE10+ has setImmediate, otherwise:\nif (!setTask || !clearTask) {\n  setTask = function setImmediate(fn) {\n    var args = [];\n    var i = 1;\n    while (arguments.length > i) args.push(arguments[i++]);\n    queue[++counter] = function () {\n      // eslint-disable-next-line no-new-func\n      invoke(typeof fn == 'function' ? fn : Function(fn), args);\n    };\n    defer(counter);\n    return counter;\n  };\n  clearTask = function clearImmediate(id) {\n    delete queue[id];\n  };\n  // Node.js 0.8-\n  if (__webpack_require__(24)(process) == 'process') {\n    defer = function (id) {\n      process.nextTick(ctx(run, id, 1));\n    };\n  // Sphere (JS game engine) Dispatch API\n  } else if (Dispatch && Dispatch.now) {\n    defer = function (id) {\n      Dispatch.now(ctx(run, id, 1));\n    };\n  // Browsers with MessageChannel, includes WebWorkers\n  } else if (MessageChannel) {\n    channel = new MessageChannel();\n    port = channel.port2;\n    channel.port1.onmessage = listener;\n    defer = ctx(port.postMessage, port, 1);\n  // Browsers with postMessage, skip WebWorkers\n  // IE8 has postMessage, but it's sync & typeof its postMessage is 'object'\n  } else if (global.addEventListener && typeof postMessage == 'function' && !global.importScripts) {\n    defer = function (id) {\n      global.postMessage(id + '', '*');\n    };\n    global.addEventListener('message', listener, false);\n  // IE8-\n  } else if (ONREADYSTATECHANGE in cel('script')) {\n    defer = function (id) {\n      html.appendChild(cel('script'))[ONREADYSTATECHANGE] = function () {\n        html.removeChild(this);\n        run.call(id);\n      };\n    };\n  // Rest old browsers\n  } else {\n    defer = function (id) {\n      setTimeout(ctx(run, id, 1), 0);\n    };\n  }\n}\nmodule.exports = {\n  set: setTask,\n  clear: clearTask\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiODQuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9bbmFtZV0vLi9ub2RlX21vZHVsZXMvY29yZS1qcy9tb2R1bGVzL190YXNrLmpzPzE5OTEiXSwic291cmNlc0NvbnRlbnQiOlsidmFyIGN0eCA9IHJlcXVpcmUoJy4vX2N0eCcpO1xudmFyIGludm9rZSA9IHJlcXVpcmUoJy4vX2ludm9rZScpO1xudmFyIGh0bWwgPSByZXF1aXJlKCcuL19odG1sJyk7XG52YXIgY2VsID0gcmVxdWlyZSgnLi9fZG9tLWNyZWF0ZScpO1xudmFyIGdsb2JhbCA9IHJlcXVpcmUoJy4vX2dsb2JhbCcpO1xudmFyIHByb2Nlc3MgPSBnbG9iYWwucHJvY2VzcztcbnZhciBzZXRUYXNrID0gZ2xvYmFsLnNldEltbWVkaWF0ZTtcbnZhciBjbGVhclRhc2sgPSBnbG9iYWwuY2xlYXJJbW1lZGlhdGU7XG52YXIgTWVzc2FnZUNoYW5uZWwgPSBnbG9iYWwuTWVzc2FnZUNoYW5uZWw7XG52YXIgRGlzcGF0Y2ggPSBnbG9iYWwuRGlzcGF0Y2g7XG52YXIgY291bnRlciA9IDA7XG52YXIgcXVldWUgPSB7fTtcbnZhciBPTlJFQURZU1RBVEVDSEFOR0UgPSAnb25yZWFkeXN0YXRlY2hhbmdlJztcbnZhciBkZWZlciwgY2hhbm5lbCwgcG9ydDtcbnZhciBydW4gPSBmdW5jdGlvbiAoKSB7XG4gIHZhciBpZCA9ICt0aGlzO1xuICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tcHJvdG90eXBlLWJ1aWx0aW5zXG4gIGlmIChxdWV1ZS5oYXNPd25Qcm9wZXJ0eShpZCkpIHtcbiAgICB2YXIgZm4gPSBxdWV1ZVtpZF07XG4gICAgZGVsZXRlIHF1ZXVlW2lkXTtcbiAgICBmbigpO1xuICB9XG59O1xudmFyIGxpc3RlbmVyID0gZnVuY3Rpb24gKGV2ZW50KSB7XG4gIHJ1bi5jYWxsKGV2ZW50LmRhdGEpO1xufTtcbi8vIE5vZGUuanMgMC45KyAmIElFMTArIGhhcyBzZXRJbW1lZGlhdGUsIG90aGVyd2lzZTpcbmlmICghc2V0VGFzayB8fCAhY2xlYXJUYXNrKSB7XG4gIHNldFRhc2sgPSBmdW5jdGlvbiBzZXRJbW1lZGlhdGUoZm4pIHtcbiAgICB2YXIgYXJncyA9IFtdO1xuICAgIHZhciBpID0gMTtcbiAgICB3aGlsZSAoYXJndW1lbnRzLmxlbmd0aCA+IGkpIGFyZ3MucHVzaChhcmd1bWVudHNbaSsrXSk7XG4gICAgcXVldWVbKytjb3VudGVyXSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1uZXctZnVuY1xuICAgICAgaW52b2tlKHR5cGVvZiBmbiA9PSAnZnVuY3Rpb24nID8gZm4gOiBGdW5jdGlvbihmbiksIGFyZ3MpO1xuICAgIH07XG4gICAgZGVmZXIoY291bnRlcik7XG4gICAgcmV0dXJuIGNvdW50ZXI7XG4gIH07XG4gIGNsZWFyVGFzayA9IGZ1bmN0aW9uIGNsZWFySW1tZWRpYXRlKGlkKSB7XG4gICAgZGVsZXRlIHF1ZXVlW2lkXTtcbiAgfTtcbiAgLy8gTm9kZS5qcyAwLjgtXG4gIGlmIChyZXF1aXJlKCcuL19jb2YnKShwcm9jZXNzKSA9PSAncHJvY2VzcycpIHtcbiAgICBkZWZlciA9IGZ1bmN0aW9uIChpZCkge1xuICAgICAgcHJvY2Vzcy5uZXh0VGljayhjdHgocnVuLCBpZCwgMSkpO1xuICAgIH07XG4gIC8vIFNwaGVyZSAoSlMgZ2FtZSBlbmdpbmUpIERpc3BhdGNoIEFQSVxuICB9IGVsc2UgaWYgKERpc3BhdGNoICYmIERpc3BhdGNoLm5vdykge1xuICAgIGRlZmVyID0gZnVuY3Rpb24gKGlkKSB7XG4gICAgICBEaXNwYXRjaC5ub3coY3R4KHJ1biwgaWQsIDEpKTtcbiAgICB9O1xuICAvLyBCcm93c2VycyB3aXRoIE1lc3NhZ2VDaGFubmVsLCBpbmNsdWRlcyBXZWJXb3JrZXJzXG4gIH0gZWxzZSBpZiAoTWVzc2FnZUNoYW5uZWwpIHtcbiAgICBjaGFubmVsID0gbmV3IE1lc3NhZ2VDaGFubmVsKCk7XG4gICAgcG9ydCA9IGNoYW5uZWwucG9ydDI7XG4gICAgY2hhbm5lbC5wb3J0MS5vbm1lc3NhZ2UgPSBsaXN0ZW5lcjtcbiAgICBkZWZlciA9IGN0eChwb3J0LnBvc3RNZXNzYWdlLCBwb3J0LCAxKTtcbiAgLy8gQnJvd3NlcnMgd2l0aCBwb3N0TWVzc2FnZSwgc2tpcCBXZWJXb3JrZXJzXG4gIC8vIElFOCBoYXMgcG9zdE1lc3NhZ2UsIGJ1dCBpdCdzIHN5bmMgJiB0eXBlb2YgaXRzIHBvc3RNZXNzYWdlIGlzICdvYmplY3QnXG4gIH0gZWxzZSBpZiAoZ2xvYmFsLmFkZEV2ZW50TGlzdGVuZXIgJiYgdHlwZW9mIHBvc3RNZXNzYWdlID09ICdmdW5jdGlvbicgJiYgIWdsb2JhbC5pbXBvcnRTY3JpcHRzKSB7XG4gICAgZGVmZXIgPSBmdW5jdGlvbiAoaWQpIHtcbiAgICAgIGdsb2JhbC5wb3N0TWVzc2FnZShpZCArICcnLCAnKicpO1xuICAgIH07XG4gICAgZ2xvYmFsLmFkZEV2ZW50TGlzdGVuZXIoJ21lc3NhZ2UnLCBsaXN0ZW5lciwgZmFsc2UpO1xuICAvLyBJRTgtXG4gIH0gZWxzZSBpZiAoT05SRUFEWVNUQVRFQ0hBTkdFIGluIGNlbCgnc2NyaXB0JykpIHtcbiAgICBkZWZlciA9IGZ1bmN0aW9uIChpZCkge1xuICAgICAgaHRtbC5hcHBlbmRDaGlsZChjZWwoJ3NjcmlwdCcpKVtPTlJFQURZU1RBVEVDSEFOR0VdID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBodG1sLnJlbW92ZUNoaWxkKHRoaXMpO1xuICAgICAgICBydW4uY2FsbChpZCk7XG4gICAgICB9O1xuICAgIH07XG4gIC8vIFJlc3Qgb2xkIGJyb3dzZXJzXG4gIH0gZWxzZSB7XG4gICAgZGVmZXIgPSBmdW5jdGlvbiAoaWQpIHtcbiAgICAgIHNldFRpbWVvdXQoY3R4KHJ1biwgaWQsIDEpLCAwKTtcbiAgICB9O1xuICB9XG59XG5tb2R1bGUuZXhwb3J0cyA9IHtcbiAgc2V0OiBzZXRUYXNrLFxuICBjbGVhcjogY2xlYXJUYXNrXG59O1xuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Iiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///84\n")},function(module,exports,__webpack_require__){"use strict";eval("\nvar global = __webpack_require__(2);\nvar DESCRIPTORS = __webpack_require__(9);\nvar LIBRARY = __webpack_require__(31);\nvar $typed = __webpack_require__(60);\nvar hide = __webpack_require__(15);\nvar redefineAll = __webpack_require__(44);\nvar fails = __webpack_require__(3);\nvar anInstance = __webpack_require__(43);\nvar toInteger = __webpack_require__(20);\nvar toLength = __webpack_require__(7);\nvar toIndex = __webpack_require__(118);\nvar gOPN = __webpack_require__(35).f;\nvar dP = __webpack_require__(10).f;\nvar arrayFill = __webpack_require__(80);\nvar setToStringTag = __webpack_require__(39);\nvar ARRAY_BUFFER = 'ArrayBuffer';\nvar DATA_VIEW = 'DataView';\nvar PROTOTYPE = 'prototype';\nvar WRONG_LENGTH = 'Wrong length!';\nvar WRONG_INDEX = 'Wrong index!';\nvar $ArrayBuffer = global[ARRAY_BUFFER];\nvar $DataView = global[DATA_VIEW];\nvar Math = global.Math;\nvar RangeError = global.RangeError;\n// eslint-disable-next-line no-shadow-restricted-names\nvar Infinity = global.Infinity;\nvar BaseBuffer = $ArrayBuffer;\nvar abs = Math.abs;\nvar pow = Math.pow;\nvar floor = Math.floor;\nvar log = Math.log;\nvar LN2 = Math.LN2;\nvar BUFFER = 'buffer';\nvar BYTE_LENGTH = 'byteLength';\nvar BYTE_OFFSET = 'byteOffset';\nvar $BUFFER = DESCRIPTORS ? '_b' : BUFFER;\nvar $LENGTH = DESCRIPTORS ? '_l' : BYTE_LENGTH;\nvar $OFFSET = DESCRIPTORS ? '_o' : BYTE_OFFSET;\n\n// IEEE754 conversions based on https://github.com/feross/ieee754\nfunction packIEEE754(value, mLen, nBytes) {\n  var buffer = new Array(nBytes);\n  var eLen = nBytes * 8 - mLen - 1;\n  var eMax = (1 << eLen) - 1;\n  var eBias = eMax >> 1;\n  var rt = mLen === 23 ? pow(2, -24) - pow(2, -77) : 0;\n  var i = 0;\n  var s = value < 0 || value === 0 && 1 / value < 0 ? 1 : 0;\n  var e, m, c;\n  value = abs(value);\n  // eslint-disable-next-line no-self-compare\n  if (value != value || value === Infinity) {\n    // eslint-disable-next-line no-self-compare\n    m = value != value ? 1 : 0;\n    e = eMax;\n  } else {\n    e = floor(log(value) / LN2);\n    if (value * (c = pow(2, -e)) < 1) {\n      e--;\n      c *= 2;\n    }\n    if (e + eBias >= 1) {\n      value += rt / c;\n    } else {\n      value += rt * pow(2, 1 - eBias);\n    }\n    if (value * c >= 2) {\n      e++;\n      c /= 2;\n    }\n    if (e + eBias >= eMax) {\n      m = 0;\n      e = eMax;\n    } else if (e + eBias >= 1) {\n      m = (value * c - 1) * pow(2, mLen);\n      e = e + eBias;\n    } else {\n      m = value * pow(2, eBias - 1) * pow(2, mLen);\n      e = 0;\n    }\n  }\n  for (; mLen >= 8; buffer[i++] = m & 255, m /= 256, mLen -= 8);\n  e = e << mLen | m;\n  eLen += mLen;\n  for (; eLen > 0; buffer[i++] = e & 255, e /= 256, eLen -= 8);\n  buffer[--i] |= s * 128;\n  return buffer;\n}\nfunction unpackIEEE754(buffer, mLen, nBytes) {\n  var eLen = nBytes * 8 - mLen - 1;\n  var eMax = (1 << eLen) - 1;\n  var eBias = eMax >> 1;\n  var nBits = eLen - 7;\n  var i = nBytes - 1;\n  var s = buffer[i--];\n  var e = s & 127;\n  var m;\n  s >>= 7;\n  for (; nBits > 0; e = e * 256 + buffer[i], i--, nBits -= 8);\n  m = e & (1 << -nBits) - 1;\n  e >>= -nBits;\n  nBits += mLen;\n  for (; nBits > 0; m = m * 256 + buffer[i], i--, nBits -= 8);\n  if (e === 0) {\n    e = 1 - eBias;\n  } else if (e === eMax) {\n    return m ? NaN : s ? -Infinity : Infinity;\n  } else {\n    m = m + pow(2, mLen);\n    e = e - eBias;\n  } return (s ? -1 : 1) * m * pow(2, e - mLen);\n}\n\nfunction unpackI32(bytes) {\n  return bytes[3] << 24 | bytes[2] << 16 | bytes[1] << 8 | bytes[0];\n}\nfunction packI8(it) {\n  return [it & 0xff];\n}\nfunction packI16(it) {\n  return [it & 0xff, it >> 8 & 0xff];\n}\nfunction packI32(it) {\n  return [it & 0xff, it >> 8 & 0xff, it >> 16 & 0xff, it >> 24 & 0xff];\n}\nfunction packF64(it) {\n  return packIEEE754(it, 52, 8);\n}\nfunction packF32(it) {\n  return packIEEE754(it, 23, 4);\n}\n\nfunction addGetter(C, key, internal) {\n  dP(C[PROTOTYPE], key, { get: function () { return this[internal]; } });\n}\n\nfunction get(view, bytes, index, isLittleEndian) {\n  var numIndex = +index;\n  var intIndex = toIndex(numIndex);\n  if (intIndex + bytes > view[$LENGTH]) throw RangeError(WRONG_INDEX);\n  var store = view[$BUFFER]._b;\n  var start = intIndex + view[$OFFSET];\n  var pack = store.slice(start, start + bytes);\n  return isLittleEndian ? pack : pack.reverse();\n}\nfunction set(view, bytes, index, conversion, value, isLittleEndian) {\n  var numIndex = +index;\n  var intIndex = toIndex(numIndex);\n  if (intIndex + bytes > view[$LENGTH]) throw RangeError(WRONG_INDEX);\n  var store = view[$BUFFER]._b;\n  var start = intIndex + view[$OFFSET];\n  var pack = conversion(+value);\n  for (var i = 0; i < bytes; i++) store[start + i] = pack[isLittleEndian ? i : bytes - i - 1];\n}\n\nif (!$typed.ABV) {\n  $ArrayBuffer = function ArrayBuffer(length) {\n    anInstance(this, $ArrayBuffer, ARRAY_BUFFER);\n    var byteLength = toIndex(length);\n    this._b = arrayFill.call(new Array(byteLength), 0);\n    this[$LENGTH] = byteLength;\n  };\n\n  $DataView = function DataView(buffer, byteOffset, byteLength) {\n    anInstance(this, $DataView, DATA_VIEW);\n    anInstance(buffer, $ArrayBuffer, DATA_VIEW);\n    var bufferLength = buffer[$LENGTH];\n    var offset = toInteger(byteOffset);\n    if (offset < 0 || offset > bufferLength) throw RangeError('Wrong offset!');\n    byteLength = byteLength === undefined ? bufferLength - offset : toLength(byteLength);\n    if (offset + byteLength > bufferLength) throw RangeError(WRONG_LENGTH);\n    this[$BUFFER] = buffer;\n    this[$OFFSET] = offset;\n    this[$LENGTH] = byteLength;\n  };\n\n  if (DESCRIPTORS) {\n    addGetter($ArrayBuffer, BYTE_LENGTH, '_l');\n    addGetter($DataView, BUFFER, '_b');\n    addGetter($DataView, BYTE_LENGTH, '_l');\n    addGetter($DataView, BYTE_OFFSET, '_o');\n  }\n\n  redefineAll($DataView[PROTOTYPE], {\n    getInt8: function getInt8(byteOffset) {\n      return get(this, 1, byteOffset)[0] << 24 >> 24;\n    },\n    getUint8: function getUint8(byteOffset) {\n      return get(this, 1, byteOffset)[0];\n    },\n    getInt16: function getInt16(byteOffset /* , littleEndian */) {\n      var bytes = get(this, 2, byteOffset, arguments[1]);\n      return (bytes[1] << 8 | bytes[0]) << 16 >> 16;\n    },\n    getUint16: function getUint16(byteOffset /* , littleEndian */) {\n      var bytes = get(this, 2, byteOffset, arguments[1]);\n      return bytes[1] << 8 | bytes[0];\n    },\n    getInt32: function getInt32(byteOffset /* , littleEndian */) {\n      return unpackI32(get(this, 4, byteOffset, arguments[1]));\n    },\n    getUint32: function getUint32(byteOffset /* , littleEndian */) {\n      return unpackI32(get(this, 4, byteOffset, arguments[1])) >>> 0;\n    },\n    getFloat32: function getFloat32(byteOffset /* , littleEndian */) {\n      return unpackIEEE754(get(this, 4, byteOffset, arguments[1]), 23, 4);\n    },\n    getFloat64: function getFloat64(byteOffset /* , littleEndian */) {\n      return unpackIEEE754(get(this, 8, byteOffset, arguments[1]), 52, 8);\n    },\n    setInt8: function setInt8(byteOffset, value) {\n      set(this, 1, byteOffset, packI8, value);\n    },\n    setUint8: function setUint8(byteOffset, value) {\n      set(this, 1, byteOffset, packI8, value);\n    },\n    setInt16: function setInt16(byteOffset, value /* , littleEndian */) {\n      set(this, 2, byteOffset, packI16, value, arguments[2]);\n    },\n    setUint16: function setUint16(byteOffset, value /* , littleEndian */) {\n      set(this, 2, byteOffset, packI16, value, arguments[2]);\n    },\n    setInt32: function setInt32(byteOffset, value /* , littleEndian */) {\n      set(this, 4, byteOffset, packI32, value, arguments[2]);\n    },\n    setUint32: function setUint32(byteOffset, value /* , littleEndian */) {\n      set(this, 4, byteOffset, packI32, value, arguments[2]);\n    },\n    setFloat32: function setFloat32(byteOffset, value /* , littleEndian */) {\n      set(this, 4, byteOffset, packF32, value, arguments[2]);\n    },\n    setFloat64: function setFloat64(byteOffset, value /* , littleEndian */) {\n      set(this, 8, byteOffset, packF64, value, arguments[2]);\n    }\n  });\n} else {\n  if (!fails(function () {\n    $ArrayBuffer(1);\n  }) || !fails(function () {\n    new $ArrayBuffer(-1); // eslint-disable-line no-new\n  }) || fails(function () {\n    new $ArrayBuffer(); // eslint-disable-line no-new\n    new $ArrayBuffer(1.5); // eslint-disable-line no-new\n    new $ArrayBuffer(NaN); // eslint-disable-line no-new\n    return $ArrayBuffer.name != ARRAY_BUFFER;\n  })) {\n    $ArrayBuffer = function ArrayBuffer(length) {\n      anInstance(this, $ArrayBuffer);\n      return new BaseBuffer(toIndex(length));\n    };\n    var ArrayBufferProto = $ArrayBuffer[PROTOTYPE] = BaseBuffer[PROTOTYPE];\n    for (var keys = gOPN(BaseBuffer), j = 0, key; keys.length > j;) {\n      if (!((key = keys[j++]) in $ArrayBuffer)) hide($ArrayBuffer, key, BaseBuffer[key]);\n    }\n    if (!LIBRARY) ArrayBufferProto.constructor = $ArrayBuffer;\n  }\n  // iOS Safari 7.x bug\n  var view = new $DataView(new $ArrayBuffer(2));\n  var $setInt8 = $DataView[PROTOTYPE].setInt8;\n  view.setInt8(0, 2147483648);\n  view.setInt8(1, 2147483649);\n  if (view.getInt8(0) || !view.getInt8(1)) redefineAll($DataView[PROTOTYPE], {\n    setInt8: function setInt8(byteOffset, value) {\n      $setInt8.call(this, byteOffset, value << 24 >> 24);\n    },\n    setUint8: function setUint8(byteOffset, value) {\n      $setInt8.call(this, byteOffset, value << 24 >> 24);\n    }\n  }, true);\n}\nsetToStringTag($ArrayBuffer, ARRAY_BUFFER);\nsetToStringTag($DataView, DATA_VIEW);\nhide($DataView[PROTOTYPE], $typed.VIEW, true);\nexports[ARRAY_BUFFER] = $ArrayBuffer;\nexports[DATA_VIEW] = $DataView;\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiODUuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9bbmFtZV0vLi9ub2RlX21vZHVsZXMvY29yZS1qcy9tb2R1bGVzL190eXBlZC1idWZmZXIuanM/ZWQwYiJdLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XG52YXIgZ2xvYmFsID0gcmVxdWlyZSgnLi9fZ2xvYmFsJyk7XG52YXIgREVTQ1JJUFRPUlMgPSByZXF1aXJlKCcuL19kZXNjcmlwdG9ycycpO1xudmFyIExJQlJBUlkgPSByZXF1aXJlKCcuL19saWJyYXJ5Jyk7XG52YXIgJHR5cGVkID0gcmVxdWlyZSgnLi9fdHlwZWQnKTtcbnZhciBoaWRlID0gcmVxdWlyZSgnLi9faGlkZScpO1xudmFyIHJlZGVmaW5lQWxsID0gcmVxdWlyZSgnLi9fcmVkZWZpbmUtYWxsJyk7XG52YXIgZmFpbHMgPSByZXF1aXJlKCcuL19mYWlscycpO1xudmFyIGFuSW5zdGFuY2UgPSByZXF1aXJlKCcuL19hbi1pbnN0YW5jZScpO1xudmFyIHRvSW50ZWdlciA9IHJlcXVpcmUoJy4vX3RvLWludGVnZXInKTtcbnZhciB0b0xlbmd0aCA9IHJlcXVpcmUoJy4vX3RvLWxlbmd0aCcpO1xudmFyIHRvSW5kZXggPSByZXF1aXJlKCcuL190by1pbmRleCcpO1xudmFyIGdPUE4gPSByZXF1aXJlKCcuL19vYmplY3QtZ29wbicpLmY7XG52YXIgZFAgPSByZXF1aXJlKCcuL19vYmplY3QtZHAnKS5mO1xudmFyIGFycmF5RmlsbCA9IHJlcXVpcmUoJy4vX2FycmF5LWZpbGwnKTtcbnZhciBzZXRUb1N0cmluZ1RhZyA9IHJlcXVpcmUoJy4vX3NldC10by1zdHJpbmctdGFnJyk7XG52YXIgQVJSQVlfQlVGRkVSID0gJ0FycmF5QnVmZmVyJztcbnZhciBEQVRBX1ZJRVcgPSAnRGF0YVZpZXcnO1xudmFyIFBST1RPVFlQRSA9ICdwcm90b3R5cGUnO1xudmFyIFdST05HX0xFTkdUSCA9ICdXcm9uZyBsZW5ndGghJztcbnZhciBXUk9OR19JTkRFWCA9ICdXcm9uZyBpbmRleCEnO1xudmFyICRBcnJheUJ1ZmZlciA9IGdsb2JhbFtBUlJBWV9CVUZGRVJdO1xudmFyICREYXRhVmlldyA9IGdsb2JhbFtEQVRBX1ZJRVddO1xudmFyIE1hdGggPSBnbG9iYWwuTWF0aDtcbnZhciBSYW5nZUVycm9yID0gZ2xvYmFsLlJhbmdlRXJyb3I7XG4vLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tc2hhZG93LXJlc3RyaWN0ZWQtbmFtZXNcbnZhciBJbmZpbml0eSA9IGdsb2JhbC5JbmZpbml0eTtcbnZhciBCYXNlQnVmZmVyID0gJEFycmF5QnVmZmVyO1xudmFyIGFicyA9IE1hdGguYWJzO1xudmFyIHBvdyA9IE1hdGgucG93O1xudmFyIGZsb29yID0gTWF0aC5mbG9vcjtcbnZhciBsb2cgPSBNYXRoLmxvZztcbnZhciBMTjIgPSBNYXRoLkxOMjtcbnZhciBCVUZGRVIgPSAnYnVmZmVyJztcbnZhciBCWVRFX0xFTkdUSCA9ICdieXRlTGVuZ3RoJztcbnZhciBCWVRFX09GRlNFVCA9ICdieXRlT2Zmc2V0JztcbnZhciAkQlVGRkVSID0gREVTQ1JJUFRPUlMgPyAnX2InIDogQlVGRkVSO1xudmFyICRMRU5HVEggPSBERVNDUklQVE9SUyA/ICdfbCcgOiBCWVRFX0xFTkdUSDtcbnZhciAkT0ZGU0VUID0gREVTQ1JJUFRPUlMgPyAnX28nIDogQllURV9PRkZTRVQ7XG5cbi8vIElFRUU3NTQgY29udmVyc2lvbnMgYmFzZWQgb24gaHR0cHM6Ly9naXRodWIuY29tL2Zlcm9zcy9pZWVlNzU0XG5mdW5jdGlvbiBwYWNrSUVFRTc1NCh2YWx1ZSwgbUxlbiwgbkJ5dGVzKSB7XG4gIHZhciBidWZmZXIgPSBuZXcgQXJyYXkobkJ5dGVzKTtcbiAgdmFyIGVMZW4gPSBuQnl0ZXMgKiA4IC0gbUxlbiAtIDE7XG4gIHZhciBlTWF4ID0gKDEgPDwgZUxlbikgLSAxO1xuICB2YXIgZUJpYXMgPSBlTWF4ID4+IDE7XG4gIHZhciBydCA9IG1MZW4gPT09IDIzID8gcG93KDIsIC0yNCkgLSBwb3coMiwgLTc3KSA6IDA7XG4gIHZhciBpID0gMDtcbiAgdmFyIHMgPSB2YWx1ZSA8IDAgfHwgdmFsdWUgPT09IDAgJiYgMSAvIHZhbHVlIDwgMCA/IDEgOiAwO1xuICB2YXIgZSwgbSwgYztcbiAgdmFsdWUgPSBhYnModmFsdWUpO1xuICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tc2VsZi1jb21wYXJlXG4gIGlmICh2YWx1ZSAhPSB2YWx1ZSB8fCB2YWx1ZSA9PT0gSW5maW5pdHkpIHtcbiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tc2VsZi1jb21wYXJlXG4gICAgbSA9IHZhbHVlICE9IHZhbHVlID8gMSA6IDA7XG4gICAgZSA9IGVNYXg7XG4gIH0gZWxzZSB7XG4gICAgZSA9IGZsb29yKGxvZyh2YWx1ZSkgLyBMTjIpO1xuICAgIGlmICh2YWx1ZSAqIChjID0gcG93KDIsIC1lKSkgPCAxKSB7XG4gICAgICBlLS07XG4gICAgICBjICo9IDI7XG4gICAgfVxuICAgIGlmIChlICsgZUJpYXMgPj0gMSkge1xuICAgICAgdmFsdWUgKz0gcnQgLyBjO1xuICAgIH0gZWxzZSB7XG4gICAgICB2YWx1ZSArPSBydCAqIHBvdygyLCAxIC0gZUJpYXMpO1xuICAgIH1cbiAgICBpZiAodmFsdWUgKiBjID49IDIpIHtcbiAgICAgIGUrKztcbiAgICAgIGMgLz0gMjtcbiAgICB9XG4gICAgaWYgKGUgKyBlQmlhcyA+PSBlTWF4KSB7XG4gICAgICBtID0gMDtcbiAgICAgIGUgPSBlTWF4O1xuICAgIH0gZWxzZSBpZiAoZSArIGVCaWFzID49IDEpIHtcbiAgICAgIG0gPSAodmFsdWUgKiBjIC0gMSkgKiBwb3coMiwgbUxlbik7XG4gICAgICBlID0gZSArIGVCaWFzO1xuICAgIH0gZWxzZSB7XG4gICAgICBtID0gdmFsdWUgKiBwb3coMiwgZUJpYXMgLSAxKSAqIHBvdygyLCBtTGVuKTtcbiAgICAgIGUgPSAwO1xuICAgIH1cbiAgfVxuICBmb3IgKDsgbUxlbiA+PSA4OyBidWZmZXJbaSsrXSA9IG0gJiAyNTUsIG0gLz0gMjU2LCBtTGVuIC09IDgpO1xuICBlID0gZSA8PCBtTGVuIHwgbTtcbiAgZUxlbiArPSBtTGVuO1xuICBmb3IgKDsgZUxlbiA+IDA7IGJ1ZmZlcltpKytdID0gZSAmIDI1NSwgZSAvPSAyNTYsIGVMZW4gLT0gOCk7XG4gIGJ1ZmZlclstLWldIHw9IHMgKiAxMjg7XG4gIHJldHVybiBidWZmZXI7XG59XG5mdW5jdGlvbiB1bnBhY2tJRUVFNzU0KGJ1ZmZlciwgbUxlbiwgbkJ5dGVzKSB7XG4gIHZhciBlTGVuID0gbkJ5dGVzICogOCAtIG1MZW4gLSAxO1xuICB2YXIgZU1heCA9ICgxIDw8IGVMZW4pIC0gMTtcbiAgdmFyIGVCaWFzID0gZU1heCA+PiAxO1xuICB2YXIgbkJpdHMgPSBlTGVuIC0gNztcbiAgdmFyIGkgPSBuQnl0ZXMgLSAxO1xuICB2YXIgcyA9IGJ1ZmZlcltpLS1dO1xuICB2YXIgZSA9IHMgJiAxMjc7XG4gIHZhciBtO1xuICBzID4+PSA3O1xuICBmb3IgKDsgbkJpdHMgPiAwOyBlID0gZSAqIDI1NiArIGJ1ZmZlcltpXSwgaS0tLCBuQml0cyAtPSA4KTtcbiAgbSA9IGUgJiAoMSA8PCAtbkJpdHMpIC0gMTtcbiAgZSA+Pj0gLW5CaXRzO1xuICBuQml0cyArPSBtTGVuO1xuICBmb3IgKDsgbkJpdHMgPiAwOyBtID0gbSAqIDI1NiArIGJ1ZmZlcltpXSwgaS0tLCBuQml0cyAtPSA4KTtcbiAgaWYgKGUgPT09IDApIHtcbiAgICBlID0gMSAtIGVCaWFzO1xuICB9IGVsc2UgaWYgKGUgPT09IGVNYXgpIHtcbiAgICByZXR1cm4gbSA/IE5hTiA6IHMgPyAtSW5maW5pdHkgOiBJbmZpbml0eTtcbiAgfSBlbHNlIHtcbiAgICBtID0gbSArIHBvdygyLCBtTGVuKTtcbiAgICBlID0gZSAtIGVCaWFzO1xuICB9IHJldHVybiAocyA/IC0xIDogMSkgKiBtICogcG93KDIsIGUgLSBtTGVuKTtcbn1cblxuZnVuY3Rpb24gdW5wYWNrSTMyKGJ5dGVzKSB7XG4gIHJldHVybiBieXRlc1szXSA8PCAyNCB8IGJ5dGVzWzJdIDw8IDE2IHwgYnl0ZXNbMV0gPDwgOCB8IGJ5dGVzWzBdO1xufVxuZnVuY3Rpb24gcGFja0k4KGl0KSB7XG4gIHJldHVybiBbaXQgJiAweGZmXTtcbn1cbmZ1bmN0aW9uIHBhY2tJMTYoaXQpIHtcbiAgcmV0dXJuIFtpdCAmIDB4ZmYsIGl0ID4+IDggJiAweGZmXTtcbn1cbmZ1bmN0aW9uIHBhY2tJMzIoaXQpIHtcbiAgcmV0dXJuIFtpdCAmIDB4ZmYsIGl0ID4+IDggJiAweGZmLCBpdCA+PiAxNiAmIDB4ZmYsIGl0ID4+IDI0ICYgMHhmZl07XG59XG5mdW5jdGlvbiBwYWNrRjY0KGl0KSB7XG4gIHJldHVybiBwYWNrSUVFRTc1NChpdCwgNTIsIDgpO1xufVxuZnVuY3Rpb24gcGFja0YzMihpdCkge1xuICByZXR1cm4gcGFja0lFRUU3NTQoaXQsIDIzLCA0KTtcbn1cblxuZnVuY3Rpb24gYWRkR2V0dGVyKEMsIGtleSwgaW50ZXJuYWwpIHtcbiAgZFAoQ1tQUk9UT1RZUEVdLCBrZXksIHsgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiB0aGlzW2ludGVybmFsXTsgfSB9KTtcbn1cblxuZnVuY3Rpb24gZ2V0KHZpZXcsIGJ5dGVzLCBpbmRleCwgaXNMaXR0bGVFbmRpYW4pIHtcbiAgdmFyIG51bUluZGV4ID0gK2luZGV4O1xuICB2YXIgaW50SW5kZXggPSB0b0luZGV4KG51bUluZGV4KTtcbiAgaWYgKGludEluZGV4ICsgYnl0ZXMgPiB2aWV3WyRMRU5HVEhdKSB0aHJvdyBSYW5nZUVycm9yKFdST05HX0lOREVYKTtcbiAgdmFyIHN0b3JlID0gdmlld1skQlVGRkVSXS5fYjtcbiAgdmFyIHN0YXJ0ID0gaW50SW5kZXggKyB2aWV3WyRPRkZTRVRdO1xuICB2YXIgcGFjayA9IHN0b3JlLnNsaWNlKHN0YXJ0LCBzdGFydCArIGJ5dGVzKTtcbiAgcmV0dXJuIGlzTGl0dGxlRW5kaWFuID8gcGFjayA6IHBhY2sucmV2ZXJzZSgpO1xufVxuZnVuY3Rpb24gc2V0KHZpZXcsIGJ5dGVzLCBpbmRleCwgY29udmVyc2lvbiwgdmFsdWUsIGlzTGl0dGxlRW5kaWFuKSB7XG4gIHZhciBudW1JbmRleCA9ICtpbmRleDtcbiAgdmFyIGludEluZGV4ID0gdG9JbmRleChudW1JbmRleCk7XG4gIGlmIChpbnRJbmRleCArIGJ5dGVzID4gdmlld1skTEVOR1RIXSkgdGhyb3cgUmFuZ2VFcnJvcihXUk9OR19JTkRFWCk7XG4gIHZhciBzdG9yZSA9IHZpZXdbJEJVRkZFUl0uX2I7XG4gIHZhciBzdGFydCA9IGludEluZGV4ICsgdmlld1skT0ZGU0VUXTtcbiAgdmFyIHBhY2sgPSBjb252ZXJzaW9uKCt2YWx1ZSk7XG4gIGZvciAodmFyIGkgPSAwOyBpIDwgYnl0ZXM7IGkrKykgc3RvcmVbc3RhcnQgKyBpXSA9IHBhY2tbaXNMaXR0bGVFbmRpYW4gPyBpIDogYnl0ZXMgLSBpIC0gMV07XG59XG5cbmlmICghJHR5cGVkLkFCVikge1xuICAkQXJyYXlCdWZmZXIgPSBmdW5jdGlvbiBBcnJheUJ1ZmZlcihsZW5ndGgpIHtcbiAgICBhbkluc3RhbmNlKHRoaXMsICRBcnJheUJ1ZmZlciwgQVJSQVlfQlVGRkVSKTtcbiAgICB2YXIgYnl0ZUxlbmd0aCA9IHRvSW5kZXgobGVuZ3RoKTtcbiAgICB0aGlzLl9iID0gYXJyYXlGaWxsLmNhbGwobmV3IEFycmF5KGJ5dGVMZW5ndGgpLCAwKTtcbiAgICB0aGlzWyRMRU5HVEhdID0gYnl0ZUxlbmd0aDtcbiAgfTtcblxuICAkRGF0YVZpZXcgPSBmdW5jdGlvbiBEYXRhVmlldyhidWZmZXIsIGJ5dGVPZmZzZXQsIGJ5dGVMZW5ndGgpIHtcbiAgICBhbkluc3RhbmNlKHRoaXMsICREYXRhVmlldywgREFUQV9WSUVXKTtcbiAgICBhbkluc3RhbmNlKGJ1ZmZlciwgJEFycmF5QnVmZmVyLCBEQVRBX1ZJRVcpO1xuICAgIHZhciBidWZmZXJMZW5ndGggPSBidWZmZXJbJExFTkdUSF07XG4gICAgdmFyIG9mZnNldCA9IHRvSW50ZWdlcihieXRlT2Zmc2V0KTtcbiAgICBpZiAob2Zmc2V0IDwgMCB8fCBvZmZzZXQgPiBidWZmZXJMZW5ndGgpIHRocm93IFJhbmdlRXJyb3IoJ1dyb25nIG9mZnNldCEnKTtcbiAgICBieXRlTGVuZ3RoID0gYnl0ZUxlbmd0aCA9PT0gdW5kZWZpbmVkID8gYnVmZmVyTGVuZ3RoIC0gb2Zmc2V0IDogdG9MZW5ndGgoYnl0ZUxlbmd0aCk7XG4gICAgaWYgKG9mZnNldCArIGJ5dGVMZW5ndGggPiBidWZmZXJMZW5ndGgpIHRocm93IFJhbmdlRXJyb3IoV1JPTkdfTEVOR1RIKTtcbiAgICB0aGlzWyRCVUZGRVJdID0gYnVmZmVyO1xuICAgIHRoaXNbJE9GRlNFVF0gPSBvZmZzZXQ7XG4gICAgdGhpc1skTEVOR1RIXSA9IGJ5dGVMZW5ndGg7XG4gIH07XG5cbiAgaWYgKERFU0NSSVBUT1JTKSB7XG4gICAgYWRkR2V0dGVyKCRBcnJheUJ1ZmZlciwgQllURV9MRU5HVEgsICdfbCcpO1xuICAgIGFkZEdldHRlcigkRGF0YVZpZXcsIEJVRkZFUiwgJ19iJyk7XG4gICAgYWRkR2V0dGVyKCREYXRhVmlldywgQllURV9MRU5HVEgsICdfbCcpO1xuICAgIGFkZEdldHRlcigkRGF0YVZpZXcsIEJZVEVfT0ZGU0VULCAnX28nKTtcbiAgfVxuXG4gIHJlZGVmaW5lQWxsKCREYXRhVmlld1tQUk9UT1RZUEVdLCB7XG4gICAgZ2V0SW50ODogZnVuY3Rpb24gZ2V0SW50OChieXRlT2Zmc2V0KSB7XG4gICAgICByZXR1cm4gZ2V0KHRoaXMsIDEsIGJ5dGVPZmZzZXQpWzBdIDw8IDI0ID4+IDI0O1xuICAgIH0sXG4gICAgZ2V0VWludDg6IGZ1bmN0aW9uIGdldFVpbnQ4KGJ5dGVPZmZzZXQpIHtcbiAgICAgIHJldHVybiBnZXQodGhpcywgMSwgYnl0ZU9mZnNldClbMF07XG4gICAgfSxcbiAgICBnZXRJbnQxNjogZnVuY3Rpb24gZ2V0SW50MTYoYnl0ZU9mZnNldCAvKiAsIGxpdHRsZUVuZGlhbiAqLykge1xuICAgICAgdmFyIGJ5dGVzID0gZ2V0KHRoaXMsIDIsIGJ5dGVPZmZzZXQsIGFyZ3VtZW50c1sxXSk7XG4gICAgICByZXR1cm4gKGJ5dGVzWzFdIDw8IDggfCBieXRlc1swXSkgPDwgMTYgPj4gMTY7XG4gICAgfSxcbiAgICBnZXRVaW50MTY6IGZ1bmN0aW9uIGdldFVpbnQxNihieXRlT2Zmc2V0IC8qICwgbGl0dGxlRW5kaWFuICovKSB7XG4gICAgICB2YXIgYnl0ZXMgPSBnZXQodGhpcywgMiwgYnl0ZU9mZnNldCwgYXJndW1lbnRzWzFdKTtcbiAgICAgIHJldHVybiBieXRlc1sxXSA8PCA4IHwgYnl0ZXNbMF07XG4gICAgfSxcbiAgICBnZXRJbnQzMjogZnVuY3Rpb24gZ2V0SW50MzIoYnl0ZU9mZnNldCAvKiAsIGxpdHRsZUVuZGlhbiAqLykge1xuICAgICAgcmV0dXJuIHVucGFja0kzMihnZXQodGhpcywgNCwgYnl0ZU9mZnNldCwgYXJndW1lbnRzWzFdKSk7XG4gICAgfSxcbiAgICBnZXRVaW50MzI6IGZ1bmN0aW9uIGdldFVpbnQzMihieXRlT2Zmc2V0IC8qICwgbGl0dGxlRW5kaWFuICovKSB7XG4gICAgICByZXR1cm4gdW5wYWNrSTMyKGdldCh0aGlzLCA0LCBieXRlT2Zmc2V0LCBhcmd1bWVudHNbMV0pKSA+Pj4gMDtcbiAgICB9LFxuICAgIGdldEZsb2F0MzI6IGZ1bmN0aW9uIGdldEZsb2F0MzIoYnl0ZU9mZnNldCAvKiAsIGxpdHRsZUVuZGlhbiAqLykge1xuICAgICAgcmV0dXJuIHVucGFja0lFRUU3NTQoZ2V0KHRoaXMsIDQsIGJ5dGVPZmZzZXQsIGFyZ3VtZW50c1sxXSksIDIzLCA0KTtcbiAgICB9LFxuICAgIGdldEZsb2F0NjQ6IGZ1bmN0aW9uIGdldEZsb2F0NjQoYnl0ZU9mZnNldCAvKiAsIGxpdHRsZUVuZGlhbiAqLykge1xuICAgICAgcmV0dXJuIHVucGFja0lFRUU3NTQoZ2V0KHRoaXMsIDgsIGJ5dGVPZmZzZXQsIGFyZ3VtZW50c1sxXSksIDUyLCA4KTtcbiAgICB9LFxuICAgIHNldEludDg6IGZ1bmN0aW9uIHNldEludDgoYnl0ZU9mZnNldCwgdmFsdWUpIHtcbiAgICAgIHNldCh0aGlzLCAxLCBieXRlT2Zmc2V0LCBwYWNrSTgsIHZhbHVlKTtcbiAgICB9LFxuICAgIHNldFVpbnQ4OiBmdW5jdGlvbiBzZXRVaW50OChieXRlT2Zmc2V0LCB2YWx1ZSkge1xuICAgICAgc2V0KHRoaXMsIDEsIGJ5dGVPZmZzZXQsIHBhY2tJOCwgdmFsdWUpO1xuICAgIH0sXG4gICAgc2V0SW50MTY6IGZ1bmN0aW9uIHNldEludDE2KGJ5dGVPZmZzZXQsIHZhbHVlIC8qICwgbGl0dGxlRW5kaWFuICovKSB7XG4gICAgICBzZXQodGhpcywgMiwgYnl0ZU9mZnNldCwgcGFja0kxNiwgdmFsdWUsIGFyZ3VtZW50c1syXSk7XG4gICAgfSxcbiAgICBzZXRVaW50MTY6IGZ1bmN0aW9uIHNldFVpbnQxNihieXRlT2Zmc2V0LCB2YWx1ZSAvKiAsIGxpdHRsZUVuZGlhbiAqLykge1xuICAgICAgc2V0KHRoaXMsIDIsIGJ5dGVPZmZzZXQsIHBhY2tJMTYsIHZhbHVlLCBhcmd1bWVudHNbMl0pO1xuICAgIH0sXG4gICAgc2V0SW50MzI6IGZ1bmN0aW9uIHNldEludDMyKGJ5dGVPZmZzZXQsIHZhbHVlIC8qICwgbGl0dGxlRW5kaWFuICovKSB7XG4gICAgICBzZXQodGhpcywgNCwgYnl0ZU9mZnNldCwgcGFja0kzMiwgdmFsdWUsIGFyZ3VtZW50c1syXSk7XG4gICAgfSxcbiAgICBzZXRVaW50MzI6IGZ1bmN0aW9uIHNldFVpbnQzMihieXRlT2Zmc2V0LCB2YWx1ZSAvKiAsIGxpdHRsZUVuZGlhbiAqLykge1xuICAgICAgc2V0KHRoaXMsIDQsIGJ5dGVPZmZzZXQsIHBhY2tJMzIsIHZhbHVlLCBhcmd1bWVudHNbMl0pO1xuICAgIH0sXG4gICAgc2V0RmxvYXQzMjogZnVuY3Rpb24gc2V0RmxvYXQzMihieXRlT2Zmc2V0LCB2YWx1ZSAvKiAsIGxpdHRsZUVuZGlhbiAqLykge1xuICAgICAgc2V0KHRoaXMsIDQsIGJ5dGVPZmZzZXQsIHBhY2tGMzIsIHZhbHVlLCBhcmd1bWVudHNbMl0pO1xuICAgIH0sXG4gICAgc2V0RmxvYXQ2NDogZnVuY3Rpb24gc2V0RmxvYXQ2NChieXRlT2Zmc2V0LCB2YWx1ZSAvKiAsIGxpdHRsZUVuZGlhbiAqLykge1xuICAgICAgc2V0KHRoaXMsIDgsIGJ5dGVPZmZzZXQsIHBhY2tGNjQsIHZhbHVlLCBhcmd1bWVudHNbMl0pO1xuICAgIH1cbiAgfSk7XG59IGVsc2Uge1xuICBpZiAoIWZhaWxzKGZ1bmN0aW9uICgpIHtcbiAgICAkQXJyYXlCdWZmZXIoMSk7XG4gIH0pIHx8ICFmYWlscyhmdW5jdGlvbiAoKSB7XG4gICAgbmV3ICRBcnJheUJ1ZmZlcigtMSk7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgbm8tbmV3XG4gIH0pIHx8IGZhaWxzKGZ1bmN0aW9uICgpIHtcbiAgICBuZXcgJEFycmF5QnVmZmVyKCk7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgbm8tbmV3XG4gICAgbmV3ICRBcnJheUJ1ZmZlcigxLjUpOyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIG5vLW5ld1xuICAgIG5ldyAkQXJyYXlCdWZmZXIoTmFOKTsgLy8gZXNsaW50LWRpc2FibGUtbGluZSBuby1uZXdcbiAgICByZXR1cm4gJEFycmF5QnVmZmVyLm5hbWUgIT0gQVJSQVlfQlVGRkVSO1xuICB9KSkge1xuICAgICRBcnJheUJ1ZmZlciA9IGZ1bmN0aW9uIEFycmF5QnVmZmVyKGxlbmd0aCkge1xuICAgICAgYW5JbnN0YW5jZSh0aGlzLCAkQXJyYXlCdWZmZXIpO1xuICAgICAgcmV0dXJuIG5ldyBCYXNlQnVmZmVyKHRvSW5kZXgobGVuZ3RoKSk7XG4gICAgfTtcbiAgICB2YXIgQXJyYXlCdWZmZXJQcm90byA9ICRBcnJheUJ1ZmZlcltQUk9UT1RZUEVdID0gQmFzZUJ1ZmZlcltQUk9UT1RZUEVdO1xuICAgIGZvciAodmFyIGtleXMgPSBnT1BOKEJhc2VCdWZmZXIpLCBqID0gMCwga2V5OyBrZXlzLmxlbmd0aCA+IGo7KSB7XG4gICAgICBpZiAoISgoa2V5ID0ga2V5c1tqKytdKSBpbiAkQXJyYXlCdWZmZXIpKSBoaWRlKCRBcnJheUJ1ZmZlciwga2V5LCBCYXNlQnVmZmVyW2tleV0pO1xuICAgIH1cbiAgICBpZiAoIUxJQlJBUlkpIEFycmF5QnVmZmVyUHJvdG8uY29uc3RydWN0b3IgPSAkQXJyYXlCdWZmZXI7XG4gIH1cbiAgLy8gaU9TIFNhZmFyaSA3LnggYnVnXG4gIHZhciB2aWV3ID0gbmV3ICREYXRhVmlldyhuZXcgJEFycmF5QnVmZmVyKDIpKTtcbiAgdmFyICRzZXRJbnQ4ID0gJERhdGFWaWV3W1BST1RPVFlQRV0uc2V0SW50ODtcbiAgdmlldy5zZXRJbnQ4KDAsIDIxNDc0ODM2NDgpO1xuICB2aWV3LnNldEludDgoMSwgMjE0NzQ4MzY0OSk7XG4gIGlmICh2aWV3LmdldEludDgoMCkgfHwgIXZpZXcuZ2V0SW50OCgxKSkgcmVkZWZpbmVBbGwoJERhdGFWaWV3W1BST1RPVFlQRV0sIHtcbiAgICBzZXRJbnQ4OiBmdW5jdGlvbiBzZXRJbnQ4KGJ5dGVPZmZzZXQsIHZhbHVlKSB7XG4gICAgICAkc2V0SW50OC5jYWxsKHRoaXMsIGJ5dGVPZmZzZXQsIHZhbHVlIDw8IDI0ID4+IDI0KTtcbiAgICB9LFxuICAgIHNldFVpbnQ4OiBmdW5jdGlvbiBzZXRVaW50OChieXRlT2Zmc2V0LCB2YWx1ZSkge1xuICAgICAgJHNldEludDguY2FsbCh0aGlzLCBieXRlT2Zmc2V0LCB2YWx1ZSA8PCAyNCA+PiAyNCk7XG4gICAgfVxuICB9LCB0cnVlKTtcbn1cbnNldFRvU3RyaW5nVGFnKCRBcnJheUJ1ZmZlciwgQVJSQVlfQlVGRkVSKTtcbnNldFRvU3RyaW5nVGFnKCREYXRhVmlldywgREFUQV9WSUVXKTtcbmhpZGUoJERhdGFWaWV3W1BST1RPVFlQRV0sICR0eXBlZC5WSUVXLCB0cnVlKTtcbmV4cG9ydHNbQVJSQVlfQlVGRkVSXSA9ICRBcnJheUJ1ZmZlcjtcbmV4cG9ydHNbREFUQV9WSUVXXSA9ICREYXRhVmlldztcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///85\n")},function(module,exports){eval("// https://github.com/zloirock/core-js/issues/86#issuecomment-115759028\nvar global = module.exports = typeof window != 'undefined' && window.Math == Math\n  ? window : typeof self != 'undefined' && self.Math == Math ? self\n  // eslint-disable-next-line no-new-func\n  : Function('return this')();\nif (typeof __g == 'number') __g = global; // eslint-disable-line no-undef\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiODYuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9bbmFtZV0vLi9ub2RlX21vZHVsZXMvY29yZS1qcy9saWJyYXJ5L21vZHVsZXMvX2dsb2JhbC5qcz9lNTNkIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIGh0dHBzOi8vZ2l0aHViLmNvbS96bG9pcm9jay9jb3JlLWpzL2lzc3Vlcy84NiNpc3N1ZWNvbW1lbnQtMTE1NzU5MDI4XG52YXIgZ2xvYmFsID0gbW9kdWxlLmV4cG9ydHMgPSB0eXBlb2Ygd2luZG93ICE9ICd1bmRlZmluZWQnICYmIHdpbmRvdy5NYXRoID09IE1hdGhcbiAgPyB3aW5kb3cgOiB0eXBlb2Ygc2VsZiAhPSAndW5kZWZpbmVkJyAmJiBzZWxmLk1hdGggPT0gTWF0aCA/IHNlbGZcbiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLW5ldy1mdW5jXG4gIDogRnVuY3Rpb24oJ3JldHVybiB0aGlzJykoKTtcbmlmICh0eXBlb2YgX19nID09ICdudW1iZXInKSBfX2cgPSBnbG9iYWw7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgbm8tdW5kZWZcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///86\n")},function(module,exports){eval("module.exports = function (it) {\n  return typeof it === 'object' ? it !== null : typeof it === 'function';\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiODcuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9bbmFtZV0vLi9ub2RlX21vZHVsZXMvY29yZS1qcy9saWJyYXJ5L21vZHVsZXMvX2lzLW9iamVjdC5qcz9mNzcyIl0sInNvdXJjZXNDb250ZW50IjpbIm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKGl0KSB7XG4gIHJldHVybiB0eXBlb2YgaXQgPT09ICdvYmplY3QnID8gaXQgIT09IG51bGwgOiB0eXBlb2YgaXQgPT09ICdmdW5jdGlvbic7XG59O1xuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7Iiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///87\n")},function(module,exports,__webpack_require__){eval("// Thank's IE8 for his funny defineProperty\nmodule.exports = !__webpack_require__(123)(function () {\n  return Object.defineProperty({}, 'a', { get: function () { return 7; } }).a != 7;\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiODguanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9bbmFtZV0vLi9ub2RlX21vZHVsZXMvY29yZS1qcy9saWJyYXJ5L21vZHVsZXMvX2Rlc2NyaXB0b3JzLmpzPzhlNjAiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gVGhhbmsncyBJRTggZm9yIGhpcyBmdW5ueSBkZWZpbmVQcm9wZXJ0eVxubW9kdWxlLmV4cG9ydHMgPSAhcmVxdWlyZSgnLi9fZmFpbHMnKShmdW5jdGlvbiAoKSB7XG4gIHJldHVybiBPYmplY3QuZGVmaW5lUHJvcGVydHkoe30sICdhJywgeyBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIDc7IH0gfSkuYSAhPSA3O1xufSk7XG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///88\n")},function(module,exports){eval('//     proxy-observe v0.0.18\r\n//     Copyright (c) 2015, 2016 Simon Y. Blackwell, AnyWhichWay\r\n//     MIT License - http://opensource.org/licenses/mit-license.php\r\n(function() {\r\n\t"use strict";\r\n\t// Creates and returns a Proxy wrapping a target so that all changes can be trapped and forwarded to\r\n\t// a callback. The callback takes an array of changes just like the traditional original Chrome Object.observe\r\n\t// {object:<object changed>,name:<field changed>,type:add|update|delete|reconfigure|preventExtensions|setPrototype,oldValue:<old value if update | delete>}\r\n\t// The acceptlist can be add|update|delete|reconfigure|preventExtensions|setPrototype.\r\n\t// v 0.0.10 to support pausing and restarting observation two additional constructor arguments are available to Object.observe:\r\n\t// pausable - create the Observer so it can be paused\r\n\t// pause - create observer in paused state\r\n\t// if pausable is true then an additional method deliver(ignorePrevious) is available to start delivery\r\n\t// to pause delivery set a property called pause on the function deliver to true\r\n\t// pausable is optional to reduce the chance of shadowing a property or method on any existing code called deliver\r\n\tif(!Object.observe && typeof(Proxy)==="function") {\r\n\t\tfunction Observer(target,callback,acceptlist,pausable,pause,delay) {\r\n\t    \tvar me = this, proxy;\r\n\t    \tfunction deliver(ignorePrevious,delay) {\r\n\t    \t\tdeliver.delay = delay;\r\n\t    \t\tif(!deliver.pause) {\r\n\t        \t\tif(me.changeset.length>0) {\r\n\t        \t\t\tif(!ignorePrevious) {\r\n\t\t    \t    \t\tvar changes = me.changeset.filter(function(change) { return !acceptlist || acceptlist.indexOf(change.type)>=0; });\r\n\t\t        \t\t\tif(changes.length>0) {\r\n\t\t        \t\t\t\tcallback(changes);\r\n\t\t        \t\t\t}\r\n\t        \t\t\t}\r\n\t        \t\t\tme.changeset = [];\r\n\t        \t\t}\r\n\t    \t\t}\r\n\t    \t}\r\n\t    \tdeliver.pause = pause;\r\n\t    \tdeliver.delay = delay;\r\n\t\t    me.get = function(target, property) {\r\n\t\t    \tif(property==="__observer__") {\r\n\t\t    \t\treturn me;\r\n\t\t    \t}\r\n\t\t    \tif(property==="unobserve") {\r\n\t\t    \t\treturn function() {\r\n\t\t    \t\t\tObject.unobserve(target);\r\n\t\t    \t\t\treturn target;\r\n\t\t    \t\t};\r\n\t\t    \t}\r\n\t\t    \tif(property==="deliver") {\r\n\t\t    \t\treturn deliver;\r\n\t\t    \t}\r\n\t\t    \treturn target[property];\r\n\t\t    }\r\n\t    \tme.target = target;\r\n\t    \tme.changeset = [];\r\n\t    \tif(!me.target.__observerCallbacks__) {\r\n\t    \t\t// __observerCallbacks__ is used as an index to get at the proxy which is the observer, so we can unobserve\r\n\t    \t\tObject.defineProperty(target,"__observerCallbacks__",{enumerable:false,configurable:true,writable:false,value:[]});\r\n\t    \t\tObject.defineProperty(target,"__observers__",{enumerable:false,configurable:true,writable:false,value:[]});\r\n\t    \t}\r\n\t    \tme.target.__observerCallbacks__.push(callback);\r\n\t    \tme.target.__observers__.push(this);\r\n\t    \tproxy = new Proxy(target,me);\r\n\t    \tdeliver(false,delay);\r\n\t    \treturn proxy;\r\n\t    }\r\n\t\tObserver.prototype.deliver = function() {\r\n\t\t\treturn this.get(null,"deliver");\r\n\t\t}\r\n\t    Observer.prototype.set = function(target, property, value) { // , receiver\r\n\t    \tvar oldvalue = target[property];\r\n\t    \tvar type = (oldvalue===undefined ? "add" : "update");\r\n\t    \ttarget[property] = value;\r\n\t    \tif(target.__observers__.indexOf(this)>=0 && (!this.acceptlist || this.acceptlist.indexOf(type)>=0)) {\r\n\t        \tvar change = {object:target,name:property,type:type},\r\n\t        \t\tstart = this.changeset.length === 0,\r\n\t        \t\tdeliver = this.deliver();\r\n\t        \tif(type==="update") {\r\n\t        \t\tchange.oldValue = oldvalue;\r\n\t        \t}\r\n\t        \tthis.changeset.push(change);\r\n\t        \tif(start) {\r\n\t        \t\tdeliver(false,(typeof(deliver.delay)==="number" ? deliver.delay : 10));\r\n\t        \t}\r\n\t    \t}\r\n\t    \treturn true;\r\n\t    };\r\n\t    Observer.prototype.deleteProperty = function(target, property) {\r\n\t    \tvar oldvalue = target[property];\r\n\t    \t//if(typeof(oldvalue)!=="undefined") {\r\n\t\t    \tdelete target[property];\r\n\t\t    \tif(target.__observers__.indexOf(this)>=0 && !this.acceptlist || this.acceptlist.indexOf("delete")>=0) {\r\n\t\t        \tvar change = {object:target,name:property,type:"delete",oldValue:oldvalue},\r\n\t\t        \t\tstart = this.changeset.length === 0,\r\n\t\t        \t\tdeliver = this.deliver();\r\n\t\t        \tthis.changeset.push(change);\r\n\t\t        \tif(start) {\r\n\t\t        \t\tdeliver(false,(typeof(deliver.delay)==="number" ? deliver.delay : 10));\r\n\t\t        \t}\r\n\t\t    \t}\r\n\t    \t//}\r\n\t    \treturn true;\r\n\t    };\r\n\t    Observer.prototype.defineProperty = function(target, property, descriptor) {\r\n\t    \tObject.defineProperty(target, property, descriptor);\r\n\t    \tif(target.__observers__.indexOf(this)>=0 && !this.acceptlist || this.acceptlist.indexOf("reconfigure")>=0) {\r\n\t        \tvar change = {object:target,name:property,type:"reconfigure"},\r\n        \t\t\tstart = this.changeset.length === 0,\r\n        \t\t\tdeliver = this.deliver();\r\n\t        \tthis.changeset.push(change);\r\n\t        \tif(start) {\r\n\t        \t\tdeliver(false,(typeof(deliver.delay)==="number" ? deliver.delay : 10));\r\n\t        \t}\r\n\t    \t}\r\n\t    \treturn true;\r\n\t    };\r\n\t    Observer.prototype.setPrototypeOf = function(target, prototype) {\r\n\t    \tvar oldvalue = Object.getPrototypeOf(target);\r\n\t    \tObject.setPrototypeOf(target, prototype);\r\n\t    \tif(target.__observers__.indexOf(this)>=0 && !this.acceptlist || this.acceptlist.indexOf("setPrototype")>=0) {\r\n\t        \tvar change = {object:target,name:"__proto__",type:"setPrototype",oldValue:oldvalue},\r\n    \t\t\t\tstart = this.changeset.length === 0,\r\n    \t\t\t\tdeliver = this.deliver();\r\n\t        \tthis.changeset.push(change);\r\n\t        \tif(start) {\r\n\t        \t\tdeliver(false,(typeof(deliver.delay)==="number" ? deliver.delay : 10));\r\n\t        \t}\r\n\t    \t}\r\n\t    \treturn true;\r\n\t    };\r\n\t    Observer.prototype.preventExtensions = function(target) {\r\n\t        Object.preventExtensions(target);\r\n\t    \tif(target.__observers__.indexOf(this)>=0 && !this.acceptlist || this.acceptlist.indexOf("preventExtensions")>=0) {\r\n\t        \tvar change = {object:target,type:"preventExtensions"},\r\n\t\t\t\t\tstart = this.changeset.length === 0,\r\n\t\t\t\t\tdeliver = this.deliver();\r\n\t        \tthis.changeset.push(change);\r\n\t        \tif(start) {\r\n\t        \t\tdeliver(false,(typeof(deliver.delay)==="number" ? deliver.delay : 10));\r\n\t        \t}\r\n\t    \t}\r\n\t    \treturn true;\r\n\t    };\r\n\t    Object.observe = function(object,callback,acceptlist,pausable,pause,delay) {\r\n\t    \treturn new Observer(object,callback,acceptlist,pausable,pause,delay);\r\n\t    };\r\n\t    Object.unobserve = function(object,callback) {\r\n\t    \tif(object.__observerCallbacks__) {\r\n\t    \t\tif(!callback) {\r\n\t    \t\t\tobject.__observerCallbacks__.splice(0,object.__observerCallbacks__.length);\r\n\t    \t\t\tobject.__observers__.splice(0,object.__observers__.length);\r\n\t    \t\t\treturn;\r\n\t    \t\t}\r\n\t    \t\tobject.__observerCallbacks__.forEach(function(observercallback,i) {\r\n\t    \t\t\tif(callback===observercallback) {\r\n\t    \t\t\t\tobject.__observerCallbacks__.splice(i,1);\r\n\t    \t\t\t\tdelete object.__observers__[i].callback;\r\n\t    \t\t\t\tobject.__observers__.splice(i,1);\r\n\t    \t\t\t}\r\n\t    \t\t});\r\n\t    \t}\r\n\t    };\r\n\t    Array.observe = function(object,callback,acceptlist,pausable,pause,delay) {\r\n\t    \tif(!(object instanceof Array) && !Array.isArray(object)) {\r\n\t    \t\tthrow new TypeError("First argument to Array.observer is not an Array");\r\n\t    \t}\r\n            \tacceptlist = acceptlist || ["add", "update", "delete", "splice"];\r\n\t    \tvar arrayproxy = new Proxy(object,{get: function(target,property) {\r\n\t    \t\tif(property==="unobserve") {\r\n\t\t    \t\treturn function(callback) {\r\n\t\t    \t\t\tif(callback) {\r\n\t\t    \t\t\t\treturn Object.unobserve(target,callback);\r\n\t\t    \t\t\t}\r\n\t\t    \t\t\treturn target.unobserve();\r\n\t\t    \t\t};\r\n\t\t    \t}\r\n\t    \t\tif(property==="splice") {\r\n\t    \t\t\treturn function(start,end) {\r\n\t    \t\t\t\tif(typeof(start)!=="number" || typeof(end)!=="number") {\r\n\t    \t\t\t\t\tthrow new TypeError("First two arguments to Array splice are not number, number");\r\n\t    \t\t\t\t}\r\n\t    \t    \t\tvar removed = this.slice(start,start+end),\r\n\t    \t    \t\t\taddedCount = (arguments.length > 1 ? arguments.length-2 : 0),\r\n\t    \t    \t\t\tchange =  {object:object,type:"splice",index:start,removed:removed,addedCount:addedCount};\r\n\t    \t    \t\ttarget.splice.apply(target,arguments);\r\n\t    \t    \t\tif(acceptlist.indexOf("splice")>=0) {\r\n\t    \t    \t\t\tvar start = proxy.__observer__.changeset.length === 0,\r\n\t    \t        \t\t\tdeliver = proxy.__observer__.deliver();\r\n\t    \t    \t\t\tproxy.__observer__.changeset.push(change);\r\n\t    \t    \t\t\tif(start) {\r\n\t    \t\t        \t\tdeliver(false,(typeof(deliver.delay)==="number" ? deliver.delay : 10));\r\n\t    \t\t        \t}\r\n\t    \t    \t\t}\r\n\t    \t    \t}\r\n\t    \t\t}\r\n\t    \t\tif(property==="push") {\r\n\t    \t\t\t return function(item) {\r\n\t    \t\t    \treturn this.splice(this.length,0,item);\r\n\t    \t\t    }\r\n\t    \t\t}\r\n\t    \t\tif(property==="pop") {\r\n\t    \t\t\t return function() {\r\n\t    \t\t    \treturn this.splice(this.length-1,1);\r\n\t    \t\t    }\r\n\t    \t\t}\r\n\t    \t\tif(property==="unshift") {\r\n\t    \t\t\t return function(item) {\r\n    \t\t    \t\treturn this.splice(0,0,item);\r\n    \t\t    \t}\r\n\t    \t\t}\r\n\t    \t\tif(property==="shift") {\r\n\t    \t\t\treturn function() {\r\n\t    \t    \t\treturn this.splice(0,1);\r\n\t    \t    \t}\r\n\t    \t\t}\r\n\t    \t\treturn target[property];\r\n\t    \t}});\r\n\t    \tvar proxy = Object.observe(arrayproxy,function(changeset) { \r\n\t    \t\tvar changes = changeset.filter(function(change) { return change.name!=="length" && change.name!=="add" && (!acceptlist || acceptlist.indexOf(change.type)>=0); });\r\n\t    \t\tif(changes.length>0) {\r\n\t    \t\t\tcallback(changes);\r\n\t    \t\t}\r\n\t    \t},acceptlist,pausable,pause,delay);\r\n\t    \treturn proxy;\r\n\t    };\r\n\t    Array.unobserve = function(object,callback) {\r\n\t\t  return object.unobserve(callback);\r\n\t    }\r\n\t}\r\n\tObject.deepObserve = function(object,callback,parts) {\r\n\r\n\t\tparts = (parts ? parts : []);\r\n\r\n\t\tvar toTypeName = function(obj) {\r\n\t\t\treturn ({}).toString.call(obj).match(/\\s([a-zA-Z]+)/)[1].toLowerCase()\r\n\t\t}\r\n\r\n\t\tfunction reobserve(value, parts) {\r\n\t\t\tvar keys = Object.keys(value);\r\n\t\t\tkeys.forEach(function(key) {\r\n\t\t\t\tif((toTypeName(value[key]) === \'object\' || toTypeName(value[key]) === \'array\') && !value[key].hasOwnProperty(\'__observers__\')) {\r\n\t\t\t\t\tvar newparts = parts.slice(0);\r\n\t\t\t\t\tnewparts.push(key);\r\n\t\t\t\t\tvalue[key] = Object.deepObserve(value[key],callback,newparts);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\treobserve(object, parts);\r\n\r\n\t\tvar observed = Object.observe(object,function(changeset) {\r\n\t\t\tvar changes = [];\r\n\t\t\tfunction recurse(name,rootObject,oldObject,newObject,path) {\r\n\t\t\t\tif(newObject instanceof Object) {\r\n\t\t\t\t\tvar newkeys = Object.keys(newObject);\r\n\t\t\t\t\tnewkeys.forEach(function(key) {\r\n\t\t\t\t\t\tif(!oldObject || (oldObject[key]!==newObject[key])) {\r\n\t\t\t\t\t\t\tvar oldvalue = (oldObject && oldObject[key]!==undefined ? oldObject[key] : undefined),\r\n\t\t\t\t\t\t\t\tchange = (oldvalue===undefined ? "add" : "update"),\r\n\t\t\t\t\t\t\t\tkeypath = path + "." + key;\r\n\r\n\t\t\t\t\t\t\tchanges.push({name:name,object:rootObject,type:change,oldValue:oldvalue,newValue:newObject[key],keypath:keypath});\r\n\t\t\t\t\t\t\trecurse(name,rootObject,oldvalue,newObject[key],keypath);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t} else if(oldObject instanceof Object) {\r\n\t\t\t\t\tvar oldkeys = Object.keys(oldObject);\r\n\t\t\t\t\toldkeys.forEach(function(key) {\r\n\t\t\t\t\t\tvar change = (newObject===null ? "update" : "delete"),\r\n\t\t\t\t\t\t\tkeypath = path + "." + key;\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\tchanges.push({name:name,object:rootObject,type:change,oldValue:oldObject[key],newValue:newObject,keypath:keypath});\r\n\t\t\t\t\t\trecurse(name,rootObject,oldObject[key],undefined,keypath);\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tchangeset.forEach(function(change) {\r\n\t\t\t\tvar keypath = (parts.length>0 ? parts.join(".") + "." : "") + change.name;\r\n\r\n\t\t\t\tif (change.type === "update" || change.type === "add") { \r\n\t\t\t\t\treobserve(change.object, parts);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tchanges.push({name:change.name,object:change.object,type:change.type,oldValue:change.oldValue,newValue:change.object[change.name],keypath:keypath});\r\n\t\t\t\trecurse(change.name,change.object,change.oldValue,change.object[change.name],keypath);\r\n\t\t\t});\r\n\t\t\tcallback(changes);\r\n\t\t});\r\n\t\treturn observed;\r\n\t};\r\n})();\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiODkuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9bbmFtZV0vLi9ub2RlX21vZHVsZXMvcHJveHktb2JzZXJ2ZS9pbmRleC5qcz85NWViIl0sInNvdXJjZXNDb250ZW50IjpbIi8vICAgICBwcm94eS1vYnNlcnZlIHYwLjAuMThcclxuLy8gICAgIENvcHlyaWdodCAoYykgMjAxNSwgMjAxNiBTaW1vbiBZLiBCbGFja3dlbGwsIEFueVdoaWNoV2F5XHJcbi8vICAgICBNSVQgTGljZW5zZSAtIGh0dHA6Ly9vcGVuc291cmNlLm9yZy9saWNlbnNlcy9taXQtbGljZW5zZS5waHBcclxuKGZ1bmN0aW9uKCkge1xyXG5cdFwidXNlIHN0cmljdFwiO1xyXG5cdC8vIENyZWF0ZXMgYW5kIHJldHVybnMgYSBQcm94eSB3cmFwcGluZyBhIHRhcmdldCBzbyB0aGF0IGFsbCBjaGFuZ2VzIGNhbiBiZSB0cmFwcGVkIGFuZCBmb3J3YXJkZWQgdG9cclxuXHQvLyBhIGNhbGxiYWNrLiBUaGUgY2FsbGJhY2sgdGFrZXMgYW4gYXJyYXkgb2YgY2hhbmdlcyBqdXN0IGxpa2UgdGhlIHRyYWRpdGlvbmFsIG9yaWdpbmFsIENocm9tZSBPYmplY3Qub2JzZXJ2ZVxyXG5cdC8vIHtvYmplY3Q6PG9iamVjdCBjaGFuZ2VkPixuYW1lOjxmaWVsZCBjaGFuZ2VkPix0eXBlOmFkZHx1cGRhdGV8ZGVsZXRlfHJlY29uZmlndXJlfHByZXZlbnRFeHRlbnNpb25zfHNldFByb3RvdHlwZSxvbGRWYWx1ZTo8b2xkIHZhbHVlIGlmIHVwZGF0ZSB8IGRlbGV0ZT59XHJcblx0Ly8gVGhlIGFjY2VwdGxpc3QgY2FuIGJlIGFkZHx1cGRhdGV8ZGVsZXRlfHJlY29uZmlndXJlfHByZXZlbnRFeHRlbnNpb25zfHNldFByb3RvdHlwZS5cclxuXHQvLyB2IDAuMC4xMCB0byBzdXBwb3J0IHBhdXNpbmcgYW5kIHJlc3RhcnRpbmcgb2JzZXJ2YXRpb24gdHdvIGFkZGl0aW9uYWwgY29uc3RydWN0b3IgYXJndW1lbnRzIGFyZSBhdmFpbGFibGUgdG8gT2JqZWN0Lm9ic2VydmU6XHJcblx0Ly8gcGF1c2FibGUgLSBjcmVhdGUgdGhlIE9ic2VydmVyIHNvIGl0IGNhbiBiZSBwYXVzZWRcclxuXHQvLyBwYXVzZSAtIGNyZWF0ZSBvYnNlcnZlciBpbiBwYXVzZWQgc3RhdGVcclxuXHQvLyBpZiBwYXVzYWJsZSBpcyB0cnVlIHRoZW4gYW4gYWRkaXRpb25hbCBtZXRob2QgZGVsaXZlcihpZ25vcmVQcmV2aW91cykgaXMgYXZhaWxhYmxlIHRvIHN0YXJ0IGRlbGl2ZXJ5XHJcblx0Ly8gdG8gcGF1c2UgZGVsaXZlcnkgc2V0IGEgcHJvcGVydHkgY2FsbGVkIHBhdXNlIG9uIHRoZSBmdW5jdGlvbiBkZWxpdmVyIHRvIHRydWVcclxuXHQvLyBwYXVzYWJsZSBpcyBvcHRpb25hbCB0byByZWR1Y2UgdGhlIGNoYW5jZSBvZiBzaGFkb3dpbmcgYSBwcm9wZXJ0eSBvciBtZXRob2Qgb24gYW55IGV4aXN0aW5nIGNvZGUgY2FsbGVkIGRlbGl2ZXJcclxuXHRpZighT2JqZWN0Lm9ic2VydmUgJiYgdHlwZW9mKFByb3h5KT09PVwiZnVuY3Rpb25cIikge1xyXG5cdFx0ZnVuY3Rpb24gT2JzZXJ2ZXIodGFyZ2V0LGNhbGxiYWNrLGFjY2VwdGxpc3QscGF1c2FibGUscGF1c2UsZGVsYXkpIHtcclxuXHQgICAgXHR2YXIgbWUgPSB0aGlzLCBwcm94eTtcclxuXHQgICAgXHRmdW5jdGlvbiBkZWxpdmVyKGlnbm9yZVByZXZpb3VzLGRlbGF5KSB7XHJcblx0ICAgIFx0XHRkZWxpdmVyLmRlbGF5ID0gZGVsYXk7XHJcblx0ICAgIFx0XHRpZighZGVsaXZlci5wYXVzZSkge1xyXG5cdCAgICAgICAgXHRcdGlmKG1lLmNoYW5nZXNldC5sZW5ndGg+MCkge1xyXG5cdCAgICAgICAgXHRcdFx0aWYoIWlnbm9yZVByZXZpb3VzKSB7XHJcblx0XHQgICAgXHQgICAgXHRcdHZhciBjaGFuZ2VzID0gbWUuY2hhbmdlc2V0LmZpbHRlcihmdW5jdGlvbihjaGFuZ2UpIHsgcmV0dXJuICFhY2NlcHRsaXN0IHx8IGFjY2VwdGxpc3QuaW5kZXhPZihjaGFuZ2UudHlwZSk+PTA7IH0pO1xyXG5cdFx0ICAgICAgICBcdFx0XHRpZihjaGFuZ2VzLmxlbmd0aD4wKSB7XHJcblx0XHQgICAgICAgIFx0XHRcdFx0Y2FsbGJhY2soY2hhbmdlcyk7XHJcblx0XHQgICAgICAgIFx0XHRcdH1cclxuXHQgICAgICAgIFx0XHRcdH1cclxuXHQgICAgICAgIFx0XHRcdG1lLmNoYW5nZXNldCA9IFtdO1xyXG5cdCAgICAgICAgXHRcdH1cclxuXHQgICAgXHRcdH1cclxuXHQgICAgXHR9XHJcblx0ICAgIFx0ZGVsaXZlci5wYXVzZSA9IHBhdXNlO1xyXG5cdCAgICBcdGRlbGl2ZXIuZGVsYXkgPSBkZWxheTtcclxuXHRcdCAgICBtZS5nZXQgPSBmdW5jdGlvbih0YXJnZXQsIHByb3BlcnR5KSB7XHJcblx0XHQgICAgXHRpZihwcm9wZXJ0eT09PVwiX19vYnNlcnZlcl9fXCIpIHtcclxuXHRcdCAgICBcdFx0cmV0dXJuIG1lO1xyXG5cdFx0ICAgIFx0fVxyXG5cdFx0ICAgIFx0aWYocHJvcGVydHk9PT1cInVub2JzZXJ2ZVwiKSB7XHJcblx0XHQgICAgXHRcdHJldHVybiBmdW5jdGlvbigpIHtcclxuXHRcdCAgICBcdFx0XHRPYmplY3QudW5vYnNlcnZlKHRhcmdldCk7XHJcblx0XHQgICAgXHRcdFx0cmV0dXJuIHRhcmdldDtcclxuXHRcdCAgICBcdFx0fTtcclxuXHRcdCAgICBcdH1cclxuXHRcdCAgICBcdGlmKHByb3BlcnR5PT09XCJkZWxpdmVyXCIpIHtcclxuXHRcdCAgICBcdFx0cmV0dXJuIGRlbGl2ZXI7XHJcblx0XHQgICAgXHR9XHJcblx0XHQgICAgXHRyZXR1cm4gdGFyZ2V0W3Byb3BlcnR5XTtcclxuXHRcdCAgICB9XHJcblx0ICAgIFx0bWUudGFyZ2V0ID0gdGFyZ2V0O1xyXG5cdCAgICBcdG1lLmNoYW5nZXNldCA9IFtdO1xyXG5cdCAgICBcdGlmKCFtZS50YXJnZXQuX19vYnNlcnZlckNhbGxiYWNrc19fKSB7XHJcblx0ICAgIFx0XHQvLyBfX29ic2VydmVyQ2FsbGJhY2tzX18gaXMgdXNlZCBhcyBhbiBpbmRleCB0byBnZXQgYXQgdGhlIHByb3h5IHdoaWNoIGlzIHRoZSBvYnNlcnZlciwgc28gd2UgY2FuIHVub2JzZXJ2ZVxyXG5cdCAgICBcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCxcIl9fb2JzZXJ2ZXJDYWxsYmFja3NfX1wiLHtlbnVtZXJhYmxlOmZhbHNlLGNvbmZpZ3VyYWJsZTp0cnVlLHdyaXRhYmxlOmZhbHNlLHZhbHVlOltdfSk7XHJcblx0ICAgIFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LFwiX19vYnNlcnZlcnNfX1wiLHtlbnVtZXJhYmxlOmZhbHNlLGNvbmZpZ3VyYWJsZTp0cnVlLHdyaXRhYmxlOmZhbHNlLHZhbHVlOltdfSk7XHJcblx0ICAgIFx0fVxyXG5cdCAgICBcdG1lLnRhcmdldC5fX29ic2VydmVyQ2FsbGJhY2tzX18ucHVzaChjYWxsYmFjayk7XHJcblx0ICAgIFx0bWUudGFyZ2V0Ll9fb2JzZXJ2ZXJzX18ucHVzaCh0aGlzKTtcclxuXHQgICAgXHRwcm94eSA9IG5ldyBQcm94eSh0YXJnZXQsbWUpO1xyXG5cdCAgICBcdGRlbGl2ZXIoZmFsc2UsZGVsYXkpO1xyXG5cdCAgICBcdHJldHVybiBwcm94eTtcclxuXHQgICAgfVxyXG5cdFx0T2JzZXJ2ZXIucHJvdG90eXBlLmRlbGl2ZXIgPSBmdW5jdGlvbigpIHtcclxuXHRcdFx0cmV0dXJuIHRoaXMuZ2V0KG51bGwsXCJkZWxpdmVyXCIpO1xyXG5cdFx0fVxyXG5cdCAgICBPYnNlcnZlci5wcm90b3R5cGUuc2V0ID0gZnVuY3Rpb24odGFyZ2V0LCBwcm9wZXJ0eSwgdmFsdWUpIHsgLy8gLCByZWNlaXZlclxyXG5cdCAgICBcdHZhciBvbGR2YWx1ZSA9IHRhcmdldFtwcm9wZXJ0eV07XHJcblx0ICAgIFx0dmFyIHR5cGUgPSAob2xkdmFsdWU9PT11bmRlZmluZWQgPyBcImFkZFwiIDogXCJ1cGRhdGVcIik7XHJcblx0ICAgIFx0dGFyZ2V0W3Byb3BlcnR5XSA9IHZhbHVlO1xyXG5cdCAgICBcdGlmKHRhcmdldC5fX29ic2VydmVyc19fLmluZGV4T2YodGhpcyk+PTAgJiYgKCF0aGlzLmFjY2VwdGxpc3QgfHwgdGhpcy5hY2NlcHRsaXN0LmluZGV4T2YodHlwZSk+PTApKSB7XHJcblx0ICAgICAgICBcdHZhciBjaGFuZ2UgPSB7b2JqZWN0OnRhcmdldCxuYW1lOnByb3BlcnR5LHR5cGU6dHlwZX0sXHJcblx0ICAgICAgICBcdFx0c3RhcnQgPSB0aGlzLmNoYW5nZXNldC5sZW5ndGggPT09IDAsXHJcblx0ICAgICAgICBcdFx0ZGVsaXZlciA9IHRoaXMuZGVsaXZlcigpO1xyXG5cdCAgICAgICAgXHRpZih0eXBlPT09XCJ1cGRhdGVcIikge1xyXG5cdCAgICAgICAgXHRcdGNoYW5nZS5vbGRWYWx1ZSA9IG9sZHZhbHVlO1xyXG5cdCAgICAgICAgXHR9XHJcblx0ICAgICAgICBcdHRoaXMuY2hhbmdlc2V0LnB1c2goY2hhbmdlKTtcclxuXHQgICAgICAgIFx0aWYoc3RhcnQpIHtcclxuXHQgICAgICAgIFx0XHRkZWxpdmVyKGZhbHNlLCh0eXBlb2YoZGVsaXZlci5kZWxheSk9PT1cIm51bWJlclwiID8gZGVsaXZlci5kZWxheSA6IDEwKSk7XHJcblx0ICAgICAgICBcdH1cclxuXHQgICAgXHR9XHJcblx0ICAgIFx0cmV0dXJuIHRydWU7XHJcblx0ICAgIH07XHJcblx0ICAgIE9ic2VydmVyLnByb3RvdHlwZS5kZWxldGVQcm9wZXJ0eSA9IGZ1bmN0aW9uKHRhcmdldCwgcHJvcGVydHkpIHtcclxuXHQgICAgXHR2YXIgb2xkdmFsdWUgPSB0YXJnZXRbcHJvcGVydHldO1xyXG5cdCAgICBcdC8vaWYodHlwZW9mKG9sZHZhbHVlKSE9PVwidW5kZWZpbmVkXCIpIHtcclxuXHRcdCAgICBcdGRlbGV0ZSB0YXJnZXRbcHJvcGVydHldO1xyXG5cdFx0ICAgIFx0aWYodGFyZ2V0Ll9fb2JzZXJ2ZXJzX18uaW5kZXhPZih0aGlzKT49MCAmJiAhdGhpcy5hY2NlcHRsaXN0IHx8IHRoaXMuYWNjZXB0bGlzdC5pbmRleE9mKFwiZGVsZXRlXCIpPj0wKSB7XHJcblx0XHQgICAgICAgIFx0dmFyIGNoYW5nZSA9IHtvYmplY3Q6dGFyZ2V0LG5hbWU6cHJvcGVydHksdHlwZTpcImRlbGV0ZVwiLG9sZFZhbHVlOm9sZHZhbHVlfSxcclxuXHRcdCAgICAgICAgXHRcdHN0YXJ0ID0gdGhpcy5jaGFuZ2VzZXQubGVuZ3RoID09PSAwLFxyXG5cdFx0ICAgICAgICBcdFx0ZGVsaXZlciA9IHRoaXMuZGVsaXZlcigpO1xyXG5cdFx0ICAgICAgICBcdHRoaXMuY2hhbmdlc2V0LnB1c2goY2hhbmdlKTtcclxuXHRcdCAgICAgICAgXHRpZihzdGFydCkge1xyXG5cdFx0ICAgICAgICBcdFx0ZGVsaXZlcihmYWxzZSwodHlwZW9mKGRlbGl2ZXIuZGVsYXkpPT09XCJudW1iZXJcIiA/IGRlbGl2ZXIuZGVsYXkgOiAxMCkpO1xyXG5cdFx0ICAgICAgICBcdH1cclxuXHRcdCAgICBcdH1cclxuXHQgICAgXHQvL31cclxuXHQgICAgXHRyZXR1cm4gdHJ1ZTtcclxuXHQgICAgfTtcclxuXHQgICAgT2JzZXJ2ZXIucHJvdG90eXBlLmRlZmluZVByb3BlcnR5ID0gZnVuY3Rpb24odGFyZ2V0LCBwcm9wZXJ0eSwgZGVzY3JpcHRvcikge1xyXG5cdCAgICBcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIHByb3BlcnR5LCBkZXNjcmlwdG9yKTtcclxuXHQgICAgXHRpZih0YXJnZXQuX19vYnNlcnZlcnNfXy5pbmRleE9mKHRoaXMpPj0wICYmICF0aGlzLmFjY2VwdGxpc3QgfHwgdGhpcy5hY2NlcHRsaXN0LmluZGV4T2YoXCJyZWNvbmZpZ3VyZVwiKT49MCkge1xyXG5cdCAgICAgICAgXHR2YXIgY2hhbmdlID0ge29iamVjdDp0YXJnZXQsbmFtZTpwcm9wZXJ0eSx0eXBlOlwicmVjb25maWd1cmVcIn0sXHJcbiAgICAgICAgXHRcdFx0c3RhcnQgPSB0aGlzLmNoYW5nZXNldC5sZW5ndGggPT09IDAsXHJcbiAgICAgICAgXHRcdFx0ZGVsaXZlciA9IHRoaXMuZGVsaXZlcigpO1xyXG5cdCAgICAgICAgXHR0aGlzLmNoYW5nZXNldC5wdXNoKGNoYW5nZSk7XHJcblx0ICAgICAgICBcdGlmKHN0YXJ0KSB7XHJcblx0ICAgICAgICBcdFx0ZGVsaXZlcihmYWxzZSwodHlwZW9mKGRlbGl2ZXIuZGVsYXkpPT09XCJudW1iZXJcIiA/IGRlbGl2ZXIuZGVsYXkgOiAxMCkpO1xyXG5cdCAgICAgICAgXHR9XHJcblx0ICAgIFx0fVxyXG5cdCAgICBcdHJldHVybiB0cnVlO1xyXG5cdCAgICB9O1xyXG5cdCAgICBPYnNlcnZlci5wcm90b3R5cGUuc2V0UHJvdG90eXBlT2YgPSBmdW5jdGlvbih0YXJnZXQsIHByb3RvdHlwZSkge1xyXG5cdCAgICBcdHZhciBvbGR2YWx1ZSA9IE9iamVjdC5nZXRQcm90b3R5cGVPZih0YXJnZXQpO1xyXG5cdCAgICBcdE9iamVjdC5zZXRQcm90b3R5cGVPZih0YXJnZXQsIHByb3RvdHlwZSk7XHJcblx0ICAgIFx0aWYodGFyZ2V0Ll9fb2JzZXJ2ZXJzX18uaW5kZXhPZih0aGlzKT49MCAmJiAhdGhpcy5hY2NlcHRsaXN0IHx8IHRoaXMuYWNjZXB0bGlzdC5pbmRleE9mKFwic2V0UHJvdG90eXBlXCIpPj0wKSB7XHJcblx0ICAgICAgICBcdHZhciBjaGFuZ2UgPSB7b2JqZWN0OnRhcmdldCxuYW1lOlwiX19wcm90b19fXCIsdHlwZTpcInNldFByb3RvdHlwZVwiLG9sZFZhbHVlOm9sZHZhbHVlfSxcclxuICAgIFx0XHRcdFx0c3RhcnQgPSB0aGlzLmNoYW5nZXNldC5sZW5ndGggPT09IDAsXHJcbiAgICBcdFx0XHRcdGRlbGl2ZXIgPSB0aGlzLmRlbGl2ZXIoKTtcclxuXHQgICAgICAgIFx0dGhpcy5jaGFuZ2VzZXQucHVzaChjaGFuZ2UpO1xyXG5cdCAgICAgICAgXHRpZihzdGFydCkge1xyXG5cdCAgICAgICAgXHRcdGRlbGl2ZXIoZmFsc2UsKHR5cGVvZihkZWxpdmVyLmRlbGF5KT09PVwibnVtYmVyXCIgPyBkZWxpdmVyLmRlbGF5IDogMTApKTtcclxuXHQgICAgICAgIFx0fVxyXG5cdCAgICBcdH1cclxuXHQgICAgXHRyZXR1cm4gdHJ1ZTtcclxuXHQgICAgfTtcclxuXHQgICAgT2JzZXJ2ZXIucHJvdG90eXBlLnByZXZlbnRFeHRlbnNpb25zID0gZnVuY3Rpb24odGFyZ2V0KSB7XHJcblx0ICAgICAgICBPYmplY3QucHJldmVudEV4dGVuc2lvbnModGFyZ2V0KTtcclxuXHQgICAgXHRpZih0YXJnZXQuX19vYnNlcnZlcnNfXy5pbmRleE9mKHRoaXMpPj0wICYmICF0aGlzLmFjY2VwdGxpc3QgfHwgdGhpcy5hY2NlcHRsaXN0LmluZGV4T2YoXCJwcmV2ZW50RXh0ZW5zaW9uc1wiKT49MCkge1xyXG5cdCAgICAgICAgXHR2YXIgY2hhbmdlID0ge29iamVjdDp0YXJnZXQsdHlwZTpcInByZXZlbnRFeHRlbnNpb25zXCJ9LFxyXG5cdFx0XHRcdFx0c3RhcnQgPSB0aGlzLmNoYW5nZXNldC5sZW5ndGggPT09IDAsXHJcblx0XHRcdFx0XHRkZWxpdmVyID0gdGhpcy5kZWxpdmVyKCk7XHJcblx0ICAgICAgICBcdHRoaXMuY2hhbmdlc2V0LnB1c2goY2hhbmdlKTtcclxuXHQgICAgICAgIFx0aWYoc3RhcnQpIHtcclxuXHQgICAgICAgIFx0XHRkZWxpdmVyKGZhbHNlLCh0eXBlb2YoZGVsaXZlci5kZWxheSk9PT1cIm51bWJlclwiID8gZGVsaXZlci5kZWxheSA6IDEwKSk7XHJcblx0ICAgICAgICBcdH1cclxuXHQgICAgXHR9XHJcblx0ICAgIFx0cmV0dXJuIHRydWU7XHJcblx0ICAgIH07XHJcblx0ICAgIE9iamVjdC5vYnNlcnZlID0gZnVuY3Rpb24ob2JqZWN0LGNhbGxiYWNrLGFjY2VwdGxpc3QscGF1c2FibGUscGF1c2UsZGVsYXkpIHtcclxuXHQgICAgXHRyZXR1cm4gbmV3IE9ic2VydmVyKG9iamVjdCxjYWxsYmFjayxhY2NlcHRsaXN0LHBhdXNhYmxlLHBhdXNlLGRlbGF5KTtcclxuXHQgICAgfTtcclxuXHQgICAgT2JqZWN0LnVub2JzZXJ2ZSA9IGZ1bmN0aW9uKG9iamVjdCxjYWxsYmFjaykge1xyXG5cdCAgICBcdGlmKG9iamVjdC5fX29ic2VydmVyQ2FsbGJhY2tzX18pIHtcclxuXHQgICAgXHRcdGlmKCFjYWxsYmFjaykge1xyXG5cdCAgICBcdFx0XHRvYmplY3QuX19vYnNlcnZlckNhbGxiYWNrc19fLnNwbGljZSgwLG9iamVjdC5fX29ic2VydmVyQ2FsbGJhY2tzX18ubGVuZ3RoKTtcclxuXHQgICAgXHRcdFx0b2JqZWN0Ll9fb2JzZXJ2ZXJzX18uc3BsaWNlKDAsb2JqZWN0Ll9fb2JzZXJ2ZXJzX18ubGVuZ3RoKTtcclxuXHQgICAgXHRcdFx0cmV0dXJuO1xyXG5cdCAgICBcdFx0fVxyXG5cdCAgICBcdFx0b2JqZWN0Ll9fb2JzZXJ2ZXJDYWxsYmFja3NfXy5mb3JFYWNoKGZ1bmN0aW9uKG9ic2VydmVyY2FsbGJhY2ssaSkge1xyXG5cdCAgICBcdFx0XHRpZihjYWxsYmFjaz09PW9ic2VydmVyY2FsbGJhY2spIHtcclxuXHQgICAgXHRcdFx0XHRvYmplY3QuX19vYnNlcnZlckNhbGxiYWNrc19fLnNwbGljZShpLDEpO1xyXG5cdCAgICBcdFx0XHRcdGRlbGV0ZSBvYmplY3QuX19vYnNlcnZlcnNfX1tpXS5jYWxsYmFjaztcclxuXHQgICAgXHRcdFx0XHRvYmplY3QuX19vYnNlcnZlcnNfXy5zcGxpY2UoaSwxKTtcclxuXHQgICAgXHRcdFx0fVxyXG5cdCAgICBcdFx0fSk7XHJcblx0ICAgIFx0fVxyXG5cdCAgICB9O1xyXG5cdCAgICBBcnJheS5vYnNlcnZlID0gZnVuY3Rpb24ob2JqZWN0LGNhbGxiYWNrLGFjY2VwdGxpc3QscGF1c2FibGUscGF1c2UsZGVsYXkpIHtcclxuXHQgICAgXHRpZighKG9iamVjdCBpbnN0YW5jZW9mIEFycmF5KSAmJiAhQXJyYXkuaXNBcnJheShvYmplY3QpKSB7XHJcblx0ICAgIFx0XHR0aHJvdyBuZXcgVHlwZUVycm9yKFwiRmlyc3QgYXJndW1lbnQgdG8gQXJyYXkub2JzZXJ2ZXIgaXMgbm90IGFuIEFycmF5XCIpO1xyXG5cdCAgICBcdH1cclxuICAgICAgICAgICAgXHRhY2NlcHRsaXN0ID0gYWNjZXB0bGlzdCB8fCBbXCJhZGRcIiwgXCJ1cGRhdGVcIiwgXCJkZWxldGVcIiwgXCJzcGxpY2VcIl07XHJcblx0ICAgIFx0dmFyIGFycmF5cHJveHkgPSBuZXcgUHJveHkob2JqZWN0LHtnZXQ6IGZ1bmN0aW9uKHRhcmdldCxwcm9wZXJ0eSkge1xyXG5cdCAgICBcdFx0aWYocHJvcGVydHk9PT1cInVub2JzZXJ2ZVwiKSB7XHJcblx0XHQgICAgXHRcdHJldHVybiBmdW5jdGlvbihjYWxsYmFjaykge1xyXG5cdFx0ICAgIFx0XHRcdGlmKGNhbGxiYWNrKSB7XHJcblx0XHQgICAgXHRcdFx0XHRyZXR1cm4gT2JqZWN0LnVub2JzZXJ2ZSh0YXJnZXQsY2FsbGJhY2spO1xyXG5cdFx0ICAgIFx0XHRcdH1cclxuXHRcdCAgICBcdFx0XHRyZXR1cm4gdGFyZ2V0LnVub2JzZXJ2ZSgpO1xyXG5cdFx0ICAgIFx0XHR9O1xyXG5cdFx0ICAgIFx0fVxyXG5cdCAgICBcdFx0aWYocHJvcGVydHk9PT1cInNwbGljZVwiKSB7XHJcblx0ICAgIFx0XHRcdHJldHVybiBmdW5jdGlvbihzdGFydCxlbmQpIHtcclxuXHQgICAgXHRcdFx0XHRpZih0eXBlb2Yoc3RhcnQpIT09XCJudW1iZXJcIiB8fCB0eXBlb2YoZW5kKSE9PVwibnVtYmVyXCIpIHtcclxuXHQgICAgXHRcdFx0XHRcdHRocm93IG5ldyBUeXBlRXJyb3IoXCJGaXJzdCB0d28gYXJndW1lbnRzIHRvIEFycmF5IHNwbGljZSBhcmUgbm90IG51bWJlciwgbnVtYmVyXCIpO1xyXG5cdCAgICBcdFx0XHRcdH1cclxuXHQgICAgXHQgICAgXHRcdHZhciByZW1vdmVkID0gdGhpcy5zbGljZShzdGFydCxzdGFydCtlbmQpLFxyXG5cdCAgICBcdCAgICBcdFx0XHRhZGRlZENvdW50ID0gKGFyZ3VtZW50cy5sZW5ndGggPiAxID8gYXJndW1lbnRzLmxlbmd0aC0yIDogMCksXHJcblx0ICAgIFx0ICAgIFx0XHRcdGNoYW5nZSA9ICB7b2JqZWN0Om9iamVjdCx0eXBlOlwic3BsaWNlXCIsaW5kZXg6c3RhcnQscmVtb3ZlZDpyZW1vdmVkLGFkZGVkQ291bnQ6YWRkZWRDb3VudH07XHJcblx0ICAgIFx0ICAgIFx0XHR0YXJnZXQuc3BsaWNlLmFwcGx5KHRhcmdldCxhcmd1bWVudHMpO1xyXG5cdCAgICBcdCAgICBcdFx0aWYoYWNjZXB0bGlzdC5pbmRleE9mKFwic3BsaWNlXCIpPj0wKSB7XHJcblx0ICAgIFx0ICAgIFx0XHRcdHZhciBzdGFydCA9IHByb3h5Ll9fb2JzZXJ2ZXJfXy5jaGFuZ2VzZXQubGVuZ3RoID09PSAwLFxyXG5cdCAgICBcdCAgICAgICAgXHRcdFx0ZGVsaXZlciA9IHByb3h5Ll9fb2JzZXJ2ZXJfXy5kZWxpdmVyKCk7XHJcblx0ICAgIFx0ICAgIFx0XHRcdHByb3h5Ll9fb2JzZXJ2ZXJfXy5jaGFuZ2VzZXQucHVzaChjaGFuZ2UpO1xyXG5cdCAgICBcdCAgICBcdFx0XHRpZihzdGFydCkge1xyXG5cdCAgICBcdFx0ICAgICAgICBcdFx0ZGVsaXZlcihmYWxzZSwodHlwZW9mKGRlbGl2ZXIuZGVsYXkpPT09XCJudW1iZXJcIiA/IGRlbGl2ZXIuZGVsYXkgOiAxMCkpO1xyXG5cdCAgICBcdFx0ICAgICAgICBcdH1cclxuXHQgICAgXHQgICAgXHRcdH1cclxuXHQgICAgXHQgICAgXHR9XHJcblx0ICAgIFx0XHR9XHJcblx0ICAgIFx0XHRpZihwcm9wZXJ0eT09PVwicHVzaFwiKSB7XHJcblx0ICAgIFx0XHRcdCByZXR1cm4gZnVuY3Rpb24oaXRlbSkge1xyXG5cdCAgICBcdFx0ICAgIFx0cmV0dXJuIHRoaXMuc3BsaWNlKHRoaXMubGVuZ3RoLDAsaXRlbSk7XHJcblx0ICAgIFx0XHQgICAgfVxyXG5cdCAgICBcdFx0fVxyXG5cdCAgICBcdFx0aWYocHJvcGVydHk9PT1cInBvcFwiKSB7XHJcblx0ICAgIFx0XHRcdCByZXR1cm4gZnVuY3Rpb24oKSB7XHJcblx0ICAgIFx0XHQgICAgXHRyZXR1cm4gdGhpcy5zcGxpY2UodGhpcy5sZW5ndGgtMSwxKTtcclxuXHQgICAgXHRcdCAgICB9XHJcblx0ICAgIFx0XHR9XHJcblx0ICAgIFx0XHRpZihwcm9wZXJ0eT09PVwidW5zaGlmdFwiKSB7XHJcblx0ICAgIFx0XHRcdCByZXR1cm4gZnVuY3Rpb24oaXRlbSkge1xyXG4gICAgXHRcdCAgICBcdFx0cmV0dXJuIHRoaXMuc3BsaWNlKDAsMCxpdGVtKTtcclxuICAgIFx0XHQgICAgXHR9XHJcblx0ICAgIFx0XHR9XHJcblx0ICAgIFx0XHRpZihwcm9wZXJ0eT09PVwic2hpZnRcIikge1xyXG5cdCAgICBcdFx0XHRyZXR1cm4gZnVuY3Rpb24oKSB7XHJcblx0ICAgIFx0ICAgIFx0XHRyZXR1cm4gdGhpcy5zcGxpY2UoMCwxKTtcclxuXHQgICAgXHQgICAgXHR9XHJcblx0ICAgIFx0XHR9XHJcblx0ICAgIFx0XHRyZXR1cm4gdGFyZ2V0W3Byb3BlcnR5XTtcclxuXHQgICAgXHR9fSk7XHJcblx0ICAgIFx0dmFyIHByb3h5ID0gT2JqZWN0Lm9ic2VydmUoYXJyYXlwcm94eSxmdW5jdGlvbihjaGFuZ2VzZXQpIHsgXHJcblx0ICAgIFx0XHR2YXIgY2hhbmdlcyA9IGNoYW5nZXNldC5maWx0ZXIoZnVuY3Rpb24oY2hhbmdlKSB7IHJldHVybiBjaGFuZ2UubmFtZSE9PVwibGVuZ3RoXCIgJiYgY2hhbmdlLm5hbWUhPT1cImFkZFwiICYmICghYWNjZXB0bGlzdCB8fCBhY2NlcHRsaXN0LmluZGV4T2YoY2hhbmdlLnR5cGUpPj0wKTsgfSk7XHJcblx0ICAgIFx0XHRpZihjaGFuZ2VzLmxlbmd0aD4wKSB7XHJcblx0ICAgIFx0XHRcdGNhbGxiYWNrKGNoYW5nZXMpO1xyXG5cdCAgICBcdFx0fVxyXG5cdCAgICBcdH0sYWNjZXB0bGlzdCxwYXVzYWJsZSxwYXVzZSxkZWxheSk7XHJcblx0ICAgIFx0cmV0dXJuIHByb3h5O1xyXG5cdCAgICB9O1xyXG5cdCAgICBBcnJheS51bm9ic2VydmUgPSBmdW5jdGlvbihvYmplY3QsY2FsbGJhY2spIHtcclxuXHRcdCAgcmV0dXJuIG9iamVjdC51bm9ic2VydmUoY2FsbGJhY2spO1xyXG5cdCAgICB9XHJcblx0fVxyXG5cdE9iamVjdC5kZWVwT2JzZXJ2ZSA9IGZ1bmN0aW9uKG9iamVjdCxjYWxsYmFjayxwYXJ0cykge1xyXG5cclxuXHRcdHBhcnRzID0gKHBhcnRzID8gcGFydHMgOiBbXSk7XHJcblxyXG5cdFx0dmFyIHRvVHlwZU5hbWUgPSBmdW5jdGlvbihvYmopIHtcclxuXHRcdFx0cmV0dXJuICh7fSkudG9TdHJpbmcuY2FsbChvYmopLm1hdGNoKC9cXHMoW2EtekEtWl0rKS8pWzFdLnRvTG93ZXJDYXNlKClcclxuXHRcdH1cclxuXHJcblx0XHRmdW5jdGlvbiByZW9ic2VydmUodmFsdWUsIHBhcnRzKSB7XHJcblx0XHRcdHZhciBrZXlzID0gT2JqZWN0LmtleXModmFsdWUpO1xyXG5cdFx0XHRrZXlzLmZvckVhY2goZnVuY3Rpb24oa2V5KSB7XHJcblx0XHRcdFx0aWYoKHRvVHlwZU5hbWUodmFsdWVba2V5XSkgPT09ICdvYmplY3QnIHx8IHRvVHlwZU5hbWUodmFsdWVba2V5XSkgPT09ICdhcnJheScpICYmICF2YWx1ZVtrZXldLmhhc093blByb3BlcnR5KCdfX29ic2VydmVyc19fJykpIHtcclxuXHRcdFx0XHRcdHZhciBuZXdwYXJ0cyA9IHBhcnRzLnNsaWNlKDApO1xyXG5cdFx0XHRcdFx0bmV3cGFydHMucHVzaChrZXkpO1xyXG5cdFx0XHRcdFx0dmFsdWVba2V5XSA9IE9iamVjdC5kZWVwT2JzZXJ2ZSh2YWx1ZVtrZXldLGNhbGxiYWNrLG5ld3BhcnRzKTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH0pO1xyXG5cdFx0fVxyXG5cclxuXHRcdHJlb2JzZXJ2ZShvYmplY3QsIHBhcnRzKTtcclxuXHJcblx0XHR2YXIgb2JzZXJ2ZWQgPSBPYmplY3Qub2JzZXJ2ZShvYmplY3QsZnVuY3Rpb24oY2hhbmdlc2V0KSB7XHJcblx0XHRcdHZhciBjaGFuZ2VzID0gW107XHJcblx0XHRcdGZ1bmN0aW9uIHJlY3Vyc2UobmFtZSxyb290T2JqZWN0LG9sZE9iamVjdCxuZXdPYmplY3QscGF0aCkge1xyXG5cdFx0XHRcdGlmKG5ld09iamVjdCBpbnN0YW5jZW9mIE9iamVjdCkge1xyXG5cdFx0XHRcdFx0dmFyIG5ld2tleXMgPSBPYmplY3Qua2V5cyhuZXdPYmplY3QpO1xyXG5cdFx0XHRcdFx0bmV3a2V5cy5mb3JFYWNoKGZ1bmN0aW9uKGtleSkge1xyXG5cdFx0XHRcdFx0XHRpZighb2xkT2JqZWN0IHx8IChvbGRPYmplY3Rba2V5XSE9PW5ld09iamVjdFtrZXldKSkge1xyXG5cdFx0XHRcdFx0XHRcdHZhciBvbGR2YWx1ZSA9IChvbGRPYmplY3QgJiYgb2xkT2JqZWN0W2tleV0hPT11bmRlZmluZWQgPyBvbGRPYmplY3Rba2V5XSA6IHVuZGVmaW5lZCksXHJcblx0XHRcdFx0XHRcdFx0XHRjaGFuZ2UgPSAob2xkdmFsdWU9PT11bmRlZmluZWQgPyBcImFkZFwiIDogXCJ1cGRhdGVcIiksXHJcblx0XHRcdFx0XHRcdFx0XHRrZXlwYXRoID0gcGF0aCArIFwiLlwiICsga2V5O1xyXG5cclxuXHRcdFx0XHRcdFx0XHRjaGFuZ2VzLnB1c2goe25hbWU6bmFtZSxvYmplY3Q6cm9vdE9iamVjdCx0eXBlOmNoYW5nZSxvbGRWYWx1ZTpvbGR2YWx1ZSxuZXdWYWx1ZTpuZXdPYmplY3Rba2V5XSxrZXlwYXRoOmtleXBhdGh9KTtcclxuXHRcdFx0XHRcdFx0XHRyZWN1cnNlKG5hbWUscm9vdE9iamVjdCxvbGR2YWx1ZSxuZXdPYmplY3Rba2V5XSxrZXlwYXRoKTtcclxuXHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0fSk7XHJcblx0XHRcdFx0fSBlbHNlIGlmKG9sZE9iamVjdCBpbnN0YW5jZW9mIE9iamVjdCkge1xyXG5cdFx0XHRcdFx0dmFyIG9sZGtleXMgPSBPYmplY3Qua2V5cyhvbGRPYmplY3QpO1xyXG5cdFx0XHRcdFx0b2xka2V5cy5mb3JFYWNoKGZ1bmN0aW9uKGtleSkge1xyXG5cdFx0XHRcdFx0XHR2YXIgY2hhbmdlID0gKG5ld09iamVjdD09PW51bGwgPyBcInVwZGF0ZVwiIDogXCJkZWxldGVcIiksXHJcblx0XHRcdFx0XHRcdFx0a2V5cGF0aCA9IHBhdGggKyBcIi5cIiArIGtleTtcclxuXHRcdFx0XHRcdFx0XHRcclxuXHRcdFx0XHRcdFx0Y2hhbmdlcy5wdXNoKHtuYW1lOm5hbWUsb2JqZWN0OnJvb3RPYmplY3QsdHlwZTpjaGFuZ2Usb2xkVmFsdWU6b2xkT2JqZWN0W2tleV0sbmV3VmFsdWU6bmV3T2JqZWN0LGtleXBhdGg6a2V5cGF0aH0pO1xyXG5cdFx0XHRcdFx0XHRyZWN1cnNlKG5hbWUscm9vdE9iamVjdCxvbGRPYmplY3Rba2V5XSx1bmRlZmluZWQsa2V5cGF0aCk7XHJcblx0XHRcdFx0XHR9KTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdFx0Y2hhbmdlc2V0LmZvckVhY2goZnVuY3Rpb24oY2hhbmdlKSB7XHJcblx0XHRcdFx0dmFyIGtleXBhdGggPSAocGFydHMubGVuZ3RoPjAgPyBwYXJ0cy5qb2luKFwiLlwiKSArIFwiLlwiIDogXCJcIikgKyBjaGFuZ2UubmFtZTtcclxuXHJcblx0XHRcdFx0aWYgKGNoYW5nZS50eXBlID09PSBcInVwZGF0ZVwiIHx8IGNoYW5nZS50eXBlID09PSBcImFkZFwiKSB7IFxyXG5cdFx0XHRcdFx0cmVvYnNlcnZlKGNoYW5nZS5vYmplY3QsIHBhcnRzKTtcclxuXHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdGNoYW5nZXMucHVzaCh7bmFtZTpjaGFuZ2UubmFtZSxvYmplY3Q6Y2hhbmdlLm9iamVjdCx0eXBlOmNoYW5nZS50eXBlLG9sZFZhbHVlOmNoYW5nZS5vbGRWYWx1ZSxuZXdWYWx1ZTpjaGFuZ2Uub2JqZWN0W2NoYW5nZS5uYW1lXSxrZXlwYXRoOmtleXBhdGh9KTtcclxuXHRcdFx0XHRyZWN1cnNlKGNoYW5nZS5uYW1lLGNoYW5nZS5vYmplY3QsY2hhbmdlLm9sZFZhbHVlLGNoYW5nZS5vYmplY3RbY2hhbmdlLm5hbWVdLGtleXBhdGgpO1xyXG5cdFx0XHR9KTtcclxuXHRcdFx0Y2FsbGJhY2soY2hhbmdlcyk7XHJcblx0XHR9KTtcclxuXHRcdHJldHVybiBvYnNlcnZlZDtcclxuXHR9O1xyXG59KSgpO1xyXG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Iiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///89\n')},function(module,exports,__webpack_require__){eval('var __WEBPACK_AMD_DEFINE_FACTORY__, __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/*\r\nAuthor: Geraint Luff and others\r\nYear: 2013\r\n\r\nThis code is released into the "public domain" by its author(s).  Anybody may use, alter and distribute the code without restriction.  The author makes no guarantees, and takes no liability of any kind for use of this code.\r\n\r\nIf you find a bug or make an improvement, it would be courteous to let the author know, but it is not compulsory.\r\n*/\r\n(function (global, factory) {\r\n  if (true) {\r\n    // AMD. Register as an anonymous module.\r\n    !(__WEBPACK_AMD_DEFINE_ARRAY__ = [], __WEBPACK_AMD_DEFINE_FACTORY__ = (factory),\n\t\t\t\t__WEBPACK_AMD_DEFINE_RESULT__ = (typeof __WEBPACK_AMD_DEFINE_FACTORY__ === \'function\' ?\n\t\t\t\t(__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__)) : __WEBPACK_AMD_DEFINE_FACTORY__),\n\t\t\t\t__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\r\n  } else {}\r\n}(this, function () {\r\n\r\n// https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/keys?redirectlocale=en-US&redirectslug=JavaScript%2FReference%2FGlobal_Objects%2FObject%2Fkeys\r\nif (!Object.keys) {\r\n\tObject.keys = (function () {\r\n\t\tvar hasOwnProperty = Object.prototype.hasOwnProperty,\r\n\t\t\thasDontEnumBug = !({toString: null}).propertyIsEnumerable(\'toString\'),\r\n\t\t\tdontEnums = [\r\n\t\t\t\t\'toString\',\r\n\t\t\t\t\'toLocaleString\',\r\n\t\t\t\t\'valueOf\',\r\n\t\t\t\t\'hasOwnProperty\',\r\n\t\t\t\t\'isPrototypeOf\',\r\n\t\t\t\t\'propertyIsEnumerable\',\r\n\t\t\t\t\'constructor\'\r\n\t\t\t],\r\n\t\t\tdontEnumsLength = dontEnums.length;\r\n\r\n\t\treturn function (obj) {\r\n\t\t\tif (typeof obj !== \'object\' && typeof obj !== \'function\' || obj === null) {\r\n\t\t\t\tthrow new TypeError(\'Object.keys called on non-object\');\r\n\t\t\t}\r\n\r\n\t\t\tvar result = [];\r\n\r\n\t\t\tfor (var prop in obj) {\r\n\t\t\t\tif (hasOwnProperty.call(obj, prop)) {\r\n\t\t\t\t\tresult.push(prop);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (hasDontEnumBug) {\r\n\t\t\t\tfor (var i=0; i < dontEnumsLength; i++) {\r\n\t\t\t\t\tif (hasOwnProperty.call(obj, dontEnums[i])) {\r\n\t\t\t\t\t\tresult.push(dontEnums[i]);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn result;\r\n\t\t};\r\n\t})();\r\n}\r\n// https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/create\r\nif (!Object.create) {\r\n\tObject.create = (function(){\r\n\t\tfunction F(){}\r\n\r\n\t\treturn function(o){\r\n\t\t\tif (arguments.length !== 1) {\r\n\t\t\t\tthrow new Error(\'Object.create implementation only accepts one parameter.\');\r\n\t\t\t}\r\n\t\t\tF.prototype = o;\r\n\t\t\treturn new F();\r\n\t\t};\r\n\t})();\r\n}\r\n// https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/isArray?redirectlocale=en-US&redirectslug=JavaScript%2FReference%2FGlobal_Objects%2FArray%2FisArray\r\nif(!Array.isArray) {\r\n\tArray.isArray = function (vArg) {\r\n\t\treturn Object.prototype.toString.call(vArg) === "[object Array]";\r\n\t};\r\n}\r\n// https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/indexOf?redirectlocale=en-US&redirectslug=JavaScript%2FReference%2FGlobal_Objects%2FArray%2FindexOf\r\nif (!Array.prototype.indexOf) {\r\n\tArray.prototype.indexOf = function (searchElement /*, fromIndex */ ) {\r\n\t\tif (this === null) {\r\n\t\t\tthrow new TypeError();\r\n\t\t}\r\n\t\tvar t = Object(this);\r\n\t\tvar len = t.length >>> 0;\r\n\r\n\t\tif (len === 0) {\r\n\t\t\treturn -1;\r\n\t\t}\r\n\t\tvar n = 0;\r\n\t\tif (arguments.length > 1) {\r\n\t\t\tn = Number(arguments[1]);\r\n\t\t\tif (n !== n) { // shortcut for verifying if it\'s NaN\r\n\t\t\t\tn = 0;\r\n\t\t\t} else if (n !== 0 && n !== Infinity && n !== -Infinity) {\r\n\t\t\t\tn = (n > 0 || -1) * Math.floor(Math.abs(n));\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (n >= len) {\r\n\t\t\treturn -1;\r\n\t\t}\r\n\t\tvar k = n >= 0 ? n : Math.max(len - Math.abs(n), 0);\r\n\t\tfor (; k < len; k++) {\r\n\t\t\tif (k in t && t[k] === searchElement) {\r\n\t\t\t\treturn k;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn -1;\r\n\t};\r\n}\r\n\r\n// Grungey Object.isFrozen hack\r\nif (!Object.isFrozen) {\r\n\tObject.isFrozen = function (obj) {\r\n\t\tvar key = "tv4_test_frozen_key";\r\n\t\twhile (obj.hasOwnProperty(key)) {\r\n\t\t\tkey += Math.random();\r\n\t\t}\r\n\t\ttry {\r\n\t\t\tobj[key] = true;\r\n\t\t\tdelete obj[key];\r\n\t\t\treturn false;\r\n\t\t} catch (e) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\t};\r\n}\r\n// Based on: https://github.com/geraintluff/uri-templates, but with all the de-substitution stuff removed\r\n\r\nvar uriTemplateGlobalModifiers = {\r\n\t"+": true,\r\n\t"#": true,\r\n\t".": true,\r\n\t"/": true,\r\n\t";": true,\r\n\t"?": true,\r\n\t"&": true\r\n};\r\nvar uriTemplateSuffices = {\r\n\t"*": true\r\n};\r\n\r\nfunction notReallyPercentEncode(string) {\r\n\treturn encodeURI(string).replace(/%25[0-9][0-9]/g, function (doubleEncoded) {\r\n\t\treturn "%" + doubleEncoded.substring(3);\r\n\t});\r\n}\r\n\r\nfunction uriTemplateSubstitution(spec) {\r\n\tvar modifier = "";\r\n\tif (uriTemplateGlobalModifiers[spec.charAt(0)]) {\r\n\t\tmodifier = spec.charAt(0);\r\n\t\tspec = spec.substring(1);\r\n\t}\r\n\tvar separator = "";\r\n\tvar prefix = "";\r\n\tvar shouldEscape = true;\r\n\tvar showVariables = false;\r\n\tvar trimEmptyString = false;\r\n\tif (modifier === \'+\') {\r\n\t\tshouldEscape = false;\r\n\t} else if (modifier === ".") {\r\n\t\tprefix = ".";\r\n\t\tseparator = ".";\r\n\t} else if (modifier === "/") {\r\n\t\tprefix = "/";\r\n\t\tseparator = "/";\r\n\t} else if (modifier === \'#\') {\r\n\t\tprefix = "#";\r\n\t\tshouldEscape = false;\r\n\t} else if (modifier === \';\') {\r\n\t\tprefix = ";";\r\n\t\tseparator = ";";\r\n\t\tshowVariables = true;\r\n\t\ttrimEmptyString = true;\r\n\t} else if (modifier === \'?\') {\r\n\t\tprefix = "?";\r\n\t\tseparator = "&";\r\n\t\tshowVariables = true;\r\n\t} else if (modifier === \'&\') {\r\n\t\tprefix = "&";\r\n\t\tseparator = "&";\r\n\t\tshowVariables = true;\r\n\t}\r\n\r\n\tvar varNames = [];\r\n\tvar varList = spec.split(",");\r\n\tvar varSpecs = [];\r\n\tvar varSpecMap = {};\r\n\tfor (var i = 0; i < varList.length; i++) {\r\n\t\tvar varName = varList[i];\r\n\t\tvar truncate = null;\r\n\t\tif (varName.indexOf(":") !== -1) {\r\n\t\t\tvar parts = varName.split(":");\r\n\t\t\tvarName = parts[0];\r\n\t\t\ttruncate = parseInt(parts[1], 10);\r\n\t\t}\r\n\t\tvar suffices = {};\r\n\t\twhile (uriTemplateSuffices[varName.charAt(varName.length - 1)]) {\r\n\t\t\tsuffices[varName.charAt(varName.length - 1)] = true;\r\n\t\t\tvarName = varName.substring(0, varName.length - 1);\r\n\t\t}\r\n\t\tvar varSpec = {\r\n\t\t\ttruncate: truncate,\r\n\t\t\tname: varName,\r\n\t\t\tsuffices: suffices\r\n\t\t};\r\n\t\tvarSpecs.push(varSpec);\r\n\t\tvarSpecMap[varName] = varSpec;\r\n\t\tvarNames.push(varName);\r\n\t}\r\n\tvar subFunction = function (valueFunction) {\r\n\t\tvar result = "";\r\n\t\tvar startIndex = 0;\r\n\t\tfor (var i = 0; i < varSpecs.length; i++) {\r\n\t\t\tvar varSpec = varSpecs[i];\r\n\t\t\tvar value = valueFunction(varSpec.name);\r\n\t\t\tif (value === null || value === undefined || (Array.isArray(value) && value.length === 0) || (typeof value === \'object\' && Object.keys(value).length === 0)) {\r\n\t\t\t\tstartIndex++;\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tif (i === startIndex) {\r\n\t\t\t\tresult += prefix;\r\n\t\t\t} else {\r\n\t\t\t\tresult += (separator || ",");\r\n\t\t\t}\r\n\t\t\tif (Array.isArray(value)) {\r\n\t\t\t\tif (showVariables) {\r\n\t\t\t\t\tresult += varSpec.name + "=";\r\n\t\t\t\t}\r\n\t\t\t\tfor (var j = 0; j < value.length; j++) {\r\n\t\t\t\t\tif (j > 0) {\r\n\t\t\t\t\t\tresult += varSpec.suffices[\'*\'] ? (separator || ",") : ",";\r\n\t\t\t\t\t\tif (varSpec.suffices[\'*\'] && showVariables) {\r\n\t\t\t\t\t\t\tresult += varSpec.name + "=";\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tresult += shouldEscape ? encodeURIComponent(value[j]).replace(/!/g, "%21") : notReallyPercentEncode(value[j]);\r\n\t\t\t\t}\r\n\t\t\t} else if (typeof value === "object") {\r\n\t\t\t\tif (showVariables && !varSpec.suffices[\'*\']) {\r\n\t\t\t\t\tresult += varSpec.name + "=";\r\n\t\t\t\t}\r\n\t\t\t\tvar first = true;\r\n\t\t\t\tfor (var key in value) {\r\n\t\t\t\t\tif (!first) {\r\n\t\t\t\t\t\tresult += varSpec.suffices[\'*\'] ? (separator || ",") : ",";\r\n\t\t\t\t\t}\r\n\t\t\t\t\tfirst = false;\r\n\t\t\t\t\tresult += shouldEscape ? encodeURIComponent(key).replace(/!/g, "%21") : notReallyPercentEncode(key);\r\n\t\t\t\t\tresult += varSpec.suffices[\'*\'] ? \'=\' : ",";\r\n\t\t\t\t\tresult += shouldEscape ? encodeURIComponent(value[key]).replace(/!/g, "%21") : notReallyPercentEncode(value[key]);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tif (showVariables) {\r\n\t\t\t\t\tresult += varSpec.name;\r\n\t\t\t\t\tif (!trimEmptyString || value !== "") {\r\n\t\t\t\t\t\tresult += "=";\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif (varSpec.truncate != null) {\r\n\t\t\t\t\tvalue = value.substring(0, varSpec.truncate);\r\n\t\t\t\t}\r\n\t\t\t\tresult += shouldEscape ? encodeURIComponent(value).replace(/!/g, "%21"): notReallyPercentEncode(value);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn result;\r\n\t};\r\n\tsubFunction.varNames = varNames;\r\n\treturn {\r\n\t\tprefix: prefix,\r\n\t\tsubstitution: subFunction\r\n\t};\r\n}\r\n\r\nfunction UriTemplate(template) {\r\n\tif (!(this instanceof UriTemplate)) {\r\n\t\treturn new UriTemplate(template);\r\n\t}\r\n\tvar parts = template.split("{");\r\n\tvar textParts = [parts.shift()];\r\n\tvar prefixes = [];\r\n\tvar substitutions = [];\r\n\tvar varNames = [];\r\n\twhile (parts.length > 0) {\r\n\t\tvar part = parts.shift();\r\n\t\tvar spec = part.split("}")[0];\r\n\t\tvar remainder = part.substring(spec.length + 1);\r\n\t\tvar funcs = uriTemplateSubstitution(spec);\r\n\t\tsubstitutions.push(funcs.substitution);\r\n\t\tprefixes.push(funcs.prefix);\r\n\t\ttextParts.push(remainder);\r\n\t\tvarNames = varNames.concat(funcs.substitution.varNames);\r\n\t}\r\n\tthis.fill = function (valueFunction) {\r\n\t\tvar result = textParts[0];\r\n\t\tfor (var i = 0; i < substitutions.length; i++) {\r\n\t\t\tvar substitution = substitutions[i];\r\n\t\t\tresult += substitution(valueFunction);\r\n\t\t\tresult += textParts[i + 1];\r\n\t\t}\r\n\t\treturn result;\r\n\t};\r\n\tthis.varNames = varNames;\r\n\tthis.template = template;\r\n}\r\nUriTemplate.prototype = {\r\n\ttoString: function () {\r\n\t\treturn this.template;\r\n\t},\r\n\tfillFromObject: function (obj) {\r\n\t\treturn this.fill(function (varName) {\r\n\t\t\treturn obj[varName];\r\n\t\t});\r\n\t}\r\n};\r\nvar ValidatorContext = function ValidatorContext(parent, collectMultiple, errorReporter, checkRecursive, trackUnknownProperties) {\r\n\tthis.missing = [];\r\n\tthis.missingMap = {};\r\n\tthis.formatValidators = parent ? Object.create(parent.formatValidators) : {};\r\n\tthis.schemas = parent ? Object.create(parent.schemas) : {};\r\n\tthis.collectMultiple = collectMultiple;\r\n\tthis.errors = [];\r\n\tthis.handleError = collectMultiple ? this.collectError : this.returnError;\r\n\tif (checkRecursive) {\r\n\t\tthis.checkRecursive = true;\r\n\t\tthis.scanned = [];\r\n\t\tthis.scannedFrozen = [];\r\n\t\tthis.scannedFrozenSchemas = [];\r\n\t\tthis.scannedFrozenValidationErrors = [];\r\n\t\tthis.validatedSchemasKey = \'tv4_validation_id\';\r\n\t\tthis.validationErrorsKey = \'tv4_validation_errors_id\';\r\n\t}\r\n\tif (trackUnknownProperties) {\r\n\t\tthis.trackUnknownProperties = true;\r\n\t\tthis.knownPropertyPaths = {};\r\n\t\tthis.unknownPropertyPaths = {};\r\n\t}\r\n\tthis.errorReporter = errorReporter || defaultErrorReporter(\'en\');\r\n\tif (typeof this.errorReporter === \'string\') {\r\n\t\tthrow new Error(\'debug\');\r\n\t}\r\n\tthis.definedKeywords = {};\r\n\tif (parent) {\r\n\t\tfor (var key in parent.definedKeywords) {\r\n\t\t\tthis.definedKeywords[key] = parent.definedKeywords[key].slice(0);\r\n\t\t}\r\n\t}\r\n};\r\nValidatorContext.prototype.defineKeyword = function (keyword, keywordFunction) {\r\n\tthis.definedKeywords[keyword] = this.definedKeywords[keyword] || [];\r\n\tthis.definedKeywords[keyword].push(keywordFunction);\r\n};\r\nValidatorContext.prototype.createError = function (code, messageParams, dataPath, schemaPath, subErrors, data, schema) {\r\n\tvar error = new ValidationError(code, messageParams, dataPath, schemaPath, subErrors);\r\n\terror.message = this.errorReporter(error, data, schema);\r\n\treturn error;\r\n};\r\nValidatorContext.prototype.returnError = function (error) {\r\n\treturn error;\r\n};\r\nValidatorContext.prototype.collectError = function (error) {\r\n\tif (error) {\r\n\t\tthis.errors.push(error);\r\n\t}\r\n\treturn null;\r\n};\r\nValidatorContext.prototype.prefixErrors = function (startIndex, dataPath, schemaPath) {\r\n\tfor (var i = startIndex; i < this.errors.length; i++) {\r\n\t\tthis.errors[i] = this.errors[i].prefixWith(dataPath, schemaPath);\r\n\t}\r\n\treturn this;\r\n};\r\nValidatorContext.prototype.banUnknownProperties = function (data, schema) {\r\n\tfor (var unknownPath in this.unknownPropertyPaths) {\r\n\t\tvar error = this.createError(ErrorCodes.UNKNOWN_PROPERTY, {path: unknownPath}, unknownPath, "", null, data, schema);\r\n\t\tvar result = this.handleError(error);\r\n\t\tif (result) {\r\n\t\t\treturn result;\r\n\t\t}\r\n\t}\r\n\treturn null;\r\n};\r\n\r\nValidatorContext.prototype.addFormat = function (format, validator) {\r\n\tif (typeof format === \'object\') {\r\n\t\tfor (var key in format) {\r\n\t\t\tthis.addFormat(key, format[key]);\r\n\t\t}\r\n\t\treturn this;\r\n\t}\r\n\tthis.formatValidators[format] = validator;\r\n};\r\nValidatorContext.prototype.resolveRefs = function (schema, urlHistory) {\r\n\tif (schema[\'$ref\'] !== undefined) {\r\n\t\turlHistory = urlHistory || {};\r\n\t\tif (urlHistory[schema[\'$ref\']]) {\r\n\t\t\treturn this.createError(ErrorCodes.CIRCULAR_REFERENCE, {urls: Object.keys(urlHistory).join(\', \')}, \'\', \'\', null, undefined, schema);\r\n\t\t}\r\n\t\turlHistory[schema[\'$ref\']] = true;\r\n\t\tschema = this.getSchema(schema[\'$ref\'], urlHistory);\r\n\t}\r\n\treturn schema;\r\n};\r\nValidatorContext.prototype.getSchema = function (url, urlHistory) {\r\n\tvar schema;\r\n\tif (this.schemas[url] !== undefined) {\r\n\t\tschema = this.schemas[url];\r\n\t\treturn this.resolveRefs(schema, urlHistory);\r\n\t}\r\n\tvar baseUrl = url;\r\n\tvar fragment = "";\r\n\tif (url.indexOf(\'#\') !== -1) {\r\n\t\tfragment = url.substring(url.indexOf("#") + 1);\r\n\t\tbaseUrl = url.substring(0, url.indexOf("#"));\r\n\t}\r\n\tif (typeof this.schemas[baseUrl] === \'object\') {\r\n\t\tschema = this.schemas[baseUrl];\r\n\t\tvar pointerPath = decodeURIComponent(fragment);\r\n\t\tif (pointerPath === "") {\r\n\t\t\treturn this.resolveRefs(schema, urlHistory);\r\n\t\t} else if (pointerPath.charAt(0) !== "/") {\r\n\t\t\treturn undefined;\r\n\t\t}\r\n\t\tvar parts = pointerPath.split("/").slice(1);\r\n\t\tfor (var i = 0; i < parts.length; i++) {\r\n\t\t\tvar component = parts[i].replace(/~1/g, "/").replace(/~0/g, "~");\r\n\t\t\tif (schema[component] === undefined) {\r\n\t\t\t\tschema = undefined;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tschema = schema[component];\r\n\t\t}\r\n\t\tif (schema !== undefined) {\r\n\t\t\treturn this.resolveRefs(schema, urlHistory);\r\n\t\t}\r\n\t}\r\n\tif (this.missing[baseUrl] === undefined) {\r\n\t\tthis.missing.push(baseUrl);\r\n\t\tthis.missing[baseUrl] = baseUrl;\r\n\t\tthis.missingMap[baseUrl] = baseUrl;\r\n\t}\r\n};\r\nValidatorContext.prototype.searchSchemas = function (schema, url) {\r\n\tif (Array.isArray(schema)) {\r\n\t\tfor (var i = 0; i < schema.length; i++) {\r\n\t\t\tthis.searchSchemas(schema[i], url);\r\n\t\t}\r\n\t} else if (schema && typeof schema === "object") {\r\n\t\tif (typeof schema.id === "string") {\r\n\t\t\tif (isTrustedUrl(url, schema.id)) {\r\n\t\t\t\tif (this.schemas[schema.id] === undefined) {\r\n\t\t\t\t\tthis.schemas[schema.id] = schema;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tfor (var key in schema) {\r\n\t\t\tif (key !== "enum") {\r\n\t\t\t\tif (typeof schema[key] === "object") {\r\n\t\t\t\t\tthis.searchSchemas(schema[key], url);\r\n\t\t\t\t} else if (key === "$ref") {\r\n\t\t\t\t\tvar uri = getDocumentUri(schema[key]);\r\n\t\t\t\t\tif (uri && this.schemas[uri] === undefined && this.missingMap[uri] === undefined) {\r\n\t\t\t\t\t\tthis.missingMap[uri] = uri;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n};\r\nValidatorContext.prototype.addSchema = function (url, schema) {\r\n\t//overload\r\n\tif (typeof url !== \'string\' || typeof schema === \'undefined\') {\r\n\t\tif (typeof url === \'object\' && typeof url.id === \'string\') {\r\n\t\t\tschema = url;\r\n\t\t\turl = schema.id;\r\n\t\t}\r\n\t\telse {\r\n\t\t\treturn;\r\n\t\t}\r\n\t}\r\n\tif (url === getDocumentUri(url) + "#") {\r\n\t\t// Remove empty fragment\r\n\t\turl = getDocumentUri(url);\r\n\t}\r\n\tthis.schemas[url] = schema;\r\n\tdelete this.missingMap[url];\r\n\tnormSchema(schema, url);\r\n\tthis.searchSchemas(schema, url);\r\n};\r\n\r\nValidatorContext.prototype.getSchemaMap = function () {\r\n\tvar map = {};\r\n\tfor (var key in this.schemas) {\r\n\t\tmap[key] = this.schemas[key];\r\n\t}\r\n\treturn map;\r\n};\r\n\r\nValidatorContext.prototype.getSchemaUris = function (filterRegExp) {\r\n\tvar list = [];\r\n\tfor (var key in this.schemas) {\r\n\t\tif (!filterRegExp || filterRegExp.test(key)) {\r\n\t\t\tlist.push(key);\r\n\t\t}\r\n\t}\r\n\treturn list;\r\n};\r\n\r\nValidatorContext.prototype.getMissingUris = function (filterRegExp) {\r\n\tvar list = [];\r\n\tfor (var key in this.missingMap) {\r\n\t\tif (!filterRegExp || filterRegExp.test(key)) {\r\n\t\t\tlist.push(key);\r\n\t\t}\r\n\t}\r\n\treturn list;\r\n};\r\n\r\nValidatorContext.prototype.dropSchemas = function () {\r\n\tthis.schemas = {};\r\n\tthis.reset();\r\n};\r\nValidatorContext.prototype.reset = function () {\r\n\tthis.missing = [];\r\n\tthis.missingMap = {};\r\n\tthis.errors = [];\r\n};\r\n\r\nValidatorContext.prototype.validateAll = function (data, schema, dataPathParts, schemaPathParts, dataPointerPath) {\r\n\tvar topLevel;\r\n\tschema = this.resolveRefs(schema);\r\n\tif (!schema) {\r\n\t\treturn null;\r\n\t} else if (schema instanceof ValidationError) {\r\n\t\tthis.errors.push(schema);\r\n\t\treturn schema;\r\n\t}\r\n\r\n\tvar startErrorCount = this.errors.length;\r\n\tvar frozenIndex, scannedFrozenSchemaIndex = null, scannedSchemasIndex = null;\r\n\tif (this.checkRecursive && data && typeof data === \'object\') {\r\n\t\ttopLevel = !this.scanned.length;\r\n\t\tif (data[this.validatedSchemasKey]) {\r\n\t\t\tvar schemaIndex = data[this.validatedSchemasKey].indexOf(schema);\r\n\t\t\tif (schemaIndex !== -1) {\r\n\t\t\t\tthis.errors = this.errors.concat(data[this.validationErrorsKey][schemaIndex]);\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (Object.isFrozen(data)) {\r\n\t\t\tfrozenIndex = this.scannedFrozen.indexOf(data);\r\n\t\t\tif (frozenIndex !== -1) {\r\n\t\t\t\tvar frozenSchemaIndex = this.scannedFrozenSchemas[frozenIndex].indexOf(schema);\r\n\t\t\t\tif (frozenSchemaIndex !== -1) {\r\n\t\t\t\t\tthis.errors = this.errors.concat(this.scannedFrozenValidationErrors[frozenIndex][frozenSchemaIndex]);\r\n\t\t\t\t\treturn null;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.scanned.push(data);\r\n\t\tif (Object.isFrozen(data)) {\r\n\t\t\tif (frozenIndex === -1) {\r\n\t\t\t\tfrozenIndex = this.scannedFrozen.length;\r\n\t\t\t\tthis.scannedFrozen.push(data);\r\n\t\t\t\tthis.scannedFrozenSchemas.push([]);\r\n\t\t\t}\r\n\t\t\tscannedFrozenSchemaIndex = this.scannedFrozenSchemas[frozenIndex].length;\r\n\t\t\tthis.scannedFrozenSchemas[frozenIndex][scannedFrozenSchemaIndex] = schema;\r\n\t\t\tthis.scannedFrozenValidationErrors[frozenIndex][scannedFrozenSchemaIndex] = [];\r\n\t\t} else {\r\n\t\t\tif (!data[this.validatedSchemasKey]) {\r\n\t\t\t\ttry {\r\n\t\t\t\t\tObject.defineProperty(data, this.validatedSchemasKey, {\r\n\t\t\t\t\t\tvalue: [],\r\n\t\t\t\t\t\tconfigurable: true\r\n\t\t\t\t\t});\r\n\t\t\t\t\tObject.defineProperty(data, this.validationErrorsKey, {\r\n\t\t\t\t\t\tvalue: [],\r\n\t\t\t\t\t\tconfigurable: true\r\n\t\t\t\t\t});\r\n\t\t\t\t} catch (e) {\r\n\t\t\t\t\t//IE 7/8 workaround\r\n\t\t\t\t\tdata[this.validatedSchemasKey] = [];\r\n\t\t\t\t\tdata[this.validationErrorsKey] = [];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tscannedSchemasIndex = data[this.validatedSchemasKey].length;\r\n\t\t\tdata[this.validatedSchemasKey][scannedSchemasIndex] = schema;\r\n\t\t\tdata[this.validationErrorsKey][scannedSchemasIndex] = [];\r\n\t\t}\r\n\t}\r\n\r\n\tvar errorCount = this.errors.length;\r\n\tvar error = this.validateBasic(data, schema, dataPointerPath)\r\n\t\t|| this.validateNumeric(data, schema, dataPointerPath)\r\n\t\t|| this.validateString(data, schema, dataPointerPath)\r\n\t\t|| this.validateArray(data, schema, dataPointerPath)\r\n\t\t|| this.validateObject(data, schema, dataPointerPath)\r\n\t\t|| this.validateCombinations(data, schema, dataPointerPath)\r\n\t\t|| this.validateHypermedia(data, schema, dataPointerPath)\r\n\t\t|| this.validateFormat(data, schema, dataPointerPath)\r\n\t\t|| this.validateDefinedKeywords(data, schema, dataPointerPath)\r\n\t\t|| null;\r\n\r\n\tif (topLevel) {\r\n\t\twhile (this.scanned.length) {\r\n\t\t\tvar item = this.scanned.pop();\r\n\t\t\tdelete item[this.validatedSchemasKey];\r\n\t\t}\r\n\t\tthis.scannedFrozen = [];\r\n\t\tthis.scannedFrozenSchemas = [];\r\n\t}\r\n\r\n\tif (error || errorCount !== this.errors.length) {\r\n\t\twhile ((dataPathParts && dataPathParts.length) || (schemaPathParts && schemaPathParts.length)) {\r\n\t\t\tvar dataPart = (dataPathParts && dataPathParts.length) ? "" + dataPathParts.pop() : null;\r\n\t\t\tvar schemaPart = (schemaPathParts && schemaPathParts.length) ? "" + schemaPathParts.pop() : null;\r\n\t\t\tif (error) {\r\n\t\t\t\terror = error.prefixWith(dataPart, schemaPart);\r\n\t\t\t}\r\n\t\t\tthis.prefixErrors(errorCount, dataPart, schemaPart);\r\n\t\t}\r\n\t}\r\n\r\n\tif (scannedFrozenSchemaIndex !== null) {\r\n\t\tthis.scannedFrozenValidationErrors[frozenIndex][scannedFrozenSchemaIndex] = this.errors.slice(startErrorCount);\r\n\t} else if (scannedSchemasIndex !== null) {\r\n\t\tdata[this.validationErrorsKey][scannedSchemasIndex] = this.errors.slice(startErrorCount);\r\n\t}\r\n\r\n\treturn this.handleError(error);\r\n};\r\nValidatorContext.prototype.validateFormat = function (data, schema) {\r\n\tif (typeof schema.format !== \'string\' || !this.formatValidators[schema.format]) {\r\n\t\treturn null;\r\n\t}\r\n\tvar errorMessage = this.formatValidators[schema.format].call(null, data, schema);\r\n\tif (typeof errorMessage === \'string\' || typeof errorMessage === \'number\') {\r\n\t\treturn this.createError(ErrorCodes.FORMAT_CUSTOM, {message: errorMessage}, \'\', \'/format\', null, data, schema);\r\n\t} else if (errorMessage && typeof errorMessage === \'object\') {\r\n\t\treturn this.createError(ErrorCodes.FORMAT_CUSTOM, {message: errorMessage.message || "?"}, errorMessage.dataPath || \'\', errorMessage.schemaPath || "/format", null, data, schema);\r\n\t}\r\n\treturn null;\r\n};\r\nValidatorContext.prototype.validateDefinedKeywords = function (data, schema, dataPointerPath) {\r\n\tfor (var key in this.definedKeywords) {\r\n\t\tif (typeof schema[key] === \'undefined\') {\r\n\t\t\tcontinue;\r\n\t\t}\r\n\t\tvar validationFunctions = this.definedKeywords[key];\r\n\t\tfor (var i = 0; i < validationFunctions.length; i++) {\r\n\t\t\tvar func = validationFunctions[i];\r\n\t\t\tvar result = func(data, schema[key], schema, dataPointerPath);\r\n\t\t\tif (typeof result === \'string\' || typeof result === \'number\') {\r\n\t\t\t\treturn this.createError(ErrorCodes.KEYWORD_CUSTOM, {key: key, message: result}, \'\', \'\', null, data, schema).prefixWith(null, key);\r\n\t\t\t} else if (result && typeof result === \'object\') {\r\n\t\t\t\tvar code = result.code;\r\n\t\t\t\tif (typeof code === \'string\') {\r\n\t\t\t\t\tif (!ErrorCodes[code]) {\r\n\t\t\t\t\t\tthrow new Error(\'Undefined error code (use defineError): \' + code);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tcode = ErrorCodes[code];\r\n\t\t\t\t} else if (typeof code !== \'number\') {\r\n\t\t\t\t\tcode = ErrorCodes.KEYWORD_CUSTOM;\r\n\t\t\t\t}\r\n\t\t\t\tvar messageParams = (typeof result.message === \'object\') ? result.message : {key: key, message: result.message || "?"};\r\n\t\t\t\tvar schemaPath = result.schemaPath || ("/" + key.replace(/~/g, \'~0\').replace(/\\//g, \'~1\'));\r\n\t\t\t\treturn this.createError(code, messageParams, result.dataPath || null, schemaPath, null, data, schema);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\treturn null;\r\n};\r\n\r\nfunction recursiveCompare(A, B) {\r\n\tif (A === B) {\r\n\t\treturn true;\r\n\t}\r\n\tif (A && B && typeof A === "object" && typeof B === "object") {\r\n\t\tif (Array.isArray(A) !== Array.isArray(B)) {\r\n\t\t\treturn false;\r\n\t\t} else if (Array.isArray(A)) {\r\n\t\t\tif (A.length !== B.length) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\tfor (var i = 0; i < A.length; i++) {\r\n\t\t\t\tif (!recursiveCompare(A[i], B[i])) {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tvar key;\r\n\t\t\tfor (key in A) {\r\n\t\t\t\tif (B[key] === undefined && A[key] !== undefined) {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tfor (key in B) {\r\n\t\t\t\tif (A[key] === undefined && B[key] !== undefined) {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tfor (key in A) {\r\n\t\t\t\tif (!recursiveCompare(A[key], B[key])) {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn true;\r\n\t}\r\n\treturn false;\r\n}\r\n\r\nValidatorContext.prototype.validateBasic = function validateBasic(data, schema, dataPointerPath) {\r\n\tvar error;\r\n\tif (error = this.validateType(data, schema, dataPointerPath)) {\r\n\t\treturn error.prefixWith(null, "type");\r\n\t}\r\n\tif (error = this.validateEnum(data, schema, dataPointerPath)) {\r\n\t\treturn error.prefixWith(null, "type");\r\n\t}\r\n\treturn null;\r\n};\r\n\r\nValidatorContext.prototype.validateType = function validateType(data, schema) {\r\n\tif (schema.type === undefined) {\r\n\t\treturn null;\r\n\t}\r\n\tvar dataType = typeof data;\r\n\tif (data === null) {\r\n\t\tdataType = "null";\r\n\t} else if (Array.isArray(data)) {\r\n\t\tdataType = "array";\r\n\t}\r\n\tvar allowedTypes = schema.type;\r\n\tif (!Array.isArray(allowedTypes)) {\r\n\t\tallowedTypes = [allowedTypes];\r\n\t}\r\n\r\n\tfor (var i = 0; i < allowedTypes.length; i++) {\r\n\t\tvar type = allowedTypes[i];\r\n\t\tif (type === dataType || (type === "integer" && dataType === "number" && (data % 1 === 0))) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t}\r\n\treturn this.createError(ErrorCodes.INVALID_TYPE, {type: dataType, expected: allowedTypes.join("/")}, \'\', \'\', null, data, schema);\r\n};\r\n\r\nValidatorContext.prototype.validateEnum = function validateEnum(data, schema) {\r\n\tif (schema["enum"] === undefined) {\r\n\t\treturn null;\r\n\t}\r\n\tfor (var i = 0; i < schema["enum"].length; i++) {\r\n\t\tvar enumVal = schema["enum"][i];\r\n\t\tif (recursiveCompare(data, enumVal)) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t}\r\n\treturn this.createError(ErrorCodes.ENUM_MISMATCH, {value: (typeof JSON !== \'undefined\') ? JSON.stringify(data) : data}, \'\', \'\', null, data, schema);\r\n};\r\n\r\nValidatorContext.prototype.validateNumeric = function validateNumeric(data, schema, dataPointerPath) {\r\n\treturn this.validateMultipleOf(data, schema, dataPointerPath)\r\n\t\t|| this.validateMinMax(data, schema, dataPointerPath)\r\n\t\t|| this.validateNaN(data, schema, dataPointerPath)\r\n\t\t|| null;\r\n};\r\n\r\nvar CLOSE_ENOUGH_LOW = Math.pow(2, -51);\r\nvar CLOSE_ENOUGH_HIGH = 1 - CLOSE_ENOUGH_LOW;\r\nValidatorContext.prototype.validateMultipleOf = function validateMultipleOf(data, schema) {\r\n\tvar multipleOf = schema.multipleOf || schema.divisibleBy;\r\n\tif (multipleOf === undefined) {\r\n\t\treturn null;\r\n\t}\r\n\tif (typeof data === "number") {\r\n\t\tvar remainder = (data/multipleOf)%1;\r\n\t\tif (remainder >= CLOSE_ENOUGH_LOW && remainder < CLOSE_ENOUGH_HIGH) {\r\n\t\t\treturn this.createError(ErrorCodes.NUMBER_MULTIPLE_OF, {value: data, multipleOf: multipleOf}, \'\', \'\', null, data, schema);\r\n\t\t}\r\n\t}\r\n\treturn null;\r\n};\r\n\r\nValidatorContext.prototype.validateMinMax = function validateMinMax(data, schema) {\r\n\tif (typeof data !== "number") {\r\n\t\treturn null;\r\n\t}\r\n\tif (schema.minimum !== undefined) {\r\n\t\tif (data < schema.minimum) {\r\n\t\t\treturn this.createError(ErrorCodes.NUMBER_MINIMUM, {value: data, minimum: schema.minimum}, \'\', \'/minimum\', null, data, schema);\r\n\t\t}\r\n\t\tif (schema.exclusiveMinimum && data === schema.minimum) {\r\n\t\t\treturn this.createError(ErrorCodes.NUMBER_MINIMUM_EXCLUSIVE, {value: data, minimum: schema.minimum}, \'\', \'/exclusiveMinimum\', null, data, schema);\r\n\t\t}\r\n\t}\r\n\tif (schema.maximum !== undefined) {\r\n\t\tif (data > schema.maximum) {\r\n\t\t\treturn this.createError(ErrorCodes.NUMBER_MAXIMUM, {value: data, maximum: schema.maximum}, \'\', \'/maximum\', null, data, schema);\r\n\t\t}\r\n\t\tif (schema.exclusiveMaximum && data === schema.maximum) {\r\n\t\t\treturn this.createError(ErrorCodes.NUMBER_MAXIMUM_EXCLUSIVE, {value: data, maximum: schema.maximum}, \'\', \'/exclusiveMaximum\', null, data, schema);\r\n\t\t}\r\n\t}\r\n\treturn null;\r\n};\r\n\r\nValidatorContext.prototype.validateNaN = function validateNaN(data, schema) {\r\n\tif (typeof data !== "number") {\r\n\t\treturn null;\r\n\t}\r\n\tif (isNaN(data) === true || data === Infinity || data === -Infinity) {\r\n\t\treturn this.createError(ErrorCodes.NUMBER_NOT_A_NUMBER, {value: data}, \'\', \'/type\', null, data, schema);\r\n\t}\r\n\treturn null;\r\n};\r\n\r\nValidatorContext.prototype.validateString = function validateString(data, schema, dataPointerPath) {\r\n\treturn this.validateStringLength(data, schema, dataPointerPath)\r\n\t\t|| this.validateStringPattern(data, schema, dataPointerPath)\r\n\t\t|| null;\r\n};\r\n\r\nValidatorContext.prototype.validateStringLength = function validateStringLength(data, schema) {\r\n\tif (typeof data !== "string") {\r\n\t\treturn null;\r\n\t}\r\n\tif (schema.minLength !== undefined) {\r\n\t\tif (data.length < schema.minLength) {\r\n\t\t\treturn this.createError(ErrorCodes.STRING_LENGTH_SHORT, {length: data.length, minimum: schema.minLength}, \'\', \'/minLength\', null, data, schema);\r\n\t\t}\r\n\t}\r\n\tif (schema.maxLength !== undefined) {\r\n\t\tif (data.length > schema.maxLength) {\r\n\t\t\treturn this.createError(ErrorCodes.STRING_LENGTH_LONG, {length: data.length, maximum: schema.maxLength}, \'\', \'/maxLength\', null, data, schema);\r\n\t\t}\r\n\t}\r\n\treturn null;\r\n};\r\n\r\nValidatorContext.prototype.validateStringPattern = function validateStringPattern(data, schema) {\r\n\tif (typeof data !== "string" || (typeof schema.pattern !== "string" && !(schema.pattern instanceof RegExp))) {\r\n\t\treturn null;\r\n\t}\r\n\tvar regexp;\r\n\tif (schema.pattern instanceof RegExp) {\r\n\t  regexp = schema.pattern;\r\n\t}\r\n\telse {\r\n\t  var body, flags = \'\';\r\n\t  // Check for regular expression literals\r\n\t  // @see http://www.ecma-international.org/ecma-262/5.1/#sec-7.8.5\r\n\t  var literal = schema.pattern.match(/^\\/(.+)\\/([img]*)$/);\r\n\t  if (literal) {\r\n\t    body = literal[1];\r\n\t    flags = literal[2];\r\n\t  }\r\n\t  else {\r\n\t    body = schema.pattern;\r\n\t  }\r\n\t  regexp = new RegExp(body, flags);\r\n\t}\r\n\tif (!regexp.test(data)) {\r\n\t\treturn this.createError(ErrorCodes.STRING_PATTERN, {pattern: schema.pattern}, \'\', \'/pattern\', null, data, schema);\r\n\t}\r\n\treturn null;\r\n};\r\n\r\nValidatorContext.prototype.validateArray = function validateArray(data, schema, dataPointerPath) {\r\n\tif (!Array.isArray(data)) {\r\n\t\treturn null;\r\n\t}\r\n\treturn this.validateArrayLength(data, schema, dataPointerPath)\r\n\t\t|| this.validateArrayUniqueItems(data, schema, dataPointerPath)\r\n\t\t|| this.validateArrayItems(data, schema, dataPointerPath)\r\n\t\t|| null;\r\n};\r\n\r\nValidatorContext.prototype.validateArrayLength = function validateArrayLength(data, schema) {\r\n\tvar error;\r\n\tif (schema.minItems !== undefined) {\r\n\t\tif (data.length < schema.minItems) {\r\n\t\t\terror = this.createError(ErrorCodes.ARRAY_LENGTH_SHORT, {length: data.length, minimum: schema.minItems}, \'\', \'/minItems\', null, data, schema);\r\n\t\t\tif (this.handleError(error)) {\r\n\t\t\t\treturn error;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tif (schema.maxItems !== undefined) {\r\n\t\tif (data.length > schema.maxItems) {\r\n\t\t\terror = this.createError(ErrorCodes.ARRAY_LENGTH_LONG, {length: data.length, maximum: schema.maxItems}, \'\', \'/maxItems\', null, data, schema);\r\n\t\t\tif (this.handleError(error)) {\r\n\t\t\t\treturn error;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\treturn null;\r\n};\r\n\r\nValidatorContext.prototype.validateArrayUniqueItems = function validateArrayUniqueItems(data, schema) {\r\n\tif (schema.uniqueItems) {\r\n\t\tfor (var i = 0; i < data.length; i++) {\r\n\t\t\tfor (var j = i + 1; j < data.length; j++) {\r\n\t\t\t\tif (recursiveCompare(data[i], data[j])) {\r\n\t\t\t\t\tvar error = this.createError(ErrorCodes.ARRAY_UNIQUE, {match1: i, match2: j}, \'\', \'/uniqueItems\', null, data, schema);\r\n\t\t\t\t\tif (this.handleError(error)) {\r\n\t\t\t\t\t\treturn error;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\treturn null;\r\n};\r\n\r\nValidatorContext.prototype.validateArrayItems = function validateArrayItems(data, schema, dataPointerPath) {\r\n\tif (schema.items === undefined) {\r\n\t\treturn null;\r\n\t}\r\n\tvar error, i;\r\n\tif (Array.isArray(schema.items)) {\r\n\t\tfor (i = 0; i < data.length; i++) {\r\n\t\t\tif (i < schema.items.length) {\r\n\t\t\t\tif (error = this.validateAll(data[i], schema.items[i], [i], ["items", i], dataPointerPath + "/" + i)) {\r\n\t\t\t\t\treturn error;\r\n\t\t\t\t}\r\n\t\t\t} else if (schema.additionalItems !== undefined) {\r\n\t\t\t\tif (typeof schema.additionalItems === "boolean") {\r\n\t\t\t\t\tif (!schema.additionalItems) {\r\n\t\t\t\t\t\terror = (this.createError(ErrorCodes.ARRAY_ADDITIONAL_ITEMS, {}, \'/\' + i, \'/additionalItems\', null, data, schema));\r\n\t\t\t\t\t\tif (this.handleError(error)) {\r\n\t\t\t\t\t\t\treturn error;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (error = this.validateAll(data[i], schema.additionalItems, [i], ["additionalItems"], dataPointerPath + "/" + i)) {\r\n\t\t\t\t\treturn error;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t} else {\r\n\t\tfor (i = 0; i < data.length; i++) {\r\n\t\t\tif (error = this.validateAll(data[i], schema.items, [i], ["items"], dataPointerPath + "/" + i)) {\r\n\t\t\t\treturn error;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\treturn null;\r\n};\r\n\r\nValidatorContext.prototype.validateObject = function validateObject(data, schema, dataPointerPath) {\r\n\tif (typeof data !== "object" || data === null || Array.isArray(data)) {\r\n\t\treturn null;\r\n\t}\r\n\treturn this.validateObjectMinMaxProperties(data, schema, dataPointerPath)\r\n\t\t|| this.validateObjectRequiredProperties(data, schema, dataPointerPath)\r\n\t\t|| this.validateObjectProperties(data, schema, dataPointerPath)\r\n\t\t|| this.validateObjectDependencies(data, schema, dataPointerPath)\r\n\t\t|| null;\r\n};\r\n\r\nValidatorContext.prototype.validateObjectMinMaxProperties = function validateObjectMinMaxProperties(data, schema) {\r\n\tvar keys = Object.keys(data);\r\n\tvar error;\r\n\tif (schema.minProperties !== undefined) {\r\n\t\tif (keys.length < schema.minProperties) {\r\n\t\t\terror = this.createError(ErrorCodes.OBJECT_PROPERTIES_MINIMUM, {propertyCount: keys.length, minimum: schema.minProperties}, \'\', \'/minProperties\', null, data, schema);\r\n\t\t\tif (this.handleError(error)) {\r\n\t\t\t\treturn error;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tif (schema.maxProperties !== undefined) {\r\n\t\tif (keys.length > schema.maxProperties) {\r\n\t\t\terror = this.createError(ErrorCodes.OBJECT_PROPERTIES_MAXIMUM, {propertyCount: keys.length, maximum: schema.maxProperties}, \'\', \'/maxProperties\', null, data, schema);\r\n\t\t\tif (this.handleError(error)) {\r\n\t\t\t\treturn error;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\treturn null;\r\n};\r\n\r\nValidatorContext.prototype.validateObjectRequiredProperties = function validateObjectRequiredProperties(data, schema) {\r\n\tif (schema.required !== undefined) {\r\n\t\tfor (var i = 0; i < schema.required.length; i++) {\r\n\t\t\tvar key = schema.required[i];\r\n\t\t\tif (data[key] === undefined) {\r\n\t\t\t\tvar error = this.createError(ErrorCodes.OBJECT_REQUIRED, {key: key}, \'\', \'/required/\' + i, null, data, schema);\r\n\t\t\t\tif (this.handleError(error)) {\r\n\t\t\t\t\treturn error;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\treturn null;\r\n};\r\n\r\nValidatorContext.prototype.validateObjectProperties = function validateObjectProperties(data, schema, dataPointerPath) {\r\n\tvar error;\r\n\tfor (var key in data) {\r\n\t\tvar keyPointerPath = dataPointerPath + "/" + key.replace(/~/g, \'~0\').replace(/\\//g, \'~1\');\r\n\t\tvar foundMatch = false;\r\n\t\tif (schema.properties !== undefined && schema.properties[key] !== undefined) {\r\n\t\t\tfoundMatch = true;\r\n\t\t\tif (error = this.validateAll(data[key], schema.properties[key], [key], ["properties", key], keyPointerPath)) {\r\n\t\t\t\treturn error;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (schema.patternProperties !== undefined) {\r\n\t\t\tfor (var patternKey in schema.patternProperties) {\r\n\t\t\t\tvar regexp = new RegExp(patternKey);\r\n\t\t\t\tif (regexp.test(key)) {\r\n\t\t\t\t\tfoundMatch = true;\r\n\t\t\t\t\tif (error = this.validateAll(data[key], schema.patternProperties[patternKey], [key], ["patternProperties", patternKey], keyPointerPath)) {\r\n\t\t\t\t\t\treturn error;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (!foundMatch) {\r\n\t\t\tif (schema.additionalProperties !== undefined) {\r\n\t\t\t\tif (this.trackUnknownProperties) {\r\n\t\t\t\t\tthis.knownPropertyPaths[keyPointerPath] = true;\r\n\t\t\t\t\tdelete this.unknownPropertyPaths[keyPointerPath];\r\n\t\t\t\t}\r\n\t\t\t\tif (typeof schema.additionalProperties === "boolean") {\r\n\t\t\t\t\tif (!schema.additionalProperties) {\r\n\t\t\t\t\t\terror = this.createError(ErrorCodes.OBJECT_ADDITIONAL_PROPERTIES, {key: key}, \'\', \'/additionalProperties\', null, data, schema).prefixWith(key, null);\r\n\t\t\t\t\t\tif (this.handleError(error)) {\r\n\t\t\t\t\t\t\treturn error;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif (error = this.validateAll(data[key], schema.additionalProperties, [key], ["additionalProperties"], keyPointerPath)) {\r\n\t\t\t\t\t\treturn error;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} else if (this.trackUnknownProperties && !this.knownPropertyPaths[keyPointerPath]) {\r\n\t\t\t\tthis.unknownPropertyPaths[keyPointerPath] = true;\r\n\t\t\t}\r\n\t\t} else if (this.trackUnknownProperties) {\r\n\t\t\tthis.knownPropertyPaths[keyPointerPath] = true;\r\n\t\t\tdelete this.unknownPropertyPaths[keyPointerPath];\r\n\t\t}\r\n\t}\r\n\treturn null;\r\n};\r\n\r\nValidatorContext.prototype.validateObjectDependencies = function validateObjectDependencies(data, schema, dataPointerPath) {\r\n\tvar error;\r\n\tif (schema.dependencies !== undefined) {\r\n\t\tfor (var depKey in schema.dependencies) {\r\n\t\t\tif (data[depKey] !== undefined) {\r\n\t\t\t\tvar dep = schema.dependencies[depKey];\r\n\t\t\t\tif (typeof dep === "string") {\r\n\t\t\t\t\tif (data[dep] === undefined) {\r\n\t\t\t\t\t\terror = this.createError(ErrorCodes.OBJECT_DEPENDENCY_KEY, {key: depKey, missing: dep}, \'\', \'\', null, data, schema).prefixWith(null, depKey).prefixWith(null, "dependencies");\r\n\t\t\t\t\t\tif (this.handleError(error)) {\r\n\t\t\t\t\t\t\treturn error;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (Array.isArray(dep)) {\r\n\t\t\t\t\tfor (var i = 0; i < dep.length; i++) {\r\n\t\t\t\t\t\tvar requiredKey = dep[i];\r\n\t\t\t\t\t\tif (data[requiredKey] === undefined) {\r\n\t\t\t\t\t\t\terror = this.createError(ErrorCodes.OBJECT_DEPENDENCY_KEY, {key: depKey, missing: requiredKey}, \'\', \'/\' + i, null, data, schema).prefixWith(null, depKey).prefixWith(null, "dependencies");\r\n\t\t\t\t\t\t\tif (this.handleError(error)) {\r\n\t\t\t\t\t\t\t\treturn error;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif (error = this.validateAll(data, dep, [], ["dependencies", depKey], dataPointerPath)) {\r\n\t\t\t\t\t\treturn error;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\treturn null;\r\n};\r\n\r\nValidatorContext.prototype.validateCombinations = function validateCombinations(data, schema, dataPointerPath) {\r\n\treturn this.validateAllOf(data, schema, dataPointerPath)\r\n\t\t|| this.validateAnyOf(data, schema, dataPointerPath)\r\n\t\t|| this.validateOneOf(data, schema, dataPointerPath)\r\n\t\t|| this.validateNot(data, schema, dataPointerPath)\r\n\t\t|| null;\r\n};\r\n\r\nValidatorContext.prototype.validateAllOf = function validateAllOf(data, schema, dataPointerPath) {\r\n\tif (schema.allOf === undefined) {\r\n\t\treturn null;\r\n\t}\r\n\tvar error;\r\n\tfor (var i = 0; i < schema.allOf.length; i++) {\r\n\t\tvar subSchema = schema.allOf[i];\r\n\t\tif (error = this.validateAll(data, subSchema, [], ["allOf", i], dataPointerPath)) {\r\n\t\t\treturn error;\r\n\t\t}\r\n\t}\r\n\treturn null;\r\n};\r\n\r\nValidatorContext.prototype.validateAnyOf = function validateAnyOf(data, schema, dataPointerPath) {\r\n\tif (schema.anyOf === undefined) {\r\n\t\treturn null;\r\n\t}\r\n\tvar errors = [];\r\n\tvar startErrorCount = this.errors.length;\r\n\tvar oldUnknownPropertyPaths, oldKnownPropertyPaths;\r\n\tif (this.trackUnknownProperties) {\r\n\t\toldUnknownPropertyPaths = this.unknownPropertyPaths;\r\n\t\toldKnownPropertyPaths = this.knownPropertyPaths;\r\n\t}\r\n\tvar errorAtEnd = true;\r\n\tfor (var i = 0; i < schema.anyOf.length; i++) {\r\n\t\tif (this.trackUnknownProperties) {\r\n\t\t\tthis.unknownPropertyPaths = {};\r\n\t\t\tthis.knownPropertyPaths = {};\r\n\t\t}\r\n\t\tvar subSchema = schema.anyOf[i];\r\n\r\n\t\tvar errorCount = this.errors.length;\r\n\t\tvar error = this.validateAll(data, subSchema, [], ["anyOf", i], dataPointerPath);\r\n\r\n\t\tif (error === null && errorCount === this.errors.length) {\r\n\t\t\tthis.errors = this.errors.slice(0, startErrorCount);\r\n\r\n\t\t\tif (this.trackUnknownProperties) {\r\n\t\t\t\tfor (var knownKey in this.knownPropertyPaths) {\r\n\t\t\t\t\toldKnownPropertyPaths[knownKey] = true;\r\n\t\t\t\t\tdelete oldUnknownPropertyPaths[knownKey];\r\n\t\t\t\t}\r\n\t\t\t\tfor (var unknownKey in this.unknownPropertyPaths) {\r\n\t\t\t\t\tif (!oldKnownPropertyPaths[unknownKey]) {\r\n\t\t\t\t\t\toldUnknownPropertyPaths[unknownKey] = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t// We need to continue looping so we catch all the property definitions, but we don\'t want to return an error\r\n\t\t\t\terrorAtEnd = false;\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\tif (error) {\r\n\t\t\terrors.push(error.prefixWith(null, "" + i).prefixWith(null, "anyOf"));\r\n\t\t}\r\n\t}\r\n\tif (this.trackUnknownProperties) {\r\n\t\tthis.unknownPropertyPaths = oldUnknownPropertyPaths;\r\n\t\tthis.knownPropertyPaths = oldKnownPropertyPaths;\r\n\t}\r\n\tif (errorAtEnd) {\r\n\t\terrors = errors.concat(this.errors.slice(startErrorCount));\r\n\t\tthis.errors = this.errors.slice(0, startErrorCount);\r\n\t\treturn this.createError(ErrorCodes.ANY_OF_MISSING, {}, "", "/anyOf", errors, data, schema);\r\n\t}\r\n};\r\n\r\nValidatorContext.prototype.validateOneOf = function validateOneOf(data, schema, dataPointerPath) {\r\n\tif (schema.oneOf === undefined) {\r\n\t\treturn null;\r\n\t}\r\n\tvar validIndex = null;\r\n\tvar errors = [];\r\n\tvar startErrorCount = this.errors.length;\r\n\tvar oldUnknownPropertyPaths, oldKnownPropertyPaths;\r\n\tif (this.trackUnknownProperties) {\r\n\t\toldUnknownPropertyPaths = this.unknownPropertyPaths;\r\n\t\toldKnownPropertyPaths = this.knownPropertyPaths;\r\n\t}\r\n\tfor (var i = 0; i < schema.oneOf.length; i++) {\r\n\t\tif (this.trackUnknownProperties) {\r\n\t\t\tthis.unknownPropertyPaths = {};\r\n\t\t\tthis.knownPropertyPaths = {};\r\n\t\t}\r\n\t\tvar subSchema = schema.oneOf[i];\r\n\r\n\t\tvar errorCount = this.errors.length;\r\n\t\tvar error = this.validateAll(data, subSchema, [], ["oneOf", i], dataPointerPath);\r\n\r\n\t\tif (error === null && errorCount === this.errors.length) {\r\n\t\t\tif (validIndex === null) {\r\n\t\t\t\tvalidIndex = i;\r\n\t\t\t} else {\r\n\t\t\t\tthis.errors = this.errors.slice(0, startErrorCount);\r\n\t\t\t\treturn this.createError(ErrorCodes.ONE_OF_MULTIPLE, {index1: validIndex, index2: i}, "", "/oneOf", null, data, schema);\r\n\t\t\t}\r\n\t\t\tif (this.trackUnknownProperties) {\r\n\t\t\t\tfor (var knownKey in this.knownPropertyPaths) {\r\n\t\t\t\t\toldKnownPropertyPaths[knownKey] = true;\r\n\t\t\t\t\tdelete oldUnknownPropertyPaths[knownKey];\r\n\t\t\t\t}\r\n\t\t\t\tfor (var unknownKey in this.unknownPropertyPaths) {\r\n\t\t\t\t\tif (!oldKnownPropertyPaths[unknownKey]) {\r\n\t\t\t\t\t\toldUnknownPropertyPaths[unknownKey] = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else if (error) {\r\n\t\t\terrors.push(error);\r\n\t\t}\r\n\t}\r\n\tif (this.trackUnknownProperties) {\r\n\t\tthis.unknownPropertyPaths = oldUnknownPropertyPaths;\r\n\t\tthis.knownPropertyPaths = oldKnownPropertyPaths;\r\n\t}\r\n\tif (validIndex === null) {\r\n\t\terrors = errors.concat(this.errors.slice(startErrorCount));\r\n\t\tthis.errors = this.errors.slice(0, startErrorCount);\r\n\t\treturn this.createError(ErrorCodes.ONE_OF_MISSING, {}, "", "/oneOf", errors, data, schema);\r\n\t} else {\r\n\t\tthis.errors = this.errors.slice(0, startErrorCount);\r\n\t}\r\n\treturn null;\r\n};\r\n\r\nValidatorContext.prototype.validateNot = function validateNot(data, schema, dataPointerPath) {\r\n\tif (schema.not === undefined) {\r\n\t\treturn null;\r\n\t}\r\n\tvar oldErrorCount = this.errors.length;\r\n\tvar oldUnknownPropertyPaths, oldKnownPropertyPaths;\r\n\tif (this.trackUnknownProperties) {\r\n\t\toldUnknownPropertyPaths = this.unknownPropertyPaths;\r\n\t\toldKnownPropertyPaths = this.knownPropertyPaths;\r\n\t\tthis.unknownPropertyPaths = {};\r\n\t\tthis.knownPropertyPaths = {};\r\n\t}\r\n\tvar error = this.validateAll(data, schema.not, null, null, dataPointerPath);\r\n\tvar notErrors = this.errors.slice(oldErrorCount);\r\n\tthis.errors = this.errors.slice(0, oldErrorCount);\r\n\tif (this.trackUnknownProperties) {\r\n\t\tthis.unknownPropertyPaths = oldUnknownPropertyPaths;\r\n\t\tthis.knownPropertyPaths = oldKnownPropertyPaths;\r\n\t}\r\n\tif (error === null && notErrors.length === 0) {\r\n\t\treturn this.createError(ErrorCodes.NOT_PASSED, {}, "", "/not", null, data, schema);\r\n\t}\r\n\treturn null;\r\n};\r\n\r\nValidatorContext.prototype.validateHypermedia = function validateCombinations(data, schema, dataPointerPath) {\r\n\tif (!schema.links) {\r\n\t\treturn null;\r\n\t}\r\n\tvar error;\r\n\tfor (var i = 0; i < schema.links.length; i++) {\r\n\t\tvar ldo = schema.links[i];\r\n\t\tif (ldo.rel === "describedby") {\r\n\t\t\tvar template = new UriTemplate(ldo.href);\r\n\t\t\tvar allPresent = true;\r\n\t\t\tfor (var j = 0; j < template.varNames.length; j++) {\r\n\t\t\t\tif (!(template.varNames[j] in data)) {\r\n\t\t\t\t\tallPresent = false;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (allPresent) {\r\n\t\t\t\tvar schemaUrl = template.fillFromObject(data);\r\n\t\t\t\tvar subSchema = {"$ref": schemaUrl};\r\n\t\t\t\tif (error = this.validateAll(data, subSchema, [], ["links", i], dataPointerPath)) {\r\n\t\t\t\t\treturn error;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n};\r\n\r\n// parseURI() and resolveUrl() are from https://gist.github.com/1088850\r\n//   -  released as public domain by author ("Yaffle") - see comments on gist\r\n\r\nfunction parseURI(url) {\r\n\tvar m = String(url).replace(/^\\s+|\\s+$/g, \'\').match(/^([^:\\/?#]+:)?(\\/\\/(?:[^:@]*(?::[^:@]*)?@)?(([^:\\/?#]*)(?::(\\d*))?))?([^?#]*)(\\?[^#]*)?(#[\\s\\S]*)?/);\r\n\t// authority = \'//\' + user + \':\' + pass \'@\' + hostname + \':\' port\r\n\treturn (m ? {\r\n\t\thref     : m[0] || \'\',\r\n\t\tprotocol : m[1] || \'\',\r\n\t\tauthority: m[2] || \'\',\r\n\t\thost     : m[3] || \'\',\r\n\t\thostname : m[4] || \'\',\r\n\t\tport     : m[5] || \'\',\r\n\t\tpathname : m[6] || \'\',\r\n\t\tsearch   : m[7] || \'\',\r\n\t\thash     : m[8] || \'\'\r\n\t} : null);\r\n}\r\n\r\nfunction resolveUrl(base, href) {// RFC 3986\r\n\r\n\tfunction removeDotSegments(input) {\r\n\t\tvar output = [];\r\n\t\tinput.replace(/^(\\.\\.?(\\/|$))+/, \'\')\r\n\t\t\t.replace(/\\/(\\.(\\/|$))+/g, \'/\')\r\n\t\t\t.replace(/\\/\\.\\.$/, \'/../\')\r\n\t\t\t.replace(/\\/?[^\\/]*/g, function (p) {\r\n\t\t\t\tif (p === \'/..\') {\r\n\t\t\t\t\toutput.pop();\r\n\t\t\t\t} else {\r\n\t\t\t\t\toutput.push(p);\r\n\t\t\t\t}\r\n\t\t});\r\n\t\treturn output.join(\'\').replace(/^\\//, input.charAt(0) === \'/\' ? \'/\' : \'\');\r\n\t}\r\n\r\n\thref = parseURI(href || \'\');\r\n\tbase = parseURI(base || \'\');\r\n\r\n\treturn !href || !base ? null : (href.protocol || base.protocol) +\r\n\t\t(href.protocol || href.authority ? href.authority : base.authority) +\r\n\t\tremoveDotSegments(href.protocol || href.authority || href.pathname.charAt(0) === \'/\' ? href.pathname : (href.pathname ? ((base.authority && !base.pathname ? \'/\' : \'\') + base.pathname.slice(0, base.pathname.lastIndexOf(\'/\') + 1) + href.pathname) : base.pathname)) +\r\n\t\t(href.protocol || href.authority || href.pathname ? href.search : (href.search || base.search)) +\r\n\t\thref.hash;\r\n}\r\n\r\nfunction getDocumentUri(uri) {\r\n\treturn uri.split(\'#\')[0];\r\n}\r\nfunction normSchema(schema, baseUri) {\r\n\tif (schema && typeof schema === "object") {\r\n\t\tif (baseUri === undefined) {\r\n\t\t\tbaseUri = schema.id;\r\n\t\t} else if (typeof schema.id === "string") {\r\n\t\t\tbaseUri = resolveUrl(baseUri, schema.id);\r\n\t\t\tschema.id = baseUri;\r\n\t\t}\r\n\t\tif (Array.isArray(schema)) {\r\n\t\t\tfor (var i = 0; i < schema.length; i++) {\r\n\t\t\t\tnormSchema(schema[i], baseUri);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif (typeof schema[\'$ref\'] === "string") {\r\n\t\t\t\tschema[\'$ref\'] = resolveUrl(baseUri, schema[\'$ref\']);\r\n\t\t\t}\r\n\t\t\tfor (var key in schema) {\r\n\t\t\t\tif (key !== "enum") {\r\n\t\t\t\t\tnormSchema(schema[key], baseUri);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n\r\nfunction defaultErrorReporter(language) {\r\n\tlanguage = language || \'en\';\r\n\r\n\tvar errorMessages = languages[language];\r\n\r\n\treturn function (error) {\r\n\t\tvar messageTemplate = errorMessages[error.code] || ErrorMessagesDefault[error.code];\r\n\t\tif (typeof messageTemplate !== \'string\') {\r\n\t\t\treturn "Unknown error code " + error.code + ": " + JSON.stringify(error.messageParams);\r\n\t\t}\r\n\t\tvar messageParams = error.params;\r\n\t\t// Adapted from Crockford\'s supplant()\r\n\t\treturn messageTemplate.replace(/\\{([^{}]*)\\}/g, function (whole, varName) {\r\n\t\t\tvar subValue = messageParams[varName];\r\n\t\t\treturn typeof subValue === \'string\' || typeof subValue === \'number\' ? subValue : whole;\r\n\t\t});\r\n\t};\r\n}\r\n\r\nvar ErrorCodes = {\r\n\tINVALID_TYPE: 0,\r\n\tENUM_MISMATCH: 1,\r\n\tANY_OF_MISSING: 10,\r\n\tONE_OF_MISSING: 11,\r\n\tONE_OF_MULTIPLE: 12,\r\n\tNOT_PASSED: 13,\r\n\t// Numeric errors\r\n\tNUMBER_MULTIPLE_OF: 100,\r\n\tNUMBER_MINIMUM: 101,\r\n\tNUMBER_MINIMUM_EXCLUSIVE: 102,\r\n\tNUMBER_MAXIMUM: 103,\r\n\tNUMBER_MAXIMUM_EXCLUSIVE: 104,\r\n\tNUMBER_NOT_A_NUMBER: 105,\r\n\t// String errors\r\n\tSTRING_LENGTH_SHORT: 200,\r\n\tSTRING_LENGTH_LONG: 201,\r\n\tSTRING_PATTERN: 202,\r\n\t// Object errors\r\n\tOBJECT_PROPERTIES_MINIMUM: 300,\r\n\tOBJECT_PROPERTIES_MAXIMUM: 301,\r\n\tOBJECT_REQUIRED: 302,\r\n\tOBJECT_ADDITIONAL_PROPERTIES: 303,\r\n\tOBJECT_DEPENDENCY_KEY: 304,\r\n\t// Array errors\r\n\tARRAY_LENGTH_SHORT: 400,\r\n\tARRAY_LENGTH_LONG: 401,\r\n\tARRAY_UNIQUE: 402,\r\n\tARRAY_ADDITIONAL_ITEMS: 403,\r\n\t// Custom/user-defined errors\r\n\tFORMAT_CUSTOM: 500,\r\n\tKEYWORD_CUSTOM: 501,\r\n\t// Schema structure\r\n\tCIRCULAR_REFERENCE: 600,\r\n\t// Non-standard validation options\r\n\tUNKNOWN_PROPERTY: 1000\r\n};\r\nvar ErrorCodeLookup = {};\r\nfor (var key in ErrorCodes) {\r\n\tErrorCodeLookup[ErrorCodes[key]] = key;\r\n}\r\nvar ErrorMessagesDefault = {\r\n\tINVALID_TYPE: "Invalid type: {type} (expected {expected})",\r\n\tENUM_MISMATCH: "No enum match for: {value}",\r\n\tANY_OF_MISSING: "Data does not match any schemas from \\"anyOf\\"",\r\n\tONE_OF_MISSING: "Data does not match any schemas from \\"oneOf\\"",\r\n\tONE_OF_MULTIPLE: "Data is valid against more than one schema from \\"oneOf\\": indices {index1} and {index2}",\r\n\tNOT_PASSED: "Data matches schema from \\"not\\"",\r\n\t// Numeric errors\r\n\tNUMBER_MULTIPLE_OF: "Value {value} is not a multiple of {multipleOf}",\r\n\tNUMBER_MINIMUM: "Value {value} is less than minimum {minimum}",\r\n\tNUMBER_MINIMUM_EXCLUSIVE: "Value {value} is equal to exclusive minimum {minimum}",\r\n\tNUMBER_MAXIMUM: "Value {value} is greater than maximum {maximum}",\r\n\tNUMBER_MAXIMUM_EXCLUSIVE: "Value {value} is equal to exclusive maximum {maximum}",\r\n\tNUMBER_NOT_A_NUMBER: "Value {value} is not a valid number",\r\n\t// String errors\r\n\tSTRING_LENGTH_SHORT: "String is too short ({length} chars), minimum {minimum}",\r\n\tSTRING_LENGTH_LONG: "String is too long ({length} chars), maximum {maximum}",\r\n\tSTRING_PATTERN: "String does not match pattern: {pattern}",\r\n\t// Object errors\r\n\tOBJECT_PROPERTIES_MINIMUM: "Too few properties defined ({propertyCount}), minimum {minimum}",\r\n\tOBJECT_PROPERTIES_MAXIMUM: "Too many properties defined ({propertyCount}), maximum {maximum}",\r\n\tOBJECT_REQUIRED: "Missing required property: {key}",\r\n\tOBJECT_ADDITIONAL_PROPERTIES: "Additional properties not allowed",\r\n\tOBJECT_DEPENDENCY_KEY: "Dependency failed - key must exist: {missing} (due to key: {key})",\r\n\t// Array errors\r\n\tARRAY_LENGTH_SHORT: "Array is too short ({length}), minimum {minimum}",\r\n\tARRAY_LENGTH_LONG: "Array is too long ({length}), maximum {maximum}",\r\n\tARRAY_UNIQUE: "Array items are not unique (indices {match1} and {match2})",\r\n\tARRAY_ADDITIONAL_ITEMS: "Additional items not allowed",\r\n\t// Format errors\r\n\tFORMAT_CUSTOM: "Format validation failed ({message})",\r\n\tKEYWORD_CUSTOM: "Keyword failed: {key} ({message})",\r\n\t// Schema structure\r\n\tCIRCULAR_REFERENCE: "Circular $refs: {urls}",\r\n\t// Non-standard validation options\r\n\tUNKNOWN_PROPERTY: "Unknown property (not in schema)"\r\n};\r\n\r\nfunction ValidationError(code, params, dataPath, schemaPath, subErrors) {\r\n\tError.call(this);\r\n\tif (code === undefined) {\r\n\t\tthrow new Error ("No error code supplied: " + schemaPath);\r\n\t}\r\n\tthis.message = \'\';\r\n\tthis.params = params;\r\n\tthis.code = code;\r\n\tthis.dataPath = dataPath || "";\r\n\tthis.schemaPath = schemaPath || "";\r\n\tthis.subErrors = subErrors || null;\r\n\r\n\tvar err = new Error(this.message);\r\n\tthis.stack = err.stack || err.stacktrace;\r\n\tif (!this.stack) {\r\n\t\ttry {\r\n\t\t\tthrow err;\r\n\t\t}\r\n\t\tcatch(err) {\r\n\t\t\tthis.stack = err.stack || err.stacktrace;\r\n\t\t}\r\n\t}\r\n}\r\nValidationError.prototype = Object.create(Error.prototype);\r\nValidationError.prototype.constructor = ValidationError;\r\nValidationError.prototype.name = \'ValidationError\';\r\n\r\nValidationError.prototype.prefixWith = function (dataPrefix, schemaPrefix) {\r\n\tif (dataPrefix !== null) {\r\n\t\tdataPrefix = dataPrefix.replace(/~/g, "~0").replace(/\\//g, "~1");\r\n\t\tthis.dataPath = "/" + dataPrefix + this.dataPath;\r\n\t}\r\n\tif (schemaPrefix !== null) {\r\n\t\tschemaPrefix = schemaPrefix.replace(/~/g, "~0").replace(/\\//g, "~1");\r\n\t\tthis.schemaPath = "/" + schemaPrefix + this.schemaPath;\r\n\t}\r\n\tif (this.subErrors !== null) {\r\n\t\tfor (var i = 0; i < this.subErrors.length; i++) {\r\n\t\t\tthis.subErrors[i].prefixWith(dataPrefix, schemaPrefix);\r\n\t\t}\r\n\t}\r\n\treturn this;\r\n};\r\n\r\nfunction isTrustedUrl(baseUrl, testUrl) {\r\n\tif(testUrl.substring(0, baseUrl.length) === baseUrl){\r\n\t\tvar remainder = testUrl.substring(baseUrl.length);\r\n\t\tif ((testUrl.length > 0 && testUrl.charAt(baseUrl.length - 1) === "/")\r\n\t\t\t|| remainder.charAt(0) === "#"\r\n\t\t\t|| remainder.charAt(0) === "?") {\r\n\t\t\treturn true;\r\n\t\t}\r\n\t}\r\n\treturn false;\r\n}\r\n\r\nvar languages = {};\r\nfunction createApi(language) {\r\n\tvar globalContext = new ValidatorContext();\r\n\tvar currentLanguage;\r\n\tvar customErrorReporter;\r\n\tvar api = {\r\n\t\tsetErrorReporter: function (reporter) {\r\n\t\t\tif (typeof reporter === \'string\') {\r\n\t\t\t\treturn this.language(reporter);\r\n\t\t\t}\r\n\t\t\tcustomErrorReporter = reporter;\r\n\t\t\treturn true;\r\n\t\t},\r\n\t\taddFormat: function () {\r\n\t\t\tglobalContext.addFormat.apply(globalContext, arguments);\r\n\t\t},\r\n\t\tlanguage: function (code) {\r\n\t\t\tif (!code) {\r\n\t\t\t\treturn currentLanguage;\r\n\t\t\t}\r\n\t\t\tif (!languages[code]) {\r\n\t\t\t\tcode = code.split(\'-\')[0]; // fall back to base language\r\n\t\t\t}\r\n\t\t\tif (languages[code]) {\r\n\t\t\t\tcurrentLanguage = code;\r\n\t\t\t\treturn code; // so you can tell if fall-back has happened\r\n\t\t\t}\r\n\t\t\treturn false;\r\n\t\t},\r\n\t\taddLanguage: function (code, messageMap) {\r\n\t\t\tvar key;\r\n\t\t\tfor (key in ErrorCodes) {\r\n\t\t\t\tif (messageMap[key] && !messageMap[ErrorCodes[key]]) {\r\n\t\t\t\t\tmessageMap[ErrorCodes[key]] = messageMap[key];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tvar rootCode = code.split(\'-\')[0];\r\n\t\t\tif (!languages[rootCode]) { // use for base language if not yet defined\r\n\t\t\t\tlanguages[code] = messageMap;\r\n\t\t\t\tlanguages[rootCode] = messageMap;\r\n\t\t\t} else {\r\n\t\t\t\tlanguages[code] = Object.create(languages[rootCode]);\r\n\t\t\t\tfor (key in messageMap) {\r\n\t\t\t\t\tif (typeof languages[rootCode][key] === \'undefined\') {\r\n\t\t\t\t\t\tlanguages[rootCode][key] = messageMap[key];\r\n\t\t\t\t\t}\r\n\t\t\t\t\tlanguages[code][key] = messageMap[key];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn this;\r\n\t\t},\r\n\t\tfreshApi: function (language) {\r\n\t\t\tvar result = createApi();\r\n\t\t\tif (language) {\r\n\t\t\t\tresult.language(language);\r\n\t\t\t}\r\n\t\t\treturn result;\r\n\t\t},\r\n\t\tvalidate: function (data, schema, checkRecursive, banUnknownProperties) {\r\n\t\t\tvar def = defaultErrorReporter(currentLanguage);\r\n\t\t\tvar errorReporter = customErrorReporter ? function (error, data, schema) {\r\n\t\t\t\treturn customErrorReporter(error, data, schema) || def(error, data, schema);\r\n\t\t\t} : def;\r\n\t\t\tvar context = new ValidatorContext(globalContext, false, errorReporter, checkRecursive, banUnknownProperties);\r\n\t\t\tif (typeof schema === "string") {\r\n\t\t\t\tschema = {"$ref": schema};\r\n\t\t\t}\r\n\t\t\tcontext.addSchema("", schema);\r\n\t\t\tvar error = context.validateAll(data, schema, null, null, "");\r\n\t\t\tif (!error && banUnknownProperties) {\r\n\t\t\t\terror = context.banUnknownProperties(data, schema);\r\n\t\t\t}\r\n\t\t\tthis.error = error;\r\n\t\t\tthis.missing = context.missing;\r\n\t\t\tthis.valid = (error === null);\r\n\t\t\treturn this.valid;\r\n\t\t},\r\n\t\tvalidateResult: function () {\r\n\t\t\tvar result = {toString: function () {\r\n\t\t\t\treturn this.valid ? \'valid\' : this.error.message;\r\n\t\t\t}};\r\n\t\t\tthis.validate.apply(result, arguments);\r\n\t\t\treturn result;\r\n\t\t},\r\n\t\tvalidateMultiple: function (data, schema, checkRecursive, banUnknownProperties) {\r\n\t\t\tvar def = defaultErrorReporter(currentLanguage);\r\n\t\t\tvar errorReporter = customErrorReporter ? function (error, data, schema) {\r\n\t\t\t\treturn customErrorReporter(error, data, schema) || def(error, data, schema);\r\n\t\t\t} : def;\r\n\t\t\tvar context = new ValidatorContext(globalContext, true, errorReporter, checkRecursive, banUnknownProperties);\r\n\t\t\tif (typeof schema === "string") {\r\n\t\t\t\tschema = {"$ref": schema};\r\n\t\t\t}\r\n\t\t\tcontext.addSchema("", schema);\r\n\t\t\tcontext.validateAll(data, schema, null, null, "");\r\n\t\t\tif (banUnknownProperties) {\r\n\t\t\t\tcontext.banUnknownProperties(data, schema);\r\n\t\t\t}\r\n\t\t\tvar result = {toString: function () {\r\n\t\t\t\treturn this.valid ? \'valid\' : this.error.message;\r\n\t\t\t}};\r\n\t\t\tresult.errors = context.errors;\r\n\t\t\tresult.missing = context.missing;\r\n\t\t\tresult.valid = (result.errors.length === 0);\r\n\t\t\treturn result;\r\n\t\t},\r\n\t\taddSchema: function () {\r\n\t\t\treturn globalContext.addSchema.apply(globalContext, arguments);\r\n\t\t},\r\n\t\tgetSchema: function () {\r\n\t\t\treturn globalContext.getSchema.apply(globalContext, arguments);\r\n\t\t},\r\n\t\tgetSchemaMap: function () {\r\n\t\t\treturn globalContext.getSchemaMap.apply(globalContext, arguments);\r\n\t\t},\r\n\t\tgetSchemaUris: function () {\r\n\t\t\treturn globalContext.getSchemaUris.apply(globalContext, arguments);\r\n\t\t},\r\n\t\tgetMissingUris: function () {\r\n\t\t\treturn globalContext.getMissingUris.apply(globalContext, arguments);\r\n\t\t},\r\n\t\tdropSchemas: function () {\r\n\t\t\tglobalContext.dropSchemas.apply(globalContext, arguments);\r\n\t\t},\r\n\t\tdefineKeyword: function () {\r\n\t\t\tglobalContext.defineKeyword.apply(globalContext, arguments);\r\n\t\t},\r\n\t\tdefineError: function (codeName, codeNumber, defaultMessage) {\r\n\t\t\tif (typeof codeName !== \'string\' || !/^[A-Z]+(_[A-Z]+)*$/.test(codeName)) {\r\n\t\t\t\tthrow new Error(\'Code name must be a string in UPPER_CASE_WITH_UNDERSCORES\');\r\n\t\t\t}\r\n\t\t\tif (typeof codeNumber !== \'number\' || codeNumber%1 !== 0 || codeNumber < 10000) {\r\n\t\t\t\tthrow new Error(\'Code number must be an integer > 10000\');\r\n\t\t\t}\r\n\t\t\tif (typeof ErrorCodes[codeName] !== \'undefined\') {\r\n\t\t\t\tthrow new Error(\'Error already defined: \' + codeName + \' as \' + ErrorCodes[codeName]);\r\n\t\t\t}\r\n\t\t\tif (typeof ErrorCodeLookup[codeNumber] !== \'undefined\') {\r\n\t\t\t\tthrow new Error(\'Error code already used: \' + ErrorCodeLookup[codeNumber] + \' as \' + codeNumber);\r\n\t\t\t}\r\n\t\t\tErrorCodes[codeName] = codeNumber;\r\n\t\t\tErrorCodeLookup[codeNumber] = codeName;\r\n\t\t\tErrorMessagesDefault[codeName] = ErrorMessagesDefault[codeNumber] = defaultMessage;\r\n\t\t\tfor (var langCode in languages) {\r\n\t\t\t\tvar language = languages[langCode];\r\n\t\t\t\tif (language[codeName]) {\r\n\t\t\t\t\tlanguage[codeNumber] = language[codeNumber] || language[codeName];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\treset: function () {\r\n\t\t\tglobalContext.reset();\r\n\t\t\tthis.error = null;\r\n\t\t\tthis.missing = [];\r\n\t\t\tthis.valid = true;\r\n\t\t},\r\n\t\tmissing: [],\r\n\t\terror: null,\r\n\t\tvalid: true,\r\n\t\tnormSchema: normSchema,\r\n\t\tresolveUrl: resolveUrl,\r\n\t\tgetDocumentUri: getDocumentUri,\r\n\t\terrorCodes: ErrorCodes\r\n\t};\r\n\tapi.language(language || \'en\');\r\n\treturn api;\r\n}\r\n\r\nvar tv4 = createApi();\r\ntv4.addLanguage(\'en-gb\', ErrorMessagesDefault);\r\n\r\n//legacy property\r\ntv4.tv4 = tv4;\r\n\r\nreturn tv4; // used by _header.js to globalise.\r\n\r\n}));//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiOTAuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9bbmFtZV0vLi9ub2RlX21vZHVsZXMvdHY0L3R2NC5qcz84ZTUyIl0sInNvdXJjZXNDb250ZW50IjpbIi8qXHJcbkF1dGhvcjogR2VyYWludCBMdWZmIGFuZCBvdGhlcnNcclxuWWVhcjogMjAxM1xyXG5cclxuVGhpcyBjb2RlIGlzIHJlbGVhc2VkIGludG8gdGhlIFwicHVibGljIGRvbWFpblwiIGJ5IGl0cyBhdXRob3IocykuICBBbnlib2R5IG1heSB1c2UsIGFsdGVyIGFuZCBkaXN0cmlidXRlIHRoZSBjb2RlIHdpdGhvdXQgcmVzdHJpY3Rpb24uICBUaGUgYXV0aG9yIG1ha2VzIG5vIGd1YXJhbnRlZXMsIGFuZCB0YWtlcyBubyBsaWFiaWxpdHkgb2YgYW55IGtpbmQgZm9yIHVzZSBvZiB0aGlzIGNvZGUuXHJcblxyXG5JZiB5b3UgZmluZCBhIGJ1ZyBvciBtYWtlIGFuIGltcHJvdmVtZW50LCBpdCB3b3VsZCBiZSBjb3VydGVvdXMgdG8gbGV0IHRoZSBhdXRob3Iga25vdywgYnV0IGl0IGlzIG5vdCBjb21wdWxzb3J5LlxyXG4qL1xyXG4oZnVuY3Rpb24gKGdsb2JhbCwgZmFjdG9yeSkge1xyXG4gIGlmICh0eXBlb2YgZGVmaW5lID09PSAnZnVuY3Rpb24nICYmIGRlZmluZS5hbWQpIHtcclxuICAgIC8vIEFNRC4gUmVnaXN0ZXIgYXMgYW4gYW5vbnltb3VzIG1vZHVsZS5cclxuICAgIGRlZmluZShbXSwgZmFjdG9yeSk7XHJcbiAgfSBlbHNlIGlmICh0eXBlb2YgbW9kdWxlICE9PSAndW5kZWZpbmVkJyAmJiBtb2R1bGUuZXhwb3J0cyl7XHJcbiAgICAvLyBDb21tb25KUy4gRGVmaW5lIGV4cG9ydC5cclxuICAgIG1vZHVsZS5leHBvcnRzID0gZmFjdG9yeSgpO1xyXG4gIH0gZWxzZSB7XHJcbiAgICAvLyBCcm93c2VyIGdsb2JhbHNcclxuICAgIGdsb2JhbC50djQgPSBmYWN0b3J5KCk7XHJcbiAgfVxyXG59KHRoaXMsIGZ1bmN0aW9uICgpIHtcclxuXHJcbi8vIGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuLVVTL2RvY3MvV2ViL0phdmFTY3JpcHQvUmVmZXJlbmNlL0dsb2JhbF9PYmplY3RzL09iamVjdC9rZXlzP3JlZGlyZWN0bG9jYWxlPWVuLVVTJnJlZGlyZWN0c2x1Zz1KYXZhU2NyaXB0JTJGUmVmZXJlbmNlJTJGR2xvYmFsX09iamVjdHMlMkZPYmplY3QlMkZrZXlzXHJcbmlmICghT2JqZWN0LmtleXMpIHtcclxuXHRPYmplY3Qua2V5cyA9IChmdW5jdGlvbiAoKSB7XHJcblx0XHR2YXIgaGFzT3duUHJvcGVydHkgPSBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LFxyXG5cdFx0XHRoYXNEb250RW51bUJ1ZyA9ICEoe3RvU3RyaW5nOiBudWxsfSkucHJvcGVydHlJc0VudW1lcmFibGUoJ3RvU3RyaW5nJyksXHJcblx0XHRcdGRvbnRFbnVtcyA9IFtcclxuXHRcdFx0XHQndG9TdHJpbmcnLFxyXG5cdFx0XHRcdCd0b0xvY2FsZVN0cmluZycsXHJcblx0XHRcdFx0J3ZhbHVlT2YnLFxyXG5cdFx0XHRcdCdoYXNPd25Qcm9wZXJ0eScsXHJcblx0XHRcdFx0J2lzUHJvdG90eXBlT2YnLFxyXG5cdFx0XHRcdCdwcm9wZXJ0eUlzRW51bWVyYWJsZScsXHJcblx0XHRcdFx0J2NvbnN0cnVjdG9yJ1xyXG5cdFx0XHRdLFxyXG5cdFx0XHRkb250RW51bXNMZW5ndGggPSBkb250RW51bXMubGVuZ3RoO1xyXG5cclxuXHRcdHJldHVybiBmdW5jdGlvbiAob2JqKSB7XHJcblx0XHRcdGlmICh0eXBlb2Ygb2JqICE9PSAnb2JqZWN0JyAmJiB0eXBlb2Ygb2JqICE9PSAnZnVuY3Rpb24nIHx8IG9iaiA9PT0gbnVsbCkge1xyXG5cdFx0XHRcdHRocm93IG5ldyBUeXBlRXJyb3IoJ09iamVjdC5rZXlzIGNhbGxlZCBvbiBub24tb2JqZWN0Jyk7XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdHZhciByZXN1bHQgPSBbXTtcclxuXHJcblx0XHRcdGZvciAodmFyIHByb3AgaW4gb2JqKSB7XHJcblx0XHRcdFx0aWYgKGhhc093blByb3BlcnR5LmNhbGwob2JqLCBwcm9wKSkge1xyXG5cdFx0XHRcdFx0cmVzdWx0LnB1c2gocHJvcCk7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHRpZiAoaGFzRG9udEVudW1CdWcpIHtcclxuXHRcdFx0XHRmb3IgKHZhciBpPTA7IGkgPCBkb250RW51bXNMZW5ndGg7IGkrKykge1xyXG5cdFx0XHRcdFx0aWYgKGhhc093blByb3BlcnR5LmNhbGwob2JqLCBkb250RW51bXNbaV0pKSB7XHJcblx0XHRcdFx0XHRcdHJlc3VsdC5wdXNoKGRvbnRFbnVtc1tpXSk7XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblx0XHRcdHJldHVybiByZXN1bHQ7XHJcblx0XHR9O1xyXG5cdH0pKCk7XHJcbn1cclxuLy8gaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9XZWIvSmF2YVNjcmlwdC9SZWZlcmVuY2UvR2xvYmFsX09iamVjdHMvT2JqZWN0L2NyZWF0ZVxyXG5pZiAoIU9iamVjdC5jcmVhdGUpIHtcclxuXHRPYmplY3QuY3JlYXRlID0gKGZ1bmN0aW9uKCl7XHJcblx0XHRmdW5jdGlvbiBGKCl7fVxyXG5cclxuXHRcdHJldHVybiBmdW5jdGlvbihvKXtcclxuXHRcdFx0aWYgKGFyZ3VtZW50cy5sZW5ndGggIT09IDEpIHtcclxuXHRcdFx0XHR0aHJvdyBuZXcgRXJyb3IoJ09iamVjdC5jcmVhdGUgaW1wbGVtZW50YXRpb24gb25seSBhY2NlcHRzIG9uZSBwYXJhbWV0ZXIuJyk7XHJcblx0XHRcdH1cclxuXHRcdFx0Ri5wcm90b3R5cGUgPSBvO1xyXG5cdFx0XHRyZXR1cm4gbmV3IEYoKTtcclxuXHRcdH07XHJcblx0fSkoKTtcclxufVxyXG4vLyBodHRwczovL2RldmVsb3Blci5tb3ppbGxhLm9yZy9lbi1VUy9kb2NzL1dlYi9KYXZhU2NyaXB0L1JlZmVyZW5jZS9HbG9iYWxfT2JqZWN0cy9BcnJheS9pc0FycmF5P3JlZGlyZWN0bG9jYWxlPWVuLVVTJnJlZGlyZWN0c2x1Zz1KYXZhU2NyaXB0JTJGUmVmZXJlbmNlJTJGR2xvYmFsX09iamVjdHMlMkZBcnJheSUyRmlzQXJyYXlcclxuaWYoIUFycmF5LmlzQXJyYXkpIHtcclxuXHRBcnJheS5pc0FycmF5ID0gZnVuY3Rpb24gKHZBcmcpIHtcclxuXHRcdHJldHVybiBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwodkFyZykgPT09IFwiW29iamVjdCBBcnJheV1cIjtcclxuXHR9O1xyXG59XHJcbi8vIGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuLVVTL2RvY3MvV2ViL0phdmFTY3JpcHQvUmVmZXJlbmNlL0dsb2JhbF9PYmplY3RzL0FycmF5L2luZGV4T2Y/cmVkaXJlY3Rsb2NhbGU9ZW4tVVMmcmVkaXJlY3RzbHVnPUphdmFTY3JpcHQlMkZSZWZlcmVuY2UlMkZHbG9iYWxfT2JqZWN0cyUyRkFycmF5JTJGaW5kZXhPZlxyXG5pZiAoIUFycmF5LnByb3RvdHlwZS5pbmRleE9mKSB7XHJcblx0QXJyYXkucHJvdG90eXBlLmluZGV4T2YgPSBmdW5jdGlvbiAoc2VhcmNoRWxlbWVudCAvKiwgZnJvbUluZGV4ICovICkge1xyXG5cdFx0aWYgKHRoaXMgPT09IG51bGwpIHtcclxuXHRcdFx0dGhyb3cgbmV3IFR5cGVFcnJvcigpO1xyXG5cdFx0fVxyXG5cdFx0dmFyIHQgPSBPYmplY3QodGhpcyk7XHJcblx0XHR2YXIgbGVuID0gdC5sZW5ndGggPj4+IDA7XHJcblxyXG5cdFx0aWYgKGxlbiA9PT0gMCkge1xyXG5cdFx0XHRyZXR1cm4gLTE7XHJcblx0XHR9XHJcblx0XHR2YXIgbiA9IDA7XHJcblx0XHRpZiAoYXJndW1lbnRzLmxlbmd0aCA+IDEpIHtcclxuXHRcdFx0biA9IE51bWJlcihhcmd1bWVudHNbMV0pO1xyXG5cdFx0XHRpZiAobiAhPT0gbikgeyAvLyBzaG9ydGN1dCBmb3IgdmVyaWZ5aW5nIGlmIGl0J3MgTmFOXHJcblx0XHRcdFx0biA9IDA7XHJcblx0XHRcdH0gZWxzZSBpZiAobiAhPT0gMCAmJiBuICE9PSBJbmZpbml0eSAmJiBuICE9PSAtSW5maW5pdHkpIHtcclxuXHRcdFx0XHRuID0gKG4gPiAwIHx8IC0xKSAqIE1hdGguZmxvb3IoTWF0aC5hYnMobikpO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0XHRpZiAobiA+PSBsZW4pIHtcclxuXHRcdFx0cmV0dXJuIC0xO1xyXG5cdFx0fVxyXG5cdFx0dmFyIGsgPSBuID49IDAgPyBuIDogTWF0aC5tYXgobGVuIC0gTWF0aC5hYnMobiksIDApO1xyXG5cdFx0Zm9yICg7IGsgPCBsZW47IGsrKykge1xyXG5cdFx0XHRpZiAoayBpbiB0ICYmIHRba10gPT09IHNlYXJjaEVsZW1lbnQpIHtcclxuXHRcdFx0XHRyZXR1cm4gaztcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdFx0cmV0dXJuIC0xO1xyXG5cdH07XHJcbn1cclxuXHJcbi8vIEdydW5nZXkgT2JqZWN0LmlzRnJvemVuIGhhY2tcclxuaWYgKCFPYmplY3QuaXNGcm96ZW4pIHtcclxuXHRPYmplY3QuaXNGcm96ZW4gPSBmdW5jdGlvbiAob2JqKSB7XHJcblx0XHR2YXIga2V5ID0gXCJ0djRfdGVzdF9mcm96ZW5fa2V5XCI7XHJcblx0XHR3aGlsZSAob2JqLmhhc093blByb3BlcnR5KGtleSkpIHtcclxuXHRcdFx0a2V5ICs9IE1hdGgucmFuZG9tKCk7XHJcblx0XHR9XHJcblx0XHR0cnkge1xyXG5cdFx0XHRvYmpba2V5XSA9IHRydWU7XHJcblx0XHRcdGRlbGV0ZSBvYmpba2V5XTtcclxuXHRcdFx0cmV0dXJuIGZhbHNlO1xyXG5cdFx0fSBjYXRjaCAoZSkge1xyXG5cdFx0XHRyZXR1cm4gdHJ1ZTtcclxuXHRcdH1cclxuXHR9O1xyXG59XHJcbi8vIEJhc2VkIG9uOiBodHRwczovL2dpdGh1Yi5jb20vZ2VyYWludGx1ZmYvdXJpLXRlbXBsYXRlcywgYnV0IHdpdGggYWxsIHRoZSBkZS1zdWJzdGl0dXRpb24gc3R1ZmYgcmVtb3ZlZFxyXG5cclxudmFyIHVyaVRlbXBsYXRlR2xvYmFsTW9kaWZpZXJzID0ge1xyXG5cdFwiK1wiOiB0cnVlLFxyXG5cdFwiI1wiOiB0cnVlLFxyXG5cdFwiLlwiOiB0cnVlLFxyXG5cdFwiL1wiOiB0cnVlLFxyXG5cdFwiO1wiOiB0cnVlLFxyXG5cdFwiP1wiOiB0cnVlLFxyXG5cdFwiJlwiOiB0cnVlXHJcbn07XHJcbnZhciB1cmlUZW1wbGF0ZVN1ZmZpY2VzID0ge1xyXG5cdFwiKlwiOiB0cnVlXHJcbn07XHJcblxyXG5mdW5jdGlvbiBub3RSZWFsbHlQZXJjZW50RW5jb2RlKHN0cmluZykge1xyXG5cdHJldHVybiBlbmNvZGVVUkkoc3RyaW5nKS5yZXBsYWNlKC8lMjVbMC05XVswLTldL2csIGZ1bmN0aW9uIChkb3VibGVFbmNvZGVkKSB7XHJcblx0XHRyZXR1cm4gXCIlXCIgKyBkb3VibGVFbmNvZGVkLnN1YnN0cmluZygzKTtcclxuXHR9KTtcclxufVxyXG5cclxuZnVuY3Rpb24gdXJpVGVtcGxhdGVTdWJzdGl0dXRpb24oc3BlYykge1xyXG5cdHZhciBtb2RpZmllciA9IFwiXCI7XHJcblx0aWYgKHVyaVRlbXBsYXRlR2xvYmFsTW9kaWZpZXJzW3NwZWMuY2hhckF0KDApXSkge1xyXG5cdFx0bW9kaWZpZXIgPSBzcGVjLmNoYXJBdCgwKTtcclxuXHRcdHNwZWMgPSBzcGVjLnN1YnN0cmluZygxKTtcclxuXHR9XHJcblx0dmFyIHNlcGFyYXRvciA9IFwiXCI7XHJcblx0dmFyIHByZWZpeCA9IFwiXCI7XHJcblx0dmFyIHNob3VsZEVzY2FwZSA9IHRydWU7XHJcblx0dmFyIHNob3dWYXJpYWJsZXMgPSBmYWxzZTtcclxuXHR2YXIgdHJpbUVtcHR5U3RyaW5nID0gZmFsc2U7XHJcblx0aWYgKG1vZGlmaWVyID09PSAnKycpIHtcclxuXHRcdHNob3VsZEVzY2FwZSA9IGZhbHNlO1xyXG5cdH0gZWxzZSBpZiAobW9kaWZpZXIgPT09IFwiLlwiKSB7XHJcblx0XHRwcmVmaXggPSBcIi5cIjtcclxuXHRcdHNlcGFyYXRvciA9IFwiLlwiO1xyXG5cdH0gZWxzZSBpZiAobW9kaWZpZXIgPT09IFwiL1wiKSB7XHJcblx0XHRwcmVmaXggPSBcIi9cIjtcclxuXHRcdHNlcGFyYXRvciA9IFwiL1wiO1xyXG5cdH0gZWxzZSBpZiAobW9kaWZpZXIgPT09ICcjJykge1xyXG5cdFx0cHJlZml4ID0gXCIjXCI7XHJcblx0XHRzaG91bGRFc2NhcGUgPSBmYWxzZTtcclxuXHR9IGVsc2UgaWYgKG1vZGlmaWVyID09PSAnOycpIHtcclxuXHRcdHByZWZpeCA9IFwiO1wiO1xyXG5cdFx0c2VwYXJhdG9yID0gXCI7XCI7XHJcblx0XHRzaG93VmFyaWFibGVzID0gdHJ1ZTtcclxuXHRcdHRyaW1FbXB0eVN0cmluZyA9IHRydWU7XHJcblx0fSBlbHNlIGlmIChtb2RpZmllciA9PT0gJz8nKSB7XHJcblx0XHRwcmVmaXggPSBcIj9cIjtcclxuXHRcdHNlcGFyYXRvciA9IFwiJlwiO1xyXG5cdFx0c2hvd1ZhcmlhYmxlcyA9IHRydWU7XHJcblx0fSBlbHNlIGlmIChtb2RpZmllciA9PT0gJyYnKSB7XHJcblx0XHRwcmVmaXggPSBcIiZcIjtcclxuXHRcdHNlcGFyYXRvciA9IFwiJlwiO1xyXG5cdFx0c2hvd1ZhcmlhYmxlcyA9IHRydWU7XHJcblx0fVxyXG5cclxuXHR2YXIgdmFyTmFtZXMgPSBbXTtcclxuXHR2YXIgdmFyTGlzdCA9IHNwZWMuc3BsaXQoXCIsXCIpO1xyXG5cdHZhciB2YXJTcGVjcyA9IFtdO1xyXG5cdHZhciB2YXJTcGVjTWFwID0ge307XHJcblx0Zm9yICh2YXIgaSA9IDA7IGkgPCB2YXJMaXN0Lmxlbmd0aDsgaSsrKSB7XHJcblx0XHR2YXIgdmFyTmFtZSA9IHZhckxpc3RbaV07XHJcblx0XHR2YXIgdHJ1bmNhdGUgPSBudWxsO1xyXG5cdFx0aWYgKHZhck5hbWUuaW5kZXhPZihcIjpcIikgIT09IC0xKSB7XHJcblx0XHRcdHZhciBwYXJ0cyA9IHZhck5hbWUuc3BsaXQoXCI6XCIpO1xyXG5cdFx0XHR2YXJOYW1lID0gcGFydHNbMF07XHJcblx0XHRcdHRydW5jYXRlID0gcGFyc2VJbnQocGFydHNbMV0sIDEwKTtcclxuXHRcdH1cclxuXHRcdHZhciBzdWZmaWNlcyA9IHt9O1xyXG5cdFx0d2hpbGUgKHVyaVRlbXBsYXRlU3VmZmljZXNbdmFyTmFtZS5jaGFyQXQodmFyTmFtZS5sZW5ndGggLSAxKV0pIHtcclxuXHRcdFx0c3VmZmljZXNbdmFyTmFtZS5jaGFyQXQodmFyTmFtZS5sZW5ndGggLSAxKV0gPSB0cnVlO1xyXG5cdFx0XHR2YXJOYW1lID0gdmFyTmFtZS5zdWJzdHJpbmcoMCwgdmFyTmFtZS5sZW5ndGggLSAxKTtcclxuXHRcdH1cclxuXHRcdHZhciB2YXJTcGVjID0ge1xyXG5cdFx0XHR0cnVuY2F0ZTogdHJ1bmNhdGUsXHJcblx0XHRcdG5hbWU6IHZhck5hbWUsXHJcblx0XHRcdHN1ZmZpY2VzOiBzdWZmaWNlc1xyXG5cdFx0fTtcclxuXHRcdHZhclNwZWNzLnB1c2godmFyU3BlYyk7XHJcblx0XHR2YXJTcGVjTWFwW3Zhck5hbWVdID0gdmFyU3BlYztcclxuXHRcdHZhck5hbWVzLnB1c2godmFyTmFtZSk7XHJcblx0fVxyXG5cdHZhciBzdWJGdW5jdGlvbiA9IGZ1bmN0aW9uICh2YWx1ZUZ1bmN0aW9uKSB7XHJcblx0XHR2YXIgcmVzdWx0ID0gXCJcIjtcclxuXHRcdHZhciBzdGFydEluZGV4ID0gMDtcclxuXHRcdGZvciAodmFyIGkgPSAwOyBpIDwgdmFyU3BlY3MubGVuZ3RoOyBpKyspIHtcclxuXHRcdFx0dmFyIHZhclNwZWMgPSB2YXJTcGVjc1tpXTtcclxuXHRcdFx0dmFyIHZhbHVlID0gdmFsdWVGdW5jdGlvbih2YXJTcGVjLm5hbWUpO1xyXG5cdFx0XHRpZiAodmFsdWUgPT09IG51bGwgfHwgdmFsdWUgPT09IHVuZGVmaW5lZCB8fCAoQXJyYXkuaXNBcnJheSh2YWx1ZSkgJiYgdmFsdWUubGVuZ3RoID09PSAwKSB8fCAodHlwZW9mIHZhbHVlID09PSAnb2JqZWN0JyAmJiBPYmplY3Qua2V5cyh2YWx1ZSkubGVuZ3RoID09PSAwKSkge1xyXG5cdFx0XHRcdHN0YXJ0SW5kZXgrKztcclxuXHRcdFx0XHRjb250aW51ZTtcclxuXHRcdFx0fVxyXG5cdFx0XHRpZiAoaSA9PT0gc3RhcnRJbmRleCkge1xyXG5cdFx0XHRcdHJlc3VsdCArPSBwcmVmaXg7XHJcblx0XHRcdH0gZWxzZSB7XHJcblx0XHRcdFx0cmVzdWx0ICs9IChzZXBhcmF0b3IgfHwgXCIsXCIpO1xyXG5cdFx0XHR9XHJcblx0XHRcdGlmIChBcnJheS5pc0FycmF5KHZhbHVlKSkge1xyXG5cdFx0XHRcdGlmIChzaG93VmFyaWFibGVzKSB7XHJcblx0XHRcdFx0XHRyZXN1bHQgKz0gdmFyU3BlYy5uYW1lICsgXCI9XCI7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHRcdGZvciAodmFyIGogPSAwOyBqIDwgdmFsdWUubGVuZ3RoOyBqKyspIHtcclxuXHRcdFx0XHRcdGlmIChqID4gMCkge1xyXG5cdFx0XHRcdFx0XHRyZXN1bHQgKz0gdmFyU3BlYy5zdWZmaWNlc1snKiddID8gKHNlcGFyYXRvciB8fCBcIixcIikgOiBcIixcIjtcclxuXHRcdFx0XHRcdFx0aWYgKHZhclNwZWMuc3VmZmljZXNbJyonXSAmJiBzaG93VmFyaWFibGVzKSB7XHJcblx0XHRcdFx0XHRcdFx0cmVzdWx0ICs9IHZhclNwZWMubmFtZSArIFwiPVwiO1xyXG5cdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRyZXN1bHQgKz0gc2hvdWxkRXNjYXBlID8gZW5jb2RlVVJJQ29tcG9uZW50KHZhbHVlW2pdKS5yZXBsYWNlKC8hL2csIFwiJTIxXCIpIDogbm90UmVhbGx5UGVyY2VudEVuY29kZSh2YWx1ZVtqXSk7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gXCJvYmplY3RcIikge1xyXG5cdFx0XHRcdGlmIChzaG93VmFyaWFibGVzICYmICF2YXJTcGVjLnN1ZmZpY2VzWycqJ10pIHtcclxuXHRcdFx0XHRcdHJlc3VsdCArPSB2YXJTcGVjLm5hbWUgKyBcIj1cIjtcclxuXHRcdFx0XHR9XHJcblx0XHRcdFx0dmFyIGZpcnN0ID0gdHJ1ZTtcclxuXHRcdFx0XHRmb3IgKHZhciBrZXkgaW4gdmFsdWUpIHtcclxuXHRcdFx0XHRcdGlmICghZmlyc3QpIHtcclxuXHRcdFx0XHRcdFx0cmVzdWx0ICs9IHZhclNwZWMuc3VmZmljZXNbJyonXSA/IChzZXBhcmF0b3IgfHwgXCIsXCIpIDogXCIsXCI7XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRmaXJzdCA9IGZhbHNlO1xyXG5cdFx0XHRcdFx0cmVzdWx0ICs9IHNob3VsZEVzY2FwZSA/IGVuY29kZVVSSUNvbXBvbmVudChrZXkpLnJlcGxhY2UoLyEvZywgXCIlMjFcIikgOiBub3RSZWFsbHlQZXJjZW50RW5jb2RlKGtleSk7XHJcblx0XHRcdFx0XHRyZXN1bHQgKz0gdmFyU3BlYy5zdWZmaWNlc1snKiddID8gJz0nIDogXCIsXCI7XHJcblx0XHRcdFx0XHRyZXN1bHQgKz0gc2hvdWxkRXNjYXBlID8gZW5jb2RlVVJJQ29tcG9uZW50KHZhbHVlW2tleV0pLnJlcGxhY2UoLyEvZywgXCIlMjFcIikgOiBub3RSZWFsbHlQZXJjZW50RW5jb2RlKHZhbHVlW2tleV0pO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fSBlbHNlIHtcclxuXHRcdFx0XHRpZiAoc2hvd1ZhcmlhYmxlcykge1xyXG5cdFx0XHRcdFx0cmVzdWx0ICs9IHZhclNwZWMubmFtZTtcclxuXHRcdFx0XHRcdGlmICghdHJpbUVtcHR5U3RyaW5nIHx8IHZhbHVlICE9PSBcIlwiKSB7XHJcblx0XHRcdFx0XHRcdHJlc3VsdCArPSBcIj1cIjtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHR9XHJcblx0XHRcdFx0aWYgKHZhclNwZWMudHJ1bmNhdGUgIT0gbnVsbCkge1xyXG5cdFx0XHRcdFx0dmFsdWUgPSB2YWx1ZS5zdWJzdHJpbmcoMCwgdmFyU3BlYy50cnVuY2F0ZSk7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHRcdHJlc3VsdCArPSBzaG91bGRFc2NhcGUgPyBlbmNvZGVVUklDb21wb25lbnQodmFsdWUpLnJlcGxhY2UoLyEvZywgXCIlMjFcIik6IG5vdFJlYWxseVBlcmNlbnRFbmNvZGUodmFsdWUpO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0XHRyZXR1cm4gcmVzdWx0O1xyXG5cdH07XHJcblx0c3ViRnVuY3Rpb24udmFyTmFtZXMgPSB2YXJOYW1lcztcclxuXHRyZXR1cm4ge1xyXG5cdFx0cHJlZml4OiBwcmVmaXgsXHJcblx0XHRzdWJzdGl0dXRpb246IHN1YkZ1bmN0aW9uXHJcblx0fTtcclxufVxyXG5cclxuZnVuY3Rpb24gVXJpVGVtcGxhdGUodGVtcGxhdGUpIHtcclxuXHRpZiAoISh0aGlzIGluc3RhbmNlb2YgVXJpVGVtcGxhdGUpKSB7XHJcblx0XHRyZXR1cm4gbmV3IFVyaVRlbXBsYXRlKHRlbXBsYXRlKTtcclxuXHR9XHJcblx0dmFyIHBhcnRzID0gdGVtcGxhdGUuc3BsaXQoXCJ7XCIpO1xyXG5cdHZhciB0ZXh0UGFydHMgPSBbcGFydHMuc2hpZnQoKV07XHJcblx0dmFyIHByZWZpeGVzID0gW107XHJcblx0dmFyIHN1YnN0aXR1dGlvbnMgPSBbXTtcclxuXHR2YXIgdmFyTmFtZXMgPSBbXTtcclxuXHR3aGlsZSAocGFydHMubGVuZ3RoID4gMCkge1xyXG5cdFx0dmFyIHBhcnQgPSBwYXJ0cy5zaGlmdCgpO1xyXG5cdFx0dmFyIHNwZWMgPSBwYXJ0LnNwbGl0KFwifVwiKVswXTtcclxuXHRcdHZhciByZW1haW5kZXIgPSBwYXJ0LnN1YnN0cmluZyhzcGVjLmxlbmd0aCArIDEpO1xyXG5cdFx0dmFyIGZ1bmNzID0gdXJpVGVtcGxhdGVTdWJzdGl0dXRpb24oc3BlYyk7XHJcblx0XHRzdWJzdGl0dXRpb25zLnB1c2goZnVuY3Muc3Vic3RpdHV0aW9uKTtcclxuXHRcdHByZWZpeGVzLnB1c2goZnVuY3MucHJlZml4KTtcclxuXHRcdHRleHRQYXJ0cy5wdXNoKHJlbWFpbmRlcik7XHJcblx0XHR2YXJOYW1lcyA9IHZhck5hbWVzLmNvbmNhdChmdW5jcy5zdWJzdGl0dXRpb24udmFyTmFtZXMpO1xyXG5cdH1cclxuXHR0aGlzLmZpbGwgPSBmdW5jdGlvbiAodmFsdWVGdW5jdGlvbikge1xyXG5cdFx0dmFyIHJlc3VsdCA9IHRleHRQYXJ0c1swXTtcclxuXHRcdGZvciAodmFyIGkgPSAwOyBpIDwgc3Vic3RpdHV0aW9ucy5sZW5ndGg7IGkrKykge1xyXG5cdFx0XHR2YXIgc3Vic3RpdHV0aW9uID0gc3Vic3RpdHV0aW9uc1tpXTtcclxuXHRcdFx0cmVzdWx0ICs9IHN1YnN0aXR1dGlvbih2YWx1ZUZ1bmN0aW9uKTtcclxuXHRcdFx0cmVzdWx0ICs9IHRleHRQYXJ0c1tpICsgMV07XHJcblx0XHR9XHJcblx0XHRyZXR1cm4gcmVzdWx0O1xyXG5cdH07XHJcblx0dGhpcy52YXJOYW1lcyA9IHZhck5hbWVzO1xyXG5cdHRoaXMudGVtcGxhdGUgPSB0ZW1wbGF0ZTtcclxufVxyXG5VcmlUZW1wbGF0ZS5wcm90b3R5cGUgPSB7XHJcblx0dG9TdHJpbmc6IGZ1bmN0aW9uICgpIHtcclxuXHRcdHJldHVybiB0aGlzLnRlbXBsYXRlO1xyXG5cdH0sXHJcblx0ZmlsbEZyb21PYmplY3Q6IGZ1bmN0aW9uIChvYmopIHtcclxuXHRcdHJldHVybiB0aGlzLmZpbGwoZnVuY3Rpb24gKHZhck5hbWUpIHtcclxuXHRcdFx0cmV0dXJuIG9ialt2YXJOYW1lXTtcclxuXHRcdH0pO1xyXG5cdH1cclxufTtcclxudmFyIFZhbGlkYXRvckNvbnRleHQgPSBmdW5jdGlvbiBWYWxpZGF0b3JDb250ZXh0KHBhcmVudCwgY29sbGVjdE11bHRpcGxlLCBlcnJvclJlcG9ydGVyLCBjaGVja1JlY3Vyc2l2ZSwgdHJhY2tVbmtub3duUHJvcGVydGllcykge1xyXG5cdHRoaXMubWlzc2luZyA9IFtdO1xyXG5cdHRoaXMubWlzc2luZ01hcCA9IHt9O1xyXG5cdHRoaXMuZm9ybWF0VmFsaWRhdG9ycyA9IHBhcmVudCA/IE9iamVjdC5jcmVhdGUocGFyZW50LmZvcm1hdFZhbGlkYXRvcnMpIDoge307XHJcblx0dGhpcy5zY2hlbWFzID0gcGFyZW50ID8gT2JqZWN0LmNyZWF0ZShwYXJlbnQuc2NoZW1hcykgOiB7fTtcclxuXHR0aGlzLmNvbGxlY3RNdWx0aXBsZSA9IGNvbGxlY3RNdWx0aXBsZTtcclxuXHR0aGlzLmVycm9ycyA9IFtdO1xyXG5cdHRoaXMuaGFuZGxlRXJyb3IgPSBjb2xsZWN0TXVsdGlwbGUgPyB0aGlzLmNvbGxlY3RFcnJvciA6IHRoaXMucmV0dXJuRXJyb3I7XHJcblx0aWYgKGNoZWNrUmVjdXJzaXZlKSB7XHJcblx0XHR0aGlzLmNoZWNrUmVjdXJzaXZlID0gdHJ1ZTtcclxuXHRcdHRoaXMuc2Nhbm5lZCA9IFtdO1xyXG5cdFx0dGhpcy5zY2FubmVkRnJvemVuID0gW107XHJcblx0XHR0aGlzLnNjYW5uZWRGcm96ZW5TY2hlbWFzID0gW107XHJcblx0XHR0aGlzLnNjYW5uZWRGcm96ZW5WYWxpZGF0aW9uRXJyb3JzID0gW107XHJcblx0XHR0aGlzLnZhbGlkYXRlZFNjaGVtYXNLZXkgPSAndHY0X3ZhbGlkYXRpb25faWQnO1xyXG5cdFx0dGhpcy52YWxpZGF0aW9uRXJyb3JzS2V5ID0gJ3R2NF92YWxpZGF0aW9uX2Vycm9yc19pZCc7XHJcblx0fVxyXG5cdGlmICh0cmFja1Vua25vd25Qcm9wZXJ0aWVzKSB7XHJcblx0XHR0aGlzLnRyYWNrVW5rbm93blByb3BlcnRpZXMgPSB0cnVlO1xyXG5cdFx0dGhpcy5rbm93blByb3BlcnR5UGF0aHMgPSB7fTtcclxuXHRcdHRoaXMudW5rbm93blByb3BlcnR5UGF0aHMgPSB7fTtcclxuXHR9XHJcblx0dGhpcy5lcnJvclJlcG9ydGVyID0gZXJyb3JSZXBvcnRlciB8fCBkZWZhdWx0RXJyb3JSZXBvcnRlcignZW4nKTtcclxuXHRpZiAodHlwZW9mIHRoaXMuZXJyb3JSZXBvcnRlciA9PT0gJ3N0cmluZycpIHtcclxuXHRcdHRocm93IG5ldyBFcnJvcignZGVidWcnKTtcclxuXHR9XHJcblx0dGhpcy5kZWZpbmVkS2V5d29yZHMgPSB7fTtcclxuXHRpZiAocGFyZW50KSB7XHJcblx0XHRmb3IgKHZhciBrZXkgaW4gcGFyZW50LmRlZmluZWRLZXl3b3Jkcykge1xyXG5cdFx0XHR0aGlzLmRlZmluZWRLZXl3b3Jkc1trZXldID0gcGFyZW50LmRlZmluZWRLZXl3b3Jkc1trZXldLnNsaWNlKDApO1xyXG5cdFx0fVxyXG5cdH1cclxufTtcclxuVmFsaWRhdG9yQ29udGV4dC5wcm90b3R5cGUuZGVmaW5lS2V5d29yZCA9IGZ1bmN0aW9uIChrZXl3b3JkLCBrZXl3b3JkRnVuY3Rpb24pIHtcclxuXHR0aGlzLmRlZmluZWRLZXl3b3Jkc1trZXl3b3JkXSA9IHRoaXMuZGVmaW5lZEtleXdvcmRzW2tleXdvcmRdIHx8IFtdO1xyXG5cdHRoaXMuZGVmaW5lZEtleXdvcmRzW2tleXdvcmRdLnB1c2goa2V5d29yZEZ1bmN0aW9uKTtcclxufTtcclxuVmFsaWRhdG9yQ29udGV4dC5wcm90b3R5cGUuY3JlYXRlRXJyb3IgPSBmdW5jdGlvbiAoY29kZSwgbWVzc2FnZVBhcmFtcywgZGF0YVBhdGgsIHNjaGVtYVBhdGgsIHN1YkVycm9ycywgZGF0YSwgc2NoZW1hKSB7XHJcblx0dmFyIGVycm9yID0gbmV3IFZhbGlkYXRpb25FcnJvcihjb2RlLCBtZXNzYWdlUGFyYW1zLCBkYXRhUGF0aCwgc2NoZW1hUGF0aCwgc3ViRXJyb3JzKTtcclxuXHRlcnJvci5tZXNzYWdlID0gdGhpcy5lcnJvclJlcG9ydGVyKGVycm9yLCBkYXRhLCBzY2hlbWEpO1xyXG5cdHJldHVybiBlcnJvcjtcclxufTtcclxuVmFsaWRhdG9yQ29udGV4dC5wcm90b3R5cGUucmV0dXJuRXJyb3IgPSBmdW5jdGlvbiAoZXJyb3IpIHtcclxuXHRyZXR1cm4gZXJyb3I7XHJcbn07XHJcblZhbGlkYXRvckNvbnRleHQucHJvdG90eXBlLmNvbGxlY3RFcnJvciA9IGZ1bmN0aW9uIChlcnJvcikge1xyXG5cdGlmIChlcnJvcikge1xyXG5cdFx0dGhpcy5lcnJvcnMucHVzaChlcnJvcik7XHJcblx0fVxyXG5cdHJldHVybiBudWxsO1xyXG59O1xyXG5WYWxpZGF0b3JDb250ZXh0LnByb3RvdHlwZS5wcmVmaXhFcnJvcnMgPSBmdW5jdGlvbiAoc3RhcnRJbmRleCwgZGF0YVBhdGgsIHNjaGVtYVBhdGgpIHtcclxuXHRmb3IgKHZhciBpID0gc3RhcnRJbmRleDsgaSA8IHRoaXMuZXJyb3JzLmxlbmd0aDsgaSsrKSB7XHJcblx0XHR0aGlzLmVycm9yc1tpXSA9IHRoaXMuZXJyb3JzW2ldLnByZWZpeFdpdGgoZGF0YVBhdGgsIHNjaGVtYVBhdGgpO1xyXG5cdH1cclxuXHRyZXR1cm4gdGhpcztcclxufTtcclxuVmFsaWRhdG9yQ29udGV4dC5wcm90b3R5cGUuYmFuVW5rbm93blByb3BlcnRpZXMgPSBmdW5jdGlvbiAoZGF0YSwgc2NoZW1hKSB7XHJcblx0Zm9yICh2YXIgdW5rbm93blBhdGggaW4gdGhpcy51bmtub3duUHJvcGVydHlQYXRocykge1xyXG5cdFx0dmFyIGVycm9yID0gdGhpcy5jcmVhdGVFcnJvcihFcnJvckNvZGVzLlVOS05PV05fUFJPUEVSVFksIHtwYXRoOiB1bmtub3duUGF0aH0sIHVua25vd25QYXRoLCBcIlwiLCBudWxsLCBkYXRhLCBzY2hlbWEpO1xyXG5cdFx0dmFyIHJlc3VsdCA9IHRoaXMuaGFuZGxlRXJyb3IoZXJyb3IpO1xyXG5cdFx0aWYgKHJlc3VsdCkge1xyXG5cdFx0XHRyZXR1cm4gcmVzdWx0O1xyXG5cdFx0fVxyXG5cdH1cclxuXHRyZXR1cm4gbnVsbDtcclxufTtcclxuXHJcblZhbGlkYXRvckNvbnRleHQucHJvdG90eXBlLmFkZEZvcm1hdCA9IGZ1bmN0aW9uIChmb3JtYXQsIHZhbGlkYXRvcikge1xyXG5cdGlmICh0eXBlb2YgZm9ybWF0ID09PSAnb2JqZWN0Jykge1xyXG5cdFx0Zm9yICh2YXIga2V5IGluIGZvcm1hdCkge1xyXG5cdFx0XHR0aGlzLmFkZEZvcm1hdChrZXksIGZvcm1hdFtrZXldKTtcclxuXHRcdH1cclxuXHRcdHJldHVybiB0aGlzO1xyXG5cdH1cclxuXHR0aGlzLmZvcm1hdFZhbGlkYXRvcnNbZm9ybWF0XSA9IHZhbGlkYXRvcjtcclxufTtcclxuVmFsaWRhdG9yQ29udGV4dC5wcm90b3R5cGUucmVzb2x2ZVJlZnMgPSBmdW5jdGlvbiAoc2NoZW1hLCB1cmxIaXN0b3J5KSB7XHJcblx0aWYgKHNjaGVtYVsnJHJlZiddICE9PSB1bmRlZmluZWQpIHtcclxuXHRcdHVybEhpc3RvcnkgPSB1cmxIaXN0b3J5IHx8IHt9O1xyXG5cdFx0aWYgKHVybEhpc3Rvcnlbc2NoZW1hWyckcmVmJ11dKSB7XHJcblx0XHRcdHJldHVybiB0aGlzLmNyZWF0ZUVycm9yKEVycm9yQ29kZXMuQ0lSQ1VMQVJfUkVGRVJFTkNFLCB7dXJsczogT2JqZWN0LmtleXModXJsSGlzdG9yeSkuam9pbignLCAnKX0sICcnLCAnJywgbnVsbCwgdW5kZWZpbmVkLCBzY2hlbWEpO1xyXG5cdFx0fVxyXG5cdFx0dXJsSGlzdG9yeVtzY2hlbWFbJyRyZWYnXV0gPSB0cnVlO1xyXG5cdFx0c2NoZW1hID0gdGhpcy5nZXRTY2hlbWEoc2NoZW1hWyckcmVmJ10sIHVybEhpc3RvcnkpO1xyXG5cdH1cclxuXHRyZXR1cm4gc2NoZW1hO1xyXG59O1xyXG5WYWxpZGF0b3JDb250ZXh0LnByb3RvdHlwZS5nZXRTY2hlbWEgPSBmdW5jdGlvbiAodXJsLCB1cmxIaXN0b3J5KSB7XHJcblx0dmFyIHNjaGVtYTtcclxuXHRpZiAodGhpcy5zY2hlbWFzW3VybF0gIT09IHVuZGVmaW5lZCkge1xyXG5cdFx0c2NoZW1hID0gdGhpcy5zY2hlbWFzW3VybF07XHJcblx0XHRyZXR1cm4gdGhpcy5yZXNvbHZlUmVmcyhzY2hlbWEsIHVybEhpc3RvcnkpO1xyXG5cdH1cclxuXHR2YXIgYmFzZVVybCA9IHVybDtcclxuXHR2YXIgZnJhZ21lbnQgPSBcIlwiO1xyXG5cdGlmICh1cmwuaW5kZXhPZignIycpICE9PSAtMSkge1xyXG5cdFx0ZnJhZ21lbnQgPSB1cmwuc3Vic3RyaW5nKHVybC5pbmRleE9mKFwiI1wiKSArIDEpO1xyXG5cdFx0YmFzZVVybCA9IHVybC5zdWJzdHJpbmcoMCwgdXJsLmluZGV4T2YoXCIjXCIpKTtcclxuXHR9XHJcblx0aWYgKHR5cGVvZiB0aGlzLnNjaGVtYXNbYmFzZVVybF0gPT09ICdvYmplY3QnKSB7XHJcblx0XHRzY2hlbWEgPSB0aGlzLnNjaGVtYXNbYmFzZVVybF07XHJcblx0XHR2YXIgcG9pbnRlclBhdGggPSBkZWNvZGVVUklDb21wb25lbnQoZnJhZ21lbnQpO1xyXG5cdFx0aWYgKHBvaW50ZXJQYXRoID09PSBcIlwiKSB7XHJcblx0XHRcdHJldHVybiB0aGlzLnJlc29sdmVSZWZzKHNjaGVtYSwgdXJsSGlzdG9yeSk7XHJcblx0XHR9IGVsc2UgaWYgKHBvaW50ZXJQYXRoLmNoYXJBdCgwKSAhPT0gXCIvXCIpIHtcclxuXHRcdFx0cmV0dXJuIHVuZGVmaW5lZDtcclxuXHRcdH1cclxuXHRcdHZhciBwYXJ0cyA9IHBvaW50ZXJQYXRoLnNwbGl0KFwiL1wiKS5zbGljZSgxKTtcclxuXHRcdGZvciAodmFyIGkgPSAwOyBpIDwgcGFydHMubGVuZ3RoOyBpKyspIHtcclxuXHRcdFx0dmFyIGNvbXBvbmVudCA9IHBhcnRzW2ldLnJlcGxhY2UoL34xL2csIFwiL1wiKS5yZXBsYWNlKC9+MC9nLCBcIn5cIik7XHJcblx0XHRcdGlmIChzY2hlbWFbY29tcG9uZW50XSA9PT0gdW5kZWZpbmVkKSB7XHJcblx0XHRcdFx0c2NoZW1hID0gdW5kZWZpbmVkO1xyXG5cdFx0XHRcdGJyZWFrO1xyXG5cdFx0XHR9XHJcblx0XHRcdHNjaGVtYSA9IHNjaGVtYVtjb21wb25lbnRdO1xyXG5cdFx0fVxyXG5cdFx0aWYgKHNjaGVtYSAhPT0gdW5kZWZpbmVkKSB7XHJcblx0XHRcdHJldHVybiB0aGlzLnJlc29sdmVSZWZzKHNjaGVtYSwgdXJsSGlzdG9yeSk7XHJcblx0XHR9XHJcblx0fVxyXG5cdGlmICh0aGlzLm1pc3NpbmdbYmFzZVVybF0gPT09IHVuZGVmaW5lZCkge1xyXG5cdFx0dGhpcy5taXNzaW5nLnB1c2goYmFzZVVybCk7XHJcblx0XHR0aGlzLm1pc3NpbmdbYmFzZVVybF0gPSBiYXNlVXJsO1xyXG5cdFx0dGhpcy5taXNzaW5nTWFwW2Jhc2VVcmxdID0gYmFzZVVybDtcclxuXHR9XHJcbn07XHJcblZhbGlkYXRvckNvbnRleHQucHJvdG90eXBlLnNlYXJjaFNjaGVtYXMgPSBmdW5jdGlvbiAoc2NoZW1hLCB1cmwpIHtcclxuXHRpZiAoQXJyYXkuaXNBcnJheShzY2hlbWEpKSB7XHJcblx0XHRmb3IgKHZhciBpID0gMDsgaSA8IHNjaGVtYS5sZW5ndGg7IGkrKykge1xyXG5cdFx0XHR0aGlzLnNlYXJjaFNjaGVtYXMoc2NoZW1hW2ldLCB1cmwpO1xyXG5cdFx0fVxyXG5cdH0gZWxzZSBpZiAoc2NoZW1hICYmIHR5cGVvZiBzY2hlbWEgPT09IFwib2JqZWN0XCIpIHtcclxuXHRcdGlmICh0eXBlb2Ygc2NoZW1hLmlkID09PSBcInN0cmluZ1wiKSB7XHJcblx0XHRcdGlmIChpc1RydXN0ZWRVcmwodXJsLCBzY2hlbWEuaWQpKSB7XHJcblx0XHRcdFx0aWYgKHRoaXMuc2NoZW1hc1tzY2hlbWEuaWRdID09PSB1bmRlZmluZWQpIHtcclxuXHRcdFx0XHRcdHRoaXMuc2NoZW1hc1tzY2hlbWEuaWRdID0gc2NoZW1hO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdFx0Zm9yICh2YXIga2V5IGluIHNjaGVtYSkge1xyXG5cdFx0XHRpZiAoa2V5ICE9PSBcImVudW1cIikge1xyXG5cdFx0XHRcdGlmICh0eXBlb2Ygc2NoZW1hW2tleV0gPT09IFwib2JqZWN0XCIpIHtcclxuXHRcdFx0XHRcdHRoaXMuc2VhcmNoU2NoZW1hcyhzY2hlbWFba2V5XSwgdXJsKTtcclxuXHRcdFx0XHR9IGVsc2UgaWYgKGtleSA9PT0gXCIkcmVmXCIpIHtcclxuXHRcdFx0XHRcdHZhciB1cmkgPSBnZXREb2N1bWVudFVyaShzY2hlbWFba2V5XSk7XHJcblx0XHRcdFx0XHRpZiAodXJpICYmIHRoaXMuc2NoZW1hc1t1cmldID09PSB1bmRlZmluZWQgJiYgdGhpcy5taXNzaW5nTWFwW3VyaV0gPT09IHVuZGVmaW5lZCkge1xyXG5cdFx0XHRcdFx0XHR0aGlzLm1pc3NpbmdNYXBbdXJpXSA9IHVyaTtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHR9XHJcbn07XHJcblZhbGlkYXRvckNvbnRleHQucHJvdG90eXBlLmFkZFNjaGVtYSA9IGZ1bmN0aW9uICh1cmwsIHNjaGVtYSkge1xyXG5cdC8vb3ZlcmxvYWRcclxuXHRpZiAodHlwZW9mIHVybCAhPT0gJ3N0cmluZycgfHwgdHlwZW9mIHNjaGVtYSA9PT0gJ3VuZGVmaW5lZCcpIHtcclxuXHRcdGlmICh0eXBlb2YgdXJsID09PSAnb2JqZWN0JyAmJiB0eXBlb2YgdXJsLmlkID09PSAnc3RyaW5nJykge1xyXG5cdFx0XHRzY2hlbWEgPSB1cmw7XHJcblx0XHRcdHVybCA9IHNjaGVtYS5pZDtcclxuXHRcdH1cclxuXHRcdGVsc2Uge1xyXG5cdFx0XHRyZXR1cm47XHJcblx0XHR9XHJcblx0fVxyXG5cdGlmICh1cmwgPT09IGdldERvY3VtZW50VXJpKHVybCkgKyBcIiNcIikge1xyXG5cdFx0Ly8gUmVtb3ZlIGVtcHR5IGZyYWdtZW50XHJcblx0XHR1cmwgPSBnZXREb2N1bWVudFVyaSh1cmwpO1xyXG5cdH1cclxuXHR0aGlzLnNjaGVtYXNbdXJsXSA9IHNjaGVtYTtcclxuXHRkZWxldGUgdGhpcy5taXNzaW5nTWFwW3VybF07XHJcblx0bm9ybVNjaGVtYShzY2hlbWEsIHVybCk7XHJcblx0dGhpcy5zZWFyY2hTY2hlbWFzKHNjaGVtYSwgdXJsKTtcclxufTtcclxuXHJcblZhbGlkYXRvckNvbnRleHQucHJvdG90eXBlLmdldFNjaGVtYU1hcCA9IGZ1bmN0aW9uICgpIHtcclxuXHR2YXIgbWFwID0ge307XHJcblx0Zm9yICh2YXIga2V5IGluIHRoaXMuc2NoZW1hcykge1xyXG5cdFx0bWFwW2tleV0gPSB0aGlzLnNjaGVtYXNba2V5XTtcclxuXHR9XHJcblx0cmV0dXJuIG1hcDtcclxufTtcclxuXHJcblZhbGlkYXRvckNvbnRleHQucHJvdG90eXBlLmdldFNjaGVtYVVyaXMgPSBmdW5jdGlvbiAoZmlsdGVyUmVnRXhwKSB7XHJcblx0dmFyIGxpc3QgPSBbXTtcclxuXHRmb3IgKHZhciBrZXkgaW4gdGhpcy5zY2hlbWFzKSB7XHJcblx0XHRpZiAoIWZpbHRlclJlZ0V4cCB8fCBmaWx0ZXJSZWdFeHAudGVzdChrZXkpKSB7XHJcblx0XHRcdGxpc3QucHVzaChrZXkpO1xyXG5cdFx0fVxyXG5cdH1cclxuXHRyZXR1cm4gbGlzdDtcclxufTtcclxuXHJcblZhbGlkYXRvckNvbnRleHQucHJvdG90eXBlLmdldE1pc3NpbmdVcmlzID0gZnVuY3Rpb24gKGZpbHRlclJlZ0V4cCkge1xyXG5cdHZhciBsaXN0ID0gW107XHJcblx0Zm9yICh2YXIga2V5IGluIHRoaXMubWlzc2luZ01hcCkge1xyXG5cdFx0aWYgKCFmaWx0ZXJSZWdFeHAgfHwgZmlsdGVyUmVnRXhwLnRlc3Qoa2V5KSkge1xyXG5cdFx0XHRsaXN0LnB1c2goa2V5KTtcclxuXHRcdH1cclxuXHR9XHJcblx0cmV0dXJuIGxpc3Q7XHJcbn07XHJcblxyXG5WYWxpZGF0b3JDb250ZXh0LnByb3RvdHlwZS5kcm9wU2NoZW1hcyA9IGZ1bmN0aW9uICgpIHtcclxuXHR0aGlzLnNjaGVtYXMgPSB7fTtcclxuXHR0aGlzLnJlc2V0KCk7XHJcbn07XHJcblZhbGlkYXRvckNvbnRleHQucHJvdG90eXBlLnJlc2V0ID0gZnVuY3Rpb24gKCkge1xyXG5cdHRoaXMubWlzc2luZyA9IFtdO1xyXG5cdHRoaXMubWlzc2luZ01hcCA9IHt9O1xyXG5cdHRoaXMuZXJyb3JzID0gW107XHJcbn07XHJcblxyXG5WYWxpZGF0b3JDb250ZXh0LnByb3RvdHlwZS52YWxpZGF0ZUFsbCA9IGZ1bmN0aW9uIChkYXRhLCBzY2hlbWEsIGRhdGFQYXRoUGFydHMsIHNjaGVtYVBhdGhQYXJ0cywgZGF0YVBvaW50ZXJQYXRoKSB7XHJcblx0dmFyIHRvcExldmVsO1xyXG5cdHNjaGVtYSA9IHRoaXMucmVzb2x2ZVJlZnMoc2NoZW1hKTtcclxuXHRpZiAoIXNjaGVtYSkge1xyXG5cdFx0cmV0dXJuIG51bGw7XHJcblx0fSBlbHNlIGlmIChzY2hlbWEgaW5zdGFuY2VvZiBWYWxpZGF0aW9uRXJyb3IpIHtcclxuXHRcdHRoaXMuZXJyb3JzLnB1c2goc2NoZW1hKTtcclxuXHRcdHJldHVybiBzY2hlbWE7XHJcblx0fVxyXG5cclxuXHR2YXIgc3RhcnRFcnJvckNvdW50ID0gdGhpcy5lcnJvcnMubGVuZ3RoO1xyXG5cdHZhciBmcm96ZW5JbmRleCwgc2Nhbm5lZEZyb3plblNjaGVtYUluZGV4ID0gbnVsbCwgc2Nhbm5lZFNjaGVtYXNJbmRleCA9IG51bGw7XHJcblx0aWYgKHRoaXMuY2hlY2tSZWN1cnNpdmUgJiYgZGF0YSAmJiB0eXBlb2YgZGF0YSA9PT0gJ29iamVjdCcpIHtcclxuXHRcdHRvcExldmVsID0gIXRoaXMuc2Nhbm5lZC5sZW5ndGg7XHJcblx0XHRpZiAoZGF0YVt0aGlzLnZhbGlkYXRlZFNjaGVtYXNLZXldKSB7XHJcblx0XHRcdHZhciBzY2hlbWFJbmRleCA9IGRhdGFbdGhpcy52YWxpZGF0ZWRTY2hlbWFzS2V5XS5pbmRleE9mKHNjaGVtYSk7XHJcblx0XHRcdGlmIChzY2hlbWFJbmRleCAhPT0gLTEpIHtcclxuXHRcdFx0XHR0aGlzLmVycm9ycyA9IHRoaXMuZXJyb3JzLmNvbmNhdChkYXRhW3RoaXMudmFsaWRhdGlvbkVycm9yc0tleV1bc2NoZW1hSW5kZXhdKTtcclxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdFx0aWYgKE9iamVjdC5pc0Zyb3plbihkYXRhKSkge1xyXG5cdFx0XHRmcm96ZW5JbmRleCA9IHRoaXMuc2Nhbm5lZEZyb3plbi5pbmRleE9mKGRhdGEpO1xyXG5cdFx0XHRpZiAoZnJvemVuSW5kZXggIT09IC0xKSB7XHJcblx0XHRcdFx0dmFyIGZyb3plblNjaGVtYUluZGV4ID0gdGhpcy5zY2FubmVkRnJvemVuU2NoZW1hc1tmcm96ZW5JbmRleF0uaW5kZXhPZihzY2hlbWEpO1xyXG5cdFx0XHRcdGlmIChmcm96ZW5TY2hlbWFJbmRleCAhPT0gLTEpIHtcclxuXHRcdFx0XHRcdHRoaXMuZXJyb3JzID0gdGhpcy5lcnJvcnMuY29uY2F0KHRoaXMuc2Nhbm5lZEZyb3plblZhbGlkYXRpb25FcnJvcnNbZnJvemVuSW5kZXhdW2Zyb3plblNjaGVtYUluZGV4XSk7XHJcblx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHRcdHRoaXMuc2Nhbm5lZC5wdXNoKGRhdGEpO1xyXG5cdFx0aWYgKE9iamVjdC5pc0Zyb3plbihkYXRhKSkge1xyXG5cdFx0XHRpZiAoZnJvemVuSW5kZXggPT09IC0xKSB7XHJcblx0XHRcdFx0ZnJvemVuSW5kZXggPSB0aGlzLnNjYW5uZWRGcm96ZW4ubGVuZ3RoO1xyXG5cdFx0XHRcdHRoaXMuc2Nhbm5lZEZyb3plbi5wdXNoKGRhdGEpO1xyXG5cdFx0XHRcdHRoaXMuc2Nhbm5lZEZyb3plblNjaGVtYXMucHVzaChbXSk7XHJcblx0XHRcdH1cclxuXHRcdFx0c2Nhbm5lZEZyb3plblNjaGVtYUluZGV4ID0gdGhpcy5zY2FubmVkRnJvemVuU2NoZW1hc1tmcm96ZW5JbmRleF0ubGVuZ3RoO1xyXG5cdFx0XHR0aGlzLnNjYW5uZWRGcm96ZW5TY2hlbWFzW2Zyb3plbkluZGV4XVtzY2FubmVkRnJvemVuU2NoZW1hSW5kZXhdID0gc2NoZW1hO1xyXG5cdFx0XHR0aGlzLnNjYW5uZWRGcm96ZW5WYWxpZGF0aW9uRXJyb3JzW2Zyb3plbkluZGV4XVtzY2FubmVkRnJvemVuU2NoZW1hSW5kZXhdID0gW107XHJcblx0XHR9IGVsc2Uge1xyXG5cdFx0XHRpZiAoIWRhdGFbdGhpcy52YWxpZGF0ZWRTY2hlbWFzS2V5XSkge1xyXG5cdFx0XHRcdHRyeSB7XHJcblx0XHRcdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZGF0YSwgdGhpcy52YWxpZGF0ZWRTY2hlbWFzS2V5LCB7XHJcblx0XHRcdFx0XHRcdHZhbHVlOiBbXSxcclxuXHRcdFx0XHRcdFx0Y29uZmlndXJhYmxlOiB0cnVlXHJcblx0XHRcdFx0XHR9KTtcclxuXHRcdFx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShkYXRhLCB0aGlzLnZhbGlkYXRpb25FcnJvcnNLZXksIHtcclxuXHRcdFx0XHRcdFx0dmFsdWU6IFtdLFxyXG5cdFx0XHRcdFx0XHRjb25maWd1cmFibGU6IHRydWVcclxuXHRcdFx0XHRcdH0pO1xyXG5cdFx0XHRcdH0gY2F0Y2ggKGUpIHtcclxuXHRcdFx0XHRcdC8vSUUgNy84IHdvcmthcm91bmRcclxuXHRcdFx0XHRcdGRhdGFbdGhpcy52YWxpZGF0ZWRTY2hlbWFzS2V5XSA9IFtdO1xyXG5cdFx0XHRcdFx0ZGF0YVt0aGlzLnZhbGlkYXRpb25FcnJvcnNLZXldID0gW107XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblx0XHRcdHNjYW5uZWRTY2hlbWFzSW5kZXggPSBkYXRhW3RoaXMudmFsaWRhdGVkU2NoZW1hc0tleV0ubGVuZ3RoO1xyXG5cdFx0XHRkYXRhW3RoaXMudmFsaWRhdGVkU2NoZW1hc0tleV1bc2Nhbm5lZFNjaGVtYXNJbmRleF0gPSBzY2hlbWE7XHJcblx0XHRcdGRhdGFbdGhpcy52YWxpZGF0aW9uRXJyb3JzS2V5XVtzY2FubmVkU2NoZW1hc0luZGV4XSA9IFtdO1xyXG5cdFx0fVxyXG5cdH1cclxuXHJcblx0dmFyIGVycm9yQ291bnQgPSB0aGlzLmVycm9ycy5sZW5ndGg7XHJcblx0dmFyIGVycm9yID0gdGhpcy52YWxpZGF0ZUJhc2ljKGRhdGEsIHNjaGVtYSwgZGF0YVBvaW50ZXJQYXRoKVxyXG5cdFx0fHwgdGhpcy52YWxpZGF0ZU51bWVyaWMoZGF0YSwgc2NoZW1hLCBkYXRhUG9pbnRlclBhdGgpXHJcblx0XHR8fCB0aGlzLnZhbGlkYXRlU3RyaW5nKGRhdGEsIHNjaGVtYSwgZGF0YVBvaW50ZXJQYXRoKVxyXG5cdFx0fHwgdGhpcy52YWxpZGF0ZUFycmF5KGRhdGEsIHNjaGVtYSwgZGF0YVBvaW50ZXJQYXRoKVxyXG5cdFx0fHwgdGhpcy52YWxpZGF0ZU9iamVjdChkYXRhLCBzY2hlbWEsIGRhdGFQb2ludGVyUGF0aClcclxuXHRcdHx8IHRoaXMudmFsaWRhdGVDb21iaW5hdGlvbnMoZGF0YSwgc2NoZW1hLCBkYXRhUG9pbnRlclBhdGgpXHJcblx0XHR8fCB0aGlzLnZhbGlkYXRlSHlwZXJtZWRpYShkYXRhLCBzY2hlbWEsIGRhdGFQb2ludGVyUGF0aClcclxuXHRcdHx8IHRoaXMudmFsaWRhdGVGb3JtYXQoZGF0YSwgc2NoZW1hLCBkYXRhUG9pbnRlclBhdGgpXHJcblx0XHR8fCB0aGlzLnZhbGlkYXRlRGVmaW5lZEtleXdvcmRzKGRhdGEsIHNjaGVtYSwgZGF0YVBvaW50ZXJQYXRoKVxyXG5cdFx0fHwgbnVsbDtcclxuXHJcblx0aWYgKHRvcExldmVsKSB7XHJcblx0XHR3aGlsZSAodGhpcy5zY2FubmVkLmxlbmd0aCkge1xyXG5cdFx0XHR2YXIgaXRlbSA9IHRoaXMuc2Nhbm5lZC5wb3AoKTtcclxuXHRcdFx0ZGVsZXRlIGl0ZW1bdGhpcy52YWxpZGF0ZWRTY2hlbWFzS2V5XTtcclxuXHRcdH1cclxuXHRcdHRoaXMuc2Nhbm5lZEZyb3plbiA9IFtdO1xyXG5cdFx0dGhpcy5zY2FubmVkRnJvemVuU2NoZW1hcyA9IFtdO1xyXG5cdH1cclxuXHJcblx0aWYgKGVycm9yIHx8IGVycm9yQ291bnQgIT09IHRoaXMuZXJyb3JzLmxlbmd0aCkge1xyXG5cdFx0d2hpbGUgKChkYXRhUGF0aFBhcnRzICYmIGRhdGFQYXRoUGFydHMubGVuZ3RoKSB8fCAoc2NoZW1hUGF0aFBhcnRzICYmIHNjaGVtYVBhdGhQYXJ0cy5sZW5ndGgpKSB7XHJcblx0XHRcdHZhciBkYXRhUGFydCA9IChkYXRhUGF0aFBhcnRzICYmIGRhdGFQYXRoUGFydHMubGVuZ3RoKSA/IFwiXCIgKyBkYXRhUGF0aFBhcnRzLnBvcCgpIDogbnVsbDtcclxuXHRcdFx0dmFyIHNjaGVtYVBhcnQgPSAoc2NoZW1hUGF0aFBhcnRzICYmIHNjaGVtYVBhdGhQYXJ0cy5sZW5ndGgpID8gXCJcIiArIHNjaGVtYVBhdGhQYXJ0cy5wb3AoKSA6IG51bGw7XHJcblx0XHRcdGlmIChlcnJvcikge1xyXG5cdFx0XHRcdGVycm9yID0gZXJyb3IucHJlZml4V2l0aChkYXRhUGFydCwgc2NoZW1hUGFydCk7XHJcblx0XHRcdH1cclxuXHRcdFx0dGhpcy5wcmVmaXhFcnJvcnMoZXJyb3JDb3VudCwgZGF0YVBhcnQsIHNjaGVtYVBhcnQpO1xyXG5cdFx0fVxyXG5cdH1cclxuXHJcblx0aWYgKHNjYW5uZWRGcm96ZW5TY2hlbWFJbmRleCAhPT0gbnVsbCkge1xyXG5cdFx0dGhpcy5zY2FubmVkRnJvemVuVmFsaWRhdGlvbkVycm9yc1tmcm96ZW5JbmRleF1bc2Nhbm5lZEZyb3plblNjaGVtYUluZGV4XSA9IHRoaXMuZXJyb3JzLnNsaWNlKHN0YXJ0RXJyb3JDb3VudCk7XHJcblx0fSBlbHNlIGlmIChzY2FubmVkU2NoZW1hc0luZGV4ICE9PSBudWxsKSB7XHJcblx0XHRkYXRhW3RoaXMudmFsaWRhdGlvbkVycm9yc0tleV1bc2Nhbm5lZFNjaGVtYXNJbmRleF0gPSB0aGlzLmVycm9ycy5zbGljZShzdGFydEVycm9yQ291bnQpO1xyXG5cdH1cclxuXHJcblx0cmV0dXJuIHRoaXMuaGFuZGxlRXJyb3IoZXJyb3IpO1xyXG59O1xyXG5WYWxpZGF0b3JDb250ZXh0LnByb3RvdHlwZS52YWxpZGF0ZUZvcm1hdCA9IGZ1bmN0aW9uIChkYXRhLCBzY2hlbWEpIHtcclxuXHRpZiAodHlwZW9mIHNjaGVtYS5mb3JtYXQgIT09ICdzdHJpbmcnIHx8ICF0aGlzLmZvcm1hdFZhbGlkYXRvcnNbc2NoZW1hLmZvcm1hdF0pIHtcclxuXHRcdHJldHVybiBudWxsO1xyXG5cdH1cclxuXHR2YXIgZXJyb3JNZXNzYWdlID0gdGhpcy5mb3JtYXRWYWxpZGF0b3JzW3NjaGVtYS5mb3JtYXRdLmNhbGwobnVsbCwgZGF0YSwgc2NoZW1hKTtcclxuXHRpZiAodHlwZW9mIGVycm9yTWVzc2FnZSA9PT0gJ3N0cmluZycgfHwgdHlwZW9mIGVycm9yTWVzc2FnZSA9PT0gJ251bWJlcicpIHtcclxuXHRcdHJldHVybiB0aGlzLmNyZWF0ZUVycm9yKEVycm9yQ29kZXMuRk9STUFUX0NVU1RPTSwge21lc3NhZ2U6IGVycm9yTWVzc2FnZX0sICcnLCAnL2Zvcm1hdCcsIG51bGwsIGRhdGEsIHNjaGVtYSk7XHJcblx0fSBlbHNlIGlmIChlcnJvck1lc3NhZ2UgJiYgdHlwZW9mIGVycm9yTWVzc2FnZSA9PT0gJ29iamVjdCcpIHtcclxuXHRcdHJldHVybiB0aGlzLmNyZWF0ZUVycm9yKEVycm9yQ29kZXMuRk9STUFUX0NVU1RPTSwge21lc3NhZ2U6IGVycm9yTWVzc2FnZS5tZXNzYWdlIHx8IFwiP1wifSwgZXJyb3JNZXNzYWdlLmRhdGFQYXRoIHx8ICcnLCBlcnJvck1lc3NhZ2Uuc2NoZW1hUGF0aCB8fCBcIi9mb3JtYXRcIiwgbnVsbCwgZGF0YSwgc2NoZW1hKTtcclxuXHR9XHJcblx0cmV0dXJuIG51bGw7XHJcbn07XHJcblZhbGlkYXRvckNvbnRleHQucHJvdG90eXBlLnZhbGlkYXRlRGVmaW5lZEtleXdvcmRzID0gZnVuY3Rpb24gKGRhdGEsIHNjaGVtYSwgZGF0YVBvaW50ZXJQYXRoKSB7XHJcblx0Zm9yICh2YXIga2V5IGluIHRoaXMuZGVmaW5lZEtleXdvcmRzKSB7XHJcblx0XHRpZiAodHlwZW9mIHNjaGVtYVtrZXldID09PSAndW5kZWZpbmVkJykge1xyXG5cdFx0XHRjb250aW51ZTtcclxuXHRcdH1cclxuXHRcdHZhciB2YWxpZGF0aW9uRnVuY3Rpb25zID0gdGhpcy5kZWZpbmVkS2V5d29yZHNba2V5XTtcclxuXHRcdGZvciAodmFyIGkgPSAwOyBpIDwgdmFsaWRhdGlvbkZ1bmN0aW9ucy5sZW5ndGg7IGkrKykge1xyXG5cdFx0XHR2YXIgZnVuYyA9IHZhbGlkYXRpb25GdW5jdGlvbnNbaV07XHJcblx0XHRcdHZhciByZXN1bHQgPSBmdW5jKGRhdGEsIHNjaGVtYVtrZXldLCBzY2hlbWEsIGRhdGFQb2ludGVyUGF0aCk7XHJcblx0XHRcdGlmICh0eXBlb2YgcmVzdWx0ID09PSAnc3RyaW5nJyB8fCB0eXBlb2YgcmVzdWx0ID09PSAnbnVtYmVyJykge1xyXG5cdFx0XHRcdHJldHVybiB0aGlzLmNyZWF0ZUVycm9yKEVycm9yQ29kZXMuS0VZV09SRF9DVVNUT00sIHtrZXk6IGtleSwgbWVzc2FnZTogcmVzdWx0fSwgJycsICcnLCBudWxsLCBkYXRhLCBzY2hlbWEpLnByZWZpeFdpdGgobnVsbCwga2V5KTtcclxuXHRcdFx0fSBlbHNlIGlmIChyZXN1bHQgJiYgdHlwZW9mIHJlc3VsdCA9PT0gJ29iamVjdCcpIHtcclxuXHRcdFx0XHR2YXIgY29kZSA9IHJlc3VsdC5jb2RlO1xyXG5cdFx0XHRcdGlmICh0eXBlb2YgY29kZSA9PT0gJ3N0cmluZycpIHtcclxuXHRcdFx0XHRcdGlmICghRXJyb3JDb2Rlc1tjb2RlXSkge1xyXG5cdFx0XHRcdFx0XHR0aHJvdyBuZXcgRXJyb3IoJ1VuZGVmaW5lZCBlcnJvciBjb2RlICh1c2UgZGVmaW5lRXJyb3IpOiAnICsgY29kZSk7XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRjb2RlID0gRXJyb3JDb2Rlc1tjb2RlXTtcclxuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZiBjb2RlICE9PSAnbnVtYmVyJykge1xyXG5cdFx0XHRcdFx0Y29kZSA9IEVycm9yQ29kZXMuS0VZV09SRF9DVVNUT007XHJcblx0XHRcdFx0fVxyXG5cdFx0XHRcdHZhciBtZXNzYWdlUGFyYW1zID0gKHR5cGVvZiByZXN1bHQubWVzc2FnZSA9PT0gJ29iamVjdCcpID8gcmVzdWx0Lm1lc3NhZ2UgOiB7a2V5OiBrZXksIG1lc3NhZ2U6IHJlc3VsdC5tZXNzYWdlIHx8IFwiP1wifTtcclxuXHRcdFx0XHR2YXIgc2NoZW1hUGF0aCA9IHJlc3VsdC5zY2hlbWFQYXRoIHx8IChcIi9cIiArIGtleS5yZXBsYWNlKC9+L2csICd+MCcpLnJlcGxhY2UoL1xcLy9nLCAnfjEnKSk7XHJcblx0XHRcdFx0cmV0dXJuIHRoaXMuY3JlYXRlRXJyb3IoY29kZSwgbWVzc2FnZVBhcmFtcywgcmVzdWx0LmRhdGFQYXRoIHx8IG51bGwsIHNjaGVtYVBhdGgsIG51bGwsIGRhdGEsIHNjaGVtYSk7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHR9XHJcblx0cmV0dXJuIG51bGw7XHJcbn07XHJcblxyXG5mdW5jdGlvbiByZWN1cnNpdmVDb21wYXJlKEEsIEIpIHtcclxuXHRpZiAoQSA9PT0gQikge1xyXG5cdFx0cmV0dXJuIHRydWU7XHJcblx0fVxyXG5cdGlmIChBICYmIEIgJiYgdHlwZW9mIEEgPT09IFwib2JqZWN0XCIgJiYgdHlwZW9mIEIgPT09IFwib2JqZWN0XCIpIHtcclxuXHRcdGlmIChBcnJheS5pc0FycmF5KEEpICE9PSBBcnJheS5pc0FycmF5KEIpKSB7XHJcblx0XHRcdHJldHVybiBmYWxzZTtcclxuXHRcdH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheShBKSkge1xyXG5cdFx0XHRpZiAoQS5sZW5ndGggIT09IEIubGVuZ3RoKSB7XHJcblx0XHRcdFx0cmV0dXJuIGZhbHNlO1xyXG5cdFx0XHR9XHJcblx0XHRcdGZvciAodmFyIGkgPSAwOyBpIDwgQS5sZW5ndGg7IGkrKykge1xyXG5cdFx0XHRcdGlmICghcmVjdXJzaXZlQ29tcGFyZShBW2ldLCBCW2ldKSkge1xyXG5cdFx0XHRcdFx0cmV0dXJuIGZhbHNlO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cdFx0fSBlbHNlIHtcclxuXHRcdFx0dmFyIGtleTtcclxuXHRcdFx0Zm9yIChrZXkgaW4gQSkge1xyXG5cdFx0XHRcdGlmIChCW2tleV0gPT09IHVuZGVmaW5lZCAmJiBBW2tleV0gIT09IHVuZGVmaW5lZCkge1xyXG5cdFx0XHRcdFx0cmV0dXJuIGZhbHNlO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cdFx0XHRmb3IgKGtleSBpbiBCKSB7XHJcblx0XHRcdFx0aWYgKEFba2V5XSA9PT0gdW5kZWZpbmVkICYmIEJba2V5XSAhPT0gdW5kZWZpbmVkKSB7XHJcblx0XHRcdFx0XHRyZXR1cm4gZmFsc2U7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblx0XHRcdGZvciAoa2V5IGluIEEpIHtcclxuXHRcdFx0XHRpZiAoIXJlY3Vyc2l2ZUNvbXBhcmUoQVtrZXldLCBCW2tleV0pKSB7XHJcblx0XHRcdFx0XHRyZXR1cm4gZmFsc2U7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0XHRyZXR1cm4gdHJ1ZTtcclxuXHR9XHJcblx0cmV0dXJuIGZhbHNlO1xyXG59XHJcblxyXG5WYWxpZGF0b3JDb250ZXh0LnByb3RvdHlwZS52YWxpZGF0ZUJhc2ljID0gZnVuY3Rpb24gdmFsaWRhdGVCYXNpYyhkYXRhLCBzY2hlbWEsIGRhdGFQb2ludGVyUGF0aCkge1xyXG5cdHZhciBlcnJvcjtcclxuXHRpZiAoZXJyb3IgPSB0aGlzLnZhbGlkYXRlVHlwZShkYXRhLCBzY2hlbWEsIGRhdGFQb2ludGVyUGF0aCkpIHtcclxuXHRcdHJldHVybiBlcnJvci5wcmVmaXhXaXRoKG51bGwsIFwidHlwZVwiKTtcclxuXHR9XHJcblx0aWYgKGVycm9yID0gdGhpcy52YWxpZGF0ZUVudW0oZGF0YSwgc2NoZW1hLCBkYXRhUG9pbnRlclBhdGgpKSB7XHJcblx0XHRyZXR1cm4gZXJyb3IucHJlZml4V2l0aChudWxsLCBcInR5cGVcIik7XHJcblx0fVxyXG5cdHJldHVybiBudWxsO1xyXG59O1xyXG5cclxuVmFsaWRhdG9yQ29udGV4dC5wcm90b3R5cGUudmFsaWRhdGVUeXBlID0gZnVuY3Rpb24gdmFsaWRhdGVUeXBlKGRhdGEsIHNjaGVtYSkge1xyXG5cdGlmIChzY2hlbWEudHlwZSA9PT0gdW5kZWZpbmVkKSB7XHJcblx0XHRyZXR1cm4gbnVsbDtcclxuXHR9XHJcblx0dmFyIGRhdGFUeXBlID0gdHlwZW9mIGRhdGE7XHJcblx0aWYgKGRhdGEgPT09IG51bGwpIHtcclxuXHRcdGRhdGFUeXBlID0gXCJudWxsXCI7XHJcblx0fSBlbHNlIGlmIChBcnJheS5pc0FycmF5KGRhdGEpKSB7XHJcblx0XHRkYXRhVHlwZSA9IFwiYXJyYXlcIjtcclxuXHR9XHJcblx0dmFyIGFsbG93ZWRUeXBlcyA9IHNjaGVtYS50eXBlO1xyXG5cdGlmICghQXJyYXkuaXNBcnJheShhbGxvd2VkVHlwZXMpKSB7XHJcblx0XHRhbGxvd2VkVHlwZXMgPSBbYWxsb3dlZFR5cGVzXTtcclxuXHR9XHJcblxyXG5cdGZvciAodmFyIGkgPSAwOyBpIDwgYWxsb3dlZFR5cGVzLmxlbmd0aDsgaSsrKSB7XHJcblx0XHR2YXIgdHlwZSA9IGFsbG93ZWRUeXBlc1tpXTtcclxuXHRcdGlmICh0eXBlID09PSBkYXRhVHlwZSB8fCAodHlwZSA9PT0gXCJpbnRlZ2VyXCIgJiYgZGF0YVR5cGUgPT09IFwibnVtYmVyXCIgJiYgKGRhdGEgJSAxID09PSAwKSkpIHtcclxuXHRcdFx0cmV0dXJuIG51bGw7XHJcblx0XHR9XHJcblx0fVxyXG5cdHJldHVybiB0aGlzLmNyZWF0ZUVycm9yKEVycm9yQ29kZXMuSU5WQUxJRF9UWVBFLCB7dHlwZTogZGF0YVR5cGUsIGV4cGVjdGVkOiBhbGxvd2VkVHlwZXMuam9pbihcIi9cIil9LCAnJywgJycsIG51bGwsIGRhdGEsIHNjaGVtYSk7XHJcbn07XHJcblxyXG5WYWxpZGF0b3JDb250ZXh0LnByb3RvdHlwZS52YWxpZGF0ZUVudW0gPSBmdW5jdGlvbiB2YWxpZGF0ZUVudW0oZGF0YSwgc2NoZW1hKSB7XHJcblx0aWYgKHNjaGVtYVtcImVudW1cIl0gPT09IHVuZGVmaW5lZCkge1xyXG5cdFx0cmV0dXJuIG51bGw7XHJcblx0fVxyXG5cdGZvciAodmFyIGkgPSAwOyBpIDwgc2NoZW1hW1wiZW51bVwiXS5sZW5ndGg7IGkrKykge1xyXG5cdFx0dmFyIGVudW1WYWwgPSBzY2hlbWFbXCJlbnVtXCJdW2ldO1xyXG5cdFx0aWYgKHJlY3Vyc2l2ZUNvbXBhcmUoZGF0YSwgZW51bVZhbCkpIHtcclxuXHRcdFx0cmV0dXJuIG51bGw7XHJcblx0XHR9XHJcblx0fVxyXG5cdHJldHVybiB0aGlzLmNyZWF0ZUVycm9yKEVycm9yQ29kZXMuRU5VTV9NSVNNQVRDSCwge3ZhbHVlOiAodHlwZW9mIEpTT04gIT09ICd1bmRlZmluZWQnKSA/IEpTT04uc3RyaW5naWZ5KGRhdGEpIDogZGF0YX0sICcnLCAnJywgbnVsbCwgZGF0YSwgc2NoZW1hKTtcclxufTtcclxuXHJcblZhbGlkYXRvckNvbnRleHQucHJvdG90eXBlLnZhbGlkYXRlTnVtZXJpYyA9IGZ1bmN0aW9uIHZhbGlkYXRlTnVtZXJpYyhkYXRhLCBzY2hlbWEsIGRhdGFQb2ludGVyUGF0aCkge1xyXG5cdHJldHVybiB0aGlzLnZhbGlkYXRlTXVsdGlwbGVPZihkYXRhLCBzY2hlbWEsIGRhdGFQb2ludGVyUGF0aClcclxuXHRcdHx8IHRoaXMudmFsaWRhdGVNaW5NYXgoZGF0YSwgc2NoZW1hLCBkYXRhUG9pbnRlclBhdGgpXHJcblx0XHR8fCB0aGlzLnZhbGlkYXRlTmFOKGRhdGEsIHNjaGVtYSwgZGF0YVBvaW50ZXJQYXRoKVxyXG5cdFx0fHwgbnVsbDtcclxufTtcclxuXHJcbnZhciBDTE9TRV9FTk9VR0hfTE9XID0gTWF0aC5wb3coMiwgLTUxKTtcclxudmFyIENMT1NFX0VOT1VHSF9ISUdIID0gMSAtIENMT1NFX0VOT1VHSF9MT1c7XHJcblZhbGlkYXRvckNvbnRleHQucHJvdG90eXBlLnZhbGlkYXRlTXVsdGlwbGVPZiA9IGZ1bmN0aW9uIHZhbGlkYXRlTXVsdGlwbGVPZihkYXRhLCBzY2hlbWEpIHtcclxuXHR2YXIgbXVsdGlwbGVPZiA9IHNjaGVtYS5tdWx0aXBsZU9mIHx8IHNjaGVtYS5kaXZpc2libGVCeTtcclxuXHRpZiAobXVsdGlwbGVPZiA9PT0gdW5kZWZpbmVkKSB7XHJcblx0XHRyZXR1cm4gbnVsbDtcclxuXHR9XHJcblx0aWYgKHR5cGVvZiBkYXRhID09PSBcIm51bWJlclwiKSB7XHJcblx0XHR2YXIgcmVtYWluZGVyID0gKGRhdGEvbXVsdGlwbGVPZiklMTtcclxuXHRcdGlmIChyZW1haW5kZXIgPj0gQ0xPU0VfRU5PVUdIX0xPVyAmJiByZW1haW5kZXIgPCBDTE9TRV9FTk9VR0hfSElHSCkge1xyXG5cdFx0XHRyZXR1cm4gdGhpcy5jcmVhdGVFcnJvcihFcnJvckNvZGVzLk5VTUJFUl9NVUxUSVBMRV9PRiwge3ZhbHVlOiBkYXRhLCBtdWx0aXBsZU9mOiBtdWx0aXBsZU9mfSwgJycsICcnLCBudWxsLCBkYXRhLCBzY2hlbWEpO1xyXG5cdFx0fVxyXG5cdH1cclxuXHRyZXR1cm4gbnVsbDtcclxufTtcclxuXHJcblZhbGlkYXRvckNvbnRleHQucHJvdG90eXBlLnZhbGlkYXRlTWluTWF4ID0gZnVuY3Rpb24gdmFsaWRhdGVNaW5NYXgoZGF0YSwgc2NoZW1hKSB7XHJcblx0aWYgKHR5cGVvZiBkYXRhICE9PSBcIm51bWJlclwiKSB7XHJcblx0XHRyZXR1cm4gbnVsbDtcclxuXHR9XHJcblx0aWYgKHNjaGVtYS5taW5pbXVtICE9PSB1bmRlZmluZWQpIHtcclxuXHRcdGlmIChkYXRhIDwgc2NoZW1hLm1pbmltdW0pIHtcclxuXHRcdFx0cmV0dXJuIHRoaXMuY3JlYXRlRXJyb3IoRXJyb3JDb2Rlcy5OVU1CRVJfTUlOSU1VTSwge3ZhbHVlOiBkYXRhLCBtaW5pbXVtOiBzY2hlbWEubWluaW11bX0sICcnLCAnL21pbmltdW0nLCBudWxsLCBkYXRhLCBzY2hlbWEpO1xyXG5cdFx0fVxyXG5cdFx0aWYgKHNjaGVtYS5leGNsdXNpdmVNaW5pbXVtICYmIGRhdGEgPT09IHNjaGVtYS5taW5pbXVtKSB7XHJcblx0XHRcdHJldHVybiB0aGlzLmNyZWF0ZUVycm9yKEVycm9yQ29kZXMuTlVNQkVSX01JTklNVU1fRVhDTFVTSVZFLCB7dmFsdWU6IGRhdGEsIG1pbmltdW06IHNjaGVtYS5taW5pbXVtfSwgJycsICcvZXhjbHVzaXZlTWluaW11bScsIG51bGwsIGRhdGEsIHNjaGVtYSk7XHJcblx0XHR9XHJcblx0fVxyXG5cdGlmIChzY2hlbWEubWF4aW11bSAhPT0gdW5kZWZpbmVkKSB7XHJcblx0XHRpZiAoZGF0YSA+IHNjaGVtYS5tYXhpbXVtKSB7XHJcblx0XHRcdHJldHVybiB0aGlzLmNyZWF0ZUVycm9yKEVycm9yQ29kZXMuTlVNQkVSX01BWElNVU0sIHt2YWx1ZTogZGF0YSwgbWF4aW11bTogc2NoZW1hLm1heGltdW19LCAnJywgJy9tYXhpbXVtJywgbnVsbCwgZGF0YSwgc2NoZW1hKTtcclxuXHRcdH1cclxuXHRcdGlmIChzY2hlbWEuZXhjbHVzaXZlTWF4aW11bSAmJiBkYXRhID09PSBzY2hlbWEubWF4aW11bSkge1xyXG5cdFx0XHRyZXR1cm4gdGhpcy5jcmVhdGVFcnJvcihFcnJvckNvZGVzLk5VTUJFUl9NQVhJTVVNX0VYQ0xVU0lWRSwge3ZhbHVlOiBkYXRhLCBtYXhpbXVtOiBzY2hlbWEubWF4aW11bX0sICcnLCAnL2V4Y2x1c2l2ZU1heGltdW0nLCBudWxsLCBkYXRhLCBzY2hlbWEpO1xyXG5cdFx0fVxyXG5cdH1cclxuXHRyZXR1cm4gbnVsbDtcclxufTtcclxuXHJcblZhbGlkYXRvckNvbnRleHQucHJvdG90eXBlLnZhbGlkYXRlTmFOID0gZnVuY3Rpb24gdmFsaWRhdGVOYU4oZGF0YSwgc2NoZW1hKSB7XHJcblx0aWYgKHR5cGVvZiBkYXRhICE9PSBcIm51bWJlclwiKSB7XHJcblx0XHRyZXR1cm4gbnVsbDtcclxuXHR9XHJcblx0aWYgKGlzTmFOKGRhdGEpID09PSB0cnVlIHx8IGRhdGEgPT09IEluZmluaXR5IHx8IGRhdGEgPT09IC1JbmZpbml0eSkge1xyXG5cdFx0cmV0dXJuIHRoaXMuY3JlYXRlRXJyb3IoRXJyb3JDb2Rlcy5OVU1CRVJfTk9UX0FfTlVNQkVSLCB7dmFsdWU6IGRhdGF9LCAnJywgJy90eXBlJywgbnVsbCwgZGF0YSwgc2NoZW1hKTtcclxuXHR9XHJcblx0cmV0dXJuIG51bGw7XHJcbn07XHJcblxyXG5WYWxpZGF0b3JDb250ZXh0LnByb3RvdHlwZS52YWxpZGF0ZVN0cmluZyA9IGZ1bmN0aW9uIHZhbGlkYXRlU3RyaW5nKGRhdGEsIHNjaGVtYSwgZGF0YVBvaW50ZXJQYXRoKSB7XHJcblx0cmV0dXJuIHRoaXMudmFsaWRhdGVTdHJpbmdMZW5ndGgoZGF0YSwgc2NoZW1hLCBkYXRhUG9pbnRlclBhdGgpXHJcblx0XHR8fCB0aGlzLnZhbGlkYXRlU3RyaW5nUGF0dGVybihkYXRhLCBzY2hlbWEsIGRhdGFQb2ludGVyUGF0aClcclxuXHRcdHx8IG51bGw7XHJcbn07XHJcblxyXG5WYWxpZGF0b3JDb250ZXh0LnByb3RvdHlwZS52YWxpZGF0ZVN0cmluZ0xlbmd0aCA9IGZ1bmN0aW9uIHZhbGlkYXRlU3RyaW5nTGVuZ3RoKGRhdGEsIHNjaGVtYSkge1xyXG5cdGlmICh0eXBlb2YgZGF0YSAhPT0gXCJzdHJpbmdcIikge1xyXG5cdFx0cmV0dXJuIG51bGw7XHJcblx0fVxyXG5cdGlmIChzY2hlbWEubWluTGVuZ3RoICE9PSB1bmRlZmluZWQpIHtcclxuXHRcdGlmIChkYXRhLmxlbmd0aCA8IHNjaGVtYS5taW5MZW5ndGgpIHtcclxuXHRcdFx0cmV0dXJuIHRoaXMuY3JlYXRlRXJyb3IoRXJyb3JDb2Rlcy5TVFJJTkdfTEVOR1RIX1NIT1JULCB7bGVuZ3RoOiBkYXRhLmxlbmd0aCwgbWluaW11bTogc2NoZW1hLm1pbkxlbmd0aH0sICcnLCAnL21pbkxlbmd0aCcsIG51bGwsIGRhdGEsIHNjaGVtYSk7XHJcblx0XHR9XHJcblx0fVxyXG5cdGlmIChzY2hlbWEubWF4TGVuZ3RoICE9PSB1bmRlZmluZWQpIHtcclxuXHRcdGlmIChkYXRhLmxlbmd0aCA+IHNjaGVtYS5tYXhMZW5ndGgpIHtcclxuXHRcdFx0cmV0dXJuIHRoaXMuY3JlYXRlRXJyb3IoRXJyb3JDb2Rlcy5TVFJJTkdfTEVOR1RIX0xPTkcsIHtsZW5ndGg6IGRhdGEubGVuZ3RoLCBtYXhpbXVtOiBzY2hlbWEubWF4TGVuZ3RofSwgJycsICcvbWF4TGVuZ3RoJywgbnVsbCwgZGF0YSwgc2NoZW1hKTtcclxuXHRcdH1cclxuXHR9XHJcblx0cmV0dXJuIG51bGw7XHJcbn07XHJcblxyXG5WYWxpZGF0b3JDb250ZXh0LnByb3RvdHlwZS52YWxpZGF0ZVN0cmluZ1BhdHRlcm4gPSBmdW5jdGlvbiB2YWxpZGF0ZVN0cmluZ1BhdHRlcm4oZGF0YSwgc2NoZW1hKSB7XHJcblx0aWYgKHR5cGVvZiBkYXRhICE9PSBcInN0cmluZ1wiIHx8ICh0eXBlb2Ygc2NoZW1hLnBhdHRlcm4gIT09IFwic3RyaW5nXCIgJiYgIShzY2hlbWEucGF0dGVybiBpbnN0YW5jZW9mIFJlZ0V4cCkpKSB7XHJcblx0XHRyZXR1cm4gbnVsbDtcclxuXHR9XHJcblx0dmFyIHJlZ2V4cDtcclxuXHRpZiAoc2NoZW1hLnBhdHRlcm4gaW5zdGFuY2VvZiBSZWdFeHApIHtcclxuXHQgIHJlZ2V4cCA9IHNjaGVtYS5wYXR0ZXJuO1xyXG5cdH1cclxuXHRlbHNlIHtcclxuXHQgIHZhciBib2R5LCBmbGFncyA9ICcnO1xyXG5cdCAgLy8gQ2hlY2sgZm9yIHJlZ3VsYXIgZXhwcmVzc2lvbiBsaXRlcmFsc1xyXG5cdCAgLy8gQHNlZSBodHRwOi8vd3d3LmVjbWEtaW50ZXJuYXRpb25hbC5vcmcvZWNtYS0yNjIvNS4xLyNzZWMtNy44LjVcclxuXHQgIHZhciBsaXRlcmFsID0gc2NoZW1hLnBhdHRlcm4ubWF0Y2goL15cXC8oLispXFwvKFtpbWddKikkLyk7XHJcblx0ICBpZiAobGl0ZXJhbCkge1xyXG5cdCAgICBib2R5ID0gbGl0ZXJhbFsxXTtcclxuXHQgICAgZmxhZ3MgPSBsaXRlcmFsWzJdO1xyXG5cdCAgfVxyXG5cdCAgZWxzZSB7XHJcblx0ICAgIGJvZHkgPSBzY2hlbWEucGF0dGVybjtcclxuXHQgIH1cclxuXHQgIHJlZ2V4cCA9IG5ldyBSZWdFeHAoYm9keSwgZmxhZ3MpO1xyXG5cdH1cclxuXHRpZiAoIXJlZ2V4cC50ZXN0KGRhdGEpKSB7XHJcblx0XHRyZXR1cm4gdGhpcy5jcmVhdGVFcnJvcihFcnJvckNvZGVzLlNUUklOR19QQVRURVJOLCB7cGF0dGVybjogc2NoZW1hLnBhdHRlcm59LCAnJywgJy9wYXR0ZXJuJywgbnVsbCwgZGF0YSwgc2NoZW1hKTtcclxuXHR9XHJcblx0cmV0dXJuIG51bGw7XHJcbn07XHJcblxyXG5WYWxpZGF0b3JDb250ZXh0LnByb3RvdHlwZS52YWxpZGF0ZUFycmF5ID0gZnVuY3Rpb24gdmFsaWRhdGVBcnJheShkYXRhLCBzY2hlbWEsIGRhdGFQb2ludGVyUGF0aCkge1xyXG5cdGlmICghQXJyYXkuaXNBcnJheShkYXRhKSkge1xyXG5cdFx0cmV0dXJuIG51bGw7XHJcblx0fVxyXG5cdHJldHVybiB0aGlzLnZhbGlkYXRlQXJyYXlMZW5ndGgoZGF0YSwgc2NoZW1hLCBkYXRhUG9pbnRlclBhdGgpXHJcblx0XHR8fCB0aGlzLnZhbGlkYXRlQXJyYXlVbmlxdWVJdGVtcyhkYXRhLCBzY2hlbWEsIGRhdGFQb2ludGVyUGF0aClcclxuXHRcdHx8IHRoaXMudmFsaWRhdGVBcnJheUl0ZW1zKGRhdGEsIHNjaGVtYSwgZGF0YVBvaW50ZXJQYXRoKVxyXG5cdFx0fHwgbnVsbDtcclxufTtcclxuXHJcblZhbGlkYXRvckNvbnRleHQucHJvdG90eXBlLnZhbGlkYXRlQXJyYXlMZW5ndGggPSBmdW5jdGlvbiB2YWxpZGF0ZUFycmF5TGVuZ3RoKGRhdGEsIHNjaGVtYSkge1xyXG5cdHZhciBlcnJvcjtcclxuXHRpZiAoc2NoZW1hLm1pbkl0ZW1zICE9PSB1bmRlZmluZWQpIHtcclxuXHRcdGlmIChkYXRhLmxlbmd0aCA8IHNjaGVtYS5taW5JdGVtcykge1xyXG5cdFx0XHRlcnJvciA9IHRoaXMuY3JlYXRlRXJyb3IoRXJyb3JDb2Rlcy5BUlJBWV9MRU5HVEhfU0hPUlQsIHtsZW5ndGg6IGRhdGEubGVuZ3RoLCBtaW5pbXVtOiBzY2hlbWEubWluSXRlbXN9LCAnJywgJy9taW5JdGVtcycsIG51bGwsIGRhdGEsIHNjaGVtYSk7XHJcblx0XHRcdGlmICh0aGlzLmhhbmRsZUVycm9yKGVycm9yKSkge1xyXG5cdFx0XHRcdHJldHVybiBlcnJvcjtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdH1cclxuXHRpZiAoc2NoZW1hLm1heEl0ZW1zICE9PSB1bmRlZmluZWQpIHtcclxuXHRcdGlmIChkYXRhLmxlbmd0aCA+IHNjaGVtYS5tYXhJdGVtcykge1xyXG5cdFx0XHRlcnJvciA9IHRoaXMuY3JlYXRlRXJyb3IoRXJyb3JDb2Rlcy5BUlJBWV9MRU5HVEhfTE9ORywge2xlbmd0aDogZGF0YS5sZW5ndGgsIG1heGltdW06IHNjaGVtYS5tYXhJdGVtc30sICcnLCAnL21heEl0ZW1zJywgbnVsbCwgZGF0YSwgc2NoZW1hKTtcclxuXHRcdFx0aWYgKHRoaXMuaGFuZGxlRXJyb3IoZXJyb3IpKSB7XHJcblx0XHRcdFx0cmV0dXJuIGVycm9yO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0fVxyXG5cdHJldHVybiBudWxsO1xyXG59O1xyXG5cclxuVmFsaWRhdG9yQ29udGV4dC5wcm90b3R5cGUudmFsaWRhdGVBcnJheVVuaXF1ZUl0ZW1zID0gZnVuY3Rpb24gdmFsaWRhdGVBcnJheVVuaXF1ZUl0ZW1zKGRhdGEsIHNjaGVtYSkge1xyXG5cdGlmIChzY2hlbWEudW5pcXVlSXRlbXMpIHtcclxuXHRcdGZvciAodmFyIGkgPSAwOyBpIDwgZGF0YS5sZW5ndGg7IGkrKykge1xyXG5cdFx0XHRmb3IgKHZhciBqID0gaSArIDE7IGogPCBkYXRhLmxlbmd0aDsgaisrKSB7XHJcblx0XHRcdFx0aWYgKHJlY3Vyc2l2ZUNvbXBhcmUoZGF0YVtpXSwgZGF0YVtqXSkpIHtcclxuXHRcdFx0XHRcdHZhciBlcnJvciA9IHRoaXMuY3JlYXRlRXJyb3IoRXJyb3JDb2Rlcy5BUlJBWV9VTklRVUUsIHttYXRjaDE6IGksIG1hdGNoMjogan0sICcnLCAnL3VuaXF1ZUl0ZW1zJywgbnVsbCwgZGF0YSwgc2NoZW1hKTtcclxuXHRcdFx0XHRcdGlmICh0aGlzLmhhbmRsZUVycm9yKGVycm9yKSkge1xyXG5cdFx0XHRcdFx0XHRyZXR1cm4gZXJyb3I7XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0fVxyXG5cdHJldHVybiBudWxsO1xyXG59O1xyXG5cclxuVmFsaWRhdG9yQ29udGV4dC5wcm90b3R5cGUudmFsaWRhdGVBcnJheUl0ZW1zID0gZnVuY3Rpb24gdmFsaWRhdGVBcnJheUl0ZW1zKGRhdGEsIHNjaGVtYSwgZGF0YVBvaW50ZXJQYXRoKSB7XHJcblx0aWYgKHNjaGVtYS5pdGVtcyA9PT0gdW5kZWZpbmVkKSB7XHJcblx0XHRyZXR1cm4gbnVsbDtcclxuXHR9XHJcblx0dmFyIGVycm9yLCBpO1xyXG5cdGlmIChBcnJheS5pc0FycmF5KHNjaGVtYS5pdGVtcykpIHtcclxuXHRcdGZvciAoaSA9IDA7IGkgPCBkYXRhLmxlbmd0aDsgaSsrKSB7XHJcblx0XHRcdGlmIChpIDwgc2NoZW1hLml0ZW1zLmxlbmd0aCkge1xyXG5cdFx0XHRcdGlmIChlcnJvciA9IHRoaXMudmFsaWRhdGVBbGwoZGF0YVtpXSwgc2NoZW1hLml0ZW1zW2ldLCBbaV0sIFtcIml0ZW1zXCIsIGldLCBkYXRhUG9pbnRlclBhdGggKyBcIi9cIiArIGkpKSB7XHJcblx0XHRcdFx0XHRyZXR1cm4gZXJyb3I7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9IGVsc2UgaWYgKHNjaGVtYS5hZGRpdGlvbmFsSXRlbXMgIT09IHVuZGVmaW5lZCkge1xyXG5cdFx0XHRcdGlmICh0eXBlb2Ygc2NoZW1hLmFkZGl0aW9uYWxJdGVtcyA9PT0gXCJib29sZWFuXCIpIHtcclxuXHRcdFx0XHRcdGlmICghc2NoZW1hLmFkZGl0aW9uYWxJdGVtcykge1xyXG5cdFx0XHRcdFx0XHRlcnJvciA9ICh0aGlzLmNyZWF0ZUVycm9yKEVycm9yQ29kZXMuQVJSQVlfQURESVRJT05BTF9JVEVNUywge30sICcvJyArIGksICcvYWRkaXRpb25hbEl0ZW1zJywgbnVsbCwgZGF0YSwgc2NoZW1hKSk7XHJcblx0XHRcdFx0XHRcdGlmICh0aGlzLmhhbmRsZUVycm9yKGVycm9yKSkge1xyXG5cdFx0XHRcdFx0XHRcdHJldHVybiBlcnJvcjtcclxuXHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdH0gZWxzZSBpZiAoZXJyb3IgPSB0aGlzLnZhbGlkYXRlQWxsKGRhdGFbaV0sIHNjaGVtYS5hZGRpdGlvbmFsSXRlbXMsIFtpXSwgW1wiYWRkaXRpb25hbEl0ZW1zXCJdLCBkYXRhUG9pbnRlclBhdGggKyBcIi9cIiArIGkpKSB7XHJcblx0XHRcdFx0XHRyZXR1cm4gZXJyb3I7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0fSBlbHNlIHtcclxuXHRcdGZvciAoaSA9IDA7IGkgPCBkYXRhLmxlbmd0aDsgaSsrKSB7XHJcblx0XHRcdGlmIChlcnJvciA9IHRoaXMudmFsaWRhdGVBbGwoZGF0YVtpXSwgc2NoZW1hLml0ZW1zLCBbaV0sIFtcIml0ZW1zXCJdLCBkYXRhUG9pbnRlclBhdGggKyBcIi9cIiArIGkpKSB7XHJcblx0XHRcdFx0cmV0dXJuIGVycm9yO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0fVxyXG5cdHJldHVybiBudWxsO1xyXG59O1xyXG5cclxuVmFsaWRhdG9yQ29udGV4dC5wcm90b3R5cGUudmFsaWRhdGVPYmplY3QgPSBmdW5jdGlvbiB2YWxpZGF0ZU9iamVjdChkYXRhLCBzY2hlbWEsIGRhdGFQb2ludGVyUGF0aCkge1xyXG5cdGlmICh0eXBlb2YgZGF0YSAhPT0gXCJvYmplY3RcIiB8fCBkYXRhID09PSBudWxsIHx8IEFycmF5LmlzQXJyYXkoZGF0YSkpIHtcclxuXHRcdHJldHVybiBudWxsO1xyXG5cdH1cclxuXHRyZXR1cm4gdGhpcy52YWxpZGF0ZU9iamVjdE1pbk1heFByb3BlcnRpZXMoZGF0YSwgc2NoZW1hLCBkYXRhUG9pbnRlclBhdGgpXHJcblx0XHR8fCB0aGlzLnZhbGlkYXRlT2JqZWN0UmVxdWlyZWRQcm9wZXJ0aWVzKGRhdGEsIHNjaGVtYSwgZGF0YVBvaW50ZXJQYXRoKVxyXG5cdFx0fHwgdGhpcy52YWxpZGF0ZU9iamVjdFByb3BlcnRpZXMoZGF0YSwgc2NoZW1hLCBkYXRhUG9pbnRlclBhdGgpXHJcblx0XHR8fCB0aGlzLnZhbGlkYXRlT2JqZWN0RGVwZW5kZW5jaWVzKGRhdGEsIHNjaGVtYSwgZGF0YVBvaW50ZXJQYXRoKVxyXG5cdFx0fHwgbnVsbDtcclxufTtcclxuXHJcblZhbGlkYXRvckNvbnRleHQucHJvdG90eXBlLnZhbGlkYXRlT2JqZWN0TWluTWF4UHJvcGVydGllcyA9IGZ1bmN0aW9uIHZhbGlkYXRlT2JqZWN0TWluTWF4UHJvcGVydGllcyhkYXRhLCBzY2hlbWEpIHtcclxuXHR2YXIga2V5cyA9IE9iamVjdC5rZXlzKGRhdGEpO1xyXG5cdHZhciBlcnJvcjtcclxuXHRpZiAoc2NoZW1hLm1pblByb3BlcnRpZXMgIT09IHVuZGVmaW5lZCkge1xyXG5cdFx0aWYgKGtleXMubGVuZ3RoIDwgc2NoZW1hLm1pblByb3BlcnRpZXMpIHtcclxuXHRcdFx0ZXJyb3IgPSB0aGlzLmNyZWF0ZUVycm9yKEVycm9yQ29kZXMuT0JKRUNUX1BST1BFUlRJRVNfTUlOSU1VTSwge3Byb3BlcnR5Q291bnQ6IGtleXMubGVuZ3RoLCBtaW5pbXVtOiBzY2hlbWEubWluUHJvcGVydGllc30sICcnLCAnL21pblByb3BlcnRpZXMnLCBudWxsLCBkYXRhLCBzY2hlbWEpO1xyXG5cdFx0XHRpZiAodGhpcy5oYW5kbGVFcnJvcihlcnJvcikpIHtcclxuXHRcdFx0XHRyZXR1cm4gZXJyb3I7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHR9XHJcblx0aWYgKHNjaGVtYS5tYXhQcm9wZXJ0aWVzICE9PSB1bmRlZmluZWQpIHtcclxuXHRcdGlmIChrZXlzLmxlbmd0aCA+IHNjaGVtYS5tYXhQcm9wZXJ0aWVzKSB7XHJcblx0XHRcdGVycm9yID0gdGhpcy5jcmVhdGVFcnJvcihFcnJvckNvZGVzLk9CSkVDVF9QUk9QRVJUSUVTX01BWElNVU0sIHtwcm9wZXJ0eUNvdW50OiBrZXlzLmxlbmd0aCwgbWF4aW11bTogc2NoZW1hLm1heFByb3BlcnRpZXN9LCAnJywgJy9tYXhQcm9wZXJ0aWVzJywgbnVsbCwgZGF0YSwgc2NoZW1hKTtcclxuXHRcdFx0aWYgKHRoaXMuaGFuZGxlRXJyb3IoZXJyb3IpKSB7XHJcblx0XHRcdFx0cmV0dXJuIGVycm9yO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0fVxyXG5cdHJldHVybiBudWxsO1xyXG59O1xyXG5cclxuVmFsaWRhdG9yQ29udGV4dC5wcm90b3R5cGUudmFsaWRhdGVPYmplY3RSZXF1aXJlZFByb3BlcnRpZXMgPSBmdW5jdGlvbiB2YWxpZGF0ZU9iamVjdFJlcXVpcmVkUHJvcGVydGllcyhkYXRhLCBzY2hlbWEpIHtcclxuXHRpZiAoc2NoZW1hLnJlcXVpcmVkICE9PSB1bmRlZmluZWQpIHtcclxuXHRcdGZvciAodmFyIGkgPSAwOyBpIDwgc2NoZW1hLnJlcXVpcmVkLmxlbmd0aDsgaSsrKSB7XHJcblx0XHRcdHZhciBrZXkgPSBzY2hlbWEucmVxdWlyZWRbaV07XHJcblx0XHRcdGlmIChkYXRhW2tleV0gPT09IHVuZGVmaW5lZCkge1xyXG5cdFx0XHRcdHZhciBlcnJvciA9IHRoaXMuY3JlYXRlRXJyb3IoRXJyb3JDb2Rlcy5PQkpFQ1RfUkVRVUlSRUQsIHtrZXk6IGtleX0sICcnLCAnL3JlcXVpcmVkLycgKyBpLCBudWxsLCBkYXRhLCBzY2hlbWEpO1xyXG5cdFx0XHRcdGlmICh0aGlzLmhhbmRsZUVycm9yKGVycm9yKSkge1xyXG5cdFx0XHRcdFx0cmV0dXJuIGVycm9yO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdH1cclxuXHRyZXR1cm4gbnVsbDtcclxufTtcclxuXHJcblZhbGlkYXRvckNvbnRleHQucHJvdG90eXBlLnZhbGlkYXRlT2JqZWN0UHJvcGVydGllcyA9IGZ1bmN0aW9uIHZhbGlkYXRlT2JqZWN0UHJvcGVydGllcyhkYXRhLCBzY2hlbWEsIGRhdGFQb2ludGVyUGF0aCkge1xyXG5cdHZhciBlcnJvcjtcclxuXHRmb3IgKHZhciBrZXkgaW4gZGF0YSkge1xyXG5cdFx0dmFyIGtleVBvaW50ZXJQYXRoID0gZGF0YVBvaW50ZXJQYXRoICsgXCIvXCIgKyBrZXkucmVwbGFjZSgvfi9nLCAnfjAnKS5yZXBsYWNlKC9cXC8vZywgJ34xJyk7XHJcblx0XHR2YXIgZm91bmRNYXRjaCA9IGZhbHNlO1xyXG5cdFx0aWYgKHNjaGVtYS5wcm9wZXJ0aWVzICE9PSB1bmRlZmluZWQgJiYgc2NoZW1hLnByb3BlcnRpZXNba2V5XSAhPT0gdW5kZWZpbmVkKSB7XHJcblx0XHRcdGZvdW5kTWF0Y2ggPSB0cnVlO1xyXG5cdFx0XHRpZiAoZXJyb3IgPSB0aGlzLnZhbGlkYXRlQWxsKGRhdGFba2V5XSwgc2NoZW1hLnByb3BlcnRpZXNba2V5XSwgW2tleV0sIFtcInByb3BlcnRpZXNcIiwga2V5XSwga2V5UG9pbnRlclBhdGgpKSB7XHJcblx0XHRcdFx0cmV0dXJuIGVycm9yO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0XHRpZiAoc2NoZW1hLnBhdHRlcm5Qcm9wZXJ0aWVzICE9PSB1bmRlZmluZWQpIHtcclxuXHRcdFx0Zm9yICh2YXIgcGF0dGVybktleSBpbiBzY2hlbWEucGF0dGVyblByb3BlcnRpZXMpIHtcclxuXHRcdFx0XHR2YXIgcmVnZXhwID0gbmV3IFJlZ0V4cChwYXR0ZXJuS2V5KTtcclxuXHRcdFx0XHRpZiAocmVnZXhwLnRlc3Qoa2V5KSkge1xyXG5cdFx0XHRcdFx0Zm91bmRNYXRjaCA9IHRydWU7XHJcblx0XHRcdFx0XHRpZiAoZXJyb3IgPSB0aGlzLnZhbGlkYXRlQWxsKGRhdGFba2V5XSwgc2NoZW1hLnBhdHRlcm5Qcm9wZXJ0aWVzW3BhdHRlcm5LZXldLCBba2V5XSwgW1wicGF0dGVyblByb3BlcnRpZXNcIiwgcGF0dGVybktleV0sIGtleVBvaW50ZXJQYXRoKSkge1xyXG5cdFx0XHRcdFx0XHRyZXR1cm4gZXJyb3I7XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0XHRpZiAoIWZvdW5kTWF0Y2gpIHtcclxuXHRcdFx0aWYgKHNjaGVtYS5hZGRpdGlvbmFsUHJvcGVydGllcyAhPT0gdW5kZWZpbmVkKSB7XHJcblx0XHRcdFx0aWYgKHRoaXMudHJhY2tVbmtub3duUHJvcGVydGllcykge1xyXG5cdFx0XHRcdFx0dGhpcy5rbm93blByb3BlcnR5UGF0aHNba2V5UG9pbnRlclBhdGhdID0gdHJ1ZTtcclxuXHRcdFx0XHRcdGRlbGV0ZSB0aGlzLnVua25vd25Qcm9wZXJ0eVBhdGhzW2tleVBvaW50ZXJQYXRoXTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdFx0aWYgKHR5cGVvZiBzY2hlbWEuYWRkaXRpb25hbFByb3BlcnRpZXMgPT09IFwiYm9vbGVhblwiKSB7XHJcblx0XHRcdFx0XHRpZiAoIXNjaGVtYS5hZGRpdGlvbmFsUHJvcGVydGllcykge1xyXG5cdFx0XHRcdFx0XHRlcnJvciA9IHRoaXMuY3JlYXRlRXJyb3IoRXJyb3JDb2Rlcy5PQkpFQ1RfQURESVRJT05BTF9QUk9QRVJUSUVTLCB7a2V5OiBrZXl9LCAnJywgJy9hZGRpdGlvbmFsUHJvcGVydGllcycsIG51bGwsIGRhdGEsIHNjaGVtYSkucHJlZml4V2l0aChrZXksIG51bGwpO1xyXG5cdFx0XHRcdFx0XHRpZiAodGhpcy5oYW5kbGVFcnJvcihlcnJvcikpIHtcclxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gZXJyb3I7XHJcblx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHR9IGVsc2Uge1xyXG5cdFx0XHRcdFx0aWYgKGVycm9yID0gdGhpcy52YWxpZGF0ZUFsbChkYXRhW2tleV0sIHNjaGVtYS5hZGRpdGlvbmFsUHJvcGVydGllcywgW2tleV0sIFtcImFkZGl0aW9uYWxQcm9wZXJ0aWVzXCJdLCBrZXlQb2ludGVyUGF0aCkpIHtcclxuXHRcdFx0XHRcdFx0cmV0dXJuIGVycm9yO1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdH1cclxuXHRcdFx0fSBlbHNlIGlmICh0aGlzLnRyYWNrVW5rbm93blByb3BlcnRpZXMgJiYgIXRoaXMua25vd25Qcm9wZXJ0eVBhdGhzW2tleVBvaW50ZXJQYXRoXSkge1xyXG5cdFx0XHRcdHRoaXMudW5rbm93blByb3BlcnR5UGF0aHNba2V5UG9pbnRlclBhdGhdID0gdHJ1ZTtcclxuXHRcdFx0fVxyXG5cdFx0fSBlbHNlIGlmICh0aGlzLnRyYWNrVW5rbm93blByb3BlcnRpZXMpIHtcclxuXHRcdFx0dGhpcy5rbm93blByb3BlcnR5UGF0aHNba2V5UG9pbnRlclBhdGhdID0gdHJ1ZTtcclxuXHRcdFx0ZGVsZXRlIHRoaXMudW5rbm93blByb3BlcnR5UGF0aHNba2V5UG9pbnRlclBhdGhdO1xyXG5cdFx0fVxyXG5cdH1cclxuXHRyZXR1cm4gbnVsbDtcclxufTtcclxuXHJcblZhbGlkYXRvckNvbnRleHQucHJvdG90eXBlLnZhbGlkYXRlT2JqZWN0RGVwZW5kZW5jaWVzID0gZnVuY3Rpb24gdmFsaWRhdGVPYmplY3REZXBlbmRlbmNpZXMoZGF0YSwgc2NoZW1hLCBkYXRhUG9pbnRlclBhdGgpIHtcclxuXHR2YXIgZXJyb3I7XHJcblx0aWYgKHNjaGVtYS5kZXBlbmRlbmNpZXMgIT09IHVuZGVmaW5lZCkge1xyXG5cdFx0Zm9yICh2YXIgZGVwS2V5IGluIHNjaGVtYS5kZXBlbmRlbmNpZXMpIHtcclxuXHRcdFx0aWYgKGRhdGFbZGVwS2V5XSAhPT0gdW5kZWZpbmVkKSB7XHJcblx0XHRcdFx0dmFyIGRlcCA9IHNjaGVtYS5kZXBlbmRlbmNpZXNbZGVwS2V5XTtcclxuXHRcdFx0XHRpZiAodHlwZW9mIGRlcCA9PT0gXCJzdHJpbmdcIikge1xyXG5cdFx0XHRcdFx0aWYgKGRhdGFbZGVwXSA9PT0gdW5kZWZpbmVkKSB7XHJcblx0XHRcdFx0XHRcdGVycm9yID0gdGhpcy5jcmVhdGVFcnJvcihFcnJvckNvZGVzLk9CSkVDVF9ERVBFTkRFTkNZX0tFWSwge2tleTogZGVwS2V5LCBtaXNzaW5nOiBkZXB9LCAnJywgJycsIG51bGwsIGRhdGEsIHNjaGVtYSkucHJlZml4V2l0aChudWxsLCBkZXBLZXkpLnByZWZpeFdpdGgobnVsbCwgXCJkZXBlbmRlbmNpZXNcIik7XHJcblx0XHRcdFx0XHRcdGlmICh0aGlzLmhhbmRsZUVycm9yKGVycm9yKSkge1xyXG5cdFx0XHRcdFx0XHRcdHJldHVybiBlcnJvcjtcclxuXHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheShkZXApKSB7XHJcblx0XHRcdFx0XHRmb3IgKHZhciBpID0gMDsgaSA8IGRlcC5sZW5ndGg7IGkrKykge1xyXG5cdFx0XHRcdFx0XHR2YXIgcmVxdWlyZWRLZXkgPSBkZXBbaV07XHJcblx0XHRcdFx0XHRcdGlmIChkYXRhW3JlcXVpcmVkS2V5XSA9PT0gdW5kZWZpbmVkKSB7XHJcblx0XHRcdFx0XHRcdFx0ZXJyb3IgPSB0aGlzLmNyZWF0ZUVycm9yKEVycm9yQ29kZXMuT0JKRUNUX0RFUEVOREVOQ1lfS0VZLCB7a2V5OiBkZXBLZXksIG1pc3Npbmc6IHJlcXVpcmVkS2V5fSwgJycsICcvJyArIGksIG51bGwsIGRhdGEsIHNjaGVtYSkucHJlZml4V2l0aChudWxsLCBkZXBLZXkpLnByZWZpeFdpdGgobnVsbCwgXCJkZXBlbmRlbmNpZXNcIik7XHJcblx0XHRcdFx0XHRcdFx0aWYgKHRoaXMuaGFuZGxlRXJyb3IoZXJyb3IpKSB7XHJcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gZXJyb3I7XHJcblx0XHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0fSBlbHNlIHtcclxuXHRcdFx0XHRcdGlmIChlcnJvciA9IHRoaXMudmFsaWRhdGVBbGwoZGF0YSwgZGVwLCBbXSwgW1wiZGVwZW5kZW5jaWVzXCIsIGRlcEtleV0sIGRhdGFQb2ludGVyUGF0aCkpIHtcclxuXHRcdFx0XHRcdFx0cmV0dXJuIGVycm9yO1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdH1cclxuXHRyZXR1cm4gbnVsbDtcclxufTtcclxuXHJcblZhbGlkYXRvckNvbnRleHQucHJvdG90eXBlLnZhbGlkYXRlQ29tYmluYXRpb25zID0gZnVuY3Rpb24gdmFsaWRhdGVDb21iaW5hdGlvbnMoZGF0YSwgc2NoZW1hLCBkYXRhUG9pbnRlclBhdGgpIHtcclxuXHRyZXR1cm4gdGhpcy52YWxpZGF0ZUFsbE9mKGRhdGEsIHNjaGVtYSwgZGF0YVBvaW50ZXJQYXRoKVxyXG5cdFx0fHwgdGhpcy52YWxpZGF0ZUFueU9mKGRhdGEsIHNjaGVtYSwgZGF0YVBvaW50ZXJQYXRoKVxyXG5cdFx0fHwgdGhpcy52YWxpZGF0ZU9uZU9mKGRhdGEsIHNjaGVtYSwgZGF0YVBvaW50ZXJQYXRoKVxyXG5cdFx0fHwgdGhpcy52YWxpZGF0ZU5vdChkYXRhLCBzY2hlbWEsIGRhdGFQb2ludGVyUGF0aClcclxuXHRcdHx8IG51bGw7XHJcbn07XHJcblxyXG5WYWxpZGF0b3JDb250ZXh0LnByb3RvdHlwZS52YWxpZGF0ZUFsbE9mID0gZnVuY3Rpb24gdmFsaWRhdGVBbGxPZihkYXRhLCBzY2hlbWEsIGRhdGFQb2ludGVyUGF0aCkge1xyXG5cdGlmIChzY2hlbWEuYWxsT2YgPT09IHVuZGVmaW5lZCkge1xyXG5cdFx0cmV0dXJuIG51bGw7XHJcblx0fVxyXG5cdHZhciBlcnJvcjtcclxuXHRmb3IgKHZhciBpID0gMDsgaSA8IHNjaGVtYS5hbGxPZi5sZW5ndGg7IGkrKykge1xyXG5cdFx0dmFyIHN1YlNjaGVtYSA9IHNjaGVtYS5hbGxPZltpXTtcclxuXHRcdGlmIChlcnJvciA9IHRoaXMudmFsaWRhdGVBbGwoZGF0YSwgc3ViU2NoZW1hLCBbXSwgW1wiYWxsT2ZcIiwgaV0sIGRhdGFQb2ludGVyUGF0aCkpIHtcclxuXHRcdFx0cmV0dXJuIGVycm9yO1xyXG5cdFx0fVxyXG5cdH1cclxuXHRyZXR1cm4gbnVsbDtcclxufTtcclxuXHJcblZhbGlkYXRvckNvbnRleHQucHJvdG90eXBlLnZhbGlkYXRlQW55T2YgPSBmdW5jdGlvbiB2YWxpZGF0ZUFueU9mKGRhdGEsIHNjaGVtYSwgZGF0YVBvaW50ZXJQYXRoKSB7XHJcblx0aWYgKHNjaGVtYS5hbnlPZiA9PT0gdW5kZWZpbmVkKSB7XHJcblx0XHRyZXR1cm4gbnVsbDtcclxuXHR9XHJcblx0dmFyIGVycm9ycyA9IFtdO1xyXG5cdHZhciBzdGFydEVycm9yQ291bnQgPSB0aGlzLmVycm9ycy5sZW5ndGg7XHJcblx0dmFyIG9sZFVua25vd25Qcm9wZXJ0eVBhdGhzLCBvbGRLbm93blByb3BlcnR5UGF0aHM7XHJcblx0aWYgKHRoaXMudHJhY2tVbmtub3duUHJvcGVydGllcykge1xyXG5cdFx0b2xkVW5rbm93blByb3BlcnR5UGF0aHMgPSB0aGlzLnVua25vd25Qcm9wZXJ0eVBhdGhzO1xyXG5cdFx0b2xkS25vd25Qcm9wZXJ0eVBhdGhzID0gdGhpcy5rbm93blByb3BlcnR5UGF0aHM7XHJcblx0fVxyXG5cdHZhciBlcnJvckF0RW5kID0gdHJ1ZTtcclxuXHRmb3IgKHZhciBpID0gMDsgaSA8IHNjaGVtYS5hbnlPZi5sZW5ndGg7IGkrKykge1xyXG5cdFx0aWYgKHRoaXMudHJhY2tVbmtub3duUHJvcGVydGllcykge1xyXG5cdFx0XHR0aGlzLnVua25vd25Qcm9wZXJ0eVBhdGhzID0ge307XHJcblx0XHRcdHRoaXMua25vd25Qcm9wZXJ0eVBhdGhzID0ge307XHJcblx0XHR9XHJcblx0XHR2YXIgc3ViU2NoZW1hID0gc2NoZW1hLmFueU9mW2ldO1xyXG5cclxuXHRcdHZhciBlcnJvckNvdW50ID0gdGhpcy5lcnJvcnMubGVuZ3RoO1xyXG5cdFx0dmFyIGVycm9yID0gdGhpcy52YWxpZGF0ZUFsbChkYXRhLCBzdWJTY2hlbWEsIFtdLCBbXCJhbnlPZlwiLCBpXSwgZGF0YVBvaW50ZXJQYXRoKTtcclxuXHJcblx0XHRpZiAoZXJyb3IgPT09IG51bGwgJiYgZXJyb3JDb3VudCA9PT0gdGhpcy5lcnJvcnMubGVuZ3RoKSB7XHJcblx0XHRcdHRoaXMuZXJyb3JzID0gdGhpcy5lcnJvcnMuc2xpY2UoMCwgc3RhcnRFcnJvckNvdW50KTtcclxuXHJcblx0XHRcdGlmICh0aGlzLnRyYWNrVW5rbm93blByb3BlcnRpZXMpIHtcclxuXHRcdFx0XHRmb3IgKHZhciBrbm93bktleSBpbiB0aGlzLmtub3duUHJvcGVydHlQYXRocykge1xyXG5cdFx0XHRcdFx0b2xkS25vd25Qcm9wZXJ0eVBhdGhzW2tub3duS2V5XSA9IHRydWU7XHJcblx0XHRcdFx0XHRkZWxldGUgb2xkVW5rbm93blByb3BlcnR5UGF0aHNba25vd25LZXldO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0XHRmb3IgKHZhciB1bmtub3duS2V5IGluIHRoaXMudW5rbm93blByb3BlcnR5UGF0aHMpIHtcclxuXHRcdFx0XHRcdGlmICghb2xkS25vd25Qcm9wZXJ0eVBhdGhzW3Vua25vd25LZXldKSB7XHJcblx0XHRcdFx0XHRcdG9sZFVua25vd25Qcm9wZXJ0eVBhdGhzW3Vua25vd25LZXldID0gdHJ1ZTtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHR9XHJcblx0XHRcdFx0Ly8gV2UgbmVlZCB0byBjb250aW51ZSBsb29waW5nIHNvIHdlIGNhdGNoIGFsbCB0aGUgcHJvcGVydHkgZGVmaW5pdGlvbnMsIGJ1dCB3ZSBkb24ndCB3YW50IHRvIHJldHVybiBhbiBlcnJvclxyXG5cdFx0XHRcdGVycm9yQXRFbmQgPSBmYWxzZTtcclxuXHRcdFx0XHRjb250aW51ZTtcclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0cmV0dXJuIG51bGw7XHJcblx0XHR9XHJcblx0XHRpZiAoZXJyb3IpIHtcclxuXHRcdFx0ZXJyb3JzLnB1c2goZXJyb3IucHJlZml4V2l0aChudWxsLCBcIlwiICsgaSkucHJlZml4V2l0aChudWxsLCBcImFueU9mXCIpKTtcclxuXHRcdH1cclxuXHR9XHJcblx0aWYgKHRoaXMudHJhY2tVbmtub3duUHJvcGVydGllcykge1xyXG5cdFx0dGhpcy51bmtub3duUHJvcGVydHlQYXRocyA9IG9sZFVua25vd25Qcm9wZXJ0eVBhdGhzO1xyXG5cdFx0dGhpcy5rbm93blByb3BlcnR5UGF0aHMgPSBvbGRLbm93blByb3BlcnR5UGF0aHM7XHJcblx0fVxyXG5cdGlmIChlcnJvckF0RW5kKSB7XHJcblx0XHRlcnJvcnMgPSBlcnJvcnMuY29uY2F0KHRoaXMuZXJyb3JzLnNsaWNlKHN0YXJ0RXJyb3JDb3VudCkpO1xyXG5cdFx0dGhpcy5lcnJvcnMgPSB0aGlzLmVycm9ycy5zbGljZSgwLCBzdGFydEVycm9yQ291bnQpO1xyXG5cdFx0cmV0dXJuIHRoaXMuY3JlYXRlRXJyb3IoRXJyb3JDb2Rlcy5BTllfT0ZfTUlTU0lORywge30sIFwiXCIsIFwiL2FueU9mXCIsIGVycm9ycywgZGF0YSwgc2NoZW1hKTtcclxuXHR9XHJcbn07XHJcblxyXG5WYWxpZGF0b3JDb250ZXh0LnByb3RvdHlwZS52YWxpZGF0ZU9uZU9mID0gZnVuY3Rpb24gdmFsaWRhdGVPbmVPZihkYXRhLCBzY2hlbWEsIGRhdGFQb2ludGVyUGF0aCkge1xyXG5cdGlmIChzY2hlbWEub25lT2YgPT09IHVuZGVmaW5lZCkge1xyXG5cdFx0cmV0dXJuIG51bGw7XHJcblx0fVxyXG5cdHZhciB2YWxpZEluZGV4ID0gbnVsbDtcclxuXHR2YXIgZXJyb3JzID0gW107XHJcblx0dmFyIHN0YXJ0RXJyb3JDb3VudCA9IHRoaXMuZXJyb3JzLmxlbmd0aDtcclxuXHR2YXIgb2xkVW5rbm93blByb3BlcnR5UGF0aHMsIG9sZEtub3duUHJvcGVydHlQYXRocztcclxuXHRpZiAodGhpcy50cmFja1Vua25vd25Qcm9wZXJ0aWVzKSB7XHJcblx0XHRvbGRVbmtub3duUHJvcGVydHlQYXRocyA9IHRoaXMudW5rbm93blByb3BlcnR5UGF0aHM7XHJcblx0XHRvbGRLbm93blByb3BlcnR5UGF0aHMgPSB0aGlzLmtub3duUHJvcGVydHlQYXRocztcclxuXHR9XHJcblx0Zm9yICh2YXIgaSA9IDA7IGkgPCBzY2hlbWEub25lT2YubGVuZ3RoOyBpKyspIHtcclxuXHRcdGlmICh0aGlzLnRyYWNrVW5rbm93blByb3BlcnRpZXMpIHtcclxuXHRcdFx0dGhpcy51bmtub3duUHJvcGVydHlQYXRocyA9IHt9O1xyXG5cdFx0XHR0aGlzLmtub3duUHJvcGVydHlQYXRocyA9IHt9O1xyXG5cdFx0fVxyXG5cdFx0dmFyIHN1YlNjaGVtYSA9IHNjaGVtYS5vbmVPZltpXTtcclxuXHJcblx0XHR2YXIgZXJyb3JDb3VudCA9IHRoaXMuZXJyb3JzLmxlbmd0aDtcclxuXHRcdHZhciBlcnJvciA9IHRoaXMudmFsaWRhdGVBbGwoZGF0YSwgc3ViU2NoZW1hLCBbXSwgW1wib25lT2ZcIiwgaV0sIGRhdGFQb2ludGVyUGF0aCk7XHJcblxyXG5cdFx0aWYgKGVycm9yID09PSBudWxsICYmIGVycm9yQ291bnQgPT09IHRoaXMuZXJyb3JzLmxlbmd0aCkge1xyXG5cdFx0XHRpZiAodmFsaWRJbmRleCA9PT0gbnVsbCkge1xyXG5cdFx0XHRcdHZhbGlkSW5kZXggPSBpO1xyXG5cdFx0XHR9IGVsc2Uge1xyXG5cdFx0XHRcdHRoaXMuZXJyb3JzID0gdGhpcy5lcnJvcnMuc2xpY2UoMCwgc3RhcnRFcnJvckNvdW50KTtcclxuXHRcdFx0XHRyZXR1cm4gdGhpcy5jcmVhdGVFcnJvcihFcnJvckNvZGVzLk9ORV9PRl9NVUxUSVBMRSwge2luZGV4MTogdmFsaWRJbmRleCwgaW5kZXgyOiBpfSwgXCJcIiwgXCIvb25lT2ZcIiwgbnVsbCwgZGF0YSwgc2NoZW1hKTtcclxuXHRcdFx0fVxyXG5cdFx0XHRpZiAodGhpcy50cmFja1Vua25vd25Qcm9wZXJ0aWVzKSB7XHJcblx0XHRcdFx0Zm9yICh2YXIga25vd25LZXkgaW4gdGhpcy5rbm93blByb3BlcnR5UGF0aHMpIHtcclxuXHRcdFx0XHRcdG9sZEtub3duUHJvcGVydHlQYXRoc1trbm93bktleV0gPSB0cnVlO1xyXG5cdFx0XHRcdFx0ZGVsZXRlIG9sZFVua25vd25Qcm9wZXJ0eVBhdGhzW2tub3duS2V5XTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdFx0Zm9yICh2YXIgdW5rbm93bktleSBpbiB0aGlzLnVua25vd25Qcm9wZXJ0eVBhdGhzKSB7XHJcblx0XHRcdFx0XHRpZiAoIW9sZEtub3duUHJvcGVydHlQYXRoc1t1bmtub3duS2V5XSkge1xyXG5cdFx0XHRcdFx0XHRvbGRVbmtub3duUHJvcGVydHlQYXRoc1t1bmtub3duS2V5XSA9IHRydWU7XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblx0XHR9IGVsc2UgaWYgKGVycm9yKSB7XHJcblx0XHRcdGVycm9ycy5wdXNoKGVycm9yKTtcclxuXHRcdH1cclxuXHR9XHJcblx0aWYgKHRoaXMudHJhY2tVbmtub3duUHJvcGVydGllcykge1xyXG5cdFx0dGhpcy51bmtub3duUHJvcGVydHlQYXRocyA9IG9sZFVua25vd25Qcm9wZXJ0eVBhdGhzO1xyXG5cdFx0dGhpcy5rbm93blByb3BlcnR5UGF0aHMgPSBvbGRLbm93blByb3BlcnR5UGF0aHM7XHJcblx0fVxyXG5cdGlmICh2YWxpZEluZGV4ID09PSBudWxsKSB7XHJcblx0XHRlcnJvcnMgPSBlcnJvcnMuY29uY2F0KHRoaXMuZXJyb3JzLnNsaWNlKHN0YXJ0RXJyb3JDb3VudCkpO1xyXG5cdFx0dGhpcy5lcnJvcnMgPSB0aGlzLmVycm9ycy5zbGljZSgwLCBzdGFydEVycm9yQ291bnQpO1xyXG5cdFx0cmV0dXJuIHRoaXMuY3JlYXRlRXJyb3IoRXJyb3JDb2Rlcy5PTkVfT0ZfTUlTU0lORywge30sIFwiXCIsIFwiL29uZU9mXCIsIGVycm9ycywgZGF0YSwgc2NoZW1hKTtcclxuXHR9IGVsc2Uge1xyXG5cdFx0dGhpcy5lcnJvcnMgPSB0aGlzLmVycm9ycy5zbGljZSgwLCBzdGFydEVycm9yQ291bnQpO1xyXG5cdH1cclxuXHRyZXR1cm4gbnVsbDtcclxufTtcclxuXHJcblZhbGlkYXRvckNvbnRleHQucHJvdG90eXBlLnZhbGlkYXRlTm90ID0gZnVuY3Rpb24gdmFsaWRhdGVOb3QoZGF0YSwgc2NoZW1hLCBkYXRhUG9pbnRlclBhdGgpIHtcclxuXHRpZiAoc2NoZW1hLm5vdCA9PT0gdW5kZWZpbmVkKSB7XHJcblx0XHRyZXR1cm4gbnVsbDtcclxuXHR9XHJcblx0dmFyIG9sZEVycm9yQ291bnQgPSB0aGlzLmVycm9ycy5sZW5ndGg7XHJcblx0dmFyIG9sZFVua25vd25Qcm9wZXJ0eVBhdGhzLCBvbGRLbm93blByb3BlcnR5UGF0aHM7XHJcblx0aWYgKHRoaXMudHJhY2tVbmtub3duUHJvcGVydGllcykge1xyXG5cdFx0b2xkVW5rbm93blByb3BlcnR5UGF0aHMgPSB0aGlzLnVua25vd25Qcm9wZXJ0eVBhdGhzO1xyXG5cdFx0b2xkS25vd25Qcm9wZXJ0eVBhdGhzID0gdGhpcy5rbm93blByb3BlcnR5UGF0aHM7XHJcblx0XHR0aGlzLnVua25vd25Qcm9wZXJ0eVBhdGhzID0ge307XHJcblx0XHR0aGlzLmtub3duUHJvcGVydHlQYXRocyA9IHt9O1xyXG5cdH1cclxuXHR2YXIgZXJyb3IgPSB0aGlzLnZhbGlkYXRlQWxsKGRhdGEsIHNjaGVtYS5ub3QsIG51bGwsIG51bGwsIGRhdGFQb2ludGVyUGF0aCk7XHJcblx0dmFyIG5vdEVycm9ycyA9IHRoaXMuZXJyb3JzLnNsaWNlKG9sZEVycm9yQ291bnQpO1xyXG5cdHRoaXMuZXJyb3JzID0gdGhpcy5lcnJvcnMuc2xpY2UoMCwgb2xkRXJyb3JDb3VudCk7XHJcblx0aWYgKHRoaXMudHJhY2tVbmtub3duUHJvcGVydGllcykge1xyXG5cdFx0dGhpcy51bmtub3duUHJvcGVydHlQYXRocyA9IG9sZFVua25vd25Qcm9wZXJ0eVBhdGhzO1xyXG5cdFx0dGhpcy5rbm93blByb3BlcnR5UGF0aHMgPSBvbGRLbm93blByb3BlcnR5UGF0aHM7XHJcblx0fVxyXG5cdGlmIChlcnJvciA9PT0gbnVsbCAmJiBub3RFcnJvcnMubGVuZ3RoID09PSAwKSB7XHJcblx0XHRyZXR1cm4gdGhpcy5jcmVhdGVFcnJvcihFcnJvckNvZGVzLk5PVF9QQVNTRUQsIHt9LCBcIlwiLCBcIi9ub3RcIiwgbnVsbCwgZGF0YSwgc2NoZW1hKTtcclxuXHR9XHJcblx0cmV0dXJuIG51bGw7XHJcbn07XHJcblxyXG5WYWxpZGF0b3JDb250ZXh0LnByb3RvdHlwZS52YWxpZGF0ZUh5cGVybWVkaWEgPSBmdW5jdGlvbiB2YWxpZGF0ZUNvbWJpbmF0aW9ucyhkYXRhLCBzY2hlbWEsIGRhdGFQb2ludGVyUGF0aCkge1xyXG5cdGlmICghc2NoZW1hLmxpbmtzKSB7XHJcblx0XHRyZXR1cm4gbnVsbDtcclxuXHR9XHJcblx0dmFyIGVycm9yO1xyXG5cdGZvciAodmFyIGkgPSAwOyBpIDwgc2NoZW1hLmxpbmtzLmxlbmd0aDsgaSsrKSB7XHJcblx0XHR2YXIgbGRvID0gc2NoZW1hLmxpbmtzW2ldO1xyXG5cdFx0aWYgKGxkby5yZWwgPT09IFwiZGVzY3JpYmVkYnlcIikge1xyXG5cdFx0XHR2YXIgdGVtcGxhdGUgPSBuZXcgVXJpVGVtcGxhdGUobGRvLmhyZWYpO1xyXG5cdFx0XHR2YXIgYWxsUHJlc2VudCA9IHRydWU7XHJcblx0XHRcdGZvciAodmFyIGogPSAwOyBqIDwgdGVtcGxhdGUudmFyTmFtZXMubGVuZ3RoOyBqKyspIHtcclxuXHRcdFx0XHRpZiAoISh0ZW1wbGF0ZS52YXJOYW1lc1tqXSBpbiBkYXRhKSkge1xyXG5cdFx0XHRcdFx0YWxsUHJlc2VudCA9IGZhbHNlO1xyXG5cdFx0XHRcdFx0YnJlYWs7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblx0XHRcdGlmIChhbGxQcmVzZW50KSB7XHJcblx0XHRcdFx0dmFyIHNjaGVtYVVybCA9IHRlbXBsYXRlLmZpbGxGcm9tT2JqZWN0KGRhdGEpO1xyXG5cdFx0XHRcdHZhciBzdWJTY2hlbWEgPSB7XCIkcmVmXCI6IHNjaGVtYVVybH07XHJcblx0XHRcdFx0aWYgKGVycm9yID0gdGhpcy52YWxpZGF0ZUFsbChkYXRhLCBzdWJTY2hlbWEsIFtdLCBbXCJsaW5rc1wiLCBpXSwgZGF0YVBvaW50ZXJQYXRoKSkge1xyXG5cdFx0XHRcdFx0cmV0dXJuIGVycm9yO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdH1cclxufTtcclxuXHJcbi8vIHBhcnNlVVJJKCkgYW5kIHJlc29sdmVVcmwoKSBhcmUgZnJvbSBodHRwczovL2dpc3QuZ2l0aHViLmNvbS8xMDg4ODUwXHJcbi8vICAgLSAgcmVsZWFzZWQgYXMgcHVibGljIGRvbWFpbiBieSBhdXRob3IgKFwiWWFmZmxlXCIpIC0gc2VlIGNvbW1lbnRzIG9uIGdpc3RcclxuXHJcbmZ1bmN0aW9uIHBhcnNlVVJJKHVybCkge1xyXG5cdHZhciBtID0gU3RyaW5nKHVybCkucmVwbGFjZSgvXlxccyt8XFxzKyQvZywgJycpLm1hdGNoKC9eKFteOlxcLz8jXSs6KT8oXFwvXFwvKD86W146QF0qKD86OlteOkBdKik/QCk/KChbXjpcXC8/I10qKSg/OjooXFxkKikpPykpPyhbXj8jXSopKFxcP1teI10qKT8oI1tcXHNcXFNdKik/Lyk7XHJcblx0Ly8gYXV0aG9yaXR5ID0gJy8vJyArIHVzZXIgKyAnOicgKyBwYXNzICdAJyArIGhvc3RuYW1lICsgJzonIHBvcnRcclxuXHRyZXR1cm4gKG0gPyB7XHJcblx0XHRocmVmICAgICA6IG1bMF0gfHwgJycsXHJcblx0XHRwcm90b2NvbCA6IG1bMV0gfHwgJycsXHJcblx0XHRhdXRob3JpdHk6IG1bMl0gfHwgJycsXHJcblx0XHRob3N0ICAgICA6IG1bM10gfHwgJycsXHJcblx0XHRob3N0bmFtZSA6IG1bNF0gfHwgJycsXHJcblx0XHRwb3J0ICAgICA6IG1bNV0gfHwgJycsXHJcblx0XHRwYXRobmFtZSA6IG1bNl0gfHwgJycsXHJcblx0XHRzZWFyY2ggICA6IG1bN10gfHwgJycsXHJcblx0XHRoYXNoICAgICA6IG1bOF0gfHwgJydcclxuXHR9IDogbnVsbCk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHJlc29sdmVVcmwoYmFzZSwgaHJlZikgey8vIFJGQyAzOTg2XHJcblxyXG5cdGZ1bmN0aW9uIHJlbW92ZURvdFNlZ21lbnRzKGlucHV0KSB7XHJcblx0XHR2YXIgb3V0cHV0ID0gW107XHJcblx0XHRpbnB1dC5yZXBsYWNlKC9eKFxcLlxcLj8oXFwvfCQpKSsvLCAnJylcclxuXHRcdFx0LnJlcGxhY2UoL1xcLyhcXC4oXFwvfCQpKSsvZywgJy8nKVxyXG5cdFx0XHQucmVwbGFjZSgvXFwvXFwuXFwuJC8sICcvLi4vJylcclxuXHRcdFx0LnJlcGxhY2UoL1xcLz9bXlxcL10qL2csIGZ1bmN0aW9uIChwKSB7XHJcblx0XHRcdFx0aWYgKHAgPT09ICcvLi4nKSB7XHJcblx0XHRcdFx0XHRvdXRwdXQucG9wKCk7XHJcblx0XHRcdFx0fSBlbHNlIHtcclxuXHRcdFx0XHRcdG91dHB1dC5wdXNoKHApO1xyXG5cdFx0XHRcdH1cclxuXHRcdH0pO1xyXG5cdFx0cmV0dXJuIG91dHB1dC5qb2luKCcnKS5yZXBsYWNlKC9eXFwvLywgaW5wdXQuY2hhckF0KDApID09PSAnLycgPyAnLycgOiAnJyk7XHJcblx0fVxyXG5cclxuXHRocmVmID0gcGFyc2VVUkkoaHJlZiB8fCAnJyk7XHJcblx0YmFzZSA9IHBhcnNlVVJJKGJhc2UgfHwgJycpO1xyXG5cclxuXHRyZXR1cm4gIWhyZWYgfHwgIWJhc2UgPyBudWxsIDogKGhyZWYucHJvdG9jb2wgfHwgYmFzZS5wcm90b2NvbCkgK1xyXG5cdFx0KGhyZWYucHJvdG9jb2wgfHwgaHJlZi5hdXRob3JpdHkgPyBocmVmLmF1dGhvcml0eSA6IGJhc2UuYXV0aG9yaXR5KSArXHJcblx0XHRyZW1vdmVEb3RTZWdtZW50cyhocmVmLnByb3RvY29sIHx8IGhyZWYuYXV0aG9yaXR5IHx8IGhyZWYucGF0aG5hbWUuY2hhckF0KDApID09PSAnLycgPyBocmVmLnBhdGhuYW1lIDogKGhyZWYucGF0aG5hbWUgPyAoKGJhc2UuYXV0aG9yaXR5ICYmICFiYXNlLnBhdGhuYW1lID8gJy8nIDogJycpICsgYmFzZS5wYXRobmFtZS5zbGljZSgwLCBiYXNlLnBhdGhuYW1lLmxhc3RJbmRleE9mKCcvJykgKyAxKSArIGhyZWYucGF0aG5hbWUpIDogYmFzZS5wYXRobmFtZSkpICtcclxuXHRcdChocmVmLnByb3RvY29sIHx8IGhyZWYuYXV0aG9yaXR5IHx8IGhyZWYucGF0aG5hbWUgPyBocmVmLnNlYXJjaCA6IChocmVmLnNlYXJjaCB8fCBiYXNlLnNlYXJjaCkpICtcclxuXHRcdGhyZWYuaGFzaDtcclxufVxyXG5cclxuZnVuY3Rpb24gZ2V0RG9jdW1lbnRVcmkodXJpKSB7XHJcblx0cmV0dXJuIHVyaS5zcGxpdCgnIycpWzBdO1xyXG59XHJcbmZ1bmN0aW9uIG5vcm1TY2hlbWEoc2NoZW1hLCBiYXNlVXJpKSB7XHJcblx0aWYgKHNjaGVtYSAmJiB0eXBlb2Ygc2NoZW1hID09PSBcIm9iamVjdFwiKSB7XHJcblx0XHRpZiAoYmFzZVVyaSA9PT0gdW5kZWZpbmVkKSB7XHJcblx0XHRcdGJhc2VVcmkgPSBzY2hlbWEuaWQ7XHJcblx0XHR9IGVsc2UgaWYgKHR5cGVvZiBzY2hlbWEuaWQgPT09IFwic3RyaW5nXCIpIHtcclxuXHRcdFx0YmFzZVVyaSA9IHJlc29sdmVVcmwoYmFzZVVyaSwgc2NoZW1hLmlkKTtcclxuXHRcdFx0c2NoZW1hLmlkID0gYmFzZVVyaTtcclxuXHRcdH1cclxuXHRcdGlmIChBcnJheS5pc0FycmF5KHNjaGVtYSkpIHtcclxuXHRcdFx0Zm9yICh2YXIgaSA9IDA7IGkgPCBzY2hlbWEubGVuZ3RoOyBpKyspIHtcclxuXHRcdFx0XHRub3JtU2NoZW1hKHNjaGVtYVtpXSwgYmFzZVVyaSk7XHJcblx0XHRcdH1cclxuXHRcdH0gZWxzZSB7XHJcblx0XHRcdGlmICh0eXBlb2Ygc2NoZW1hWyckcmVmJ10gPT09IFwic3RyaW5nXCIpIHtcclxuXHRcdFx0XHRzY2hlbWFbJyRyZWYnXSA9IHJlc29sdmVVcmwoYmFzZVVyaSwgc2NoZW1hWyckcmVmJ10pO1xyXG5cdFx0XHR9XHJcblx0XHRcdGZvciAodmFyIGtleSBpbiBzY2hlbWEpIHtcclxuXHRcdFx0XHRpZiAoa2V5ICE9PSBcImVudW1cIikge1xyXG5cdFx0XHRcdFx0bm9ybVNjaGVtYShzY2hlbWFba2V5XSwgYmFzZVVyaSk7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0fVxyXG59XHJcblxyXG5mdW5jdGlvbiBkZWZhdWx0RXJyb3JSZXBvcnRlcihsYW5ndWFnZSkge1xyXG5cdGxhbmd1YWdlID0gbGFuZ3VhZ2UgfHwgJ2VuJztcclxuXHJcblx0dmFyIGVycm9yTWVzc2FnZXMgPSBsYW5ndWFnZXNbbGFuZ3VhZ2VdO1xyXG5cclxuXHRyZXR1cm4gZnVuY3Rpb24gKGVycm9yKSB7XHJcblx0XHR2YXIgbWVzc2FnZVRlbXBsYXRlID0gZXJyb3JNZXNzYWdlc1tlcnJvci5jb2RlXSB8fCBFcnJvck1lc3NhZ2VzRGVmYXVsdFtlcnJvci5jb2RlXTtcclxuXHRcdGlmICh0eXBlb2YgbWVzc2FnZVRlbXBsYXRlICE9PSAnc3RyaW5nJykge1xyXG5cdFx0XHRyZXR1cm4gXCJVbmtub3duIGVycm9yIGNvZGUgXCIgKyBlcnJvci5jb2RlICsgXCI6IFwiICsgSlNPTi5zdHJpbmdpZnkoZXJyb3IubWVzc2FnZVBhcmFtcyk7XHJcblx0XHR9XHJcblx0XHR2YXIgbWVzc2FnZVBhcmFtcyA9IGVycm9yLnBhcmFtcztcclxuXHRcdC8vIEFkYXB0ZWQgZnJvbSBDcm9ja2ZvcmQncyBzdXBwbGFudCgpXHJcblx0XHRyZXR1cm4gbWVzc2FnZVRlbXBsYXRlLnJlcGxhY2UoL1xceyhbXnt9XSopXFx9L2csIGZ1bmN0aW9uICh3aG9sZSwgdmFyTmFtZSkge1xyXG5cdFx0XHR2YXIgc3ViVmFsdWUgPSBtZXNzYWdlUGFyYW1zW3Zhck5hbWVdO1xyXG5cdFx0XHRyZXR1cm4gdHlwZW9mIHN1YlZhbHVlID09PSAnc3RyaW5nJyB8fCB0eXBlb2Ygc3ViVmFsdWUgPT09ICdudW1iZXInID8gc3ViVmFsdWUgOiB3aG9sZTtcclxuXHRcdH0pO1xyXG5cdH07XHJcbn1cclxuXHJcbnZhciBFcnJvckNvZGVzID0ge1xyXG5cdElOVkFMSURfVFlQRTogMCxcclxuXHRFTlVNX01JU01BVENIOiAxLFxyXG5cdEFOWV9PRl9NSVNTSU5HOiAxMCxcclxuXHRPTkVfT0ZfTUlTU0lORzogMTEsXHJcblx0T05FX09GX01VTFRJUExFOiAxMixcclxuXHROT1RfUEFTU0VEOiAxMyxcclxuXHQvLyBOdW1lcmljIGVycm9yc1xyXG5cdE5VTUJFUl9NVUxUSVBMRV9PRjogMTAwLFxyXG5cdE5VTUJFUl9NSU5JTVVNOiAxMDEsXHJcblx0TlVNQkVSX01JTklNVU1fRVhDTFVTSVZFOiAxMDIsXHJcblx0TlVNQkVSX01BWElNVU06IDEwMyxcclxuXHROVU1CRVJfTUFYSU1VTV9FWENMVVNJVkU6IDEwNCxcclxuXHROVU1CRVJfTk9UX0FfTlVNQkVSOiAxMDUsXHJcblx0Ly8gU3RyaW5nIGVycm9yc1xyXG5cdFNUUklOR19MRU5HVEhfU0hPUlQ6IDIwMCxcclxuXHRTVFJJTkdfTEVOR1RIX0xPTkc6IDIwMSxcclxuXHRTVFJJTkdfUEFUVEVSTjogMjAyLFxyXG5cdC8vIE9iamVjdCBlcnJvcnNcclxuXHRPQkpFQ1RfUFJPUEVSVElFU19NSU5JTVVNOiAzMDAsXHJcblx0T0JKRUNUX1BST1BFUlRJRVNfTUFYSU1VTTogMzAxLFxyXG5cdE9CSkVDVF9SRVFVSVJFRDogMzAyLFxyXG5cdE9CSkVDVF9BRERJVElPTkFMX1BST1BFUlRJRVM6IDMwMyxcclxuXHRPQkpFQ1RfREVQRU5ERU5DWV9LRVk6IDMwNCxcclxuXHQvLyBBcnJheSBlcnJvcnNcclxuXHRBUlJBWV9MRU5HVEhfU0hPUlQ6IDQwMCxcclxuXHRBUlJBWV9MRU5HVEhfTE9ORzogNDAxLFxyXG5cdEFSUkFZX1VOSVFVRTogNDAyLFxyXG5cdEFSUkFZX0FERElUSU9OQUxfSVRFTVM6IDQwMyxcclxuXHQvLyBDdXN0b20vdXNlci1kZWZpbmVkIGVycm9yc1xyXG5cdEZPUk1BVF9DVVNUT006IDUwMCxcclxuXHRLRVlXT1JEX0NVU1RPTTogNTAxLFxyXG5cdC8vIFNjaGVtYSBzdHJ1Y3R1cmVcclxuXHRDSVJDVUxBUl9SRUZFUkVOQ0U6IDYwMCxcclxuXHQvLyBOb24tc3RhbmRhcmQgdmFsaWRhdGlvbiBvcHRpb25zXHJcblx0VU5LTk9XTl9QUk9QRVJUWTogMTAwMFxyXG59O1xyXG52YXIgRXJyb3JDb2RlTG9va3VwID0ge307XHJcbmZvciAodmFyIGtleSBpbiBFcnJvckNvZGVzKSB7XHJcblx0RXJyb3JDb2RlTG9va3VwW0Vycm9yQ29kZXNba2V5XV0gPSBrZXk7XHJcbn1cclxudmFyIEVycm9yTWVzc2FnZXNEZWZhdWx0ID0ge1xyXG5cdElOVkFMSURfVFlQRTogXCJJbnZhbGlkIHR5cGU6IHt0eXBlfSAoZXhwZWN0ZWQge2V4cGVjdGVkfSlcIixcclxuXHRFTlVNX01JU01BVENIOiBcIk5vIGVudW0gbWF0Y2ggZm9yOiB7dmFsdWV9XCIsXHJcblx0QU5ZX09GX01JU1NJTkc6IFwiRGF0YSBkb2VzIG5vdCBtYXRjaCBhbnkgc2NoZW1hcyBmcm9tIFxcXCJhbnlPZlxcXCJcIixcclxuXHRPTkVfT0ZfTUlTU0lORzogXCJEYXRhIGRvZXMgbm90IG1hdGNoIGFueSBzY2hlbWFzIGZyb20gXFxcIm9uZU9mXFxcIlwiLFxyXG5cdE9ORV9PRl9NVUxUSVBMRTogXCJEYXRhIGlzIHZhbGlkIGFnYWluc3QgbW9yZSB0aGFuIG9uZSBzY2hlbWEgZnJvbSBcXFwib25lT2ZcXFwiOiBpbmRpY2VzIHtpbmRleDF9IGFuZCB7aW5kZXgyfVwiLFxyXG5cdE5PVF9QQVNTRUQ6IFwiRGF0YSBtYXRjaGVzIHNjaGVtYSBmcm9tIFxcXCJub3RcXFwiXCIsXHJcblx0Ly8gTnVtZXJpYyBlcnJvcnNcclxuXHROVU1CRVJfTVVMVElQTEVfT0Y6IFwiVmFsdWUge3ZhbHVlfSBpcyBub3QgYSBtdWx0aXBsZSBvZiB7bXVsdGlwbGVPZn1cIixcclxuXHROVU1CRVJfTUlOSU1VTTogXCJWYWx1ZSB7dmFsdWV9IGlzIGxlc3MgdGhhbiBtaW5pbXVtIHttaW5pbXVtfVwiLFxyXG5cdE5VTUJFUl9NSU5JTVVNX0VYQ0xVU0lWRTogXCJWYWx1ZSB7dmFsdWV9IGlzIGVxdWFsIHRvIGV4Y2x1c2l2ZSBtaW5pbXVtIHttaW5pbXVtfVwiLFxyXG5cdE5VTUJFUl9NQVhJTVVNOiBcIlZhbHVlIHt2YWx1ZX0gaXMgZ3JlYXRlciB0aGFuIG1heGltdW0ge21heGltdW19XCIsXHJcblx0TlVNQkVSX01BWElNVU1fRVhDTFVTSVZFOiBcIlZhbHVlIHt2YWx1ZX0gaXMgZXF1YWwgdG8gZXhjbHVzaXZlIG1heGltdW0ge21heGltdW19XCIsXHJcblx0TlVNQkVSX05PVF9BX05VTUJFUjogXCJWYWx1ZSB7dmFsdWV9IGlzIG5vdCBhIHZhbGlkIG51bWJlclwiLFxyXG5cdC8vIFN0cmluZyBlcnJvcnNcclxuXHRTVFJJTkdfTEVOR1RIX1NIT1JUOiBcIlN0cmluZyBpcyB0b28gc2hvcnQgKHtsZW5ndGh9IGNoYXJzKSwgbWluaW11bSB7bWluaW11bX1cIixcclxuXHRTVFJJTkdfTEVOR1RIX0xPTkc6IFwiU3RyaW5nIGlzIHRvbyBsb25nICh7bGVuZ3RofSBjaGFycyksIG1heGltdW0ge21heGltdW19XCIsXHJcblx0U1RSSU5HX1BBVFRFUk46IFwiU3RyaW5nIGRvZXMgbm90IG1hdGNoIHBhdHRlcm46IHtwYXR0ZXJufVwiLFxyXG5cdC8vIE9iamVjdCBlcnJvcnNcclxuXHRPQkpFQ1RfUFJPUEVSVElFU19NSU5JTVVNOiBcIlRvbyBmZXcgcHJvcGVydGllcyBkZWZpbmVkICh7cHJvcGVydHlDb3VudH0pLCBtaW5pbXVtIHttaW5pbXVtfVwiLFxyXG5cdE9CSkVDVF9QUk9QRVJUSUVTX01BWElNVU06IFwiVG9vIG1hbnkgcHJvcGVydGllcyBkZWZpbmVkICh7cHJvcGVydHlDb3VudH0pLCBtYXhpbXVtIHttYXhpbXVtfVwiLFxyXG5cdE9CSkVDVF9SRVFVSVJFRDogXCJNaXNzaW5nIHJlcXVpcmVkIHByb3BlcnR5OiB7a2V5fVwiLFxyXG5cdE9CSkVDVF9BRERJVElPTkFMX1BST1BFUlRJRVM6IFwiQWRkaXRpb25hbCBwcm9wZXJ0aWVzIG5vdCBhbGxvd2VkXCIsXHJcblx0T0JKRUNUX0RFUEVOREVOQ1lfS0VZOiBcIkRlcGVuZGVuY3kgZmFpbGVkIC0ga2V5IG11c3QgZXhpc3Q6IHttaXNzaW5nfSAoZHVlIHRvIGtleToge2tleX0pXCIsXHJcblx0Ly8gQXJyYXkgZXJyb3JzXHJcblx0QVJSQVlfTEVOR1RIX1NIT1JUOiBcIkFycmF5IGlzIHRvbyBzaG9ydCAoe2xlbmd0aH0pLCBtaW5pbXVtIHttaW5pbXVtfVwiLFxyXG5cdEFSUkFZX0xFTkdUSF9MT05HOiBcIkFycmF5IGlzIHRvbyBsb25nICh7bGVuZ3RofSksIG1heGltdW0ge21heGltdW19XCIsXHJcblx0QVJSQVlfVU5JUVVFOiBcIkFycmF5IGl0ZW1zIGFyZSBub3QgdW5pcXVlIChpbmRpY2VzIHttYXRjaDF9IGFuZCB7bWF0Y2gyfSlcIixcclxuXHRBUlJBWV9BRERJVElPTkFMX0lURU1TOiBcIkFkZGl0aW9uYWwgaXRlbXMgbm90IGFsbG93ZWRcIixcclxuXHQvLyBGb3JtYXQgZXJyb3JzXHJcblx0Rk9STUFUX0NVU1RPTTogXCJGb3JtYXQgdmFsaWRhdGlvbiBmYWlsZWQgKHttZXNzYWdlfSlcIixcclxuXHRLRVlXT1JEX0NVU1RPTTogXCJLZXl3b3JkIGZhaWxlZDoge2tleX0gKHttZXNzYWdlfSlcIixcclxuXHQvLyBTY2hlbWEgc3RydWN0dXJlXHJcblx0Q0lSQ1VMQVJfUkVGRVJFTkNFOiBcIkNpcmN1bGFyICRyZWZzOiB7dXJsc31cIixcclxuXHQvLyBOb24tc3RhbmRhcmQgdmFsaWRhdGlvbiBvcHRpb25zXHJcblx0VU5LTk9XTl9QUk9QRVJUWTogXCJVbmtub3duIHByb3BlcnR5IChub3QgaW4gc2NoZW1hKVwiXHJcbn07XHJcblxyXG5mdW5jdGlvbiBWYWxpZGF0aW9uRXJyb3IoY29kZSwgcGFyYW1zLCBkYXRhUGF0aCwgc2NoZW1hUGF0aCwgc3ViRXJyb3JzKSB7XHJcblx0RXJyb3IuY2FsbCh0aGlzKTtcclxuXHRpZiAoY29kZSA9PT0gdW5kZWZpbmVkKSB7XHJcblx0XHR0aHJvdyBuZXcgRXJyb3IgKFwiTm8gZXJyb3IgY29kZSBzdXBwbGllZDogXCIgKyBzY2hlbWFQYXRoKTtcclxuXHR9XHJcblx0dGhpcy5tZXNzYWdlID0gJyc7XHJcblx0dGhpcy5wYXJhbXMgPSBwYXJhbXM7XHJcblx0dGhpcy5jb2RlID0gY29kZTtcclxuXHR0aGlzLmRhdGFQYXRoID0gZGF0YVBhdGggfHwgXCJcIjtcclxuXHR0aGlzLnNjaGVtYVBhdGggPSBzY2hlbWFQYXRoIHx8IFwiXCI7XHJcblx0dGhpcy5zdWJFcnJvcnMgPSBzdWJFcnJvcnMgfHwgbnVsbDtcclxuXHJcblx0dmFyIGVyciA9IG5ldyBFcnJvcih0aGlzLm1lc3NhZ2UpO1xyXG5cdHRoaXMuc3RhY2sgPSBlcnIuc3RhY2sgfHwgZXJyLnN0YWNrdHJhY2U7XHJcblx0aWYgKCF0aGlzLnN0YWNrKSB7XHJcblx0XHR0cnkge1xyXG5cdFx0XHR0aHJvdyBlcnI7XHJcblx0XHR9XHJcblx0XHRjYXRjaChlcnIpIHtcclxuXHRcdFx0dGhpcy5zdGFjayA9IGVyci5zdGFjayB8fCBlcnIuc3RhY2t0cmFjZTtcclxuXHRcdH1cclxuXHR9XHJcbn1cclxuVmFsaWRhdGlvbkVycm9yLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoRXJyb3IucHJvdG90eXBlKTtcclxuVmFsaWRhdGlvbkVycm9yLnByb3RvdHlwZS5jb25zdHJ1Y3RvciA9IFZhbGlkYXRpb25FcnJvcjtcclxuVmFsaWRhdGlvbkVycm9yLnByb3RvdHlwZS5uYW1lID0gJ1ZhbGlkYXRpb25FcnJvcic7XHJcblxyXG5WYWxpZGF0aW9uRXJyb3IucHJvdG90eXBlLnByZWZpeFdpdGggPSBmdW5jdGlvbiAoZGF0YVByZWZpeCwgc2NoZW1hUHJlZml4KSB7XHJcblx0aWYgKGRhdGFQcmVmaXggIT09IG51bGwpIHtcclxuXHRcdGRhdGFQcmVmaXggPSBkYXRhUHJlZml4LnJlcGxhY2UoL34vZywgXCJ+MFwiKS5yZXBsYWNlKC9cXC8vZywgXCJ+MVwiKTtcclxuXHRcdHRoaXMuZGF0YVBhdGggPSBcIi9cIiArIGRhdGFQcmVmaXggKyB0aGlzLmRhdGFQYXRoO1xyXG5cdH1cclxuXHRpZiAoc2NoZW1hUHJlZml4ICE9PSBudWxsKSB7XHJcblx0XHRzY2hlbWFQcmVmaXggPSBzY2hlbWFQcmVmaXgucmVwbGFjZSgvfi9nLCBcIn4wXCIpLnJlcGxhY2UoL1xcLy9nLCBcIn4xXCIpO1xyXG5cdFx0dGhpcy5zY2hlbWFQYXRoID0gXCIvXCIgKyBzY2hlbWFQcmVmaXggKyB0aGlzLnNjaGVtYVBhdGg7XHJcblx0fVxyXG5cdGlmICh0aGlzLnN1YkVycm9ycyAhPT0gbnVsbCkge1xyXG5cdFx0Zm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLnN1YkVycm9ycy5sZW5ndGg7IGkrKykge1xyXG5cdFx0XHR0aGlzLnN1YkVycm9yc1tpXS5wcmVmaXhXaXRoKGRhdGFQcmVmaXgsIHNjaGVtYVByZWZpeCk7XHJcblx0XHR9XHJcblx0fVxyXG5cdHJldHVybiB0aGlzO1xyXG59O1xyXG5cclxuZnVuY3Rpb24gaXNUcnVzdGVkVXJsKGJhc2VVcmwsIHRlc3RVcmwpIHtcclxuXHRpZih0ZXN0VXJsLnN1YnN0cmluZygwLCBiYXNlVXJsLmxlbmd0aCkgPT09IGJhc2VVcmwpe1xyXG5cdFx0dmFyIHJlbWFpbmRlciA9IHRlc3RVcmwuc3Vic3RyaW5nKGJhc2VVcmwubGVuZ3RoKTtcclxuXHRcdGlmICgodGVzdFVybC5sZW5ndGggPiAwICYmIHRlc3RVcmwuY2hhckF0KGJhc2VVcmwubGVuZ3RoIC0gMSkgPT09IFwiL1wiKVxyXG5cdFx0XHR8fCByZW1haW5kZXIuY2hhckF0KDApID09PSBcIiNcIlxyXG5cdFx0XHR8fCByZW1haW5kZXIuY2hhckF0KDApID09PSBcIj9cIikge1xyXG5cdFx0XHRyZXR1cm4gdHJ1ZTtcclxuXHRcdH1cclxuXHR9XHJcblx0cmV0dXJuIGZhbHNlO1xyXG59XHJcblxyXG52YXIgbGFuZ3VhZ2VzID0ge307XHJcbmZ1bmN0aW9uIGNyZWF0ZUFwaShsYW5ndWFnZSkge1xyXG5cdHZhciBnbG9iYWxDb250ZXh0ID0gbmV3IFZhbGlkYXRvckNvbnRleHQoKTtcclxuXHR2YXIgY3VycmVudExhbmd1YWdlO1xyXG5cdHZhciBjdXN0b21FcnJvclJlcG9ydGVyO1xyXG5cdHZhciBhcGkgPSB7XHJcblx0XHRzZXRFcnJvclJlcG9ydGVyOiBmdW5jdGlvbiAocmVwb3J0ZXIpIHtcclxuXHRcdFx0aWYgKHR5cGVvZiByZXBvcnRlciA9PT0gJ3N0cmluZycpIHtcclxuXHRcdFx0XHRyZXR1cm4gdGhpcy5sYW5ndWFnZShyZXBvcnRlcik7XHJcblx0XHRcdH1cclxuXHRcdFx0Y3VzdG9tRXJyb3JSZXBvcnRlciA9IHJlcG9ydGVyO1xyXG5cdFx0XHRyZXR1cm4gdHJ1ZTtcclxuXHRcdH0sXHJcblx0XHRhZGRGb3JtYXQ6IGZ1bmN0aW9uICgpIHtcclxuXHRcdFx0Z2xvYmFsQ29udGV4dC5hZGRGb3JtYXQuYXBwbHkoZ2xvYmFsQ29udGV4dCwgYXJndW1lbnRzKTtcclxuXHRcdH0sXHJcblx0XHRsYW5ndWFnZTogZnVuY3Rpb24gKGNvZGUpIHtcclxuXHRcdFx0aWYgKCFjb2RlKSB7XHJcblx0XHRcdFx0cmV0dXJuIGN1cnJlbnRMYW5ndWFnZTtcclxuXHRcdFx0fVxyXG5cdFx0XHRpZiAoIWxhbmd1YWdlc1tjb2RlXSkge1xyXG5cdFx0XHRcdGNvZGUgPSBjb2RlLnNwbGl0KCctJylbMF07IC8vIGZhbGwgYmFjayB0byBiYXNlIGxhbmd1YWdlXHJcblx0XHRcdH1cclxuXHRcdFx0aWYgKGxhbmd1YWdlc1tjb2RlXSkge1xyXG5cdFx0XHRcdGN1cnJlbnRMYW5ndWFnZSA9IGNvZGU7XHJcblx0XHRcdFx0cmV0dXJuIGNvZGU7IC8vIHNvIHlvdSBjYW4gdGVsbCBpZiBmYWxsLWJhY2sgaGFzIGhhcHBlbmVkXHJcblx0XHRcdH1cclxuXHRcdFx0cmV0dXJuIGZhbHNlO1xyXG5cdFx0fSxcclxuXHRcdGFkZExhbmd1YWdlOiBmdW5jdGlvbiAoY29kZSwgbWVzc2FnZU1hcCkge1xyXG5cdFx0XHR2YXIga2V5O1xyXG5cdFx0XHRmb3IgKGtleSBpbiBFcnJvckNvZGVzKSB7XHJcblx0XHRcdFx0aWYgKG1lc3NhZ2VNYXBba2V5XSAmJiAhbWVzc2FnZU1hcFtFcnJvckNvZGVzW2tleV1dKSB7XHJcblx0XHRcdFx0XHRtZXNzYWdlTWFwW0Vycm9yQ29kZXNba2V5XV0gPSBtZXNzYWdlTWFwW2tleV07XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblx0XHRcdHZhciByb290Q29kZSA9IGNvZGUuc3BsaXQoJy0nKVswXTtcclxuXHRcdFx0aWYgKCFsYW5ndWFnZXNbcm9vdENvZGVdKSB7IC8vIHVzZSBmb3IgYmFzZSBsYW5ndWFnZSBpZiBub3QgeWV0IGRlZmluZWRcclxuXHRcdFx0XHRsYW5ndWFnZXNbY29kZV0gPSBtZXNzYWdlTWFwO1xyXG5cdFx0XHRcdGxhbmd1YWdlc1tyb290Q29kZV0gPSBtZXNzYWdlTWFwO1xyXG5cdFx0XHR9IGVsc2Uge1xyXG5cdFx0XHRcdGxhbmd1YWdlc1tjb2RlXSA9IE9iamVjdC5jcmVhdGUobGFuZ3VhZ2VzW3Jvb3RDb2RlXSk7XHJcblx0XHRcdFx0Zm9yIChrZXkgaW4gbWVzc2FnZU1hcCkge1xyXG5cdFx0XHRcdFx0aWYgKHR5cGVvZiBsYW5ndWFnZXNbcm9vdENvZGVdW2tleV0gPT09ICd1bmRlZmluZWQnKSB7XHJcblx0XHRcdFx0XHRcdGxhbmd1YWdlc1tyb290Q29kZV1ba2V5XSA9IG1lc3NhZ2VNYXBba2V5XTtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdGxhbmd1YWdlc1tjb2RlXVtrZXldID0gbWVzc2FnZU1hcFtrZXldO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cdFx0XHRyZXR1cm4gdGhpcztcclxuXHRcdH0sXHJcblx0XHRmcmVzaEFwaTogZnVuY3Rpb24gKGxhbmd1YWdlKSB7XHJcblx0XHRcdHZhciByZXN1bHQgPSBjcmVhdGVBcGkoKTtcclxuXHRcdFx0aWYgKGxhbmd1YWdlKSB7XHJcblx0XHRcdFx0cmVzdWx0Lmxhbmd1YWdlKGxhbmd1YWdlKTtcclxuXHRcdFx0fVxyXG5cdFx0XHRyZXR1cm4gcmVzdWx0O1xyXG5cdFx0fSxcclxuXHRcdHZhbGlkYXRlOiBmdW5jdGlvbiAoZGF0YSwgc2NoZW1hLCBjaGVja1JlY3Vyc2l2ZSwgYmFuVW5rbm93blByb3BlcnRpZXMpIHtcclxuXHRcdFx0dmFyIGRlZiA9IGRlZmF1bHRFcnJvclJlcG9ydGVyKGN1cnJlbnRMYW5ndWFnZSk7XHJcblx0XHRcdHZhciBlcnJvclJlcG9ydGVyID0gY3VzdG9tRXJyb3JSZXBvcnRlciA/IGZ1bmN0aW9uIChlcnJvciwgZGF0YSwgc2NoZW1hKSB7XHJcblx0XHRcdFx0cmV0dXJuIGN1c3RvbUVycm9yUmVwb3J0ZXIoZXJyb3IsIGRhdGEsIHNjaGVtYSkgfHwgZGVmKGVycm9yLCBkYXRhLCBzY2hlbWEpO1xyXG5cdFx0XHR9IDogZGVmO1xyXG5cdFx0XHR2YXIgY29udGV4dCA9IG5ldyBWYWxpZGF0b3JDb250ZXh0KGdsb2JhbENvbnRleHQsIGZhbHNlLCBlcnJvclJlcG9ydGVyLCBjaGVja1JlY3Vyc2l2ZSwgYmFuVW5rbm93blByb3BlcnRpZXMpO1xyXG5cdFx0XHRpZiAodHlwZW9mIHNjaGVtYSA9PT0gXCJzdHJpbmdcIikge1xyXG5cdFx0XHRcdHNjaGVtYSA9IHtcIiRyZWZcIjogc2NoZW1hfTtcclxuXHRcdFx0fVxyXG5cdFx0XHRjb250ZXh0LmFkZFNjaGVtYShcIlwiLCBzY2hlbWEpO1xyXG5cdFx0XHR2YXIgZXJyb3IgPSBjb250ZXh0LnZhbGlkYXRlQWxsKGRhdGEsIHNjaGVtYSwgbnVsbCwgbnVsbCwgXCJcIik7XHJcblx0XHRcdGlmICghZXJyb3IgJiYgYmFuVW5rbm93blByb3BlcnRpZXMpIHtcclxuXHRcdFx0XHRlcnJvciA9IGNvbnRleHQuYmFuVW5rbm93blByb3BlcnRpZXMoZGF0YSwgc2NoZW1hKTtcclxuXHRcdFx0fVxyXG5cdFx0XHR0aGlzLmVycm9yID0gZXJyb3I7XHJcblx0XHRcdHRoaXMubWlzc2luZyA9IGNvbnRleHQubWlzc2luZztcclxuXHRcdFx0dGhpcy52YWxpZCA9IChlcnJvciA9PT0gbnVsbCk7XHJcblx0XHRcdHJldHVybiB0aGlzLnZhbGlkO1xyXG5cdFx0fSxcclxuXHRcdHZhbGlkYXRlUmVzdWx0OiBmdW5jdGlvbiAoKSB7XHJcblx0XHRcdHZhciByZXN1bHQgPSB7dG9TdHJpbmc6IGZ1bmN0aW9uICgpIHtcclxuXHRcdFx0XHRyZXR1cm4gdGhpcy52YWxpZCA/ICd2YWxpZCcgOiB0aGlzLmVycm9yLm1lc3NhZ2U7XHJcblx0XHRcdH19O1xyXG5cdFx0XHR0aGlzLnZhbGlkYXRlLmFwcGx5KHJlc3VsdCwgYXJndW1lbnRzKTtcclxuXHRcdFx0cmV0dXJuIHJlc3VsdDtcclxuXHRcdH0sXHJcblx0XHR2YWxpZGF0ZU11bHRpcGxlOiBmdW5jdGlvbiAoZGF0YSwgc2NoZW1hLCBjaGVja1JlY3Vyc2l2ZSwgYmFuVW5rbm93blByb3BlcnRpZXMpIHtcclxuXHRcdFx0dmFyIGRlZiA9IGRlZmF1bHRFcnJvclJlcG9ydGVyKGN1cnJlbnRMYW5ndWFnZSk7XHJcblx0XHRcdHZhciBlcnJvclJlcG9ydGVyID0gY3VzdG9tRXJyb3JSZXBvcnRlciA/IGZ1bmN0aW9uIChlcnJvciwgZGF0YSwgc2NoZW1hKSB7XHJcblx0XHRcdFx0cmV0dXJuIGN1c3RvbUVycm9yUmVwb3J0ZXIoZXJyb3IsIGRhdGEsIHNjaGVtYSkgfHwgZGVmKGVycm9yLCBkYXRhLCBzY2hlbWEpO1xyXG5cdFx0XHR9IDogZGVmO1xyXG5cdFx0XHR2YXIgY29udGV4dCA9IG5ldyBWYWxpZGF0b3JDb250ZXh0KGdsb2JhbENvbnRleHQsIHRydWUsIGVycm9yUmVwb3J0ZXIsIGNoZWNrUmVjdXJzaXZlLCBiYW5Vbmtub3duUHJvcGVydGllcyk7XHJcblx0XHRcdGlmICh0eXBlb2Ygc2NoZW1hID09PSBcInN0cmluZ1wiKSB7XHJcblx0XHRcdFx0c2NoZW1hID0ge1wiJHJlZlwiOiBzY2hlbWF9O1xyXG5cdFx0XHR9XHJcblx0XHRcdGNvbnRleHQuYWRkU2NoZW1hKFwiXCIsIHNjaGVtYSk7XHJcblx0XHRcdGNvbnRleHQudmFsaWRhdGVBbGwoZGF0YSwgc2NoZW1hLCBudWxsLCBudWxsLCBcIlwiKTtcclxuXHRcdFx0aWYgKGJhblVua25vd25Qcm9wZXJ0aWVzKSB7XHJcblx0XHRcdFx0Y29udGV4dC5iYW5Vbmtub3duUHJvcGVydGllcyhkYXRhLCBzY2hlbWEpO1xyXG5cdFx0XHR9XHJcblx0XHRcdHZhciByZXN1bHQgPSB7dG9TdHJpbmc6IGZ1bmN0aW9uICgpIHtcclxuXHRcdFx0XHRyZXR1cm4gdGhpcy52YWxpZCA/ICd2YWxpZCcgOiB0aGlzLmVycm9yLm1lc3NhZ2U7XHJcblx0XHRcdH19O1xyXG5cdFx0XHRyZXN1bHQuZXJyb3JzID0gY29udGV4dC5lcnJvcnM7XHJcblx0XHRcdHJlc3VsdC5taXNzaW5nID0gY29udGV4dC5taXNzaW5nO1xyXG5cdFx0XHRyZXN1bHQudmFsaWQgPSAocmVzdWx0LmVycm9ycy5sZW5ndGggPT09IDApO1xyXG5cdFx0XHRyZXR1cm4gcmVzdWx0O1xyXG5cdFx0fSxcclxuXHRcdGFkZFNjaGVtYTogZnVuY3Rpb24gKCkge1xyXG5cdFx0XHRyZXR1cm4gZ2xvYmFsQ29udGV4dC5hZGRTY2hlbWEuYXBwbHkoZ2xvYmFsQ29udGV4dCwgYXJndW1lbnRzKTtcclxuXHRcdH0sXHJcblx0XHRnZXRTY2hlbWE6IGZ1bmN0aW9uICgpIHtcclxuXHRcdFx0cmV0dXJuIGdsb2JhbENvbnRleHQuZ2V0U2NoZW1hLmFwcGx5KGdsb2JhbENvbnRleHQsIGFyZ3VtZW50cyk7XHJcblx0XHR9LFxyXG5cdFx0Z2V0U2NoZW1hTWFwOiBmdW5jdGlvbiAoKSB7XHJcblx0XHRcdHJldHVybiBnbG9iYWxDb250ZXh0LmdldFNjaGVtYU1hcC5hcHBseShnbG9iYWxDb250ZXh0LCBhcmd1bWVudHMpO1xyXG5cdFx0fSxcclxuXHRcdGdldFNjaGVtYVVyaXM6IGZ1bmN0aW9uICgpIHtcclxuXHRcdFx0cmV0dXJuIGdsb2JhbENvbnRleHQuZ2V0U2NoZW1hVXJpcy5hcHBseShnbG9iYWxDb250ZXh0LCBhcmd1bWVudHMpO1xyXG5cdFx0fSxcclxuXHRcdGdldE1pc3NpbmdVcmlzOiBmdW5jdGlvbiAoKSB7XHJcblx0XHRcdHJldHVybiBnbG9iYWxDb250ZXh0LmdldE1pc3NpbmdVcmlzLmFwcGx5KGdsb2JhbENvbnRleHQsIGFyZ3VtZW50cyk7XHJcblx0XHR9LFxyXG5cdFx0ZHJvcFNjaGVtYXM6IGZ1bmN0aW9uICgpIHtcclxuXHRcdFx0Z2xvYmFsQ29udGV4dC5kcm9wU2NoZW1hcy5hcHBseShnbG9iYWxDb250ZXh0LCBhcmd1bWVudHMpO1xyXG5cdFx0fSxcclxuXHRcdGRlZmluZUtleXdvcmQ6IGZ1bmN0aW9uICgpIHtcclxuXHRcdFx0Z2xvYmFsQ29udGV4dC5kZWZpbmVLZXl3b3JkLmFwcGx5KGdsb2JhbENvbnRleHQsIGFyZ3VtZW50cyk7XHJcblx0XHR9LFxyXG5cdFx0ZGVmaW5lRXJyb3I6IGZ1bmN0aW9uIChjb2RlTmFtZSwgY29kZU51bWJlciwgZGVmYXVsdE1lc3NhZ2UpIHtcclxuXHRcdFx0aWYgKHR5cGVvZiBjb2RlTmFtZSAhPT0gJ3N0cmluZycgfHwgIS9eW0EtWl0rKF9bQS1aXSspKiQvLnRlc3QoY29kZU5hbWUpKSB7XHJcblx0XHRcdFx0dGhyb3cgbmV3IEVycm9yKCdDb2RlIG5hbWUgbXVzdCBiZSBhIHN0cmluZyBpbiBVUFBFUl9DQVNFX1dJVEhfVU5ERVJTQ09SRVMnKTtcclxuXHRcdFx0fVxyXG5cdFx0XHRpZiAodHlwZW9mIGNvZGVOdW1iZXIgIT09ICdudW1iZXInIHx8IGNvZGVOdW1iZXIlMSAhPT0gMCB8fCBjb2RlTnVtYmVyIDwgMTAwMDApIHtcclxuXHRcdFx0XHR0aHJvdyBuZXcgRXJyb3IoJ0NvZGUgbnVtYmVyIG11c3QgYmUgYW4gaW50ZWdlciA+IDEwMDAwJyk7XHJcblx0XHRcdH1cclxuXHRcdFx0aWYgKHR5cGVvZiBFcnJvckNvZGVzW2NvZGVOYW1lXSAhPT0gJ3VuZGVmaW5lZCcpIHtcclxuXHRcdFx0XHR0aHJvdyBuZXcgRXJyb3IoJ0Vycm9yIGFscmVhZHkgZGVmaW5lZDogJyArIGNvZGVOYW1lICsgJyBhcyAnICsgRXJyb3JDb2Rlc1tjb2RlTmFtZV0pO1xyXG5cdFx0XHR9XHJcblx0XHRcdGlmICh0eXBlb2YgRXJyb3JDb2RlTG9va3VwW2NvZGVOdW1iZXJdICE9PSAndW5kZWZpbmVkJykge1xyXG5cdFx0XHRcdHRocm93IG5ldyBFcnJvcignRXJyb3IgY29kZSBhbHJlYWR5IHVzZWQ6ICcgKyBFcnJvckNvZGVMb29rdXBbY29kZU51bWJlcl0gKyAnIGFzICcgKyBjb2RlTnVtYmVyKTtcclxuXHRcdFx0fVxyXG5cdFx0XHRFcnJvckNvZGVzW2NvZGVOYW1lXSA9IGNvZGVOdW1iZXI7XHJcblx0XHRcdEVycm9yQ29kZUxvb2t1cFtjb2RlTnVtYmVyXSA9IGNvZGVOYW1lO1xyXG5cdFx0XHRFcnJvck1lc3NhZ2VzRGVmYXVsdFtjb2RlTmFtZV0gPSBFcnJvck1lc3NhZ2VzRGVmYXVsdFtjb2RlTnVtYmVyXSA9IGRlZmF1bHRNZXNzYWdlO1xyXG5cdFx0XHRmb3IgKHZhciBsYW5nQ29kZSBpbiBsYW5ndWFnZXMpIHtcclxuXHRcdFx0XHR2YXIgbGFuZ3VhZ2UgPSBsYW5ndWFnZXNbbGFuZ0NvZGVdO1xyXG5cdFx0XHRcdGlmIChsYW5ndWFnZVtjb2RlTmFtZV0pIHtcclxuXHRcdFx0XHRcdGxhbmd1YWdlW2NvZGVOdW1iZXJdID0gbGFuZ3VhZ2VbY29kZU51bWJlcl0gfHwgbGFuZ3VhZ2VbY29kZU5hbWVdO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cdFx0fSxcclxuXHRcdHJlc2V0OiBmdW5jdGlvbiAoKSB7XHJcblx0XHRcdGdsb2JhbENvbnRleHQucmVzZXQoKTtcclxuXHRcdFx0dGhpcy5lcnJvciA9IG51bGw7XHJcblx0XHRcdHRoaXMubWlzc2luZyA9IFtdO1xyXG5cdFx0XHR0aGlzLnZhbGlkID0gdHJ1ZTtcclxuXHRcdH0sXHJcblx0XHRtaXNzaW5nOiBbXSxcclxuXHRcdGVycm9yOiBudWxsLFxyXG5cdFx0dmFsaWQ6IHRydWUsXHJcblx0XHRub3JtU2NoZW1hOiBub3JtU2NoZW1hLFxyXG5cdFx0cmVzb2x2ZVVybDogcmVzb2x2ZVVybCxcclxuXHRcdGdldERvY3VtZW50VXJpOiBnZXREb2N1bWVudFVyaSxcclxuXHRcdGVycm9yQ29kZXM6IEVycm9yQ29kZXNcclxuXHR9O1xyXG5cdGFwaS5sYW5ndWFnZShsYW5ndWFnZSB8fCAnZW4nKTtcclxuXHRyZXR1cm4gYXBpO1xyXG59XHJcblxyXG52YXIgdHY0ID0gY3JlYXRlQXBpKCk7XHJcbnR2NC5hZGRMYW5ndWFnZSgnZW4tZ2InLCBFcnJvck1lc3NhZ2VzRGVmYXVsdCk7XHJcblxyXG4vL2xlZ2FjeSBwcm9wZXJ0eVxyXG50djQudHY0ID0gdHY0O1xyXG5cclxucmV0dXJuIHR2NDsgLy8gdXNlZCBieSBfaGVhZGVyLmpzIHRvIGdsb2JhbGlzZS5cclxuXHJcbn0pKTsiXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUNBLFdBTUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///90\n')},function(module,exports,__webpack_require__){eval("module.exports = !__webpack_require__(9) && !__webpack_require__(3)(function () {\n  return Object.defineProperty(__webpack_require__(61)('div'), 'a', { get: function () { return 7; } }).a != 7;\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiOTEuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9bbmFtZV0vLi9ub2RlX21vZHVsZXMvY29yZS1qcy9tb2R1bGVzL19pZTgtZG9tLWRlZmluZS5qcz9jNjlhIl0sInNvdXJjZXNDb250ZW50IjpbIm1vZHVsZS5leHBvcnRzID0gIXJlcXVpcmUoJy4vX2Rlc2NyaXB0b3JzJykgJiYgIXJlcXVpcmUoJy4vX2ZhaWxzJykoZnVuY3Rpb24gKCkge1xuICByZXR1cm4gT2JqZWN0LmRlZmluZVByb3BlcnR5KHJlcXVpcmUoJy4vX2RvbS1jcmVhdGUnKSgnZGl2JyksICdhJywgeyBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIDc7IH0gfSkuYSAhPSA3O1xufSk7XG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///91\n")},function(module,exports,__webpack_require__){eval("var global = __webpack_require__(2);\nvar core = __webpack_require__(8);\nvar LIBRARY = __webpack_require__(31);\nvar wksExt = __webpack_require__(62);\nvar defineProperty = __webpack_require__(10).f;\nmodule.exports = function (name) {\n  var $Symbol = core.Symbol || (core.Symbol = LIBRARY ? {} : global.Symbol || {});\n  if (name.charAt(0) != '_' && !(name in $Symbol)) defineProperty($Symbol, name, { value: wksExt.f(name) });\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiOTIuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9bbmFtZV0vLi9ub2RlX21vZHVsZXMvY29yZS1qcy9tb2R1bGVzL193a3MtZGVmaW5lLmpzPzNhNzIiXSwic291cmNlc0NvbnRlbnQiOlsidmFyIGdsb2JhbCA9IHJlcXVpcmUoJy4vX2dsb2JhbCcpO1xudmFyIGNvcmUgPSByZXF1aXJlKCcuL19jb3JlJyk7XG52YXIgTElCUkFSWSA9IHJlcXVpcmUoJy4vX2xpYnJhcnknKTtcbnZhciB3a3NFeHQgPSByZXF1aXJlKCcuL193a3MtZXh0Jyk7XG52YXIgZGVmaW5lUHJvcGVydHkgPSByZXF1aXJlKCcuL19vYmplY3QtZHAnKS5mO1xubW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAobmFtZSkge1xuICB2YXIgJFN5bWJvbCA9IGNvcmUuU3ltYm9sIHx8IChjb3JlLlN5bWJvbCA9IExJQlJBUlkgPyB7fSA6IGdsb2JhbC5TeW1ib2wgfHwge30pO1xuICBpZiAobmFtZS5jaGFyQXQoMCkgIT0gJ18nICYmICEobmFtZSBpbiAkU3ltYm9sKSkgZGVmaW5lUHJvcGVydHkoJFN5bWJvbCwgbmFtZSwgeyB2YWx1ZTogd2tzRXh0LmYobmFtZSkgfSk7XG59O1xuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Iiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///92\n")},function(module,exports,__webpack_require__){eval("var has = __webpack_require__(14);\nvar toIObject = __webpack_require__(16);\nvar arrayIndexOf = __webpack_require__(50)(false);\nvar IE_PROTO = __webpack_require__(63)('IE_PROTO');\n\nmodule.exports = function (object, names) {\n  var O = toIObject(object);\n  var i = 0;\n  var result = [];\n  var key;\n  for (key in O) if (key != IE_PROTO) has(O, key) && result.push(key);\n  // Don't enum bug & hidden keys\n  while (names.length > i) if (has(O, key = names[i++])) {\n    ~arrayIndexOf(result, key) || result.push(key);\n  }\n  return result;\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiOTMuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9bbmFtZV0vLi9ub2RlX21vZHVsZXMvY29yZS1qcy9tb2R1bGVzL19vYmplY3Qta2V5cy1pbnRlcm5hbC5qcz9jZTEwIl0sInNvdXJjZXNDb250ZW50IjpbInZhciBoYXMgPSByZXF1aXJlKCcuL19oYXMnKTtcbnZhciB0b0lPYmplY3QgPSByZXF1aXJlKCcuL190by1pb2JqZWN0Jyk7XG52YXIgYXJyYXlJbmRleE9mID0gcmVxdWlyZSgnLi9fYXJyYXktaW5jbHVkZXMnKShmYWxzZSk7XG52YXIgSUVfUFJPVE8gPSByZXF1aXJlKCcuL19zaGFyZWQta2V5JykoJ0lFX1BST1RPJyk7XG5cbm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKG9iamVjdCwgbmFtZXMpIHtcbiAgdmFyIE8gPSB0b0lPYmplY3Qob2JqZWN0KTtcbiAgdmFyIGkgPSAwO1xuICB2YXIgcmVzdWx0ID0gW107XG4gIHZhciBrZXk7XG4gIGZvciAoa2V5IGluIE8pIGlmIChrZXkgIT0gSUVfUFJPVE8pIGhhcyhPLCBrZXkpICYmIHJlc3VsdC5wdXNoKGtleSk7XG4gIC8vIERvbid0IGVudW0gYnVnICYgaGlkZGVuIGtleXNcbiAgd2hpbGUgKG5hbWVzLmxlbmd0aCA+IGkpIGlmIChoYXMoTywga2V5ID0gbmFtZXNbaSsrXSkpIHtcbiAgICB+YXJyYXlJbmRleE9mKHJlc3VsdCwga2V5KSB8fCByZXN1bHQucHVzaChrZXkpO1xuICB9XG4gIHJldHVybiByZXN1bHQ7XG59O1xuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///93\n")},function(module,exports,__webpack_require__){eval("var dP = __webpack_require__(10);\nvar anObject = __webpack_require__(4);\nvar getKeys = __webpack_require__(32);\n\nmodule.exports = __webpack_require__(9) ? Object.defineProperties : function defineProperties(O, Properties) {\n  anObject(O);\n  var keys = getKeys(Properties);\n  var length = keys.length;\n  var i = 0;\n  var P;\n  while (length > i) dP.f(O, P = keys[i++], Properties[P]);\n  return O;\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiOTQuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9bbmFtZV0vLi9ub2RlX21vZHVsZXMvY29yZS1qcy9tb2R1bGVzL19vYmplY3QtZHBzLmpzPzE0OTUiXSwic291cmNlc0NvbnRlbnQiOlsidmFyIGRQID0gcmVxdWlyZSgnLi9fb2JqZWN0LWRwJyk7XG52YXIgYW5PYmplY3QgPSByZXF1aXJlKCcuL19hbi1vYmplY3QnKTtcbnZhciBnZXRLZXlzID0gcmVxdWlyZSgnLi9fb2JqZWN0LWtleXMnKTtcblxubW9kdWxlLmV4cG9ydHMgPSByZXF1aXJlKCcuL19kZXNjcmlwdG9ycycpID8gT2JqZWN0LmRlZmluZVByb3BlcnRpZXMgOiBmdW5jdGlvbiBkZWZpbmVQcm9wZXJ0aWVzKE8sIFByb3BlcnRpZXMpIHtcbiAgYW5PYmplY3QoTyk7XG4gIHZhciBrZXlzID0gZ2V0S2V5cyhQcm9wZXJ0aWVzKTtcbiAgdmFyIGxlbmd0aCA9IGtleXMubGVuZ3RoO1xuICB2YXIgaSA9IDA7XG4gIHZhciBQO1xuICB3aGlsZSAobGVuZ3RoID4gaSkgZFAuZihPLCBQID0ga2V5c1tpKytdLCBQcm9wZXJ0aWVzW1BdKTtcbiAgcmV0dXJuIE87XG59O1xuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///94\n")},function(module,exports,__webpack_require__){eval("// fallback for IE11 buggy Object.getOwnPropertyNames with iframe and window\nvar toIObject = __webpack_require__(16);\nvar gOPN = __webpack_require__(35).f;\nvar toString = {}.toString;\n\nvar windowNames = typeof window == 'object' && window && Object.getOwnPropertyNames\n  ? Object.getOwnPropertyNames(window) : [];\n\nvar getWindowNames = function (it) {\n  try {\n    return gOPN(it);\n  } catch (e) {\n    return windowNames.slice();\n  }\n};\n\nmodule.exports.f = function getOwnPropertyNames(it) {\n  return windowNames && toString.call(it) == '[object Window]' ? getWindowNames(it) : gOPN(toIObject(it));\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiOTUuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9bbmFtZV0vLi9ub2RlX21vZHVsZXMvY29yZS1qcy9tb2R1bGVzL19vYmplY3QtZ29wbi1leHQuanM/N2JiYyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBmYWxsYmFjayBmb3IgSUUxMSBidWdneSBPYmplY3QuZ2V0T3duUHJvcGVydHlOYW1lcyB3aXRoIGlmcmFtZSBhbmQgd2luZG93XG52YXIgdG9JT2JqZWN0ID0gcmVxdWlyZSgnLi9fdG8taW9iamVjdCcpO1xudmFyIGdPUE4gPSByZXF1aXJlKCcuL19vYmplY3QtZ29wbicpLmY7XG52YXIgdG9TdHJpbmcgPSB7fS50b1N0cmluZztcblxudmFyIHdpbmRvd05hbWVzID0gdHlwZW9mIHdpbmRvdyA9PSAnb2JqZWN0JyAmJiB3aW5kb3cgJiYgT2JqZWN0LmdldE93blByb3BlcnR5TmFtZXNcbiAgPyBPYmplY3QuZ2V0T3duUHJvcGVydHlOYW1lcyh3aW5kb3cpIDogW107XG5cbnZhciBnZXRXaW5kb3dOYW1lcyA9IGZ1bmN0aW9uIChpdCkge1xuICB0cnkge1xuICAgIHJldHVybiBnT1BOKGl0KTtcbiAgfSBjYXRjaCAoZSkge1xuICAgIHJldHVybiB3aW5kb3dOYW1lcy5zbGljZSgpO1xuICB9XG59O1xuXG5tb2R1bGUuZXhwb3J0cy5mID0gZnVuY3Rpb24gZ2V0T3duUHJvcGVydHlOYW1lcyhpdCkge1xuICByZXR1cm4gd2luZG93TmFtZXMgJiYgdG9TdHJpbmcuY2FsbChpdCkgPT0gJ1tvYmplY3QgV2luZG93XScgPyBnZXRXaW5kb3dOYW1lcyhpdCkgOiBnT1BOKHRvSU9iamVjdChpdCkpO1xufTtcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Iiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///95\n")},function(module,exports,__webpack_require__){"use strict";eval("\n// 19.1.2.1 Object.assign(target, source, ...)\nvar DESCRIPTORS = __webpack_require__(9);\nvar getKeys = __webpack_require__(32);\nvar gOPS = __webpack_require__(51);\nvar pIE = __webpack_require__(46);\nvar toObject = __webpack_require__(11);\nvar IObject = __webpack_require__(45);\nvar $assign = Object.assign;\n\n// should work with symbols and should have deterministic property order (V8 bug)\nmodule.exports = !$assign || __webpack_require__(3)(function () {\n  var A = {};\n  var B = {};\n  // eslint-disable-next-line no-undef\n  var S = Symbol();\n  var K = 'abcdefghijklmnopqrst';\n  A[S] = 7;\n  K.split('').forEach(function (k) { B[k] = k; });\n  return $assign({}, A)[S] != 7 || Object.keys($assign({}, B)).join('') != K;\n}) ? function assign(target, source) { // eslint-disable-line no-unused-vars\n  var T = toObject(target);\n  var aLen = arguments.length;\n  var index = 1;\n  var getSymbols = gOPS.f;\n  var isEnum = pIE.f;\n  while (aLen > index) {\n    var S = IObject(arguments[index++]);\n    var keys = getSymbols ? getKeys(S).concat(getSymbols(S)) : getKeys(S);\n    var length = keys.length;\n    var j = 0;\n    var key;\n    while (length > j) {\n      key = keys[j++];\n      if (!DESCRIPTORS || isEnum.call(S, key)) T[key] = S[key];\n    }\n  } return T;\n} : $assign;\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiOTYuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9bbmFtZV0vLi9ub2RlX21vZHVsZXMvY29yZS1qcy9tb2R1bGVzL19vYmplY3QtYXNzaWduLmpzPzczMzMiXSwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuLy8gMTkuMS4yLjEgT2JqZWN0LmFzc2lnbih0YXJnZXQsIHNvdXJjZSwgLi4uKVxudmFyIERFU0NSSVBUT1JTID0gcmVxdWlyZSgnLi9fZGVzY3JpcHRvcnMnKTtcbnZhciBnZXRLZXlzID0gcmVxdWlyZSgnLi9fb2JqZWN0LWtleXMnKTtcbnZhciBnT1BTID0gcmVxdWlyZSgnLi9fb2JqZWN0LWdvcHMnKTtcbnZhciBwSUUgPSByZXF1aXJlKCcuL19vYmplY3QtcGllJyk7XG52YXIgdG9PYmplY3QgPSByZXF1aXJlKCcuL190by1vYmplY3QnKTtcbnZhciBJT2JqZWN0ID0gcmVxdWlyZSgnLi9faW9iamVjdCcpO1xudmFyICRhc3NpZ24gPSBPYmplY3QuYXNzaWduO1xuXG4vLyBzaG91bGQgd29yayB3aXRoIHN5bWJvbHMgYW5kIHNob3VsZCBoYXZlIGRldGVybWluaXN0aWMgcHJvcGVydHkgb3JkZXIgKFY4IGJ1Zylcbm1vZHVsZS5leHBvcnRzID0gISRhc3NpZ24gfHwgcmVxdWlyZSgnLi9fZmFpbHMnKShmdW5jdGlvbiAoKSB7XG4gIHZhciBBID0ge307XG4gIHZhciBCID0ge307XG4gIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby11bmRlZlxuICB2YXIgUyA9IFN5bWJvbCgpO1xuICB2YXIgSyA9ICdhYmNkZWZnaGlqa2xtbm9wcXJzdCc7XG4gIEFbU10gPSA3O1xuICBLLnNwbGl0KCcnKS5mb3JFYWNoKGZ1bmN0aW9uIChrKSB7IEJba10gPSBrOyB9KTtcbiAgcmV0dXJuICRhc3NpZ24oe30sIEEpW1NdICE9IDcgfHwgT2JqZWN0LmtleXMoJGFzc2lnbih7fSwgQikpLmpvaW4oJycpICE9IEs7XG59KSA/IGZ1bmN0aW9uIGFzc2lnbih0YXJnZXQsIHNvdXJjZSkgeyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIG5vLXVudXNlZC12YXJzXG4gIHZhciBUID0gdG9PYmplY3QodGFyZ2V0KTtcbiAgdmFyIGFMZW4gPSBhcmd1bWVudHMubGVuZ3RoO1xuICB2YXIgaW5kZXggPSAxO1xuICB2YXIgZ2V0U3ltYm9scyA9IGdPUFMuZjtcbiAgdmFyIGlzRW51bSA9IHBJRS5mO1xuICB3aGlsZSAoYUxlbiA+IGluZGV4KSB7XG4gICAgdmFyIFMgPSBJT2JqZWN0KGFyZ3VtZW50c1tpbmRleCsrXSk7XG4gICAgdmFyIGtleXMgPSBnZXRTeW1ib2xzID8gZ2V0S2V5cyhTKS5jb25jYXQoZ2V0U3ltYm9scyhTKSkgOiBnZXRLZXlzKFMpO1xuICAgIHZhciBsZW5ndGggPSBrZXlzLmxlbmd0aDtcbiAgICB2YXIgaiA9IDA7XG4gICAgdmFyIGtleTtcbiAgICB3aGlsZSAobGVuZ3RoID4gaikge1xuICAgICAga2V5ID0ga2V5c1tqKytdO1xuICAgICAgaWYgKCFERVNDUklQVE9SUyB8fCBpc0VudW0uY2FsbChTLCBrZXkpKSBUW2tleV0gPSBTW2tleV07XG4gICAgfVxuICB9IHJldHVybiBUO1xufSA6ICRhc3NpZ247XG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Iiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///96\n")},function(module,exports){eval("// 7.2.9 SameValue(x, y)\nmodule.exports = Object.is || function is(x, y) {\n  // eslint-disable-next-line no-self-compare\n  return x === y ? x !== 0 || 1 / x === 1 / y : x != x && y != y;\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiOTcuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9bbmFtZV0vLi9ub2RlX21vZHVsZXMvY29yZS1qcy9tb2R1bGVzL19zYW1lLXZhbHVlLmpzPzgzYTEiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gNy4yLjkgU2FtZVZhbHVlKHgsIHkpXG5tb2R1bGUuZXhwb3J0cyA9IE9iamVjdC5pcyB8fCBmdW5jdGlvbiBpcyh4LCB5KSB7XG4gIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1zZWxmLWNvbXBhcmVcbiAgcmV0dXJuIHggPT09IHkgPyB4ICE9PSAwIHx8IDEgLyB4ID09PSAxIC8geSA6IHggIT0geCAmJiB5ICE9IHk7XG59O1xuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///97\n")},function(module,exports,__webpack_require__){"use strict";eval("\nvar aFunction = __webpack_require__(19);\nvar isObject = __webpack_require__(5);\nvar invoke = __webpack_require__(99);\nvar arraySlice = [].slice;\nvar factories = {};\n\nvar construct = function (F, len, args) {\n  if (!(len in factories)) {\n    for (var n = [], i = 0; i < len; i++) n[i] = 'a[' + i + ']';\n    // eslint-disable-next-line no-new-func\n    factories[len] = Function('F,a', 'return new F(' + n.join(',') + ')');\n  } return factories[len](F, args);\n};\n\nmodule.exports = Function.bind || function bind(that /* , ...args */) {\n  var fn = aFunction(this);\n  var partArgs = arraySlice.call(arguments, 1);\n  var bound = function (/* args... */) {\n    var args = partArgs.concat(arraySlice.call(arguments));\n    return this instanceof bound ? construct(fn, args.length, args) : invoke(fn, args, that);\n  };\n  if (isObject(fn.prototype)) bound.prototype = fn.prototype;\n  return bound;\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiOTguanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9bbmFtZV0vLi9ub2RlX21vZHVsZXMvY29yZS1qcy9tb2R1bGVzL19iaW5kLmpzP2YwYzEiXSwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xudmFyIGFGdW5jdGlvbiA9IHJlcXVpcmUoJy4vX2EtZnVuY3Rpb24nKTtcbnZhciBpc09iamVjdCA9IHJlcXVpcmUoJy4vX2lzLW9iamVjdCcpO1xudmFyIGludm9rZSA9IHJlcXVpcmUoJy4vX2ludm9rZScpO1xudmFyIGFycmF5U2xpY2UgPSBbXS5zbGljZTtcbnZhciBmYWN0b3JpZXMgPSB7fTtcblxudmFyIGNvbnN0cnVjdCA9IGZ1bmN0aW9uIChGLCBsZW4sIGFyZ3MpIHtcbiAgaWYgKCEobGVuIGluIGZhY3RvcmllcykpIHtcbiAgICBmb3IgKHZhciBuID0gW10sIGkgPSAwOyBpIDwgbGVuOyBpKyspIG5baV0gPSAnYVsnICsgaSArICddJztcbiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tbmV3LWZ1bmNcbiAgICBmYWN0b3JpZXNbbGVuXSA9IEZ1bmN0aW9uKCdGLGEnLCAncmV0dXJuIG5ldyBGKCcgKyBuLmpvaW4oJywnKSArICcpJyk7XG4gIH0gcmV0dXJuIGZhY3Rvcmllc1tsZW5dKEYsIGFyZ3MpO1xufTtcblxubW9kdWxlLmV4cG9ydHMgPSBGdW5jdGlvbi5iaW5kIHx8IGZ1bmN0aW9uIGJpbmQodGhhdCAvKiAsIC4uLmFyZ3MgKi8pIHtcbiAgdmFyIGZuID0gYUZ1bmN0aW9uKHRoaXMpO1xuICB2YXIgcGFydEFyZ3MgPSBhcnJheVNsaWNlLmNhbGwoYXJndW1lbnRzLCAxKTtcbiAgdmFyIGJvdW5kID0gZnVuY3Rpb24gKC8qIGFyZ3MuLi4gKi8pIHtcbiAgICB2YXIgYXJncyA9IHBhcnRBcmdzLmNvbmNhdChhcnJheVNsaWNlLmNhbGwoYXJndW1lbnRzKSk7XG4gICAgcmV0dXJuIHRoaXMgaW5zdGFuY2VvZiBib3VuZCA/IGNvbnN0cnVjdChmbiwgYXJncy5sZW5ndGgsIGFyZ3MpIDogaW52b2tlKGZuLCBhcmdzLCB0aGF0KTtcbiAgfTtcbiAgaWYgKGlzT2JqZWN0KGZuLnByb3RvdHlwZSkpIGJvdW5kLnByb3RvdHlwZSA9IGZuLnByb3RvdHlwZTtcbiAgcmV0dXJuIGJvdW5kO1xufTtcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Iiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///98\n")},function(module,exports){eval("// fast apply, http://jsperf.lnkit.com/fast-apply/5\nmodule.exports = function (fn, args, that) {\n  var un = that === undefined;\n  switch (args.length) {\n    case 0: return un ? fn()\n                      : fn.call(that);\n    case 1: return un ? fn(args[0])\n                      : fn.call(that, args[0]);\n    case 2: return un ? fn(args[0], args[1])\n                      : fn.call(that, args[0], args[1]);\n    case 3: return un ? fn(args[0], args[1], args[2])\n                      : fn.call(that, args[0], args[1], args[2]);\n    case 4: return un ? fn(args[0], args[1], args[2], args[3])\n                      : fn.call(that, args[0], args[1], args[2], args[3]);\n  } return fn.apply(that, args);\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiOTkuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9bbmFtZV0vLi9ub2RlX21vZHVsZXMvY29yZS1qcy9tb2R1bGVzL19pbnZva2UuanM/MzFmNCJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBmYXN0IGFwcGx5LCBodHRwOi8vanNwZXJmLmxua2l0LmNvbS9mYXN0LWFwcGx5LzVcbm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKGZuLCBhcmdzLCB0aGF0KSB7XG4gIHZhciB1biA9IHRoYXQgPT09IHVuZGVmaW5lZDtcbiAgc3dpdGNoIChhcmdzLmxlbmd0aCkge1xuICAgIGNhc2UgMDogcmV0dXJuIHVuID8gZm4oKVxuICAgICAgICAgICAgICAgICAgICAgIDogZm4uY2FsbCh0aGF0KTtcbiAgICBjYXNlIDE6IHJldHVybiB1biA/IGZuKGFyZ3NbMF0pXG4gICAgICAgICAgICAgICAgICAgICAgOiBmbi5jYWxsKHRoYXQsIGFyZ3NbMF0pO1xuICAgIGNhc2UgMjogcmV0dXJuIHVuID8gZm4oYXJnc1swXSwgYXJnc1sxXSlcbiAgICAgICAgICAgICAgICAgICAgICA6IGZuLmNhbGwodGhhdCwgYXJnc1swXSwgYXJnc1sxXSk7XG4gICAgY2FzZSAzOiByZXR1cm4gdW4gPyBmbihhcmdzWzBdLCBhcmdzWzFdLCBhcmdzWzJdKVxuICAgICAgICAgICAgICAgICAgICAgIDogZm4uY2FsbCh0aGF0LCBhcmdzWzBdLCBhcmdzWzFdLCBhcmdzWzJdKTtcbiAgICBjYXNlIDQ6IHJldHVybiB1biA/IGZuKGFyZ3NbMF0sIGFyZ3NbMV0sIGFyZ3NbMl0sIGFyZ3NbM10pXG4gICAgICAgICAgICAgICAgICAgICAgOiBmbi5jYWxsKHRoYXQsIGFyZ3NbMF0sIGFyZ3NbMV0sIGFyZ3NbMl0sIGFyZ3NbM10pO1xuICB9IHJldHVybiBmbi5hcHBseSh0aGF0LCBhcmdzKTtcbn07XG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///99\n")},function(module,exports,__webpack_require__){eval("var $parseInt = __webpack_require__(2).parseInt;\nvar $trim = __webpack_require__(40).trim;\nvar ws = __webpack_require__(67);\nvar hex = /^[-+]?0[xX]/;\n\nmodule.exports = $parseInt(ws + '08') !== 8 || $parseInt(ws + '0x16') !== 22 ? function parseInt(str, radix) {\n  var string = $trim(String(str), 3);\n  return $parseInt(string, (radix >>> 0) || (hex.test(string) ? 16 : 10));\n} : $parseInt;\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTAwLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9fcGFyc2UtaW50LmpzPzNjYTUiXSwic291cmNlc0NvbnRlbnQiOlsidmFyICRwYXJzZUludCA9IHJlcXVpcmUoJy4vX2dsb2JhbCcpLnBhcnNlSW50O1xudmFyICR0cmltID0gcmVxdWlyZSgnLi9fc3RyaW5nLXRyaW0nKS50cmltO1xudmFyIHdzID0gcmVxdWlyZSgnLi9fc3RyaW5nLXdzJyk7XG52YXIgaGV4ID0gL15bLStdPzBbeFhdLztcblxubW9kdWxlLmV4cG9ydHMgPSAkcGFyc2VJbnQod3MgKyAnMDgnKSAhPT0gOCB8fCAkcGFyc2VJbnQod3MgKyAnMHgxNicpICE9PSAyMiA/IGZ1bmN0aW9uIHBhcnNlSW50KHN0ciwgcmFkaXgpIHtcbiAgdmFyIHN0cmluZyA9ICR0cmltKFN0cmluZyhzdHIpLCAzKTtcbiAgcmV0dXJuICRwYXJzZUludChzdHJpbmcsIChyYWRpeCA+Pj4gMCkgfHwgKGhleC50ZXN0KHN0cmluZykgPyAxNiA6IDEwKSk7XG59IDogJHBhcnNlSW50O1xuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Iiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///100\n")},function(module,exports,__webpack_require__){eval("var $parseFloat = __webpack_require__(2).parseFloat;\nvar $trim = __webpack_require__(40).trim;\n\nmodule.exports = 1 / $parseFloat(__webpack_require__(67) + '-0') !== -Infinity ? function parseFloat(str) {\n  var string = $trim(String(str), 3);\n  var result = $parseFloat(string);\n  return result === 0 && string.charAt(0) == '-' ? -0 : result;\n} : $parseFloat;\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTAxLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9fcGFyc2UtZmxvYXQuanM/ZDc1MiJdLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgJHBhcnNlRmxvYXQgPSByZXF1aXJlKCcuL19nbG9iYWwnKS5wYXJzZUZsb2F0O1xudmFyICR0cmltID0gcmVxdWlyZSgnLi9fc3RyaW5nLXRyaW0nKS50cmltO1xuXG5tb2R1bGUuZXhwb3J0cyA9IDEgLyAkcGFyc2VGbG9hdChyZXF1aXJlKCcuL19zdHJpbmctd3MnKSArICctMCcpICE9PSAtSW5maW5pdHkgPyBmdW5jdGlvbiBwYXJzZUZsb2F0KHN0cikge1xuICB2YXIgc3RyaW5nID0gJHRyaW0oU3RyaW5nKHN0ciksIDMpO1xuICB2YXIgcmVzdWx0ID0gJHBhcnNlRmxvYXQoc3RyaW5nKTtcbiAgcmV0dXJuIHJlc3VsdCA9PT0gMCAmJiBzdHJpbmcuY2hhckF0KDApID09ICctJyA/IC0wIDogcmVzdWx0O1xufSA6ICRwYXJzZUZsb2F0O1xuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///101\n")},function(module,exports,__webpack_require__){eval("var cof = __webpack_require__(24);\nmodule.exports = function (it, msg) {\n  if (typeof it != 'number' && cof(it) != 'Number') throw TypeError(msg);\n  return +it;\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTAyLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9fYS1udW1iZXItdmFsdWUuanM/YmVmOSJdLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgY29mID0gcmVxdWlyZSgnLi9fY29mJyk7XG5tb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChpdCwgbXNnKSB7XG4gIGlmICh0eXBlb2YgaXQgIT0gJ251bWJlcicgJiYgY29mKGl0KSAhPSAnTnVtYmVyJykgdGhyb3cgVHlwZUVycm9yKG1zZyk7XG4gIHJldHVybiAraXQ7XG59O1xuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///102\n")},function(module,exports,__webpack_require__){eval("// 20.1.2.3 Number.isInteger(number)\nvar isObject = __webpack_require__(5);\nvar floor = Math.floor;\nmodule.exports = function isInteger(it) {\n  return !isObject(it) && isFinite(it) && floor(it) === it;\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTAzLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9faXMtaW50ZWdlci5qcz85YzEyIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIDIwLjEuMi4zIE51bWJlci5pc0ludGVnZXIobnVtYmVyKVxudmFyIGlzT2JqZWN0ID0gcmVxdWlyZSgnLi9faXMtb2JqZWN0Jyk7XG52YXIgZmxvb3IgPSBNYXRoLmZsb29yO1xubW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiBpc0ludGVnZXIoaXQpIHtcbiAgcmV0dXJuICFpc09iamVjdChpdCkgJiYgaXNGaW5pdGUoaXQpICYmIGZsb29yKGl0KSA9PT0gaXQ7XG59O1xuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Iiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///103\n")},function(module,exports){eval("// 20.2.2.20 Math.log1p(x)\nmodule.exports = Math.log1p || function log1p(x) {\n  return (x = +x) > -1e-8 && x < 1e-8 ? x - x * x / 2 : Math.log(1 + x);\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTA0LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9fbWF0aC1sb2cxcC5qcz9kNmM2Il0sInNvdXJjZXNDb250ZW50IjpbIi8vIDIwLjIuMi4yMCBNYXRoLmxvZzFwKHgpXG5tb2R1bGUuZXhwb3J0cyA9IE1hdGgubG9nMXAgfHwgZnVuY3Rpb24gbG9nMXAoeCkge1xuICByZXR1cm4gKHggPSAreCkgPiAtMWUtOCAmJiB4IDwgMWUtOCA/IHggLSB4ICogeCAvIDIgOiBNYXRoLmxvZygxICsgeCk7XG59O1xuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///104\n")},function(module,exports,__webpack_require__){"use strict";eval("\nvar create = __webpack_require__(34);\nvar descriptor = __webpack_require__(29);\nvar setToStringTag = __webpack_require__(39);\nvar IteratorPrototype = {};\n\n// 25.1.2.1.1 %IteratorPrototype%[@@iterator]()\n__webpack_require__(15)(IteratorPrototype, __webpack_require__(6)('iterator'), function () { return this; });\n\nmodule.exports = function (Constructor, NAME, next) {\n  Constructor.prototype = create(IteratorPrototype, { next: descriptor(1, next) });\n  setToStringTag(Constructor, NAME + ' Iterator');\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTA1LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9faXRlci1jcmVhdGUuanM/NDFhMCJdLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XG52YXIgY3JlYXRlID0gcmVxdWlyZSgnLi9fb2JqZWN0LWNyZWF0ZScpO1xudmFyIGRlc2NyaXB0b3IgPSByZXF1aXJlKCcuL19wcm9wZXJ0eS1kZXNjJyk7XG52YXIgc2V0VG9TdHJpbmdUYWcgPSByZXF1aXJlKCcuL19zZXQtdG8tc3RyaW5nLXRhZycpO1xudmFyIEl0ZXJhdG9yUHJvdG90eXBlID0ge307XG5cbi8vIDI1LjEuMi4xLjEgJUl0ZXJhdG9yUHJvdG90eXBlJVtAQGl0ZXJhdG9yXSgpXG5yZXF1aXJlKCcuL19oaWRlJykoSXRlcmF0b3JQcm90b3R5cGUsIHJlcXVpcmUoJy4vX3drcycpKCdpdGVyYXRvcicpLCBmdW5jdGlvbiAoKSB7IHJldHVybiB0aGlzOyB9KTtcblxubW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoQ29uc3RydWN0b3IsIE5BTUUsIG5leHQpIHtcbiAgQ29uc3RydWN0b3IucHJvdG90eXBlID0gY3JlYXRlKEl0ZXJhdG9yUHJvdG90eXBlLCB7IG5leHQ6IGRlc2NyaXB0b3IoMSwgbmV4dCkgfSk7XG4gIHNldFRvU3RyaW5nVGFnKENvbnN0cnVjdG9yLCBOQU1FICsgJyBJdGVyYXRvcicpO1xufTtcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Iiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///105\n")},function(module,exports,__webpack_require__){eval("// call something on iterator step with safe closing on error\nvar anObject = __webpack_require__(4);\nmodule.exports = function (iterator, fn, value, entries) {\n  try {\n    return entries ? fn(anObject(value)[0], value[1]) : fn(value);\n  // 7.4.6 IteratorClose(iterator, completion)\n  } catch (e) {\n    var ret = iterator['return'];\n    if (ret !== undefined) anObject(ret.call(iterator));\n    throw e;\n  }\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTA2LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9faXRlci1jYWxsLmpzPzFmYTgiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gY2FsbCBzb21ldGhpbmcgb24gaXRlcmF0b3Igc3RlcCB3aXRoIHNhZmUgY2xvc2luZyBvbiBlcnJvclxudmFyIGFuT2JqZWN0ID0gcmVxdWlyZSgnLi9fYW4tb2JqZWN0Jyk7XG5tb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChpdGVyYXRvciwgZm4sIHZhbHVlLCBlbnRyaWVzKSB7XG4gIHRyeSB7XG4gICAgcmV0dXJuIGVudHJpZXMgPyBmbihhbk9iamVjdCh2YWx1ZSlbMF0sIHZhbHVlWzFdKSA6IGZuKHZhbHVlKTtcbiAgLy8gNy40LjYgSXRlcmF0b3JDbG9zZShpdGVyYXRvciwgY29tcGxldGlvbilcbiAgfSBjYXRjaCAoZSkge1xuICAgIHZhciByZXQgPSBpdGVyYXRvclsncmV0dXJuJ107XG4gICAgaWYgKHJldCAhPT0gdW5kZWZpbmVkKSBhbk9iamVjdChyZXQuY2FsbChpdGVyYXRvcikpO1xuICAgIHRocm93IGU7XG4gIH1cbn07XG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///106\n")},function(module,exports,__webpack_require__){eval("// 9.4.2.3 ArraySpeciesCreate(originalArray, length)\nvar speciesConstructor = __webpack_require__(219);\n\nmodule.exports = function (original, length) {\n  return new (speciesConstructor(original))(length);\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTA3LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9fYXJyYXktc3BlY2llcy1jcmVhdGUuanM/Y2QxYyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyA5LjQuMi4zIEFycmF5U3BlY2llc0NyZWF0ZShvcmlnaW5hbEFycmF5LCBsZW5ndGgpXG52YXIgc3BlY2llc0NvbnN0cnVjdG9yID0gcmVxdWlyZSgnLi9fYXJyYXktc3BlY2llcy1jb25zdHJ1Y3RvcicpO1xuXG5tb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChvcmlnaW5hbCwgbGVuZ3RoKSB7XG4gIHJldHVybiBuZXcgKHNwZWNpZXNDb25zdHJ1Y3RvcihvcmlnaW5hbCkpKGxlbmd0aCk7XG59O1xuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Iiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///107\n")},function(module,exports,__webpack_require__){eval("var aFunction = __webpack_require__(19);\nvar toObject = __webpack_require__(11);\nvar IObject = __webpack_require__(45);\nvar toLength = __webpack_require__(7);\n\nmodule.exports = function (that, callbackfn, aLen, memo, isRight) {\n  aFunction(callbackfn);\n  var O = toObject(that);\n  var self = IObject(O);\n  var length = toLength(O.length);\n  var index = isRight ? length - 1 : 0;\n  var i = isRight ? -1 : 1;\n  if (aLen < 2) for (;;) {\n    if (index in self) {\n      memo = self[index];\n      index += i;\n      break;\n    }\n    index += i;\n    if (isRight ? index < 0 : length <= index) {\n      throw TypeError('Reduce of empty array with no initial value');\n    }\n  }\n  for (;isRight ? index >= 0 : length > index; index += i) if (index in self) {\n    memo = callbackfn(memo, self[index], index, O);\n  }\n  return memo;\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTA4LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9fYXJyYXktcmVkdWNlLmpzPzdiMjMiXSwic291cmNlc0NvbnRlbnQiOlsidmFyIGFGdW5jdGlvbiA9IHJlcXVpcmUoJy4vX2EtZnVuY3Rpb24nKTtcbnZhciB0b09iamVjdCA9IHJlcXVpcmUoJy4vX3RvLW9iamVjdCcpO1xudmFyIElPYmplY3QgPSByZXF1aXJlKCcuL19pb2JqZWN0Jyk7XG52YXIgdG9MZW5ndGggPSByZXF1aXJlKCcuL190by1sZW5ndGgnKTtcblxubW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAodGhhdCwgY2FsbGJhY2tmbiwgYUxlbiwgbWVtbywgaXNSaWdodCkge1xuICBhRnVuY3Rpb24oY2FsbGJhY2tmbik7XG4gIHZhciBPID0gdG9PYmplY3QodGhhdCk7XG4gIHZhciBzZWxmID0gSU9iamVjdChPKTtcbiAgdmFyIGxlbmd0aCA9IHRvTGVuZ3RoKE8ubGVuZ3RoKTtcbiAgdmFyIGluZGV4ID0gaXNSaWdodCA/IGxlbmd0aCAtIDEgOiAwO1xuICB2YXIgaSA9IGlzUmlnaHQgPyAtMSA6IDE7XG4gIGlmIChhTGVuIDwgMikgZm9yICg7Oykge1xuICAgIGlmIChpbmRleCBpbiBzZWxmKSB7XG4gICAgICBtZW1vID0gc2VsZltpbmRleF07XG4gICAgICBpbmRleCArPSBpO1xuICAgICAgYnJlYWs7XG4gICAgfVxuICAgIGluZGV4ICs9IGk7XG4gICAgaWYgKGlzUmlnaHQgPyBpbmRleCA8IDAgOiBsZW5ndGggPD0gaW5kZXgpIHtcbiAgICAgIHRocm93IFR5cGVFcnJvcignUmVkdWNlIG9mIGVtcHR5IGFycmF5IHdpdGggbm8gaW5pdGlhbCB2YWx1ZScpO1xuICAgIH1cbiAgfVxuICBmb3IgKDtpc1JpZ2h0ID8gaW5kZXggPj0gMCA6IGxlbmd0aCA+IGluZGV4OyBpbmRleCArPSBpKSBpZiAoaW5kZXggaW4gc2VsZikge1xuICAgIG1lbW8gPSBjYWxsYmFja2ZuKG1lbW8sIHNlbGZbaW5kZXhdLCBpbmRleCwgTyk7XG4gIH1cbiAgcmV0dXJuIG1lbW87XG59O1xuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///108\n")},function(module,exports,__webpack_require__){"use strict";eval("// 22.1.3.3 Array.prototype.copyWithin(target, start, end = this.length)\n\nvar toObject = __webpack_require__(11);\nvar toAbsoluteIndex = __webpack_require__(33);\nvar toLength = __webpack_require__(7);\n\nmodule.exports = [].copyWithin || function copyWithin(target /* = 0 */, start /* = 0, end = @length */) {\n  var O = toObject(this);\n  var len = toLength(O.length);\n  var to = toAbsoluteIndex(target, len);\n  var from = toAbsoluteIndex(start, len);\n  var end = arguments.length > 2 ? arguments[2] : undefined;\n  var count = Math.min((end === undefined ? len : toAbsoluteIndex(end, len)) - from, len - to);\n  var inc = 1;\n  if (from < to && to < from + count) {\n    inc = -1;\n    from += count - 1;\n    to += count - 1;\n  }\n  while (count-- > 0) {\n    if (from in O) O[to] = O[from];\n    else delete O[to];\n    to += inc;\n    from += inc;\n  } return O;\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTA5LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9fYXJyYXktY29weS13aXRoaW4uanM/YmE5MiJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyAyMi4xLjMuMyBBcnJheS5wcm90b3R5cGUuY29weVdpdGhpbih0YXJnZXQsIHN0YXJ0LCBlbmQgPSB0aGlzLmxlbmd0aClcbid1c2Ugc3RyaWN0JztcbnZhciB0b09iamVjdCA9IHJlcXVpcmUoJy4vX3RvLW9iamVjdCcpO1xudmFyIHRvQWJzb2x1dGVJbmRleCA9IHJlcXVpcmUoJy4vX3RvLWFic29sdXRlLWluZGV4Jyk7XG52YXIgdG9MZW5ndGggPSByZXF1aXJlKCcuL190by1sZW5ndGgnKTtcblxubW9kdWxlLmV4cG9ydHMgPSBbXS5jb3B5V2l0aGluIHx8IGZ1bmN0aW9uIGNvcHlXaXRoaW4odGFyZ2V0IC8qID0gMCAqLywgc3RhcnQgLyogPSAwLCBlbmQgPSBAbGVuZ3RoICovKSB7XG4gIHZhciBPID0gdG9PYmplY3QodGhpcyk7XG4gIHZhciBsZW4gPSB0b0xlbmd0aChPLmxlbmd0aCk7XG4gIHZhciB0byA9IHRvQWJzb2x1dGVJbmRleCh0YXJnZXQsIGxlbik7XG4gIHZhciBmcm9tID0gdG9BYnNvbHV0ZUluZGV4KHN0YXJ0LCBsZW4pO1xuICB2YXIgZW5kID0gYXJndW1lbnRzLmxlbmd0aCA+IDIgPyBhcmd1bWVudHNbMl0gOiB1bmRlZmluZWQ7XG4gIHZhciBjb3VudCA9IE1hdGgubWluKChlbmQgPT09IHVuZGVmaW5lZCA/IGxlbiA6IHRvQWJzb2x1dGVJbmRleChlbmQsIGxlbikpIC0gZnJvbSwgbGVuIC0gdG8pO1xuICB2YXIgaW5jID0gMTtcbiAgaWYgKGZyb20gPCB0byAmJiB0byA8IGZyb20gKyBjb3VudCkge1xuICAgIGluYyA9IC0xO1xuICAgIGZyb20gKz0gY291bnQgLSAxO1xuICAgIHRvICs9IGNvdW50IC0gMTtcbiAgfVxuICB3aGlsZSAoY291bnQtLSA+IDApIHtcbiAgICBpZiAoZnJvbSBpbiBPKSBPW3RvXSA9IE9bZnJvbV07XG4gICAgZWxzZSBkZWxldGUgT1t0b107XG4gICAgdG8gKz0gaW5jO1xuICAgIGZyb20gKz0gaW5jO1xuICB9IHJldHVybiBPO1xufTtcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///109\n")},function(module,exports){eval("module.exports = function (done, value) {\n  return { value: value, done: !!done };\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTEwLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9faXRlci1zdGVwLmpzP2Q1M2IiXSwic291cmNlc0NvbnRlbnQiOlsibW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoZG9uZSwgdmFsdWUpIHtcbiAgcmV0dXJuIHsgdmFsdWU6IHZhbHVlLCBkb25lOiAhIWRvbmUgfTtcbn07XG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///110\n")},function(module,exports,__webpack_require__){"use strict";eval("\nvar regexpExec = __webpack_require__(82);\n__webpack_require__(1)({\n  target: 'RegExp',\n  proto: true,\n  forced: regexpExec !== /./.exec\n}, {\n  exec: regexpExec\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTExLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9lczYucmVnZXhwLmV4ZWMuanM/YjBjNSJdLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XG52YXIgcmVnZXhwRXhlYyA9IHJlcXVpcmUoJy4vX3JlZ2V4cC1leGVjJyk7XG5yZXF1aXJlKCcuL19leHBvcnQnKSh7XG4gIHRhcmdldDogJ1JlZ0V4cCcsXG4gIHByb3RvOiB0cnVlLFxuICBmb3JjZWQ6IHJlZ2V4cEV4ZWMgIT09IC8uLy5leGVjXG59LCB7XG4gIGV4ZWM6IHJlZ2V4cEV4ZWNcbn0pO1xuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Iiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///111\n")},function(module,exports,__webpack_require__){eval("// 21.2.5.3 get RegExp.prototype.flags()\nif (__webpack_require__(9) && /./g.flags != 'g') __webpack_require__(10).f(RegExp.prototype, 'flags', {\n  configurable: true,\n  get: __webpack_require__(54)\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTEyLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9lczYucmVnZXhwLmZsYWdzLmpzPzM4NDYiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gMjEuMi41LjMgZ2V0IFJlZ0V4cC5wcm90b3R5cGUuZmxhZ3MoKVxuaWYgKHJlcXVpcmUoJy4vX2Rlc2NyaXB0b3JzJykgJiYgLy4vZy5mbGFncyAhPSAnZycpIHJlcXVpcmUoJy4vX29iamVjdC1kcCcpLmYoUmVnRXhwLnByb3RvdHlwZSwgJ2ZsYWdzJywge1xuICBjb25maWd1cmFibGU6IHRydWUsXG4gIGdldDogcmVxdWlyZSgnLi9fZmxhZ3MnKVxufSk7XG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Iiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///112\n")},function(module,exports,__webpack_require__){"use strict";eval("\nvar LIBRARY = __webpack_require__(31);\nvar global = __webpack_require__(2);\nvar ctx = __webpack_require__(18);\nvar classof = __webpack_require__(47);\nvar $export = __webpack_require__(1);\nvar isObject = __webpack_require__(5);\nvar aFunction = __webpack_require__(19);\nvar anInstance = __webpack_require__(43);\nvar forOf = __webpack_require__(57);\nvar speciesConstructor = __webpack_require__(48);\nvar task = __webpack_require__(84).set;\nvar microtask = __webpack_require__(239)();\nvar newPromiseCapabilityModule = __webpack_require__(114);\nvar perform = __webpack_require__(240);\nvar userAgent = __webpack_require__(58);\nvar promiseResolve = __webpack_require__(115);\nvar PROMISE = 'Promise';\nvar TypeError = global.TypeError;\nvar process = global.process;\nvar versions = process && process.versions;\nvar v8 = versions && versions.v8 || '';\nvar $Promise = global[PROMISE];\nvar isNode = classof(process) == 'process';\nvar empty = function () { /* empty */ };\nvar Internal, newGenericPromiseCapability, OwnPromiseCapability, Wrapper;\nvar newPromiseCapability = newGenericPromiseCapability = newPromiseCapabilityModule.f;\n\nvar USE_NATIVE = !!function () {\n  try {\n    // correct subclassing with @@species support\n    var promise = $Promise.resolve(1);\n    var FakePromise = (promise.constructor = {})[__webpack_require__(6)('species')] = function (exec) {\n      exec(empty, empty);\n    };\n    // unhandled rejections tracking support, NodeJS Promise without it fails @@species test\n    return (isNode || typeof PromiseRejectionEvent == 'function')\n      && promise.then(empty) instanceof FakePromise\n      // v8 6.6 (Node 10 and Chrome 66) have a bug with resolving custom thenables\n      // https://bugs.chromium.org/p/chromium/issues/detail?id=830565\n      // we can't detect it synchronously, so just check versions\n      && v8.indexOf('6.6') !== 0\n      && userAgent.indexOf('Chrome/66') === -1;\n  } catch (e) { /* empty */ }\n}();\n\n// helpers\nvar isThenable = function (it) {\n  var then;\n  return isObject(it) && typeof (then = it.then) == 'function' ? then : false;\n};\nvar notify = function (promise, isReject) {\n  if (promise._n) return;\n  promise._n = true;\n  var chain = promise._c;\n  microtask(function () {\n    var value = promise._v;\n    var ok = promise._s == 1;\n    var i = 0;\n    var run = function (reaction) {\n      var handler = ok ? reaction.ok : reaction.fail;\n      var resolve = reaction.resolve;\n      var reject = reaction.reject;\n      var domain = reaction.domain;\n      var result, then, exited;\n      try {\n        if (handler) {\n          if (!ok) {\n            if (promise._h == 2) onHandleUnhandled(promise);\n            promise._h = 1;\n          }\n          if (handler === true) result = value;\n          else {\n            if (domain) domain.enter();\n            result = handler(value); // may throw\n            if (domain) {\n              domain.exit();\n              exited = true;\n            }\n          }\n          if (result === reaction.promise) {\n            reject(TypeError('Promise-chain cycle'));\n          } else if (then = isThenable(result)) {\n            then.call(result, resolve, reject);\n          } else resolve(result);\n        } else reject(value);\n      } catch (e) {\n        if (domain && !exited) domain.exit();\n        reject(e);\n      }\n    };\n    while (chain.length > i) run(chain[i++]); // variable length - can't use forEach\n    promise._c = [];\n    promise._n = false;\n    if (isReject && !promise._h) onUnhandled(promise);\n  });\n};\nvar onUnhandled = function (promise) {\n  task.call(global, function () {\n    var value = promise._v;\n    var unhandled = isUnhandled(promise);\n    var result, handler, console;\n    if (unhandled) {\n      result = perform(function () {\n        if (isNode) {\n          process.emit('unhandledRejection', value, promise);\n        } else if (handler = global.onunhandledrejection) {\n          handler({ promise: promise, reason: value });\n        } else if ((console = global.console) && console.error) {\n          console.error('Unhandled promise rejection', value);\n        }\n      });\n      // Browsers should not trigger `rejectionHandled` event if it was handled here, NodeJS - should\n      promise._h = isNode || isUnhandled(promise) ? 2 : 1;\n    } promise._a = undefined;\n    if (unhandled && result.e) throw result.v;\n  });\n};\nvar isUnhandled = function (promise) {\n  return promise._h !== 1 && (promise._a || promise._c).length === 0;\n};\nvar onHandleUnhandled = function (promise) {\n  task.call(global, function () {\n    var handler;\n    if (isNode) {\n      process.emit('rejectionHandled', promise);\n    } else if (handler = global.onrejectionhandled) {\n      handler({ promise: promise, reason: promise._v });\n    }\n  });\n};\nvar $reject = function (value) {\n  var promise = this;\n  if (promise._d) return;\n  promise._d = true;\n  promise = promise._w || promise; // unwrap\n  promise._v = value;\n  promise._s = 2;\n  if (!promise._a) promise._a = promise._c.slice();\n  notify(promise, true);\n};\nvar $resolve = function (value) {\n  var promise = this;\n  var then;\n  if (promise._d) return;\n  promise._d = true;\n  promise = promise._w || promise; // unwrap\n  try {\n    if (promise === value) throw TypeError(\"Promise can't be resolved itself\");\n    if (then = isThenable(value)) {\n      microtask(function () {\n        var wrapper = { _w: promise, _d: false }; // wrap\n        try {\n          then.call(value, ctx($resolve, wrapper, 1), ctx($reject, wrapper, 1));\n        } catch (e) {\n          $reject.call(wrapper, e);\n        }\n      });\n    } else {\n      promise._v = value;\n      promise._s = 1;\n      notify(promise, false);\n    }\n  } catch (e) {\n    $reject.call({ _w: promise, _d: false }, e); // wrap\n  }\n};\n\n// constructor polyfill\nif (!USE_NATIVE) {\n  // 25.4.3.1 Promise(executor)\n  $Promise = function Promise(executor) {\n    anInstance(this, $Promise, PROMISE, '_h');\n    aFunction(executor);\n    Internal.call(this);\n    try {\n      executor(ctx($resolve, this, 1), ctx($reject, this, 1));\n    } catch (err) {\n      $reject.call(this, err);\n    }\n  };\n  // eslint-disable-next-line no-unused-vars\n  Internal = function Promise(executor) {\n    this._c = [];             // <- awaiting reactions\n    this._a = undefined;      // <- checked in isUnhandled reactions\n    this._s = 0;              // <- state\n    this._d = false;          // <- done\n    this._v = undefined;      // <- value\n    this._h = 0;              // <- rejection state, 0 - default, 1 - handled, 2 - unhandled\n    this._n = false;          // <- notify\n  };\n  Internal.prototype = __webpack_require__(44)($Promise.prototype, {\n    // 25.4.5.3 Promise.prototype.then(onFulfilled, onRejected)\n    then: function then(onFulfilled, onRejected) {\n      var reaction = newPromiseCapability(speciesConstructor(this, $Promise));\n      reaction.ok = typeof onFulfilled == 'function' ? onFulfilled : true;\n      reaction.fail = typeof onRejected == 'function' && onRejected;\n      reaction.domain = isNode ? process.domain : undefined;\n      this._c.push(reaction);\n      if (this._a) this._a.push(reaction);\n      if (this._s) notify(this, false);\n      return reaction.promise;\n    },\n    // 25.4.5.1 Promise.prototype.catch(onRejected)\n    'catch': function (onRejected) {\n      return this.then(undefined, onRejected);\n    }\n  });\n  OwnPromiseCapability = function () {\n    var promise = new Internal();\n    this.promise = promise;\n    this.resolve = ctx($resolve, promise, 1);\n    this.reject = ctx($reject, promise, 1);\n  };\n  newPromiseCapabilityModule.f = newPromiseCapability = function (C) {\n    return C === $Promise || C === Wrapper\n      ? new OwnPromiseCapability(C)\n      : newGenericPromiseCapability(C);\n  };\n}\n\n$export($export.G + $export.W + $export.F * !USE_NATIVE, { Promise: $Promise });\n__webpack_require__(39)($Promise, PROMISE);\n__webpack_require__(42)(PROMISE);\nWrapper = __webpack_require__(8)[PROMISE];\n\n// statics\n$export($export.S + $export.F * !USE_NATIVE, PROMISE, {\n  // 25.4.4.5 Promise.reject(r)\n  reject: function reject(r) {\n    var capability = newPromiseCapability(this);\n    var $$reject = capability.reject;\n    $$reject(r);\n    return capability.promise;\n  }\n});\n$export($export.S + $export.F * (LIBRARY || !USE_NATIVE), PROMISE, {\n  // 25.4.4.6 Promise.resolve(x)\n  resolve: function resolve(x) {\n    return promiseResolve(LIBRARY && this === Wrapper ? $Promise : this, x);\n  }\n});\n$export($export.S + $export.F * !(USE_NATIVE && __webpack_require__(53)(function (iter) {\n  $Promise.all(iter)['catch'](empty);\n})), PROMISE, {\n  // 25.4.4.1 Promise.all(iterable)\n  all: function all(iterable) {\n    var C = this;\n    var capability = newPromiseCapability(C);\n    var resolve = capability.resolve;\n    var reject = capability.reject;\n    var result = perform(function () {\n      var values = [];\n      var index = 0;\n      var remaining = 1;\n      forOf(iterable, false, function (promise) {\n        var $index = index++;\n        var alreadyCalled = false;\n        values.push(undefined);\n        remaining++;\n        C.resolve(promise).then(function (value) {\n          if (alreadyCalled) return;\n          alreadyCalled = true;\n          values[$index] = value;\n          --remaining || resolve(values);\n        }, reject);\n      });\n      --remaining || resolve(values);\n    });\n    if (result.e) reject(result.v);\n    return capability.promise;\n  },\n  // 25.4.4.4 Promise.race(iterable)\n  race: function race(iterable) {\n    var C = this;\n    var capability = newPromiseCapability(C);\n    var reject = capability.reject;\n    var result = perform(function () {\n      forOf(iterable, false, function (promise) {\n        C.resolve(promise).then(capability.resolve, reject);\n      });\n    });\n    if (result.e) reject(result.v);\n    return capability.promise;\n  }\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTEzLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9lczYucHJvbWlzZS5qcz81NTFjIl0sInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcbnZhciBMSUJSQVJZID0gcmVxdWlyZSgnLi9fbGlicmFyeScpO1xudmFyIGdsb2JhbCA9IHJlcXVpcmUoJy4vX2dsb2JhbCcpO1xudmFyIGN0eCA9IHJlcXVpcmUoJy4vX2N0eCcpO1xudmFyIGNsYXNzb2YgPSByZXF1aXJlKCcuL19jbGFzc29mJyk7XG52YXIgJGV4cG9ydCA9IHJlcXVpcmUoJy4vX2V4cG9ydCcpO1xudmFyIGlzT2JqZWN0ID0gcmVxdWlyZSgnLi9faXMtb2JqZWN0Jyk7XG52YXIgYUZ1bmN0aW9uID0gcmVxdWlyZSgnLi9fYS1mdW5jdGlvbicpO1xudmFyIGFuSW5zdGFuY2UgPSByZXF1aXJlKCcuL19hbi1pbnN0YW5jZScpO1xudmFyIGZvck9mID0gcmVxdWlyZSgnLi9fZm9yLW9mJyk7XG52YXIgc3BlY2llc0NvbnN0cnVjdG9yID0gcmVxdWlyZSgnLi9fc3BlY2llcy1jb25zdHJ1Y3RvcicpO1xudmFyIHRhc2sgPSByZXF1aXJlKCcuL190YXNrJykuc2V0O1xudmFyIG1pY3JvdGFzayA9IHJlcXVpcmUoJy4vX21pY3JvdGFzaycpKCk7XG52YXIgbmV3UHJvbWlzZUNhcGFiaWxpdHlNb2R1bGUgPSByZXF1aXJlKCcuL19uZXctcHJvbWlzZS1jYXBhYmlsaXR5Jyk7XG52YXIgcGVyZm9ybSA9IHJlcXVpcmUoJy4vX3BlcmZvcm0nKTtcbnZhciB1c2VyQWdlbnQgPSByZXF1aXJlKCcuL191c2VyLWFnZW50Jyk7XG52YXIgcHJvbWlzZVJlc29sdmUgPSByZXF1aXJlKCcuL19wcm9taXNlLXJlc29sdmUnKTtcbnZhciBQUk9NSVNFID0gJ1Byb21pc2UnO1xudmFyIFR5cGVFcnJvciA9IGdsb2JhbC5UeXBlRXJyb3I7XG52YXIgcHJvY2VzcyA9IGdsb2JhbC5wcm9jZXNzO1xudmFyIHZlcnNpb25zID0gcHJvY2VzcyAmJiBwcm9jZXNzLnZlcnNpb25zO1xudmFyIHY4ID0gdmVyc2lvbnMgJiYgdmVyc2lvbnMudjggfHwgJyc7XG52YXIgJFByb21pc2UgPSBnbG9iYWxbUFJPTUlTRV07XG52YXIgaXNOb2RlID0gY2xhc3NvZihwcm9jZXNzKSA9PSAncHJvY2Vzcyc7XG52YXIgZW1wdHkgPSBmdW5jdGlvbiAoKSB7IC8qIGVtcHR5ICovIH07XG52YXIgSW50ZXJuYWwsIG5ld0dlbmVyaWNQcm9taXNlQ2FwYWJpbGl0eSwgT3duUHJvbWlzZUNhcGFiaWxpdHksIFdyYXBwZXI7XG52YXIgbmV3UHJvbWlzZUNhcGFiaWxpdHkgPSBuZXdHZW5lcmljUHJvbWlzZUNhcGFiaWxpdHkgPSBuZXdQcm9taXNlQ2FwYWJpbGl0eU1vZHVsZS5mO1xuXG52YXIgVVNFX05BVElWRSA9ICEhZnVuY3Rpb24gKCkge1xuICB0cnkge1xuICAgIC8vIGNvcnJlY3Qgc3ViY2xhc3Npbmcgd2l0aCBAQHNwZWNpZXMgc3VwcG9ydFxuICAgIHZhciBwcm9taXNlID0gJFByb21pc2UucmVzb2x2ZSgxKTtcbiAgICB2YXIgRmFrZVByb21pc2UgPSAocHJvbWlzZS5jb25zdHJ1Y3RvciA9IHt9KVtyZXF1aXJlKCcuL193a3MnKSgnc3BlY2llcycpXSA9IGZ1bmN0aW9uIChleGVjKSB7XG4gICAgICBleGVjKGVtcHR5LCBlbXB0eSk7XG4gICAgfTtcbiAgICAvLyB1bmhhbmRsZWQgcmVqZWN0aW9ucyB0cmFja2luZyBzdXBwb3J0LCBOb2RlSlMgUHJvbWlzZSB3aXRob3V0IGl0IGZhaWxzIEBAc3BlY2llcyB0ZXN0XG4gICAgcmV0dXJuIChpc05vZGUgfHwgdHlwZW9mIFByb21pc2VSZWplY3Rpb25FdmVudCA9PSAnZnVuY3Rpb24nKVxuICAgICAgJiYgcHJvbWlzZS50aGVuKGVtcHR5KSBpbnN0YW5jZW9mIEZha2VQcm9taXNlXG4gICAgICAvLyB2OCA2LjYgKE5vZGUgMTAgYW5kIENocm9tZSA2NikgaGF2ZSBhIGJ1ZyB3aXRoIHJlc29sdmluZyBjdXN0b20gdGhlbmFibGVzXG4gICAgICAvLyBodHRwczovL2J1Z3MuY2hyb21pdW0ub3JnL3AvY2hyb21pdW0vaXNzdWVzL2RldGFpbD9pZD04MzA1NjVcbiAgICAgIC8vIHdlIGNhbid0IGRldGVjdCBpdCBzeW5jaHJvbm91c2x5LCBzbyBqdXN0IGNoZWNrIHZlcnNpb25zXG4gICAgICAmJiB2OC5pbmRleE9mKCc2LjYnKSAhPT0gMFxuICAgICAgJiYgdXNlckFnZW50LmluZGV4T2YoJ0Nocm9tZS82NicpID09PSAtMTtcbiAgfSBjYXRjaCAoZSkgeyAvKiBlbXB0eSAqLyB9XG59KCk7XG5cbi8vIGhlbHBlcnNcbnZhciBpc1RoZW5hYmxlID0gZnVuY3Rpb24gKGl0KSB7XG4gIHZhciB0aGVuO1xuICByZXR1cm4gaXNPYmplY3QoaXQpICYmIHR5cGVvZiAodGhlbiA9IGl0LnRoZW4pID09ICdmdW5jdGlvbicgPyB0aGVuIDogZmFsc2U7XG59O1xudmFyIG5vdGlmeSA9IGZ1bmN0aW9uIChwcm9taXNlLCBpc1JlamVjdCkge1xuICBpZiAocHJvbWlzZS5fbikgcmV0dXJuO1xuICBwcm9taXNlLl9uID0gdHJ1ZTtcbiAgdmFyIGNoYWluID0gcHJvbWlzZS5fYztcbiAgbWljcm90YXNrKGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgdmFsdWUgPSBwcm9taXNlLl92O1xuICAgIHZhciBvayA9IHByb21pc2UuX3MgPT0gMTtcbiAgICB2YXIgaSA9IDA7XG4gICAgdmFyIHJ1biA9IGZ1bmN0aW9uIChyZWFjdGlvbikge1xuICAgICAgdmFyIGhhbmRsZXIgPSBvayA/IHJlYWN0aW9uLm9rIDogcmVhY3Rpb24uZmFpbDtcbiAgICAgIHZhciByZXNvbHZlID0gcmVhY3Rpb24ucmVzb2x2ZTtcbiAgICAgIHZhciByZWplY3QgPSByZWFjdGlvbi5yZWplY3Q7XG4gICAgICB2YXIgZG9tYWluID0gcmVhY3Rpb24uZG9tYWluO1xuICAgICAgdmFyIHJlc3VsdCwgdGhlbiwgZXhpdGVkO1xuICAgICAgdHJ5IHtcbiAgICAgICAgaWYgKGhhbmRsZXIpIHtcbiAgICAgICAgICBpZiAoIW9rKSB7XG4gICAgICAgICAgICBpZiAocHJvbWlzZS5faCA9PSAyKSBvbkhhbmRsZVVuaGFuZGxlZChwcm9taXNlKTtcbiAgICAgICAgICAgIHByb21pc2UuX2ggPSAxO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAoaGFuZGxlciA9PT0gdHJ1ZSkgcmVzdWx0ID0gdmFsdWU7XG4gICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBpZiAoZG9tYWluKSBkb21haW4uZW50ZXIoKTtcbiAgICAgICAgICAgIHJlc3VsdCA9IGhhbmRsZXIodmFsdWUpOyAvLyBtYXkgdGhyb3dcbiAgICAgICAgICAgIGlmIChkb21haW4pIHtcbiAgICAgICAgICAgICAgZG9tYWluLmV4aXQoKTtcbiAgICAgICAgICAgICAgZXhpdGVkID0gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKHJlc3VsdCA9PT0gcmVhY3Rpb24ucHJvbWlzZSkge1xuICAgICAgICAgICAgcmVqZWN0KFR5cGVFcnJvcignUHJvbWlzZS1jaGFpbiBjeWNsZScpKTtcbiAgICAgICAgICB9IGVsc2UgaWYgKHRoZW4gPSBpc1RoZW5hYmxlKHJlc3VsdCkpIHtcbiAgICAgICAgICAgIHRoZW4uY2FsbChyZXN1bHQsIHJlc29sdmUsIHJlamVjdCk7XG4gICAgICAgICAgfSBlbHNlIHJlc29sdmUocmVzdWx0KTtcbiAgICAgICAgfSBlbHNlIHJlamVjdCh2YWx1ZSk7XG4gICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgIGlmIChkb21haW4gJiYgIWV4aXRlZCkgZG9tYWluLmV4aXQoKTtcbiAgICAgICAgcmVqZWN0KGUpO1xuICAgICAgfVxuICAgIH07XG4gICAgd2hpbGUgKGNoYWluLmxlbmd0aCA+IGkpIHJ1bihjaGFpbltpKytdKTsgLy8gdmFyaWFibGUgbGVuZ3RoIC0gY2FuJ3QgdXNlIGZvckVhY2hcbiAgICBwcm9taXNlLl9jID0gW107XG4gICAgcHJvbWlzZS5fbiA9IGZhbHNlO1xuICAgIGlmIChpc1JlamVjdCAmJiAhcHJvbWlzZS5faCkgb25VbmhhbmRsZWQocHJvbWlzZSk7XG4gIH0pO1xufTtcbnZhciBvblVuaGFuZGxlZCA9IGZ1bmN0aW9uIChwcm9taXNlKSB7XG4gIHRhc2suY2FsbChnbG9iYWwsIGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgdmFsdWUgPSBwcm9taXNlLl92O1xuICAgIHZhciB1bmhhbmRsZWQgPSBpc1VuaGFuZGxlZChwcm9taXNlKTtcbiAgICB2YXIgcmVzdWx0LCBoYW5kbGVyLCBjb25zb2xlO1xuICAgIGlmICh1bmhhbmRsZWQpIHtcbiAgICAgIHJlc3VsdCA9IHBlcmZvcm0oZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAoaXNOb2RlKSB7XG4gICAgICAgICAgcHJvY2Vzcy5lbWl0KCd1bmhhbmRsZWRSZWplY3Rpb24nLCB2YWx1ZSwgcHJvbWlzZSk7XG4gICAgICAgIH0gZWxzZSBpZiAoaGFuZGxlciA9IGdsb2JhbC5vbnVuaGFuZGxlZHJlamVjdGlvbikge1xuICAgICAgICAgIGhhbmRsZXIoeyBwcm9taXNlOiBwcm9taXNlLCByZWFzb246IHZhbHVlIH0pO1xuICAgICAgICB9IGVsc2UgaWYgKChjb25zb2xlID0gZ2xvYmFsLmNvbnNvbGUpICYmIGNvbnNvbGUuZXJyb3IpIHtcbiAgICAgICAgICBjb25zb2xlLmVycm9yKCdVbmhhbmRsZWQgcHJvbWlzZSByZWplY3Rpb24nLCB2YWx1ZSk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgICAgLy8gQnJvd3NlcnMgc2hvdWxkIG5vdCB0cmlnZ2VyIGByZWplY3Rpb25IYW5kbGVkYCBldmVudCBpZiBpdCB3YXMgaGFuZGxlZCBoZXJlLCBOb2RlSlMgLSBzaG91bGRcbiAgICAgIHByb21pc2UuX2ggPSBpc05vZGUgfHwgaXNVbmhhbmRsZWQocHJvbWlzZSkgPyAyIDogMTtcbiAgICB9IHByb21pc2UuX2EgPSB1bmRlZmluZWQ7XG4gICAgaWYgKHVuaGFuZGxlZCAmJiByZXN1bHQuZSkgdGhyb3cgcmVzdWx0LnY7XG4gIH0pO1xufTtcbnZhciBpc1VuaGFuZGxlZCA9IGZ1bmN0aW9uIChwcm9taXNlKSB7XG4gIHJldHVybiBwcm9taXNlLl9oICE9PSAxICYmIChwcm9taXNlLl9hIHx8IHByb21pc2UuX2MpLmxlbmd0aCA9PT0gMDtcbn07XG52YXIgb25IYW5kbGVVbmhhbmRsZWQgPSBmdW5jdGlvbiAocHJvbWlzZSkge1xuICB0YXNrLmNhbGwoZ2xvYmFsLCBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIGhhbmRsZXI7XG4gICAgaWYgKGlzTm9kZSkge1xuICAgICAgcHJvY2Vzcy5lbWl0KCdyZWplY3Rpb25IYW5kbGVkJywgcHJvbWlzZSk7XG4gICAgfSBlbHNlIGlmIChoYW5kbGVyID0gZ2xvYmFsLm9ucmVqZWN0aW9uaGFuZGxlZCkge1xuICAgICAgaGFuZGxlcih7IHByb21pc2U6IHByb21pc2UsIHJlYXNvbjogcHJvbWlzZS5fdiB9KTtcbiAgICB9XG4gIH0pO1xufTtcbnZhciAkcmVqZWN0ID0gZnVuY3Rpb24gKHZhbHVlKSB7XG4gIHZhciBwcm9taXNlID0gdGhpcztcbiAgaWYgKHByb21pc2UuX2QpIHJldHVybjtcbiAgcHJvbWlzZS5fZCA9IHRydWU7XG4gIHByb21pc2UgPSBwcm9taXNlLl93IHx8IHByb21pc2U7IC8vIHVud3JhcFxuICBwcm9taXNlLl92ID0gdmFsdWU7XG4gIHByb21pc2UuX3MgPSAyO1xuICBpZiAoIXByb21pc2UuX2EpIHByb21pc2UuX2EgPSBwcm9taXNlLl9jLnNsaWNlKCk7XG4gIG5vdGlmeShwcm9taXNlLCB0cnVlKTtcbn07XG52YXIgJHJlc29sdmUgPSBmdW5jdGlvbiAodmFsdWUpIHtcbiAgdmFyIHByb21pc2UgPSB0aGlzO1xuICB2YXIgdGhlbjtcbiAgaWYgKHByb21pc2UuX2QpIHJldHVybjtcbiAgcHJvbWlzZS5fZCA9IHRydWU7XG4gIHByb21pc2UgPSBwcm9taXNlLl93IHx8IHByb21pc2U7IC8vIHVud3JhcFxuICB0cnkge1xuICAgIGlmIChwcm9taXNlID09PSB2YWx1ZSkgdGhyb3cgVHlwZUVycm9yKFwiUHJvbWlzZSBjYW4ndCBiZSByZXNvbHZlZCBpdHNlbGZcIik7XG4gICAgaWYgKHRoZW4gPSBpc1RoZW5hYmxlKHZhbHVlKSkge1xuICAgICAgbWljcm90YXNrKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHdyYXBwZXIgPSB7IF93OiBwcm9taXNlLCBfZDogZmFsc2UgfTsgLy8gd3JhcFxuICAgICAgICB0cnkge1xuICAgICAgICAgIHRoZW4uY2FsbCh2YWx1ZSwgY3R4KCRyZXNvbHZlLCB3cmFwcGVyLCAxKSwgY3R4KCRyZWplY3QsIHdyYXBwZXIsIDEpKTtcbiAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICRyZWplY3QuY2FsbCh3cmFwcGVyLCBlKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHByb21pc2UuX3YgPSB2YWx1ZTtcbiAgICAgIHByb21pc2UuX3MgPSAxO1xuICAgICAgbm90aWZ5KHByb21pc2UsIGZhbHNlKTtcbiAgICB9XG4gIH0gY2F0Y2ggKGUpIHtcbiAgICAkcmVqZWN0LmNhbGwoeyBfdzogcHJvbWlzZSwgX2Q6IGZhbHNlIH0sIGUpOyAvLyB3cmFwXG4gIH1cbn07XG5cbi8vIGNvbnN0cnVjdG9yIHBvbHlmaWxsXG5pZiAoIVVTRV9OQVRJVkUpIHtcbiAgLy8gMjUuNC4zLjEgUHJvbWlzZShleGVjdXRvcilcbiAgJFByb21pc2UgPSBmdW5jdGlvbiBQcm9taXNlKGV4ZWN1dG9yKSB7XG4gICAgYW5JbnN0YW5jZSh0aGlzLCAkUHJvbWlzZSwgUFJPTUlTRSwgJ19oJyk7XG4gICAgYUZ1bmN0aW9uKGV4ZWN1dG9yKTtcbiAgICBJbnRlcm5hbC5jYWxsKHRoaXMpO1xuICAgIHRyeSB7XG4gICAgICBleGVjdXRvcihjdHgoJHJlc29sdmUsIHRoaXMsIDEpLCBjdHgoJHJlamVjdCwgdGhpcywgMSkpO1xuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgJHJlamVjdC5jYWxsKHRoaXMsIGVycik7XG4gICAgfVxuICB9O1xuICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tdW51c2VkLXZhcnNcbiAgSW50ZXJuYWwgPSBmdW5jdGlvbiBQcm9taXNlKGV4ZWN1dG9yKSB7XG4gICAgdGhpcy5fYyA9IFtdOyAgICAgICAgICAgICAvLyA8LSBhd2FpdGluZyByZWFjdGlvbnNcbiAgICB0aGlzLl9hID0gdW5kZWZpbmVkOyAgICAgIC8vIDwtIGNoZWNrZWQgaW4gaXNVbmhhbmRsZWQgcmVhY3Rpb25zXG4gICAgdGhpcy5fcyA9IDA7ICAgICAgICAgICAgICAvLyA8LSBzdGF0ZVxuICAgIHRoaXMuX2QgPSBmYWxzZTsgICAgICAgICAgLy8gPC0gZG9uZVxuICAgIHRoaXMuX3YgPSB1bmRlZmluZWQ7ICAgICAgLy8gPC0gdmFsdWVcbiAgICB0aGlzLl9oID0gMDsgICAgICAgICAgICAgIC8vIDwtIHJlamVjdGlvbiBzdGF0ZSwgMCAtIGRlZmF1bHQsIDEgLSBoYW5kbGVkLCAyIC0gdW5oYW5kbGVkXG4gICAgdGhpcy5fbiA9IGZhbHNlOyAgICAgICAgICAvLyA8LSBub3RpZnlcbiAgfTtcbiAgSW50ZXJuYWwucHJvdG90eXBlID0gcmVxdWlyZSgnLi9fcmVkZWZpbmUtYWxsJykoJFByb21pc2UucHJvdG90eXBlLCB7XG4gICAgLy8gMjUuNC41LjMgUHJvbWlzZS5wcm90b3R5cGUudGhlbihvbkZ1bGZpbGxlZCwgb25SZWplY3RlZClcbiAgICB0aGVuOiBmdW5jdGlvbiB0aGVuKG9uRnVsZmlsbGVkLCBvblJlamVjdGVkKSB7XG4gICAgICB2YXIgcmVhY3Rpb24gPSBuZXdQcm9taXNlQ2FwYWJpbGl0eShzcGVjaWVzQ29uc3RydWN0b3IodGhpcywgJFByb21pc2UpKTtcbiAgICAgIHJlYWN0aW9uLm9rID0gdHlwZW9mIG9uRnVsZmlsbGVkID09ICdmdW5jdGlvbicgPyBvbkZ1bGZpbGxlZCA6IHRydWU7XG4gICAgICByZWFjdGlvbi5mYWlsID0gdHlwZW9mIG9uUmVqZWN0ZWQgPT0gJ2Z1bmN0aW9uJyAmJiBvblJlamVjdGVkO1xuICAgICAgcmVhY3Rpb24uZG9tYWluID0gaXNOb2RlID8gcHJvY2Vzcy5kb21haW4gOiB1bmRlZmluZWQ7XG4gICAgICB0aGlzLl9jLnB1c2gocmVhY3Rpb24pO1xuICAgICAgaWYgKHRoaXMuX2EpIHRoaXMuX2EucHVzaChyZWFjdGlvbik7XG4gICAgICBpZiAodGhpcy5fcykgbm90aWZ5KHRoaXMsIGZhbHNlKTtcbiAgICAgIHJldHVybiByZWFjdGlvbi5wcm9taXNlO1xuICAgIH0sXG4gICAgLy8gMjUuNC41LjEgUHJvbWlzZS5wcm90b3R5cGUuY2F0Y2gob25SZWplY3RlZClcbiAgICAnY2F0Y2gnOiBmdW5jdGlvbiAob25SZWplY3RlZCkge1xuICAgICAgcmV0dXJuIHRoaXMudGhlbih1bmRlZmluZWQsIG9uUmVqZWN0ZWQpO1xuICAgIH1cbiAgfSk7XG4gIE93blByb21pc2VDYXBhYmlsaXR5ID0gZnVuY3Rpb24gKCkge1xuICAgIHZhciBwcm9taXNlID0gbmV3IEludGVybmFsKCk7XG4gICAgdGhpcy5wcm9taXNlID0gcHJvbWlzZTtcbiAgICB0aGlzLnJlc29sdmUgPSBjdHgoJHJlc29sdmUsIHByb21pc2UsIDEpO1xuICAgIHRoaXMucmVqZWN0ID0gY3R4KCRyZWplY3QsIHByb21pc2UsIDEpO1xuICB9O1xuICBuZXdQcm9taXNlQ2FwYWJpbGl0eU1vZHVsZS5mID0gbmV3UHJvbWlzZUNhcGFiaWxpdHkgPSBmdW5jdGlvbiAoQykge1xuICAgIHJldHVybiBDID09PSAkUHJvbWlzZSB8fCBDID09PSBXcmFwcGVyXG4gICAgICA/IG5ldyBPd25Qcm9taXNlQ2FwYWJpbGl0eShDKVxuICAgICAgOiBuZXdHZW5lcmljUHJvbWlzZUNhcGFiaWxpdHkoQyk7XG4gIH07XG59XG5cbiRleHBvcnQoJGV4cG9ydC5HICsgJGV4cG9ydC5XICsgJGV4cG9ydC5GICogIVVTRV9OQVRJVkUsIHsgUHJvbWlzZTogJFByb21pc2UgfSk7XG5yZXF1aXJlKCcuL19zZXQtdG8tc3RyaW5nLXRhZycpKCRQcm9taXNlLCBQUk9NSVNFKTtcbnJlcXVpcmUoJy4vX3NldC1zcGVjaWVzJykoUFJPTUlTRSk7XG5XcmFwcGVyID0gcmVxdWlyZSgnLi9fY29yZScpW1BST01JU0VdO1xuXG4vLyBzdGF0aWNzXG4kZXhwb3J0KCRleHBvcnQuUyArICRleHBvcnQuRiAqICFVU0VfTkFUSVZFLCBQUk9NSVNFLCB7XG4gIC8vIDI1LjQuNC41IFByb21pc2UucmVqZWN0KHIpXG4gIHJlamVjdDogZnVuY3Rpb24gcmVqZWN0KHIpIHtcbiAgICB2YXIgY2FwYWJpbGl0eSA9IG5ld1Byb21pc2VDYXBhYmlsaXR5KHRoaXMpO1xuICAgIHZhciAkJHJlamVjdCA9IGNhcGFiaWxpdHkucmVqZWN0O1xuICAgICQkcmVqZWN0KHIpO1xuICAgIHJldHVybiBjYXBhYmlsaXR5LnByb21pc2U7XG4gIH1cbn0pO1xuJGV4cG9ydCgkZXhwb3J0LlMgKyAkZXhwb3J0LkYgKiAoTElCUkFSWSB8fCAhVVNFX05BVElWRSksIFBST01JU0UsIHtcbiAgLy8gMjUuNC40LjYgUHJvbWlzZS5yZXNvbHZlKHgpXG4gIHJlc29sdmU6IGZ1bmN0aW9uIHJlc29sdmUoeCkge1xuICAgIHJldHVybiBwcm9taXNlUmVzb2x2ZShMSUJSQVJZICYmIHRoaXMgPT09IFdyYXBwZXIgPyAkUHJvbWlzZSA6IHRoaXMsIHgpO1xuICB9XG59KTtcbiRleHBvcnQoJGV4cG9ydC5TICsgJGV4cG9ydC5GICogIShVU0VfTkFUSVZFICYmIHJlcXVpcmUoJy4vX2l0ZXItZGV0ZWN0JykoZnVuY3Rpb24gKGl0ZXIpIHtcbiAgJFByb21pc2UuYWxsKGl0ZXIpWydjYXRjaCddKGVtcHR5KTtcbn0pKSwgUFJPTUlTRSwge1xuICAvLyAyNS40LjQuMSBQcm9taXNlLmFsbChpdGVyYWJsZSlcbiAgYWxsOiBmdW5jdGlvbiBhbGwoaXRlcmFibGUpIHtcbiAgICB2YXIgQyA9IHRoaXM7XG4gICAgdmFyIGNhcGFiaWxpdHkgPSBuZXdQcm9taXNlQ2FwYWJpbGl0eShDKTtcbiAgICB2YXIgcmVzb2x2ZSA9IGNhcGFiaWxpdHkucmVzb2x2ZTtcbiAgICB2YXIgcmVqZWN0ID0gY2FwYWJpbGl0eS5yZWplY3Q7XG4gICAgdmFyIHJlc3VsdCA9IHBlcmZvcm0oZnVuY3Rpb24gKCkge1xuICAgICAgdmFyIHZhbHVlcyA9IFtdO1xuICAgICAgdmFyIGluZGV4ID0gMDtcbiAgICAgIHZhciByZW1haW5pbmcgPSAxO1xuICAgICAgZm9yT2YoaXRlcmFibGUsIGZhbHNlLCBmdW5jdGlvbiAocHJvbWlzZSkge1xuICAgICAgICB2YXIgJGluZGV4ID0gaW5kZXgrKztcbiAgICAgICAgdmFyIGFscmVhZHlDYWxsZWQgPSBmYWxzZTtcbiAgICAgICAgdmFsdWVzLnB1c2godW5kZWZpbmVkKTtcbiAgICAgICAgcmVtYWluaW5nKys7XG4gICAgICAgIEMucmVzb2x2ZShwcm9taXNlKS50aGVuKGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgICAgIGlmIChhbHJlYWR5Q2FsbGVkKSByZXR1cm47XG4gICAgICAgICAgYWxyZWFkeUNhbGxlZCA9IHRydWU7XG4gICAgICAgICAgdmFsdWVzWyRpbmRleF0gPSB2YWx1ZTtcbiAgICAgICAgICAtLXJlbWFpbmluZyB8fCByZXNvbHZlKHZhbHVlcyk7XG4gICAgICAgIH0sIHJlamVjdCk7XG4gICAgICB9KTtcbiAgICAgIC0tcmVtYWluaW5nIHx8IHJlc29sdmUodmFsdWVzKTtcbiAgICB9KTtcbiAgICBpZiAocmVzdWx0LmUpIHJlamVjdChyZXN1bHQudik7XG4gICAgcmV0dXJuIGNhcGFiaWxpdHkucHJvbWlzZTtcbiAgfSxcbiAgLy8gMjUuNC40LjQgUHJvbWlzZS5yYWNlKGl0ZXJhYmxlKVxuICByYWNlOiBmdW5jdGlvbiByYWNlKGl0ZXJhYmxlKSB7XG4gICAgdmFyIEMgPSB0aGlzO1xuICAgIHZhciBjYXBhYmlsaXR5ID0gbmV3UHJvbWlzZUNhcGFiaWxpdHkoQyk7XG4gICAgdmFyIHJlamVjdCA9IGNhcGFiaWxpdHkucmVqZWN0O1xuICAgIHZhciByZXN1bHQgPSBwZXJmb3JtKGZ1bmN0aW9uICgpIHtcbiAgICAgIGZvck9mKGl0ZXJhYmxlLCBmYWxzZSwgZnVuY3Rpb24gKHByb21pc2UpIHtcbiAgICAgICAgQy5yZXNvbHZlKHByb21pc2UpLnRoZW4oY2FwYWJpbGl0eS5yZXNvbHZlLCByZWplY3QpO1xuICAgICAgfSk7XG4gICAgfSk7XG4gICAgaWYgKHJlc3VsdC5lKSByZWplY3QocmVzdWx0LnYpO1xuICAgIHJldHVybiBjYXBhYmlsaXR5LnByb21pc2U7XG4gIH1cbn0pO1xuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///113\n")},function(module,exports,__webpack_require__){"use strict";eval("\n// 25.4.1.5 NewPromiseCapability(C)\nvar aFunction = __webpack_require__(19);\n\nfunction PromiseCapability(C) {\n  var resolve, reject;\n  this.promise = new C(function ($$resolve, $$reject) {\n    if (resolve !== undefined || reject !== undefined) throw TypeError('Bad Promise constructor');\n    resolve = $$resolve;\n    reject = $$reject;\n  });\n  this.resolve = aFunction(resolve);\n  this.reject = aFunction(reject);\n}\n\nmodule.exports.f = function (C) {\n  return new PromiseCapability(C);\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTE0LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9fbmV3LXByb21pc2UtY2FwYWJpbGl0eS5qcz9hNWI4Il0sInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0Jztcbi8vIDI1LjQuMS41IE5ld1Byb21pc2VDYXBhYmlsaXR5KEMpXG52YXIgYUZ1bmN0aW9uID0gcmVxdWlyZSgnLi9fYS1mdW5jdGlvbicpO1xuXG5mdW5jdGlvbiBQcm9taXNlQ2FwYWJpbGl0eShDKSB7XG4gIHZhciByZXNvbHZlLCByZWplY3Q7XG4gIHRoaXMucHJvbWlzZSA9IG5ldyBDKGZ1bmN0aW9uICgkJHJlc29sdmUsICQkcmVqZWN0KSB7XG4gICAgaWYgKHJlc29sdmUgIT09IHVuZGVmaW5lZCB8fCByZWplY3QgIT09IHVuZGVmaW5lZCkgdGhyb3cgVHlwZUVycm9yKCdCYWQgUHJvbWlzZSBjb25zdHJ1Y3RvcicpO1xuICAgIHJlc29sdmUgPSAkJHJlc29sdmU7XG4gICAgcmVqZWN0ID0gJCRyZWplY3Q7XG4gIH0pO1xuICB0aGlzLnJlc29sdmUgPSBhRnVuY3Rpb24ocmVzb2x2ZSk7XG4gIHRoaXMucmVqZWN0ID0gYUZ1bmN0aW9uKHJlamVjdCk7XG59XG5cbm1vZHVsZS5leHBvcnRzLmYgPSBmdW5jdGlvbiAoQykge1xuICByZXR1cm4gbmV3IFByb21pc2VDYXBhYmlsaXR5KEMpO1xufTtcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///114\n")},function(module,exports,__webpack_require__){eval("var anObject = __webpack_require__(4);\nvar isObject = __webpack_require__(5);\nvar newPromiseCapability = __webpack_require__(114);\n\nmodule.exports = function (C, x) {\n  anObject(C);\n  if (isObject(x) && x.constructor === C) return x;\n  var promiseCapability = newPromiseCapability.f(C);\n  var resolve = promiseCapability.resolve;\n  resolve(x);\n  return promiseCapability.promise;\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTE1LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9fcHJvbWlzZS1yZXNvbHZlLmpzP2JjYWEiXSwic291cmNlc0NvbnRlbnQiOlsidmFyIGFuT2JqZWN0ID0gcmVxdWlyZSgnLi9fYW4tb2JqZWN0Jyk7XG52YXIgaXNPYmplY3QgPSByZXF1aXJlKCcuL19pcy1vYmplY3QnKTtcbnZhciBuZXdQcm9taXNlQ2FwYWJpbGl0eSA9IHJlcXVpcmUoJy4vX25ldy1wcm9taXNlLWNhcGFiaWxpdHknKTtcblxubW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoQywgeCkge1xuICBhbk9iamVjdChDKTtcbiAgaWYgKGlzT2JqZWN0KHgpICYmIHguY29uc3RydWN0b3IgPT09IEMpIHJldHVybiB4O1xuICB2YXIgcHJvbWlzZUNhcGFiaWxpdHkgPSBuZXdQcm9taXNlQ2FwYWJpbGl0eS5mKEMpO1xuICB2YXIgcmVzb2x2ZSA9IHByb21pc2VDYXBhYmlsaXR5LnJlc29sdmU7XG4gIHJlc29sdmUoeCk7XG4gIHJldHVybiBwcm9taXNlQ2FwYWJpbGl0eS5wcm9taXNlO1xufTtcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///115\n")},function(module,exports,__webpack_require__){"use strict";eval("\nvar dP = __webpack_require__(10).f;\nvar create = __webpack_require__(34);\nvar redefineAll = __webpack_require__(44);\nvar ctx = __webpack_require__(18);\nvar anInstance = __webpack_require__(43);\nvar forOf = __webpack_require__(57);\nvar $iterDefine = __webpack_require__(73);\nvar step = __webpack_require__(110);\nvar setSpecies = __webpack_require__(42);\nvar DESCRIPTORS = __webpack_require__(9);\nvar fastKey = __webpack_require__(28).fastKey;\nvar validate = __webpack_require__(38);\nvar SIZE = DESCRIPTORS ? '_s' : 'size';\n\nvar getEntry = function (that, key) {\n  // fast case\n  var index = fastKey(key);\n  var entry;\n  if (index !== 'F') return that._i[index];\n  // frozen object case\n  for (entry = that._f; entry; entry = entry.n) {\n    if (entry.k == key) return entry;\n  }\n};\n\nmodule.exports = {\n  getConstructor: function (wrapper, NAME, IS_MAP, ADDER) {\n    var C = wrapper(function (that, iterable) {\n      anInstance(that, C, NAME, '_i');\n      that._t = NAME;         // collection type\n      that._i = create(null); // index\n      that._f = undefined;    // first entry\n      that._l = undefined;    // last entry\n      that[SIZE] = 0;         // size\n      if (iterable != undefined) forOf(iterable, IS_MAP, that[ADDER], that);\n    });\n    redefineAll(C.prototype, {\n      // 23.1.3.1 Map.prototype.clear()\n      // 23.2.3.2 Set.prototype.clear()\n      clear: function clear() {\n        for (var that = validate(this, NAME), data = that._i, entry = that._f; entry; entry = entry.n) {\n          entry.r = true;\n          if (entry.p) entry.p = entry.p.n = undefined;\n          delete data[entry.i];\n        }\n        that._f = that._l = undefined;\n        that[SIZE] = 0;\n      },\n      // 23.1.3.3 Map.prototype.delete(key)\n      // 23.2.3.4 Set.prototype.delete(value)\n      'delete': function (key) {\n        var that = validate(this, NAME);\n        var entry = getEntry(that, key);\n        if (entry) {\n          var next = entry.n;\n          var prev = entry.p;\n          delete that._i[entry.i];\n          entry.r = true;\n          if (prev) prev.n = next;\n          if (next) next.p = prev;\n          if (that._f == entry) that._f = next;\n          if (that._l == entry) that._l = prev;\n          that[SIZE]--;\n        } return !!entry;\n      },\n      // 23.2.3.6 Set.prototype.forEach(callbackfn, thisArg = undefined)\n      // 23.1.3.5 Map.prototype.forEach(callbackfn, thisArg = undefined)\n      forEach: function forEach(callbackfn /* , that = undefined */) {\n        validate(this, NAME);\n        var f = ctx(callbackfn, arguments.length > 1 ? arguments[1] : undefined, 3);\n        var entry;\n        while (entry = entry ? entry.n : this._f) {\n          f(entry.v, entry.k, this);\n          // revert to the last existing entry\n          while (entry && entry.r) entry = entry.p;\n        }\n      },\n      // 23.1.3.7 Map.prototype.has(key)\n      // 23.2.3.7 Set.prototype.has(value)\n      has: function has(key) {\n        return !!getEntry(validate(this, NAME), key);\n      }\n    });\n    if (DESCRIPTORS) dP(C.prototype, 'size', {\n      get: function () {\n        return validate(this, NAME)[SIZE];\n      }\n    });\n    return C;\n  },\n  def: function (that, key, value) {\n    var entry = getEntry(that, key);\n    var prev, index;\n    // change existing entry\n    if (entry) {\n      entry.v = value;\n    // create new entry\n    } else {\n      that._l = entry = {\n        i: index = fastKey(key, true), // <- index\n        k: key,                        // <- key\n        v: value,                      // <- value\n        p: prev = that._l,             // <- previous entry\n        n: undefined,                  // <- next entry\n        r: false                       // <- removed\n      };\n      if (!that._f) that._f = entry;\n      if (prev) prev.n = entry;\n      that[SIZE]++;\n      // add to index\n      if (index !== 'F') that._i[index] = entry;\n    } return that;\n  },\n  getEntry: getEntry,\n  setStrong: function (C, NAME, IS_MAP) {\n    // add .keys, .values, .entries, [@@iterator]\n    // 23.1.3.4, 23.1.3.8, 23.1.3.11, 23.1.3.12, 23.2.3.5, 23.2.3.8, 23.2.3.10, 23.2.3.11\n    $iterDefine(C, NAME, function (iterated, kind) {\n      this._t = validate(iterated, NAME); // target\n      this._k = kind;                     // kind\n      this._l = undefined;                // previous\n    }, function () {\n      var that = this;\n      var kind = that._k;\n      var entry = that._l;\n      // revert to the last existing entry\n      while (entry && entry.r) entry = entry.p;\n      // get next entry\n      if (!that._t || !(that._l = entry = entry ? entry.n : that._t._f)) {\n        // or finish the iteration\n        that._t = undefined;\n        return step(1);\n      }\n      // return step by kind\n      if (kind == 'keys') return step(0, entry.k);\n      if (kind == 'values') return step(0, entry.v);\n      return step(0, [entry.k, entry.v]);\n    }, IS_MAP ? 'entries' : 'values', !IS_MAP, true);\n\n    // add [@@species], 23.1.2.2, 23.2.2.2\n    setSpecies(NAME);\n  }\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTE2LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9fY29sbGVjdGlvbi1zdHJvbmcuanM/YzI2YiJdLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XG52YXIgZFAgPSByZXF1aXJlKCcuL19vYmplY3QtZHAnKS5mO1xudmFyIGNyZWF0ZSA9IHJlcXVpcmUoJy4vX29iamVjdC1jcmVhdGUnKTtcbnZhciByZWRlZmluZUFsbCA9IHJlcXVpcmUoJy4vX3JlZGVmaW5lLWFsbCcpO1xudmFyIGN0eCA9IHJlcXVpcmUoJy4vX2N0eCcpO1xudmFyIGFuSW5zdGFuY2UgPSByZXF1aXJlKCcuL19hbi1pbnN0YW5jZScpO1xudmFyIGZvck9mID0gcmVxdWlyZSgnLi9fZm9yLW9mJyk7XG52YXIgJGl0ZXJEZWZpbmUgPSByZXF1aXJlKCcuL19pdGVyLWRlZmluZScpO1xudmFyIHN0ZXAgPSByZXF1aXJlKCcuL19pdGVyLXN0ZXAnKTtcbnZhciBzZXRTcGVjaWVzID0gcmVxdWlyZSgnLi9fc2V0LXNwZWNpZXMnKTtcbnZhciBERVNDUklQVE9SUyA9IHJlcXVpcmUoJy4vX2Rlc2NyaXB0b3JzJyk7XG52YXIgZmFzdEtleSA9IHJlcXVpcmUoJy4vX21ldGEnKS5mYXN0S2V5O1xudmFyIHZhbGlkYXRlID0gcmVxdWlyZSgnLi9fdmFsaWRhdGUtY29sbGVjdGlvbicpO1xudmFyIFNJWkUgPSBERVNDUklQVE9SUyA/ICdfcycgOiAnc2l6ZSc7XG5cbnZhciBnZXRFbnRyeSA9IGZ1bmN0aW9uICh0aGF0LCBrZXkpIHtcbiAgLy8gZmFzdCBjYXNlXG4gIHZhciBpbmRleCA9IGZhc3RLZXkoa2V5KTtcbiAgdmFyIGVudHJ5O1xuICBpZiAoaW5kZXggIT09ICdGJykgcmV0dXJuIHRoYXQuX2lbaW5kZXhdO1xuICAvLyBmcm96ZW4gb2JqZWN0IGNhc2VcbiAgZm9yIChlbnRyeSA9IHRoYXQuX2Y7IGVudHJ5OyBlbnRyeSA9IGVudHJ5Lm4pIHtcbiAgICBpZiAoZW50cnkuayA9PSBrZXkpIHJldHVybiBlbnRyeTtcbiAgfVxufTtcblxubW9kdWxlLmV4cG9ydHMgPSB7XG4gIGdldENvbnN0cnVjdG9yOiBmdW5jdGlvbiAod3JhcHBlciwgTkFNRSwgSVNfTUFQLCBBRERFUikge1xuICAgIHZhciBDID0gd3JhcHBlcihmdW5jdGlvbiAodGhhdCwgaXRlcmFibGUpIHtcbiAgICAgIGFuSW5zdGFuY2UodGhhdCwgQywgTkFNRSwgJ19pJyk7XG4gICAgICB0aGF0Ll90ID0gTkFNRTsgICAgICAgICAvLyBjb2xsZWN0aW9uIHR5cGVcbiAgICAgIHRoYXQuX2kgPSBjcmVhdGUobnVsbCk7IC8vIGluZGV4XG4gICAgICB0aGF0Ll9mID0gdW5kZWZpbmVkOyAgICAvLyBmaXJzdCBlbnRyeVxuICAgICAgdGhhdC5fbCA9IHVuZGVmaW5lZDsgICAgLy8gbGFzdCBlbnRyeVxuICAgICAgdGhhdFtTSVpFXSA9IDA7ICAgICAgICAgLy8gc2l6ZVxuICAgICAgaWYgKGl0ZXJhYmxlICE9IHVuZGVmaW5lZCkgZm9yT2YoaXRlcmFibGUsIElTX01BUCwgdGhhdFtBRERFUl0sIHRoYXQpO1xuICAgIH0pO1xuICAgIHJlZGVmaW5lQWxsKEMucHJvdG90eXBlLCB7XG4gICAgICAvLyAyMy4xLjMuMSBNYXAucHJvdG90eXBlLmNsZWFyKClcbiAgICAgIC8vIDIzLjIuMy4yIFNldC5wcm90b3R5cGUuY2xlYXIoKVxuICAgICAgY2xlYXI6IGZ1bmN0aW9uIGNsZWFyKCkge1xuICAgICAgICBmb3IgKHZhciB0aGF0ID0gdmFsaWRhdGUodGhpcywgTkFNRSksIGRhdGEgPSB0aGF0Ll9pLCBlbnRyeSA9IHRoYXQuX2Y7IGVudHJ5OyBlbnRyeSA9IGVudHJ5Lm4pIHtcbiAgICAgICAgICBlbnRyeS5yID0gdHJ1ZTtcbiAgICAgICAgICBpZiAoZW50cnkucCkgZW50cnkucCA9IGVudHJ5LnAubiA9IHVuZGVmaW5lZDtcbiAgICAgICAgICBkZWxldGUgZGF0YVtlbnRyeS5pXTtcbiAgICAgICAgfVxuICAgICAgICB0aGF0Ll9mID0gdGhhdC5fbCA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhhdFtTSVpFXSA9IDA7XG4gICAgICB9LFxuICAgICAgLy8gMjMuMS4zLjMgTWFwLnByb3RvdHlwZS5kZWxldGUoa2V5KVxuICAgICAgLy8gMjMuMi4zLjQgU2V0LnByb3RvdHlwZS5kZWxldGUodmFsdWUpXG4gICAgICAnZGVsZXRlJzogZnVuY3Rpb24gKGtleSkge1xuICAgICAgICB2YXIgdGhhdCA9IHZhbGlkYXRlKHRoaXMsIE5BTUUpO1xuICAgICAgICB2YXIgZW50cnkgPSBnZXRFbnRyeSh0aGF0LCBrZXkpO1xuICAgICAgICBpZiAoZW50cnkpIHtcbiAgICAgICAgICB2YXIgbmV4dCA9IGVudHJ5Lm47XG4gICAgICAgICAgdmFyIHByZXYgPSBlbnRyeS5wO1xuICAgICAgICAgIGRlbGV0ZSB0aGF0Ll9pW2VudHJ5LmldO1xuICAgICAgICAgIGVudHJ5LnIgPSB0cnVlO1xuICAgICAgICAgIGlmIChwcmV2KSBwcmV2Lm4gPSBuZXh0O1xuICAgICAgICAgIGlmIChuZXh0KSBuZXh0LnAgPSBwcmV2O1xuICAgICAgICAgIGlmICh0aGF0Ll9mID09IGVudHJ5KSB0aGF0Ll9mID0gbmV4dDtcbiAgICAgICAgICBpZiAodGhhdC5fbCA9PSBlbnRyeSkgdGhhdC5fbCA9IHByZXY7XG4gICAgICAgICAgdGhhdFtTSVpFXS0tO1xuICAgICAgICB9IHJldHVybiAhIWVudHJ5O1xuICAgICAgfSxcbiAgICAgIC8vIDIzLjIuMy42IFNldC5wcm90b3R5cGUuZm9yRWFjaChjYWxsYmFja2ZuLCB0aGlzQXJnID0gdW5kZWZpbmVkKVxuICAgICAgLy8gMjMuMS4zLjUgTWFwLnByb3RvdHlwZS5mb3JFYWNoKGNhbGxiYWNrZm4sIHRoaXNBcmcgPSB1bmRlZmluZWQpXG4gICAgICBmb3JFYWNoOiBmdW5jdGlvbiBmb3JFYWNoKGNhbGxiYWNrZm4gLyogLCB0aGF0ID0gdW5kZWZpbmVkICovKSB7XG4gICAgICAgIHZhbGlkYXRlKHRoaXMsIE5BTUUpO1xuICAgICAgICB2YXIgZiA9IGN0eChjYWxsYmFja2ZuLCBhcmd1bWVudHMubGVuZ3RoID4gMSA/IGFyZ3VtZW50c1sxXSA6IHVuZGVmaW5lZCwgMyk7XG4gICAgICAgIHZhciBlbnRyeTtcbiAgICAgICAgd2hpbGUgKGVudHJ5ID0gZW50cnkgPyBlbnRyeS5uIDogdGhpcy5fZikge1xuICAgICAgICAgIGYoZW50cnkudiwgZW50cnkuaywgdGhpcyk7XG4gICAgICAgICAgLy8gcmV2ZXJ0IHRvIHRoZSBsYXN0IGV4aXN0aW5nIGVudHJ5XG4gICAgICAgICAgd2hpbGUgKGVudHJ5ICYmIGVudHJ5LnIpIGVudHJ5ID0gZW50cnkucDtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIC8vIDIzLjEuMy43IE1hcC5wcm90b3R5cGUuaGFzKGtleSlcbiAgICAgIC8vIDIzLjIuMy43IFNldC5wcm90b3R5cGUuaGFzKHZhbHVlKVxuICAgICAgaGFzOiBmdW5jdGlvbiBoYXMoa2V5KSB7XG4gICAgICAgIHJldHVybiAhIWdldEVudHJ5KHZhbGlkYXRlKHRoaXMsIE5BTUUpLCBrZXkpO1xuICAgICAgfVxuICAgIH0pO1xuICAgIGlmIChERVNDUklQVE9SUykgZFAoQy5wcm90b3R5cGUsICdzaXplJywge1xuICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB2YWxpZGF0ZSh0aGlzLCBOQU1FKVtTSVpFXTtcbiAgICAgIH1cbiAgICB9KTtcbiAgICByZXR1cm4gQztcbiAgfSxcbiAgZGVmOiBmdW5jdGlvbiAodGhhdCwga2V5LCB2YWx1ZSkge1xuICAgIHZhciBlbnRyeSA9IGdldEVudHJ5KHRoYXQsIGtleSk7XG4gICAgdmFyIHByZXYsIGluZGV4O1xuICAgIC8vIGNoYW5nZSBleGlzdGluZyBlbnRyeVxuICAgIGlmIChlbnRyeSkge1xuICAgICAgZW50cnkudiA9IHZhbHVlO1xuICAgIC8vIGNyZWF0ZSBuZXcgZW50cnlcbiAgICB9IGVsc2Uge1xuICAgICAgdGhhdC5fbCA9IGVudHJ5ID0ge1xuICAgICAgICBpOiBpbmRleCA9IGZhc3RLZXkoa2V5LCB0cnVlKSwgLy8gPC0gaW5kZXhcbiAgICAgICAgazoga2V5LCAgICAgICAgICAgICAgICAgICAgICAgIC8vIDwtIGtleVxuICAgICAgICB2OiB2YWx1ZSwgICAgICAgICAgICAgICAgICAgICAgLy8gPC0gdmFsdWVcbiAgICAgICAgcDogcHJldiA9IHRoYXQuX2wsICAgICAgICAgICAgIC8vIDwtIHByZXZpb3VzIGVudHJ5XG4gICAgICAgIG46IHVuZGVmaW5lZCwgICAgICAgICAgICAgICAgICAvLyA8LSBuZXh0IGVudHJ5XG4gICAgICAgIHI6IGZhbHNlICAgICAgICAgICAgICAgICAgICAgICAvLyA8LSByZW1vdmVkXG4gICAgICB9O1xuICAgICAgaWYgKCF0aGF0Ll9mKSB0aGF0Ll9mID0gZW50cnk7XG4gICAgICBpZiAocHJldikgcHJldi5uID0gZW50cnk7XG4gICAgICB0aGF0W1NJWkVdKys7XG4gICAgICAvLyBhZGQgdG8gaW5kZXhcbiAgICAgIGlmIChpbmRleCAhPT0gJ0YnKSB0aGF0Ll9pW2luZGV4XSA9IGVudHJ5O1xuICAgIH0gcmV0dXJuIHRoYXQ7XG4gIH0sXG4gIGdldEVudHJ5OiBnZXRFbnRyeSxcbiAgc2V0U3Ryb25nOiBmdW5jdGlvbiAoQywgTkFNRSwgSVNfTUFQKSB7XG4gICAgLy8gYWRkIC5rZXlzLCAudmFsdWVzLCAuZW50cmllcywgW0BAaXRlcmF0b3JdXG4gICAgLy8gMjMuMS4zLjQsIDIzLjEuMy44LCAyMy4xLjMuMTEsIDIzLjEuMy4xMiwgMjMuMi4zLjUsIDIzLjIuMy44LCAyMy4yLjMuMTAsIDIzLjIuMy4xMVxuICAgICRpdGVyRGVmaW5lKEMsIE5BTUUsIGZ1bmN0aW9uIChpdGVyYXRlZCwga2luZCkge1xuICAgICAgdGhpcy5fdCA9IHZhbGlkYXRlKGl0ZXJhdGVkLCBOQU1FKTsgLy8gdGFyZ2V0XG4gICAgICB0aGlzLl9rID0ga2luZDsgICAgICAgICAgICAgICAgICAgICAvLyBraW5kXG4gICAgICB0aGlzLl9sID0gdW5kZWZpbmVkOyAgICAgICAgICAgICAgICAvLyBwcmV2aW91c1xuICAgIH0sIGZ1bmN0aW9uICgpIHtcbiAgICAgIHZhciB0aGF0ID0gdGhpcztcbiAgICAgIHZhciBraW5kID0gdGhhdC5faztcbiAgICAgIHZhciBlbnRyeSA9IHRoYXQuX2w7XG4gICAgICAvLyByZXZlcnQgdG8gdGhlIGxhc3QgZXhpc3RpbmcgZW50cnlcbiAgICAgIHdoaWxlIChlbnRyeSAmJiBlbnRyeS5yKSBlbnRyeSA9IGVudHJ5LnA7XG4gICAgICAvLyBnZXQgbmV4dCBlbnRyeVxuICAgICAgaWYgKCF0aGF0Ll90IHx8ICEodGhhdC5fbCA9IGVudHJ5ID0gZW50cnkgPyBlbnRyeS5uIDogdGhhdC5fdC5fZikpIHtcbiAgICAgICAgLy8gb3IgZmluaXNoIHRoZSBpdGVyYXRpb25cbiAgICAgICAgdGhhdC5fdCA9IHVuZGVmaW5lZDtcbiAgICAgICAgcmV0dXJuIHN0ZXAoMSk7XG4gICAgICB9XG4gICAgICAvLyByZXR1cm4gc3RlcCBieSBraW5kXG4gICAgICBpZiAoa2luZCA9PSAna2V5cycpIHJldHVybiBzdGVwKDAsIGVudHJ5LmspO1xuICAgICAgaWYgKGtpbmQgPT0gJ3ZhbHVlcycpIHJldHVybiBzdGVwKDAsIGVudHJ5LnYpO1xuICAgICAgcmV0dXJuIHN0ZXAoMCwgW2VudHJ5LmssIGVudHJ5LnZdKTtcbiAgICB9LCBJU19NQVAgPyAnZW50cmllcycgOiAndmFsdWVzJywgIUlTX01BUCwgdHJ1ZSk7XG5cbiAgICAvLyBhZGQgW0BAc3BlY2llc10sIDIzLjEuMi4yLCAyMy4yLjIuMlxuICAgIHNldFNwZWNpZXMoTkFNRSk7XG4gIH1cbn07XG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///116\n")},function(module,exports,__webpack_require__){"use strict";eval("\nvar redefineAll = __webpack_require__(44);\nvar getWeak = __webpack_require__(28).getWeak;\nvar anObject = __webpack_require__(4);\nvar isObject = __webpack_require__(5);\nvar anInstance = __webpack_require__(43);\nvar forOf = __webpack_require__(57);\nvar createArrayMethod = __webpack_require__(23);\nvar $has = __webpack_require__(14);\nvar validate = __webpack_require__(38);\nvar arrayFind = createArrayMethod(5);\nvar arrayFindIndex = createArrayMethod(6);\nvar id = 0;\n\n// fallback for uncaught frozen keys\nvar uncaughtFrozenStore = function (that) {\n  return that._l || (that._l = new UncaughtFrozenStore());\n};\nvar UncaughtFrozenStore = function () {\n  this.a = [];\n};\nvar findUncaughtFrozen = function (store, key) {\n  return arrayFind(store.a, function (it) {\n    return it[0] === key;\n  });\n};\nUncaughtFrozenStore.prototype = {\n  get: function (key) {\n    var entry = findUncaughtFrozen(this, key);\n    if (entry) return entry[1];\n  },\n  has: function (key) {\n    return !!findUncaughtFrozen(this, key);\n  },\n  set: function (key, value) {\n    var entry = findUncaughtFrozen(this, key);\n    if (entry) entry[1] = value;\n    else this.a.push([key, value]);\n  },\n  'delete': function (key) {\n    var index = arrayFindIndex(this.a, function (it) {\n      return it[0] === key;\n    });\n    if (~index) this.a.splice(index, 1);\n    return !!~index;\n  }\n};\n\nmodule.exports = {\n  getConstructor: function (wrapper, NAME, IS_MAP, ADDER) {\n    var C = wrapper(function (that, iterable) {\n      anInstance(that, C, NAME, '_i');\n      that._t = NAME;      // collection type\n      that._i = id++;      // collection id\n      that._l = undefined; // leak store for uncaught frozen objects\n      if (iterable != undefined) forOf(iterable, IS_MAP, that[ADDER], that);\n    });\n    redefineAll(C.prototype, {\n      // 23.3.3.2 WeakMap.prototype.delete(key)\n      // 23.4.3.3 WeakSet.prototype.delete(value)\n      'delete': function (key) {\n        if (!isObject(key)) return false;\n        var data = getWeak(key);\n        if (data === true) return uncaughtFrozenStore(validate(this, NAME))['delete'](key);\n        return data && $has(data, this._i) && delete data[this._i];\n      },\n      // 23.3.3.4 WeakMap.prototype.has(key)\n      // 23.4.3.4 WeakSet.prototype.has(value)\n      has: function has(key) {\n        if (!isObject(key)) return false;\n        var data = getWeak(key);\n        if (data === true) return uncaughtFrozenStore(validate(this, NAME)).has(key);\n        return data && $has(data, this._i);\n      }\n    });\n    return C;\n  },\n  def: function (that, key, value) {\n    var data = getWeak(anObject(key), true);\n    if (data === true) uncaughtFrozenStore(that).set(key, value);\n    else data[that._i] = value;\n    return that;\n  },\n  ufstore: uncaughtFrozenStore\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTE3LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9fY29sbGVjdGlvbi13ZWFrLmpzPzY0M2UiXSwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xudmFyIHJlZGVmaW5lQWxsID0gcmVxdWlyZSgnLi9fcmVkZWZpbmUtYWxsJyk7XG52YXIgZ2V0V2VhayA9IHJlcXVpcmUoJy4vX21ldGEnKS5nZXRXZWFrO1xudmFyIGFuT2JqZWN0ID0gcmVxdWlyZSgnLi9fYW4tb2JqZWN0Jyk7XG52YXIgaXNPYmplY3QgPSByZXF1aXJlKCcuL19pcy1vYmplY3QnKTtcbnZhciBhbkluc3RhbmNlID0gcmVxdWlyZSgnLi9fYW4taW5zdGFuY2UnKTtcbnZhciBmb3JPZiA9IHJlcXVpcmUoJy4vX2Zvci1vZicpO1xudmFyIGNyZWF0ZUFycmF5TWV0aG9kID0gcmVxdWlyZSgnLi9fYXJyYXktbWV0aG9kcycpO1xudmFyICRoYXMgPSByZXF1aXJlKCcuL19oYXMnKTtcbnZhciB2YWxpZGF0ZSA9IHJlcXVpcmUoJy4vX3ZhbGlkYXRlLWNvbGxlY3Rpb24nKTtcbnZhciBhcnJheUZpbmQgPSBjcmVhdGVBcnJheU1ldGhvZCg1KTtcbnZhciBhcnJheUZpbmRJbmRleCA9IGNyZWF0ZUFycmF5TWV0aG9kKDYpO1xudmFyIGlkID0gMDtcblxuLy8gZmFsbGJhY2sgZm9yIHVuY2F1Z2h0IGZyb3plbiBrZXlzXG52YXIgdW5jYXVnaHRGcm96ZW5TdG9yZSA9IGZ1bmN0aW9uICh0aGF0KSB7XG4gIHJldHVybiB0aGF0Ll9sIHx8ICh0aGF0Ll9sID0gbmV3IFVuY2F1Z2h0RnJvemVuU3RvcmUoKSk7XG59O1xudmFyIFVuY2F1Z2h0RnJvemVuU3RvcmUgPSBmdW5jdGlvbiAoKSB7XG4gIHRoaXMuYSA9IFtdO1xufTtcbnZhciBmaW5kVW5jYXVnaHRGcm96ZW4gPSBmdW5jdGlvbiAoc3RvcmUsIGtleSkge1xuICByZXR1cm4gYXJyYXlGaW5kKHN0b3JlLmEsIGZ1bmN0aW9uIChpdCkge1xuICAgIHJldHVybiBpdFswXSA9PT0ga2V5O1xuICB9KTtcbn07XG5VbmNhdWdodEZyb3plblN0b3JlLnByb3RvdHlwZSA9IHtcbiAgZ2V0OiBmdW5jdGlvbiAoa2V5KSB7XG4gICAgdmFyIGVudHJ5ID0gZmluZFVuY2F1Z2h0RnJvemVuKHRoaXMsIGtleSk7XG4gICAgaWYgKGVudHJ5KSByZXR1cm4gZW50cnlbMV07XG4gIH0sXG4gIGhhczogZnVuY3Rpb24gKGtleSkge1xuICAgIHJldHVybiAhIWZpbmRVbmNhdWdodEZyb3plbih0aGlzLCBrZXkpO1xuICB9LFxuICBzZXQ6IGZ1bmN0aW9uIChrZXksIHZhbHVlKSB7XG4gICAgdmFyIGVudHJ5ID0gZmluZFVuY2F1Z2h0RnJvemVuKHRoaXMsIGtleSk7XG4gICAgaWYgKGVudHJ5KSBlbnRyeVsxXSA9IHZhbHVlO1xuICAgIGVsc2UgdGhpcy5hLnB1c2goW2tleSwgdmFsdWVdKTtcbiAgfSxcbiAgJ2RlbGV0ZSc6IGZ1bmN0aW9uIChrZXkpIHtcbiAgICB2YXIgaW5kZXggPSBhcnJheUZpbmRJbmRleCh0aGlzLmEsIGZ1bmN0aW9uIChpdCkge1xuICAgICAgcmV0dXJuIGl0WzBdID09PSBrZXk7XG4gICAgfSk7XG4gICAgaWYgKH5pbmRleCkgdGhpcy5hLnNwbGljZShpbmRleCwgMSk7XG4gICAgcmV0dXJuICEhfmluZGV4O1xuICB9XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IHtcbiAgZ2V0Q29uc3RydWN0b3I6IGZ1bmN0aW9uICh3cmFwcGVyLCBOQU1FLCBJU19NQVAsIEFEREVSKSB7XG4gICAgdmFyIEMgPSB3cmFwcGVyKGZ1bmN0aW9uICh0aGF0LCBpdGVyYWJsZSkge1xuICAgICAgYW5JbnN0YW5jZSh0aGF0LCBDLCBOQU1FLCAnX2knKTtcbiAgICAgIHRoYXQuX3QgPSBOQU1FOyAgICAgIC8vIGNvbGxlY3Rpb24gdHlwZVxuICAgICAgdGhhdC5faSA9IGlkKys7ICAgICAgLy8gY29sbGVjdGlvbiBpZFxuICAgICAgdGhhdC5fbCA9IHVuZGVmaW5lZDsgLy8gbGVhayBzdG9yZSBmb3IgdW5jYXVnaHQgZnJvemVuIG9iamVjdHNcbiAgICAgIGlmIChpdGVyYWJsZSAhPSB1bmRlZmluZWQpIGZvck9mKGl0ZXJhYmxlLCBJU19NQVAsIHRoYXRbQURERVJdLCB0aGF0KTtcbiAgICB9KTtcbiAgICByZWRlZmluZUFsbChDLnByb3RvdHlwZSwge1xuICAgICAgLy8gMjMuMy4zLjIgV2Vha01hcC5wcm90b3R5cGUuZGVsZXRlKGtleSlcbiAgICAgIC8vIDIzLjQuMy4zIFdlYWtTZXQucHJvdG90eXBlLmRlbGV0ZSh2YWx1ZSlcbiAgICAgICdkZWxldGUnOiBmdW5jdGlvbiAoa2V5KSB7XG4gICAgICAgIGlmICghaXNPYmplY3Qoa2V5KSkgcmV0dXJuIGZhbHNlO1xuICAgICAgICB2YXIgZGF0YSA9IGdldFdlYWsoa2V5KTtcbiAgICAgICAgaWYgKGRhdGEgPT09IHRydWUpIHJldHVybiB1bmNhdWdodEZyb3plblN0b3JlKHZhbGlkYXRlKHRoaXMsIE5BTUUpKVsnZGVsZXRlJ10oa2V5KTtcbiAgICAgICAgcmV0dXJuIGRhdGEgJiYgJGhhcyhkYXRhLCB0aGlzLl9pKSAmJiBkZWxldGUgZGF0YVt0aGlzLl9pXTtcbiAgICAgIH0sXG4gICAgICAvLyAyMy4zLjMuNCBXZWFrTWFwLnByb3RvdHlwZS5oYXMoa2V5KVxuICAgICAgLy8gMjMuNC4zLjQgV2Vha1NldC5wcm90b3R5cGUuaGFzKHZhbHVlKVxuICAgICAgaGFzOiBmdW5jdGlvbiBoYXMoa2V5KSB7XG4gICAgICAgIGlmICghaXNPYmplY3Qoa2V5KSkgcmV0dXJuIGZhbHNlO1xuICAgICAgICB2YXIgZGF0YSA9IGdldFdlYWsoa2V5KTtcbiAgICAgICAgaWYgKGRhdGEgPT09IHRydWUpIHJldHVybiB1bmNhdWdodEZyb3plblN0b3JlKHZhbGlkYXRlKHRoaXMsIE5BTUUpKS5oYXMoa2V5KTtcbiAgICAgICAgcmV0dXJuIGRhdGEgJiYgJGhhcyhkYXRhLCB0aGlzLl9pKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgICByZXR1cm4gQztcbiAgfSxcbiAgZGVmOiBmdW5jdGlvbiAodGhhdCwga2V5LCB2YWx1ZSkge1xuICAgIHZhciBkYXRhID0gZ2V0V2Vhayhhbk9iamVjdChrZXkpLCB0cnVlKTtcbiAgICBpZiAoZGF0YSA9PT0gdHJ1ZSkgdW5jYXVnaHRGcm96ZW5TdG9yZSh0aGF0KS5zZXQoa2V5LCB2YWx1ZSk7XG4gICAgZWxzZSBkYXRhW3RoYXQuX2ldID0gdmFsdWU7XG4gICAgcmV0dXJuIHRoYXQ7XG4gIH0sXG4gIHVmc3RvcmU6IHVuY2F1Z2h0RnJvemVuU3RvcmVcbn07XG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///117\n")},function(module,exports,__webpack_require__){eval("// https://tc39.github.io/ecma262/#sec-toindex\nvar toInteger = __webpack_require__(20);\nvar toLength = __webpack_require__(7);\nmodule.exports = function (it) {\n  if (it === undefined) return 0;\n  var number = toInteger(it);\n  var length = toLength(number);\n  if (number !== length) throw RangeError('Wrong length!');\n  return length;\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTE4LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9fdG8taW5kZXguanM/MDlmYSJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBodHRwczovL3RjMzkuZ2l0aHViLmlvL2VjbWEyNjIvI3NlYy10b2luZGV4XG52YXIgdG9JbnRlZ2VyID0gcmVxdWlyZSgnLi9fdG8taW50ZWdlcicpO1xudmFyIHRvTGVuZ3RoID0gcmVxdWlyZSgnLi9fdG8tbGVuZ3RoJyk7XG5tb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChpdCkge1xuICBpZiAoaXQgPT09IHVuZGVmaW5lZCkgcmV0dXJuIDA7XG4gIHZhciBudW1iZXIgPSB0b0ludGVnZXIoaXQpO1xuICB2YXIgbGVuZ3RoID0gdG9MZW5ndGgobnVtYmVyKTtcbiAgaWYgKG51bWJlciAhPT0gbGVuZ3RoKSB0aHJvdyBSYW5nZUVycm9yKCdXcm9uZyBsZW5ndGghJyk7XG4gIHJldHVybiBsZW5ndGg7XG59O1xuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///118\n")},function(module,exports,__webpack_require__){eval("// all object keys, includes non-enumerable and symbols\nvar gOPN = __webpack_require__(35);\nvar gOPS = __webpack_require__(51);\nvar anObject = __webpack_require__(4);\nvar Reflect = __webpack_require__(2).Reflect;\nmodule.exports = Reflect && Reflect.ownKeys || function ownKeys(it) {\n  var keys = gOPN.f(anObject(it));\n  var getSymbols = gOPS.f;\n  return getSymbols ? keys.concat(getSymbols(it)) : keys;\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTE5LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9fb3duLWtleXMuanM/OTkwYiJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBhbGwgb2JqZWN0IGtleXMsIGluY2x1ZGVzIG5vbi1lbnVtZXJhYmxlIGFuZCBzeW1ib2xzXG52YXIgZ09QTiA9IHJlcXVpcmUoJy4vX29iamVjdC1nb3BuJyk7XG52YXIgZ09QUyA9IHJlcXVpcmUoJy4vX29iamVjdC1nb3BzJyk7XG52YXIgYW5PYmplY3QgPSByZXF1aXJlKCcuL19hbi1vYmplY3QnKTtcbnZhciBSZWZsZWN0ID0gcmVxdWlyZSgnLi9fZ2xvYmFsJykuUmVmbGVjdDtcbm1vZHVsZS5leHBvcnRzID0gUmVmbGVjdCAmJiBSZWZsZWN0Lm93bktleXMgfHwgZnVuY3Rpb24gb3duS2V5cyhpdCkge1xuICB2YXIga2V5cyA9IGdPUE4uZihhbk9iamVjdChpdCkpO1xuICB2YXIgZ2V0U3ltYm9scyA9IGdPUFMuZjtcbiAgcmV0dXJuIGdldFN5bWJvbHMgPyBrZXlzLmNvbmNhdChnZXRTeW1ib2xzKGl0KSkgOiBrZXlzO1xufTtcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Iiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///119\n")},function(module,exports,__webpack_require__){eval("// https://github.com/tc39/proposal-string-pad-start-end\nvar toLength = __webpack_require__(7);\nvar repeat = __webpack_require__(69);\nvar defined = __webpack_require__(25);\n\nmodule.exports = function (that, maxLength, fillString, left) {\n  var S = String(defined(that));\n  var stringLength = S.length;\n  var fillStr = fillString === undefined ? ' ' : String(fillString);\n  var intMaxLength = toLength(maxLength);\n  if (intMaxLength <= stringLength || fillStr == '') return S;\n  var fillLen = intMaxLength - stringLength;\n  var stringFiller = repeat.call(fillStr, Math.ceil(fillLen / fillStr.length));\n  if (stringFiller.length > fillLen) stringFiller = stringFiller.slice(0, fillLen);\n  return left ? stringFiller + S : S + stringFiller;\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTIwLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9fc3RyaW5nLXBhZC5qcz8yZTA4Il0sInNvdXJjZXNDb250ZW50IjpbIi8vIGh0dHBzOi8vZ2l0aHViLmNvbS90YzM5L3Byb3Bvc2FsLXN0cmluZy1wYWQtc3RhcnQtZW5kXG52YXIgdG9MZW5ndGggPSByZXF1aXJlKCcuL190by1sZW5ndGgnKTtcbnZhciByZXBlYXQgPSByZXF1aXJlKCcuL19zdHJpbmctcmVwZWF0Jyk7XG52YXIgZGVmaW5lZCA9IHJlcXVpcmUoJy4vX2RlZmluZWQnKTtcblxubW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAodGhhdCwgbWF4TGVuZ3RoLCBmaWxsU3RyaW5nLCBsZWZ0KSB7XG4gIHZhciBTID0gU3RyaW5nKGRlZmluZWQodGhhdCkpO1xuICB2YXIgc3RyaW5nTGVuZ3RoID0gUy5sZW5ndGg7XG4gIHZhciBmaWxsU3RyID0gZmlsbFN0cmluZyA9PT0gdW5kZWZpbmVkID8gJyAnIDogU3RyaW5nKGZpbGxTdHJpbmcpO1xuICB2YXIgaW50TWF4TGVuZ3RoID0gdG9MZW5ndGgobWF4TGVuZ3RoKTtcbiAgaWYgKGludE1heExlbmd0aCA8PSBzdHJpbmdMZW5ndGggfHwgZmlsbFN0ciA9PSAnJykgcmV0dXJuIFM7XG4gIHZhciBmaWxsTGVuID0gaW50TWF4TGVuZ3RoIC0gc3RyaW5nTGVuZ3RoO1xuICB2YXIgc3RyaW5nRmlsbGVyID0gcmVwZWF0LmNhbGwoZmlsbFN0ciwgTWF0aC5jZWlsKGZpbGxMZW4gLyBmaWxsU3RyLmxlbmd0aCkpO1xuICBpZiAoc3RyaW5nRmlsbGVyLmxlbmd0aCA+IGZpbGxMZW4pIHN0cmluZ0ZpbGxlciA9IHN0cmluZ0ZpbGxlci5zbGljZSgwLCBmaWxsTGVuKTtcbiAgcmV0dXJuIGxlZnQgPyBzdHJpbmdGaWxsZXIgKyBTIDogUyArIHN0cmluZ0ZpbGxlcjtcbn07XG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///120\n")},function(module,exports,__webpack_require__){eval("var DESCRIPTORS = __webpack_require__(9);\nvar getKeys = __webpack_require__(32);\nvar toIObject = __webpack_require__(16);\nvar isEnum = __webpack_require__(46).f;\nmodule.exports = function (isEntries) {\n  return function (it) {\n    var O = toIObject(it);\n    var keys = getKeys(O);\n    var length = keys.length;\n    var i = 0;\n    var result = [];\n    var key;\n    while (length > i) {\n      key = keys[i++];\n      if (!DESCRIPTORS || isEnum.call(O, key)) {\n        result.push(isEntries ? [key, O[key]] : O[key]);\n      }\n    }\n    return result;\n  };\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTIxLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9fb2JqZWN0LXRvLWFycmF5LmpzPzUwNGMiXSwic291cmNlc0NvbnRlbnQiOlsidmFyIERFU0NSSVBUT1JTID0gcmVxdWlyZSgnLi9fZGVzY3JpcHRvcnMnKTtcbnZhciBnZXRLZXlzID0gcmVxdWlyZSgnLi9fb2JqZWN0LWtleXMnKTtcbnZhciB0b0lPYmplY3QgPSByZXF1aXJlKCcuL190by1pb2JqZWN0Jyk7XG52YXIgaXNFbnVtID0gcmVxdWlyZSgnLi9fb2JqZWN0LXBpZScpLmY7XG5tb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChpc0VudHJpZXMpIHtcbiAgcmV0dXJuIGZ1bmN0aW9uIChpdCkge1xuICAgIHZhciBPID0gdG9JT2JqZWN0KGl0KTtcbiAgICB2YXIga2V5cyA9IGdldEtleXMoTyk7XG4gICAgdmFyIGxlbmd0aCA9IGtleXMubGVuZ3RoO1xuICAgIHZhciBpID0gMDtcbiAgICB2YXIgcmVzdWx0ID0gW107XG4gICAgdmFyIGtleTtcbiAgICB3aGlsZSAobGVuZ3RoID4gaSkge1xuICAgICAga2V5ID0ga2V5c1tpKytdO1xuICAgICAgaWYgKCFERVNDUklQVE9SUyB8fCBpc0VudW0uY2FsbChPLCBrZXkpKSB7XG4gICAgICAgIHJlc3VsdC5wdXNoKGlzRW50cmllcyA/IFtrZXksIE9ba2V5XV0gOiBPW2tleV0pO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gcmVzdWx0O1xuICB9O1xufTtcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///121\n")},function(module,exports){eval("var core = module.exports = { version: '2.6.8' };\nif (typeof __e == 'number') __e = core; // eslint-disable-line no-undef\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTIyLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbGlicmFyeS9tb2R1bGVzL19jb3JlLmpzPzU4NGEiXSwic291cmNlc0NvbnRlbnQiOlsidmFyIGNvcmUgPSBtb2R1bGUuZXhwb3J0cyA9IHsgdmVyc2lvbjogJzIuNi44JyB9O1xuaWYgKHR5cGVvZiBfX2UgPT0gJ251bWJlcicpIF9fZSA9IGNvcmU7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgbm8tdW5kZWZcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///122\n")},function(module,exports){eval("module.exports = function (exec) {\n  try {\n    return !!exec();\n  } catch (e) {\n    return true;\n  }\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTIzLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbGlicmFyeS9tb2R1bGVzL19mYWlscy5qcz8yOTRjIl0sInNvdXJjZXNDb250ZW50IjpbIm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKGV4ZWMpIHtcbiAgdHJ5IHtcbiAgICByZXR1cm4gISFleGVjKCk7XG4gIH0gY2F0Y2ggKGUpIHtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxufTtcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Iiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///123\n")},function(c,e,n){n(125),c.exports=n(311)},function(module,exports,__webpack_require__){"use strict";eval('\n\n__webpack_require__(126);\n\nvar _global = _interopRequireDefault(__webpack_require__(298));\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nif (_global.default._babelPolyfill && typeof console !== "undefined" && console.warn) {\n  console.warn("@babel/polyfill is loaded more than once on this page. This is probably not desirable/intended " + "and may have consequences if different versions of the polyfills are applied sequentially. " + "If you do need to load the polyfill more than once, use @babel/polyfill/noConflict " + "instead to bypass the warning.");\n}\n\n_global.default._babelPolyfill = true;//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTI1LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL0BiYWJlbC9wb2x5ZmlsbC9saWIvaW5kZXguanM/ZTc5MiJdLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcblxucmVxdWlyZShcIi4vbm9Db25mbGljdFwiKTtcblxudmFyIF9nbG9iYWwgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmUoXCJjb3JlLWpzL2xpYnJhcnkvZm4vZ2xvYmFsXCIpKTtcblxuZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChvYmopIHsgcmV0dXJuIG9iaiAmJiBvYmouX19lc01vZHVsZSA/IG9iaiA6IHsgZGVmYXVsdDogb2JqIH07IH1cblxuaWYgKF9nbG9iYWwuZGVmYXVsdC5fYmFiZWxQb2x5ZmlsbCAmJiB0eXBlb2YgY29uc29sZSAhPT0gXCJ1bmRlZmluZWRcIiAmJiBjb25zb2xlLndhcm4pIHtcbiAgY29uc29sZS53YXJuKFwiQGJhYmVsL3BvbHlmaWxsIGlzIGxvYWRlZCBtb3JlIHRoYW4gb25jZSBvbiB0aGlzIHBhZ2UuIFRoaXMgaXMgcHJvYmFibHkgbm90IGRlc2lyYWJsZS9pbnRlbmRlZCBcIiArIFwiYW5kIG1heSBoYXZlIGNvbnNlcXVlbmNlcyBpZiBkaWZmZXJlbnQgdmVyc2lvbnMgb2YgdGhlIHBvbHlmaWxscyBhcmUgYXBwbGllZCBzZXF1ZW50aWFsbHkuIFwiICsgXCJJZiB5b3UgZG8gbmVlZCB0byBsb2FkIHRoZSBwb2x5ZmlsbCBtb3JlIHRoYW4gb25jZSwgdXNlIEBiYWJlbC9wb2x5ZmlsbC9ub0NvbmZsaWN0IFwiICsgXCJpbnN0ZWFkIHRvIGJ5cGFzcyB0aGUgd2FybmluZy5cIik7XG59XG5cbl9nbG9iYWwuZGVmYXVsdC5fYmFiZWxQb2x5ZmlsbCA9IHRydWU7Il0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///125\n')},function(module,exports,__webpack_require__){"use strict";eval("\n\n__webpack_require__(127);\n\n__webpack_require__(270);\n\n__webpack_require__(272);\n\n__webpack_require__(275);\n\n__webpack_require__(277);\n\n__webpack_require__(279);\n\n__webpack_require__(281);\n\n__webpack_require__(283);\n\n__webpack_require__(285);\n\n__webpack_require__(287);\n\n__webpack_require__(289);\n\n__webpack_require__(291);\n\n__webpack_require__(293);\n\n__webpack_require__(297);//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTI2LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL0BiYWJlbC9wb2x5ZmlsbC9saWIvbm9Db25mbGljdC5qcz84MzY2Il0sInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuXG5yZXF1aXJlKFwiY29yZS1qcy9lczZcIik7XG5cbnJlcXVpcmUoXCJjb3JlLWpzL2ZuL2FycmF5L2luY2x1ZGVzXCIpO1xuXG5yZXF1aXJlKFwiY29yZS1qcy9mbi9hcnJheS9mbGF0LW1hcFwiKTtcblxucmVxdWlyZShcImNvcmUtanMvZm4vc3RyaW5nL3BhZC1zdGFydFwiKTtcblxucmVxdWlyZShcImNvcmUtanMvZm4vc3RyaW5nL3BhZC1lbmRcIik7XG5cbnJlcXVpcmUoXCJjb3JlLWpzL2ZuL3N0cmluZy90cmltLXN0YXJ0XCIpO1xuXG5yZXF1aXJlKFwiY29yZS1qcy9mbi9zdHJpbmcvdHJpbS1lbmRcIik7XG5cbnJlcXVpcmUoXCJjb3JlLWpzL2ZuL3N5bWJvbC9hc3luYy1pdGVyYXRvclwiKTtcblxucmVxdWlyZShcImNvcmUtanMvZm4vb2JqZWN0L2dldC1vd24tcHJvcGVydHktZGVzY3JpcHRvcnNcIik7XG5cbnJlcXVpcmUoXCJjb3JlLWpzL2ZuL29iamVjdC92YWx1ZXNcIik7XG5cbnJlcXVpcmUoXCJjb3JlLWpzL2ZuL29iamVjdC9lbnRyaWVzXCIpO1xuXG5yZXF1aXJlKFwiY29yZS1qcy9mbi9wcm9taXNlL2ZpbmFsbHlcIik7XG5cbnJlcXVpcmUoXCJjb3JlLWpzL3dlYlwiKTtcblxucmVxdWlyZShcInJlZ2VuZXJhdG9yLXJ1bnRpbWUvcnVudGltZVwiKTsiXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///126\n")},function(module,exports,__webpack_require__){eval("__webpack_require__(128);\n__webpack_require__(131);\n__webpack_require__(132);\n__webpack_require__(133);\n__webpack_require__(134);\n__webpack_require__(135);\n__webpack_require__(136);\n__webpack_require__(137);\n__webpack_require__(138);\n__webpack_require__(139);\n__webpack_require__(140);\n__webpack_require__(141);\n__webpack_require__(142);\n__webpack_require__(143);\n__webpack_require__(144);\n__webpack_require__(145);\n__webpack_require__(146);\n__webpack_require__(147);\n__webpack_require__(148);\n__webpack_require__(149);\n__webpack_require__(150);\n__webpack_require__(151);\n__webpack_require__(152);\n__webpack_require__(153);\n__webpack_require__(154);\n__webpack_require__(155);\n__webpack_require__(156);\n__webpack_require__(157);\n__webpack_require__(158);\n__webpack_require__(159);\n__webpack_require__(160);\n__webpack_require__(161);\n__webpack_require__(162);\n__webpack_require__(163);\n__webpack_require__(164);\n__webpack_require__(165);\n__webpack_require__(166);\n__webpack_require__(167);\n__webpack_require__(168);\n__webpack_require__(169);\n__webpack_require__(170);\n__webpack_require__(171);\n__webpack_require__(172);\n__webpack_require__(174);\n__webpack_require__(175);\n__webpack_require__(176);\n__webpack_require__(177);\n__webpack_require__(178);\n__webpack_require__(179);\n__webpack_require__(180);\n__webpack_require__(181);\n__webpack_require__(182);\n__webpack_require__(183);\n__webpack_require__(184);\n__webpack_require__(185);\n__webpack_require__(186);\n__webpack_require__(187);\n__webpack_require__(188);\n__webpack_require__(189);\n__webpack_require__(190);\n__webpack_require__(191);\n__webpack_require__(192);\n__webpack_require__(193);\n__webpack_require__(194);\n__webpack_require__(195);\n__webpack_require__(196);\n__webpack_require__(197);\n__webpack_require__(198);\n__webpack_require__(199);\n__webpack_require__(200);\n__webpack_require__(201);\n__webpack_require__(202);\n__webpack_require__(203);\n__webpack_require__(204);\n__webpack_require__(205);\n__webpack_require__(206);\n__webpack_require__(207);\n__webpack_require__(209);\n__webpack_require__(210);\n__webpack_require__(212);\n__webpack_require__(213);\n__webpack_require__(214);\n__webpack_require__(215);\n__webpack_require__(216);\n__webpack_require__(217);\n__webpack_require__(218);\n__webpack_require__(220);\n__webpack_require__(221);\n__webpack_require__(222);\n__webpack_require__(223);\n__webpack_require__(224);\n__webpack_require__(225);\n__webpack_require__(226);\n__webpack_require__(227);\n__webpack_require__(228);\n__webpack_require__(229);\n__webpack_require__(230);\n__webpack_require__(231);\n__webpack_require__(232);\n__webpack_require__(81);\n__webpack_require__(233);\n__webpack_require__(111);\n__webpack_require__(234);\n__webpack_require__(112);\n__webpack_require__(235);\n__webpack_require__(236);\n__webpack_require__(237);\n__webpack_require__(238);\n__webpack_require__(113);\n__webpack_require__(241);\n__webpack_require__(242);\n__webpack_require__(243);\n__webpack_require__(244);\n__webpack_require__(245);\n__webpack_require__(246);\n__webpack_require__(247);\n__webpack_require__(248);\n__webpack_require__(249);\n__webpack_require__(250);\n__webpack_require__(251);\n__webpack_require__(252);\n__webpack_require__(253);\n__webpack_require__(254);\n__webpack_require__(255);\n__webpack_require__(256);\n__webpack_require__(257);\n__webpack_require__(258);\n__webpack_require__(259);\n__webpack_require__(260);\n__webpack_require__(261);\n__webpack_require__(262);\n__webpack_require__(263);\n__webpack_require__(264);\n__webpack_require__(265);\n__webpack_require__(266);\n__webpack_require__(267);\n__webpack_require__(268);\n__webpack_require__(269);\nmodule.exports = __webpack_require__(8);\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTI3LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvZXM2L2luZGV4LmpzPzViZDciXSwic291cmNlc0NvbnRlbnQiOlsicmVxdWlyZSgnLi4vbW9kdWxlcy9lczYuc3ltYm9sJyk7XG5yZXF1aXJlKCcuLi9tb2R1bGVzL2VzNi5vYmplY3QuY3JlYXRlJyk7XG5yZXF1aXJlKCcuLi9tb2R1bGVzL2VzNi5vYmplY3QuZGVmaW5lLXByb3BlcnR5Jyk7XG5yZXF1aXJlKCcuLi9tb2R1bGVzL2VzNi5vYmplY3QuZGVmaW5lLXByb3BlcnRpZXMnKTtcbnJlcXVpcmUoJy4uL21vZHVsZXMvZXM2Lm9iamVjdC5nZXQtb3duLXByb3BlcnR5LWRlc2NyaXB0b3InKTtcbnJlcXVpcmUoJy4uL21vZHVsZXMvZXM2Lm9iamVjdC5nZXQtcHJvdG90eXBlLW9mJyk7XG5yZXF1aXJlKCcuLi9tb2R1bGVzL2VzNi5vYmplY3Qua2V5cycpO1xucmVxdWlyZSgnLi4vbW9kdWxlcy9lczYub2JqZWN0LmdldC1vd24tcHJvcGVydHktbmFtZXMnKTtcbnJlcXVpcmUoJy4uL21vZHVsZXMvZXM2Lm9iamVjdC5mcmVlemUnKTtcbnJlcXVpcmUoJy4uL21vZHVsZXMvZXM2Lm9iamVjdC5zZWFsJyk7XG5yZXF1aXJlKCcuLi9tb2R1bGVzL2VzNi5vYmplY3QucHJldmVudC1leHRlbnNpb25zJyk7XG5yZXF1aXJlKCcuLi9tb2R1bGVzL2VzNi5vYmplY3QuaXMtZnJvemVuJyk7XG5yZXF1aXJlKCcuLi9tb2R1bGVzL2VzNi5vYmplY3QuaXMtc2VhbGVkJyk7XG5yZXF1aXJlKCcuLi9tb2R1bGVzL2VzNi5vYmplY3QuaXMtZXh0ZW5zaWJsZScpO1xucmVxdWlyZSgnLi4vbW9kdWxlcy9lczYub2JqZWN0LmFzc2lnbicpO1xucmVxdWlyZSgnLi4vbW9kdWxlcy9lczYub2JqZWN0LmlzJyk7XG5yZXF1aXJlKCcuLi9tb2R1bGVzL2VzNi5vYmplY3Quc2V0LXByb3RvdHlwZS1vZicpO1xucmVxdWlyZSgnLi4vbW9kdWxlcy9lczYub2JqZWN0LnRvLXN0cmluZycpO1xucmVxdWlyZSgnLi4vbW9kdWxlcy9lczYuZnVuY3Rpb24uYmluZCcpO1xucmVxdWlyZSgnLi4vbW9kdWxlcy9lczYuZnVuY3Rpb24ubmFtZScpO1xucmVxdWlyZSgnLi4vbW9kdWxlcy9lczYuZnVuY3Rpb24uaGFzLWluc3RhbmNlJyk7XG5yZXF1aXJlKCcuLi9tb2R1bGVzL2VzNi5wYXJzZS1pbnQnKTtcbnJlcXVpcmUoJy4uL21vZHVsZXMvZXM2LnBhcnNlLWZsb2F0Jyk7XG5yZXF1aXJlKCcuLi9tb2R1bGVzL2VzNi5udW1iZXIuY29uc3RydWN0b3InKTtcbnJlcXVpcmUoJy4uL21vZHVsZXMvZXM2Lm51bWJlci50by1maXhlZCcpO1xucmVxdWlyZSgnLi4vbW9kdWxlcy9lczYubnVtYmVyLnRvLXByZWNpc2lvbicpO1xucmVxdWlyZSgnLi4vbW9kdWxlcy9lczYubnVtYmVyLmVwc2lsb24nKTtcbnJlcXVpcmUoJy4uL21vZHVsZXMvZXM2Lm51bWJlci5pcy1maW5pdGUnKTtcbnJlcXVpcmUoJy4uL21vZHVsZXMvZXM2Lm51bWJlci5pcy1pbnRlZ2VyJyk7XG5yZXF1aXJlKCcuLi9tb2R1bGVzL2VzNi5udW1iZXIuaXMtbmFuJyk7XG5yZXF1aXJlKCcuLi9tb2R1bGVzL2VzNi5udW1iZXIuaXMtc2FmZS1pbnRlZ2VyJyk7XG5yZXF1aXJlKCcuLi9tb2R1bGVzL2VzNi5udW1iZXIubWF4LXNhZmUtaW50ZWdlcicpO1xucmVxdWlyZSgnLi4vbW9kdWxlcy9lczYubnVtYmVyLm1pbi1zYWZlLWludGVnZXInKTtcbnJlcXVpcmUoJy4uL21vZHVsZXMvZXM2Lm51bWJlci5wYXJzZS1mbG9hdCcpO1xucmVxdWlyZSgnLi4vbW9kdWxlcy9lczYubnVtYmVyLnBhcnNlLWludCcpO1xucmVxdWlyZSgnLi4vbW9kdWxlcy9lczYubWF0aC5hY29zaCcpO1xucmVxdWlyZSgnLi4vbW9kdWxlcy9lczYubWF0aC5hc2luaCcpO1xucmVxdWlyZSgnLi4vbW9kdWxlcy9lczYubWF0aC5hdGFuaCcpO1xucmVxdWlyZSgnLi4vbW9kdWxlcy9lczYubWF0aC5jYnJ0Jyk7XG5yZXF1aXJlKCcuLi9tb2R1bGVzL2VzNi5tYXRoLmNsejMyJyk7XG5yZXF1aXJlKCcuLi9tb2R1bGVzL2VzNi5tYXRoLmNvc2gnKTtcbnJlcXVpcmUoJy4uL21vZHVsZXMvZXM2Lm1hdGguZXhwbTEnKTtcbnJlcXVpcmUoJy4uL21vZHVsZXMvZXM2Lm1hdGguZnJvdW5kJyk7XG5yZXF1aXJlKCcuLi9tb2R1bGVzL2VzNi5tYXRoLmh5cG90Jyk7XG5yZXF1aXJlKCcuLi9tb2R1bGVzL2VzNi5tYXRoLmltdWwnKTtcbnJlcXVpcmUoJy4uL21vZHVsZXMvZXM2Lm1hdGgubG9nMTAnKTtcbnJlcXVpcmUoJy4uL21vZHVsZXMvZXM2Lm1hdGgubG9nMXAnKTtcbnJlcXVpcmUoJy4uL21vZHVsZXMvZXM2Lm1hdGgubG9nMicpO1xucmVxdWlyZSgnLi4vbW9kdWxlcy9lczYubWF0aC5zaWduJyk7XG5yZXF1aXJlKCcuLi9tb2R1bGVzL2VzNi5tYXRoLnNpbmgnKTtcbnJlcXVpcmUoJy4uL21vZHVsZXMvZXM2Lm1hdGgudGFuaCcpO1xucmVxdWlyZSgnLi4vbW9kdWxlcy9lczYubWF0aC50cnVuYycpO1xucmVxdWlyZSgnLi4vbW9kdWxlcy9lczYuc3RyaW5nLmZyb20tY29kZS1wb2ludCcpO1xucmVxdWlyZSgnLi4vbW9kdWxlcy9lczYuc3RyaW5nLnJhdycpO1xucmVxdWlyZSgnLi4vbW9kdWxlcy9lczYuc3RyaW5nLnRyaW0nKTtcbnJlcXVpcmUoJy4uL21vZHVsZXMvZXM2LnN0cmluZy5pdGVyYXRvcicpO1xucmVxdWlyZSgnLi4vbW9kdWxlcy9lczYuc3RyaW5nLmNvZGUtcG9pbnQtYXQnKTtcbnJlcXVpcmUoJy4uL21vZHVsZXMvZXM2LnN0cmluZy5lbmRzLXdpdGgnKTtcbnJlcXVpcmUoJy4uL21vZHVsZXMvZXM2LnN0cmluZy5pbmNsdWRlcycpO1xucmVxdWlyZSgnLi4vbW9kdWxlcy9lczYuc3RyaW5nLnJlcGVhdCcpO1xucmVxdWlyZSgnLi4vbW9kdWxlcy9lczYuc3RyaW5nLnN0YXJ0cy13aXRoJyk7XG5yZXF1aXJlKCcuLi9tb2R1bGVzL2VzNi5zdHJpbmcuYW5jaG9yJyk7XG5yZXF1aXJlKCcuLi9tb2R1bGVzL2VzNi5zdHJpbmcuYmlnJyk7XG5yZXF1aXJlKCcuLi9tb2R1bGVzL2VzNi5zdHJpbmcuYmxpbmsnKTtcbnJlcXVpcmUoJy4uL21vZHVsZXMvZXM2LnN0cmluZy5ib2xkJyk7XG5yZXF1aXJlKCcuLi9tb2R1bGVzL2VzNi5zdHJpbmcuZml4ZWQnKTtcbnJlcXVpcmUoJy4uL21vZHVsZXMvZXM2LnN0cmluZy5mb250Y29sb3InKTtcbnJlcXVpcmUoJy4uL21vZHVsZXMvZXM2LnN0cmluZy5mb250c2l6ZScpO1xucmVxdWlyZSgnLi4vbW9kdWxlcy9lczYuc3RyaW5nLml0YWxpY3MnKTtcbnJlcXVpcmUoJy4uL21vZHVsZXMvZXM2LnN0cmluZy5saW5rJyk7XG5yZXF1aXJlKCcuLi9tb2R1bGVzL2VzNi5zdHJpbmcuc21hbGwnKTtcbnJlcXVpcmUoJy4uL21vZHVsZXMvZXM2LnN0cmluZy5zdHJpa2UnKTtcbnJlcXVpcmUoJy4uL21vZHVsZXMvZXM2LnN0cmluZy5zdWInKTtcbnJlcXVpcmUoJy4uL21vZHVsZXMvZXM2LnN0cmluZy5zdXAnKTtcbnJlcXVpcmUoJy4uL21vZHVsZXMvZXM2LmRhdGUubm93Jyk7XG5yZXF1aXJlKCcuLi9tb2R1bGVzL2VzNi5kYXRlLnRvLWpzb24nKTtcbnJlcXVpcmUoJy4uL21vZHVsZXMvZXM2LmRhdGUudG8taXNvLXN0cmluZycpO1xucmVxdWlyZSgnLi4vbW9kdWxlcy9lczYuZGF0ZS50by1zdHJpbmcnKTtcbnJlcXVpcmUoJy4uL21vZHVsZXMvZXM2LmRhdGUudG8tcHJpbWl0aXZlJyk7XG5yZXF1aXJlKCcuLi9tb2R1bGVzL2VzNi5hcnJheS5pcy1hcnJheScpO1xucmVxdWlyZSgnLi4vbW9kdWxlcy9lczYuYXJyYXkuZnJvbScpO1xucmVxdWlyZSgnLi4vbW9kdWxlcy9lczYuYXJyYXkub2YnKTtcbnJlcXVpcmUoJy4uL21vZHVsZXMvZXM2LmFycmF5LmpvaW4nKTtcbnJlcXVpcmUoJy4uL21vZHVsZXMvZXM2LmFycmF5LnNsaWNlJyk7XG5yZXF1aXJlKCcuLi9tb2R1bGVzL2VzNi5hcnJheS5zb3J0Jyk7XG5yZXF1aXJlKCcuLi9tb2R1bGVzL2VzNi5hcnJheS5mb3ItZWFjaCcpO1xucmVxdWlyZSgnLi4vbW9kdWxlcy9lczYuYXJyYXkubWFwJyk7XG5yZXF1aXJlKCcuLi9tb2R1bGVzL2VzNi5hcnJheS5maWx0ZXInKTtcbnJlcXVpcmUoJy4uL21vZHVsZXMvZXM2LmFycmF5LnNvbWUnKTtcbnJlcXVpcmUoJy4uL21vZHVsZXMvZXM2LmFycmF5LmV2ZXJ5Jyk7XG5yZXF1aXJlKCcuLi9tb2R1bGVzL2VzNi5hcnJheS5yZWR1Y2UnKTtcbnJlcXVpcmUoJy4uL21vZHVsZXMvZXM2LmFycmF5LnJlZHVjZS1yaWdodCcpO1xucmVxdWlyZSgnLi4vbW9kdWxlcy9lczYuYXJyYXkuaW5kZXgtb2YnKTtcbnJlcXVpcmUoJy4uL21vZHVsZXMvZXM2LmFycmF5Lmxhc3QtaW5kZXgtb2YnKTtcbnJlcXVpcmUoJy4uL21vZHVsZXMvZXM2LmFycmF5LmNvcHktd2l0aGluJyk7XG5yZXF1aXJlKCcuLi9tb2R1bGVzL2VzNi5hcnJheS5maWxsJyk7XG5yZXF1aXJlKCcuLi9tb2R1bGVzL2VzNi5hcnJheS5maW5kJyk7XG5yZXF1aXJlKCcuLi9tb2R1bGVzL2VzNi5hcnJheS5maW5kLWluZGV4Jyk7XG5yZXF1aXJlKCcuLi9tb2R1bGVzL2VzNi5hcnJheS5zcGVjaWVzJyk7XG5yZXF1aXJlKCcuLi9tb2R1bGVzL2VzNi5hcnJheS5pdGVyYXRvcicpO1xucmVxdWlyZSgnLi4vbW9kdWxlcy9lczYucmVnZXhwLmNvbnN0cnVjdG9yJyk7XG5yZXF1aXJlKCcuLi9tb2R1bGVzL2VzNi5yZWdleHAuZXhlYycpO1xucmVxdWlyZSgnLi4vbW9kdWxlcy9lczYucmVnZXhwLnRvLXN0cmluZycpO1xucmVxdWlyZSgnLi4vbW9kdWxlcy9lczYucmVnZXhwLmZsYWdzJyk7XG5yZXF1aXJlKCcuLi9tb2R1bGVzL2VzNi5yZWdleHAubWF0Y2gnKTtcbnJlcXVpcmUoJy4uL21vZHVsZXMvZXM2LnJlZ2V4cC5yZXBsYWNlJyk7XG5yZXF1aXJlKCcuLi9tb2R1bGVzL2VzNi5yZWdleHAuc2VhcmNoJyk7XG5yZXF1aXJlKCcuLi9tb2R1bGVzL2VzNi5yZWdleHAuc3BsaXQnKTtcbnJlcXVpcmUoJy4uL21vZHVsZXMvZXM2LnByb21pc2UnKTtcbnJlcXVpcmUoJy4uL21vZHVsZXMvZXM2Lm1hcCcpO1xucmVxdWlyZSgnLi4vbW9kdWxlcy9lczYuc2V0Jyk7XG5yZXF1aXJlKCcuLi9tb2R1bGVzL2VzNi53ZWFrLW1hcCcpO1xucmVxdWlyZSgnLi4vbW9kdWxlcy9lczYud2Vhay1zZXQnKTtcbnJlcXVpcmUoJy4uL21vZHVsZXMvZXM2LnR5cGVkLmFycmF5LWJ1ZmZlcicpO1xucmVxdWlyZSgnLi4vbW9kdWxlcy9lczYudHlwZWQuZGF0YS12aWV3Jyk7XG5yZXF1aXJlKCcuLi9tb2R1bGVzL2VzNi50eXBlZC5pbnQ4LWFycmF5Jyk7XG5yZXF1aXJlKCcuLi9tb2R1bGVzL2VzNi50eXBlZC51aW50OC1hcnJheScpO1xucmVxdWlyZSgnLi4vbW9kdWxlcy9lczYudHlwZWQudWludDgtY2xhbXBlZC1hcnJheScpO1xucmVxdWlyZSgnLi4vbW9kdWxlcy9lczYudHlwZWQuaW50MTYtYXJyYXknKTtcbnJlcXVpcmUoJy4uL21vZHVsZXMvZXM2LnR5cGVkLnVpbnQxNi1hcnJheScpO1xucmVxdWlyZSgnLi4vbW9kdWxlcy9lczYudHlwZWQuaW50MzItYXJyYXknKTtcbnJlcXVpcmUoJy4uL21vZHVsZXMvZXM2LnR5cGVkLnVpbnQzMi1hcnJheScpO1xucmVxdWlyZSgnLi4vbW9kdWxlcy9lczYudHlwZWQuZmxvYXQzMi1hcnJheScpO1xucmVxdWlyZSgnLi4vbW9kdWxlcy9lczYudHlwZWQuZmxvYXQ2NC1hcnJheScpO1xucmVxdWlyZSgnLi4vbW9kdWxlcy9lczYucmVmbGVjdC5hcHBseScpO1xucmVxdWlyZSgnLi4vbW9kdWxlcy9lczYucmVmbGVjdC5jb25zdHJ1Y3QnKTtcbnJlcXVpcmUoJy4uL21vZHVsZXMvZXM2LnJlZmxlY3QuZGVmaW5lLXByb3BlcnR5Jyk7XG5yZXF1aXJlKCcuLi9tb2R1bGVzL2VzNi5yZWZsZWN0LmRlbGV0ZS1wcm9wZXJ0eScpO1xucmVxdWlyZSgnLi4vbW9kdWxlcy9lczYucmVmbGVjdC5lbnVtZXJhdGUnKTtcbnJlcXVpcmUoJy4uL21vZHVsZXMvZXM2LnJlZmxlY3QuZ2V0Jyk7XG5yZXF1aXJlKCcuLi9tb2R1bGVzL2VzNi5yZWZsZWN0LmdldC1vd24tcHJvcGVydHktZGVzY3JpcHRvcicpO1xucmVxdWlyZSgnLi4vbW9kdWxlcy9lczYucmVmbGVjdC5nZXQtcHJvdG90eXBlLW9mJyk7XG5yZXF1aXJlKCcuLi9tb2R1bGVzL2VzNi5yZWZsZWN0LmhhcycpO1xucmVxdWlyZSgnLi4vbW9kdWxlcy9lczYucmVmbGVjdC5pcy1leHRlbnNpYmxlJyk7XG5yZXF1aXJlKCcuLi9tb2R1bGVzL2VzNi5yZWZsZWN0Lm93bi1rZXlzJyk7XG5yZXF1aXJlKCcuLi9tb2R1bGVzL2VzNi5yZWZsZWN0LnByZXZlbnQtZXh0ZW5zaW9ucycpO1xucmVxdWlyZSgnLi4vbW9kdWxlcy9lczYucmVmbGVjdC5zZXQnKTtcbnJlcXVpcmUoJy4uL21vZHVsZXMvZXM2LnJlZmxlY3Quc2V0LXByb3RvdHlwZS1vZicpO1xubW9kdWxlLmV4cG9ydHMgPSByZXF1aXJlKCcuLi9tb2R1bGVzL19jb3JlJyk7XG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///127\n")},function(module,exports,__webpack_require__){"use strict";eval("\n// ECMAScript 6 symbols shim\nvar global = __webpack_require__(2);\nvar has = __webpack_require__(14);\nvar DESCRIPTORS = __webpack_require__(9);\nvar $export = __webpack_require__(1);\nvar redefine = __webpack_require__(12);\nvar META = __webpack_require__(28).KEY;\nvar $fails = __webpack_require__(3);\nvar shared = __webpack_require__(49);\nvar setToStringTag = __webpack_require__(39);\nvar uid = __webpack_require__(30);\nvar wks = __webpack_require__(6);\nvar wksExt = __webpack_require__(62);\nvar wksDefine = __webpack_require__(92);\nvar enumKeys = __webpack_require__(130);\nvar isArray = __webpack_require__(52);\nvar anObject = __webpack_require__(4);\nvar isObject = __webpack_require__(5);\nvar toObject = __webpack_require__(11);\nvar toIObject = __webpack_require__(16);\nvar toPrimitive = __webpack_require__(27);\nvar createDesc = __webpack_require__(29);\nvar _create = __webpack_require__(34);\nvar gOPNExt = __webpack_require__(95);\nvar $GOPD = __webpack_require__(21);\nvar $GOPS = __webpack_require__(51);\nvar $DP = __webpack_require__(10);\nvar $keys = __webpack_require__(32);\nvar gOPD = $GOPD.f;\nvar dP = $DP.f;\nvar gOPN = gOPNExt.f;\nvar $Symbol = global.Symbol;\nvar $JSON = global.JSON;\nvar _stringify = $JSON && $JSON.stringify;\nvar PROTOTYPE = 'prototype';\nvar HIDDEN = wks('_hidden');\nvar TO_PRIMITIVE = wks('toPrimitive');\nvar isEnum = {}.propertyIsEnumerable;\nvar SymbolRegistry = shared('symbol-registry');\nvar AllSymbols = shared('symbols');\nvar OPSymbols = shared('op-symbols');\nvar ObjectProto = Object[PROTOTYPE];\nvar USE_NATIVE = typeof $Symbol == 'function' && !!$GOPS.f;\nvar QObject = global.QObject;\n// Don't use setters in Qt Script, https://github.com/zloirock/core-js/issues/173\nvar setter = !QObject || !QObject[PROTOTYPE] || !QObject[PROTOTYPE].findChild;\n\n// fallback for old Android, https://code.google.com/p/v8/issues/detail?id=687\nvar setSymbolDesc = DESCRIPTORS && $fails(function () {\n  return _create(dP({}, 'a', {\n    get: function () { return dP(this, 'a', { value: 7 }).a; }\n  })).a != 7;\n}) ? function (it, key, D) {\n  var protoDesc = gOPD(ObjectProto, key);\n  if (protoDesc) delete ObjectProto[key];\n  dP(it, key, D);\n  if (protoDesc && it !== ObjectProto) dP(ObjectProto, key, protoDesc);\n} : dP;\n\nvar wrap = function (tag) {\n  var sym = AllSymbols[tag] = _create($Symbol[PROTOTYPE]);\n  sym._k = tag;\n  return sym;\n};\n\nvar isSymbol = USE_NATIVE && typeof $Symbol.iterator == 'symbol' ? function (it) {\n  return typeof it == 'symbol';\n} : function (it) {\n  return it instanceof $Symbol;\n};\n\nvar $defineProperty = function defineProperty(it, key, D) {\n  if (it === ObjectProto) $defineProperty(OPSymbols, key, D);\n  anObject(it);\n  key = toPrimitive(key, true);\n  anObject(D);\n  if (has(AllSymbols, key)) {\n    if (!D.enumerable) {\n      if (!has(it, HIDDEN)) dP(it, HIDDEN, createDesc(1, {}));\n      it[HIDDEN][key] = true;\n    } else {\n      if (has(it, HIDDEN) && it[HIDDEN][key]) it[HIDDEN][key] = false;\n      D = _create(D, { enumerable: createDesc(0, false) });\n    } return setSymbolDesc(it, key, D);\n  } return dP(it, key, D);\n};\nvar $defineProperties = function defineProperties(it, P) {\n  anObject(it);\n  var keys = enumKeys(P = toIObject(P));\n  var i = 0;\n  var l = keys.length;\n  var key;\n  while (l > i) $defineProperty(it, key = keys[i++], P[key]);\n  return it;\n};\nvar $create = function create(it, P) {\n  return P === undefined ? _create(it) : $defineProperties(_create(it), P);\n};\nvar $propertyIsEnumerable = function propertyIsEnumerable(key) {\n  var E = isEnum.call(this, key = toPrimitive(key, true));\n  if (this === ObjectProto && has(AllSymbols, key) && !has(OPSymbols, key)) return false;\n  return E || !has(this, key) || !has(AllSymbols, key) || has(this, HIDDEN) && this[HIDDEN][key] ? E : true;\n};\nvar $getOwnPropertyDescriptor = function getOwnPropertyDescriptor(it, key) {\n  it = toIObject(it);\n  key = toPrimitive(key, true);\n  if (it === ObjectProto && has(AllSymbols, key) && !has(OPSymbols, key)) return;\n  var D = gOPD(it, key);\n  if (D && has(AllSymbols, key) && !(has(it, HIDDEN) && it[HIDDEN][key])) D.enumerable = true;\n  return D;\n};\nvar $getOwnPropertyNames = function getOwnPropertyNames(it) {\n  var names = gOPN(toIObject(it));\n  var result = [];\n  var i = 0;\n  var key;\n  while (names.length > i) {\n    if (!has(AllSymbols, key = names[i++]) && key != HIDDEN && key != META) result.push(key);\n  } return result;\n};\nvar $getOwnPropertySymbols = function getOwnPropertySymbols(it) {\n  var IS_OP = it === ObjectProto;\n  var names = gOPN(IS_OP ? OPSymbols : toIObject(it));\n  var result = [];\n  var i = 0;\n  var key;\n  while (names.length > i) {\n    if (has(AllSymbols, key = names[i++]) && (IS_OP ? has(ObjectProto, key) : true)) result.push(AllSymbols[key]);\n  } return result;\n};\n\n// 19.4.1.1 Symbol([description])\nif (!USE_NATIVE) {\n  $Symbol = function Symbol() {\n    if (this instanceof $Symbol) throw TypeError('Symbol is not a constructor!');\n    var tag = uid(arguments.length > 0 ? arguments[0] : undefined);\n    var $set = function (value) {\n      if (this === ObjectProto) $set.call(OPSymbols, value);\n      if (has(this, HIDDEN) && has(this[HIDDEN], tag)) this[HIDDEN][tag] = false;\n      setSymbolDesc(this, tag, createDesc(1, value));\n    };\n    if (DESCRIPTORS && setter) setSymbolDesc(ObjectProto, tag, { configurable: true, set: $set });\n    return wrap(tag);\n  };\n  redefine($Symbol[PROTOTYPE], 'toString', function toString() {\n    return this._k;\n  });\n\n  $GOPD.f = $getOwnPropertyDescriptor;\n  $DP.f = $defineProperty;\n  __webpack_require__(35).f = gOPNExt.f = $getOwnPropertyNames;\n  __webpack_require__(46).f = $propertyIsEnumerable;\n  $GOPS.f = $getOwnPropertySymbols;\n\n  if (DESCRIPTORS && !__webpack_require__(31)) {\n    redefine(ObjectProto, 'propertyIsEnumerable', $propertyIsEnumerable, true);\n  }\n\n  wksExt.f = function (name) {\n    return wrap(wks(name));\n  };\n}\n\n$export($export.G + $export.W + $export.F * !USE_NATIVE, { Symbol: $Symbol });\n\nfor (var es6Symbols = (\n  // 19.4.2.2, 19.4.2.3, 19.4.2.4, 19.4.2.6, 19.4.2.8, 19.4.2.9, 19.4.2.10, 19.4.2.11, 19.4.2.12, 19.4.2.13, 19.4.2.14\n  'hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables'\n).split(','), j = 0; es6Symbols.length > j;)wks(es6Symbols[j++]);\n\nfor (var wellKnownSymbols = $keys(wks.store), k = 0; wellKnownSymbols.length > k;) wksDefine(wellKnownSymbols[k++]);\n\n$export($export.S + $export.F * !USE_NATIVE, 'Symbol', {\n  // 19.4.2.1 Symbol.for(key)\n  'for': function (key) {\n    return has(SymbolRegistry, key += '')\n      ? SymbolRegistry[key]\n      : SymbolRegistry[key] = $Symbol(key);\n  },\n  // 19.4.2.5 Symbol.keyFor(sym)\n  keyFor: function keyFor(sym) {\n    if (!isSymbol(sym)) throw TypeError(sym + ' is not a symbol!');\n    for (var key in SymbolRegistry) if (SymbolRegistry[key] === sym) return key;\n  },\n  useSetter: function () { setter = true; },\n  useSimple: function () { setter = false; }\n});\n\n$export($export.S + $export.F * !USE_NATIVE, 'Object', {\n  // 19.1.2.2 Object.create(O [, Properties])\n  create: $create,\n  // 19.1.2.4 Object.defineProperty(O, P, Attributes)\n  defineProperty: $defineProperty,\n  // 19.1.2.3 Object.defineProperties(O, Properties)\n  defineProperties: $defineProperties,\n  // 19.1.2.6 Object.getOwnPropertyDescriptor(O, P)\n  getOwnPropertyDescriptor: $getOwnPropertyDescriptor,\n  // 19.1.2.7 Object.getOwnPropertyNames(O)\n  getOwnPropertyNames: $getOwnPropertyNames,\n  // 19.1.2.8 Object.getOwnPropertySymbols(O)\n  getOwnPropertySymbols: $getOwnPropertySymbols\n});\n\n// Chrome 38 and 39 `Object.getOwnPropertySymbols` fails on primitives\n// https://bugs.chromium.org/p/v8/issues/detail?id=3443\nvar FAILS_ON_PRIMITIVES = $fails(function () { $GOPS.f(1); });\n\n$export($export.S + $export.F * FAILS_ON_PRIMITIVES, 'Object', {\n  getOwnPropertySymbols: function getOwnPropertySymbols(it) {\n    return $GOPS.f(toObject(it));\n  }\n});\n\n// 24.3.2 JSON.stringify(value [, replacer [, space]])\n$JSON && $export($export.S + $export.F * (!USE_NATIVE || $fails(function () {\n  var S = $Symbol();\n  // MS Edge converts symbol values to JSON as {}\n  // WebKit converts symbol values to JSON as null\n  // V8 throws on boxed symbols\n  return _stringify([S]) != '[null]' || _stringify({ a: S }) != '{}' || _stringify(Object(S)) != '{}';\n})), 'JSON', {\n  stringify: function stringify(it) {\n    var args = [it];\n    var i = 1;\n    var replacer, $replacer;\n    while (arguments.length > i) args.push(arguments[i++]);\n    $replacer = replacer = args[1];\n    if (!isObject(replacer) && it === undefined || isSymbol(it)) return; // IE8 returns string on undefined\n    if (!isArray(replacer)) replacer = function (key, value) {\n      if (typeof $replacer == 'function') value = $replacer.call(this, key, value);\n      if (!isSymbol(value)) return value;\n    };\n    args[1] = replacer;\n    return _stringify.apply($JSON, args);\n  }\n});\n\n// 19.4.3.4 Symbol.prototype[@@toPrimitive](hint)\n$Symbol[PROTOTYPE][TO_PRIMITIVE] || __webpack_require__(15)($Symbol[PROTOTYPE], TO_PRIMITIVE, $Symbol[PROTOTYPE].valueOf);\n// 19.4.3.5 Symbol.prototype[@@toStringTag]\nsetToStringTag($Symbol, 'Symbol');\n// 20.2.1.9 Math[@@toStringTag]\nsetToStringTag(Math, 'Math', true);\n// 24.3.3 JSON[@@toStringTag]\nsetToStringTag(global.JSON, 'JSON', true);\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTI4LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9lczYuc3ltYm9sLmpzPzhhODEiXSwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuLy8gRUNNQVNjcmlwdCA2IHN5bWJvbHMgc2hpbVxudmFyIGdsb2JhbCA9IHJlcXVpcmUoJy4vX2dsb2JhbCcpO1xudmFyIGhhcyA9IHJlcXVpcmUoJy4vX2hhcycpO1xudmFyIERFU0NSSVBUT1JTID0gcmVxdWlyZSgnLi9fZGVzY3JpcHRvcnMnKTtcbnZhciAkZXhwb3J0ID0gcmVxdWlyZSgnLi9fZXhwb3J0Jyk7XG52YXIgcmVkZWZpbmUgPSByZXF1aXJlKCcuL19yZWRlZmluZScpO1xudmFyIE1FVEEgPSByZXF1aXJlKCcuL19tZXRhJykuS0VZO1xudmFyICRmYWlscyA9IHJlcXVpcmUoJy4vX2ZhaWxzJyk7XG52YXIgc2hhcmVkID0gcmVxdWlyZSgnLi9fc2hhcmVkJyk7XG52YXIgc2V0VG9TdHJpbmdUYWcgPSByZXF1aXJlKCcuL19zZXQtdG8tc3RyaW5nLXRhZycpO1xudmFyIHVpZCA9IHJlcXVpcmUoJy4vX3VpZCcpO1xudmFyIHdrcyA9IHJlcXVpcmUoJy4vX3drcycpO1xudmFyIHdrc0V4dCA9IHJlcXVpcmUoJy4vX3drcy1leHQnKTtcbnZhciB3a3NEZWZpbmUgPSByZXF1aXJlKCcuL193a3MtZGVmaW5lJyk7XG52YXIgZW51bUtleXMgPSByZXF1aXJlKCcuL19lbnVtLWtleXMnKTtcbnZhciBpc0FycmF5ID0gcmVxdWlyZSgnLi9faXMtYXJyYXknKTtcbnZhciBhbk9iamVjdCA9IHJlcXVpcmUoJy4vX2FuLW9iamVjdCcpO1xudmFyIGlzT2JqZWN0ID0gcmVxdWlyZSgnLi9faXMtb2JqZWN0Jyk7XG52YXIgdG9PYmplY3QgPSByZXF1aXJlKCcuL190by1vYmplY3QnKTtcbnZhciB0b0lPYmplY3QgPSByZXF1aXJlKCcuL190by1pb2JqZWN0Jyk7XG52YXIgdG9QcmltaXRpdmUgPSByZXF1aXJlKCcuL190by1wcmltaXRpdmUnKTtcbnZhciBjcmVhdGVEZXNjID0gcmVxdWlyZSgnLi9fcHJvcGVydHktZGVzYycpO1xudmFyIF9jcmVhdGUgPSByZXF1aXJlKCcuL19vYmplY3QtY3JlYXRlJyk7XG52YXIgZ09QTkV4dCA9IHJlcXVpcmUoJy4vX29iamVjdC1nb3BuLWV4dCcpO1xudmFyICRHT1BEID0gcmVxdWlyZSgnLi9fb2JqZWN0LWdvcGQnKTtcbnZhciAkR09QUyA9IHJlcXVpcmUoJy4vX29iamVjdC1nb3BzJyk7XG52YXIgJERQID0gcmVxdWlyZSgnLi9fb2JqZWN0LWRwJyk7XG52YXIgJGtleXMgPSByZXF1aXJlKCcuL19vYmplY3Qta2V5cycpO1xudmFyIGdPUEQgPSAkR09QRC5mO1xudmFyIGRQID0gJERQLmY7XG52YXIgZ09QTiA9IGdPUE5FeHQuZjtcbnZhciAkU3ltYm9sID0gZ2xvYmFsLlN5bWJvbDtcbnZhciAkSlNPTiA9IGdsb2JhbC5KU09OO1xudmFyIF9zdHJpbmdpZnkgPSAkSlNPTiAmJiAkSlNPTi5zdHJpbmdpZnk7XG52YXIgUFJPVE9UWVBFID0gJ3Byb3RvdHlwZSc7XG52YXIgSElEREVOID0gd2tzKCdfaGlkZGVuJyk7XG52YXIgVE9fUFJJTUlUSVZFID0gd2tzKCd0b1ByaW1pdGl2ZScpO1xudmFyIGlzRW51bSA9IHt9LnByb3BlcnR5SXNFbnVtZXJhYmxlO1xudmFyIFN5bWJvbFJlZ2lzdHJ5ID0gc2hhcmVkKCdzeW1ib2wtcmVnaXN0cnknKTtcbnZhciBBbGxTeW1ib2xzID0gc2hhcmVkKCdzeW1ib2xzJyk7XG52YXIgT1BTeW1ib2xzID0gc2hhcmVkKCdvcC1zeW1ib2xzJyk7XG52YXIgT2JqZWN0UHJvdG8gPSBPYmplY3RbUFJPVE9UWVBFXTtcbnZhciBVU0VfTkFUSVZFID0gdHlwZW9mICRTeW1ib2wgPT0gJ2Z1bmN0aW9uJyAmJiAhISRHT1BTLmY7XG52YXIgUU9iamVjdCA9IGdsb2JhbC5RT2JqZWN0O1xuLy8gRG9uJ3QgdXNlIHNldHRlcnMgaW4gUXQgU2NyaXB0LCBodHRwczovL2dpdGh1Yi5jb20vemxvaXJvY2svY29yZS1qcy9pc3N1ZXMvMTczXG52YXIgc2V0dGVyID0gIVFPYmplY3QgfHwgIVFPYmplY3RbUFJPVE9UWVBFXSB8fCAhUU9iamVjdFtQUk9UT1RZUEVdLmZpbmRDaGlsZDtcblxuLy8gZmFsbGJhY2sgZm9yIG9sZCBBbmRyb2lkLCBodHRwczovL2NvZGUuZ29vZ2xlLmNvbS9wL3Y4L2lzc3Vlcy9kZXRhaWw/aWQ9Njg3XG52YXIgc2V0U3ltYm9sRGVzYyA9IERFU0NSSVBUT1JTICYmICRmYWlscyhmdW5jdGlvbiAoKSB7XG4gIHJldHVybiBfY3JlYXRlKGRQKHt9LCAnYScsIHtcbiAgICBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIGRQKHRoaXMsICdhJywgeyB2YWx1ZTogNyB9KS5hOyB9XG4gIH0pKS5hICE9IDc7XG59KSA/IGZ1bmN0aW9uIChpdCwga2V5LCBEKSB7XG4gIHZhciBwcm90b0Rlc2MgPSBnT1BEKE9iamVjdFByb3RvLCBrZXkpO1xuICBpZiAocHJvdG9EZXNjKSBkZWxldGUgT2JqZWN0UHJvdG9ba2V5XTtcbiAgZFAoaXQsIGtleSwgRCk7XG4gIGlmIChwcm90b0Rlc2MgJiYgaXQgIT09IE9iamVjdFByb3RvKSBkUChPYmplY3RQcm90bywga2V5LCBwcm90b0Rlc2MpO1xufSA6IGRQO1xuXG52YXIgd3JhcCA9IGZ1bmN0aW9uICh0YWcpIHtcbiAgdmFyIHN5bSA9IEFsbFN5bWJvbHNbdGFnXSA9IF9jcmVhdGUoJFN5bWJvbFtQUk9UT1RZUEVdKTtcbiAgc3ltLl9rID0gdGFnO1xuICByZXR1cm4gc3ltO1xufTtcblxudmFyIGlzU3ltYm9sID0gVVNFX05BVElWRSAmJiB0eXBlb2YgJFN5bWJvbC5pdGVyYXRvciA9PSAnc3ltYm9sJyA/IGZ1bmN0aW9uIChpdCkge1xuICByZXR1cm4gdHlwZW9mIGl0ID09ICdzeW1ib2wnO1xufSA6IGZ1bmN0aW9uIChpdCkge1xuICByZXR1cm4gaXQgaW5zdGFuY2VvZiAkU3ltYm9sO1xufTtcblxudmFyICRkZWZpbmVQcm9wZXJ0eSA9IGZ1bmN0aW9uIGRlZmluZVByb3BlcnR5KGl0LCBrZXksIEQpIHtcbiAgaWYgKGl0ID09PSBPYmplY3RQcm90bykgJGRlZmluZVByb3BlcnR5KE9QU3ltYm9scywga2V5LCBEKTtcbiAgYW5PYmplY3QoaXQpO1xuICBrZXkgPSB0b1ByaW1pdGl2ZShrZXksIHRydWUpO1xuICBhbk9iamVjdChEKTtcbiAgaWYgKGhhcyhBbGxTeW1ib2xzLCBrZXkpKSB7XG4gICAgaWYgKCFELmVudW1lcmFibGUpIHtcbiAgICAgIGlmICghaGFzKGl0LCBISURERU4pKSBkUChpdCwgSElEREVOLCBjcmVhdGVEZXNjKDEsIHt9KSk7XG4gICAgICBpdFtISURERU5dW2tleV0gPSB0cnVlO1xuICAgIH0gZWxzZSB7XG4gICAgICBpZiAoaGFzKGl0LCBISURERU4pICYmIGl0W0hJRERFTl1ba2V5XSkgaXRbSElEREVOXVtrZXldID0gZmFsc2U7XG4gICAgICBEID0gX2NyZWF0ZShELCB7IGVudW1lcmFibGU6IGNyZWF0ZURlc2MoMCwgZmFsc2UpIH0pO1xuICAgIH0gcmV0dXJuIHNldFN5bWJvbERlc2MoaXQsIGtleSwgRCk7XG4gIH0gcmV0dXJuIGRQKGl0LCBrZXksIEQpO1xufTtcbnZhciAkZGVmaW5lUHJvcGVydGllcyA9IGZ1bmN0aW9uIGRlZmluZVByb3BlcnRpZXMoaXQsIFApIHtcbiAgYW5PYmplY3QoaXQpO1xuICB2YXIga2V5cyA9IGVudW1LZXlzKFAgPSB0b0lPYmplY3QoUCkpO1xuICB2YXIgaSA9IDA7XG4gIHZhciBsID0ga2V5cy5sZW5ndGg7XG4gIHZhciBrZXk7XG4gIHdoaWxlIChsID4gaSkgJGRlZmluZVByb3BlcnR5KGl0LCBrZXkgPSBrZXlzW2krK10sIFBba2V5XSk7XG4gIHJldHVybiBpdDtcbn07XG52YXIgJGNyZWF0ZSA9IGZ1bmN0aW9uIGNyZWF0ZShpdCwgUCkge1xuICByZXR1cm4gUCA9PT0gdW5kZWZpbmVkID8gX2NyZWF0ZShpdCkgOiAkZGVmaW5lUHJvcGVydGllcyhfY3JlYXRlKGl0KSwgUCk7XG59O1xudmFyICRwcm9wZXJ0eUlzRW51bWVyYWJsZSA9IGZ1bmN0aW9uIHByb3BlcnR5SXNFbnVtZXJhYmxlKGtleSkge1xuICB2YXIgRSA9IGlzRW51bS5jYWxsKHRoaXMsIGtleSA9IHRvUHJpbWl0aXZlKGtleSwgdHJ1ZSkpO1xuICBpZiAodGhpcyA9PT0gT2JqZWN0UHJvdG8gJiYgaGFzKEFsbFN5bWJvbHMsIGtleSkgJiYgIWhhcyhPUFN5bWJvbHMsIGtleSkpIHJldHVybiBmYWxzZTtcbiAgcmV0dXJuIEUgfHwgIWhhcyh0aGlzLCBrZXkpIHx8ICFoYXMoQWxsU3ltYm9scywga2V5KSB8fCBoYXModGhpcywgSElEREVOKSAmJiB0aGlzW0hJRERFTl1ba2V5XSA/IEUgOiB0cnVlO1xufTtcbnZhciAkZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yID0gZnVuY3Rpb24gZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKGl0LCBrZXkpIHtcbiAgaXQgPSB0b0lPYmplY3QoaXQpO1xuICBrZXkgPSB0b1ByaW1pdGl2ZShrZXksIHRydWUpO1xuICBpZiAoaXQgPT09IE9iamVjdFByb3RvICYmIGhhcyhBbGxTeW1ib2xzLCBrZXkpICYmICFoYXMoT1BTeW1ib2xzLCBrZXkpKSByZXR1cm47XG4gIHZhciBEID0gZ09QRChpdCwga2V5KTtcbiAgaWYgKEQgJiYgaGFzKEFsbFN5bWJvbHMsIGtleSkgJiYgIShoYXMoaXQsIEhJRERFTikgJiYgaXRbSElEREVOXVtrZXldKSkgRC5lbnVtZXJhYmxlID0gdHJ1ZTtcbiAgcmV0dXJuIEQ7XG59O1xudmFyICRnZXRPd25Qcm9wZXJ0eU5hbWVzID0gZnVuY3Rpb24gZ2V0T3duUHJvcGVydHlOYW1lcyhpdCkge1xuICB2YXIgbmFtZXMgPSBnT1BOKHRvSU9iamVjdChpdCkpO1xuICB2YXIgcmVzdWx0ID0gW107XG4gIHZhciBpID0gMDtcbiAgdmFyIGtleTtcbiAgd2hpbGUgKG5hbWVzLmxlbmd0aCA+IGkpIHtcbiAgICBpZiAoIWhhcyhBbGxTeW1ib2xzLCBrZXkgPSBuYW1lc1tpKytdKSAmJiBrZXkgIT0gSElEREVOICYmIGtleSAhPSBNRVRBKSByZXN1bHQucHVzaChrZXkpO1xuICB9IHJldHVybiByZXN1bHQ7XG59O1xudmFyICRnZXRPd25Qcm9wZXJ0eVN5bWJvbHMgPSBmdW5jdGlvbiBnZXRPd25Qcm9wZXJ0eVN5bWJvbHMoaXQpIHtcbiAgdmFyIElTX09QID0gaXQgPT09IE9iamVjdFByb3RvO1xuICB2YXIgbmFtZXMgPSBnT1BOKElTX09QID8gT1BTeW1ib2xzIDogdG9JT2JqZWN0KGl0KSk7XG4gIHZhciByZXN1bHQgPSBbXTtcbiAgdmFyIGkgPSAwO1xuICB2YXIga2V5O1xuICB3aGlsZSAobmFtZXMubGVuZ3RoID4gaSkge1xuICAgIGlmIChoYXMoQWxsU3ltYm9scywga2V5ID0gbmFtZXNbaSsrXSkgJiYgKElTX09QID8gaGFzKE9iamVjdFByb3RvLCBrZXkpIDogdHJ1ZSkpIHJlc3VsdC5wdXNoKEFsbFN5bWJvbHNba2V5XSk7XG4gIH0gcmV0dXJuIHJlc3VsdDtcbn07XG5cbi8vIDE5LjQuMS4xIFN5bWJvbChbZGVzY3JpcHRpb25dKVxuaWYgKCFVU0VfTkFUSVZFKSB7XG4gICRTeW1ib2wgPSBmdW5jdGlvbiBTeW1ib2woKSB7XG4gICAgaWYgKHRoaXMgaW5zdGFuY2VvZiAkU3ltYm9sKSB0aHJvdyBUeXBlRXJyb3IoJ1N5bWJvbCBpcyBub3QgYSBjb25zdHJ1Y3RvciEnKTtcbiAgICB2YXIgdGFnID0gdWlkKGFyZ3VtZW50cy5sZW5ndGggPiAwID8gYXJndW1lbnRzWzBdIDogdW5kZWZpbmVkKTtcbiAgICB2YXIgJHNldCA9IGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgaWYgKHRoaXMgPT09IE9iamVjdFByb3RvKSAkc2V0LmNhbGwoT1BTeW1ib2xzLCB2YWx1ZSk7XG4gICAgICBpZiAoaGFzKHRoaXMsIEhJRERFTikgJiYgaGFzKHRoaXNbSElEREVOXSwgdGFnKSkgdGhpc1tISURERU5dW3RhZ10gPSBmYWxzZTtcbiAgICAgIHNldFN5bWJvbERlc2ModGhpcywgdGFnLCBjcmVhdGVEZXNjKDEsIHZhbHVlKSk7XG4gICAgfTtcbiAgICBpZiAoREVTQ1JJUFRPUlMgJiYgc2V0dGVyKSBzZXRTeW1ib2xEZXNjKE9iamVjdFByb3RvLCB0YWcsIHsgY29uZmlndXJhYmxlOiB0cnVlLCBzZXQ6ICRzZXQgfSk7XG4gICAgcmV0dXJuIHdyYXAodGFnKTtcbiAgfTtcbiAgcmVkZWZpbmUoJFN5bWJvbFtQUk9UT1RZUEVdLCAndG9TdHJpbmcnLCBmdW5jdGlvbiB0b1N0cmluZygpIHtcbiAgICByZXR1cm4gdGhpcy5faztcbiAgfSk7XG5cbiAgJEdPUEQuZiA9ICRnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3I7XG4gICREUC5mID0gJGRlZmluZVByb3BlcnR5O1xuICByZXF1aXJlKCcuL19vYmplY3QtZ29wbicpLmYgPSBnT1BORXh0LmYgPSAkZ2V0T3duUHJvcGVydHlOYW1lcztcbiAgcmVxdWlyZSgnLi9fb2JqZWN0LXBpZScpLmYgPSAkcHJvcGVydHlJc0VudW1lcmFibGU7XG4gICRHT1BTLmYgPSAkZ2V0T3duUHJvcGVydHlTeW1ib2xzO1xuXG4gIGlmIChERVNDUklQVE9SUyAmJiAhcmVxdWlyZSgnLi9fbGlicmFyeScpKSB7XG4gICAgcmVkZWZpbmUoT2JqZWN0UHJvdG8sICdwcm9wZXJ0eUlzRW51bWVyYWJsZScsICRwcm9wZXJ0eUlzRW51bWVyYWJsZSwgdHJ1ZSk7XG4gIH1cblxuICB3a3NFeHQuZiA9IGZ1bmN0aW9uIChuYW1lKSB7XG4gICAgcmV0dXJuIHdyYXAod2tzKG5hbWUpKTtcbiAgfTtcbn1cblxuJGV4cG9ydCgkZXhwb3J0LkcgKyAkZXhwb3J0LlcgKyAkZXhwb3J0LkYgKiAhVVNFX05BVElWRSwgeyBTeW1ib2w6ICRTeW1ib2wgfSk7XG5cbmZvciAodmFyIGVzNlN5bWJvbHMgPSAoXG4gIC8vIDE5LjQuMi4yLCAxOS40LjIuMywgMTkuNC4yLjQsIDE5LjQuMi42LCAxOS40LjIuOCwgMTkuNC4yLjksIDE5LjQuMi4xMCwgMTkuNC4yLjExLCAxOS40LjIuMTIsIDE5LjQuMi4xMywgMTkuNC4yLjE0XG4gICdoYXNJbnN0YW5jZSxpc0NvbmNhdFNwcmVhZGFibGUsaXRlcmF0b3IsbWF0Y2gscmVwbGFjZSxzZWFyY2gsc3BlY2llcyxzcGxpdCx0b1ByaW1pdGl2ZSx0b1N0cmluZ1RhZyx1bnNjb3BhYmxlcydcbikuc3BsaXQoJywnKSwgaiA9IDA7IGVzNlN5bWJvbHMubGVuZ3RoID4gajspd2tzKGVzNlN5bWJvbHNbaisrXSk7XG5cbmZvciAodmFyIHdlbGxLbm93blN5bWJvbHMgPSAka2V5cyh3a3Muc3RvcmUpLCBrID0gMDsgd2VsbEtub3duU3ltYm9scy5sZW5ndGggPiBrOykgd2tzRGVmaW5lKHdlbGxLbm93blN5bWJvbHNbaysrXSk7XG5cbiRleHBvcnQoJGV4cG9ydC5TICsgJGV4cG9ydC5GICogIVVTRV9OQVRJVkUsICdTeW1ib2wnLCB7XG4gIC8vIDE5LjQuMi4xIFN5bWJvbC5mb3Ioa2V5KVxuICAnZm9yJzogZnVuY3Rpb24gKGtleSkge1xuICAgIHJldHVybiBoYXMoU3ltYm9sUmVnaXN0cnksIGtleSArPSAnJylcbiAgICAgID8gU3ltYm9sUmVnaXN0cnlba2V5XVxuICAgICAgOiBTeW1ib2xSZWdpc3RyeVtrZXldID0gJFN5bWJvbChrZXkpO1xuICB9LFxuICAvLyAxOS40LjIuNSBTeW1ib2wua2V5Rm9yKHN5bSlcbiAga2V5Rm9yOiBmdW5jdGlvbiBrZXlGb3Ioc3ltKSB7XG4gICAgaWYgKCFpc1N5bWJvbChzeW0pKSB0aHJvdyBUeXBlRXJyb3Ioc3ltICsgJyBpcyBub3QgYSBzeW1ib2whJyk7XG4gICAgZm9yICh2YXIga2V5IGluIFN5bWJvbFJlZ2lzdHJ5KSBpZiAoU3ltYm9sUmVnaXN0cnlba2V5XSA9PT0gc3ltKSByZXR1cm4ga2V5O1xuICB9LFxuICB1c2VTZXR0ZXI6IGZ1bmN0aW9uICgpIHsgc2V0dGVyID0gdHJ1ZTsgfSxcbiAgdXNlU2ltcGxlOiBmdW5jdGlvbiAoKSB7IHNldHRlciA9IGZhbHNlOyB9XG59KTtcblxuJGV4cG9ydCgkZXhwb3J0LlMgKyAkZXhwb3J0LkYgKiAhVVNFX05BVElWRSwgJ09iamVjdCcsIHtcbiAgLy8gMTkuMS4yLjIgT2JqZWN0LmNyZWF0ZShPIFssIFByb3BlcnRpZXNdKVxuICBjcmVhdGU6ICRjcmVhdGUsXG4gIC8vIDE5LjEuMi40IE9iamVjdC5kZWZpbmVQcm9wZXJ0eShPLCBQLCBBdHRyaWJ1dGVzKVxuICBkZWZpbmVQcm9wZXJ0eTogJGRlZmluZVByb3BlcnR5LFxuICAvLyAxOS4xLjIuMyBPYmplY3QuZGVmaW5lUHJvcGVydGllcyhPLCBQcm9wZXJ0aWVzKVxuICBkZWZpbmVQcm9wZXJ0aWVzOiAkZGVmaW5lUHJvcGVydGllcyxcbiAgLy8gMTkuMS4yLjYgT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihPLCBQKVxuICBnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3I6ICRnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IsXG4gIC8vIDE5LjEuMi43IE9iamVjdC5nZXRPd25Qcm9wZXJ0eU5hbWVzKE8pXG4gIGdldE93blByb3BlcnR5TmFtZXM6ICRnZXRPd25Qcm9wZXJ0eU5hbWVzLFxuICAvLyAxOS4xLjIuOCBPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKE8pXG4gIGdldE93blByb3BlcnR5U3ltYm9sczogJGdldE93blByb3BlcnR5U3ltYm9sc1xufSk7XG5cbi8vIENocm9tZSAzOCBhbmQgMzkgYE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHNgIGZhaWxzIG9uIHByaW1pdGl2ZXNcbi8vIGh0dHBzOi8vYnVncy5jaHJvbWl1bS5vcmcvcC92OC9pc3N1ZXMvZGV0YWlsP2lkPTM0NDNcbnZhciBGQUlMU19PTl9QUklNSVRJVkVTID0gJGZhaWxzKGZ1bmN0aW9uICgpIHsgJEdPUFMuZigxKTsgfSk7XG5cbiRleHBvcnQoJGV4cG9ydC5TICsgJGV4cG9ydC5GICogRkFJTFNfT05fUFJJTUlUSVZFUywgJ09iamVjdCcsIHtcbiAgZ2V0T3duUHJvcGVydHlTeW1ib2xzOiBmdW5jdGlvbiBnZXRPd25Qcm9wZXJ0eVN5bWJvbHMoaXQpIHtcbiAgICByZXR1cm4gJEdPUFMuZih0b09iamVjdChpdCkpO1xuICB9XG59KTtcblxuLy8gMjQuMy4yIEpTT04uc3RyaW5naWZ5KHZhbHVlIFssIHJlcGxhY2VyIFssIHNwYWNlXV0pXG4kSlNPTiAmJiAkZXhwb3J0KCRleHBvcnQuUyArICRleHBvcnQuRiAqICghVVNFX05BVElWRSB8fCAkZmFpbHMoZnVuY3Rpb24gKCkge1xuICB2YXIgUyA9ICRTeW1ib2woKTtcbiAgLy8gTVMgRWRnZSBjb252ZXJ0cyBzeW1ib2wgdmFsdWVzIHRvIEpTT04gYXMge31cbiAgLy8gV2ViS2l0IGNvbnZlcnRzIHN5bWJvbCB2YWx1ZXMgdG8gSlNPTiBhcyBudWxsXG4gIC8vIFY4IHRocm93cyBvbiBib3hlZCBzeW1ib2xzXG4gIHJldHVybiBfc3RyaW5naWZ5KFtTXSkgIT0gJ1tudWxsXScgfHwgX3N0cmluZ2lmeSh7IGE6IFMgfSkgIT0gJ3t9JyB8fCBfc3RyaW5naWZ5KE9iamVjdChTKSkgIT0gJ3t9Jztcbn0pKSwgJ0pTT04nLCB7XG4gIHN0cmluZ2lmeTogZnVuY3Rpb24gc3RyaW5naWZ5KGl0KSB7XG4gICAgdmFyIGFyZ3MgPSBbaXRdO1xuICAgIHZhciBpID0gMTtcbiAgICB2YXIgcmVwbGFjZXIsICRyZXBsYWNlcjtcbiAgICB3aGlsZSAoYXJndW1lbnRzLmxlbmd0aCA+IGkpIGFyZ3MucHVzaChhcmd1bWVudHNbaSsrXSk7XG4gICAgJHJlcGxhY2VyID0gcmVwbGFjZXIgPSBhcmdzWzFdO1xuICAgIGlmICghaXNPYmplY3QocmVwbGFjZXIpICYmIGl0ID09PSB1bmRlZmluZWQgfHwgaXNTeW1ib2woaXQpKSByZXR1cm47IC8vIElFOCByZXR1cm5zIHN0cmluZyBvbiB1bmRlZmluZWRcbiAgICBpZiAoIWlzQXJyYXkocmVwbGFjZXIpKSByZXBsYWNlciA9IGZ1bmN0aW9uIChrZXksIHZhbHVlKSB7XG4gICAgICBpZiAodHlwZW9mICRyZXBsYWNlciA9PSAnZnVuY3Rpb24nKSB2YWx1ZSA9ICRyZXBsYWNlci5jYWxsKHRoaXMsIGtleSwgdmFsdWUpO1xuICAgICAgaWYgKCFpc1N5bWJvbCh2YWx1ZSkpIHJldHVybiB2YWx1ZTtcbiAgICB9O1xuICAgIGFyZ3NbMV0gPSByZXBsYWNlcjtcbiAgICByZXR1cm4gX3N0cmluZ2lmeS5hcHBseSgkSlNPTiwgYXJncyk7XG4gIH1cbn0pO1xuXG4vLyAxOS40LjMuNCBTeW1ib2wucHJvdG90eXBlW0BAdG9QcmltaXRpdmVdKGhpbnQpXG4kU3ltYm9sW1BST1RPVFlQRV1bVE9fUFJJTUlUSVZFXSB8fCByZXF1aXJlKCcuL19oaWRlJykoJFN5bWJvbFtQUk9UT1RZUEVdLCBUT19QUklNSVRJVkUsICRTeW1ib2xbUFJPVE9UWVBFXS52YWx1ZU9mKTtcbi8vIDE5LjQuMy41IFN5bWJvbC5wcm90b3R5cGVbQEB0b1N0cmluZ1RhZ11cbnNldFRvU3RyaW5nVGFnKCRTeW1ib2wsICdTeW1ib2wnKTtcbi8vIDIwLjIuMS45IE1hdGhbQEB0b1N0cmluZ1RhZ11cbnNldFRvU3RyaW5nVGFnKE1hdGgsICdNYXRoJywgdHJ1ZSk7XG4vLyAyNC4zLjMgSlNPTltAQHRvU3RyaW5nVGFnXVxuc2V0VG9TdHJpbmdUYWcoZ2xvYmFsLkpTT04sICdKU09OJywgdHJ1ZSk7XG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///128\n")},function(module,exports,__webpack_require__){eval("module.exports = __webpack_require__(49)('native-function-to-string', Function.toString);\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTI5LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9fZnVuY3Rpb24tdG8tc3RyaW5nLmpzP2ZhNWIiXSwic291cmNlc0NvbnRlbnQiOlsibW9kdWxlLmV4cG9ydHMgPSByZXF1aXJlKCcuL19zaGFyZWQnKSgnbmF0aXZlLWZ1bmN0aW9uLXRvLXN0cmluZycsIEZ1bmN0aW9uLnRvU3RyaW5nKTtcbiJdLCJtYXBwaW5ncyI6IkFBQUE7Iiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///129\n")},function(module,exports,__webpack_require__){eval("// all enumerable object keys, includes symbols\nvar getKeys = __webpack_require__(32);\nvar gOPS = __webpack_require__(51);\nvar pIE = __webpack_require__(46);\nmodule.exports = function (it) {\n  var result = getKeys(it);\n  var getSymbols = gOPS.f;\n  if (getSymbols) {\n    var symbols = getSymbols(it);\n    var isEnum = pIE.f;\n    var i = 0;\n    var key;\n    while (symbols.length > i) if (isEnum.call(it, key = symbols[i++])) result.push(key);\n  } return result;\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTMwLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9fZW51bS1rZXlzLmpzP2Q0YzAiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gYWxsIGVudW1lcmFibGUgb2JqZWN0IGtleXMsIGluY2x1ZGVzIHN5bWJvbHNcbnZhciBnZXRLZXlzID0gcmVxdWlyZSgnLi9fb2JqZWN0LWtleXMnKTtcbnZhciBnT1BTID0gcmVxdWlyZSgnLi9fb2JqZWN0LWdvcHMnKTtcbnZhciBwSUUgPSByZXF1aXJlKCcuL19vYmplY3QtcGllJyk7XG5tb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChpdCkge1xuICB2YXIgcmVzdWx0ID0gZ2V0S2V5cyhpdCk7XG4gIHZhciBnZXRTeW1ib2xzID0gZ09QUy5mO1xuICBpZiAoZ2V0U3ltYm9scykge1xuICAgIHZhciBzeW1ib2xzID0gZ2V0U3ltYm9scyhpdCk7XG4gICAgdmFyIGlzRW51bSA9IHBJRS5mO1xuICAgIHZhciBpID0gMDtcbiAgICB2YXIga2V5O1xuICAgIHdoaWxlIChzeW1ib2xzLmxlbmd0aCA+IGkpIGlmIChpc0VudW0uY2FsbChpdCwga2V5ID0gc3ltYm9sc1tpKytdKSkgcmVzdWx0LnB1c2goa2V5KTtcbiAgfSByZXR1cm4gcmVzdWx0O1xufTtcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///130\n")},function(module,exports,__webpack_require__){eval("var $export = __webpack_require__(1);\n// 19.1.2.2 / 15.2.3.5 Object.create(O [, Properties])\n$export($export.S, 'Object', { create: __webpack_require__(34) });\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTMxLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9lczYub2JqZWN0LmNyZWF0ZS5qcz84NDc4Il0sInNvdXJjZXNDb250ZW50IjpbInZhciAkZXhwb3J0ID0gcmVxdWlyZSgnLi9fZXhwb3J0Jyk7XG4vLyAxOS4xLjIuMiAvIDE1LjIuMy41IE9iamVjdC5jcmVhdGUoTyBbLCBQcm9wZXJ0aWVzXSlcbiRleHBvcnQoJGV4cG9ydC5TLCAnT2JqZWN0JywgeyBjcmVhdGU6IHJlcXVpcmUoJy4vX29iamVjdC1jcmVhdGUnKSB9KTtcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///131\n")},function(module,exports,__webpack_require__){eval("var $export = __webpack_require__(1);\n// 19.1.2.4 / 15.2.3.6 Object.defineProperty(O, P, Attributes)\n$export($export.S + $export.F * !__webpack_require__(9), 'Object', { defineProperty: __webpack_require__(10).f });\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTMyLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9lczYub2JqZWN0LmRlZmluZS1wcm9wZXJ0eS5qcz8xYzAxIl0sInNvdXJjZXNDb250ZW50IjpbInZhciAkZXhwb3J0ID0gcmVxdWlyZSgnLi9fZXhwb3J0Jyk7XG4vLyAxOS4xLjIuNCAvIDE1LjIuMy42IE9iamVjdC5kZWZpbmVQcm9wZXJ0eShPLCBQLCBBdHRyaWJ1dGVzKVxuJGV4cG9ydCgkZXhwb3J0LlMgKyAkZXhwb3J0LkYgKiAhcmVxdWlyZSgnLi9fZGVzY3JpcHRvcnMnKSwgJ09iamVjdCcsIHsgZGVmaW5lUHJvcGVydHk6IHJlcXVpcmUoJy4vX29iamVjdC1kcCcpLmYgfSk7XG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///132\n")},function(module,exports,__webpack_require__){eval("var $export = __webpack_require__(1);\n// 19.1.2.3 / 15.2.3.7 Object.defineProperties(O, Properties)\n$export($export.S + $export.F * !__webpack_require__(9), 'Object', { defineProperties: __webpack_require__(94) });\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTMzLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9lczYub2JqZWN0LmRlZmluZS1wcm9wZXJ0aWVzLmpzPzU4YjIiXSwic291cmNlc0NvbnRlbnQiOlsidmFyICRleHBvcnQgPSByZXF1aXJlKCcuL19leHBvcnQnKTtcbi8vIDE5LjEuMi4zIC8gMTUuMi4zLjcgT2JqZWN0LmRlZmluZVByb3BlcnRpZXMoTywgUHJvcGVydGllcylcbiRleHBvcnQoJGV4cG9ydC5TICsgJGV4cG9ydC5GICogIXJlcXVpcmUoJy4vX2Rlc2NyaXB0b3JzJyksICdPYmplY3QnLCB7IGRlZmluZVByb3BlcnRpZXM6IHJlcXVpcmUoJy4vX29iamVjdC1kcHMnKSB9KTtcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///133\n")},function(module,exports,__webpack_require__){eval("// 19.1.2.6 Object.getOwnPropertyDescriptor(O, P)\nvar toIObject = __webpack_require__(16);\nvar $getOwnPropertyDescriptor = __webpack_require__(21).f;\n\n__webpack_require__(22)('getOwnPropertyDescriptor', function () {\n  return function getOwnPropertyDescriptor(it, key) {\n    return $getOwnPropertyDescriptor(toIObject(it), key);\n  };\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTM0LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9lczYub2JqZWN0LmdldC1vd24tcHJvcGVydHktZGVzY3JpcHRvci5qcz85OTg2Il0sInNvdXJjZXNDb250ZW50IjpbIi8vIDE5LjEuMi42IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoTywgUClcbnZhciB0b0lPYmplY3QgPSByZXF1aXJlKCcuL190by1pb2JqZWN0Jyk7XG52YXIgJGdldE93blByb3BlcnR5RGVzY3JpcHRvciA9IHJlcXVpcmUoJy4vX29iamVjdC1nb3BkJykuZjtcblxucmVxdWlyZSgnLi9fb2JqZWN0LXNhcCcpKCdnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3InLCBmdW5jdGlvbiAoKSB7XG4gIHJldHVybiBmdW5jdGlvbiBnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoaXQsIGtleSkge1xuICAgIHJldHVybiAkZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKHRvSU9iamVjdChpdCksIGtleSk7XG4gIH07XG59KTtcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///134\n")},function(module,exports,__webpack_require__){eval("// 19.1.2.9 Object.getPrototypeOf(O)\nvar toObject = __webpack_require__(11);\nvar $getPrototypeOf = __webpack_require__(36);\n\n__webpack_require__(22)('getPrototypeOf', function () {\n  return function getPrototypeOf(it) {\n    return $getPrototypeOf(toObject(it));\n  };\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTM1LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9lczYub2JqZWN0LmdldC1wcm90b3R5cGUtb2YuanM/ZTRmNyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyAxOS4xLjIuOSBPYmplY3QuZ2V0UHJvdG90eXBlT2YoTylcbnZhciB0b09iamVjdCA9IHJlcXVpcmUoJy4vX3RvLW9iamVjdCcpO1xudmFyICRnZXRQcm90b3R5cGVPZiA9IHJlcXVpcmUoJy4vX29iamVjdC1ncG8nKTtcblxucmVxdWlyZSgnLi9fb2JqZWN0LXNhcCcpKCdnZXRQcm90b3R5cGVPZicsIGZ1bmN0aW9uICgpIHtcbiAgcmV0dXJuIGZ1bmN0aW9uIGdldFByb3RvdHlwZU9mKGl0KSB7XG4gICAgcmV0dXJuICRnZXRQcm90b3R5cGVPZih0b09iamVjdChpdCkpO1xuICB9O1xufSk7XG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///135\n")},function(module,exports,__webpack_require__){eval("// 19.1.2.14 Object.keys(O)\nvar toObject = __webpack_require__(11);\nvar $keys = __webpack_require__(32);\n\n__webpack_require__(22)('keys', function () {\n  return function keys(it) {\n    return $keys(toObject(it));\n  };\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTM2LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9lczYub2JqZWN0LmtleXMuanM/NDU2ZCJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyAxOS4xLjIuMTQgT2JqZWN0LmtleXMoTylcbnZhciB0b09iamVjdCA9IHJlcXVpcmUoJy4vX3RvLW9iamVjdCcpO1xudmFyICRrZXlzID0gcmVxdWlyZSgnLi9fb2JqZWN0LWtleXMnKTtcblxucmVxdWlyZSgnLi9fb2JqZWN0LXNhcCcpKCdrZXlzJywgZnVuY3Rpb24gKCkge1xuICByZXR1cm4gZnVuY3Rpb24ga2V5cyhpdCkge1xuICAgIHJldHVybiAka2V5cyh0b09iamVjdChpdCkpO1xuICB9O1xufSk7XG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///136\n")},function(module,exports,__webpack_require__){eval("// 19.1.2.7 Object.getOwnPropertyNames(O)\n__webpack_require__(22)('getOwnPropertyNames', function () {\n  return __webpack_require__(95).f;\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTM3LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9lczYub2JqZWN0LmdldC1vd24tcHJvcGVydHktbmFtZXMuanM/MjVkYiJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyAxOS4xLjIuNyBPYmplY3QuZ2V0T3duUHJvcGVydHlOYW1lcyhPKVxucmVxdWlyZSgnLi9fb2JqZWN0LXNhcCcpKCdnZXRPd25Qcm9wZXJ0eU5hbWVzJywgZnVuY3Rpb24gKCkge1xuICByZXR1cm4gcmVxdWlyZSgnLi9fb2JqZWN0LWdvcG4tZXh0JykuZjtcbn0pO1xuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///137\n")},function(module,exports,__webpack_require__){eval("// 19.1.2.5 Object.freeze(O)\nvar isObject = __webpack_require__(5);\nvar meta = __webpack_require__(28).onFreeze;\n\n__webpack_require__(22)('freeze', function ($freeze) {\n  return function freeze(it) {\n    return $freeze && isObject(it) ? $freeze(meta(it)) : it;\n  };\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTM4LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9lczYub2JqZWN0LmZyZWV6ZS5qcz8wZDZkIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIDE5LjEuMi41IE9iamVjdC5mcmVlemUoTylcbnZhciBpc09iamVjdCA9IHJlcXVpcmUoJy4vX2lzLW9iamVjdCcpO1xudmFyIG1ldGEgPSByZXF1aXJlKCcuL19tZXRhJykub25GcmVlemU7XG5cbnJlcXVpcmUoJy4vX29iamVjdC1zYXAnKSgnZnJlZXplJywgZnVuY3Rpb24gKCRmcmVlemUpIHtcbiAgcmV0dXJuIGZ1bmN0aW9uIGZyZWV6ZShpdCkge1xuICAgIHJldHVybiAkZnJlZXplICYmIGlzT2JqZWN0KGl0KSA/ICRmcmVlemUobWV0YShpdCkpIDogaXQ7XG4gIH07XG59KTtcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///138\n")},function(module,exports,__webpack_require__){eval("// 19.1.2.17 Object.seal(O)\nvar isObject = __webpack_require__(5);\nvar meta = __webpack_require__(28).onFreeze;\n\n__webpack_require__(22)('seal', function ($seal) {\n  return function seal(it) {\n    return $seal && isObject(it) ? $seal(meta(it)) : it;\n  };\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTM5LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9lczYub2JqZWN0LnNlYWwuanM/Y2Y2YSJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyAxOS4xLjIuMTcgT2JqZWN0LnNlYWwoTylcbnZhciBpc09iamVjdCA9IHJlcXVpcmUoJy4vX2lzLW9iamVjdCcpO1xudmFyIG1ldGEgPSByZXF1aXJlKCcuL19tZXRhJykub25GcmVlemU7XG5cbnJlcXVpcmUoJy4vX29iamVjdC1zYXAnKSgnc2VhbCcsIGZ1bmN0aW9uICgkc2VhbCkge1xuICByZXR1cm4gZnVuY3Rpb24gc2VhbChpdCkge1xuICAgIHJldHVybiAkc2VhbCAmJiBpc09iamVjdChpdCkgPyAkc2VhbChtZXRhKGl0KSkgOiBpdDtcbiAgfTtcbn0pO1xuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Iiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///139\n")},function(module,exports,__webpack_require__){eval("// 19.1.2.15 Object.preventExtensions(O)\nvar isObject = __webpack_require__(5);\nvar meta = __webpack_require__(28).onFreeze;\n\n__webpack_require__(22)('preventExtensions', function ($preventExtensions) {\n  return function preventExtensions(it) {\n    return $preventExtensions && isObject(it) ? $preventExtensions(meta(it)) : it;\n  };\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTQwLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9lczYub2JqZWN0LnByZXZlbnQtZXh0ZW5zaW9ucy5qcz85YWVhIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIDE5LjEuMi4xNSBPYmplY3QucHJldmVudEV4dGVuc2lvbnMoTylcbnZhciBpc09iamVjdCA9IHJlcXVpcmUoJy4vX2lzLW9iamVjdCcpO1xudmFyIG1ldGEgPSByZXF1aXJlKCcuL19tZXRhJykub25GcmVlemU7XG5cbnJlcXVpcmUoJy4vX29iamVjdC1zYXAnKSgncHJldmVudEV4dGVuc2lvbnMnLCBmdW5jdGlvbiAoJHByZXZlbnRFeHRlbnNpb25zKSB7XG4gIHJldHVybiBmdW5jdGlvbiBwcmV2ZW50RXh0ZW5zaW9ucyhpdCkge1xuICAgIHJldHVybiAkcHJldmVudEV4dGVuc2lvbnMgJiYgaXNPYmplY3QoaXQpID8gJHByZXZlbnRFeHRlbnNpb25zKG1ldGEoaXQpKSA6IGl0O1xuICB9O1xufSk7XG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///140\n")},function(module,exports,__webpack_require__){eval("// 19.1.2.12 Object.isFrozen(O)\nvar isObject = __webpack_require__(5);\n\n__webpack_require__(22)('isFrozen', function ($isFrozen) {\n  return function isFrozen(it) {\n    return isObject(it) ? $isFrozen ? $isFrozen(it) : false : true;\n  };\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTQxLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9lczYub2JqZWN0LmlzLWZyb3plbi5qcz82NmM4Il0sInNvdXJjZXNDb250ZW50IjpbIi8vIDE5LjEuMi4xMiBPYmplY3QuaXNGcm96ZW4oTylcbnZhciBpc09iamVjdCA9IHJlcXVpcmUoJy4vX2lzLW9iamVjdCcpO1xuXG5yZXF1aXJlKCcuL19vYmplY3Qtc2FwJykoJ2lzRnJvemVuJywgZnVuY3Rpb24gKCRpc0Zyb3plbikge1xuICByZXR1cm4gZnVuY3Rpb24gaXNGcm96ZW4oaXQpIHtcbiAgICByZXR1cm4gaXNPYmplY3QoaXQpID8gJGlzRnJvemVuID8gJGlzRnJvemVuKGl0KSA6IGZhbHNlIDogdHJ1ZTtcbiAgfTtcbn0pO1xuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///141\n")},function(module,exports,__webpack_require__){eval("// 19.1.2.13 Object.isSealed(O)\nvar isObject = __webpack_require__(5);\n\n__webpack_require__(22)('isSealed', function ($isSealed) {\n  return function isSealed(it) {\n    return isObject(it) ? $isSealed ? $isSealed(it) : false : true;\n  };\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTQyLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9lczYub2JqZWN0LmlzLXNlYWxlZC5qcz81N2YwIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIDE5LjEuMi4xMyBPYmplY3QuaXNTZWFsZWQoTylcbnZhciBpc09iamVjdCA9IHJlcXVpcmUoJy4vX2lzLW9iamVjdCcpO1xuXG5yZXF1aXJlKCcuL19vYmplY3Qtc2FwJykoJ2lzU2VhbGVkJywgZnVuY3Rpb24gKCRpc1NlYWxlZCkge1xuICByZXR1cm4gZnVuY3Rpb24gaXNTZWFsZWQoaXQpIHtcbiAgICByZXR1cm4gaXNPYmplY3QoaXQpID8gJGlzU2VhbGVkID8gJGlzU2VhbGVkKGl0KSA6IGZhbHNlIDogdHJ1ZTtcbiAgfTtcbn0pO1xuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///142\n")},function(module,exports,__webpack_require__){eval("// 19.1.2.11 Object.isExtensible(O)\nvar isObject = __webpack_require__(5);\n\n__webpack_require__(22)('isExtensible', function ($isExtensible) {\n  return function isExtensible(it) {\n    return isObject(it) ? $isExtensible ? $isExtensible(it) : true : false;\n  };\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTQzLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9lczYub2JqZWN0LmlzLWV4dGVuc2libGUuanM/MTY1YiJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyAxOS4xLjIuMTEgT2JqZWN0LmlzRXh0ZW5zaWJsZShPKVxudmFyIGlzT2JqZWN0ID0gcmVxdWlyZSgnLi9faXMtb2JqZWN0Jyk7XG5cbnJlcXVpcmUoJy4vX29iamVjdC1zYXAnKSgnaXNFeHRlbnNpYmxlJywgZnVuY3Rpb24gKCRpc0V4dGVuc2libGUpIHtcbiAgcmV0dXJuIGZ1bmN0aW9uIGlzRXh0ZW5zaWJsZShpdCkge1xuICAgIHJldHVybiBpc09iamVjdChpdCkgPyAkaXNFeHRlbnNpYmxlID8gJGlzRXh0ZW5zaWJsZShpdCkgOiB0cnVlIDogZmFsc2U7XG4gIH07XG59KTtcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///143\n")},function(module,exports,__webpack_require__){eval("// 19.1.3.1 Object.assign(target, source)\nvar $export = __webpack_require__(1);\n\n$export($export.S + $export.F, 'Object', { assign: __webpack_require__(96) });\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTQ0LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9lczYub2JqZWN0LmFzc2lnbi5qcz9mNzUxIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIDE5LjEuMy4xIE9iamVjdC5hc3NpZ24odGFyZ2V0LCBzb3VyY2UpXG52YXIgJGV4cG9ydCA9IHJlcXVpcmUoJy4vX2V4cG9ydCcpO1xuXG4kZXhwb3J0KCRleHBvcnQuUyArICRleHBvcnQuRiwgJ09iamVjdCcsIHsgYXNzaWduOiByZXF1aXJlKCcuL19vYmplY3QtYXNzaWduJykgfSk7XG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///144\n")},function(module,exports,__webpack_require__){eval("// 19.1.3.10 Object.is(value1, value2)\nvar $export = __webpack_require__(1);\n$export($export.S, 'Object', { is: __webpack_require__(97) });\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTQ1LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9lczYub2JqZWN0LmlzLmpzP2RiOTciXSwic291cmNlc0NvbnRlbnQiOlsiLy8gMTkuMS4zLjEwIE9iamVjdC5pcyh2YWx1ZTEsIHZhbHVlMilcbnZhciAkZXhwb3J0ID0gcmVxdWlyZSgnLi9fZXhwb3J0Jyk7XG4kZXhwb3J0KCRleHBvcnQuUywgJ09iamVjdCcsIHsgaXM6IHJlcXVpcmUoJy4vX3NhbWUtdmFsdWUnKSB9KTtcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///145\n")},function(module,exports,__webpack_require__){eval("// 19.1.3.19 Object.setPrototypeOf(O, proto)\nvar $export = __webpack_require__(1);\n$export($export.S, 'Object', { setPrototypeOf: __webpack_require__(66).set });\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTQ2LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9lczYub2JqZWN0LnNldC1wcm90b3R5cGUtb2YuanM/ZmQyNCJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyAxOS4xLjMuMTkgT2JqZWN0LnNldFByb3RvdHlwZU9mKE8sIHByb3RvKVxudmFyICRleHBvcnQgPSByZXF1aXJlKCcuL19leHBvcnQnKTtcbiRleHBvcnQoJGV4cG9ydC5TLCAnT2JqZWN0JywgeyBzZXRQcm90b3R5cGVPZjogcmVxdWlyZSgnLi9fc2V0LXByb3RvJykuc2V0IH0pO1xuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7Iiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///146\n")},function(module,exports,__webpack_require__){"use strict";eval("\n// 19.1.3.6 Object.prototype.toString()\nvar classof = __webpack_require__(47);\nvar test = {};\ntest[__webpack_require__(6)('toStringTag')] = 'z';\nif (test + '' != '[object z]') {\n  __webpack_require__(12)(Object.prototype, 'toString', function toString() {\n    return '[object ' + classof(this) + ']';\n  }, true);\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTQ3LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9lczYub2JqZWN0LnRvLXN0cmluZy5qcz8wNmRiIl0sInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0Jztcbi8vIDE5LjEuMy42IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcoKVxudmFyIGNsYXNzb2YgPSByZXF1aXJlKCcuL19jbGFzc29mJyk7XG52YXIgdGVzdCA9IHt9O1xudGVzdFtyZXF1aXJlKCcuL193a3MnKSgndG9TdHJpbmdUYWcnKV0gPSAneic7XG5pZiAodGVzdCArICcnICE9ICdbb2JqZWN0IHpdJykge1xuICByZXF1aXJlKCcuL19yZWRlZmluZScpKE9iamVjdC5wcm90b3R5cGUsICd0b1N0cmluZycsIGZ1bmN0aW9uIHRvU3RyaW5nKCkge1xuICAgIHJldHVybiAnW29iamVjdCAnICsgY2xhc3NvZih0aGlzKSArICddJztcbiAgfSwgdHJ1ZSk7XG59XG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///147\n")},function(module,exports,__webpack_require__){eval("// 19.2.3.2 / 15.3.4.5 Function.prototype.bind(thisArg, args...)\nvar $export = __webpack_require__(1);\n\n$export($export.P, 'Function', { bind: __webpack_require__(98) });\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTQ4LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9lczYuZnVuY3Rpb24uYmluZC5qcz9kOTJhIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIDE5LjIuMy4yIC8gMTUuMy40LjUgRnVuY3Rpb24ucHJvdG90eXBlLmJpbmQodGhpc0FyZywgYXJncy4uLilcbnZhciAkZXhwb3J0ID0gcmVxdWlyZSgnLi9fZXhwb3J0Jyk7XG5cbiRleHBvcnQoJGV4cG9ydC5QLCAnRnVuY3Rpb24nLCB7IGJpbmQ6IHJlcXVpcmUoJy4vX2JpbmQnKSB9KTtcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7Iiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///148\n")},function(module,exports,__webpack_require__){eval("var dP = __webpack_require__(10).f;\nvar FProto = Function.prototype;\nvar nameRE = /^\\s*function ([^ (]*)/;\nvar NAME = 'name';\n\n// 19.2.4.2 name\nNAME in FProto || __webpack_require__(9) && dP(FProto, NAME, {\n  configurable: true,\n  get: function () {\n    try {\n      return ('' + this).match(nameRE)[1];\n    } catch (e) {\n      return '';\n    }\n  }\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTQ5LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9lczYuZnVuY3Rpb24ubmFtZS5qcz83ZjdmIl0sInNvdXJjZXNDb250ZW50IjpbInZhciBkUCA9IHJlcXVpcmUoJy4vX29iamVjdC1kcCcpLmY7XG52YXIgRlByb3RvID0gRnVuY3Rpb24ucHJvdG90eXBlO1xudmFyIG5hbWVSRSA9IC9eXFxzKmZ1bmN0aW9uIChbXiAoXSopLztcbnZhciBOQU1FID0gJ25hbWUnO1xuXG4vLyAxOS4yLjQuMiBuYW1lXG5OQU1FIGluIEZQcm90byB8fCByZXF1aXJlKCcuL19kZXNjcmlwdG9ycycpICYmIGRQKEZQcm90bywgTkFNRSwge1xuICBjb25maWd1cmFibGU6IHRydWUsXG4gIGdldDogZnVuY3Rpb24gKCkge1xuICAgIHRyeSB7XG4gICAgICByZXR1cm4gKCcnICsgdGhpcykubWF0Y2gobmFtZVJFKVsxXTtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICByZXR1cm4gJyc7XG4gICAgfVxuICB9XG59KTtcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Iiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///149\n")},function(module,exports,__webpack_require__){"use strict";eval("\nvar isObject = __webpack_require__(5);\nvar getPrototypeOf = __webpack_require__(36);\nvar HAS_INSTANCE = __webpack_require__(6)('hasInstance');\nvar FunctionProto = Function.prototype;\n// 19.2.3.6 Function.prototype[@@hasInstance](V)\nif (!(HAS_INSTANCE in FunctionProto)) __webpack_require__(10).f(FunctionProto, HAS_INSTANCE, { value: function (O) {\n  if (typeof this != 'function' || !isObject(O)) return false;\n  if (!isObject(this.prototype)) return O instanceof this;\n  // for environment w/o native `@@hasInstance` logic enough `instanceof`, but add this:\n  while (O = getPrototypeOf(O)) if (this.prototype === O) return true;\n  return false;\n} });\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTUwLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9lczYuZnVuY3Rpb24uaGFzLWluc3RhbmNlLmpzPzIxN2IiXSwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xudmFyIGlzT2JqZWN0ID0gcmVxdWlyZSgnLi9faXMtb2JqZWN0Jyk7XG52YXIgZ2V0UHJvdG90eXBlT2YgPSByZXF1aXJlKCcuL19vYmplY3QtZ3BvJyk7XG52YXIgSEFTX0lOU1RBTkNFID0gcmVxdWlyZSgnLi9fd2tzJykoJ2hhc0luc3RhbmNlJyk7XG52YXIgRnVuY3Rpb25Qcm90byA9IEZ1bmN0aW9uLnByb3RvdHlwZTtcbi8vIDE5LjIuMy42IEZ1bmN0aW9uLnByb3RvdHlwZVtAQGhhc0luc3RhbmNlXShWKVxuaWYgKCEoSEFTX0lOU1RBTkNFIGluIEZ1bmN0aW9uUHJvdG8pKSByZXF1aXJlKCcuL19vYmplY3QtZHAnKS5mKEZ1bmN0aW9uUHJvdG8sIEhBU19JTlNUQU5DRSwgeyB2YWx1ZTogZnVuY3Rpb24gKE8pIHtcbiAgaWYgKHR5cGVvZiB0aGlzICE9ICdmdW5jdGlvbicgfHwgIWlzT2JqZWN0KE8pKSByZXR1cm4gZmFsc2U7XG4gIGlmICghaXNPYmplY3QodGhpcy5wcm90b3R5cGUpKSByZXR1cm4gTyBpbnN0YW5jZW9mIHRoaXM7XG4gIC8vIGZvciBlbnZpcm9ubWVudCB3L28gbmF0aXZlIGBAQGhhc0luc3RhbmNlYCBsb2dpYyBlbm91Z2ggYGluc3RhbmNlb2ZgLCBidXQgYWRkIHRoaXM6XG4gIHdoaWxlIChPID0gZ2V0UHJvdG90eXBlT2YoTykpIGlmICh0aGlzLnByb3RvdHlwZSA9PT0gTykgcmV0dXJuIHRydWU7XG4gIHJldHVybiBmYWxzZTtcbn0gfSk7XG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///150\n")},function(module,exports,__webpack_require__){eval("var $export = __webpack_require__(1);\nvar $parseInt = __webpack_require__(100);\n// 18.2.5 parseInt(string, radix)\n$export($export.G + $export.F * (parseInt != $parseInt), { parseInt: $parseInt });\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTUxLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9lczYucGFyc2UtaW50LmpzPzE4ZDAiXSwic291cmNlc0NvbnRlbnQiOlsidmFyICRleHBvcnQgPSByZXF1aXJlKCcuL19leHBvcnQnKTtcbnZhciAkcGFyc2VJbnQgPSByZXF1aXJlKCcuL19wYXJzZS1pbnQnKTtcbi8vIDE4LjIuNSBwYXJzZUludChzdHJpbmcsIHJhZGl4KVxuJGV4cG9ydCgkZXhwb3J0LkcgKyAkZXhwb3J0LkYgKiAocGFyc2VJbnQgIT0gJHBhcnNlSW50KSwgeyBwYXJzZUludDogJHBhcnNlSW50IH0pO1xuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///151\n")},function(module,exports,__webpack_require__){eval("var $export = __webpack_require__(1);\nvar $parseFloat = __webpack_require__(101);\n// 18.2.4 parseFloat(string)\n$export($export.G + $export.F * (parseFloat != $parseFloat), { parseFloat: $parseFloat });\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTUyLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9lczYucGFyc2UtZmxvYXQuanM/YjcyYyJdLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgJGV4cG9ydCA9IHJlcXVpcmUoJy4vX2V4cG9ydCcpO1xudmFyICRwYXJzZUZsb2F0ID0gcmVxdWlyZSgnLi9fcGFyc2UtZmxvYXQnKTtcbi8vIDE4LjIuNCBwYXJzZUZsb2F0KHN0cmluZylcbiRleHBvcnQoJGV4cG9ydC5HICsgJGV4cG9ydC5GICogKHBhcnNlRmxvYXQgIT0gJHBhcnNlRmxvYXQpLCB7IHBhcnNlRmxvYXQ6ICRwYXJzZUZsb2F0IH0pO1xuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///152\n")},function(module,exports,__webpack_require__){"use strict";eval("\nvar global = __webpack_require__(2);\nvar has = __webpack_require__(14);\nvar cof = __webpack_require__(24);\nvar inheritIfRequired = __webpack_require__(68);\nvar toPrimitive = __webpack_require__(27);\nvar fails = __webpack_require__(3);\nvar gOPN = __webpack_require__(35).f;\nvar gOPD = __webpack_require__(21).f;\nvar dP = __webpack_require__(10).f;\nvar $trim = __webpack_require__(40).trim;\nvar NUMBER = 'Number';\nvar $Number = global[NUMBER];\nvar Base = $Number;\nvar proto = $Number.prototype;\n// Opera ~12 has broken Object#toString\nvar BROKEN_COF = cof(__webpack_require__(34)(proto)) == NUMBER;\nvar TRIM = 'trim' in String.prototype;\n\n// 7.1.3 ToNumber(argument)\nvar toNumber = function (argument) {\n  var it = toPrimitive(argument, false);\n  if (typeof it == 'string' && it.length > 2) {\n    it = TRIM ? it.trim() : $trim(it, 3);\n    var first = it.charCodeAt(0);\n    var third, radix, maxCode;\n    if (first === 43 || first === 45) {\n      third = it.charCodeAt(2);\n      if (third === 88 || third === 120) return NaN; // Number('+0x1') should be NaN, old V8 fix\n    } else if (first === 48) {\n      switch (it.charCodeAt(1)) {\n        case 66: case 98: radix = 2; maxCode = 49; break; // fast equal /^0b[01]+$/i\n        case 79: case 111: radix = 8; maxCode = 55; break; // fast equal /^0o[0-7]+$/i\n        default: return +it;\n      }\n      for (var digits = it.slice(2), i = 0, l = digits.length, code; i < l; i++) {\n        code = digits.charCodeAt(i);\n        // parseInt parses a string to a first unavailable symbol\n        // but ToNumber should return NaN if a string contains unavailable symbols\n        if (code < 48 || code > maxCode) return NaN;\n      } return parseInt(digits, radix);\n    }\n  } return +it;\n};\n\nif (!$Number(' 0o1') || !$Number('0b1') || $Number('+0x1')) {\n  $Number = function Number(value) {\n    var it = arguments.length < 1 ? 0 : value;\n    var that = this;\n    return that instanceof $Number\n      // check on 1..constructor(foo) case\n      && (BROKEN_COF ? fails(function () { proto.valueOf.call(that); }) : cof(that) != NUMBER)\n        ? inheritIfRequired(new Base(toNumber(it)), that, $Number) : toNumber(it);\n  };\n  for (var keys = __webpack_require__(9) ? gOPN(Base) : (\n    // ES3:\n    'MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,' +\n    // ES6 (in case, if modules with ES6 Number statics required before):\n    'EPSILON,isFinite,isInteger,isNaN,isSafeInteger,MAX_SAFE_INTEGER,' +\n    'MIN_SAFE_INTEGER,parseFloat,parseInt,isInteger'\n  ).split(','), j = 0, key; keys.length > j; j++) {\n    if (has(Base, key = keys[j]) && !has($Number, key)) {\n      dP($Number, key, gOPD(Base, key));\n    }\n  }\n  $Number.prototype = proto;\n  proto.constructor = $Number;\n  __webpack_require__(12)(global, NUMBER, $Number);\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTUzLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9lczYubnVtYmVyLmNvbnN0cnVjdG9yLmpzP2M1ZjYiXSwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xudmFyIGdsb2JhbCA9IHJlcXVpcmUoJy4vX2dsb2JhbCcpO1xudmFyIGhhcyA9IHJlcXVpcmUoJy4vX2hhcycpO1xudmFyIGNvZiA9IHJlcXVpcmUoJy4vX2NvZicpO1xudmFyIGluaGVyaXRJZlJlcXVpcmVkID0gcmVxdWlyZSgnLi9faW5oZXJpdC1pZi1yZXF1aXJlZCcpO1xudmFyIHRvUHJpbWl0aXZlID0gcmVxdWlyZSgnLi9fdG8tcHJpbWl0aXZlJyk7XG52YXIgZmFpbHMgPSByZXF1aXJlKCcuL19mYWlscycpO1xudmFyIGdPUE4gPSByZXF1aXJlKCcuL19vYmplY3QtZ29wbicpLmY7XG52YXIgZ09QRCA9IHJlcXVpcmUoJy4vX29iamVjdC1nb3BkJykuZjtcbnZhciBkUCA9IHJlcXVpcmUoJy4vX29iamVjdC1kcCcpLmY7XG52YXIgJHRyaW0gPSByZXF1aXJlKCcuL19zdHJpbmctdHJpbScpLnRyaW07XG52YXIgTlVNQkVSID0gJ051bWJlcic7XG52YXIgJE51bWJlciA9IGdsb2JhbFtOVU1CRVJdO1xudmFyIEJhc2UgPSAkTnVtYmVyO1xudmFyIHByb3RvID0gJE51bWJlci5wcm90b3R5cGU7XG4vLyBPcGVyYSB+MTIgaGFzIGJyb2tlbiBPYmplY3QjdG9TdHJpbmdcbnZhciBCUk9LRU5fQ09GID0gY29mKHJlcXVpcmUoJy4vX29iamVjdC1jcmVhdGUnKShwcm90bykpID09IE5VTUJFUjtcbnZhciBUUklNID0gJ3RyaW0nIGluIFN0cmluZy5wcm90b3R5cGU7XG5cbi8vIDcuMS4zIFRvTnVtYmVyKGFyZ3VtZW50KVxudmFyIHRvTnVtYmVyID0gZnVuY3Rpb24gKGFyZ3VtZW50KSB7XG4gIHZhciBpdCA9IHRvUHJpbWl0aXZlKGFyZ3VtZW50LCBmYWxzZSk7XG4gIGlmICh0eXBlb2YgaXQgPT0gJ3N0cmluZycgJiYgaXQubGVuZ3RoID4gMikge1xuICAgIGl0ID0gVFJJTSA/IGl0LnRyaW0oKSA6ICR0cmltKGl0LCAzKTtcbiAgICB2YXIgZmlyc3QgPSBpdC5jaGFyQ29kZUF0KDApO1xuICAgIHZhciB0aGlyZCwgcmFkaXgsIG1heENvZGU7XG4gICAgaWYgKGZpcnN0ID09PSA0MyB8fCBmaXJzdCA9PT0gNDUpIHtcbiAgICAgIHRoaXJkID0gaXQuY2hhckNvZGVBdCgyKTtcbiAgICAgIGlmICh0aGlyZCA9PT0gODggfHwgdGhpcmQgPT09IDEyMCkgcmV0dXJuIE5hTjsgLy8gTnVtYmVyKCcrMHgxJykgc2hvdWxkIGJlIE5hTiwgb2xkIFY4IGZpeFxuICAgIH0gZWxzZSBpZiAoZmlyc3QgPT09IDQ4KSB7XG4gICAgICBzd2l0Y2ggKGl0LmNoYXJDb2RlQXQoMSkpIHtcbiAgICAgICAgY2FzZSA2NjogY2FzZSA5ODogcmFkaXggPSAyOyBtYXhDb2RlID0gNDk7IGJyZWFrOyAvLyBmYXN0IGVxdWFsIC9eMGJbMDFdKyQvaVxuICAgICAgICBjYXNlIDc5OiBjYXNlIDExMTogcmFkaXggPSA4OyBtYXhDb2RlID0gNTU7IGJyZWFrOyAvLyBmYXN0IGVxdWFsIC9eMG9bMC03XSskL2lcbiAgICAgICAgZGVmYXVsdDogcmV0dXJuICtpdDtcbiAgICAgIH1cbiAgICAgIGZvciAodmFyIGRpZ2l0cyA9IGl0LnNsaWNlKDIpLCBpID0gMCwgbCA9IGRpZ2l0cy5sZW5ndGgsIGNvZGU7IGkgPCBsOyBpKyspIHtcbiAgICAgICAgY29kZSA9IGRpZ2l0cy5jaGFyQ29kZUF0KGkpO1xuICAgICAgICAvLyBwYXJzZUludCBwYXJzZXMgYSBzdHJpbmcgdG8gYSBmaXJzdCB1bmF2YWlsYWJsZSBzeW1ib2xcbiAgICAgICAgLy8gYnV0IFRvTnVtYmVyIHNob3VsZCByZXR1cm4gTmFOIGlmIGEgc3RyaW5nIGNvbnRhaW5zIHVuYXZhaWxhYmxlIHN5bWJvbHNcbiAgICAgICAgaWYgKGNvZGUgPCA0OCB8fCBjb2RlID4gbWF4Q29kZSkgcmV0dXJuIE5hTjtcbiAgICAgIH0gcmV0dXJuIHBhcnNlSW50KGRpZ2l0cywgcmFkaXgpO1xuICAgIH1cbiAgfSByZXR1cm4gK2l0O1xufTtcblxuaWYgKCEkTnVtYmVyKCcgMG8xJykgfHwgISROdW1iZXIoJzBiMScpIHx8ICROdW1iZXIoJysweDEnKSkge1xuICAkTnVtYmVyID0gZnVuY3Rpb24gTnVtYmVyKHZhbHVlKSB7XG4gICAgdmFyIGl0ID0gYXJndW1lbnRzLmxlbmd0aCA8IDEgPyAwIDogdmFsdWU7XG4gICAgdmFyIHRoYXQgPSB0aGlzO1xuICAgIHJldHVybiB0aGF0IGluc3RhbmNlb2YgJE51bWJlclxuICAgICAgLy8gY2hlY2sgb24gMS4uY29uc3RydWN0b3IoZm9vKSBjYXNlXG4gICAgICAmJiAoQlJPS0VOX0NPRiA/IGZhaWxzKGZ1bmN0aW9uICgpIHsgcHJvdG8udmFsdWVPZi5jYWxsKHRoYXQpOyB9KSA6IGNvZih0aGF0KSAhPSBOVU1CRVIpXG4gICAgICAgID8gaW5oZXJpdElmUmVxdWlyZWQobmV3IEJhc2UodG9OdW1iZXIoaXQpKSwgdGhhdCwgJE51bWJlcikgOiB0b051bWJlcihpdCk7XG4gIH07XG4gIGZvciAodmFyIGtleXMgPSByZXF1aXJlKCcuL19kZXNjcmlwdG9ycycpID8gZ09QTihCYXNlKSA6IChcbiAgICAvLyBFUzM6XG4gICAgJ01BWF9WQUxVRSxNSU5fVkFMVUUsTmFOLE5FR0FUSVZFX0lORklOSVRZLFBPU0lUSVZFX0lORklOSVRZLCcgK1xuICAgIC8vIEVTNiAoaW4gY2FzZSwgaWYgbW9kdWxlcyB3aXRoIEVTNiBOdW1iZXIgc3RhdGljcyByZXF1aXJlZCBiZWZvcmUpOlxuICAgICdFUFNJTE9OLGlzRmluaXRlLGlzSW50ZWdlcixpc05hTixpc1NhZmVJbnRlZ2VyLE1BWF9TQUZFX0lOVEVHRVIsJyArXG4gICAgJ01JTl9TQUZFX0lOVEVHRVIscGFyc2VGbG9hdCxwYXJzZUludCxpc0ludGVnZXInXG4gICkuc3BsaXQoJywnKSwgaiA9IDAsIGtleTsga2V5cy5sZW5ndGggPiBqOyBqKyspIHtcbiAgICBpZiAoaGFzKEJhc2UsIGtleSA9IGtleXNbal0pICYmICFoYXMoJE51bWJlciwga2V5KSkge1xuICAgICAgZFAoJE51bWJlciwga2V5LCBnT1BEKEJhc2UsIGtleSkpO1xuICAgIH1cbiAgfVxuICAkTnVtYmVyLnByb3RvdHlwZSA9IHByb3RvO1xuICBwcm90by5jb25zdHJ1Y3RvciA9ICROdW1iZXI7XG4gIHJlcXVpcmUoJy4vX3JlZGVmaW5lJykoZ2xvYmFsLCBOVU1CRVIsICROdW1iZXIpO1xufVxuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Iiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///153\n")},function(module,exports,__webpack_require__){"use strict";eval("\nvar $export = __webpack_require__(1);\nvar toInteger = __webpack_require__(20);\nvar aNumberValue = __webpack_require__(102);\nvar repeat = __webpack_require__(69);\nvar $toFixed = 1.0.toFixed;\nvar floor = Math.floor;\nvar data = [0, 0, 0, 0, 0, 0];\nvar ERROR = 'Number.toFixed: incorrect invocation!';\nvar ZERO = '0';\n\nvar multiply = function (n, c) {\n  var i = -1;\n  var c2 = c;\n  while (++i < 6) {\n    c2 += n * data[i];\n    data[i] = c2 % 1e7;\n    c2 = floor(c2 / 1e7);\n  }\n};\nvar divide = function (n) {\n  var i = 6;\n  var c = 0;\n  while (--i >= 0) {\n    c += data[i];\n    data[i] = floor(c / n);\n    c = (c % n) * 1e7;\n  }\n};\nvar numToString = function () {\n  var i = 6;\n  var s = '';\n  while (--i >= 0) {\n    if (s !== '' || i === 0 || data[i] !== 0) {\n      var t = String(data[i]);\n      s = s === '' ? t : s + repeat.call(ZERO, 7 - t.length) + t;\n    }\n  } return s;\n};\nvar pow = function (x, n, acc) {\n  return n === 0 ? acc : n % 2 === 1 ? pow(x, n - 1, acc * x) : pow(x * x, n / 2, acc);\n};\nvar log = function (x) {\n  var n = 0;\n  var x2 = x;\n  while (x2 >= 4096) {\n    n += 12;\n    x2 /= 4096;\n  }\n  while (x2 >= 2) {\n    n += 1;\n    x2 /= 2;\n  } return n;\n};\n\n$export($export.P + $export.F * (!!$toFixed && (\n  0.00008.toFixed(3) !== '0.000' ||\n  0.9.toFixed(0) !== '1' ||\n  1.255.toFixed(2) !== '1.25' ||\n  1000000000000000128.0.toFixed(0) !== '1000000000000000128'\n) || !__webpack_require__(3)(function () {\n  // V8 ~ Android 4.3-\n  $toFixed.call({});\n})), 'Number', {\n  toFixed: function toFixed(fractionDigits) {\n    var x = aNumberValue(this, ERROR);\n    var f = toInteger(fractionDigits);\n    var s = '';\n    var m = ZERO;\n    var e, z, j, k;\n    if (f < 0 || f > 20) throw RangeError(ERROR);\n    // eslint-disable-next-line no-self-compare\n    if (x != x) return 'NaN';\n    if (x <= -1e21 || x >= 1e21) return String(x);\n    if (x < 0) {\n      s = '-';\n      x = -x;\n    }\n    if (x > 1e-21) {\n      e = log(x * pow(2, 69, 1)) - 69;\n      z = e < 0 ? x * pow(2, -e, 1) : x / pow(2, e, 1);\n      z *= 0x10000000000000;\n      e = 52 - e;\n      if (e > 0) {\n        multiply(0, z);\n        j = f;\n        while (j >= 7) {\n          multiply(1e7, 0);\n          j -= 7;\n        }\n        multiply(pow(10, j, 1), 0);\n        j = e - 1;\n        while (j >= 23) {\n          divide(1 << 23);\n          j -= 23;\n        }\n        divide(1 << j);\n        multiply(1, 1);\n        divide(2);\n        m = numToString();\n      } else {\n        multiply(0, z);\n        multiply(1 << -e, 0);\n        m = numToString() + repeat.call(ZERO, f);\n      }\n    }\n    if (f > 0) {\n      k = m.length;\n      m = s + (k <= f ? '0.' + repeat.call(ZERO, f - k) + m : m.slice(0, k - f) + '.' + m.slice(k - f));\n    } else {\n      m = s + m;\n    } return m;\n  }\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTU0LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9lczYubnVtYmVyLnRvLWZpeGVkLmpzPzAzNmMiXSwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xudmFyICRleHBvcnQgPSByZXF1aXJlKCcuL19leHBvcnQnKTtcbnZhciB0b0ludGVnZXIgPSByZXF1aXJlKCcuL190by1pbnRlZ2VyJyk7XG52YXIgYU51bWJlclZhbHVlID0gcmVxdWlyZSgnLi9fYS1udW1iZXItdmFsdWUnKTtcbnZhciByZXBlYXQgPSByZXF1aXJlKCcuL19zdHJpbmctcmVwZWF0Jyk7XG52YXIgJHRvRml4ZWQgPSAxLjAudG9GaXhlZDtcbnZhciBmbG9vciA9IE1hdGguZmxvb3I7XG52YXIgZGF0YSA9IFswLCAwLCAwLCAwLCAwLCAwXTtcbnZhciBFUlJPUiA9ICdOdW1iZXIudG9GaXhlZDogaW5jb3JyZWN0IGludm9jYXRpb24hJztcbnZhciBaRVJPID0gJzAnO1xuXG52YXIgbXVsdGlwbHkgPSBmdW5jdGlvbiAobiwgYykge1xuICB2YXIgaSA9IC0xO1xuICB2YXIgYzIgPSBjO1xuICB3aGlsZSAoKytpIDwgNikge1xuICAgIGMyICs9IG4gKiBkYXRhW2ldO1xuICAgIGRhdGFbaV0gPSBjMiAlIDFlNztcbiAgICBjMiA9IGZsb29yKGMyIC8gMWU3KTtcbiAgfVxufTtcbnZhciBkaXZpZGUgPSBmdW5jdGlvbiAobikge1xuICB2YXIgaSA9IDY7XG4gIHZhciBjID0gMDtcbiAgd2hpbGUgKC0taSA+PSAwKSB7XG4gICAgYyArPSBkYXRhW2ldO1xuICAgIGRhdGFbaV0gPSBmbG9vcihjIC8gbik7XG4gICAgYyA9IChjICUgbikgKiAxZTc7XG4gIH1cbn07XG52YXIgbnVtVG9TdHJpbmcgPSBmdW5jdGlvbiAoKSB7XG4gIHZhciBpID0gNjtcbiAgdmFyIHMgPSAnJztcbiAgd2hpbGUgKC0taSA+PSAwKSB7XG4gICAgaWYgKHMgIT09ICcnIHx8IGkgPT09IDAgfHwgZGF0YVtpXSAhPT0gMCkge1xuICAgICAgdmFyIHQgPSBTdHJpbmcoZGF0YVtpXSk7XG4gICAgICBzID0gcyA9PT0gJycgPyB0IDogcyArIHJlcGVhdC5jYWxsKFpFUk8sIDcgLSB0Lmxlbmd0aCkgKyB0O1xuICAgIH1cbiAgfSByZXR1cm4gcztcbn07XG52YXIgcG93ID0gZnVuY3Rpb24gKHgsIG4sIGFjYykge1xuICByZXR1cm4gbiA9PT0gMCA/IGFjYyA6IG4gJSAyID09PSAxID8gcG93KHgsIG4gLSAxLCBhY2MgKiB4KSA6IHBvdyh4ICogeCwgbiAvIDIsIGFjYyk7XG59O1xudmFyIGxvZyA9IGZ1bmN0aW9uICh4KSB7XG4gIHZhciBuID0gMDtcbiAgdmFyIHgyID0geDtcbiAgd2hpbGUgKHgyID49IDQwOTYpIHtcbiAgICBuICs9IDEyO1xuICAgIHgyIC89IDQwOTY7XG4gIH1cbiAgd2hpbGUgKHgyID49IDIpIHtcbiAgICBuICs9IDE7XG4gICAgeDIgLz0gMjtcbiAgfSByZXR1cm4gbjtcbn07XG5cbiRleHBvcnQoJGV4cG9ydC5QICsgJGV4cG9ydC5GICogKCEhJHRvRml4ZWQgJiYgKFxuICAwLjAwMDA4LnRvRml4ZWQoMykgIT09ICcwLjAwMCcgfHxcbiAgMC45LnRvRml4ZWQoMCkgIT09ICcxJyB8fFxuICAxLjI1NS50b0ZpeGVkKDIpICE9PSAnMS4yNScgfHxcbiAgMTAwMDAwMDAwMDAwMDAwMDEyOC4wLnRvRml4ZWQoMCkgIT09ICcxMDAwMDAwMDAwMDAwMDAwMTI4J1xuKSB8fCAhcmVxdWlyZSgnLi9fZmFpbHMnKShmdW5jdGlvbiAoKSB7XG4gIC8vIFY4IH4gQW5kcm9pZCA0LjMtXG4gICR0b0ZpeGVkLmNhbGwoe30pO1xufSkpLCAnTnVtYmVyJywge1xuICB0b0ZpeGVkOiBmdW5jdGlvbiB0b0ZpeGVkKGZyYWN0aW9uRGlnaXRzKSB7XG4gICAgdmFyIHggPSBhTnVtYmVyVmFsdWUodGhpcywgRVJST1IpO1xuICAgIHZhciBmID0gdG9JbnRlZ2VyKGZyYWN0aW9uRGlnaXRzKTtcbiAgICB2YXIgcyA9ICcnO1xuICAgIHZhciBtID0gWkVSTztcbiAgICB2YXIgZSwgeiwgaiwgaztcbiAgICBpZiAoZiA8IDAgfHwgZiA+IDIwKSB0aHJvdyBSYW5nZUVycm9yKEVSUk9SKTtcbiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tc2VsZi1jb21wYXJlXG4gICAgaWYgKHggIT0geCkgcmV0dXJuICdOYU4nO1xuICAgIGlmICh4IDw9IC0xZTIxIHx8IHggPj0gMWUyMSkgcmV0dXJuIFN0cmluZyh4KTtcbiAgICBpZiAoeCA8IDApIHtcbiAgICAgIHMgPSAnLSc7XG4gICAgICB4ID0gLXg7XG4gICAgfVxuICAgIGlmICh4ID4gMWUtMjEpIHtcbiAgICAgIGUgPSBsb2coeCAqIHBvdygyLCA2OSwgMSkpIC0gNjk7XG4gICAgICB6ID0gZSA8IDAgPyB4ICogcG93KDIsIC1lLCAxKSA6IHggLyBwb3coMiwgZSwgMSk7XG4gICAgICB6ICo9IDB4MTAwMDAwMDAwMDAwMDA7XG4gICAgICBlID0gNTIgLSBlO1xuICAgICAgaWYgKGUgPiAwKSB7XG4gICAgICAgIG11bHRpcGx5KDAsIHopO1xuICAgICAgICBqID0gZjtcbiAgICAgICAgd2hpbGUgKGogPj0gNykge1xuICAgICAgICAgIG11bHRpcGx5KDFlNywgMCk7XG4gICAgICAgICAgaiAtPSA3O1xuICAgICAgICB9XG4gICAgICAgIG11bHRpcGx5KHBvdygxMCwgaiwgMSksIDApO1xuICAgICAgICBqID0gZSAtIDE7XG4gICAgICAgIHdoaWxlIChqID49IDIzKSB7XG4gICAgICAgICAgZGl2aWRlKDEgPDwgMjMpO1xuICAgICAgICAgIGogLT0gMjM7XG4gICAgICAgIH1cbiAgICAgICAgZGl2aWRlKDEgPDwgaik7XG4gICAgICAgIG11bHRpcGx5KDEsIDEpO1xuICAgICAgICBkaXZpZGUoMik7XG4gICAgICAgIG0gPSBudW1Ub1N0cmluZygpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgbXVsdGlwbHkoMCwgeik7XG4gICAgICAgIG11bHRpcGx5KDEgPDwgLWUsIDApO1xuICAgICAgICBtID0gbnVtVG9TdHJpbmcoKSArIHJlcGVhdC5jYWxsKFpFUk8sIGYpO1xuICAgICAgfVxuICAgIH1cbiAgICBpZiAoZiA+IDApIHtcbiAgICAgIGsgPSBtLmxlbmd0aDtcbiAgICAgIG0gPSBzICsgKGsgPD0gZiA/ICcwLicgKyByZXBlYXQuY2FsbChaRVJPLCBmIC0gaykgKyBtIDogbS5zbGljZSgwLCBrIC0gZikgKyAnLicgKyBtLnNsaWNlKGsgLSBmKSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIG0gPSBzICsgbTtcbiAgICB9IHJldHVybiBtO1xuICB9XG59KTtcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///154\n")},function(module,exports,__webpack_require__){"use strict";eval("\nvar $export = __webpack_require__(1);\nvar $fails = __webpack_require__(3);\nvar aNumberValue = __webpack_require__(102);\nvar $toPrecision = 1.0.toPrecision;\n\n$export($export.P + $export.F * ($fails(function () {\n  // IE7-\n  return $toPrecision.call(1, undefined) !== '1';\n}) || !$fails(function () {\n  // V8 ~ Android 4.3-\n  $toPrecision.call({});\n})), 'Number', {\n  toPrecision: function toPrecision(precision) {\n    var that = aNumberValue(this, 'Number#toPrecision: incorrect invocation!');\n    return precision === undefined ? $toPrecision.call(that) : $toPrecision.call(that, precision);\n  }\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTU1LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9lczYubnVtYmVyLnRvLXByZWNpc2lvbi5qcz81NGE4Il0sInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcbnZhciAkZXhwb3J0ID0gcmVxdWlyZSgnLi9fZXhwb3J0Jyk7XG52YXIgJGZhaWxzID0gcmVxdWlyZSgnLi9fZmFpbHMnKTtcbnZhciBhTnVtYmVyVmFsdWUgPSByZXF1aXJlKCcuL19hLW51bWJlci12YWx1ZScpO1xudmFyICR0b1ByZWNpc2lvbiA9IDEuMC50b1ByZWNpc2lvbjtcblxuJGV4cG9ydCgkZXhwb3J0LlAgKyAkZXhwb3J0LkYgKiAoJGZhaWxzKGZ1bmN0aW9uICgpIHtcbiAgLy8gSUU3LVxuICByZXR1cm4gJHRvUHJlY2lzaW9uLmNhbGwoMSwgdW5kZWZpbmVkKSAhPT0gJzEnO1xufSkgfHwgISRmYWlscyhmdW5jdGlvbiAoKSB7XG4gIC8vIFY4IH4gQW5kcm9pZCA0LjMtXG4gICR0b1ByZWNpc2lvbi5jYWxsKHt9KTtcbn0pKSwgJ051bWJlcicsIHtcbiAgdG9QcmVjaXNpb246IGZ1bmN0aW9uIHRvUHJlY2lzaW9uKHByZWNpc2lvbikge1xuICAgIHZhciB0aGF0ID0gYU51bWJlclZhbHVlKHRoaXMsICdOdW1iZXIjdG9QcmVjaXNpb246IGluY29ycmVjdCBpbnZvY2F0aW9uIScpO1xuICAgIHJldHVybiBwcmVjaXNpb24gPT09IHVuZGVmaW5lZCA/ICR0b1ByZWNpc2lvbi5jYWxsKHRoYXQpIDogJHRvUHJlY2lzaW9uLmNhbGwodGhhdCwgcHJlY2lzaW9uKTtcbiAgfVxufSk7XG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///155\n")},function(module,exports,__webpack_require__){eval("// 20.1.2.1 Number.EPSILON\nvar $export = __webpack_require__(1);\n\n$export($export.S, 'Number', { EPSILON: Math.pow(2, -52) });\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTU2LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9lczYubnVtYmVyLmVwc2lsb24uanM/MmUzNyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyAyMC4xLjIuMSBOdW1iZXIuRVBTSUxPTlxudmFyICRleHBvcnQgPSByZXF1aXJlKCcuL19leHBvcnQnKTtcblxuJGV4cG9ydCgkZXhwb3J0LlMsICdOdW1iZXInLCB7IEVQU0lMT046IE1hdGgucG93KDIsIC01MikgfSk7XG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///156\n")},function(module,exports,__webpack_require__){eval("// 20.1.2.2 Number.isFinite(number)\nvar $export = __webpack_require__(1);\nvar _isFinite = __webpack_require__(2).isFinite;\n\n$export($export.S, 'Number', {\n  isFinite: function isFinite(it) {\n    return typeof it == 'number' && _isFinite(it);\n  }\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTU3LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9lczYubnVtYmVyLmlzLWZpbml0ZS5qcz9mY2EwIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIDIwLjEuMi4yIE51bWJlci5pc0Zpbml0ZShudW1iZXIpXG52YXIgJGV4cG9ydCA9IHJlcXVpcmUoJy4vX2V4cG9ydCcpO1xudmFyIF9pc0Zpbml0ZSA9IHJlcXVpcmUoJy4vX2dsb2JhbCcpLmlzRmluaXRlO1xuXG4kZXhwb3J0KCRleHBvcnQuUywgJ051bWJlcicsIHtcbiAgaXNGaW5pdGU6IGZ1bmN0aW9uIGlzRmluaXRlKGl0KSB7XG4gICAgcmV0dXJuIHR5cGVvZiBpdCA9PSAnbnVtYmVyJyAmJiBfaXNGaW5pdGUoaXQpO1xuICB9XG59KTtcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///157\n")},function(module,exports,__webpack_require__){eval("// 20.1.2.3 Number.isInteger(number)\nvar $export = __webpack_require__(1);\n\n$export($export.S, 'Number', { isInteger: __webpack_require__(103) });\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTU4LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9lczYubnVtYmVyLmlzLWludGVnZXIuanM/N2NkZiJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyAyMC4xLjIuMyBOdW1iZXIuaXNJbnRlZ2VyKG51bWJlcilcbnZhciAkZXhwb3J0ID0gcmVxdWlyZSgnLi9fZXhwb3J0Jyk7XG5cbiRleHBvcnQoJGV4cG9ydC5TLCAnTnVtYmVyJywgeyBpc0ludGVnZXI6IHJlcXVpcmUoJy4vX2lzLWludGVnZXInKSB9KTtcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7Iiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///158\n")},function(module,exports,__webpack_require__){eval("// 20.1.2.4 Number.isNaN(number)\nvar $export = __webpack_require__(1);\n\n$export($export.S, 'Number', {\n  isNaN: function isNaN(number) {\n    // eslint-disable-next-line no-self-compare\n    return number != number;\n  }\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTU5LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9lczYubnVtYmVyLmlzLW5hbi5qcz9lZTFkIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIDIwLjEuMi40IE51bWJlci5pc05hTihudW1iZXIpXG52YXIgJGV4cG9ydCA9IHJlcXVpcmUoJy4vX2V4cG9ydCcpO1xuXG4kZXhwb3J0KCRleHBvcnQuUywgJ051bWJlcicsIHtcbiAgaXNOYU46IGZ1bmN0aW9uIGlzTmFOKG51bWJlcikge1xuICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1zZWxmLWNvbXBhcmVcbiAgICByZXR1cm4gbnVtYmVyICE9IG51bWJlcjtcbiAgfVxufSk7XG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///159\n")},function(module,exports,__webpack_require__){eval("// 20.1.2.5 Number.isSafeInteger(number)\nvar $export = __webpack_require__(1);\nvar isInteger = __webpack_require__(103);\nvar abs = Math.abs;\n\n$export($export.S, 'Number', {\n  isSafeInteger: function isSafeInteger(number) {\n    return isInteger(number) && abs(number) <= 0x1fffffffffffff;\n  }\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTYwLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9lczYubnVtYmVyLmlzLXNhZmUtaW50ZWdlci5qcz9iMWIxIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIDIwLjEuMi41IE51bWJlci5pc1NhZmVJbnRlZ2VyKG51bWJlcilcbnZhciAkZXhwb3J0ID0gcmVxdWlyZSgnLi9fZXhwb3J0Jyk7XG52YXIgaXNJbnRlZ2VyID0gcmVxdWlyZSgnLi9faXMtaW50ZWdlcicpO1xudmFyIGFicyA9IE1hdGguYWJzO1xuXG4kZXhwb3J0KCRleHBvcnQuUywgJ051bWJlcicsIHtcbiAgaXNTYWZlSW50ZWdlcjogZnVuY3Rpb24gaXNTYWZlSW50ZWdlcihudW1iZXIpIHtcbiAgICByZXR1cm4gaXNJbnRlZ2VyKG51bWJlcikgJiYgYWJzKG51bWJlcikgPD0gMHgxZmZmZmZmZmZmZmZmZjtcbiAgfVxufSk7XG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///160\n")},function(module,exports,__webpack_require__){eval("// 20.1.2.6 Number.MAX_SAFE_INTEGER\nvar $export = __webpack_require__(1);\n\n$export($export.S, 'Number', { MAX_SAFE_INTEGER: 0x1fffffffffffff });\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTYxLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9lczYubnVtYmVyLm1heC1zYWZlLWludGVnZXIuanM/ODdmMyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyAyMC4xLjIuNiBOdW1iZXIuTUFYX1NBRkVfSU5URUdFUlxudmFyICRleHBvcnQgPSByZXF1aXJlKCcuL19leHBvcnQnKTtcblxuJGV4cG9ydCgkZXhwb3J0LlMsICdOdW1iZXInLCB7IE1BWF9TQUZFX0lOVEVHRVI6IDB4MWZmZmZmZmZmZmZmZmYgfSk7XG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///161\n")},function(module,exports,__webpack_require__){eval("// 20.1.2.10 Number.MIN_SAFE_INTEGER\nvar $export = __webpack_require__(1);\n\n$export($export.S, 'Number', { MIN_SAFE_INTEGER: -0x1fffffffffffff });\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTYyLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9lczYubnVtYmVyLm1pbi1zYWZlLWludGVnZXIuanM/OTI3OCJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyAyMC4xLjIuMTAgTnVtYmVyLk1JTl9TQUZFX0lOVEVHRVJcbnZhciAkZXhwb3J0ID0gcmVxdWlyZSgnLi9fZXhwb3J0Jyk7XG5cbiRleHBvcnQoJGV4cG9ydC5TLCAnTnVtYmVyJywgeyBNSU5fU0FGRV9JTlRFR0VSOiAtMHgxZmZmZmZmZmZmZmZmZiB9KTtcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7Iiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///162\n")},function(module,exports,__webpack_require__){eval("var $export = __webpack_require__(1);\nvar $parseFloat = __webpack_require__(101);\n// 20.1.2.12 Number.parseFloat(string)\n$export($export.S + $export.F * (Number.parseFloat != $parseFloat), 'Number', { parseFloat: $parseFloat });\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTYzLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9lczYubnVtYmVyLnBhcnNlLWZsb2F0LmpzPzVkZjIiXSwic291cmNlc0NvbnRlbnQiOlsidmFyICRleHBvcnQgPSByZXF1aXJlKCcuL19leHBvcnQnKTtcbnZhciAkcGFyc2VGbG9hdCA9IHJlcXVpcmUoJy4vX3BhcnNlLWZsb2F0Jyk7XG4vLyAyMC4xLjIuMTIgTnVtYmVyLnBhcnNlRmxvYXQoc3RyaW5nKVxuJGV4cG9ydCgkZXhwb3J0LlMgKyAkZXhwb3J0LkYgKiAoTnVtYmVyLnBhcnNlRmxvYXQgIT0gJHBhcnNlRmxvYXQpLCAnTnVtYmVyJywgeyBwYXJzZUZsb2F0OiAkcGFyc2VGbG9hdCB9KTtcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7Iiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///163\n")},function(module,exports,__webpack_require__){eval("var $export = __webpack_require__(1);\nvar $parseInt = __webpack_require__(100);\n// 20.1.2.13 Number.parseInt(string, radix)\n$export($export.S + $export.F * (Number.parseInt != $parseInt), 'Number', { parseInt: $parseInt });\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTY0LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9lczYubnVtYmVyLnBhcnNlLWludC5qcz8wNGZmIl0sInNvdXJjZXNDb250ZW50IjpbInZhciAkZXhwb3J0ID0gcmVxdWlyZSgnLi9fZXhwb3J0Jyk7XG52YXIgJHBhcnNlSW50ID0gcmVxdWlyZSgnLi9fcGFyc2UtaW50Jyk7XG4vLyAyMC4xLjIuMTMgTnVtYmVyLnBhcnNlSW50KHN0cmluZywgcmFkaXgpXG4kZXhwb3J0KCRleHBvcnQuUyArICRleHBvcnQuRiAqIChOdW1iZXIucGFyc2VJbnQgIT0gJHBhcnNlSW50KSwgJ051bWJlcicsIHsgcGFyc2VJbnQ6ICRwYXJzZUludCB9KTtcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7Iiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///164\n")},function(module,exports,__webpack_require__){eval("// 20.2.2.3 Math.acosh(x)\nvar $export = __webpack_require__(1);\nvar log1p = __webpack_require__(104);\nvar sqrt = Math.sqrt;\nvar $acosh = Math.acosh;\n\n$export($export.S + $export.F * !($acosh\n  // V8 bug: https://code.google.com/p/v8/issues/detail?id=3509\n  && Math.floor($acosh(Number.MAX_VALUE)) == 710\n  // Tor Browser bug: Math.acosh(Infinity) -> NaN\n  && $acosh(Infinity) == Infinity\n), 'Math', {\n  acosh: function acosh(x) {\n    return (x = +x) < 1 ? NaN : x > 94906265.62425156\n      ? Math.log(x) + Math.LN2\n      : log1p(x - 1 + sqrt(x - 1) * sqrt(x + 1));\n  }\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTY1LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9lczYubWF0aC5hY29zaC5qcz83ZjI1Il0sInNvdXJjZXNDb250ZW50IjpbIi8vIDIwLjIuMi4zIE1hdGguYWNvc2goeClcbnZhciAkZXhwb3J0ID0gcmVxdWlyZSgnLi9fZXhwb3J0Jyk7XG52YXIgbG9nMXAgPSByZXF1aXJlKCcuL19tYXRoLWxvZzFwJyk7XG52YXIgc3FydCA9IE1hdGguc3FydDtcbnZhciAkYWNvc2ggPSBNYXRoLmFjb3NoO1xuXG4kZXhwb3J0KCRleHBvcnQuUyArICRleHBvcnQuRiAqICEoJGFjb3NoXG4gIC8vIFY4IGJ1ZzogaHR0cHM6Ly9jb2RlLmdvb2dsZS5jb20vcC92OC9pc3N1ZXMvZGV0YWlsP2lkPTM1MDlcbiAgJiYgTWF0aC5mbG9vcigkYWNvc2goTnVtYmVyLk1BWF9WQUxVRSkpID09IDcxMFxuICAvLyBUb3IgQnJvd3NlciBidWc6IE1hdGguYWNvc2goSW5maW5pdHkpIC0+IE5hTlxuICAmJiAkYWNvc2goSW5maW5pdHkpID09IEluZmluaXR5XG4pLCAnTWF0aCcsIHtcbiAgYWNvc2g6IGZ1bmN0aW9uIGFjb3NoKHgpIHtcbiAgICByZXR1cm4gKHggPSAreCkgPCAxID8gTmFOIDogeCA+IDk0OTA2MjY1LjYyNDI1MTU2XG4gICAgICA/IE1hdGgubG9nKHgpICsgTWF0aC5MTjJcbiAgICAgIDogbG9nMXAoeCAtIDEgKyBzcXJ0KHggLSAxKSAqIHNxcnQoeCArIDEpKTtcbiAgfVxufSk7XG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///165\n")},function(module,exports,__webpack_require__){eval("// 20.2.2.5 Math.asinh(x)\nvar $export = __webpack_require__(1);\nvar $asinh = Math.asinh;\n\nfunction asinh(x) {\n  return !isFinite(x = +x) || x == 0 ? x : x < 0 ? -asinh(-x) : Math.log(x + Math.sqrt(x * x + 1));\n}\n\n// Tor Browser bug: Math.asinh(0) -> -0\n$export($export.S + $export.F * !($asinh && 1 / $asinh(0) > 0), 'Math', { asinh: asinh });\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTY2LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9lczYubWF0aC5hc2luaC5qcz81MzZiIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIDIwLjIuMi41IE1hdGguYXNpbmgoeClcbnZhciAkZXhwb3J0ID0gcmVxdWlyZSgnLi9fZXhwb3J0Jyk7XG52YXIgJGFzaW5oID0gTWF0aC5hc2luaDtcblxuZnVuY3Rpb24gYXNpbmgoeCkge1xuICByZXR1cm4gIWlzRmluaXRlKHggPSAreCkgfHwgeCA9PSAwID8geCA6IHggPCAwID8gLWFzaW5oKC14KSA6IE1hdGgubG9nKHggKyBNYXRoLnNxcnQoeCAqIHggKyAxKSk7XG59XG5cbi8vIFRvciBCcm93c2VyIGJ1ZzogTWF0aC5hc2luaCgwKSAtPiAtMFxuJGV4cG9ydCgkZXhwb3J0LlMgKyAkZXhwb3J0LkYgKiAhKCRhc2luaCAmJiAxIC8gJGFzaW5oKDApID4gMCksICdNYXRoJywgeyBhc2luaDogYXNpbmggfSk7XG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///166\n")},function(module,exports,__webpack_require__){eval("// 20.2.2.7 Math.atanh(x)\nvar $export = __webpack_require__(1);\nvar $atanh = Math.atanh;\n\n// Tor Browser bug: Math.atanh(-0) -> 0\n$export($export.S + $export.F * !($atanh && 1 / $atanh(-0) < 0), 'Math', {\n  atanh: function atanh(x) {\n    return (x = +x) == 0 ? x : Math.log((1 + x) / (1 - x)) / 2;\n  }\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTY3LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9lczYubWF0aC5hdGFuaC5qcz9kOWFiIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIDIwLjIuMi43IE1hdGguYXRhbmgoeClcbnZhciAkZXhwb3J0ID0gcmVxdWlyZSgnLi9fZXhwb3J0Jyk7XG52YXIgJGF0YW5oID0gTWF0aC5hdGFuaDtcblxuLy8gVG9yIEJyb3dzZXIgYnVnOiBNYXRoLmF0YW5oKC0wKSAtPiAwXG4kZXhwb3J0KCRleHBvcnQuUyArICRleHBvcnQuRiAqICEoJGF0YW5oICYmIDEgLyAkYXRhbmgoLTApIDwgMCksICdNYXRoJywge1xuICBhdGFuaDogZnVuY3Rpb24gYXRhbmgoeCkge1xuICAgIHJldHVybiAoeCA9ICt4KSA9PSAwID8geCA6IE1hdGgubG9nKCgxICsgeCkgLyAoMSAtIHgpKSAvIDI7XG4gIH1cbn0pO1xuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///167\n")},function(module,exports,__webpack_require__){eval("// 20.2.2.9 Math.cbrt(x)\nvar $export = __webpack_require__(1);\nvar sign = __webpack_require__(70);\n\n$export($export.S, 'Math', {\n  cbrt: function cbrt(x) {\n    return sign(x = +x) * Math.pow(Math.abs(x), 1 / 3);\n  }\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTY4LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9lczYubWF0aC5jYnJ0LmpzP2Y5YWIiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gMjAuMi4yLjkgTWF0aC5jYnJ0KHgpXG52YXIgJGV4cG9ydCA9IHJlcXVpcmUoJy4vX2V4cG9ydCcpO1xudmFyIHNpZ24gPSByZXF1aXJlKCcuL19tYXRoLXNpZ24nKTtcblxuJGV4cG9ydCgkZXhwb3J0LlMsICdNYXRoJywge1xuICBjYnJ0OiBmdW5jdGlvbiBjYnJ0KHgpIHtcbiAgICByZXR1cm4gc2lnbih4ID0gK3gpICogTWF0aC5wb3coTWF0aC5hYnMoeCksIDEgLyAzKTtcbiAgfVxufSk7XG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///168\n")},function(module,exports,__webpack_require__){eval("// 20.2.2.11 Math.clz32(x)\nvar $export = __webpack_require__(1);\n\n$export($export.S, 'Math', {\n  clz32: function clz32(x) {\n    return (x >>>= 0) ? 31 - Math.floor(Math.log(x + 0.5) * Math.LOG2E) : 32;\n  }\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTY5LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9lczYubWF0aC5jbHozMi5qcz8zMmQ3Il0sInNvdXJjZXNDb250ZW50IjpbIi8vIDIwLjIuMi4xMSBNYXRoLmNsejMyKHgpXG52YXIgJGV4cG9ydCA9IHJlcXVpcmUoJy4vX2V4cG9ydCcpO1xuXG4kZXhwb3J0KCRleHBvcnQuUywgJ01hdGgnLCB7XG4gIGNsejMyOiBmdW5jdGlvbiBjbHozMih4KSB7XG4gICAgcmV0dXJuICh4ID4+Pj0gMCkgPyAzMSAtIE1hdGguZmxvb3IoTWF0aC5sb2coeCArIDAuNSkgKiBNYXRoLkxPRzJFKSA6IDMyO1xuICB9XG59KTtcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///169\n")},function(module,exports,__webpack_require__){eval("// 20.2.2.12 Math.cosh(x)\nvar $export = __webpack_require__(1);\nvar exp = Math.exp;\n\n$export($export.S, 'Math', {\n  cosh: function cosh(x) {\n    return (exp(x = +x) + exp(-x)) / 2;\n  }\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTcwLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9lczYubWF0aC5jb3NoLmpzPzI1YzkiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gMjAuMi4yLjEyIE1hdGguY29zaCh4KVxudmFyICRleHBvcnQgPSByZXF1aXJlKCcuL19leHBvcnQnKTtcbnZhciBleHAgPSBNYXRoLmV4cDtcblxuJGV4cG9ydCgkZXhwb3J0LlMsICdNYXRoJywge1xuICBjb3NoOiBmdW5jdGlvbiBjb3NoKHgpIHtcbiAgICByZXR1cm4gKGV4cCh4ID0gK3gpICsgZXhwKC14KSkgLyAyO1xuICB9XG59KTtcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///170\n")},function(module,exports,__webpack_require__){eval("// 20.2.2.14 Math.expm1(x)\nvar $export = __webpack_require__(1);\nvar $expm1 = __webpack_require__(71);\n\n$export($export.S + $export.F * ($expm1 != Math.expm1), 'Math', { expm1: $expm1 });\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTcxLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9lczYubWF0aC5leHBtMS5qcz85ZjNjIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIDIwLjIuMi4xNCBNYXRoLmV4cG0xKHgpXG52YXIgJGV4cG9ydCA9IHJlcXVpcmUoJy4vX2V4cG9ydCcpO1xudmFyICRleHBtMSA9IHJlcXVpcmUoJy4vX21hdGgtZXhwbTEnKTtcblxuJGV4cG9ydCgkZXhwb3J0LlMgKyAkZXhwb3J0LkYgKiAoJGV4cG0xICE9IE1hdGguZXhwbTEpLCAnTWF0aCcsIHsgZXhwbTE6ICRleHBtMSB9KTtcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///171\n")},function(module,exports,__webpack_require__){eval("// 20.2.2.16 Math.fround(x)\nvar $export = __webpack_require__(1);\n\n$export($export.S, 'Math', { fround: __webpack_require__(173) });\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTcyLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9lczYubWF0aC5mcm91bmQuanM/MDQyZSJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyAyMC4yLjIuMTYgTWF0aC5mcm91bmQoeClcbnZhciAkZXhwb3J0ID0gcmVxdWlyZSgnLi9fZXhwb3J0Jyk7XG5cbiRleHBvcnQoJGV4cG9ydC5TLCAnTWF0aCcsIHsgZnJvdW5kOiByZXF1aXJlKCcuL19tYXRoLWZyb3VuZCcpIH0pO1xuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///172\n")},function(module,exports,__webpack_require__){eval("// 20.2.2.16 Math.fround(x)\nvar sign = __webpack_require__(70);\nvar pow = Math.pow;\nvar EPSILON = pow(2, -52);\nvar EPSILON32 = pow(2, -23);\nvar MAX32 = pow(2, 127) * (2 - EPSILON32);\nvar MIN32 = pow(2, -126);\n\nvar roundTiesToEven = function (n) {\n  return n + 1 / EPSILON - 1 / EPSILON;\n};\n\nmodule.exports = Math.fround || function fround(x) {\n  var $abs = Math.abs(x);\n  var $sign = sign(x);\n  var a, result;\n  if ($abs < MIN32) return $sign * roundTiesToEven($abs / MIN32 / EPSILON32) * MIN32 * EPSILON32;\n  a = (1 + EPSILON32 / EPSILON) * $abs;\n  result = a - (a - $abs);\n  // eslint-disable-next-line no-self-compare\n  if (result > MAX32 || result != result) return $sign * Infinity;\n  return $sign * result;\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTczLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9fbWF0aC1mcm91bmQuanM/OTFjYSJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyAyMC4yLjIuMTYgTWF0aC5mcm91bmQoeClcbnZhciBzaWduID0gcmVxdWlyZSgnLi9fbWF0aC1zaWduJyk7XG52YXIgcG93ID0gTWF0aC5wb3c7XG52YXIgRVBTSUxPTiA9IHBvdygyLCAtNTIpO1xudmFyIEVQU0lMT04zMiA9IHBvdygyLCAtMjMpO1xudmFyIE1BWDMyID0gcG93KDIsIDEyNykgKiAoMiAtIEVQU0lMT04zMik7XG52YXIgTUlOMzIgPSBwb3coMiwgLTEyNik7XG5cbnZhciByb3VuZFRpZXNUb0V2ZW4gPSBmdW5jdGlvbiAobikge1xuICByZXR1cm4gbiArIDEgLyBFUFNJTE9OIC0gMSAvIEVQU0lMT047XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IE1hdGguZnJvdW5kIHx8IGZ1bmN0aW9uIGZyb3VuZCh4KSB7XG4gIHZhciAkYWJzID0gTWF0aC5hYnMoeCk7XG4gIHZhciAkc2lnbiA9IHNpZ24oeCk7XG4gIHZhciBhLCByZXN1bHQ7XG4gIGlmICgkYWJzIDwgTUlOMzIpIHJldHVybiAkc2lnbiAqIHJvdW5kVGllc1RvRXZlbigkYWJzIC8gTUlOMzIgLyBFUFNJTE9OMzIpICogTUlOMzIgKiBFUFNJTE9OMzI7XG4gIGEgPSAoMSArIEVQU0lMT04zMiAvIEVQU0lMT04pICogJGFicztcbiAgcmVzdWx0ID0gYSAtIChhIC0gJGFicyk7XG4gIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1zZWxmLWNvbXBhcmVcbiAgaWYgKHJlc3VsdCA+IE1BWDMyIHx8IHJlc3VsdCAhPSByZXN1bHQpIHJldHVybiAkc2lnbiAqIEluZmluaXR5O1xuICByZXR1cm4gJHNpZ24gKiByZXN1bHQ7XG59O1xuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///173\n")},function(module,exports,__webpack_require__){eval("// 20.2.2.17 Math.hypot([value1[, value2[, … ]]])\nvar $export = __webpack_require__(1);\nvar abs = Math.abs;\n\n$export($export.S, 'Math', {\n  hypot: function hypot(value1, value2) { // eslint-disable-line no-unused-vars\n    var sum = 0;\n    var i = 0;\n    var aLen = arguments.length;\n    var larg = 0;\n    var arg, div;\n    while (i < aLen) {\n      arg = abs(arguments[i++]);\n      if (larg < arg) {\n        div = larg / arg;\n        sum = sum * div * div + 1;\n        larg = arg;\n      } else if (arg > 0) {\n        div = arg / larg;\n        sum += div * div;\n      } else sum += arg;\n    }\n    return larg === Infinity ? Infinity : larg * Math.sqrt(sum);\n  }\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTc0LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9lczYubWF0aC5oeXBvdC5qcz9jN2M2Il0sInNvdXJjZXNDb250ZW50IjpbIi8vIDIwLjIuMi4xNyBNYXRoLmh5cG90KFt2YWx1ZTFbLCB2YWx1ZTJbLCDigKYgXV1dKVxudmFyICRleHBvcnQgPSByZXF1aXJlKCcuL19leHBvcnQnKTtcbnZhciBhYnMgPSBNYXRoLmFicztcblxuJGV4cG9ydCgkZXhwb3J0LlMsICdNYXRoJywge1xuICBoeXBvdDogZnVuY3Rpb24gaHlwb3QodmFsdWUxLCB2YWx1ZTIpIHsgLy8gZXNsaW50LWRpc2FibGUtbGluZSBuby11bnVzZWQtdmFyc1xuICAgIHZhciBzdW0gPSAwO1xuICAgIHZhciBpID0gMDtcbiAgICB2YXIgYUxlbiA9IGFyZ3VtZW50cy5sZW5ndGg7XG4gICAgdmFyIGxhcmcgPSAwO1xuICAgIHZhciBhcmcsIGRpdjtcbiAgICB3aGlsZSAoaSA8IGFMZW4pIHtcbiAgICAgIGFyZyA9IGFicyhhcmd1bWVudHNbaSsrXSk7XG4gICAgICBpZiAobGFyZyA8IGFyZykge1xuICAgICAgICBkaXYgPSBsYXJnIC8gYXJnO1xuICAgICAgICBzdW0gPSBzdW0gKiBkaXYgKiBkaXYgKyAxO1xuICAgICAgICBsYXJnID0gYXJnO1xuICAgICAgfSBlbHNlIGlmIChhcmcgPiAwKSB7XG4gICAgICAgIGRpdiA9IGFyZyAvIGxhcmc7XG4gICAgICAgIHN1bSArPSBkaXYgKiBkaXY7XG4gICAgICB9IGVsc2Ugc3VtICs9IGFyZztcbiAgICB9XG4gICAgcmV0dXJuIGxhcmcgPT09IEluZmluaXR5ID8gSW5maW5pdHkgOiBsYXJnICogTWF0aC5zcXJ0KHN1bSk7XG4gIH1cbn0pO1xuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///174\n")},function(module,exports,__webpack_require__){eval("// 20.2.2.18 Math.imul(x, y)\nvar $export = __webpack_require__(1);\nvar $imul = Math.imul;\n\n// some WebKit versions fails with big numbers, some has wrong arity\n$export($export.S + $export.F * __webpack_require__(3)(function () {\n  return $imul(0xffffffff, 5) != -5 || $imul.length != 2;\n}), 'Math', {\n  imul: function imul(x, y) {\n    var UINT16 = 0xffff;\n    var xn = +x;\n    var yn = +y;\n    var xl = UINT16 & xn;\n    var yl = UINT16 & yn;\n    return 0 | xl * yl + ((UINT16 & xn >>> 16) * yl + xl * (UINT16 & yn >>> 16) << 16 >>> 0);\n  }\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTc1LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9lczYubWF0aC5pbXVsLmpzP2Y0ZmYiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gMjAuMi4yLjE4IE1hdGguaW11bCh4LCB5KVxudmFyICRleHBvcnQgPSByZXF1aXJlKCcuL19leHBvcnQnKTtcbnZhciAkaW11bCA9IE1hdGguaW11bDtcblxuLy8gc29tZSBXZWJLaXQgdmVyc2lvbnMgZmFpbHMgd2l0aCBiaWcgbnVtYmVycywgc29tZSBoYXMgd3JvbmcgYXJpdHlcbiRleHBvcnQoJGV4cG9ydC5TICsgJGV4cG9ydC5GICogcmVxdWlyZSgnLi9fZmFpbHMnKShmdW5jdGlvbiAoKSB7XG4gIHJldHVybiAkaW11bCgweGZmZmZmZmZmLCA1KSAhPSAtNSB8fCAkaW11bC5sZW5ndGggIT0gMjtcbn0pLCAnTWF0aCcsIHtcbiAgaW11bDogZnVuY3Rpb24gaW11bCh4LCB5KSB7XG4gICAgdmFyIFVJTlQxNiA9IDB4ZmZmZjtcbiAgICB2YXIgeG4gPSAreDtcbiAgICB2YXIgeW4gPSAreTtcbiAgICB2YXIgeGwgPSBVSU5UMTYgJiB4bjtcbiAgICB2YXIgeWwgPSBVSU5UMTYgJiB5bjtcbiAgICByZXR1cm4gMCB8IHhsICogeWwgKyAoKFVJTlQxNiAmIHhuID4+PiAxNikgKiB5bCArIHhsICogKFVJTlQxNiAmIHluID4+PiAxNikgPDwgMTYgPj4+IDApO1xuICB9XG59KTtcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///175\n")},function(module,exports,__webpack_require__){eval("// 20.2.2.21 Math.log10(x)\nvar $export = __webpack_require__(1);\n\n$export($export.S, 'Math', {\n  log10: function log10(x) {\n    return Math.log(x) * Math.LOG10E;\n  }\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTc2LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9lczYubWF0aC5sb2cxMC5qcz83ODcyIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIDIwLjIuMi4yMSBNYXRoLmxvZzEwKHgpXG52YXIgJGV4cG9ydCA9IHJlcXVpcmUoJy4vX2V4cG9ydCcpO1xuXG4kZXhwb3J0KCRleHBvcnQuUywgJ01hdGgnLCB7XG4gIGxvZzEwOiBmdW5jdGlvbiBsb2cxMCh4KSB7XG4gICAgcmV0dXJuIE1hdGgubG9nKHgpICogTWF0aC5MT0cxMEU7XG4gIH1cbn0pO1xuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///176\n")},function(module,exports,__webpack_require__){eval("// 20.2.2.20 Math.log1p(x)\nvar $export = __webpack_require__(1);\n\n$export($export.S, 'Math', { log1p: __webpack_require__(104) });\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTc3LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9lczYubWF0aC5sb2cxcC5qcz8wNDlmIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIDIwLjIuMi4yMCBNYXRoLmxvZzFwKHgpXG52YXIgJGV4cG9ydCA9IHJlcXVpcmUoJy4vX2V4cG9ydCcpO1xuXG4kZXhwb3J0KCRleHBvcnQuUywgJ01hdGgnLCB7IGxvZzFwOiByZXF1aXJlKCcuL19tYXRoLWxvZzFwJykgfSk7XG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///177\n")},function(module,exports,__webpack_require__){eval("// 20.2.2.22 Math.log2(x)\nvar $export = __webpack_require__(1);\n\n$export($export.S, 'Math', {\n  log2: function log2(x) {\n    return Math.log(x) / Math.LN2;\n  }\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTc4LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9lczYubWF0aC5sb2cyLmpzP2E2OWYiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gMjAuMi4yLjIyIE1hdGgubG9nMih4KVxudmFyICRleHBvcnQgPSByZXF1aXJlKCcuL19leHBvcnQnKTtcblxuJGV4cG9ydCgkZXhwb3J0LlMsICdNYXRoJywge1xuICBsb2cyOiBmdW5jdGlvbiBsb2cyKHgpIHtcbiAgICByZXR1cm4gTWF0aC5sb2coeCkgLyBNYXRoLkxOMjtcbiAgfVxufSk7XG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Iiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///178\n")},function(module,exports,__webpack_require__){eval("// 20.2.2.28 Math.sign(x)\nvar $export = __webpack_require__(1);\n\n$export($export.S, 'Math', { sign: __webpack_require__(70) });\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTc5LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9lczYubWF0aC5zaWduLmpzPzBiMjEiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gMjAuMi4yLjI4IE1hdGguc2lnbih4KVxudmFyICRleHBvcnQgPSByZXF1aXJlKCcuL19leHBvcnQnKTtcblxuJGV4cG9ydCgkZXhwb3J0LlMsICdNYXRoJywgeyBzaWduOiByZXF1aXJlKCcuL19tYXRoLXNpZ24nKSB9KTtcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7Iiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///179\n")},function(module,exports,__webpack_require__){eval("// 20.2.2.30 Math.sinh(x)\nvar $export = __webpack_require__(1);\nvar expm1 = __webpack_require__(71);\nvar exp = Math.exp;\n\n// V8 near Chromium 38 has a problem with very small numbers\n$export($export.S + $export.F * __webpack_require__(3)(function () {\n  return !Math.sinh(-2e-17) != -2e-17;\n}), 'Math', {\n  sinh: function sinh(x) {\n    return Math.abs(x = +x) < 1\n      ? (expm1(x) - expm1(-x)) / 2\n      : (exp(x - 1) - exp(-x - 1)) * (Math.E / 2);\n  }\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTgwLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9lczYubWF0aC5zaW5oLmpzPzZjMWEiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gMjAuMi4yLjMwIE1hdGguc2luaCh4KVxudmFyICRleHBvcnQgPSByZXF1aXJlKCcuL19leHBvcnQnKTtcbnZhciBleHBtMSA9IHJlcXVpcmUoJy4vX21hdGgtZXhwbTEnKTtcbnZhciBleHAgPSBNYXRoLmV4cDtcblxuLy8gVjggbmVhciBDaHJvbWl1bSAzOCBoYXMgYSBwcm9ibGVtIHdpdGggdmVyeSBzbWFsbCBudW1iZXJzXG4kZXhwb3J0KCRleHBvcnQuUyArICRleHBvcnQuRiAqIHJlcXVpcmUoJy4vX2ZhaWxzJykoZnVuY3Rpb24gKCkge1xuICByZXR1cm4gIU1hdGguc2luaCgtMmUtMTcpICE9IC0yZS0xNztcbn0pLCAnTWF0aCcsIHtcbiAgc2luaDogZnVuY3Rpb24gc2luaCh4KSB7XG4gICAgcmV0dXJuIE1hdGguYWJzKHggPSAreCkgPCAxXG4gICAgICA/IChleHBtMSh4KSAtIGV4cG0xKC14KSkgLyAyXG4gICAgICA6IChleHAoeCAtIDEpIC0gZXhwKC14IC0gMSkpICogKE1hdGguRSAvIDIpO1xuICB9XG59KTtcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///180\n")},function(module,exports,__webpack_require__){eval("// 20.2.2.33 Math.tanh(x)\nvar $export = __webpack_require__(1);\nvar expm1 = __webpack_require__(71);\nvar exp = Math.exp;\n\n$export($export.S, 'Math', {\n  tanh: function tanh(x) {\n    var a = expm1(x = +x);\n    var b = expm1(-x);\n    return a == Infinity ? 1 : b == Infinity ? -1 : (a - b) / (exp(x) + exp(-x));\n  }\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTgxLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9lczYubWF0aC50YW5oLmpzP2M3YzYiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gMjAuMi4yLjMzIE1hdGgudGFuaCh4KVxudmFyICRleHBvcnQgPSByZXF1aXJlKCcuL19leHBvcnQnKTtcbnZhciBleHBtMSA9IHJlcXVpcmUoJy4vX21hdGgtZXhwbTEnKTtcbnZhciBleHAgPSBNYXRoLmV4cDtcblxuJGV4cG9ydCgkZXhwb3J0LlMsICdNYXRoJywge1xuICB0YW5oOiBmdW5jdGlvbiB0YW5oKHgpIHtcbiAgICB2YXIgYSA9IGV4cG0xKHggPSAreCk7XG4gICAgdmFyIGIgPSBleHBtMSgteCk7XG4gICAgcmV0dXJuIGEgPT0gSW5maW5pdHkgPyAxIDogYiA9PSBJbmZpbml0eSA/IC0xIDogKGEgLSBiKSAvIChleHAoeCkgKyBleHAoLXgpKTtcbiAgfVxufSk7XG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///181\n")},function(module,exports,__webpack_require__){eval("// 20.2.2.34 Math.trunc(x)\nvar $export = __webpack_require__(1);\n\n$export($export.S, 'Math', {\n  trunc: function trunc(it) {\n    return (it > 0 ? Math.floor : Math.ceil)(it);\n  }\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTgyLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9lczYubWF0aC50cnVuYy5qcz84NGI0Il0sInNvdXJjZXNDb250ZW50IjpbIi8vIDIwLjIuMi4zNCBNYXRoLnRydW5jKHgpXG52YXIgJGV4cG9ydCA9IHJlcXVpcmUoJy4vX2V4cG9ydCcpO1xuXG4kZXhwb3J0KCRleHBvcnQuUywgJ01hdGgnLCB7XG4gIHRydW5jOiBmdW5jdGlvbiB0cnVuYyhpdCkge1xuICAgIHJldHVybiAoaXQgPiAwID8gTWF0aC5mbG9vciA6IE1hdGguY2VpbCkoaXQpO1xuICB9XG59KTtcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///182\n")},function(module,exports,__webpack_require__){eval("var $export = __webpack_require__(1);\nvar toAbsoluteIndex = __webpack_require__(33);\nvar fromCharCode = String.fromCharCode;\nvar $fromCodePoint = String.fromCodePoint;\n\n// length should be 1, old FF problem\n$export($export.S + $export.F * (!!$fromCodePoint && $fromCodePoint.length != 1), 'String', {\n  // 21.1.2.2 String.fromCodePoint(...codePoints)\n  fromCodePoint: function fromCodePoint(x) { // eslint-disable-line no-unused-vars\n    var res = [];\n    var aLen = arguments.length;\n    var i = 0;\n    var code;\n    while (aLen > i) {\n      code = +arguments[i++];\n      if (toAbsoluteIndex(code, 0x10ffff) !== code) throw RangeError(code + ' is not a valid code point');\n      res.push(code < 0x10000\n        ? fromCharCode(code)\n        : fromCharCode(((code -= 0x10000) >> 10) + 0xd800, code % 0x400 + 0xdc00)\n      );\n    } return res.join('');\n  }\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTgzLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9lczYuc3RyaW5nLmZyb20tY29kZS1wb2ludC5qcz81Njk1Il0sInNvdXJjZXNDb250ZW50IjpbInZhciAkZXhwb3J0ID0gcmVxdWlyZSgnLi9fZXhwb3J0Jyk7XG52YXIgdG9BYnNvbHV0ZUluZGV4ID0gcmVxdWlyZSgnLi9fdG8tYWJzb2x1dGUtaW5kZXgnKTtcbnZhciBmcm9tQ2hhckNvZGUgPSBTdHJpbmcuZnJvbUNoYXJDb2RlO1xudmFyICRmcm9tQ29kZVBvaW50ID0gU3RyaW5nLmZyb21Db2RlUG9pbnQ7XG5cbi8vIGxlbmd0aCBzaG91bGQgYmUgMSwgb2xkIEZGIHByb2JsZW1cbiRleHBvcnQoJGV4cG9ydC5TICsgJGV4cG9ydC5GICogKCEhJGZyb21Db2RlUG9pbnQgJiYgJGZyb21Db2RlUG9pbnQubGVuZ3RoICE9IDEpLCAnU3RyaW5nJywge1xuICAvLyAyMS4xLjIuMiBTdHJpbmcuZnJvbUNvZGVQb2ludCguLi5jb2RlUG9pbnRzKVxuICBmcm9tQ29kZVBvaW50OiBmdW5jdGlvbiBmcm9tQ29kZVBvaW50KHgpIHsgLy8gZXNsaW50LWRpc2FibGUtbGluZSBuby11bnVzZWQtdmFyc1xuICAgIHZhciByZXMgPSBbXTtcbiAgICB2YXIgYUxlbiA9IGFyZ3VtZW50cy5sZW5ndGg7XG4gICAgdmFyIGkgPSAwO1xuICAgIHZhciBjb2RlO1xuICAgIHdoaWxlIChhTGVuID4gaSkge1xuICAgICAgY29kZSA9ICthcmd1bWVudHNbaSsrXTtcbiAgICAgIGlmICh0b0Fic29sdXRlSW5kZXgoY29kZSwgMHgxMGZmZmYpICE9PSBjb2RlKSB0aHJvdyBSYW5nZUVycm9yKGNvZGUgKyAnIGlzIG5vdCBhIHZhbGlkIGNvZGUgcG9pbnQnKTtcbiAgICAgIHJlcy5wdXNoKGNvZGUgPCAweDEwMDAwXG4gICAgICAgID8gZnJvbUNoYXJDb2RlKGNvZGUpXG4gICAgICAgIDogZnJvbUNoYXJDb2RlKCgoY29kZSAtPSAweDEwMDAwKSA+PiAxMCkgKyAweGQ4MDAsIGNvZGUgJSAweDQwMCArIDB4ZGMwMClcbiAgICAgICk7XG4gICAgfSByZXR1cm4gcmVzLmpvaW4oJycpO1xuICB9XG59KTtcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///183\n")},function(module,exports,__webpack_require__){eval("var $export = __webpack_require__(1);\nvar toIObject = __webpack_require__(16);\nvar toLength = __webpack_require__(7);\n\n$export($export.S, 'String', {\n  // 21.1.2.4 String.raw(callSite, ...substitutions)\n  raw: function raw(callSite) {\n    var tpl = toIObject(callSite.raw);\n    var len = toLength(tpl.length);\n    var aLen = arguments.length;\n    var res = [];\n    var i = 0;\n    while (len > i) {\n      res.push(String(tpl[i++]));\n      if (i < aLen) res.push(String(arguments[i]));\n    } return res.join('');\n  }\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTg0LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9lczYuc3RyaW5nLnJhdy5qcz83ODhkIl0sInNvdXJjZXNDb250ZW50IjpbInZhciAkZXhwb3J0ID0gcmVxdWlyZSgnLi9fZXhwb3J0Jyk7XG52YXIgdG9JT2JqZWN0ID0gcmVxdWlyZSgnLi9fdG8taW9iamVjdCcpO1xudmFyIHRvTGVuZ3RoID0gcmVxdWlyZSgnLi9fdG8tbGVuZ3RoJyk7XG5cbiRleHBvcnQoJGV4cG9ydC5TLCAnU3RyaW5nJywge1xuICAvLyAyMS4xLjIuNCBTdHJpbmcucmF3KGNhbGxTaXRlLCAuLi5zdWJzdGl0dXRpb25zKVxuICByYXc6IGZ1bmN0aW9uIHJhdyhjYWxsU2l0ZSkge1xuICAgIHZhciB0cGwgPSB0b0lPYmplY3QoY2FsbFNpdGUucmF3KTtcbiAgICB2YXIgbGVuID0gdG9MZW5ndGgodHBsLmxlbmd0aCk7XG4gICAgdmFyIGFMZW4gPSBhcmd1bWVudHMubGVuZ3RoO1xuICAgIHZhciByZXMgPSBbXTtcbiAgICB2YXIgaSA9IDA7XG4gICAgd2hpbGUgKGxlbiA+IGkpIHtcbiAgICAgIHJlcy5wdXNoKFN0cmluZyh0cGxbaSsrXSkpO1xuICAgICAgaWYgKGkgPCBhTGVuKSByZXMucHVzaChTdHJpbmcoYXJndW1lbnRzW2ldKSk7XG4gICAgfSByZXR1cm4gcmVzLmpvaW4oJycpO1xuICB9XG59KTtcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///184\n")},function(module,exports,__webpack_require__){"use strict";eval("\n// 21.1.3.25 String.prototype.trim()\n__webpack_require__(40)('trim', function ($trim) {\n  return function trim() {\n    return $trim(this, 3);\n  };\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTg1LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9lczYuc3RyaW5nLnRyaW0uanM/NGYzNyJdLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XG4vLyAyMS4xLjMuMjUgU3RyaW5nLnByb3RvdHlwZS50cmltKClcbnJlcXVpcmUoJy4vX3N0cmluZy10cmltJykoJ3RyaW0nLCBmdW5jdGlvbiAoJHRyaW0pIHtcbiAgcmV0dXJuIGZ1bmN0aW9uIHRyaW0oKSB7XG4gICAgcmV0dXJuICR0cmltKHRoaXMsIDMpO1xuICB9O1xufSk7XG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///185\n")},function(module,exports,__webpack_require__){"use strict";eval("\nvar $at = __webpack_require__(72)(true);\n\n// 21.1.3.27 String.prototype[@@iterator]()\n__webpack_require__(73)(String, 'String', function (iterated) {\n  this._t = String(iterated); // target\n  this._i = 0;                // next index\n// 21.1.5.2.1 %StringIteratorPrototype%.next()\n}, function () {\n  var O = this._t;\n  var index = this._i;\n  var point;\n  if (index >= O.length) return { value: undefined, done: true };\n  point = $at(O, index);\n  this._i += point.length;\n  return { value: point, done: false };\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTg2LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9lczYuc3RyaW5nLml0ZXJhdG9yLmpzPzVkZjMiXSwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xudmFyICRhdCA9IHJlcXVpcmUoJy4vX3N0cmluZy1hdCcpKHRydWUpO1xuXG4vLyAyMS4xLjMuMjcgU3RyaW5nLnByb3RvdHlwZVtAQGl0ZXJhdG9yXSgpXG5yZXF1aXJlKCcuL19pdGVyLWRlZmluZScpKFN0cmluZywgJ1N0cmluZycsIGZ1bmN0aW9uIChpdGVyYXRlZCkge1xuICB0aGlzLl90ID0gU3RyaW5nKGl0ZXJhdGVkKTsgLy8gdGFyZ2V0XG4gIHRoaXMuX2kgPSAwOyAgICAgICAgICAgICAgICAvLyBuZXh0IGluZGV4XG4vLyAyMS4xLjUuMi4xICVTdHJpbmdJdGVyYXRvclByb3RvdHlwZSUubmV4dCgpXG59LCBmdW5jdGlvbiAoKSB7XG4gIHZhciBPID0gdGhpcy5fdDtcbiAgdmFyIGluZGV4ID0gdGhpcy5faTtcbiAgdmFyIHBvaW50O1xuICBpZiAoaW5kZXggPj0gTy5sZW5ndGgpIHJldHVybiB7IHZhbHVlOiB1bmRlZmluZWQsIGRvbmU6IHRydWUgfTtcbiAgcG9pbnQgPSAkYXQoTywgaW5kZXgpO1xuICB0aGlzLl9pICs9IHBvaW50Lmxlbmd0aDtcbiAgcmV0dXJuIHsgdmFsdWU6IHBvaW50LCBkb25lOiBmYWxzZSB9O1xufSk7XG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Iiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///186\n")},function(module,exports,__webpack_require__){"use strict";eval("\nvar $export = __webpack_require__(1);\nvar $at = __webpack_require__(72)(false);\n$export($export.P, 'String', {\n  // 21.1.3.3 String.prototype.codePointAt(pos)\n  codePointAt: function codePointAt(pos) {\n    return $at(this, pos);\n  }\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTg3LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9lczYuc3RyaW5nLmNvZGUtcG9pbnQtYXQuanM/YTAzMiJdLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XG52YXIgJGV4cG9ydCA9IHJlcXVpcmUoJy4vX2V4cG9ydCcpO1xudmFyICRhdCA9IHJlcXVpcmUoJy4vX3N0cmluZy1hdCcpKGZhbHNlKTtcbiRleHBvcnQoJGV4cG9ydC5QLCAnU3RyaW5nJywge1xuICAvLyAyMS4xLjMuMyBTdHJpbmcucHJvdG90eXBlLmNvZGVQb2ludEF0KHBvcylcbiAgY29kZVBvaW50QXQ6IGZ1bmN0aW9uIGNvZGVQb2ludEF0KHBvcykge1xuICAgIHJldHVybiAkYXQodGhpcywgcG9zKTtcbiAgfVxufSk7XG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///187\n")},function(module,exports,__webpack_require__){"use strict";eval("// 21.1.3.6 String.prototype.endsWith(searchString [, endPosition])\n\nvar $export = __webpack_require__(1);\nvar toLength = __webpack_require__(7);\nvar context = __webpack_require__(74);\nvar ENDS_WITH = 'endsWith';\nvar $endsWith = ''[ENDS_WITH];\n\n$export($export.P + $export.F * __webpack_require__(76)(ENDS_WITH), 'String', {\n  endsWith: function endsWith(searchString /* , endPosition = @length */) {\n    var that = context(this, searchString, ENDS_WITH);\n    var endPosition = arguments.length > 1 ? arguments[1] : undefined;\n    var len = toLength(that.length);\n    var end = endPosition === undefined ? len : Math.min(toLength(endPosition), len);\n    var search = String(searchString);\n    return $endsWith\n      ? $endsWith.call(that, search, end)\n      : that.slice(end - search.length, end) === search;\n  }\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTg4LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9lczYuc3RyaW5nLmVuZHMtd2l0aC5qcz9hZWY2Il0sInNvdXJjZXNDb250ZW50IjpbIi8vIDIxLjEuMy42IFN0cmluZy5wcm90b3R5cGUuZW5kc1dpdGgoc2VhcmNoU3RyaW5nIFssIGVuZFBvc2l0aW9uXSlcbid1c2Ugc3RyaWN0JztcbnZhciAkZXhwb3J0ID0gcmVxdWlyZSgnLi9fZXhwb3J0Jyk7XG52YXIgdG9MZW5ndGggPSByZXF1aXJlKCcuL190by1sZW5ndGgnKTtcbnZhciBjb250ZXh0ID0gcmVxdWlyZSgnLi9fc3RyaW5nLWNvbnRleHQnKTtcbnZhciBFTkRTX1dJVEggPSAnZW5kc1dpdGgnO1xudmFyICRlbmRzV2l0aCA9ICcnW0VORFNfV0lUSF07XG5cbiRleHBvcnQoJGV4cG9ydC5QICsgJGV4cG9ydC5GICogcmVxdWlyZSgnLi9fZmFpbHMtaXMtcmVnZXhwJykoRU5EU19XSVRIKSwgJ1N0cmluZycsIHtcbiAgZW5kc1dpdGg6IGZ1bmN0aW9uIGVuZHNXaXRoKHNlYXJjaFN0cmluZyAvKiAsIGVuZFBvc2l0aW9uID0gQGxlbmd0aCAqLykge1xuICAgIHZhciB0aGF0ID0gY29udGV4dCh0aGlzLCBzZWFyY2hTdHJpbmcsIEVORFNfV0lUSCk7XG4gICAgdmFyIGVuZFBvc2l0aW9uID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgPyBhcmd1bWVudHNbMV0gOiB1bmRlZmluZWQ7XG4gICAgdmFyIGxlbiA9IHRvTGVuZ3RoKHRoYXQubGVuZ3RoKTtcbiAgICB2YXIgZW5kID0gZW5kUG9zaXRpb24gPT09IHVuZGVmaW5lZCA/IGxlbiA6IE1hdGgubWluKHRvTGVuZ3RoKGVuZFBvc2l0aW9uKSwgbGVuKTtcbiAgICB2YXIgc2VhcmNoID0gU3RyaW5nKHNlYXJjaFN0cmluZyk7XG4gICAgcmV0dXJuICRlbmRzV2l0aFxuICAgICAgPyAkZW5kc1dpdGguY2FsbCh0aGF0LCBzZWFyY2gsIGVuZClcbiAgICAgIDogdGhhdC5zbGljZShlbmQgLSBzZWFyY2gubGVuZ3RoLCBlbmQpID09PSBzZWFyY2g7XG4gIH1cbn0pO1xuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///188\n")},function(module,exports,__webpack_require__){"use strict";eval("// 21.1.3.7 String.prototype.includes(searchString, position = 0)\n\nvar $export = __webpack_require__(1);\nvar context = __webpack_require__(74);\nvar INCLUDES = 'includes';\n\n$export($export.P + $export.F * __webpack_require__(76)(INCLUDES), 'String', {\n  includes: function includes(searchString /* , position = 0 */) {\n    return !!~context(this, searchString, INCLUDES)\n      .indexOf(searchString, arguments.length > 1 ? arguments[1] : undefined);\n  }\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTg5LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9lczYuc3RyaW5nLmluY2x1ZGVzLmpzPzJmZGIiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gMjEuMS4zLjcgU3RyaW5nLnByb3RvdHlwZS5pbmNsdWRlcyhzZWFyY2hTdHJpbmcsIHBvc2l0aW9uID0gMClcbid1c2Ugc3RyaWN0JztcbnZhciAkZXhwb3J0ID0gcmVxdWlyZSgnLi9fZXhwb3J0Jyk7XG52YXIgY29udGV4dCA9IHJlcXVpcmUoJy4vX3N0cmluZy1jb250ZXh0Jyk7XG52YXIgSU5DTFVERVMgPSAnaW5jbHVkZXMnO1xuXG4kZXhwb3J0KCRleHBvcnQuUCArICRleHBvcnQuRiAqIHJlcXVpcmUoJy4vX2ZhaWxzLWlzLXJlZ2V4cCcpKElOQ0xVREVTKSwgJ1N0cmluZycsIHtcbiAgaW5jbHVkZXM6IGZ1bmN0aW9uIGluY2x1ZGVzKHNlYXJjaFN0cmluZyAvKiAsIHBvc2l0aW9uID0gMCAqLykge1xuICAgIHJldHVybiAhIX5jb250ZXh0KHRoaXMsIHNlYXJjaFN0cmluZywgSU5DTFVERVMpXG4gICAgICAuaW5kZXhPZihzZWFyY2hTdHJpbmcsIGFyZ3VtZW50cy5sZW5ndGggPiAxID8gYXJndW1lbnRzWzFdIDogdW5kZWZpbmVkKTtcbiAgfVxufSk7XG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///189\n")},function(module,exports,__webpack_require__){eval("var $export = __webpack_require__(1);\n\n$export($export.P, 'String', {\n  // 21.1.3.13 String.prototype.repeat(count)\n  repeat: __webpack_require__(69)\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTkwLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9lczYuc3RyaW5nLnJlcGVhdC5qcz8xNGI5Il0sInNvdXJjZXNDb250ZW50IjpbInZhciAkZXhwb3J0ID0gcmVxdWlyZSgnLi9fZXhwb3J0Jyk7XG5cbiRleHBvcnQoJGV4cG9ydC5QLCAnU3RyaW5nJywge1xuICAvLyAyMS4xLjMuMTMgU3RyaW5nLnByb3RvdHlwZS5yZXBlYXQoY291bnQpXG4gIHJlcGVhdDogcmVxdWlyZSgnLi9fc3RyaW5nLXJlcGVhdCcpXG59KTtcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///190\n")},function(module,exports,__webpack_require__){"use strict";eval("// 21.1.3.18 String.prototype.startsWith(searchString [, position ])\n\nvar $export = __webpack_require__(1);\nvar toLength = __webpack_require__(7);\nvar context = __webpack_require__(74);\nvar STARTS_WITH = 'startsWith';\nvar $startsWith = ''[STARTS_WITH];\n\n$export($export.P + $export.F * __webpack_require__(76)(STARTS_WITH), 'String', {\n  startsWith: function startsWith(searchString /* , position = 0 */) {\n    var that = context(this, searchString, STARTS_WITH);\n    var index = toLength(Math.min(arguments.length > 1 ? arguments[1] : undefined, that.length));\n    var search = String(searchString);\n    return $startsWith\n      ? $startsWith.call(that, search, index)\n      : that.slice(index, index + search.length) === search;\n  }\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTkxLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9lczYuc3RyaW5nLnN0YXJ0cy13aXRoLmpzP2Y1NTkiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gMjEuMS4zLjE4IFN0cmluZy5wcm90b3R5cGUuc3RhcnRzV2l0aChzZWFyY2hTdHJpbmcgWywgcG9zaXRpb24gXSlcbid1c2Ugc3RyaWN0JztcbnZhciAkZXhwb3J0ID0gcmVxdWlyZSgnLi9fZXhwb3J0Jyk7XG52YXIgdG9MZW5ndGggPSByZXF1aXJlKCcuL190by1sZW5ndGgnKTtcbnZhciBjb250ZXh0ID0gcmVxdWlyZSgnLi9fc3RyaW5nLWNvbnRleHQnKTtcbnZhciBTVEFSVFNfV0lUSCA9ICdzdGFydHNXaXRoJztcbnZhciAkc3RhcnRzV2l0aCA9ICcnW1NUQVJUU19XSVRIXTtcblxuJGV4cG9ydCgkZXhwb3J0LlAgKyAkZXhwb3J0LkYgKiByZXF1aXJlKCcuL19mYWlscy1pcy1yZWdleHAnKShTVEFSVFNfV0lUSCksICdTdHJpbmcnLCB7XG4gIHN0YXJ0c1dpdGg6IGZ1bmN0aW9uIHN0YXJ0c1dpdGgoc2VhcmNoU3RyaW5nIC8qICwgcG9zaXRpb24gPSAwICovKSB7XG4gICAgdmFyIHRoYXQgPSBjb250ZXh0KHRoaXMsIHNlYXJjaFN0cmluZywgU1RBUlRTX1dJVEgpO1xuICAgIHZhciBpbmRleCA9IHRvTGVuZ3RoKE1hdGgubWluKGFyZ3VtZW50cy5sZW5ndGggPiAxID8gYXJndW1lbnRzWzFdIDogdW5kZWZpbmVkLCB0aGF0Lmxlbmd0aCkpO1xuICAgIHZhciBzZWFyY2ggPSBTdHJpbmcoc2VhcmNoU3RyaW5nKTtcbiAgICByZXR1cm4gJHN0YXJ0c1dpdGhcbiAgICAgID8gJHN0YXJ0c1dpdGguY2FsbCh0aGF0LCBzZWFyY2gsIGluZGV4KVxuICAgICAgOiB0aGF0LnNsaWNlKGluZGV4LCBpbmRleCArIHNlYXJjaC5sZW5ndGgpID09PSBzZWFyY2g7XG4gIH1cbn0pO1xuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Iiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///191\n")},function(module,exports,__webpack_require__){"use strict";eval("\n// B.2.3.2 String.prototype.anchor(name)\n__webpack_require__(13)('anchor', function (createHTML) {\n  return function anchor(name) {\n    return createHTML(this, 'a', 'name', name);\n  };\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTkyLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9lczYuc3RyaW5nLmFuY2hvci5qcz84NDQ5Il0sInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0Jztcbi8vIEIuMi4zLjIgU3RyaW5nLnByb3RvdHlwZS5hbmNob3IobmFtZSlcbnJlcXVpcmUoJy4vX3N0cmluZy1odG1sJykoJ2FuY2hvcicsIGZ1bmN0aW9uIChjcmVhdGVIVE1MKSB7XG4gIHJldHVybiBmdW5jdGlvbiBhbmNob3IobmFtZSkge1xuICAgIHJldHVybiBjcmVhdGVIVE1MKHRoaXMsICdhJywgJ25hbWUnLCBuYW1lKTtcbiAgfTtcbn0pO1xuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///192\n")},function(module,exports,__webpack_require__){"use strict";eval("\n// B.2.3.3 String.prototype.big()\n__webpack_require__(13)('big', function (createHTML) {\n  return function big() {\n    return createHTML(this, 'big', '', '');\n  };\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTkzLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9lczYuc3RyaW5nLmJpZy5qcz85Yzg2Il0sInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0Jztcbi8vIEIuMi4zLjMgU3RyaW5nLnByb3RvdHlwZS5iaWcoKVxucmVxdWlyZSgnLi9fc3RyaW5nLWh0bWwnKSgnYmlnJywgZnVuY3Rpb24gKGNyZWF0ZUhUTUwpIHtcbiAgcmV0dXJuIGZ1bmN0aW9uIGJpZygpIHtcbiAgICByZXR1cm4gY3JlYXRlSFRNTCh0aGlzLCAnYmlnJywgJycsICcnKTtcbiAgfTtcbn0pO1xuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///193\n")},function(module,exports,__webpack_require__){"use strict";eval("\n// B.2.3.4 String.prototype.blink()\n__webpack_require__(13)('blink', function (createHTML) {\n  return function blink() {\n    return createHTML(this, 'blink', '', '');\n  };\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTk0LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9lczYuc3RyaW5nLmJsaW5rLmpzP2ZhODMiXSwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuLy8gQi4yLjMuNCBTdHJpbmcucHJvdG90eXBlLmJsaW5rKClcbnJlcXVpcmUoJy4vX3N0cmluZy1odG1sJykoJ2JsaW5rJywgZnVuY3Rpb24gKGNyZWF0ZUhUTUwpIHtcbiAgcmV0dXJuIGZ1bmN0aW9uIGJsaW5rKCkge1xuICAgIHJldHVybiBjcmVhdGVIVE1MKHRoaXMsICdibGluaycsICcnLCAnJyk7XG4gIH07XG59KTtcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Iiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///194\n")},function(module,exports,__webpack_require__){"use strict";eval("\n// B.2.3.5 String.prototype.bold()\n__webpack_require__(13)('bold', function (createHTML) {\n  return function bold() {\n    return createHTML(this, 'b', '', '');\n  };\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTk1LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9lczYuc3RyaW5nLmJvbGQuanM/NDhjMCJdLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XG4vLyBCLjIuMy41IFN0cmluZy5wcm90b3R5cGUuYm9sZCgpXG5yZXF1aXJlKCcuL19zdHJpbmctaHRtbCcpKCdib2xkJywgZnVuY3Rpb24gKGNyZWF0ZUhUTUwpIHtcbiAgcmV0dXJuIGZ1bmN0aW9uIGJvbGQoKSB7XG4gICAgcmV0dXJuIGNyZWF0ZUhUTUwodGhpcywgJ2InLCAnJywgJycpO1xuICB9O1xufSk7XG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///195\n")},function(module,exports,__webpack_require__){"use strict";eval("\n// B.2.3.6 String.prototype.fixed()\n__webpack_require__(13)('fixed', function (createHTML) {\n  return function fixed() {\n    return createHTML(this, 'tt', '', '');\n  };\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTk2LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9lczYuc3RyaW5nLmZpeGVkLmpzP2QyNjMiXSwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuLy8gQi4yLjMuNiBTdHJpbmcucHJvdG90eXBlLmZpeGVkKClcbnJlcXVpcmUoJy4vX3N0cmluZy1odG1sJykoJ2ZpeGVkJywgZnVuY3Rpb24gKGNyZWF0ZUhUTUwpIHtcbiAgcmV0dXJuIGZ1bmN0aW9uIGZpeGVkKCkge1xuICAgIHJldHVybiBjcmVhdGVIVE1MKHRoaXMsICd0dCcsICcnLCAnJyk7XG4gIH07XG59KTtcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Iiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///196\n")},function(module,exports,__webpack_require__){"use strict";eval("\n// B.2.3.7 String.prototype.fontcolor(color)\n__webpack_require__(13)('fontcolor', function (createHTML) {\n  return function fontcolor(color) {\n    return createHTML(this, 'font', 'color', color);\n  };\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTk3LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9lczYuc3RyaW5nLmZvbnRjb2xvci5qcz82YzM3Il0sInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0Jztcbi8vIEIuMi4zLjcgU3RyaW5nLnByb3RvdHlwZS5mb250Y29sb3IoY29sb3IpXG5yZXF1aXJlKCcuL19zdHJpbmctaHRtbCcpKCdmb250Y29sb3InLCBmdW5jdGlvbiAoY3JlYXRlSFRNTCkge1xuICByZXR1cm4gZnVuY3Rpb24gZm9udGNvbG9yKGNvbG9yKSB7XG4gICAgcmV0dXJuIGNyZWF0ZUhUTUwodGhpcywgJ2ZvbnQnLCAnY29sb3InLCBjb2xvcik7XG4gIH07XG59KTtcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Iiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///197\n")},function(module,exports,__webpack_require__){"use strict";eval("\n// B.2.3.8 String.prototype.fontsize(size)\n__webpack_require__(13)('fontsize', function (createHTML) {\n  return function fontsize(size) {\n    return createHTML(this, 'font', 'size', size);\n  };\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTk4LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9lczYuc3RyaW5nLmZvbnRzaXplLmpzPzllYzgiXSwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuLy8gQi4yLjMuOCBTdHJpbmcucHJvdG90eXBlLmZvbnRzaXplKHNpemUpXG5yZXF1aXJlKCcuL19zdHJpbmctaHRtbCcpKCdmb250c2l6ZScsIGZ1bmN0aW9uIChjcmVhdGVIVE1MKSB7XG4gIHJldHVybiBmdW5jdGlvbiBmb250c2l6ZShzaXplKSB7XG4gICAgcmV0dXJuIGNyZWF0ZUhUTUwodGhpcywgJ2ZvbnQnLCAnc2l6ZScsIHNpemUpO1xuICB9O1xufSk7XG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///198\n")},function(module,exports,__webpack_require__){"use strict";eval("\n// B.2.3.9 String.prototype.italics()\n__webpack_require__(13)('italics', function (createHTML) {\n  return function italics() {\n    return createHTML(this, 'i', '', '');\n  };\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTk5LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9lczYuc3RyaW5nLml0YWxpY3MuanM/ZDBiMCJdLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XG4vLyBCLjIuMy45IFN0cmluZy5wcm90b3R5cGUuaXRhbGljcygpXG5yZXF1aXJlKCcuL19zdHJpbmctaHRtbCcpKCdpdGFsaWNzJywgZnVuY3Rpb24gKGNyZWF0ZUhUTUwpIHtcbiAgcmV0dXJuIGZ1bmN0aW9uIGl0YWxpY3MoKSB7XG4gICAgcmV0dXJuIGNyZWF0ZUhUTUwodGhpcywgJ2knLCAnJywgJycpO1xuICB9O1xufSk7XG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///199\n")},function(module,exports,__webpack_require__){"use strict";eval("\n// B.2.3.10 String.prototype.link(url)\n__webpack_require__(13)('link', function (createHTML) {\n  return function link(url) {\n    return createHTML(this, 'a', 'href', url);\n  };\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMjAwLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9lczYuc3RyaW5nLmxpbmsuanM/YjU0YSJdLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XG4vLyBCLjIuMy4xMCBTdHJpbmcucHJvdG90eXBlLmxpbmsodXJsKVxucmVxdWlyZSgnLi9fc3RyaW5nLWh0bWwnKSgnbGluaycsIGZ1bmN0aW9uIChjcmVhdGVIVE1MKSB7XG4gIHJldHVybiBmdW5jdGlvbiBsaW5rKHVybCkge1xuICAgIHJldHVybiBjcmVhdGVIVE1MKHRoaXMsICdhJywgJ2hyZWYnLCB1cmwpO1xuICB9O1xufSk7XG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///200\n")},function(module,exports,__webpack_require__){"use strict";eval("\n// B.2.3.11 String.prototype.small()\n__webpack_require__(13)('small', function (createHTML) {\n  return function small() {\n    return createHTML(this, 'small', '', '');\n  };\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMjAxLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9lczYuc3RyaW5nLnNtYWxsLmpzP2YzODYiXSwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuLy8gQi4yLjMuMTEgU3RyaW5nLnByb3RvdHlwZS5zbWFsbCgpXG5yZXF1aXJlKCcuL19zdHJpbmctaHRtbCcpKCdzbWFsbCcsIGZ1bmN0aW9uIChjcmVhdGVIVE1MKSB7XG4gIHJldHVybiBmdW5jdGlvbiBzbWFsbCgpIHtcbiAgICByZXR1cm4gY3JlYXRlSFRNTCh0aGlzLCAnc21hbGwnLCAnJywgJycpO1xuICB9O1xufSk7XG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///201\n")},function(module,exports,__webpack_require__){"use strict";eval("\n// B.2.3.12 String.prototype.strike()\n__webpack_require__(13)('strike', function (createHTML) {\n  return function strike() {\n    return createHTML(this, 'strike', '', '');\n  };\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMjAyLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9lczYuc3RyaW5nLnN0cmlrZS5qcz8xNDQ4Il0sInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0Jztcbi8vIEIuMi4zLjEyIFN0cmluZy5wcm90b3R5cGUuc3RyaWtlKClcbnJlcXVpcmUoJy4vX3N0cmluZy1odG1sJykoJ3N0cmlrZScsIGZ1bmN0aW9uIChjcmVhdGVIVE1MKSB7XG4gIHJldHVybiBmdW5jdGlvbiBzdHJpa2UoKSB7XG4gICAgcmV0dXJuIGNyZWF0ZUhUTUwodGhpcywgJ3N0cmlrZScsICcnLCAnJyk7XG4gIH07XG59KTtcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Iiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///202\n")},function(module,exports,__webpack_require__){"use strict";eval("\n// B.2.3.13 String.prototype.sub()\n__webpack_require__(13)('sub', function (createHTML) {\n  return function sub() {\n    return createHTML(this, 'sub', '', '');\n  };\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMjAzLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9lczYuc3RyaW5nLnN1Yi5qcz82NzNlIl0sInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0Jztcbi8vIEIuMi4zLjEzIFN0cmluZy5wcm90b3R5cGUuc3ViKClcbnJlcXVpcmUoJy4vX3N0cmluZy1odG1sJykoJ3N1YicsIGZ1bmN0aW9uIChjcmVhdGVIVE1MKSB7XG4gIHJldHVybiBmdW5jdGlvbiBzdWIoKSB7XG4gICAgcmV0dXJuIGNyZWF0ZUhUTUwodGhpcywgJ3N1YicsICcnLCAnJyk7XG4gIH07XG59KTtcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Iiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///203\n")},function(module,exports,__webpack_require__){"use strict";eval("\n// B.2.3.14 String.prototype.sup()\n__webpack_require__(13)('sup', function (createHTML) {\n  return function sup() {\n    return createHTML(this, 'sup', '', '');\n  };\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMjA0LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9lczYuc3RyaW5nLnN1cC5qcz8yNDJhIl0sInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0Jztcbi8vIEIuMi4zLjE0IFN0cmluZy5wcm90b3R5cGUuc3VwKClcbnJlcXVpcmUoJy4vX3N0cmluZy1odG1sJykoJ3N1cCcsIGZ1bmN0aW9uIChjcmVhdGVIVE1MKSB7XG4gIHJldHVybiBmdW5jdGlvbiBzdXAoKSB7XG4gICAgcmV0dXJuIGNyZWF0ZUhUTUwodGhpcywgJ3N1cCcsICcnLCAnJyk7XG4gIH07XG59KTtcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Iiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///204\n")},function(module,exports,__webpack_require__){eval("// 20.3.3.1 / 15.9.4.4 Date.now()\nvar $export = __webpack_require__(1);\n\n$export($export.S, 'Date', { now: function () { return new Date().getTime(); } });\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMjA1LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9lczYuZGF0ZS5ub3cuanM/NzhjZSJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyAyMC4zLjMuMSAvIDE1LjkuNC40IERhdGUubm93KClcbnZhciAkZXhwb3J0ID0gcmVxdWlyZSgnLi9fZXhwb3J0Jyk7XG5cbiRleHBvcnQoJGV4cG9ydC5TLCAnRGF0ZScsIHsgbm93OiBmdW5jdGlvbiAoKSB7IHJldHVybiBuZXcgRGF0ZSgpLmdldFRpbWUoKTsgfSB9KTtcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7Iiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///205\n")},function(module,exports,__webpack_require__){"use strict";eval("\nvar $export = __webpack_require__(1);\nvar toObject = __webpack_require__(11);\nvar toPrimitive = __webpack_require__(27);\n\n$export($export.P + $export.F * __webpack_require__(3)(function () {\n  return new Date(NaN).toJSON() !== null\n    || Date.prototype.toJSON.call({ toISOString: function () { return 1; } }) !== 1;\n}), 'Date', {\n  // eslint-disable-next-line no-unused-vars\n  toJSON: function toJSON(key) {\n    var O = toObject(this);\n    var pv = toPrimitive(O);\n    return typeof pv == 'number' && !isFinite(pv) ? null : O.toISOString();\n  }\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMjA2LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9lczYuZGF0ZS50by1qc29uLmpzPzAyOTgiXSwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xudmFyICRleHBvcnQgPSByZXF1aXJlKCcuL19leHBvcnQnKTtcbnZhciB0b09iamVjdCA9IHJlcXVpcmUoJy4vX3RvLW9iamVjdCcpO1xudmFyIHRvUHJpbWl0aXZlID0gcmVxdWlyZSgnLi9fdG8tcHJpbWl0aXZlJyk7XG5cbiRleHBvcnQoJGV4cG9ydC5QICsgJGV4cG9ydC5GICogcmVxdWlyZSgnLi9fZmFpbHMnKShmdW5jdGlvbiAoKSB7XG4gIHJldHVybiBuZXcgRGF0ZShOYU4pLnRvSlNPTigpICE9PSBudWxsXG4gICAgfHwgRGF0ZS5wcm90b3R5cGUudG9KU09OLmNhbGwoeyB0b0lTT1N0cmluZzogZnVuY3Rpb24gKCkgeyByZXR1cm4gMTsgfSB9KSAhPT0gMTtcbn0pLCAnRGF0ZScsIHtcbiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLXVudXNlZC12YXJzXG4gIHRvSlNPTjogZnVuY3Rpb24gdG9KU09OKGtleSkge1xuICAgIHZhciBPID0gdG9PYmplY3QodGhpcyk7XG4gICAgdmFyIHB2ID0gdG9QcmltaXRpdmUoTyk7XG4gICAgcmV0dXJuIHR5cGVvZiBwdiA9PSAnbnVtYmVyJyAmJiAhaXNGaW5pdGUocHYpID8gbnVsbCA6IE8udG9JU09TdHJpbmcoKTtcbiAgfVxufSk7XG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///206\n")},function(module,exports,__webpack_require__){eval("// 20.3.4.36 / 15.9.5.43 Date.prototype.toISOString()\nvar $export = __webpack_require__(1);\nvar toISOString = __webpack_require__(208);\n\n// PhantomJS / old WebKit has a broken implementations\n$export($export.P + $export.F * (Date.prototype.toISOString !== toISOString), 'Date', {\n  toISOString: toISOString\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMjA3LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9lczYuZGF0ZS50by1pc28tc3RyaW5nLmpzPzhlYTUiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gMjAuMy40LjM2IC8gMTUuOS41LjQzIERhdGUucHJvdG90eXBlLnRvSVNPU3RyaW5nKClcbnZhciAkZXhwb3J0ID0gcmVxdWlyZSgnLi9fZXhwb3J0Jyk7XG52YXIgdG9JU09TdHJpbmcgPSByZXF1aXJlKCcuL19kYXRlLXRvLWlzby1zdHJpbmcnKTtcblxuLy8gUGhhbnRvbUpTIC8gb2xkIFdlYktpdCBoYXMgYSBicm9rZW4gaW1wbGVtZW50YXRpb25zXG4kZXhwb3J0KCRleHBvcnQuUCArICRleHBvcnQuRiAqIChEYXRlLnByb3RvdHlwZS50b0lTT1N0cmluZyAhPT0gdG9JU09TdHJpbmcpLCAnRGF0ZScsIHtcbiAgdG9JU09TdHJpbmc6IHRvSVNPU3RyaW5nXG59KTtcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///207\n")},function(module,exports,__webpack_require__){"use strict";eval("\n// 20.3.4.36 / 15.9.5.43 Date.prototype.toISOString()\nvar fails = __webpack_require__(3);\nvar getTime = Date.prototype.getTime;\nvar $toISOString = Date.prototype.toISOString;\n\nvar lz = function (num) {\n  return num > 9 ? num : '0' + num;\n};\n\n// PhantomJS / old WebKit has a broken implementations\nmodule.exports = (fails(function () {\n  return $toISOString.call(new Date(-5e13 - 1)) != '0385-07-25T07:06:39.999Z';\n}) || !fails(function () {\n  $toISOString.call(new Date(NaN));\n})) ? function toISOString() {\n  if (!isFinite(getTime.call(this))) throw RangeError('Invalid time value');\n  var d = this;\n  var y = d.getUTCFullYear();\n  var m = d.getUTCMilliseconds();\n  var s = y < 0 ? '-' : y > 9999 ? '+' : '';\n  return s + ('00000' + Math.abs(y)).slice(s ? -6 : -4) +\n    '-' + lz(d.getUTCMonth() + 1) + '-' + lz(d.getUTCDate()) +\n    'T' + lz(d.getUTCHours()) + ':' + lz(d.getUTCMinutes()) +\n    ':' + lz(d.getUTCSeconds()) + '.' + (m > 99 ? m : '0' + lz(m)) + 'Z';\n} : $toISOString;\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMjA4LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9fZGF0ZS10by1pc28tc3RyaW5nLmpzPzhlZDAiXSwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuLy8gMjAuMy40LjM2IC8gMTUuOS41LjQzIERhdGUucHJvdG90eXBlLnRvSVNPU3RyaW5nKClcbnZhciBmYWlscyA9IHJlcXVpcmUoJy4vX2ZhaWxzJyk7XG52YXIgZ2V0VGltZSA9IERhdGUucHJvdG90eXBlLmdldFRpbWU7XG52YXIgJHRvSVNPU3RyaW5nID0gRGF0ZS5wcm90b3R5cGUudG9JU09TdHJpbmc7XG5cbnZhciBseiA9IGZ1bmN0aW9uIChudW0pIHtcbiAgcmV0dXJuIG51bSA+IDkgPyBudW0gOiAnMCcgKyBudW07XG59O1xuXG4vLyBQaGFudG9tSlMgLyBvbGQgV2ViS2l0IGhhcyBhIGJyb2tlbiBpbXBsZW1lbnRhdGlvbnNcbm1vZHVsZS5leHBvcnRzID0gKGZhaWxzKGZ1bmN0aW9uICgpIHtcbiAgcmV0dXJuICR0b0lTT1N0cmluZy5jYWxsKG5ldyBEYXRlKC01ZTEzIC0gMSkpICE9ICcwMzg1LTA3LTI1VDA3OjA2OjM5Ljk5OVonO1xufSkgfHwgIWZhaWxzKGZ1bmN0aW9uICgpIHtcbiAgJHRvSVNPU3RyaW5nLmNhbGwobmV3IERhdGUoTmFOKSk7XG59KSkgPyBmdW5jdGlvbiB0b0lTT1N0cmluZygpIHtcbiAgaWYgKCFpc0Zpbml0ZShnZXRUaW1lLmNhbGwodGhpcykpKSB0aHJvdyBSYW5nZUVycm9yKCdJbnZhbGlkIHRpbWUgdmFsdWUnKTtcbiAgdmFyIGQgPSB0aGlzO1xuICB2YXIgeSA9IGQuZ2V0VVRDRnVsbFllYXIoKTtcbiAgdmFyIG0gPSBkLmdldFVUQ01pbGxpc2Vjb25kcygpO1xuICB2YXIgcyA9IHkgPCAwID8gJy0nIDogeSA+IDk5OTkgPyAnKycgOiAnJztcbiAgcmV0dXJuIHMgKyAoJzAwMDAwJyArIE1hdGguYWJzKHkpKS5zbGljZShzID8gLTYgOiAtNCkgK1xuICAgICctJyArIGx6KGQuZ2V0VVRDTW9udGgoKSArIDEpICsgJy0nICsgbHooZC5nZXRVVENEYXRlKCkpICtcbiAgICAnVCcgKyBseihkLmdldFVUQ0hvdXJzKCkpICsgJzonICsgbHooZC5nZXRVVENNaW51dGVzKCkpICtcbiAgICAnOicgKyBseihkLmdldFVUQ1NlY29uZHMoKSkgKyAnLicgKyAobSA+IDk5ID8gbSA6ICcwJyArIGx6KG0pKSArICdaJztcbn0gOiAkdG9JU09TdHJpbmc7XG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Iiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///208\n")},function(module,exports,__webpack_require__){eval("var DateProto = Date.prototype;\nvar INVALID_DATE = 'Invalid Date';\nvar TO_STRING = 'toString';\nvar $toString = DateProto[TO_STRING];\nvar getTime = DateProto.getTime;\nif (new Date(NaN) + '' != INVALID_DATE) {\n  __webpack_require__(12)(DateProto, TO_STRING, function toString() {\n    var value = getTime.call(this);\n    // eslint-disable-next-line no-self-compare\n    return value === value ? $toString.call(this) : INVALID_DATE;\n  });\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMjA5LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9lczYuZGF0ZS50by1zdHJpbmcuanM/ODdiMyJdLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgRGF0ZVByb3RvID0gRGF0ZS5wcm90b3R5cGU7XG52YXIgSU5WQUxJRF9EQVRFID0gJ0ludmFsaWQgRGF0ZSc7XG52YXIgVE9fU1RSSU5HID0gJ3RvU3RyaW5nJztcbnZhciAkdG9TdHJpbmcgPSBEYXRlUHJvdG9bVE9fU1RSSU5HXTtcbnZhciBnZXRUaW1lID0gRGF0ZVByb3RvLmdldFRpbWU7XG5pZiAobmV3IERhdGUoTmFOKSArICcnICE9IElOVkFMSURfREFURSkge1xuICByZXF1aXJlKCcuL19yZWRlZmluZScpKERhdGVQcm90bywgVE9fU1RSSU5HLCBmdW5jdGlvbiB0b1N0cmluZygpIHtcbiAgICB2YXIgdmFsdWUgPSBnZXRUaW1lLmNhbGwodGhpcyk7XG4gICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLXNlbGYtY29tcGFyZVxuICAgIHJldHVybiB2YWx1ZSA9PT0gdmFsdWUgPyAkdG9TdHJpbmcuY2FsbCh0aGlzKSA6IElOVkFMSURfREFURTtcbiAgfSk7XG59XG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///209\n")},function(module,exports,__webpack_require__){eval("var TO_PRIMITIVE = __webpack_require__(6)('toPrimitive');\nvar proto = Date.prototype;\n\nif (!(TO_PRIMITIVE in proto)) __webpack_require__(15)(proto, TO_PRIMITIVE, __webpack_require__(211));\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMjEwLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9lczYuZGF0ZS50by1wcmltaXRpdmUuanM/YzhjZSJdLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgVE9fUFJJTUlUSVZFID0gcmVxdWlyZSgnLi9fd2tzJykoJ3RvUHJpbWl0aXZlJyk7XG52YXIgcHJvdG8gPSBEYXRlLnByb3RvdHlwZTtcblxuaWYgKCEoVE9fUFJJTUlUSVZFIGluIHByb3RvKSkgcmVxdWlyZSgnLi9faGlkZScpKHByb3RvLCBUT19QUklNSVRJVkUsIHJlcXVpcmUoJy4vX2RhdGUtdG8tcHJpbWl0aXZlJykpO1xuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///210\n")},function(module,exports,__webpack_require__){"use strict";eval("\nvar anObject = __webpack_require__(4);\nvar toPrimitive = __webpack_require__(27);\nvar NUMBER = 'number';\n\nmodule.exports = function (hint) {\n  if (hint !== 'string' && hint !== NUMBER && hint !== 'default') throw TypeError('Incorrect hint');\n  return toPrimitive(anObject(this), hint != NUMBER);\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMjExLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9fZGF0ZS10by1wcmltaXRpdmUuanM/ODM4MSJdLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XG52YXIgYW5PYmplY3QgPSByZXF1aXJlKCcuL19hbi1vYmplY3QnKTtcbnZhciB0b1ByaW1pdGl2ZSA9IHJlcXVpcmUoJy4vX3RvLXByaW1pdGl2ZScpO1xudmFyIE5VTUJFUiA9ICdudW1iZXInO1xuXG5tb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChoaW50KSB7XG4gIGlmIChoaW50ICE9PSAnc3RyaW5nJyAmJiBoaW50ICE9PSBOVU1CRVIgJiYgaGludCAhPT0gJ2RlZmF1bHQnKSB0aHJvdyBUeXBlRXJyb3IoJ0luY29ycmVjdCBoaW50Jyk7XG4gIHJldHVybiB0b1ByaW1pdGl2ZShhbk9iamVjdCh0aGlzKSwgaGludCAhPSBOVU1CRVIpO1xufTtcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///211\n")},function(module,exports,__webpack_require__){eval("// 22.1.2.2 / 15.4.3.2 Array.isArray(arg)\nvar $export = __webpack_require__(1);\n\n$export($export.S, 'Array', { isArray: __webpack_require__(52) });\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMjEyLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9lczYuYXJyYXkuaXMtYXJyYXkuanM/MmNhZiJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyAyMi4xLjIuMiAvIDE1LjQuMy4yIEFycmF5LmlzQXJyYXkoYXJnKVxudmFyICRleHBvcnQgPSByZXF1aXJlKCcuL19leHBvcnQnKTtcblxuJGV4cG9ydCgkZXhwb3J0LlMsICdBcnJheScsIHsgaXNBcnJheTogcmVxdWlyZSgnLi9faXMtYXJyYXknKSB9KTtcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7Iiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///212\n")},function(module,exports,__webpack_require__){"use strict";eval("\nvar ctx = __webpack_require__(18);\nvar $export = __webpack_require__(1);\nvar toObject = __webpack_require__(11);\nvar call = __webpack_require__(106);\nvar isArrayIter = __webpack_require__(77);\nvar toLength = __webpack_require__(7);\nvar createProperty = __webpack_require__(78);\nvar getIterFn = __webpack_require__(79);\n\n$export($export.S + $export.F * !__webpack_require__(53)(function (iter) { Array.from(iter); }), 'Array', {\n  // 22.1.2.1 Array.from(arrayLike, mapfn = undefined, thisArg = undefined)\n  from: function from(arrayLike /* , mapfn = undefined, thisArg = undefined */) {\n    var O = toObject(arrayLike);\n    var C = typeof this == 'function' ? this : Array;\n    var aLen = arguments.length;\n    var mapfn = aLen > 1 ? arguments[1] : undefined;\n    var mapping = mapfn !== undefined;\n    var index = 0;\n    var iterFn = getIterFn(O);\n    var length, result, step, iterator;\n    if (mapping) mapfn = ctx(mapfn, aLen > 2 ? arguments[2] : undefined, 2);\n    // if object isn't iterable or it's array with default iterator - use simple case\n    if (iterFn != undefined && !(C == Array && isArrayIter(iterFn))) {\n      for (iterator = iterFn.call(O), result = new C(); !(step = iterator.next()).done; index++) {\n        createProperty(result, index, mapping ? call(iterator, mapfn, [step.value, index], true) : step.value);\n      }\n    } else {\n      length = toLength(O.length);\n      for (result = new C(length); length > index; index++) {\n        createProperty(result, index, mapping ? mapfn(O[index], index) : O[index]);\n      }\n    }\n    result.length = index;\n    return result;\n  }\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMjEzLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9lczYuYXJyYXkuZnJvbS5qcz8xYzRjIl0sInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcbnZhciBjdHggPSByZXF1aXJlKCcuL19jdHgnKTtcbnZhciAkZXhwb3J0ID0gcmVxdWlyZSgnLi9fZXhwb3J0Jyk7XG52YXIgdG9PYmplY3QgPSByZXF1aXJlKCcuL190by1vYmplY3QnKTtcbnZhciBjYWxsID0gcmVxdWlyZSgnLi9faXRlci1jYWxsJyk7XG52YXIgaXNBcnJheUl0ZXIgPSByZXF1aXJlKCcuL19pcy1hcnJheS1pdGVyJyk7XG52YXIgdG9MZW5ndGggPSByZXF1aXJlKCcuL190by1sZW5ndGgnKTtcbnZhciBjcmVhdGVQcm9wZXJ0eSA9IHJlcXVpcmUoJy4vX2NyZWF0ZS1wcm9wZXJ0eScpO1xudmFyIGdldEl0ZXJGbiA9IHJlcXVpcmUoJy4vY29yZS5nZXQtaXRlcmF0b3ItbWV0aG9kJyk7XG5cbiRleHBvcnQoJGV4cG9ydC5TICsgJGV4cG9ydC5GICogIXJlcXVpcmUoJy4vX2l0ZXItZGV0ZWN0JykoZnVuY3Rpb24gKGl0ZXIpIHsgQXJyYXkuZnJvbShpdGVyKTsgfSksICdBcnJheScsIHtcbiAgLy8gMjIuMS4yLjEgQXJyYXkuZnJvbShhcnJheUxpa2UsIG1hcGZuID0gdW5kZWZpbmVkLCB0aGlzQXJnID0gdW5kZWZpbmVkKVxuICBmcm9tOiBmdW5jdGlvbiBmcm9tKGFycmF5TGlrZSAvKiAsIG1hcGZuID0gdW5kZWZpbmVkLCB0aGlzQXJnID0gdW5kZWZpbmVkICovKSB7XG4gICAgdmFyIE8gPSB0b09iamVjdChhcnJheUxpa2UpO1xuICAgIHZhciBDID0gdHlwZW9mIHRoaXMgPT0gJ2Z1bmN0aW9uJyA/IHRoaXMgOiBBcnJheTtcbiAgICB2YXIgYUxlbiA9IGFyZ3VtZW50cy5sZW5ndGg7XG4gICAgdmFyIG1hcGZuID0gYUxlbiA+IDEgPyBhcmd1bWVudHNbMV0gOiB1bmRlZmluZWQ7XG4gICAgdmFyIG1hcHBpbmcgPSBtYXBmbiAhPT0gdW5kZWZpbmVkO1xuICAgIHZhciBpbmRleCA9IDA7XG4gICAgdmFyIGl0ZXJGbiA9IGdldEl0ZXJGbihPKTtcbiAgICB2YXIgbGVuZ3RoLCByZXN1bHQsIHN0ZXAsIGl0ZXJhdG9yO1xuICAgIGlmIChtYXBwaW5nKSBtYXBmbiA9IGN0eChtYXBmbiwgYUxlbiA+IDIgPyBhcmd1bWVudHNbMl0gOiB1bmRlZmluZWQsIDIpO1xuICAgIC8vIGlmIG9iamVjdCBpc24ndCBpdGVyYWJsZSBvciBpdCdzIGFycmF5IHdpdGggZGVmYXVsdCBpdGVyYXRvciAtIHVzZSBzaW1wbGUgY2FzZVxuICAgIGlmIChpdGVyRm4gIT0gdW5kZWZpbmVkICYmICEoQyA9PSBBcnJheSAmJiBpc0FycmF5SXRlcihpdGVyRm4pKSkge1xuICAgICAgZm9yIChpdGVyYXRvciA9IGl0ZXJGbi5jYWxsKE8pLCByZXN1bHQgPSBuZXcgQygpOyAhKHN0ZXAgPSBpdGVyYXRvci5uZXh0KCkpLmRvbmU7IGluZGV4KyspIHtcbiAgICAgICAgY3JlYXRlUHJvcGVydHkocmVzdWx0LCBpbmRleCwgbWFwcGluZyA/IGNhbGwoaXRlcmF0b3IsIG1hcGZuLCBbc3RlcC52YWx1ZSwgaW5kZXhdLCB0cnVlKSA6IHN0ZXAudmFsdWUpO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICBsZW5ndGggPSB0b0xlbmd0aChPLmxlbmd0aCk7XG4gICAgICBmb3IgKHJlc3VsdCA9IG5ldyBDKGxlbmd0aCk7IGxlbmd0aCA+IGluZGV4OyBpbmRleCsrKSB7XG4gICAgICAgIGNyZWF0ZVByb3BlcnR5KHJlc3VsdCwgaW5kZXgsIG1hcHBpbmcgPyBtYXBmbihPW2luZGV4XSwgaW5kZXgpIDogT1tpbmRleF0pO1xuICAgICAgfVxuICAgIH1cbiAgICByZXN1bHQubGVuZ3RoID0gaW5kZXg7XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfVxufSk7XG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///213\n")},function(module,exports,__webpack_require__){"use strict";eval("\nvar $export = __webpack_require__(1);\nvar createProperty = __webpack_require__(78);\n\n// WebKit Array.of isn't generic\n$export($export.S + $export.F * __webpack_require__(3)(function () {\n  function F() { /* empty */ }\n  return !(Array.of.call(F) instanceof F);\n}), 'Array', {\n  // 22.1.2.3 Array.of( ...items)\n  of: function of(/* ...args */) {\n    var index = 0;\n    var aLen = arguments.length;\n    var result = new (typeof this == 'function' ? this : Array)(aLen);\n    while (aLen > index) createProperty(result, index, arguments[index++]);\n    result.length = aLen;\n    return result;\n  }\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMjE0LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9lczYuYXJyYXkub2YuanM/ZTgwNCJdLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XG52YXIgJGV4cG9ydCA9IHJlcXVpcmUoJy4vX2V4cG9ydCcpO1xudmFyIGNyZWF0ZVByb3BlcnR5ID0gcmVxdWlyZSgnLi9fY3JlYXRlLXByb3BlcnR5Jyk7XG5cbi8vIFdlYktpdCBBcnJheS5vZiBpc24ndCBnZW5lcmljXG4kZXhwb3J0KCRleHBvcnQuUyArICRleHBvcnQuRiAqIHJlcXVpcmUoJy4vX2ZhaWxzJykoZnVuY3Rpb24gKCkge1xuICBmdW5jdGlvbiBGKCkgeyAvKiBlbXB0eSAqLyB9XG4gIHJldHVybiAhKEFycmF5Lm9mLmNhbGwoRikgaW5zdGFuY2VvZiBGKTtcbn0pLCAnQXJyYXknLCB7XG4gIC8vIDIyLjEuMi4zIEFycmF5Lm9mKCAuLi5pdGVtcylcbiAgb2Y6IGZ1bmN0aW9uIG9mKC8qIC4uLmFyZ3MgKi8pIHtcbiAgICB2YXIgaW5kZXggPSAwO1xuICAgIHZhciBhTGVuID0gYXJndW1lbnRzLmxlbmd0aDtcbiAgICB2YXIgcmVzdWx0ID0gbmV3ICh0eXBlb2YgdGhpcyA9PSAnZnVuY3Rpb24nID8gdGhpcyA6IEFycmF5KShhTGVuKTtcbiAgICB3aGlsZSAoYUxlbiA+IGluZGV4KSBjcmVhdGVQcm9wZXJ0eShyZXN1bHQsIGluZGV4LCBhcmd1bWVudHNbaW5kZXgrK10pO1xuICAgIHJlc3VsdC5sZW5ndGggPSBhTGVuO1xuICAgIHJldHVybiByZXN1bHQ7XG4gIH1cbn0pO1xuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///214\n")},function(module,exports,__webpack_require__){"use strict";eval("\n// 22.1.3.13 Array.prototype.join(separator)\nvar $export = __webpack_require__(1);\nvar toIObject = __webpack_require__(16);\nvar arrayJoin = [].join;\n\n// fallback for not array-like strings\n$export($export.P + $export.F * (__webpack_require__(45) != Object || !__webpack_require__(17)(arrayJoin)), 'Array', {\n  join: function join(separator) {\n    return arrayJoin.call(toIObject(this), separator === undefined ? ',' : separator);\n  }\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMjE1LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9lczYuYXJyYXkuam9pbi5qcz8zNzNmIl0sInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0Jztcbi8vIDIyLjEuMy4xMyBBcnJheS5wcm90b3R5cGUuam9pbihzZXBhcmF0b3IpXG52YXIgJGV4cG9ydCA9IHJlcXVpcmUoJy4vX2V4cG9ydCcpO1xudmFyIHRvSU9iamVjdCA9IHJlcXVpcmUoJy4vX3RvLWlvYmplY3QnKTtcbnZhciBhcnJheUpvaW4gPSBbXS5qb2luO1xuXG4vLyBmYWxsYmFjayBmb3Igbm90IGFycmF5LWxpa2Ugc3RyaW5nc1xuJGV4cG9ydCgkZXhwb3J0LlAgKyAkZXhwb3J0LkYgKiAocmVxdWlyZSgnLi9faW9iamVjdCcpICE9IE9iamVjdCB8fCAhcmVxdWlyZSgnLi9fc3RyaWN0LW1ldGhvZCcpKGFycmF5Sm9pbikpLCAnQXJyYXknLCB7XG4gIGpvaW46IGZ1bmN0aW9uIGpvaW4oc2VwYXJhdG9yKSB7XG4gICAgcmV0dXJuIGFycmF5Sm9pbi5jYWxsKHRvSU9iamVjdCh0aGlzKSwgc2VwYXJhdG9yID09PSB1bmRlZmluZWQgPyAnLCcgOiBzZXBhcmF0b3IpO1xuICB9XG59KTtcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///215\n")},function(module,exports,__webpack_require__){"use strict";eval("\nvar $export = __webpack_require__(1);\nvar html = __webpack_require__(65);\nvar cof = __webpack_require__(24);\nvar toAbsoluteIndex = __webpack_require__(33);\nvar toLength = __webpack_require__(7);\nvar arraySlice = [].slice;\n\n// fallback for not array-like ES3 strings and DOM objects\n$export($export.P + $export.F * __webpack_require__(3)(function () {\n  if (html) arraySlice.call(html);\n}), 'Array', {\n  slice: function slice(begin, end) {\n    var len = toLength(this.length);\n    var klass = cof(this);\n    end = end === undefined ? len : end;\n    if (klass == 'Array') return arraySlice.call(this, begin, end);\n    var start = toAbsoluteIndex(begin, len);\n    var upTo = toAbsoluteIndex(end, len);\n    var size = toLength(upTo - start);\n    var cloned = new Array(size);\n    var i = 0;\n    for (; i < size; i++) cloned[i] = klass == 'String'\n      ? this.charAt(start + i)\n      : this[start + i];\n    return cloned;\n  }\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMjE2LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9lczYuYXJyYXkuc2xpY2UuanM/MjNiZiJdLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XG52YXIgJGV4cG9ydCA9IHJlcXVpcmUoJy4vX2V4cG9ydCcpO1xudmFyIGh0bWwgPSByZXF1aXJlKCcuL19odG1sJyk7XG52YXIgY29mID0gcmVxdWlyZSgnLi9fY29mJyk7XG52YXIgdG9BYnNvbHV0ZUluZGV4ID0gcmVxdWlyZSgnLi9fdG8tYWJzb2x1dGUtaW5kZXgnKTtcbnZhciB0b0xlbmd0aCA9IHJlcXVpcmUoJy4vX3RvLWxlbmd0aCcpO1xudmFyIGFycmF5U2xpY2UgPSBbXS5zbGljZTtcblxuLy8gZmFsbGJhY2sgZm9yIG5vdCBhcnJheS1saWtlIEVTMyBzdHJpbmdzIGFuZCBET00gb2JqZWN0c1xuJGV4cG9ydCgkZXhwb3J0LlAgKyAkZXhwb3J0LkYgKiByZXF1aXJlKCcuL19mYWlscycpKGZ1bmN0aW9uICgpIHtcbiAgaWYgKGh0bWwpIGFycmF5U2xpY2UuY2FsbChodG1sKTtcbn0pLCAnQXJyYXknLCB7XG4gIHNsaWNlOiBmdW5jdGlvbiBzbGljZShiZWdpbiwgZW5kKSB7XG4gICAgdmFyIGxlbiA9IHRvTGVuZ3RoKHRoaXMubGVuZ3RoKTtcbiAgICB2YXIga2xhc3MgPSBjb2YodGhpcyk7XG4gICAgZW5kID0gZW5kID09PSB1bmRlZmluZWQgPyBsZW4gOiBlbmQ7XG4gICAgaWYgKGtsYXNzID09ICdBcnJheScpIHJldHVybiBhcnJheVNsaWNlLmNhbGwodGhpcywgYmVnaW4sIGVuZCk7XG4gICAgdmFyIHN0YXJ0ID0gdG9BYnNvbHV0ZUluZGV4KGJlZ2luLCBsZW4pO1xuICAgIHZhciB1cFRvID0gdG9BYnNvbHV0ZUluZGV4KGVuZCwgbGVuKTtcbiAgICB2YXIgc2l6ZSA9IHRvTGVuZ3RoKHVwVG8gLSBzdGFydCk7XG4gICAgdmFyIGNsb25lZCA9IG5ldyBBcnJheShzaXplKTtcbiAgICB2YXIgaSA9IDA7XG4gICAgZm9yICg7IGkgPCBzaXplOyBpKyspIGNsb25lZFtpXSA9IGtsYXNzID09ICdTdHJpbmcnXG4gICAgICA/IHRoaXMuY2hhckF0KHN0YXJ0ICsgaSlcbiAgICAgIDogdGhpc1tzdGFydCArIGldO1xuICAgIHJldHVybiBjbG9uZWQ7XG4gIH1cbn0pO1xuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///216\n")},function(module,exports,__webpack_require__){"use strict";eval("\nvar $export = __webpack_require__(1);\nvar aFunction = __webpack_require__(19);\nvar toObject = __webpack_require__(11);\nvar fails = __webpack_require__(3);\nvar $sort = [].sort;\nvar test = [1, 2, 3];\n\n$export($export.P + $export.F * (fails(function () {\n  // IE8-\n  test.sort(undefined);\n}) || !fails(function () {\n  // V8 bug\n  test.sort(null);\n  // Old WebKit\n}) || !__webpack_require__(17)($sort)), 'Array', {\n  // 22.1.3.25 Array.prototype.sort(comparefn)\n  sort: function sort(comparefn) {\n    return comparefn === undefined\n      ? $sort.call(toObject(this))\n      : $sort.call(toObject(this), aFunction(comparefn));\n  }\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMjE3LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9lczYuYXJyYXkuc29ydC5qcz81NWRkIl0sInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcbnZhciAkZXhwb3J0ID0gcmVxdWlyZSgnLi9fZXhwb3J0Jyk7XG52YXIgYUZ1bmN0aW9uID0gcmVxdWlyZSgnLi9fYS1mdW5jdGlvbicpO1xudmFyIHRvT2JqZWN0ID0gcmVxdWlyZSgnLi9fdG8tb2JqZWN0Jyk7XG52YXIgZmFpbHMgPSByZXF1aXJlKCcuL19mYWlscycpO1xudmFyICRzb3J0ID0gW10uc29ydDtcbnZhciB0ZXN0ID0gWzEsIDIsIDNdO1xuXG4kZXhwb3J0KCRleHBvcnQuUCArICRleHBvcnQuRiAqIChmYWlscyhmdW5jdGlvbiAoKSB7XG4gIC8vIElFOC1cbiAgdGVzdC5zb3J0KHVuZGVmaW5lZCk7XG59KSB8fCAhZmFpbHMoZnVuY3Rpb24gKCkge1xuICAvLyBWOCBidWdcbiAgdGVzdC5zb3J0KG51bGwpO1xuICAvLyBPbGQgV2ViS2l0XG59KSB8fCAhcmVxdWlyZSgnLi9fc3RyaWN0LW1ldGhvZCcpKCRzb3J0KSksICdBcnJheScsIHtcbiAgLy8gMjIuMS4zLjI1IEFycmF5LnByb3RvdHlwZS5zb3J0KGNvbXBhcmVmbilcbiAgc29ydDogZnVuY3Rpb24gc29ydChjb21wYXJlZm4pIHtcbiAgICByZXR1cm4gY29tcGFyZWZuID09PSB1bmRlZmluZWRcbiAgICAgID8gJHNvcnQuY2FsbCh0b09iamVjdCh0aGlzKSlcbiAgICAgIDogJHNvcnQuY2FsbCh0b09iamVjdCh0aGlzKSwgYUZ1bmN0aW9uKGNvbXBhcmVmbikpO1xuICB9XG59KTtcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///217\n")},function(module,exports,__webpack_require__){"use strict";eval("\nvar $export = __webpack_require__(1);\nvar $forEach = __webpack_require__(23)(0);\nvar STRICT = __webpack_require__(17)([].forEach, true);\n\n$export($export.P + $export.F * !STRICT, 'Array', {\n  // 22.1.3.10 / 15.4.4.18 Array.prototype.forEach(callbackfn [, thisArg])\n  forEach: function forEach(callbackfn /* , thisArg */) {\n    return $forEach(this, callbackfn, arguments[1]);\n  }\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMjE4LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9lczYuYXJyYXkuZm9yLWVhY2guanM/ZjNlMiJdLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XG52YXIgJGV4cG9ydCA9IHJlcXVpcmUoJy4vX2V4cG9ydCcpO1xudmFyICRmb3JFYWNoID0gcmVxdWlyZSgnLi9fYXJyYXktbWV0aG9kcycpKDApO1xudmFyIFNUUklDVCA9IHJlcXVpcmUoJy4vX3N0cmljdC1tZXRob2QnKShbXS5mb3JFYWNoLCB0cnVlKTtcblxuJGV4cG9ydCgkZXhwb3J0LlAgKyAkZXhwb3J0LkYgKiAhU1RSSUNULCAnQXJyYXknLCB7XG4gIC8vIDIyLjEuMy4xMCAvIDE1LjQuNC4xOCBBcnJheS5wcm90b3R5cGUuZm9yRWFjaChjYWxsYmFja2ZuIFssIHRoaXNBcmddKVxuICBmb3JFYWNoOiBmdW5jdGlvbiBmb3JFYWNoKGNhbGxiYWNrZm4gLyogLCB0aGlzQXJnICovKSB7XG4gICAgcmV0dXJuICRmb3JFYWNoKHRoaXMsIGNhbGxiYWNrZm4sIGFyZ3VtZW50c1sxXSk7XG4gIH1cbn0pO1xuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///218\n")},function(module,exports,__webpack_require__){eval("var isObject = __webpack_require__(5);\nvar isArray = __webpack_require__(52);\nvar SPECIES = __webpack_require__(6)('species');\n\nmodule.exports = function (original) {\n  var C;\n  if (isArray(original)) {\n    C = original.constructor;\n    // cross-realm fallback\n    if (typeof C == 'function' && (C === Array || isArray(C.prototype))) C = undefined;\n    if (isObject(C)) {\n      C = C[SPECIES];\n      if (C === null) C = undefined;\n    }\n  } return C === undefined ? Array : C;\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMjE5LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9fYXJyYXktc3BlY2llcy1jb25zdHJ1Y3Rvci5qcz9lODUzIl0sInNvdXJjZXNDb250ZW50IjpbInZhciBpc09iamVjdCA9IHJlcXVpcmUoJy4vX2lzLW9iamVjdCcpO1xudmFyIGlzQXJyYXkgPSByZXF1aXJlKCcuL19pcy1hcnJheScpO1xudmFyIFNQRUNJRVMgPSByZXF1aXJlKCcuL193a3MnKSgnc3BlY2llcycpO1xuXG5tb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChvcmlnaW5hbCkge1xuICB2YXIgQztcbiAgaWYgKGlzQXJyYXkob3JpZ2luYWwpKSB7XG4gICAgQyA9IG9yaWdpbmFsLmNvbnN0cnVjdG9yO1xuICAgIC8vIGNyb3NzLXJlYWxtIGZhbGxiYWNrXG4gICAgaWYgKHR5cGVvZiBDID09ICdmdW5jdGlvbicgJiYgKEMgPT09IEFycmF5IHx8IGlzQXJyYXkoQy5wcm90b3R5cGUpKSkgQyA9IHVuZGVmaW5lZDtcbiAgICBpZiAoaXNPYmplY3QoQykpIHtcbiAgICAgIEMgPSBDW1NQRUNJRVNdO1xuICAgICAgaWYgKEMgPT09IG51bGwpIEMgPSB1bmRlZmluZWQ7XG4gICAgfVxuICB9IHJldHVybiBDID09PSB1bmRlZmluZWQgPyBBcnJheSA6IEM7XG59O1xuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///219\n")},function(module,exports,__webpack_require__){"use strict";eval("\nvar $export = __webpack_require__(1);\nvar $map = __webpack_require__(23)(1);\n\n$export($export.P + $export.F * !__webpack_require__(17)([].map, true), 'Array', {\n  // 22.1.3.15 / 15.4.4.19 Array.prototype.map(callbackfn [, thisArg])\n  map: function map(callbackfn /* , thisArg */) {\n    return $map(this, callbackfn, arguments[1]);\n  }\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMjIwLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9lczYuYXJyYXkubWFwLmpzPzZkNjciXSwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xudmFyICRleHBvcnQgPSByZXF1aXJlKCcuL19leHBvcnQnKTtcbnZhciAkbWFwID0gcmVxdWlyZSgnLi9fYXJyYXktbWV0aG9kcycpKDEpO1xuXG4kZXhwb3J0KCRleHBvcnQuUCArICRleHBvcnQuRiAqICFyZXF1aXJlKCcuL19zdHJpY3QtbWV0aG9kJykoW10ubWFwLCB0cnVlKSwgJ0FycmF5Jywge1xuICAvLyAyMi4xLjMuMTUgLyAxNS40LjQuMTkgQXJyYXkucHJvdG90eXBlLm1hcChjYWxsYmFja2ZuIFssIHRoaXNBcmddKVxuICBtYXA6IGZ1bmN0aW9uIG1hcChjYWxsYmFja2ZuIC8qICwgdGhpc0FyZyAqLykge1xuICAgIHJldHVybiAkbWFwKHRoaXMsIGNhbGxiYWNrZm4sIGFyZ3VtZW50c1sxXSk7XG4gIH1cbn0pO1xuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///220\n")},function(module,exports,__webpack_require__){"use strict";eval("\nvar $export = __webpack_require__(1);\nvar $filter = __webpack_require__(23)(2);\n\n$export($export.P + $export.F * !__webpack_require__(17)([].filter, true), 'Array', {\n  // 22.1.3.7 / 15.4.4.20 Array.prototype.filter(callbackfn [, thisArg])\n  filter: function filter(callbackfn /* , thisArg */) {\n    return $filter(this, callbackfn, arguments[1]);\n  }\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMjIxLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9lczYuYXJyYXkuZmlsdGVyLmpzP2QyNWYiXSwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xudmFyICRleHBvcnQgPSByZXF1aXJlKCcuL19leHBvcnQnKTtcbnZhciAkZmlsdGVyID0gcmVxdWlyZSgnLi9fYXJyYXktbWV0aG9kcycpKDIpO1xuXG4kZXhwb3J0KCRleHBvcnQuUCArICRleHBvcnQuRiAqICFyZXF1aXJlKCcuL19zdHJpY3QtbWV0aG9kJykoW10uZmlsdGVyLCB0cnVlKSwgJ0FycmF5Jywge1xuICAvLyAyMi4xLjMuNyAvIDE1LjQuNC4yMCBBcnJheS5wcm90b3R5cGUuZmlsdGVyKGNhbGxiYWNrZm4gWywgdGhpc0FyZ10pXG4gIGZpbHRlcjogZnVuY3Rpb24gZmlsdGVyKGNhbGxiYWNrZm4gLyogLCB0aGlzQXJnICovKSB7XG4gICAgcmV0dXJuICRmaWx0ZXIodGhpcywgY2FsbGJhY2tmbiwgYXJndW1lbnRzWzFdKTtcbiAgfVxufSk7XG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///221\n")},function(module,exports,__webpack_require__){"use strict";eval("\nvar $export = __webpack_require__(1);\nvar $some = __webpack_require__(23)(3);\n\n$export($export.P + $export.F * !__webpack_require__(17)([].some, true), 'Array', {\n  // 22.1.3.23 / 15.4.4.17 Array.prototype.some(callbackfn [, thisArg])\n  some: function some(callbackfn /* , thisArg */) {\n    return $some(this, callbackfn, arguments[1]);\n  }\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMjIyLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9lczYuYXJyYXkuc29tZS5qcz83NTlmIl0sInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcbnZhciAkZXhwb3J0ID0gcmVxdWlyZSgnLi9fZXhwb3J0Jyk7XG52YXIgJHNvbWUgPSByZXF1aXJlKCcuL19hcnJheS1tZXRob2RzJykoMyk7XG5cbiRleHBvcnQoJGV4cG9ydC5QICsgJGV4cG9ydC5GICogIXJlcXVpcmUoJy4vX3N0cmljdC1tZXRob2QnKShbXS5zb21lLCB0cnVlKSwgJ0FycmF5Jywge1xuICAvLyAyMi4xLjMuMjMgLyAxNS40LjQuMTcgQXJyYXkucHJvdG90eXBlLnNvbWUoY2FsbGJhY2tmbiBbLCB0aGlzQXJnXSlcbiAgc29tZTogZnVuY3Rpb24gc29tZShjYWxsYmFja2ZuIC8qICwgdGhpc0FyZyAqLykge1xuICAgIHJldHVybiAkc29tZSh0aGlzLCBjYWxsYmFja2ZuLCBhcmd1bWVudHNbMV0pO1xuICB9XG59KTtcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Iiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///222\n")},function(module,exports,__webpack_require__){"use strict";eval("\nvar $export = __webpack_require__(1);\nvar $every = __webpack_require__(23)(4);\n\n$export($export.P + $export.F * !__webpack_require__(17)([].every, true), 'Array', {\n  // 22.1.3.5 / 15.4.4.16 Array.prototype.every(callbackfn [, thisArg])\n  every: function every(callbackfn /* , thisArg */) {\n    return $every(this, callbackfn, arguments[1]);\n  }\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMjIzLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9lczYuYXJyYXkuZXZlcnkuanM/NjA5NSJdLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XG52YXIgJGV4cG9ydCA9IHJlcXVpcmUoJy4vX2V4cG9ydCcpO1xudmFyICRldmVyeSA9IHJlcXVpcmUoJy4vX2FycmF5LW1ldGhvZHMnKSg0KTtcblxuJGV4cG9ydCgkZXhwb3J0LlAgKyAkZXhwb3J0LkYgKiAhcmVxdWlyZSgnLi9fc3RyaWN0LW1ldGhvZCcpKFtdLmV2ZXJ5LCB0cnVlKSwgJ0FycmF5Jywge1xuICAvLyAyMi4xLjMuNSAvIDE1LjQuNC4xNiBBcnJheS5wcm90b3R5cGUuZXZlcnkoY2FsbGJhY2tmbiBbLCB0aGlzQXJnXSlcbiAgZXZlcnk6IGZ1bmN0aW9uIGV2ZXJ5KGNhbGxiYWNrZm4gLyogLCB0aGlzQXJnICovKSB7XG4gICAgcmV0dXJuICRldmVyeSh0aGlzLCBjYWxsYmFja2ZuLCBhcmd1bWVudHNbMV0pO1xuICB9XG59KTtcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Iiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///223\n")},function(module,exports,__webpack_require__){"use strict";eval("\nvar $export = __webpack_require__(1);\nvar $reduce = __webpack_require__(108);\n\n$export($export.P + $export.F * !__webpack_require__(17)([].reduce, true), 'Array', {\n  // 22.1.3.18 / 15.4.4.21 Array.prototype.reduce(callbackfn [, initialValue])\n  reduce: function reduce(callbackfn /* , initialValue */) {\n    return $reduce(this, callbackfn, arguments.length, arguments[1], false);\n  }\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMjI0LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9lczYuYXJyYXkucmVkdWNlLmpzPzBjZDgiXSwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xudmFyICRleHBvcnQgPSByZXF1aXJlKCcuL19leHBvcnQnKTtcbnZhciAkcmVkdWNlID0gcmVxdWlyZSgnLi9fYXJyYXktcmVkdWNlJyk7XG5cbiRleHBvcnQoJGV4cG9ydC5QICsgJGV4cG9ydC5GICogIXJlcXVpcmUoJy4vX3N0cmljdC1tZXRob2QnKShbXS5yZWR1Y2UsIHRydWUpLCAnQXJyYXknLCB7XG4gIC8vIDIyLjEuMy4xOCAvIDE1LjQuNC4yMSBBcnJheS5wcm90b3R5cGUucmVkdWNlKGNhbGxiYWNrZm4gWywgaW5pdGlhbFZhbHVlXSlcbiAgcmVkdWNlOiBmdW5jdGlvbiByZWR1Y2UoY2FsbGJhY2tmbiAvKiAsIGluaXRpYWxWYWx1ZSAqLykge1xuICAgIHJldHVybiAkcmVkdWNlKHRoaXMsIGNhbGxiYWNrZm4sIGFyZ3VtZW50cy5sZW5ndGgsIGFyZ3VtZW50c1sxXSwgZmFsc2UpO1xuICB9XG59KTtcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Iiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///224\n")},function(module,exports,__webpack_require__){"use strict";eval("\nvar $export = __webpack_require__(1);\nvar $reduce = __webpack_require__(108);\n\n$export($export.P + $export.F * !__webpack_require__(17)([].reduceRight, true), 'Array', {\n  // 22.1.3.19 / 15.4.4.22 Array.prototype.reduceRight(callbackfn [, initialValue])\n  reduceRight: function reduceRight(callbackfn /* , initialValue */) {\n    return $reduce(this, callbackfn, arguments.length, arguments[1], true);\n  }\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMjI1LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9lczYuYXJyYXkucmVkdWNlLXJpZ2h0LmpzPzQ4ZjgiXSwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xudmFyICRleHBvcnQgPSByZXF1aXJlKCcuL19leHBvcnQnKTtcbnZhciAkcmVkdWNlID0gcmVxdWlyZSgnLi9fYXJyYXktcmVkdWNlJyk7XG5cbiRleHBvcnQoJGV4cG9ydC5QICsgJGV4cG9ydC5GICogIXJlcXVpcmUoJy4vX3N0cmljdC1tZXRob2QnKShbXS5yZWR1Y2VSaWdodCwgdHJ1ZSksICdBcnJheScsIHtcbiAgLy8gMjIuMS4zLjE5IC8gMTUuNC40LjIyIEFycmF5LnByb3RvdHlwZS5yZWR1Y2VSaWdodChjYWxsYmFja2ZuIFssIGluaXRpYWxWYWx1ZV0pXG4gIHJlZHVjZVJpZ2h0OiBmdW5jdGlvbiByZWR1Y2VSaWdodChjYWxsYmFja2ZuIC8qICwgaW5pdGlhbFZhbHVlICovKSB7XG4gICAgcmV0dXJuICRyZWR1Y2UodGhpcywgY2FsbGJhY2tmbiwgYXJndW1lbnRzLmxlbmd0aCwgYXJndW1lbnRzWzFdLCB0cnVlKTtcbiAgfVxufSk7XG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///225\n")},function(module,exports,__webpack_require__){"use strict";eval("\nvar $export = __webpack_require__(1);\nvar $indexOf = __webpack_require__(50)(false);\nvar $native = [].indexOf;\nvar NEGATIVE_ZERO = !!$native && 1 / [1].indexOf(1, -0) < 0;\n\n$export($export.P + $export.F * (NEGATIVE_ZERO || !__webpack_require__(17)($native)), 'Array', {\n  // 22.1.3.11 / 15.4.4.14 Array.prototype.indexOf(searchElement [, fromIndex])\n  indexOf: function indexOf(searchElement /* , fromIndex = 0 */) {\n    return NEGATIVE_ZERO\n      // convert -0 to +0\n      ? $native.apply(this, arguments) || 0\n      : $indexOf(this, searchElement, arguments[1]);\n  }\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMjI2LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9lczYuYXJyYXkuaW5kZXgtb2YuanM/NTdlNyJdLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XG52YXIgJGV4cG9ydCA9IHJlcXVpcmUoJy4vX2V4cG9ydCcpO1xudmFyICRpbmRleE9mID0gcmVxdWlyZSgnLi9fYXJyYXktaW5jbHVkZXMnKShmYWxzZSk7XG52YXIgJG5hdGl2ZSA9IFtdLmluZGV4T2Y7XG52YXIgTkVHQVRJVkVfWkVSTyA9ICEhJG5hdGl2ZSAmJiAxIC8gWzFdLmluZGV4T2YoMSwgLTApIDwgMDtcblxuJGV4cG9ydCgkZXhwb3J0LlAgKyAkZXhwb3J0LkYgKiAoTkVHQVRJVkVfWkVSTyB8fCAhcmVxdWlyZSgnLi9fc3RyaWN0LW1ldGhvZCcpKCRuYXRpdmUpKSwgJ0FycmF5Jywge1xuICAvLyAyMi4xLjMuMTEgLyAxNS40LjQuMTQgQXJyYXkucHJvdG90eXBlLmluZGV4T2Yoc2VhcmNoRWxlbWVudCBbLCBmcm9tSW5kZXhdKVxuICBpbmRleE9mOiBmdW5jdGlvbiBpbmRleE9mKHNlYXJjaEVsZW1lbnQgLyogLCBmcm9tSW5kZXggPSAwICovKSB7XG4gICAgcmV0dXJuIE5FR0FUSVZFX1pFUk9cbiAgICAgIC8vIGNvbnZlcnQgLTAgdG8gKzBcbiAgICAgID8gJG5hdGl2ZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpIHx8IDBcbiAgICAgIDogJGluZGV4T2YodGhpcywgc2VhcmNoRWxlbWVudCwgYXJndW1lbnRzWzFdKTtcbiAgfVxufSk7XG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///226\n")},function(module,exports,__webpack_require__){"use strict";eval("\nvar $export = __webpack_require__(1);\nvar toIObject = __webpack_require__(16);\nvar toInteger = __webpack_require__(20);\nvar toLength = __webpack_require__(7);\nvar $native = [].lastIndexOf;\nvar NEGATIVE_ZERO = !!$native && 1 / [1].lastIndexOf(1, -0) < 0;\n\n$export($export.P + $export.F * (NEGATIVE_ZERO || !__webpack_require__(17)($native)), 'Array', {\n  // 22.1.3.14 / 15.4.4.15 Array.prototype.lastIndexOf(searchElement [, fromIndex])\n  lastIndexOf: function lastIndexOf(searchElement /* , fromIndex = @[*-1] */) {\n    // convert -0 to +0\n    if (NEGATIVE_ZERO) return $native.apply(this, arguments) || 0;\n    var O = toIObject(this);\n    var length = toLength(O.length);\n    var index = length - 1;\n    if (arguments.length > 1) index = Math.min(index, toInteger(arguments[1]));\n    if (index < 0) index = length + index;\n    for (;index >= 0; index--) if (index in O) if (O[index] === searchElement) return index || 0;\n    return -1;\n  }\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMjI3LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9lczYuYXJyYXkubGFzdC1pbmRleC1vZi5qcz85ODY1Il0sInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcbnZhciAkZXhwb3J0ID0gcmVxdWlyZSgnLi9fZXhwb3J0Jyk7XG52YXIgdG9JT2JqZWN0ID0gcmVxdWlyZSgnLi9fdG8taW9iamVjdCcpO1xudmFyIHRvSW50ZWdlciA9IHJlcXVpcmUoJy4vX3RvLWludGVnZXInKTtcbnZhciB0b0xlbmd0aCA9IHJlcXVpcmUoJy4vX3RvLWxlbmd0aCcpO1xudmFyICRuYXRpdmUgPSBbXS5sYXN0SW5kZXhPZjtcbnZhciBORUdBVElWRV9aRVJPID0gISEkbmF0aXZlICYmIDEgLyBbMV0ubGFzdEluZGV4T2YoMSwgLTApIDwgMDtcblxuJGV4cG9ydCgkZXhwb3J0LlAgKyAkZXhwb3J0LkYgKiAoTkVHQVRJVkVfWkVSTyB8fCAhcmVxdWlyZSgnLi9fc3RyaWN0LW1ldGhvZCcpKCRuYXRpdmUpKSwgJ0FycmF5Jywge1xuICAvLyAyMi4xLjMuMTQgLyAxNS40LjQuMTUgQXJyYXkucHJvdG90eXBlLmxhc3RJbmRleE9mKHNlYXJjaEVsZW1lbnQgWywgZnJvbUluZGV4XSlcbiAgbGFzdEluZGV4T2Y6IGZ1bmN0aW9uIGxhc3RJbmRleE9mKHNlYXJjaEVsZW1lbnQgLyogLCBmcm9tSW5kZXggPSBAWyotMV0gKi8pIHtcbiAgICAvLyBjb252ZXJ0IC0wIHRvICswXG4gICAgaWYgKE5FR0FUSVZFX1pFUk8pIHJldHVybiAkbmF0aXZlLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfHwgMDtcbiAgICB2YXIgTyA9IHRvSU9iamVjdCh0aGlzKTtcbiAgICB2YXIgbGVuZ3RoID0gdG9MZW5ndGgoTy5sZW5ndGgpO1xuICAgIHZhciBpbmRleCA9IGxlbmd0aCAtIDE7XG4gICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPiAxKSBpbmRleCA9IE1hdGgubWluKGluZGV4LCB0b0ludGVnZXIoYXJndW1lbnRzWzFdKSk7XG4gICAgaWYgKGluZGV4IDwgMCkgaW5kZXggPSBsZW5ndGggKyBpbmRleDtcbiAgICBmb3IgKDtpbmRleCA+PSAwOyBpbmRleC0tKSBpZiAoaW5kZXggaW4gTykgaWYgKE9baW5kZXhdID09PSBzZWFyY2hFbGVtZW50KSByZXR1cm4gaW5kZXggfHwgMDtcbiAgICByZXR1cm4gLTE7XG4gIH1cbn0pO1xuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///227\n")},function(module,exports,__webpack_require__){eval("// 22.1.3.3 Array.prototype.copyWithin(target, start, end = this.length)\nvar $export = __webpack_require__(1);\n\n$export($export.P, 'Array', { copyWithin: __webpack_require__(109) });\n\n__webpack_require__(37)('copyWithin');\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMjI4LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9lczYuYXJyYXkuY29weS13aXRoaW4uanM/NzQ0ZiJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyAyMi4xLjMuMyBBcnJheS5wcm90b3R5cGUuY29weVdpdGhpbih0YXJnZXQsIHN0YXJ0LCBlbmQgPSB0aGlzLmxlbmd0aClcbnZhciAkZXhwb3J0ID0gcmVxdWlyZSgnLi9fZXhwb3J0Jyk7XG5cbiRleHBvcnQoJGV4cG9ydC5QLCAnQXJyYXknLCB7IGNvcHlXaXRoaW46IHJlcXVpcmUoJy4vX2FycmF5LWNvcHktd2l0aGluJykgfSk7XG5cbnJlcXVpcmUoJy4vX2FkZC10by11bnNjb3BhYmxlcycpKCdjb3B5V2l0aGluJyk7XG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///228\n")},function(module,exports,__webpack_require__){eval("// 22.1.3.6 Array.prototype.fill(value, start = 0, end = this.length)\nvar $export = __webpack_require__(1);\n\n$export($export.P, 'Array', { fill: __webpack_require__(80) });\n\n__webpack_require__(37)('fill');\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMjI5LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9lczYuYXJyYXkuZmlsbC5qcz82YzdiIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIDIyLjEuMy42IEFycmF5LnByb3RvdHlwZS5maWxsKHZhbHVlLCBzdGFydCA9IDAsIGVuZCA9IHRoaXMubGVuZ3RoKVxudmFyICRleHBvcnQgPSByZXF1aXJlKCcuL19leHBvcnQnKTtcblxuJGV4cG9ydCgkZXhwb3J0LlAsICdBcnJheScsIHsgZmlsbDogcmVxdWlyZSgnLi9fYXJyYXktZmlsbCcpIH0pO1xuXG5yZXF1aXJlKCcuL19hZGQtdG8tdW5zY29wYWJsZXMnKSgnZmlsbCcpO1xuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Iiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///229\n")},function(module,exports,__webpack_require__){"use strict";eval("\n// 22.1.3.8 Array.prototype.find(predicate, thisArg = undefined)\nvar $export = __webpack_require__(1);\nvar $find = __webpack_require__(23)(5);\nvar KEY = 'find';\nvar forced = true;\n// Shouldn't skip holes\nif (KEY in []) Array(1)[KEY](function () { forced = false; });\n$export($export.P + $export.F * forced, 'Array', {\n  find: function find(callbackfn /* , that = undefined */) {\n    return $find(this, callbackfn, arguments.length > 1 ? arguments[1] : undefined);\n  }\n});\n__webpack_require__(37)(KEY);\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMjMwLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9lczYuYXJyYXkuZmluZC5qcz83NTE0Il0sInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0Jztcbi8vIDIyLjEuMy44IEFycmF5LnByb3RvdHlwZS5maW5kKHByZWRpY2F0ZSwgdGhpc0FyZyA9IHVuZGVmaW5lZClcbnZhciAkZXhwb3J0ID0gcmVxdWlyZSgnLi9fZXhwb3J0Jyk7XG52YXIgJGZpbmQgPSByZXF1aXJlKCcuL19hcnJheS1tZXRob2RzJykoNSk7XG52YXIgS0VZID0gJ2ZpbmQnO1xudmFyIGZvcmNlZCA9IHRydWU7XG4vLyBTaG91bGRuJ3Qgc2tpcCBob2xlc1xuaWYgKEtFWSBpbiBbXSkgQXJyYXkoMSlbS0VZXShmdW5jdGlvbiAoKSB7IGZvcmNlZCA9IGZhbHNlOyB9KTtcbiRleHBvcnQoJGV4cG9ydC5QICsgJGV4cG9ydC5GICogZm9yY2VkLCAnQXJyYXknLCB7XG4gIGZpbmQ6IGZ1bmN0aW9uIGZpbmQoY2FsbGJhY2tmbiAvKiAsIHRoYXQgPSB1bmRlZmluZWQgKi8pIHtcbiAgICByZXR1cm4gJGZpbmQodGhpcywgY2FsbGJhY2tmbiwgYXJndW1lbnRzLmxlbmd0aCA+IDEgPyBhcmd1bWVudHNbMV0gOiB1bmRlZmluZWQpO1xuICB9XG59KTtcbnJlcXVpcmUoJy4vX2FkZC10by11bnNjb3BhYmxlcycpKEtFWSk7XG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Iiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///230\n")},function(module,exports,__webpack_require__){"use strict";eval("\n// 22.1.3.9 Array.prototype.findIndex(predicate, thisArg = undefined)\nvar $export = __webpack_require__(1);\nvar $find = __webpack_require__(23)(6);\nvar KEY = 'findIndex';\nvar forced = true;\n// Shouldn't skip holes\nif (KEY in []) Array(1)[KEY](function () { forced = false; });\n$export($export.P + $export.F * forced, 'Array', {\n  findIndex: function findIndex(callbackfn /* , that = undefined */) {\n    return $find(this, callbackfn, arguments.length > 1 ? arguments[1] : undefined);\n  }\n});\n__webpack_require__(37)(KEY);\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMjMxLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9lczYuYXJyYXkuZmluZC1pbmRleC5qcz8yMGQ2Il0sInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0Jztcbi8vIDIyLjEuMy45IEFycmF5LnByb3RvdHlwZS5maW5kSW5kZXgocHJlZGljYXRlLCB0aGlzQXJnID0gdW5kZWZpbmVkKVxudmFyICRleHBvcnQgPSByZXF1aXJlKCcuL19leHBvcnQnKTtcbnZhciAkZmluZCA9IHJlcXVpcmUoJy4vX2FycmF5LW1ldGhvZHMnKSg2KTtcbnZhciBLRVkgPSAnZmluZEluZGV4JztcbnZhciBmb3JjZWQgPSB0cnVlO1xuLy8gU2hvdWxkbid0IHNraXAgaG9sZXNcbmlmIChLRVkgaW4gW10pIEFycmF5KDEpW0tFWV0oZnVuY3Rpb24gKCkgeyBmb3JjZWQgPSBmYWxzZTsgfSk7XG4kZXhwb3J0KCRleHBvcnQuUCArICRleHBvcnQuRiAqIGZvcmNlZCwgJ0FycmF5Jywge1xuICBmaW5kSW5kZXg6IGZ1bmN0aW9uIGZpbmRJbmRleChjYWxsYmFja2ZuIC8qICwgdGhhdCA9IHVuZGVmaW5lZCAqLykge1xuICAgIHJldHVybiAkZmluZCh0aGlzLCBjYWxsYmFja2ZuLCBhcmd1bWVudHMubGVuZ3RoID4gMSA/IGFyZ3VtZW50c1sxXSA6IHVuZGVmaW5lZCk7XG4gIH1cbn0pO1xucmVxdWlyZSgnLi9fYWRkLXRvLXVuc2NvcGFibGVzJykoS0VZKTtcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///231\n")},function(module,exports,__webpack_require__){eval("__webpack_require__(42)('Array');\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMjMyLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9lczYuYXJyYXkuc3BlY2llcy5qcz9kMDRmIl0sInNvdXJjZXNDb250ZW50IjpbInJlcXVpcmUoJy4vX3NldC1zcGVjaWVzJykoJ0FycmF5Jyk7XG4iXSwibWFwcGluZ3MiOiJBQUFBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///232\n")},function(module,exports,__webpack_require__){eval("var global = __webpack_require__(2);\nvar inheritIfRequired = __webpack_require__(68);\nvar dP = __webpack_require__(10).f;\nvar gOPN = __webpack_require__(35).f;\nvar isRegExp = __webpack_require__(75);\nvar $flags = __webpack_require__(54);\nvar $RegExp = global.RegExp;\nvar Base = $RegExp;\nvar proto = $RegExp.prototype;\nvar re1 = /a/g;\nvar re2 = /a/g;\n// \"new\" creates a new object, old webkit buggy here\nvar CORRECT_NEW = new $RegExp(re1) !== re1;\n\nif (__webpack_require__(9) && (!CORRECT_NEW || __webpack_require__(3)(function () {\n  re2[__webpack_require__(6)('match')] = false;\n  // RegExp constructor can alter flags and IsRegExp works correct with @@match\n  return $RegExp(re1) != re1 || $RegExp(re2) == re2 || $RegExp(re1, 'i') != '/a/i';\n}))) {\n  $RegExp = function RegExp(p, f) {\n    var tiRE = this instanceof $RegExp;\n    var piRE = isRegExp(p);\n    var fiU = f === undefined;\n    return !tiRE && piRE && p.constructor === $RegExp && fiU ? p\n      : inheritIfRequired(CORRECT_NEW\n        ? new Base(piRE && !fiU ? p.source : p, f)\n        : Base((piRE = p instanceof $RegExp) ? p.source : p, piRE && fiU ? $flags.call(p) : f)\n      , tiRE ? this : proto, $RegExp);\n  };\n  var proxy = function (key) {\n    key in $RegExp || dP($RegExp, key, {\n      configurable: true,\n      get: function () { return Base[key]; },\n      set: function (it) { Base[key] = it; }\n    });\n  };\n  for (var keys = gOPN(Base), i = 0; keys.length > i;) proxy(keys[i++]);\n  proto.constructor = $RegExp;\n  $RegExp.prototype = proto;\n  __webpack_require__(12)(global, 'RegExp', $RegExp);\n}\n\n__webpack_require__(42)('RegExp');\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMjMzLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9lczYucmVnZXhwLmNvbnN0cnVjdG9yLmpzPzNiMmIiXSwic291cmNlc0NvbnRlbnQiOlsidmFyIGdsb2JhbCA9IHJlcXVpcmUoJy4vX2dsb2JhbCcpO1xudmFyIGluaGVyaXRJZlJlcXVpcmVkID0gcmVxdWlyZSgnLi9faW5oZXJpdC1pZi1yZXF1aXJlZCcpO1xudmFyIGRQID0gcmVxdWlyZSgnLi9fb2JqZWN0LWRwJykuZjtcbnZhciBnT1BOID0gcmVxdWlyZSgnLi9fb2JqZWN0LWdvcG4nKS5mO1xudmFyIGlzUmVnRXhwID0gcmVxdWlyZSgnLi9faXMtcmVnZXhwJyk7XG52YXIgJGZsYWdzID0gcmVxdWlyZSgnLi9fZmxhZ3MnKTtcbnZhciAkUmVnRXhwID0gZ2xvYmFsLlJlZ0V4cDtcbnZhciBCYXNlID0gJFJlZ0V4cDtcbnZhciBwcm90byA9ICRSZWdFeHAucHJvdG90eXBlO1xudmFyIHJlMSA9IC9hL2c7XG52YXIgcmUyID0gL2EvZztcbi8vIFwibmV3XCIgY3JlYXRlcyBhIG5ldyBvYmplY3QsIG9sZCB3ZWJraXQgYnVnZ3kgaGVyZVxudmFyIENPUlJFQ1RfTkVXID0gbmV3ICRSZWdFeHAocmUxKSAhPT0gcmUxO1xuXG5pZiAocmVxdWlyZSgnLi9fZGVzY3JpcHRvcnMnKSAmJiAoIUNPUlJFQ1RfTkVXIHx8IHJlcXVpcmUoJy4vX2ZhaWxzJykoZnVuY3Rpb24gKCkge1xuICByZTJbcmVxdWlyZSgnLi9fd2tzJykoJ21hdGNoJyldID0gZmFsc2U7XG4gIC8vIFJlZ0V4cCBjb25zdHJ1Y3RvciBjYW4gYWx0ZXIgZmxhZ3MgYW5kIElzUmVnRXhwIHdvcmtzIGNvcnJlY3Qgd2l0aCBAQG1hdGNoXG4gIHJldHVybiAkUmVnRXhwKHJlMSkgIT0gcmUxIHx8ICRSZWdFeHAocmUyKSA9PSByZTIgfHwgJFJlZ0V4cChyZTEsICdpJykgIT0gJy9hL2knO1xufSkpKSB7XG4gICRSZWdFeHAgPSBmdW5jdGlvbiBSZWdFeHAocCwgZikge1xuICAgIHZhciB0aVJFID0gdGhpcyBpbnN0YW5jZW9mICRSZWdFeHA7XG4gICAgdmFyIHBpUkUgPSBpc1JlZ0V4cChwKTtcbiAgICB2YXIgZmlVID0gZiA9PT0gdW5kZWZpbmVkO1xuICAgIHJldHVybiAhdGlSRSAmJiBwaVJFICYmIHAuY29uc3RydWN0b3IgPT09ICRSZWdFeHAgJiYgZmlVID8gcFxuICAgICAgOiBpbmhlcml0SWZSZXF1aXJlZChDT1JSRUNUX05FV1xuICAgICAgICA/IG5ldyBCYXNlKHBpUkUgJiYgIWZpVSA/IHAuc291cmNlIDogcCwgZilcbiAgICAgICAgOiBCYXNlKChwaVJFID0gcCBpbnN0YW5jZW9mICRSZWdFeHApID8gcC5zb3VyY2UgOiBwLCBwaVJFICYmIGZpVSA/ICRmbGFncy5jYWxsKHApIDogZilcbiAgICAgICwgdGlSRSA/IHRoaXMgOiBwcm90bywgJFJlZ0V4cCk7XG4gIH07XG4gIHZhciBwcm94eSA9IGZ1bmN0aW9uIChrZXkpIHtcbiAgICBrZXkgaW4gJFJlZ0V4cCB8fCBkUCgkUmVnRXhwLCBrZXksIHtcbiAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSxcbiAgICAgIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gQmFzZVtrZXldOyB9LFxuICAgICAgc2V0OiBmdW5jdGlvbiAoaXQpIHsgQmFzZVtrZXldID0gaXQ7IH1cbiAgICB9KTtcbiAgfTtcbiAgZm9yICh2YXIga2V5cyA9IGdPUE4oQmFzZSksIGkgPSAwOyBrZXlzLmxlbmd0aCA+IGk7KSBwcm94eShrZXlzW2krK10pO1xuICBwcm90by5jb25zdHJ1Y3RvciA9ICRSZWdFeHA7XG4gICRSZWdFeHAucHJvdG90eXBlID0gcHJvdG87XG4gIHJlcXVpcmUoJy4vX3JlZGVmaW5lJykoZ2xvYmFsLCAnUmVnRXhwJywgJFJlZ0V4cCk7XG59XG5cbnJlcXVpcmUoJy4vX3NldC1zcGVjaWVzJykoJ1JlZ0V4cCcpO1xuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///233\n")},function(module,exports,__webpack_require__){"use strict";eval("\n__webpack_require__(112);\nvar anObject = __webpack_require__(4);\nvar $flags = __webpack_require__(54);\nvar DESCRIPTORS = __webpack_require__(9);\nvar TO_STRING = 'toString';\nvar $toString = /./[TO_STRING];\n\nvar define = function (fn) {\n  __webpack_require__(12)(RegExp.prototype, TO_STRING, fn, true);\n};\n\n// 21.2.5.14 RegExp.prototype.toString()\nif (__webpack_require__(3)(function () { return $toString.call({ source: 'a', flags: 'b' }) != '/a/b'; })) {\n  define(function toString() {\n    var R = anObject(this);\n    return '/'.concat(R.source, '/',\n      'flags' in R ? R.flags : !DESCRIPTORS && R instanceof RegExp ? $flags.call(R) : undefined);\n  });\n// FF44- RegExp#toString has a wrong name\n} else if ($toString.name != TO_STRING) {\n  define(function toString() {\n    return $toString.call(this);\n  });\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMjM0LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9lczYucmVnZXhwLnRvLXN0cmluZy5qcz82YjU0Il0sInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcbnJlcXVpcmUoJy4vZXM2LnJlZ2V4cC5mbGFncycpO1xudmFyIGFuT2JqZWN0ID0gcmVxdWlyZSgnLi9fYW4tb2JqZWN0Jyk7XG52YXIgJGZsYWdzID0gcmVxdWlyZSgnLi9fZmxhZ3MnKTtcbnZhciBERVNDUklQVE9SUyA9IHJlcXVpcmUoJy4vX2Rlc2NyaXB0b3JzJyk7XG52YXIgVE9fU1RSSU5HID0gJ3RvU3RyaW5nJztcbnZhciAkdG9TdHJpbmcgPSAvLi9bVE9fU1RSSU5HXTtcblxudmFyIGRlZmluZSA9IGZ1bmN0aW9uIChmbikge1xuICByZXF1aXJlKCcuL19yZWRlZmluZScpKFJlZ0V4cC5wcm90b3R5cGUsIFRPX1NUUklORywgZm4sIHRydWUpO1xufTtcblxuLy8gMjEuMi41LjE0IFJlZ0V4cC5wcm90b3R5cGUudG9TdHJpbmcoKVxuaWYgKHJlcXVpcmUoJy4vX2ZhaWxzJykoZnVuY3Rpb24gKCkgeyByZXR1cm4gJHRvU3RyaW5nLmNhbGwoeyBzb3VyY2U6ICdhJywgZmxhZ3M6ICdiJyB9KSAhPSAnL2EvYic7IH0pKSB7XG4gIGRlZmluZShmdW5jdGlvbiB0b1N0cmluZygpIHtcbiAgICB2YXIgUiA9IGFuT2JqZWN0KHRoaXMpO1xuICAgIHJldHVybiAnLycuY29uY2F0KFIuc291cmNlLCAnLycsXG4gICAgICAnZmxhZ3MnIGluIFIgPyBSLmZsYWdzIDogIURFU0NSSVBUT1JTICYmIFIgaW5zdGFuY2VvZiBSZWdFeHAgPyAkZmxhZ3MuY2FsbChSKSA6IHVuZGVmaW5lZCk7XG4gIH0pO1xuLy8gRkY0NC0gUmVnRXhwI3RvU3RyaW5nIGhhcyBhIHdyb25nIG5hbWVcbn0gZWxzZSBpZiAoJHRvU3RyaW5nLm5hbWUgIT0gVE9fU1RSSU5HKSB7XG4gIGRlZmluZShmdW5jdGlvbiB0b1N0cmluZygpIHtcbiAgICByZXR1cm4gJHRvU3RyaW5nLmNhbGwodGhpcyk7XG4gIH0pO1xufVxuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///234\n")},function(module,exports,__webpack_require__){"use strict";eval("\n\nvar anObject = __webpack_require__(4);\nvar toLength = __webpack_require__(7);\nvar advanceStringIndex = __webpack_require__(83);\nvar regExpExec = __webpack_require__(55);\n\n// @@match logic\n__webpack_require__(56)('match', 1, function (defined, MATCH, $match, maybeCallNative) {\n  return [\n    // `String.prototype.match` method\n    // https://tc39.github.io/ecma262/#sec-string.prototype.match\n    function match(regexp) {\n      var O = defined(this);\n      var fn = regexp == undefined ? undefined : regexp[MATCH];\n      return fn !== undefined ? fn.call(regexp, O) : new RegExp(regexp)[MATCH](String(O));\n    },\n    // `RegExp.prototype[@@match]` method\n    // https://tc39.github.io/ecma262/#sec-regexp.prototype-@@match\n    function (regexp) {\n      var res = maybeCallNative($match, regexp, this);\n      if (res.done) return res.value;\n      var rx = anObject(regexp);\n      var S = String(this);\n      if (!rx.global) return regExpExec(rx, S);\n      var fullUnicode = rx.unicode;\n      rx.lastIndex = 0;\n      var A = [];\n      var n = 0;\n      var result;\n      while ((result = regExpExec(rx, S)) !== null) {\n        var matchStr = String(result[0]);\n        A[n] = matchStr;\n        if (matchStr === '') rx.lastIndex = advanceStringIndex(S, toLength(rx.lastIndex), fullUnicode);\n        n++;\n      }\n      return n === 0 ? null : A;\n    }\n  ];\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMjM1LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9lczYucmVnZXhwLm1hdGNoLmpzPzQ5MTciXSwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuXG52YXIgYW5PYmplY3QgPSByZXF1aXJlKCcuL19hbi1vYmplY3QnKTtcbnZhciB0b0xlbmd0aCA9IHJlcXVpcmUoJy4vX3RvLWxlbmd0aCcpO1xudmFyIGFkdmFuY2VTdHJpbmdJbmRleCA9IHJlcXVpcmUoJy4vX2FkdmFuY2Utc3RyaW5nLWluZGV4Jyk7XG52YXIgcmVnRXhwRXhlYyA9IHJlcXVpcmUoJy4vX3JlZ2V4cC1leGVjLWFic3RyYWN0Jyk7XG5cbi8vIEBAbWF0Y2ggbG9naWNcbnJlcXVpcmUoJy4vX2ZpeC1yZS13a3MnKSgnbWF0Y2gnLCAxLCBmdW5jdGlvbiAoZGVmaW5lZCwgTUFUQ0gsICRtYXRjaCwgbWF5YmVDYWxsTmF0aXZlKSB7XG4gIHJldHVybiBbXG4gICAgLy8gYFN0cmluZy5wcm90b3R5cGUubWF0Y2hgIG1ldGhvZFxuICAgIC8vIGh0dHBzOi8vdGMzOS5naXRodWIuaW8vZWNtYTI2Mi8jc2VjLXN0cmluZy5wcm90b3R5cGUubWF0Y2hcbiAgICBmdW5jdGlvbiBtYXRjaChyZWdleHApIHtcbiAgICAgIHZhciBPID0gZGVmaW5lZCh0aGlzKTtcbiAgICAgIHZhciBmbiA9IHJlZ2V4cCA9PSB1bmRlZmluZWQgPyB1bmRlZmluZWQgOiByZWdleHBbTUFUQ0hdO1xuICAgICAgcmV0dXJuIGZuICE9PSB1bmRlZmluZWQgPyBmbi5jYWxsKHJlZ2V4cCwgTykgOiBuZXcgUmVnRXhwKHJlZ2V4cClbTUFUQ0hdKFN0cmluZyhPKSk7XG4gICAgfSxcbiAgICAvLyBgUmVnRXhwLnByb3RvdHlwZVtAQG1hdGNoXWAgbWV0aG9kXG4gICAgLy8gaHR0cHM6Ly90YzM5LmdpdGh1Yi5pby9lY21hMjYyLyNzZWMtcmVnZXhwLnByb3RvdHlwZS1AQG1hdGNoXG4gICAgZnVuY3Rpb24gKHJlZ2V4cCkge1xuICAgICAgdmFyIHJlcyA9IG1heWJlQ2FsbE5hdGl2ZSgkbWF0Y2gsIHJlZ2V4cCwgdGhpcyk7XG4gICAgICBpZiAocmVzLmRvbmUpIHJldHVybiByZXMudmFsdWU7XG4gICAgICB2YXIgcnggPSBhbk9iamVjdChyZWdleHApO1xuICAgICAgdmFyIFMgPSBTdHJpbmcodGhpcyk7XG4gICAgICBpZiAoIXJ4Lmdsb2JhbCkgcmV0dXJuIHJlZ0V4cEV4ZWMocngsIFMpO1xuICAgICAgdmFyIGZ1bGxVbmljb2RlID0gcngudW5pY29kZTtcbiAgICAgIHJ4Lmxhc3RJbmRleCA9IDA7XG4gICAgICB2YXIgQSA9IFtdO1xuICAgICAgdmFyIG4gPSAwO1xuICAgICAgdmFyIHJlc3VsdDtcbiAgICAgIHdoaWxlICgocmVzdWx0ID0gcmVnRXhwRXhlYyhyeCwgUykpICE9PSBudWxsKSB7XG4gICAgICAgIHZhciBtYXRjaFN0ciA9IFN0cmluZyhyZXN1bHRbMF0pO1xuICAgICAgICBBW25dID0gbWF0Y2hTdHI7XG4gICAgICAgIGlmIChtYXRjaFN0ciA9PT0gJycpIHJ4Lmxhc3RJbmRleCA9IGFkdmFuY2VTdHJpbmdJbmRleChTLCB0b0xlbmd0aChyeC5sYXN0SW5kZXgpLCBmdWxsVW5pY29kZSk7XG4gICAgICAgIG4rKztcbiAgICAgIH1cbiAgICAgIHJldHVybiBuID09PSAwID8gbnVsbCA6IEE7XG4gICAgfVxuICBdO1xufSk7XG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///235\n")},function(module,exports,__webpack_require__){"use strict";eval("\n\nvar anObject = __webpack_require__(4);\nvar toObject = __webpack_require__(11);\nvar toLength = __webpack_require__(7);\nvar toInteger = __webpack_require__(20);\nvar advanceStringIndex = __webpack_require__(83);\nvar regExpExec = __webpack_require__(55);\nvar max = Math.max;\nvar min = Math.min;\nvar floor = Math.floor;\nvar SUBSTITUTION_SYMBOLS = /\\$([$&`']|\\d\\d?|<[^>]*>)/g;\nvar SUBSTITUTION_SYMBOLS_NO_NAMED = /\\$([$&`']|\\d\\d?)/g;\n\nvar maybeToString = function (it) {\n  return it === undefined ? it : String(it);\n};\n\n// @@replace logic\n__webpack_require__(56)('replace', 2, function (defined, REPLACE, $replace, maybeCallNative) {\n  return [\n    // `String.prototype.replace` method\n    // https://tc39.github.io/ecma262/#sec-string.prototype.replace\n    function replace(searchValue, replaceValue) {\n      var O = defined(this);\n      var fn = searchValue == undefined ? undefined : searchValue[REPLACE];\n      return fn !== undefined\n        ? fn.call(searchValue, O, replaceValue)\n        : $replace.call(String(O), searchValue, replaceValue);\n    },\n    // `RegExp.prototype[@@replace]` method\n    // https://tc39.github.io/ecma262/#sec-regexp.prototype-@@replace\n    function (regexp, replaceValue) {\n      var res = maybeCallNative($replace, regexp, this, replaceValue);\n      if (res.done) return res.value;\n\n      var rx = anObject(regexp);\n      var S = String(this);\n      var functionalReplace = typeof replaceValue === 'function';\n      if (!functionalReplace) replaceValue = String(replaceValue);\n      var global = rx.global;\n      if (global) {\n        var fullUnicode = rx.unicode;\n        rx.lastIndex = 0;\n      }\n      var results = [];\n      while (true) {\n        var result = regExpExec(rx, S);\n        if (result === null) break;\n        results.push(result);\n        if (!global) break;\n        var matchStr = String(result[0]);\n        if (matchStr === '') rx.lastIndex = advanceStringIndex(S, toLength(rx.lastIndex), fullUnicode);\n      }\n      var accumulatedResult = '';\n      var nextSourcePosition = 0;\n      for (var i = 0; i < results.length; i++) {\n        result = results[i];\n        var matched = String(result[0]);\n        var position = max(min(toInteger(result.index), S.length), 0);\n        var captures = [];\n        // NOTE: This is equivalent to\n        //   captures = result.slice(1).map(maybeToString)\n        // but for some reason `nativeSlice.call(result, 1, result.length)` (called in\n        // the slice polyfill when slicing native arrays) \"doesn't work\" in safari 9 and\n        // causes a crash (https://pastebin.com/N21QzeQA) when trying to debug it.\n        for (var j = 1; j < result.length; j++) captures.push(maybeToString(result[j]));\n        var namedCaptures = result.groups;\n        if (functionalReplace) {\n          var replacerArgs = [matched].concat(captures, position, S);\n          if (namedCaptures !== undefined) replacerArgs.push(namedCaptures);\n          var replacement = String(replaceValue.apply(undefined, replacerArgs));\n        } else {\n          replacement = getSubstitution(matched, S, position, captures, namedCaptures, replaceValue);\n        }\n        if (position >= nextSourcePosition) {\n          accumulatedResult += S.slice(nextSourcePosition, position) + replacement;\n          nextSourcePosition = position + matched.length;\n        }\n      }\n      return accumulatedResult + S.slice(nextSourcePosition);\n    }\n  ];\n\n    // https://tc39.github.io/ecma262/#sec-getsubstitution\n  function getSubstitution(matched, str, position, captures, namedCaptures, replacement) {\n    var tailPos = position + matched.length;\n    var m = captures.length;\n    var symbols = SUBSTITUTION_SYMBOLS_NO_NAMED;\n    if (namedCaptures !== undefined) {\n      namedCaptures = toObject(namedCaptures);\n      symbols = SUBSTITUTION_SYMBOLS;\n    }\n    return $replace.call(replacement, symbols, function (match, ch) {\n      var capture;\n      switch (ch.charAt(0)) {\n        case '$': return '$';\n        case '&': return matched;\n        case '`': return str.slice(0, position);\n        case \"'\": return str.slice(tailPos);\n        case '<':\n          capture = namedCaptures[ch.slice(1, -1)];\n          break;\n        default: // \\d\\d?\n          var n = +ch;\n          if (n === 0) return match;\n          if (n > m) {\n            var f = floor(n / 10);\n            if (f === 0) return match;\n            if (f <= m) return captures[f - 1] === undefined ? ch.charAt(1) : captures[f - 1] + ch.charAt(1);\n            return match;\n          }\n          capture = captures[n - 1];\n      }\n      return capture === undefined ? '' : capture;\n    });\n  }\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMjM2LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9lczYucmVnZXhwLnJlcGxhY2UuanM/YTQ4MSJdLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XG5cbnZhciBhbk9iamVjdCA9IHJlcXVpcmUoJy4vX2FuLW9iamVjdCcpO1xudmFyIHRvT2JqZWN0ID0gcmVxdWlyZSgnLi9fdG8tb2JqZWN0Jyk7XG52YXIgdG9MZW5ndGggPSByZXF1aXJlKCcuL190by1sZW5ndGgnKTtcbnZhciB0b0ludGVnZXIgPSByZXF1aXJlKCcuL190by1pbnRlZ2VyJyk7XG52YXIgYWR2YW5jZVN0cmluZ0luZGV4ID0gcmVxdWlyZSgnLi9fYWR2YW5jZS1zdHJpbmctaW5kZXgnKTtcbnZhciByZWdFeHBFeGVjID0gcmVxdWlyZSgnLi9fcmVnZXhwLWV4ZWMtYWJzdHJhY3QnKTtcbnZhciBtYXggPSBNYXRoLm1heDtcbnZhciBtaW4gPSBNYXRoLm1pbjtcbnZhciBmbG9vciA9IE1hdGguZmxvb3I7XG52YXIgU1VCU1RJVFVUSU9OX1NZTUJPTFMgPSAvXFwkKFskJmAnXXxcXGRcXGQ/fDxbXj5dKj4pL2c7XG52YXIgU1VCU1RJVFVUSU9OX1NZTUJPTFNfTk9fTkFNRUQgPSAvXFwkKFskJmAnXXxcXGRcXGQ/KS9nO1xuXG52YXIgbWF5YmVUb1N0cmluZyA9IGZ1bmN0aW9uIChpdCkge1xuICByZXR1cm4gaXQgPT09IHVuZGVmaW5lZCA/IGl0IDogU3RyaW5nKGl0KTtcbn07XG5cbi8vIEBAcmVwbGFjZSBsb2dpY1xucmVxdWlyZSgnLi9fZml4LXJlLXdrcycpKCdyZXBsYWNlJywgMiwgZnVuY3Rpb24gKGRlZmluZWQsIFJFUExBQ0UsICRyZXBsYWNlLCBtYXliZUNhbGxOYXRpdmUpIHtcbiAgcmV0dXJuIFtcbiAgICAvLyBgU3RyaW5nLnByb3RvdHlwZS5yZXBsYWNlYCBtZXRob2RcbiAgICAvLyBodHRwczovL3RjMzkuZ2l0aHViLmlvL2VjbWEyNjIvI3NlYy1zdHJpbmcucHJvdG90eXBlLnJlcGxhY2VcbiAgICBmdW5jdGlvbiByZXBsYWNlKHNlYXJjaFZhbHVlLCByZXBsYWNlVmFsdWUpIHtcbiAgICAgIHZhciBPID0gZGVmaW5lZCh0aGlzKTtcbiAgICAgIHZhciBmbiA9IHNlYXJjaFZhbHVlID09IHVuZGVmaW5lZCA/IHVuZGVmaW5lZCA6IHNlYXJjaFZhbHVlW1JFUExBQ0VdO1xuICAgICAgcmV0dXJuIGZuICE9PSB1bmRlZmluZWRcbiAgICAgICAgPyBmbi5jYWxsKHNlYXJjaFZhbHVlLCBPLCByZXBsYWNlVmFsdWUpXG4gICAgICAgIDogJHJlcGxhY2UuY2FsbChTdHJpbmcoTyksIHNlYXJjaFZhbHVlLCByZXBsYWNlVmFsdWUpO1xuICAgIH0sXG4gICAgLy8gYFJlZ0V4cC5wcm90b3R5cGVbQEByZXBsYWNlXWAgbWV0aG9kXG4gICAgLy8gaHR0cHM6Ly90YzM5LmdpdGh1Yi5pby9lY21hMjYyLyNzZWMtcmVnZXhwLnByb3RvdHlwZS1AQHJlcGxhY2VcbiAgICBmdW5jdGlvbiAocmVnZXhwLCByZXBsYWNlVmFsdWUpIHtcbiAgICAgIHZhciByZXMgPSBtYXliZUNhbGxOYXRpdmUoJHJlcGxhY2UsIHJlZ2V4cCwgdGhpcywgcmVwbGFjZVZhbHVlKTtcbiAgICAgIGlmIChyZXMuZG9uZSkgcmV0dXJuIHJlcy52YWx1ZTtcblxuICAgICAgdmFyIHJ4ID0gYW5PYmplY3QocmVnZXhwKTtcbiAgICAgIHZhciBTID0gU3RyaW5nKHRoaXMpO1xuICAgICAgdmFyIGZ1bmN0aW9uYWxSZXBsYWNlID0gdHlwZW9mIHJlcGxhY2VWYWx1ZSA9PT0gJ2Z1bmN0aW9uJztcbiAgICAgIGlmICghZnVuY3Rpb25hbFJlcGxhY2UpIHJlcGxhY2VWYWx1ZSA9IFN0cmluZyhyZXBsYWNlVmFsdWUpO1xuICAgICAgdmFyIGdsb2JhbCA9IHJ4Lmdsb2JhbDtcbiAgICAgIGlmIChnbG9iYWwpIHtcbiAgICAgICAgdmFyIGZ1bGxVbmljb2RlID0gcngudW5pY29kZTtcbiAgICAgICAgcngubGFzdEluZGV4ID0gMDtcbiAgICAgIH1cbiAgICAgIHZhciByZXN1bHRzID0gW107XG4gICAgICB3aGlsZSAodHJ1ZSkge1xuICAgICAgICB2YXIgcmVzdWx0ID0gcmVnRXhwRXhlYyhyeCwgUyk7XG4gICAgICAgIGlmIChyZXN1bHQgPT09IG51bGwpIGJyZWFrO1xuICAgICAgICByZXN1bHRzLnB1c2gocmVzdWx0KTtcbiAgICAgICAgaWYgKCFnbG9iYWwpIGJyZWFrO1xuICAgICAgICB2YXIgbWF0Y2hTdHIgPSBTdHJpbmcocmVzdWx0WzBdKTtcbiAgICAgICAgaWYgKG1hdGNoU3RyID09PSAnJykgcngubGFzdEluZGV4ID0gYWR2YW5jZVN0cmluZ0luZGV4KFMsIHRvTGVuZ3RoKHJ4Lmxhc3RJbmRleCksIGZ1bGxVbmljb2RlKTtcbiAgICAgIH1cbiAgICAgIHZhciBhY2N1bXVsYXRlZFJlc3VsdCA9ICcnO1xuICAgICAgdmFyIG5leHRTb3VyY2VQb3NpdGlvbiA9IDA7XG4gICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHJlc3VsdHMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgcmVzdWx0ID0gcmVzdWx0c1tpXTtcbiAgICAgICAgdmFyIG1hdGNoZWQgPSBTdHJpbmcocmVzdWx0WzBdKTtcbiAgICAgICAgdmFyIHBvc2l0aW9uID0gbWF4KG1pbih0b0ludGVnZXIocmVzdWx0LmluZGV4KSwgUy5sZW5ndGgpLCAwKTtcbiAgICAgICAgdmFyIGNhcHR1cmVzID0gW107XG4gICAgICAgIC8vIE5PVEU6IFRoaXMgaXMgZXF1aXZhbGVudCB0b1xuICAgICAgICAvLyAgIGNhcHR1cmVzID0gcmVzdWx0LnNsaWNlKDEpLm1hcChtYXliZVRvU3RyaW5nKVxuICAgICAgICAvLyBidXQgZm9yIHNvbWUgcmVhc29uIGBuYXRpdmVTbGljZS5jYWxsKHJlc3VsdCwgMSwgcmVzdWx0Lmxlbmd0aClgIChjYWxsZWQgaW5cbiAgICAgICAgLy8gdGhlIHNsaWNlIHBvbHlmaWxsIHdoZW4gc2xpY2luZyBuYXRpdmUgYXJyYXlzKSBcImRvZXNuJ3Qgd29ya1wiIGluIHNhZmFyaSA5IGFuZFxuICAgICAgICAvLyBjYXVzZXMgYSBjcmFzaCAoaHR0cHM6Ly9wYXN0ZWJpbi5jb20vTjIxUXplUUEpIHdoZW4gdHJ5aW5nIHRvIGRlYnVnIGl0LlxuICAgICAgICBmb3IgKHZhciBqID0gMTsgaiA8IHJlc3VsdC5sZW5ndGg7IGorKykgY2FwdHVyZXMucHVzaChtYXliZVRvU3RyaW5nKHJlc3VsdFtqXSkpO1xuICAgICAgICB2YXIgbmFtZWRDYXB0dXJlcyA9IHJlc3VsdC5ncm91cHM7XG4gICAgICAgIGlmIChmdW5jdGlvbmFsUmVwbGFjZSkge1xuICAgICAgICAgIHZhciByZXBsYWNlckFyZ3MgPSBbbWF0Y2hlZF0uY29uY2F0KGNhcHR1cmVzLCBwb3NpdGlvbiwgUyk7XG4gICAgICAgICAgaWYgKG5hbWVkQ2FwdHVyZXMgIT09IHVuZGVmaW5lZCkgcmVwbGFjZXJBcmdzLnB1c2gobmFtZWRDYXB0dXJlcyk7XG4gICAgICAgICAgdmFyIHJlcGxhY2VtZW50ID0gU3RyaW5nKHJlcGxhY2VWYWx1ZS5hcHBseSh1bmRlZmluZWQsIHJlcGxhY2VyQXJncykpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJlcGxhY2VtZW50ID0gZ2V0U3Vic3RpdHV0aW9uKG1hdGNoZWQsIFMsIHBvc2l0aW9uLCBjYXB0dXJlcywgbmFtZWRDYXB0dXJlcywgcmVwbGFjZVZhbHVlKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAocG9zaXRpb24gPj0gbmV4dFNvdXJjZVBvc2l0aW9uKSB7XG4gICAgICAgICAgYWNjdW11bGF0ZWRSZXN1bHQgKz0gUy5zbGljZShuZXh0U291cmNlUG9zaXRpb24sIHBvc2l0aW9uKSArIHJlcGxhY2VtZW50O1xuICAgICAgICAgIG5leHRTb3VyY2VQb3NpdGlvbiA9IHBvc2l0aW9uICsgbWF0Y2hlZC5sZW5ndGg7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiBhY2N1bXVsYXRlZFJlc3VsdCArIFMuc2xpY2UobmV4dFNvdXJjZVBvc2l0aW9uKTtcbiAgICB9XG4gIF07XG5cbiAgICAvLyBodHRwczovL3RjMzkuZ2l0aHViLmlvL2VjbWEyNjIvI3NlYy1nZXRzdWJzdGl0dXRpb25cbiAgZnVuY3Rpb24gZ2V0U3Vic3RpdHV0aW9uKG1hdGNoZWQsIHN0ciwgcG9zaXRpb24sIGNhcHR1cmVzLCBuYW1lZENhcHR1cmVzLCByZXBsYWNlbWVudCkge1xuICAgIHZhciB0YWlsUG9zID0gcG9zaXRpb24gKyBtYXRjaGVkLmxlbmd0aDtcbiAgICB2YXIgbSA9IGNhcHR1cmVzLmxlbmd0aDtcbiAgICB2YXIgc3ltYm9scyA9IFNVQlNUSVRVVElPTl9TWU1CT0xTX05PX05BTUVEO1xuICAgIGlmIChuYW1lZENhcHR1cmVzICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIG5hbWVkQ2FwdHVyZXMgPSB0b09iamVjdChuYW1lZENhcHR1cmVzKTtcbiAgICAgIHN5bWJvbHMgPSBTVUJTVElUVVRJT05fU1lNQk9MUztcbiAgICB9XG4gICAgcmV0dXJuICRyZXBsYWNlLmNhbGwocmVwbGFjZW1lbnQsIHN5bWJvbHMsIGZ1bmN0aW9uIChtYXRjaCwgY2gpIHtcbiAgICAgIHZhciBjYXB0dXJlO1xuICAgICAgc3dpdGNoIChjaC5jaGFyQXQoMCkpIHtcbiAgICAgICAgY2FzZSAnJCc6IHJldHVybiAnJCc7XG4gICAgICAgIGNhc2UgJyYnOiByZXR1cm4gbWF0Y2hlZDtcbiAgICAgICAgY2FzZSAnYCc6IHJldHVybiBzdHIuc2xpY2UoMCwgcG9zaXRpb24pO1xuICAgICAgICBjYXNlIFwiJ1wiOiByZXR1cm4gc3RyLnNsaWNlKHRhaWxQb3MpO1xuICAgICAgICBjYXNlICc8JzpcbiAgICAgICAgICBjYXB0dXJlID0gbmFtZWRDYXB0dXJlc1tjaC5zbGljZSgxLCAtMSldO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBkZWZhdWx0OiAvLyBcXGRcXGQ/XG4gICAgICAgICAgdmFyIG4gPSArY2g7XG4gICAgICAgICAgaWYgKG4gPT09IDApIHJldHVybiBtYXRjaDtcbiAgICAgICAgICBpZiAobiA+IG0pIHtcbiAgICAgICAgICAgIHZhciBmID0gZmxvb3IobiAvIDEwKTtcbiAgICAgICAgICAgIGlmIChmID09PSAwKSByZXR1cm4gbWF0Y2g7XG4gICAgICAgICAgICBpZiAoZiA8PSBtKSByZXR1cm4gY2FwdHVyZXNbZiAtIDFdID09PSB1bmRlZmluZWQgPyBjaC5jaGFyQXQoMSkgOiBjYXB0dXJlc1tmIC0gMV0gKyBjaC5jaGFyQXQoMSk7XG4gICAgICAgICAgICByZXR1cm4gbWF0Y2g7XG4gICAgICAgICAgfVxuICAgICAgICAgIGNhcHR1cmUgPSBjYXB0dXJlc1tuIC0gMV07XG4gICAgICB9XG4gICAgICByZXR1cm4gY2FwdHVyZSA9PT0gdW5kZWZpbmVkID8gJycgOiBjYXB0dXJlO1xuICAgIH0pO1xuICB9XG59KTtcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Iiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///236\n")},function(module,exports,__webpack_require__){"use strict";eval("\n\nvar anObject = __webpack_require__(4);\nvar sameValue = __webpack_require__(97);\nvar regExpExec = __webpack_require__(55);\n\n// @@search logic\n__webpack_require__(56)('search', 1, function (defined, SEARCH, $search, maybeCallNative) {\n  return [\n    // `String.prototype.search` method\n    // https://tc39.github.io/ecma262/#sec-string.prototype.search\n    function search(regexp) {\n      var O = defined(this);\n      var fn = regexp == undefined ? undefined : regexp[SEARCH];\n      return fn !== undefined ? fn.call(regexp, O) : new RegExp(regexp)[SEARCH](String(O));\n    },\n    // `RegExp.prototype[@@search]` method\n    // https://tc39.github.io/ecma262/#sec-regexp.prototype-@@search\n    function (regexp) {\n      var res = maybeCallNative($search, regexp, this);\n      if (res.done) return res.value;\n      var rx = anObject(regexp);\n      var S = String(this);\n      var previousLastIndex = rx.lastIndex;\n      if (!sameValue(previousLastIndex, 0)) rx.lastIndex = 0;\n      var result = regExpExec(rx, S);\n      if (!sameValue(rx.lastIndex, previousLastIndex)) rx.lastIndex = previousLastIndex;\n      return result === null ? -1 : result.index;\n    }\n  ];\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMjM3LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9lczYucmVnZXhwLnNlYXJjaC5qcz8zODZkIl0sInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcblxudmFyIGFuT2JqZWN0ID0gcmVxdWlyZSgnLi9fYW4tb2JqZWN0Jyk7XG52YXIgc2FtZVZhbHVlID0gcmVxdWlyZSgnLi9fc2FtZS12YWx1ZScpO1xudmFyIHJlZ0V4cEV4ZWMgPSByZXF1aXJlKCcuL19yZWdleHAtZXhlYy1hYnN0cmFjdCcpO1xuXG4vLyBAQHNlYXJjaCBsb2dpY1xucmVxdWlyZSgnLi9fZml4LXJlLXdrcycpKCdzZWFyY2gnLCAxLCBmdW5jdGlvbiAoZGVmaW5lZCwgU0VBUkNILCAkc2VhcmNoLCBtYXliZUNhbGxOYXRpdmUpIHtcbiAgcmV0dXJuIFtcbiAgICAvLyBgU3RyaW5nLnByb3RvdHlwZS5zZWFyY2hgIG1ldGhvZFxuICAgIC8vIGh0dHBzOi8vdGMzOS5naXRodWIuaW8vZWNtYTI2Mi8jc2VjLXN0cmluZy5wcm90b3R5cGUuc2VhcmNoXG4gICAgZnVuY3Rpb24gc2VhcmNoKHJlZ2V4cCkge1xuICAgICAgdmFyIE8gPSBkZWZpbmVkKHRoaXMpO1xuICAgICAgdmFyIGZuID0gcmVnZXhwID09IHVuZGVmaW5lZCA/IHVuZGVmaW5lZCA6IHJlZ2V4cFtTRUFSQ0hdO1xuICAgICAgcmV0dXJuIGZuICE9PSB1bmRlZmluZWQgPyBmbi5jYWxsKHJlZ2V4cCwgTykgOiBuZXcgUmVnRXhwKHJlZ2V4cClbU0VBUkNIXShTdHJpbmcoTykpO1xuICAgIH0sXG4gICAgLy8gYFJlZ0V4cC5wcm90b3R5cGVbQEBzZWFyY2hdYCBtZXRob2RcbiAgICAvLyBodHRwczovL3RjMzkuZ2l0aHViLmlvL2VjbWEyNjIvI3NlYy1yZWdleHAucHJvdG90eXBlLUBAc2VhcmNoXG4gICAgZnVuY3Rpb24gKHJlZ2V4cCkge1xuICAgICAgdmFyIHJlcyA9IG1heWJlQ2FsbE5hdGl2ZSgkc2VhcmNoLCByZWdleHAsIHRoaXMpO1xuICAgICAgaWYgKHJlcy5kb25lKSByZXR1cm4gcmVzLnZhbHVlO1xuICAgICAgdmFyIHJ4ID0gYW5PYmplY3QocmVnZXhwKTtcbiAgICAgIHZhciBTID0gU3RyaW5nKHRoaXMpO1xuICAgICAgdmFyIHByZXZpb3VzTGFzdEluZGV4ID0gcngubGFzdEluZGV4O1xuICAgICAgaWYgKCFzYW1lVmFsdWUocHJldmlvdXNMYXN0SW5kZXgsIDApKSByeC5sYXN0SW5kZXggPSAwO1xuICAgICAgdmFyIHJlc3VsdCA9IHJlZ0V4cEV4ZWMocngsIFMpO1xuICAgICAgaWYgKCFzYW1lVmFsdWUocngubGFzdEluZGV4LCBwcmV2aW91c0xhc3RJbmRleCkpIHJ4Lmxhc3RJbmRleCA9IHByZXZpb3VzTGFzdEluZGV4O1xuICAgICAgcmV0dXJuIHJlc3VsdCA9PT0gbnVsbCA/IC0xIDogcmVzdWx0LmluZGV4O1xuICAgIH1cbiAgXTtcbn0pO1xuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///237\n")},function(module,exports,__webpack_require__){"use strict";eval("\n\nvar isRegExp = __webpack_require__(75);\nvar anObject = __webpack_require__(4);\nvar speciesConstructor = __webpack_require__(48);\nvar advanceStringIndex = __webpack_require__(83);\nvar toLength = __webpack_require__(7);\nvar callRegExpExec = __webpack_require__(55);\nvar regexpExec = __webpack_require__(82);\nvar fails = __webpack_require__(3);\nvar $min = Math.min;\nvar $push = [].push;\nvar $SPLIT = 'split';\nvar LENGTH = 'length';\nvar LAST_INDEX = 'lastIndex';\nvar MAX_UINT32 = 0xffffffff;\n\n// babel-minify transpiles RegExp('x', 'y') -> /x/y and it causes SyntaxError\nvar SUPPORTS_Y = !fails(function () { RegExp(MAX_UINT32, 'y'); });\n\n// @@split logic\n__webpack_require__(56)('split', 2, function (defined, SPLIT, $split, maybeCallNative) {\n  var internalSplit;\n  if (\n    'abbc'[$SPLIT](/(b)*/)[1] == 'c' ||\n    'test'[$SPLIT](/(?:)/, -1)[LENGTH] != 4 ||\n    'ab'[$SPLIT](/(?:ab)*/)[LENGTH] != 2 ||\n    '.'[$SPLIT](/(.?)(.?)/)[LENGTH] != 4 ||\n    '.'[$SPLIT](/()()/)[LENGTH] > 1 ||\n    ''[$SPLIT](/.?/)[LENGTH]\n  ) {\n    // based on es5-shim implementation, need to rework it\n    internalSplit = function (separator, limit) {\n      var string = String(this);\n      if (separator === undefined && limit === 0) return [];\n      // If `separator` is not a regex, use native split\n      if (!isRegExp(separator)) return $split.call(string, separator, limit);\n      var output = [];\n      var flags = (separator.ignoreCase ? 'i' : '') +\n                  (separator.multiline ? 'm' : '') +\n                  (separator.unicode ? 'u' : '') +\n                  (separator.sticky ? 'y' : '');\n      var lastLastIndex = 0;\n      var splitLimit = limit === undefined ? MAX_UINT32 : limit >>> 0;\n      // Make `global` and avoid `lastIndex` issues by working with a copy\n      var separatorCopy = new RegExp(separator.source, flags + 'g');\n      var match, lastIndex, lastLength;\n      while (match = regexpExec.call(separatorCopy, string)) {\n        lastIndex = separatorCopy[LAST_INDEX];\n        if (lastIndex > lastLastIndex) {\n          output.push(string.slice(lastLastIndex, match.index));\n          if (match[LENGTH] > 1 && match.index < string[LENGTH]) $push.apply(output, match.slice(1));\n          lastLength = match[0][LENGTH];\n          lastLastIndex = lastIndex;\n          if (output[LENGTH] >= splitLimit) break;\n        }\n        if (separatorCopy[LAST_INDEX] === match.index) separatorCopy[LAST_INDEX]++; // Avoid an infinite loop\n      }\n      if (lastLastIndex === string[LENGTH]) {\n        if (lastLength || !separatorCopy.test('')) output.push('');\n      } else output.push(string.slice(lastLastIndex));\n      return output[LENGTH] > splitLimit ? output.slice(0, splitLimit) : output;\n    };\n  // Chakra, V8\n  } else if ('0'[$SPLIT](undefined, 0)[LENGTH]) {\n    internalSplit = function (separator, limit) {\n      return separator === undefined && limit === 0 ? [] : $split.call(this, separator, limit);\n    };\n  } else {\n    internalSplit = $split;\n  }\n\n  return [\n    // `String.prototype.split` method\n    // https://tc39.github.io/ecma262/#sec-string.prototype.split\n    function split(separator, limit) {\n      var O = defined(this);\n      var splitter = separator == undefined ? undefined : separator[SPLIT];\n      return splitter !== undefined\n        ? splitter.call(separator, O, limit)\n        : internalSplit.call(String(O), separator, limit);\n    },\n    // `RegExp.prototype[@@split]` method\n    // https://tc39.github.io/ecma262/#sec-regexp.prototype-@@split\n    //\n    // NOTE: This cannot be properly polyfilled in engines that don't support\n    // the 'y' flag.\n    function (regexp, limit) {\n      var res = maybeCallNative(internalSplit, regexp, this, limit, internalSplit !== $split);\n      if (res.done) return res.value;\n\n      var rx = anObject(regexp);\n      var S = String(this);\n      var C = speciesConstructor(rx, RegExp);\n\n      var unicodeMatching = rx.unicode;\n      var flags = (rx.ignoreCase ? 'i' : '') +\n                  (rx.multiline ? 'm' : '') +\n                  (rx.unicode ? 'u' : '') +\n                  (SUPPORTS_Y ? 'y' : 'g');\n\n      // ^(? + rx + ) is needed, in combination with some S slicing, to\n      // simulate the 'y' flag.\n      var splitter = new C(SUPPORTS_Y ? rx : '^(?:' + rx.source + ')', flags);\n      var lim = limit === undefined ? MAX_UINT32 : limit >>> 0;\n      if (lim === 0) return [];\n      if (S.length === 0) return callRegExpExec(splitter, S) === null ? [S] : [];\n      var p = 0;\n      var q = 0;\n      var A = [];\n      while (q < S.length) {\n        splitter.lastIndex = SUPPORTS_Y ? q : 0;\n        var z = callRegExpExec(splitter, SUPPORTS_Y ? S : S.slice(q));\n        var e;\n        if (\n          z === null ||\n          (e = $min(toLength(splitter.lastIndex + (SUPPORTS_Y ? 0 : q)), S.length)) === p\n        ) {\n          q = advanceStringIndex(S, q, unicodeMatching);\n        } else {\n          A.push(S.slice(p, q));\n          if (A.length === lim) return A;\n          for (var i = 1; i <= z.length - 1; i++) {\n            A.push(z[i]);\n            if (A.length === lim) return A;\n          }\n          q = p = e;\n        }\n      }\n      A.push(S.slice(p));\n      return A;\n    }\n  ];\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMjM4LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9lczYucmVnZXhwLnNwbGl0LmpzPzI4YTUiXSwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuXG52YXIgaXNSZWdFeHAgPSByZXF1aXJlKCcuL19pcy1yZWdleHAnKTtcbnZhciBhbk9iamVjdCA9IHJlcXVpcmUoJy4vX2FuLW9iamVjdCcpO1xudmFyIHNwZWNpZXNDb25zdHJ1Y3RvciA9IHJlcXVpcmUoJy4vX3NwZWNpZXMtY29uc3RydWN0b3InKTtcbnZhciBhZHZhbmNlU3RyaW5nSW5kZXggPSByZXF1aXJlKCcuL19hZHZhbmNlLXN0cmluZy1pbmRleCcpO1xudmFyIHRvTGVuZ3RoID0gcmVxdWlyZSgnLi9fdG8tbGVuZ3RoJyk7XG52YXIgY2FsbFJlZ0V4cEV4ZWMgPSByZXF1aXJlKCcuL19yZWdleHAtZXhlYy1hYnN0cmFjdCcpO1xudmFyIHJlZ2V4cEV4ZWMgPSByZXF1aXJlKCcuL19yZWdleHAtZXhlYycpO1xudmFyIGZhaWxzID0gcmVxdWlyZSgnLi9fZmFpbHMnKTtcbnZhciAkbWluID0gTWF0aC5taW47XG52YXIgJHB1c2ggPSBbXS5wdXNoO1xudmFyICRTUExJVCA9ICdzcGxpdCc7XG52YXIgTEVOR1RIID0gJ2xlbmd0aCc7XG52YXIgTEFTVF9JTkRFWCA9ICdsYXN0SW5kZXgnO1xudmFyIE1BWF9VSU5UMzIgPSAweGZmZmZmZmZmO1xuXG4vLyBiYWJlbC1taW5pZnkgdHJhbnNwaWxlcyBSZWdFeHAoJ3gnLCAneScpIC0+IC94L3kgYW5kIGl0IGNhdXNlcyBTeW50YXhFcnJvclxudmFyIFNVUFBPUlRTX1kgPSAhZmFpbHMoZnVuY3Rpb24gKCkgeyBSZWdFeHAoTUFYX1VJTlQzMiwgJ3knKTsgfSk7XG5cbi8vIEBAc3BsaXQgbG9naWNcbnJlcXVpcmUoJy4vX2ZpeC1yZS13a3MnKSgnc3BsaXQnLCAyLCBmdW5jdGlvbiAoZGVmaW5lZCwgU1BMSVQsICRzcGxpdCwgbWF5YmVDYWxsTmF0aXZlKSB7XG4gIHZhciBpbnRlcm5hbFNwbGl0O1xuICBpZiAoXG4gICAgJ2FiYmMnWyRTUExJVF0oLyhiKSovKVsxXSA9PSAnYycgfHxcbiAgICAndGVzdCdbJFNQTElUXSgvKD86KS8sIC0xKVtMRU5HVEhdICE9IDQgfHxcbiAgICAnYWInWyRTUExJVF0oLyg/OmFiKSovKVtMRU5HVEhdICE9IDIgfHxcbiAgICAnLidbJFNQTElUXSgvKC4/KSguPykvKVtMRU5HVEhdICE9IDQgfHxcbiAgICAnLidbJFNQTElUXSgvKCkoKS8pW0xFTkdUSF0gPiAxIHx8XG4gICAgJydbJFNQTElUXSgvLj8vKVtMRU5HVEhdXG4gICkge1xuICAgIC8vIGJhc2VkIG9uIGVzNS1zaGltIGltcGxlbWVudGF0aW9uLCBuZWVkIHRvIHJld29yayBpdFxuICAgIGludGVybmFsU3BsaXQgPSBmdW5jdGlvbiAoc2VwYXJhdG9yLCBsaW1pdCkge1xuICAgICAgdmFyIHN0cmluZyA9IFN0cmluZyh0aGlzKTtcbiAgICAgIGlmIChzZXBhcmF0b3IgPT09IHVuZGVmaW5lZCAmJiBsaW1pdCA9PT0gMCkgcmV0dXJuIFtdO1xuICAgICAgLy8gSWYgYHNlcGFyYXRvcmAgaXMgbm90IGEgcmVnZXgsIHVzZSBuYXRpdmUgc3BsaXRcbiAgICAgIGlmICghaXNSZWdFeHAoc2VwYXJhdG9yKSkgcmV0dXJuICRzcGxpdC5jYWxsKHN0cmluZywgc2VwYXJhdG9yLCBsaW1pdCk7XG4gICAgICB2YXIgb3V0cHV0ID0gW107XG4gICAgICB2YXIgZmxhZ3MgPSAoc2VwYXJhdG9yLmlnbm9yZUNhc2UgPyAnaScgOiAnJykgK1xuICAgICAgICAgICAgICAgICAgKHNlcGFyYXRvci5tdWx0aWxpbmUgPyAnbScgOiAnJykgK1xuICAgICAgICAgICAgICAgICAgKHNlcGFyYXRvci51bmljb2RlID8gJ3UnIDogJycpICtcbiAgICAgICAgICAgICAgICAgIChzZXBhcmF0b3Iuc3RpY2t5ID8gJ3knIDogJycpO1xuICAgICAgdmFyIGxhc3RMYXN0SW5kZXggPSAwO1xuICAgICAgdmFyIHNwbGl0TGltaXQgPSBsaW1pdCA9PT0gdW5kZWZpbmVkID8gTUFYX1VJTlQzMiA6IGxpbWl0ID4+PiAwO1xuICAgICAgLy8gTWFrZSBgZ2xvYmFsYCBhbmQgYXZvaWQgYGxhc3RJbmRleGAgaXNzdWVzIGJ5IHdvcmtpbmcgd2l0aCBhIGNvcHlcbiAgICAgIHZhciBzZXBhcmF0b3JDb3B5ID0gbmV3IFJlZ0V4cChzZXBhcmF0b3Iuc291cmNlLCBmbGFncyArICdnJyk7XG4gICAgICB2YXIgbWF0Y2gsIGxhc3RJbmRleCwgbGFzdExlbmd0aDtcbiAgICAgIHdoaWxlIChtYXRjaCA9IHJlZ2V4cEV4ZWMuY2FsbChzZXBhcmF0b3JDb3B5LCBzdHJpbmcpKSB7XG4gICAgICAgIGxhc3RJbmRleCA9IHNlcGFyYXRvckNvcHlbTEFTVF9JTkRFWF07XG4gICAgICAgIGlmIChsYXN0SW5kZXggPiBsYXN0TGFzdEluZGV4KSB7XG4gICAgICAgICAgb3V0cHV0LnB1c2goc3RyaW5nLnNsaWNlKGxhc3RMYXN0SW5kZXgsIG1hdGNoLmluZGV4KSk7XG4gICAgICAgICAgaWYgKG1hdGNoW0xFTkdUSF0gPiAxICYmIG1hdGNoLmluZGV4IDwgc3RyaW5nW0xFTkdUSF0pICRwdXNoLmFwcGx5KG91dHB1dCwgbWF0Y2guc2xpY2UoMSkpO1xuICAgICAgICAgIGxhc3RMZW5ndGggPSBtYXRjaFswXVtMRU5HVEhdO1xuICAgICAgICAgIGxhc3RMYXN0SW5kZXggPSBsYXN0SW5kZXg7XG4gICAgICAgICAgaWYgKG91dHB1dFtMRU5HVEhdID49IHNwbGl0TGltaXQpIGJyZWFrO1xuICAgICAgICB9XG4gICAgICAgIGlmIChzZXBhcmF0b3JDb3B5W0xBU1RfSU5ERVhdID09PSBtYXRjaC5pbmRleCkgc2VwYXJhdG9yQ29weVtMQVNUX0lOREVYXSsrOyAvLyBBdm9pZCBhbiBpbmZpbml0ZSBsb29wXG4gICAgICB9XG4gICAgICBpZiAobGFzdExhc3RJbmRleCA9PT0gc3RyaW5nW0xFTkdUSF0pIHtcbiAgICAgICAgaWYgKGxhc3RMZW5ndGggfHwgIXNlcGFyYXRvckNvcHkudGVzdCgnJykpIG91dHB1dC5wdXNoKCcnKTtcbiAgICAgIH0gZWxzZSBvdXRwdXQucHVzaChzdHJpbmcuc2xpY2UobGFzdExhc3RJbmRleCkpO1xuICAgICAgcmV0dXJuIG91dHB1dFtMRU5HVEhdID4gc3BsaXRMaW1pdCA/IG91dHB1dC5zbGljZSgwLCBzcGxpdExpbWl0KSA6IG91dHB1dDtcbiAgICB9O1xuICAvLyBDaGFrcmEsIFY4XG4gIH0gZWxzZSBpZiAoJzAnWyRTUExJVF0odW5kZWZpbmVkLCAwKVtMRU5HVEhdKSB7XG4gICAgaW50ZXJuYWxTcGxpdCA9IGZ1bmN0aW9uIChzZXBhcmF0b3IsIGxpbWl0KSB7XG4gICAgICByZXR1cm4gc2VwYXJhdG9yID09PSB1bmRlZmluZWQgJiYgbGltaXQgPT09IDAgPyBbXSA6ICRzcGxpdC5jYWxsKHRoaXMsIHNlcGFyYXRvciwgbGltaXQpO1xuICAgIH07XG4gIH0gZWxzZSB7XG4gICAgaW50ZXJuYWxTcGxpdCA9ICRzcGxpdDtcbiAgfVxuXG4gIHJldHVybiBbXG4gICAgLy8gYFN0cmluZy5wcm90b3R5cGUuc3BsaXRgIG1ldGhvZFxuICAgIC8vIGh0dHBzOi8vdGMzOS5naXRodWIuaW8vZWNtYTI2Mi8jc2VjLXN0cmluZy5wcm90b3R5cGUuc3BsaXRcbiAgICBmdW5jdGlvbiBzcGxpdChzZXBhcmF0b3IsIGxpbWl0KSB7XG4gICAgICB2YXIgTyA9IGRlZmluZWQodGhpcyk7XG4gICAgICB2YXIgc3BsaXR0ZXIgPSBzZXBhcmF0b3IgPT0gdW5kZWZpbmVkID8gdW5kZWZpbmVkIDogc2VwYXJhdG9yW1NQTElUXTtcbiAgICAgIHJldHVybiBzcGxpdHRlciAhPT0gdW5kZWZpbmVkXG4gICAgICAgID8gc3BsaXR0ZXIuY2FsbChzZXBhcmF0b3IsIE8sIGxpbWl0KVxuICAgICAgICA6IGludGVybmFsU3BsaXQuY2FsbChTdHJpbmcoTyksIHNlcGFyYXRvciwgbGltaXQpO1xuICAgIH0sXG4gICAgLy8gYFJlZ0V4cC5wcm90b3R5cGVbQEBzcGxpdF1gIG1ldGhvZFxuICAgIC8vIGh0dHBzOi8vdGMzOS5naXRodWIuaW8vZWNtYTI2Mi8jc2VjLXJlZ2V4cC5wcm90b3R5cGUtQEBzcGxpdFxuICAgIC8vXG4gICAgLy8gTk9URTogVGhpcyBjYW5ub3QgYmUgcHJvcGVybHkgcG9seWZpbGxlZCBpbiBlbmdpbmVzIHRoYXQgZG9uJ3Qgc3VwcG9ydFxuICAgIC8vIHRoZSAneScgZmxhZy5cbiAgICBmdW5jdGlvbiAocmVnZXhwLCBsaW1pdCkge1xuICAgICAgdmFyIHJlcyA9IG1heWJlQ2FsbE5hdGl2ZShpbnRlcm5hbFNwbGl0LCByZWdleHAsIHRoaXMsIGxpbWl0LCBpbnRlcm5hbFNwbGl0ICE9PSAkc3BsaXQpO1xuICAgICAgaWYgKHJlcy5kb25lKSByZXR1cm4gcmVzLnZhbHVlO1xuXG4gICAgICB2YXIgcnggPSBhbk9iamVjdChyZWdleHApO1xuICAgICAgdmFyIFMgPSBTdHJpbmcodGhpcyk7XG4gICAgICB2YXIgQyA9IHNwZWNpZXNDb25zdHJ1Y3RvcihyeCwgUmVnRXhwKTtcblxuICAgICAgdmFyIHVuaWNvZGVNYXRjaGluZyA9IHJ4LnVuaWNvZGU7XG4gICAgICB2YXIgZmxhZ3MgPSAocnguaWdub3JlQ2FzZSA/ICdpJyA6ICcnKSArXG4gICAgICAgICAgICAgICAgICAocngubXVsdGlsaW5lID8gJ20nIDogJycpICtcbiAgICAgICAgICAgICAgICAgIChyeC51bmljb2RlID8gJ3UnIDogJycpICtcbiAgICAgICAgICAgICAgICAgIChTVVBQT1JUU19ZID8gJ3knIDogJ2cnKTtcblxuICAgICAgLy8gXig/ICsgcnggKyApIGlzIG5lZWRlZCwgaW4gY29tYmluYXRpb24gd2l0aCBzb21lIFMgc2xpY2luZywgdG9cbiAgICAgIC8vIHNpbXVsYXRlIHRoZSAneScgZmxhZy5cbiAgICAgIHZhciBzcGxpdHRlciA9IG5ldyBDKFNVUFBPUlRTX1kgPyByeCA6ICdeKD86JyArIHJ4LnNvdXJjZSArICcpJywgZmxhZ3MpO1xuICAgICAgdmFyIGxpbSA9IGxpbWl0ID09PSB1bmRlZmluZWQgPyBNQVhfVUlOVDMyIDogbGltaXQgPj4+IDA7XG4gICAgICBpZiAobGltID09PSAwKSByZXR1cm4gW107XG4gICAgICBpZiAoUy5sZW5ndGggPT09IDApIHJldHVybiBjYWxsUmVnRXhwRXhlYyhzcGxpdHRlciwgUykgPT09IG51bGwgPyBbU10gOiBbXTtcbiAgICAgIHZhciBwID0gMDtcbiAgICAgIHZhciBxID0gMDtcbiAgICAgIHZhciBBID0gW107XG4gICAgICB3aGlsZSAocSA8IFMubGVuZ3RoKSB7XG4gICAgICAgIHNwbGl0dGVyLmxhc3RJbmRleCA9IFNVUFBPUlRTX1kgPyBxIDogMDtcbiAgICAgICAgdmFyIHogPSBjYWxsUmVnRXhwRXhlYyhzcGxpdHRlciwgU1VQUE9SVFNfWSA/IFMgOiBTLnNsaWNlKHEpKTtcbiAgICAgICAgdmFyIGU7XG4gICAgICAgIGlmIChcbiAgICAgICAgICB6ID09PSBudWxsIHx8XG4gICAgICAgICAgKGUgPSAkbWluKHRvTGVuZ3RoKHNwbGl0dGVyLmxhc3RJbmRleCArIChTVVBQT1JUU19ZID8gMCA6IHEpKSwgUy5sZW5ndGgpKSA9PT0gcFxuICAgICAgICApIHtcbiAgICAgICAgICBxID0gYWR2YW5jZVN0cmluZ0luZGV4KFMsIHEsIHVuaWNvZGVNYXRjaGluZyk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgQS5wdXNoKFMuc2xpY2UocCwgcSkpO1xuICAgICAgICAgIGlmIChBLmxlbmd0aCA9PT0gbGltKSByZXR1cm4gQTtcbiAgICAgICAgICBmb3IgKHZhciBpID0gMTsgaSA8PSB6Lmxlbmd0aCAtIDE7IGkrKykge1xuICAgICAgICAgICAgQS5wdXNoKHpbaV0pO1xuICAgICAgICAgICAgaWYgKEEubGVuZ3RoID09PSBsaW0pIHJldHVybiBBO1xuICAgICAgICAgIH1cbiAgICAgICAgICBxID0gcCA9IGU7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIEEucHVzaChTLnNsaWNlKHApKTtcbiAgICAgIHJldHVybiBBO1xuICAgIH1cbiAgXTtcbn0pO1xuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///238\n")},function(module,exports,__webpack_require__){eval("var global = __webpack_require__(2);\nvar macrotask = __webpack_require__(84).set;\nvar Observer = global.MutationObserver || global.WebKitMutationObserver;\nvar process = global.process;\nvar Promise = global.Promise;\nvar isNode = __webpack_require__(24)(process) == 'process';\n\nmodule.exports = function () {\n  var head, last, notify;\n\n  var flush = function () {\n    var parent, fn;\n    if (isNode && (parent = process.domain)) parent.exit();\n    while (head) {\n      fn = head.fn;\n      head = head.next;\n      try {\n        fn();\n      } catch (e) {\n        if (head) notify();\n        else last = undefined;\n        throw e;\n      }\n    } last = undefined;\n    if (parent) parent.enter();\n  };\n\n  // Node.js\n  if (isNode) {\n    notify = function () {\n      process.nextTick(flush);\n    };\n  // browsers with MutationObserver, except iOS Safari - https://github.com/zloirock/core-js/issues/339\n  } else if (Observer && !(global.navigator && global.navigator.standalone)) {\n    var toggle = true;\n    var node = document.createTextNode('');\n    new Observer(flush).observe(node, { characterData: true }); // eslint-disable-line no-new\n    notify = function () {\n      node.data = toggle = !toggle;\n    };\n  // environments with maybe non-completely correct, but existent Promise\n  } else if (Promise && Promise.resolve) {\n    // Promise.resolve without an argument throws an error in LG WebOS 2\n    var promise = Promise.resolve(undefined);\n    notify = function () {\n      promise.then(flush);\n    };\n  // for other environments - macrotask based on:\n  // - setImmediate\n  // - MessageChannel\n  // - window.postMessag\n  // - onreadystatechange\n  // - setTimeout\n  } else {\n    notify = function () {\n      // strange IE + webpack dev server bug - use .call(global)\n      macrotask.call(global, flush);\n    };\n  }\n\n  return function (fn) {\n    var task = { fn: fn, next: undefined };\n    if (last) last.next = task;\n    if (!head) {\n      head = task;\n      notify();\n    } last = task;\n  };\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMjM5LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9fbWljcm90YXNrLmpzPzgwNzkiXSwic291cmNlc0NvbnRlbnQiOlsidmFyIGdsb2JhbCA9IHJlcXVpcmUoJy4vX2dsb2JhbCcpO1xudmFyIG1hY3JvdGFzayA9IHJlcXVpcmUoJy4vX3Rhc2snKS5zZXQ7XG52YXIgT2JzZXJ2ZXIgPSBnbG9iYWwuTXV0YXRpb25PYnNlcnZlciB8fCBnbG9iYWwuV2ViS2l0TXV0YXRpb25PYnNlcnZlcjtcbnZhciBwcm9jZXNzID0gZ2xvYmFsLnByb2Nlc3M7XG52YXIgUHJvbWlzZSA9IGdsb2JhbC5Qcm9taXNlO1xudmFyIGlzTm9kZSA9IHJlcXVpcmUoJy4vX2NvZicpKHByb2Nlc3MpID09ICdwcm9jZXNzJztcblxubW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoKSB7XG4gIHZhciBoZWFkLCBsYXN0LCBub3RpZnk7XG5cbiAgdmFyIGZsdXNoID0gZnVuY3Rpb24gKCkge1xuICAgIHZhciBwYXJlbnQsIGZuO1xuICAgIGlmIChpc05vZGUgJiYgKHBhcmVudCA9IHByb2Nlc3MuZG9tYWluKSkgcGFyZW50LmV4aXQoKTtcbiAgICB3aGlsZSAoaGVhZCkge1xuICAgICAgZm4gPSBoZWFkLmZuO1xuICAgICAgaGVhZCA9IGhlYWQubmV4dDtcbiAgICAgIHRyeSB7XG4gICAgICAgIGZuKCk7XG4gICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgIGlmIChoZWFkKSBub3RpZnkoKTtcbiAgICAgICAgZWxzZSBsYXN0ID0gdW5kZWZpbmVkO1xuICAgICAgICB0aHJvdyBlO1xuICAgICAgfVxuICAgIH0gbGFzdCA9IHVuZGVmaW5lZDtcbiAgICBpZiAocGFyZW50KSBwYXJlbnQuZW50ZXIoKTtcbiAgfTtcblxuICAvLyBOb2RlLmpzXG4gIGlmIChpc05vZGUpIHtcbiAgICBub3RpZnkgPSBmdW5jdGlvbiAoKSB7XG4gICAgICBwcm9jZXNzLm5leHRUaWNrKGZsdXNoKTtcbiAgICB9O1xuICAvLyBicm93c2VycyB3aXRoIE11dGF0aW9uT2JzZXJ2ZXIsIGV4Y2VwdCBpT1MgU2FmYXJpIC0gaHR0cHM6Ly9naXRodWIuY29tL3psb2lyb2NrL2NvcmUtanMvaXNzdWVzLzMzOVxuICB9IGVsc2UgaWYgKE9ic2VydmVyICYmICEoZ2xvYmFsLm5hdmlnYXRvciAmJiBnbG9iYWwubmF2aWdhdG9yLnN0YW5kYWxvbmUpKSB7XG4gICAgdmFyIHRvZ2dsZSA9IHRydWU7XG4gICAgdmFyIG5vZGUgPSBkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgnJyk7XG4gICAgbmV3IE9ic2VydmVyKGZsdXNoKS5vYnNlcnZlKG5vZGUsIHsgY2hhcmFjdGVyRGF0YTogdHJ1ZSB9KTsgLy8gZXNsaW50LWRpc2FibGUtbGluZSBuby1uZXdcbiAgICBub3RpZnkgPSBmdW5jdGlvbiAoKSB7XG4gICAgICBub2RlLmRhdGEgPSB0b2dnbGUgPSAhdG9nZ2xlO1xuICAgIH07XG4gIC8vIGVudmlyb25tZW50cyB3aXRoIG1heWJlIG5vbi1jb21wbGV0ZWx5IGNvcnJlY3QsIGJ1dCBleGlzdGVudCBQcm9taXNlXG4gIH0gZWxzZSBpZiAoUHJvbWlzZSAmJiBQcm9taXNlLnJlc29sdmUpIHtcbiAgICAvLyBQcm9taXNlLnJlc29sdmUgd2l0aG91dCBhbiBhcmd1bWVudCB0aHJvd3MgYW4gZXJyb3IgaW4gTEcgV2ViT1MgMlxuICAgIHZhciBwcm9taXNlID0gUHJvbWlzZS5yZXNvbHZlKHVuZGVmaW5lZCk7XG4gICAgbm90aWZ5ID0gZnVuY3Rpb24gKCkge1xuICAgICAgcHJvbWlzZS50aGVuKGZsdXNoKTtcbiAgICB9O1xuICAvLyBmb3Igb3RoZXIgZW52aXJvbm1lbnRzIC0gbWFjcm90YXNrIGJhc2VkIG9uOlxuICAvLyAtIHNldEltbWVkaWF0ZVxuICAvLyAtIE1lc3NhZ2VDaGFubmVsXG4gIC8vIC0gd2luZG93LnBvc3RNZXNzYWdcbiAgLy8gLSBvbnJlYWR5c3RhdGVjaGFuZ2VcbiAgLy8gLSBzZXRUaW1lb3V0XG4gIH0gZWxzZSB7XG4gICAgbm90aWZ5ID0gZnVuY3Rpb24gKCkge1xuICAgICAgLy8gc3RyYW5nZSBJRSArIHdlYnBhY2sgZGV2IHNlcnZlciBidWcgLSB1c2UgLmNhbGwoZ2xvYmFsKVxuICAgICAgbWFjcm90YXNrLmNhbGwoZ2xvYmFsLCBmbHVzaCk7XG4gICAgfTtcbiAgfVxuXG4gIHJldHVybiBmdW5jdGlvbiAoZm4pIHtcbiAgICB2YXIgdGFzayA9IHsgZm46IGZuLCBuZXh0OiB1bmRlZmluZWQgfTtcbiAgICBpZiAobGFzdCkgbGFzdC5uZXh0ID0gdGFzaztcbiAgICBpZiAoIWhlYWQpIHtcbiAgICAgIGhlYWQgPSB0YXNrO1xuICAgICAgbm90aWZ5KCk7XG4gICAgfSBsYXN0ID0gdGFzaztcbiAgfTtcbn07XG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///239\n")},function(module,exports){eval("module.exports = function (exec) {\n  try {\n    return { e: false, v: exec() };\n  } catch (e) {\n    return { e: true, v: e };\n  }\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMjQwLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9fcGVyZm9ybS5qcz85YzgwIl0sInNvdXJjZXNDb250ZW50IjpbIm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKGV4ZWMpIHtcbiAgdHJ5IHtcbiAgICByZXR1cm4geyBlOiBmYWxzZSwgdjogZXhlYygpIH07XG4gIH0gY2F0Y2ggKGUpIHtcbiAgICByZXR1cm4geyBlOiB0cnVlLCB2OiBlIH07XG4gIH1cbn07XG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///240\n")},function(module,exports,__webpack_require__){"use strict";eval("\nvar strong = __webpack_require__(116);\nvar validate = __webpack_require__(38);\nvar MAP = 'Map';\n\n// 23.1 Map Objects\nmodule.exports = __webpack_require__(59)(MAP, function (get) {\n  return function Map() { return get(this, arguments.length > 0 ? arguments[0] : undefined); };\n}, {\n  // 23.1.3.6 Map.prototype.get(key)\n  get: function get(key) {\n    var entry = strong.getEntry(validate(this, MAP), key);\n    return entry && entry.v;\n  },\n  // 23.1.3.9 Map.prototype.set(key, value)\n  set: function set(key, value) {\n    return strong.def(validate(this, MAP), key === 0 ? 0 : key, value);\n  }\n}, strong, true);\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMjQxLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9lczYubWFwLmpzP2Y0MDAiXSwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xudmFyIHN0cm9uZyA9IHJlcXVpcmUoJy4vX2NvbGxlY3Rpb24tc3Ryb25nJyk7XG52YXIgdmFsaWRhdGUgPSByZXF1aXJlKCcuL192YWxpZGF0ZS1jb2xsZWN0aW9uJyk7XG52YXIgTUFQID0gJ01hcCc7XG5cbi8vIDIzLjEgTWFwIE9iamVjdHNcbm1vZHVsZS5leHBvcnRzID0gcmVxdWlyZSgnLi9fY29sbGVjdGlvbicpKE1BUCwgZnVuY3Rpb24gKGdldCkge1xuICByZXR1cm4gZnVuY3Rpb24gTWFwKCkgeyByZXR1cm4gZ2V0KHRoaXMsIGFyZ3VtZW50cy5sZW5ndGggPiAwID8gYXJndW1lbnRzWzBdIDogdW5kZWZpbmVkKTsgfTtcbn0sIHtcbiAgLy8gMjMuMS4zLjYgTWFwLnByb3RvdHlwZS5nZXQoa2V5KVxuICBnZXQ6IGZ1bmN0aW9uIGdldChrZXkpIHtcbiAgICB2YXIgZW50cnkgPSBzdHJvbmcuZ2V0RW50cnkodmFsaWRhdGUodGhpcywgTUFQKSwga2V5KTtcbiAgICByZXR1cm4gZW50cnkgJiYgZW50cnkudjtcbiAgfSxcbiAgLy8gMjMuMS4zLjkgTWFwLnByb3RvdHlwZS5zZXQoa2V5LCB2YWx1ZSlcbiAgc2V0OiBmdW5jdGlvbiBzZXQoa2V5LCB2YWx1ZSkge1xuICAgIHJldHVybiBzdHJvbmcuZGVmKHZhbGlkYXRlKHRoaXMsIE1BUCksIGtleSA9PT0gMCA/IDAgOiBrZXksIHZhbHVlKTtcbiAgfVxufSwgc3Ryb25nLCB0cnVlKTtcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Iiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///241\n")},function(module,exports,__webpack_require__){"use strict";eval("\nvar strong = __webpack_require__(116);\nvar validate = __webpack_require__(38);\nvar SET = 'Set';\n\n// 23.2 Set Objects\nmodule.exports = __webpack_require__(59)(SET, function (get) {\n  return function Set() { return get(this, arguments.length > 0 ? arguments[0] : undefined); };\n}, {\n  // 23.2.3.1 Set.prototype.add(value)\n  add: function add(value) {\n    return strong.def(validate(this, SET), value = value === 0 ? 0 : value, value);\n  }\n}, strong);\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMjQyLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9lczYuc2V0LmpzPzRmN2YiXSwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xudmFyIHN0cm9uZyA9IHJlcXVpcmUoJy4vX2NvbGxlY3Rpb24tc3Ryb25nJyk7XG52YXIgdmFsaWRhdGUgPSByZXF1aXJlKCcuL192YWxpZGF0ZS1jb2xsZWN0aW9uJyk7XG52YXIgU0VUID0gJ1NldCc7XG5cbi8vIDIzLjIgU2V0IE9iamVjdHNcbm1vZHVsZS5leHBvcnRzID0gcmVxdWlyZSgnLi9fY29sbGVjdGlvbicpKFNFVCwgZnVuY3Rpb24gKGdldCkge1xuICByZXR1cm4gZnVuY3Rpb24gU2V0KCkgeyByZXR1cm4gZ2V0KHRoaXMsIGFyZ3VtZW50cy5sZW5ndGggPiAwID8gYXJndW1lbnRzWzBdIDogdW5kZWZpbmVkKTsgfTtcbn0sIHtcbiAgLy8gMjMuMi4zLjEgU2V0LnByb3RvdHlwZS5hZGQodmFsdWUpXG4gIGFkZDogZnVuY3Rpb24gYWRkKHZhbHVlKSB7XG4gICAgcmV0dXJuIHN0cm9uZy5kZWYodmFsaWRhdGUodGhpcywgU0VUKSwgdmFsdWUgPSB2YWx1ZSA9PT0gMCA/IDAgOiB2YWx1ZSwgdmFsdWUpO1xuICB9XG59LCBzdHJvbmcpO1xuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///242\n")},function(module,exports,__webpack_require__){"use strict";eval("\nvar global = __webpack_require__(2);\nvar each = __webpack_require__(23)(0);\nvar redefine = __webpack_require__(12);\nvar meta = __webpack_require__(28);\nvar assign = __webpack_require__(96);\nvar weak = __webpack_require__(117);\nvar isObject = __webpack_require__(5);\nvar validate = __webpack_require__(38);\nvar NATIVE_WEAK_MAP = __webpack_require__(38);\nvar IS_IE11 = !global.ActiveXObject && 'ActiveXObject' in global;\nvar WEAK_MAP = 'WeakMap';\nvar getWeak = meta.getWeak;\nvar isExtensible = Object.isExtensible;\nvar uncaughtFrozenStore = weak.ufstore;\nvar InternalMap;\n\nvar wrapper = function (get) {\n  return function WeakMap() {\n    return get(this, arguments.length > 0 ? arguments[0] : undefined);\n  };\n};\n\nvar methods = {\n  // 23.3.3.3 WeakMap.prototype.get(key)\n  get: function get(key) {\n    if (isObject(key)) {\n      var data = getWeak(key);\n      if (data === true) return uncaughtFrozenStore(validate(this, WEAK_MAP)).get(key);\n      return data ? data[this._i] : undefined;\n    }\n  },\n  // 23.3.3.5 WeakMap.prototype.set(key, value)\n  set: function set(key, value) {\n    return weak.def(validate(this, WEAK_MAP), key, value);\n  }\n};\n\n// 23.3 WeakMap Objects\nvar $WeakMap = module.exports = __webpack_require__(59)(WEAK_MAP, wrapper, methods, weak, true, true);\n\n// IE11 WeakMap frozen keys fix\nif (NATIVE_WEAK_MAP && IS_IE11) {\n  InternalMap = weak.getConstructor(wrapper, WEAK_MAP);\n  assign(InternalMap.prototype, methods);\n  meta.NEED = true;\n  each(['delete', 'has', 'get', 'set'], function (key) {\n    var proto = $WeakMap.prototype;\n    var method = proto[key];\n    redefine(proto, key, function (a, b) {\n      // store frozen objects on internal weakmap shim\n      if (isObject(a) && !isExtensible(a)) {\n        if (!this._f) this._f = new InternalMap();\n        var result = this._f[key](a, b);\n        return key == 'set' ? this : result;\n      // store all the rest on native weakmap\n      } return method.call(this, a, b);\n    });\n  });\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMjQzLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9lczYud2Vhay1tYXAuanM/MTBhZCJdLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XG52YXIgZ2xvYmFsID0gcmVxdWlyZSgnLi9fZ2xvYmFsJyk7XG52YXIgZWFjaCA9IHJlcXVpcmUoJy4vX2FycmF5LW1ldGhvZHMnKSgwKTtcbnZhciByZWRlZmluZSA9IHJlcXVpcmUoJy4vX3JlZGVmaW5lJyk7XG52YXIgbWV0YSA9IHJlcXVpcmUoJy4vX21ldGEnKTtcbnZhciBhc3NpZ24gPSByZXF1aXJlKCcuL19vYmplY3QtYXNzaWduJyk7XG52YXIgd2VhayA9IHJlcXVpcmUoJy4vX2NvbGxlY3Rpb24td2VhaycpO1xudmFyIGlzT2JqZWN0ID0gcmVxdWlyZSgnLi9faXMtb2JqZWN0Jyk7XG52YXIgdmFsaWRhdGUgPSByZXF1aXJlKCcuL192YWxpZGF0ZS1jb2xsZWN0aW9uJyk7XG52YXIgTkFUSVZFX1dFQUtfTUFQID0gcmVxdWlyZSgnLi9fdmFsaWRhdGUtY29sbGVjdGlvbicpO1xudmFyIElTX0lFMTEgPSAhZ2xvYmFsLkFjdGl2ZVhPYmplY3QgJiYgJ0FjdGl2ZVhPYmplY3QnIGluIGdsb2JhbDtcbnZhciBXRUFLX01BUCA9ICdXZWFrTWFwJztcbnZhciBnZXRXZWFrID0gbWV0YS5nZXRXZWFrO1xudmFyIGlzRXh0ZW5zaWJsZSA9IE9iamVjdC5pc0V4dGVuc2libGU7XG52YXIgdW5jYXVnaHRGcm96ZW5TdG9yZSA9IHdlYWsudWZzdG9yZTtcbnZhciBJbnRlcm5hbE1hcDtcblxudmFyIHdyYXBwZXIgPSBmdW5jdGlvbiAoZ2V0KSB7XG4gIHJldHVybiBmdW5jdGlvbiBXZWFrTWFwKCkge1xuICAgIHJldHVybiBnZXQodGhpcywgYXJndW1lbnRzLmxlbmd0aCA+IDAgPyBhcmd1bWVudHNbMF0gOiB1bmRlZmluZWQpO1xuICB9O1xufTtcblxudmFyIG1ldGhvZHMgPSB7XG4gIC8vIDIzLjMuMy4zIFdlYWtNYXAucHJvdG90eXBlLmdldChrZXkpXG4gIGdldDogZnVuY3Rpb24gZ2V0KGtleSkge1xuICAgIGlmIChpc09iamVjdChrZXkpKSB7XG4gICAgICB2YXIgZGF0YSA9IGdldFdlYWsoa2V5KTtcbiAgICAgIGlmIChkYXRhID09PSB0cnVlKSByZXR1cm4gdW5jYXVnaHRGcm96ZW5TdG9yZSh2YWxpZGF0ZSh0aGlzLCBXRUFLX01BUCkpLmdldChrZXkpO1xuICAgICAgcmV0dXJuIGRhdGEgPyBkYXRhW3RoaXMuX2ldIDogdW5kZWZpbmVkO1xuICAgIH1cbiAgfSxcbiAgLy8gMjMuMy4zLjUgV2Vha01hcC5wcm90b3R5cGUuc2V0KGtleSwgdmFsdWUpXG4gIHNldDogZnVuY3Rpb24gc2V0KGtleSwgdmFsdWUpIHtcbiAgICByZXR1cm4gd2Vhay5kZWYodmFsaWRhdGUodGhpcywgV0VBS19NQVApLCBrZXksIHZhbHVlKTtcbiAgfVxufTtcblxuLy8gMjMuMyBXZWFrTWFwIE9iamVjdHNcbnZhciAkV2Vha01hcCA9IG1vZHVsZS5leHBvcnRzID0gcmVxdWlyZSgnLi9fY29sbGVjdGlvbicpKFdFQUtfTUFQLCB3cmFwcGVyLCBtZXRob2RzLCB3ZWFrLCB0cnVlLCB0cnVlKTtcblxuLy8gSUUxMSBXZWFrTWFwIGZyb3plbiBrZXlzIGZpeFxuaWYgKE5BVElWRV9XRUFLX01BUCAmJiBJU19JRTExKSB7XG4gIEludGVybmFsTWFwID0gd2Vhay5nZXRDb25zdHJ1Y3Rvcih3cmFwcGVyLCBXRUFLX01BUCk7XG4gIGFzc2lnbihJbnRlcm5hbE1hcC5wcm90b3R5cGUsIG1ldGhvZHMpO1xuICBtZXRhLk5FRUQgPSB0cnVlO1xuICBlYWNoKFsnZGVsZXRlJywgJ2hhcycsICdnZXQnLCAnc2V0J10sIGZ1bmN0aW9uIChrZXkpIHtcbiAgICB2YXIgcHJvdG8gPSAkV2Vha01hcC5wcm90b3R5cGU7XG4gICAgdmFyIG1ldGhvZCA9IHByb3RvW2tleV07XG4gICAgcmVkZWZpbmUocHJvdG8sIGtleSwgZnVuY3Rpb24gKGEsIGIpIHtcbiAgICAgIC8vIHN0b3JlIGZyb3plbiBvYmplY3RzIG9uIGludGVybmFsIHdlYWttYXAgc2hpbVxuICAgICAgaWYgKGlzT2JqZWN0KGEpICYmICFpc0V4dGVuc2libGUoYSkpIHtcbiAgICAgICAgaWYgKCF0aGlzLl9mKSB0aGlzLl9mID0gbmV3IEludGVybmFsTWFwKCk7XG4gICAgICAgIHZhciByZXN1bHQgPSB0aGlzLl9mW2tleV0oYSwgYik7XG4gICAgICAgIHJldHVybiBrZXkgPT0gJ3NldCcgPyB0aGlzIDogcmVzdWx0O1xuICAgICAgLy8gc3RvcmUgYWxsIHRoZSByZXN0IG9uIG5hdGl2ZSB3ZWFrbWFwXG4gICAgICB9IHJldHVybiBtZXRob2QuY2FsbCh0aGlzLCBhLCBiKTtcbiAgICB9KTtcbiAgfSk7XG59XG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///243\n")},function(module,exports,__webpack_require__){"use strict";eval("\nvar weak = __webpack_require__(117);\nvar validate = __webpack_require__(38);\nvar WEAK_SET = 'WeakSet';\n\n// 23.4 WeakSet Objects\n__webpack_require__(59)(WEAK_SET, function (get) {\n  return function WeakSet() { return get(this, arguments.length > 0 ? arguments[0] : undefined); };\n}, {\n  // 23.4.3.1 WeakSet.prototype.add(value)\n  add: function add(value) {\n    return weak.def(validate(this, WEAK_SET), value, true);\n  }\n}, weak, false, true);\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMjQ0LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9lczYud2Vhay1zZXQuanM/YzAyYiJdLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XG52YXIgd2VhayA9IHJlcXVpcmUoJy4vX2NvbGxlY3Rpb24td2VhaycpO1xudmFyIHZhbGlkYXRlID0gcmVxdWlyZSgnLi9fdmFsaWRhdGUtY29sbGVjdGlvbicpO1xudmFyIFdFQUtfU0VUID0gJ1dlYWtTZXQnO1xuXG4vLyAyMy40IFdlYWtTZXQgT2JqZWN0c1xucmVxdWlyZSgnLi9fY29sbGVjdGlvbicpKFdFQUtfU0VULCBmdW5jdGlvbiAoZ2V0KSB7XG4gIHJldHVybiBmdW5jdGlvbiBXZWFrU2V0KCkgeyByZXR1cm4gZ2V0KHRoaXMsIGFyZ3VtZW50cy5sZW5ndGggPiAwID8gYXJndW1lbnRzWzBdIDogdW5kZWZpbmVkKTsgfTtcbn0sIHtcbiAgLy8gMjMuNC4zLjEgV2Vha1NldC5wcm90b3R5cGUuYWRkKHZhbHVlKVxuICBhZGQ6IGZ1bmN0aW9uIGFkZCh2YWx1ZSkge1xuICAgIHJldHVybiB3ZWFrLmRlZih2YWxpZGF0ZSh0aGlzLCBXRUFLX1NFVCksIHZhbHVlLCB0cnVlKTtcbiAgfVxufSwgd2VhaywgZmFsc2UsIHRydWUpO1xuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///244\n")},function(module,exports,__webpack_require__){"use strict";eval("\nvar $export = __webpack_require__(1);\nvar $typed = __webpack_require__(60);\nvar buffer = __webpack_require__(85);\nvar anObject = __webpack_require__(4);\nvar toAbsoluteIndex = __webpack_require__(33);\nvar toLength = __webpack_require__(7);\nvar isObject = __webpack_require__(5);\nvar ArrayBuffer = __webpack_require__(2).ArrayBuffer;\nvar speciesConstructor = __webpack_require__(48);\nvar $ArrayBuffer = buffer.ArrayBuffer;\nvar $DataView = buffer.DataView;\nvar $isView = $typed.ABV && ArrayBuffer.isView;\nvar $slice = $ArrayBuffer.prototype.slice;\nvar VIEW = $typed.VIEW;\nvar ARRAY_BUFFER = 'ArrayBuffer';\n\n$export($export.G + $export.W + $export.F * (ArrayBuffer !== $ArrayBuffer), { ArrayBuffer: $ArrayBuffer });\n\n$export($export.S + $export.F * !$typed.CONSTR, ARRAY_BUFFER, {\n  // 24.1.3.1 ArrayBuffer.isView(arg)\n  isView: function isView(it) {\n    return $isView && $isView(it) || isObject(it) && VIEW in it;\n  }\n});\n\n$export($export.P + $export.U + $export.F * __webpack_require__(3)(function () {\n  return !new $ArrayBuffer(2).slice(1, undefined).byteLength;\n}), ARRAY_BUFFER, {\n  // 24.1.4.3 ArrayBuffer.prototype.slice(start, end)\n  slice: function slice(start, end) {\n    if ($slice !== undefined && end === undefined) return $slice.call(anObject(this), start); // FF fix\n    var len = anObject(this).byteLength;\n    var first = toAbsoluteIndex(start, len);\n    var fin = toAbsoluteIndex(end === undefined ? len : end, len);\n    var result = new (speciesConstructor(this, $ArrayBuffer))(toLength(fin - first));\n    var viewS = new $DataView(this);\n    var viewT = new $DataView(result);\n    var index = 0;\n    while (first < fin) {\n      viewT.setUint8(index++, viewS.getUint8(first++));\n    } return result;\n  }\n});\n\n__webpack_require__(42)(ARRAY_BUFFER);\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMjQ1LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9lczYudHlwZWQuYXJyYXktYnVmZmVyLmpzP2M2NmYiXSwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xudmFyICRleHBvcnQgPSByZXF1aXJlKCcuL19leHBvcnQnKTtcbnZhciAkdHlwZWQgPSByZXF1aXJlKCcuL190eXBlZCcpO1xudmFyIGJ1ZmZlciA9IHJlcXVpcmUoJy4vX3R5cGVkLWJ1ZmZlcicpO1xudmFyIGFuT2JqZWN0ID0gcmVxdWlyZSgnLi9fYW4tb2JqZWN0Jyk7XG52YXIgdG9BYnNvbHV0ZUluZGV4ID0gcmVxdWlyZSgnLi9fdG8tYWJzb2x1dGUtaW5kZXgnKTtcbnZhciB0b0xlbmd0aCA9IHJlcXVpcmUoJy4vX3RvLWxlbmd0aCcpO1xudmFyIGlzT2JqZWN0ID0gcmVxdWlyZSgnLi9faXMtb2JqZWN0Jyk7XG52YXIgQXJyYXlCdWZmZXIgPSByZXF1aXJlKCcuL19nbG9iYWwnKS5BcnJheUJ1ZmZlcjtcbnZhciBzcGVjaWVzQ29uc3RydWN0b3IgPSByZXF1aXJlKCcuL19zcGVjaWVzLWNvbnN0cnVjdG9yJyk7XG52YXIgJEFycmF5QnVmZmVyID0gYnVmZmVyLkFycmF5QnVmZmVyO1xudmFyICREYXRhVmlldyA9IGJ1ZmZlci5EYXRhVmlldztcbnZhciAkaXNWaWV3ID0gJHR5cGVkLkFCViAmJiBBcnJheUJ1ZmZlci5pc1ZpZXc7XG52YXIgJHNsaWNlID0gJEFycmF5QnVmZmVyLnByb3RvdHlwZS5zbGljZTtcbnZhciBWSUVXID0gJHR5cGVkLlZJRVc7XG52YXIgQVJSQVlfQlVGRkVSID0gJ0FycmF5QnVmZmVyJztcblxuJGV4cG9ydCgkZXhwb3J0LkcgKyAkZXhwb3J0LlcgKyAkZXhwb3J0LkYgKiAoQXJyYXlCdWZmZXIgIT09ICRBcnJheUJ1ZmZlciksIHsgQXJyYXlCdWZmZXI6ICRBcnJheUJ1ZmZlciB9KTtcblxuJGV4cG9ydCgkZXhwb3J0LlMgKyAkZXhwb3J0LkYgKiAhJHR5cGVkLkNPTlNUUiwgQVJSQVlfQlVGRkVSLCB7XG4gIC8vIDI0LjEuMy4xIEFycmF5QnVmZmVyLmlzVmlldyhhcmcpXG4gIGlzVmlldzogZnVuY3Rpb24gaXNWaWV3KGl0KSB7XG4gICAgcmV0dXJuICRpc1ZpZXcgJiYgJGlzVmlldyhpdCkgfHwgaXNPYmplY3QoaXQpICYmIFZJRVcgaW4gaXQ7XG4gIH1cbn0pO1xuXG4kZXhwb3J0KCRleHBvcnQuUCArICRleHBvcnQuVSArICRleHBvcnQuRiAqIHJlcXVpcmUoJy4vX2ZhaWxzJykoZnVuY3Rpb24gKCkge1xuICByZXR1cm4gIW5ldyAkQXJyYXlCdWZmZXIoMikuc2xpY2UoMSwgdW5kZWZpbmVkKS5ieXRlTGVuZ3RoO1xufSksIEFSUkFZX0JVRkZFUiwge1xuICAvLyAyNC4xLjQuMyBBcnJheUJ1ZmZlci5wcm90b3R5cGUuc2xpY2Uoc3RhcnQsIGVuZClcbiAgc2xpY2U6IGZ1bmN0aW9uIHNsaWNlKHN0YXJ0LCBlbmQpIHtcbiAgICBpZiAoJHNsaWNlICE9PSB1bmRlZmluZWQgJiYgZW5kID09PSB1bmRlZmluZWQpIHJldHVybiAkc2xpY2UuY2FsbChhbk9iamVjdCh0aGlzKSwgc3RhcnQpOyAvLyBGRiBmaXhcbiAgICB2YXIgbGVuID0gYW5PYmplY3QodGhpcykuYnl0ZUxlbmd0aDtcbiAgICB2YXIgZmlyc3QgPSB0b0Fic29sdXRlSW5kZXgoc3RhcnQsIGxlbik7XG4gICAgdmFyIGZpbiA9IHRvQWJzb2x1dGVJbmRleChlbmQgPT09IHVuZGVmaW5lZCA/IGxlbiA6IGVuZCwgbGVuKTtcbiAgICB2YXIgcmVzdWx0ID0gbmV3IChzcGVjaWVzQ29uc3RydWN0b3IodGhpcywgJEFycmF5QnVmZmVyKSkodG9MZW5ndGgoZmluIC0gZmlyc3QpKTtcbiAgICB2YXIgdmlld1MgPSBuZXcgJERhdGFWaWV3KHRoaXMpO1xuICAgIHZhciB2aWV3VCA9IG5ldyAkRGF0YVZpZXcocmVzdWx0KTtcbiAgICB2YXIgaW5kZXggPSAwO1xuICAgIHdoaWxlIChmaXJzdCA8IGZpbikge1xuICAgICAgdmlld1Quc2V0VWludDgoaW5kZXgrKywgdmlld1MuZ2V0VWludDgoZmlyc3QrKykpO1xuICAgIH0gcmV0dXJuIHJlc3VsdDtcbiAgfVxufSk7XG5cbnJlcXVpcmUoJy4vX3NldC1zcGVjaWVzJykoQVJSQVlfQlVGRkVSKTtcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Iiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///245\n")},function(module,exports,__webpack_require__){eval("var $export = __webpack_require__(1);\n$export($export.G + $export.W + $export.F * !__webpack_require__(60).ABV, {\n  DataView: __webpack_require__(85).DataView\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMjQ2LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9lczYudHlwZWQuZGF0YS12aWV3LmpzPzI2MmYiXSwic291cmNlc0NvbnRlbnQiOlsidmFyICRleHBvcnQgPSByZXF1aXJlKCcuL19leHBvcnQnKTtcbiRleHBvcnQoJGV4cG9ydC5HICsgJGV4cG9ydC5XICsgJGV4cG9ydC5GICogIXJlcXVpcmUoJy4vX3R5cGVkJykuQUJWLCB7XG4gIERhdGFWaWV3OiByZXF1aXJlKCcuL190eXBlZC1idWZmZXInKS5EYXRhVmlld1xufSk7XG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///246\n")},function(module,exports,__webpack_require__){eval("__webpack_require__(26)('Int8', 1, function (init) {\n  return function Int8Array(data, byteOffset, length) {\n    return init(this, data, byteOffset, length);\n  };\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMjQ3LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9lczYudHlwZWQuaW50OC1hcnJheS5qcz9iMDVjIl0sInNvdXJjZXNDb250ZW50IjpbInJlcXVpcmUoJy4vX3R5cGVkLWFycmF5JykoJ0ludDgnLCAxLCBmdW5jdGlvbiAoaW5pdCkge1xuICByZXR1cm4gZnVuY3Rpb24gSW50OEFycmF5KGRhdGEsIGJ5dGVPZmZzZXQsIGxlbmd0aCkge1xuICAgIHJldHVybiBpbml0KHRoaXMsIGRhdGEsIGJ5dGVPZmZzZXQsIGxlbmd0aCk7XG4gIH07XG59KTtcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///247\n")},function(module,exports,__webpack_require__){eval("__webpack_require__(26)('Uint8', 1, function (init) {\n  return function Uint8Array(data, byteOffset, length) {\n    return init(this, data, byteOffset, length);\n  };\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMjQ4LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9lczYudHlwZWQudWludDgtYXJyYXkuanM/MzRlZiJdLCJzb3VyY2VzQ29udGVudCI6WyJyZXF1aXJlKCcuL190eXBlZC1hcnJheScpKCdVaW50OCcsIDEsIGZ1bmN0aW9uIChpbml0KSB7XG4gIHJldHVybiBmdW5jdGlvbiBVaW50OEFycmF5KGRhdGEsIGJ5dGVPZmZzZXQsIGxlbmd0aCkge1xuICAgIHJldHVybiBpbml0KHRoaXMsIGRhdGEsIGJ5dGVPZmZzZXQsIGxlbmd0aCk7XG4gIH07XG59KTtcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///248\n")},function(module,exports,__webpack_require__){eval("__webpack_require__(26)('Uint8', 1, function (init) {\n  return function Uint8ClampedArray(data, byteOffset, length) {\n    return init(this, data, byteOffset, length);\n  };\n}, true);\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMjQ5LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9lczYudHlwZWQudWludDgtY2xhbXBlZC1hcnJheS5qcz82YWEyIl0sInNvdXJjZXNDb250ZW50IjpbInJlcXVpcmUoJy4vX3R5cGVkLWFycmF5JykoJ1VpbnQ4JywgMSwgZnVuY3Rpb24gKGluaXQpIHtcbiAgcmV0dXJuIGZ1bmN0aW9uIFVpbnQ4Q2xhbXBlZEFycmF5KGRhdGEsIGJ5dGVPZmZzZXQsIGxlbmd0aCkge1xuICAgIHJldHVybiBpbml0KHRoaXMsIGRhdGEsIGJ5dGVPZmZzZXQsIGxlbmd0aCk7XG4gIH07XG59LCB0cnVlKTtcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///249\n")},function(module,exports,__webpack_require__){eval("__webpack_require__(26)('Int16', 2, function (init) {\n  return function Int16Array(data, byteOffset, length) {\n    return init(this, data, byteOffset, length);\n  };\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMjUwLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9lczYudHlwZWQuaW50MTYtYXJyYXkuanM/MTVhYyJdLCJzb3VyY2VzQ29udGVudCI6WyJyZXF1aXJlKCcuL190eXBlZC1hcnJheScpKCdJbnQxNicsIDIsIGZ1bmN0aW9uIChpbml0KSB7XG4gIHJldHVybiBmdW5jdGlvbiBJbnQxNkFycmF5KGRhdGEsIGJ5dGVPZmZzZXQsIGxlbmd0aCkge1xuICAgIHJldHVybiBpbml0KHRoaXMsIGRhdGEsIGJ5dGVPZmZzZXQsIGxlbmd0aCk7XG4gIH07XG59KTtcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///250\n")},function(module,exports,__webpack_require__){eval("__webpack_require__(26)('Uint16', 2, function (init) {\n  return function Uint16Array(data, byteOffset, length) {\n    return init(this, data, byteOffset, length);\n  };\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMjUxLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9lczYudHlwZWQudWludDE2LWFycmF5LmpzP2FmNTYiXSwic291cmNlc0NvbnRlbnQiOlsicmVxdWlyZSgnLi9fdHlwZWQtYXJyYXknKSgnVWludDE2JywgMiwgZnVuY3Rpb24gKGluaXQpIHtcbiAgcmV0dXJuIGZ1bmN0aW9uIFVpbnQxNkFycmF5KGRhdGEsIGJ5dGVPZmZzZXQsIGxlbmd0aCkge1xuICAgIHJldHVybiBpbml0KHRoaXMsIGRhdGEsIGJ5dGVPZmZzZXQsIGxlbmd0aCk7XG4gIH07XG59KTtcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///251\n")},function(module,exports,__webpack_require__){eval("__webpack_require__(26)('Int32', 4, function (init) {\n  return function Int32Array(data, byteOffset, length) {\n    return init(this, data, byteOffset, length);\n  };\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMjUyLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9lczYudHlwZWQuaW50MzItYXJyYXkuanM/YjZlNCJdLCJzb3VyY2VzQ29udGVudCI6WyJyZXF1aXJlKCcuL190eXBlZC1hcnJheScpKCdJbnQzMicsIDQsIGZ1bmN0aW9uIChpbml0KSB7XG4gIHJldHVybiBmdW5jdGlvbiBJbnQzMkFycmF5KGRhdGEsIGJ5dGVPZmZzZXQsIGxlbmd0aCkge1xuICAgIHJldHVybiBpbml0KHRoaXMsIGRhdGEsIGJ5dGVPZmZzZXQsIGxlbmd0aCk7XG4gIH07XG59KTtcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///252\n")},function(module,exports,__webpack_require__){eval("__webpack_require__(26)('Uint32', 4, function (init) {\n  return function Uint32Array(data, byteOffset, length) {\n    return init(this, data, byteOffset, length);\n  };\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMjUzLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9lczYudHlwZWQudWludDMyLWFycmF5LmpzPzljMjkiXSwic291cmNlc0NvbnRlbnQiOlsicmVxdWlyZSgnLi9fdHlwZWQtYXJyYXknKSgnVWludDMyJywgNCwgZnVuY3Rpb24gKGluaXQpIHtcbiAgcmV0dXJuIGZ1bmN0aW9uIFVpbnQzMkFycmF5KGRhdGEsIGJ5dGVPZmZzZXQsIGxlbmd0aCkge1xuICAgIHJldHVybiBpbml0KHRoaXMsIGRhdGEsIGJ5dGVPZmZzZXQsIGxlbmd0aCk7XG4gIH07XG59KTtcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///253\n")},function(module,exports,__webpack_require__){eval("__webpack_require__(26)('Float32', 4, function (init) {\n  return function Float32Array(data, byteOffset, length) {\n    return init(this, data, byteOffset, length);\n  };\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMjU0LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9lczYudHlwZWQuZmxvYXQzMi1hcnJheS5qcz82M2Q5Il0sInNvdXJjZXNDb250ZW50IjpbInJlcXVpcmUoJy4vX3R5cGVkLWFycmF5JykoJ0Zsb2F0MzInLCA0LCBmdW5jdGlvbiAoaW5pdCkge1xuICByZXR1cm4gZnVuY3Rpb24gRmxvYXQzMkFycmF5KGRhdGEsIGJ5dGVPZmZzZXQsIGxlbmd0aCkge1xuICAgIHJldHVybiBpbml0KHRoaXMsIGRhdGEsIGJ5dGVPZmZzZXQsIGxlbmd0aCk7XG4gIH07XG59KTtcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///254\n")},function(module,exports,__webpack_require__){eval("__webpack_require__(26)('Float64', 8, function (init) {\n  return function Float64Array(data, byteOffset, length) {\n    return init(this, data, byteOffset, length);\n  };\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMjU1LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9lczYudHlwZWQuZmxvYXQ2NC1hcnJheS5qcz80ZGRhIl0sInNvdXJjZXNDb250ZW50IjpbInJlcXVpcmUoJy4vX3R5cGVkLWFycmF5JykoJ0Zsb2F0NjQnLCA4LCBmdW5jdGlvbiAoaW5pdCkge1xuICByZXR1cm4gZnVuY3Rpb24gRmxvYXQ2NEFycmF5KGRhdGEsIGJ5dGVPZmZzZXQsIGxlbmd0aCkge1xuICAgIHJldHVybiBpbml0KHRoaXMsIGRhdGEsIGJ5dGVPZmZzZXQsIGxlbmd0aCk7XG4gIH07XG59KTtcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///255\n")},function(module,exports,__webpack_require__){eval("// 26.1.1 Reflect.apply(target, thisArgument, argumentsList)\nvar $export = __webpack_require__(1);\nvar aFunction = __webpack_require__(19);\nvar anObject = __webpack_require__(4);\nvar rApply = (__webpack_require__(2).Reflect || {}).apply;\nvar fApply = Function.apply;\n// MS Edge argumentsList argument is optional\n$export($export.S + $export.F * !__webpack_require__(3)(function () {\n  rApply(function () { /* empty */ });\n}), 'Reflect', {\n  apply: function apply(target, thisArgument, argumentsList) {\n    var T = aFunction(target);\n    var L = anObject(argumentsList);\n    return rApply ? rApply(T, thisArgument, L) : fApply.call(T, thisArgument, L);\n  }\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMjU2LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9lczYucmVmbGVjdC5hcHBseS5qcz9kZjFiIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIDI2LjEuMSBSZWZsZWN0LmFwcGx5KHRhcmdldCwgdGhpc0FyZ3VtZW50LCBhcmd1bWVudHNMaXN0KVxudmFyICRleHBvcnQgPSByZXF1aXJlKCcuL19leHBvcnQnKTtcbnZhciBhRnVuY3Rpb24gPSByZXF1aXJlKCcuL19hLWZ1bmN0aW9uJyk7XG52YXIgYW5PYmplY3QgPSByZXF1aXJlKCcuL19hbi1vYmplY3QnKTtcbnZhciByQXBwbHkgPSAocmVxdWlyZSgnLi9fZ2xvYmFsJykuUmVmbGVjdCB8fCB7fSkuYXBwbHk7XG52YXIgZkFwcGx5ID0gRnVuY3Rpb24uYXBwbHk7XG4vLyBNUyBFZGdlIGFyZ3VtZW50c0xpc3QgYXJndW1lbnQgaXMgb3B0aW9uYWxcbiRleHBvcnQoJGV4cG9ydC5TICsgJGV4cG9ydC5GICogIXJlcXVpcmUoJy4vX2ZhaWxzJykoZnVuY3Rpb24gKCkge1xuICByQXBwbHkoZnVuY3Rpb24gKCkgeyAvKiBlbXB0eSAqLyB9KTtcbn0pLCAnUmVmbGVjdCcsIHtcbiAgYXBwbHk6IGZ1bmN0aW9uIGFwcGx5KHRhcmdldCwgdGhpc0FyZ3VtZW50LCBhcmd1bWVudHNMaXN0KSB7XG4gICAgdmFyIFQgPSBhRnVuY3Rpb24odGFyZ2V0KTtcbiAgICB2YXIgTCA9IGFuT2JqZWN0KGFyZ3VtZW50c0xpc3QpO1xuICAgIHJldHVybiByQXBwbHkgPyByQXBwbHkoVCwgdGhpc0FyZ3VtZW50LCBMKSA6IGZBcHBseS5jYWxsKFQsIHRoaXNBcmd1bWVudCwgTCk7XG4gIH1cbn0pO1xuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///256\n")},function(module,exports,__webpack_require__){eval("// 26.1.2 Reflect.construct(target, argumentsList [, newTarget])\nvar $export = __webpack_require__(1);\nvar create = __webpack_require__(34);\nvar aFunction = __webpack_require__(19);\nvar anObject = __webpack_require__(4);\nvar isObject = __webpack_require__(5);\nvar fails = __webpack_require__(3);\nvar bind = __webpack_require__(98);\nvar rConstruct = (__webpack_require__(2).Reflect || {}).construct;\n\n// MS Edge supports only 2 arguments and argumentsList argument is optional\n// FF Nightly sets third argument as `new.target`, but does not create `this` from it\nvar NEW_TARGET_BUG = fails(function () {\n  function F() { /* empty */ }\n  return !(rConstruct(function () { /* empty */ }, [], F) instanceof F);\n});\nvar ARGS_BUG = !fails(function () {\n  rConstruct(function () { /* empty */ });\n});\n\n$export($export.S + $export.F * (NEW_TARGET_BUG || ARGS_BUG), 'Reflect', {\n  construct: function construct(Target, args /* , newTarget */) {\n    aFunction(Target);\n    anObject(args);\n    var newTarget = arguments.length < 3 ? Target : aFunction(arguments[2]);\n    if (ARGS_BUG && !NEW_TARGET_BUG) return rConstruct(Target, args, newTarget);\n    if (Target == newTarget) {\n      // w/o altered newTarget, optimization for 0-4 arguments\n      switch (args.length) {\n        case 0: return new Target();\n        case 1: return new Target(args[0]);\n        case 2: return new Target(args[0], args[1]);\n        case 3: return new Target(args[0], args[1], args[2]);\n        case 4: return new Target(args[0], args[1], args[2], args[3]);\n      }\n      // w/o altered newTarget, lot of arguments case\n      var $args = [null];\n      $args.push.apply($args, args);\n      return new (bind.apply(Target, $args))();\n    }\n    // with altered newTarget, not support built-in constructors\n    var proto = newTarget.prototype;\n    var instance = create(isObject(proto) ? proto : Object.prototype);\n    var result = Function.apply.call(Target, instance, args);\n    return isObject(result) ? result : instance;\n  }\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMjU3LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9lczYucmVmbGVjdC5jb25zdHJ1Y3QuanM/MjM5NyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyAyNi4xLjIgUmVmbGVjdC5jb25zdHJ1Y3QodGFyZ2V0LCBhcmd1bWVudHNMaXN0IFssIG5ld1RhcmdldF0pXG52YXIgJGV4cG9ydCA9IHJlcXVpcmUoJy4vX2V4cG9ydCcpO1xudmFyIGNyZWF0ZSA9IHJlcXVpcmUoJy4vX29iamVjdC1jcmVhdGUnKTtcbnZhciBhRnVuY3Rpb24gPSByZXF1aXJlKCcuL19hLWZ1bmN0aW9uJyk7XG52YXIgYW5PYmplY3QgPSByZXF1aXJlKCcuL19hbi1vYmplY3QnKTtcbnZhciBpc09iamVjdCA9IHJlcXVpcmUoJy4vX2lzLW9iamVjdCcpO1xudmFyIGZhaWxzID0gcmVxdWlyZSgnLi9fZmFpbHMnKTtcbnZhciBiaW5kID0gcmVxdWlyZSgnLi9fYmluZCcpO1xudmFyIHJDb25zdHJ1Y3QgPSAocmVxdWlyZSgnLi9fZ2xvYmFsJykuUmVmbGVjdCB8fCB7fSkuY29uc3RydWN0O1xuXG4vLyBNUyBFZGdlIHN1cHBvcnRzIG9ubHkgMiBhcmd1bWVudHMgYW5kIGFyZ3VtZW50c0xpc3QgYXJndW1lbnQgaXMgb3B0aW9uYWxcbi8vIEZGIE5pZ2h0bHkgc2V0cyB0aGlyZCBhcmd1bWVudCBhcyBgbmV3LnRhcmdldGAsIGJ1dCBkb2VzIG5vdCBjcmVhdGUgYHRoaXNgIGZyb20gaXRcbnZhciBORVdfVEFSR0VUX0JVRyA9IGZhaWxzKGZ1bmN0aW9uICgpIHtcbiAgZnVuY3Rpb24gRigpIHsgLyogZW1wdHkgKi8gfVxuICByZXR1cm4gIShyQ29uc3RydWN0KGZ1bmN0aW9uICgpIHsgLyogZW1wdHkgKi8gfSwgW10sIEYpIGluc3RhbmNlb2YgRik7XG59KTtcbnZhciBBUkdTX0JVRyA9ICFmYWlscyhmdW5jdGlvbiAoKSB7XG4gIHJDb25zdHJ1Y3QoZnVuY3Rpb24gKCkgeyAvKiBlbXB0eSAqLyB9KTtcbn0pO1xuXG4kZXhwb3J0KCRleHBvcnQuUyArICRleHBvcnQuRiAqIChORVdfVEFSR0VUX0JVRyB8fCBBUkdTX0JVRyksICdSZWZsZWN0Jywge1xuICBjb25zdHJ1Y3Q6IGZ1bmN0aW9uIGNvbnN0cnVjdChUYXJnZXQsIGFyZ3MgLyogLCBuZXdUYXJnZXQgKi8pIHtcbiAgICBhRnVuY3Rpb24oVGFyZ2V0KTtcbiAgICBhbk9iamVjdChhcmdzKTtcbiAgICB2YXIgbmV3VGFyZ2V0ID0gYXJndW1lbnRzLmxlbmd0aCA8IDMgPyBUYXJnZXQgOiBhRnVuY3Rpb24oYXJndW1lbnRzWzJdKTtcbiAgICBpZiAoQVJHU19CVUcgJiYgIU5FV19UQVJHRVRfQlVHKSByZXR1cm4gckNvbnN0cnVjdChUYXJnZXQsIGFyZ3MsIG5ld1RhcmdldCk7XG4gICAgaWYgKFRhcmdldCA9PSBuZXdUYXJnZXQpIHtcbiAgICAgIC8vIHcvbyBhbHRlcmVkIG5ld1RhcmdldCwgb3B0aW1pemF0aW9uIGZvciAwLTQgYXJndW1lbnRzXG4gICAgICBzd2l0Y2ggKGFyZ3MubGVuZ3RoKSB7XG4gICAgICAgIGNhc2UgMDogcmV0dXJuIG5ldyBUYXJnZXQoKTtcbiAgICAgICAgY2FzZSAxOiByZXR1cm4gbmV3IFRhcmdldChhcmdzWzBdKTtcbiAgICAgICAgY2FzZSAyOiByZXR1cm4gbmV3IFRhcmdldChhcmdzWzBdLCBhcmdzWzFdKTtcbiAgICAgICAgY2FzZSAzOiByZXR1cm4gbmV3IFRhcmdldChhcmdzWzBdLCBhcmdzWzFdLCBhcmdzWzJdKTtcbiAgICAgICAgY2FzZSA0OiByZXR1cm4gbmV3IFRhcmdldChhcmdzWzBdLCBhcmdzWzFdLCBhcmdzWzJdLCBhcmdzWzNdKTtcbiAgICAgIH1cbiAgICAgIC8vIHcvbyBhbHRlcmVkIG5ld1RhcmdldCwgbG90IG9mIGFyZ3VtZW50cyBjYXNlXG4gICAgICB2YXIgJGFyZ3MgPSBbbnVsbF07XG4gICAgICAkYXJncy5wdXNoLmFwcGx5KCRhcmdzLCBhcmdzKTtcbiAgICAgIHJldHVybiBuZXcgKGJpbmQuYXBwbHkoVGFyZ2V0LCAkYXJncykpKCk7XG4gICAgfVxuICAgIC8vIHdpdGggYWx0ZXJlZCBuZXdUYXJnZXQsIG5vdCBzdXBwb3J0IGJ1aWx0LWluIGNvbnN0cnVjdG9yc1xuICAgIHZhciBwcm90byA9IG5ld1RhcmdldC5wcm90b3R5cGU7XG4gICAgdmFyIGluc3RhbmNlID0gY3JlYXRlKGlzT2JqZWN0KHByb3RvKSA/IHByb3RvIDogT2JqZWN0LnByb3RvdHlwZSk7XG4gICAgdmFyIHJlc3VsdCA9IEZ1bmN0aW9uLmFwcGx5LmNhbGwoVGFyZ2V0LCBpbnN0YW5jZSwgYXJncyk7XG4gICAgcmV0dXJuIGlzT2JqZWN0KHJlc3VsdCkgPyByZXN1bHQgOiBpbnN0YW5jZTtcbiAgfVxufSk7XG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Iiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///257\n")},function(module,exports,__webpack_require__){eval("// 26.1.3 Reflect.defineProperty(target, propertyKey, attributes)\nvar dP = __webpack_require__(10);\nvar $export = __webpack_require__(1);\nvar anObject = __webpack_require__(4);\nvar toPrimitive = __webpack_require__(27);\n\n// MS Edge has broken Reflect.defineProperty - throwing instead of returning false\n$export($export.S + $export.F * __webpack_require__(3)(function () {\n  // eslint-disable-next-line no-undef\n  Reflect.defineProperty(dP.f({}, 1, { value: 1 }), 1, { value: 2 });\n}), 'Reflect', {\n  defineProperty: function defineProperty(target, propertyKey, attributes) {\n    anObject(target);\n    propertyKey = toPrimitive(propertyKey, true);\n    anObject(attributes);\n    try {\n      dP.f(target, propertyKey, attributes);\n      return true;\n    } catch (e) {\n      return false;\n    }\n  }\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMjU4LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9lczYucmVmbGVjdC5kZWZpbmUtcHJvcGVydHkuanM/ODhjYSJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyAyNi4xLjMgUmVmbGVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIHByb3BlcnR5S2V5LCBhdHRyaWJ1dGVzKVxudmFyIGRQID0gcmVxdWlyZSgnLi9fb2JqZWN0LWRwJyk7XG52YXIgJGV4cG9ydCA9IHJlcXVpcmUoJy4vX2V4cG9ydCcpO1xudmFyIGFuT2JqZWN0ID0gcmVxdWlyZSgnLi9fYW4tb2JqZWN0Jyk7XG52YXIgdG9QcmltaXRpdmUgPSByZXF1aXJlKCcuL190by1wcmltaXRpdmUnKTtcblxuLy8gTVMgRWRnZSBoYXMgYnJva2VuIFJlZmxlY3QuZGVmaW5lUHJvcGVydHkgLSB0aHJvd2luZyBpbnN0ZWFkIG9mIHJldHVybmluZyBmYWxzZVxuJGV4cG9ydCgkZXhwb3J0LlMgKyAkZXhwb3J0LkYgKiByZXF1aXJlKCcuL19mYWlscycpKGZ1bmN0aW9uICgpIHtcbiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLXVuZGVmXG4gIFJlZmxlY3QuZGVmaW5lUHJvcGVydHkoZFAuZih7fSwgMSwgeyB2YWx1ZTogMSB9KSwgMSwgeyB2YWx1ZTogMiB9KTtcbn0pLCAnUmVmbGVjdCcsIHtcbiAgZGVmaW5lUHJvcGVydHk6IGZ1bmN0aW9uIGRlZmluZVByb3BlcnR5KHRhcmdldCwgcHJvcGVydHlLZXksIGF0dHJpYnV0ZXMpIHtcbiAgICBhbk9iamVjdCh0YXJnZXQpO1xuICAgIHByb3BlcnR5S2V5ID0gdG9QcmltaXRpdmUocHJvcGVydHlLZXksIHRydWUpO1xuICAgIGFuT2JqZWN0KGF0dHJpYnV0ZXMpO1xuICAgIHRyeSB7XG4gICAgICBkUC5mKHRhcmdldCwgcHJvcGVydHlLZXksIGF0dHJpYnV0ZXMpO1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgfVxufSk7XG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Iiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///258\n")},function(module,exports,__webpack_require__){eval("// 26.1.4 Reflect.deleteProperty(target, propertyKey)\nvar $export = __webpack_require__(1);\nvar gOPD = __webpack_require__(21).f;\nvar anObject = __webpack_require__(4);\n\n$export($export.S, 'Reflect', {\n  deleteProperty: function deleteProperty(target, propertyKey) {\n    var desc = gOPD(anObject(target), propertyKey);\n    return desc && !desc.configurable ? false : delete target[propertyKey];\n  }\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMjU5LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9lczYucmVmbGVjdC5kZWxldGUtcHJvcGVydHkuanM/YmExNiJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyAyNi4xLjQgUmVmbGVjdC5kZWxldGVQcm9wZXJ0eSh0YXJnZXQsIHByb3BlcnR5S2V5KVxudmFyICRleHBvcnQgPSByZXF1aXJlKCcuL19leHBvcnQnKTtcbnZhciBnT1BEID0gcmVxdWlyZSgnLi9fb2JqZWN0LWdvcGQnKS5mO1xudmFyIGFuT2JqZWN0ID0gcmVxdWlyZSgnLi9fYW4tb2JqZWN0Jyk7XG5cbiRleHBvcnQoJGV4cG9ydC5TLCAnUmVmbGVjdCcsIHtcbiAgZGVsZXRlUHJvcGVydHk6IGZ1bmN0aW9uIGRlbGV0ZVByb3BlcnR5KHRhcmdldCwgcHJvcGVydHlLZXkpIHtcbiAgICB2YXIgZGVzYyA9IGdPUEQoYW5PYmplY3QodGFyZ2V0KSwgcHJvcGVydHlLZXkpO1xuICAgIHJldHVybiBkZXNjICYmICFkZXNjLmNvbmZpZ3VyYWJsZSA/IGZhbHNlIDogZGVsZXRlIHRhcmdldFtwcm9wZXJ0eUtleV07XG4gIH1cbn0pO1xuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///259\n")},function(module,exports,__webpack_require__){"use strict";eval("\n// 26.1.5 Reflect.enumerate(target)\nvar $export = __webpack_require__(1);\nvar anObject = __webpack_require__(4);\nvar Enumerate = function (iterated) {\n  this._t = anObject(iterated); // target\n  this._i = 0;                  // next index\n  var keys = this._k = [];      // keys\n  var key;\n  for (key in iterated) keys.push(key);\n};\n__webpack_require__(105)(Enumerate, 'Object', function () {\n  var that = this;\n  var keys = that._k;\n  var key;\n  do {\n    if (that._i >= keys.length) return { value: undefined, done: true };\n  } while (!((key = keys[that._i++]) in that._t));\n  return { value: key, done: false };\n});\n\n$export($export.S, 'Reflect', {\n  enumerate: function enumerate(target) {\n    return new Enumerate(target);\n  }\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMjYwLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9lczYucmVmbGVjdC5lbnVtZXJhdGUuanM/N2ZmNiJdLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XG4vLyAyNi4xLjUgUmVmbGVjdC5lbnVtZXJhdGUodGFyZ2V0KVxudmFyICRleHBvcnQgPSByZXF1aXJlKCcuL19leHBvcnQnKTtcbnZhciBhbk9iamVjdCA9IHJlcXVpcmUoJy4vX2FuLW9iamVjdCcpO1xudmFyIEVudW1lcmF0ZSA9IGZ1bmN0aW9uIChpdGVyYXRlZCkge1xuICB0aGlzLl90ID0gYW5PYmplY3QoaXRlcmF0ZWQpOyAvLyB0YXJnZXRcbiAgdGhpcy5faSA9IDA7ICAgICAgICAgICAgICAgICAgLy8gbmV4dCBpbmRleFxuICB2YXIga2V5cyA9IHRoaXMuX2sgPSBbXTsgICAgICAvLyBrZXlzXG4gIHZhciBrZXk7XG4gIGZvciAoa2V5IGluIGl0ZXJhdGVkKSBrZXlzLnB1c2goa2V5KTtcbn07XG5yZXF1aXJlKCcuL19pdGVyLWNyZWF0ZScpKEVudW1lcmF0ZSwgJ09iamVjdCcsIGZ1bmN0aW9uICgpIHtcbiAgdmFyIHRoYXQgPSB0aGlzO1xuICB2YXIga2V5cyA9IHRoYXQuX2s7XG4gIHZhciBrZXk7XG4gIGRvIHtcbiAgICBpZiAodGhhdC5faSA+PSBrZXlzLmxlbmd0aCkgcmV0dXJuIHsgdmFsdWU6IHVuZGVmaW5lZCwgZG9uZTogdHJ1ZSB9O1xuICB9IHdoaWxlICghKChrZXkgPSBrZXlzW3RoYXQuX2krK10pIGluIHRoYXQuX3QpKTtcbiAgcmV0dXJuIHsgdmFsdWU6IGtleSwgZG9uZTogZmFsc2UgfTtcbn0pO1xuXG4kZXhwb3J0KCRleHBvcnQuUywgJ1JlZmxlY3QnLCB7XG4gIGVudW1lcmF0ZTogZnVuY3Rpb24gZW51bWVyYXRlKHRhcmdldCkge1xuICAgIHJldHVybiBuZXcgRW51bWVyYXRlKHRhcmdldCk7XG4gIH1cbn0pO1xuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///260\n")},function(module,exports,__webpack_require__){eval("// 26.1.6 Reflect.get(target, propertyKey [, receiver])\nvar gOPD = __webpack_require__(21);\nvar getPrototypeOf = __webpack_require__(36);\nvar has = __webpack_require__(14);\nvar $export = __webpack_require__(1);\nvar isObject = __webpack_require__(5);\nvar anObject = __webpack_require__(4);\n\nfunction get(target, propertyKey /* , receiver */) {\n  var receiver = arguments.length < 3 ? target : arguments[2];\n  var desc, proto;\n  if (anObject(target) === receiver) return target[propertyKey];\n  if (desc = gOPD.f(target, propertyKey)) return has(desc, 'value')\n    ? desc.value\n    : desc.get !== undefined\n      ? desc.get.call(receiver)\n      : undefined;\n  if (isObject(proto = getPrototypeOf(target))) return get(proto, propertyKey, receiver);\n}\n\n$export($export.S, 'Reflect', { get: get });\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMjYxLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9lczYucmVmbGVjdC5nZXQuanM/ZDE4NSJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyAyNi4xLjYgUmVmbGVjdC5nZXQodGFyZ2V0LCBwcm9wZXJ0eUtleSBbLCByZWNlaXZlcl0pXG52YXIgZ09QRCA9IHJlcXVpcmUoJy4vX29iamVjdC1nb3BkJyk7XG52YXIgZ2V0UHJvdG90eXBlT2YgPSByZXF1aXJlKCcuL19vYmplY3QtZ3BvJyk7XG52YXIgaGFzID0gcmVxdWlyZSgnLi9faGFzJyk7XG52YXIgJGV4cG9ydCA9IHJlcXVpcmUoJy4vX2V4cG9ydCcpO1xudmFyIGlzT2JqZWN0ID0gcmVxdWlyZSgnLi9faXMtb2JqZWN0Jyk7XG52YXIgYW5PYmplY3QgPSByZXF1aXJlKCcuL19hbi1vYmplY3QnKTtcblxuZnVuY3Rpb24gZ2V0KHRhcmdldCwgcHJvcGVydHlLZXkgLyogLCByZWNlaXZlciAqLykge1xuICB2YXIgcmVjZWl2ZXIgPSBhcmd1bWVudHMubGVuZ3RoIDwgMyA/IHRhcmdldCA6IGFyZ3VtZW50c1syXTtcbiAgdmFyIGRlc2MsIHByb3RvO1xuICBpZiAoYW5PYmplY3QodGFyZ2V0KSA9PT0gcmVjZWl2ZXIpIHJldHVybiB0YXJnZXRbcHJvcGVydHlLZXldO1xuICBpZiAoZGVzYyA9IGdPUEQuZih0YXJnZXQsIHByb3BlcnR5S2V5KSkgcmV0dXJuIGhhcyhkZXNjLCAndmFsdWUnKVxuICAgID8gZGVzYy52YWx1ZVxuICAgIDogZGVzYy5nZXQgIT09IHVuZGVmaW5lZFxuICAgICAgPyBkZXNjLmdldC5jYWxsKHJlY2VpdmVyKVxuICAgICAgOiB1bmRlZmluZWQ7XG4gIGlmIChpc09iamVjdChwcm90byA9IGdldFByb3RvdHlwZU9mKHRhcmdldCkpKSByZXR1cm4gZ2V0KHByb3RvLCBwcm9wZXJ0eUtleSwgcmVjZWl2ZXIpO1xufVxuXG4kZXhwb3J0KCRleHBvcnQuUywgJ1JlZmxlY3QnLCB7IGdldDogZ2V0IH0pO1xuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Iiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///261\n")},function(module,exports,__webpack_require__){eval("// 26.1.7 Reflect.getOwnPropertyDescriptor(target, propertyKey)\nvar gOPD = __webpack_require__(21);\nvar $export = __webpack_require__(1);\nvar anObject = __webpack_require__(4);\n\n$export($export.S, 'Reflect', {\n  getOwnPropertyDescriptor: function getOwnPropertyDescriptor(target, propertyKey) {\n    return gOPD.f(anObject(target), propertyKey);\n  }\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMjYyLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9lczYucmVmbGVjdC5nZXQtb3duLXByb3BlcnR5LWRlc2NyaXB0b3IuanM/ZWJkZSJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyAyNi4xLjcgUmVmbGVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IodGFyZ2V0LCBwcm9wZXJ0eUtleSlcbnZhciBnT1BEID0gcmVxdWlyZSgnLi9fb2JqZWN0LWdvcGQnKTtcbnZhciAkZXhwb3J0ID0gcmVxdWlyZSgnLi9fZXhwb3J0Jyk7XG52YXIgYW5PYmplY3QgPSByZXF1aXJlKCcuL19hbi1vYmplY3QnKTtcblxuJGV4cG9ydCgkZXhwb3J0LlMsICdSZWZsZWN0Jywge1xuICBnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3I6IGZ1bmN0aW9uIGdldE93blByb3BlcnR5RGVzY3JpcHRvcih0YXJnZXQsIHByb3BlcnR5S2V5KSB7XG4gICAgcmV0dXJuIGdPUEQuZihhbk9iamVjdCh0YXJnZXQpLCBwcm9wZXJ0eUtleSk7XG4gIH1cbn0pO1xuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///262\n")},function(module,exports,__webpack_require__){eval("// 26.1.8 Reflect.getPrototypeOf(target)\nvar $export = __webpack_require__(1);\nvar getProto = __webpack_require__(36);\nvar anObject = __webpack_require__(4);\n\n$export($export.S, 'Reflect', {\n  getPrototypeOf: function getPrototypeOf(target) {\n    return getProto(anObject(target));\n  }\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMjYzLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9lczYucmVmbGVjdC5nZXQtcHJvdG90eXBlLW9mLmpzPzJkMzQiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gMjYuMS44IFJlZmxlY3QuZ2V0UHJvdG90eXBlT2YodGFyZ2V0KVxudmFyICRleHBvcnQgPSByZXF1aXJlKCcuL19leHBvcnQnKTtcbnZhciBnZXRQcm90byA9IHJlcXVpcmUoJy4vX29iamVjdC1ncG8nKTtcbnZhciBhbk9iamVjdCA9IHJlcXVpcmUoJy4vX2FuLW9iamVjdCcpO1xuXG4kZXhwb3J0KCRleHBvcnQuUywgJ1JlZmxlY3QnLCB7XG4gIGdldFByb3RvdHlwZU9mOiBmdW5jdGlvbiBnZXRQcm90b3R5cGVPZih0YXJnZXQpIHtcbiAgICByZXR1cm4gZ2V0UHJvdG8oYW5PYmplY3QodGFyZ2V0KSk7XG4gIH1cbn0pO1xuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///263\n")},function(module,exports,__webpack_require__){eval("// 26.1.9 Reflect.has(target, propertyKey)\nvar $export = __webpack_require__(1);\n\n$export($export.S, 'Reflect', {\n  has: function has(target, propertyKey) {\n    return propertyKey in target;\n  }\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMjY0LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9lczYucmVmbGVjdC5oYXMuanM/ZjZiMyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyAyNi4xLjkgUmVmbGVjdC5oYXModGFyZ2V0LCBwcm9wZXJ0eUtleSlcbnZhciAkZXhwb3J0ID0gcmVxdWlyZSgnLi9fZXhwb3J0Jyk7XG5cbiRleHBvcnQoJGV4cG9ydC5TLCAnUmVmbGVjdCcsIHtcbiAgaGFzOiBmdW5jdGlvbiBoYXModGFyZ2V0LCBwcm9wZXJ0eUtleSkge1xuICAgIHJldHVybiBwcm9wZXJ0eUtleSBpbiB0YXJnZXQ7XG4gIH1cbn0pO1xuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///264\n")},function(module,exports,__webpack_require__){eval("// 26.1.10 Reflect.isExtensible(target)\nvar $export = __webpack_require__(1);\nvar anObject = __webpack_require__(4);\nvar $isExtensible = Object.isExtensible;\n\n$export($export.S, 'Reflect', {\n  isExtensible: function isExtensible(target) {\n    anObject(target);\n    return $isExtensible ? $isExtensible(target) : true;\n  }\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMjY1LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9lczYucmVmbGVjdC5pcy1leHRlbnNpYmxlLmpzPzIyNTEiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gMjYuMS4xMCBSZWZsZWN0LmlzRXh0ZW5zaWJsZSh0YXJnZXQpXG52YXIgJGV4cG9ydCA9IHJlcXVpcmUoJy4vX2V4cG9ydCcpO1xudmFyIGFuT2JqZWN0ID0gcmVxdWlyZSgnLi9fYW4tb2JqZWN0Jyk7XG52YXIgJGlzRXh0ZW5zaWJsZSA9IE9iamVjdC5pc0V4dGVuc2libGU7XG5cbiRleHBvcnQoJGV4cG9ydC5TLCAnUmVmbGVjdCcsIHtcbiAgaXNFeHRlbnNpYmxlOiBmdW5jdGlvbiBpc0V4dGVuc2libGUodGFyZ2V0KSB7XG4gICAgYW5PYmplY3QodGFyZ2V0KTtcbiAgICByZXR1cm4gJGlzRXh0ZW5zaWJsZSA/ICRpc0V4dGVuc2libGUodGFyZ2V0KSA6IHRydWU7XG4gIH1cbn0pO1xuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///265\n")},function(module,exports,__webpack_require__){eval("// 26.1.11 Reflect.ownKeys(target)\nvar $export = __webpack_require__(1);\n\n$export($export.S, 'Reflect', { ownKeys: __webpack_require__(119) });\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMjY2LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9lczYucmVmbGVjdC5vd24ta2V5cy5qcz9jNjk4Il0sInNvdXJjZXNDb250ZW50IjpbIi8vIDI2LjEuMTEgUmVmbGVjdC5vd25LZXlzKHRhcmdldClcbnZhciAkZXhwb3J0ID0gcmVxdWlyZSgnLi9fZXhwb3J0Jyk7XG5cbiRleHBvcnQoJGV4cG9ydC5TLCAnUmVmbGVjdCcsIHsgb3duS2V5czogcmVxdWlyZSgnLi9fb3duLWtleXMnKSB9KTtcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7Iiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///266\n")},function(module,exports,__webpack_require__){eval("// 26.1.12 Reflect.preventExtensions(target)\nvar $export = __webpack_require__(1);\nvar anObject = __webpack_require__(4);\nvar $preventExtensions = Object.preventExtensions;\n\n$export($export.S, 'Reflect', {\n  preventExtensions: function preventExtensions(target) {\n    anObject(target);\n    try {\n      if ($preventExtensions) $preventExtensions(target);\n      return true;\n    } catch (e) {\n      return false;\n    }\n  }\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMjY3LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9lczYucmVmbGVjdC5wcmV2ZW50LWV4dGVuc2lvbnMuanM/YTE5ZiJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyAyNi4xLjEyIFJlZmxlY3QucHJldmVudEV4dGVuc2lvbnModGFyZ2V0KVxudmFyICRleHBvcnQgPSByZXF1aXJlKCcuL19leHBvcnQnKTtcbnZhciBhbk9iamVjdCA9IHJlcXVpcmUoJy4vX2FuLW9iamVjdCcpO1xudmFyICRwcmV2ZW50RXh0ZW5zaW9ucyA9IE9iamVjdC5wcmV2ZW50RXh0ZW5zaW9ucztcblxuJGV4cG9ydCgkZXhwb3J0LlMsICdSZWZsZWN0Jywge1xuICBwcmV2ZW50RXh0ZW5zaW9uczogZnVuY3Rpb24gcHJldmVudEV4dGVuc2lvbnModGFyZ2V0KSB7XG4gICAgYW5PYmplY3QodGFyZ2V0KTtcbiAgICB0cnkge1xuICAgICAgaWYgKCRwcmV2ZW50RXh0ZW5zaW9ucykgJHByZXZlbnRFeHRlbnNpb25zKHRhcmdldCk7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICB9XG59KTtcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Iiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///267\n")},function(module,exports,__webpack_require__){eval("// 26.1.13 Reflect.set(target, propertyKey, V [, receiver])\nvar dP = __webpack_require__(10);\nvar gOPD = __webpack_require__(21);\nvar getPrototypeOf = __webpack_require__(36);\nvar has = __webpack_require__(14);\nvar $export = __webpack_require__(1);\nvar createDesc = __webpack_require__(29);\nvar anObject = __webpack_require__(4);\nvar isObject = __webpack_require__(5);\n\nfunction set(target, propertyKey, V /* , receiver */) {\n  var receiver = arguments.length < 4 ? target : arguments[3];\n  var ownDesc = gOPD.f(anObject(target), propertyKey);\n  var existingDescriptor, proto;\n  if (!ownDesc) {\n    if (isObject(proto = getPrototypeOf(target))) {\n      return set(proto, propertyKey, V, receiver);\n    }\n    ownDesc = createDesc(0);\n  }\n  if (has(ownDesc, 'value')) {\n    if (ownDesc.writable === false || !isObject(receiver)) return false;\n    if (existingDescriptor = gOPD.f(receiver, propertyKey)) {\n      if (existingDescriptor.get || existingDescriptor.set || existingDescriptor.writable === false) return false;\n      existingDescriptor.value = V;\n      dP.f(receiver, propertyKey, existingDescriptor);\n    } else dP.f(receiver, propertyKey, createDesc(0, V));\n    return true;\n  }\n  return ownDesc.set === undefined ? false : (ownDesc.set.call(receiver, V), true);\n}\n\n$export($export.S, 'Reflect', { set: set });\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMjY4LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9lczYucmVmbGVjdC5zZXQuanM/OTI1MyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyAyNi4xLjEzIFJlZmxlY3Quc2V0KHRhcmdldCwgcHJvcGVydHlLZXksIFYgWywgcmVjZWl2ZXJdKVxudmFyIGRQID0gcmVxdWlyZSgnLi9fb2JqZWN0LWRwJyk7XG52YXIgZ09QRCA9IHJlcXVpcmUoJy4vX29iamVjdC1nb3BkJyk7XG52YXIgZ2V0UHJvdG90eXBlT2YgPSByZXF1aXJlKCcuL19vYmplY3QtZ3BvJyk7XG52YXIgaGFzID0gcmVxdWlyZSgnLi9faGFzJyk7XG52YXIgJGV4cG9ydCA9IHJlcXVpcmUoJy4vX2V4cG9ydCcpO1xudmFyIGNyZWF0ZURlc2MgPSByZXF1aXJlKCcuL19wcm9wZXJ0eS1kZXNjJyk7XG52YXIgYW5PYmplY3QgPSByZXF1aXJlKCcuL19hbi1vYmplY3QnKTtcbnZhciBpc09iamVjdCA9IHJlcXVpcmUoJy4vX2lzLW9iamVjdCcpO1xuXG5mdW5jdGlvbiBzZXQodGFyZ2V0LCBwcm9wZXJ0eUtleSwgViAvKiAsIHJlY2VpdmVyICovKSB7XG4gIHZhciByZWNlaXZlciA9IGFyZ3VtZW50cy5sZW5ndGggPCA0ID8gdGFyZ2V0IDogYXJndW1lbnRzWzNdO1xuICB2YXIgb3duRGVzYyA9IGdPUEQuZihhbk9iamVjdCh0YXJnZXQpLCBwcm9wZXJ0eUtleSk7XG4gIHZhciBleGlzdGluZ0Rlc2NyaXB0b3IsIHByb3RvO1xuICBpZiAoIW93bkRlc2MpIHtcbiAgICBpZiAoaXNPYmplY3QocHJvdG8gPSBnZXRQcm90b3R5cGVPZih0YXJnZXQpKSkge1xuICAgICAgcmV0dXJuIHNldChwcm90bywgcHJvcGVydHlLZXksIFYsIHJlY2VpdmVyKTtcbiAgICB9XG4gICAgb3duRGVzYyA9IGNyZWF0ZURlc2MoMCk7XG4gIH1cbiAgaWYgKGhhcyhvd25EZXNjLCAndmFsdWUnKSkge1xuICAgIGlmIChvd25EZXNjLndyaXRhYmxlID09PSBmYWxzZSB8fCAhaXNPYmplY3QocmVjZWl2ZXIpKSByZXR1cm4gZmFsc2U7XG4gICAgaWYgKGV4aXN0aW5nRGVzY3JpcHRvciA9IGdPUEQuZihyZWNlaXZlciwgcHJvcGVydHlLZXkpKSB7XG4gICAgICBpZiAoZXhpc3RpbmdEZXNjcmlwdG9yLmdldCB8fCBleGlzdGluZ0Rlc2NyaXB0b3Iuc2V0IHx8IGV4aXN0aW5nRGVzY3JpcHRvci53cml0YWJsZSA9PT0gZmFsc2UpIHJldHVybiBmYWxzZTtcbiAgICAgIGV4aXN0aW5nRGVzY3JpcHRvci52YWx1ZSA9IFY7XG4gICAgICBkUC5mKHJlY2VpdmVyLCBwcm9wZXJ0eUtleSwgZXhpc3RpbmdEZXNjcmlwdG9yKTtcbiAgICB9IGVsc2UgZFAuZihyZWNlaXZlciwgcHJvcGVydHlLZXksIGNyZWF0ZURlc2MoMCwgVikpO1xuICAgIHJldHVybiB0cnVlO1xuICB9XG4gIHJldHVybiBvd25EZXNjLnNldCA9PT0gdW5kZWZpbmVkID8gZmFsc2UgOiAob3duRGVzYy5zZXQuY2FsbChyZWNlaXZlciwgViksIHRydWUpO1xufVxuXG4kZXhwb3J0KCRleHBvcnQuUywgJ1JlZmxlY3QnLCB7IHNldDogc2V0IH0pO1xuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Iiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///268\n")},function(module,exports,__webpack_require__){eval("// 26.1.14 Reflect.setPrototypeOf(target, proto)\nvar $export = __webpack_require__(1);\nvar setProto = __webpack_require__(66);\n\nif (setProto) $export($export.S, 'Reflect', {\n  setPrototypeOf: function setPrototypeOf(target, proto) {\n    setProto.check(target, proto);\n    try {\n      setProto.set(target, proto);\n      return true;\n    } catch (e) {\n      return false;\n    }\n  }\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMjY5LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9lczYucmVmbGVjdC5zZXQtcHJvdG90eXBlLW9mLmpzPzkyNzUiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gMjYuMS4xNCBSZWZsZWN0LnNldFByb3RvdHlwZU9mKHRhcmdldCwgcHJvdG8pXG52YXIgJGV4cG9ydCA9IHJlcXVpcmUoJy4vX2V4cG9ydCcpO1xudmFyIHNldFByb3RvID0gcmVxdWlyZSgnLi9fc2V0LXByb3RvJyk7XG5cbmlmIChzZXRQcm90bykgJGV4cG9ydCgkZXhwb3J0LlMsICdSZWZsZWN0Jywge1xuICBzZXRQcm90b3R5cGVPZjogZnVuY3Rpb24gc2V0UHJvdG90eXBlT2YodGFyZ2V0LCBwcm90bykge1xuICAgIHNldFByb3RvLmNoZWNrKHRhcmdldCwgcHJvdG8pO1xuICAgIHRyeSB7XG4gICAgICBzZXRQcm90by5zZXQodGFyZ2V0LCBwcm90byk7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICB9XG59KTtcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///269\n")},function(module,exports,__webpack_require__){eval("__webpack_require__(271);\nmodule.exports = __webpack_require__(8).Array.includes;\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMjcwLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvZm4vYXJyYXkvaW5jbHVkZXMuanM/MTQzYSJdLCJzb3VyY2VzQ29udGVudCI6WyJyZXF1aXJlKCcuLi8uLi9tb2R1bGVzL2VzNy5hcnJheS5pbmNsdWRlcycpO1xubW9kdWxlLmV4cG9ydHMgPSByZXF1aXJlKCcuLi8uLi9tb2R1bGVzL19jb3JlJykuQXJyYXkuaW5jbHVkZXM7XG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7Iiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///270\n")},function(module,exports,__webpack_require__){"use strict";eval("\n// https://github.com/tc39/Array.prototype.includes\nvar $export = __webpack_require__(1);\nvar $includes = __webpack_require__(50)(true);\n\n$export($export.P, 'Array', {\n  includes: function includes(el /* , fromIndex = 0 */) {\n    return $includes(this, el, arguments.length > 1 ? arguments[1] : undefined);\n  }\n});\n\n__webpack_require__(37)('includes');\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMjcxLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9lczcuYXJyYXkuaW5jbHVkZXMuanM/Njc2MiJdLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XG4vLyBodHRwczovL2dpdGh1Yi5jb20vdGMzOS9BcnJheS5wcm90b3R5cGUuaW5jbHVkZXNcbnZhciAkZXhwb3J0ID0gcmVxdWlyZSgnLi9fZXhwb3J0Jyk7XG52YXIgJGluY2x1ZGVzID0gcmVxdWlyZSgnLi9fYXJyYXktaW5jbHVkZXMnKSh0cnVlKTtcblxuJGV4cG9ydCgkZXhwb3J0LlAsICdBcnJheScsIHtcbiAgaW5jbHVkZXM6IGZ1bmN0aW9uIGluY2x1ZGVzKGVsIC8qICwgZnJvbUluZGV4ID0gMCAqLykge1xuICAgIHJldHVybiAkaW5jbHVkZXModGhpcywgZWwsIGFyZ3VtZW50cy5sZW5ndGggPiAxID8gYXJndW1lbnRzWzFdIDogdW5kZWZpbmVkKTtcbiAgfVxufSk7XG5cbnJlcXVpcmUoJy4vX2FkZC10by11bnNjb3BhYmxlcycpKCdpbmNsdWRlcycpO1xuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Iiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///271\n")},function(module,exports,__webpack_require__){eval("__webpack_require__(273);\nmodule.exports = __webpack_require__(8).Array.flatMap;\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMjcyLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvZm4vYXJyYXkvZmxhdC1tYXAuanM/NjI5ZiJdLCJzb3VyY2VzQ29udGVudCI6WyJyZXF1aXJlKCcuLi8uLi9tb2R1bGVzL2VzNy5hcnJheS5mbGF0LW1hcCcpO1xubW9kdWxlLmV4cG9ydHMgPSByZXF1aXJlKCcuLi8uLi9tb2R1bGVzL19jb3JlJykuQXJyYXkuZmxhdE1hcDtcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///272\n")},function(module,exports,__webpack_require__){"use strict";eval("\n// https://tc39.github.io/proposal-flatMap/#sec-Array.prototype.flatMap\nvar $export = __webpack_require__(1);\nvar flattenIntoArray = __webpack_require__(274);\nvar toObject = __webpack_require__(11);\nvar toLength = __webpack_require__(7);\nvar aFunction = __webpack_require__(19);\nvar arraySpeciesCreate = __webpack_require__(107);\n\n$export($export.P, 'Array', {\n  flatMap: function flatMap(callbackfn /* , thisArg */) {\n    var O = toObject(this);\n    var sourceLen, A;\n    aFunction(callbackfn);\n    sourceLen = toLength(O.length);\n    A = arraySpeciesCreate(O, 0);\n    flattenIntoArray(A, O, O, sourceLen, 0, 1, callbackfn, arguments[1]);\n    return A;\n  }\n});\n\n__webpack_require__(37)('flatMap');\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMjczLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9lczcuYXJyYXkuZmxhdC1tYXAuanM/ZTk1NiJdLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XG4vLyBodHRwczovL3RjMzkuZ2l0aHViLmlvL3Byb3Bvc2FsLWZsYXRNYXAvI3NlYy1BcnJheS5wcm90b3R5cGUuZmxhdE1hcFxudmFyICRleHBvcnQgPSByZXF1aXJlKCcuL19leHBvcnQnKTtcbnZhciBmbGF0dGVuSW50b0FycmF5ID0gcmVxdWlyZSgnLi9fZmxhdHRlbi1pbnRvLWFycmF5Jyk7XG52YXIgdG9PYmplY3QgPSByZXF1aXJlKCcuL190by1vYmplY3QnKTtcbnZhciB0b0xlbmd0aCA9IHJlcXVpcmUoJy4vX3RvLWxlbmd0aCcpO1xudmFyIGFGdW5jdGlvbiA9IHJlcXVpcmUoJy4vX2EtZnVuY3Rpb24nKTtcbnZhciBhcnJheVNwZWNpZXNDcmVhdGUgPSByZXF1aXJlKCcuL19hcnJheS1zcGVjaWVzLWNyZWF0ZScpO1xuXG4kZXhwb3J0KCRleHBvcnQuUCwgJ0FycmF5Jywge1xuICBmbGF0TWFwOiBmdW5jdGlvbiBmbGF0TWFwKGNhbGxiYWNrZm4gLyogLCB0aGlzQXJnICovKSB7XG4gICAgdmFyIE8gPSB0b09iamVjdCh0aGlzKTtcbiAgICB2YXIgc291cmNlTGVuLCBBO1xuICAgIGFGdW5jdGlvbihjYWxsYmFja2ZuKTtcbiAgICBzb3VyY2VMZW4gPSB0b0xlbmd0aChPLmxlbmd0aCk7XG4gICAgQSA9IGFycmF5U3BlY2llc0NyZWF0ZShPLCAwKTtcbiAgICBmbGF0dGVuSW50b0FycmF5KEEsIE8sIE8sIHNvdXJjZUxlbiwgMCwgMSwgY2FsbGJhY2tmbiwgYXJndW1lbnRzWzFdKTtcbiAgICByZXR1cm4gQTtcbiAgfVxufSk7XG5cbnJlcXVpcmUoJy4vX2FkZC10by11bnNjb3BhYmxlcycpKCdmbGF0TWFwJyk7XG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///273\n")},function(module,exports,__webpack_require__){"use strict";eval("\n// https://tc39.github.io/proposal-flatMap/#sec-FlattenIntoArray\nvar isArray = __webpack_require__(52);\nvar isObject = __webpack_require__(5);\nvar toLength = __webpack_require__(7);\nvar ctx = __webpack_require__(18);\nvar IS_CONCAT_SPREADABLE = __webpack_require__(6)('isConcatSpreadable');\n\nfunction flattenIntoArray(target, original, source, sourceLen, start, depth, mapper, thisArg) {\n  var targetIndex = start;\n  var sourceIndex = 0;\n  var mapFn = mapper ? ctx(mapper, thisArg, 3) : false;\n  var element, spreadable;\n\n  while (sourceIndex < sourceLen) {\n    if (sourceIndex in source) {\n      element = mapFn ? mapFn(source[sourceIndex], sourceIndex, original) : source[sourceIndex];\n\n      spreadable = false;\n      if (isObject(element)) {\n        spreadable = element[IS_CONCAT_SPREADABLE];\n        spreadable = spreadable !== undefined ? !!spreadable : isArray(element);\n      }\n\n      if (spreadable && depth > 0) {\n        targetIndex = flattenIntoArray(target, original, element, toLength(element.length), targetIndex, depth - 1) - 1;\n      } else {\n        if (targetIndex >= 0x1fffffffffffff) throw TypeError();\n        target[targetIndex] = element;\n      }\n\n      targetIndex++;\n    }\n    sourceIndex++;\n  }\n  return targetIndex;\n}\n\nmodule.exports = flattenIntoArray;\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMjc0LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9fZmxhdHRlbi1pbnRvLWFycmF5LmpzP2M0NWYiXSwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuLy8gaHR0cHM6Ly90YzM5LmdpdGh1Yi5pby9wcm9wb3NhbC1mbGF0TWFwLyNzZWMtRmxhdHRlbkludG9BcnJheVxudmFyIGlzQXJyYXkgPSByZXF1aXJlKCcuL19pcy1hcnJheScpO1xudmFyIGlzT2JqZWN0ID0gcmVxdWlyZSgnLi9faXMtb2JqZWN0Jyk7XG52YXIgdG9MZW5ndGggPSByZXF1aXJlKCcuL190by1sZW5ndGgnKTtcbnZhciBjdHggPSByZXF1aXJlKCcuL19jdHgnKTtcbnZhciBJU19DT05DQVRfU1BSRUFEQUJMRSA9IHJlcXVpcmUoJy4vX3drcycpKCdpc0NvbmNhdFNwcmVhZGFibGUnKTtcblxuZnVuY3Rpb24gZmxhdHRlbkludG9BcnJheSh0YXJnZXQsIG9yaWdpbmFsLCBzb3VyY2UsIHNvdXJjZUxlbiwgc3RhcnQsIGRlcHRoLCBtYXBwZXIsIHRoaXNBcmcpIHtcbiAgdmFyIHRhcmdldEluZGV4ID0gc3RhcnQ7XG4gIHZhciBzb3VyY2VJbmRleCA9IDA7XG4gIHZhciBtYXBGbiA9IG1hcHBlciA/IGN0eChtYXBwZXIsIHRoaXNBcmcsIDMpIDogZmFsc2U7XG4gIHZhciBlbGVtZW50LCBzcHJlYWRhYmxlO1xuXG4gIHdoaWxlIChzb3VyY2VJbmRleCA8IHNvdXJjZUxlbikge1xuICAgIGlmIChzb3VyY2VJbmRleCBpbiBzb3VyY2UpIHtcbiAgICAgIGVsZW1lbnQgPSBtYXBGbiA/IG1hcEZuKHNvdXJjZVtzb3VyY2VJbmRleF0sIHNvdXJjZUluZGV4LCBvcmlnaW5hbCkgOiBzb3VyY2Vbc291cmNlSW5kZXhdO1xuXG4gICAgICBzcHJlYWRhYmxlID0gZmFsc2U7XG4gICAgICBpZiAoaXNPYmplY3QoZWxlbWVudCkpIHtcbiAgICAgICAgc3ByZWFkYWJsZSA9IGVsZW1lbnRbSVNfQ09OQ0FUX1NQUkVBREFCTEVdO1xuICAgICAgICBzcHJlYWRhYmxlID0gc3ByZWFkYWJsZSAhPT0gdW5kZWZpbmVkID8gISFzcHJlYWRhYmxlIDogaXNBcnJheShlbGVtZW50KTtcbiAgICAgIH1cblxuICAgICAgaWYgKHNwcmVhZGFibGUgJiYgZGVwdGggPiAwKSB7XG4gICAgICAgIHRhcmdldEluZGV4ID0gZmxhdHRlbkludG9BcnJheSh0YXJnZXQsIG9yaWdpbmFsLCBlbGVtZW50LCB0b0xlbmd0aChlbGVtZW50Lmxlbmd0aCksIHRhcmdldEluZGV4LCBkZXB0aCAtIDEpIC0gMTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGlmICh0YXJnZXRJbmRleCA+PSAweDFmZmZmZmZmZmZmZmZmKSB0aHJvdyBUeXBlRXJyb3IoKTtcbiAgICAgICAgdGFyZ2V0W3RhcmdldEluZGV4XSA9IGVsZW1lbnQ7XG4gICAgICB9XG5cbiAgICAgIHRhcmdldEluZGV4Kys7XG4gICAgfVxuICAgIHNvdXJjZUluZGV4Kys7XG4gIH1cbiAgcmV0dXJuIHRhcmdldEluZGV4O1xufVxuXG5tb2R1bGUuZXhwb3J0cyA9IGZsYXR0ZW5JbnRvQXJyYXk7XG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///274\n")},function(module,exports,__webpack_require__){eval("__webpack_require__(276);\nmodule.exports = __webpack_require__(8).String.padStart;\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMjc1LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvZm4vc3RyaW5nL3BhZC1zdGFydC5qcz9jMThjIl0sInNvdXJjZXNDb250ZW50IjpbInJlcXVpcmUoJy4uLy4uL21vZHVsZXMvZXM3LnN0cmluZy5wYWQtc3RhcnQnKTtcbm1vZHVsZS5leHBvcnRzID0gcmVxdWlyZSgnLi4vLi4vbW9kdWxlcy9fY29yZScpLlN0cmluZy5wYWRTdGFydDtcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///275\n")},function(module,exports,__webpack_require__){"use strict";eval("\n// https://github.com/tc39/proposal-string-pad-start-end\nvar $export = __webpack_require__(1);\nvar $pad = __webpack_require__(120);\nvar userAgent = __webpack_require__(58);\n\n// https://github.com/zloirock/core-js/issues/280\nvar WEBKIT_BUG = /Version\\/10\\.\\d+(\\.\\d+)?( Mobile\\/\\w+)? Safari\\//.test(userAgent);\n\n$export($export.P + $export.F * WEBKIT_BUG, 'String', {\n  padStart: function padStart(maxLength /* , fillString = ' ' */) {\n    return $pad(this, maxLength, arguments.length > 1 ? arguments[1] : undefined, true);\n  }\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMjc2LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9lczcuc3RyaW5nLnBhZC1zdGFydC5qcz9mNTc2Il0sInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0Jztcbi8vIGh0dHBzOi8vZ2l0aHViLmNvbS90YzM5L3Byb3Bvc2FsLXN0cmluZy1wYWQtc3RhcnQtZW5kXG52YXIgJGV4cG9ydCA9IHJlcXVpcmUoJy4vX2V4cG9ydCcpO1xudmFyICRwYWQgPSByZXF1aXJlKCcuL19zdHJpbmctcGFkJyk7XG52YXIgdXNlckFnZW50ID0gcmVxdWlyZSgnLi9fdXNlci1hZ2VudCcpO1xuXG4vLyBodHRwczovL2dpdGh1Yi5jb20vemxvaXJvY2svY29yZS1qcy9pc3N1ZXMvMjgwXG52YXIgV0VCS0lUX0JVRyA9IC9WZXJzaW9uXFwvMTBcXC5cXGQrKFxcLlxcZCspPyggTW9iaWxlXFwvXFx3Kyk/IFNhZmFyaVxcLy8udGVzdCh1c2VyQWdlbnQpO1xuXG4kZXhwb3J0KCRleHBvcnQuUCArICRleHBvcnQuRiAqIFdFQktJVF9CVUcsICdTdHJpbmcnLCB7XG4gIHBhZFN0YXJ0OiBmdW5jdGlvbiBwYWRTdGFydChtYXhMZW5ndGggLyogLCBmaWxsU3RyaW5nID0gJyAnICovKSB7XG4gICAgcmV0dXJuICRwYWQodGhpcywgbWF4TGVuZ3RoLCBhcmd1bWVudHMubGVuZ3RoID4gMSA/IGFyZ3VtZW50c1sxXSA6IHVuZGVmaW5lZCwgdHJ1ZSk7XG4gIH1cbn0pO1xuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///276\n")},function(module,exports,__webpack_require__){eval("__webpack_require__(278);\nmodule.exports = __webpack_require__(8).String.padEnd;\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMjc3LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvZm4vc3RyaW5nL3BhZC1lbmQuanM/NDBkYyJdLCJzb3VyY2VzQ29udGVudCI6WyJyZXF1aXJlKCcuLi8uLi9tb2R1bGVzL2VzNy5zdHJpbmcucGFkLWVuZCcpO1xubW9kdWxlLmV4cG9ydHMgPSByZXF1aXJlKCcuLi8uLi9tb2R1bGVzL19jb3JlJykuU3RyaW5nLnBhZEVuZDtcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///277\n")},function(module,exports,__webpack_require__){"use strict";eval("\n// https://github.com/tc39/proposal-string-pad-start-end\nvar $export = __webpack_require__(1);\nvar $pad = __webpack_require__(120);\nvar userAgent = __webpack_require__(58);\n\n// https://github.com/zloirock/core-js/issues/280\nvar WEBKIT_BUG = /Version\\/10\\.\\d+(\\.\\d+)?( Mobile\\/\\w+)? Safari\\//.test(userAgent);\n\n$export($export.P + $export.F * WEBKIT_BUG, 'String', {\n  padEnd: function padEnd(maxLength /* , fillString = ' ' */) {\n    return $pad(this, maxLength, arguments.length > 1 ? arguments[1] : undefined, false);\n  }\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMjc4LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9lczcuc3RyaW5nLnBhZC1lbmQuanM/ZWQ1MCJdLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XG4vLyBodHRwczovL2dpdGh1Yi5jb20vdGMzOS9wcm9wb3NhbC1zdHJpbmctcGFkLXN0YXJ0LWVuZFxudmFyICRleHBvcnQgPSByZXF1aXJlKCcuL19leHBvcnQnKTtcbnZhciAkcGFkID0gcmVxdWlyZSgnLi9fc3RyaW5nLXBhZCcpO1xudmFyIHVzZXJBZ2VudCA9IHJlcXVpcmUoJy4vX3VzZXItYWdlbnQnKTtcblxuLy8gaHR0cHM6Ly9naXRodWIuY29tL3psb2lyb2NrL2NvcmUtanMvaXNzdWVzLzI4MFxudmFyIFdFQktJVF9CVUcgPSAvVmVyc2lvblxcLzEwXFwuXFxkKyhcXC5cXGQrKT8oIE1vYmlsZVxcL1xcdyspPyBTYWZhcmlcXC8vLnRlc3QodXNlckFnZW50KTtcblxuJGV4cG9ydCgkZXhwb3J0LlAgKyAkZXhwb3J0LkYgKiBXRUJLSVRfQlVHLCAnU3RyaW5nJywge1xuICBwYWRFbmQ6IGZ1bmN0aW9uIHBhZEVuZChtYXhMZW5ndGggLyogLCBmaWxsU3RyaW5nID0gJyAnICovKSB7XG4gICAgcmV0dXJuICRwYWQodGhpcywgbWF4TGVuZ3RoLCBhcmd1bWVudHMubGVuZ3RoID4gMSA/IGFyZ3VtZW50c1sxXSA6IHVuZGVmaW5lZCwgZmFsc2UpO1xuICB9XG59KTtcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///278\n")},function(module,exports,__webpack_require__){eval("__webpack_require__(280);\nmodule.exports = __webpack_require__(8).String.trimLeft;\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMjc5LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvZm4vc3RyaW5nL3RyaW0tc3RhcnQuanM/MjMzYiJdLCJzb3VyY2VzQ29udGVudCI6WyJyZXF1aXJlKCcuLi8uLi9tb2R1bGVzL2VzNy5zdHJpbmcudHJpbS1sZWZ0Jyk7XG5tb2R1bGUuZXhwb3J0cyA9IHJlcXVpcmUoJy4uLy4uL21vZHVsZXMvX2NvcmUnKS5TdHJpbmcudHJpbUxlZnQ7XG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7Iiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///279\n")},function(module,exports,__webpack_require__){"use strict";eval("\n// https://github.com/sebmarkbage/ecmascript-string-left-right-trim\n__webpack_require__(40)('trimLeft', function ($trim) {\n  return function trimLeft() {\n    return $trim(this, 1);\n  };\n}, 'trimStart');\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMjgwLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9lczcuc3RyaW5nLnRyaW0tbGVmdC5qcz8yM2JlIl0sInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0Jztcbi8vIGh0dHBzOi8vZ2l0aHViLmNvbS9zZWJtYXJrYmFnZS9lY21hc2NyaXB0LXN0cmluZy1sZWZ0LXJpZ2h0LXRyaW1cbnJlcXVpcmUoJy4vX3N0cmluZy10cmltJykoJ3RyaW1MZWZ0JywgZnVuY3Rpb24gKCR0cmltKSB7XG4gIHJldHVybiBmdW5jdGlvbiB0cmltTGVmdCgpIHtcbiAgICByZXR1cm4gJHRyaW0odGhpcywgMSk7XG4gIH07XG59LCAndHJpbVN0YXJ0Jyk7XG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///280\n")},function(module,exports,__webpack_require__){eval("__webpack_require__(282);\nmodule.exports = __webpack_require__(8).String.trimRight;\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMjgxLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvZm4vc3RyaW5nL3RyaW0tZW5kLmpzPzk2N2QiXSwic291cmNlc0NvbnRlbnQiOlsicmVxdWlyZSgnLi4vLi4vbW9kdWxlcy9lczcuc3RyaW5nLnRyaW0tcmlnaHQnKTtcbm1vZHVsZS5leHBvcnRzID0gcmVxdWlyZSgnLi4vLi4vbW9kdWxlcy9fY29yZScpLlN0cmluZy50cmltUmlnaHQ7XG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7Iiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///281\n")},function(module,exports,__webpack_require__){"use strict";eval("\n// https://github.com/sebmarkbage/ecmascript-string-left-right-trim\n__webpack_require__(40)('trimRight', function ($trim) {\n  return function trimRight() {\n    return $trim(this, 2);\n  };\n}, 'trimEnd');\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMjgyLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9lczcuc3RyaW5nLnRyaW0tcmlnaHQuanM/N2MwZSJdLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XG4vLyBodHRwczovL2dpdGh1Yi5jb20vc2VibWFya2JhZ2UvZWNtYXNjcmlwdC1zdHJpbmctbGVmdC1yaWdodC10cmltXG5yZXF1aXJlKCcuL19zdHJpbmctdHJpbScpKCd0cmltUmlnaHQnLCBmdW5jdGlvbiAoJHRyaW0pIHtcbiAgcmV0dXJuIGZ1bmN0aW9uIHRyaW1SaWdodCgpIHtcbiAgICByZXR1cm4gJHRyaW0odGhpcywgMik7XG4gIH07XG59LCAndHJpbUVuZCcpO1xuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///282\n")},function(module,exports,__webpack_require__){eval("__webpack_require__(284);\nmodule.exports = __webpack_require__(62).f('asyncIterator');\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMjgzLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvZm4vc3ltYm9sL2FzeW5jLWl0ZXJhdG9yLmpzP2MwM2MiXSwic291cmNlc0NvbnRlbnQiOlsicmVxdWlyZSgnLi4vLi4vbW9kdWxlcy9lczcuc3ltYm9sLmFzeW5jLWl0ZXJhdG9yJyk7XG5tb2R1bGUuZXhwb3J0cyA9IHJlcXVpcmUoJy4uLy4uL21vZHVsZXMvX3drcy1leHQnKS5mKCdhc3luY0l0ZXJhdG9yJyk7XG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7Iiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///283\n")},function(module,exports,__webpack_require__){eval("__webpack_require__(92)('asyncIterator');\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMjg0LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9lczcuc3ltYm9sLmFzeW5jLWl0ZXJhdG9yLmpzP2FjNGQiXSwic291cmNlc0NvbnRlbnQiOlsicmVxdWlyZSgnLi9fd2tzLWRlZmluZScpKCdhc3luY0l0ZXJhdG9yJyk7XG4iXSwibWFwcGluZ3MiOiJBQUFBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///284\n")},function(module,exports,__webpack_require__){eval("__webpack_require__(286);\nmodule.exports = __webpack_require__(8).Object.getOwnPropertyDescriptors;\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMjg1LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvZm4vb2JqZWN0L2dldC1vd24tcHJvcGVydHktZGVzY3JpcHRvcnMuanM/Zjk3OSJdLCJzb3VyY2VzQ29udGVudCI6WyJyZXF1aXJlKCcuLi8uLi9tb2R1bGVzL2VzNy5vYmplY3QuZ2V0LW93bi1wcm9wZXJ0eS1kZXNjcmlwdG9ycycpO1xubW9kdWxlLmV4cG9ydHMgPSByZXF1aXJlKCcuLi8uLi9tb2R1bGVzL19jb3JlJykuT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcnM7XG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7Iiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///285\n")},function(module,exports,__webpack_require__){eval("// https://github.com/tc39/proposal-object-getownpropertydescriptors\nvar $export = __webpack_require__(1);\nvar ownKeys = __webpack_require__(119);\nvar toIObject = __webpack_require__(16);\nvar gOPD = __webpack_require__(21);\nvar createProperty = __webpack_require__(78);\n\n$export($export.S, 'Object', {\n  getOwnPropertyDescriptors: function getOwnPropertyDescriptors(object) {\n    var O = toIObject(object);\n    var getDesc = gOPD.f;\n    var keys = ownKeys(O);\n    var result = {};\n    var i = 0;\n    var key, desc;\n    while (keys.length > i) {\n      desc = getDesc(O, key = keys[i++]);\n      if (desc !== undefined) createProperty(result, key, desc);\n    }\n    return result;\n  }\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMjg2LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9lczcub2JqZWN0LmdldC1vd24tcHJvcGVydHktZGVzY3JpcHRvcnMuanM/OGU2ZSJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBodHRwczovL2dpdGh1Yi5jb20vdGMzOS9wcm9wb3NhbC1vYmplY3QtZ2V0b3ducHJvcGVydHlkZXNjcmlwdG9yc1xudmFyICRleHBvcnQgPSByZXF1aXJlKCcuL19leHBvcnQnKTtcbnZhciBvd25LZXlzID0gcmVxdWlyZSgnLi9fb3duLWtleXMnKTtcbnZhciB0b0lPYmplY3QgPSByZXF1aXJlKCcuL190by1pb2JqZWN0Jyk7XG52YXIgZ09QRCA9IHJlcXVpcmUoJy4vX29iamVjdC1nb3BkJyk7XG52YXIgY3JlYXRlUHJvcGVydHkgPSByZXF1aXJlKCcuL19jcmVhdGUtcHJvcGVydHknKTtcblxuJGV4cG9ydCgkZXhwb3J0LlMsICdPYmplY3QnLCB7XG4gIGdldE93blByb3BlcnR5RGVzY3JpcHRvcnM6IGZ1bmN0aW9uIGdldE93blByb3BlcnR5RGVzY3JpcHRvcnMob2JqZWN0KSB7XG4gICAgdmFyIE8gPSB0b0lPYmplY3Qob2JqZWN0KTtcbiAgICB2YXIgZ2V0RGVzYyA9IGdPUEQuZjtcbiAgICB2YXIga2V5cyA9IG93bktleXMoTyk7XG4gICAgdmFyIHJlc3VsdCA9IHt9O1xuICAgIHZhciBpID0gMDtcbiAgICB2YXIga2V5LCBkZXNjO1xuICAgIHdoaWxlIChrZXlzLmxlbmd0aCA+IGkpIHtcbiAgICAgIGRlc2MgPSBnZXREZXNjKE8sIGtleSA9IGtleXNbaSsrXSk7XG4gICAgICBpZiAoZGVzYyAhPT0gdW5kZWZpbmVkKSBjcmVhdGVQcm9wZXJ0eShyZXN1bHQsIGtleSwgZGVzYyk7XG4gICAgfVxuICAgIHJldHVybiByZXN1bHQ7XG4gIH1cbn0pO1xuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///286\n")},function(module,exports,__webpack_require__){eval("__webpack_require__(288);\nmodule.exports = __webpack_require__(8).Object.values;\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMjg3LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvZm4vb2JqZWN0L3ZhbHVlcy5qcz9jYzUxIl0sInNvdXJjZXNDb250ZW50IjpbInJlcXVpcmUoJy4uLy4uL21vZHVsZXMvZXM3Lm9iamVjdC52YWx1ZXMnKTtcbm1vZHVsZS5leHBvcnRzID0gcmVxdWlyZSgnLi4vLi4vbW9kdWxlcy9fY29yZScpLk9iamVjdC52YWx1ZXM7XG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7Iiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///287\n")},function(module,exports,__webpack_require__){eval("// https://github.com/tc39/proposal-object-values-entries\nvar $export = __webpack_require__(1);\nvar $values = __webpack_require__(121)(false);\n\n$export($export.S, 'Object', {\n  values: function values(it) {\n    return $values(it);\n  }\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMjg4LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9lczcub2JqZWN0LnZhbHVlcy5qcz84NjE1Il0sInNvdXJjZXNDb250ZW50IjpbIi8vIGh0dHBzOi8vZ2l0aHViLmNvbS90YzM5L3Byb3Bvc2FsLW9iamVjdC12YWx1ZXMtZW50cmllc1xudmFyICRleHBvcnQgPSByZXF1aXJlKCcuL19leHBvcnQnKTtcbnZhciAkdmFsdWVzID0gcmVxdWlyZSgnLi9fb2JqZWN0LXRvLWFycmF5JykoZmFsc2UpO1xuXG4kZXhwb3J0KCRleHBvcnQuUywgJ09iamVjdCcsIHtcbiAgdmFsdWVzOiBmdW5jdGlvbiB2YWx1ZXMoaXQpIHtcbiAgICByZXR1cm4gJHZhbHVlcyhpdCk7XG4gIH1cbn0pO1xuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Iiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///288\n")},function(module,exports,__webpack_require__){eval("__webpack_require__(290);\nmodule.exports = __webpack_require__(8).Object.entries;\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMjg5LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvZm4vb2JqZWN0L2VudHJpZXMuanM/MjViNCJdLCJzb3VyY2VzQ29udGVudCI6WyJyZXF1aXJlKCcuLi8uLi9tb2R1bGVzL2VzNy5vYmplY3QuZW50cmllcycpO1xubW9kdWxlLmV4cG9ydHMgPSByZXF1aXJlKCcuLi8uLi9tb2R1bGVzL19jb3JlJykuT2JqZWN0LmVudHJpZXM7XG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7Iiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///289\n")},function(module,exports,__webpack_require__){eval("// https://github.com/tc39/proposal-object-values-entries\nvar $export = __webpack_require__(1);\nvar $entries = __webpack_require__(121)(true);\n\n$export($export.S, 'Object', {\n  entries: function entries(it) {\n    return $entries(it);\n  }\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMjkwLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9lczcub2JqZWN0LmVudHJpZXMuanM/ZmZjMSJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBodHRwczovL2dpdGh1Yi5jb20vdGMzOS9wcm9wb3NhbC1vYmplY3QtdmFsdWVzLWVudHJpZXNcbnZhciAkZXhwb3J0ID0gcmVxdWlyZSgnLi9fZXhwb3J0Jyk7XG52YXIgJGVudHJpZXMgPSByZXF1aXJlKCcuL19vYmplY3QtdG8tYXJyYXknKSh0cnVlKTtcblxuJGV4cG9ydCgkZXhwb3J0LlMsICdPYmplY3QnLCB7XG4gIGVudHJpZXM6IGZ1bmN0aW9uIGVudHJpZXMoaXQpIHtcbiAgICByZXR1cm4gJGVudHJpZXMoaXQpO1xuICB9XG59KTtcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///290\n")},function(module,exports,__webpack_require__){"use strict";eval("\n__webpack_require__(113);\n__webpack_require__(292);\nmodule.exports = __webpack_require__(8).Promise['finally'];\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMjkxLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvZm4vcHJvbWlzZS9maW5hbGx5LmpzPzRjOGEiXSwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xucmVxdWlyZSgnLi4vLi4vbW9kdWxlcy9lczYucHJvbWlzZScpO1xucmVxdWlyZSgnLi4vLi4vbW9kdWxlcy9lczcucHJvbWlzZS5maW5hbGx5Jyk7XG5tb2R1bGUuZXhwb3J0cyA9IHJlcXVpcmUoJy4uLy4uL21vZHVsZXMvX2NvcmUnKS5Qcm9taXNlWydmaW5hbGx5J107XG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///291\n")},function(module,exports,__webpack_require__){"use strict";eval("// https://github.com/tc39/proposal-promise-finally\n\nvar $export = __webpack_require__(1);\nvar core = __webpack_require__(8);\nvar global = __webpack_require__(2);\nvar speciesConstructor = __webpack_require__(48);\nvar promiseResolve = __webpack_require__(115);\n\n$export($export.P + $export.R, 'Promise', { 'finally': function (onFinally) {\n  var C = speciesConstructor(this, core.Promise || global.Promise);\n  var isFunction = typeof onFinally == 'function';\n  return this.then(\n    isFunction ? function (x) {\n      return promiseResolve(C, onFinally()).then(function () { return x; });\n    } : onFinally,\n    isFunction ? function (e) {\n      return promiseResolve(C, onFinally()).then(function () { throw e; });\n    } : onFinally\n  );\n} });\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMjkyLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9lczcucHJvbWlzZS5maW5hbGx5LmpzPzA5N2QiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gaHR0cHM6Ly9naXRodWIuY29tL3RjMzkvcHJvcG9zYWwtcHJvbWlzZS1maW5hbGx5XG4ndXNlIHN0cmljdCc7XG52YXIgJGV4cG9ydCA9IHJlcXVpcmUoJy4vX2V4cG9ydCcpO1xudmFyIGNvcmUgPSByZXF1aXJlKCcuL19jb3JlJyk7XG52YXIgZ2xvYmFsID0gcmVxdWlyZSgnLi9fZ2xvYmFsJyk7XG52YXIgc3BlY2llc0NvbnN0cnVjdG9yID0gcmVxdWlyZSgnLi9fc3BlY2llcy1jb25zdHJ1Y3RvcicpO1xudmFyIHByb21pc2VSZXNvbHZlID0gcmVxdWlyZSgnLi9fcHJvbWlzZS1yZXNvbHZlJyk7XG5cbiRleHBvcnQoJGV4cG9ydC5QICsgJGV4cG9ydC5SLCAnUHJvbWlzZScsIHsgJ2ZpbmFsbHknOiBmdW5jdGlvbiAob25GaW5hbGx5KSB7XG4gIHZhciBDID0gc3BlY2llc0NvbnN0cnVjdG9yKHRoaXMsIGNvcmUuUHJvbWlzZSB8fCBnbG9iYWwuUHJvbWlzZSk7XG4gIHZhciBpc0Z1bmN0aW9uID0gdHlwZW9mIG9uRmluYWxseSA9PSAnZnVuY3Rpb24nO1xuICByZXR1cm4gdGhpcy50aGVuKFxuICAgIGlzRnVuY3Rpb24gPyBmdW5jdGlvbiAoeCkge1xuICAgICAgcmV0dXJuIHByb21pc2VSZXNvbHZlKEMsIG9uRmluYWxseSgpKS50aGVuKGZ1bmN0aW9uICgpIHsgcmV0dXJuIHg7IH0pO1xuICAgIH0gOiBvbkZpbmFsbHksXG4gICAgaXNGdW5jdGlvbiA/IGZ1bmN0aW9uIChlKSB7XG4gICAgICByZXR1cm4gcHJvbWlzZVJlc29sdmUoQywgb25GaW5hbGx5KCkpLnRoZW4oZnVuY3Rpb24gKCkgeyB0aHJvdyBlOyB9KTtcbiAgICB9IDogb25GaW5hbGx5XG4gICk7XG59IH0pO1xuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///292\n")},function(module,exports,__webpack_require__){eval("__webpack_require__(294);\n__webpack_require__(295);\n__webpack_require__(296);\nmodule.exports = __webpack_require__(8);\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMjkzLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvd2ViL2luZGV4LmpzPzE3MTUiXSwic291cmNlc0NvbnRlbnQiOlsicmVxdWlyZSgnLi4vbW9kdWxlcy93ZWIudGltZXJzJyk7XG5yZXF1aXJlKCcuLi9tb2R1bGVzL3dlYi5pbW1lZGlhdGUnKTtcbnJlcXVpcmUoJy4uL21vZHVsZXMvd2ViLmRvbS5pdGVyYWJsZScpO1xubW9kdWxlLmV4cG9ydHMgPSByZXF1aXJlKCcuLi9tb2R1bGVzL19jb3JlJyk7XG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///293\n")},function(module,exports,__webpack_require__){eval("// ie9- setTimeout & setInterval additional parameters fix\nvar global = __webpack_require__(2);\nvar $export = __webpack_require__(1);\nvar userAgent = __webpack_require__(58);\nvar slice = [].slice;\nvar MSIE = /MSIE .\\./.test(userAgent); // <- dirty ie9- check\nvar wrap = function (set) {\n  return function (fn, time /* , ...args */) {\n    var boundArgs = arguments.length > 2;\n    var args = boundArgs ? slice.call(arguments, 2) : false;\n    return set(boundArgs ? function () {\n      // eslint-disable-next-line no-new-func\n      (typeof fn == 'function' ? fn : Function(fn)).apply(this, args);\n    } : fn, time);\n  };\n};\n$export($export.G + $export.B + $export.F * MSIE, {\n  setTimeout: wrap(global.setTimeout),\n  setInterval: wrap(global.setInterval)\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMjk0LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy93ZWIudGltZXJzLmpzPzQ3OTUiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gaWU5LSBzZXRUaW1lb3V0ICYgc2V0SW50ZXJ2YWwgYWRkaXRpb25hbCBwYXJhbWV0ZXJzIGZpeFxudmFyIGdsb2JhbCA9IHJlcXVpcmUoJy4vX2dsb2JhbCcpO1xudmFyICRleHBvcnQgPSByZXF1aXJlKCcuL19leHBvcnQnKTtcbnZhciB1c2VyQWdlbnQgPSByZXF1aXJlKCcuL191c2VyLWFnZW50Jyk7XG52YXIgc2xpY2UgPSBbXS5zbGljZTtcbnZhciBNU0lFID0gL01TSUUgLlxcLi8udGVzdCh1c2VyQWdlbnQpOyAvLyA8LSBkaXJ0eSBpZTktIGNoZWNrXG52YXIgd3JhcCA9IGZ1bmN0aW9uIChzZXQpIHtcbiAgcmV0dXJuIGZ1bmN0aW9uIChmbiwgdGltZSAvKiAsIC4uLmFyZ3MgKi8pIHtcbiAgICB2YXIgYm91bmRBcmdzID0gYXJndW1lbnRzLmxlbmd0aCA+IDI7XG4gICAgdmFyIGFyZ3MgPSBib3VuZEFyZ3MgPyBzbGljZS5jYWxsKGFyZ3VtZW50cywgMikgOiBmYWxzZTtcbiAgICByZXR1cm4gc2V0KGJvdW5kQXJncyA/IGZ1bmN0aW9uICgpIHtcbiAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1uZXctZnVuY1xuICAgICAgKHR5cGVvZiBmbiA9PSAnZnVuY3Rpb24nID8gZm4gOiBGdW5jdGlvbihmbikpLmFwcGx5KHRoaXMsIGFyZ3MpO1xuICAgIH0gOiBmbiwgdGltZSk7XG4gIH07XG59O1xuJGV4cG9ydCgkZXhwb3J0LkcgKyAkZXhwb3J0LkIgKyAkZXhwb3J0LkYgKiBNU0lFLCB7XG4gIHNldFRpbWVvdXQ6IHdyYXAoZ2xvYmFsLnNldFRpbWVvdXQpLFxuICBzZXRJbnRlcnZhbDogd3JhcChnbG9iYWwuc2V0SW50ZXJ2YWwpXG59KTtcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///294\n")},function(module,exports,__webpack_require__){eval("var $export = __webpack_require__(1);\nvar $task = __webpack_require__(84);\n$export($export.G + $export.B, {\n  setImmediate: $task.set,\n  clearImmediate: $task.clear\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMjk1LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy93ZWIuaW1tZWRpYXRlLmpzPzEzMGYiXSwic291cmNlc0NvbnRlbnQiOlsidmFyICRleHBvcnQgPSByZXF1aXJlKCcuL19leHBvcnQnKTtcbnZhciAkdGFzayA9IHJlcXVpcmUoJy4vX3Rhc2snKTtcbiRleHBvcnQoJGV4cG9ydC5HICsgJGV4cG9ydC5CLCB7XG4gIHNldEltbWVkaWF0ZTogJHRhc2suc2V0LFxuICBjbGVhckltbWVkaWF0ZTogJHRhc2suY2xlYXJcbn0pO1xuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Iiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///295\n")},function(module,exports,__webpack_require__){eval("var $iterators = __webpack_require__(81);\nvar getKeys = __webpack_require__(32);\nvar redefine = __webpack_require__(12);\nvar global = __webpack_require__(2);\nvar hide = __webpack_require__(15);\nvar Iterators = __webpack_require__(41);\nvar wks = __webpack_require__(6);\nvar ITERATOR = wks('iterator');\nvar TO_STRING_TAG = wks('toStringTag');\nvar ArrayValues = Iterators.Array;\n\nvar DOMIterables = {\n  CSSRuleList: true, // TODO: Not spec compliant, should be false.\n  CSSStyleDeclaration: false,\n  CSSValueList: false,\n  ClientRectList: false,\n  DOMRectList: false,\n  DOMStringList: false,\n  DOMTokenList: true,\n  DataTransferItemList: false,\n  FileList: false,\n  HTMLAllCollection: false,\n  HTMLCollection: false,\n  HTMLFormElement: false,\n  HTMLSelectElement: false,\n  MediaList: true, // TODO: Not spec compliant, should be false.\n  MimeTypeArray: false,\n  NamedNodeMap: false,\n  NodeList: true,\n  PaintRequestList: false,\n  Plugin: false,\n  PluginArray: false,\n  SVGLengthList: false,\n  SVGNumberList: false,\n  SVGPathSegList: false,\n  SVGPointList: false,\n  SVGStringList: false,\n  SVGTransformList: false,\n  SourceBufferList: false,\n  StyleSheetList: true, // TODO: Not spec compliant, should be false.\n  TextTrackCueList: false,\n  TextTrackList: false,\n  TouchList: false\n};\n\nfor (var collections = getKeys(DOMIterables), i = 0; i < collections.length; i++) {\n  var NAME = collections[i];\n  var explicit = DOMIterables[NAME];\n  var Collection = global[NAME];\n  var proto = Collection && Collection.prototype;\n  var key;\n  if (proto) {\n    if (!proto[ITERATOR]) hide(proto, ITERATOR, ArrayValues);\n    if (!proto[TO_STRING_TAG]) hide(proto, TO_STRING_TAG, NAME);\n    Iterators[NAME] = ArrayValues;\n    if (explicit) for (key in $iterators) if (!proto[key]) redefine(proto, key, $iterators[key], true);\n  }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMjk2LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy93ZWIuZG9tLml0ZXJhYmxlLmpzP2FjNmEiXSwic291cmNlc0NvbnRlbnQiOlsidmFyICRpdGVyYXRvcnMgPSByZXF1aXJlKCcuL2VzNi5hcnJheS5pdGVyYXRvcicpO1xudmFyIGdldEtleXMgPSByZXF1aXJlKCcuL19vYmplY3Qta2V5cycpO1xudmFyIHJlZGVmaW5lID0gcmVxdWlyZSgnLi9fcmVkZWZpbmUnKTtcbnZhciBnbG9iYWwgPSByZXF1aXJlKCcuL19nbG9iYWwnKTtcbnZhciBoaWRlID0gcmVxdWlyZSgnLi9faGlkZScpO1xudmFyIEl0ZXJhdG9ycyA9IHJlcXVpcmUoJy4vX2l0ZXJhdG9ycycpO1xudmFyIHdrcyA9IHJlcXVpcmUoJy4vX3drcycpO1xudmFyIElURVJBVE9SID0gd2tzKCdpdGVyYXRvcicpO1xudmFyIFRPX1NUUklOR19UQUcgPSB3a3MoJ3RvU3RyaW5nVGFnJyk7XG52YXIgQXJyYXlWYWx1ZXMgPSBJdGVyYXRvcnMuQXJyYXk7XG5cbnZhciBET01JdGVyYWJsZXMgPSB7XG4gIENTU1J1bGVMaXN0OiB0cnVlLCAvLyBUT0RPOiBOb3Qgc3BlYyBjb21wbGlhbnQsIHNob3VsZCBiZSBmYWxzZS5cbiAgQ1NTU3R5bGVEZWNsYXJhdGlvbjogZmFsc2UsXG4gIENTU1ZhbHVlTGlzdDogZmFsc2UsXG4gIENsaWVudFJlY3RMaXN0OiBmYWxzZSxcbiAgRE9NUmVjdExpc3Q6IGZhbHNlLFxuICBET01TdHJpbmdMaXN0OiBmYWxzZSxcbiAgRE9NVG9rZW5MaXN0OiB0cnVlLFxuICBEYXRhVHJhbnNmZXJJdGVtTGlzdDogZmFsc2UsXG4gIEZpbGVMaXN0OiBmYWxzZSxcbiAgSFRNTEFsbENvbGxlY3Rpb246IGZhbHNlLFxuICBIVE1MQ29sbGVjdGlvbjogZmFsc2UsXG4gIEhUTUxGb3JtRWxlbWVudDogZmFsc2UsXG4gIEhUTUxTZWxlY3RFbGVtZW50OiBmYWxzZSxcbiAgTWVkaWFMaXN0OiB0cnVlLCAvLyBUT0RPOiBOb3Qgc3BlYyBjb21wbGlhbnQsIHNob3VsZCBiZSBmYWxzZS5cbiAgTWltZVR5cGVBcnJheTogZmFsc2UsXG4gIE5hbWVkTm9kZU1hcDogZmFsc2UsXG4gIE5vZGVMaXN0OiB0cnVlLFxuICBQYWludFJlcXVlc3RMaXN0OiBmYWxzZSxcbiAgUGx1Z2luOiBmYWxzZSxcbiAgUGx1Z2luQXJyYXk6IGZhbHNlLFxuICBTVkdMZW5ndGhMaXN0OiBmYWxzZSxcbiAgU1ZHTnVtYmVyTGlzdDogZmFsc2UsXG4gIFNWR1BhdGhTZWdMaXN0OiBmYWxzZSxcbiAgU1ZHUG9pbnRMaXN0OiBmYWxzZSxcbiAgU1ZHU3RyaW5nTGlzdDogZmFsc2UsXG4gIFNWR1RyYW5zZm9ybUxpc3Q6IGZhbHNlLFxuICBTb3VyY2VCdWZmZXJMaXN0OiBmYWxzZSxcbiAgU3R5bGVTaGVldExpc3Q6IHRydWUsIC8vIFRPRE86IE5vdCBzcGVjIGNvbXBsaWFudCwgc2hvdWxkIGJlIGZhbHNlLlxuICBUZXh0VHJhY2tDdWVMaXN0OiBmYWxzZSxcbiAgVGV4dFRyYWNrTGlzdDogZmFsc2UsXG4gIFRvdWNoTGlzdDogZmFsc2Vcbn07XG5cbmZvciAodmFyIGNvbGxlY3Rpb25zID0gZ2V0S2V5cyhET01JdGVyYWJsZXMpLCBpID0gMDsgaSA8IGNvbGxlY3Rpb25zLmxlbmd0aDsgaSsrKSB7XG4gIHZhciBOQU1FID0gY29sbGVjdGlvbnNbaV07XG4gIHZhciBleHBsaWNpdCA9IERPTUl0ZXJhYmxlc1tOQU1FXTtcbiAgdmFyIENvbGxlY3Rpb24gPSBnbG9iYWxbTkFNRV07XG4gIHZhciBwcm90byA9IENvbGxlY3Rpb24gJiYgQ29sbGVjdGlvbi5wcm90b3R5cGU7XG4gIHZhciBrZXk7XG4gIGlmIChwcm90bykge1xuICAgIGlmICghcHJvdG9bSVRFUkFUT1JdKSBoaWRlKHByb3RvLCBJVEVSQVRPUiwgQXJyYXlWYWx1ZXMpO1xuICAgIGlmICghcHJvdG9bVE9fU1RSSU5HX1RBR10pIGhpZGUocHJvdG8sIFRPX1NUUklOR19UQUcsIE5BTUUpO1xuICAgIEl0ZXJhdG9yc1tOQU1FXSA9IEFycmF5VmFsdWVzO1xuICAgIGlmIChleHBsaWNpdCkgZm9yIChrZXkgaW4gJGl0ZXJhdG9ycykgaWYgKCFwcm90b1trZXldKSByZWRlZmluZShwcm90bywga2V5LCAkaXRlcmF0b3JzW2tleV0sIHRydWUpO1xuICB9XG59XG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///296\n")},function(module,exports,__webpack_require__){eval('/**\n * Copyright (c) 2014-present, Facebook, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\nvar runtime = (function (exports) {\n  "use strict";\n\n  var Op = Object.prototype;\n  var hasOwn = Op.hasOwnProperty;\n  var undefined; // More compressible than void 0.\n  var $Symbol = typeof Symbol === "function" ? Symbol : {};\n  var iteratorSymbol = $Symbol.iterator || "@@iterator";\n  var asyncIteratorSymbol = $Symbol.asyncIterator || "@@asyncIterator";\n  var toStringTagSymbol = $Symbol.toStringTag || "@@toStringTag";\n\n  function wrap(innerFn, outerFn, self, tryLocsList) {\n    // If outerFn provided and outerFn.prototype is a Generator, then outerFn.prototype instanceof Generator.\n    var protoGenerator = outerFn && outerFn.prototype instanceof Generator ? outerFn : Generator;\n    var generator = Object.create(protoGenerator.prototype);\n    var context = new Context(tryLocsList || []);\n\n    // The ._invoke method unifies the implementations of the .next,\n    // .throw, and .return methods.\n    generator._invoke = makeInvokeMethod(innerFn, self, context);\n\n    return generator;\n  }\n  exports.wrap = wrap;\n\n  // Try/catch helper to minimize deoptimizations. Returns a completion\n  // record like context.tryEntries[i].completion. This interface could\n  // have been (and was previously) designed to take a closure to be\n  // invoked without arguments, but in all the cases we care about we\n  // already have an existing method we want to call, so there\'s no need\n  // to create a new function object. We can even get away with assuming\n  // the method takes exactly one argument, since that happens to be true\n  // in every case, so we don\'t have to touch the arguments object. The\n  // only additional allocation required is the completion record, which\n  // has a stable shape and so hopefully should be cheap to allocate.\n  function tryCatch(fn, obj, arg) {\n    try {\n      return { type: "normal", arg: fn.call(obj, arg) };\n    } catch (err) {\n      return { type: "throw", arg: err };\n    }\n  }\n\n  var GenStateSuspendedStart = "suspendedStart";\n  var GenStateSuspendedYield = "suspendedYield";\n  var GenStateExecuting = "executing";\n  var GenStateCompleted = "completed";\n\n  // Returning this object from the innerFn has the same effect as\n  // breaking out of the dispatch switch statement.\n  var ContinueSentinel = {};\n\n  // Dummy constructor functions that we use as the .constructor and\n  // .constructor.prototype properties for functions that return Generator\n  // objects. For full spec compliance, you may wish to configure your\n  // minifier not to mangle the names of these two functions.\n  function Generator() {}\n  function GeneratorFunction() {}\n  function GeneratorFunctionPrototype() {}\n\n  // This is a polyfill for %IteratorPrototype% for environments that\n  // don\'t natively support it.\n  var IteratorPrototype = {};\n  IteratorPrototype[iteratorSymbol] = function () {\n    return this;\n  };\n\n  var getProto = Object.getPrototypeOf;\n  var NativeIteratorPrototype = getProto && getProto(getProto(values([])));\n  if (NativeIteratorPrototype &&\n      NativeIteratorPrototype !== Op &&\n      hasOwn.call(NativeIteratorPrototype, iteratorSymbol)) {\n    // This environment has a native %IteratorPrototype%; use it instead\n    // of the polyfill.\n    IteratorPrototype = NativeIteratorPrototype;\n  }\n\n  var Gp = GeneratorFunctionPrototype.prototype =\n    Generator.prototype = Object.create(IteratorPrototype);\n  GeneratorFunction.prototype = Gp.constructor = GeneratorFunctionPrototype;\n  GeneratorFunctionPrototype.constructor = GeneratorFunction;\n  GeneratorFunctionPrototype[toStringTagSymbol] =\n    GeneratorFunction.displayName = "GeneratorFunction";\n\n  // Helper for defining the .next, .throw, and .return methods of the\n  // Iterator interface in terms of a single ._invoke method.\n  function defineIteratorMethods(prototype) {\n    ["next", "throw", "return"].forEach(function(method) {\n      prototype[method] = function(arg) {\n        return this._invoke(method, arg);\n      };\n    });\n  }\n\n  exports.isGeneratorFunction = function(genFun) {\n    var ctor = typeof genFun === "function" && genFun.constructor;\n    return ctor\n      ? ctor === GeneratorFunction ||\n        // For the native GeneratorFunction constructor, the best we can\n        // do is to check its .name property.\n        (ctor.displayName || ctor.name) === "GeneratorFunction"\n      : false;\n  };\n\n  exports.mark = function(genFun) {\n    if (Object.setPrototypeOf) {\n      Object.setPrototypeOf(genFun, GeneratorFunctionPrototype);\n    } else {\n      genFun.__proto__ = GeneratorFunctionPrototype;\n      if (!(toStringTagSymbol in genFun)) {\n        genFun[toStringTagSymbol] = "GeneratorFunction";\n      }\n    }\n    genFun.prototype = Object.create(Gp);\n    return genFun;\n  };\n\n  // Within the body of any async function, `await x` is transformed to\n  // `yield regeneratorRuntime.awrap(x)`, so that the runtime can test\n  // `hasOwn.call(value, "__await")` to determine if the yielded value is\n  // meant to be awaited.\n  exports.awrap = function(arg) {\n    return { __await: arg };\n  };\n\n  function AsyncIterator(generator) {\n    function invoke(method, arg, resolve, reject) {\n      var record = tryCatch(generator[method], generator, arg);\n      if (record.type === "throw") {\n        reject(record.arg);\n      } else {\n        var result = record.arg;\n        var value = result.value;\n        if (value &&\n            typeof value === "object" &&\n            hasOwn.call(value, "__await")) {\n          return Promise.resolve(value.__await).then(function(value) {\n            invoke("next", value, resolve, reject);\n          }, function(err) {\n            invoke("throw", err, resolve, reject);\n          });\n        }\n\n        return Promise.resolve(value).then(function(unwrapped) {\n          // When a yielded Promise is resolved, its final value becomes\n          // the .value of the Promise<{value,done}> result for the\n          // current iteration.\n          result.value = unwrapped;\n          resolve(result);\n        }, function(error) {\n          // If a rejected Promise was yielded, throw the rejection back\n          // into the async generator function so it can be handled there.\n          return invoke("throw", error, resolve, reject);\n        });\n      }\n    }\n\n    var previousPromise;\n\n    function enqueue(method, arg) {\n      function callInvokeWithMethodAndArg() {\n        return new Promise(function(resolve, reject) {\n          invoke(method, arg, resolve, reject);\n        });\n      }\n\n      return previousPromise =\n        // If enqueue has been called before, then we want to wait until\n        // all previous Promises have been resolved before calling invoke,\n        // so that results are always delivered in the correct order. If\n        // enqueue has not been called before, then it is important to\n        // call invoke immediately, without waiting on a callback to fire,\n        // so that the async generator function has the opportunity to do\n        // any necessary setup in a predictable way. This predictability\n        // is why the Promise constructor synchronously invokes its\n        // executor callback, and why async functions synchronously\n        // execute code before the first await. Since we implement simple\n        // async functions in terms of async generators, it is especially\n        // important to get this right, even though it requires care.\n        previousPromise ? previousPromise.then(\n          callInvokeWithMethodAndArg,\n          // Avoid propagating failures to Promises returned by later\n          // invocations of the iterator.\n          callInvokeWithMethodAndArg\n        ) : callInvokeWithMethodAndArg();\n    }\n\n    // Define the unified helper method that is used to implement .next,\n    // .throw, and .return (see defineIteratorMethods).\n    this._invoke = enqueue;\n  }\n\n  defineIteratorMethods(AsyncIterator.prototype);\n  AsyncIterator.prototype[asyncIteratorSymbol] = function () {\n    return this;\n  };\n  exports.AsyncIterator = AsyncIterator;\n\n  // Note that simple async functions are implemented on top of\n  // AsyncIterator objects; they just return a Promise for the value of\n  // the final result produced by the iterator.\n  exports.async = function(innerFn, outerFn, self, tryLocsList) {\n    var iter = new AsyncIterator(\n      wrap(innerFn, outerFn, self, tryLocsList)\n    );\n\n    return exports.isGeneratorFunction(outerFn)\n      ? iter // If outerFn is a generator, return the full iterator.\n      : iter.next().then(function(result) {\n          return result.done ? result.value : iter.next();\n        });\n  };\n\n  function makeInvokeMethod(innerFn, self, context) {\n    var state = GenStateSuspendedStart;\n\n    return function invoke(method, arg) {\n      if (state === GenStateExecuting) {\n        throw new Error("Generator is already running");\n      }\n\n      if (state === GenStateCompleted) {\n        if (method === "throw") {\n          throw arg;\n        }\n\n        // Be forgiving, per 25.3.3.3.3 of the spec:\n        // https://people.mozilla.org/~jorendorff/es6-draft.html#sec-generatorresume\n        return doneResult();\n      }\n\n      context.method = method;\n      context.arg = arg;\n\n      while (true) {\n        var delegate = context.delegate;\n        if (delegate) {\n          var delegateResult = maybeInvokeDelegate(delegate, context);\n          if (delegateResult) {\n            if (delegateResult === ContinueSentinel) continue;\n            return delegateResult;\n          }\n        }\n\n        if (context.method === "next") {\n          // Setting context._sent for legacy support of Babel\'s\n          // function.sent implementation.\n          context.sent = context._sent = context.arg;\n\n        } else if (context.method === "throw") {\n          if (state === GenStateSuspendedStart) {\n            state = GenStateCompleted;\n            throw context.arg;\n          }\n\n          context.dispatchException(context.arg);\n\n        } else if (context.method === "return") {\n          context.abrupt("return", context.arg);\n        }\n\n        state = GenStateExecuting;\n\n        var record = tryCatch(innerFn, self, context);\n        if (record.type === "normal") {\n          // If an exception is thrown from innerFn, we leave state ===\n          // GenStateExecuting and loop back for another invocation.\n          state = context.done\n            ? GenStateCompleted\n            : GenStateSuspendedYield;\n\n          if (record.arg === ContinueSentinel) {\n            continue;\n          }\n\n          return {\n            value: record.arg,\n            done: context.done\n          };\n\n        } else if (record.type === "throw") {\n          state = GenStateCompleted;\n          // Dispatch the exception by looping back around to the\n          // context.dispatchException(context.arg) call above.\n          context.method = "throw";\n          context.arg = record.arg;\n        }\n      }\n    };\n  }\n\n  // Call delegate.iterator[context.method](context.arg) and handle the\n  // result, either by returning a { value, done } result from the\n  // delegate iterator, or by modifying context.method and context.arg,\n  // setting context.delegate to null, and returning the ContinueSentinel.\n  function maybeInvokeDelegate(delegate, context) {\n    var method = delegate.iterator[context.method];\n    if (method === undefined) {\n      // A .throw or .return when the delegate iterator has no .throw\n      // method always terminates the yield* loop.\n      context.delegate = null;\n\n      if (context.method === "throw") {\n        // Note: ["return"] must be used for ES3 parsing compatibility.\n        if (delegate.iterator["return"]) {\n          // If the delegate iterator has a return method, give it a\n          // chance to clean up.\n          context.method = "return";\n          context.arg = undefined;\n          maybeInvokeDelegate(delegate, context);\n\n          if (context.method === "throw") {\n            // If maybeInvokeDelegate(context) changed context.method from\n            // "return" to "throw", let that override the TypeError below.\n            return ContinueSentinel;\n          }\n        }\n\n        context.method = "throw";\n        context.arg = new TypeError(\n          "The iterator does not provide a \'throw\' method");\n      }\n\n      return ContinueSentinel;\n    }\n\n    var record = tryCatch(method, delegate.iterator, context.arg);\n\n    if (record.type === "throw") {\n      context.method = "throw";\n      context.arg = record.arg;\n      context.delegate = null;\n      return ContinueSentinel;\n    }\n\n    var info = record.arg;\n\n    if (! info) {\n      context.method = "throw";\n      context.arg = new TypeError("iterator result is not an object");\n      context.delegate = null;\n      return ContinueSentinel;\n    }\n\n    if (info.done) {\n      // Assign the result of the finished delegate to the temporary\n      // variable specified by delegate.resultName (see delegateYield).\n      context[delegate.resultName] = info.value;\n\n      // Resume execution at the desired location (see delegateYield).\n      context.next = delegate.nextLoc;\n\n      // If context.method was "throw" but the delegate handled the\n      // exception, let the outer generator proceed normally. If\n      // context.method was "next", forget context.arg since it has been\n      // "consumed" by the delegate iterator. If context.method was\n      // "return", allow the original .return call to continue in the\n      // outer generator.\n      if (context.method !== "return") {\n        context.method = "next";\n        context.arg = undefined;\n      }\n\n    } else {\n      // Re-yield the result returned by the delegate method.\n      return info;\n    }\n\n    // The delegate iterator is finished, so forget it and continue with\n    // the outer generator.\n    context.delegate = null;\n    return ContinueSentinel;\n  }\n\n  // Define Generator.prototype.{next,throw,return} in terms of the\n  // unified ._invoke helper method.\n  defineIteratorMethods(Gp);\n\n  Gp[toStringTagSymbol] = "Generator";\n\n  // A Generator should always return itself as the iterator object when the\n  // @@iterator function is called on it. Some browsers\' implementations of the\n  // iterator prototype chain incorrectly implement this, causing the Generator\n  // object to not be returned from this call. This ensures that doesn\'t happen.\n  // See https://github.com/facebook/regenerator/issues/274 for more details.\n  Gp[iteratorSymbol] = function() {\n    return this;\n  };\n\n  Gp.toString = function() {\n    return "[object Generator]";\n  };\n\n  function pushTryEntry(locs) {\n    var entry = { tryLoc: locs[0] };\n\n    if (1 in locs) {\n      entry.catchLoc = locs[1];\n    }\n\n    if (2 in locs) {\n      entry.finallyLoc = locs[2];\n      entry.afterLoc = locs[3];\n    }\n\n    this.tryEntries.push(entry);\n  }\n\n  function resetTryEntry(entry) {\n    var record = entry.completion || {};\n    record.type = "normal";\n    delete record.arg;\n    entry.completion = record;\n  }\n\n  function Context(tryLocsList) {\n    // The root entry object (effectively a try statement without a catch\n    // or a finally block) gives us a place to store values thrown from\n    // locations where there is no enclosing try statement.\n    this.tryEntries = [{ tryLoc: "root" }];\n    tryLocsList.forEach(pushTryEntry, this);\n    this.reset(true);\n  }\n\n  exports.keys = function(object) {\n    var keys = [];\n    for (var key in object) {\n      keys.push(key);\n    }\n    keys.reverse();\n\n    // Rather than returning an object with a next method, we keep\n    // things simple and return the next function itself.\n    return function next() {\n      while (keys.length) {\n        var key = keys.pop();\n        if (key in object) {\n          next.value = key;\n          next.done = false;\n          return next;\n        }\n      }\n\n      // To avoid creating an additional object, we just hang the .value\n      // and .done properties off the next function object itself. This\n      // also ensures that the minifier will not anonymize the function.\n      next.done = true;\n      return next;\n    };\n  };\n\n  function values(iterable) {\n    if (iterable) {\n      var iteratorMethod = iterable[iteratorSymbol];\n      if (iteratorMethod) {\n        return iteratorMethod.call(iterable);\n      }\n\n      if (typeof iterable.next === "function") {\n        return iterable;\n      }\n\n      if (!isNaN(iterable.length)) {\n        var i = -1, next = function next() {\n          while (++i < iterable.length) {\n            if (hasOwn.call(iterable, i)) {\n              next.value = iterable[i];\n              next.done = false;\n              return next;\n            }\n          }\n\n          next.value = undefined;\n          next.done = true;\n\n          return next;\n        };\n\n        return next.next = next;\n      }\n    }\n\n    // Return an iterator with no values.\n    return { next: doneResult };\n  }\n  exports.values = values;\n\n  function doneResult() {\n    return { value: undefined, done: true };\n  }\n\n  Context.prototype = {\n    constructor: Context,\n\n    reset: function(skipTempReset) {\n      this.prev = 0;\n      this.next = 0;\n      // Resetting context._sent for legacy support of Babel\'s\n      // function.sent implementation.\n      this.sent = this._sent = undefined;\n      this.done = false;\n      this.delegate = null;\n\n      this.method = "next";\n      this.arg = undefined;\n\n      this.tryEntries.forEach(resetTryEntry);\n\n      if (!skipTempReset) {\n        for (var name in this) {\n          // Not sure about the optimal order of these conditions:\n          if (name.charAt(0) === "t" &&\n              hasOwn.call(this, name) &&\n              !isNaN(+name.slice(1))) {\n            this[name] = undefined;\n          }\n        }\n      }\n    },\n\n    stop: function() {\n      this.done = true;\n\n      var rootEntry = this.tryEntries[0];\n      var rootRecord = rootEntry.completion;\n      if (rootRecord.type === "throw") {\n        throw rootRecord.arg;\n      }\n\n      return this.rval;\n    },\n\n    dispatchException: function(exception) {\n      if (this.done) {\n        throw exception;\n      }\n\n      var context = this;\n      function handle(loc, caught) {\n        record.type = "throw";\n        record.arg = exception;\n        context.next = loc;\n\n        if (caught) {\n          // If the dispatched exception was caught by a catch block,\n          // then let that catch block handle the exception normally.\n          context.method = "next";\n          context.arg = undefined;\n        }\n\n        return !! caught;\n      }\n\n      for (var i = this.tryEntries.length - 1; i >= 0; --i) {\n        var entry = this.tryEntries[i];\n        var record = entry.completion;\n\n        if (entry.tryLoc === "root") {\n          // Exception thrown outside of any try block that could handle\n          // it, so set the completion value of the entire function to\n          // throw the exception.\n          return handle("end");\n        }\n\n        if (entry.tryLoc <= this.prev) {\n          var hasCatch = hasOwn.call(entry, "catchLoc");\n          var hasFinally = hasOwn.call(entry, "finallyLoc");\n\n          if (hasCatch && hasFinally) {\n            if (this.prev < entry.catchLoc) {\n              return handle(entry.catchLoc, true);\n            } else if (this.prev < entry.finallyLoc) {\n              return handle(entry.finallyLoc);\n            }\n\n          } else if (hasCatch) {\n            if (this.prev < entry.catchLoc) {\n              return handle(entry.catchLoc, true);\n            }\n\n          } else if (hasFinally) {\n            if (this.prev < entry.finallyLoc) {\n              return handle(entry.finallyLoc);\n            }\n\n          } else {\n            throw new Error("try statement without catch or finally");\n          }\n        }\n      }\n    },\n\n    abrupt: function(type, arg) {\n      for (var i = this.tryEntries.length - 1; i >= 0; --i) {\n        var entry = this.tryEntries[i];\n        if (entry.tryLoc <= this.prev &&\n            hasOwn.call(entry, "finallyLoc") &&\n            this.prev < entry.finallyLoc) {\n          var finallyEntry = entry;\n          break;\n        }\n      }\n\n      if (finallyEntry &&\n          (type === "break" ||\n           type === "continue") &&\n          finallyEntry.tryLoc <= arg &&\n          arg <= finallyEntry.finallyLoc) {\n        // Ignore the finally entry if control is not jumping to a\n        // location outside the try/catch block.\n        finallyEntry = null;\n      }\n\n      var record = finallyEntry ? finallyEntry.completion : {};\n      record.type = type;\n      record.arg = arg;\n\n      if (finallyEntry) {\n        this.method = "next";\n        this.next = finallyEntry.finallyLoc;\n        return ContinueSentinel;\n      }\n\n      return this.complete(record);\n    },\n\n    complete: function(record, afterLoc) {\n      if (record.type === "throw") {\n        throw record.arg;\n      }\n\n      if (record.type === "break" ||\n          record.type === "continue") {\n        this.next = record.arg;\n      } else if (record.type === "return") {\n        this.rval = this.arg = record.arg;\n        this.method = "return";\n        this.next = "end";\n      } else if (record.type === "normal" && afterLoc) {\n        this.next = afterLoc;\n      }\n\n      return ContinueSentinel;\n    },\n\n    finish: function(finallyLoc) {\n      for (var i = this.tryEntries.length - 1; i >= 0; --i) {\n        var entry = this.tryEntries[i];\n        if (entry.finallyLoc === finallyLoc) {\n          this.complete(entry.completion, entry.afterLoc);\n          resetTryEntry(entry);\n          return ContinueSentinel;\n        }\n      }\n    },\n\n    "catch": function(tryLoc) {\n      for (var i = this.tryEntries.length - 1; i >= 0; --i) {\n        var entry = this.tryEntries[i];\n        if (entry.tryLoc === tryLoc) {\n          var record = entry.completion;\n          if (record.type === "throw") {\n            var thrown = record.arg;\n            resetTryEntry(entry);\n          }\n          return thrown;\n        }\n      }\n\n      // The context.catch method must only be called with a location\n      // argument that corresponds to a known catch block.\n      throw new Error("illegal catch attempt");\n    },\n\n    delegateYield: function(iterable, resultName, nextLoc) {\n      this.delegate = {\n        iterator: values(iterable),\n        resultName: resultName,\n        nextLoc: nextLoc\n      };\n\n      if (this.method === "next") {\n        // Deliberately forget the last sent value so that we don\'t\n        // accidentally pass it on to the delegate.\n        this.arg = undefined;\n      }\n\n      return ContinueSentinel;\n    }\n  };\n\n  // Regardless of whether this script is executing as a CommonJS module\n  // or not, return the runtime object so that we can declare the variable\n  // regeneratorRuntime in the outer scope, which allows this module to be\n  // injected easily by `bin/regenerator --include-runtime script.js`.\n  return exports;\n\n}(\n  // If this script is executing as a CommonJS module, use module.exports\n  // as the regeneratorRuntime namespace. Otherwise create a new empty\n  // object. Either way, the resulting object will be used to initialize\n  // the regeneratorRuntime variable at the top of this file.\n   true ? module.exports : undefined\n));\n\ntry {\n  regeneratorRuntime = runtime;\n} catch (accidentalStrictMode) {\n  // This module should not be running in strict mode, so the above\n  // assignment should always work unless something is misconfigured. Just\n  // in case runtime.js accidentally runs in strict mode, we can escape\n  // strict mode using a global Function call. This could conceivably fail\n  // if a Content Security Policy forbids using Function, but in that case\n  // the proper solution is to fix the accidental strict mode problem. If\n  // you\'ve misconfigured your bundler to force strict mode and applied a\n  // CSP to forbid Function, and you\'re not willing to fix either of those\n  // problems, please detail your unique predicament in a GitHub issue.\n  Function("r", "regeneratorRuntime = r")(runtime);\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMjk3LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL3JlZ2VuZXJhdG9yLXJ1bnRpbWUvcnVudGltZS5qcz85NmNmIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQ29weXJpZ2h0IChjKSAyMDE0LXByZXNlbnQsIEZhY2Vib29rLCBJbmMuXG4gKlxuICogVGhpcyBzb3VyY2UgY29kZSBpcyBsaWNlbnNlZCB1bmRlciB0aGUgTUlUIGxpY2Vuc2UgZm91bmQgaW4gdGhlXG4gKiBMSUNFTlNFIGZpbGUgaW4gdGhlIHJvb3QgZGlyZWN0b3J5IG9mIHRoaXMgc291cmNlIHRyZWUuXG4gKi9cblxudmFyIHJ1bnRpbWUgPSAoZnVuY3Rpb24gKGV4cG9ydHMpIHtcbiAgXCJ1c2Ugc3RyaWN0XCI7XG5cbiAgdmFyIE9wID0gT2JqZWN0LnByb3RvdHlwZTtcbiAgdmFyIGhhc093biA9IE9wLmhhc093blByb3BlcnR5O1xuICB2YXIgdW5kZWZpbmVkOyAvLyBNb3JlIGNvbXByZXNzaWJsZSB0aGFuIHZvaWQgMC5cbiAgdmFyICRTeW1ib2wgPSB0eXBlb2YgU3ltYm9sID09PSBcImZ1bmN0aW9uXCIgPyBTeW1ib2wgOiB7fTtcbiAgdmFyIGl0ZXJhdG9yU3ltYm9sID0gJFN5bWJvbC5pdGVyYXRvciB8fCBcIkBAaXRlcmF0b3JcIjtcbiAgdmFyIGFzeW5jSXRlcmF0b3JTeW1ib2wgPSAkU3ltYm9sLmFzeW5jSXRlcmF0b3IgfHwgXCJAQGFzeW5jSXRlcmF0b3JcIjtcbiAgdmFyIHRvU3RyaW5nVGFnU3ltYm9sID0gJFN5bWJvbC50b1N0cmluZ1RhZyB8fCBcIkBAdG9TdHJpbmdUYWdcIjtcblxuICBmdW5jdGlvbiB3cmFwKGlubmVyRm4sIG91dGVyRm4sIHNlbGYsIHRyeUxvY3NMaXN0KSB7XG4gICAgLy8gSWYgb3V0ZXJGbiBwcm92aWRlZCBhbmQgb3V0ZXJGbi5wcm90b3R5cGUgaXMgYSBHZW5lcmF0b3IsIHRoZW4gb3V0ZXJGbi5wcm90b3R5cGUgaW5zdGFuY2VvZiBHZW5lcmF0b3IuXG4gICAgdmFyIHByb3RvR2VuZXJhdG9yID0gb3V0ZXJGbiAmJiBvdXRlckZuLnByb3RvdHlwZSBpbnN0YW5jZW9mIEdlbmVyYXRvciA/IG91dGVyRm4gOiBHZW5lcmF0b3I7XG4gICAgdmFyIGdlbmVyYXRvciA9IE9iamVjdC5jcmVhdGUocHJvdG9HZW5lcmF0b3IucHJvdG90eXBlKTtcbiAgICB2YXIgY29udGV4dCA9IG5ldyBDb250ZXh0KHRyeUxvY3NMaXN0IHx8IFtdKTtcblxuICAgIC8vIFRoZSAuX2ludm9rZSBtZXRob2QgdW5pZmllcyB0aGUgaW1wbGVtZW50YXRpb25zIG9mIHRoZSAubmV4dCxcbiAgICAvLyAudGhyb3csIGFuZCAucmV0dXJuIG1ldGhvZHMuXG4gICAgZ2VuZXJhdG9yLl9pbnZva2UgPSBtYWtlSW52b2tlTWV0aG9kKGlubmVyRm4sIHNlbGYsIGNvbnRleHQpO1xuXG4gICAgcmV0dXJuIGdlbmVyYXRvcjtcbiAgfVxuICBleHBvcnRzLndyYXAgPSB3cmFwO1xuXG4gIC8vIFRyeS9jYXRjaCBoZWxwZXIgdG8gbWluaW1pemUgZGVvcHRpbWl6YXRpb25zLiBSZXR1cm5zIGEgY29tcGxldGlvblxuICAvLyByZWNvcmQgbGlrZSBjb250ZXh0LnRyeUVudHJpZXNbaV0uY29tcGxldGlvbi4gVGhpcyBpbnRlcmZhY2UgY291bGRcbiAgLy8gaGF2ZSBiZWVuIChhbmQgd2FzIHByZXZpb3VzbHkpIGRlc2lnbmVkIHRvIHRha2UgYSBjbG9zdXJlIHRvIGJlXG4gIC8vIGludm9rZWQgd2l0aG91dCBhcmd1bWVudHMsIGJ1dCBpbiBhbGwgdGhlIGNhc2VzIHdlIGNhcmUgYWJvdXQgd2VcbiAgLy8gYWxyZWFkeSBoYXZlIGFuIGV4aXN0aW5nIG1ldGhvZCB3ZSB3YW50IHRvIGNhbGwsIHNvIHRoZXJlJ3Mgbm8gbmVlZFxuICAvLyB0byBjcmVhdGUgYSBuZXcgZnVuY3Rpb24gb2JqZWN0LiBXZSBjYW4gZXZlbiBnZXQgYXdheSB3aXRoIGFzc3VtaW5nXG4gIC8vIHRoZSBtZXRob2QgdGFrZXMgZXhhY3RseSBvbmUgYXJndW1lbnQsIHNpbmNlIHRoYXQgaGFwcGVucyB0byBiZSB0cnVlXG4gIC8vIGluIGV2ZXJ5IGNhc2UsIHNvIHdlIGRvbid0IGhhdmUgdG8gdG91Y2ggdGhlIGFyZ3VtZW50cyBvYmplY3QuIFRoZVxuICAvLyBvbmx5IGFkZGl0aW9uYWwgYWxsb2NhdGlvbiByZXF1aXJlZCBpcyB0aGUgY29tcGxldGlvbiByZWNvcmQsIHdoaWNoXG4gIC8vIGhhcyBhIHN0YWJsZSBzaGFwZSBhbmQgc28gaG9wZWZ1bGx5IHNob3VsZCBiZSBjaGVhcCB0byBhbGxvY2F0ZS5cbiAgZnVuY3Rpb24gdHJ5Q2F0Y2goZm4sIG9iaiwgYXJnKSB7XG4gICAgdHJ5IHtcbiAgICAgIHJldHVybiB7IHR5cGU6IFwibm9ybWFsXCIsIGFyZzogZm4uY2FsbChvYmosIGFyZykgfTtcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIHJldHVybiB7IHR5cGU6IFwidGhyb3dcIiwgYXJnOiBlcnIgfTtcbiAgICB9XG4gIH1cblxuICB2YXIgR2VuU3RhdGVTdXNwZW5kZWRTdGFydCA9IFwic3VzcGVuZGVkU3RhcnRcIjtcbiAgdmFyIEdlblN0YXRlU3VzcGVuZGVkWWllbGQgPSBcInN1c3BlbmRlZFlpZWxkXCI7XG4gIHZhciBHZW5TdGF0ZUV4ZWN1dGluZyA9IFwiZXhlY3V0aW5nXCI7XG4gIHZhciBHZW5TdGF0ZUNvbXBsZXRlZCA9IFwiY29tcGxldGVkXCI7XG5cbiAgLy8gUmV0dXJuaW5nIHRoaXMgb2JqZWN0IGZyb20gdGhlIGlubmVyRm4gaGFzIHRoZSBzYW1lIGVmZmVjdCBhc1xuICAvLyBicmVha2luZyBvdXQgb2YgdGhlIGRpc3BhdGNoIHN3aXRjaCBzdGF0ZW1lbnQuXG4gIHZhciBDb250aW51ZVNlbnRpbmVsID0ge307XG5cbiAgLy8gRHVtbXkgY29uc3RydWN0b3IgZnVuY3Rpb25zIHRoYXQgd2UgdXNlIGFzIHRoZSAuY29uc3RydWN0b3IgYW5kXG4gIC8vIC5jb25zdHJ1Y3Rvci5wcm90b3R5cGUgcHJvcGVydGllcyBmb3IgZnVuY3Rpb25zIHRoYXQgcmV0dXJuIEdlbmVyYXRvclxuICAvLyBvYmplY3RzLiBGb3IgZnVsbCBzcGVjIGNvbXBsaWFuY2UsIHlvdSBtYXkgd2lzaCB0byBjb25maWd1cmUgeW91clxuICAvLyBtaW5pZmllciBub3QgdG8gbWFuZ2xlIHRoZSBuYW1lcyBvZiB0aGVzZSB0d28gZnVuY3Rpb25zLlxuICBmdW5jdGlvbiBHZW5lcmF0b3IoKSB7fVxuICBmdW5jdGlvbiBHZW5lcmF0b3JGdW5jdGlvbigpIHt9XG4gIGZ1bmN0aW9uIEdlbmVyYXRvckZ1bmN0aW9uUHJvdG90eXBlKCkge31cblxuICAvLyBUaGlzIGlzIGEgcG9seWZpbGwgZm9yICVJdGVyYXRvclByb3RvdHlwZSUgZm9yIGVudmlyb25tZW50cyB0aGF0XG4gIC8vIGRvbid0IG5hdGl2ZWx5IHN1cHBvcnQgaXQuXG4gIHZhciBJdGVyYXRvclByb3RvdHlwZSA9IHt9O1xuICBJdGVyYXRvclByb3RvdHlwZVtpdGVyYXRvclN5bWJvbF0gPSBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH07XG5cbiAgdmFyIGdldFByb3RvID0gT2JqZWN0LmdldFByb3RvdHlwZU9mO1xuICB2YXIgTmF0aXZlSXRlcmF0b3JQcm90b3R5cGUgPSBnZXRQcm90byAmJiBnZXRQcm90byhnZXRQcm90byh2YWx1ZXMoW10pKSk7XG4gIGlmIChOYXRpdmVJdGVyYXRvclByb3RvdHlwZSAmJlxuICAgICAgTmF0aXZlSXRlcmF0b3JQcm90b3R5cGUgIT09IE9wICYmXG4gICAgICBoYXNPd24uY2FsbChOYXRpdmVJdGVyYXRvclByb3RvdHlwZSwgaXRlcmF0b3JTeW1ib2wpKSB7XG4gICAgLy8gVGhpcyBlbnZpcm9ubWVudCBoYXMgYSBuYXRpdmUgJUl0ZXJhdG9yUHJvdG90eXBlJTsgdXNlIGl0IGluc3RlYWRcbiAgICAvLyBvZiB0aGUgcG9seWZpbGwuXG4gICAgSXRlcmF0b3JQcm90b3R5cGUgPSBOYXRpdmVJdGVyYXRvclByb3RvdHlwZTtcbiAgfVxuXG4gIHZhciBHcCA9IEdlbmVyYXRvckZ1bmN0aW9uUHJvdG90eXBlLnByb3RvdHlwZSA9XG4gICAgR2VuZXJhdG9yLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoSXRlcmF0b3JQcm90b3R5cGUpO1xuICBHZW5lcmF0b3JGdW5jdGlvbi5wcm90b3R5cGUgPSBHcC5jb25zdHJ1Y3RvciA9IEdlbmVyYXRvckZ1bmN0aW9uUHJvdG90eXBlO1xuICBHZW5lcmF0b3JGdW5jdGlvblByb3RvdHlwZS5jb25zdHJ1Y3RvciA9IEdlbmVyYXRvckZ1bmN0aW9uO1xuICBHZW5lcmF0b3JGdW5jdGlvblByb3RvdHlwZVt0b1N0cmluZ1RhZ1N5bWJvbF0gPVxuICAgIEdlbmVyYXRvckZ1bmN0aW9uLmRpc3BsYXlOYW1lID0gXCJHZW5lcmF0b3JGdW5jdGlvblwiO1xuXG4gIC8vIEhlbHBlciBmb3IgZGVmaW5pbmcgdGhlIC5uZXh0LCAudGhyb3csIGFuZCAucmV0dXJuIG1ldGhvZHMgb2YgdGhlXG4gIC8vIEl0ZXJhdG9yIGludGVyZmFjZSBpbiB0ZXJtcyBvZiBhIHNpbmdsZSAuX2ludm9rZSBtZXRob2QuXG4gIGZ1bmN0aW9uIGRlZmluZUl0ZXJhdG9yTWV0aG9kcyhwcm90b3R5cGUpIHtcbiAgICBbXCJuZXh0XCIsIFwidGhyb3dcIiwgXCJyZXR1cm5cIl0uZm9yRWFjaChmdW5jdGlvbihtZXRob2QpIHtcbiAgICAgIHByb3RvdHlwZVttZXRob2RdID0gZnVuY3Rpb24oYXJnKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9pbnZva2UobWV0aG9kLCBhcmcpO1xuICAgICAgfTtcbiAgICB9KTtcbiAgfVxuXG4gIGV4cG9ydHMuaXNHZW5lcmF0b3JGdW5jdGlvbiA9IGZ1bmN0aW9uKGdlbkZ1bikge1xuICAgIHZhciBjdG9yID0gdHlwZW9mIGdlbkZ1biA9PT0gXCJmdW5jdGlvblwiICYmIGdlbkZ1bi5jb25zdHJ1Y3RvcjtcbiAgICByZXR1cm4gY3RvclxuICAgICAgPyBjdG9yID09PSBHZW5lcmF0b3JGdW5jdGlvbiB8fFxuICAgICAgICAvLyBGb3IgdGhlIG5hdGl2ZSBHZW5lcmF0b3JGdW5jdGlvbiBjb25zdHJ1Y3RvciwgdGhlIGJlc3Qgd2UgY2FuXG4gICAgICAgIC8vIGRvIGlzIHRvIGNoZWNrIGl0cyAubmFtZSBwcm9wZXJ0eS5cbiAgICAgICAgKGN0b3IuZGlzcGxheU5hbWUgfHwgY3Rvci5uYW1lKSA9PT0gXCJHZW5lcmF0b3JGdW5jdGlvblwiXG4gICAgICA6IGZhbHNlO1xuICB9O1xuXG4gIGV4cG9ydHMubWFyayA9IGZ1bmN0aW9uKGdlbkZ1bikge1xuICAgIGlmIChPYmplY3Quc2V0UHJvdG90eXBlT2YpIHtcbiAgICAgIE9iamVjdC5zZXRQcm90b3R5cGVPZihnZW5GdW4sIEdlbmVyYXRvckZ1bmN0aW9uUHJvdG90eXBlKTtcbiAgICB9IGVsc2Uge1xuICAgICAgZ2VuRnVuLl9fcHJvdG9fXyA9IEdlbmVyYXRvckZ1bmN0aW9uUHJvdG90eXBlO1xuICAgICAgaWYgKCEodG9TdHJpbmdUYWdTeW1ib2wgaW4gZ2VuRnVuKSkge1xuICAgICAgICBnZW5GdW5bdG9TdHJpbmdUYWdTeW1ib2xdID0gXCJHZW5lcmF0b3JGdW5jdGlvblwiO1xuICAgICAgfVxuICAgIH1cbiAgICBnZW5GdW4ucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShHcCk7XG4gICAgcmV0dXJuIGdlbkZ1bjtcbiAgfTtcblxuICAvLyBXaXRoaW4gdGhlIGJvZHkgb2YgYW55IGFzeW5jIGZ1bmN0aW9uLCBgYXdhaXQgeGAgaXMgdHJhbnNmb3JtZWQgdG9cbiAgLy8gYHlpZWxkIHJlZ2VuZXJhdG9yUnVudGltZS5hd3JhcCh4KWAsIHNvIHRoYXQgdGhlIHJ1bnRpbWUgY2FuIHRlc3RcbiAgLy8gYGhhc093bi5jYWxsKHZhbHVlLCBcIl9fYXdhaXRcIilgIHRvIGRldGVybWluZSBpZiB0aGUgeWllbGRlZCB2YWx1ZSBpc1xuICAvLyBtZWFudCB0byBiZSBhd2FpdGVkLlxuICBleHBvcnRzLmF3cmFwID0gZnVuY3Rpb24oYXJnKSB7XG4gICAgcmV0dXJuIHsgX19hd2FpdDogYXJnIH07XG4gIH07XG5cbiAgZnVuY3Rpb24gQXN5bmNJdGVyYXRvcihnZW5lcmF0b3IpIHtcbiAgICBmdW5jdGlvbiBpbnZva2UobWV0aG9kLCBhcmcsIHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgdmFyIHJlY29yZCA9IHRyeUNhdGNoKGdlbmVyYXRvclttZXRob2RdLCBnZW5lcmF0b3IsIGFyZyk7XG4gICAgICBpZiAocmVjb3JkLnR5cGUgPT09IFwidGhyb3dcIikge1xuICAgICAgICByZWplY3QocmVjb3JkLmFyZyk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB2YXIgcmVzdWx0ID0gcmVjb3JkLmFyZztcbiAgICAgICAgdmFyIHZhbHVlID0gcmVzdWx0LnZhbHVlO1xuICAgICAgICBpZiAodmFsdWUgJiZcbiAgICAgICAgICAgIHR5cGVvZiB2YWx1ZSA9PT0gXCJvYmplY3RcIiAmJlxuICAgICAgICAgICAgaGFzT3duLmNhbGwodmFsdWUsIFwiX19hd2FpdFwiKSkge1xuICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUodmFsdWUuX19hd2FpdCkudGhlbihmdW5jdGlvbih2YWx1ZSkge1xuICAgICAgICAgICAgaW52b2tlKFwibmV4dFwiLCB2YWx1ZSwgcmVzb2x2ZSwgcmVqZWN0KTtcbiAgICAgICAgICB9LCBmdW5jdGlvbihlcnIpIHtcbiAgICAgICAgICAgIGludm9rZShcInRocm93XCIsIGVyciwgcmVzb2x2ZSwgcmVqZWN0KTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUodmFsdWUpLnRoZW4oZnVuY3Rpb24odW53cmFwcGVkKSB7XG4gICAgICAgICAgLy8gV2hlbiBhIHlpZWxkZWQgUHJvbWlzZSBpcyByZXNvbHZlZCwgaXRzIGZpbmFsIHZhbHVlIGJlY29tZXNcbiAgICAgICAgICAvLyB0aGUgLnZhbHVlIG9mIHRoZSBQcm9taXNlPHt2YWx1ZSxkb25lfT4gcmVzdWx0IGZvciB0aGVcbiAgICAgICAgICAvLyBjdXJyZW50IGl0ZXJhdGlvbi5cbiAgICAgICAgICByZXN1bHQudmFsdWUgPSB1bndyYXBwZWQ7XG4gICAgICAgICAgcmVzb2x2ZShyZXN1bHQpO1xuICAgICAgICB9LCBmdW5jdGlvbihlcnJvcikge1xuICAgICAgICAgIC8vIElmIGEgcmVqZWN0ZWQgUHJvbWlzZSB3YXMgeWllbGRlZCwgdGhyb3cgdGhlIHJlamVjdGlvbiBiYWNrXG4gICAgICAgICAgLy8gaW50byB0aGUgYXN5bmMgZ2VuZXJhdG9yIGZ1bmN0aW9uIHNvIGl0IGNhbiBiZSBoYW5kbGVkIHRoZXJlLlxuICAgICAgICAgIHJldHVybiBpbnZva2UoXCJ0aHJvd1wiLCBlcnJvciwgcmVzb2x2ZSwgcmVqZWN0KTtcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgdmFyIHByZXZpb3VzUHJvbWlzZTtcblxuICAgIGZ1bmN0aW9uIGVucXVldWUobWV0aG9kLCBhcmcpIHtcbiAgICAgIGZ1bmN0aW9uIGNhbGxJbnZva2VXaXRoTWV0aG9kQW5kQXJnKCkge1xuICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgICAgaW52b2tlKG1ldGhvZCwgYXJnLCByZXNvbHZlLCByZWplY3QpO1xuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHByZXZpb3VzUHJvbWlzZSA9XG4gICAgICAgIC8vIElmIGVucXVldWUgaGFzIGJlZW4gY2FsbGVkIGJlZm9yZSwgdGhlbiB3ZSB3YW50IHRvIHdhaXQgdW50aWxcbiAgICAgICAgLy8gYWxsIHByZXZpb3VzIFByb21pc2VzIGhhdmUgYmVlbiByZXNvbHZlZCBiZWZvcmUgY2FsbGluZyBpbnZva2UsXG4gICAgICAgIC8vIHNvIHRoYXQgcmVzdWx0cyBhcmUgYWx3YXlzIGRlbGl2ZXJlZCBpbiB0aGUgY29ycmVjdCBvcmRlci4gSWZcbiAgICAgICAgLy8gZW5xdWV1ZSBoYXMgbm90IGJlZW4gY2FsbGVkIGJlZm9yZSwgdGhlbiBpdCBpcyBpbXBvcnRhbnQgdG9cbiAgICAgICAgLy8gY2FsbCBpbnZva2UgaW1tZWRpYXRlbHksIHdpdGhvdXQgd2FpdGluZyBvbiBhIGNhbGxiYWNrIHRvIGZpcmUsXG4gICAgICAgIC8vIHNvIHRoYXQgdGhlIGFzeW5jIGdlbmVyYXRvciBmdW5jdGlvbiBoYXMgdGhlIG9wcG9ydHVuaXR5IHRvIGRvXG4gICAgICAgIC8vIGFueSBuZWNlc3Nhcnkgc2V0dXAgaW4gYSBwcmVkaWN0YWJsZSB3YXkuIFRoaXMgcHJlZGljdGFiaWxpdHlcbiAgICAgICAgLy8gaXMgd2h5IHRoZSBQcm9taXNlIGNvbnN0cnVjdG9yIHN5bmNocm9ub3VzbHkgaW52b2tlcyBpdHNcbiAgICAgICAgLy8gZXhlY3V0b3IgY2FsbGJhY2ssIGFuZCB3aHkgYXN5bmMgZnVuY3Rpb25zIHN5bmNocm9ub3VzbHlcbiAgICAgICAgLy8gZXhlY3V0ZSBjb2RlIGJlZm9yZSB0aGUgZmlyc3QgYXdhaXQuIFNpbmNlIHdlIGltcGxlbWVudCBzaW1wbGVcbiAgICAgICAgLy8gYXN5bmMgZnVuY3Rpb25zIGluIHRlcm1zIG9mIGFzeW5jIGdlbmVyYXRvcnMsIGl0IGlzIGVzcGVjaWFsbHlcbiAgICAgICAgLy8gaW1wb3J0YW50IHRvIGdldCB0aGlzIHJpZ2h0LCBldmVuIHRob3VnaCBpdCByZXF1aXJlcyBjYXJlLlxuICAgICAgICBwcmV2aW91c1Byb21pc2UgPyBwcmV2aW91c1Byb21pc2UudGhlbihcbiAgICAgICAgICBjYWxsSW52b2tlV2l0aE1ldGhvZEFuZEFyZyxcbiAgICAgICAgICAvLyBBdm9pZCBwcm9wYWdhdGluZyBmYWlsdXJlcyB0byBQcm9taXNlcyByZXR1cm5lZCBieSBsYXRlclxuICAgICAgICAgIC8vIGludm9jYXRpb25zIG9mIHRoZSBpdGVyYXRvci5cbiAgICAgICAgICBjYWxsSW52b2tlV2l0aE1ldGhvZEFuZEFyZ1xuICAgICAgICApIDogY2FsbEludm9rZVdpdGhNZXRob2RBbmRBcmcoKTtcbiAgICB9XG5cbiAgICAvLyBEZWZpbmUgdGhlIHVuaWZpZWQgaGVscGVyIG1ldGhvZCB0aGF0IGlzIHVzZWQgdG8gaW1wbGVtZW50IC5uZXh0LFxuICAgIC8vIC50aHJvdywgYW5kIC5yZXR1cm4gKHNlZSBkZWZpbmVJdGVyYXRvck1ldGhvZHMpLlxuICAgIHRoaXMuX2ludm9rZSA9IGVucXVldWU7XG4gIH1cblxuICBkZWZpbmVJdGVyYXRvck1ldGhvZHMoQXN5bmNJdGVyYXRvci5wcm90b3R5cGUpO1xuICBBc3luY0l0ZXJhdG9yLnByb3RvdHlwZVthc3luY0l0ZXJhdG9yU3ltYm9sXSA9IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gdGhpcztcbiAgfTtcbiAgZXhwb3J0cy5Bc3luY0l0ZXJhdG9yID0gQXN5bmNJdGVyYXRvcjtcblxuICAvLyBOb3RlIHRoYXQgc2ltcGxlIGFzeW5jIGZ1bmN0aW9ucyBhcmUgaW1wbGVtZW50ZWQgb24gdG9wIG9mXG4gIC8vIEFzeW5jSXRlcmF0b3Igb2JqZWN0czsgdGhleSBqdXN0IHJldHVybiBhIFByb21pc2UgZm9yIHRoZSB2YWx1ZSBvZlxuICAvLyB0aGUgZmluYWwgcmVzdWx0IHByb2R1Y2VkIGJ5IHRoZSBpdGVyYXRvci5cbiAgZXhwb3J0cy5hc3luYyA9IGZ1bmN0aW9uKGlubmVyRm4sIG91dGVyRm4sIHNlbGYsIHRyeUxvY3NMaXN0KSB7XG4gICAgdmFyIGl0ZXIgPSBuZXcgQXN5bmNJdGVyYXRvcihcbiAgICAgIHdyYXAoaW5uZXJGbiwgb3V0ZXJGbiwgc2VsZiwgdHJ5TG9jc0xpc3QpXG4gICAgKTtcblxuICAgIHJldHVybiBleHBvcnRzLmlzR2VuZXJhdG9yRnVuY3Rpb24ob3V0ZXJGbilcbiAgICAgID8gaXRlciAvLyBJZiBvdXRlckZuIGlzIGEgZ2VuZXJhdG9yLCByZXR1cm4gdGhlIGZ1bGwgaXRlcmF0b3IuXG4gICAgICA6IGl0ZXIubmV4dCgpLnRoZW4oZnVuY3Rpb24ocmVzdWx0KSB7XG4gICAgICAgICAgcmV0dXJuIHJlc3VsdC5kb25lID8gcmVzdWx0LnZhbHVlIDogaXRlci5uZXh0KCk7XG4gICAgICAgIH0pO1xuICB9O1xuXG4gIGZ1bmN0aW9uIG1ha2VJbnZva2VNZXRob2QoaW5uZXJGbiwgc2VsZiwgY29udGV4dCkge1xuICAgIHZhciBzdGF0ZSA9IEdlblN0YXRlU3VzcGVuZGVkU3RhcnQ7XG5cbiAgICByZXR1cm4gZnVuY3Rpb24gaW52b2tlKG1ldGhvZCwgYXJnKSB7XG4gICAgICBpZiAoc3RhdGUgPT09IEdlblN0YXRlRXhlY3V0aW5nKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIkdlbmVyYXRvciBpcyBhbHJlYWR5IHJ1bm5pbmdcIik7XG4gICAgICB9XG5cbiAgICAgIGlmIChzdGF0ZSA9PT0gR2VuU3RhdGVDb21wbGV0ZWQpIHtcbiAgICAgICAgaWYgKG1ldGhvZCA9PT0gXCJ0aHJvd1wiKSB7XG4gICAgICAgICAgdGhyb3cgYXJnO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gQmUgZm9yZ2l2aW5nLCBwZXIgMjUuMy4zLjMuMyBvZiB0aGUgc3BlYzpcbiAgICAgICAgLy8gaHR0cHM6Ly9wZW9wbGUubW96aWxsYS5vcmcvfmpvcmVuZG9yZmYvZXM2LWRyYWZ0Lmh0bWwjc2VjLWdlbmVyYXRvcnJlc3VtZVxuICAgICAgICByZXR1cm4gZG9uZVJlc3VsdCgpO1xuICAgICAgfVxuXG4gICAgICBjb250ZXh0Lm1ldGhvZCA9IG1ldGhvZDtcbiAgICAgIGNvbnRleHQuYXJnID0gYXJnO1xuXG4gICAgICB3aGlsZSAodHJ1ZSkge1xuICAgICAgICB2YXIgZGVsZWdhdGUgPSBjb250ZXh0LmRlbGVnYXRlO1xuICAgICAgICBpZiAoZGVsZWdhdGUpIHtcbiAgICAgICAgICB2YXIgZGVsZWdhdGVSZXN1bHQgPSBtYXliZUludm9rZURlbGVnYXRlKGRlbGVnYXRlLCBjb250ZXh0KTtcbiAgICAgICAgICBpZiAoZGVsZWdhdGVSZXN1bHQpIHtcbiAgICAgICAgICAgIGlmIChkZWxlZ2F0ZVJlc3VsdCA9PT0gQ29udGludWVTZW50aW5lbCkgY29udGludWU7XG4gICAgICAgICAgICByZXR1cm4gZGVsZWdhdGVSZXN1bHQ7XG4gICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGNvbnRleHQubWV0aG9kID09PSBcIm5leHRcIikge1xuICAgICAgICAgIC8vIFNldHRpbmcgY29udGV4dC5fc2VudCBmb3IgbGVnYWN5IHN1cHBvcnQgb2YgQmFiZWwnc1xuICAgICAgICAgIC8vIGZ1bmN0aW9uLnNlbnQgaW1wbGVtZW50YXRpb24uXG4gICAgICAgICAgY29udGV4dC5zZW50ID0gY29udGV4dC5fc2VudCA9IGNvbnRleHQuYXJnO1xuXG4gICAgICAgIH0gZWxzZSBpZiAoY29udGV4dC5tZXRob2QgPT09IFwidGhyb3dcIikge1xuICAgICAgICAgIGlmIChzdGF0ZSA9PT0gR2VuU3RhdGVTdXNwZW5kZWRTdGFydCkge1xuICAgICAgICAgICAgc3RhdGUgPSBHZW5TdGF0ZUNvbXBsZXRlZDtcbiAgICAgICAgICAgIHRocm93IGNvbnRleHQuYXJnO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGNvbnRleHQuZGlzcGF0Y2hFeGNlcHRpb24oY29udGV4dC5hcmcpO1xuXG4gICAgICAgIH0gZWxzZSBpZiAoY29udGV4dC5tZXRob2QgPT09IFwicmV0dXJuXCIpIHtcbiAgICAgICAgICBjb250ZXh0LmFicnVwdChcInJldHVyblwiLCBjb250ZXh0LmFyZyk7XG4gICAgICAgIH1cblxuICAgICAgICBzdGF0ZSA9IEdlblN0YXRlRXhlY3V0aW5nO1xuXG4gICAgICAgIHZhciByZWNvcmQgPSB0cnlDYXRjaChpbm5lckZuLCBzZWxmLCBjb250ZXh0KTtcbiAgICAgICAgaWYgKHJlY29yZC50eXBlID09PSBcIm5vcm1hbFwiKSB7XG4gICAgICAgICAgLy8gSWYgYW4gZXhjZXB0aW9uIGlzIHRocm93biBmcm9tIGlubmVyRm4sIHdlIGxlYXZlIHN0YXRlID09PVxuICAgICAgICAgIC8vIEdlblN0YXRlRXhlY3V0aW5nIGFuZCBsb29wIGJhY2sgZm9yIGFub3RoZXIgaW52b2NhdGlvbi5cbiAgICAgICAgICBzdGF0ZSA9IGNvbnRleHQuZG9uZVxuICAgICAgICAgICAgPyBHZW5TdGF0ZUNvbXBsZXRlZFxuICAgICAgICAgICAgOiBHZW5TdGF0ZVN1c3BlbmRlZFlpZWxkO1xuXG4gICAgICAgICAgaWYgKHJlY29yZC5hcmcgPT09IENvbnRpbnVlU2VudGluZWwpIHtcbiAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICB2YWx1ZTogcmVjb3JkLmFyZyxcbiAgICAgICAgICAgIGRvbmU6IGNvbnRleHQuZG9uZVxuICAgICAgICAgIH07XG5cbiAgICAgICAgfSBlbHNlIGlmIChyZWNvcmQudHlwZSA9PT0gXCJ0aHJvd1wiKSB7XG4gICAgICAgICAgc3RhdGUgPSBHZW5TdGF0ZUNvbXBsZXRlZDtcbiAgICAgICAgICAvLyBEaXNwYXRjaCB0aGUgZXhjZXB0aW9uIGJ5IGxvb3BpbmcgYmFjayBhcm91bmQgdG8gdGhlXG4gICAgICAgICAgLy8gY29udGV4dC5kaXNwYXRjaEV4Y2VwdGlvbihjb250ZXh0LmFyZykgY2FsbCBhYm92ZS5cbiAgICAgICAgICBjb250ZXh0Lm1ldGhvZCA9IFwidGhyb3dcIjtcbiAgICAgICAgICBjb250ZXh0LmFyZyA9IHJlY29yZC5hcmc7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9O1xuICB9XG5cbiAgLy8gQ2FsbCBkZWxlZ2F0ZS5pdGVyYXRvcltjb250ZXh0Lm1ldGhvZF0oY29udGV4dC5hcmcpIGFuZCBoYW5kbGUgdGhlXG4gIC8vIHJlc3VsdCwgZWl0aGVyIGJ5IHJldHVybmluZyBhIHsgdmFsdWUsIGRvbmUgfSByZXN1bHQgZnJvbSB0aGVcbiAgLy8gZGVsZWdhdGUgaXRlcmF0b3IsIG9yIGJ5IG1vZGlmeWluZyBjb250ZXh0Lm1ldGhvZCBhbmQgY29udGV4dC5hcmcsXG4gIC8vIHNldHRpbmcgY29udGV4dC5kZWxlZ2F0ZSB0byBudWxsLCBhbmQgcmV0dXJuaW5nIHRoZSBDb250aW51ZVNlbnRpbmVsLlxuICBmdW5jdGlvbiBtYXliZUludm9rZURlbGVnYXRlKGRlbGVnYXRlLCBjb250ZXh0KSB7XG4gICAgdmFyIG1ldGhvZCA9IGRlbGVnYXRlLml0ZXJhdG9yW2NvbnRleHQubWV0aG9kXTtcbiAgICBpZiAobWV0aG9kID09PSB1bmRlZmluZWQpIHtcbiAgICAgIC8vIEEgLnRocm93IG9yIC5yZXR1cm4gd2hlbiB0aGUgZGVsZWdhdGUgaXRlcmF0b3IgaGFzIG5vIC50aHJvd1xuICAgICAgLy8gbWV0aG9kIGFsd2F5cyB0ZXJtaW5hdGVzIHRoZSB5aWVsZCogbG9vcC5cbiAgICAgIGNvbnRleHQuZGVsZWdhdGUgPSBudWxsO1xuXG4gICAgICBpZiAoY29udGV4dC5tZXRob2QgPT09IFwidGhyb3dcIikge1xuICAgICAgICAvLyBOb3RlOiBbXCJyZXR1cm5cIl0gbXVzdCBiZSB1c2VkIGZvciBFUzMgcGFyc2luZyBjb21wYXRpYmlsaXR5LlxuICAgICAgICBpZiAoZGVsZWdhdGUuaXRlcmF0b3JbXCJyZXR1cm5cIl0pIHtcbiAgICAgICAgICAvLyBJZiB0aGUgZGVsZWdhdGUgaXRlcmF0b3IgaGFzIGEgcmV0dXJuIG1ldGhvZCwgZ2l2ZSBpdCBhXG4gICAgICAgICAgLy8gY2hhbmNlIHRvIGNsZWFuIHVwLlxuICAgICAgICAgIGNvbnRleHQubWV0aG9kID0gXCJyZXR1cm5cIjtcbiAgICAgICAgICBjb250ZXh0LmFyZyA9IHVuZGVmaW5lZDtcbiAgICAgICAgICBtYXliZUludm9rZURlbGVnYXRlKGRlbGVnYXRlLCBjb250ZXh0KTtcblxuICAgICAgICAgIGlmIChjb250ZXh0Lm1ldGhvZCA9PT0gXCJ0aHJvd1wiKSB7XG4gICAgICAgICAgICAvLyBJZiBtYXliZUludm9rZURlbGVnYXRlKGNvbnRleHQpIGNoYW5nZWQgY29udGV4dC5tZXRob2QgZnJvbVxuICAgICAgICAgICAgLy8gXCJyZXR1cm5cIiB0byBcInRocm93XCIsIGxldCB0aGF0IG92ZXJyaWRlIHRoZSBUeXBlRXJyb3IgYmVsb3cuXG4gICAgICAgICAgICByZXR1cm4gQ29udGludWVTZW50aW5lbDtcbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBjb250ZXh0Lm1ldGhvZCA9IFwidGhyb3dcIjtcbiAgICAgICAgY29udGV4dC5hcmcgPSBuZXcgVHlwZUVycm9yKFxuICAgICAgICAgIFwiVGhlIGl0ZXJhdG9yIGRvZXMgbm90IHByb3ZpZGUgYSAndGhyb3cnIG1ldGhvZFwiKTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIENvbnRpbnVlU2VudGluZWw7XG4gICAgfVxuXG4gICAgdmFyIHJlY29yZCA9IHRyeUNhdGNoKG1ldGhvZCwgZGVsZWdhdGUuaXRlcmF0b3IsIGNvbnRleHQuYXJnKTtcblxuICAgIGlmIChyZWNvcmQudHlwZSA9PT0gXCJ0aHJvd1wiKSB7XG4gICAgICBjb250ZXh0Lm1ldGhvZCA9IFwidGhyb3dcIjtcbiAgICAgIGNvbnRleHQuYXJnID0gcmVjb3JkLmFyZztcbiAgICAgIGNvbnRleHQuZGVsZWdhdGUgPSBudWxsO1xuICAgICAgcmV0dXJuIENvbnRpbnVlU2VudGluZWw7XG4gICAgfVxuXG4gICAgdmFyIGluZm8gPSByZWNvcmQuYXJnO1xuXG4gICAgaWYgKCEgaW5mbykge1xuICAgICAgY29udGV4dC5tZXRob2QgPSBcInRocm93XCI7XG4gICAgICBjb250ZXh0LmFyZyA9IG5ldyBUeXBlRXJyb3IoXCJpdGVyYXRvciByZXN1bHQgaXMgbm90IGFuIG9iamVjdFwiKTtcbiAgICAgIGNvbnRleHQuZGVsZWdhdGUgPSBudWxsO1xuICAgICAgcmV0dXJuIENvbnRpbnVlU2VudGluZWw7XG4gICAgfVxuXG4gICAgaWYgKGluZm8uZG9uZSkge1xuICAgICAgLy8gQXNzaWduIHRoZSByZXN1bHQgb2YgdGhlIGZpbmlzaGVkIGRlbGVnYXRlIHRvIHRoZSB0ZW1wb3JhcnlcbiAgICAgIC8vIHZhcmlhYmxlIHNwZWNpZmllZCBieSBkZWxlZ2F0ZS5yZXN1bHROYW1lIChzZWUgZGVsZWdhdGVZaWVsZCkuXG4gICAgICBjb250ZXh0W2RlbGVnYXRlLnJlc3VsdE5hbWVdID0gaW5mby52YWx1ZTtcblxuICAgICAgLy8gUmVzdW1lIGV4ZWN1dGlvbiBhdCB0aGUgZGVzaXJlZCBsb2NhdGlvbiAoc2VlIGRlbGVnYXRlWWllbGQpLlxuICAgICAgY29udGV4dC5uZXh0ID0gZGVsZWdhdGUubmV4dExvYztcblxuICAgICAgLy8gSWYgY29udGV4dC5tZXRob2Qgd2FzIFwidGhyb3dcIiBidXQgdGhlIGRlbGVnYXRlIGhhbmRsZWQgdGhlXG4gICAgICAvLyBleGNlcHRpb24sIGxldCB0aGUgb3V0ZXIgZ2VuZXJhdG9yIHByb2NlZWQgbm9ybWFsbHkuIElmXG4gICAgICAvLyBjb250ZXh0Lm1ldGhvZCB3YXMgXCJuZXh0XCIsIGZvcmdldCBjb250ZXh0LmFyZyBzaW5jZSBpdCBoYXMgYmVlblxuICAgICAgLy8gXCJjb25zdW1lZFwiIGJ5IHRoZSBkZWxlZ2F0ZSBpdGVyYXRvci4gSWYgY29udGV4dC5tZXRob2Qgd2FzXG4gICAgICAvLyBcInJldHVyblwiLCBhbGxvdyB0aGUgb3JpZ2luYWwgLnJldHVybiBjYWxsIHRvIGNvbnRpbnVlIGluIHRoZVxuICAgICAgLy8gb3V0ZXIgZ2VuZXJhdG9yLlxuICAgICAgaWYgKGNvbnRleHQubWV0aG9kICE9PSBcInJldHVyblwiKSB7XG4gICAgICAgIGNvbnRleHQubWV0aG9kID0gXCJuZXh0XCI7XG4gICAgICAgIGNvbnRleHQuYXJnID0gdW5kZWZpbmVkO1xuICAgICAgfVxuXG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIFJlLXlpZWxkIHRoZSByZXN1bHQgcmV0dXJuZWQgYnkgdGhlIGRlbGVnYXRlIG1ldGhvZC5cbiAgICAgIHJldHVybiBpbmZvO1xuICAgIH1cblxuICAgIC8vIFRoZSBkZWxlZ2F0ZSBpdGVyYXRvciBpcyBmaW5pc2hlZCwgc28gZm9yZ2V0IGl0IGFuZCBjb250aW51ZSB3aXRoXG4gICAgLy8gdGhlIG91dGVyIGdlbmVyYXRvci5cbiAgICBjb250ZXh0LmRlbGVnYXRlID0gbnVsbDtcbiAgICByZXR1cm4gQ29udGludWVTZW50aW5lbDtcbiAgfVxuXG4gIC8vIERlZmluZSBHZW5lcmF0b3IucHJvdG90eXBlLntuZXh0LHRocm93LHJldHVybn0gaW4gdGVybXMgb2YgdGhlXG4gIC8vIHVuaWZpZWQgLl9pbnZva2UgaGVscGVyIG1ldGhvZC5cbiAgZGVmaW5lSXRlcmF0b3JNZXRob2RzKEdwKTtcblxuICBHcFt0b1N0cmluZ1RhZ1N5bWJvbF0gPSBcIkdlbmVyYXRvclwiO1xuXG4gIC8vIEEgR2VuZXJhdG9yIHNob3VsZCBhbHdheXMgcmV0dXJuIGl0c2VsZiBhcyB0aGUgaXRlcmF0b3Igb2JqZWN0IHdoZW4gdGhlXG4gIC8vIEBAaXRlcmF0b3IgZnVuY3Rpb24gaXMgY2FsbGVkIG9uIGl0LiBTb21lIGJyb3dzZXJzJyBpbXBsZW1lbnRhdGlvbnMgb2YgdGhlXG4gIC8vIGl0ZXJhdG9yIHByb3RvdHlwZSBjaGFpbiBpbmNvcnJlY3RseSBpbXBsZW1lbnQgdGhpcywgY2F1c2luZyB0aGUgR2VuZXJhdG9yXG4gIC8vIG9iamVjdCB0byBub3QgYmUgcmV0dXJuZWQgZnJvbSB0aGlzIGNhbGwuIFRoaXMgZW5zdXJlcyB0aGF0IGRvZXNuJ3QgaGFwcGVuLlxuICAvLyBTZWUgaHR0cHM6Ly9naXRodWIuY29tL2ZhY2Vib29rL3JlZ2VuZXJhdG9yL2lzc3Vlcy8yNzQgZm9yIG1vcmUgZGV0YWlscy5cbiAgR3BbaXRlcmF0b3JTeW1ib2xdID0gZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH07XG5cbiAgR3AudG9TdHJpbmcgPSBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gXCJbb2JqZWN0IEdlbmVyYXRvcl1cIjtcbiAgfTtcblxuICBmdW5jdGlvbiBwdXNoVHJ5RW50cnkobG9jcykge1xuICAgIHZhciBlbnRyeSA9IHsgdHJ5TG9jOiBsb2NzWzBdIH07XG5cbiAgICBpZiAoMSBpbiBsb2NzKSB7XG4gICAgICBlbnRyeS5jYXRjaExvYyA9IGxvY3NbMV07XG4gICAgfVxuXG4gICAgaWYgKDIgaW4gbG9jcykge1xuICAgICAgZW50cnkuZmluYWxseUxvYyA9IGxvY3NbMl07XG4gICAgICBlbnRyeS5hZnRlckxvYyA9IGxvY3NbM107XG4gICAgfVxuXG4gICAgdGhpcy50cnlFbnRyaWVzLnB1c2goZW50cnkpO1xuICB9XG5cbiAgZnVuY3Rpb24gcmVzZXRUcnlFbnRyeShlbnRyeSkge1xuICAgIHZhciByZWNvcmQgPSBlbnRyeS5jb21wbGV0aW9uIHx8IHt9O1xuICAgIHJlY29yZC50eXBlID0gXCJub3JtYWxcIjtcbiAgICBkZWxldGUgcmVjb3JkLmFyZztcbiAgICBlbnRyeS5jb21wbGV0aW9uID0gcmVjb3JkO1xuICB9XG5cbiAgZnVuY3Rpb24gQ29udGV4dCh0cnlMb2NzTGlzdCkge1xuICAgIC8vIFRoZSByb290IGVudHJ5IG9iamVjdCAoZWZmZWN0aXZlbHkgYSB0cnkgc3RhdGVtZW50IHdpdGhvdXQgYSBjYXRjaFxuICAgIC8vIG9yIGEgZmluYWxseSBibG9jaykgZ2l2ZXMgdXMgYSBwbGFjZSB0byBzdG9yZSB2YWx1ZXMgdGhyb3duIGZyb21cbiAgICAvLyBsb2NhdGlvbnMgd2hlcmUgdGhlcmUgaXMgbm8gZW5jbG9zaW5nIHRyeSBzdGF0ZW1lbnQuXG4gICAgdGhpcy50cnlFbnRyaWVzID0gW3sgdHJ5TG9jOiBcInJvb3RcIiB9XTtcbiAgICB0cnlMb2NzTGlzdC5mb3JFYWNoKHB1c2hUcnlFbnRyeSwgdGhpcyk7XG4gICAgdGhpcy5yZXNldCh0cnVlKTtcbiAgfVxuXG4gIGV4cG9ydHMua2V5cyA9IGZ1bmN0aW9uKG9iamVjdCkge1xuICAgIHZhciBrZXlzID0gW107XG4gICAgZm9yICh2YXIga2V5IGluIG9iamVjdCkge1xuICAgICAga2V5cy5wdXNoKGtleSk7XG4gICAgfVxuICAgIGtleXMucmV2ZXJzZSgpO1xuXG4gICAgLy8gUmF0aGVyIHRoYW4gcmV0dXJuaW5nIGFuIG9iamVjdCB3aXRoIGEgbmV4dCBtZXRob2QsIHdlIGtlZXBcbiAgICAvLyB0aGluZ3Mgc2ltcGxlIGFuZCByZXR1cm4gdGhlIG5leHQgZnVuY3Rpb24gaXRzZWxmLlxuICAgIHJldHVybiBmdW5jdGlvbiBuZXh0KCkge1xuICAgICAgd2hpbGUgKGtleXMubGVuZ3RoKSB7XG4gICAgICAgIHZhciBrZXkgPSBrZXlzLnBvcCgpO1xuICAgICAgICBpZiAoa2V5IGluIG9iamVjdCkge1xuICAgICAgICAgIG5leHQudmFsdWUgPSBrZXk7XG4gICAgICAgICAgbmV4dC5kb25lID0gZmFsc2U7XG4gICAgICAgICAgcmV0dXJuIG5leHQ7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgLy8gVG8gYXZvaWQgY3JlYXRpbmcgYW4gYWRkaXRpb25hbCBvYmplY3QsIHdlIGp1c3QgaGFuZyB0aGUgLnZhbHVlXG4gICAgICAvLyBhbmQgLmRvbmUgcHJvcGVydGllcyBvZmYgdGhlIG5leHQgZnVuY3Rpb24gb2JqZWN0IGl0c2VsZi4gVGhpc1xuICAgICAgLy8gYWxzbyBlbnN1cmVzIHRoYXQgdGhlIG1pbmlmaWVyIHdpbGwgbm90IGFub255bWl6ZSB0aGUgZnVuY3Rpb24uXG4gICAgICBuZXh0LmRvbmUgPSB0cnVlO1xuICAgICAgcmV0dXJuIG5leHQ7XG4gICAgfTtcbiAgfTtcblxuICBmdW5jdGlvbiB2YWx1ZXMoaXRlcmFibGUpIHtcbiAgICBpZiAoaXRlcmFibGUpIHtcbiAgICAgIHZhciBpdGVyYXRvck1ldGhvZCA9IGl0ZXJhYmxlW2l0ZXJhdG9yU3ltYm9sXTtcbiAgICAgIGlmIChpdGVyYXRvck1ldGhvZCkge1xuICAgICAgICByZXR1cm4gaXRlcmF0b3JNZXRob2QuY2FsbChpdGVyYWJsZSk7XG4gICAgICB9XG5cbiAgICAgIGlmICh0eXBlb2YgaXRlcmFibGUubmV4dCA9PT0gXCJmdW5jdGlvblwiKSB7XG4gICAgICAgIHJldHVybiBpdGVyYWJsZTtcbiAgICAgIH1cblxuICAgICAgaWYgKCFpc05hTihpdGVyYWJsZS5sZW5ndGgpKSB7XG4gICAgICAgIHZhciBpID0gLTEsIG5leHQgPSBmdW5jdGlvbiBuZXh0KCkge1xuICAgICAgICAgIHdoaWxlICgrK2kgPCBpdGVyYWJsZS5sZW5ndGgpIHtcbiAgICAgICAgICAgIGlmIChoYXNPd24uY2FsbChpdGVyYWJsZSwgaSkpIHtcbiAgICAgICAgICAgICAgbmV4dC52YWx1ZSA9IGl0ZXJhYmxlW2ldO1xuICAgICAgICAgICAgICBuZXh0LmRvbmUgPSBmYWxzZTtcbiAgICAgICAgICAgICAgcmV0dXJuIG5leHQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgbmV4dC52YWx1ZSA9IHVuZGVmaW5lZDtcbiAgICAgICAgICBuZXh0LmRvbmUgPSB0cnVlO1xuXG4gICAgICAgICAgcmV0dXJuIG5leHQ7XG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIG5leHQubmV4dCA9IG5leHQ7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gUmV0dXJuIGFuIGl0ZXJhdG9yIHdpdGggbm8gdmFsdWVzLlxuICAgIHJldHVybiB7IG5leHQ6IGRvbmVSZXN1bHQgfTtcbiAgfVxuICBleHBvcnRzLnZhbHVlcyA9IHZhbHVlcztcblxuICBmdW5jdGlvbiBkb25lUmVzdWx0KCkge1xuICAgIHJldHVybiB7IHZhbHVlOiB1bmRlZmluZWQsIGRvbmU6IHRydWUgfTtcbiAgfVxuXG4gIENvbnRleHQucHJvdG90eXBlID0ge1xuICAgIGNvbnN0cnVjdG9yOiBDb250ZXh0LFxuXG4gICAgcmVzZXQ6IGZ1bmN0aW9uKHNraXBUZW1wUmVzZXQpIHtcbiAgICAgIHRoaXMucHJldiA9IDA7XG4gICAgICB0aGlzLm5leHQgPSAwO1xuICAgICAgLy8gUmVzZXR0aW5nIGNvbnRleHQuX3NlbnQgZm9yIGxlZ2FjeSBzdXBwb3J0IG9mIEJhYmVsJ3NcbiAgICAgIC8vIGZ1bmN0aW9uLnNlbnQgaW1wbGVtZW50YXRpb24uXG4gICAgICB0aGlzLnNlbnQgPSB0aGlzLl9zZW50ID0gdW5kZWZpbmVkO1xuICAgICAgdGhpcy5kb25lID0gZmFsc2U7XG4gICAgICB0aGlzLmRlbGVnYXRlID0gbnVsbDtcblxuICAgICAgdGhpcy5tZXRob2QgPSBcIm5leHRcIjtcbiAgICAgIHRoaXMuYXJnID0gdW5kZWZpbmVkO1xuXG4gICAgICB0aGlzLnRyeUVudHJpZXMuZm9yRWFjaChyZXNldFRyeUVudHJ5KTtcblxuICAgICAgaWYgKCFza2lwVGVtcFJlc2V0KSB7XG4gICAgICAgIGZvciAodmFyIG5hbWUgaW4gdGhpcykge1xuICAgICAgICAgIC8vIE5vdCBzdXJlIGFib3V0IHRoZSBvcHRpbWFsIG9yZGVyIG9mIHRoZXNlIGNvbmRpdGlvbnM6XG4gICAgICAgICAgaWYgKG5hbWUuY2hhckF0KDApID09PSBcInRcIiAmJlxuICAgICAgICAgICAgICBoYXNPd24uY2FsbCh0aGlzLCBuYW1lKSAmJlxuICAgICAgICAgICAgICAhaXNOYU4oK25hbWUuc2xpY2UoMSkpKSB7XG4gICAgICAgICAgICB0aGlzW25hbWVdID0gdW5kZWZpbmVkO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0sXG5cbiAgICBzdG9wOiBmdW5jdGlvbigpIHtcbiAgICAgIHRoaXMuZG9uZSA9IHRydWU7XG5cbiAgICAgIHZhciByb290RW50cnkgPSB0aGlzLnRyeUVudHJpZXNbMF07XG4gICAgICB2YXIgcm9vdFJlY29yZCA9IHJvb3RFbnRyeS5jb21wbGV0aW9uO1xuICAgICAgaWYgKHJvb3RSZWNvcmQudHlwZSA9PT0gXCJ0aHJvd1wiKSB7XG4gICAgICAgIHRocm93IHJvb3RSZWNvcmQuYXJnO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gdGhpcy5ydmFsO1xuICAgIH0sXG5cbiAgICBkaXNwYXRjaEV4Y2VwdGlvbjogZnVuY3Rpb24oZXhjZXB0aW9uKSB7XG4gICAgICBpZiAodGhpcy5kb25lKSB7XG4gICAgICAgIHRocm93IGV4Y2VwdGlvbjtcbiAgICAgIH1cblxuICAgICAgdmFyIGNvbnRleHQgPSB0aGlzO1xuICAgICAgZnVuY3Rpb24gaGFuZGxlKGxvYywgY2F1Z2h0KSB7XG4gICAgICAgIHJlY29yZC50eXBlID0gXCJ0aHJvd1wiO1xuICAgICAgICByZWNvcmQuYXJnID0gZXhjZXB0aW9uO1xuICAgICAgICBjb250ZXh0Lm5leHQgPSBsb2M7XG5cbiAgICAgICAgaWYgKGNhdWdodCkge1xuICAgICAgICAgIC8vIElmIHRoZSBkaXNwYXRjaGVkIGV4Y2VwdGlvbiB3YXMgY2F1Z2h0IGJ5IGEgY2F0Y2ggYmxvY2ssXG4gICAgICAgICAgLy8gdGhlbiBsZXQgdGhhdCBjYXRjaCBibG9jayBoYW5kbGUgdGhlIGV4Y2VwdGlvbiBub3JtYWxseS5cbiAgICAgICAgICBjb250ZXh0Lm1ldGhvZCA9IFwibmV4dFwiO1xuICAgICAgICAgIGNvbnRleHQuYXJnID0gdW5kZWZpbmVkO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuICEhIGNhdWdodDtcbiAgICAgIH1cblxuICAgICAgZm9yICh2YXIgaSA9IHRoaXMudHJ5RW50cmllcy5sZW5ndGggLSAxOyBpID49IDA7IC0taSkge1xuICAgICAgICB2YXIgZW50cnkgPSB0aGlzLnRyeUVudHJpZXNbaV07XG4gICAgICAgIHZhciByZWNvcmQgPSBlbnRyeS5jb21wbGV0aW9uO1xuXG4gICAgICAgIGlmIChlbnRyeS50cnlMb2MgPT09IFwicm9vdFwiKSB7XG4gICAgICAgICAgLy8gRXhjZXB0aW9uIHRocm93biBvdXRzaWRlIG9mIGFueSB0cnkgYmxvY2sgdGhhdCBjb3VsZCBoYW5kbGVcbiAgICAgICAgICAvLyBpdCwgc28gc2V0IHRoZSBjb21wbGV0aW9uIHZhbHVlIG9mIHRoZSBlbnRpcmUgZnVuY3Rpb24gdG9cbiAgICAgICAgICAvLyB0aHJvdyB0aGUgZXhjZXB0aW9uLlxuICAgICAgICAgIHJldHVybiBoYW5kbGUoXCJlbmRcIik7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoZW50cnkudHJ5TG9jIDw9IHRoaXMucHJldikge1xuICAgICAgICAgIHZhciBoYXNDYXRjaCA9IGhhc093bi5jYWxsKGVudHJ5LCBcImNhdGNoTG9jXCIpO1xuICAgICAgICAgIHZhciBoYXNGaW5hbGx5ID0gaGFzT3duLmNhbGwoZW50cnksIFwiZmluYWxseUxvY1wiKTtcblxuICAgICAgICAgIGlmIChoYXNDYXRjaCAmJiBoYXNGaW5hbGx5KSB7XG4gICAgICAgICAgICBpZiAodGhpcy5wcmV2IDwgZW50cnkuY2F0Y2hMb2MpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIGhhbmRsZShlbnRyeS5jYXRjaExvYywgdHJ1ZSk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMucHJldiA8IGVudHJ5LmZpbmFsbHlMb2MpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIGhhbmRsZShlbnRyeS5maW5hbGx5TG9jKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgIH0gZWxzZSBpZiAoaGFzQ2F0Y2gpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLnByZXYgPCBlbnRyeS5jYXRjaExvYykge1xuICAgICAgICAgICAgICByZXR1cm4gaGFuZGxlKGVudHJ5LmNhdGNoTG9jLCB0cnVlKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgIH0gZWxzZSBpZiAoaGFzRmluYWxseSkge1xuICAgICAgICAgICAgaWYgKHRoaXMucHJldiA8IGVudHJ5LmZpbmFsbHlMb2MpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIGhhbmRsZShlbnRyeS5maW5hbGx5TG9jKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJ0cnkgc3RhdGVtZW50IHdpdGhvdXQgY2F0Y2ggb3IgZmluYWxseVwiKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9LFxuXG4gICAgYWJydXB0OiBmdW5jdGlvbih0eXBlLCBhcmcpIHtcbiAgICAgIGZvciAodmFyIGkgPSB0aGlzLnRyeUVudHJpZXMubGVuZ3RoIC0gMTsgaSA+PSAwOyAtLWkpIHtcbiAgICAgICAgdmFyIGVudHJ5ID0gdGhpcy50cnlFbnRyaWVzW2ldO1xuICAgICAgICBpZiAoZW50cnkudHJ5TG9jIDw9IHRoaXMucHJldiAmJlxuICAgICAgICAgICAgaGFzT3duLmNhbGwoZW50cnksIFwiZmluYWxseUxvY1wiKSAmJlxuICAgICAgICAgICAgdGhpcy5wcmV2IDwgZW50cnkuZmluYWxseUxvYykge1xuICAgICAgICAgIHZhciBmaW5hbGx5RW50cnkgPSBlbnRyeTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBpZiAoZmluYWxseUVudHJ5ICYmXG4gICAgICAgICAgKHR5cGUgPT09IFwiYnJlYWtcIiB8fFxuICAgICAgICAgICB0eXBlID09PSBcImNvbnRpbnVlXCIpICYmXG4gICAgICAgICAgZmluYWxseUVudHJ5LnRyeUxvYyA8PSBhcmcgJiZcbiAgICAgICAgICBhcmcgPD0gZmluYWxseUVudHJ5LmZpbmFsbHlMb2MpIHtcbiAgICAgICAgLy8gSWdub3JlIHRoZSBmaW5hbGx5IGVudHJ5IGlmIGNvbnRyb2wgaXMgbm90IGp1bXBpbmcgdG8gYVxuICAgICAgICAvLyBsb2NhdGlvbiBvdXRzaWRlIHRoZSB0cnkvY2F0Y2ggYmxvY2suXG4gICAgICAgIGZpbmFsbHlFbnRyeSA9IG51bGw7XG4gICAgICB9XG5cbiAgICAgIHZhciByZWNvcmQgPSBmaW5hbGx5RW50cnkgPyBmaW5hbGx5RW50cnkuY29tcGxldGlvbiA6IHt9O1xuICAgICAgcmVjb3JkLnR5cGUgPSB0eXBlO1xuICAgICAgcmVjb3JkLmFyZyA9IGFyZztcblxuICAgICAgaWYgKGZpbmFsbHlFbnRyeSkge1xuICAgICAgICB0aGlzLm1ldGhvZCA9IFwibmV4dFwiO1xuICAgICAgICB0aGlzLm5leHQgPSBmaW5hbGx5RW50cnkuZmluYWxseUxvYztcbiAgICAgICAgcmV0dXJuIENvbnRpbnVlU2VudGluZWw7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiB0aGlzLmNvbXBsZXRlKHJlY29yZCk7XG4gICAgfSxcblxuICAgIGNvbXBsZXRlOiBmdW5jdGlvbihyZWNvcmQsIGFmdGVyTG9jKSB7XG4gICAgICBpZiAocmVjb3JkLnR5cGUgPT09IFwidGhyb3dcIikge1xuICAgICAgICB0aHJvdyByZWNvcmQuYXJnO1xuICAgICAgfVxuXG4gICAgICBpZiAocmVjb3JkLnR5cGUgPT09IFwiYnJlYWtcIiB8fFxuICAgICAgICAgIHJlY29yZC50eXBlID09PSBcImNvbnRpbnVlXCIpIHtcbiAgICAgICAgdGhpcy5uZXh0ID0gcmVjb3JkLmFyZztcbiAgICAgIH0gZWxzZSBpZiAocmVjb3JkLnR5cGUgPT09IFwicmV0dXJuXCIpIHtcbiAgICAgICAgdGhpcy5ydmFsID0gdGhpcy5hcmcgPSByZWNvcmQuYXJnO1xuICAgICAgICB0aGlzLm1ldGhvZCA9IFwicmV0dXJuXCI7XG4gICAgICAgIHRoaXMubmV4dCA9IFwiZW5kXCI7XG4gICAgICB9IGVsc2UgaWYgKHJlY29yZC50eXBlID09PSBcIm5vcm1hbFwiICYmIGFmdGVyTG9jKSB7XG4gICAgICAgIHRoaXMubmV4dCA9IGFmdGVyTG9jO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gQ29udGludWVTZW50aW5lbDtcbiAgICB9LFxuXG4gICAgZmluaXNoOiBmdW5jdGlvbihmaW5hbGx5TG9jKSB7XG4gICAgICBmb3IgKHZhciBpID0gdGhpcy50cnlFbnRyaWVzLmxlbmd0aCAtIDE7IGkgPj0gMDsgLS1pKSB7XG4gICAgICAgIHZhciBlbnRyeSA9IHRoaXMudHJ5RW50cmllc1tpXTtcbiAgICAgICAgaWYgKGVudHJ5LmZpbmFsbHlMb2MgPT09IGZpbmFsbHlMb2MpIHtcbiAgICAgICAgICB0aGlzLmNvbXBsZXRlKGVudHJ5LmNvbXBsZXRpb24sIGVudHJ5LmFmdGVyTG9jKTtcbiAgICAgICAgICByZXNldFRyeUVudHJ5KGVudHJ5KTtcbiAgICAgICAgICByZXR1cm4gQ29udGludWVTZW50aW5lbDtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0sXG5cbiAgICBcImNhdGNoXCI6IGZ1bmN0aW9uKHRyeUxvYykge1xuICAgICAgZm9yICh2YXIgaSA9IHRoaXMudHJ5RW50cmllcy5sZW5ndGggLSAxOyBpID49IDA7IC0taSkge1xuICAgICAgICB2YXIgZW50cnkgPSB0aGlzLnRyeUVudHJpZXNbaV07XG4gICAgICAgIGlmIChlbnRyeS50cnlMb2MgPT09IHRyeUxvYykge1xuICAgICAgICAgIHZhciByZWNvcmQgPSBlbnRyeS5jb21wbGV0aW9uO1xuICAgICAgICAgIGlmIChyZWNvcmQudHlwZSA9PT0gXCJ0aHJvd1wiKSB7XG4gICAgICAgICAgICB2YXIgdGhyb3duID0gcmVjb3JkLmFyZztcbiAgICAgICAgICAgIHJlc2V0VHJ5RW50cnkoZW50cnkpO1xuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm4gdGhyb3duO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIC8vIFRoZSBjb250ZXh0LmNhdGNoIG1ldGhvZCBtdXN0IG9ubHkgYmUgY2FsbGVkIHdpdGggYSBsb2NhdGlvblxuICAgICAgLy8gYXJndW1lbnQgdGhhdCBjb3JyZXNwb25kcyB0byBhIGtub3duIGNhdGNoIGJsb2NrLlxuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiaWxsZWdhbCBjYXRjaCBhdHRlbXB0XCIpO1xuICAgIH0sXG5cbiAgICBkZWxlZ2F0ZVlpZWxkOiBmdW5jdGlvbihpdGVyYWJsZSwgcmVzdWx0TmFtZSwgbmV4dExvYykge1xuICAgICAgdGhpcy5kZWxlZ2F0ZSA9IHtcbiAgICAgICAgaXRlcmF0b3I6IHZhbHVlcyhpdGVyYWJsZSksXG4gICAgICAgIHJlc3VsdE5hbWU6IHJlc3VsdE5hbWUsXG4gICAgICAgIG5leHRMb2M6IG5leHRMb2NcbiAgICAgIH07XG5cbiAgICAgIGlmICh0aGlzLm1ldGhvZCA9PT0gXCJuZXh0XCIpIHtcbiAgICAgICAgLy8gRGVsaWJlcmF0ZWx5IGZvcmdldCB0aGUgbGFzdCBzZW50IHZhbHVlIHNvIHRoYXQgd2UgZG9uJ3RcbiAgICAgICAgLy8gYWNjaWRlbnRhbGx5IHBhc3MgaXQgb24gdG8gdGhlIGRlbGVnYXRlLlxuICAgICAgICB0aGlzLmFyZyA9IHVuZGVmaW5lZDtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIENvbnRpbnVlU2VudGluZWw7XG4gICAgfVxuICB9O1xuXG4gIC8vIFJlZ2FyZGxlc3Mgb2Ygd2hldGhlciB0aGlzIHNjcmlwdCBpcyBleGVjdXRpbmcgYXMgYSBDb21tb25KUyBtb2R1bGVcbiAgLy8gb3Igbm90LCByZXR1cm4gdGhlIHJ1bnRpbWUgb2JqZWN0IHNvIHRoYXQgd2UgY2FuIGRlY2xhcmUgdGhlIHZhcmlhYmxlXG4gIC8vIHJlZ2VuZXJhdG9yUnVudGltZSBpbiB0aGUgb3V0ZXIgc2NvcGUsIHdoaWNoIGFsbG93cyB0aGlzIG1vZHVsZSB0byBiZVxuICAvLyBpbmplY3RlZCBlYXNpbHkgYnkgYGJpbi9yZWdlbmVyYXRvciAtLWluY2x1ZGUtcnVudGltZSBzY3JpcHQuanNgLlxuICByZXR1cm4gZXhwb3J0cztcblxufShcbiAgLy8gSWYgdGhpcyBzY3JpcHQgaXMgZXhlY3V0aW5nIGFzIGEgQ29tbW9uSlMgbW9kdWxlLCB1c2UgbW9kdWxlLmV4cG9ydHNcbiAgLy8gYXMgdGhlIHJlZ2VuZXJhdG9yUnVudGltZSBuYW1lc3BhY2UuIE90aGVyd2lzZSBjcmVhdGUgYSBuZXcgZW1wdHlcbiAgLy8gb2JqZWN0LiBFaXRoZXIgd2F5LCB0aGUgcmVzdWx0aW5nIG9iamVjdCB3aWxsIGJlIHVzZWQgdG8gaW5pdGlhbGl6ZVxuICAvLyB0aGUgcmVnZW5lcmF0b3JSdW50aW1lIHZhcmlhYmxlIGF0IHRoZSB0b3Agb2YgdGhpcyBmaWxlLlxuICB0eXBlb2YgbW9kdWxlID09PSBcIm9iamVjdFwiID8gbW9kdWxlLmV4cG9ydHMgOiB7fVxuKSk7XG5cbnRyeSB7XG4gIHJlZ2VuZXJhdG9yUnVudGltZSA9IHJ1bnRpbWU7XG59IGNhdGNoIChhY2NpZGVudGFsU3RyaWN0TW9kZSkge1xuICAvLyBUaGlzIG1vZHVsZSBzaG91bGQgbm90IGJlIHJ1bm5pbmcgaW4gc3RyaWN0IG1vZGUsIHNvIHRoZSBhYm92ZVxuICAvLyBhc3NpZ25tZW50IHNob3VsZCBhbHdheXMgd29yayB1bmxlc3Mgc29tZXRoaW5nIGlzIG1pc2NvbmZpZ3VyZWQuIEp1c3RcbiAgLy8gaW4gY2FzZSBydW50aW1lLmpzIGFjY2lkZW50YWxseSBydW5zIGluIHN0cmljdCBtb2RlLCB3ZSBjYW4gZXNjYXBlXG4gIC8vIHN0cmljdCBtb2RlIHVzaW5nIGEgZ2xvYmFsIEZ1bmN0aW9uIGNhbGwuIFRoaXMgY291bGQgY29uY2VpdmFibHkgZmFpbFxuICAvLyBpZiBhIENvbnRlbnQgU2VjdXJpdHkgUG9saWN5IGZvcmJpZHMgdXNpbmcgRnVuY3Rpb24sIGJ1dCBpbiB0aGF0IGNhc2VcbiAgLy8gdGhlIHByb3BlciBzb2x1dGlvbiBpcyB0byBmaXggdGhlIGFjY2lkZW50YWwgc3RyaWN0IG1vZGUgcHJvYmxlbS4gSWZcbiAgLy8geW91J3ZlIG1pc2NvbmZpZ3VyZWQgeW91ciBidW5kbGVyIHRvIGZvcmNlIHN0cmljdCBtb2RlIGFuZCBhcHBsaWVkIGFcbiAgLy8gQ1NQIHRvIGZvcmJpZCBGdW5jdGlvbiwgYW5kIHlvdSdyZSBub3Qgd2lsbGluZyB0byBmaXggZWl0aGVyIG9mIHRob3NlXG4gIC8vIHByb2JsZW1zLCBwbGVhc2UgZGV0YWlsIHlvdXIgdW5pcXVlIHByZWRpY2FtZW50IGluIGEgR2l0SHViIGlzc3VlLlxuICBGdW5jdGlvbihcInJcIiwgXCJyZWdlbmVyYXRvclJ1bnRpbWUgPSByXCIpKHJ1bnRpbWUpO1xufVxuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Iiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///297\n')},function(module,exports,__webpack_require__){eval("__webpack_require__(299);\nmodule.exports = __webpack_require__(122).global;\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMjk4LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbGlicmFyeS9mbi9nbG9iYWwuanM/NTZjNSJdLCJzb3VyY2VzQ29udGVudCI6WyJyZXF1aXJlKCcuLi9tb2R1bGVzL2VzNy5nbG9iYWwnKTtcbm1vZHVsZS5leHBvcnRzID0gcmVxdWlyZSgnLi4vbW9kdWxlcy9fY29yZScpLmdsb2JhbDtcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///298\n")},function(module,exports,__webpack_require__){eval("// https://github.com/tc39/proposal-global\nvar $export = __webpack_require__(300);\n\n$export($export.G, { global: __webpack_require__(86) });\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMjk5LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbGlicmFyeS9tb2R1bGVzL2VzNy5nbG9iYWwuanM/ZWNmMiJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBodHRwczovL2dpdGh1Yi5jb20vdGMzOS9wcm9wb3NhbC1nbG9iYWxcbnZhciAkZXhwb3J0ID0gcmVxdWlyZSgnLi9fZXhwb3J0Jyk7XG5cbiRleHBvcnQoJGV4cG9ydC5HLCB7IGdsb2JhbDogcmVxdWlyZSgnLi9fZ2xvYmFsJykgfSk7XG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///299\n")},function(module,exports,__webpack_require__){eval("var global = __webpack_require__(86);\nvar core = __webpack_require__(122);\nvar ctx = __webpack_require__(301);\nvar hide = __webpack_require__(303);\nvar has = __webpack_require__(310);\nvar PROTOTYPE = 'prototype';\n\nvar $export = function (type, name, source) {\n  var IS_FORCED = type & $export.F;\n  var IS_GLOBAL = type & $export.G;\n  var IS_STATIC = type & $export.S;\n  var IS_PROTO = type & $export.P;\n  var IS_BIND = type & $export.B;\n  var IS_WRAP = type & $export.W;\n  var exports = IS_GLOBAL ? core : core[name] || (core[name] = {});\n  var expProto = exports[PROTOTYPE];\n  var target = IS_GLOBAL ? global : IS_STATIC ? global[name] : (global[name] || {})[PROTOTYPE];\n  var key, own, out;\n  if (IS_GLOBAL) source = name;\n  for (key in source) {\n    // contains in native\n    own = !IS_FORCED && target && target[key] !== undefined;\n    if (own && has(exports, key)) continue;\n    // export native or passed\n    out = own ? target[key] : source[key];\n    // prevent global pollution for namespaces\n    exports[key] = IS_GLOBAL && typeof target[key] != 'function' ? source[key]\n    // bind timers to global for call from export context\n    : IS_BIND && own ? ctx(out, global)\n    // wrap global constructors for prevent change them in library\n    : IS_WRAP && target[key] == out ? (function (C) {\n      var F = function (a, b, c) {\n        if (this instanceof C) {\n          switch (arguments.length) {\n            case 0: return new C();\n            case 1: return new C(a);\n            case 2: return new C(a, b);\n          } return new C(a, b, c);\n        } return C.apply(this, arguments);\n      };\n      F[PROTOTYPE] = C[PROTOTYPE];\n      return F;\n    // make static versions for prototype methods\n    })(out) : IS_PROTO && typeof out == 'function' ? ctx(Function.call, out) : out;\n    // export proto methods to core.%CONSTRUCTOR%.methods.%NAME%\n    if (IS_PROTO) {\n      (exports.virtual || (exports.virtual = {}))[key] = out;\n      // export proto methods to core.%CONSTRUCTOR%.prototype.%NAME%\n      if (type & $export.R && expProto && !expProto[key]) hide(expProto, key, out);\n    }\n  }\n};\n// type bitmap\n$export.F = 1;   // forced\n$export.G = 2;   // global\n$export.S = 4;   // static\n$export.P = 8;   // proto\n$export.B = 16;  // bind\n$export.W = 32;  // wrap\n$export.U = 64;  // safe\n$export.R = 128; // real proto method for `library`\nmodule.exports = $export;\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMzAwLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbGlicmFyeS9tb2R1bGVzL19leHBvcnQuanM/NjNiNiJdLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgZ2xvYmFsID0gcmVxdWlyZSgnLi9fZ2xvYmFsJyk7XG52YXIgY29yZSA9IHJlcXVpcmUoJy4vX2NvcmUnKTtcbnZhciBjdHggPSByZXF1aXJlKCcuL19jdHgnKTtcbnZhciBoaWRlID0gcmVxdWlyZSgnLi9faGlkZScpO1xudmFyIGhhcyA9IHJlcXVpcmUoJy4vX2hhcycpO1xudmFyIFBST1RPVFlQRSA9ICdwcm90b3R5cGUnO1xuXG52YXIgJGV4cG9ydCA9IGZ1bmN0aW9uICh0eXBlLCBuYW1lLCBzb3VyY2UpIHtcbiAgdmFyIElTX0ZPUkNFRCA9IHR5cGUgJiAkZXhwb3J0LkY7XG4gIHZhciBJU19HTE9CQUwgPSB0eXBlICYgJGV4cG9ydC5HO1xuICB2YXIgSVNfU1RBVElDID0gdHlwZSAmICRleHBvcnQuUztcbiAgdmFyIElTX1BST1RPID0gdHlwZSAmICRleHBvcnQuUDtcbiAgdmFyIElTX0JJTkQgPSB0eXBlICYgJGV4cG9ydC5CO1xuICB2YXIgSVNfV1JBUCA9IHR5cGUgJiAkZXhwb3J0Llc7XG4gIHZhciBleHBvcnRzID0gSVNfR0xPQkFMID8gY29yZSA6IGNvcmVbbmFtZV0gfHwgKGNvcmVbbmFtZV0gPSB7fSk7XG4gIHZhciBleHBQcm90byA9IGV4cG9ydHNbUFJPVE9UWVBFXTtcbiAgdmFyIHRhcmdldCA9IElTX0dMT0JBTCA/IGdsb2JhbCA6IElTX1NUQVRJQyA/IGdsb2JhbFtuYW1lXSA6IChnbG9iYWxbbmFtZV0gfHwge30pW1BST1RPVFlQRV07XG4gIHZhciBrZXksIG93biwgb3V0O1xuICBpZiAoSVNfR0xPQkFMKSBzb3VyY2UgPSBuYW1lO1xuICBmb3IgKGtleSBpbiBzb3VyY2UpIHtcbiAgICAvLyBjb250YWlucyBpbiBuYXRpdmVcbiAgICBvd24gPSAhSVNfRk9SQ0VEICYmIHRhcmdldCAmJiB0YXJnZXRba2V5XSAhPT0gdW5kZWZpbmVkO1xuICAgIGlmIChvd24gJiYgaGFzKGV4cG9ydHMsIGtleSkpIGNvbnRpbnVlO1xuICAgIC8vIGV4cG9ydCBuYXRpdmUgb3IgcGFzc2VkXG4gICAgb3V0ID0gb3duID8gdGFyZ2V0W2tleV0gOiBzb3VyY2Vba2V5XTtcbiAgICAvLyBwcmV2ZW50IGdsb2JhbCBwb2xsdXRpb24gZm9yIG5hbWVzcGFjZXNcbiAgICBleHBvcnRzW2tleV0gPSBJU19HTE9CQUwgJiYgdHlwZW9mIHRhcmdldFtrZXldICE9ICdmdW5jdGlvbicgPyBzb3VyY2Vba2V5XVxuICAgIC8vIGJpbmQgdGltZXJzIHRvIGdsb2JhbCBmb3IgY2FsbCBmcm9tIGV4cG9ydCBjb250ZXh0XG4gICAgOiBJU19CSU5EICYmIG93biA/IGN0eChvdXQsIGdsb2JhbClcbiAgICAvLyB3cmFwIGdsb2JhbCBjb25zdHJ1Y3RvcnMgZm9yIHByZXZlbnQgY2hhbmdlIHRoZW0gaW4gbGlicmFyeVxuICAgIDogSVNfV1JBUCAmJiB0YXJnZXRba2V5XSA9PSBvdXQgPyAoZnVuY3Rpb24gKEMpIHtcbiAgICAgIHZhciBGID0gZnVuY3Rpb24gKGEsIGIsIGMpIHtcbiAgICAgICAgaWYgKHRoaXMgaW5zdGFuY2VvZiBDKSB7XG4gICAgICAgICAgc3dpdGNoIChhcmd1bWVudHMubGVuZ3RoKSB7XG4gICAgICAgICAgICBjYXNlIDA6IHJldHVybiBuZXcgQygpO1xuICAgICAgICAgICAgY2FzZSAxOiByZXR1cm4gbmV3IEMoYSk7XG4gICAgICAgICAgICBjYXNlIDI6IHJldHVybiBuZXcgQyhhLCBiKTtcbiAgICAgICAgICB9IHJldHVybiBuZXcgQyhhLCBiLCBjKTtcbiAgICAgICAgfSByZXR1cm4gQy5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgICAgfTtcbiAgICAgIEZbUFJPVE9UWVBFXSA9IENbUFJPVE9UWVBFXTtcbiAgICAgIHJldHVybiBGO1xuICAgIC8vIG1ha2Ugc3RhdGljIHZlcnNpb25zIGZvciBwcm90b3R5cGUgbWV0aG9kc1xuICAgIH0pKG91dCkgOiBJU19QUk9UTyAmJiB0eXBlb2Ygb3V0ID09ICdmdW5jdGlvbicgPyBjdHgoRnVuY3Rpb24uY2FsbCwgb3V0KSA6IG91dDtcbiAgICAvLyBleHBvcnQgcHJvdG8gbWV0aG9kcyB0byBjb3JlLiVDT05TVFJVQ1RPUiUubWV0aG9kcy4lTkFNRSVcbiAgICBpZiAoSVNfUFJPVE8pIHtcbiAgICAgIChleHBvcnRzLnZpcnR1YWwgfHwgKGV4cG9ydHMudmlydHVhbCA9IHt9KSlba2V5XSA9IG91dDtcbiAgICAgIC8vIGV4cG9ydCBwcm90byBtZXRob2RzIHRvIGNvcmUuJUNPTlNUUlVDVE9SJS5wcm90b3R5cGUuJU5BTUUlXG4gICAgICBpZiAodHlwZSAmICRleHBvcnQuUiAmJiBleHBQcm90byAmJiAhZXhwUHJvdG9ba2V5XSkgaGlkZShleHBQcm90bywga2V5LCBvdXQpO1xuICAgIH1cbiAgfVxufTtcbi8vIHR5cGUgYml0bWFwXG4kZXhwb3J0LkYgPSAxOyAgIC8vIGZvcmNlZFxuJGV4cG9ydC5HID0gMjsgICAvLyBnbG9iYWxcbiRleHBvcnQuUyA9IDQ7ICAgLy8gc3RhdGljXG4kZXhwb3J0LlAgPSA4OyAgIC8vIHByb3RvXG4kZXhwb3J0LkIgPSAxNjsgIC8vIGJpbmRcbiRleHBvcnQuVyA9IDMyOyAgLy8gd3JhcFxuJGV4cG9ydC5VID0gNjQ7ICAvLyBzYWZlXG4kZXhwb3J0LlIgPSAxMjg7IC8vIHJlYWwgcHJvdG8gbWV0aG9kIGZvciBgbGlicmFyeWBcbm1vZHVsZS5leHBvcnRzID0gJGV4cG9ydDtcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///300\n")},function(module,exports,__webpack_require__){eval("// optional / simple context binding\nvar aFunction = __webpack_require__(302);\nmodule.exports = function (fn, that, length) {\n  aFunction(fn);\n  if (that === undefined) return fn;\n  switch (length) {\n    case 1: return function (a) {\n      return fn.call(that, a);\n    };\n    case 2: return function (a, b) {\n      return fn.call(that, a, b);\n    };\n    case 3: return function (a, b, c) {\n      return fn.call(that, a, b, c);\n    };\n  }\n  return function (/* ...args */) {\n    return fn.apply(that, arguments);\n  };\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMzAxLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbGlicmFyeS9tb2R1bGVzL19jdHguanM/ZDg2NCJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBvcHRpb25hbCAvIHNpbXBsZSBjb250ZXh0IGJpbmRpbmdcbnZhciBhRnVuY3Rpb24gPSByZXF1aXJlKCcuL19hLWZ1bmN0aW9uJyk7XG5tb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChmbiwgdGhhdCwgbGVuZ3RoKSB7XG4gIGFGdW5jdGlvbihmbik7XG4gIGlmICh0aGF0ID09PSB1bmRlZmluZWQpIHJldHVybiBmbjtcbiAgc3dpdGNoIChsZW5ndGgpIHtcbiAgICBjYXNlIDE6IHJldHVybiBmdW5jdGlvbiAoYSkge1xuICAgICAgcmV0dXJuIGZuLmNhbGwodGhhdCwgYSk7XG4gICAgfTtcbiAgICBjYXNlIDI6IHJldHVybiBmdW5jdGlvbiAoYSwgYikge1xuICAgICAgcmV0dXJuIGZuLmNhbGwodGhhdCwgYSwgYik7XG4gICAgfTtcbiAgICBjYXNlIDM6IHJldHVybiBmdW5jdGlvbiAoYSwgYiwgYykge1xuICAgICAgcmV0dXJuIGZuLmNhbGwodGhhdCwgYSwgYiwgYyk7XG4gICAgfTtcbiAgfVxuICByZXR1cm4gZnVuY3Rpb24gKC8qIC4uLmFyZ3MgKi8pIHtcbiAgICByZXR1cm4gZm4uYXBwbHkodGhhdCwgYXJndW1lbnRzKTtcbiAgfTtcbn07XG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Iiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///301\n")},function(module,exports){eval("module.exports = function (it) {\n  if (typeof it != 'function') throw TypeError(it + ' is not a function!');\n  return it;\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMzAyLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbGlicmFyeS9tb2R1bGVzL19hLWZ1bmN0aW9uLmpzPzc5YWEiXSwic291cmNlc0NvbnRlbnQiOlsibW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoaXQpIHtcbiAgaWYgKHR5cGVvZiBpdCAhPSAnZnVuY3Rpb24nKSB0aHJvdyBUeXBlRXJyb3IoaXQgKyAnIGlzIG5vdCBhIGZ1bmN0aW9uIScpO1xuICByZXR1cm4gaXQ7XG59O1xuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///302\n")},function(module,exports,__webpack_require__){eval("var dP = __webpack_require__(304);\nvar createDesc = __webpack_require__(309);\nmodule.exports = __webpack_require__(88) ? function (object, key, value) {\n  return dP.f(object, key, createDesc(1, value));\n} : function (object, key, value) {\n  object[key] = value;\n  return object;\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMzAzLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbGlicmFyeS9tb2R1bGVzL19oaWRlLmpzPzM1ZTgiXSwic291cmNlc0NvbnRlbnQiOlsidmFyIGRQID0gcmVxdWlyZSgnLi9fb2JqZWN0LWRwJyk7XG52YXIgY3JlYXRlRGVzYyA9IHJlcXVpcmUoJy4vX3Byb3BlcnR5LWRlc2MnKTtcbm1vZHVsZS5leHBvcnRzID0gcmVxdWlyZSgnLi9fZGVzY3JpcHRvcnMnKSA/IGZ1bmN0aW9uIChvYmplY3QsIGtleSwgdmFsdWUpIHtcbiAgcmV0dXJuIGRQLmYob2JqZWN0LCBrZXksIGNyZWF0ZURlc2MoMSwgdmFsdWUpKTtcbn0gOiBmdW5jdGlvbiAob2JqZWN0LCBrZXksIHZhbHVlKSB7XG4gIG9iamVjdFtrZXldID0gdmFsdWU7XG4gIHJldHVybiBvYmplY3Q7XG59O1xuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///303\n")},function(module,exports,__webpack_require__){eval("var anObject = __webpack_require__(305);\nvar IE8_DOM_DEFINE = __webpack_require__(306);\nvar toPrimitive = __webpack_require__(308);\nvar dP = Object.defineProperty;\n\nexports.f = __webpack_require__(88) ? Object.defineProperty : function defineProperty(O, P, Attributes) {\n  anObject(O);\n  P = toPrimitive(P, true);\n  anObject(Attributes);\n  if (IE8_DOM_DEFINE) try {\n    return dP(O, P, Attributes);\n  } catch (e) { /* empty */ }\n  if ('get' in Attributes || 'set' in Attributes) throw TypeError('Accessors not supported!');\n  if ('value' in Attributes) O[P] = Attributes.value;\n  return O;\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMzA0LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbGlicmFyeS9tb2R1bGVzL19vYmplY3QtZHAuanM/ZDlmNiJdLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgYW5PYmplY3QgPSByZXF1aXJlKCcuL19hbi1vYmplY3QnKTtcbnZhciBJRThfRE9NX0RFRklORSA9IHJlcXVpcmUoJy4vX2llOC1kb20tZGVmaW5lJyk7XG52YXIgdG9QcmltaXRpdmUgPSByZXF1aXJlKCcuL190by1wcmltaXRpdmUnKTtcbnZhciBkUCA9IE9iamVjdC5kZWZpbmVQcm9wZXJ0eTtcblxuZXhwb3J0cy5mID0gcmVxdWlyZSgnLi9fZGVzY3JpcHRvcnMnKSA/IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSA6IGZ1bmN0aW9uIGRlZmluZVByb3BlcnR5KE8sIFAsIEF0dHJpYnV0ZXMpIHtcbiAgYW5PYmplY3QoTyk7XG4gIFAgPSB0b1ByaW1pdGl2ZShQLCB0cnVlKTtcbiAgYW5PYmplY3QoQXR0cmlidXRlcyk7XG4gIGlmIChJRThfRE9NX0RFRklORSkgdHJ5IHtcbiAgICByZXR1cm4gZFAoTywgUCwgQXR0cmlidXRlcyk7XG4gIH0gY2F0Y2ggKGUpIHsgLyogZW1wdHkgKi8gfVxuICBpZiAoJ2dldCcgaW4gQXR0cmlidXRlcyB8fCAnc2V0JyBpbiBBdHRyaWJ1dGVzKSB0aHJvdyBUeXBlRXJyb3IoJ0FjY2Vzc29ycyBub3Qgc3VwcG9ydGVkIScpO1xuICBpZiAoJ3ZhbHVlJyBpbiBBdHRyaWJ1dGVzKSBPW1BdID0gQXR0cmlidXRlcy52YWx1ZTtcbiAgcmV0dXJuIE87XG59O1xuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///304\n")},function(module,exports,__webpack_require__){eval("var isObject = __webpack_require__(87);\nmodule.exports = function (it) {\n  if (!isObject(it)) throw TypeError(it + ' is not an object!');\n  return it;\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMzA1LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbGlicmFyeS9tb2R1bGVzL19hbi1vYmplY3QuanM/ZTRhZSJdLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgaXNPYmplY3QgPSByZXF1aXJlKCcuL19pcy1vYmplY3QnKTtcbm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKGl0KSB7XG4gIGlmICghaXNPYmplY3QoaXQpKSB0aHJvdyBUeXBlRXJyb3IoaXQgKyAnIGlzIG5vdCBhbiBvYmplY3QhJyk7XG4gIHJldHVybiBpdDtcbn07XG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Iiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///305\n")},function(module,exports,__webpack_require__){eval("module.exports = !__webpack_require__(88) && !__webpack_require__(123)(function () {\n  return Object.defineProperty(__webpack_require__(307)('div'), 'a', { get: function () { return 7; } }).a != 7;\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMzA2LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbGlicmFyeS9tb2R1bGVzL19pZTgtZG9tLWRlZmluZS5qcz83OTRiIl0sInNvdXJjZXNDb250ZW50IjpbIm1vZHVsZS5leHBvcnRzID0gIXJlcXVpcmUoJy4vX2Rlc2NyaXB0b3JzJykgJiYgIXJlcXVpcmUoJy4vX2ZhaWxzJykoZnVuY3Rpb24gKCkge1xuICByZXR1cm4gT2JqZWN0LmRlZmluZVByb3BlcnR5KHJlcXVpcmUoJy4vX2RvbS1jcmVhdGUnKSgnZGl2JyksICdhJywgeyBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIDc7IH0gfSkuYSAhPSA3O1xufSk7XG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///306\n")},function(module,exports,__webpack_require__){eval("var isObject = __webpack_require__(87);\nvar document = __webpack_require__(86).document;\n// typeof document.createElement is 'object' in old IE\nvar is = isObject(document) && isObject(document.createElement);\nmodule.exports = function (it) {\n  return is ? document.createElement(it) : {};\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMzA3LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbGlicmFyeS9tb2R1bGVzL19kb20tY3JlYXRlLmpzPzFlYzkiXSwic291cmNlc0NvbnRlbnQiOlsidmFyIGlzT2JqZWN0ID0gcmVxdWlyZSgnLi9faXMtb2JqZWN0Jyk7XG52YXIgZG9jdW1lbnQgPSByZXF1aXJlKCcuL19nbG9iYWwnKS5kb2N1bWVudDtcbi8vIHR5cGVvZiBkb2N1bWVudC5jcmVhdGVFbGVtZW50IGlzICdvYmplY3QnIGluIG9sZCBJRVxudmFyIGlzID0gaXNPYmplY3QoZG9jdW1lbnQpICYmIGlzT2JqZWN0KGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQpO1xubW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoaXQpIHtcbiAgcmV0dXJuIGlzID8gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChpdCkgOiB7fTtcbn07XG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///307\n")},function(module,exports,__webpack_require__){eval("// 7.1.1 ToPrimitive(input [, PreferredType])\nvar isObject = __webpack_require__(87);\n// instead of the ES6 spec version, we didn't implement @@toPrimitive case\n// and the second argument - flag - preferred type is a string\nmodule.exports = function (it, S) {\n  if (!isObject(it)) return it;\n  var fn, val;\n  if (S && typeof (fn = it.toString) == 'function' && !isObject(val = fn.call(it))) return val;\n  if (typeof (fn = it.valueOf) == 'function' && !isObject(val = fn.call(it))) return val;\n  if (!S && typeof (fn = it.toString) == 'function' && !isObject(val = fn.call(it))) return val;\n  throw TypeError(\"Can't convert object to primitive value\");\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMzA4LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbGlicmFyeS9tb2R1bGVzL190by1wcmltaXRpdmUuanM/MWJjMyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyA3LjEuMSBUb1ByaW1pdGl2ZShpbnB1dCBbLCBQcmVmZXJyZWRUeXBlXSlcbnZhciBpc09iamVjdCA9IHJlcXVpcmUoJy4vX2lzLW9iamVjdCcpO1xuLy8gaW5zdGVhZCBvZiB0aGUgRVM2IHNwZWMgdmVyc2lvbiwgd2UgZGlkbid0IGltcGxlbWVudCBAQHRvUHJpbWl0aXZlIGNhc2Vcbi8vIGFuZCB0aGUgc2Vjb25kIGFyZ3VtZW50IC0gZmxhZyAtIHByZWZlcnJlZCB0eXBlIGlzIGEgc3RyaW5nXG5tb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChpdCwgUykge1xuICBpZiAoIWlzT2JqZWN0KGl0KSkgcmV0dXJuIGl0O1xuICB2YXIgZm4sIHZhbDtcbiAgaWYgKFMgJiYgdHlwZW9mIChmbiA9IGl0LnRvU3RyaW5nKSA9PSAnZnVuY3Rpb24nICYmICFpc09iamVjdCh2YWwgPSBmbi5jYWxsKGl0KSkpIHJldHVybiB2YWw7XG4gIGlmICh0eXBlb2YgKGZuID0gaXQudmFsdWVPZikgPT0gJ2Z1bmN0aW9uJyAmJiAhaXNPYmplY3QodmFsID0gZm4uY2FsbChpdCkpKSByZXR1cm4gdmFsO1xuICBpZiAoIVMgJiYgdHlwZW9mIChmbiA9IGl0LnRvU3RyaW5nKSA9PSAnZnVuY3Rpb24nICYmICFpc09iamVjdCh2YWwgPSBmbi5jYWxsKGl0KSkpIHJldHVybiB2YWw7XG4gIHRocm93IFR5cGVFcnJvcihcIkNhbid0IGNvbnZlcnQgb2JqZWN0IHRvIHByaW1pdGl2ZSB2YWx1ZVwiKTtcbn07XG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///308\n")},function(module,exports){eval("module.exports = function (bitmap, value) {\n  return {\n    enumerable: !(bitmap & 1),\n    configurable: !(bitmap & 2),\n    writable: !(bitmap & 4),\n    value: value\n  };\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMzA5LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbGlicmFyeS9tb2R1bGVzL19wcm9wZXJ0eS1kZXNjLmpzP2FlYmQiXSwic291cmNlc0NvbnRlbnQiOlsibW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoYml0bWFwLCB2YWx1ZSkge1xuICByZXR1cm4ge1xuICAgIGVudW1lcmFibGU6ICEoYml0bWFwICYgMSksXG4gICAgY29uZmlndXJhYmxlOiAhKGJpdG1hcCAmIDIpLFxuICAgIHdyaXRhYmxlOiAhKGJpdG1hcCAmIDQpLFxuICAgIHZhbHVlOiB2YWx1ZVxuICB9O1xufTtcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///309\n")},function(module,exports){eval("var hasOwnProperty = {}.hasOwnProperty;\nmodule.exports = function (it, key) {\n  return hasOwnProperty.call(it, key);\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMzEwLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vbm9kZV9tb2R1bGVzL2NvcmUtanMvbGlicmFyeS9tb2R1bGVzL19oYXMuanM/MDdlMyJdLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgaGFzT3duUHJvcGVydHkgPSB7fS5oYXNPd25Qcm9wZXJ0eTtcbm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKGl0LCBrZXkpIHtcbiAgcmV0dXJuIGhhc093blByb3BlcnR5LmNhbGwoaXQsIGtleSk7XG59O1xuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///310\n")},function(module,__webpack_exports__,__webpack_require__){"use strict";eval("__webpack_require__.r(__webpack_exports__);\n\n// EXTERNAL MODULE: ./node_modules/loglevel/lib/loglevel.js\nvar loglevel = __webpack_require__(0);\nvar loglevel_default = /*#__PURE__*/__webpack_require__.n(loglevel);\n\n// CONCATENATED MODULE: ./src/logLevels.js\n\r\n\r\nconst a = loglevel_default.a.getLogger('address-allocation');\r\nconst b = loglevel_default.a.getLogger('Bus');\r\nconst c = loglevel_default.a.getLogger('MessageBus');\r\nconst d = loglevel_default.a.getLogger('CoreDiscovery');\r\nconst e = loglevel_default.a.getLogger('StorageManager');\r\nconst f = loglevel_default.a.getLogger('HypertyResourcesStorage');\r\nconst g = loglevel_default.a.getLogger('IdentityModule');\r\nconst h = loglevel_default.a.getLogger('PEP');\r\nconst logLevels_i = loglevel_default.a.getLogger('P2PConnectionResolve');\r\nconst j = loglevel_default.a.getLogger('Registry');\r\nconst k = loglevel_default.a.getLogger('RuntimeUA');\r\nconst l = loglevel_default.a.getLogger('Loader');\r\nconst m = loglevel_default.a.getLogger('Descriptors');\r\nconst n = loglevel_default.a.getLogger('DataObjectsStorage');\r\nconst o = loglevel_default.a.getLogger('Subscription');\r\nconst p = loglevel_default.a.getLogger('SubscriptionManager');\r\nconst q = loglevel_default.a.getLogger('ObserverObject');\r\nconst r = loglevel_default.a.getLogger('ReporterObject');\r\nconst s = loglevel_default.a.getLogger('SynSubscription');\r\nconst t = loglevel_default.a.getLogger('SyncherManager');\r\nconst u = loglevel_default.a.getLogger('IdentityHandler');\r\nconst v = loglevel_default.a.getLogger('CryptoManager');\r\nconst x = loglevel_default.a.getLogger('Pipeline');\r\nconst f1 = loglevel_default.a.getLogger('Syncher');\r\nconst f2 = loglevel_default.a.getLogger('RuntimeCatalogue');\r\n\r\n\r\n\r\n\r\n/**\r\n  0 actual logging methods, ordered and available as:\r\n\r\n      0 - log.trace(msg)\r\n      1 - log.debug(msg)\r\n      2 - log.info(msg)\r\n      3 - log.warn(msg)\r\n      4 - log.error(msg)\r\n\r\n  log.log(msg) is also available, as an alias for log.debug(msg), to improve compatibility with console, and make migration easier.\r\n\r\n  Exact output formatting of these will depend on the console available in the current context of your application. For example, many environments will include a full stack trace with all trace() calls, and icons or similar to highlight other calls.\r\n\r\n  These methods should never fail in any environment, even if no console object is currently available, and should always fall back to an available log method even if the specific method called (e.g. warn) isn't available.\r\n\r\n  Be aware that all this means that these method won't necessarily always produce exactly the output you expect in every environment; loglevel only guarantees that these methods will never explode on you, and that it will call the most relevant method it can find, with your argument. Firefox is a notable example here: due to a current Firefox bug log.trace(msg) calls in Firefox will print only the stacktrace, and won't include any passed message arguments.\r\n\r\n*/\r\n\r\n\r\n// address-allocation\r\na.setLevel(0);\r\n\r\n// Bus\r\nb.setLevel(3);\r\n\r\n// MessageBus\r\nc.setLevel(3);\r\n\r\n// CoreDiscovery\r\nd.setLevel(5);\r\n\r\n// StorageManager\r\ne.setLevel(0);\r\n\r\n// HypertyResourcesStorage\r\nf.setLevel(3);\r\n\r\n// IdentityModule\r\ng.setLevel(0);\r\n\r\n// PEP\r\nh.setLevel(3);\r\n\r\n// P2PConnectionResolve\r\nlogLevels_i.setLevel(3);\r\n\r\n// Registry\r\nj.setLevel(0);\r\n\r\n// RuntimeUA\r\nk.setLevel(0);\r\n\r\n// Loader\r\nl.setLevel(0);\r\n\r\n// Descriptors\r\nm.setLevel(3);\r\n\r\n// DataObjectsStorage\r\nn.setLevel(0);\r\n\r\n// Subscription\r\no.setLevel(3);\r\n\r\n// SubscriptionManager\r\np.setLevel(3);\r\n\r\n// ObserverObject\r\nq.setLevel(0);\r\n\r\n// ReporterObject\r\nr.setLevel(0);\r\n\r\n// SynSubscription\r\ns.setLevel(3);\r\n\r\n// SyncherManager\r\nt.setLevel(0);\r\n\r\n// IdentityHandler\r\nu.setLevel(3);\r\n\r\n// CryptoManager\r\nv.setLevel(0);\r\n\r\n// Pipeline\r\nx.setLevel(0);\r\n\r\n// Syncher\r\nf1.setLevel(0);\r\n\r\n// Syncher DataObjectObserver\r\nf1.setLevel(0);\r\n\r\n// RuntimeCatalogue\r\nf2.setLevel(0);\r\n\n// CONCATENATED MODULE: ./src/runtime/runtimeUtils.js\nlet runtimeUtils = {\r\n  runtimeDescriptor: {},\r\n  runtimeCapabilities: {\r\n    constraints: {}\r\n  }\r\n};\r\n\n// CONCATENATED MODULE: ./src/utils/utils.js\n/**\r\n* Copyright 2016 PT Inovação e Sistemas SA\r\n* Copyright 2016 INESC-ID\r\n* Copyright 2016 QUOBIS NETWORKS SL\r\n* Copyright 2016 FRAUNHOFER-GESELLSCHAFT ZUR FOERDERUNG DER ANGEWANDTEN FORSCHUNG E.V\r\n* Copyright 2016 ORANGE SA\r\n* Copyright 2016 Deutsche Telekom AG\r\n* Copyright 2016 Apizee\r\n* Copyright 2016 TECHNISCHE UNIVERSITAT BERLIN\r\n*\r\n* Licensed under the Apache License, Version 2.0 (the \"License\");\r\n* you may not use this file except in compliance with the License.\r\n* You may obtain a copy of the License at\r\n*\r\n*   http://www.apache.org/licenses/LICENSE-2.0\r\n*\r\n* Unless required by applicable law or agreed to in writing, software\r\n* distributed under the License is distributed on an \"AS IS\" BASIS,\r\n* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n* See the License for the specific language governing permissions and\r\n* limitations under the License.\r\n**/\r\n/**\r\n * Support module with some functions will be useful\r\n * @module utils\r\n */\r\n\r\n/**\r\n * @typedef divideURL\r\n * @type Object\r\n * @property {string} type The type of URL\r\n * @property {string} domain The domain of URL\r\n * @property {string} identity The identity of URL\r\n */\r\n\r\n/**\r\n * Divide an url in type, domain and identity\r\n * @param  {URL.URL} url - url address\r\n * @return {divideURL} the result of divideURL\r\n */\r\nfunction divideURL(url) {\r\n\r\n  function recurse(value) {\r\n    const regex = /([a-zA-Z-]*)(:\\/\\/(?:\\.)?|:)([-a-zA-Z0-9@:%._+~#=]{2,256})([-a-zA-Z0-9@:%._+~#=/]*)/gi;\r\n    const subst = '$1,$3,$4';\r\n    let parts = value.replace(regex, subst).split(',');\r\n    return parts;\r\n  }\r\n\r\n  let parts = recurse(url);\r\n\r\n  // If the url has no scheme\r\n  if (parts[0] === url && !parts[0].includes('@')) {\r\n\r\n    let result = {\r\n      type: '',\r\n      domain: url,\r\n      identity: ''\r\n    };\r\n\r\n    console.warn('[DivideURL] DivideURL don\\'t support url without scheme. Please review your url address', url);\r\n\r\n    return result;\r\n  }\r\n\r\n  // check if the url has the scheme and includes an @\r\n  if (parts[0] === url && parts[0].includes('@')) {\r\n    let scheme = parts[0] === url ? 'smtp' : parts[0];\r\n    parts = recurse(scheme + '://' + parts[0]);\r\n  }\r\n\r\n  // if the domain includes an @, divide it to domain and identity respectively\r\n  if (parts[1].includes('@')) {\r\n    parts[2] = parts[0] + '://' + parts[1];\r\n    parts[1] = parts[1].substr(parts[1].indexOf('@') + 1);\r\n  } \t/*else if (parts[2].includes('/')) {\r\n    parts[2] = parts[2].substr(parts[2].lastIndexOf('/')+1);\r\n  }*/\r\n\r\n  let result = {\r\n    type: parts[0],\r\n    domain: parts[1],\r\n    identity: parts[2]\r\n  };\r\n\r\n  return result;\r\n\r\n}\r\n\r\n/**\r\n * Check if an Object is empty\r\n * @param  {Object} object Object to be checked\r\n * @return {Boolean}       status of Object, empty or not (true|false);\r\n */\r\nfunction emptyObject(object) {\r\n  return Object.keys(object).length > 0 ? false : true;\r\n}\r\n\r\nfunction secondsSinceEpoch() {\r\n  return Math.floor(Date.now() / 1000);\r\n}\r\n\r\n\r\n/**\r\n * Make a COPY of the original data\r\n * @param  {Object}  obj - object to be cloned\r\n * @return {Object}\r\n */\r\nfunction deepClone(obj) {\r\n  //TODO: simple but inefficient JSON deep clone...\r\n  if (obj) return JSON.parse(JSON.stringify(obj));\r\n}\r\n\r\nfunction removePathFromURL(url) {\r\n  let splitURL = url.split('/');\r\n  return splitURL[0] + '//' + splitURL[2] + '/' + splitURL[3];\r\n}\r\n\r\n/**\r\n * Obtains the user URL that corresponds to a given email\r\n * @param  {string} userEmail The user email\r\n * @return {URL.URL} userURL The user URL\r\n */\r\nfunction getUserURLFromEmail(userEmail) {\r\n  let indexOfAt = userEmail.indexOf('@');\r\n  return 'user://' + userEmail.substring(indexOfAt + 1, userEmail.length) + '/' + userEmail.substring(0, indexOfAt);\r\n}\r\n\r\n/**\r\n * Obtains the user email that corresponds to a given URL\r\n * @param  {URL.URL} userURL The user URL\r\n * @return {string} userEmail The user email\r\n */\r\nfunction getUserEmailFromURL(userURL) {\r\n  let url = divideURL(userURL);\r\n  return url.identity.replace('/', '') + '@' + url.domain; // identity field has '/exampleID' instead of 'exampleID'\r\n}\r\n\r\n/**\r\n * Check if the user identifier is already in the URL format, if not, convert to URL format\r\n * @param  {string}   identifier  user identifier\r\n * @return {string}   userURL    the user URL\r\n */\r\nfunction convertToUserURL(identifier) {\r\n\r\n  // check if the identifier is already in the url format\r\n  if (identifier.substring(0, 7) === 'user://') {\r\n    let dividedURL = divideURL(identifier);\r\n\r\n    //check if the url is well formated\r\n    if (dividedURL.domain && dividedURL.identity) {\r\n      return identifier;\r\n    } else {\r\n      throw 'userURL with wrong format';\r\n    }\r\n\r\n  //if not, convert the user email to URL format\r\n  } else {\r\n    return getUserURLFromEmail(identifier);\r\n  }\r\n}\r\n\r\nfunction isDataObjectURL(url) {\r\n  let schemasToIgnore = ['domain-idp', 'runtime', 'domain', 'hyperty'];\r\n  let splitURL = (url).split('://');\r\n  let urlSchema = splitURL[0];\r\n\r\n  return schemasToIgnore.indexOf(urlSchema) === -1;\r\n}\r\n\r\nfunction utils_isLegacy(url) {\r\n  if (url.split('@').length > 1) {\r\n    return true;\r\n  } else {\r\n    return false;\r\n  }\r\n}\r\n\r\nfunction isURL(url) {\r\n  return (url).split('/').length >= 3;\r\n}\r\n\r\nfunction isUserURL(url) {\r\n  return divideURL(url).type === 'user';\r\n}\r\n\r\nfunction utils_isHypertyURL(url) {\r\n  return divideURL(url).type === 'hyperty';\r\n}\r\n\r\n/**\r\n * get information relative each component configured on runtime configuration;\r\n * @param  {object} configuration object with all configuration\r\n * @param  {string} component     string with the component to get the configuration, like, runtimeURLS, catalogueURLs, msgNodeURL, domainRegistryURL;\r\n * @param  {string} resource      type of resource to get, like, catalogue, runtimeUA, protocolstub, idpProxy\r\n * @return {object}               return an object with all configurations;\r\n */\r\nfunction getConfigurationResources(configuration, component, resource) {\r\n  let objectResource = configuration[component];\r\n  let resourceType = objectResource[resource];\r\n\r\n  return resourceType;\r\n}\r\n\r\n/**\r\n * Build a full url with the runtime configuration;\r\n * @param  {object} configuration object with all configuration\r\n * @param  {string} component     string with the component to get the configuration, like, runtimeURLS, catalogueURLs, msgNodeURL, domainRegistryURL;\r\n * @param  {string} resource      type of resource to get, like, catalogue, runtimeUA, protocolstub, idpProxy\r\n * @param  {string} type          resource to get, like a hyperty name or protocolstub name;\r\n * @param  {boolean} useFallback  if true the function will check if have a fallback url;\r\n * @return {string}               partial url to contact the resource;\r\n */\r\nfunction buildURL(configuration, component, type, resource, useFallback = false) {\r\n  let objectResource = configuration[component];\r\n  let url;\r\n\r\n  if (!objectResource.hasOwnProperty(type)) {\r\n    throw Error('The configuration ' + JSON.stringify(objectResource, '', 2) + ' don\\'t have the ' + type + ' resource you are looking for');\r\n  }\r\n\r\n  let resourceType = objectResource[type];\r\n\r\n\r\n  if (type) {\r\n    let ext = type === 'idp-proxy' ? '.idp.js' : '.ps.js';\r\n    url = resourceType.prefix + configuration.domain + resourceType.suffix + resource;\r\n    if (resourceType.hasOwnProperty('fallback') && useFallback) {\r\n      if (resourceType.fallback.indexOf('%domain%')) {\r\n        url = resourceType.fallback.replace(/(%domain%)/g, configuration.domain) + resource+ext;\r\n      } else {\r\n        url = resourceType.fallback + resource;\r\n      }\r\n    }\r\n  } else {\r\n    url = resourceType.prefix + configuration.domain + resourceType.suffix;\r\n  }\r\n\r\n  // console.log(url);\r\n\r\n  return url;\r\n}\r\n\r\n/**\r\n * Generate a Global Unique ID\r\n *\r\n * @returns String;\r\n */\r\nfunction generateGUID() {\r\n\r\n  function s4() {\r\n    return Math.floor((1 + Math.random()) * 0x10000)\r\n      .toString(16)\r\n      .substring(1);\r\n  }\r\n\r\n  return s4() + s4() + '-' + s4() + '-' + s4() + '-' + s4() + '-' + s4() + s4() + s4();\r\n\r\n}\r\n\r\nfunction getUserIdentityDomain(url) {\r\n  let dividedURL = divideURL(url);\r\n  let splitedDomain = dividedURL.domain.split('.');\r\n  let splitedLength = splitedDomain.length;\r\n  if (splitedLength == 1) {\r\n    return splitedDomain[splitedLength - 1];\r\n  }\r\n  let domain = splitedDomain[splitedLength - 2] + '.' + splitedDomain[splitedLength - 1];\r\n  return domain;\r\n}\r\n\r\n/**\r\n * Check if URL is from a backend service\r\n * @param  {string} url     URL to be processed\r\n * @return {boolean}\r\n */\r\n\r\nfunction isBackendServiceURL(url) {\r\n  let dividedURL = divideURL(url);\r\n  let splitedDomain = dividedURL.domain.split('.');\r\n  let backendSchemes = ['domain', 'global', 'domain-idp']; // should be defined in the runtime configuration\r\n  let backendSubDomains = ['registry', 'msg-node']; // should be defined in the runtime configuration\r\n  let subDomain;\r\n\r\n  if (splitedDomain.length > 1) {\r\n    subDomain = splitedDomain.filter(item => backendSubDomains.indexOf(item) !== -1)[0];\r\n  }\r\n\r\n  if (subDomain && backendSubDomains.indexOf(subDomain) !== -1) {\r\n    return true;\r\n  }\r\n\r\n  if (dividedURL.type) {\r\n    return (backendSchemes.indexOf(dividedURL.type) !== -1);\r\n  }\r\n\r\n  return false;\r\n}\r\n\r\nfunction divideEmail(email) {\r\n  let indexOfAt = email.indexOf('@');\r\n\r\n  let result = {\r\n    username: email.substring(0, indexOfAt),\r\n    domain: email.substring(indexOfAt + 1, email.length)\r\n  };\r\n\r\n  return result;\r\n}\r\n\r\n\r\nfunction utils_assign(obj, keyPath, value) {\r\n\r\n  if (!obj) obj = {};\r\n  if (typeof(keyPath) === 'string') keyPath = parseAttributes(keyPath);\r\n\r\n  let lastKeyIndex = keyPath.length - 1;\r\n\r\n  for (var i = 0; i < lastKeyIndex; ++i) {\r\n    let key = keyPath[i];\r\n    if (!(key in obj)) {\r\n      obj[key] = {};\r\n    }\r\n\r\n    obj = obj[key];\r\n\r\n  }\r\n\r\n  obj[keyPath[lastKeyIndex]] = value;\r\n}\r\n\r\nfunction splitObjectURL(dataObjectURL) {\r\n  console.info('[utils - splitObjectURL]: ', dataObjectURL);\r\n\r\n  let splitedURL = dataObjectURL.split('/');\r\n  let url = splitedURL[0] + '//' + splitedURL[2] + '/' + splitedURL[3];\r\n  let resource = splitedURL[5];\r\n\r\n  let result = {\r\n    url: url,\r\n    resource: resource\r\n  };\r\n\r\n  console.info('[utils - splitObjectURL]: ', result);\r\n\r\n  return result;\r\n}\r\n\r\nfunction checkAttribute(path) {\r\n\r\n  let regex = /((([a-zA-Z]+):\\/\\/([0-9a-zA-Z][-\\w]*[0-9a-zA-Z]\\.)+[a-zA-Z]{2,9})\\/[a-zA-Z0-9.]+@[a-zA-Z0-9]+(-)?[a-zA-Z0-9]+(\\.)?[a-zA-Z0-9]{2,10}?\\.[a-zA-Z]{2,10})(.+(?=.identity))?/gm;\r\n\r\n  let list = [];\r\n  let final = [];\r\n  let test = path.match(regex);\r\n\r\n  if (test == null) {\r\n    final = path.split('.');\r\n  } else {\r\n    let m;\r\n    while ((m = regex.exec(path)) !== null) {\r\n      // This is necessary to avoid infinite loops with zero-width matches\r\n      if (m.index === regex.lastIndex) {\r\n        regex.lastIndex++;\r\n      }\r\n\r\n      // The result can be accessed through the `m`-variable.\r\n      m.forEach((match, groupIndex) => {\r\n        if (groupIndex === 0) {\r\n          list.push(match);\r\n        }\r\n      });\r\n    }\r\n    let result;\r\n    list.forEach((url) => {\r\n\r\n      result = path.replace(url, '*-*');\r\n      final = result.split('.').map((item) => {\r\n\r\n        if (item === '*-*') { return url; }\r\n\r\n        return item;\r\n      });\r\n    });\r\n  }\r\n\r\n  console.log('[RuntimeCore.Utils.checkAttribute]', final);\r\n  return final;\r\n}\r\n\r\nfunction parseAttributes(path) {\r\n  let regex = /([0-9a-zA-Z][-\\w]*):\\/\\//g;\r\n\r\n  let string3 = 'identity';\r\n\r\n  if (!path.includes('://')) {\r\n    return (path.split('.'));\r\n  } else {\r\n    let string1 = path.split(regex)[0];\r\n\r\n    let array1 = string1.split('.');\r\n\r\n    let string2 = path.replace(string1, '');\r\n\r\n    if (path.includes(string3)) {\r\n\r\n      let array2 = string2.split(string3 + '.');\r\n\r\n      console.log('array2 ' + array2);\r\n\r\n      string2 = array2[0].slice('.', -1);\r\n\r\n      array2 = array2[1].split('.');\r\n\r\n      array1.push(string2, string3);\r\n\r\n      array1 = array1.concat(array2);\r\n\r\n    } else {\r\n      array1.push(string2);\r\n\r\n    }\r\n\r\n    return (array1.filter(Boolean));\r\n\r\n  }\r\n\r\n}\r\n\r\nfunction isEmpty(obj) {\r\n  for (var prop in obj) {\r\n\r\n    if (obj.hasOwnProperty(prop)) {\r\n      return false;\r\n    }\r\n\r\n  }\r\n\r\n  return JSON.stringify(obj) === JSON.stringify({});\r\n}\r\n\r\nfunction chatkeysToStringCloner(sessionKeys) {\r\n  let dataObjectSessionKeysClone = {};\r\n  let fields = Object.keys(sessionKeys);\r\n  if (fields) {\r\n    try {\r\n      for (let i = 0; i <  fields.length; i++) {\r\n        let field = fields[i];\r\n        dataObjectSessionKeysClone[field] = {};\r\n        dataObjectSessionKeysClone[field].sessionKey = sessionKeys[field].sessionKey.toString();\r\n        dataObjectSessionKeysClone[field].isToEncrypt = sessionKeys[field].isToEncrypt;\r\n      }\r\n    } catch (err) {\r\n      console.error('_chatkeysToStringCloner:err', err);\r\n    }\r\n  }\r\n  return dataObjectSessionKeysClone;\r\n}\r\n\r\nfunction chatkeysToArrayCloner(sessionKeys) {\r\n  let dataObjectSessionKeysClone = {};\r\n  let fields = Object.keys(sessionKeys);\r\n  if (fields) {\r\n    try {\r\n      for (let i = 0; i <  fields.length; i++) {\r\n        let field = fields[i];\r\n        dataObjectSessionKeysClone[field] = {};\r\n        let arrayValues = JSON.parse('[' + sessionKeys[field].sessionKey + ']');\r\n        dataObjectSessionKeysClone[field].sessionKey = new Uint8Array(arrayValues);\r\n        dataObjectSessionKeysClone[field].isToEncrypt = sessionKeys[field].isToEncrypt;\r\n      }\r\n    } catch (err) {\r\n      console.error('_chatkeysToArrayCloner:err', err);\r\n    }\r\n  }\r\n  return dataObjectSessionKeysClone;\r\n}\r\n\r\nfunction parseMessageURL(URL) {\r\n  let splitedToURL = URL.split('/');\r\n  if (splitedToURL.length <= 6) {\r\n    return splitedToURL[0] + '//' + splitedToURL[2] + '/' + splitedToURL[3];\r\n  } else {\r\n    return splitedToURL[0] + '//' + splitedToURL[2] + '/' + splitedToURL[3] + '/' + splitedToURL[4];\r\n  }\r\n}\r\n\r\nfunction availableSpace(usage, quota) {\r\n  const available = (usage / quota).toFixed(2);\r\n  return {\r\n    quota: quota,\r\n    usage: usage,\r\n    percent: Number(available)\r\n  };\r\n}\r\n\r\n/**\r\n* Encodes a JS object to base 64 encode\r\n* @param   {Object}    value    byteArray value\r\n* @return  {string}   encoded value\r\n*/\r\nfunction encode(value) {\r\n  try {\r\n    let stringValue = stringify(value);\r\n    return btoa(stringValue);\r\n  } catch (err) {\r\n    console.error('[Utils.encode:err] ' + err);\r\n    throw err;\r\n  }\r\n}\r\n\r\n/**\r\n  * Decode a base64 string to object\r\n  * @param   {string_b64}    value    value encoded in base 64\r\n  * @return  {Object} decodedValue\r\n  */\r\nfunction decode(value) {\r\n  try {\r\n    return JSON.parse(atob(value));\r\n  } catch (err) {\r\n    console.log('[Utils.decode:err] ' + err);\r\n    throw err;\r\n  }\r\n}\r\n\r\n/**\r\n* Decode a base64 string to Uint8Array\r\n* @param   {string_b64}    value    byteArray value\r\n* @return  {Uint8Array}   encoded value\r\n*/\r\nfunction decodeToUint8Array(value) {\r\n  try {\r\n    return new Uint8Array(decode(value));\r\n  } catch (err) {\r\n    console.error('[Utils.decodeToUint8Array:err] ' + err);\r\n    throw err;\r\n  }\r\n}\r\n\r\n/**\r\n* Converts a JS object to string\r\n* NOTE: Special conversion for Uint8Arrays\r\n* @param   {Object}    value    byteArray value\r\n* @return  {Uint8Array}   encoded value\r\n*/\r\nfunction stringify(value) {\r\n  try {\r\n    let stringValue;\r\n    if (value.constructor === Uint8Array) {\r\n      stringValue = '[' + value.toString() + ']'; // the [] is for JSON.parse compatibility\r\n    } else {\r\n      stringValue = JSON.stringify(value);\r\n    }\r\n    return stringValue;\r\n  } catch (err) {\r\n    console.error('[Utils.stringify:err] ' + err);\r\n    throw err;\r\n  }\r\n}\r\n\r\n/**\r\n* Converts a stringified object to object\r\n* @param   {String}    value    byteArray value\r\n* @return  {Object}   encoded value\r\n*/\r\nfunction parse(value) {\r\n  try {\r\n    return JSON.parse(value);\r\n  } catch (err) {\r\n    console.error('[Utils.parse:err]' + err);\r\n    console.trace();\r\n    console.error('That that cause the error:', value);\r\n    throw err;\r\n  }\r\n}\r\n\r\n/**\r\n* Converts a stringified object to object\r\n* @param   {String}    value    byteArray value\r\n* @return  {Uint8Array}   encoded value\r\n*/\r\nfunction parseToUint8Array(value) {\r\n  try {\r\n    return new Uint8Array(parse(value));\r\n  } catch (err) {\r\n    console.error('[Utils.parseToUint8Array:err]' + err);\r\n    throw err;\r\n  }\r\n}\r\n\n// EXTERNAL MODULE: ./node_modules/proxy-observe/index.js\nvar proxy_observe = __webpack_require__(89);\n\n// CONCATENATED MODULE: ./src/syncher/ProxyObject.js\n\r\n\r\n\r\nconst ProxyObject_objectType = {ARRAY: '[object Array]', OBJECT: '[object Object]' };\r\n\r\n/**\r\n * @access private\r\n * Main class that maintains a JSON object, and observes changes in this object, recursively.\r\n * Internal objects and arrays are also observed.\r\n */\r\nclass ProxyObject_SyncObject {\r\n\r\n  constructor(initialData) {\r\n    let _this = this;\r\n\r\n    _this._observers = [];\r\n    _this._filters = {};\r\n\r\n    this._data = initialData || {};\r\n\r\n    this._internalObserve(this._data);\r\n  }\r\n\r\n  get data() { return this._data; }\r\n\r\n  observe(callback) {\r\n    this._observers.push(callback);\r\n  }\r\n\r\n  find(path) {\r\n    let list = parseAttributes(path);\r\n\r\n    return this._findWithSplit(list);\r\n  }\r\n\r\n  findBefore(path) {\r\n    let result = {};\r\n    let list = parseAttributes(path);\r\n    result.last = list.pop();\r\n    result.obj = this._findWithSplit(list);\r\n\r\n    return result;\r\n  }\r\n\r\n  _findWithSplit(list) {\r\n    let obj = this._data;\r\n    list.forEach((value) => {\r\n      obj = obj[value];\r\n    });\r\n\r\n    return obj;\r\n  }\r\n\r\n  _internalObserve(object) {\r\n\r\n    let handler = (changeset) => {\r\n\r\n      changeset.every((change) => {\r\n        this._onChanges(change);\r\n      });\r\n\r\n    };\r\n\r\n    this._data = Object.deepObserve(object, handler);\r\n\r\n  }\r\n\r\n  _fireEvent(event) {\r\n    this._observers.forEach((callback) => {\r\n      callback(event);\r\n    });\r\n  }\r\n\r\n  _onChanges(change) {\r\n\r\n    let obj = change.object;\r\n    let objType;\r\n\r\n    if (obj.constructor === Object) {\r\n      objType = ObjectType.OBJECT;\r\n    }\r\n\r\n    if (obj.constructor === Array) {\r\n      objType = ObjectType.ARRAY;\r\n    }\r\n\r\n    let fieldString = change.keypath;\r\n\r\n    // console.log('Field:', fieldString);\r\n    // console.log('type:', change.type);\r\n\r\n    //let oldValue = change.oldValue;\r\n    let newValue = obj[change.name];\r\n\r\n    // console.info(change.type + ' | Field: ' + fieldString + ' | New Value:', JSON.stringify(newValue), fieldString.includes('length'));\r\n\r\n    if (change.type === 'update' && !fieldString.includes('.length')) {\r\n      this._fireEvent({\r\n        cType: ChangeType.UPDATE,\r\n        oType: objType,\r\n        field: fieldString,\r\n        data: newValue\r\n      });\r\n    }\r\n\r\n    if (change.type === 'add') {\r\n      this._fireEvent({\r\n        cType: ChangeType.ADD,\r\n        oType: objType,\r\n        field: fieldString,\r\n        data: newValue\r\n      });\r\n    }\r\n\r\n    if (change.type === 'delete') {\r\n      this._fireEvent({\r\n        cType: ChangeType.REMOVE,\r\n        oType: objType,\r\n        field: fieldString\r\n      });\r\n    }\r\n  }\r\n\r\n}\r\n\r\nlet ChangeType = {UPDATE: 'update', ADD: 'add', REMOVE: 'remove'};\r\nlet ObjectType = {OBJECT: 'object', ARRAY: 'array'};\r\n/* harmony default export */ var ProxyObject = (ProxyObject_SyncObject);\r\n\n// CONCATENATED MODULE: ./src/syncher/DataObjectChild.js\n/**\r\n* Copyright 2016 PT Inovação e Sistemas SA\r\n* Copyright 2016 INESC-ID\r\n* Copyright 2016 QUOBIS NETWORKS SL\r\n* Copyright 2016 FRAUNHOFER-GESELLSCHAFT ZUR FOERDERUNG DER ANGEWANDTEN FORSCHUNG E.V\r\n* Copyright 2016 ORANGE SA\r\n* Copyright 2016 Deutsche Telekom AG\r\n* Copyright 2016 Apizee\r\n* Copyright 2016 TECHNISCHE UNIVERSITAT BERLIN\r\n*\r\n* Licensed under the Apache License, Version 2.0 (the \"License\");\r\n* you may not use this file except in compliance with the License.\r\n* You may obtain a copy of the License at\r\n*\r\n*   http://www.apache.org/licenses/LICENSE-2.0\r\n*\r\n* Unless required by applicable law or agreed to in writing, software\r\n* distributed under the License is distributed on an \"AS IS\" BASIS,\r\n* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n* See the License for the specific language governing permissions and\r\n* limitations under the License.\r\n**/\r\n// Log System\r\n\r\nlet DataObjectChild_log = loglevel[\"getLogger\"]('DataObjectChild');\r\n\r\n\r\n\r\n\r\n\r\n/**\r\n * The class returned from the DataObject addChildren call or from onAddChildren if remotely created.\r\n */\r\nclass DataObjectChild_DataObjectChild /* implements SyncStatus */ {\r\n  /* private\r\n\r\n  ----event handlers----\r\n  _onResponseHandler: (event) => void\r\n  */\r\n\r\n  /**\r\n   * @ignore\r\n   * Should not be used directly by Hyperties. It's called by the DataObject.addChild\r\n   */\r\n  constructor(input) {\r\n    let _this = this;\r\n\r\n    function throwMandatoryParmMissingError(par) {\r\n      throw '[DataObjectChild] ' + par + ' mandatory parameter is missing';\r\n    }\r\n\r\n    input.parent ?  _this._parent = input.parent : throwMandatoryParmMissingError('parent');\r\n    input.url ?  _this._url = input.url : throwMandatoryParmMissingError('url');\r\n    input.created ? _this._created = input.created : throwMandatoryParmMissingError('created');\r\n    input.reporter ? _this._reporter = input.reporter : throwMandatoryParmMissingError('reporter');\r\n    input.runtime ? _this._runtime = input.runtime : throwMandatoryParmMissingError('runtime');\r\n    input.schema ? _this._schema = input.schema : throwMandatoryParmMissingError('schema');\r\n    input.parentObject ? _this._parentObject = input.parentObject : throwMandatoryParmMissingError('parentObject');\r\n\r\n    if (input.name) _this._name = input.name;\r\n    if (input.description) _this._description = input.description;\r\n    if (input.tags) _this._tags = input.tags;\r\n    if (input.resources) _this._resources = input.resources;\r\n    if (input.observerStorage) _this._observerStorage = input.observerStorage;\r\n    if (input.publicObservation) _this._publicObservation = input.publicObservation;\r\n\r\n    _this._childId = input.url;\r\n\r\n    if (input.data) {\r\n      _this._syncObj = new ProxyObject(input.data);\r\n    } else {\r\n      _this._syncObj = new ProxyObject({});\r\n    }\r\n\r\n    DataObjectChild_log.log('[DataObjectChild -  Constructor] - ', _this._syncObj);\r\n\r\n    _this._bus = _this._parentObject._bus;\r\n    _this._owner = _this._parentObject._owner;\r\n\r\n    _this._allocateListeners();\r\n\r\n    _this._metadata = input;\r\n\r\n    // delete _this._metadata.data;\r\n    delete _this._metadata.parentObject;\r\n\r\n    _this._sharingStatus = false;\r\n\r\n  }\r\n\r\n  get shareable() {\r\n    let shareable = this.metadata;\r\n    shareable.data = this.data;\r\n\r\n    return shareable;\r\n  }\r\n\r\n  /**\r\n   * This function is used to share the child Object among authorised Hyperties\r\n   * @param  {boolean}     reporter  If true the child object is only shared to Parent reporter\r\n   * @return {Promise<JSON>}        It returns a promise with the sharing results.\r\n   */\r\n\r\n  share(toReporter) {\r\n    let _this = this;\r\n\r\n    _this._sharingStatus = new Promise((resolve, reject) => {\r\n\r\n      let to;\r\n      let reporter = toReporter;\r\n\r\n      if (reporter) {\r\n        to = _this.metadata.parent;\r\n      } else to = _this.metadata.parent + '/children/';\r\n\r\n      let childValue = _this.metadata;\r\n      childValue.data = _this.data;\r\n\r\n      //FLOW-OUT: this message will be sent directly to a resource child address: MessageBus\r\n      let requestMsg = {\r\n        type: 'create', from: _this.metadata.reporter, to: to,\r\n        body: { resource: childValue.url, value: childValue }\r\n      };\r\n\r\n      if (_this.identity)      {\r\n        requestMsg.body.identity = _this.identity;\r\n      }\r\n\r\n      //to be used to disable mutual authentication for legacy users\r\n\r\n      if (_this._parentObject.data.hasOwnProperty('mutual')) requestMsg.body.mutual = _this._parentObject.data.mutual;\r\n\r\n      if (_this._parentObject.metadata.reporter === _this.metadata.reporter) {\r\n        _this._bus.postMessage(deepClone(requestMsg));\r\n        return resolve();\r\n      } else {\r\n\r\n        let callback = (reply) => {\r\n\r\n          if (reply.to === _this._reporter) {\r\n            _this._bus.removeResponseListener(requestMsg.from, reply.id);\r\n\r\n            DataObjectChild_log.log('[Syncher.DataObjectChild.share] Parent reporter reply ', reply);\r\n\r\n            let result = {\r\n              code: reply.body && reply.body.code ? reply.body.code : 500,\r\n              desc: reply.body && reply.body.desc ? reply.body.desc : 'Unknown'\r\n            };\r\n\r\n            if (reply.body.code < 300) {\r\n              return resolve(result);\r\n            } else return reject(result);\r\n\r\n          }\r\n        };\r\n\r\n        let id = _this._bus.postMessage(deepClone(requestMsg), callback, false);\r\n\r\n        setTimeout(()=> {\r\n\r\n          // If Reporter does  not reply the promise is rejected\r\n          _this._bus.removeResponseListener(requestMsg.from, id);\r\n\r\n          let result = {\r\n            code: 408,\r\n            desc: 'timout'\r\n          };\r\n          return reject(result);\r\n\r\n        }, 3000);\r\n\r\n      }\r\n    });\r\n\r\n  }\r\n\r\n  /**\r\n     * This function is used to share the child Object among authorised Hyperties\r\n     * @param  {boolean}     reporter  If true the child object is only shared to Parent reporter\r\n     * @return {Promise<JSON>}        It returns a promise with the sharing results.\r\n     */\r\n\r\n  store() {\r\n    let _this = this;\r\n\r\n    let child = {};\r\n    let key = _this.metadata.children + '.' + _this.metadata.url;\r\n\r\n    child.value = _this.metadata;\r\n    child.identity = _this.identity;\r\n\r\n    let msg = {\r\n\r\n      from: _this.metadata.reporter,\r\n      to: _this._parentObject._syncher._subURL,\r\n      type: 'create',\r\n      body: {\r\n        resource: _this.metadata.parent,\r\n        attribute: key,\r\n        value: child\r\n      }\r\n    };\r\n\r\n    DataObjectChild_log.log('[DataObjectChild.store]:', msg);\r\n\r\n    _this._bus.postMessage(msg);\r\n  }\r\n\r\n  _allocateListeners() {\r\n    let _this = this;\r\n\r\n    //this is only needed for children reporters\r\n    if (_this._reporter === _this._owner) {\r\n      _this._listener = _this._bus.addListener(_this._reporter, (msg) => {\r\n        if (msg.type === 'response' && msg.id === _this._msgId) {\r\n          DataObjectChild_log.log('DataObjectChild.onResponse:', msg);\r\n          _this._onResponse(msg);\r\n        }\r\n      });\r\n    }\r\n  }\r\n\r\n  _releaseListeners() {\r\n    let _this = this;\r\n\r\n    if (_this._listener) {\r\n      _this._listener.remove();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Release and delete object data\r\n   */\r\n  delete() {\r\n    let _this = this;\r\n\r\n\r\n    _this._releaseListeners();\r\n\r\n    //TODO: send delete message ?\r\n\r\n    // nothing to be done\r\n    // return new Promise((resolve) => {\r\n    //   log.log('[DataObjectChild.delete]');\r\n    //   resolve();\r\n    // });\r\n  }\r\n\r\n  /**\r\n   * All Metadata about the Child Data Object\r\n   * @type {Object} -\r\n   */\r\n  get metadata() { return this._metadata; }\r\n\r\n  /**\r\n   * Children ID generated on addChildren. Unique identifier\r\n   * @type {URL} - URL of the format <HypertyURL>#<numeric-sequence>\r\n   */\r\n  get childId() { return this._childId; }\r\n\r\n  /**\r\n   * Data Structure to be synchronized.\r\n   * @type {JSON} - JSON structure that should follow the defined schema, if any.\r\n   */\r\n\r\n  get sharingStatus() {\r\n    return this._sharingStatus;\r\n  }\r\n\r\n  /**\r\n    * Data Structure to be synchronized.\r\n    * @type {JSON} - JSON structure that should follow the defined schema, if any.\r\n    */\r\n\r\n  get data() { return this._syncObj.data; }\r\n\r\n  /**\r\n   * Set for this dataObjectChild an identity\r\n   * @method identity\r\n   * @param  {Identity} identity identity from who created the message\r\n   */\r\n  set identity(identity) { this._identity = identity; }\r\n\r\n  /**\r\n   * Get for this dataObjectChild an identity\r\n   * @method identity\r\n   * @return {Identity} identity from who created the message\r\n   */\r\n  get identity() { return this._identity; }\r\n\r\n  /**\r\n   * Register the change listeners sent by the reporter child\r\n   * @param {function(event: MsgEvent)} callback\r\n   */\r\n  onChange(callback) {\r\n    this._syncObj.observe((event) => {\r\n      DataObjectChild_log.log('[DataObjectChild - observer] - ', event);\r\n      callback(event);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Setup the callback to process response notifications of the creates\r\n   * @param {function(event: MsgEvent)} callback\r\n   */\r\n  onResponse(callback) {\r\n    this._onResponseHandler = callback;\r\n  }\r\n\r\n  //FLOW-IN: message received from a remote DataObject -> _onChildCreate\r\n  _onResponse(msg) {\r\n    let _this = this;\r\n\r\n    let event = {\r\n      type: msg.type,\r\n      url: msg.body.source,\r\n      code: msg.body.code\r\n    };\r\n\r\n    if (_this._onResponseHandler) {\r\n      _this._onResponseHandler(event);\r\n    }\r\n  }\r\n\r\n}\r\n\r\n/* harmony default export */ var syncher_DataObjectChild = (DataObjectChild_DataObjectChild);\r\n\n// CONCATENATED MODULE: ./src/hyperty-resource/HypertyResource.js\n/**\r\n* The Hyperty Resource Data Model is used to model resouces handled by Hyperties and Data Objects including chat messages, files, real time human audio and video..\r\n*\r\n*/\r\n\r\n// Log System\r\n\r\nlet HypertyResource_log = loglevel[\"getLogger\"]('HypertyResource');\r\n\r\n\r\n\r\n\r\nclass HypertyResource_HypertyResource extends syncher_DataObjectChild {\r\n\r\n  /**\r\n  * HypertyResource constructor\r\n  *\r\n  * @param  {URL} localRuntimeURL RuntimeURL of local runtime\r\n  * @param  {URL} input.owner HypertyURL of the Hyperty handling this resource\r\n  * @param  {URL} input.runtime Runtime URL where this resource is hosted\r\n  * @param  {Bus} input.bus sandbox message bus\r\n  * @param  {DataObject} input.parent Parent Data Object where the HypertyResource is handled as a child\r\n  * @param  {Boolean} isSender indicates if parent is Reporter or an Observer\r\n  * @param  {Array} input optional input parameters\r\n  */\r\n\r\n  constructor(isSender, input) {\r\n    super(input);\r\n    let _this = this;\r\n\r\n    _this.arraybufferSizeLimit = 5242880; //above this limit content is not saved as ArrayBuffer\r\n\r\n    _this._isSender = isSender;\r\n\r\n    _this._localStorageURL = _this._parentObject._syncher._runtimeUrl + '/storage';\r\n\r\n  }\r\n\r\n  get resourceType() {\r\n    let _this = this;\r\n    return _this.metadata.resourceType;\r\n  }\r\n\r\n  get mimetype() {\r\n    let _this = this;\r\n    return _this._metadata.type;\r\n  }\r\n\r\n  get content() {\r\n    let _this = this;\r\n    return _this._content;\r\n  }\r\n\r\n  get contentURL() {\r\n    let _this = this;\r\n    return _this._metadata.contentURL;\r\n  }\r\n\r\n  get shareable() {\r\n    let _this = this;\r\n    let shareable = super.metadata;\r\n    shareable.resourceType = _this.resourceType;\r\n    return shareable;\r\n  }\r\n\r\n  /*\r\n  set parent(parent) {\r\n    let _this = this;\r\n    _this._parent = parent;\r\n  }*/\r\n\r\n  save() {\r\n    let _this = this;\r\n\r\n    return new Promise(function(resolve, reject) {\r\n\r\n      let msg = {\r\n        from: _this._owner,\r\n        to: _this._localStorageURL,\r\n        type: 'create',\r\n        body: { value: deepClone(_this._metadata) }\r\n      };\r\n\r\n      let callback = (reply) => {\r\n        HypertyResource_log.info('[HypertyResource.save] reply: ', reply);\r\n        _this._bus.removeResponseListener(_this._owner, reply.id);\r\n        if (reply.body.code === 200) {\r\n          if (reply.body.value) {\r\n            if (!_this._metadata.contentURL) _this._metadata.contentURL = [];\r\n            _this._metadata.contentURL.push(reply.body.value);\r\n          }\r\n          resolve();\r\n        } else reject(reply.body.code + ' ' + reply.body.desc);\r\n\r\n      };\r\n\r\n      msg.body.value.content = _this._content;\r\n\r\n      _this._bus.postMessage(msg, callback, false);\r\n\r\n    });\r\n\r\n  }\r\n\r\n  /**\r\n  * Function to Read HypertyResource\r\n  *\r\n  * @param  {} callback callback to be called with progress information in terms of percentage\r\n  * @return  {Promise}  input optional input parameters\r\n  */\r\n\r\n\r\n  read(callback) {\r\n    let _this = this;\r\n    HypertyResource_log.info('[HypertyResource.read] ', this);\r\n\r\n    return new Promise(function(resolve, reject) {\r\n\r\n      if (_this.content) {\r\n        resolve(_this);\r\n      } else {\r\n\r\n        //TODO: use an iteration to get online runtime storages when some are offline\r\n        let storage = _this._getBestContentURL(_this._metadata.contentURL);\r\n\r\n        HypertyResource_log.log('Storage:', storage);\r\n\r\n        let msg = {\r\n          from: _this._owner,\r\n          to: storage.url,\r\n          type: 'read',\r\n          body: { resource: storage.url + '/' + storage.resource, p2p: true }\r\n        };\r\n\r\n        if (_this.metadata.p2pRequester && _this.metadata.p2pHandler) {\r\n          msg.body.p2pRequester = _this.metadata.p2pRequester;\r\n          msg.body.p2pHandler = _this.metadata.p2pHandler;\r\n        }\r\n\r\n        // get the resource first on the Local Hyperty Resource Storage;\r\n        _this._getBestResource(msg, callback).then((reply) => {\r\n          HypertyResource_log.info('[HypertyResource] - get locally the resource:', reply);\r\n          resolve(_this);\r\n        }).catch((reply) => {\r\n\r\n          HypertyResource_log.warn('[HypertyResource] - get locally the resource fail', reply);\r\n\r\n          // Generate new message to not use the same id of the last one;\r\n          let msg = {\r\n            from: _this._owner,\r\n            to: storage.remoteURL,\r\n            type: 'read',\r\n            body: { resource: storage.remoteURL + '/' + storage.resource, p2p: true }\r\n          };\r\n\r\n          if (_this.metadata.p2pRequester && _this.metadata.p2pHandler) {\r\n            msg.body.p2pRequester = _this.metadata.p2pRequester;\r\n            msg.body.p2pHandler = _this.metadata.p2pHandler;\r\n          }\r\n\r\n          // get the resource on the Remote Hyperty Resource Storage;\r\n          _this._getBestResource(msg, callback).then((reply) => {\r\n            HypertyResource_log.warn('[HypertyResource] - get remotely the resource', reply);\r\n            resolve(_this);\r\n          }).catch((reply) => {\r\n            HypertyResource_log.warn('[HypertyResource] - get remotely the resource fail', reply);\r\n            reject(reply.body.code + ' ' + reply.body.desc);\r\n          });\r\n\r\n        });\r\n\r\n      }\r\n    });\r\n  }\r\n\r\n  _getBestResource(msg, inProgressCallback) {\r\n    let _this = this;\r\n\r\n    return new Promise((resolve, reject) => {\r\n\r\n      let waitForResponse = setTimeout(() => {\r\n\r\n        // If Reporter does  not reply the promise is rejected\r\n        _this._bus.removeResponseListener(_this._owner, id);\r\n\r\n        msg.body.code = 408;\r\n        msg.body.desc = 'Response timeout'\r\n\r\n        return reject(msg);\r\n\r\n      }, 3000);\r\n\r\n      let callback = (reply) => {\r\n        HypertyResource_log.log('[HypertyResource.read] reply: ', reply);\r\n        let id = reply.id;\r\n\r\n        clearTimeout(waitForResponse);\r\n\r\n        switch (reply.body.code) {\r\n          case 200:\r\n            _this._content = reply.body.value.content;\r\n\r\n            // save locally if not too big\r\n            if (reply.body.value.size < _this.arraybufferSizeLimit) {\r\n              _this.save();\r\n            }\r\n\r\n            _this._bus.removeResponseListener(_this._owner, id);\r\n            resolve(reply);\r\n\r\n            break;\r\n\r\n          case 183:\r\n            inProgressCallback(reply.body.value);\r\n            break;\r\n\r\n          default:\r\n            _this._bus.removeResponseListener(_this._owner, id);\r\n            reject(reply);\r\n            break;\r\n        }\r\n\r\n      };\r\n\r\n      let id = _this._bus.postMessage(msg, callback, false);\r\n\r\n    });\r\n\r\n  }\r\n\r\n  // Remove Hyperty from the local storage\r\n\r\n  delete() {\r\n    let _this = this;\r\n\r\n    HypertyResource_log.info('[HypertyResource.delete]', _this.metadata);\r\n\r\n\r\n    let msg = {\r\n      from: _this._owner,\r\n      to: _this._localStorageURL,\r\n      type: 'delete',\r\n      body: { resources: _this.metadata.contentURL }\r\n    };\r\n\r\n    return new Promise((resolve) => {\r\n      _this._bus.postMessage(msg, (reply) => {\r\n        if (reply.body.code < 300) resolve(true);\r\n        else resolve(false);\r\n      });\r\n    });\r\n  }\r\n\r\n  _getBestContentURL(contentURLList) {\r\n\r\n    let _this = this;\r\n\r\n    const contentURL = contentURLList[0];\r\n    const splitedResource = contentURL.substr(contentURL.lastIndexOf('/') + 1);\r\n    const url = _this._localStorageURL; // contentURL.substr(0, contentURL.lastIndexOf('/'));\r\n    const remoteResource = contentURL.substr(0, contentURL.lastIndexOf('/'));\r\n\r\n    return {url: url, resource: splitedResource, remoteURL: remoteResource };\r\n\r\n  }\r\n\r\n}\r\n\r\n\r\n/* harmony default export */ var hyperty_resource_HypertyResource = (HypertyResource_HypertyResource);\r\n\n// CONCATENATED MODULE: ./src/utils/ImageTools.js\nlet hasBlobConstructor = typeof(Blob) !== 'undefined' && (function () {\r\n    try {\r\n        return Boolean(new Blob());\r\n    } catch (e) {\r\n        return false;\r\n    }\r\n}());\r\n\r\nlet hasArrayBufferViewSupport = hasBlobConstructor && typeof(Uint8Array) !== 'undefined' && (function () {\r\n    try {\r\n        return new Blob([new Uint8Array(100)]).size === 100;\r\n    } catch (e) {\r\n        return false;\r\n    }\r\n}());\r\n\r\nlet hasToBlobSupport = (typeof HTMLCanvasElement !== \"undefined\" ? HTMLCanvasElement.prototype.toBlob : false);\r\n\r\nlet hasBlobSupport = (hasToBlobSupport || (typeof Uint8Array !== 'undefined' && typeof ArrayBuffer !== 'undefined' && typeof atob !== 'undefined'));\r\n\r\nlet hasReaderSupport = (typeof FileReader !== 'undefined' || typeof URL !== 'undefined');\r\n\r\nclass ImageTools {\r\n    static resize(file, maxDimensions, callback) {\r\n        if (typeof maxDimensions === 'function') {\r\n            callback = maxDimensions;\r\n            maxDimensions = {\r\n                width: 640,\r\n                height: 480\r\n            };\r\n        }\r\n\r\n        let maxWidth  = maxDimensions.width;\r\n        let maxHeight = maxDimensions.height;\r\n\r\n        if (!ImageTools.isSupported() || !file.type.match(/image.*/)) {\r\n            callback(file, false);\r\n            return false;\r\n        }\r\n\r\n        if (file.type.match(/image\\/gif/)) {\r\n            // Not attempting, could be an animated gif\r\n            callback(file, false);\r\n            // TODO: use https://github.com/antimatter15/whammy to convert gif to webm\r\n            return false;\r\n        }\r\n\r\n        let image = document.createElement('img');\r\n            \r\n        image.onload = (imgEvt) => {\r\n            let width  = image.width;\r\n            let height = image.height;\r\n            let isTooLarge = false;\r\n\r\n            if (width >= height && width > maxDimensions.width) {\r\n                // width is the largest dimension, and it's too big.\r\n                height *= maxDimensions.width / width;\r\n                width = maxDimensions.width;\r\n                isTooLarge = true;\r\n            } else if (height > maxDimensions.height) {\r\n                // either width wasn't over-size or height is the largest dimension\r\n                // and the height is over-size\r\n                width *= maxDimensions.height / height;\r\n                height = maxDimensions.height;\r\n                isTooLarge = true;\r\n            }\r\n\r\n            if (!isTooLarge) {\r\n                // early exit; no need to resize\r\n                callback(file, false);\r\n                return;\r\n            }\r\n\r\n            let canvas = document.createElement('canvas');\r\n            canvas.width = width;\r\n            canvas.height = height;\r\n\r\n            let ctx = canvas.getContext('2d');\r\n            ctx.drawImage(image, 0, 0, width, height);\r\n\r\n            if (hasToBlobSupport) {\r\n                canvas.toBlob((blob) => {\r\n                    callback(blob, true);\r\n                }, file.type);\r\n            } else {\r\n                let blob = ImageTools._toBlob(canvas, file.type);\r\n                callback(blob, true);\r\n            }\r\n        };\r\n        ImageTools._loadImage(image, file);\r\n\r\n        return true;\r\n    }\r\n\r\n    static _toBlob(canvas, type) {\r\n        let dataURI = canvas.toDataURL(type);\r\n        let dataURIParts = dataURI.split(',');\r\n        let byteString;\r\n        if (dataURIParts[0].indexOf('base64') >= 0) {\r\n            // Convert base64 to raw binary data held in a string:\r\n            byteString = atob(dataURIParts[1]);\r\n        } else {\r\n            // Convert base64/URLEncoded data component to raw binary data:\r\n            byteString = decodeURIComponent(dataURIParts[1]);\r\n        }\r\n        let arrayBuffer = new ArrayBuffer(byteString.length);\r\n        let intArray = new Uint8Array(arrayBuffer);\r\n\r\n        for (let i = 0; i < byteString.length; i += 1) {\r\n            intArray[i] = byteString.charCodeAt(i);\r\n        }\r\n\r\n        let mimeString = dataURIParts[0].split(':')[1].split(';')[0];\r\n        let blob = null;\r\n\r\n        if (hasBlobConstructor) {\r\n            blob = new Blob(\r\n                [hasArrayBufferViewSupport ? intArray : arrayBuffer],\r\n                {type: mimeString}\r\n            );\r\n        } else {\r\n            let bb = new BlobBuilder();\r\n            bb.append(arrayBuffer);\r\n            blob = bb.getBlob(mimeString);\r\n        }\r\n\r\n        return blob;\r\n    }\r\n\r\n    static _loadImage(image, file, callback) {\r\n        if (typeof(URL) === 'undefined') {\r\n            let reader = new FileReader();\r\n            reader.onload = function(evt) {\r\n                image.src = evt.target.result;\r\n                if (callback) { callback(); }\r\n            }\r\n            reader.readAsDataURL(file);\r\n        } else {\r\n            image.src = URL.createObjectURL(file);\r\n            if (callback) { callback(); }\r\n        }\r\n    };\r\n\r\n    static isSupported() {\r\n        return (\r\n               (typeof(HTMLCanvasElement) !== 'undefined') \r\n            && hasBlobSupport\r\n            && hasReaderSupport\r\n        );\r\n    }\r\n}\r\n\n// CONCATENATED MODULE: ./src/hyperty-resource/FileHypertyResource.js\n/**\r\n* The Hyperty Resource Data Model is used to model resouces handled by Hyperties and Data Objects including chat messages, files, real time human audio and video..\r\n*\r\n*/\r\n\r\n// Log System\r\n\r\nlet FileHypertyResource_log = loglevel[\"getLogger\"]('FileHypertyResource');\r\n\r\n\r\n\r\n\r\n\r\n\r\nclass FileHypertyResource_FileHypertyResource extends hyperty_resource_HypertyResource {\r\n\r\n  /**\r\n  * FileHypertyResource constructor\r\n  *\r\n  * @param  {URL} owner HypertyURL of the Hyperty handling this resource\r\n  * @param  {URL} runtime Runtime URL where this resource is hosted\r\n  * @param  {Bus} bus sandbox message bus\r\n  * @param  {DataObject} parent Parent Data Object where the HypertyResource is handled as a child\r\n  * @param  {File} file file to be encoded as HypertyResource\r\n  * @param  {Boolean} isReporter indicates if parent is Reporter or an Observer\r\n  * @param  {Array} input optional input parameters\r\n  */\r\n\r\n  constructor(isSender, input) {\r\n\r\n    super(isSender, input);\r\n\r\n    let _this = this;\r\n\r\n    _this.metadata.resourceType = 'file';\r\n\r\n  }\r\n\r\n  init(file) {\r\n    let _this = this;\r\n\r\n    if (!file) throw new Error('[FileHypertyResource.constructor] missing mandatory *file* input ');\r\n\r\n    return new Promise(function(resolve, reject) {\r\n\r\n      _this._metadata.name = file.name;\r\n      _this._metadata.lastModified = file.lastModified;\r\n      _this._metadata.size = file.size;\r\n      _this._metadata.mimetype = file.type;\r\n\r\n      FileHypertyResource_log.log('[FileHypertyResource.init] file: ', file);\r\n\r\n      if (_this._isSender) {\r\n\r\n        let mimetype = file.type.split('/')[0];\r\n\r\n        switch (mimetype) {\r\n          case 'image' :\r\n            _this._getImagePreview(file).then((preview)=>{\r\n              _this._metadata.preview = preview;\r\n              _this._content = file;\r\n              resolve();\r\n            });\r\n            break;\r\n          default :\r\n            _this._content = file;\r\n            resolve();\r\n            break;\r\n        }\r\n\r\n        // if too big lets store as File and asArray Buffer\r\n\r\n      //  if (file.size > _this.arraybufferSizeLimit) {\r\n      /*  } else {\r\n\r\n          let reader = new FileReader();\r\n\r\n          reader.onload = function(theFile) {\r\n\r\n            log.log('[FileHypertyResource.init] file loaded ', theFile);\r\n\r\n            _this._content = theFile.target.result;\r\n            resolve();\r\n\r\n          }\r\n\r\n          reader.readAsArrayBuffer(file);\r\n\r\n        }*/\r\n      } else {\r\n      _this._content = file.content;\r\n      if (file.preview) _this._metadata.preview = file.preview;\r\n      resolve();\r\n    }\r\n\r\n    });\r\n\r\n  }\r\n\r\n _getImagePreview(image){\r\n   let reader = new FileReader();\r\n   return new Promise((resolve,reject)=>{\r\n\r\n   ImageTools.resize(image, {\r\n        width: 100, // maximum width\r\n        height: 100 // maximum height\r\n    }, function(blob, didItResize) {\r\n        // didItResize will be true if it managed to resize it, otherwise false (and will return the original file as 'blob')\r\n        if (didItResize) {\r\n          reader.readAsDataURL(blob);\r\n\r\n          reader.onload = function(theImage) {\r\n            resolve(theImage.target.result);\r\n        };\r\n      } else {\r\n        FileHypertyResource_log.warn('[FileHypertyResource._getImagePreview] unable to create image preview from original image ');\r\n        resolve(undefined);\r\n      }\r\n    });\r\n  });\r\n }\r\n\r\n\r\n\r\n  get name() {\r\n    let _this = this;\r\n    return _this._metadata.name;\r\n  }\r\n\r\n  get preview() {\r\n    let _this = this;\r\n    return _this._metadata.preview;\r\n  }\r\n\r\n  /**\r\n  * Share file as a data object child of a data object parent\r\n  *\r\n  * @param  {string} children Data Object Parent children name where the file is shared\r\n  */\r\n\r\n/*  share(children) {\r\n    let _this = this;\r\n\r\n    return new Promise(function(resolve, reject) {\r\n      //to be improved and adapted\r\n\r\n      if (!_this._isSender) return reject('[FileHypertyResource.share] Observers can not share files');\r\n\r\n      let file2share = _this._metadata;\r\n      file2share.type = _this._type;\r\n\r\n      _this._parent.addChild(children, file2share).then(function(dataObjectChild) {\r\n        log.log('[FileHypertyResource.share] object child: ', dataObjectChild);\r\n\r\n        let sharedFile = dataObjectChild.data;\r\n\r\n        resolve(sharedFile);\r\n\r\n      }).catch(function(reason) {\r\n        log.error('Reason:', reason);\r\n        reject(reason);\r\n      });\r\n\r\n    });\r\n\r\n  }*/\r\n\r\n  /**\r\n  * Returns file content optimised to be displayed in a message line\r\n  *\r\n  * @param  {string} children Data Object Parent children name where the file is shared\r\n  */\r\n\r\n  toMessage() {\r\n    //TODO: to be implemented. It should return HTML with img attribute as a thumbnail plus the name.\r\n  }\r\n\r\n}\r\n\r\n\r\n/* harmony default export */ var hyperty_resource_FileHypertyResource = (FileHypertyResource_FileHypertyResource);\r\n\n// CONCATENATED MODULE: ./src/hyperty-resource/HypertyResourceFactory.js\n/**\r\n* The Hyperty Resource Data Model is used to model resouces handled by Hyperties and Data Objects including chat messages, files, real time human audio and video..\r\n*\r\n*/\r\n\r\n\r\n\r\nclass HypertyResourceFactory_HypertyResourceFactory {\r\n\r\n  /**\r\n  * HypertyResourceFactory constructor\r\n  *\r\n  */\r\n\r\n  constructor() {\r\n\r\n  }\r\n\r\n  createHypertyResource(isSender, type, metadata) {\r\n    let newHypertyResource;\r\n\r\n    switch (type) {\r\n      case 'file':\r\n        newHypertyResource = new hyperty_resource_FileHypertyResource(isSender, metadata);\r\n        break;\r\n      default:\r\n        throw new Error('[HypertyResourceFactory.createHypertyResource] not supported type: ', type);\r\n        break;\r\n      }\r\n\r\n      return(newHypertyResource);\r\n\r\n  }\r\n\r\n  createHypertyResourceWithContent(isSender, type, content, metadata) {\r\n    let newHypertyResource;\r\n\r\n    return new Promise((resolve) => {\r\n\r\n    switch (type) {\r\n      case 'file':\r\n        newHypertyResource = new hyperty_resource_FileHypertyResource(isSender, metadata);\r\n        break;\r\n      default:\r\n        reject();\r\n        break;\r\n      }\r\n\r\n      newHypertyResource.init(content).then(()=>{\r\n        return newHypertyResource.save();// skip save?\r\n      }).then(()=>{\r\n        resolve(newHypertyResource);\r\n      });\r\n\r\n  });\r\n\r\n  }\r\n}\r\n\r\n/* harmony default export */ var hyperty_resource_HypertyResourceFactory = (HypertyResourceFactory_HypertyResourceFactory);\r\n\n// CONCATENATED MODULE: ./src/syncher/DataObject.js\n/**\r\n* Copyright 2016 PT Inovação e Sistemas SA\r\n* Copyright 2016 INESC-ID\r\n* Copyright 2016 QUOBIS NETWORKS SL\r\n* Copyright 2016 FRAUNHOFER-GESELLSCHAFT ZUR FOERDERUNG DER ANGEWANDTEN FORSCHUNG E.V\r\n* Copyright 2016 ORANGE SA\r\n* Copyright 2016 Deutsche Telekom AG\r\n* Copyright 2016 Apizee\r\n* Copyright 2016 TECHNISCHE UNIVERSITAT BERLIN\r\n*\r\n* Licensed under the Apache License, Version 2.0 (the \"License\");\r\n* you may not use this file except in compliance with the License.\r\n* You may obtain a copy of the License at\r\n*\r\n*   http://www.apache.org/licenses/LICENSE-2.0\r\n*\r\n* Unless required by applicable law or agreed to in writing, software\r\n* distributed under the License is distributed on an \"AS IS\" BASIS,\r\n* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n* See the License for the specific language governing permissions and\r\n* limitations under the License.\r\n**/\r\n\r\n// Log System\r\n\r\nlet DataObject_log = loglevel[\"getLogger\"]('DataObject');\r\n\r\n\r\n\r\n//import HeartBeat from './HeartBeat';\r\n\r\n\r\n\r\n/**\r\n * Main extension class for observers and reporters, with common properties and methods.\r\n * Children management is common for observers and reporters.\r\n */\r\nclass DataObject_DataObject {\r\n  /* private\r\n  _version: number\r\n\r\n  _owner: HypertyURL\r\n  _url: ObjectURL\r\n  _schema: Schema\r\n  _bus: MiniBus\r\n  _status: on | paused\r\n  _syncObj: SyncData\r\n\r\n  _children: { id: DataObjectChild }\r\n  _childrenListener: [MsgListener]\r\n\r\n  ----event handlers----\r\n  _onAddChildHandler: (event) => void\r\n  */\r\n\r\n  /**\r\n   * @ignore\r\n   * Should not be used directly by Hyperties. It's called by the Syncher create or subscribe method's\r\n   */\r\n\r\n  constructor(input) {\r\n    let _this = this;\r\n\r\n    function throwMandatoryParmMissingError(par) {\r\n      throw '[DataObject] ' + par + ' mandatory parameter is missing';\r\n    }\r\n\r\n    input.syncher ? _this._syncher = input.syncher : throwMandatoryParmMissingError('syncher');\r\n    input.url ? _this._url = input.url : throwMandatoryParmMissingError('url');\r\n    input.created ? _this._created = input.created : throwMandatoryParmMissingError('created');\r\n    input.reporter ? _this._reporter = input.reporter : throwMandatoryParmMissingError('reporter');\r\n    input.runtime ? _this._runtime = input.runtime : throwMandatoryParmMissingError('runtime');\r\n    input.schema ? _this._schema = input.schema : throwMandatoryParmMissingError('schema');\r\n    input.name ? _this._name = input.name : throwMandatoryParmMissingError('name');\r\n\r\n\r\n    _this._status = input.status;\r\n\r\n    if (input.data) {\r\n      _this._syncObj = new ProxyObject(input.data);\r\n    } else {\r\n      _this._syncObj = new ProxyObject({});\r\n    }\r\n    _this._childrens = input.childrens;\r\n\r\n    //TODO: For Further Study\r\n    _this._mutual = input.mutual;\r\n\r\n    _this._version = 0;\r\n    _this._childId = 1;\r\n    _this._childrenListener; //bus listener for children\r\n    _this._onAddChildrenHandler; //Hyperty side handlers to process child objects created by remote Hyperties\r\n\r\n    _this._resumed = input.resume;\r\n\r\n    if (input.resume) { _this._version = input.version; }\r\n\r\n    _this._owner = input.syncher._owner;\r\n    _this._bus = input.syncher._bus;\r\n\r\n    if (input.description) _this._description = input.description;\r\n    if (input.tags) _this._tags = input.tags;\r\n    if (input.resources) _this._resources = input.resources;\r\n    if (input.observerStorage) _this._observerStorage = input.observerStorage;\r\n    if (input.publicObservation) _this._publicObservation = input.publicObservation;\r\n\r\n    _this._metadata = Object.assign(input);\r\n\r\n    //    console.log('[DataObject] mutual ', _this._metadata.mutual);\r\n\r\n    if (!input.hasOwnProperty('resume') || (input.hasOwnProperty('resume') && !input.resume)) {\r\n      _this._metadata.lastModified = _this._metadata.created;\r\n    }\r\n\r\n    delete _this._metadata.data;\r\n    delete _this._metadata.syncher;\r\n    delete _this._metadata.authorise;\r\n\r\n    _this._hypertyResourceFactory = new hyperty_resource_HypertyResourceFactory();\r\n    _this._childrenObjects = {};\r\n    _this._sharedChilds = []; //childObjects that were not sent yet to Reporters\r\n\r\n/*    if (input.backup && _this._childrens) {\r\n      let lastHeartbeat = (input.hasOwnProperty('childrenObjects') && input.childrenObjects.hasOwnProperty('heartbeat'))\r\n        ? input.childrenObjects.heartbeat : 0;\r\n      _this._heartBeat = new HeartBeat(_this._bus, _this._owner, _this._syncher._runtimeUrl, this, 15, lastHeartbeat);\r\n      if (_this._resumed) _this._heartBeat.start(true, _this.metadata.isReporter);\r\n      else _this._heartBeat.start(false, _this.metadata.isReporter);\r\n\r\n    }*/\r\n  }\r\n\r\n  _getLastChildId() {\r\n    let _this = this;\r\n\r\n    let childIdInt = 0;\r\n    let childIdString = _this._owner + '#' + childIdInt;\r\n\r\n\r\n    Object.keys(_this._childrens).filter((key) => {\r\n      if (_this._childrens[key].childId > childIdString) {\r\n        childIdString = _this._childrens[key].childId;\r\n      }\r\n    });\r\n\r\n    return childIdInt = Number(childIdString.split('#')[1]);\r\n  }\r\n\r\n  _allocateListeners() {\r\n    let _this = this;\r\n\r\n    let childBaseURL = _this._url + '/children/';\r\n    DataObject_log.log('[Data Object - AllocateListeners] - ', _this._childrens);\r\n    if (_this._childrens) {\r\n      //      _this._childrens.forEach((child) => {\r\n      let childURL = childBaseURL;\r\n      let listener = _this._bus.addListener(childURL, (msg) => {\r\n        //ignore msg sent by himself\r\n        if (msg.from !== this._owner) {\r\n          console.log('DataObject-Children-RCV: ', msg);\r\n          switch (msg.type) {\r\n            case 'create': _this._onChildCreate(msg); break;\r\n            case 'event': _this._onEvent(msg); break;\r\n            case 'delete': DataObject_log.log(msg); break;\r\n            default: _this._changeChildren(msg); break;\r\n          }\r\n        }\r\n        //        });\r\n\r\n        _this._childrenListener = listener;\r\n      });\r\n    }\r\n  }\r\n\r\n  _releaseListeners() {\r\n    let _this = this;\r\n\r\n    if (_this._childrenListener) {\r\n      _this._childrenListener.remove();\r\n\r\n      Object.keys(_this._childrenObjects).forEach((child) => {\r\n        /*      if (children === 'resources') {\r\n                Object.keys(_this._childrenObjects[children]).forEach((child) => {\r\n                  _this._childrenObjects[children][child]._releaseListeners();\r\n                });\r\n              } else {*/\r\n        _this._childrenObjects[child]._releaseListeners();\r\n        //      }\r\n      });\r\n    }\r\n\r\n\r\n  }\r\n\r\n  /**\r\n   * Sync Data Object Observer with last version of Data Object Reporter. Useful for Resumes\r\n   * remove since hyperties can directly use syncher read?\r\n   */\r\n  sync() {\r\n\r\n    let _this = this;\r\n    DataObject_log.info('[DataObject.sync] synchronising ');\r\n\r\n    return new Promise((resolve, reject) => {\r\n\r\n      let criteria = {};\r\n\r\n//      if (this.metadata.backupRevision) criteria.backupRevision = this.metadata.backupRevision;\r\n\r\n      _this._syncher.read(_this._metadata.url, criteria).then((value) => {\r\n        console.log('[DataObject.sync] value to sync: ', value);\r\n\r\n        Object.assign(_this.data, deepClone(value.data));\r\n\r\n        _this._version = value.version;\r\n\r\n        _this._metadata.lastModified = value.lastModified;\r\n\r\n        //TODO: check first if there are new childrenObjects to avoid overhead\r\n\r\n        if (value.childrenObjects) {\r\n          _this.resumeChildrens(value.childrenObjects);\r\n//          _this._storeChildrens();\r\n          resolve(true);\r\n        } else resolve(true);\r\n\r\n\r\n        /*if (value.version != _this._version) {\r\n          log.info('[DataObject.sync] updating existing data: ', _this.data);\r\n\r\n          Object.assign(_this.data || {}, deepClone(value.data));\r\n\r\n          _this._metadata = deepClone(value);\r\n\r\n          delete _this._metadata.data;\r\n\r\n          _this._version = value.version;\r\n\r\n        } else {\r\n          log.info('[DataObject.sync] existing data is updated: ', value);\r\n        }*/\r\n\r\n      }).catch((reason) => {\r\n        DataObject_log.info('[DataObject.sync] sync failed: ', reason);\r\n        resolve(false);\r\n      });\r\n\r\n    });\r\n\r\n\r\n  }\r\n  /**\r\n   *\r\n   */\r\n  resumeChildrens(childrens) {\r\n    let _this = this;\r\n\r\n    let childIdString = this._owner.split('/')[3] + '#' + this._childId;\r\n\r\n    //setup childrens data from subscription\r\n    //    Object.keys(childrens).forEach((childrenResource) => {\r\n    //      let children = childrens[childrenResource];\r\n    let children = childrens;\r\n\r\n    //_this._childrenObjects[childrenResource] = {};\r\n    Object.keys(children).forEach((childId) => {\r\n      let newChild = false;\r\n\r\n/*        if (!_this._childrenObjects.hasOwnProperty(childrenResource))\r\n          _this._childrenObjects[childrenResource] = {};*/\r\n\r\n        // check if it is the last heartbeat\r\n\r\n        if (childId === 'heartbeat') {\r\n//          _this._heartBeat.onNewHeartbeat(children[childId].value);\r\n//          _this._heartBeat.start(true);\r\n        }\r\n        else if (children[childId].hasOwnProperty('value') && children[childId].value.resourceType && !_this._childrenObjects.hasOwnProperty(childId)) {\r\n        _this._childrenObjects[childId] = _this._resumeHypertyResource(children[childId]);\r\n        newChild = true;\r\n      } else if (!_this._childrenObjects.hasOwnProperty(childId)) {\r\n\r\n        _this._childrenObjects[childId] = _this._resumeChild(children[childId]);\r\n        DataObject_log.log('[DataObject.resumeChildrens] new DataObjectChild: ', _this._childrenObjects[childId]);\r\n        newChild = true;\r\n      }\r\n\r\n      if (newChild && childId > childIdString) {\r\n        childIdString = childId;\r\n        DataObject_log.log('[DataObjectReporter.resumeChildrens] - resuming: ', this._childrenObjects[childId]);\r\n      }\r\n\r\n    });\r\n    //    });\r\n\r\n    this._childId = Number(childIdString.split('#')[1]);\r\n\r\n  }\r\n\r\n  _resumeChild(input) {\r\n    let _this = this;\r\n    let childInput = input.value;\r\n    childInput.parentObject = _this;\r\n    childInput.parent = _this._url;\r\n\r\n    let child = new syncher_DataObjectChild(childInput);\r\n\r\n    child.identity = input.identity;\r\n\r\n    let event = {\r\n      type: 'create',\r\n      from: child.reporter,\r\n      url: child.parent,\r\n      value: child.data,\r\n      childId: child.url,\r\n      identity: child.identity,\r\n      child: child\r\n    };\r\n\r\n    if (child.resourceType) {\r\n      event.resource = child;\r\n\r\n    }\r\n\r\n    if (_this._onAddChildrenHandler) _this._onAddChildrenHandler(event);\r\n\r\n    return child;\r\n\r\n  }\r\n\r\n  _resumeHypertyResource(input) {\r\n    let _this = this;\r\n    let childInput = input.value;\r\n    childInput.parentObject = _this;\r\n    childInput.parent = _this._url;\r\n\r\n    let hypertyResource = _this._hypertyResourceFactory.createHypertyResource(false, childInput.resourceType, childInput)\r\n\r\n    hypertyResource.identity = input.identity;\r\n\r\n    let event = {\r\n      type: 'create',\r\n      from: hypertyResource.reporter,\r\n      url: hypertyResource.parent,\r\n      value: hypertyResource.data,\r\n      childId: hypertyResource.url,\r\n      identity: hypertyResource.identity,\r\n      child: hypertyResource\r\n    };\r\n\r\n    if (hypertyResource.resourceType) {\r\n      event.resource = hypertyResource;\r\n\r\n    }\r\n\r\n    if (_this._onAddChildrenHandler) _this._onAddChildrenHandler(event);\r\n\r\n    return hypertyResource;\r\n  }\r\n\r\n  /**\r\n   * All Metadata about the Data Object\r\n   * @type {Object} -\r\n   */\r\n\r\n  get metadata() { return this._metadata; }\r\n\r\n  /**\r\n   * Object URL of reporter or observer\r\n   * @type {ObjectURL}\r\n   */\r\n  get url() { return this._url; }\r\n\r\n  /**\r\n   * Object schema URL (this field is not yet stable, and is subsject to change)\r\n   * @type {SchemaURL}\r\n   */\r\n  get schema() { return this._schema; }\r\n\r\n  /**\r\n   * Status of the reporter or observer connection (this field is not yet stable, and is subsject to change)\r\n   * @type {Status} - Enum of: on | paused\r\n   */\r\n  get status() { return this._status; }\r\n\r\n  /**\r\n   * Data structure to be synchronized.\r\n   * @type {JSON} - JSON structure that should follow the defined schema, if any.\r\n   */\r\n  get data() { return this._syncObj.data; }\r\n\r\n  /**\r\n   * All created children's since the subscription, doesn't contain all children's since reporter creation.\r\n   * @type {Object<ChildId, DataObjectChild>}\r\n   */\r\n  get childrens() { return this._childrenObjects; }\r\n\r\n  /**\r\n   * @ignore\r\n   */\r\n  pause() {\r\n    //TODO: this feature needs more analise\r\n    throw 'Not implemented';\r\n  }\r\n\r\n  /**\r\n   * @ignore\r\n   */\r\n  resume() {\r\n    //TODO: this feature needs more analise\r\n    throw 'Not implemented';\r\n  }\r\n\r\n  /**\r\n   * @ignore\r\n   */\r\n  stop() {\r\n    //TODO: should remove the subscription and send message unsubscribe?\r\n    throw 'Not implemented';\r\n  }\r\n\r\n  /**\r\n   * Create and add a DataObjectChild to a children collection.\r\n   * @param {JSON} initialData - Initial data of the child\r\n   * @param  {MessageBodyIdentity} identity - (optional) identity data to be added to identity the user reporter. To be used for legacy identities.\r\n   * @param  {SyncChildMetadata} input - (optional) All additional metadata about the DataObjectChild.\r\n   * @return {Promise<DataObjectChild>} - Return Promise to a new DataObjectChild.\r\n   */\r\n\r\n  addChild(initialData, identity, input) {\r\n    let _this = this;\r\n    let newChild;\r\n\r\n    //returns promise, in the future, the API may change to asynchronous call\r\n    return new Promise((resolve) => {\r\n\r\n      let msgChildPath = _this._url + '/children/';\r\n\r\n\r\n      let childInput = _this._getChildInput(input);\r\n      childInput.data = initialData;\r\n      //      childInput.children = children;\r\n      newChild = new syncher_DataObjectChild(childInput);\r\n\r\n      if (identity) newChild.identity = identity;\r\n\r\n      newChild.share();\r\n\r\n      console.log('[DataObject.addChild] added ', newChild);\r\n\r\n      newChild.onChange((event) => {\r\n        _this._onChange(event, { path: msgChildPath, childId: childInput.url });\r\n      });\r\n\r\n      //     if (!_this._childrenObjects.hasOwnProperty(children)) _this._childrenObjects[children] = {};\r\n\r\n      _this._childrenObjects[childInput.url] = newChild;\r\n\r\n      resolve(newChild);\r\n    });\r\n  }\r\n\r\n  _deleteChildrens() {\r\n\r\n    let _this = this;\r\n    let deletePromises = [];\r\n\r\n\r\n    return new Promise((resolve) => {\r\n      if (_this.childrens) {\r\n        DataObject_log.log('[DataObject.deleteChildrens]', _this.childrens);\r\n        let child;\r\n\r\n        for (child in _this.childrens) {\r\n          //          let child;\r\n\r\n          /*          if (children === 'resources') {\r\n                      for (child in _this.childrens[children]) {\r\n                        let childObj = _this.childrens[children][child];\r\n                        log.log('[DataObject._deleteChildrens] child',childObj);\r\n                        if (childObj.metadata.hasOwnProperty('resourceType'))\r\n                          deletePromises.push(_this.childrens[children][child].delete());\r\n                      }\r\n                     } else {*/\r\n          let childObj = _this.childrens[child];\r\n          DataObject_log.log('[DataObject._deleteChildrens] child', childObj);\r\n          if (childObj.metadata.hasOwnProperty('resourceType'))\r\n            deletePromises.push(_this.childrens[child].delete());\r\n        }\r\n        //        }\r\n\r\n        DataObject_log.log('[DataObject._deleteChildrens] promises ', deletePromises);\r\n\r\n        if (deletePromises.length > 0) {\r\n          Promise.all(deletePromises).then(() => {\r\n            resolve('[DataObject._deleteChildrens] done');\r\n          });\r\n        } else resolve('[DataObject._deleteChildrens] nothing to delete');\r\n      }\r\n\r\n    });\r\n\r\n  }\r\n\r\n  _getChildInput(input) {\r\n    let _this = this;\r\n    let childInput = Object.assign({}, input);\r\n\r\n    _this._childId++;\r\n\r\n    //removing domain from childId to avoid backup issues with '.'\r\n\r\n    let start = Math.floor(Date.now());\r\n\r\n    console.log('[DataObject._getChildInput] start ', start);\r\n\r\n    childInput.url = start + '-' + _this._owner.split('/')[3] + '#' + _this._childId;\r\n\r\n    childInput.parentObject = _this;\r\n    childInput.reporter = _this._owner;\r\n    childInput.created = (new Date).toISOString();\r\n    childInput.runtime = _this._syncher._runtimeUrl;\r\n    childInput.p2pHandler = _this._syncher._p2pHandler;\r\n    childInput.p2pRequester = _this._syncher._p2pRequester;\r\n    childInput.schema = _this._schema;\r\n    childInput.parent = _this.url;\r\n    childInput.mutual = _this.metadata.mutual;\r\n    //    console.log('[DataObject._getChildInput] mutual ', childInput.mutual);\r\n\r\n    return childInput;\r\n  }\r\n\r\n  addHypertyResource(type, resource, identity, input) {\r\n    let _this = this;\r\n\r\n    //returns promise, in the future, the API may change to asynchronous call\r\n    return new Promise((resolve) => {\r\n\r\n      let hypertyResource;\r\n      let msgChildPath = _this._url + '/children/';\r\n\r\n      let childInput = _this._getChildInput(input);\r\n      //      childInput.children = children;\r\n\r\n      _this._hypertyResourceFactory.createHypertyResourceWithContent(true, type, resource, childInput).then((resource) => {\r\n        hypertyResource = resource;\r\n\r\n        if (identity) hypertyResource.identity = identity;\r\n\r\n        hypertyResource.share();\r\n\r\n        DataObject_log.log('[DataObject.addHypertyResource] added ', hypertyResource);\r\n\r\n        hypertyResource.onChange((event) => {\r\n          _this._onChange(event, { path: msgChildPath, childId: hypertyResource.childId });\r\n        });\r\n\r\n        //        if (!_this._childrenObjects.hasOwnProperty(children)) _this._childrenObjects[children] = {};\r\n\r\n        _this._childrenObjects[hypertyResource.childId] = hypertyResource;\r\n\r\n        resolve(hypertyResource);\r\n      });\r\n\r\n\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Setup the callback to process create and delete of childrens.\r\n   * @param {function(event: MsgEvent)} callback\r\n   * TODO: add childrenId to support different handlers per children\r\n   */\r\n  onAddChild(callback) {\r\n\r\n    this._onAddChildrenHandler = callback;\r\n  }\r\n\r\n  /**\r\n   * Setup the callback to process events from Data Objects.\r\n   * @param {function(event: DataObjectEvent)} callback\r\n   */\r\n  onEvent(callback) {\r\n\r\n    this._onEventHandler = callback;\r\n  }\r\n\r\n  /**\r\n   * Send Data Object Events.\r\n   * @param {function(event: DataObjectEvent)} callback\r\n   */\r\n  sendEvent(event) {\r\n\r\n    let msgEvent = {\r\n      from: this._owner,\r\n      to: this._url+'/children/',\r\n      type: 'event',\r\n      body: { value: event}\r\n    }\r\n\r\n    this._bus.postMessage(msgEvent);\r\n  }\r\n\r\n\r\n//FLOW-IN: event received from a remote DataObject\r\n_onEvent(msg) {\r\n  let _this = this;\r\n\r\n  let event = {\r\n    from: msg.from,\r\n    value: msg.body.value,\r\n    identity: msg.body.identity,\r\n  };\r\n\r\n  if (_this._onEventHandler) _this._onEventHandler(event);  \r\n\r\n}\r\n\r\n\r\n  //FLOW-IN: message received from a remote DataObject -> addChild\r\n  _onChildCreate(msg) {\r\n    let _this = this;\r\n\r\n    //    console.log('[DataObject._onChildCreate] receivedBy ' + _this._owner + ' : ', msg);\r\n\r\n    // if this is an heartbeat msg foward it to heatbeat handler\r\n\r\n    if (msg.body.resource === 'heartbeat') {\r\n//      console.log('[DataObject._onChildCreate] new heartbeat received ' + msg.body.value);\r\n//      this._heartBeat.onNewHeartbeat(msg.body.value);\r\n    } else {\r\n      console.log('[DataObject._onChildCreate] new child receivedBy ' + _this._owner + ' : ', msg);\r\n      let response = {\r\n        from: msg.to,\r\n        to: msg.from,\r\n        type: 'response',\r\n        id: msg.id,\r\n        body: {\r\n          code: 100\r\n        }\r\n      }\r\n\r\n      _this._bus.postMessage(response);\r\n\r\n      if (msg.body.value.resourceType) {\r\n        _this._onHypertyResourceAdded(msg);\r\n      } else _this._onChildAdded(msg);\r\n\r\n    }\r\n\r\n  }\r\n\r\n  _onChildAdded(msg) {\r\n    let _this = this;\r\n    let childInput = deepClone(msg.body.value);\r\n    childInput.parentObject = _this;\r\n\r\n    //    let children = childInput.children;\r\n\r\n    let newChild = new syncher_DataObjectChild(childInput);\r\n    newChild.identity = msg.body.identity;\r\n\r\n\r\n    //    if (!_this._childrenObjects.hasOwnProperty(children)) _this._childrenObjects[children] = {};\r\n\r\n    _this._childrenObjects[childInput.url] = newChild;\r\n\r\n    if (msg.to === _this.metadata.url) newChild.store();\r\n\r\n    _this._hypertyEvt(msg, newChild);\r\n  }\r\n\r\n  _onHypertyResourceAdded(msg) {\r\n    let _this = this;\r\n    let input = msg.body.value;\r\n    let hypertyResource;\r\n\r\n    //    let children = input.children;\r\n\r\n    input.parentObject = _this;\r\n\r\n    hypertyResource = _this._hypertyResourceFactory.createHypertyResource(false, input.resourceType, input);\r\n    hypertyResource.identity = msg.body.identity;\r\n\r\n    //    if (!_this._childrenObjects.hasOwnProperty(children)) _this._childrenObjects[children] = {};\r\n\r\n    _this._childrenObjects[hypertyResource.childId] = hypertyResource;\r\n\r\n    _this._hypertyEvt(msg, hypertyResource);\r\n\r\n    // locally store messages that are directly sent to the hyperty\r\n    // ie to sync with messages sent when offline\r\n\r\n    if (msg.to === _this.metadata.url) hypertyResource.store();\r\n  }\r\n\r\n  _hypertyEvt(msg, child) {\r\n    let _this = this;\r\n\r\n    let event = {\r\n      type: msg.type,\r\n      from: msg.from,\r\n      url: msg.to,\r\n      value: child.data,\r\n      childId: child.url,\r\n      identity: msg.body.identity,\r\n      child: child\r\n    };\r\n\r\n    if (child.resourceType) {\r\n      event.resource = child;\r\n\r\n    }\r\n\r\n    if (_this._onAddChildrenHandler) _this._onAddChildrenHandler(event);\r\n  }\r\n\r\n  //send delta messages to subscriptions\r\n  _onChange(event, childInfo) {\r\n    let _this = this;\r\n\r\n    _this._metadata.lastModified = (new Date).toISOString();\r\n\r\n    _this._version++;\r\n\r\n    if (_this._status === 'live') {\r\n      //FLOW-OUT: this message will be sent directly to a resource changes address: MessageBus\r\n      let changeMsg = {\r\n        type: 'update', from: _this._url, to: _this._url + '/changes',\r\n        body: { version: _this._version, source: _this._owner, attribute: event.field, lastModified: _this._metadata.lastModified }\r\n      };\r\n\r\n      DataObject_log.log('[DataObject - _onChange] - ', event, childInfo, changeMsg);\r\n\r\n      if (event.oType === ObjectType.OBJECT) {\r\n        if (event.cType !== ChangeType.REMOVE) {\r\n          changeMsg.body.value = deepClone(event.data);\r\n        }\r\n      } else {\r\n        changeMsg.body.attributeType = event.oType;\r\n        changeMsg.body.value = event.data;\r\n        if (event.cType !== ChangeType.UPDATE) {\r\n          changeMsg.body.operation = event.cType;\r\n        }\r\n      }\r\n\r\n      //childInfo must have (path, childId)\r\n      if (childInfo) {\r\n        changeMsg.to = childInfo.path;\r\n        changeMsg.body.resource = childInfo.childId;\r\n      }\r\n\r\n      //TODO: For Further Study\r\n      if (!_this.data._mutual) changeMsg.body.mutual = _this._mutual;\r\n\r\n      _this._bus.postMessage(changeMsg);\r\n    }\r\n  }\r\n\r\n  //FLOW-IN: delta message received from a remote DataObjectReporter or DataObjectChild when changing data\r\n  _changeObject(syncObj, msg) {\r\n    let _this = this;\r\n\r\n    //TODO: update version ?\r\n    //how to handle an incorrect version ? Example: receive a version 3 when the observer is in version 1, where is the version 2 ?\r\n    //will we need to confirm the reception ?\r\n    if (_this._version + 1 <= msg.body.version) {\r\n      _this._version = msg.body.version;\r\n      let path = msg.body.attribute;\r\n      let value;\r\n      if (typeof msg.body.value === 'object') value = deepClone(msg.body.value);\r\n      else value = msg.body.value;\r\n\r\n      let findResult = syncObj.findBefore(path);\r\n\r\n      if (msg.body.lastModified) {\r\n        _this._metadata.lastModified = msg.body.lastModified;\r\n      } else {\r\n        _this._metadata.lastModified = (new Date).toISOString();\r\n      }\r\n\r\n      if (msg.body.attributeType === ObjectType.ARRAY) {\r\n        if (msg.body.operation === ChangeType.ADD) {\r\n          let arr = findResult.obj;\r\n          let index = findResult.last;\r\n          Array.prototype.splice.apply(arr, [index, 0].concat(value));\r\n        } else if (msg.body.operation === ChangeType.REMOVE) {\r\n          let arr = findResult.obj;\r\n          let index = findResult.last;\r\n          arr.splice(index, value);\r\n        } else {\r\n          findResult.obj[findResult.last] = value; // UPDATE\r\n        }\r\n      } else {\r\n        if (msg.body.hasOwnProperty('value')) {\r\n          findResult.obj[findResult.last] = value; // UPDATE or ADD\r\n        } else {\r\n          delete findResult.obj[findResult.last]; // REMOVE\r\n        }\r\n      }\r\n    } else {\r\n      //TODO: how to handle unsynchronized versions?\r\n      DataObject_log.log('UNSYNCHRONIZED VERSION: (data => ' + _this._version + ', msg => ' + msg.body.version + ')');\r\n    }\r\n  }\r\n\r\n  //FLOW-IN: message received from a remote DataObjectChild when changing data\r\n  _changeChildren(msg) {\r\n    let _this = this;\r\n    const dividedURL = divideURL(msg.to);\r\n    const identity = dividedURL.identity;\r\n    //    const resource = identity ? identity.substring(identity.lastIndexOf('/') + 1) : undefined;\r\n\r\n    let childId = msg.body.resource;\r\n    let children = _this._childrenObjects[childId];\r\n\r\n    DataObject_log.log('Change children: ', _this._owner, msg, resource);\r\n\r\n    if (children) {\r\n      _this._changeObject(children._syncObj, msg);\r\n    } else {\r\n      DataObject_log.warn('No children found for: ', childId);\r\n    }\r\n  }\r\n\r\n}\r\n\r\n/* harmony default export */ var syncher_DataObject = (DataObject_DataObject);\r\n\n// CONCATENATED MODULE: ./src/syncher/DataObjectReporter.js\n/**\r\n* Copyright 2016 PT Inovação e Sistemas SA\r\n* Copyright 2016 INESC-ID\r\n* Copyright 2016 QUOBIS NETWORKS SL\r\n* Copyright 2016 FRAUNHOFER-GESELLSCHAFT ZUR FOERDERUNG DER ANGEWANDTEN FORSCHUNG E.V\r\n* Copyright 2016 ORANGE SA\r\n* Copyright 2016 Deutsche Telekom AG\r\n* Copyright 2016 Apizee\r\n* Copyright 2016 TECHNISCHE UNIVERSITAT BERLIN\r\n*\r\n* Licensed under the Apache License, Version 2.0 (the \"License\");\r\n* you may not use this file except in compliance with the License.\r\n* You may obtain a copy of the License at\r\n*\r\n*   http://www.apache.org/licenses/LICENSE-2.0\r\n*\r\n* Unless required by applicable law or agreed to in writing, software\r\n* distributed under the License is distributed on an \"AS IS\" BASIS,\r\n* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n* See the License for the specific language governing permissions and\r\n* limitations under the License.\r\n**/\r\n\r\n// Log System\r\n\r\nlet DataObjectReporter_log = loglevel[\"getLogger\"]('DataObjectReporter');\r\n\r\n\r\n\r\n\r\n\r\n/**\r\n * The class returned from the Syncher create call.\r\n * To be used as a reporter point, changes will be submited to DataObjectObserver instances.\r\n */\r\nclass DataObjectReporter_DataObjectReporter extends syncher_DataObject /* implements SyncStatus */ {\r\n  /* private\r\n  _subscriptions: <hypertyUrl: { status: string } }>\r\n\r\n  ----event handlers----\r\n  _onSubscriptionHandler: (event) => void\r\n  _onResponseHandler: (event) => void\r\n  _onReadHandler: (event) => void\r\n  */\r\n\r\n  /**\r\n   * @ignore\r\n   * Should not be used directly by Hyperties. It's called by the Syncher.create method\r\n   */\r\n\r\n  //constructor(syncher, url, created, reporter, runtime, schema, name, initialStatus, initialData, childrens, mutual = true, resumed = false, description, tags, resources, observerStorage, publicObservation) {\r\n  constructor(input) {\r\n\r\n    super(input);\r\n    let _this = this;\r\n\r\n    _this._subscriptions = {};\r\n\r\n    _this._syncObj.observe((event) => {\r\n      DataObjectReporter_log.log('[Syncher.DataObjectReporter] ' + _this.url + ' publish change: ', event);\r\n      _this._onChange(event);\r\n    });\r\n\r\n    _this._allocateListeners();\r\n\r\n    _this.invitations = []; // array of promises with pending invitations\r\n    _this._childrenSizeThreshold = 50000;// to be used when replying to sync requests to ensure each response msg is not too large\r\n\r\n  }\r\n\r\n  _allocateListeners() {\r\n    super._allocateListeners();\r\n    let _this = this;\r\n\r\n    _this._objectListener = _this._bus.addListener(_this._url, (msg) => {\r\n      DataObjectReporter_log.log('[Syncher.DataObjectReporter] listener ' + _this._url + ' Received: ', msg);\r\n      switch (msg.type) {\r\n        case 'response': _this._onResponse(msg); break;\r\n        case 'read': _this._onRead(msg); break;\r\n        case 'execute': _this._onExecute(msg); break;\r\n        case 'create': _this._onChildCreate(msg); break;// to create child objects that were sent whenn offline\r\n      }\r\n    });\r\n\r\n    _this._runtimeStatusListener = _this._bus.addListener(_this._syncher._runtimeUrl+'/status' , (evt) => {\r\n      console.log('[Syncher.DataObjectReporter] runtime status event received ' + evt);\r\n\r\n/*      if (evt.body && evt.body.resource && evt.body.resource === _this._url && \r\n        evt.body.value && evt.body.value.backupRevision ) {\r\n          // broadcast backupRevision update\r\n\r\n          _this.data.backupRevision = evt.body.value.backupRevision;\r\n          console.log('[Syncher.DataObjectReporter] DO updated with backup revision ' + _this.data.backupRevision);\r\n        }*/\r\n    });\r\n\r\n  }\r\n\r\n  _releaseListeners() {\r\n    super._releaseListeners();\r\n    let _this = this;\r\n\r\n    _this._objectListener.remove();\r\n  }\r\n\r\n  /**\r\n   * Send invitations (create messages) to hyperties, observers list.\r\n   * @param  {HypertyURL[]} observers List of Hyperty URL's\r\n   */\r\n  inviteObservers(observers, p2p) {\r\n    let _this = this;\r\n\r\n\r\n    //FLOW-OUT: this message will be sent to the runtime instance of SyncherManager -> _onCreate\r\n    // TODO: remove value and add resources? should similar to 1st create\r\n\r\n    let toInvite = observers;\r\n\r\n    // let invitePromises = [];\r\n\r\n    /*  observers.forEach((observer)=> {\r\n      if (!_this.invitations[observer]) {\r\n        toInvite.push(observer);\r\n        _this.invitations[observer] = observer;\r\n      }\r\n    });*/\r\n\r\n\r\n    if (toInvite.length > 0) {\r\n      DataObjectReporter_log.log('[Syncher.DataObjectReporter] InviteObservers ', toInvite, _this._metadata);\r\n\r\n      toInvite.forEach((observer)=>{\r\n\r\n        let invitation = new Promise((resolve, reject) => {\r\n\r\n          let inviteMsg = {\r\n            type: 'create', from: _this._syncher._owner, to: _this._syncher._subURL,\r\n            body: { resume: false, resource: _this._url, schema: _this._schema, value: _this._metadata, authorise: [observer] }\r\n          };\r\n\r\n          if (p2p) inviteMsg.body.p2p = p2p;\r\n\r\n          if (!_this.data.mutual) inviteMsg.body.mutual = _this.data.mutual;\r\n\r\n          _this._bus.postMessage(inviteMsg, (reply)=>{\r\n            DataObjectReporter_log.log('[Syncher.DataObjectReporter] Invitation reply ', reply);\r\n\r\n            let result = {\r\n              invited: observer,\r\n              code: reply.body && reply.body.code ? reply.body.code : 500,\r\n              desc: reply.body && reply.body.desc ? reply.body.desc : 'Unknown'\r\n            };\r\n\r\n            if (result.code < 300) resolve(result);\r\n/*            else if (result.code >= 300) {\r\n              if (_this.metadata.offline) {\r\n                resolve(_this._processOfflineInvitation(inviteMsg));\r\n              }*/ else reject(result);\r\n//            } \r\n          });\r\n        });\r\n\r\n        _this.invitations.push(invitation);\r\n\r\n      });\r\n\r\n      //      return(invitePromises);\r\n\r\n    }\r\n  }\r\n\r\n\r\n  /**\r\n   * Release and delete object data\r\n   */\r\n  delete() {\r\n    let _this = this;\r\n\r\n   if(_this._heartBeat) _this._heartBeat.stop();\r\n\r\n    _this._deleteChildrens().then((result)=>{\r\n      DataObjectReporter_log.log(result);\r\n      //FLOW-OUT: this message will be sent to the runtime instance of SyncherManager -> _onDelete\r\n      let deleteMsg = {\r\n        type: 'delete', from: _this._owner, to: _this._syncher._subURL,\r\n        body: { resource: _this._url }\r\n      };\r\n\r\n      _this._bus.postMessage(deleteMsg, (reply) => {\r\n        DataObjectReporter_log.log('DataObjectReporter-DELETE: ', reply);\r\n        if (reply.body.code === 200) {\r\n          _this._releaseListeners();\r\n          delete _this._syncher._reporters[_this._url];\r\n\r\n          //_this._syncObj.unobserve();\r\n          _this._syncObj = {};\r\n        }\r\n      });\r\n    });\r\n\r\n  }\r\n\r\n  /**\r\n   * Subscriptions requested and accepted to this reporter\r\n   * @type {Object<HypertyURL, SyncSubscription>}\r\n   */\r\n  get subscriptions() { return this._subscriptions; }\r\n\r\n  /**\r\n   * Setup the callback to process subscribe and unsubscribe notifications\r\n   * @param {function(event: MsgEvent)} callback function to receive events\r\n   */\r\n  onSubscription(callback) {\r\n    this._onSubscriptionHandler = callback;\r\n  }\r\n\r\n  /**\r\n   * Setup the callback to process response notifications of the create's\r\n   * @param {function(event: MsgEvent)} callback function to receive events\r\n   */\r\n  onResponse(callback) {\r\n    this._onResponseHandler = callback;\r\n  }\r\n\r\n  /**\r\n   * Setup the callback to process read notifications\r\n   * @param {function(event: MsgEvent)} callback\r\n   */\r\n\r\n  onRead(callback) {\r\n    this._onReadHandler = callback;\r\n  }\r\n\r\n  /**\r\n   * Setup the callback to process execute notifications\r\n   * @param {function(event: MsgEvent)} callback\r\n   */\r\n\r\n  onExecute(callback) {\r\n    this._onExecuteHandler = callback;\r\n  }\r\n\r\n  //FLOW-IN: message received from parent Syncher -> _onForward\r\n  _onForward(msg) {\r\n    let _this = this;\r\n\r\n    DataObjectReporter_log.log('DataObjectReporter-RCV: ', msg);\r\n    switch (msg.body.type) {\r\n      case 'subscribe': _this._onSubscribe(msg); break;\r\n      case 'unsubscribe': _this._onUnSubscribe(msg); break;\r\n    }\r\n  }\r\n\r\n  //FLOW-IN: message received from this -> _onForward: emitted by a remote Syncher -> subscribe\r\n  _onSubscribe(msg) {\r\n    let _this = this;\r\n    let hypertyUrl = msg.body.from;\r\n    let dividedURL = divideURL(hypertyUrl);\r\n    let domain = dividedURL.domain;\r\n    let mutual = true;\r\n\r\n    if (msg.body.hasOwnProperty('mutual') && !msg.body.mutual) mutual = false;\r\n\r\n\r\n    console.log('[DataObjectReporter._onSubscribe]', msg, domain, dividedURL);\r\n\r\n    let event = {\r\n      type: msg.body.type,\r\n      url: hypertyUrl,\r\n\r\n      domain: domain,\r\n\r\n      identity: msg.body.identity,\r\n\r\n      nutual: mutual,\r\n\r\n      accept: () => {\r\n        //create new subscription\r\n        let sub = { url: hypertyUrl, status: 'live' };\r\n        _this._subscriptions[hypertyUrl] = sub;\r\n        if (_this.metadata.subscriptions) { _this.metadata.subscriptions.push(sub.url); }\r\n\r\n        let msgValue = deepClone(_this._metadata);\r\n        msgValue.data = deepClone(_this.data);\r\n        msgValue.version = _this._version;\r\n\r\n        //process and send childrens data\r\n        // let childrenValues = {};\r\n        //\r\n        // if (_this._childrenObjects) {\r\n        //   Object.keys(_this._childrenObjects).forEach((childrenId) => {\r\n        //     let childrenData = _this._childrenObjects[childrenId];\r\n        //     childrenValues[childrenId] = deepClone(childrenData);\r\n        //   });\r\n        //   msgValue.childrenObjects = childrenValues;\r\n        // }\r\n\r\n        let sendMsg = {\r\n          id: msg.id, type: 'response', from: msg.to, to: msg.from,\r\n          body: { code: 200, schema: _this._schema, value: msgValue }\r\n        };\r\n\r\n        //TODO: For Further Study\r\n        if (msg.body.hasOwnProperty('mutual') && !msg.body.mutual) {\r\n          sendMsg.body.mutual = msg.body.mutual;// TODO: remove?\r\n          _this.data.mutual = false;\r\n        }\r\n\r\n        if (_this._heartBeat) {\r\n          sendMsg.body.value.childrenObjects = {};\r\n          sendMsg.body.value.childrenObjects.heartbeat = _this._heartBeat.heartbeat;\r\n        }\r\n\r\n        console.log('[DataObjectReporter._onSubscribe.accept] sending response: ', sendMsg)\r\n\r\n        //send ok response message\r\n        _this._bus.postMessage(sendMsg);\r\n\r\n        return sub;\r\n      },\r\n\r\n      reject: (reason) => {\r\n        //send reject response message\r\n        _this._bus.postMessage({\r\n          id: msg.id, type: 'response', from: msg.to, to: msg.from,\r\n          body: { code: 403, desc: reason }\r\n        });\r\n      }\r\n    };\r\n\r\n    if (_this._onSubscriptionHandler) {\r\n      DataObjectReporter_log.log('SUBSCRIPTION-EVENT: ', event);\r\n      _this._onSubscriptionHandler(event);\r\n    }\r\n  }\r\n\r\n  //FLOW-IN: message received from this -> _onForward: emitted by a remote DataObjectObserver -> unsubscribe\r\n  _onUnSubscribe(msg) {\r\n    let _this = this;\r\n    let hypertyUrl = msg.body.from;\r\n    let dividedURL = divideURL(hypertyUrl);\r\n    let domain = dividedURL.domain;\r\n\r\n    DataObjectReporter_log.log('[DataObjectReporter._onUnSubscribe]', msg, domain, dividedURL);\r\n\r\n    //let sub = _this._subscriptions[hypertyUrl];\r\n    delete _this._subscriptions[hypertyUrl];\r\n    delete _this.invitations[hypertyUrl];\r\n\r\n    let event = {\r\n      type: msg.body.type,\r\n      url: hypertyUrl,\r\n      domain: domain,\r\n      identity: msg.body.identity\r\n    };\r\n\r\n    // TODO: check if the _onSubscriptionHandler it is the same of the subscriptions???\r\n    if (_this._onSubscriptionHandler) {\r\n      DataObjectReporter_log.log('UN-SUBSCRIPTION-EVENT: ', event);\r\n      _this._onSubscriptionHandler(event);\r\n    }\r\n  }\r\n\r\n  //FLOW-IN: message received from ReporterURL address: emited by a remote Syncher -> _onRemoteCreate -> event.ack\r\n  _onResponse(msg) {\r\n    let _this = this;\r\n\r\n    let event = {\r\n      type: msg.type,\r\n      url: msg.from,\r\n      code: msg.body.code\r\n    };\r\n\r\n    if (_this._onResponseHandler) {\r\n      DataObjectReporter_log.log('RESPONSE-EVENT: ', event);\r\n      _this._onResponseHandler(event);\r\n    }\r\n  }\r\n\r\n  //FLOW-IN: message received from ReporterURL address: emited by a remote Syncher -> read\r\n  _onRead(msg) {\r\n    let _this = this;\r\n    let childrensSize = JSON.stringify(_this.childrensJSON).length;\r\n\r\n    let largeObject = (childrensSize > _this._childrenSizeThreshold) ? true : false;\r\n\r\n    let event = {\r\n      type: msg.type,\r\n      url: msg.from,\r\n\r\n      accept: () => {\r\n        if (largeObject) _this._syncReplyForLargeData(msg);\r\n        else _this._syncReply(msg);\r\n      },\r\n\r\n      reject: (reason) => {\r\n        _this._bus.postMessage({\r\n          id: msg.id, type: 'response', from: msg.to, to: msg.from,\r\n          body: { code: 401, desc: reason }\r\n        });\r\n      }\r\n    };\r\n\r\n    // if the requester is an authorised observer, the data object is responded otherwise an event is triggered\r\n    let subscriptions = [];\r\n\r\n    if (_this.metadata.subscriptions) {\r\n      subscriptions = _this.metadata.subscriptions;\r\n    } else if (_this._subscriptions) {\r\n      subscriptions = Object.keys(_this._subscriptions).map(function(key) { return _this._subscriptions[key].url; });\r\n    }\r\n\r\n    if (subscriptions.indexOf(msg.from) != -1) {\r\n      if (largeObject) _this._syncReplyForLargeData(msg);\r\n      else _this._syncReply(msg);\r\n    } else if (_this._onReadHandler) {\r\n      DataObjectReporter_log.log('READ-EVENT: ', event);\r\n      _this._onReadHandler(event);\r\n    }\r\n\r\n  }\r\n\r\n  get childrensJSON() {\r\n    let _this = this;\r\n    let childrens = {};\r\n\r\n//    let children;\r\n\r\n//    for (children in _this._childrenObjects) {\r\n      let child;\r\n//      childrens[children] = {};\r\n      for (child in _this._childrenObjects) {\r\n        childrens[child] = {};\r\n        childrens[child].value = _this._childrenObjects[child].metadata;\r\n        childrens[child].identity = _this._childrenObjects[child].identity;\r\n      }\r\n//    }\r\n\r\n    return childrens;\r\n  }\r\n\r\n  _syncReply(msg) {\r\n    let _this = this;\r\n\r\n    let objectValue = deepClone(_this.metadata);\r\n\r\n    objectValue.data = deepClone(_this.data);\r\n    objectValue.childrenObjects = deepClone(_this.childrensJSON);\r\n\r\n    objectValue.version = _this._version;\r\n\r\n    let response = {\r\n      id: msg.id, type: 'response', from: msg.to, to: msg.from,\r\n      body: { code: 200, value: objectValue }\r\n    };\r\n\r\n    _this._bus.postMessage(response);\r\n\r\n  }\r\n\r\n  // This function is only used if the data object to be synched has childrenOjects too large\r\n\r\n  _syncReplyForLargeData(msg) {\r\n  //set attribute with number of spllited messages\r\n    let _this = this;\r\n\r\n    // lets set the initial message with no childObjects\r\n\r\n    let objectValue = deepClone(_this.metadata);\r\n\r\n    objectValue.data = deepClone(_this.data);\r\n\r\n    objectValue.version = _this._version;\r\n\r\n    delete objectValue.childrenObjects;\r\n\r\n    let children;\r\n    let values = []; // array of values to be sent in separated responses\r\n    let childrenValue = {}; // value to be used in each response\r\n\r\n    for (child in _this._childrenObjects) {\r\n//      let child;\r\n      childrenValue[child] = {};\r\n//      for (child in _this._childrenObjects[children]) {\r\n        if (JSON.stringify(childrenValue).length > _this._childrenSizeThreshold) {\r\n          //childrenValue big enough to be sent in a response message\r\n          values.push(childrenValue);\r\n//          childrenValue = {};\r\n//          childrenValue[child] = {};\r\n        }\r\n        childrenValue[child] = {};\r\n        childrenValue[child].value = _this._childrenObjects[child].metadata;\r\n        childrenValue[child].identity = _this._childrenObjects[child].identity;\r\n//      }\r\n    }\r\n\r\n    values.push(childrenValue);\r\n\r\n    objectValue.responses = values.length + 1; //number of responses to be sent\r\n\r\n    let initialResponse = {\r\n      id: msg.id, type: 'response', from: msg.to, to: msg.from,\r\n      body: { code: 100, value: objectValue }\r\n    };\r\n\r\n    _this._bus.postMessage(initialResponse);\r\n\r\n    values.forEach((value) => {\r\n\r\n      let response = deepClone(initialResponse);\r\n\r\n      response.body.value = value;\r\n\r\n      response.body.value.responses = objectValue.responses;\r\n\r\n      setTimeout(() => { _this._bus.postMessage(response); }, 50);\r\n\r\n      // should put a timeout?\r\n\r\n    });\r\n\r\n  }\r\n\r\n  // Execute request received\r\n  _onExecute(msg) {\r\n    let _this = this;\r\n\r\n    if (!msg.body.method) throw '[DataObjectReporter._onExecute] method missing ', msg;\r\n\r\n    let response = {\r\n      id: msg.id, type: 'response', from: msg.to, to: msg.from,\r\n      body: { code: 200 }\r\n    };\r\n\r\n    let event = {\r\n      type: msg.type,\r\n      url: msg.from,\r\n      method: msg.body.method,\r\n      params: msg.body.params,\r\n\r\n      accept: () => {\r\n        _this._bus.postMessage(response);\r\n      },\r\n\r\n      reject: (reason) => {\r\n        _this._bus.postMessage({\r\n          id: msg.id, type: 'response', from: msg.to, to: msg.from,\r\n          body: { code: 401, desc: reason }\r\n        });\r\n      }\r\n    };\r\n\r\n    if (_this._onExecuteHandler) {\r\n      DataObjectReporter_log.log('[DataObjectReporter] EXECUTE-EVENT: ', event);\r\n      _this._onExecuteHandler(event);\r\n    }\r\n  }\r\n\r\n}\r\n\r\n/* harmony default export */ var syncher_DataObjectReporter = (DataObjectReporter_DataObjectReporter);\r\n\n// CONCATENATED MODULE: ./src/syncher/DataObjectObserver.js\n/**\r\n* Copyright 2016 PT Inovação e Sistemas SA\r\n* Copyright 2016 INESC-ID\r\n* Copyright 2016 QUOBIS NETWORKS SL\r\n* Copyright 2016 FRAUNHOFER-GESELLSCHAFT ZUR FOERDERUNG DER ANGEWANDTEN FORSCHUNG E.V\r\n* Copyright 2016 ORANGE SA\r\n* Copyright 2016 Deutsche Telekom AG\r\n* Copyright 2016 Apizee\r\n* Copyright 2016 TECHNISCHE UNIVERSITAT BERLIN\r\n*\r\n* Licensed under the Apache License, Version 2.0 (the \"License\");\r\n* you may not use this file except in compliance with the License.\r\n* You may obtain a copy of the License at\r\n*\r\n*   http://www.apache.org/licenses/LICENSE-2.0\r\n*\r\n* Unless required by applicable law or agreed to in writing, software\r\n* distributed under the License is distributed on an \"AS IS\" BASIS,\r\n* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n* See the License for the specific language governing permissions and\r\n* limitations under the License.\r\n**/\r\n\r\n// Log System\r\n\r\nlet DataObjectObserver_log = loglevel[\"getLogger\"]('DataObjectObserver');\r\n\r\n\r\n\r\n\r\nlet FilterType = {ANY: 'any', START: 'start', EXACT: 'exact'};\r\n\r\n/**\r\n * The class returned from the Syncher subscribe call.\r\n * To be used as an observation point from a DataObjectReporter change.\r\n */\r\nclass DataObjectObserver_DataObjectObserver extends syncher_DataObject /* implements SyncStatus */ {\r\n  /* private\r\n  _changeListener: MsgListener\r\n\r\n  ----event handlers----\r\n  _filters: {<filter>: {type: <start, exact>, callback: <function>} }\r\n  */\r\n\r\n  /**\r\n   * @ignore\r\n   * Should not be used directly by Hyperties. It's called by the Syncher.subscribe method\r\n   */\r\n\r\n  //TODO: For Further Study\r\n  constructor(input) {\r\n    //todo: check why\r\n    //input.initialData = input.initialData.data;\r\n\r\n    super(input);\r\n\r\n    let _this = this;\r\n\r\n    _this._version = input.version;\r\n    _this._filters = {};\r\n\r\n    _this._syncObj.observe((event) => {\r\n      _this._onFilter(event);\r\n    });\r\n\r\n\r\n    _this._allocateListeners();\r\n  }\r\n\r\n  /**\r\n   * Sync Data Object Observer with last version of Data Object Reporter. Useful for Resumes\r\n   */\r\n  sync() {\r\n\r\n    let _this = this;\r\n    DataObjectObserver_log.info('[DataObjectObserver_sync] synchronising ');\r\n\r\n    return new Promise((resolve, reject) => {\r\n\r\n      let criteria = {};\r\n\r\n//      if (this.metadata.backupRevision) criteria.backupRevision = this.metadata.backupRevision;\r\n\r\n      _this._syncher.read(_this._metadata.url, criteria).then((value)=>{\r\n        DataObjectObserver_log.info('[DataObjectObserver_sync] value to sync: ', value);\r\n\r\n        Object.assign(_this.data, deepClone(value.data));\r\n\r\n        _this._version = value.version;\r\n\r\n        _this._metadata.lastModified = value.lastModified;\r\n\r\n        //TODO: check first if there are new childrenObjects to avoid overhead\r\n\r\n        if (value.childrenObjects) {\r\n          _this.resumeChildrens(value.childrenObjects);\r\n          _this._storeChildrens();\r\n          resolve(true);\r\n        } else resolve(true);\r\n\r\n\r\n        /*if (value.version != _this._version) {\r\n          log.info('[DataObjectObserver_sync] updating existing data: ', _this.data);\r\n\r\n          Object.assign(_this.data || {}, deepClone(value.data));\r\n\r\n          _this._metadata = deepClone(value);\r\n\r\n          delete _this._metadata.data;\r\n\r\n          _this._version = value.version;\r\n\r\n        } else {\r\n          log.info('[DataObjectObserver_sync] existing data is updated: ', value);\r\n        }*/\r\n\r\n      }).catch((reason) => {\r\n        DataObjectObserver_log.info('[DataObjectObserver_sync] sync failed: ', reason);\r\n        resolve(false);\r\n      });\r\n\r\n    });\r\n\r\n\r\n  }\r\n\r\n  _storeChildrens() {\r\n    let _this = this;\r\n\r\n    let childrens = {};\r\n\r\n    //TODO: to be sent to HypertyResourceStorage when ready to handle Chat Messages\r\n\r\n    Object.keys(_this._childrenObjects).forEach((childId) => {\r\n      let children = _this._childrenObjects;\r\n//      childrens[childrenResource] = {};\r\n\r\n//      Object.keys(children).forEach((childId) => {\r\n        childrens[childId] = {};\r\n        childrens[childId].value = children[childId].metadata;\r\n        childrens[childId].identity = children[childId].identity;\r\n//      });\r\n    });\r\n\r\n      let msg = {\r\n\r\n        from: _this._owner,\r\n        to: _this._syncher._subURL,\r\n        type: 'create',\r\n        body: {\r\n          resource: _this._url,\r\n          attribute: 'childrenObjects',\r\n          value: childrens\r\n        }\r\n      };\r\n\r\n      _this._bus.postMessage(msg);\r\n\r\n  }\r\n\r\n  _allocateListeners() {\r\n    super._allocateListeners();\r\n    let _this = this;\r\n\r\n    _this._changeListener = _this._bus.addListener(_this._url + '/changes', (msg) => {\r\n      if (msg.type === 'update') {\r\n        DataObjectObserver_log.log('DataObjectObserver-' + _this._url + '-RCV: ', msg);\r\n        _this._changeObject(_this._syncObj, msg);\r\n      }\r\n    });\r\n  }\r\n\r\n  _releaseListeners() {\r\n    super._releaseListeners();\r\n    let _this = this;\r\n\r\n    _this._changeListener.remove();\r\n  }\r\n\r\n  /**\r\n   * Release and delete object data\r\n   */\r\n  delete() {\r\n    let _this = this;\r\n\r\n    if (_this._heartBeat) _this._heartBeat.stop();\r\n\r\n    _this._deleteChildrens().then(()=>{\r\n      _this.unsubscribe();\r\n      _this._releaseListeners();\r\n      delete _this._syncher._observers[_this._url];\r\n    });\r\n\r\n  }\r\n\r\n  /**\r\n   * Release and delete object data\r\n   */\r\n  unsubscribe() {\r\n    let _this = this;\r\n\r\n    //FLOW-OUT: this message will be sent to the runtime instance of SyncherManager -> _onLocalUnSubscribe\r\n    let unSubscribeMsg = {\r\n      type: 'unsubscribe', from: _this._owner, to: _this._syncher._subURL,\r\n      body: { resource: _this._url }\r\n    };\r\n\r\n    _this._bus.postMessage(unSubscribeMsg, (reply) => {\r\n      DataObjectObserver_log.log('DataObjectObserver-UNSUBSCRIBE: ', reply);\r\n      if (reply.body.code === 200) {\r\n        _this._releaseListeners();\r\n        delete _this._syncher._observers[_this._url];\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Register the change listeners sent by the reporter\r\n   * @param {string} filter - Filter that identifies the field (separated dot path). Accepts * at the end for a more unrestricted filtering.\r\n   * @param {function(event: MsgEvent)} callback\r\n   */\r\n  onChange(filter, callback) {\r\n    let key = filter;\r\n    let filterObj = {\r\n      type: FilterType.EXACT,\r\n      callback: callback\r\n    };\r\n\r\n    let idx = filter.indexOf('*');\r\n    if (idx === filter.length - 1) {\r\n      if (idx === 0) {\r\n        filterObj.type = FilterType.ANY;\r\n      } else {\r\n        filterObj.type = FilterType.START;\r\n        key = filter.substr(0, filter.length - 1);\r\n      }\r\n    }\r\n\r\n    this._filters[key] = filterObj;\r\n  }\r\n\r\n  _onFilter(event) {\r\n    let _this = this;\r\n\r\n    Object.keys(_this._filters).forEach((key) => {\r\n      let filter = _this._filters[key];\r\n      if (filter.type === FilterType.ANY) {\r\n        //match anything\r\n        filter.callback(event);\r\n      } else if (filter.type === FilterType.START) {\r\n        //if starts with filter...\r\n        if (event.field.indexOf(key) === 0) {\r\n          filter.callback(event);\r\n        }\r\n      } else if (filter.type === FilterType.EXACT) {\r\n        //exact match\r\n        if (event.field === key) {\r\n          filter.callback(event);\r\n        }\r\n      }\r\n    });\r\n  }\r\n\r\n  onDisconnected(callback) {\r\n\r\n    return new Promise((resolve, reject) => {\r\n\r\n      this._subscribeRegistration()\r\n      .then(() => {\r\n        this._onDisconnected = callback;\r\n        resolve();\r\n      })\r\n      .catch((err) => reject(err));\r\n    });\r\n  }\r\n\r\n  _subscribeRegistration() {\r\n\r\n    const msg = {\r\n      type: 'subscribe',\r\n      from: this._owner,\r\n      to: this._syncher._runtimeUrl + '/subscriptions',\r\n      body: {\r\n        resources: [this._url + '/registration']\r\n      }\r\n    };\r\n\r\n    return new Promise((resolve, reject) => {\r\n\r\n      this._bus.postMessage(msg, (reply) => {\r\n        DataObjectObserver_log.log(`[DataObjectObserver._subscribeRegistration] ${this._url} rcved reply `, reply);\r\n\r\n        if (reply.body.code === 200) {\r\n          this._generateListener(this._url + '/registration');\r\n          resolve();\r\n        } else {\r\n          DataObjectObserver_log.error('Error subscribing registration status for ', this._url);\r\n          reject('Error subscribing registration status for ' + this._url);\r\n        }\r\n      });\r\n    });\r\n  }\r\n\r\n  _generateListener(notificationURL) {\r\n    let _this = this;\r\n\r\n    _this._bus.addListener(notificationURL, (msg) => {\r\n      DataObjectObserver_log.log(`[DataObjectObserver.registrationNotification] ${_this._url}: `, msg);\r\n      if (msg.body.value && msg.body.value === 'disconnected' && _this._onDisconnected) {\r\n        DataObjectObserver_log.log(`[DataObjectObserver] ${_this._url}: was disconnected `, msg);\r\n        _this._onDisconnected();\r\n      }\r\n\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Requests the reporter to execute a method on the data object\r\n   * @param {string} method - Name of the function to be executed.\r\n   * @param {array} params - array of parameters for the requested function\r\n   * @return {promise}\r\n   */\r\n\r\n  execute(method, params) {\r\n    let _this = this;\r\n\r\n    return new Promise((resolve, reject) => {\r\n\r\n      const msg = {\r\n        type: 'execute',\r\n        from: this._owner,\r\n        to: _this._url,\r\n        body: {\r\n          method: method,\r\n          params: params\r\n        }\r\n      };\r\n\r\n      _this._bus.postMessage(msg, (reply) => {\r\n        DataObjectObserver_log.log(`[DataObjectObserver.execute] ${_this._url} rcved reply `, reply);\r\n\r\n        if (reply.body.code === 200) {\r\n          resolve();\r\n        } else {\r\n          DataObjectObserver_log.warn(`[DataObjectObserver.execute] execution of method ${method} was reject by reporter`);\r\n          reject(`[DataObjectObserver.execute] execution of method ${method} was reject by reporter`);\r\n        }\r\n      });\r\n    });\r\n  }\r\n}\r\n\r\n/* harmony default export */ var syncher_DataObjectObserver = (DataObjectObserver_DataObjectObserver);\r\n\n// CONCATENATED MODULE: ./src/syncher/DataProvisional.js\n/**\r\n* Copyright 2016 PT Inovação e Sistemas SA\r\n* Copyright 2016 INESC-ID\r\n* Copyright 2016 QUOBIS NETWORKS SL\r\n* Copyright 2016 FRAUNHOFER-GESELLSCHAFT ZUR FOERDERUNG DER ANGEWANDTEN FORSCHUNG E.V\r\n* Copyright 2016 ORANGE SA\r\n* Copyright 2016 Deutsche Telekom AG\r\n* Copyright 2016 Apizee\r\n* Copyright 2016 TECHNISCHE UNIVERSITAT BERLIN\r\n*\r\n* Licensed under the Apache License, Version 2.0 (the \"License\");\r\n* you may not use this file except in compliance with the License.\r\n* You may obtain a copy of the License at\r\n*\r\n*   http://www.apache.org/licenses/LICENSE-2.0\r\n*\r\n* Unless required by applicable law or agreed to in writing, software\r\n* distributed under the License is distributed on an \"AS IS\" BASIS,\r\n* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n* See the License for the specific language governing permissions and\r\n* limitations under the License.\r\n**/\r\n\r\n/**\r\n * @access private\r\n * This class is responsible for collecting delta changes in remote objects, before the response of subscription reach the observer.\r\n * It's used in Syncher -> subscribe. The flow is defined as:\r\n * 1. (observer) --subscribe--\x3e (reporter)\r\n * 2. (observer) <--delta updates-- (reporter)\r\n * 3. (observer) <--subscribe response-- (reporter)\r\n * This means that there could be delta updates transferred before the subscription confirmation.\r\n * Since there is no DataObjectObserver before the ubscription confirmation, there should be some other object collecting the updates.\r\n * Provisional data is applied to the DataObjectObserver after confirmation. Or discarded if there is no confirmation.\r\n */\r\n\r\n// Log System\r\n\r\nlet DataProvisional_log = loglevel[\"getLogger\"]('DataProvisional');\r\n\r\nclass DataProvisional {\r\n  /* private\r\n  _childrenListeners: [MsgListener]\r\n  _listener: MsgListener\r\n\r\n  _changes: []\r\n  */\r\n\r\n  constructor(owner, url, bus, children) {\r\n    let _this = this;\r\n\r\n    _this._owner = owner;\r\n    _this._url = url;\r\n    _this._bus = bus;\r\n    _this._children = children;\r\n\r\n    _this._changes = [];\r\n    _this._allocateListeners();\r\n  }\r\n\r\n  _allocateListeners() {\r\n    let _this = this;\r\n\r\n    _this._listener = _this._bus.addListener(_this._url, (msg) => {\r\n      DataProvisional_log.log('DataProvisional-' + _this._url + '-RCV: ', msg);\r\n      _this._changes.push(msg);\r\n    });\r\n\r\n    /*\r\n    _this._childrenListeners = [];\r\n    if (_this._children) {\r\n      let childBaseURL = url + '/children/';\r\n      _this._children.forEach((child) => {\r\n        let childURL = childBaseURL + child;\r\n        let listener = _this._bus.addListener(childURL, (msg) => {\r\n          //ignore msg sent by himself\r\n          if (msg.from !== owner) {\r\n            log.log(msg);\r\n          }\r\n        });\r\n\r\n        _this._childrenListeners.push(listener);\r\n      });\r\n    }*/\r\n  }\r\n\r\n  _releaseListeners() {\r\n    let _this = this;\r\n\r\n    _this._listener.remove();\r\n\r\n    /*_this._childrenListeners.forEach((listener) => {\r\n      listener.remove();\r\n    });*/\r\n  }\r\n\r\n  get children() { return this._children; }\r\n\r\n  apply(observer) {\r\n    let _this = this;\r\n    _this._changes.forEach((change) => {\r\n      observer._changeObject(observer._syncObj, change);\r\n    });\r\n  }\r\n}\r\n\r\n/* harmony default export */ var syncher_DataProvisional = (DataProvisional);\r\n\n// CONCATENATED MODULE: ./src/syncher/Syncher.js\n/**\r\n* Copyright 2016 PT Inovação e Sistemas SA\r\n* Copyright 2016 INESC-ID\r\n* Copyright 2016 QUOBIS NETWORKS SL\r\n* Copyright 2016 FRAUNHOFER-GESELLSCHAFT ZUR FOERDERUNG DER ANGEWANDTEN FORSCHUNG E.V\r\n* Copyright 2016 ORANGE SA\r\n* Copyright 2016 Deutsche Telekom AG\r\n* Copyright 2016 Apizee\r\n* Copyright 2016 TECHNISCHE UNIVERSITAT BERLIN\r\n*\r\n* Licensed under the Apache License, Version 2.0 (the \"License\");\r\n* you may not use this file except in compliance with the License.\r\n* You may obtain a copy of the License at\r\n*\r\n*   http://www.apache.org/licenses/LICENSE-2.0\r\n*\r\n* Unless required by applicable law or agreed to in writing, software\r\n* distributed under the License is distributed on an \"AS IS\" BASIS,\r\n* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n* See the License for the specific language governing permissions and\r\n* limitations under the License.\r\n**/\r\n\r\n// Log System\r\n\r\nlet Syncher_log = loglevel[\"getLogger\"]('Syncher');\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n/**\r\n* The main class for the syncher package.\r\n* The Syncher is a singleton class per Hyperty/URL and it is the owner of all created Data Sync Objects according to the Reporter - Observer pattern.\r\n* Main functionality is to create reporters and to subscribe to existing ones.\r\n*/\r\nclass Syncher_Syncher {\r\n  /* private\r\n  _owner: URL\r\n  _bus: MiniBus\r\n\r\n  _subURL: URL\r\n\r\n  _reporters: <url: DataObjectReporter>\r\n  _observers: <url: DataObjectObserver>\r\n  _provisionals: <url: DataProvisional>\r\n\r\n  ----event handlers----\r\n  _onNotificationHandler: (event) => void\r\n  _onResume: (event) => void\r\n  */\r\n\r\n  /**\r\n  * Constructor that should be used by the Hyperty owner\r\n  * @param {HypertyURL} owner - Hyperty URL owner. An URL allocated by the runtime that uniquely identifies the Hyperty.\r\n  * @param {MiniBus} bus - An instance of the MiniBus provided in the sandbox. When an object (Reporter or Observed) is created, the SyncherManager will add a listener in the MiniBus to receive/send Messages of that object.\r\n  * @param {JSON} config - Configuration data. The only required field for now is the runtimeURL.\r\n  */\r\n  constructor(owner, bus, config) {\r\n    let _this = this;\r\n\r\n    _this._owner = owner;\r\n    _this._bus = bus;\r\n\r\n    _this._subURL = config.runtimeURL + '/sm';\r\n    _this._runtimeUrl = config.runtimeURL;\r\n\r\n    _this._p2pHandler = config.p2pHandler;\r\n    _this._p2pRequester = config.p2pRequester;\r\n\r\n    _this._reporters = {};\r\n    _this._observers = {};\r\n    _this._provisionals = {};\r\n\r\n    bus.addListener(owner, (msg) => {\r\n      //ignore msg sent by himself\r\n      if (msg.from !== owner) {\r\n        Syncher_log.info('[Syncher] Syncher-RCV: ', msg, _this);\r\n        switch (msg.type) {\r\n          case 'forward': _this._onForward(msg); break;\r\n          case 'create': _this._onRemoteCreate(msg); break;\r\n          case 'delete': _this._onRemoteDelete(msg); break;\r\n          case 'execute': _this._onExecute(msg); break;\r\n        }\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n  * The owner of the Syncher and all created reporters.\r\n  * @type {HypertyURL}\r\n  */\r\n  get owner() { return this._owner; }\r\n\r\n  /**\r\n  * All owned reporters, the ones that were created by a create\r\n  * @type {Object<URL, DataObjectReporter>}\r\n  */\r\n  get reporters() { return this._reporters; }\r\n\r\n  /**\r\n  * All owned observers, the ones that were created by a local subscription\r\n  * @type {Object<URL, DataObjectObserver>}\r\n  */\r\n  get observers() { return this._observers; }\r\n\r\n  /**\r\n  * Request a DataObjectReporter creation. The URL will be be requested by the allocation mechanism.\r\n  * @param  {SchemaURL} schema - Hyperty Catalogue URL address that can be used to retrieve the JSON-Schema describing the Data Object schema\r\n  * @param  {HypertyURL[]} observers - List of hyperties that are pre-authorized for subscription\r\n  * @param  {JSON} initialData - Initial data of the reporter\r\n  * @param  {boolean} store - (Optional) if true, object will be stored by the runtime\r\n  * @param  {boolean} p2p - (Optional) if true, data synchronisation stream will use p2p connection as much as possible\r\n  * @param  {string} name - (Optional) the name of the dataobject\r\n  * @param  {MessageBodyIdentity} identity - (optional) identity data to be added to identity the user reporter. To be used for legacy identities.\r\n  * @param  {SyncMetadata} input - (optional) all metadata required to sunc the Data Object.\r\n  * @return {Promise<DataObjectReporter>} Return Promise to a new Reporter. The reporter can be accepted or rejected by the PEP\r\n  */\r\n  create(schema, observers, initialData, store = false, p2p = false, name = 'no name', identity, input) {\r\n\r\n    if (!schema) throw Error('[Syncher - Create] - You need specify the data object schema');\r\n    if (!observers) throw Error('[Syncher - Create] -The observers should be defined');\r\n\r\n    let _this = this;\r\n    input = input || {};\r\n    let createInput  = Object.assign({}, input);\r\n\r\n    createInput.p2p = p2p;\r\n    createInput.store = store;\r\n    createInput.schema = schema;\r\n    createInput.authorise = observers;\r\n    createInput.p2pHandler = _this._p2pHandler;\r\n    createInput.p2pRequester = _this._p2pRequester;\r\n    (initialData) ? createInput.data = deepClone(initialData) : createInput.data = {};\r\n    createInput.name = name.length === 0 ? 'no name' : name;\r\n    createInput.reporter = (input.hasOwnProperty('reporter') && ((typeof input.reporter) !== 'boolean')) ? input.reporter : _this._owner;\r\n    createInput.resume = false;\r\n    if (input) {\r\n      createInput.mutual = input.hasOwnProperty('mutual') ? input.mutual : false;\r\n      createInput.name = input.hasOwnProperty('name') ? input.name : createInput.name;\r\n    } else { createInput.mutual = false; }\r\n\r\n    if (input.hasOwnProperty('reuseURL')) {\r\n      createInput.resource = input.reuseURL;\r\n    }\r\n\r\n    if (identity)      { createInput.identity = identity; }\r\n\r\n    //Object.assign(createInput, {resume: false});\r\n    //debugger;\r\n//    console.log('[syncher - create] - create Reporter - createInput: ', createInput);\r\n\r\n    return _this._create(createInput);\r\n  }\r\n\r\n  /**\r\n  * Request a DataObjectReporter creation. The URL will be be requested by the allocation mechanism.\r\n  * @param  {Object} criteria - (optional) identity data to be added to identity the user reporter. To be used for legacy identities.\r\n  * @return {Promise<DataObjectReporter>[]} Return a promise with a list of DataObjectReporter to be resumed;\r\n  */\r\n  resumeReporters(criteria) {\r\n    let _this = this;\r\n    Syncher_log.log('[syncher - create] - resume Reporter - criteria: ', criteria);\r\n\r\n    Object.assign(criteria, {resume: true});\r\n\r\n    return _this._resumeCreate(criteria);\r\n  }\r\n\r\n  /**\r\n  * Request a subscription to an existent reporter object.\r\n  * @param {SchemaURL} schema - Hyperty Catalogue URL address that can be used to retrieve the JSON-Schema describing the Data Object schema\r\n  * @param {ObjectURL} objURL - Address of the existent reporter object to be observed\r\n  * @param {Boolean} [store=false] - Save the subscription on the Syncher Manager for further resume (Default is false)\r\n  * @param {Boolean} [p2p=false] - Info about if should use p2p connection (Default is false)\r\n  * @param {Boolean} [mutual=true] - Info about if messages of this object should be encrypted (Default is true)\r\n  * @param  {MessageBodyIdentity} identity - (optional) identity data to be added to identity the user reporter. To be used for legacy identities.\r\n  * @return {Promise<DataObjectObserver>} Return Promise to a new observer. It's associated with the reporter.\r\n  */\r\n\r\n  subscribe(input) {\r\n  /*  let _this = this;\r\n    let criteria = {};\r\n\r\n    criteria.p2p = p2p;\r\n    criteria.store = store;\r\n    criteria.schema = schema;\r\n    criteria.domain_subscription = domain_subscription;\r\n\r\n    criteria.resource = objURL;\r\n    if (identity)      { criteria.identity = identity; }\r\n\r\n    //TODO: For Further Study\r\n    criteria.mutual = mutual;\r\n\r\n    log.log('[syncher - subscribe] - subscribe criteria: ', criteria);\r\n\r\n    Object.assign(criteria, {resume: false});*/\r\n\r\n    return this._subscribe(input);\r\n  }\r\n\r\n  /**\r\n  * Request a subscription to an existent reporter object.\r\n  * @param {criteria} criteria - Information to discovery the observer object\r\n  * @return {Promise<DataObjectObserver>} Return Promise to a new observer. It's associated with the reporter.\r\n  */\r\n  resumeObservers(criteria) {\r\n    let _this = this;\r\n    let _criteria = criteria || {};\r\n\r\n    Object.assign(_criteria, {resume: true});\r\n\r\n    return _this._resumeSubscribe(_criteria);\r\n  }\r\n\r\n  /**\r\n  * Request a read action on the reporter object\r\n  * @param {ObjectURL} objURL - URL of the reporter object to be read\r\n  * @return {Promise<Object>} Return Promise to last available data of the reporter\r\n  */\r\n  read(objURL, criteria) {\r\n    let _this = this;\r\n    console.log('[Syncher.read] ', objURL);\r\n\r\n    return new Promise((resolve, reject) => {\r\n     // in case the object is synched in a remote storage, lets sync with it\r\n//      if (_this._observers[objURL] && _this._observers[objURL].metadata.hasOwnProperty('backup') && _this._observers[objURL].metadata.backup) {\r\n\r\n        let readMsg = {\r\n          type: 'read', from: _this._owner, to: _this._subURL, \r\n          body: { resource: objURL}\r\n        };\r\n\r\n        if (criteria) readMsg.body.criteria = criteria;\r\n\r\n          let callback = (reply) => {\r\n            resolve(reply.body.value);\r\n          };\r\n    \r\n          _this._bus.postMessage(readMsg, callback, false);\r\n    \r\n /*     } else {\r\n        _this._readReporter(objURL).then((result)=> {\r\n        resolve(result);\r\n      });\r\n    }*/\r\n\r\n    });\r\n\r\n  }\r\n\r\n/*  _readCallBack(reply, resolve,reject) {\r\n    let _this = this;\r\n\r\n      console.log('[Syncher.read] reply: ', reply);\r\n\r\n      let childrens = {};\r\n      let value = {};\r\n      let n = 0;\r\n\r\n      if (reply.body.code < 300) {\r\n        if (!reply.body.value.hasOwnProperty('responses')) {\r\n          _this._bus.removeResponseListener(reply.from, reply.id);\r\n          resolve(reply.body.value);\r\n        } else { //data object is sent in separated messages\r\n          if (n === 0) { //initial response without childrens\r\n            value = reply.body.value;\r\n            ++n;\r\n          } else { // received response contains childrens\r\n            delete reply.body.value.responses;\r\n            let children;\r\n            for (children in reply.body.value) {\r\n              if (!childrens.hasOwnProperty(children)) childrens[children] = {};\r\n              Object.assign(childrens[children], reply.body.value[children]);\r\n            }\r\n            ++n;\r\n            if (n === value.responses) {\r\n              value.childrenObjects = childrens;\r\n              delete value.responses;\r\n              _this._bus.removeResponseListener(reply.from, reply.id);\r\n              resolve(value);\r\n            }\r\n          }\r\n        }\r\n      } else {\r\n\r\n      reject(reply.body.desc);\r\n      }\r\n\r\n  }*/\r\n\r\n  _readReporter(objURL) {\r\n    let _this = this;\r\n\r\n    //FLOW-OUT: this message will be sent directly to reporter object (maybe there is no listener available, so it will be resolved with MessageBus -> resolve)\r\n    //will reach the remote object in DataObjectReporter -> _onRead\r\n    let readMsg = {\r\n      type: 'read', from: _this._owner, to: objURL\r\n    };\r\n\r\n    return new Promise((resolve, reject) => {\r\n\r\n      _this._bus.postMessage(readMsg, (reply) => {\r\n        return _this._readCallBack(reply, resolve, reject);\r\n      }, false);\r\n\r\n    });\r\n  }\r\n\r\n  /**\r\n  * Setup the callback to process create and delete events of remove Reporter objects.\r\n  * This is releated to the messagens sent by create to the observers Hyperty array.\r\n  * @param {function(event: MsgEvent)} callback\r\n  */\r\n  onNotification(callback) {\r\n    this._onNotificationHandler = callback;\r\n  }\r\n\r\n  /**\r\n  * Setup the callback to process close events from the runtime.\r\n  * @param {function(event: MsgEvent)} callback\r\n  */\r\n  onClose(callback) {\r\n    this._onClose = callback;\r\n  }\r\n\r\n  _create(input) {\r\n    let _this = this;\r\n\r\n    return new Promise((resolve, reject) => {\r\n\r\n      let reporterInput  = Object.assign({}, input);\r\n\r\n      let resume = input.resume;\r\n\r\n      reporterInput.created = (new Date).toISOString();\r\n      reporterInput.runtime = _this._runtimeUrl;\r\n\r\n      let requestValue = deepClone(reporterInput);\r\n\r\n      delete requestValue.p2p;\r\n      delete requestValue.store;\r\n      delete requestValue.observers;\r\n      delete requestValue.identity;\r\n\r\n      //FLOW-OUT: this message will be sent to the runtime instance of SyncherManager -> _onCreate\r\n      //debugger;\r\n      let requestMsg = {\r\n        type: 'create', from: _this._owner, to: _this._subURL,\r\n        body: { resume: resume, value: requestValue  }\r\n      };\r\n\r\n\r\n      requestMsg.body.schema = reporterInput.schema;\r\n\r\n      if (reporterInput.p2p) requestMsg.body.p2p = reporterInput.p2p;\r\n      if (reporterInput.store) requestMsg.body.store = reporterInput.store;\r\n      if (reporterInput.identity) requestMsg.body.identity = reporterInput.identity;\r\n\r\n      console.log('[syncher._create]: ', reporterInput, requestMsg);\r\n\r\n      //request create to the allocation system. Can be rejected by the PolicyEngine.\r\n      _this._bus.postMessage(requestMsg, (reply) => {\r\n        Syncher_log.log('[syncher - create] - create-response: ', reply);\r\n        if (reply.body.code === 200) {\r\n          //reporter creation accepted\r\n          reporterInput.url = reply.body.resource;\r\n\r\n/*          if (reply.body.p2pHandler) reporterInput.p2pHandler = reply.body.p2pHandler;\r\n          if (reply.body.p2pRequester) reporterInput.p2pRequester = reply.body.p2pRequester;*/\r\n\r\n          reporterInput.status = 'live';// pch: do we ned this?\r\n          reporterInput.syncher = _this;\r\n          reporterInput.childrens = reply.body.childrenResources;\r\n\r\n          let newObj = _this._reporters[reporterInput.url];\r\n\r\n          if (!newObj) {\r\n            newObj = new syncher_DataObjectReporter(reporterInput);\r\n            _this._reporters[reporterInput.url] = newObj;\r\n          }\r\n\r\n          newObj.inviteObservers(input.authorise, input.p2p);\r\n\r\n          resolve(newObj);\r\n\r\n        } else {\r\n          //reporter creation rejected\r\n          reject(reply.body.desc);\r\n        }\r\n      });\r\n    });\r\n\r\n  }\r\n\r\n  _resumeCreate(criteria) {\r\n    let _this = this;\r\n\r\n    return new Promise((resolve, reject) => {\r\n      let resume = criteria.resume;\r\n\r\n      //FLOW-OUT: this message will be sent to the runtime instance of SyncherManager -> _onCreate\r\n      let requestMsg = {\r\n        type: 'create', from: _this._owner, to: _this._subURL,\r\n        body: { resume: resume }\r\n      };\r\n\r\n      Syncher_log.log('[syncher - create]: ', criteria, requestMsg);\r\n      if (criteria) {\r\n        requestMsg.body.value = criteria;\r\n        if (criteria.hasOwnProperty('reporter')) {\r\n          requestMsg.body.value.reporter = criteria.reporter;\r\n        } else {\r\n          requestMsg.body.value.reporter = _this._owner;\r\n        }\r\n      }\r\n\r\n      if (criteria.p2p) requestMsg.body.p2p = criteria.p2p;\r\n      if (criteria.store) requestMsg.body.store = criteria.store;\r\n      if (criteria.observers) requestMsg.body.authorise = criteria.observers;\r\n      if (criteria.identity) requestMsg.body.identity = criteria.identity;\r\n\r\n      Syncher_log.log('[syncher._resumeCreate] - resume message: ', requestMsg);\r\n\r\n      //debugger;\r\n\r\n      //request create to the allocation system. Can be rejected by the PolicyEngine.\r\n\r\n      _this._bus.postMessage(requestMsg, (reply) => {\r\n        Syncher_log.log('[syncher._resumeCreate] - create-resumed-response: ', reply);\r\n        if (reply.body.code === 200) {\r\n          //debugger;\r\n          let listOfReporters = reply.body.value;\r\n\r\n          for (let index in listOfReporters) {\r\n\r\n            let dataObject = listOfReporters[index];\r\n\r\n            //reporter creation accepted\r\n\r\n            dataObject.data = deepClone(dataObject.data) || {};\r\n\r\n            if (dataObject.childrenObjects) { dataObject.childrenObjects = deepClone(dataObject.childrenObjects); }\r\n\r\n            dataObject.mutual = false;\r\n            dataObject.resume = true;\r\n            dataObject.status = 'live';// pch: do we ned this?\r\n            dataObject.syncher = _this;\r\n\r\n            Syncher_log.log('[syncher._resumeCreate] - create-resumed-dataObjectReporter', dataObject);\r\n\r\n            let newObj = new syncher_DataObjectReporter(dataObject);\r\n\r\n            if (dataObject.childrenObjects) {\r\n              newObj.resumeChildrens(dataObject.childrenObjects);\r\n            }\r\n            _this._reporters[dataObject.url] = newObj;\r\n\r\n          }\r\n\r\n          resolve(_this._reporters);\r\n          if (this._onReportersResume) this._onReportersResume(this._reporters);\r\n\r\n        } else if (reply.body.code === 404) {\r\n          resolve({});\r\n        } else {\r\n          //reporter creation rejected\r\n          reject(reply.body.desc);\r\n        }\r\n      });\r\n    });\r\n  }\r\n\r\n  _subscribe(input) {\r\n    let _this = this;\r\n\r\n    return new Promise((resolve, reject) => {\r\n\r\n      //FLOW-OUT: this message will be sent to the runtime instance of SyncherManager -> _onLocalSubscribe\r\n      let subscribeMsg = {\r\n        type: 'subscribe', from: _this._owner, to: _this._subURL,\r\n        body: input\r\n      };\r\n\r\n      // Hyperty request to be an Observer\r\n      // https://github.com/reTHINK-project/specs/blob/master/messages/data-sync-messages.md#hyperty-request-to-be-an-observer\r\n\r\n      // Resume Subscriptions for the same Hyperty URL\r\n      // https://github.com/reTHINK-project/specs/blob/master/messages/data-sync-messages.md#resume-subscriptions-for-the-same-hyperty-url\r\n\r\n      // Resume Subscriptions for a certain user and data schema independently of the Hyperty URL.\r\n      // https://github.com/reTHINK-project/specs/blob/master/messages/data-sync-messages.md#resume-subscriptions-for-a-certain-user-and-data-schema-independently-of-the-hyperty-url\r\n/*      if (input) {\r\n        if (input.hasOwnProperty('p2p')) subscribeMsg.body.p2p = input.p2p;\r\n        if (input.hasOwnProperty('store')) subscribeMsg.body.store = input.store;\r\n        if (input.hasOwnProperty('schema')) subscribeMsg.body.schema = input.schema;\r\n        if (input.hasOwnProperty('identity')) subscribeMsg.body.identity = input.identity;\r\n        if (input.hasOwnProperty('resource')) subscribeMsg.body.resource = input.resource;\r\n        if (input.hasOwnProperty('domain_subscription')) subscribeMsg.body.domain_subscription = input.domain_subscription;\r\n      }\r\n      \r\n\r\n      subscribeMsg.body.resume = input.resume;\r\n\r\n      //TODO: For Further Study\r\n      if (input.hasOwnProperty('mutual')) subscribeMsg.body.mutual = input.mutual;*/\r\n\r\n      Syncher_log.log('[syncher_subscribe] - subscribe message: ', input, subscribeMsg);\r\n\r\n      //request subscription\r\n      //Provisional data is applied to the DataObjectObserver after confirmation. Or discarded if there is no confirmation.\r\n      //for more info see the DataProvisional class documentation.\r\n      let msgId = _this._bus.postMessage(subscribeMsg);\r\n\r\n      _this._bus.addResponseListener(_this._owner, msgId,  (reply) => {\r\n\r\n        Syncher_log.log('[syncher] - subscribe-response: ', reply);\r\n\r\n        let objURL = reply.body.resource;\r\n\r\n        let newProvisional = _this._provisionals[objURL];\r\n        delete _this._provisionals[objURL];\r\n        if (newProvisional) newProvisional._releaseListeners();\r\n\r\n        if (reply.body.code < 200) {\r\n          Syncher_log.log('[syncher] - new DataProvisional: ', reply.body.childrenResources, objURL);\r\n          newProvisional = new syncher_DataProvisional(_this._owner, objURL, _this._bus, reply.body.childrenResources);\r\n          _this._provisionals[objURL] = newProvisional;\r\n        } else if (reply.body.code === 200) {\r\n          Syncher_log.log('[syncher] - new Data Object Observer: ', reply, _this._provisionals);\r\n\r\n          let observerInput = reply.body.value;\r\n\r\n          observerInput.syncher = _this;\r\n          observerInput.p2p = input.p2p;\r\n          observerInput.store = input.store;\r\n          observerInput.identity = input.identity;\r\n          observerInput.resume = false;\r\n\r\n          // todo: For Further Study\r\n          observerInput.mutual = input.mutual;\r\n\r\n          //observerInput.children = newProvisional.children;\r\n\r\n          //TODO: mutual For Further Study\r\n          let newObj = _this._observers[objURL];\r\n          if (!newObj) {\r\n            newObj = new syncher_DataObjectObserver(observerInput);\r\n            _this._observers[objURL] = newObj;\r\n          } else {\r\n            newObj.sync();\r\n          }\r\n\r\n          Syncher_log.log('[syncher] - new Data Object Observer already exist: ', newObj);\r\n\r\n          _this._bus.removeResponseListener(_this._owner, msgId);\r\n          resolve(newObj);\r\n\r\n          if (newProvisional) { newProvisional.apply(newObj); }\r\n\r\n        } else {\r\n          _this._bus.removeResponseListener(_this._owner, msgId);\r\n          reject(reply.body.desc);\r\n        }\r\n      });\r\n    });\r\n  }\r\n/*\r\n  _processOfflineSubscription(subscription, redirectTo) {\r\n    let _this = this;\r\n\r\n    let forward = {\r\n      from: subscription.from,\r\n      type: 'forward',\r\n      to: redirectTo,\r\n      body: subscription\r\n    };\r\n\r\n    console.log('[Syncher._processOfflineSubscription] forwading ', forward);\r\n\r\n    _this._bus.postMessage(forward);\r\n\r\n    let result = {\r\n      code: 302,\r\n      desc: \"Found \" + redirectTo\r\n    };\r\n\r\n    return(result);\r\n\r\n  }*/\r\n\r\n\r\n  _resumeSubscribe(criteria) {\r\n    let _this = this;\r\n\r\n    return new Promise((resolve, reject) => {\r\n\r\n      //FLOW-OUT: this message will be sent to the runtime instance of SyncherManager -> _onLocalSubscribe\r\n      let subscribeMsg = {\r\n        type: 'subscribe', from: _this._owner, to: _this._subURL,\r\n        body: {}\r\n      };\r\n\r\n      // Hyperty request to be an Observer\r\n      // https://github.com/reTHINK-project/specs/blob/master/messages/data-sync-messages.md#hyperty-request-to-be-an-observer\r\n\r\n      // Resume Subscriptions for the same Hyperty URL\r\n      // https://github.com/reTHINK-project/specs/blob/master/messages/data-sync-messages.md#resume-subscriptions-for-the-same-hyperty-url\r\n\r\n      // Resume Subscriptions for a certain user and data schema independently of the Hyperty URL.\r\n      // https://github.com/reTHINK-project/specs/blob/master/messages/data-sync-messages.md#resume-subscriptions-for-a-certain-user-and-data-schema-independently-of-the-hyperty-url\r\n      if (criteria) {\r\n        if (criteria.hasOwnProperty('p2p')) subscribeMsg.body.p2p = criteria.p2p;\r\n        if (criteria.hasOwnProperty('store')) subscribeMsg.body.store = criteria.store;\r\n        if (criteria.hasOwnProperty('schema')) subscribeMsg.body.schema = criteria.schema;\r\n        if (criteria.hasOwnProperty('identity')) subscribeMsg.body.identity = criteria.identity;\r\n        if (criteria.hasOwnProperty('resource')) subscribeMsg.body.resource = criteria.resource;\r\n      }\r\n\r\n      subscribeMsg.body.resume = criteria.resume;\r\n\r\n      //TODO: For Further Study\r\n      let mutual = criteria.mutual;\r\n      if (criteria.hasOwnProperty('mutual')) subscribeMsg.body.mutual = mutual;\r\n\r\n      console.log('[syncher] - subscribe message: ', criteria, subscribeMsg);\r\n\r\n      //request subscription\r\n      //Provisional data is applied to the DataObjectObserver after confirmation. Or discarded if there is no confirmation.\r\n      //for more info see the DataProvisional class documentation.\r\n      _this._bus.postMessage(subscribeMsg, (reply) => {\r\n        console.log('[syncher] - subscribe-resumed-response: ', reply);\r\n\r\n        let objURL = reply.body.resource;\r\n\r\n        let newProvisional = _this._provisionals[objURL];\r\n        delete _this._provisionals[objURL];\r\n        if (newProvisional) newProvisional._releaseListeners();\r\n\r\n        if (reply.body.code < 200) { // todo: check if this is needed for the resume\r\n\r\n          Syncher_log.log('[syncher] - resume new DataProvisional: ', reply, objURL);\r\n          newProvisional = new syncher_DataProvisional(_this._owner, objURL, _this._bus, reply.body.childrenResources);\r\n          _this._provisionals[objURL] = newProvisional;\r\n\r\n        } else if (reply.body.code === 200) {\r\n\r\n          let listOfObservers = reply.body.value;\r\n\r\n          for (let index in listOfObservers) {\r\n\r\n            let dataObject = listOfObservers[index];\r\n            console.log('[syncher] - Resume Object Observer: ', reply, dataObject, _this._provisionals);\r\n\r\n            if (dataObject.childrenObjects) { dataObject.childrenObjects = deepClone(dataObject.childrenObjects); }\r\n\r\n            dataObject.data = deepClone(dataObject.data) || {};\r\n            dataObject.resume = true;\r\n            dataObject.syncher = _this;\r\n\r\n            //TODO: mutual For Further Study\r\n            console.log('[syncher._resumeSubscribe] - create new dataObject: ', dataObject);\r\n            let newObj = new syncher_DataObjectObserver(dataObject);\r\n\r\n            if (dataObject.childrenObjects) { newObj.resumeChildrens(dataObject.childrenObjects); }\r\n            Syncher_log.log('[syncher._resumeSubscribe] - new dataObject', newObj);\r\n            _this._observers[newObj.url] = newObj;\r\n\r\n            if (_this._provisionals[newObj.url]) {\r\n              _this._provisionals[newObj.url].apply(newObj);\r\n            }\r\n\r\n            //lets sync with Reporter\r\n            // it was commented to let hyperties decide when to sync\r\n            //newObj.sync();\r\n          }\r\n\r\n          resolve(_this._observers);\r\n\r\n          if (this._onObserversResume) this._onObserversResume(_this._observers);\r\n\r\n        } else if (reply.body.code === 404) {\r\n          resolve({});\r\n        } else {\r\n          reject(reply.body.desc);\r\n        }\r\n      });\r\n    });\r\n\r\n  }\r\n\r\n  //FLOW-IN: message received from a local runtime ReporterObject -> _onRemoteSubscribe\r\n  _onForward(msg) {\r\n    let _this = this;\r\n\r\n    let reporter = _this._reporters[msg.body.to];\r\n    reporter._onForward(msg);\r\n  }\r\n\r\n  //FLOW-IN: message received from a remote Syncher -> create (this is actually an invitation to subscribe)\r\n  _onRemoteCreate(msg) {\r\n    let _this = this;\r\n    let resource = msg.from.slice(0, -13); //remove \"/subscription\" from the URL\r\n    let dividedURL = divideURL(resource);\r\n    let domain = dividedURL.domain;\r\n\r\n    let event = {\r\n      type: msg.type,\r\n      from: msg.body.source,\r\n      url: resource,\r\n      domain: domain,\r\n      schema: msg.body.schema,\r\n      value: msg.body.value,\r\n      identity: msg.body.identity,\r\n\r\n      ack: (type) => {\r\n        let lType = 200;\r\n        if (type) {\r\n          lType = type;\r\n        }\r\n\r\n       //send ack response message\r\n        _this._bus.postMessage({\r\n          id: msg.id, type: 'response', from: msg.to, to: msg.from,\r\n          body: { code: lType }\r\n        });\r\n      }\r\n    };\r\n\r\n    if (_this._onNotificationHandler) {\r\n      Syncher_log.info('[Syncher] NOTIFICATION-EVENT: ', event);\r\n      _this._onNotificationHandler(event);\r\n    }\r\n  }\r\n\r\n  //FLOW-IN: message received from a remote DataObjectReporter -> delete\r\n  _onRemoteDelete(msg) {\r\n    let _this = this;\r\n\r\n   //remove \"/subscription\" from the URL\r\n    let resource = msg.body.resource;\r\n\r\n    let object = _this._observers[resource];\r\n\r\n    let unsubscribe = {\r\n      from: _this.owner,\r\n      to: _this._subURL,\r\n      id: msg.id,\r\n      type: 'unsubscribe',\r\n      body: { resource: msg.body.resource }\r\n    };\r\n\r\n    _this._bus.postMessage(unsubscribe);\r\n\r\n    delete _this._observers[resource];\r\n\r\n    let event = {\r\n      type: msg.type,\r\n      url: resource,\r\n      identity: msg.body.identity,\r\n\r\n      ack: (type) => {\r\n        let lType = 200;\r\n        if (type) {\r\n          lType = type;\r\n        }\r\n\r\n       //TODO: any other different options for the release process, like accept but nor release local?\r\n        if (lType === 200 && object) {\r\n          object.delete();\r\n        }\r\n\r\n        //send ack response message\r\n        _this._bus.postMessage({\r\n          id: msg.id, type: 'response', from: msg.to, to: msg.from,\r\n          body: { code: lType, source: _this._owner }\r\n        });\r\n      }\r\n    };\r\n\r\n//    if (object) {\r\n\r\n\r\n      if (_this._onNotificationHandler) {\r\n        Syncher_log.log('NOTIFICATION-EVENT: ', event);\r\n        _this._onNotificationHandler(event);\r\n      }\r\n/*    } else {\r\n      _this._bus.postMessage({\r\n        id: msg.id, type: 'response', from: msg.to, to: msg.from,\r\n        body: { code: 404, source: _this._owner }\r\n      });\r\n    }*/\r\n  }\r\n\r\n  // close event received from runtime registry\r\n  _onExecute(msg) {\r\n    let _this = this;\r\n\r\n    let reply = {\r\n      id: msg.id, type: 'response', from: msg.to, to: msg.from,\r\n      body: { code: 200 }\r\n    };\r\n\r\n    if ((msg.from === _this._runtimeUrl + '/registry/' || msg.from === _this._runtimeUrl + '/registry') && msg.body && msg.body.method && msg.body.method === 'close' && _this._onClose) {\r\n      let event = {\r\n        type: 'close',\r\n\r\n        ack: (type) => {\r\n          if (type) {\r\n            reply.body.code = type;\r\n          }\r\n\r\n         //send ack response message\r\n          _this._bus.postMessage(reply);\r\n        }\r\n      };\r\n\r\n      Syncher_log.info('[Syncher] Close-EVENT: ', event);\r\n      _this._onClose(event);\r\n\r\n    } else {\r\n      _this._bus.postMessage(reply);\r\n    }\r\n\r\n  }\r\n\r\n  /**\r\n  * Callback system to trigger the resumed reporters\r\n  * @param  {Function} callback - function callback which will be invoked\r\n  * @return {Object<URL, DataObjectReporter>} Return one object with all resumed reporters;\r\n  */\r\n  onReportersResume(callback) {\r\n    this._onReportersResume = callback;\r\n  }\r\n\r\n  /**\r\n  * Callback system to trigger the resumed observers\r\n  * @param  {Function} callback - function callback which will be invoked\r\n  * @return {Object<URL, DataObjectObserver>} Return one object with all resumed observers;\r\n  */\r\n  onObserversResume(callback) {\r\n    this._onObserversResume = callback;\r\n  }\r\n\r\n}\r\n\r\n/* harmony default export */ var syncher_Syncher = (Syncher_Syncher);\r\n\n// CONCATENATED MODULE: ./src/syncher/NotificationHandler.js\n/**\r\n* The Notitification Handler is used to handle notifications not processed by the syncher when running in a sandbox.\r\n*/\r\n\r\n\r\n\r\nclass NotificationHandler_NotificationHandler {\r\n\r\n  constructor(bus) {\r\n\r\n    if (!bus) throw Error('[NotificationHandler Constructor] bus input is mandatory');\r\n    this._bus = bus;\r\n    this._onNotificationHandler = {};\r\n  }\r\n\r\n  onNotification(scheme, callback) {\r\n    this._onNotificationHandler[scheme] = callback;\r\n  }\r\n\r\n  onCreate(msg) {\r\n\r\n    let _this = this;\r\n  //  let resource = msg.from.slice(0, -13); //remove \"/subscription\" from the URL\r\n\r\n    let resource = msg.body.hasOwnProperty('resource') ? msg.body.resource : msg.from.slice(0, -13);\r\n    let dividedURL = divideURL(resource);\r\n    let domain = dividedURL.domain;\r\n    let scheme = resource.split('://')[0];\r\n\r\n    let error = (reason) => {\r\n      _this._bus.postMessage({\r\n        id: msg.id, type: 'response', from: msg.to, to: msg.from,\r\n        body: { code: 400, desc: 'Bad Request: ' + reason }\r\n      });\r\n    };\r\n\r\n    if (!msg.body.hasOwnProperty('source')) { error('Missing source'); }\r\n    if (!msg.body.hasOwnProperty('schema')) { error('Missing schema'); }\r\n    if (!msg.body.hasOwnProperty('value')) { error('Missing value'); }\r\n    if (!msg.body.hasOwnProperty('identity')) { error('Missing identity'); }\r\n\r\n    let event = {\r\n      type: msg.type,\r\n      from: msg.body.source,\r\n      url: resource,\r\n      domain: domain,\r\n      schema: msg.body.schema,\r\n      value: msg.body.value,\r\n      identity: msg.body.identity,\r\n      to: msg.to,\r\n      via: msg.body.via,\r\n\r\n      ack: (type) => {\r\n        let lType = 200;\r\n        if (type) {\r\n          lType = type;\r\n        }\r\n\r\n       //send ack response message\r\n        _this._bus.postMessage({\r\n          id: msg.id, type: 'response', from: msg.to, to: msg.from,\r\n          body: { code: lType }\r\n        });\r\n      },\r\n      error: (reason) => {\r\n        error(reason);\r\n      }\r\n    };\r\n    if (_this._onNotificationHandler[scheme]) {\r\n      console.info('[NotificationHandler] NOTIFICATION-EVENT: ', event);\r\n      _this._onNotificationHandler[scheme](event);\r\n    }\r\n  }\r\n\r\n  onDelete(msg) {\r\n    let _this = this;\r\n\r\n   //remove \"/subscription\" from the URL\r\n    let resource = msg.body.resource;\r\n\r\n    let object = _this._observers[resource];\r\n\r\n    let unsubscribe = {\r\n      from: _this.owner,\r\n      to: _this._subURL,\r\n      id: msg.id,\r\n      type: 'unsubscribe',\r\n      body: { resource: msg.body.resource }\r\n    };\r\n\r\n    _this._bus.postMessage(unsubscribe);\r\n\r\n    delete _this._observers[resource];\r\n\r\n    if (object) {\r\n      let event = {\r\n        type: msg.type,\r\n        url: resource,\r\n        identity: msg.body.identity,\r\n\r\n        ack: (type) => {\r\n          let lType = 200;\r\n          if (type) {\r\n            lType = type;\r\n          }\r\n\r\n         //TODO: any other different options for the release process, like accept but nor release local?\r\n          if (lType === 200) {\r\n            object.delete();\r\n          }\r\n\r\n          //send ack response message\r\n          _this._bus.postMessage({\r\n            id: msg.id, type: 'response', from: msg.to, to: msg.from,\r\n            body: { code: lType, source: _this._owner }\r\n          });\r\n        }\r\n      };\r\n\r\n      if (_this._onNotificationHandler) {\r\n        log.log('NOTIFICATION-EVENT: ', event);\r\n        _this._onNotificationHandler(event);\r\n      }\r\n    } else {\r\n      _this._bus.postMessage({\r\n        id: msg.id, type: 'response', from: msg.to, to: msg.from,\r\n        body: { code: 404, source: _this._owner }\r\n      });\r\n    }\r\n  }\r\n}\r\n\r\n/* harmony default export */ var syncher_NotificationHandler = (NotificationHandler_NotificationHandler);\r\n\n// CONCATENATED MODULE: ./src/identity/IdentityManager.js\n/**\r\n* Copyright 2016 PT Inovação e Sistemas SA\r\n* Copyright 2016 INESC-ID\r\n* Copyright 2016 QUOBIS NETWORKS SL\r\n* Copyright 2016 FRAUNHOFER-GESELLSCHAFT ZUR FOERDERUNG DER ANGEWANDTEN FORSCHUNG E.V\r\n* Copyright 2016 ORANGE SA\r\n* Copyright 2016 Deutsche Telekom AG\r\n* Copyright 2016 Apizee\r\n* Copyright 2016 TECHNISCHE UNIVERSITAT BERLIN\r\n*\r\n* Licensed under the Apache License, Version 2.0 (the \"License\");\r\n* you may not use this file except in compliance with the License.\r\n* You may obtain a copy of the License at\r\n*\r\n*   http://www.apache.org/licenses/LICENSE-2.0\r\n*\r\n* Unless required by applicable law or agreed to in writing, software\r\n* distributed under the License is distributed on an \"AS IS\" BASIS,\r\n* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n* See the License for the specific language governing permissions and\r\n* limitations under the License.\r\n**/\r\n\r\n\r\n/**\r\n* Core IdentityManager interface\r\n* Class to allow applications to search for Identities registered in runtime-core\r\n*/\r\nclass IdentityManager_IdentityManager {\r\n\r\n  /**\r\n  * To initialise the IdentityManager, which will provide the support for hyperties to\r\n  * query about identities registered\r\n  * @param  {String}          owner            owner\r\n  * @param  {String}          runtimeURL            runtimeURL\r\n  * @param  {MessageBus}          msgbus                msgbus\r\n  */\r\n  constructor(owner, runtimeURL, msgBus) {\r\n    let _this = this;\r\n    _this.messageBus = msgBus;\r\n\r\n    _this.domain = divideURL(owner).domain;\r\n    _this.owner = owner;\r\n    _this.runtimeURL = runtimeURL;\r\n  }\r\n\r\n  /**\r\n  * Function to query the runtime registry about the identity to which the hyperty was associated\r\n  * @param {String}       type (Optional)         type of user info required\r\n  * @param {String}       owner (Optional)   owner to search for\r\n  * @return {Promise}     userURL       userURL associated to the hyperty\r\n  */\r\n  discoverUserRegistered(type, hyperty) {\r\n    let _this = this;\r\n\r\n    return new Promise(function(resolve, reject) {\r\n\r\n      let activeHypertyURL;\r\n\r\n      // if any type of search is selected query for that type, otherwise query for default user info\r\n      let searchType = (type) ? type : '.';\r\n\r\n      if (!hyperty) {\r\n        activeHypertyURL = _this.owner;\r\n      } else {\r\n        activeHypertyURL = hyperty;\r\n      }\r\n\r\n      let msg = {\r\n        type: 'read', from: activeHypertyURL, to: _this.runtimeURL + '/registry/', body: { resource: searchType, criteria: activeHypertyURL}\r\n      };\r\n\r\n      _this.messageBus.postMessage(msg, (reply) => {\r\n\r\n        let userURL = reply.body.resource;\r\n\r\n        if (userURL && reply.body.code === 200) {\r\n          resolve(userURL);\r\n        } else {\r\n          reject('code: ' + reply.body.code + ' No user was found');\r\n        }\r\n      });\r\n    });\r\n  }\r\n\r\n  /**\r\n  * Function to query the Identity Module about authenticated identities from a certain domain\r\n  * @param {String}       idp idp domain of the identity to be discovered\r\n  * @return {Promise}     identity\r\n  */\r\n\r\n  discoverIdentityPerIdP(idp) {\r\n    let _this = this;\r\n\r\n    return new Promise(function(resolve, reject) {\r\n\r\n      let msg = {\r\n        type: 'read', from: this.owner, to: _this.runtimeURL + '/idm', body: { resource: idp, criteria: 'idp'}\r\n      };\r\n\r\n      _this.messageBus.postMessage(msg, (reply) => {\r\n\r\n        if (reply.body.code === 200) {\r\n          resolve(reply.body.value);\r\n        } else {\r\n          reject(reply.body.code + ' ' + reply.body.desc);\r\n        }\r\n      });\r\n    });\r\n  }\r\n}\r\n\r\n/* harmony default export */ var identity_IdentityManager = (IdentityManager_IdentityManager);\r\n\n// CONCATENATED MODULE: ./src/discovery/RegistrationStatus.js\n/**\r\n* Copyright 2016 PT Inovação e Sistemas SA\r\n* Copyright 2016 INESC-ID\r\n* Copyright 2016 QUOBIS NETWORKS SL\r\n* Copyright 2016 FRAUNHOFER-GESELLSCHAFT ZUR FOERDERUNG DER ANGEWANDTEN FORSCHUNG E.V\r\n* Copyright 2016 ORANGE SA\r\n* Copyright 2016 Deutsche Telekom AG\r\n* Copyright 2016 Apizee\r\n* Copyright 2016 TECHNISCHE UNIVERSITAT BERLIN\r\n*\r\n* Licensed under the Apache License, Version 2.0 (the \"License\");\r\n* you may not use this file except in compliance with the License.\r\n* You may obtain a copy of the License at\r\n*\r\n*   http://www.apache.org/licenses/LICENSE-2.0\r\n*\r\n* Unless required by applicable law or agreed to in writing, software\r\n* distributed under the License is distributed on an \"AS IS\" BASIS,\r\n* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n* See the License for the specific language governing permissions and\r\n* limitations under the License.\r\n**/\r\n\r\n// Log System\r\n\r\nlet RegistrationStatus_log = loglevel[\"getLogger\"]('RegistrationStatus');\r\n\r\n\r\n\r\n/**\r\n* The RegistrationStatus lib allows to monitor registration status of an Hyperty or Data Object\r\n*\r\n*/\r\nclass RegistrationStatus_RegistrationStatus {\r\n\r\n  /**\r\n  * @param {URL} url URL address of the entity to be monitored\r\n  * @param {URL} runtimeURL the current URL of the Runtime Instance used\r\n  * @param {HypertyURL} owner the URL of the Hyperty instance that is using this lib\r\n  * @param {MiniBus} owner the URL of the Hyperty instance that is using this lib\r\n  *\r\n  */\r\n\r\n  constructor(url, runtimeURL, owner, msgBus) {\r\n    this._registryObjectURL = url;\r\n    this._runtimeURL = runtimeURL;\r\n    this._domain = divideURL(runtimeURL).domain;\r\n    this._discoveredObjectURL = owner;\r\n    this._messageBus = msgBus;\r\n    this._subscriptionSet = false;\r\n    this._subscribers = {\r\n      live: {},\r\n      disconnected: {}\r\n    };\r\n  }\r\n\r\n\r\n  onLive(subscriber, callback) {\r\n\r\n    return new Promise((resolve, reject) => {\r\n\r\n      if (!this._subscriptionSet) {\r\n        this._subscribe()\r\n        .then(() => {\r\n          this._subscribers.live[subscriber] = callback;\r\n          resolve();\r\n        })\r\n        .catch((err) => reject(err));\r\n      } else {\r\n        this._subscribers.live[subscriber] = callback;\r\n        resolve();\r\n      }\r\n    });\r\n  }\r\n\r\n  onDisconnected(subscriber, callback) {\r\n\r\n    return new Promise((resolve, reject) => {\r\n\r\n      if (!this._subscriptionSet) {\r\n        this._subscribe()\r\n        .then(() => {\r\n          this._subscribers.disconnected[subscriber] = callback;\r\n          resolve();\r\n        })\r\n        .catch((err) => reject(err));\r\n      } else {\r\n        this._subscribers.disconnected[subscriber] = callback;\r\n        resolve();\r\n      }\r\n    });\r\n  }\r\n\r\n  _subscribe() {\r\n\r\n    const msg = {\r\n      type: 'subscribe',\r\n      from: this._discoveredObjectURL,\r\n      to: this._runtimeURL + '/subscriptions',\r\n      body: {\r\n        resources: [this._registryObjectURL + '/registration']\r\n      }\r\n    };\r\n\r\n    return new Promise((resolve, reject) => {\r\n\r\n      this._messageBus.postMessage(msg, (reply) => {\r\n        RegistrationStatus_log.log(`[DiscoveredObject.subscribe] ${this._registryObjectURL} rcved reply `, reply);\r\n\r\n        if (reply.body.code === 200) {\r\n          this._generateListener(this._registryObjectURL + '/registration');\r\n          this._subscriptionSet = true;\r\n          resolve();\r\n        } else {\r\n          RegistrationStatus_log.error('Error subscribing ', this._registryObjectURL);\r\n          reject('Error subscribing ' + this._registryObjectURL);\r\n        }\r\n      });\r\n    });\r\n  }\r\n\r\n  _generateListener(notificationURL) {\r\n\r\n    this._messageBus.addListener(notificationURL, (msg) => {\r\n      RegistrationStatus_log.log(`[DiscoveredObject.notification] ${this._registryObjectURL}: `, msg);\r\n      this._processNotification(msg);\r\n    });\r\n  }\r\n\r\n  _processNotification(msg) {\r\n    const status = msg.body.value;\r\n\r\n    setTimeout(() => {\r\n\r\n      // Hack to give time for onLive Hyperties to get ready. To be removed when Hyperty State machaine is implemented\r\n      Object.keys(this._subscribers[status]).forEach(\r\n        subscriber => this._subscribers[status][subscriber]()\r\n      );\r\n\r\n    }, 5000);\r\n\r\n  }\r\n\r\n\r\n  _unsubscribe() {\r\n\r\n    const msg = {\r\n      type: 'unsubscribe',\r\n      from: this._discoveredObjectURL,\r\n      to: this._runtimeURL + '/subscriptions',\r\n      body: {\r\n        resource: this._registryObjectURL + '/registration'\r\n      }\r\n    };\r\n\r\n    return new Promise((resolve, reject) => {\r\n\r\n      this._messageBus.postMessage(msg, (reply) => {\r\n        RegistrationStatus_log.log(`[DiscoveredObject.unsubscribe] ${this._registryObjectURL} rcved reply `, reply);\r\n\r\n        if (reply.body.code === 200) {\r\n          resolve();\r\n        } else {\r\n          RegistrationStatus_log.error('Error unsubscribing ', this._registryObjectURL);\r\n          reject('Error unsubscribing ' + this._registryObjectURL);\r\n        }\r\n      });\r\n    });\r\n  }\r\n\r\n  unsubscribeLive(subscriber) {\r\n    return new Promise((resolve, reject) => {\r\n\r\n      if (subscriber in this._subscribers.live) {\r\n\r\n          //TODO: unsubscribe outside this condition\r\n        delete this._subscribers.live[subscriber];\r\n      }\r\n\r\n      if (this._areSubscriptionsEmpty()) {\r\n        this._unsubscribe()\r\n            .then(() => resolve())\r\n            .catch((err) => reject(err));\r\n      } else {\r\n        resolve();\r\n      }\r\n\r\n      /*  } else {\r\n          reject(`${subscriber} doesn't subscribe onLive for ${this._registryObjectURL}`);\r\n        }*/\r\n    });\r\n  }\r\n\r\n  unsubscribeDisconnected(subscriber) {\r\n    return new Promise((resolve, reject) => {\r\n\r\n      if (subscriber in this._subscribers.disconnected) {\r\n        delete this._subscribers.disconnected[subscriber];\r\n\r\n        if (this._areSubscriptionsEmpty()) {\r\n          this._unsubscribe()\r\n          .then(() => resolve())\r\n          .catch((err) => reject(err));\r\n        } else {\r\n          resolve();\r\n        }\r\n      } else {\r\n        reject(`${subscriber} doesn't subscribe onDisconnected for ${this._registryObjectURL}`);\r\n      }\r\n    });\r\n  }\r\n\r\n  _areSubscriptionsEmpty() {\r\n    return Object.keys(this._subscribers.live).length === 0\r\n      && Object.keys(this._subscribers.disconnected).length === 0;\r\n  }\r\n\r\n}\r\n\r\n/* harmony default export */ var discovery_RegistrationStatus = (RegistrationStatus_RegistrationStatus);\r\n\n// CONCATENATED MODULE: ./src/discovery/DiscoveredObject.js\n/**\r\n* Copyright 2016 PT Inovação e Sistemas SA\r\n* Copyright 2016 INESC-ID\r\n* Copyright 2016 QUOBIS NETWORKS SL\r\n* Copyright 2016 FRAUNHOFER-GESELLSCHAFT ZUR FOERDERUNG DER ANGEWANDTEN FORSCHUNG E.V\r\n* Copyright 2016 ORANGE SA\r\n* Copyright 2016 Deutsche Telekom AG\r\n* Copyright 2016 Apizee\r\n* Copyright 2016 TECHNISCHE UNIVERSITAT BERLIN\r\n*\r\n* Licensed under the Apache License, Version 2.0 (the \"License\");\r\n* you may not use this file except in compliance with the License.\r\n* You may obtain a copy of the License at\r\n*\r\n*   http://www.apache.org/licenses/LICENSE-2.0\r\n*\r\n* Unless required by applicable law or agreed to in writing, software\r\n* distributed under the License is distributed on an \"AS IS\" BASIS,\r\n* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n* See the License for the specific language governing permissions and\r\n* limitations under the License.\r\n**/\r\n\r\n//import {divideURL, convertToUserURL} from '../utils/utils';\r\n\r\n\r\n/**\r\n* Discovered Object interface\r\n*/\r\nclass DiscoveredObject_DiscoveredObject extends discovery_RegistrationStatus {\r\n\r\n  get data() {\r\n    return this._data;\r\n  }\r\n\r\n  constructor(data, runtimeURL, discoveryURL, msgBus, discovery) {\r\n    super(data.hypertyID || data.url, runtimeURL, discoveryURL, msgBus);\r\n\r\n    this._data = data;\r\n    this._discovery = discovery;\r\n  }\r\n\r\n\r\n\r\n\r\n  /**\r\n  * function to check the status of the DiscoveredObject.\r\n  * Depending on existing subscribers it may trigger onLive or onDisconnected events.\r\n  *\r\n  */\r\n\r\n  check() {\r\n    // query DR for the status and call processNotification with msg received\r\n\r\n    let _this = this;\r\n    let message = {\r\n      body: {}\r\n    };\r\n\r\n    if (_this._discoveredObjectURL.startsWith('hyperty://') ) {\r\n      _this._discovery.discoverHypertyPerURL(_this._discoveredObjectURL).then((registration)=>{\r\n        message.body.status = registration.status;\r\n        _this._processNotification(message);\r\n      });\r\n    } else {\r\n      _this._discovery.discoverDataObjectsPerURL(_this._discoveredObjectURL).then((registration)=>{\r\n        message.body.status = registration.status;\r\n        _this._processNotification(message);\r\n      });\r\n    }\r\n  }\r\n\r\n\r\n\r\n}\r\n\r\n/* harmony default export */ var discovery_DiscoveredObject = (DiscoveredObject_DiscoveredObject);\r\n\n// CONCATENATED MODULE: ./src/discovery/Discovery.js\n/**\r\n* Copyright 2016 PT Inovação e Sistemas SA\r\n* Copyright 2016 INESC-ID\r\n* Copyright 2016 QUOBIS NETWORKS SL\r\n* Copyright 2016 FRAUNHOFER-GESELLSCHAFT ZUR FOERDERUNG DER ANGEWANDTEN FORSCHUNG E.V\r\n* Copyright 2016 ORANGE SA\r\n* Copyright 2016 Deutsche Telekom AG\r\n* Copyright 2016 Apizee\r\n* Copyright 2016 TECHNISCHE UNIVERSITAT BERLIN\r\n*\r\n* Licensed under the Apache License, Version 2.0 (the \"License\");\r\n* you may not use this file except in compliance with the License.\r\n* You may obtain a copy of the License at\r\n*\r\n*   http://www.apache.org/licenses/LICENSE-2.0\r\n*\r\n* Unless required by applicable law or agreed to in writing, software\r\n* distributed under the License is distributed on an \"AS IS\" BASIS,\r\n* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n* See the License for the specific language governing permissions and\r\n* limitations under the License.\r\n**/\r\n\r\n// Log System\r\n\r\nlet Discovery_log = loglevel[\"getLogger\"]('Discovery');\r\n\r\n\r\n\r\n\r\n/**\r\n* Core Discovery interface\r\n* Class to allow applications to search for hyperties and DataObjects using the message bus\r\n*/\r\nclass Discovery_Discovery {\r\n\r\n  /**\r\n  * To initialise the HypertyDiscover, which will provide the support for hyperties to\r\n  * query users registered in outside the internal core.\r\n  * @param  {MessageBus}          msgbus                msgbus\r\n  * @param  {RuntimeURL}          runtimeURL            runtimeURL\r\n  */\r\n  constructor(hypertyURL, runtimeURL, msgBus) {\r\n    let _this = this;\r\n    _this.messageBus = msgBus;\r\n    _this.runtimeURL = runtimeURL;\r\n\r\n    _this.domain = divideURL(hypertyURL).domain;\r\n    _this.discoveryURL = hypertyURL;\r\n  }\r\n\r\n  /**\r\n  * Advanced Search for Hyperties registered in domain registry associated with some user identifier (eg email, name ...)\r\n  * @param  {String}           userIdentifier\r\n  * @param  {Array<string>}    schema (Optional)     types of hyperties schemas\r\n  * @param  {Array<string>}    resources (Optional)  types of hyperties resources\r\n  */\r\n  _isLegacyUser(userIdentifier) {\r\n    if (userIdentifier.includes(':') && !userIdentifier.includes('user://')) {\r\n      return true;\r\n    } else {\r\n      return false;\r\n    }\r\n  }\r\n\r\n  /**\r\n  * Advanced Search for Hyperties registered in domain registry associated with some user identifier (eg email, name ...)\r\n  * @param  {String}           userIdentifier\r\n  * @param  {Array<string>}    schema (Optional)     types of hyperties schemas\r\n  * @param  {Array<string>}    resources (Optional)  types of hyperties resources\r\n  */\r\n  discoverHypertiesPerUserProfileData(userIdentifier, schema, resources) {\r\n    let _this = this;\r\n    let filteredHyperties = [];\r\n\r\n    let msg = {\r\n      type: 'read',\r\n      from: _this.discoveryURL,\r\n      to: _this.runtimeURL + '/discovery/',\r\n      body: {\r\n        resource: '/hyperty/userprofile/' + userIdentifier,\r\n      }\r\n    };\r\n\r\n    if (schema || resources) {\r\n      msg.body['criteria'] = {\r\n        resources: resources,\r\n        dataSchemes: schema\r\n      };\r\n    }\r\n\r\n    return new Promise(function(resolve, reject) {\r\n\r\n      if (!_this._isLegacyUser(userIdentifier)) {// todo: to reomve when discovery of legcay users are supported\r\n\r\n        _this.messageBus.postMessage(msg, (reply) => {\r\n\r\n          if(reply.body.code === 200){\r\n            reply.body.value.map(function(hyperty) {\r\n               if(hyperty.hypertyID != _this.discoveryURL)\r\n                   filteredHyperties.push(hyperty);\r\n            });\r\n            if(filteredHyperties.length === 0)\r\n              resolve([]);\r\n            else {\r\n              Discovery_log.log(\"[Discovery.discoverHypertiesPerUserProfileData] Reply log: \",filteredHyperties);\r\n              resolve(filteredHyperties);\r\n            }\r\n          }\r\n          else {\r\n            Discovery_log.warn(\"[Discovery.discoverHypertiesPerUserProfileData] Error Reply for \" + userIdentifier + \" Reason: \", reply.body.description);\r\n            resolve([]);\r\n          }\r\n        });\r\n      } else {\r\n        resolve([{hypertyID: userIdentifier, status: 'live'}]);\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n  * Advanced Search for Hyperties registered in domain registry associated with some user identifier (eg email, name ...)\r\n  * returns DiscoveredObject\r\n  * @param  {String}           userIdentifier\r\n  * @param  {Array<string>}    schema (Optional)     types of hyperties schemas\r\n  * @param  {Array<string>}    resources (Optional)  types of hyperties resources\r\n  */\r\n  discoverHypertiesPerUserProfileDataDO(userIdentifier, schema, resources) {\r\n\r\n    return new Promise((resolve, reject) => {\r\n      this.discoverHypertiesPerUserProfileData(...arguments)\r\n      .then(hyperties => {\r\n        resolve(this._convertToDiscoveredObject(hyperties));\r\n      })\r\n      .catch(error => reject(error));\r\n    });\r\n  }\r\n\r\n  /**\r\n  * Advanced Search for DataObjects registered in domain registry associated with some user identifier (eg email, name ...)\r\n  * @param  {String}           userIdentifier\r\n  * @param  {Array<string>}    schema (Optional)     types of hyperties schemas\r\n  * @param  {Array<string>}    resources (Optional)  types of hyperties resources\r\n  */\r\n  discoverDataObjectsPerUserProfileData(userIdentifier, schema, resources) {\r\n    let _this = this;\r\n\r\n    let msg = {\r\n      type: 'read',\r\n      from: _this.discoveryURL,\r\n      to: _this.runtimeURL + '/discovery/',\r\n      body: {\r\n        resource: '/dataObject/userprofile/' + userIdentifier,\r\n      }\r\n    };\r\n\r\n    if(schema || resources) {\r\n      msg.body['criteria'] = {\r\n        resources: resources,\r\n        dataSchemes: schema\r\n      };\r\n    }\r\n\r\n    return new Promise(function(resolve, reject) {\r\n\r\n      if (!_this._isLegacyUser(userIdentifier)) {// todo: to reomve when discovery of legcay users are supported\r\n\r\n        _this.messageBus.postMessage(msg, (reply) => {\r\n\r\n          if(reply.body.code === 200){\r\n            Discovery_log.log(\"Reply log: \",reply.body.value);\r\n            resolve(reply.body.value);\r\n          }\r\n          else {\r\n            Discovery_log.warn(\"[Discovery.discoverDataObjectsPerUserProfileData] Error Reply for \" + userIdentifier + \" Reason: \", reply.body.description);\r\n            resolve([]);\r\n          }\r\n        });\r\n      } else {\r\n          resolve([{hypertyID: userIdentifier, status: 'live'}]);\r\n        }\r\n    });\r\n  }\r\n\r\n  /**\r\n  * function to request about dataObject registered in domain registry, and\r\n  * returns discoveredObject.\r\n  * @param  {String}           guidURL                guid URL e.g user-guid://<unique-user-identifier>\r\n  * @param  {Array<string>}    schema (Optional)     types of hyperties schemas\r\n  * @param  {Array<string>}    resources (Optional)  types of hyperties resources\r\n  * @param  {String}           domain (Optional)     domain of the registry to search\r\n  */\r\n  discoverDataObjectsPerUserProfileDataDO(guidURL, schema, resources) {\r\n\r\n    return new Promise((resolve, reject) => {\r\n      this.discoverDataObjectsPerUserProfileData(...arguments)\r\n        .then(registryObjects => resolve(this._convertToDiscoveredObject(registryObjects)))\r\n        .catch(error => reject(error));\r\n    });\r\n  }\r\n\r\n  /**\r\n  * Advanced Search for Hyperties registered in domain registry associated with some GUID\r\n  * @param  {String}           guidURL                guid URL e.g user-guid://<unique-user-identifier>\r\n  * @param  {Array<string>}    schema (Optional)     types of hyperties schemas\r\n  * @param  {Array<string>}    resources (Optional)  types of hyperties resources\r\n  */\r\n  discoverHypertiesPerGUID(guidURL, schema, resources) {\r\n    let _this = this;\r\n    let filteredHyperties = [];\r\n\r\n    let msg = {\r\n      type: 'read',\r\n      from: _this.discoveryURL,\r\n      to: _this.runtimeURL + '/discovery/',\r\n      body: {\r\n        resource: '/hyperty/guid/' + guidURL,\r\n      }\r\n    };\r\n\r\n    if(schema || resources) {\r\n      msg.body['criteria'] = {\r\n        resources: resources,\r\n        dataSchemes: schema\r\n      };\r\n    }\r\n\r\n    return new Promise(function(resolve, reject) {\r\n\r\n      _this.messageBus.postMessage(msg, (reply) => {\r\n\r\n        if(reply.body.code === 200){\r\n          reply.body.value.map(function(hyperty) {\r\n             if(hyperty.hypertyID != _this.discoveryURL)\r\n                 filteredHyperties.push(hyperty);\r\n          });\r\n          if(filteredHyperties.length === 0)\r\n            reject('No Hyperty was found');\r\n          else {\r\n            Discovery_log.log(\"Reply log: \",filteredHyperties);\r\n            resolve(filteredHyperties);\r\n          }\r\n        }\r\n        else {\r\n          Discovery_log.warn(\"[Discovery.discoverHypertiesPerGUID] Error Reply for \" + guidURL + \" Reason: \", reply.body.description);\r\n          resolve([]);\r\n        }\r\n      });\r\n    });\r\n  }\r\n\r\n  /**\r\n  * Advanced Search for Hyperties registered in domain registry associated with some GUID\r\n  * returns DiscoveredObject\r\n  * @param  {String}           guidURL                guid URL e.g user-guid://<unique-user-identifier>\r\n  * @param  {Array<string>}    schema (Optional)     types of hyperties schemas\r\n  * @param  {Array<string>}    resources (Optional)  types of hyperties resources\r\n  */\r\n  discoverHypertiesPerGUIDDO(guidURL, schema, resources) {\r\n\r\n    return new Promise((resolve, reject) => {\r\n      this.discoverHypertiesPerGUID(...arguments)\r\n      .then(hyperties => {\r\n        resolve(this._convertToDiscoveredObject(hyperties));\r\n      })\r\n      .catch(error => reject(error));\r\n    });\r\n  }\r\n\r\n  /**\r\n  * Advanced Search for DataObjects registered in domain registry associated with some GUID\r\n  * @param  {String}           guidURL                guid URL e.g user-guid://<unique-user-identifier>\r\n  * @param  {Array<string>}    schema (Optional)     types of hyperties schemas\r\n  * @param  {Array<string>}    resources (Optional)  types of hyperties resources\r\n  * @param  {String}           domain (Optional)     domain of the registry to search\r\n  */\r\n  discoverDataObjectsPerGUID(guidURL, schema, resources) {\r\n    let _this = this;\r\n\r\n    let msg = {\r\n      type: 'read',\r\n      from: _this.discoveryURL,\r\n      to: _this.runtimeURL + '/discovery/',\r\n      body: {\r\n        resource: '/dataObject/guid/' + guidURL,\r\n      }\r\n    };\r\n\r\n    if(schema || resources) {\r\n      msg.body['criteria'] = {\r\n        resources: resources,\r\n        dataSchemes: schema\r\n      };\r\n    }\r\n\r\n    return new Promise(function(resolve, reject) {\r\n\r\n      _this.messageBus.postMessage(msg, (reply) => {\r\n\r\n        if(reply.body.code === 200){\r\n          Discovery_log.log(\"Reply log: \",reply.body.value);\r\n          resolve(reply.body.value);\r\n        }\r\n        else {\r\n          Discovery_log.warn(\"[Discovery.discoverDataObjectsPerGUID] Error Reply for \" + guidURL + \" Reason: \", reply.body.description);\r\n          resolve([]);\r\n        }\r\n      });\r\n    });\r\n  }\r\n\r\n  /**\r\n  * function to request about dataObject registered in domain registry, and\r\n  * returns discoveredObject.\r\n  * @param  {String}           guidURL                guid URL e.g user-guid://<unique-user-identifier>\r\n  * @param  {Array<string>}    schema (Optional)     types of hyperties schemas\r\n  * @param  {Array<string>}    resources (Optional)  types of hyperties resources\r\n  * @param  {String}           domain (Optional)     domain of the registry to search\r\n  */\r\n  discoverDataObjectsPerGUIDDO(guidURL, schema, resources) {\r\n\r\n    return new Promise((resolve, reject) => {\r\n      this.discoverDataObjectsPerGUID(...arguments)\r\n        .then(registryObjects => resolve(this._convertToDiscoveredObject(registryObjects)))\r\n        .catch(error => reject(error));\r\n    });\r\n  }\r\n\r\n  /** Advanced Search for Hyperties registered in domain registry\r\n  * @param  {String}           user                  user identifier, either in url or email format\r\n  * @param  {Array<string>}    schema (Optional)     types of hyperties schemas\r\n  * @param  {Array<string>}    resources (Optional)  types of hyperties resources\r\n  * @param  {String}           domain (Optional)     domain of the registry to search\r\n  */\r\n  discoverHyperties(user, schema, resources, domain) {\r\n    let _this = this;\r\n    let activeDomain;\r\n    let filteredHyperties = [];\r\n\r\n    activeDomain = (!domain) ? _this.domain : domain;\r\n\r\n    let msg = {\r\n      type: 'read',\r\n      from: _this.discoveryURL,\r\n      to: _this.runtimeURL + '/discovery/',\r\n      body: {\r\n        resource: '/hyperty/user/' + user,\r\n      }\r\n    };\r\n\r\n    if(schema || resources) {\r\n      msg.body['criteria'] = {\r\n        resources: resources,\r\n        dataSchemes: schema,\r\n        domain: activeDomain\r\n      };\r\n    }else {\r\n      msg.body['criteria'] = {\r\n        domain: activeDomain\r\n      }\r\n    }\r\n\r\n    return new Promise(function(resolve, reject) {\r\n\r\n      if (!_this._isLegacyUser(user)) {// todo: to reomve when discovery of legcay users are supported\r\n\r\n        _this.messageBus.postMessage(msg, (reply) => {\r\n\r\n          if(reply.body.code === 200 || reply.body.code === 500){\r\n            reply.body.value.map(function(hyperty) {\r\n               if(hyperty.hypertyID != _this.discoveryURL)\r\n                   filteredHyperties.push(hyperty);\r\n            });\r\n/*            if(filteredHyperties.length === 0)\r\n              reject('No Hyperty was found');\r\n            else {*/\r\n              Discovery_log.log(\"[Discovery.discoverHyperties] Reply : \",filteredHyperties);\r\n              resolve(filteredHyperties);\r\n//            }\r\n          }\r\n          else {\r\n            Discovery_log.warn(\"[Discovery.discoverHyperties] Error Reply for \" + user + \" Reason: \", reply.body.description);\r\n            resolve(filteredHyperties);\r\n          }\r\n        });\r\n      } else {\r\n        resolve([{hypertyID: user, status: 'live'}]);\r\n      }\r\n    });\r\n  }\r\n\r\n  /** Advanced Search for Hyperties registered in domain registry,\r\n  *returns DiscoveredObject\r\n  * @param  {String}           user                  user identifier, either in url or email format\r\n  * @param  {Array<string>}    schema (Optional)     types of hyperties schemas\r\n  * @param  {Array<string>}    resources (Optional)  types of hyperties resources\r\n  * @param  {String}           domain (Optional)     domain of the registry to search\r\n  */\r\n  discoverHypertiesDO(user, schema, resources, domain) {\r\n\r\n    return new Promise((resolve, reject) => {\r\n      this.discoverHyperties(...arguments)\r\n      .then(hyperties => {\r\n        resolve(this._convertToDiscoveredObject(hyperties));\r\n      })\r\n      .catch(error => reject(error));\r\n    });\r\n  }\r\n\r\n  /** Advanced Search for DataObjects registered in domain registry\r\n  * @param  {String}           user                  user identifier, either in url or email format\r\n  * @param  {Array<string>}    schema (Optional)     types of dataObjects schemas\r\n  * @param  {Array<string>}    resources (Optional)  types of dataObjects resources\r\n  * @param  {String}           domain (Optional)     domain of the registry to search\r\n  */\r\n  discoverDataObjects(user, schema, resources, domain) {\r\n    let _this = this;\r\n    let activeDomain;\r\n\r\n    activeDomain = (!domain) ? _this.domain : domain;\r\n\r\n    let msg = {\r\n      type: 'read',\r\n      from: _this.discoveryURL,\r\n      to: _this.runtimeURL + '/discovery/',\r\n      body: {\r\n        resource: '/dataObject/user/' + user,\r\n      }\r\n    };\r\n\r\n    if(schema || resources) {\r\n      msg.body['criteria'] = {\r\n        resources: resources,\r\n        dataSchemes: schema,\r\n        domain: activeDomain\r\n      };\r\n    }else {\r\n      msg.body['criteria'] = {\r\n        domain: activeDomain\r\n      }\r\n    }\r\n\r\n    return new Promise(function(resolve, reject) {\r\n\r\n      _this.messageBus.postMessage(msg, (reply) => {\r\n\r\n        if(reply.body.code === 200){\r\n          Discovery_log.log(\"Reply Value Log: \",reply.body.value);\r\n          resolve(reply.body.value);\r\n        }\r\n        else {\r\n          Discovery_log.warn(\"[Discovery.discoverDataObjects] Error Reply for \" + user + \" Reason: \", reply.body.description);\r\n          resolve([]);\r\n        }\r\n      });\r\n    });\r\n  }\r\n\r\n  /**\r\n  * function to request about dataObject registered in domain registry, and\r\n  * returns discoveredObject.\r\n  * @param  {String}           user                  user identifier, either in url or email format\r\n  * @param  {Array<string>}    schema (Optional)     types of dataObjects schemas\r\n  * @param  {Array<string>}    resources (Optional)  types of dataObjects resources\r\n  * @param  {String}           domain (Optional)     domain of the registry to search\r\n  */\r\n  discoverDataObjectsDO(user, schema, resources, domain) {\r\n\r\n    return new Promise((resolve, reject) => {\r\n      this.discoverDataObjects(...arguments)\r\n        .then(registryObjects => resolve(this._convertToDiscoveredObject(registryObjects)))\r\n        .catch(error => reject(error));\r\n    });\r\n  }\r\n\r\n  /**\r\n  * function to request about hyperties registered in domain registry, and\r\n  * return the hyperty information, if found.\r\n  * @param  {String}              url  hyperty URL\r\n  * @param  {String}            domain (Optional)\r\n  */\r\n  discoverHypertyPerURL(url, domain) {\r\n    let _this = this;\r\n    let activeDomain;\r\n\r\n    activeDomain = (!domain) ? _this.domain : domain;\r\n\r\n    let msg = {\r\n      type: 'read',\r\n      from: _this.discoveryURL,\r\n      to: _this.runtimeURL + '/discovery/',\r\n      body: {\r\n        resource: '/hyperty/url/' + url,\r\n        criteria: {\r\n          domain: activeDomain\r\n        }\r\n      }\r\n    };\r\n\r\n    return new Promise(function(resolve, reject) {\r\n\r\n      _this.messageBus.postMessage(msg, (reply) => {\r\n\r\n        if(reply.body.code === 200){\r\n          Discovery_log.log(\"Reply Value Log: \",reply.body.value);\r\n          resolve(reply.body.value);\r\n        }\r\n        else {\r\n          Discovery_log.warn(\"[Discovery.discoverHypertyPerURL] Error Reply for \" + url + \" Reason: \", reply.body.description);\r\n          resolve([]);\r\n        }\r\n      });\r\n    });\r\n  }\r\n\r\n  /**\r\n  * function to request about hyperties registered in domain registry, and\r\n  * returns discoveredObject.\r\n  * @param  {String}              url  hyperty URL\r\n  * @param  {String}            domain (Optional)\r\n  */\r\n  discoverHypertyPerURLDO(url, domain) {\r\n\r\n    return new Promise((resolve, reject) => {\r\n      this.discoverHypertyPerURL(...arguments)\r\n        .then(hyperty => resolve(new discovery_DiscoveredObject(hyperty, this.runtimeURL, this.discoveryURL, this.messageBus, this)))\r\n        .catch(error => reject(error));\r\n    });\r\n  }\r\n\r\n  /**\r\n  * function to request about dataObject registered in domain registry, and\r\n  * return the dataObject information, if found.\r\n  * @param  {String}              url  dataObject URL\r\n  * @param  {String}            domain (Optional)\r\n  */\r\n  discoverDataObjectPerURL(url, domain) {\r\n    let _this = this;\r\n    let activeDomain;\r\n\r\n    activeDomain = (!domain) ? _this.domain : domain;\r\n\r\n    let msg = {\r\n      type: 'read',\r\n      from: _this.discoveryURL,\r\n      to: _this.runtimeURL + '/discovery/',\r\n      body: {\r\n        resource: '/dataObject/url/' + url,\r\n        criteria: {\r\n          domain: activeDomain\r\n        }\r\n      }\r\n    };\r\n\r\n    return new Promise(function(resolve, reject) {\r\n\r\n      _this.messageBus.postMessage(msg, (reply) => {\r\n\r\n        if(reply.body.code === 200){\r\n          Discovery_log.log(\"Reply Value Log: \",reply.body.value);\r\n          resolve(reply.body.value);\r\n        }\r\n        else {\r\n          Discovery_log.warn(\"[Discovery.discoverDataObjectPerURL] Error Reply for \" + url + \" Reason: \", reply.body.description);\r\n          resolve([]);\r\n        }\r\n      });\r\n    });\r\n  }\r\n\r\n  /**\r\n  * function to request about dataObject registered in domain registry, and\r\n  * returns discoveredObject.\r\n  * @param  {String}              url  dataObject URL\r\n  * @param  {String}            domain (Optional)\r\n  */\r\n  discoverDataObjectPerURLDO(url, domain) {\r\n\r\n    return new Promise((resolve, reject) => {\r\n      this.discoverDataObjectPerURL(...arguments)\r\n        .then(registryObject => resolve(new discovery_DiscoveredObject(registryObject, this.runtimeURL, this.discoveryURL, this.messageBus, this)))\r\n        .catch(error => reject(error));\r\n    });\r\n  }\r\n\r\n  /**\r\n  * function to request about an dataObjects registered in domain registry with a given name, and\r\n  * return the dataObjects information, if found.\r\n  * @param  {String}              name  dataObject URL\r\n  * @param  {Array<string>}    schema (Optional)     types of dataObjects schemas\r\n  * @param  {Array<string>}    resources (Optional)  types of dataObjects resources\r\n  * @param  {String}            domain (Optional)\r\n  */\r\n  discoverDataObjectsPerName(name, schema, resources, domain) {\r\n    let _this = this;\r\n    let activeDomain;\r\n\r\n    activeDomain = (!domain) ? _this.domain : domain;\r\n\r\n    let msg = {\r\n      type: 'read',\r\n      from: _this.discoveryURL,\r\n      to: _this.runtimeURL + '/discovery/',\r\n      body: {\r\n        resource: '/dataObject/name/' + name\r\n      }\r\n    };\r\n\r\n    if(schema || resources) {\r\n      msg.body['criteria'] = {\r\n        resources: resources,\r\n        dataSchemes: schema,\r\n        domain: activeDomain\r\n      };\r\n    }else {\r\n      msg.body['criteria'] = {\r\n        domain: activeDomain\r\n      }\r\n    }\r\n\r\n    return new Promise(function(resolve, reject) {\r\n\r\n      _this.messageBus.postMessage(msg, (reply) => {\r\n\r\n        if(reply.body.code === 200){\r\n          Discovery_log.log(\"Reply Value Log: \",reply.body.value);\r\n          resolve(reply.body.value);\r\n        }\r\n        else {\r\n          Discovery_log.warn(\"[Discovery.discoverDataObjectsPerName] Error Reply for \" + name + \" Reason: \", reply.body.description);\r\n          resolve([]);\r\n        }\r\n      });\r\n    });\r\n  }\r\n\r\n  /**\r\n  * function to request about dataObject registered in domain registry, and\r\n  * returns discoveredObject.\r\n  * @param  {String}              name  dataObject URL\r\n  * @param  {Array<string>}    schema (Optional)     types of dataObjects schemas\r\n  * @param  {Array<string>}    resources (Optional)  types of dataObjects resources\r\n  * @param  {String}            domain (Optional)\r\n  */\r\n  discoverDataObjectsPerNameDO(name, schema, resources, domain) {\r\n\r\n    return new Promise((resolve, reject) => {\r\n      this.discoverDataObjectsPerName(...arguments)\r\n        .then(registryObjects => resolve(this._convertToDiscoveredObject(registryObjects)))\r\n        .catch(error => reject(error));\r\n    });\r\n  }\r\n\r\n  /**\r\n  * function to request about specific reporter dataObject registered in domain registry, and\r\n  * return the dataObjects from that reporter.\r\n  * @param  {String}           reporter     dataObject reporter\r\n  * @param  {Array<string>}    schema (Optional)     types of dataObjects schemas\r\n  * @param  {Array<string>}    resources (Optional)  types of dataObjects resources\r\n  * @param  {String}           domain       (Optional)\r\n  */\r\n  discoverDataObjectsPerReporter(reporter, schema, resources, domain) {\r\n    let _this = this;\r\n    let activeDomain;\r\n\r\n    activeDomain = (!domain) ? _this.domain : domain;\r\n\r\n\r\n    let msg = {\r\n      type: 'read',\r\n      from: _this.discoveryURL,\r\n      to: _this.runtimeURL + '/discovery/',\r\n      body: {\r\n        resource: '/dataObject/reporter/' + reporter\r\n      }\r\n    };\r\n\r\n    if(schema || resources) {\r\n      msg.body['criteria'] = {\r\n        resources: resources,\r\n        dataSchemes: schema,\r\n        domain: activeDomain\r\n      };\r\n    }else {\r\n      msg.body['criteria'] = {\r\n        domain: activeDomain\r\n      }\r\n    }\r\n\r\n    return new Promise(function(resolve, reject) {\r\n\r\n      _this.messageBus.postMessage(msg, (reply) => {\r\n\r\n        if(reply.body.code === 200){\r\n          Discovery_log.log(\"Reply Value Log: \",reply.body.value);\r\n          resolve(reply.body.value);\r\n        }\r\n        else {\r\n          Discovery_log.warn(\"[Discovery.discoverDataObjectsPerName] Error Reply for \" + reporter + \" Reason: \", reply.body.description);\r\n          resolve([]);\r\n        }\r\n      });\r\n    });\r\n  }\r\n\r\n  /**\r\n  * function to request about dataObject registered in domain registry, and\r\n  * returns discoveredObject.\r\n  * @param  {String}              name  dataObject URL\r\n  * @param  {Array<string>}    schema (Optional)     types of dataObjects schemas\r\n  * @param  {Array<string>}    resources (Optional)  types of dataObjects resources\r\n  * @param  {String}            domain (Optional)\r\n  */\r\n  discoverDataObjectsPerReporterDO(reporter, schema, resources, domain) {\r\n\r\n    return new Promise((resolve, reject) => {\r\n      this.discoverDataObjectsPerReporter(...arguments)\r\n        .then(registryObjects => resolve(this._convertToDiscoveredObject(registryObjects)))\r\n        .catch(error => reject(error));\r\n    });\r\n  }\r\n\r\n  _convertToDiscoveredObject(registryObjects) {\r\n    return registryObjects.map((registryObject) => {\r\n      return new discovery_DiscoveredObject(registryObject, this.runtimeURL, this.discoveryURL, this.messageBus, this);\r\n    });\r\n  }\r\n\r\n  /** Advanced Search for dataObjects registered in domain registry\r\n  * @deprecated Deprecated. Use discoverDataObjectsPerName instead\r\n  * @param  {String}           name                  name of the dataObject\r\n  * @param  {Array<string>}    schema (Optional)     types of dataObject schemas\r\n  * @param  {Array<string>}    resources (Optional)  types of dataObject resources\r\n  * @param  {String}           domain (Optional)     domain of the registry to search\r\n  */\r\n  discoverDataObject(name, schema, resources, domain) {\r\n    let _this = this;\r\n    let activeDomain;\r\n    //let userIdentifier = convertToUserURL(user);\r\n\r\n    activeDomain = (!domain) ? _this.domain : domain;\r\n\r\n    let msg = {\r\n      type: 'read', from: _this.discoveryURL, to: 'domain://registry.' + activeDomain, body: { resource: name,\r\n      criteria: {resources: resources, dataSchemes: schema}\r\n      }\r\n    };\r\n\r\n    return new Promise(function(resolve, reject) {\r\n\r\n      _this.messageBus.postMessage(msg, (reply) => {\r\n        Discovery_log.log('[Discovery]', reply)\r\n\r\n        if(reply.body.code>299) {\r\n          Discovery_log.warn(\"[Discovery.discoverDataObject] Error Reply for \" + name + \" Reason: \", reply.body.description);\r\n          return resolve([]);\r\n        }\r\n\r\n        let hyperties = reply.body.value;\r\n\r\n        if (hyperties) {\r\n          resolve(hyperties);\r\n        } else {\r\n          resolve([]);\r\n        }\r\n      });\r\n    });\r\n  }\r\n\r\n  /** Advanced Search for Hyperties registered in domain registry\r\n  * @deprecated Deprecated. Use discoverHyperties instead\r\n  * @param  {String}           user                  user identifier, either in url or email format\r\n  * @param  {Array<string>}    schema (Optional)     types of hyperties schemas\r\n  * @param  {Array<string>}    resources (Optional)  types of hyperties resources\r\n  * @param  {String}           domain (Optional)     domain of the registry to search\r\n  */\r\n  discoverHyperty(user, schema, resources, domain) {\r\n    let _this = this;\r\n    let activeDomain;\r\n    let userIdentifier = convertToUserURL(user);\r\n\r\n    if (!domain) {\r\n      activeDomain = _this.domain;\r\n    } else {\r\n      activeDomain = domain;\r\n    }\r\n\r\n    return new Promise(function(resolve, reject) {\r\n\r\n      Discovery_log.log('[Discovery.discoverHyperty] ACTIVE DOMAIN -> ', activeDomain, 'user->', user, 'schema->', schema, 'resources->', resources, 'domain->', domain);\r\n      if (user.includes(':') && !user.includes('user://')) {\r\n        Discovery_log.log('[Discovery.discoverHyperty] ' + user + ' is legacy domain');\r\n        let legacyUser = { userID: user, hypertyID: user, schema: schema, resources: resources };\r\n        return resolve(legacyUser);\r\n      }\r\n      let msg = {\r\n        type: 'read', from: _this.discoveryURL, to: 'domain://registry.' + activeDomain, body: { resource: userIdentifier,\r\n        criteria: {resources: resources, dataSchemes: schema}\r\n        }\r\n      };\r\n\r\n      Discovery_log.info('[Discovery] msg to send->', msg);\r\n\r\n      _this.messageBus.postMessage(msg, (reply) => {\r\n\r\n        Discovery_log.info('[Discovery] ON discoverHyperty->', reply);\r\n        let hyperties = reply.body.value;\r\n\r\n        if (hyperties) {\r\n          resolve(hyperties);\r\n        } else {\r\n          reject('No Hyperty was found');\r\n        }\r\n      });\r\n    });\r\n  }\r\n\r\n  /**\r\n  * function to request about users registered in domain registry, and\r\n  * return the last hyperty instance registered by the user.\r\n  * @deprecated Deprecated. Use discoverHyperty instead\r\n  * @param  {email}              email\r\n  * @param  {domain}            domain (Optional)\r\n  */\r\n  discoverHypertyPerUser(email, domain) {\r\n    let _this = this;\r\n    let activeDomain;\r\n\r\n    return new Promise(function(resolve, reject) {\r\n\r\n      // Hack for legacy users\r\n      if (email.includes(':') && !email.includes('user://')) {\r\n        Discovery_log.log('[Discovery.discoverHyperty] ' + email +'is legacy domain');\r\n        let legacyUser = { id: email, hypertyURL: email, descriptor: 'unknown' };\r\n        return resolve(legacyUser);\r\n      }\r\n\r\n      if (!domain) {\r\n        activeDomain = _this.domain;\r\n      } else {\r\n        activeDomain = domain;\r\n      }\r\n\r\n      let identityURL = 'user://' + email.substring(email.indexOf('@') + 1, email.length) + '/' + email.substring(0, email.indexOf('@'));\r\n\r\n\r\n      // message to query domain registry, asking for a user hyperty.\r\n      let message = {\r\n        type: 'read', from: _this.discoveryURL, to: 'domain://registry.' + activeDomain, body: { resource: identityURL}\r\n      };\r\n\r\n      Discovery_log.info('[Discovery] Message: ', message, activeDomain, identityURL);\r\n\r\n      //log.info('[Discovery] message READ', message);\r\n\r\n      _this.messageBus.postMessage(message, (reply) => {\r\n        Discovery_log.info('[Discovery] message reply', reply);\r\n\r\n        let hyperty;\r\n        let mostRecent;\r\n        let lastHyperty;\r\n        let value = reply.body.value;\r\n\r\n        for (hyperty in value) {\r\n          if (value[hyperty].lastModified !== undefined) {\r\n            if (mostRecent === undefined) {\r\n              mostRecent = new Date(value[hyperty].lastModified);\r\n              lastHyperty = hyperty;\r\n            } else {\r\n              let hypertyDate = new Date(value[hyperty].lastModified);\r\n              if (mostRecent.getTime() < hypertyDate.getTime()) {\r\n                mostRecent = hypertyDate;\r\n                lastHyperty = hyperty;\r\n              }\r\n            }\r\n          }\r\n        }\r\n\r\n        Discovery_log.info('[Discovery] Last Hyperty: ', lastHyperty, mostRecent);\r\n\r\n        let hypertyURL = lastHyperty;\r\n\r\n        if (hypertyURL === undefined) {\r\n          return reject('User Hyperty not found');\r\n        }\r\n\r\n        let idPackage = {\r\n          id: email,\r\n          descriptor: value[hypertyURL].descriptor,\r\n          hypertyURL: hypertyURL\r\n        };\r\n\r\n        Discovery_log.info('[Discovery] ===> hypertyDiscovery messageBundle: ', idPackage);\r\n        resolve(idPackage);\r\n      });\r\n    });\r\n  }\r\n\r\n  /**\r\n  * function to request about users registered in domain registry, and\r\n  * return the all the hyperties registered by the user\r\n  * @deprecated Deprecated. Use discoverHyperty instead\r\n  * @param  {email}              email\r\n  * @param  {domain}            domain (Optional)\r\n  */\r\n  discoverHypertiesPerUser(email, domain) {\r\n    let _this = this;\r\n    let activeDomain;\r\n    Discovery_log.log('on Function->', email);\r\n    return new Promise(function(resolve, reject) {\r\n\r\n      if (email.includes(':') && !email.includes('user://')) {\r\n        Discovery_log.log('[Discovery.discoverHyperty] is legacy domain');\r\n        let legacyUser = { userID: email, hypertyID: email, schema: schema, resources: resources };\r\n        return resolve(legacyUser);\r\n      }\r\n\r\n      if (!domain) {\r\n        activeDomain = _this.domain;\r\n      } else {\r\n        activeDomain = domain;\r\n      }\r\n\r\n      let identityURL = 'user://' + email.substring(email.indexOf('@') + 1, email.length) + '/' + email.substring(0, email.indexOf('@'));\r\n\r\n      // message to query domain registry, asking for a user hyperty.\r\n      let message = {\r\n        type: 'read', from: _this.discoveryURL, to: 'domain://registry.' + activeDomain, body: { resource: identityURL}\r\n      };\r\n\r\n      Discovery_log.log('[Discovery] Message discoverHypertiesPerUser: ', message, activeDomain, identityURL);\r\n\r\n      //log.info('[Discovery] message READ', message);\r\n\r\n      _this.messageBus.postMessage(message, (reply) => {\r\n        Discovery_log.info('[Discovery] discoverHypertiesPerUser reply', reply);\r\n\r\n        let value = reply.body.value;\r\n\r\n        if (!value) {\r\n          return reject('User Hyperty not found');\r\n        }\r\n\r\n        resolve(value);\r\n      });\r\n    });\r\n  }\r\n\r\n  /**\r\n  * function to request about users registered in domain registry, and\r\n  * return the all the hyperties registered by the user\r\n  * @deprecated Deprecated. Use discoverHyperty instead\r\n  * @param  {email}              email\r\n  * @param  {domain}            domain (Optional)\r\n  */\r\n  resumeDiscoveries() {\r\n\r\n    let _this = this;\r\n\r\n    Discovery_log.log('[Discovery] resumeDiscoveries');\r\n\r\n    return new Promise(function(resolve, reject) {\r\n\r\n      let msg = {\r\n        type: 'read', from: _this.discoveryURL, to: _this.runtimeURL + '/subscriptions', body: { resource: _this.discoveryURL}\r\n      };\r\n\r\n      _this.messageBus.postMessage(msg, (reply)=>{\r\n        Discovery_log.log('[Discovery.resumeDiscoveries] reply: ', reply);\r\n\r\n        let notifications = [];\r\n\r\n        if (reply.body.code === 200) {\r\n          let urls = reply.body.value;// URLs to add listeners to\r\n\r\n          //lets create one DiscoveryObject per notification\r\n          urls.forEach((url) => {\r\n            let objectUrl = url.split('/registration')[0];\r\n            let data = {};\r\n            data.url = objectUrl;\r\n            Discovery_log.log('[Discovery.resumeDiscoveries] adding listener to: ', objectUrl);\r\n\r\n            if (objectUrl.includes('hyperty://')) {\r\n              notifications.push(_this.discoverHypertyPerURLDO(objectUrl));\r\n            } else {\r\n              notifications.push(_this.discoverDataObjectPerURLDO(objectUrl));\r\n            }\r\n          });\r\n          Promise.all(notifications).then(values=>{ resolve(values); });\r\n        } else {\r\n          resolve([]);\r\n        }\r\n      });\r\n\r\n    });\r\n\r\n  }\r\n}\r\n\r\n/* harmony default export */ var discovery_Discovery = (Discovery_Discovery);\r\n\n// CONCATENATED MODULE: ./src/utils/Search.js\nclass Search {\r\n\r\n  constructor(discovery, identityManager) {\r\n\r\n    if (!discovery) throw new Error('The discovery component is a needed parameter');\r\n    if (!identityManager) throw new Error('The identityManager component is a needed parameter');\r\n\r\n    let _this = this;\r\n\r\n    _this.discovery = discovery;\r\n    _this.identityManager = identityManager;\r\n\r\n  }\r\n\r\n  myIdentity() {\r\n    let _this = this;\r\n\r\n    return new Promise(function(resolve, reject) {\r\n\r\n      _this.identityManager.discoverUserRegistered().then((result) => {\r\n        resolve(result);\r\n      }).catch((reason) => {\r\n        reject(reason);\r\n      });\r\n\r\n    });\r\n\r\n  }\r\n\r\n  hyperties(users, schemes, resources, globalFlag = false) {\r\n    //TODO: reuse users or the other way around\r\n\r\n  }\r\n\r\n  /**\r\n   * List of usersURL to search\r\n   * @param  {array<URL.userURL>}  users List of UserUR, like this format user://<ipddomain>/<user-identifier>\r\n   * @return {Promise}\r\n   */\r\n  users(usersURLs, providedDomains, schemes, resources, globalFlag = false) {\r\n\r\n    if (!usersURLs) throw new Error('You need to provide a list of users');\r\n    if (!providedDomains) throw new Error('You need to provide a list of domains');\r\n    if (!resources) throw new Error('You need to provide a list of resources');\r\n    if (!schemes) throw new Error('You need to provide a list of schemes');\r\n\r\n    let _this = this;\r\n\r\n    return new Promise(function(resolve, reject) {\r\n\r\n      console.info('[Search] Users: ', usersURLs, usersURLs.length);\r\n      console.info('[Search] Domains: ', providedDomains, providedDomains.length);\r\n      if (usersURLs.length === 0) {\r\n        console.info('Don\\'t have users to discovery');\r\n        resolve(usersURLs);\r\n      } else {\r\n        let getUsers = [];\r\n\r\n        usersURLs.forEach((userURL, index) => {\r\n          let currentDomain = providedDomains[index];\r\n          console.info('[Search] Search user ' + userURL + ' for provided domain:', currentDomain);\r\n          if (!globalFlag) {\r\n            getUsers.push(_this.discovery.discoverHyperties(userURL, schemes, resources, currentDomain));\r\n          } else {\r\n            getUsers.push(_this.discovery.discoverHypertiesPerUserProfileData(userURL, schemes, resources));\r\n          }\r\n\r\n        });\r\n\r\n        console.info('Requests promises: ', getUsers);\r\n\r\n        Promise.all(getUsers.map((promise) => {\r\n          return promise.then((hyperty) => { return hyperty; }, (error) => { return error; });\r\n        })).then((hyperties) => {\r\n\r\n          console.info('[Search] Hyperties from new Discovery', hyperties);\r\n          let result = hyperties.map(function(hyperty) {\r\n\r\n            if (hyperty.hasOwnProperty('hypertyID'))\r\n              return hyperty;\r\n            let recent = Object.keys(hyperty).reduceRight(function(a, b) {\r\n              let hypertyDate = new Date(hyperty[b].lastModified);\r\n              let hypertyDateP = new Date(hyperty[a].lastModified);\r\n              if (hypertyDateP.getTime() < hypertyDate.getTime()) {\r\n                return b;\r\n              }\r\n              return a;\r\n            });\r\n\r\n            return hyperty[recent];\r\n          });\r\n\r\n          let clean = result.filter((hyperty) => {\r\n            return hyperty.hasOwnProperty('hypertyID');\r\n          });\r\n\r\n          console.log('Requests result: ', clean);\r\n\r\n          hyperties.forEach(function(entry) {\r\n            if (entry !== 'No Hyperty was found') {\r\n              return resolve(clean);\r\n            }\r\n          });\r\n\r\n          reject('No Hyperty was found');\r\n\r\n        }).catch((reason) => {\r\n          console.error(reason);\r\n          resolve(usersURLs);\r\n        });\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\n/* harmony default export */ var utils_Search = (Search);\r\n\n// CONCATENATED MODULE: ./src/utils/EventEmitter.js\n/**\r\n* Copyright 2016 PT Inovação e Sistemas SA\r\n* Copyright 2016 INESC-ID\r\n* Copyright 2016 QUOBIS NETWORKS SL\r\n* Copyright 2016 FRAUNHOFER-GESELLSCHAFT ZUR FOERDERUNG DER ANGEWANDTEN FORSCHUNG E.V\r\n* Copyright 2016 ORANGE SA\r\n* Copyright 2016 Deutsche Telekom AG\r\n* Copyright 2016 Apizee\r\n* Copyright 2016 TECHNISCHE UNIVERSITAT BERLIN\r\n*\r\n* Licensed under the Apache License, Version 2.0 (the \"License\");\r\n* you may not use this file except in compliance with the License.\r\n* You may obtain a copy of the License at\r\n*\r\n*   http://www.apache.org/licenses/LICENSE-2.0\r\n*\r\n* Unless required by applicable law or agreed to in writing, software\r\n* distributed under the License is distributed on an \"AS IS\" BASIS,\r\n* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n* See the License for the specific language governing permissions and\r\n* limitations under the License.\r\n**/\r\n/**\r\n * EventEmitter\r\n * All classes which extends this, can have addEventListener and trigger events;\r\n */\r\nclass EventEmitter {\r\n\r\n  /**\r\n   * addEventListener listen for an eventType\r\n   * @param  {string}         eventType - listening for this type of event\r\n   * @param  {Function}       cb        - callback function will be executed when the event it is invoked\r\n   */\r\n  addEventListener(eventType, cb) {\r\n    let _this = this;\r\n    _this[eventType] = cb;\r\n  }\r\n\r\n  /**\r\n   * Invoke the eventType\r\n   * @param  {string} eventType - event will be invoked\r\n   * @param  {object} params - parameters will be passed to the addEventListener\r\n   */\r\n  trigger(eventType, params) {\r\n    let _this = this;\r\n\r\n    if (_this[eventType]) {\r\n      _this[eventType](params);\r\n    }\r\n  }\r\n\r\n}\r\n\r\n/* harmony default export */ var utils_EventEmitter = (EventEmitter);\r\n\n// CONCATENATED MODULE: ./src/contextManager/ContextObserver.js\n//import IdentityManager from '../identityManager/IdentityManager';\r\n//import Syncher from '../syncher/Syncher.js';\r\n//import Discovery from '../discovery/Discovery.js';\r\n//import {divideURL} from '../utils/utils';\r\n\r\n//import Search from '../utils/Search';\r\n\r\n\r\n/**\r\n* Context Observer;\r\n* @author Paulo Chainho [paulo-g-chainho@alticelabs.com]\r\n*/\r\n\r\nclass ContextObserver_ContextObserver extends utils_EventEmitter {\r\n\r\n  constructor(hypertyURL, bus, configuration, contextResourceTypes, factory, syncher) {\r\n    if (!hypertyURL) throw new Error('The hypertyURL is a needed parameter');\r\n    if (!bus) throw new Error('The MiniBus is a needed parameter');\r\n    if (!configuration) throw new Error('The configuration is a needed parameter ');\r\n    if (!factory) throw new Error('The factory is a needed parameter ');\r\n\r\n    super();\r\n\r\n    let _this = this;\r\n\r\n    _this._contextResourceTypes = contextResourceTypes;\r\n    _this._url = hypertyURL;\r\n    _this._discoverUsersPromises = {}; // object with promises executed at discoverUsers function\r\n    _this._observePromises = {}; // object with promises executed at observe function\r\n\r\n\r\n    //let identityManager = new IdentityManager(hypertyURL, configuration.runtimeURL, bus);\r\n    console.log('[ContextObserver] started with hypertyURL->', hypertyURL);\r\n    _this._domain = factory.divideURL(configuration.runtimeURL).domain;\r\n    _this._objectDescURL = 'hyperty-catalogue://catalogue.' + _this._domain + '/.well-known/dataschema/Context';\r\n\r\n    _this._users2observe = [];\r\n    _this._observers = {};\r\n\r\n    this._syncher = syncher ? syncher : factory.createSyncher(hypertyURL, bus, configuration);\r\n\r\n    let discovery = factory.createDiscovery(hypertyURL, configuration.runtimeURL, bus);\r\n    _this._discovery = discovery;\r\n\r\n    _this._discoveries = {}; //list of discovered objects\r\n    //_this.identityManager = identityManager;\r\n    //_this.search = new Search(discovery, identityManager);\r\n    window.discovery = _this._discovery;\r\n  }\r\n\r\n\r\n  start(resumedContext, disconnectedCallBack) {\r\n    let _this = this;\r\n    console.log('[ContextObserver.start] ');\r\n\r\n    return new Promise((resolve, reject) => {\r\n      _this._syncher.resumeObservers({store: true}).then((observers) => {\r\n\r\n        let observersList = Object.keys(observers);\r\n\r\n        if (observersList.length  > 0) {\r\n\r\n          console.log('[ContextObserver.start] resuming: ', observers);\r\n\r\n          /*observersList.forEach((i)=>{\r\n          _this._users2observe.push(new UserAvailabilityController(observers[i]));\r\n        });*/\r\n          _this._observers = observers;\r\n\r\n          resolve(observers);\r\n\r\n          observersList.forEach((observer) =>{\r\n            let Context = observers[observer];\r\n\r\n            // By default resumed context is set with resumedContext.\r\n            if (resumedContext) context.data.values = resumedContext;\r\n\r\n            // Context will will be updated with value synchronized with reporter if connected\r\n            Context.sync();\r\n\r\n            //Add listener to be notified when reporter is abruptly disconnected\r\n            if (disconnectedCallBack) Context.onDisconnected(disconnectedCallBack);\r\n          });\r\n\r\n\r\n        } else {\r\n          resolve(false);\r\n        }\r\n\r\n      }).catch((reason) => {\r\n        console.info('[ContextObserver] Resume Observer failed | ', reason);\r\n        resolve(false);\r\n      });\r\n    }).catch((reason) => {\r\n      reject('[ContextObserver] Start failed | ', reason);\r\n    });\r\n  }\r\n\r\n  resumeDiscoveries() {\r\n    let _this = this;\r\n\r\n    return new Promise((resolve, reject) => {\r\n      _this._discovery.resumeDiscoveries().then((discoveries) => {\r\n\r\n        console.log('[ContextObserver._resumeDiscoveries] found: ', discoveries);\r\n\r\n        discoveries.forEach((discovery) =>{\r\n\r\n          if (discovery.data.resources && discovery.data.resources[0] === _this._contextResourceTypes[0]) {\r\n            console.log('[ContextObserver._resumeDiscoveries] resuming: ', discovery);\r\n\r\n            if (discovery.data.status === 'live') { // previously discovered object is now live\r\n              resolve([discovery.data]);\r\n              discovery.unsubscribeLive(_this._url);\r\n            } else { // previously discovered object is still disconnected\r\n              discovery.onLive(_this._url, ()=>{\r\n                console.log('[ContextObserver._resumeDiscoveries] disconnected Hyperty is back to live', discovery);\r\n                resolve([discovery.data]);\r\n                discovery.unsubscribeLive(_this._url);\r\n              });\r\n            }\r\n          }\r\n        });\r\n      });\r\n    }).catch((reason) => {\r\n      reject('[ContextObserver] resumeDiscoveries failed | ', reason);\r\n    });\r\n  }\r\n\r\n  onResumeObserver(callback) {\r\n    let _this = this;\r\n    _this._onResumeObserver = callback;\r\n  }\r\n\r\n\r\n  discoverUsers(email, domain) {\r\n    let _this = this;\r\n\r\n\r\n    let user = email + '@' + domain;\r\n\r\n    if (!_this._discoverUsersPromises[user]) {\r\n      _this._discoverUsersPromises[user] = new Promise(function(resolve, reject) {\r\n\r\n        _this._discovery.discoverHypertiesDO(email, ['context'], _this._contextResourceTypes, domain).then(hyperties =>{\r\n          //_this.search.users([email], [domain], ['context'], ['Context_context']).then(function(a) {\r\n          console.log('[ContextObserver.discoverUsers] discovery result->', hyperties);\r\n          let discovered = [];\r\n          let disconnected = [];\r\n          hyperties.forEach(hyperty =>{\r\n            _this._discoveries[hyperty.data.hypertyID] = hyperty;\r\n            if (hyperty.data.status === 'live') {\r\n              discovered.push(hyperty.data);\r\n            } else {\r\n              disconnected.push(hyperty);\r\n            }\r\n          });\r\n\r\n\r\n          if (discovered.length > 0) {\r\n            console.log('[ContextObserver.discoverUsers] returning discovered hyperties data->', discovered);\r\n            resolve(discovered);\r\n          } else if (disconnected.length > 0) {\r\n            console.log('[ContextObserver.discoverUsers] disconnected Hyperties ', disconnected);\r\n\r\n            //resolve([]);\r\n\r\n            disconnected[0].onLive(_this._url, ()=>{\r\n              console.log('[ContextObserver.discoverUsers] disconnected Hyperty is back to live', disconnected[0]);\r\n\r\n              discovered.push(disconnected[0].data);\r\n              resolve(discovered);\r\n              disconnected[0].unsubscribeLive(_this._url);\r\n            });\r\n          }\r\n        });\r\n      });\r\n    }\r\n    return _this._discoverUsersPromises[user];\r\n  }\r\n\r\n  /**\r\n   * This function is used to start the user Context observation for a certain user Context reporter\r\n   * @param  {DiscoveredObject} hyperty       Hyperty to be observed.\r\n   * @return {<Promise> DataObjectObserver}      It returns as a Promise the UserAvailability Data Object Observer.\r\n   */\r\n\r\n  observe(hyperty, domainSubscription = true) {\r\n    let _this = this;\r\n    if (!_this._observePromises[hyperty.hypertyID]) {\r\n      _this._observePromises[hyperty.hypertyID] = new Promise(function(resolve, reject) {\r\n      //check if we are already observing it\r\n        _this._users2observe.forEach((Context) => {\r\n          if (Context._reporter === hyperty.hypertyID) return resolve(Context);\r\n        });\r\n\r\n        _this._discovery.discoverDataObjectsPerReporter(hyperty.hypertyID, ['context'], _this._contextResourceTypes,  _this._domain).then(function(dataObjects) {\r\n          console.log('[ContextObserver.discoverAvailability] discovered context objects ', dataObjects);\r\n          let last = 0;\r\n          let url;\r\n\r\n          dataObjects.forEach((dataObject) => {\r\n            if (dataObject.hasOwnProperty('lastModified') && dataObject.hasOwnProperty('url') && Date.parse(dataObject.lastModified) > last) {\r\n              last = dataObject.lastModified;\r\n              url = dataObject.url;\r\n\r\n            //console.log('URL DATA Object', url);\r\n            }\r\n          });\r\n          if (last != 0 && url) {\r\n            resolve(_this._subscribeContext(hyperty, url, domainSubscription));\r\n          } else {\r\n            reject('[ContextObserver.observe] discovered DataObjecs are invalid', dataObjects);\r\n          }\r\n        });\r\n      });\r\n    }\r\n    return _this._observePromises[hyperty.hypertyID];\r\n  }\r\n\r\n  _subscribeContext(hyperty, url, domainSubscription = true) {\r\n    let _this = this;\r\n\r\n    // avoid duplicated subscriptions\r\n\r\n    return new Promise(function(resolve, reject) {\r\n      _this._users2observe.forEach((Context) => {\r\n        if (Context.url === url) return resolve(Context);\r\n      });\r\n\r\n      let input = {\r\n        schema: _this._objectDescURL,\r\n        resource: url,\r\n        store: null,\r\n        p2p: null,\r\n        mutual: null,\r\n        domain_subscription: domainSubscription\r\n      };\r\n\r\n      _this._syncher.subscribe(input).then((Context) => {\r\n        console.log('[ContextObserver._subscribeContext] observer object', Context);\r\n\r\n        //let newUserAvailability = new UserAvailabilityController(Context, userID);\r\n\r\n        _this._users2observe.push(Context);\r\n\r\n        // When Object is disconnected set user Context status as unavailable\r\n        Context.onDisconnected(()=>{\r\n          console.log('[ContextObserver.onDisconnected]: ', Context);\r\n\r\n          Context.data.values[0].value = 'unavailable';\r\n          Context.sync();\r\n        });\r\n\r\n        resolve(Context);\r\n      });\r\n    });\r\n  }\r\n\r\n  _discoverAndSubscribeLegacyUsers(name) {\r\n    let _this = this;\r\n    return new Promise(function(resolve, reject) {\r\n      _this._discovery.discoverDataObjectsPerName(name).then(function(result) {\r\n        console.log('[ContextObserver._discoverAndSubscribeLegacyUsers] All DataObjects Result', result);\r\n        result.forEach(function(obj) {\r\n          if (obj.status === 'live') {\r\n            console.log('Live obj', obj);\r\n            if (!obj.hypertyID) {\r\n              obj.hypertyID = obj.reporter;\r\n            }\r\n            _this._subscribeContext(obj.schema, obj.url).then(function(resultSubscribe) {\r\n              console.log('[ContextObserver._discoverAndSubscribeLegacyUsers] _subscribeContext', resultSubscribe);\r\n              return resolve(resultSubscribe);\r\n            });\r\n          }\r\n        });\r\n      }).catch(function(err) {\r\n        console.log('error ', err);\r\n      });\r\n    });\r\n  }\r\n\r\n  /**\r\n * This function is used to stop the user Context observation for a certain user\r\n * @param  {string} Context       the UserAvailability Data Object Observer URL to be unobserved.\r\n */\r\n\r\n  unobserve(Context) {\r\n    let _this = this;\r\n\r\n    _this._users2observe.forEach((user, index) => {\r\n      if (user.url === Context) {\r\n        user.unsubscribe();\r\n        _this._users2observe.splice(index, 1);\r\n      }\r\n\r\n    });\r\n  }\r\n\r\n}\r\n\r\n/* harmony default export */ var contextManager_ContextObserver = (ContextObserver_ContextObserver);\r\n\n// CONCATENATED MODULE: ./src/contextManager/ContextReporter.js\n/**\r\n* Copyright 2016 PT Inovação e Sistemas SA\r\n* Copyright 2016 INESC-ID\r\n* Copyright 2016 QUOBIS NETWORKS SL\r\n* Copyright 2016 FRAUNHOFER-GESELLSCHAFT ZUR FOERDERUNG DER ANGEWANDTEN FORSCHUNG E.V\r\n* Copyright 2016 ORANGE SA\r\n* Copyright 2016 Deutsche Telekom AG\r\n* Copyright 2016 Apizee\r\n* Copyright 2016 TECHNISCHE UNIVERSITAT BERLIN\r\n*\r\n* Licensed under the Apache License, Version 2.0 (the \"License\");\r\n* you may not use this file except in compliance with the License.\r\n* You may obtain a copy of the License at\r\n*\r\n*   http://www.apache.org/licenses/LICENSE-2.0\r\n*\r\n* Unless required by applicable law or agreed to in writing, software\r\n* distributed under the License is distributed on an \"AS IS\" BASIS,\r\n* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n* See the License for the specific language governing permissions and\r\n* limitations under the License.\r\n**/\r\n\r\n// Service Framework\r\n//import Syncher from '../syncher/Syncher';\r\n\r\n// Utils\r\n\r\n//import {divideURL} from '../utils/utils.js';\r\n\r\n// import availability from './availability.js';\r\n\r\n/**\r\n* Context Reporter;\r\n* @author Paulo Chainho [paulo-g-chainho@alticelabs.com]\r\n*/\r\nclass ContextReporter_ContextReporter extends utils_EventEmitter {\r\n\r\n  constructor(hypertyURL, bus, configuration, factory, syncher) {\r\n    if (!hypertyURL) throw new Error('The hypertyURL is a needed parameter');\r\n    if (!bus) throw new Error('The MiniBus is a needed parameter');\r\n    if (!configuration) throw new Error('The configuration is a needed parameter');\r\n\r\n    super(hypertyURL, bus, configuration);\r\n\r\n    let _this = this;\r\n\r\n    console.info('[ContextReporter] started with url: ', hypertyURL);\r\n\r\n    this.syncher = syncher ? syncher : factory.createSyncher(hypertyURL, bus, configuration);\r\n\r\n\r\n    //    this.discovery = new Discovery(hypertyURL, bus);\r\n    this.domain = factory.divideURL(configuration.runtimeURL).domain;\r\n    this.contexts = {};\r\n\r\n    this.contextDescURL = 'hyperty-catalogue://catalogue.' + this.domain + '/.well-known/dataschema/Context';\r\n\r\n\r\n    //    this.heartbeat = [];\r\n\r\n    this.syncher.onNotification((event) => {\r\n      let _this = this;\r\n      _this.onNotification(event);\r\n    });\r\n\r\n    //TODO: uncomment when used with service framework develop branch\r\n\r\n    this.syncher.onClose((event) => {\r\n\r\n      console.log('[ContextReporter.onClose]');\r\n      let _this = this;\r\n      _this.setStatus(event.id, 'unavailable');\r\n      event.ack();\r\n    });\r\n\r\n  }\r\n\r\n  //TODO: move to User availability Reporter or to abstract HypertyContextReporter\r\n\r\n  start() {\r\n    let _this = this;\r\n\r\n    return new Promise((resolve, reject) => {\r\n\r\n      this.syncher.resumeReporters({store: true}).then((reporters) => {\r\n\r\n        let reportersList = Object.keys(reporters);\r\n\r\n        if (reportersList.length  > 0) {\r\n\r\n          console.log('[ContextReporter.start] resuming ', reporters[reportersList[0]]);\r\n\r\n          // set availability to available\r\n\r\n          _this.contexts = reporters;\r\n\r\n          //TODO:\r\n          reportersList.forEach((context) => {\r\n            _this._onSubscription(_this.contexts[context]);\r\n          });\r\n\r\n          resolve(_this.contexts);\r\n        } else {\r\n          console.log('[ContextReporter.start] nothing to resume ', reporters);\r\n          resolve(false);\r\n        }\r\n\r\n      }).catch((reason) => {\r\n        console.error('[ContextReporter] Resume failed | ', reason);\r\n      });\r\n    }).catch((reason) => {\r\n      reject('[ContextReporter] Start failed | ', reason);\r\n    });\r\n  }\r\n\r\n\r\n  processNotification(event) {\r\n    let _this = this;\r\n    console.log('[ContextReporter.processNotification: ', event);\r\n\r\n    event.ack();\r\n\r\n  }\r\n\r\n  /**\r\n   * This function is used to create a new status object syncher\r\n   * @param  {URL.UserURL} contacts List of Users\r\n   * @return {Promise}\r\n   */\r\n  create(id, init, resources, name = 'myContext', reporter = null, reuseURL = null) {\r\n    //debugger;\r\n    let _this = this;\r\n    let input;\r\n    return new Promise((resolve, reject) => {\r\n      if (!reporter && !reuseURL) {\r\n        input = {resources: resources, expires: 30};\r\n      } else if (reporter && !reuseURL) {\r\n        input = {resources: resources, expires: 30, reporter: reporter};\r\n      } else if (!reporter && reuseURL) {\r\n        input = {resources: resources, expires: 30, reuseURL: reuseURL};\r\n      } else {\r\n        input = {resources: resources, expires: 30, reuseURL: reuseURL, reporter: reporter};\r\n      }\r\n\r\n      console.info('[ContextReporter.create] lets create a new User availability Context Object ', input);\r\n      _this.syncher.create(_this.contextDescURL, [], init, true, false, name, null, input)\r\n        .then((context) => {\r\n          _this.contexts[id] = context;\r\n\r\n          _this._onSubscription(context);\r\n          resolve(context);\r\n\r\n        }).catch(function(reason) {\r\n          reject(reason);\r\n        });\r\n\r\n    });\r\n\r\n  }\r\n\r\n  _onSubscription(context) {\r\n    context.onSubscription((event) => {\r\n      console.info('[ContextReporter._onSubscription] accepting: ', event);\r\n      event.accept();\r\n    });\r\n  }\r\n\r\n  setContext(id, newContext) {\r\n    let _this = this;\r\n    console.log('THIS [ContextReporter.setContext] before change :', _this.contexts[id]);\r\n    console.log('[ContextReporter.setContext] before change :', _this.contexts[id].data);\r\n\r\n    //    _this.contexts[id].data.values[0].value = newContext;\r\n\r\n    _this.contexts[id].data.values = newContext;\r\n    console.debug('[ContextReporter.setContext] after change :', _this.contexts[id].data);\r\n    _this.trigger(id + '-context-update', newContext);\r\n\r\n  }\r\n\r\n\r\n}\r\n\r\n/* harmony default export */ var contextManager_ContextReporter = (ContextReporter_ContextReporter);\r\n\n// CONCATENATED MODULE: ./src/identity/UserProfile.js\n/**\r\n* The UserProfile according to User Identity Data Model\r\n*/\r\n\r\n\r\nclass UserProfile {\r\n\r\n  constructor(username, userURL, picture, name, locale, profile) {\r\n\r\n    if (username) { this.preferred_username = username; }\r\n    if (picture) { this.picture = picture; }\r\n    if (name) { this.name = name; }\r\n    if (locale) { this.locale = locale; }\r\n    if (userURL) { this.userURL = userURL; }\r\n    if (profile) Object.assign(this, profile);\r\n\r\n  }\r\n}\r\n\r\n/* harmony default export */ var identity_UserProfile = (UserProfile);\r\n\n// CONCATENATED MODULE: ./src/identity/MessageBodyIdentity.js\n/**\r\n* The Identity info to be added to Message.Body.Identity\r\n*/\r\n\r\n\r\n\r\nclass MessageBodyIdentity_MessageBodyIdentity {\r\n\r\n  constructor(username, userURL, picture, name, locale, idp, assertion, profile) {\r\n\r\n    if (!idp) throw new Error('IDP should be a parameter');\r\n    if (!username) throw new Error('username should be a parameter');\r\n\r\n    this.idp = idp;\r\n\r\n    if (assertion)      { this.assertion = assertion; }\r\n    this.userProfile = new identity_UserProfile(username, userURL, picture, name, locale, profile);\r\n\r\n  }\r\n\r\n}\r\n\r\n\r\n/* harmony default export */ var identity_MessageBodyIdentity = (MessageBodyIdentity_MessageBodyIdentity);\r\n\n// CONCATENATED MODULE: ./src/chatManager/communication.js\n/**\r\n* Copyright 2016 PT Inovação e Sistemas SA\r\n* Copyright 2016 INESC-ID\r\n* Copyright 2016 QUOBIS NETWORKS SL\r\n* Copyright 2016 FRAUNHOFER-GESELLSCHAFT ZUR FOERDERUNG DER ANGEWANDTEN FORSCHUNG E.V\r\n* Copyright 2016 ORANGE SA\r\n* Copyright 2016 Deutsche Telekom AG\r\n* Copyright 2016 Apizee\r\n* Copyright 2016 TECHNISCHE UNIVERSITAT BERLIN\r\n*\r\n* Licensed under the Apache License, Version 2.0 (the \"License\");\r\n* you may not use this file except in compliance with the License.\r\n* You may obtain a copy of the License at\r\n*\r\n*   http://www.apache.org/licenses/LICENSE-2.0\r\n*\r\n* Unless required by applicable law or agreed to in writing, software\r\n* distributed under the License is distributed on an \"AS IS\" BASIS,\r\n* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n* See the License for the specific language governing permissions and\r\n* limitations under the License.\r\n**/\r\n\r\nconst CommunicationStatus = {\r\n  OPEN: 'open',\r\n  PENDING: 'pending',\r\n  CLOSED: 'closed',\r\n  PAUSED: 'paused',\r\n  FAILED: 'failed'\r\n};\r\n\r\nlet communicationObject = {\r\n  startingTime: '',\r\n  status: '',\r\n  participants: {}\r\n};\r\n\r\nlet communicationChildren = {\r\n  \"parent\" : \"communication\",\r\n  \"listener\" : \"resources\",\r\n  \"type\" : \"HypertyResource\"\r\n};\r\n\r\n/*\r\nexport let communicationObject = {\r\n  id: '',\r\n  name: '',\r\n  owner: '',\r\n  scheme: 'comm',\r\n  startingTime: '',\r\n  lastModified: '',\r\n  duration: '',\r\n  status: '',\r\n  participants: []\r\n};\r\n*/\r\n\n// CONCATENATED MODULE: ./src/chatManager/InvitationsHandler.js\n/**\r\n* Copyright 2016 PT Inovação e Sistemas SA\r\n* Copyright 2016 INESC-ID\r\n* Copyright 2016 QUOBIS NETWORKS SL\r\n* Copyright 2016 FRAUNHOFER-GESELLSCHAFT ZUR FOERDERUNG DER ANGEWANDTEN FORSCHUNG E.V\r\n* Copyright 2016 ORANGE SA\r\n* Copyright 2016 Deutsche Telekom AG\r\n* Copyright 2016 Apizee\r\n* Copyright 2016 TECHNISCHE UNIVERSITAT BERLIN\r\n*\r\n* Licensed under the Apache License, Version 2.0 (the \"License\");\r\n* you may not use this file except in compliance with the License.\r\n* You may obtain a copy of the License at\r\n*\r\n*   http://www.apache.org/licenses/LICENSE-2.0\r\n*\r\n* Unless required by applicable law or agreed to in writing, software\r\n* distributed under the License is distributed on an \"AS IS\" BASIS,\r\n* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n* See the License for the specific language governing permissions and\r\n* limitations under the License.\r\n**/\r\n\r\n/**\r\n* To manage Group Chat Invitations\r\n* @author Paulo Chainho [paulo-g-chainho@alticelabs.com]\r\n* @version 0.1.0\r\n*/\r\n\r\n// TODO: have an instance per ChatController\r\n\r\nclass InvitationsHandler {\r\n\r\n  constructor(hypertyURL) {\r\n\r\n    if (!hypertyURL) throw Error('hypertyURL is a necessary dependecy');\r\n\r\n    let _this = this;\r\n    _this._hypertyURL = hypertyURL;\r\n\r\n    _this._pending = {}; // All pending invitations\r\n  }\r\n\r\n  set invitationResponse(callback) {\r\n    this._invitationsResponse = callback;\r\n  }\r\n\r\n  /**\r\n   * This function is used to handle notifications for disconnected Hy+erties.\r\n   * @param  {DiscoveredObject[]}    disconnected  array of discovered hyperties that are disconnected\r\n   * @param  {DataObjectReporter}    DataObjectReporter   Data Object Reporter addressed by invitations\r\n   */\r\n\r\n  inviteDisconnectedHyperties(disconnected, dataObjectReporter) {\r\n\r\n    let _this = this;\r\n    console.log('[GroupChatManager.InvitationsHandler.inviteDisconnectedHyperties] lets invite ', disconnected);\r\n\r\n    disconnected.forEach((disconnectedHyperty)=>{\r\n\r\n      if (!_this._pending[dataObjectReporter]) {\r\n        _this._pending[dataObjectReporter] = {};\r\n      }\r\n\r\n      _this._pending[dataObjectReporter][disconnectedHyperty.data.hypertyID] = disconnectedHyperty;\r\n\r\n      disconnectedHyperty.onLive(_this._hypertyURL,()=>{\r\n        console.log('[GroupChatManager.create] disconnected Hyperty is back to live', disconnectedHyperty);\r\n\r\n        dataObjectReporter.inviteObservers([disconnectedHyperty.data.hypertyID]);\r\n\r\n        disconnectedHyperty.unsubscribeLive(_this._hypertyURL);\r\n\r\n        delete _this._pending[dataObjectReporter][disconnectedHyperty.data.hypertyID];\r\n\r\n      });\r\n\r\n    });\r\n\r\n  }\r\n\r\n  /**\r\n   * This function is used to process sent invitations. In case invitations are not acknowledge by recipient it will be handled as a disconnected hyperty\r\n   * @param  {DiscoveredObject[]}    live  array of discovered hyperties that are or were live\r\n   * @param  {DataObjectReporter}    DataObjectReporter   Data Object Reporter addressed by invitations\r\n   */\r\n\r\n  processInvitations(live, dataObjectReporter) {\r\n    let _this = this;\r\n\r\n    let invitations = dataObjectReporter.invitations || [];\r\n\r\n    console.log('[GroupChatManager.InvitationsHandler.processInvitations] waiting for replies ', invitations, this._invitationsResponse);\r\n\r\n    invitations.forEach((invitation) => {\r\n      invitation.then((result) => {\r\n        console.log('[GroupChatManager.InvitationsHandler.processInvitations] - OK: ', result, this._invitationsResponse);\r\n        if (this._invitationsResponse) { this._invitationsResponse(result); }\r\n      }).catch((result) => {\r\n        console.log('[GroupChatManager.InvitationsHandler.processInvitations] - NOT OK: ', result, this._invitationsResponse);\r\n        if (this._invitationsResponse) { this._invitationsResponse(result); }\r\n        _this.inviteDisconnectedHyperties([live[result.invited]], dataObjectReporter);\r\n      });\r\n    });\r\n\r\n  }\r\n\r\n  resumeDiscoveries(discoveryEngine, groupChat) {\r\n    let _this = this;\r\n\r\n    return new Promise((resolve, reject) => {\r\n\r\n      let live = {};\r\n      let liveHyperties = [];\r\n      let disconnected = [];\r\n      let unsubscriptonPromises = [];\r\n\r\n      discoveryEngine.resumeDiscoveries().then((discoveries) => {\r\n\r\n        console.log('[GroupChatManager.InvitationsHandler.resumeDiscoveries] found: ', discoveries);\r\n\r\n        discoveries.forEach((discovery) =>{\r\n\r\n          if (discovery.data.resources && discovery.data.resources[0] === 'chat') {\r\n            console.log('[GroupChatManager.InvitationsHandler.resumeDiscoveries] resuming: ', discovery);\r\n\r\n            if (discovery.data.status === 'live' ) {// previously discovered object is now live\r\n              live[discovery.data.hypertyID] = discovery;\r\n              liveHyperties.push(discovery.data.hypertyID);\r\n              unsubscriptonPromises.push( discovery.unsubscribeLive(_this._hypertyURL) );\r\n            } else {// previously discovered object is still disconnected\r\n              disconnected.push(discovery);\r\n            }\r\n          }\r\n        });\r\n        if (disconnected.length > 0) _this.inviteDisconnectedHyperties(disconnected, groupChat);\r\n\r\n        if ( Object.keys(live).length > 0) {\r\n          groupChat.inviteObservers(liveHyperties);\r\n\r\n          if (groupChat.invitations.length > 0) _this.processInvitations(live, groupChat);\r\n\r\n          Promise.all(unsubscriptonPromises).then(()=>{ resolve()});\r\n\r\n        } else resolve();\r\n\r\n      });\r\n    }).catch((reason) => {\r\n    reject('[GroupChatManager.InvitationsHandler.resumeDiscoveries] failed | ', reason);\r\n  });\r\n  }\r\n\r\n  /**\r\n   * This function is used to remove and clean all pending invitations.\r\n   * @param  {DataObjectReporter}    DataObjectReporter   Data Object Reporter addressed by invitations\r\n   * @return {Promise} return a promise when all unsubscriptons for pending invitations are finished\r\n   */\r\n\r\n  cleanInvitations(dataObjectReporter) {\r\n    let _this = this;\r\n\r\n    let chatInvitations = _this._pending[dataObjectReporter];\r\n\r\n    console.log('[GroupChatManager.InvitationsHandler.cleanInvitations] ', chatInvitations);\r\n\r\n    if (chatInvitations) {\r\n\r\n      return new Promise((resolve, reject) => {\r\n        let pendingInvitations = Object.keys(chatInvitations);\r\n\r\n        let unsubscriptonPromises = [];\r\n\r\n        pendingInvitations.forEach((invitation)=>{\r\n          unsubscriptonPromises.push( chatInvitations[invitation].unsubscribeLive(_this._hypertyURL) );\r\n        });\r\n\r\n        Promise.all(pendingInvitations).then(()=>{ resolve(); });\r\n\r\n      });\r\n\r\n    } else return Promise.resolve();\r\n\r\n\r\n  }\r\n\r\n}\r\n\r\n/* harmony default export */ var chatManager_InvitationsHandler = (InvitationsHandler);\r\n\n// CONCATENATED MODULE: ./src/chatManager/ChatController.js\n/**\r\n* Copyright 2016 PT Inovação e Sistemas SA\r\n* Copyright 2016 INESC-ID\r\n* Copyright 2016 QUOBIS NETWORKS SL\r\n* Copyright 2016 FRAUNHOFER-GESELLSCHAFT ZUR FOERDERUNG DER ANGEWANDTEN FORSCHUNG E.V\r\n* Copyright 2016 ORANGE SA\r\n* Copyright 2016 Deutsche Telekom AG\r\n* Copyright 2016 Apizee\r\n* Copyright 2016 TECHNISCHE UNIVERSITAT BERLIN\r\n*\r\n* Licensed under the Apache License, Version 2.0 (the \"License\");\r\n* you may not use this file except in compliance with the License.\r\n* You may obtain a copy of the License at\r\n*\r\n*   http://www.apache.org/licenses/LICENSE-2.0\r\n*\r\n* Unless required by applicable law or agreed to in writing, software\r\n* distributed under the License is distributed on an \"AS IS\" BASIS,\r\n* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n* See the License for the specific language governing permissions and\r\n* limitations under the License.\r\n**/\r\n\r\n/**\r\n* The Group Chat API is used to control a Group Chat instance.\r\n* @author Vitor Silva [vitor-t-silva@telecom.pt]\r\n* @version 0.1.0\r\n*/\r\n\r\n//import { UserInfo } from './UserInfo';\r\n\r\n\r\n\r\nclass ChatController_ChatController {\r\n\r\n  constructor(syncher, discovery, domain, search, identity, manager) {\r\n\r\n    if (!syncher) throw Error('Syncher is a necessary dependecy');\r\n    if (!discovery) throw Error('Discover is a necessary dependecy');\r\n    if (!domain) throw Error('Domain is a necessary dependecy');\r\n    if (!search) throw Error('Search is a necessary dependecy');\r\n\r\n    let _this = this;\r\n    _this._syncher = syncher;\r\n    _this.discovery = discovery;\r\n    _this.search = search;\r\n    _this.myIdentity = identity;\r\n    _this.controllerMode = 'reporter';\r\n    _this.child_cseq = 0;\r\n    _this.domain = domain;\r\n\r\n    _this._manager = manager;\r\n\r\n    const hypertyURL = syncher.owner;\r\n\r\n    _this._objectDescURL = 'hyperty-catalogue://catalogue.' + domain + '/.well-known/dataschema/Communication';\r\n\r\n    _this._invitationsHandler = new chatManager_InvitationsHandler(hypertyURL);\r\n\r\n  }\r\n\r\n  get invitationsHandler() {\r\n    return this._invitationsHandler;\r\n  }\r\n\r\n  get url() {\r\n    return this.controllerMode === 'reporter' ? this.dataObjectReporter.url : this.dataObjectObserver.url;\r\n  }\r\n\r\n  set dataObjectReporter(dataObjectReporter) {\r\n\r\n    if (!dataObjectReporter) throw new Error('[ChatController] The data object reporter is necessary parameter ');\r\n    let _this = this;\r\n\r\n    _this.controllerMode = 'reporter';\r\n\r\n    // Handler to process received files\r\n\r\n    // dataObjectReporter.onResponse(function(event) {\r\n    //   console.log('[DataObjectReporter - onResponse]', event);\r\n    //   if (_this._onInvitationResponse) {\r\n    //     _this._onInvitationResponse(event);\r\n    //   }\r\n    //\r\n    // });\r\n\r\n    dataObjectReporter.onSubscription(function(event) {\r\n\r\n      switch (event.type) {\r\n        case 'subscribe': _this._onSubscribe(event); break;\r\n        case 'unsubscribe': _this._onUnsubscribe(event); break;\r\n      }\r\n    });\r\n\r\n    _this._setOnAddChildListener(dataObjectReporter);\r\n\r\n    dataObjectReporter.onRead((event) => {\r\n      event.accept();\r\n    });\r\n\r\n    dataObjectReporter.onExecute((event) => {\r\n      switch (event.method) {\r\n        case 'addUser':\r\n          _this.addUser(event.params[0]).then(() => {\r\n            event.accept();\r\n          }).catch(function(reason) {\r\n            console.error('Reason:', reason);\r\n            event.reject(reason);\r\n          });\r\n          break;\r\n          case 'removeUser':\r\n            _this.removeUser(event.params).then(() => {\r\n              event.accept();\r\n            }).catch(function(reason) {\r\n              console.error('Reason:', reason);\r\n              event.reject(reason);\r\n            });\r\n            break;\r\n        default: event.reject('[ChatController.onExecute] Chat method execution not accepted by Reporter');\r\n          break;\r\n      }\r\n    });\r\n\r\n    _this._dataObjectReporter = dataObjectReporter;\r\n\r\n  }\r\n\r\n  get dataObjectReporter() {\r\n    let _this = this;\r\n    return _this._dataObjectReporter;\r\n  }\r\n\r\n  get messages() {\r\n\r\n    return this.controllerMode === 'reporter' ? this._dataObjectReporter._childrenObjects : this._dataObjectObserver._childrenObjects;\r\n  }\r\n\r\n  set dataObjectObserver(dataObjectObserver) {\r\n    let _this = this;\r\n\r\n    _this.controllerMode = 'observer';\r\n\r\n    _this._dataObjectObserver = dataObjectObserver;\r\n\r\n    dataObjectObserver.onChange('*', function(event) {\r\n      console.info('[ChatManager.ChatController]Observer - onChange', event);\r\n\r\n      if (event.field.includes('participants')) {\r\n        switch (event.cType) {\r\n          case 'add':\r\n            if (_this._onUserAdded) _this._onUserAdded(event);\r\n            break;\r\n\r\n          case 'remove':\r\n            if (_this._onUserRemoved) _this._onUserRemoved(event);\r\n            break;\r\n        }\r\n      }\r\n\r\n      if (_this._onChange) _this._onChange(event);\r\n\r\n    });\r\n\r\n    _this._setOnAddChildListener(dataObjectObserver);\r\n\r\n    // let childrens = dataObjectObserver.childrens;\r\n    // Object.keys(childrens).forEach((child) => {\r\n    //   if (_this._onMessage) _this._onMessage({\r\n    //     childId: child,\r\n    //     identity: childrens[child].identity,\r\n    //     value: childrens[child].data\r\n    //   });\r\n    // })\r\n\r\n  }\r\n\r\n  get dataObjectObserver() {\r\n    let _this = this;\r\n    return _this._dataObjectObserver;\r\n  }\r\n\r\n  _setOnAddChildListener(dataObject) {\r\n\r\n    let _this = this;\r\n\r\n    dataObject.onAddChild(function(child) {\r\n      _this.child_cseq +=1;\r\n      console.info('[ChatManager.ChatController._setOnAddChildListener] new Child received: ', child);\r\n\r\n      if (_this._onMessage) _this._onMessage(child);\r\n    });\r\n\r\n  }\r\n\r\n\r\n  get dataObject() {\r\n    return this.controllerMode === 'reporter' ? this.dataObjectReporter : this.dataObjectObserver;\r\n  }\r\n\r\n  set closeEvent(event) {\r\n    let _this = this;\r\n    _this._closeEvent = event;\r\n\r\n    if (_this._onClose) _this._onClose(event);\r\n  }\r\n\r\n  get closeEvent() {\r\n    let _this = this;\r\n    return _this._closeEvent;\r\n  }\r\n\r\n\r\n\r\n  _onSubscribe(event) {\r\n\r\n    let dataObjectReporter = this._dataObjectReporter;\r\n\r\n    event.accept();\r\n\r\n\r\n    console.log('[ChatManager.ChatController.onSubscribe] event', event, dataObjectReporter.url);\r\n    console.log('[ChatManager.ChatController.onSubscribe] New user has subscribe this object: ', dataObjectReporter.data, event.identity);\r\n\r\n    let identity = JSON.parse(JSON.stringify(event.identity));\r\n\r\n    if (identity.hasOwnProperty('assertion')) {\r\n      delete identity.assertion\r\n    }\r\n\r\n    let userInfo = {\r\n      hypertyURL: event.url,\r\n      domain: event.domain,\r\n      identity: identity\r\n    }\r\n    let userURL = event.identity.userProfile.guid;\r\n\r\n    console.log('[ChatManager.ChatController.onSubscribe]  new participant', userInfo);\r\n    if (event.identity.legacy) {\r\n     userInfo.legacy = event.identity.legacy;\r\n    }\r\n\r\n    dataObjectReporter.data.participants[userURL] = userInfo;\r\n\r\n    console.log('[ChatManager.ChatController.onSubscribe] communicationObject OBJ chatcontroller', dataObjectReporter.data.participants);\r\n    console.log('[ChatManager.ChatController.onSubscribe - onSubscription] ', userInfo);\r\n    // console.log('[ChatManager.ChatController.onSubscribe - this._onUserAdded] ', this._onUserAdded);\r\n\r\n    if (this._onUserAdded) this._onUserAdded(userInfo);\r\n  }\r\n\r\n  _onUnsubscribe(event) {\r\n    let dataObjectReporter = this._dataObjectReporter;\r\n\r\n    console.log('[ChatManager.ChatController.onUnsubscribe] event', event, dataObjectReporter.url);\r\n\r\n    let participant = event.identity.userProfile;\r\n\r\n    console.log('[ChatManager.ChatController.onUnsubscribe]  participant left', participant);\r\n    if (event.identity.legacy) {\r\n      participant.legacy = event.identity.legacy;\r\n    }\r\n\r\n    delete dataObjectReporter.data.participants[participant.userURL];\r\n\r\n    console.log('[ChatManager.ChatController.onUnsubscribe - this._onUserRemoved] ', this.onUserRemoved);\r\n    if (this._onUserRemoved) this._onUserRemoved(participant);\r\n  }\r\n\r\n  /**\r\n   * This function is used to send a file.\r\n   * @param  {string}     file                        Is the file to be sent.\r\n   * @return {Promise<Communication.ChatMessage>}        It returns the ChatMessage child object created by the Syncher as a Promise.\r\n   */\r\n  sendFile(file) {\r\n\r\n    let _this = this;\r\n    let mode = _this.controllerMode;\r\n    let dataObject = mode === 'reporter' ? _this.dataObjectReporter : _this.dataObjectObserver;\r\n\r\n    return new Promise(function(resolve, reject) {\r\n\r\n      let identity = {\r\n        userProfile: _this.myIdentity\r\n      };\r\n\r\n      dataObject.addHypertyResource('resources', 'file',  file, identity).then(function(resourceFile) {\r\n\r\n          let identity = {\r\n              userProfile: _this.myIdentity\r\n          };\r\n          let fileSentEvt = { value : resourceFile, identity: identity, resource: resourceFile};\r\n\r\n          let reporterStatus = new discovery_RegistrationStatus(dataObject.url, _this._manager._runtimeURL, _this._manager._hypertyURL, _this._manager._bus );\r\n\r\n          // recursive function to sync with chat reporter\r\n\r\n            let share2Reporter = function(file, subscriber, evt, status) {\r\n              let statusOfReporter = status;\r\n              file.sharingStatus.then(resolve(evt)).catch((result)=>{\r\n                console.log('[ChatManager.ChatController.sendFile] share failed: ', result);\r\n\r\n                statusOfReporter.onLive( subscriber, () => {\r\n                statusOfReporter.unsubscribeLive(subscriber);\r\n                file.share(true);\r\n                share2Reporter(file, subscriber, evt, statusOfReporter);\r\n                });\r\n                  //TODO: subscribe to sync when reporter is live. New synched messages should trigger onMessage ie onChild\r\n              });\r\n            }\r\n\r\n            share2Reporter(resourceFile, _this._manager._hypertyURL, fileSentEvt, reporterStatus);\r\n        });\r\n    }).catch(function(reason) {\r\n      console.error('Reason:', reason);\r\n      reject(reason);\r\n    });\r\n\r\n  }\r\n\r\n  /**\r\n   * This function is used to send a chat message.\r\n   * @param  {string}     message                        Is the ChatMessage to be sent.\r\n   * @return {Promise<Communication.ChatMessage>}        It returns the ChatMessage child object created by the Syncher as a Promise.\r\n   */\r\n  send(message, identity) {\r\n\r\n    let _this = this;\r\n    let mode = _this.controllerMode;\r\n    let dataObject = mode === 'reporter' ? _this.dataObjectReporter : _this.dataObjectObserver;\r\n\r\n    return new Promise(function(resolve, reject) {\r\n\r\n//      let _dataObjectChild;\r\n      _this.child_cseq += 1;\r\n      let msg = {\r\n\r\n/*        url: dataObject.data.url,\r\n        cseq: _this.child_cseq,\r\n        reporter: dataObject.data.reporter,\r\n        schema: dataObject.data.schema,\r\n        name: dataObject.data.name,\r\n        created : new Date().toJSON(),*/\r\n\r\n        type: 'chat',\r\n        content: message\r\n      }\r\n\r\n      let sender = identity ? identity : {\r\n        userProfile: _this.myIdentity\r\n      };\r\n\r\n\r\n      // TODO: change chatmessages to resource - chat, file\r\n      // TODO: change message to hypertyResource - https://github.com/reTHINK-project/dev-service-framework/tree/develop/docs/datamodel/data-objects/hyperty-resource\r\n      // TODO: handle with multiple resources - if the \"message\" will be different for each type of resources\r\n      dataObject.addChild(msg, sender).then(function(dataObjectChild) {\r\n        console.log('[ChatManager.ChatController][addChild - Chat Message]: ', dataObjectChild);\r\n        //resolve(dataObjectChild);\r\n\r\n        //TODO: move to separate function\r\n\r\n\r\n        let msg = {\r\n          childId: dataObjectChild._childId,\r\n          from: dataObjectChild._owner,\r\n          value: dataObjectChild.data,\r\n          type: 'create',\r\n          identity: sender\r\n        };\r\n\r\n        let reporterStatus = new discovery_RegistrationStatus(dataObject.url, _this._manager._runtimeURL, _this._manager._hypertyURL, _this._manager._bus );\r\n\r\n        // recursive function to sync with chat reporter\r\n\r\n          let share2Reporter = function(child, subscriber, msg, status) {\r\n            let statusOfReporter = status;\r\n            child.sharingStatus.then(resolve(msg)).catch((result)=>{\r\n\r\n                statusOfReporter.onLive( subscriber, () => {\r\n                  statusOfReporter.unsubscribeLive(subscriber);\r\n                  child.share(true);\r\n                  share2Reporter(child, subscriber, msg, statusOfReporter);\r\n                });\r\n                //TODO: subscribe to sync when reporter is live. New synched messages should trigger onMessage ie onChild\r\n            });\r\n          }\r\n\r\n          share2Reporter(dataObjectChild, _this._manager._hypertyURL, msg, reporterStatus);\r\n\r\n        }).catch(function(reason) {\r\n        console.error('Reason:', reason);\r\n        reject(reason);\r\n      });\r\n\r\n    });\r\n\r\n  }\r\n\r\n  /**\r\n   * [onChange description]\r\n   * @param  {Function} callback [description]\r\n   * @return {[type]}            [description]\r\n   */\r\n  onChange(callback) {\r\n    let _this = this;\r\n    _this._onChange = callback;\r\n  }\r\n\r\n  /**\r\n   * This function is used to receive new messages.\r\n   * @param  {Function} callback Function to handle with new messages\r\n   * @return {Communication.ChatMessage} m\r\n   */\r\n  onMessage(callback) {\r\n    let _this = this;\r\n    _this._onMessage = callback;\r\n  }\r\n\r\n  /**\r\n   * [onUserAdded description]\r\n   * @param  {Function} callback [description]\r\n   * @return {[type]}            [description]\r\n   */\r\n  onUserAdded(callback) {\r\n    let _this = this;\r\n    _this._onUserAdded = callback;\r\n  }\r\n\r\n  /**\r\n   * When the an user was removed\r\n   * @param  {Function} callback Function handle with the removed user\r\n   * @return {[type]}            [description]\r\n   */\r\n  onUserRemoved(callback) {\r\n    let _this = this;\r\n    _this._onUserRemoved = callback;\r\n  }\r\n\r\n  /**\r\n   * This function is used to receive requests to close the Group Chat instance.\r\n   * @return {DeleteEvent} The DeleteEvent fired by the Syncher when the Chat is closed.\r\n   */\r\n  onClose(callback) {\r\n    let _this = this;\r\n    _this._onClose = callback;\r\n  }\r\n\r\n  onResponse(callback) {\r\n    let _this = this;\r\n    _this._onResponse = callback;\r\n  }\r\n\r\n  /**\r\n   * This function is used to add / invite new user on an existing Group Chat instance.\r\n   * Only the Reporter, i.e. the Hyperty that has created the Group Chat, is allowed to use this function.\r\n   * @param {URL.UserURL}  users  User to be invited to join the Group Chat that is identified with reTHINK User URL.\r\n   * @return {Promise<boolean>}   It returns as a Promise true if successfully invited or false otherwise.\r\n   */\r\n  addUser(users) {\r\n\r\n    let _this = this;\r\n\r\n    let haveEmptyElements = (element) => {\r\n      console.log('Element:', element.length);\r\n      return element.length !== 0;\r\n    };\r\n\r\n    let notFoundElements = (element) => {\r\n      console.log('user not found: ', element);\r\n      return !(element instanceof String);\r\n    };\r\n\r\n    return new Promise(function(resolve, reject) {\r\n\r\n      if (users.filter(haveEmptyElements).length === 0) {\r\n        return reject('Don\\'t have users to invite');\r\n      }\r\n\r\n      console.info('[ChatManager.ChatController.addUsers ]: ', users);\r\n\r\n      /*_this.search.users(users, domains, ['comm'], ['chat'])\r\n\r\n    .then((hypertiesIDs) => {\r\n\r\n      if (hypertiesIDs.filter(notFoundElements).length === 0) {\r\n        throw 'User(s) not found';\r\n      }\r\n\r\n      let selectedHyperties = hypertiesIDs.map((hyperty) => {\r\n        return hyperty.hypertyID;\r\n      });*/\r\n\r\n      let usersDiscovery = [];\r\n      let disconnected = [];\r\n      let live = {};\r\n\r\n      users.forEach((user) => {\r\n        let userDiscoveryPromise = _this.discovery.discoverHypertiesDO(user.user, ['comm'], ['chat'], user.domain);\r\n          usersDiscovery.push(userDiscoveryPromise);\r\n        });\r\n\r\n      Promise.all(usersDiscovery).then((userDiscoveryResults) => {\r\n        console.log('[ChatManager.ChatController.addUsers] Users Discovery Results->', userDiscoveryResults);\r\n\r\n        let selectedHyperties = [];\r\n\r\n         userDiscoveryResults.forEach((userDiscoveryResult) => {\r\n\r\n           userDiscoveryResult.forEach((discovered)=>{\r\n             if (discovered.data.status === 'live'){\r\n               selectedHyperties.push(discovered.data.hypertyID);\r\n               live[discovered.data.hypertyID] = discovered;\r\n             }\r\n             else if (disconnected.length < 5) disconnected.push(discovered);\r\n           });\r\n\r\n        });\r\n\r\n        console.info('[ChatManager.ChatController]------------------------ Syncher Create ---------------------- \\n');\r\n        console.info('[ChatManager.ChatController]Selected Hyperties: !!! ', selectedHyperties);\r\n        console.info(`Have ${selectedHyperties.length} users;`);\r\n//        console.info('[ChatManager] HypertiesIDs ', hypertiesIDs);\r\n\r\n        let dataObject = _this.controllerMode === 'reporter' ? _this.dataObjectReporter : _this.dataObjectObserver;\r\n\r\n        if (disconnected.length > 0) _this._invitationsHandler.inviteDisconnectedHyperties(disconnected, dataObject);\r\n\r\n        dataObject.inviteObservers(selectedHyperties);\r\n\r\n        if (dataObject.invitations.length > 0) _this._invitationsHandler.processInvitations(live, dataObject);\r\n\r\n        return;\r\n\r\n        })\r\n        .then(() => {\r\n          console.info('[ChatManager.ChatController]Are invited with success ' + users.length + ' users;');\r\n          resolve(true);\r\n\r\n\r\n\r\n        }).catch((reason) => {\r\n          console.error('An error occurred when trying to invite users;\\n', reason);\r\n          reject(reason);\r\n        });\r\n\r\n    });\r\n\r\n  }\r\n\r\n  /**\r\n   * This function is used to request the Reporter to add / invite new user on an existing Group Chat instance.\r\n   * Only Observers are allowed to use this function.\r\n   * @param {URL.UserURL}  users  User to be invited to join the Group Chat that is identified with reTHINK User URL.\r\n   * @return {Promise<boolean>}   It returns as a Promise true if successfully invited or false otherwise.\r\n   */\r\n  addUserReq(users) {\r\n\r\n    let _this = this;\r\n\r\n    //check is Observer and invoke observer.execute() with new promise\r\n    let haveEmptyElements = (element) => {\r\n      console.log('Element:', element.length);\r\n      return element.length !== 0;\r\n    };\r\n\r\n    return new Promise(function(resolve, reject) {\r\n\r\n      if (users.filter(haveEmptyElements).length === 0) {\r\n        return reject('[ChatManager.ChatController.addUserReq] Don\\'t have users to add');\r\n      }\r\n      if (!_this.controllerMode === 'observer') {\r\n        return reject('[ChatManager.ChatController.addUserReq] only allowed to Chat Observer');\r\n\r\n      let addUser = _this.addUser(users);\r\n\r\n      if (_this._dataObjectObserver) {\r\n        addUser = _this._dataObjectObserver.execute('addUser', users);\r\n      }\r\n\r\n      addUser.then(() => {\r\n        console.info('[ChatManager.ChatController.addUserReq] Request accepted by Reporter ');\r\n        resolve(true);\r\n      }).catch((reason) => {\r\n        console.error('[ChatManager.ChatController.addUserReq] Request rejected by Reporter;\\n', reason);\r\n        reject(reason);\r\n      });\r\n    }\r\n\r\n  });\r\n\r\n}\r\n\r\n  onInvitationResponse(callback) {\r\n    let _this = this;\r\n    _this._onInvitationResponse = callback;\r\n    _this._invitationsHandler.invitationResponse = callback;\r\n  }\r\n\r\n\r\n  /**\r\n   * This function is used to remove a user from an existing Group Chat instance.\r\n   * Only the Reporter, i.e. the Hyperty that has created the Group Chat, is allowed to use this function.\r\n   * @return {<Promise> boolean} Promise with the status\r\n   */\r\n\r\n  /**\r\n   * This function is used to remove a user from an existing Group Chat instance.\r\n   * Only the Reporter, i.e. the Hyperty that has created the Group Chat, is allowed to use this function.\r\n   * @param  {URL.UserURL} user       User to be removed from the Group Chat that is identified with reTHINK User URL.\r\n   * @return {<Promise> boolean}      It returns as a Promise true if successfully removed or false otherwise.\r\n   */\r\n  removeUser(user) {\r\n\r\n    // TODO: implement the removeUser;\r\n    console.log('[ChatManager.ChatController]Not yet implemented: ', user);\r\n\r\n  }\r\n\r\n  /**\r\n   * This function is used to close an existing Group Chat instance.\r\n   * Only available to Chat Group Reporters i.e. the Hyperty instance that created the Group Chat.\r\n   * @return {<Promise>Boolean} It returns as a Promise true if successfully closed or false otherwise.\r\n   */\r\n  close(del = true) {\r\n    // TODO: the dataObjectReporter.delete should be a Promise;\r\n\r\n    let _this = this;\r\n    \r\n    return new Promise(function(resolve, reject) {\r\n      \r\n      if (_this.controllerMode === 'reporter') {\r\n        // reporter\r\n        _this._invitationsHandler.cleanInvitations(_this.dataObjectReporter).then(() => {\r\n          if (!del) {\r\n            _this._manager.communicationObject.status = 'closed';\r\n              resolve(true);\r\n            }\r\n            else{\r\n\r\n              try {\r\n              \r\n                  delete _this._manager._reportersControllers[_this.dataObjectReporter.url];\r\n                _this.dataObjectReporter.delete();\r\n                resolve(true);\r\n                if (_this._onClose) _this._onClose({\r\n                  code: 200,\r\n                  desc: 'deleted',\r\n                  url: _this.dataObjectReporter.url\r\n                })\r\n              } catch (e) {\r\n                console.error(e);\r\n                reject(false);\r\n              }\r\n            }\r\n\r\n          });\r\n\r\n      } else {\r\n        // observer\r\n        if(del){\r\n          try {\r\n            delete _this._manager._observersControllers[_this.dataObjectObserver.url];\r\n            _this.dataObjectObserver.unsubscribe();\r\n            resolve(true);\r\n          } catch (e) {\r\n            console.error(e);\r\n            reject(false);\r\n          }\r\n        }\r\n        else{\r\n          // TODO: send message \r\n          resolve(true);\r\n        } \r\n        \r\n      }\r\n    });\r\n\r\n  }\r\n\r\n}\r\n\r\n/* harmony default export */ var chatManager_ChatController = (ChatController_ChatController);\r\n\n// CONCATENATED MODULE: ./src/chatManager/UserInfo.js\n\r\n\r\nclass UserInfo_UserInfo {\r\n\r\n  constructor(hypertyURL, domain, identity) {\r\n\r\n    let completeIdentity = deepClone(identity);\r\n    if (!identity.hasOwnProperty('userProfile')) {\r\n      completeIdentity['userProfile'] = identity;\r\n    }\r\n\r\n    return {\r\n      hypertyURL: hypertyURL,\r\n      domain, domain,\r\n      identity: completeIdentity\r\n    }\r\n\r\n  }\r\n\r\n}\r\n\n// CONCATENATED MODULE: ./src/chatManager/ChatManager.js\n\r\n/**\r\n* Copyright 2016 PT Inovação e Sistemas SA\r\n* Copyright 2016 INESC-ID\r\n* Copyright 2016 QUOBIS NETWORKS SL\r\n* Copyright 2016 FRAUNHOFER-GESELLSCHAFT ZUR FOERDERUNG DER ANGEWANDTEN FORSCHUNG E.V\r\n* Copyright 2016 ORANGE SA\r\n* Copyright 2016 Deutsche Telekom AG\r\n* Copyright 2016 Apizee\r\n* Copyright 2016 TECHNISCHE UNIVERSITAT BERLIN\r\n*\r\n* Licensed under the Apache License, Version 2.0 (the \"License\");\r\n* you may not use this file except in compliance with the License.\r\n* You may obtain a copy of the License at\r\n*\r\n*   http://www.apache.org/licenses/LICENSE-2.0\r\n*\r\n* Unless required by applicable law or agreed to in writing, software\r\n* distributed under the License is distributed on an \"AS IS\" BASIS,\r\n* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n* See the License for the specific language governing permissions and\r\n* limitations under the License.\r\n**/\r\n\r\n// Service Framework\r\n//import IdentityManager from '../identityManager/IdentityManager';\r\n//import RegistrationStatus from '../discovery/RegistrationStatus';\r\n//import Discovery from '../discovery/Discovery';\r\n//import Syncher from '../syncher/Syncher';\r\n\r\n// Utils\r\n//import {divideURL} from '../utils/utils';\r\n//import Search from '../utils/Search';\r\n\r\n// Internals\r\n\r\n\r\n\r\n\r\n/**\r\n* Hyperty Group Chat Manager API (HypertyChat)\r\n* @author Vitor Silva [vitor-t-silva@telecom.pt]\r\n* @version 0.1.0\r\n*/\r\nclass ChatManager_ChatManager {\r\n\r\n  constructor(myUrl, bus, configuration, syncher, factory) {\r\n    if (!myUrl) throw new Error('[ChatManager.constructor] The myUrl is a needed parameter');\r\n    if (!bus) throw new Error('[ChatManager.constructor] The MiniBus is a needed parameter');\r\n    if (!configuration) throw new Error('[ChatManager.constructor] The configuration is a needed parameter');\r\n\r\n    let _this = this;\r\n    if (!syncher) {\r\n      syncher = factory.createSyncher(myUrl, bus, configuration);\r\n    }\r\n\r\n    _this._runtimeURL = configuration.runtimeURL;\r\n\r\n    let domain = factory.divideURL(_this._runtimeURL).domain;\r\n    let discovery = factory.createDiscovery(myUrl, configuration.runtimeURL, bus);\r\n    let identityManager = factory.createIdentityManager(myUrl, configuration.runtimeURL, bus);\r\n\r\n    _this._objectDescURL = 'hyperty-catalogue://catalogue.' + domain + '/.well-known/dataschema/Communication';\r\n\r\n    _this._reportersControllers = {};\r\n    _this._observersControllers = {};\r\n\r\n    _this._myUrl = myUrl;\r\n    _this._bus = bus;\r\n    _this._syncher = syncher;\r\n    _this._domain = domain;\r\n\r\n    _this.discovery = discovery;\r\n    _this.identityManager = identityManager;\r\n    _this.currentIdentity;\r\n\r\n    _this.search = factory.createSearch(discovery, identityManager);\r\n\r\n    _this.communicationObject = communicationObject;\r\n\r\n    _this.communicationChildren = communicationChildren;\r\n\r\n    console.log('[ChatManager] Discover ', discovery);\r\n    console.log('[ChatManager] Identity Manager ', identityManager);\r\n\r\n\r\n  }\r\n\r\n  set offline(offline) {\r\n    this._offline = offline;\r\n  }\r\n\r\n  get offline() {\r\n    return this._offline ? this._offline : false;\r\n  }\r\n\r\n\r\n  processNotification(event) {\r\n    let _this = this;\r\n    console.log('[ChatManager.processNotification: ', event);\r\n\r\n    if (event.type === 'create') {\r\n\r\n      // TODO: replace the 100 for Message.Response\r\n      // event.ack(200);\r\n\r\n      if (_this._onInvitation) { _this._onInvitation(event); }\r\n    }\r\n\r\n    if (event.type === 'delete') {\r\n      // TODO: replace the 200 for Message.Response\r\n      event.ack(200);\r\n\r\n      _this._observersControllers[event.url].closeEvent = event;\r\n\r\n      delete _this._observersControllers[event.url];\r\n\r\n      _this._observersControllers.closeEvent = event;\r\n\r\n      _this.communicationObject = communicationObject;\r\n\r\n\r\n      for (let url in this._reportersControllers) {\r\n        this._reportersControllers[url].close(event);\r\n      }\r\n\r\n      for (let url in this._observersControllers) {\r\n        this._observersControllers[url].close(event);\r\n      }\r\n\r\n    }\r\n  }\r\n\r\n  myIdentity(identity) {\r\n    let _this = this;\r\n\r\n    return new Promise((resolve, reject) => {\r\n      console.info('[ChatManager.myIdentity]');\r\n      if (identity) return resolve(identity);\r\n\r\n      if (_this._myUrl.includes('hyperty://')) {\r\n        _this.identityManager.discoverUserRegistered().then((identity) => {\r\n          resolve(identity);\r\n        }).catch(function(reason) {\r\n          reject(reason);\r\n        });\r\n      } else {\r\n        _this.identityManager.discoverIdentityPerIdP().then((identity) => {\r\n          resolve(identity);\r\n        }).catch(function(reason) {\r\n          reject(reason);\r\n        });\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * This function is used to create a new Group Chat providing the name and the identifiers of users to be invited.\r\n   * @param  {string}                     name  Is a string to identify the Group Chat\r\n   * @param  {array<URL.userURL>}         users Array of users to be invited to join the Group Chat. Users are identified with reTHINK User URL, like this format user://<ipddomain>/<user-identifier>\r\n   * @return {<Promise>ChatController}    A ChatController object as a Promise.\r\n   */\r\n  create(name, users, extra = {}) {\r\n\r\n    let _this = this;\r\n    let syncher = _this._syncher;\r\n\r\n    return new Promise((resolve, reject) => {\r\n\r\n      _this.communicationObject = communicationObject;\r\n      _this.communicationObject.cseq = 1;\r\n      _this.communicationObject.startingTime = new Date().toJSON();\r\n      _this.communicationObject.status =  CommunicationStatus.OPEN;\r\n\r\n      let myIdentity;\r\n\r\n      _this.myIdentity().then((identity) => {\r\n        myIdentity = identity;\r\n        console.log('[ChatManager.create ] My Identity', identity);\r\n\r\n        // let url = _this.communicationObject.reporter;\r\n\r\n        let userInfo = new UserInfo_UserInfo(_this._myUrl, _this._domain, identity);\r\n\r\n        // Add my identity\r\n        _this.communicationObject.participants[identity.guid] = userInfo;\r\n\r\n        console.log('[ChatManager.create ] participants: ', _this.communicationObject.participants);\r\n        console.log('[ChatManager.create ] communicationObject', _this.communicationObject);\r\n        console.info('[ChatManager.create] searching ' + users);\r\n\r\n        //let usersSearch = _this.search.users(users, domains, ['comm'], ['chat']);\r\n\r\n        let usersDiscovery = [];\r\n\r\n        let disconnected = [];\r\n        let live = {};\r\n\r\n        users.forEach((user) => {\r\n          let userDiscoveryPromise = _this.discovery.discoverHypertiesDO(user.user, ['comm'], ['chat'], user.domain);\r\n          usersDiscovery.push(userDiscoveryPromise);\r\n\r\n          //if (user.user.includes('://')) mutual = false;\r\n        });\r\n\r\n        Promise.all(usersDiscovery).then((userDiscoveryResults) => {\r\n          console.log('[ChatManager.create] Users Discovery Results->', userDiscoveryResults);\r\n\r\n          let selectedHyperties = [];\r\n\r\n          userDiscoveryResults.forEach((userDiscoveryResult) => {\r\n\r\n            userDiscoveryResult.forEach((discovered)=>{\r\n              if (discovered.data.status === 'live') {\r\n                selectedHyperties.push(discovered.data.hypertyID);\r\n                live[discovered.data.hypertyID] = discovered;\r\n              } else {\r\n                // To control the number of subscriptions to disconnected devices\r\n                 if (disconnected.length < 5) {\r\n                    disconnected.push(discovered);\r\n                  }\r\n              }\r\n            });\r\n\r\n          });\r\n\r\n\r\n          /*        return usersSearch;\r\n      }).then((hypertiesIDs) => {\r\n        let selectedHyperties = hypertiesIDs.map((hyperty) => {\r\n          return hyperty.hypertyID;\r\n        }); */\r\n\r\n          console.info('[ChatManager] ---------------------- Syncher Create ---------------------- \\n');\r\n          console.info('[ChatManager] Selected Hyperties: !!! ', selectedHyperties);\r\n          console.info(`Have ${selectedHyperties.length} users;`);\r\n          let mutual = extra.mutual ? extra.mutual : true;\r\n\r\n          let input = Object.assign({resources: ['chat'], mutual: mutual}, extra);\r\n          delete input.name;\r\n\r\n          if (_this.offline) input.offline = _this.offline;\r\n\r\n          console.info('[ChatManager] input data:', input);\r\n          return syncher.create(_this._objectDescURL, selectedHyperties, _this.communicationObject, true, false, name, {}, input);\r\n        }).then(function(dataObjectReporter) {\r\n\r\n          console.info('[ChatManager] 3. Return Create Data Object Reporter', dataObjectReporter);\r\n\r\n          let chatController = new chatManager_ChatController(syncher, _this.discovery, _this._domain, _this.search, myIdentity, _this);\r\n          chatController.dataObjectReporter = dataObjectReporter;\r\n\r\n          _this._reportersControllers[dataObjectReporter.url] = chatController;\r\n\r\n          console.log('[ChatManager] chatController invitationsHandler: ',   chatController.invitationsHandler);\r\n\r\n          // process invitations to handle not received invitations\r\n          if (dataObjectReporter.invitations.length > 0) {\r\n            chatController.invitationsHandler.processInvitations(live, dataObjectReporter);\r\n          }\r\n\r\n          // If any invited User is disconnected let's wait until it is connected again\r\n          if (disconnected.length > 0) chatController.invitationsHandler.inviteDisconnectedHyperties(disconnected, dataObjectReporter);\r\n\r\n          resolve(chatController);\r\n\r\n        }).catch(function(reason) {\r\n          reject(reason);\r\n        });\r\n\r\n      }).catch((reason) => {\r\n        console.log('[ChatManager.create] MyIdentity Error:', reason);\r\n        return reject(reason);\r\n      });\r\n    });\r\n\r\n  }\r\n\r\n\r\n  /**\r\n   * This function is used to handle notifications about incoming invitations to join a Group Chat.\r\n   * @param  {Function} CreateEvent The CreateEvent fired by the Syncher when an invitaion is received\r\n   */\r\n  onInvitation(callback) {\r\n    let _this = this;\r\n    _this._onInvitation = callback;\r\n  }\r\n\r\n  /**\r\n   * This function is used to join a Group Chat.\r\n   * @param  {URL.CommunicationURL} invitationURL  The Communication URL of the Group Chat to join that is provided in the invitation event\r\n   * @return {<Promise>ChatController}             It returns the ChatController object as a Promise\r\n   */\r\n  join(invitationURL, mutual = true, identity) {\r\n    let _this = this;\r\n\r\n    return new Promise(function(resolve, reject) {\r\n      let syncher = _this._syncher;\r\n      let myIdentity;\r\n\r\n      console.info('[ChatManager] ------------------------ Syncher subscribe ---------------------- \\n');\r\n      console.info('invitationURL', invitationURL);\r\n      _this.myIdentity(identity).then((identity) => {\r\n        myIdentity = identity;\r\n        let input = {\r\n          schema: _this._objectDescURL,\r\n          resource: invitationURL,\r\n          store: true,\r\n          p2p: false,\r\n          mutual: mutual,\r\n          domain_subscription: true,\r\n          identity: identity\r\n        };\r\n\r\n        if (_this.offline) input.offline = _this.offline;\r\n\r\n        return syncher.subscribe(input);\r\n\r\n      }).then(function(dataObjectObserver) {\r\n        console.info('Data Object Observer: ', dataObjectObserver);\r\n\r\n        let chatController = new chatManager_ChatController(syncher, _this.discovery, _this._domain, _this.search, myIdentity, _this);\r\n        resolve(chatController);\r\n\r\n        chatController.dataObjectObserver = dataObjectObserver;\r\n\r\n        _this._observersControllers[dataObjectObserver.url] = chatController;\r\n\r\n      }).catch(function(reason) {\r\n        reject(reason);\r\n      });\r\n    });\r\n\r\n  }\r\n\r\n}\r\n\r\n/* harmony default export */ var chatManager_ChatManager = (ChatManager_ChatManager);\r\n\n// CONCATENATED MODULE: ./src/chatManager/Chat.js\n/**\r\n* Copyright 2016 PT Inovação e Sistemas SA\r\n* Copyright 2016 INESC-ID\r\n* Copyright 2016 QUOBIS NETWORKS SL\r\n* Copyright 2016 FRAUNHOFER-GESELLSCHAFT ZUR FOERDERUNG DER ANGEWANDTEN FORSCHUNG E.V\r\n* Copyright 2016 ORANGE SA\r\n* Copyright 2016 Deutsche Telekom AG\r\n* Copyright 2016 Apizee\r\n* Copyright 2016 TECHNISCHE UNIVERSITAT BERLIN\r\n*\r\n* Licensed under the Apache License, Version 2.0 (the \"License\");\r\n* you may not use this file except in compliance with the License.\r\n* You may obtain a copy of the License at\r\n*\r\n*   http://www.apache.org/licenses/LICENSE-2.0\r\n*\r\n* Unless required by applicable law or agreed to in writing, software\r\n* distributed under the License is distributed on an \"AS IS\" BASIS,\r\n* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n* See the License for the specific language governing permissions and\r\n* limitations under the License.\r\n**/\r\n\r\n/**\r\n* The Group Chat API is used to control a Group Chat instance.\r\n* @author Vitor Silva [vitor-t-silva@telecom.pt]\r\n* @version 0.1.0\r\n*/\r\n\r\n//import { UserInfo } from './UserInfo';\r\n//import RegistrationStatus from '../discovery/RegistrationStatus';\r\n//import InvitationsHandler from './InvitationsHandler';\r\n\r\nclass Chat {\r\n\r\n  constructor(syncher, domain, identity, manager) {\r\n\r\n    if (!syncher) throw Error('Syncher is a necessary dependecy');\r\n//    if (!discovery) throw Error('Discover is a necessary dependecy');\r\n    if (!domain) throw Error('Domain is a necessary dependecy');\r\n//    if (!search) throw Error('Search is a necessary dependecy');\r\n\r\n    let _this = this;\r\n    _this._syncher = syncher;\r\n//    _this.discovery = discovery;\r\n//    _this.search = search;\r\n    _this.myIdentity = identity;\r\n    _this.controllerMode = 'reporter';\r\n    _this.child_cseq = 0;\r\n    _this.domain = domain;\r\n\r\n    _this._manager = manager;\r\n\r\n    const hypertyURL = syncher.owner;\r\n\r\n    _this._objectDescURL = 'hyperty-catalogue://catalogue.' + domain + '/.well-known/dataschema/Communication';\r\n\r\n//    _this._invitationsHandler = new InvitationsHandler(hypertyURL);\r\n\r\n  }\r\n\r\n/*  get invitationsHandler() {\r\n    return this._invitationsHandler;\r\n  }*/\r\n\r\n  get url() {\r\n    return this.controllerMode === 'reporter' ? this.dataObjectReporter.url : this.dataObjectObserver.url;\r\n  }\r\n\r\n  set dataObjectReporter(dataObjectReporter) {\r\n\r\n    if (!dataObjectReporter) throw new Error('[ChatController] The data object reporter is necessary parameter ');\r\n    let _this = this;\r\n\r\n\r\n    _this.controllerMode = 'reporter';\r\n\r\n    // Handler to process received files\r\n\r\n    // dataObjectReporter.onResponse(function(event) {\r\n    //   console.log('[DataObjectReporter - onResponse]', event);\r\n    //   if (_this._onInvitationResponse) {\r\n    //     _this._onInvitationResponse(event);\r\n    //   }\r\n    //\r\n    // });\r\n\r\n    dataObjectReporter.onSubscription(function(event) {\r\n\r\n      switch (event.type) {\r\n        case 'subscribe': _this._onSubscribe(event); break;\r\n        case 'unsubscribe': _this._onUnsubscribe(event); break;\r\n      }\r\n    });\r\n\r\n    _this._setOnAddChildListener(dataObjectReporter);\r\n\r\n    dataObjectReporter.onRead((event) => {\r\n      event.accept();\r\n    });\r\n\r\n    dataObjectReporter.onExecute((event) => {\r\n      switch (event.method) {\r\n        case 'addUser':\r\n          _this.addUser(event.params[0]).then(() => {\r\n            event.accept();\r\n          }).catch(function(reason) {\r\n            console.error('Reason:', reason);\r\n            event.reject(reason);\r\n          });\r\n          break;\r\n          case 'removeUser':\r\n            _this.removeUser(event.params).then(() => {\r\n              event.accept();\r\n            }).catch(function(reason) {\r\n              console.error('Reason:', reason);\r\n              event.reject(reason);\r\n            });\r\n            break;\r\n        default: event.reject('[ChatController.onExecute] Chat method execution not accepted by Reporter');\r\n          break;\r\n      }\r\n    });\r\n\r\n    _this._dataObjectReporter = dataObjectReporter;\r\n\r\n  }\r\n\r\n  get dataObjectReporter() {\r\n    let _this = this;\r\n    return _this._dataObjectReporter;\r\n  }\r\n\r\n  get messages() {\r\n\r\n    return this.controllerMode === 'reporter' ? this._dataObjectReporter._childrenObjects : this._dataObjectObserver._childrenObjects;\r\n  }\r\n\r\n  set dataObjectObserver(dataObjectObserver) {\r\n    let _this = this;\r\n\r\n    _this.controllerMode = 'observer';\r\n\r\n    _this._dataObjectObserver = dataObjectObserver;\r\n\r\n    dataObjectObserver.onChange('*', function(event) {\r\n      console.info('[ChatManager.ChatController]Observer - onChange', event);\r\n\r\n      if (event.field.includes('participants')) {\r\n        switch (event.cType) {\r\n          case 'add':\r\n            if (_this._onUserAdded) _this._onUserAdded(event);\r\n            break;\r\n\r\n          case 'remove':\r\n            if (_this._onUserRemoved) _this._onUserRemoved(event);\r\n            break;\r\n        }\r\n      }\r\n\r\n      if (_this._onChange) _this._onChange(event);\r\n\r\n    });\r\n\r\n    _this._setOnAddChildListener(dataObjectObserver);\r\n\r\n    // let childrens = dataObjectObserver.childrens;\r\n    // Object.keys(childrens).forEach((child) => {\r\n    //   if (_this._onMessage) _this._onMessage({\r\n    //     childId: child,\r\n    //     identity: childrens[child].identity,\r\n    //     value: childrens[child].data\r\n    //   });\r\n    // })\r\n\r\n  }\r\n\r\n  get dataObjectObserver() {\r\n    let _this = this;\r\n    return _this._dataObjectObserver;\r\n  }\r\n\r\n  _setOnAddChildListener(dataObject) {\r\n\r\n    let _this = this;\r\n\r\n    dataObject.onAddChild(function(child) {\r\n      _this.child_cseq +=1;\r\n      console.info('[ChatManager.ChatController._setOnAddChildListener] new Child received: ', child);\r\n\r\n      if (_this._onMessage) _this._onMessage(child);\r\n    });\r\n\r\n  }\r\n\r\n\r\n  get dataObject() {\r\n    return this.controllerMode === 'reporter' ? this.dataObjectReporter : this.dataObjectObserver;\r\n  }\r\n\r\n  set closeEvent(event) {\r\n    let _this = this;\r\n    _this._closeEvent = event;\r\n\r\n    if (_this._onClose) _this._onClose(event);\r\n  }\r\n\r\n  get closeEvent() {\r\n    let _this = this;\r\n    return _this._closeEvent;\r\n  }\r\n\r\n\r\n\r\n  _onSubscribe(event) {\r\n\r\n    let dataObjectReporter = this._dataObjectReporter;\r\n\r\n    event.accept();\r\n\r\n\r\n    console.log('[ChatManager.ChatController.onSubscribe] event', event, dataObjectReporter.url);\r\n    console.log('[ChatManager.ChatController.onSubscribe] New user has subscribe this object: ', dataObjectReporter.data, event.identity);\r\n\r\n    let identity = JSON.parse(JSON.stringify(event.identity));\r\n\r\n    if (identity.hasOwnProperty('assertion')) {\r\n      delete identity.assertion\r\n    }\r\n\r\n    let userInfo = {\r\n      hypertyURL: event.url,\r\n      domain: event.domain,\r\n      identity: identity\r\n    }\r\n    let userURL = event.identity.userProfile.guid;\r\n\r\n    console.log('[ChatManager.ChatController.onSubscribe]  new participant', userInfo);\r\n    if (event.identity.legacy) {\r\n     userInfo.legacy = event.identity.legacy;\r\n    }\r\n\r\n    dataObjectReporter.data.participants[userURL] = userInfo;\r\n\r\n    console.log('[ChatManager.ChatController.onSubscribe] communicationObject OBJ chatcontroller', dataObjectReporter.data.participants);\r\n    console.log('[ChatManager.ChatController.onSubscribe - onSubscription] ', userInfo);\r\n    // console.log('[ChatManager.ChatController.onSubscribe - this._onUserAdded] ', this._onUserAdded);\r\n\r\n    if (this._onUserAdded) this._onUserAdded(userInfo);\r\n  }\r\n\r\n  _onUnsubscribe(event) {\r\n    let dataObjectReporter = this._dataObjectReporter;\r\n\r\n    console.log('[ChatManager.ChatController.onUnsubscribe] event', event, dataObjectReporter.url);\r\n\r\n    let participant = event.identity.userProfile;\r\n\r\n    console.log('[ChatManager.ChatController.onUnsubscribe]  participant left', participant);\r\n    if (event.identity.legacy) {\r\n      participant.legacy = event.identity.legacy;\r\n    }\r\n\r\n    delete dataObjectReporter.data.participants[participant.userURL];\r\n\r\n    console.log('[ChatManager.ChatController.onUnsubscribe - this._onUserRemoved] ', this.onUserRemoved);\r\n    if (this._onUserRemoved) this._onUserRemoved(participant);\r\n  }\r\n\r\n  /**\r\n   * This function is used to send a file.\r\n   * @param  {string}     file                        Is the file to be sent.\r\n   * @return {Promise<Communication.ChatMessage>}        It returns the ChatMessage child object created by the Syncher as a Promise.\r\n   */\r\n  sendFile(file) {\r\n\r\n    let _this = this;\r\n    let mode = _this.controllerMode;\r\n    let dataObject = mode === 'reporter' ? _this.dataObjectReporter : _this.dataObjectObserver;\r\n\r\n    return new Promise(function(resolve, reject) {\r\n\r\n      let identity = {\r\n        userProfile: _this.myIdentity\r\n      };\r\n\r\n      dataObject.addHypertyResource('resources', 'file',  file, identity).then(function(resourceFile) {\r\n\r\n          let identity = {\r\n              userProfile: _this.myIdentity\r\n          };\r\n          let fileSentEvt = { value : resourceFile, identity: identity, resource: resourceFile};\r\n\r\n/*          let reporterStatus = new RegistrationStatus(dataObject.url, _this._manager._runtimeURL, _this._manager._hypertyURL, _this._manager._bus );\r\n\r\n          // recursive function to sync with chat reporter\r\n\r\n            let share2Reporter = function(file, subscriber, evt, status) {\r\n              let statusOfReporter = status;\r\n              file.sharingStatus.then(resolve(evt)).catch((result)=>{\r\n                console.log('[ChatManager.ChatController.sendFile] share failed: ', result);\r\n\r\n                statusOfReporter.onLive( subscriber, () => {\r\n                statusOfReporter.unsubscribeLive(subscriber);\r\n                file.share(true);\r\n                share2Reporter(file, subscriber, evt, statusOfReporter);\r\n                });\r\n                  //TODO: subscribe to sync when reporter is live. New synched messages should trigger onMessage ie onChild\r\n              });\r\n            }*/\r\n\r\n//            resourceFile.share(true).then(()=>{\r\n              resolve(fileSentEvt);\r\n//            });\r\n//            share2Reporter(resourceFile, _this._manager._hypertyURL, fileSentEvt, reporterStatus);\r\n        });\r\n    }).catch(function(reason) {\r\n      console.error('Reason:', reason);\r\n      reject(reason);\r\n    });\r\n\r\n  }\r\n\r\n  /**\r\n   * This function is used to send a chat message.\r\n   * @param  {string}     message                        Is the ChatMessage to be sent.\r\n   * @return {Promise<Communication.ChatMessage>}        It returns the ChatMessage child object created by the Syncher as a Promise.\r\n   */\r\n  send(message, identity) {\r\n\r\n    let _this = this;\r\n    let mode = _this.controllerMode;\r\n    let dataObject = mode === 'reporter' ? _this.dataObjectReporter : _this.dataObjectObserver;\r\n\r\n    return new Promise(function(resolve, reject) {\r\n\r\n//      let _dataObjectChild;\r\n      _this.child_cseq += 1;\r\n      let msg = {\r\n\r\n/*        url: dataObject.data.url,\r\n        cseq: _this.child_cseq,\r\n        reporter: dataObject.data.reporter,\r\n        schema: dataObject.data.schema,\r\n        name: dataObject.data.name,\r\n        created : new Date().toJSON(),*/\r\n\r\n        type: 'chat',\r\n        content: message\r\n      }\r\n\r\n      let sender = identity ? identity : {\r\n        userProfile: _this.myIdentity\r\n      };\r\n\r\n      let input = {};\r\n      input.anonymous = true;\r\n\r\n\r\n      // TODO: change chatmessages to resource - chat, file\r\n      // TODO: change message to hypertyResource - https://github.com/reTHINK-project/dev-service-framework/tree/develop/docs/datamodel/data-objects/hyperty-resource\r\n      // TODO: handle with multiple resources - if the \"message\" will be different for each type of resources\r\n      dataObject.addChild(msg, sender, input).then(function(dataObjectChild) {\r\n        console.log('[ChatManager.ChatController][addChild - Chat Message]: ', dataObjectChild);\r\n        //resolve(dataObjectChild);\r\n\r\n        //TODO: move to separate function\r\n\r\n\r\n        let msg = {\r\n          childId: dataObjectChild._childId,\r\n          from: dataObjectChild._owner,\r\n          value: dataObjectChild.data,\r\n          type: 'create',\r\n          identity: sender\r\n        };\r\n\r\n/*        let reporterStatus = new RegistrationStatus(dataObject.url, _this._manager._runtimeURL, _this._manager._hypertyURL, _this._manager._bus );\r\n\r\n        // recursive function to sync with chat reporter\r\n\r\n          let share2Reporter = function(child, subscriber, msg, status) {\r\n            let statusOfReporter = status;\r\n            child.sharingStatus.then(resolve(msg)).catch((result)=>{\r\n\r\n                statusOfReporter.onLive( subscriber, () => {\r\n                  statusOfReporter.unsubscribeLive(subscriber);\r\n                  child.share(true);\r\n                  share2Reporter(child, subscriber, msg, statusOfReporter);\r\n                });\r\n                //TODO: subscribe to sync when reporter is live. New synched messages should trigger onMessage ie onChild\r\n            });\r\n          }*/\r\n\r\n//          share2Reporter(dataObjectChild, _this._manager._hypertyURL, msg, reporterStatus);\r\n//        dataObjectChild.share(true);\r\n          resolve(msg);\r\n\r\n\r\n        }).catch(function(reason) {\r\n        console.error('Reason:', reason);\r\n        reject(reason);\r\n      });\r\n\r\n    });\r\n\r\n  }\r\n\r\n  /**\r\n   * [onChange description]\r\n   * @param  {Function} callback [description]\r\n   * @return {[type]}            [description]\r\n   */\r\n  onChange(callback) {\r\n    let _this = this;\r\n    _this._onChange = callback;\r\n  }\r\n\r\n  /**\r\n   * This function is used to receive new messages.\r\n   * @param  {Function} callback Function to handle with new messages\r\n   * @return {Communication.ChatMessage} m\r\n   */\r\n  onMessage(callback) {\r\n    let _this = this;\r\n    _this._onMessage = callback;\r\n  }\r\n\r\n  /**\r\n   * This function is used to receive typing events.\r\n   * @param  {Function} callback Function to handle typing event\r\n   */\r\n\r\n  onTyping(callback) {\r\n      if (this._dataObjectReporter) this._dataObjectReporter.onEvent((event)=>{\r\n        if (event.value === 'typing') {\r\n          callback();\r\n        }\r\n      });\r\n      else this._dataObjectObserver.onEvent((event)=>{\r\n        if (event.value === 'typing') {\r\n          callback();\r\n        } \r\n      });\r\n  }\r\n\r\n  /**\r\n   * This function is used to trigger typing events.\r\n   */\r\n\r\n  typing() {\r\n      if (this._dataObjectReporter) this._dataObjectReporter.sendEvent('typing');\r\n      else this._dataObjectObserver.sendEvent('typing');\r\n  }\r\n\r\n\r\n  /**\r\n   * [onUserAdded description]\r\n   * @param  {Function} callback [description]\r\n   * @return {[type]}            [description]\r\n   */\r\n  onUserAdded(callback) {\r\n    let _this = this;\r\n    _this._onUserAdded = callback;\r\n  }\r\n\r\n  /**\r\n   * When the an user was removed\r\n   * @param  {Function} callback Function handle with the removed user\r\n   * @return {[type]}            [description]\r\n   */\r\n  onUserRemoved(callback) {\r\n    let _this = this;\r\n    _this._onUserRemoved = callback;\r\n  }\r\n\r\n  /**\r\n   * This function is used to receive requests to close the Group Chat instance.\r\n   * @return {DeleteEvent} The DeleteEvent fired by the Syncher when the Chat is closed.\r\n   */\r\n  onClose(callback) {\r\n    let _this = this;\r\n    _this._onClose = callback;\r\n  }\r\n\r\n  onResponse(callback) {\r\n    let _this = this;\r\n    _this._onResponse = callback;\r\n  }\r\n\r\n  /**\r\n   * This function is used to add / invite new user on an existing Group Chat instance.\r\n   * Only the Reporter, i.e. the Hyperty that has created the Group Chat, is allowed to use this function.\r\n   * @param {URL.UserURL}  users  User to be invited to join the Group Chat that is identified with reTHINK User URL.\r\n   * @return {Promise<boolean>}   It returns as a Promise true if successfully invited or false otherwise.\r\n   */\r\n/*  addUser(users) {\r\n\r\n    let _this = this;\r\n\r\n    let haveEmptyElements = (element) => {\r\n      console.log('Element:', element.length);\r\n      return element.length !== 0;\r\n    };\r\n\r\n    let notFoundElements = (element) => {\r\n      console.log('user not found: ', element);\r\n      return !(element instanceof String);\r\n    };\r\n\r\n    return new Promise(function(resolve, reject) {\r\n\r\n      if (users.filter(haveEmptyElements).length === 0) {\r\n        return reject('Don\\'t have users to invite');\r\n      }\r\n\r\n      console.info('[ChatManager.ChatController.addUsers ]: ', users);\r\n\r\n      /*_this.search.users(users, domains, ['comm'], ['chat'])\r\n\r\n    .then((hypertiesIDs) => {\r\n\r\n      if (hypertiesIDs.filter(notFoundElements).length === 0) {\r\n        throw 'User(s) not found';\r\n      }\r\n\r\n      let selectedHyperties = hypertiesIDs.map((hyperty) => {\r\n        return hyperty.hypertyID;\r\n      });*/\r\n\r\n/*      let usersDiscovery = [];\r\n      let disconnected = [];\r\n      let live = {};\r\n\r\n      users.forEach((user) => {\r\n        let userDiscoveryPromise = _this.discovery.discoverHypertiesDO(user.user, ['comm'], ['chat'], user.domain);\r\n          usersDiscovery.push(userDiscoveryPromise);\r\n        });\r\n\r\n      Promise.all(usersDiscovery).then((userDiscoveryResults) => {\r\n        console.log('[ChatManager.ChatController.addUsers] Users Discovery Results->', userDiscoveryResults);\r\n\r\n        let selectedHyperties = [];\r\n\r\n         userDiscoveryResults.forEach((userDiscoveryResult) => {\r\n\r\n           userDiscoveryResult.forEach((discovered)=>{\r\n             if (discovered.data.status === 'live'){\r\n               selectedHyperties.push(discovered.data.hypertyID);\r\n               live[discovered.data.hypertyID] = discovered;\r\n             }\r\n             else if (disconnected.length < 5) disconnected.push(discovered);\r\n           });\r\n\r\n        });\r\n\r\n        console.info('[ChatManager.ChatController]------------------------ Syncher Create ---------------------- \\n');\r\n        console.info('[ChatManager.ChatController]Selected Hyperties: !!! ', selectedHyperties);\r\n        console.info(`Have ${selectedHyperties.length} users;`);\r\n//        console.info('[ChatManager] HypertiesIDs ', hypertiesIDs);\r\n\r\n        let dataObject = _this.controllerMode === 'reporter' ? _this.dataObjectReporter : _this.dataObjectObserver;\r\n\r\n        if (disconnected.length > 0) _this._invitationsHandler.inviteDisconnectedHyperties(disconnected, dataObject);\r\n\r\n        dataObject.inviteObservers(selectedHyperties);\r\n\r\n        if (dataObject.invitations.length > 0) _this._invitationsHandler.processInvitations(live, dataObject);\r\n\r\n        return;\r\n\r\n        })\r\n        .then(() => {\r\n          console.info('[ChatManager.ChatController]Are invited with success ' + users.length + ' users;');\r\n          resolve(true);\r\n\r\n\r\n\r\n        }).catch((reason) => {\r\n          console.error('An error occurred when trying to invite users;\\n', reason);\r\n          reject(reason);\r\n        });\r\n\r\n    });\r\n\r\n  }*/\r\n\r\n  /**\r\n   * This function is used to request the Reporter to add / invite new user on an existing Group Chat instance.\r\n   * Only Observers are allowed to use this function.\r\n   * @param {URL.UserURL}  users  User to be invited to join the Group Chat that is identified with reTHINK User URL.\r\n   * @return {Promise<boolean>}   It returns as a Promise true if successfully invited or false otherwise.\r\n   */\r\n/*  addUserReq(users) {\r\n\r\n    let _this = this;\r\n\r\n    //check is Observer and invoke observer.execute() with new promise\r\n    let haveEmptyElements = (element) => {\r\n      console.log('Element:', element.length);\r\n      return element.length !== 0;\r\n    };\r\n\r\n    return new Promise(function(resolve, reject) {\r\n\r\n      if (users.filter(haveEmptyElements).length === 0) {\r\n        return reject('[ChatManager.ChatController.addUserReq] Don\\'t have users to add');\r\n      }\r\n      if (!_this.controllerMode === 'observer') {\r\n        return reject('[ChatManager.ChatController.addUserReq] only allowed to Chat Observer');\r\n\r\n      let addUser = _this.addUser(users);\r\n\r\n      if (_this._dataObjectObserver) {\r\n        addUser = _this._dataObjectObserver.execute('addUser', users);\r\n      }\r\n\r\n      addUser.then(() => {\r\n        console.info('[ChatManager.ChatController.addUserReq] Request accepted by Reporter ');\r\n        resolve(true);\r\n      }).catch((reason) => {\r\n        console.error('[ChatManager.ChatController.addUserReq] Request rejected by Reporter;\\n', reason);\r\n        reject(reason);\r\n      });\r\n    }\r\n\r\n  });\r\n\r\n}*/\r\n\r\n  onInvitationResponse(callback) {\r\n    let _this = this;\r\n    _this._onInvitationResponse = callback;\r\n//    _this._invitationsHandler.invitationResponse = callback;\r\n  }\r\n\r\n\r\n  /**\r\n   * This function is used to remove a user from an existing Group Chat instance.\r\n   * Only the Reporter, i.e. the Hyperty that has created the Group Chat, is allowed to use this function.\r\n   * @return {<Promise> boolean} Promise with the status\r\n   */\r\n\r\n  /**\r\n   * This function is used to remove a user from an existing Group Chat instance.\r\n   * Only the Reporter, i.e. the Hyperty that has created the Group Chat, is allowed to use this function.\r\n   * @param  {URL.UserURL} user       User to be removed from the Group Chat that is identified with reTHINK User URL.\r\n   * @return {<Promise> boolean}      It returns as a Promise true if successfully removed or false otherwise.\r\n   */\r\n  removeUser(user) {\r\n\r\n    // TODO: implement the removeUser;\r\n    console.log('[ChatManager.ChatController]Not yet implemented: ', user);\r\n\r\n  }\r\n\r\n  /**\r\n   * This function is used to close an existing Group Chat instance.\r\n   * Only available to Chat Group Reporters i.e. the Hyperty instance that created the Group Chat.\r\n   * @return {<Promise>Boolean} It returns as a Promise true if successfully closed or false otherwise.\r\n   */\r\n  close(del = true) {\r\n    // TODO: the dataObjectReporter.delete should be a Promise;\r\n\r\n    let _this = this;\r\n    \r\n    return new Promise(function(resolve, reject) {\r\n      \r\n      if (_this.controllerMode === 'reporter') {\r\n        // reporter\r\n//        _this._invitationsHandler.cleanInvitations(_this.dataObjectReporter).then(() => {\r\n          if (!del) {\r\n            _this._manager.communicationObject.status = 'closed';\r\n              resolve(true);\r\n            }\r\n            else{\r\n\r\n              try {\r\n              \r\n                  delete _this._manager._reportersControllers[_this.dataObjectReporter.url];\r\n                _this.dataObjectReporter.delete();\r\n                resolve(true);\r\n                if (_this._onClose) _this._onClose({\r\n                  code: 200,\r\n                  desc: 'deleted',\r\n                  url: _this.dataObjectReporter.url\r\n                })\r\n              } catch (e) {\r\n                console.error(e);\r\n                reject(false);\r\n              }\r\n            }\r\n\r\n//          });\r\n\r\n      } else {\r\n        // observer\r\n        if(del){\r\n          try {\r\n            delete _this._manager._observersControllers[_this.dataObjectObserver.url];\r\n            _this.dataObjectObserver.unsubscribe();\r\n            resolve(true);\r\n          } catch (e) {\r\n            console.error(e);\r\n            reject(false);\r\n          }\r\n        }\r\n        else{\r\n          // TODO: send message \r\n          resolve(true);\r\n        } \r\n        \r\n      }\r\n    });\r\n\r\n  }\r\n\r\n}\r\n\r\n/* harmony default export */ var chatManager_Chat = (Chat);\r\n\n// CONCATENATED MODULE: ./src/chatManager/SimpleChatManager.js\n\r\n/**\r\n* Copyright 2016 PT Inovação e Sistemas SA\r\n* Copyright 2016 INESC-ID\r\n* Copyright 2016 QUOBIS NETWORKS SL\r\n* Copyright 2016 FRAUNHOFER-GESELLSCHAFT ZUR FOERDERUNG DER ANGEWANDTEN FORSCHUNG E.V\r\n* Copyright 2016 ORANGE SA\r\n* Copyright 2016 Deutsche Telekom AG\r\n* Copyright 2016 Apizee\r\n* Copyright 2016 TECHNISCHE UNIVERSITAT BERLIN\r\n*\r\n* Licensed under the Apache License, Version 2.0 (the \"License\");\r\n* you may not use this file except in compliance with the License.\r\n* You may obtain a copy of the License at\r\n*\r\n*   http://www.apache.org/licenses/LICENSE-2.0\r\n*\r\n* Unless required by applicable law or agreed to in writing, software\r\n* distributed under the License is distributed on an \"AS IS\" BASIS,\r\n* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n* See the License for the specific language governing permissions and\r\n* limitations under the License.\r\n**/\r\n\r\n// Service Framework\r\n//import IdentityManager from '../identityManager/IdentityManager';\r\n//import RegistrationStatus from '../discovery/RegistrationStatus';\r\n//import Discovery from '../discovery/Discovery';\r\n//import Syncher from '../syncher/Syncher';\r\n\r\n// Utils\r\n//import {divideURL} from '../utils/utils';\r\n//import Search from '../utils/Search';\r\n\r\n// Internals\r\n\r\n\r\n\r\n\r\n/**\r\n* Hyperty Simple Group Chat Manager API\r\n* @author Vitor Silva [vitor-t-silva@telecom.pt]\r\n* @version 0.1.0\r\n*/\r\nclass SimpleChatManager_SimpleChatManager {\r\n\r\n  constructor(myUrl, bus, configuration, syncher, factory) {\r\n    if (!myUrl) throw new Error('[SimpleChatManager.constructor] The myUrl is a needed parameter');\r\n    if (!bus) throw new Error('[SimpleChatManager.constructor] The MiniBus is a needed parameter');\r\n    if (!configuration) throw new Error('[SimpleChatManager.constructor] The configuration is a needed parameter');\r\n\r\n    let _this = this;\r\n    if (!syncher) {\r\n      syncher = factory.createSyncher(myUrl, bus, configuration);\r\n    }\r\n\r\n    _this._runtimeURL = configuration.runtimeURL;\r\n\r\n    let domain = factory.divideURL(_this._runtimeURL).domain;\r\n//    let discovery = factory.createDiscovery(myUrl, configuration.runtimeURL, bus);\r\n    let identityManager = factory.createIdentityManager(myUrl, configuration.runtimeURL, bus);\r\n\r\n    _this._objectDescURL = 'hyperty-catalogue://catalogue.' + domain + '/.well-known/dataschema/Communication';\r\n\r\n    _this._reportersControllers = {};\r\n    _this._observersControllers = {};\r\n\r\n    _this._myUrl = myUrl;\r\n    _this._bus = bus;\r\n    _this._syncher = syncher;\r\n    _this._domain = domain;\r\n    _this._defaultStubTriggered = false;\r\n\r\n//    _this.discovery = discovery;\r\n    _this.identityManager = identityManager;\r\n    _this.currentIdentity;\r\n\r\n//    _this.search = factory.createSearch(discovery, identityManager);\r\n\r\n    _this.communicationObject = communicationObject;\r\n\r\n    _this.communicationChildren = communicationChildren;\r\n\r\n//    console.log('[SimpleChatManager] Discover ', discovery);\r\n    console.log('[SimpleChatManager] Identity Manager ', identityManager);\r\n\r\n\r\n  }\r\n\r\n  set offline(offline) {\r\n    this._offline = offline;\r\n  }\r\n\r\n  get offline() {\r\n    return this._offline ? this._offline : false;\r\n  }\r\n\r\n  set backup(backup) {\r\n    this._backup = backup;\r\n  }\r\n\r\n  get backup() {\r\n    return this._backup ? this._backup : false;\r\n  }\r\n\r\n  processNotification(event) {\r\n    let _this = this;\r\n    console.log('[SimpleChatManager.processNotification: ', event);\r\n\r\n    if (event.type === 'create') {\r\n\r\n      // TODO: replace the 100 for Message.Response\r\n      // event.ack(200);\r\n\r\n      if (_this._onInvitation) { _this._onInvitation(event); }\r\n    }\r\n\r\n    if (event.type === 'delete') {\r\n      // TODO: replace the 200 for Message.Response\r\n      event.ack(200);\r\n\r\n      if (_this._onNotification) { _this._onNotification(event); }\r\n\r\n      if ( _this._observersControllers[event.url]){\r\n        _this._observersControllers[event.url].closeEvent = event;\r\n\r\n        delete _this._observersControllers[event.url];\r\n\r\n        _this._observersControllers.closeEvent = event;\r\n\r\n        _this.communicationObject = communicationObject;\r\n\r\n      }\r\n\r\n\r\n/*\r\n      for (let url in this._reportersControllers) {\r\n        this._reportersControllers[url].close(event);\r\n      }\r\n\r\n      for (let url in this._observersControllers) {\r\n        this._observersControllers[url].close(event);\r\n      }*/\r\n\r\n    }\r\n  }\r\n\r\n  myIdentity(identity) {\r\n    let _this = this;\r\n\r\n    return new Promise((resolve, reject) => {\r\n      console.info('[SimpleChatManager.myIdentity]');\r\n      if (identity) return resolve(identity);\r\n\r\n      if (_this._myUrl.includes('hyperty://')) {\r\n        _this.identityManager.discoverUserRegistered().then((identity) => {\r\n          _this.currentIdentity = identity;\r\n          resolve(identity);\r\n        }).catch(function(reason) {\r\n          reject(reason);\r\n        });\r\n      } else {\r\n        _this.identityManager.discoverIdentityPerIdP().then((identity) => {\r\n          _this.currentIdentity = identity;\r\n          resolve(identity);\r\n        }).catch(function(reason) {\r\n          reject(reason);\r\n        });\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * This function is used to create a new Group Chat providing the name and the identifiers of users to be invited.\r\n   * @param  {string}                     name  Is a string to identify the Group Chat\r\n   * @param  {array<URL.HypertyURL>}         hyperties Array of hyperties to be invited to join the Group Chat. Users are identified with reTHINK User URL, like this format user://<ipddomain>/<user-identifier>\r\n   * @return {<Promise>ChatController}    A ChatController object as a Promise.\r\n   */\r\n  create(name, hyperties, extra = {}) {\r\n\r\n    let _this = this;\r\n    let syncher = _this._syncher;\r\n\r\n    return new Promise((resolve, reject) => {\r\n\r\n      _this.communicationObject = communicationObject;\r\n      _this.communicationObject.cseq = 1;\r\n      _this.communicationObject.startingTime = new Date().toJSON();\r\n      _this.communicationObject.status =  CommunicationStatus.OPEN;\r\n\r\n      let myIdentity;\r\n\r\n      _this.myIdentity().then((identity) => {\r\n        myIdentity = identity;\r\n        console.log('[SimpleChatManager.create ] My Identity', identity);\r\n\r\n        // let url = _this.communicationObject.reporter;\r\n\r\n        let userInfo = new UserInfo_UserInfo(_this._myUrl, _this._domain, identity);\r\n\r\n        // Add my identity\r\n        _this.communicationObject.participants[identity.guid] = userInfo;\r\n\r\n        console.log('[SimpleChatManager.create ] participants: ', _this.communicationObject.participants);\r\n        console.log('[SimpleChatManager.create ] communicationObject', _this.communicationObject);\r\n\r\n\r\n          console.info('[SimpleChatManager] ---------------------- Syncher Create ---------------------- \\n');\r\n          console.info('[SimpleChatManager] Selected Hyperties: !!! ', hyperties);\r\n//          console.info(`Have ${hyperties.length} users;`);\r\n          let mutual = extra.mutual ? extra.mutual : true;\r\n\r\n          let input = Object.assign({resources: ['chat'], mutual: mutual}, extra);\r\n          delete input.name;\r\n\r\n          if (_this.offline) input.offline = _this.offline;\r\n          if (_this.backup) input.backup = _this.backup;\r\n\r\n          console.log('[SimpleChatManager] input data:', input);\r\n          return syncher.create(_this._objectDescURL, hyperties, _this.communicationObject, true, false, name, {}, input);\r\n        }).then(function(dataObjectReporter) {\r\n\r\n          console.info('[SimpleChatManager] 3. Return Create Data Object Reporter', dataObjectReporter);\r\n\r\n          let chat = new chatManager_Chat(syncher, _this._domain, myIdentity, _this);\r\n          chat.dataObjectReporter = dataObjectReporter;\r\n\r\n          _this._reportersControllers[dataObjectReporter.url] = chat;\r\n\r\n//          console.log('[SimpleChatManager] chat invitationsHandler: ',   chat.invitationsHandler);\r\n\r\n          // process invitations to handle not received invitations\r\n/*          if (dataObjectReporter.invitations.length > 0) {\r\n            chat.invitationsHandler.processInvitations(live, dataObjectReporter);\r\n          }\r\n\r\n          // If any invited User is disconnected let's wait until it is connected again\r\n          if (disconnected.length > 0) chat.invitationsHandler.inviteDisconnectedHyperties(disconnected, dataObjectReporter);\r\n*/\r\n          resolve(chat);\r\n\r\n        }).catch(function(reason) {\r\n          reject(reason);\r\n        });\r\n\r\n      }).catch((reason) => {\r\n        console.log('[SimpleChatManager.create] MyIdentity Error:', reason);\r\n        return reject(reason);\r\n      });\r\n//    });\r\n\r\n  }\r\n\r\n\r\n  /**\r\n   * This function is used to handle notifications about incoming invitations to join a Group Chat.\r\n   * @param  {Function} CreateEvent The CreateEvent fired by the Syncher when an invitaion is received\r\n   */\r\n  onInvitation(callback) {\r\n    let _this = this;\r\n    _this._onInvitation = callback;\r\n\r\n    _this._triggerDefaultStubDeployment();\r\n  }\r\n\r\n  // send message to trigger domain default stub to ensure incoming messages are received\r\n\r\n  _triggerDefaultStubDeployment(){\r\n    let pingMessage = { from: this._myUrl, to: this._domain, type: 'execute'  };\r\n    if (!this._defaultStubTriggered) this._bus.postMessage(pingMessage);\r\n    this._defaultStubTriggered = true;\r\n  }\r\n\r\n  /**\r\n   * This function is used to handle notifications about incoming invitations to join a Group Chat.\r\n   * @param  {Function} CreateEvent The CreateEvent fired by the Syncher when an invitaion is received\r\n   */\r\n  onNotification(callback) {\r\n    let _this = this;\r\n    _this._onNotification = callback;\r\n  }\r\n\r\n  /**\r\n   * This function is used to join a Group Chat.\r\n   * @param  {URL.CommunicationURL} invitationURL  The Communication URL of the Group Chat to join that is provided in the invitation event\r\n   * @return {<Promise>ChatController}             It returns the ChatController object as a Promise\r\n   */\r\n  join(invitationURL, mutual = false, identity) {\r\n    let _this = this;\r\n\r\n    return new Promise(function(resolve, reject) {\r\n      let syncher = _this._syncher;\r\n      let myIdentity;\r\n\r\n      console.info('[SimpleChatManager] ------------------------ Syncher subscribe ---------------------- \\n');\r\n      console.info('invitationURL', invitationURL);\r\n      _this.myIdentity(identity).then((identity) => {\r\n        myIdentity = identity;\r\n        let input = {\r\n          schema: _this._objectDescURL,\r\n          resource: invitationURL,\r\n          store: true,\r\n          p2p: false,\r\n          mutual: mutual,\r\n          domain_subscription: true,\r\n          identity: identity\r\n        };\r\n\r\n        if (_this.offline) input.offline = _this.offline;\r\n\r\n        return syncher.subscribe(input);\r\n\r\n      }).then(function(dataObjectObserver) {\r\n        console.info('Data Object Observer: ', dataObjectObserver);\r\n\r\n        let chat = new chatManager_Chat(syncher, _this._domain, myIdentity, _this);\r\n        resolve(chat);\r\n\r\n        chat.dataObjectObserver = dataObjectObserver;\r\n\r\n        _this._observersControllers[dataObjectObserver.url] = chat;\r\n\r\n      }).catch(function(reason) {\r\n        reject(reason);\r\n      });\r\n    });\r\n\r\n  }\r\n\r\n}\r\n\r\n/* harmony default export */ var chatManager_SimpleChatManager = (SimpleChatManager_SimpleChatManager);\r\n\n// CONCATENATED MODULE: ./src/sandbox/SandboxFactory.js\n/**\r\n* Copyright 2016 PT Inovação e Sistemas SA\r\n* Copyright 2016 INESC-ID\r\n* Copyright 2016 QUOBIS NETWORKS SL\r\n* Copyright 2016 FRAUNHOFER-GESELLSCHAFT ZUR FOERDERUNG DER ANGEWANDTEN FORSCHUNG E.V\r\n* Copyright 2016 ORANGE SA\r\n* Copyright 2016 Deutsche Telekom AG\r\n* Copyright 2016 Apizee\r\n* Copyright 2016 TECHNISCHE UNIVERSITAT BERLIN\r\n*\r\n* Licensed under the Apache License, Version 2.0 (the \"License\");\r\n* you may not use this file except in compliance with the License.\r\n* You may obtain a copy of the License at\r\n*\r\n*   http://www.apache.org/licenses/LICENSE-2.0\r\n*\r\n* Unless required by applicable law or agreed to in writing, software\r\n* distributed under the License is distributed on an \"AS IS\" BASIS,\r\n* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n* See the License for the specific language governing permissions and\r\n* limitations under the License.\r\n**/\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n/**\r\n * Internal component to instantiate framework functionalities.\r\n */\r\nclass SandboxFactory_SandboxFactory {\r\n  /* private\r\n  _components: <url: instance>\r\n  */\r\n\r\n  constructor(bus) {\r\n    let _this = this;\r\n    _this._bus = bus;\r\n    _this._divideURL = divideURL;\r\n\r\n  }\r\n\r\n  createSyncher(owner, bus, config) { \r\n    return new syncher_Syncher(owner, bus, config);\r\n   }\r\n\r\n   createIdentityManager(hypertyURL, runtimeURL, bus) { \r\n    let _this = this;\r\n    return new identity_IdentityManager(hypertyURL, runtimeURL, bus);\r\n   }\r\n\r\n   createDiscovery(hypertyURL, runtimeURL, bus) { \r\n    let _this = this;\r\n    return new discovery_Discovery(hypertyURL, runtimeURL, bus);\r\n   }\r\n\r\n   createSearch(discovery, identityManager) { \r\n    let _this = this;\r\n    return new utils_Search(discovery, identityManager);\r\n   }\r\n\r\n   createContextObserver(hypertyURL, bus, config, schemes) { \r\n    return new contextManager_ContextObserver(hypertyURL, bus, config, schemes, this);\r\n   }\r\n\r\n   createContextReporter(hypertyURL, bus, config) { \r\n    let _this = this;\r\n    return new contextManager_ContextReporter(hypertyURL, bus, config, this);\r\n   }\r\n\r\n   createNotificationHandler(bus) { \r\n    let _this = this;\r\n    return new syncher_NotificationHandler(bus);\r\n   }\r\n\r\n   createMessageBodyIdentity(username, userURL, picture, name, locale, idp, assertion, profile) { \r\n    return new identity_MessageBodyIdentity(username, userURL, picture, name, locale, idp, assertion, profile);\r\n   }\r\n\r\n   createChatManager(hypertyURL, bus, configuration, syncher) { \r\n    return new chatManager_ChatManager(hypertyURL, bus, configuration, syncher, this);\r\n   }\r\n\r\n   createChatController(syncher, discovery, domain, search, identity, manager) { \r\n    return new chatManager_ChatController(syncher, discovery, domain, search, identity, manager);\r\n   }\r\n\r\n   createSimpleChatManager(hypertyURL, bus, configuration, syncher) { \r\n    return new chatManager_SimpleChatManager(hypertyURL, bus, configuration, syncher, this);\r\n   }\r\n\r\n   createChat(syncher, domain, identity, manager) { \r\n    return new chatManager_Chat(syncher, domain, identity, manager);\r\n   }\r\n   get divideURL(){\r\n     return this._divideURL;\r\n   }\r\n\r\n   createRegistrationStatus(observer, runtimeURL, chatUrl, bus) {\r\n    return new discovery_RegistrationStatus(observer, runtimeURL, chatUrl, bus);\r\n\r\n  }\r\n\r\n\r\n\r\n}\r\n\r\n\r\n/* harmony default export */ var sandbox_SandboxFactory = (SandboxFactory_SandboxFactory);\r\n\n// CONCATENATED MODULE: ./src/sandbox/SandboxRegistry.js\n/**\r\n* Copyright 2016 PT Inovação e Sistemas SA\r\n* Copyright 2016 INESC-ID\r\n* Copyright 2016 QUOBIS NETWORKS SL\r\n* Copyright 2016 FRAUNHOFER-GESELLSCHAFT ZUR FOERDERUNG DER ANGEWANDTEN FORSCHUNG E.V\r\n* Copyright 2016 ORANGE SA\r\n* Copyright 2016 Deutsche Telekom AG\r\n* Copyright 2016 Apizee\r\n* Copyright 2016 TECHNISCHE UNIVERSITAT BERLIN\r\n*\r\n* Licensed under the Apache License, Version 2.0 (the \"License\");\r\n* you may not use this file except in compliance with the License.\r\n* You may obtain a copy of the License at\r\n*\r\n*   http://www.apache.org/licenses/LICENSE-2.0\r\n*\r\n* Unless required by applicable law or agreed to in writing, software\r\n* distributed under the License is distributed on an \"AS IS\" BASIS,\r\n* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n* See the License for the specific language governing permissions and\r\n* limitations under the License.\r\n**/\r\n/**\r\n * @author micaelpedrosa@gmail.com\r\n * Base class to implement internal deploy manager of components.\r\n */\r\n\r\n\r\n/**\r\n * @author micaelpedrosa@gmail.com\r\n * Internal component registry of all sandboxes.\r\n * Process internal request's for component deploy.\r\n */\r\nclass SandboxRegistry_SandboxRegistry {\r\n  /* private\r\n  _components: <url: instance>\r\n  */\r\n\r\n  constructor(bus) {\r\n    let _this = this;\r\n\r\n    _this._bus = bus;\r\n    _this._factory = new sandbox_SandboxFactory(bus);\r\n    _this._components = {};\r\n\r\n    bus.addListener(SandboxRegistry_SandboxRegistry.InternalDeployAddress, (msg) => {\r\n      console.log('SandboxRegistry-RCV: ', msg);\r\n      // let responseMsg = {\r\n      //   id: msg.id, type: 'response', from: SandboxRegistry.InternalDeployAddress, to: SandboxRegistry.ExternalDeployAddress\r\n      // };\r\n\r\n      switch (msg.type) {\r\n        case 'create': _this._onDeploy(msg); break;\r\n        case 'delete': _this._onRemove(msg); break;\r\n      }\r\n    });\r\n  }\r\n\r\n  get components() { return this._components; }\r\n\r\n  _responseMsg(msg, code, value) {\r\n\r\n    let _this = this;\r\n\r\n    // let messageFactory = _this.messageFactory;\r\n\r\n    //FLOW-OUT: generic response message to external Sandbox (deploy and un-deploy responses)\r\n    let responseMsg = {\r\n      id: msg.id, type: 'response', from: SandboxRegistry_SandboxRegistry.InternalDeployAddress, to: SandboxRegistry_SandboxRegistry.ExternalDeployAddress\r\n    };\r\n\r\n    // Chanege the origin message, because the response;\r\n    // msg.from = SandboxRegistry.InternalDeployAddress;\r\n    // msg.to = SandboxRegistry.ExternalDeployAddress;\r\n\r\n    let body = {};\r\n    if (code) body.code = code;\r\n    if (value) body.desc = value;\r\n\r\n    responseMsg.body = body;\r\n\r\n    // return messageFactory.createResponse(msg, code, value);\r\n    return responseMsg;\r\n  }\r\n\r\n  //FLOW-IN: message from the runtime core Sandbox -> deployComponent\r\n  _onDeploy(msg) {\r\n    let _this = this;\r\n    let config = msg.body.config;\r\n    let componentURL = msg.body.url;\r\n    let sourceCode = msg.body.sourceCode;\r\n    let responseCode;\r\n    let responseDesc;\r\n\r\n    if (!_this._components.hasOwnProperty(componentURL)) {\r\n      try {\r\n      console.log('SandboxRegistry-onDeploy: ', msg);\r\n      _this._components[componentURL] = _this._create(componentURL, sourceCode, config, _this._factory );\r\n        responseCode = 200;\r\n      } catch (error) {\r\n        responseCode = 500;\r\n        responseDesc = error;\r\n      }\r\n    } else {\r\n      responseCode = 500;\r\n      responseDesc = 'Instance ' + componentURL + ' already exist!';\r\n    }\r\n\r\n    let responseMsg = _this._responseMsg(msg, responseCode, responseDesc);\r\n    _this._bus.postMessage(responseMsg);\r\n  }\r\n\r\n  //FLOW-IN: message from the runtime core Sandbox -> removeComponent\r\n  _onRemove(msg) {\r\n    let _this = this;\r\n    let componentURL = msg.body.url;\r\n    let responseCode;\r\n    let responseDesc;\r\n\r\n    if (_this._components.hasOwnProperty(componentURL)) {\r\n      //remove component from the pool and all listeners\r\n      delete _this._components[componentURL];\r\n      _this._bus.removeAllListenersOf(componentURL);\r\n      responseCode = 200;\r\n    } else {\r\n      responseCode = 500;\r\n      responseDesc = 'Instance ' + componentURL + ' doesn\\'t exist!';\r\n    }\r\n\r\n    let responseMsg = _this._responseMsg(msg, responseCode, responseDesc);\r\n\r\n    _this._bus.postMessage(responseMsg);\r\n  }\r\n\r\n  /**\r\n   * This method should be implemented by the internal sandbox code.\r\n   * @param  {ComponentURL} url URL used for the instance\r\n   * @param  {string} sourceCode Code of the component\r\n   * @param  {Config} config Configuration parameters\r\n   * @return {Object} Returns instance of the component or throw an error \"throw 'error message'\"\r\n   */\r\n  _create(url, sourceCode, config, factory) {\r\n    //implementation specific\r\n    /* example code:\r\n      eval(sourceCode);\r\n      return activate(url, _this._bus, config);\r\n    */\r\n  }\r\n}\r\n\r\nSandboxRegistry_SandboxRegistry.ExternalDeployAddress = 'hyperty-runtime://sandbox/external';\r\nSandboxRegistry_SandboxRegistry.InternalDeployAddress = 'hyperty-runtime://sandbox/internal';\r\n\r\n/* harmony default export */ var sandbox_SandboxRegistry = (SandboxRegistry_SandboxRegistry);\r\n\n// CONCATENATED MODULE: ./src/bus/Bus.js\n/**\r\n* Copyright 2016 PT Inovação e Sistemas SA\r\n* Copyright 2016 INESC-ID\r\n* Copyright 2016 QUOBIS NETWORKS SL\r\n* Copyright 2016 FRAUNHOFER-GESELLSCHAFT ZUR FOERDERUNG DER ANGEWANDTEN FORSCHUNG E.V\r\n* Copyright 2016 ORANGE SA\r\n* Copyright 2016 Deutsche Telekom AG\r\n* Copyright 2016 Apizee\r\n* Copyright 2016 TECHNISCHE UNIVERSITAT BERLIN\r\n*\r\n* Licensed under the Apache License, Version 2.0 (the \"License\");\r\n* you may not use this file except in compliance with the License.\r\n* You may obtain a copy of the License at\r\n*\r\n*   http://www.apache.org/licenses/LICENSE-2.0\r\n*\r\n* Unless required by applicable law or agreed to in writing, software\r\n* distributed under the License is distributed on an \"AS IS\" BASIS,\r\n* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n* See the License for the specific language governing permissions and\r\n* limitations under the License.\r\n**/\r\n\r\n// Log system\r\n\r\nlet Bus_log = loglevel[\"getLogger\"]('Bus');\r\n\r\n/**\r\n* @author micaelpedrosa@gmail.com\r\n* Minimal interface and implementation to send and receive messages. It can be reused in many type of components.\r\n* Components that need a message system should receive this class as a dependency or extend it.\r\n* Extensions should implement the following private methods: _onPostMessage and _registerExternalListener\r\n*/\r\nclass Bus {\r\n  /* private\r\n  _msgId: number;\r\n  _subscriptions: <url: MsgListener[]>\r\n\r\n  _responseTimeOut: number\r\n  _responseCallbacks: <url+id: (msg) => void>\r\n\r\n  */\r\n\r\n  constructor() {\r\n    let _this = this;\r\n    _this._msgId = 0;\r\n    _this._subscriptions = {};\r\n\r\n    _this._responseTimeOut = 15000; //default to 3s\r\n    _this._responseCallbacks = {};\r\n\r\n    _this._registerExternalListener();\r\n  }\r\n\r\n  /**\r\n  * Register listener to receive message when \"msg.to === url\".\r\n  * Special url \"*\" for default listener is accepted to intercept all messages.\r\n  * @param {URL} url Address to intercept, tha is in the message \"to\"\r\n  * @param {Listener} listener listener\r\n  * @return {MsgListener} instance of MsgListener\r\n  */\r\n  addListener(url, listener) {\r\n    let _this = this;\r\n\r\n    let item = new MsgListener(_this._subscriptions, url, listener);\r\n    let itemList = _this._subscriptions[url];\r\n    if (!itemList) {\r\n      itemList = [];\r\n      _this._subscriptions[url] = itemList;\r\n    }\r\n\r\n    itemList.push(item);\r\n    return item;\r\n  }\r\n\r\n  /**\r\n   * Manually add a response listener. Only one listener per message ID should exist.\r\n   * ATENTION, there is no timeout for this listener.\r\n   * The listener should be removed with a removeResponseListener, failing to do this will result in a unreleased memory problem.\r\n   * @param {URL} url Origin address of the message sent, \"msg.from\".\r\n   * @param {number} msgId Message ID that is returned from the postMessage.\r\n   * @param {Function} responseListener Callback function for the response\r\n   */\r\n  addResponseListener(url, msgId, responseListener) {\r\n    this._responseCallbacks[url + msgId] = responseListener;\r\n  }\r\n\r\n  /**\r\n   * Remove the response listener.\r\n   * @param {URL} url Origin address of the message sent, \"msg.from\".\r\n   * @param {number} msgId  Message ID that is returned from the postMessage\r\n   */\r\n  removeResponseListener(url, msgId) {\r\n    delete this._responseCallbacks[url + msgId];\r\n  }\r\n\r\n  /**\r\n   * Remove all existent listeners for the URL\r\n   * @param  {URL} url Address registered\r\n   */\r\n  removeAllListenersOf(url) {\r\n    delete this._subscriptions[url];\r\n  }\r\n\r\n  /**\r\n   * Helper method to bind listeners (in both directions) into other MiniBus target.\r\n   * @param  {URL} outUrl Outbound URL, register listener for url in direction \"this -> target\"\r\n   * @param  {URL} inUrl Inbound URL, register listener for url in direction \"target -> this\"\r\n   * @param  {MiniBus} target The other target MiniBus\r\n   * @return {Bound} an object that contains the properties [thisListener, targetListener] and the unbind method.\r\n   */\r\n  bind(outUrl, inUrl, target) {\r\n    let _this = this;\r\n\r\n    let thisListn = _this.addListener(outUrl, (msg) => {\r\n      target.postMessage(msg);\r\n    });\r\n\r\n    let targetListn = target.addListener(inUrl, (msg) => {\r\n      _this.postMessage(msg);\r\n    });\r\n\r\n    return {\r\n      thisListener: thisListn,\r\n      targetListener: targetListn,\r\n      unbind: () => {\r\n        this.thisListener.remove();\r\n        this.targetListener.remove();\r\n      }\r\n    };\r\n  }\r\n\r\n  //publish on default listeners\r\n  _publishOnDefault(msg) {\r\n    //is there any \"*\" (default) listeners?\r\n    let itemList = this._subscriptions['*'];\r\n    if (itemList) {\r\n      this._publishOn(itemList, msg);\r\n    }\r\n  }\r\n\r\n  //publish on a subscription list.\r\n  _publishOn(itemList, msg) {\r\n    itemList.forEach((sub) => {\r\n      sub._callback(msg);\r\n    });\r\n  }\r\n\r\n  _responseCallback(inMsg, responseCallback, timeout = true) {\r\n    let _this = this;\r\n\r\n    //automatic management of response handlers\r\n    if (responseCallback) {\r\n      let responseId = inMsg.from + inMsg.id;\r\n      _this._responseCallbacks[responseId] = responseCallback;\r\n\r\n      if (timeout) {\r\n        setTimeout(() => {\r\n          let responseFun = _this._responseCallbacks[responseId];\r\n          delete _this._responseCallbacks[responseId];\r\n\r\n          if (responseFun) {\r\n            let errorMsg = {\r\n              id: inMsg.id, type: 'response',\r\n              body: { code: 408, desc: 'Response timeout!', value: inMsg }\r\n            };\r\n\r\n            responseFun(errorMsg);\r\n          }\r\n        }, _this._responseTimeOut);\r\n      }\r\n\r\n    }\r\n  }\r\n\r\n//TODO: provisional responses should reset timeout\r\n  _onResponse(msg) {\r\n    let _this = this;\r\n\r\n    if (msg.type === 'response') {\r\n      let responseId = msg.to + msg.id;\r\n      let responseFun = _this._responseCallbacks[responseId];\r\n\r\n      if (msg.body.code >= 200) { //if it's a provisional response, don't delete response listener\r\n        delete _this._responseCallbacks[responseId];\r\n      }\r\n\r\n      if (responseFun) {\r\n        responseFun(msg);\r\n        return true;\r\n      }\r\n\r\n\r\n    }\r\n\r\n    return false;\r\n  }\r\n\r\n  //receive messages from external interface\r\n  _onMessage(msg) {\r\n    let _this = this;\r\n\r\n    if (!_this._onResponse(msg)) {\r\n      let itemList = _this._subscriptions[msg.to];\r\n      if (itemList) {\r\n        _this._publishOn(itemList, msg);\r\n      } else {\r\n        _this._publishOnDefault(msg);\r\n      }\r\n    }\r\n  }\r\n\r\n  _genId(inMsg) {\r\n    //TODO: how do we manage message ID's? Should it be a global runtime counter, or per URL address?\r\n    //Global counter will not work, because there will be multiple MiniBus instances!\r\n    //Per URL, can be a lot of data to maintain!\r\n    //Maybe a counter per MiniBus instance. This is the assumed solution for now.\r\n    if (!inMsg.id || inMsg.id === 0) {\r\n      this._msgId++;\r\n      inMsg.id = this._msgId;\r\n    }\r\n  }\r\n\r\n  /**\r\n  * Send messages to local listeners, or if not exists to external listeners.\r\n  * It's has an optional mechanism for automatic management of response handlers.\r\n  * The response handler will be unregistered after receiving the response, or after response timeout (default to 3s).\r\n  * @param  {Message} msg Message to send. Message ID is automatically added to the message.\r\n  * @param  {Function} responseCallback Optional parameter, if the developer what's automatic response management.\r\n  * @return {number} Returns the message ID, in case it should be needed for manual management of the response handler.\r\n  */\r\n  postMessage(inMsg, responseCallback) { }\r\n\r\n  /**\r\n   * Function to post messages with a number of retries in case timeouts occur.\r\n   * @param  {Message} msg Message to send. Message ID is automatically added to the message.\r\n   * @param  {Function} responseCallback Optional parameter, if the developer what's automatic response management.\r\n   * @param  {integer} retries number of retries when timeouts occur\r\n   * @return {boolean} message delivery result;\r\n   */\r\n\r\n\r\n  postMessageWithRetries(msg, retries, callback) {\r\n\r\n    let _this = this;\r\n\r\n    let retry = 0;\r\n    //let timeout = true;\r\n\r\n    let sendMsg = function() {\r\n\r\n      return new Promise((resolve, reject) => {\r\n        _this.postMessage(msg, (reply) => {\r\n          if (reply.body.code === 408 || reply.body.code === 500) reject();\r\n          else {\r\n            Bus_log.info('[Bus.postMessageWithRetries] msg delivered: ', msg);\r\n            callback(reply);\r\n            resolve();\r\n          }\r\n        });\r\n      });\r\n    };\r\n\r\n    let tryAgain = () => {\r\n      sendMsg().then(()=>{\r\n        //timeout = false;\r\n        return;\r\n      }, ()=>{\r\n        Bus_log.warn(`[Bus.postMessageWithRetries] Message Bounced (retry ${retry}): '`, msg);\r\n        if (retry++ < retries) {\r\n          tryAgain();\r\n          // setTimeout(() => { tryAgain(); }, 1000);\r\n        } else {\r\n          const error = `[Error] Message Bounced (delivery attempts ${retries}): '`;\r\n          throw new Error(error + msg);\r\n        }\r\n      });\r\n    };\r\n    tryAgain();\r\n  }\r\n\r\n  /**\r\n   * Not public available, used by the class extension implementation, to process messages from the public \"postMessage\" without a registered listener.\r\n   * Used to send the message to an external interface, like a WebWorker, IFrame, etc.\r\n   * @param  {Message.Message} msg Message\r\n   */\r\n  _onPostMessage(msg) { /*implementation will send message to external system*/ }\r\n\r\n  /**\r\n   * Not public available, used by the class extension implementation, to process all messages that enter the MiniBus from an external interface, like a WebWorker, IFrame, etc.\r\n   * This method is called one time in the constructor to register external listeners.\r\n   * The implementation will probably call the \"_onMessage\" method to publish in the local listeners.\r\n   * DO NOT call \"postMessage\", there is a danger that the message enters in a cycle!\r\n   */\r\n  _registerExternalListener() { /*implementation will register external listener and call \"this._onMessage(msg)\" */ }\r\n\r\n}\r\n\r\nclass MsgListener {\r\n  /* private\r\n  _subscriptions: <string: MsgListener[]>;\r\n  _url: string;\r\n  _callback: (msg) => void;\r\n  */\r\n\r\n  constructor(subscriptions, url, callback) {\r\n    let _this = this;\r\n\r\n    _this._subscriptions = subscriptions;\r\n    _this._url = url;\r\n    _this._callback = callback;\r\n  }\r\n\r\n  get url() { return this._url; }\r\n\r\n  /**\r\n   * Remove this listener from the Bus\r\n   */\r\n  remove() {\r\n    let _this = this;\r\n\r\n    let subs = _this._subscriptions[_this._url];\r\n    if (subs) {\r\n      let index = subs.indexOf(_this);\r\n      subs.splice(index, 1);\r\n\r\n      //if there are no listeners, remove the subscription entirely.\r\n      if (subs.length === 0) {\r\n        delete _this._subscriptions[_this._url];\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\n/* harmony default export */ var bus_Bus = (Bus);\r\n\n// CONCATENATED MODULE: ./src/bus/MiniBus.js\n/**\r\n* Copyright 2016 PT Inovação e Sistemas SA\r\n* Copyright 2016 INESC-ID\r\n* Copyright 2016 QUOBIS NETWORKS SL\r\n* Copyright 2016 FRAUNHOFER-GESELLSCHAFT ZUR FOERDERUNG DER ANGEWANDTEN FORSCHUNG E.V\r\n* Copyright 2016 ORANGE SA\r\n* Copyright 2016 Deutsche Telekom AG\r\n* Copyright 2016 Apizee\r\n* Copyright 2016 TECHNISCHE UNIVERSITAT BERLIN\r\n*\r\n* Licensed under the Apache License, Version 2.0 (the \"License\");\r\n* you may not use this file except in compliance with the License.\r\n* You may obtain a copy of the License at\r\n*\r\n*   http://www.apache.org/licenses/LICENSE-2.0\r\n*\r\n* Unless required by applicable law or agreed to in writing, software\r\n* distributed under the License is distributed on an \"AS IS\" BASIS,\r\n* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n* See the License for the specific language governing permissions and\r\n* limitations under the License.\r\n**/\r\n\r\n\r\n/**\r\n* @author micaelpedrosa@gmail.com\r\n* Message BUS Interface is an extension of the Bus\r\n* It is used mainly in the internal sandbox routing.\r\n*/\r\nclass MiniBus_MiniBus extends bus_Bus {\r\n\r\n  constructor() {\r\n    super();\r\n  }\r\n\r\n  /**\r\n   * Post a message for routing. Message is routed directly to the external routing _onPostMessage.\r\n   * @param  {Message} inMsg            JSON with mandatory Message structure {id, type, from, to}\r\n   * @param  {Callback} responseCallback Optional callback if a response is expected from the request. A response will be always sent, even if it is a \"Timeout\".\r\n   * @return {number}                  the Message id\r\n   */\r\n  postMessage(inMsg, responseCallback, timeout) {\r\n    let _this = this;\r\n\r\n    _this._genId(inMsg);\r\n    _this._responseCallback(inMsg, responseCallback, timeout);\r\n\r\n    //always send to external (to core MessageBus)\r\n    _this._onPostMessage(inMsg);\r\n\r\n    return inMsg.id;\r\n  }\r\n\r\n  //internal method used when a message is received by an external routing system\r\n  _onMessage(msg) {\r\n    let _this = this;\r\n\r\n    if (!_this._onResponse(msg)) {\r\n      let itemList = _this._subscriptions[msg.to];\r\n      if (itemList) {\r\n        _this._publishOn(itemList, msg);\r\n        if (!msg.to.startsWith('hyperty')) {\r\n          _this._publishOnDefault(msg);\r\n        }\r\n      } else {\r\n        _this._publishOnDefault(msg);\r\n      }\r\n    }\r\n  }\r\n\r\n}\r\n\r\n/* harmony default export */ var bus_MiniBus = (MiniBus_MiniBus);\r\n\n// CONCATENATED MODULE: ./src/sandbox/Sandbox.js\n/**\r\n* Copyright 2016 PT Inovação e Sistemas SA\r\n* Copyright 2016 INESC-ID\r\n* Copyright 2016 QUOBIS NETWORKS SL\r\n* Copyright 2016 FRAUNHOFER-GESELLSCHAFT ZUR FOERDERUNG DER ANGEWANDTEN FORSCHUNG E.V\r\n* Copyright 2016 ORANGE SA\r\n* Copyright 2016 Deutsche Telekom AG\r\n* Copyright 2016 Apizee\r\n* Copyright 2016 TECHNISCHE UNIVERSITAT BERLIN\r\n*\r\n* Licensed under the Apache License, Version 2.0 (the \"License\");\r\n* you may not use this file except in compliance with the License.\r\n* You may obtain a copy of the License at\r\n*\r\n*   http://www.apache.org/licenses/LICENSE-2.0\r\n*\r\n* Unless required by applicable law or agreed to in writing, software\r\n* distributed under the License is distributed on an \"AS IS\" BASIS,\r\n* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n* See the License for the specific language governing permissions and\r\n* limitations under the License.\r\n**/\r\n\r\n\r\n\r\n\r\nlet SandboxType = {APP: 'app', NORMAL: 'normal', WINDOW: 'window'};\r\n\r\n/**\r\n * @author micaelpedrosa@gmail.com\r\n * Base class to implement external sandbox component\r\n */\r\nclass Sandbox_Sandbox extends bus_MiniBus {\r\n\r\n  constructor(capabilities) {\r\n\r\n    super();\r\n\r\n    let _this = this;\r\n\r\n    if (capabilities)      { _this.capabilities = capabilities; }\r\n\r\n\r\n  }\r\n\r\n  /**\r\n   * Deploy an instance of the component into the sandbox.\r\n   * @param  {string} componentSourceCode Component source code (Hyperty, ProtoStub, etc)\r\n   * @param  {URL} componentURL Hyperty, ProtoStub, or any other component address.\r\n   * @param  {Config} configuration Config parameters of the component\r\n   * @return {Promise<string>} return deployed if successful, or any other string with an error\r\n   */\r\n  deployComponent(componentSourceCode, componentURL, configuration) {\r\n\r\n    let _this = this;\r\n\r\n    // let messageFactory = _this.messageFactory;\r\n\r\n    return new Promise((resolve, reject) => {\r\n      //FLOW-OUT: deploy message for the internal SandboxRegistry -> _onDeploy\r\n      let deployMessage = {\r\n        type: 'create', from: sandbox_SandboxRegistry.ExternalDeployAddress, to: sandbox_SandboxRegistry.InternalDeployAddress,\r\n        body: { url: componentURL, sourceCode: componentSourceCode, config: configuration }\r\n      };\r\n\r\n      //send message into the sandbox internals and wait for reply\r\n      _this.postMessage(deployMessage, (reply) => {\r\n        if (reply.body.code === 200) {\r\n          //is this response complaint with the spec?\r\n          resolve('deployed');\r\n        } else {\r\n          reject(reply.body.desc);\r\n        }\r\n      });\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Remove the instance of a previously deployed component.\r\n   * @param  {URL} componentURL Hyperty, ProtoStub, or any other component address.\r\n   * @return {Promise<string>} return undeployed if successful, or any other string with an error\r\n   */\r\n  removeComponent(componentURL) {\r\n    let _this = this;\r\n\r\n    return new Promise((resolve, reject) => {\r\n      //FLOW-OUT: un-deploy message for the internal SandboxRegistry -> _onRemove\r\n      let removeMessage = {\r\n        type: 'delete', from: sandbox_SandboxRegistry.ExternalDeployAddress, to: sandbox_SandboxRegistry.InternalDeployAddress,\r\n        body: { url: componentURL }\r\n      };\r\n\r\n      //send message into the sandbox internals and wait for reply\r\n      _this.postMessage(removeMessage, (reply) => {\r\n        if (reply.body.code === 200) {\r\n          //is this response complaint with the spec?\r\n          resolve('undeployed');\r\n        } else {\r\n          reject(reply.body.desc);\r\n        }\r\n      });\r\n    });\r\n  }\r\n\r\n  /**\r\n  * Matches Sandbox capabilities against provided capabilities. Used to check if sandbox provides all required capabilities\r\n  * @param  {RuntimeCapabilities} constraints set of RuntimeCapabilities to match with.\r\n  * @return {boolean} return true if constraints are matched false otherwise\r\n   */\r\n\r\n  matches(constraints) {\r\n    let _this = this;\r\n\r\n    let filtered = Object.keys(constraints).filter((key) => {\r\n      return !(_this.capabilities[key] && _this.capabilities[key] === constraints[key]);\r\n    });\r\n\r\n    if (filtered.length === 0)      { return true; }    else      { return !(constraints[filtered]); }\r\n  }\r\n\r\n}\r\n\r\n/* harmony default export */ var sandbox_Sandbox = (Sandbox_Sandbox);\r\n\n// CONCATENATED MODULE: ./src/allocation/AddressAllocation.js\n/**\r\n* Copyright 2016 PT Inovação e Sistemas SA\r\n* Copyright 2016 INESC-ID\r\n* Copyright 2016 QUOBIS NETWORKS SL\r\n* Copyright 2016 FRAUNHOFER-GESELLSCHAFT ZUR FOERDERUNG DER ANGEWANDTEN FORSCHUNG E.V\r\n* Copyright 2016 ORANGE SA\r\n* Copyright 2016 Deutsche Telekom AG\r\n* Copyright 2016 Apizee\r\n* Copyright 2016 TECHNISCHE UNIVERSITAT BERLIN\r\n*\r\n* Licensed under the Apache License, Version 2.0 (the \"License\");\r\n* you may not use this file except in compliance with the License.\r\n* You may obtain a copy of the License at\r\n*\r\n*   http://www.apache.org/licenses/LICENSE-2.0\r\n*\r\n* Unless required by applicable law or agreed to in writing, software\r\n* distributed under the License is distributed on an \"AS IS\" BASIS,\r\n* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n* See the License for the specific language governing permissions and\r\n* limitations under the License.\r\n**/\r\n\r\n// Log system\r\n\r\nlet AddressAllocation_log = loglevel[\"getLogger\"]('address-allocation');\r\n\r\n\r\n\r\n\r\n// TODO: this could not be the best way to do a Singleton but at this moment it works;\r\n\r\nlet AddressAllocation_instance;\r\n\r\n/**\r\n * Class will ask to the message node for addresses\r\n */\r\nclass AddressAllocation_AddressAllocation {\r\n  /* private\r\n  _url: URL\r\n  _bus: MiniBus\r\n  */\r\n\r\n  /**\r\n   * Create an Address Allocation\r\n   * @param  {URL.URL}      url - url from who is sending the message\r\n   * @param  {MiniBus}      bus - MiniBus used for address allocation\r\n   */\r\n  constructor(url, bus, registry, subscriptionManager) {\r\n\r\n    if (!AddressAllocation_instance) {\r\n      this._url = url + '/address-allocation';\r\n      this._bus = bus;\r\n      this._registry = registry;\r\n      this._subscriptionManager = subscriptionManager;\r\n      AddressAllocation_instance = this;\r\n    } else {\r\n      return AddressAllocation_instance;\r\n    }\r\n  }\r\n\r\n  static get instance() {\r\n    if (!AddressAllocation_instance) {\r\n      throw new Error('The address allocation was not instantiated');\r\n    }\r\n\r\n    return AddressAllocation_instance\r\n  }\r\n\r\n  /**\r\n   * get the URL value\r\n   * @return {string} The url value;\r\n   */\r\n  get url() { return this._url; }\r\n\r\n\r\n  /**\r\n   *\r\n   * Ask for creation of a number of Hyperty addresses, to the domain message node.\r\n   *\r\n   * @param {Domain} domain - domain of the message node\r\n   * @param {Number} number - number of address to be allocated\r\n   * @param {Descriptor} info - descriptor to search for the hyperty (TODO:// this should be confirmed)\r\n   * @see https://github.com/reTHINK-project/specs/blob/master/datamodel/core/hyperty-catalogue/readme.md#catalogue-data-model\r\n   * @param {scheme} scheme - scheme of address to be created or reused, like: hyperty, comm, context, etc;\r\n   * @param {boolean|URL.HypertyURL} reuseURL - reuseURL is used to reuse the hypertyURL previously registred;\r\n   * @returns {Promise<Object, Error>} this is Promise and returns an object with the address information\r\n   *\r\n   * @memberOf AddressAllocation\r\n   */\r\n  create(domain, number, info, scheme, reuseURL) {\r\n\r\n    AddressAllocation_log.log('[AddressAllocation.create] info ', info);\r\n    //debugger;\r\n    if (reuseURL) {\r\n\r\n      if (typeof(reuseURL) === 'boolean') {\r\n\r\n        if (reuseURL) {\r\n          return this._reuseAllocatedAddress(domain, number, info, scheme, reuseURL);\r\n        } else {\r\n          return this._allocateNewAddress(domain, scheme, number, info);\r\n        }\r\n\r\n      }\r\n\r\n      if (typeof(reuseURL) === 'string' && isURL(reuseURL)) {\r\n        //return this._reuseAllocatedAddress(domain, number, info, scheme, reuseURL);\r\n        return new Promise((resolve, reject) => {\r\n          let value = { newAddress: false, address: [reuseURL] };\r\n          return resolve(value);\r\n        });\r\n      }\r\n\r\n    } else {\r\n      AddressAllocation_log.log('[AddressAllocation] - new address will be allocated');\r\n\r\n      // if there is no URL saved request a new URL\r\n      return this._allocateNewAddress(domain, scheme, number, info);\r\n    }\r\n\r\n  }\r\n\r\n  _reuseAllocatedAddress(domain, number, info, scheme, reuseURL) {\r\n\r\n    return new Promise((resolve, reject) => {\r\n\r\n      console.log('REUSETEST -  _reuseAllocatedAddress', domain, number, info, scheme, reuseURL);\r\n      this._registry.checkRegisteredURLs(info, reuseURL).then((urls) => {\r\n        console.log('REUSETEST -  registeredurls', urls);\r\n        if (urls) {\r\n          AddressAllocation_log.info('[AddressAllocation - ' + scheme + '] - Reuse URL');\r\n          let value = {newAddress: false, address: urls};\r\n          resolve(value);\r\n        } else {\r\n\r\n          if (typeof(reuseURL) === 'string') {\r\n            AddressAllocation_log.info('[AddressAllocation - reuseURL] - Object ' + reuseURL + ' not found');\r\n            reject('URL Not Found');\r\n          } else if (typeof(reuseURL) === 'boolean') {\r\n            this._allocateNewAddress(domain, scheme, number, info).then(resolve).catch(reject);\r\n          } else {\r\n            reject('URL Not Found');\r\n          }\r\n\r\n        }\r\n\r\n      });\r\n\r\n    });\r\n  }\r\n\r\n  _allocateNewAddress(domain, scheme, number, info) {\r\n    let _this = this;\r\n\r\n    return new Promise((resolve, reject) => {\r\n\r\n      let addresses = [];\r\n      var i;\r\n\r\n      for (i=0; i< number; i++) {\r\n        addresses.push(scheme+'://' + domain + '/' + generateGUID())\r\n      }\r\n\r\n      let result = {newAddress: true, address: addresses};\r\n\r\n      if (scheme === 'hyperty' ) {\r\n        if (info.hasOwnProperty('configuration') && info.configuration.hasOwnProperty('domain_routing') && !info.configuration.domain_routing) \r\n          resolve(result);\r\n        else {\r\n          _this._subscriptionManager.createSubscription(domain,addresses, _this._url).then(()=>{\r\n            resolve(result);\r\n          });\r\n\r\n        }\r\n      } else resolve(result);\r\n\r\n\r\n/*      let msg = {\r\n        type: 'create', from: this._url, to: 'domain://msg-node.' + domain + '/address-allocation',\r\n        body: {value: { number: number } }\r\n      };\r\n\r\n      if (scheme !== 'hyperty') msg.body.scheme = scheme;\r\n\r\n      log.info('[AddressAllocation - ' + scheme + '] - Request new URL');\r\n\r\n      this._bus.postMessage(msg, (reply) => {\r\n        if (reply.body.code === 200) {\r\n          let result = {newAddress: true, address: reply.body.value.allocated};\r\n          resolve(result);\r\n        } else {\r\n          reject(reply.body.desc);\r\n        }\r\n      });*/\r\n\r\n      });\r\n\r\n  }\r\n\r\n  /**\r\n  * Send a request to the domain message node, to deallocate one or more addresses\r\n  * @param  {Domain} domain - Domain of the message node.\r\n  * @param  {addresses} addresses to request the deallocation\r\n  * @returns {Promise}  the response by the message node\r\n  */\r\n  delete(domain, addresses) {\r\n    let _this = this;\r\n\r\n    return new Promise((resolve, reject) => {\r\n\r\n      resolve(200);\r\n\r\n/*      let message = {\r\n        type: 'delete', from: _this._url, to: 'domain://msg-node.' + domain + '/address-allocation',\r\n        body: {childrenResources: addresses}\r\n      };\r\n\r\n      _this._bus.postMessage(message, (reply) => {\r\n        if (reply.body.code === 200) {\r\n          resolve(reply.body.code);\r\n        } else {\r\n          reject(reply.body.desc);\r\n        }\r\n      });*/\r\n    });\r\n\r\n  }\r\n}\r\n\r\n/* harmony default export */ var allocation_AddressAllocation = (AddressAllocation_AddressAllocation);\r\n\n// CONCATENATED MODULE: ./src/registry/RegistryDataModel.js\n/**\r\n* Copyright 2016 PT Inovação e Sistemas SA\r\n* Copyright 2016 INESC-ID\r\n* Copyright 2016 QUOBIS NETWORKS SL\r\n* Copyright 2016 FRAUNHOFER-GESELLSCHAFT ZUR FOERDERUNG DER ANGEWANDTEN FORSCHUNG E.V\r\n* Copyright 2016 ORANGE SA\r\n* Copyright 2016 Deutsche Telekom AG\r\n* Copyright 2016 Apizee\r\n* Copyright 2016 TECHNISCHE UNIVERSITAT BERLIN\r\n*\r\n* Licensed under the Apache License, Version 2.0 (the \"License\");\r\n* you may not use this file except in compliance with the License.\r\n* You may obtain a copy of the License at\r\n*\r\n*   http://www.apache.org/licenses/LICENSE-2.0\r\n*\r\n* Unless required by applicable law or agreed to in writing, software\r\n* distributed under the License is distributed on an \"AS IS\" BASIS,\r\n* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n* See the License for the specific language governing permissions and\r\n* limitations under the License.\r\n**/\r\n/**\r\n*   @author: Gil Dias (gil.dias@tecnico.ulisboa.pt)\r\n*   Registry Data Model includes all Objects to be handled by the Registry functionality including\r\n*/\r\nclass RegistryDataModel {\r\n\r\n  constructor(id, url, descriptorURL, p2pRequester, startingTime, lastModified, status, stubs, stubsConfiguration) {\r\n    let _this = this;\r\n\r\n    _this._id = id;\r\n    _this._url = url;\r\n    _this._descriptorURL = descriptorURL;\r\n    _this._startingTime = startingTime;\r\n    _this._lastModified = lastModified;\r\n    _this._status = status;\r\n    _this._stubs = stubs;\r\n    _this._stubsConfiguration = stubsConfiguration;\r\n    _this._p2pRequester = p2pRequester;\r\n  }\r\n\r\n  get id() {\r\n    let _this = this;\r\n    return _this._id;\r\n  }\r\n\r\n  get url() {\r\n    let _this = this;\r\n    return _this._url;\r\n  }\r\n\r\n  get descriptorURL() {\r\n    let _this = this;\r\n    return _this._descriptorURL;\r\n  }\r\n\r\n  get p2pRequester() {\r\n    let _this = this;\r\n    return _this._p2pRequester;\r\n  }\r\n\r\n  get lastModified() {\r\n    let _this = this;\r\n    return _this._lastModified;\r\n  }\r\n\r\n}\r\n\r\n/* harmony default export */ var registry_RegistryDataModel = (RegistryDataModel);\r\n\n// CONCATENATED MODULE: ./src/registry/HypertyInstance.js\n/**\r\n* Copyright 2016 PT Inovação e Sistemas SA\r\n* Copyright 2016 INESC-ID\r\n* Copyright 2016 QUOBIS NETWORKS SL\r\n* Copyright 2016 FRAUNHOFER-GESELLSCHAFT ZUR FOERDERUNG DER ANGEWANDTEN FORSCHUNG E.V\r\n* Copyright 2016 ORANGE SA\r\n* Copyright 2016 Deutsche Telekom AG\r\n* Copyright 2016 Apizee\r\n* Copyright 2016 TECHNISCHE UNIVERSITAT BERLIN\r\n*\r\n* Licensed under the Apache License, Version 2.0 (the \"License\");\r\n* you may not use this file except in compliance with the License.\r\n* You may obtain a copy of the License at\r\n*\r\n*   http://www.apache.org/licenses/LICENSE-2.0\r\n*\r\n* Unless required by applicable law or agreed to in writing, software\r\n* distributed under the License is distributed on an \"AS IS\" BASIS,\r\n* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n* See the License for the specific language governing permissions and\r\n* limitations under the License.\r\n**/\r\n\r\n\r\n/**\r\n*   @author: Gil Dias (gil.dias@tecnico.ulisboa.pt)\r\n*   HypertyInstance Data Model used to model instances of Hyperties running in devices and servers.\r\n*/\r\nclass HypertyInstance_HypertyInstance extends registry_RegistryDataModel {\r\n\r\n  constructor(id, url, descriptorURL, descriptor, hypertyURL, user, guid, runtime, context, p2pHandler, p2pRequester, dataSchemes, resources, startingTime, lastModified) {\r\n    super(id, url, descriptorURL, p2pRequester, startingTime, lastModified);\r\n    let _this = this;\r\n    _this._descriptor = descriptor;\r\n    _this._hypertyURL = hypertyURL;\r\n    _this._user = user;\r\n    _this._guid = guid;\r\n    _this._runtime = runtime;\r\n    _this._context = context;\r\n    _this._p2pHandler = p2pHandler;\r\n    _this._dataSchemes = dataSchemes;\r\n    _this._resources = resources;\r\n  }\r\n\r\n  set user(identity) {\r\n    let _this = this;\r\n    _this.user = identity;\r\n  }\r\n\r\n  get user() {\r\n    let _this = this;\r\n    return _this._user;\r\n  }\r\n\r\n  get hypertyURL() {\r\n    let _this = this;\r\n    return _this._hypertyURL;\r\n  }\r\n\r\n  get descriptor() {\r\n    let _this = this;\r\n    return _this._descriptor;\r\n  }\r\n\r\n  get objectName() {\r\n    let _this = this;\r\n    return _this._descriptor._objectName;\r\n  }\r\n\r\n  get p2pHandler() {\r\n    let _this = this;\r\n    return _this._p2pHandler;\r\n  }\r\n\r\n  get dataSchemes() {\r\n    let _this = this;\r\n    return _this._dataSchemes;\r\n  }\r\n\r\n  get resources() {\r\n    let _this = this;\r\n    return _this._resources;\r\n  }\r\n\r\n  get runtimeURL() {\r\n    let _this = this;\r\n    return _this._runtime;\r\n  }\r\n}\r\n\r\n/* harmony default export */ var registry_HypertyInstance = (HypertyInstance_HypertyInstance);\r\n\n// CONCATENATED MODULE: ./src/registry/DomainRegistration.js\n/**\r\n* Copyright 2016 PT Inovação e Sistemas SA\r\n* Copyright 2016 INESC-ID\r\n* Copyright 2016 QUOBIS NETWORKS SL\r\n* Copyright 2016 FRAUNHOFER-GESELLSCHAFT ZUR FOERDERUNG DER ANGEWANDTEN FORSCHUNG E.V\r\n* Copyright 2016 ORANGE SA\r\n* Copyright 2016 Deutsche Telekom AG\r\n* Copyright 2016 Apizee\r\n* Copyright 2016 TECHNISCHE UNIVERSITAT BERLIN\r\n*\r\n* Licensed under the Apache License, Version 2.0 (the \"License\");\r\n* you may not use this file except in compliance with the License.\r\n* You may obtain a copy of the License at\r\n*\r\n*   http://www.apache.org/licenses/LICENSE-2.0\r\n*\r\n* Unless required by applicable law or agreed to in writing, software\r\n* distributed under the License is distributed on an \"AS IS\" BASIS,\r\n* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n* See the License for the specific language governing permissions and\r\n* limitations under the License.\r\n**/\r\n\r\n// Log System\r\n\r\nlet DomainRegistration_log = loglevel[\"getLogger\"]('Registry');\r\n\r\n\r\n\r\n\r\n\r\n\r\n/**\r\n* Runtime DomainRegistration Interface\r\n*/\r\nclass DomainRegistration_DomainRegistration {\r\n\r\n  /**\r\n  * To initialise the Runtime Registry with the RuntimeURL that will be the basis to derive the internal runtime addresses when allocating addresses to internal runtime component. In addition, the Registry domain back-end to be used to remotely register Runtime components, is also passed as input parameter.\r\n  * @param  {MessageBus}          messageBus                msgbus\r\n  * @param  {HypertyRuntimeURL}   runtimeURL            runtimeURL\r\n  * @param  {DomainURL}           domain        remoteRegistry\r\n  */\r\n  constructor(runtimeURL, registryURL, domain, messageBus) {\r\n\r\n    if (!runtimeURL) throw new Error('runtimeURL is missing.');\r\n    if (!registryURL) throw new Error('registryURL is missing.');\r\n    if (!domain) throw new Error('domain is missing.');\r\n    if (!messageBus) throw new Error('messageBus is missing.');\r\n\r\n    let _this = this;\r\n\r\n    _this.registryURL = registryURL;\r\n    _this.runtimeURL = runtimeURL;\r\n    _this._registrationRetries = 5;// number of attempts to register Hyperties and DataObjects when errors occurs\r\n\r\n    // the expires in 3600, represents 1 hour\r\n    //the expires is in seconds, unit of measure received by the domain registry\r\n    _this.expiresTime = 3600;\r\n\r\n    _this._domain = domain;\r\n    _this._messageBus = messageBus;\r\n  }\r\n\r\n\r\n  /**\r\n  *  function to unregister an hypertyInstance in the Domain Registry\r\n  *  @param   {String}      hypertyInstance   HypertyInsntance url\r\n  *\r\n  */\r\n  unregisterHyperty(hypertyInstance) {\r\n    let _this = this;\r\n\r\n      let message = { type: 'update', from: _this.registryURL,\r\n        to: 'domain://registry.' + _this._domain,\r\n        body: { resource: '/hyperty/' + hypertyInstance, value: 'disconnected', attribute: 'status' }};\r\n\r\n      _this._messageBus.postMessage(message, (reply) => {\r\n        DomainRegistration_log.log('[DomainRegistration] unregister hyperty Reply', reply);\r\n\r\n    });\r\n  }\r\n\r\n  /**\r\n  *  function to unregister a Data Object in the Domain Registry\r\n  *  @param   {String}      hypertyInstance   HypertyInsntance url\r\n  *\r\n  */\r\n  unregisterDataObject(url) {\r\n    let _this = this;\r\n\r\n    let message = { type: 'update', from: _this.registryURL,\r\n      to: 'domain://registry.' + _this._domain,\r\n      body: {\r\n        resource: url,\r\n        value: {\r\n          status: 'disconnected'\r\n        }\r\n      }};\r\n\r\n    _this._messageBus.postMessage(message, (reply) => {\r\n      DomainRegistration_log.log('[DomainRegistration] unregister dataObject Reply', reply);\r\n    });\r\n  }\r\n\r\n  /**\r\n  *  function to delete an dataObjectInstance in the Domain Registry\r\n  *  @param   {String}    name      DataObjectName\r\n  */\r\n  deleteDataObjectInstance(name) {\r\n    let _this = this;\r\n\r\n    let message = { type: 'delete', from: _this.registryURL,\r\n      to: 'domain://registry.' + _this._domain,\r\n      body: { value: {name: name}}};\r\n\r\n    _this._messageBus.postMessage(message, (reply) => {\r\n      DomainRegistration_log.log('[DomainRegistration] unregister dataObject Reply', reply);\r\n    });\r\n  }\r\n\r\n  /**\r\n  * Function to update an Hyperty\r\n  */\r\n  updateHypertyInstance(resource, value) {\r\n    let _this = this;\r\n\r\n    let message = { type: 'UPDATE', from: _this.registryURL,\r\n      to: 'domain://registry.' + _this._domain,\r\n      body: { resource: resource, value: value}};\r\n\r\n    _this._messageBus.post.postMessage(message, (reply) => {\r\n      // log.log('[Registry] Updated hyperty reply', reply);\r\n    });\r\n  }\r\n\r\n\r\n  /**\r\n  * To register a new Data Object in the Domain Registry.\r\n  * @param  {JSON}     registration                   registration data to be used\r\n  * @param  {boolean}     resume                     if this is just to update the registration with the resume of a data object\r\n  */\r\n\r\n  registerDataObject(registration, resume, p2pHandlerStub) {\r\n\r\n    let _this = this;\r\n\r\n    let p2pHandler;\r\n    let p2pRequester;\r\n\r\n    return new Promise(function(resolve, reject) {\r\n\r\n      let dataScheme = [];\r\n      let filteredDataScheme = registration.url.split(':');\r\n      dataScheme.push(filteredDataScheme[0]);\r\n\r\n      if (Object.keys(p2pHandlerStub).length !== 0) {\r\n      p2pHandler = p2pHandlerStub[_this.runtimeURL].url;\r\n      p2pRequester = runtimeUtils.runtimeDescriptor.p2pRequesterStub;\r\n    }\r\n\r\n    registration.startingTime = registration.created;\r\n\r\n    delete registration.authorise;\r\n    delete registration.created;\r\n    delete registration.mutual;\r\n    delete registration.resume;\r\n\r\n    if (!registration.expires) registration.expires = _this.expiresTime;\r\n\r\n    registration.dataSchemes = dataScheme;\r\n\r\n    if (p2pHandler) {\r\n      registration.p2pHandler = p2pHandler;\r\n      registration.p2pRequester = p2pRequester;\r\n    }\r\n\r\n    registration.status = 'live';\r\n\r\n    let message;\r\n\r\n    if (!resume) {\r\n\r\n      DomainRegistration_log.log('[Registry.registerDataObject] registering new data object URL', registration);\r\n\r\n      message = { type: 'create', from: _this.registryURL, to: 'domain://registry.' + _this._domain, body: { value: registration, policy: 'policy' } };\r\n\r\n    } else {\r\n\r\n      DomainRegistration_log.log('[Registry.registerDataObject] registering previously registered data object URL', registration);\r\n\r\n      message = {\r\n        type: 'update',\r\n        to: 'domain://registry.' + _this._domain,\r\n        from: _this.registryURL,\r\n        body: { resource: registration.url, value: { status: 'live' } }\r\n      };\r\n\r\n    }\r\n\r\n    try {\r\n      _this._messageBus.postMessageWithRetries(message, _this._registrationRetries, (reply) => {\r\n        // log.log('[Registry.registerDataObject] ===> registerDataObject Reply: ', reply);\r\n        if (reply.body.code === 200) {\r\n          resolve(registration);\r\n        } else {\r\n          reject('error on register DataObject');\r\n        }\r\n      });\r\n    } catch (e) {\r\n      DomainRegistration_log.error(e);\r\n      reject(e);\r\n    }\r\n\r\n\r\n    //timer to keep the registration alive\r\n    // the time is defined by a little less than half of the expires time defined\r\n    let keepAliveTimer = setInterval(function () {\r\n\r\n      let message = {\r\n        type: 'update',\r\n        from: _this.registryURL,\r\n        to: 'domain://registry.' + _this._domain,\r\n        body: { resource: registration.url, value: { status: 'live' }, method: 'refresh' }\r\n      };\r\n\r\n      _this._messageBus.postMessage(message, (reply) => {\r\n        // log.log('[Registry.registerDataObject] KeepAlive Reply: ', reply);\r\n      });\r\n    }, (((registration.expires / 1.1) / 2) * 1000));\r\n\r\n  });\r\n\r\n\r\n  }\r\n\r\n\r\n\r\n\r\n  /**\r\n  * To register a new Hyperty in the Domain Registry.\r\n  * @param  {HypertyInstance}     hyperty            Hyperty to be registered\r\n  * @param  {boolean}     resume                     if this is just to update the registration with the resume of a data object\r\n  */\r\n\r\n\r\n  registerHyperty(hyperty, resume){\r\n\r\n    let _this = this;\r\n\r\n    return new Promise(function(resolve, reject) {\r\n\r\n    let runtime = _this.runtimeURL;\r\n    let status = 'live';\r\n\r\n    //message to register the new hyperty, within the domain registry\r\n    let message;\r\n    let registrationExpires = _this.expiresTime;\r\n\r\n    let messageValue = {\r\n      user: hyperty.user.email,\r\n      descriptor: hyperty.descriptorURL,\r\n      url: hyperty.hypertyURL,\r\n      expires: registrationExpires,\r\n      resources: hyperty.resources,\r\n      dataSchemes: hyperty.dataSchemes,\r\n      runtime: runtime,\r\n      status: status\r\n    };\r\n\r\n    // set a different expires if defined in the hyperty configuration\r\n\r\n    if (hyperty.p2pHandler) {\r\n      messageValue.p2pHandler = hyperty.p2pHandler;\r\n      messageValue.p2pRequester = hyperty.p2pRequester;\r\n    }\r\n\r\n    // set a different expires value if configured in the Hyperty descriptor\r\n\r\n    if (hyperty.descriptor.configuration && hyperty.descriptor.configuration.expires) registrationExpires = hyperty.descriptor.configuration.expires;\r\n\r\n    if (!resume) {\r\n      // log.log('[Registry registerHyperty] registering new Hyperty URL', addressURL.address[0]);\r\n\r\n\r\n      // set a different expires if defined in the hyperty configuration\r\n\r\n\r\n      // log.log('[Registry registerHyperty] registering new Hyperty at domain registry ', messageValue);\r\n\r\n      message = {type: 'create', from: _this.registryURL, to: 'domain://registry.' + _this._domain, body: {value: messageValue, policy: 'policy'}};\r\n\r\n    } else {\r\n      // log.log('[Registry registerHyperty] registering previously registered Hyperty URL', addressURL.address[0]);\r\n\r\n      message = {\r\n        type: 'update',\r\n        to: 'domain://registry.' + _this._domain,\r\n        from: _this.registryURL,\r\n        body: {resource: hyperty.hypertyURL, value: { status: 'live', user: hyperty.user.email }}\r\n      };\r\n\r\n      if (hyperty.p2pHandler) {\r\n        message.body.value.p2pHandler = hyperty.p2pHandler;\r\n        message.body.value.p2pRequester = hyperty.p2pRequester;\r\n      }\r\n    }\r\n\r\n    // log.log('[Registry registerHyperty] Hyperty registration at domain registry  - ', message);\r\n\r\n      try {\r\n        _this._messageBus.postMessageWithRetries(message, _this._registrationRetries, (reply) => {\r\n          // log.log('[Registry registerHyperty] Hyperty registration response: ', reply);\r\n\r\n          if (reply.body.code === 200) {\r\n            let result = { url: hyperty.hypertyURL};\r\n            if (hyperty.p2pHandler) {\r\n              result.p2pHandler = hyperty.p2pHandler;\r\n              result.p2pRequester = hyperty.p2pRequester;\r\n            }\r\n\r\n\r\n\r\n            resolve(result);\r\n          } else if (reply.body.code === 404) {\r\n            // log.log('[Registry registerHyperty] The update was not possible. Registering new Hyperty at domain registry');\r\n\r\n            message = {type: 'create', from: _this.registryURL, to: 'domain://registry.' + _this._domain, body: {value: messageValue, policy: 'policy'}};\r\n\r\n            try {\r\n              _this._messageBus.postMessageWithRetries(message, _this._registrationRetries, (reply) =>{\r\n                // log.log('[Registry registerHyperty] Hyperty registration update response: ', reply);\r\n\r\n                if (reply.body.code === 200) {\r\n                  let result = { url: hyperty.hypertyURL};\r\n                  if (hyperty.p2pHandler) {\r\n                    result.p2pHandler = hyperty.p2pHandler;\r\n                    result.p2pRequester = hyperty.p2pRequester;\r\n                  }\r\n        \r\n                  resolve(result);\r\n\r\n                } else {\r\n                  throw new Error('Failed to register an Hyperty: ' + reply);\r\n                }\r\n\r\n              });\r\n            } catch (e) {\r\n              DomainRegistration_log.error(e);\r\n              reject(e);\r\n            }\r\n          } else {\r\n            throw new Error('Failed to register an Hyperty to domain: ', reply);\r\n          }\r\n\r\n        });\r\n\r\n      } catch (e) {\r\n        DomainRegistration_log.error(e);\r\n        reject(e);\r\n      }\r\n\r\n      //timer to keep the registration alive\r\n      // the time is defined by a little less than half of the expires time defined\r\n      let keepAliveTimer = setInterval(function() {\r\n\r\n        let message = {\r\n          type: 'update',\r\n          from: _this.registryURL,\r\n          to: 'domain://registry.' + _this._domain,\r\n          body: { resource: hyperty.hypertyURL, value: {status: 'live'}, method: 'refresh' }};\r\n\r\n        _this._messageBus.postMessage(message, (reply) => {\r\n          // log.log('[Registry registerHyperty] KeepAlive Reply: ', reply);\r\n        });\r\n      }, (((registrationExpires / 1.1) / 2) * 1000));\r\n    });\r\n\r\n  }\r\n\r\n}\r\n\r\n/* harmony default export */ var registry_DomainRegistration = (DomainRegistration_DomainRegistration);\r\n\n// CONCATENATED MODULE: ./src/registry/P2PConnectionResolve.js\n/**\r\n* Copyright 2016 PT Inovação e Sistemas SA\r\n* Copyright 2016 INESC-ID\r\n* Copyright 2016 QUOBIS NETWORKS SL\r\n* Copyright 2016 FRAUNHOFER-GESELLSCHAFT ZUR FOERDERUNG DER ANGEWANDTEN FORSCHUNG E.V\r\n* Copyright 2016 ORANGE SA\r\n* Copyright 2016 Deutsche Telekom AG\r\n* Copyright 2016 Apizee\r\n* Copyright 2016 TECHNISCHE UNIVERSITAT BERLIN\r\n*\r\n* Licensed under the Apache License, Version 2.0 (the \"License\");\r\n* you may not use this file except in compliance with the License.\r\n* You may obtain a copy of the License at\r\n*\r\n*   http://www.apache.org/licenses/LICENSE-2.0\r\n*\r\n* Unless required by applicable law or agreed to in writing, software\r\n* distributed under the License is distributed on an \"AS IS\" BASIS,\r\n* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n* See the License for the specific language governing permissions and\r\n* limitations under the License.\r\n**/\r\n\r\n// Log System\r\n\r\nlet P2PConnectionResolve_log = loglevel[\"getLogger\"]('P2PConnectionResolve');\r\n\r\n/**\r\n*   To process address resolution for p2p connections\r\n*/\r\nclass P2PConnectionResolve  {\r\n\r\n  constructor(registry) {\r\n    let _this = this;\r\n    _this._registry = registry;\r\n    _this._remoteP2PEntities = {}; // All remote entities and associated runtime url that are reachable with existing p2p connections\r\n\r\n  }\r\n\r\n\r\n  /**\r\n  * Verifies if remote Entity can be reached with a P2P Connection.\r\n  * @param  {URL.URL}        info           object URL\r\n  * @return {HypertyDataObjectInstance}  addressURL     return the Data Object instance registered URL, return undefined otherwise\r\n  */\r\n\r\n  checkP2P(msg) {\r\n\r\n    if (!msg.hasOwnProperty('to')) {\r\n      // throw Error('The p2p verification was failed');\r\n      return Promise.reject('The p2p verification was failed');\r\n    }\r\n\r\n    let scheme = msg.to.split('://')[0];\r\n\r\n    let comp = msg.to.split('://')[1].split('/')[2];\r\n\r\n    let url;\r\n\r\n    if (comp) url = msg.to.substring(0, msg.to.indexOf('/' + comp));\r\n    else url = msg.to;\r\n\r\n    let p2p = {};\r\n\r\n    if (msg.body && msg.body.p2p) p2p.p2p = msg.body.p2p;\r\n\r\n    if (msg.body && msg.body.p2pHandler && msg.body.p2pRequester) {\r\n      p2p.p2pHandler = msg.body.p2pHandler;\r\n      p2p.p2pRequester = msg.body.p2pRequester;\r\n      p2p.runtime = msg.body.p2pHandler.split('/p2phandler/')[0];\r\n    }\r\n\r\n    switch (scheme) {\r\n      case 'runtime':\r\n        return this.checkP2PRuntime(url, p2p);\r\n        break;\r\n      default:\r\n        return this.checkP2PEntity(url, p2p);\r\n        break;\r\n\r\n    }\r\n  }\r\n\r\n  /**\r\n  * Verifies if remote Entity (Hyperty or Data Object) can be reached with a P2P Connection.\r\n  * @param  {string}        url           Remote Entity URL to be checked\r\n  * @param  {object}        p2p           p2p information to be used including ´runtime´ with remote Runtime URL, 'p2pHandler' remote P2P Handler Stub URL and p2pRequester with Catalogue URL of P2P Requester to be used\r\n  * @return {promise} registeredEntity     if p2p connection is possible it returns p2p information to be used in the connection, otherwise the promise is rejected\r\n  */\r\n\r\n  checkP2PEntity(url, p2p) {\r\n    let _this = this;\r\n\r\n    return new Promise((resolve, reject) => {\r\n      let remoteEntity = _this._remoteP2PEntities[url];\r\n\r\n      if (remoteEntity) resolve(remoteEntity);\r\n      else if (p2p.runtime) resolve(p2p); // use provided p2p if available in the message body\r\n      else if (p2p.p2p) { // otherwise look on Domain Registry\r\n\r\n        P2PConnectionResolve_log.log('[Registry - checkP2PEntity] - search in Domain Registry: ', url);\r\n\r\n        let message = {\r\n          type: 'read',\r\n          from: _this._registry.registryURL,\r\n          to: 'domain://registry.' + _this._registry._domain,\r\n          body: {\r\n            resource: url\r\n          }\r\n        };\r\n\r\n        _this._registry._messageBus.postMessage(message, (reply) => {\r\n          P2PConnectionResolve_log.log('[Registry - checkP2PEntity] Domain Registry reply', reply);\r\n          if ('value' in reply.body) {\r\n\r\n            //todo: store retrieved entity\r\n            let resolvedEntity = reply.body.value;\r\n\r\n            if (resolvedEntity.hasOwnProperty('p2pHandler')) {\r\n              resolve(resolvedEntity);\r\n            } else {\r\n              reject('[Registry checkP2PEntity] Hyperty found does not support P2P', reply.body.value);\r\n            }\r\n\r\n          } else {\r\n            reject('[Registry checkP2PEntity] Hyperty with P2PHandler not found', reply.body.code);\r\n          }\r\n        });\r\n      } else reject('[Registry checkP2PEntity] No P2P Connection available for ', url);\r\n    });\r\n  }\r\n\r\n  /**\r\n  * Verifies if remote Runtime can be reached with a P2P Connection.\r\n  * @param  {URL.URL}        runtimeURL           Runtime URL\r\n  * @return {Object}  p2pConnection    return the P2PConnection instance registered URL, return undefined otherwise\r\n  */\r\n\r\n  checkP2PRuntime(runtimeURL, p2p) {\r\n    let _this = this;\r\n\r\n    let registeredRuntime = {};\r\n\r\n    // look on locally stored p2p connections\r\n    return new Promise((resolve, reject) => {\r\n      if (_this._registry.p2pConnectionList[runtimeURL]) {\r\n        resolve({runtime: runtimeURL});\r\n      } else if ( p2p.runtime) {\r\n        registeredRuntime = p2p;\r\n        resolve(registeredRuntime);\r\n      } else reject('[Registry.P2PConnectionResolve.checkP2PRuntime] No P2P Connection found to ', runtimeURL);\r\n\r\n    });\r\n\r\n  }\r\n\r\n  /**\r\n  * Verifies if remote Hyperty can be reached with a P2P Connection.\r\n  * @param  {JSON}        info           object or entity charateristics info\r\n  * @return {addressURL}  addressURL     return the URL if there is any previousy registered URL, return undefined otherwise\r\n  */\r\n\r\n  checkP2PHyperty(hypertyURL, p2p) {\r\n    let _this = this;\r\n\r\n    return new Promise((resolve, reject) => {\r\n      let hyperty;\r\n\r\n\r\n      // look on locally stored hyperties\r\n\r\n      for (let i in _this._registry.remoteHypertyList) {\r\n        hyperty = _this._registry.remoteHypertyList[i];\r\n\r\n        P2PConnectionResolve_log.log('[Registry - checkP2PHyperty] - for each Hyperty: ', hyperty);\r\n\r\n        // todo: change to \"hyperty.url\" to be aligned with hyperty instance data model spec\r\n\r\n        if (hyperty.hypertyID === hypertyURL) {\r\n\r\n          if (hyperty.hasOwnProperty('p2pHandler')) {\r\n            resolve(hyperty);\r\n          } else {\r\n            reject('[Registry checkP2PHyperty] Hyperty found does not support P2P', hyperty);\r\n          }\r\n          return;\r\n        }\r\n      }\r\n\r\n      if (!hyperty && p2p.runtime) resolve(p2p); // use provided p2p if available in the message body\r\n      else if (!hyperty && p2p.p2p) { // otherwise look on Domain Registry\r\n\r\n        P2PConnectionResolve_log.log('[Registry - checkP2PHyperty] - search in Domain Registry: ', hyperty);\r\n\r\n        let message = {\r\n          type: 'read',\r\n          from: _this._registry.registryURL,\r\n          to: 'domain://registry.' + _this._registry._domain,\r\n          body: {\r\n            resource: hypertyURL\r\n          }\r\n        };\r\n\r\n        _this._registry._messageBus.postMessage(message, (reply) => {\r\n          P2PConnectionResolve_log.log('[Registry - checkP2PHyperty] Domain Registry reply', reply);\r\n          if ('value' in reply.body) {\r\n\r\n            //todo: store retrieved hyperty\r\n            let resolvedHyperty = reply.body.value;\r\n\r\n            _this._registry.remoteHypertyList.push(resolvedHyperty);\r\n\r\n            if (resolvedHyperty.hasOwnProperty('p2pHandler')) {\r\n              resolve(resolvedHyperty);\r\n            } else {\r\n              reject('[Registry checkP2PHyperty] Hyperty found does not support P2P', reply.body.value);\r\n            }\r\n\r\n          } else {\r\n            reject('[Registry checkP2PHyperty] Hyperty with P2PHandler not found', reply.body.code);\r\n          }\r\n        });\r\n      } else reject('[Registry checkP2PHyperty] No P2P Connection available for ', hypertyURL);\r\n    });\r\n  }\r\n\r\n  /**\r\n  * Verifies if remote Data Object can be reached with a P2P Connection.\r\n  * @param  {URL.URL}        DataObjectURL           object URL\r\n  * @return {HypertyDataObjectInstance}  addressURL     return the Data Object instance registered URL, return undefined otherwise\r\n  */\r\n\r\n  checkP2PDataObject(url, p2p) {\r\n    let _this = this;\r\n\r\n    return new Promise((resolve, reject) => {\r\n\r\n      // look on locally stored Remote Data Objects\r\n\r\n      let dataobject = _this._registry.remoteDataObjectList.filter((i) => {\r\n        return (_this._registry.remoteDataObjectList[i].url === url);\r\n      });\r\n\r\n      if (dataobject.length !== 0 && dataobject[0].p2pRequester) {\r\n        resolve(dataobject[0]);\r\n      } else if (dataobject.length !== 0) {\r\n        reject('[Registry checkP2PDataObject] Data Object found does not support P2P', dataobject[0]);\r\n      } else if (dataobject.length === 0 && p2p.runtime) resolve(p2p); // use provided p2p info if available in the message body\r\n      else if (dataobject.length && p2p.p2p) { // otherwise look on Domain Registry\r\n\r\n      // look on Domain Registry\r\n\r\n        let message = {\r\n          type: 'read',\r\n          from: _this._registry.registryURL,\r\n          to: 'domain://registry.' + _this._registry._domain,\r\n          body: {\r\n            resource: url\r\n          }\r\n        };\r\n\r\n        _this._registry._messageBus.postMessage(message, (reply) => {\r\n          P2PConnectionResolve_log.log('discover data object per url reply', reply);\r\n          if ('value' in reply.body) {\r\n\r\n            //todo: store retrieved hyperty\r\n            let resolvedDataObject = reply.body.value;\r\n\r\n            _this._registry.remoteDataObjectList.push(resolvedDataObject);\r\n\r\n            if (resolvedDataObject.p2pRequester) {\r\n              resolve(resolvedDataObject);\r\n            } else {\r\n              reject('[Registry checkP2PDataObject] Data Object found does not support P2P', reply.body.value);\r\n            }\r\n\r\n          } else {\r\n            reject('[Registry checkP2PDataObject] not found', reply.body.code);\r\n          }\r\n        });\r\n      } else reject('[Registry checkP2PDataObject] no P2P Connection found');\r\n    });\r\n  }\r\n\r\n  addRemoteP2PEntity(url, runtime) {\r\n    this._remoteP2PEntities[url] = runtime;\r\n  }\r\n\r\n  removeRemoteP2PEntity(url) {\r\n    delete this._remoteP2PEntities[url];\r\n  }\r\n\r\n  reconnectP2PRequester(p2pRequester) {\r\n    let _this = this;\r\n\r\n    P2PConnectionResolve_log.log('[P2PConenctionResolve.reconnectP2PRequester] lets try to reconnect P2P Requester Stub: ', p2pRequester);\r\n\r\n    return new Promise((resolve, reject) => {\r\n\r\n      let remoteRuntime = p2pRequester.runtime;\r\n\r\n      let message = {\r\n        type: 'execute',\r\n        from: _this._registry.registryURL,\r\n        to: p2pRequester.url,\r\n        body: {\r\n          method: 'connect',\r\n          params: [p2pRequester.p2pHandler]\r\n        }\r\n      };\r\n\r\n      // lets prepare the p2pRequesterSTub reconnect by setting an observer to its status changes\r\n\r\n      _this._registry.watchingYou.observe('p2pRequesterStub', (change) => {\r\n\r\n        P2PConnectionResolve_log.log('[P2PConenctionResolve.reconnectP2PRequester] p2pRequesterStubs changed ' + _this._registry.p2pRequesterStub);\r\n\r\n        if (change.keypath.split('.')[0] === remoteRuntime && change.name === 'status') {\r\n          switch (change.newValue) {\r\n            case 'live':\r\n              P2PConnectionResolve_log.log('[P2PConenctionResolve.reconnectP2PRequester] p2pRequester is live ' + _this._registry.p2pRequesterStub[remoteRuntime]);\r\n              resolve(_this._registry.p2pRequesterStub[remoteRuntime].url);\r\n              break;\r\n            case 'failed':\r\n              P2PConnectionResolve_log.log('[P2PConenctionResolve.reconnectP2PRequester] p2pRequester reconnect failed ' + _this._registry.p2pRequesterStub[remoteRuntime]);\r\n              reject('P2P Requester reconnect failed');\r\n              break;\r\n            default:\r\n          }\r\n        }\r\n      });\r\n\r\n      //  stub load\r\n      _this._registry._messageBus.postMessage(message, (reply) => {\r\n        P2PConnectionResolve_log.log('[P2PConenctionResolve.reconnectP2PRequester] reconnect request reply', reply);\r\n      });\r\n    });\r\n  }\r\n\r\n}\r\n\r\n/* harmony default export */ var registry_P2PConnectionResolve = (P2PConnectionResolve);\r\n\n// CONCATENATED MODULE: ./src/utils/WatchingYou.js\n\r\n\r\nclass WatchingYou {\r\n\r\n  constructor() {\r\n    this._watching = {};\r\n    this._observers = [];\r\n  }\r\n\r\n  watch(key, object, deep = false) {\r\n    if (deep) {\r\n      this._watching[key] = Object.deepObserve(object, (changes) => {\r\n        changes.every((change) => {\r\n          this._fireEvent(key, change);\r\n        });\r\n      });\r\n    } else {\r\n      this._watching[key] = Object.observe(object, (changes) => {\r\n        changes.every((change) => {\r\n          this._fireEvent(key, change);\r\n        });\r\n      });\r\n    }\r\n    return this._watching[key];\r\n  }\r\n\r\n  observe(key, callback) {\r\n    this._observers.push({key: key, callback: callback});\r\n  }\r\n\r\n  _fireEvent(key, change) {\r\n\r\n    this._observers.filter((observe) => {\r\n      return observe.key === key;\r\n    }).forEach((observe) => {\r\n      observe.callback(change);\r\n    });\r\n\r\n  }\r\n\r\n}\r\n\r\n/* harmony default export */ var utils_WatchingYou = (WatchingYou);\r\n\r\n/*let watchChanges = new WatchChanges();\r\nlet p2pRequesterStub = watchChanges.watch('p2p', {}, true);\r\nlet stub = watchChanges.watch('stub', {});\r\n\r\nwatchChanges.observe('p2p', (change) => {\r\n  console.log('p2pRequesterStub: ' + change.name + ' - ' + JSON.stringify(change.newValue));\r\n});\r\n\r\nwatchChanges.observe('p2p', (change) => {\r\n  console.log('p2pRequesterStub: ' + change.name + ' - ' + JSON.stringify(change.newValue));\r\n});\r\n\r\nwatchChanges.observe('stub', (change) => {\r\n  console.log('stub ' + change.name);\r\n});\r\n\r\np2pRequesterStub.a = {};\r\nstub.b = {name: 'vitor'};\r\np2pRequesterStub.a.name = 'Hello';\r\nstub.b = {name: 'vitor'};\r\np2pRequesterStub.a.age = '32';\r\np2pRequesterStub.a.name = 'World';*/\r\n\n// CONCATENATED MODULE: ./src/Utils.js\n\r\n\r\n\r\n\n// CONCATENATED MODULE: ./src/registry/Registry.js\n/**\r\n* Copyright 2016 PT Inovação e Sistemas SA\r\n* Copyright 2016 INESC-ID\r\n* Copyright 2016 QUOBIS NETWORKS SL\r\n* Copyright 2016 FRAUNHOFER-GESELLSCHAFT ZUR FOERDERUNG DER ANGEWANDTEN FORSCHUNG E.V\r\n* Copyright 2016 ORANGE SA\r\n* Copyright 2016 Deutsche Telekom AG\r\n* Copyright 2016 Apizee\r\n* Copyright 2016 TECHNISCHE UNIVERSITAT BERLIN\r\n*\r\n* Licensed under the Apache License, Version 2.0 (the \"License\");\r\n* you may not use this file except in compliance with the License.\r\n* You may obtain a copy of the License at\r\n*\r\n*   http://www.apache.org/licenses/LICENSE-2.0\r\n*\r\n* Unless required by applicable law or agreed to in writing, software\r\n* distributed under the License is distributed on an \"AS IS\" BASIS,\r\n* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n* See the License for the specific language governing permissions and\r\n* limitations under the License.\r\n**/\r\n\r\n// Log System\r\n\r\nlet Registry_log = loglevel[\"getLogger\"]('Registry');\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n// import DiscoveryServiceFramework from './DiscoveryServiceFramework';\r\n\r\nconst STATUS = { CREATED: 'created', LIVE: 'live', DEPLOYING: 'deploying', DEPLOYED: 'deployed', PROGRESS: 'in-progress', DISCONNECTED: 'disconnected', FAILED: 'deployment-failed', DEAD: 'dead' };\r\n\r\n/*import IdentityManager from './IdentityManager';\r\nimport Discovery from './Discovery';*/\r\n\r\n/**\r\n* Runtime Registry Interface\r\n*/\r\nclass Registry_Registry {\r\n\r\n  /**\r\n  * To initialise the Runtime Registry with the RuntimeURL that will be the basis to derive the internal runtime addresses when allocating addresses to internal runtime component. In addition, the Registry domain back-end to be used to remotely register Runtime components, is also passed as input parameter.\r\n  * @param  {MessageBus}          msgbus                msgbus\r\n  * @param  {HypertyRuntimeURL}   runtimeURL            runtimeURL\r\n  * @param  {AppSandbox}          appSandbox            appSandbox\r\n  * @param  {runtimeCatalogue}    runtimeCatalogue      runtimeCatalogue\r\n  * @param  {DomainURL}           remoteRegistry        remoteRegistry\r\n  * @param  {storageManager}      storageManager\r\n  */\r\n  constructor(runtimeURL, appSandbox, identityModule, runtimeCatalogue, runtimeCapabilities, storageManager, p2pHandlerURL, remoteRegistry) {\r\n\r\n    // how some functions receive the parameters for example:\r\n    // new Registry('hyperty-runtime://sp1/123', appSandbox, idModule, remoteRegistry);\r\n    // registry.registerStub(sandbox, 'sp1');\r\n    // registry.registerHyperty(sandBox, 'hyperty-runtime://sp1/123');\r\n    // registry.resolve('hyperty-runtime://sp1/123');\r\n\r\n    if (!runtimeURL) throw new Error('runtimeURL is missing.');\r\n    if (!storageManager) throw new Error('storageManager is missing.');\r\n\r\n    /*if (!remoteRegistry) throw new Error('remoteRegistry is missing');*/\r\n\r\n    let _this = this;\r\n\r\n    _this.registryURL = runtimeURL + '/registry/';\r\n    _this.appSandbox = appSandbox;\r\n    _this.runtimeURL = runtimeURL;\r\n    _this.p2pHandlerURL = p2pHandlerURL;\r\n    _this.runtimeCatalogue = runtimeCatalogue;\r\n    _this.remoteRegistry = remoteRegistry;\r\n    _this.idModule = identityModule;\r\n    _this.storageManager = storageManager;\r\n    _this.runtimeCapabilities = runtimeCapabilities;\r\n    _this.identifier = generateGUID();\r\n\r\n    _this.hypertiesListToRemove = {};\r\n    _this.hypertiesList = [];\r\n    _this.remoteHypertyList = [];\r\n    _this.remoteDataObjectList = [];\r\n    _this.idpLegacyProxyList = {};\r\n\r\n    _this.watchingYou = new utils_WatchingYou();\r\n    _this.p2pHandlerStub = {};\r\n    _this.p2pRequesterStub = _this.watchingYou.watch('p2pRequesterStub', {}, true);\r\n    _this.p2pConnectionList = _this.watchingYou.watch('p2pConnectionList', {}, true);\r\n    _this.p2pHandlerAssociation = {};\r\n\r\n    _this.protostubsList = _this.watchingYou.watch('protostubsList', {}, true);\r\n    _this.idpProxyList = _this.watchingYou.watch('idpProxyList', {}, true);\r\n    _this.dataObjectList = {};\r\n    _this.subscribedDataObjectList = {};\r\n    _this.sandboxesList = {sandbox: {}, appSandbox: {} };\r\n    _this.pepList = {};\r\n    _this.registries = {};\r\n\r\n    _this._domain = divideURL(_this.registryURL).domain;\r\n    _this.sandboxesList.appSandbox[runtimeURL] = appSandbox;\r\n    let p2pConnectionResolve = new registry_P2PConnectionResolve(_this);\r\n\r\n    _this._p2pConnectionResolve = p2pConnectionResolve;\r\n\r\n    _this._hypertyUrls = {};\r\n    _this._dataObjectUrls = {};\r\n  }\r\n\r\n  loadRegistry() {\r\n\r\n    let _this = this;\r\n\r\n    return new Promise((resolve) => {\r\n      _this.storageManager.get('registry:HypertyURLs').then((urlsList) => {\r\n        if (urlsList) _this._hypertyUrls = urlsList;\r\n        _this.storageManager.get('registry:DataObjectURLs').then((urlsList) => {\r\n          if (urlsList) _this._dataObjectUrls = urlsList;\r\n          resolve();\r\n        });\r\n      });\r\n    });\r\n  }\r\n\r\n  set loader(loader) {\r\n    let _this = this;\r\n    _this._loader = loader;\r\n  }\r\n\r\n  get loader() {\r\n    let _this = this;\r\n    return _this._loader;\r\n  }\r\n\r\n  /**\r\n  * return the messageBus in this Registry\r\n  * @param {MessageBus}           messageBus\r\n  */\r\n  get messageBus() {\r\n    let _this = this;\r\n    return _this._messageBus;\r\n  }\r\n\r\n  /**\r\n  * Set the messageBus in this Registry\r\n  * @param {MessageBus}           messageBus\r\n  */\r\n  set messageBus(messageBus) {\r\n    let _this = this;\r\n    _this._messageBus = messageBus;\r\n\r\n    _this._messageBus.addListener(_this.registryURL, function(msg) {\r\n\r\n      // log.log('[Registry listener] ', msg);\r\n\r\n      let isHyperty = utils_isHypertyURL(msg.from);\r\n      let hasCriteria = msg.body.hasOwnProperty('criteria');\r\n      let isURLResource;\r\n      let isUserResource;\r\n      let isHypertyResource;\r\n\r\n      if (msg.body.hasOwnProperty('resource') && msg.body.resource !== '.') {\r\n        isURLResource = isURL(msg.body.resource);\r\n        isUserResource = isUserURL(msg.body.resource);\r\n        isHypertyResource = utils_isHypertyURL(msg.body.resource);\r\n      }\r\n      let isDelete = msg.type === 'delete';\r\n      let hasName;\r\n      let hasUser;\r\n\r\n      if (msg.body.hasOwnProperty('value')) {\r\n        hasName = msg.body.value.hasOwnProperty('name');\r\n        hasUser = msg.body.value.hasOwnProperty('user');\r\n      }\r\n\r\n      if (msg.type === 'response') {\r\n        Registry_log.error('[Register listener] skipping ', msg);\r\n        return;\r\n      }\r\n\r\n      // msg sent by identity manager library\r\n      let userUrl = _this._getIdentityAssociated(msg.body.resource, msg.body.criteria);\r\n\r\n      let reply = {id: msg.id, type: 'response', to: msg.from, from: msg.to, body: {resource: userUrl}};\r\n      reply.body.code = (userUrl) ? 200 : 404;\r\n\r\n      _this._messageBus.postMessage(reply);\r\n\r\n    });\r\n\r\n    // Install AddressAllocation\r\n    let addressAllocation = allocation_AddressAllocation.instance;\r\n    _this.addressAllocation = addressAllocation;\r\n\r\n    _this._domainRegistration = new registry_DomainRegistration(_this.runtimeURL,_this.registryURL, _this._domain, messageBus);\r\n\r\n    // log.log('[Registry - AddressAllocation] - ', addressAllocation);\r\n  }\r\n\r\n\r\n  _getIdentityAssociated(type, hypertyURL) {\r\n    let _this = this;\r\n\r\n    for (let hyperty in _this.hypertiesList) {\r\n      let value = _this.hypertiesList[hyperty];\r\n\r\n      if (value._hypertyURL === hypertyURL) {\r\n        switch (type) {\r\n          case 'username':\r\n            return value._user.username;\r\n          case 'cn':\r\n            return value._user.cn;\r\n          case 'locale':\r\n            return value._user.locale;\r\n          case 'avatar':\r\n            return value._user.avatar;\r\n          case 'userURL':\r\n            return value._user.userURL;\r\n          case '.':\r\n            return value._user;\r\n          default:\r\n            return '';\r\n        }\r\n      }\r\n    }\r\n    return '';\r\n  }\r\n\r\n  /**\r\n  * This function is used to return the sandbox instance where the Application is executing. It is assumed there is just one App per Runtime instance.\r\n  */\r\n  getAppSandbox() {\r\n    let _this = this;\r\n    return _this.appSandbox;\r\n  }\r\n\r\n  /**\r\n  * This function returns the user associated to the hyperty URL\r\n  * @param    {String}    hypertyURL      hyperty URL\r\n  * @return   {String}    userURL         user URL\r\n  */\r\n  getHypertyOwner(hypertyURL) {\r\n\r\n    let _this = this;\r\n    let userURL;\r\n\r\n    for (let index in _this.hypertiesList) {\r\n      let hyperty = _this.hypertiesList[index];\r\n\r\n      if (hyperty.hypertyURL === hypertyURL) {\r\n        return hyperty.user.userURL;\r\n      }\r\n    }\r\n    return userURL;\r\n  }\r\n\r\n  /**\r\n  * This function returns the user associated to the hyperty URL\r\n  * @param    {String}    dataObjectURL      dataObjectURL URL\r\n  * @return   {String}    userURL         user URL\r\n  */\r\n  getDataObjectReporter(dataObjectURL) {\r\n\r\n    let _this = this;\r\n    let DOurl = removePathFromURL(dataObjectURL);\r\n    for (let index in _this.dataObjectList) {\r\n      let dataObject = _this.dataObjectList[index];\r\n\r\n      if (dataObject.url === DOurl) {\r\n        return dataObject.reporter;\r\n      }\r\n    }\r\n    return null;\r\n  }\r\n\r\n  /**\r\n  * returns the hyperty Name from a given url. This url could be from a dataObject or hyperty\r\n  * @param    {String}    url      hyperty or dataObject URL\r\n  * @return   {String}    hypertyName     hyperty Name\r\n  */\r\n  getHypertyName(url) {\r\n    let _this = this;\r\n\r\n    let isHypertyURL = divideURL(url).type === 'hyperty';\r\n\r\n    //value to be returned in the end\r\n    let hypertyName;\r\n\r\n    //if is not an hyperty, check if is a dataObject and obtain his reporter\r\n    let hypertyURL = isHypertyURL ? url : _this.getReporterURLSynchonous(url);\r\n\r\n    for (let index in _this.hypertiesList) {\r\n      let hyperty = _this.hypertiesList[index];\r\n      if (hyperty.hypertyURL === hypertyURL) {\r\n        hypertyName = hyperty.objectName;\r\n        break;\r\n      }\r\n    }\r\n    return hypertyName;\r\n  }\r\n\r\n  /**\r\n  * function to return the reporterURL associated with the dataobject URL\r\n  * @param    {String}     dataObjectURL    dataObjectURL\r\n  * @return   {String}     reporterURL      reporterURL\r\n  */\r\n  getReporterURL(dataObjectURL) {\r\n    let _this = this;\r\n\r\n    return new Promise(function(resolve, reject) {\r\n\r\n      let dataObject = _this.dataObjectList[dataObjectURL];\r\n\r\n      if (dataObject) {\r\n        resolve(dataObject.reporter);\r\n      } else {\r\n        reject('No reporter was found');\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n  * function to return the reporterURL associated with the dataobject URL. no promise returned\r\n  * @param    {String}     dataObjectURL    dataObjectURL\r\n  * @return   {String}     reporterURL      reporterURL\r\n  */\r\n  getReporterURLSynchonous(dataObjectURL) {\r\n    let _this = this;\r\n\r\n    let dataObject = _this.dataObjectList[dataObjectURL];\r\n\r\n    return (dataObject) ? dataObject.reporter : undefined;\r\n  }\r\n\r\n  /**\r\n  * returns the hyperty URL that subscribed the dataObject\r\n  * @param    {String}     url            url format\r\n  * @return   {String}    Hyperty URL subscribed to the URL\r\n  */\r\n  getDataObjectSubscriberHyperty(url) {\r\n    let _this = this;\r\n\r\n    return _this.subscribedDataObjectList[url];\r\n  }\r\n\r\n  /**\r\n  * register a desired dataObject to subscribe\r\n  * @param    {String}    dataObjectURL      dataObject URL\r\n  */\r\n  registerSubscribedDataObject(dataObjectURL, hypertyURL) {\r\n    let _this = this;\r\n    if (_this.subscribedDataObjectList[dataObjectURL] === undefined) {\r\n      _this.subscribedDataObjectList[dataObjectURL] = hypertyURL;\r\n    }\r\n  }\r\n\r\n  /**\r\n  * Function to return the list of pre authorised users received in the creation of a data object\r\n  * @param    {String}            dataObjectURL    dataObjectURL\r\n  * @return   {Array<String>}     preAuth         List of pre authorised users\r\n  */\r\n  getPreAuthSubscribers(dataObjectURL) {\r\n    let _this = this;\r\n    let dataObject = _this.dataObjectList[dataObjectURL];\r\n    let preAuth = [];\r\n\r\n    if (dataObject) {\r\n      preAuth = dataObject.authorise;\r\n    }\r\n    return preAuth;\r\n  }\r\n\r\n  /**\r\n  * send requests to unregister all hyperties registered in domain registry\r\n  * @return   {Promise}     return a promise if the result of unregistration all hyperties\r\n  */\r\n  unregisterAllHyperties() {\r\n    let _this = this;\r\n\r\n    let unregisterResults = [];\r\n\r\n    return new Promise(function(resolve, reject) {\r\n\r\n      for (let index in _this.hypertiesList) {\r\n        let hyperty = _this.hypertiesList[index];\r\n        let result = _this.unregisterHypertyInstance(hyperty.hypertyURL);\r\n        unregisterResults.push(result);\r\n      }\r\n\r\n      Promise.all(unregisterResults).then(() => {\r\n\r\n        resolve('successfully unregistered all hyperties');\r\n      }, error => { reject(error); });\r\n    });\r\n  }\r\n\r\n  /**\r\n  *  function to unregister an hypertyInstance in the Domain Registry\r\n  *  @param   {String}      hypertyInstance   HypertyInsntance url\r\n  *\r\n  */\r\n  unregisterHypertyInstance(hypertyInstance) {\r\n    //TODO working but the user\r\n    let _this = this;\r\n\r\n    let closeMsg = { type: 'execute', from: _this.registryURL,\r\n      to: hypertyInstance,\r\n      body: { method: 'close' }};\r\n\r\n    // Send message to hyperty to close\r\n    _this._messageBus.postMessage(closeMsg, (reply) => {\r\n      Registry_log.log('[Registry.unregisterHypertyInstance] Close Reply', reply);\r\n\r\n      _this._domainRegistration.unregisterHyperty(hypertyInstance);\r\n\r\n    });\r\n  }\r\n\r\n  /**\r\n  *  function to unregister a Data Object in the Domain Registry\r\n  *  @param   {String}      hypertyInstance   HypertyInsntance url\r\n  *\r\n  */\r\n  unregisterDataObject(url) {\r\n    this._domainRegistration.unregisterDataObject(url);\r\n  }\r\n\r\n\r\n  /**\r\n  * register a new subscriber in the dataObject registered\r\n  * @param  {String}   dataObjectURL    dataObject URL\r\n  * @param  {String}   subscriberURL    subscriber URL\r\n  */\r\n  registerSubscriber(dataObjectURL, subscriberURL) {\r\n    let _this = this;\r\n    let dataObject = _this.dataObjectList[dataObjectURL];\r\n\r\n    if (dataObject) {\r\n\r\n      if (!dataObject.subscribers) dataObject.subscribers = [];\r\n\r\n      dataObject.subscribers.push(subscriberURL);\r\n      _this.dataObjectList[dataObjectURL] = dataObject;\r\n    }\r\n  }\r\n\r\n  /**\r\n  * get the subscribers registered within a dataObject\r\n  * @param  {String}          dataObjectURL    dataObject URL\r\n  * @param  {Array<String>}   Substribers List\r\n  */\r\n  getDataObjectSubscribers(dataObjectURL) {\r\n    let _this = this;\r\n    let dataObject = _this.dataObjectList[dataObjectURL];\r\n\r\n    if (dataObject) {\r\n      return dataObject.subscribers;\r\n    } else {\r\n      throw 'No dataObject was found';\r\n    }\r\n\r\n  }\r\n\r\n  /**\r\n  * To register a new Data Object in the runtime which returns the dataObjectURL allocated to the new Data Object.\r\n  * @param  {String}      identifier                  identifier\r\n  * @param  {String}      dataObjectschema            dataObjectschema\r\n  * @param  {String}      dataObjectUrl               dataObjectUrl\r\n  * @param {String}      dataObjectReporter           dataObjectReporter\r\n  * @param  {Array}     resources                     dataObject resources\r\n  * @param  {Array}     authorise                     list of pre authorised authorised IDs\r\n  */\r\n  //registerDataObject(identifier, dataObjectschema, dataObjectUrl, dataObjectReporter, resources, addressURL, authorise) {\r\n  registerDataObject(objectRegistration) {\r\n    let _this = this;\r\n\r\n    let registration = deepClone(objectRegistration);\r\n\r\n    return new Promise(function(resolve, reject) {\r\n\r\n\r\n      _this.dataObjectList[objectRegistration.url] = objectRegistration;\r\n\r\n//      _this.storageManager.get('registry:DataObjectURLs').then((urlsList) => {\r\n\r\n/*        if (!urlsList) {\r\n          urlsList = {};\r\n        }*/\r\n\r\n        //update the list with the new elements\r\n        _this._dataObjectUrls[objectRegistration.name + objectRegistration.schema + objectRegistration.resources + objectRegistration.reporter] = objectRegistration.url;\r\n\r\n        // step to obtain the list of all URL registered to updated with the new one.\r\n        _this.storageManager.set('registry:DataObjectURLs', 0, _this._dataObjectUrls).then(() => {\r\n\r\n          if (_this.isInterworkingProtoStub(registration.reporter)) {\r\n            registration.interworking = true;\r\n          }\r\n\r\n          let domainRegistration = true;\r\n\r\n          if (registration.hasOwnProperty(\"domain_registration\"))\r\n          domainRegistration = registration.domain_registration;\r\n\r\n          if (domainRegistration)\r\n            _this._domainRegistration.registerDataObject(registration,objectRegistration.resume, _this.p2pHandlerStub).then(( registered ) =>{ resolve(registered) });\r\n          else resolve(registration);\r\n\r\n        }).catch(function(reason) {\r\n          Registry_log.error('[Registry registerDataObject] Error: ', reason);\r\n          reject(reason);\r\n        });\r\n      });\r\n//    });\r\n  }\r\n\r\n\r\n  _getResourcesAndSchemes(descriptor) {\r\n    let _this = this;\r\n\r\n    return new Promise((resolve)=> {\r\n\r\n      let resources;\r\n\r\n      // check if the hyperty resources is a vector or a string\r\n      // TODO delete later when catalogue is fixed\r\n      if (typeof (descriptor.hypertyType) === 'string') {\r\n        resources = [];\r\n        resources.push(descriptor.hypertyType);\r\n      } else {\r\n        resources = descriptor.hypertyType;\r\n      }\r\n\r\n      let objName = descriptor.objectName;\r\n\r\n      let descriptorDataSchema = descriptor.dataObjects;\r\n      let dataSchemasArray = [];\r\n\r\n      //this will create a array with a Promise in each position\r\n      for (let index in descriptorDataSchema) {\r\n        dataSchemasArray.push(_this.runtimeCatalogue.getDataSchemaDescriptor(descriptorDataSchema[index]));\r\n      }\r\n\r\n      // as soon as the previous array is completed, this will wait for the resolve of all promises in the array\r\n      Promise.all(dataSchemasArray).then(function(dataSchemas) {\r\n\r\n        let filteredDataSchemas = [];\r\n        for (let index in dataSchemas) {\r\n          let dataSchema = dataSchemas[index];\r\n          filteredDataSchemas.push(dataSchema.sourcePackage.sourceCode.properties.scheme);\r\n        }\r\n\r\n        // log.log('[Registry] Hyperty Schemas', filteredDataSchemas);\r\n        // log.log('[Registry] Hyperty resources', resources);\r\n\r\n        resolve({resources: resources, dataSchema: filteredDataSchemas, name: objName});\r\n      });\r\n    });\r\n  }\r\n\r\n  /**\r\n  * method that returns previously registered Hyperty or DataObjects URLS, for given characteristics\r\n  * @param  {JSON}        info           object or hyperty charateristics info\r\n  * @return {addressURL}  addressURL     return the URL if there is any previousy registered URL, return undefined otherwise\r\n  */\r\n  checkRegisteredURLs(info, reuseURL) {\r\n    let _this = this;\r\n\r\n    return new Promise((resolve) => {\r\n\r\n      let objectType = (info.reporter) ? 'registry:DataObjectURLs' : 'registry:HypertyURLs';\r\n\r\n      if (typeof(reuseURL) === 'string') {\r\n        objectType = reuseURL && divideURL(reuseURL).type !== 'hyperty' ? 'registry:DataObjectURLs' : 'registry:HypertyURLs';\r\n      }\r\n      //debugger;\r\n      _this.storageManager.get(objectType).then((urlsList) => {\r\n\r\n        if (!urlsList) {\r\n          urlsList = {};\r\n        }\r\n\r\n        if (typeof(reuseURL) === 'string') {\r\n          Registry_log.info('[Registry - checkRegisteredURLs] - look for ' + reuseURL + ' on ', urlsList);\r\n\r\n          let searchResult = Object.keys(urlsList).map((key) => {\r\n            let indexOf = urlsList[key].indexOf(reuseURL);\r\n            return urlsList[key][indexOf];\r\n          });\r\n\r\n          Registry_log.info('[Registry - checkRegisteredURLs] - found ' + searchResult.length + ' results on ', searchResult);\r\n          if (searchResult.length === 1) {\r\n            return resolve(searchResult);\r\n          } else {\r\n            return resolve(undefined);\r\n          }\r\n        }\r\n\r\n        if (objectType === 'registry:HypertyURLs') {\r\n          _this._getResourcesAndSchemes(info).then((value) => {\r\n            if (urlsList[value.resources + value.dataSchema + value.name]) {\r\n              // log.log('[Registry] reusage of hyperty URL');\r\n              return resolve(urlsList[value.resources + value.dataSchema + value.name]);\r\n            } else {\r\n              // log.log('[Registry] no hyperty URL was previously registered ');\r\n              return resolve(undefined);\r\n            }\r\n          });\r\n        } else {\r\n\r\n          let characteristics = info.name + info.schema + info.resources + info.reporter;\r\n\r\n          if (urlsList[characteristics]) {\r\n            // log.log('[Registry] reusage of dataObject URL');\r\n            if (typeof(urlsList[characteristics]) === 'string') {\r\n              let arrayToResolve = [];\r\n              arrayToResolve.push(urlsList[characteristics]);\r\n              return resolve(arrayToResolve);\r\n            } else {\r\n              return resolve(urlsList[characteristics]);\r\n            }\r\n          } else {\r\n            // log.log('[Registry] no dataObject URL was previously registered');\r\n            return resolve(undefined);\r\n          }\r\n        }\r\n\r\n      });\r\n\r\n    });\r\n  }\r\n\r\n\r\n  /**\r\n  * To register a new Hyperty in the runtime which returns the HypertyURL allocated to the new Hyperty.\r\n  * @param  {Sandbox}             sandbox               sandbox\r\n  * @param  {HypertyCatalogueURL} HypertyCatalogueURL   descriptor\r\n  * @param {object} IdpConstraint - constraints to be used when selecting the identity to be associated with the Hyperty including origin, idp, and idHint.\r\n  * @return {HypertyURL}          HypertyURL\r\n  */\r\n  registerHyperty(sandbox, importPath, descriptor, addressURL, IdpConstraint) {\r\n    let _this = this;\r\n\r\n    let hypertyCapabilities;\r\n\r\n    return new Promise(function(resolve, reject) {\r\n\r\n\r\n      _this.idModule.getIdentityAssertion(IdpConstraint).then(function(result) {\r\n\r\n        let userProfile = result.userProfile;\r\n\r\n        // log.log('[Registry registerHyperty] userProfile', userProfile);\r\n\r\n        if (_this._messageBus === undefined) {\r\n          reject('[Registry registerHyperty] MessageBus is undefined');\r\n        } else {\r\n          //call check if the protostub exist: to be removed\r\n          /*  _this.resolve(domainUrl).then(function(a) {\r\n            // log.log('[Registry registerHyperty] stub to domain registry- ', a);*/\r\n\r\n//          _this.storageManager.get('registry:HypertyURLs').then((urlsList) => {\r\n\r\n        \r\n\r\n            // log.log('[Registry registerHyperty] storageManager] - ', urlsList);\r\n\r\n            _this._getResourcesAndSchemes(descriptor).then((value) => {\r\n\r\n              hypertyCapabilities = value;\r\n\r\n/*              if (!urlsList) {\r\n                urlsList = {};\r\n              }*/\r\n\r\n              _this._hypertyUrls[hypertyCapabilities.resources + hypertyCapabilities.dataSchema + hypertyCapabilities.name] = addressURL.address;\r\n              _this.storageManager.set('registry:HypertyURLs', 0, _this._hypertyUrls).then(() => {\r\n\r\n\r\n                //check whether the received sanbox e ApplicationSandbox or a normal sandbox\r\n                if (sandbox.type === 'app') {\r\n                  _this.sandboxesList.appSandbox[addressURL.address[0]] = sandbox;\r\n                } else if (sandbox.type === 'normal') {\r\n                  _this.sandboxesList.sandbox[addressURL.address[0]] = sandbox;\r\n                } else {\r\n                  reject('Wrong SandboxType');\r\n                }\r\n\r\n                let p2pHandler;\r\n                let p2pRequester;\r\n\r\n                if (Object.keys(_this.p2pHandlerStub).length !== 0) {\r\n                  p2pHandler = _this.p2pHandlerStub[_this.runtimeURL].url;\r\n                  p2pRequester = runtimeUtils.runtimeDescriptor.p2pRequesterStub;\r\n                }\r\n\r\n                let hyperty = new registry_HypertyInstance(_this.identifier, _this.registryURL, importPath, descriptor,\r\n                  addressURL.address[0], userProfile, 'guid', _this.runtimeURL, 'ctx', p2pHandler,\r\n                 p2pRequester, hypertyCapabilities.dataSchema, hypertyCapabilities.resources);\r\n\r\n                _this.hypertiesList.push(hyperty);\r\n\r\n                /*--- start here move p2p and domain registry related features to a separated function.-------..*/\r\n\r\n                let registrationAtdomain = true;\r\n\r\n                if ( descriptor.hasOwnProperty(\"configuration\") && descriptor.configuration.hasOwnProperty(\"domain_registration\")) {\r\n                  registrationAtdomain = descriptor.configuration.domain_registration;\r\n                  }\r\n\r\n                  if (registrationAtdomain) _this._domainRegistration.registerHyperty(hyperty, addressURL.newAddress).then((registered)=> {resolve(registered)});\r\n                  else resolve({ url: hyperty.hypertyURL});\r\n\r\n             /*------------------- END HERE MOVE DOMAIN REGISTRY ------------------*/\r\n              }).catch(function(reason) {\r\n                // log.log('[Registry registerHyperty] Error: ', reason);\r\n                reject(reason);\r\n              });\r\n            });\r\n//          });\r\n        }\r\n      }, function(err) {\r\n        reject('[Registry registerHyperty] ', err);\r\n      });\r\n    });\r\n  }\r\n\r\n\r\n\r\n  /**\r\n  * To unregister a previously registered Hyperty\r\n  * @param  {HypertyURL}          HypertyURL url        url\r\n  */\r\n  unregisterHyperty(url) {\r\n    let _this = this;\r\n\r\n    return new Promise(function(resolve, reject) {\r\n\r\n      let found = false;\r\n      let index = 0;\r\n\r\n      for\t(index = 0; index < _this.hypertiesList.length; index++) {\r\n        let hyperty = _this.hypertiesList[index];\r\n        if (hyperty !== undefined) {\r\n          if (hyperty.hypertyURL === url) {\r\n            found = true;\r\n            break;\r\n          }\r\n        }\r\n      }\r\n\r\n      if (found === false) {\r\n        reject('Hyperty not found');\r\n      } else {\r\n        delete _this.hypertiesList[index];\r\n        resolve('Hyperty successfully deleted');\r\n      }\r\n    });\r\n\r\n  }\r\n\r\n  /**\r\n  * To discover protocol stubs available in the runtime for a certain domain. If available, it returns the runtime url for the protocol stub that connects to the requested domain. Required by the runtime BUS to route messages to remote servers or peers (do we need something similar for Hyperties?).\r\n  * @param  {DomainURL}           DomainURL            url\r\n  * @return {RuntimeURL}           RuntimeURL\r\n  */\r\n  discoverProtostub(url) {\r\n    if (!url) throw new Error('Parameter url needed');\r\n    let _this = this;\r\n\r\n    let dividedURL = divideURL(url);\r\n    let domainURL = dividedURL.domain;\r\n\r\n    if (_this.protostubsList.hasOwnProperty(domainURL) && _this.protostubsList[domainURL].status === STATUS.LIVE) {\r\n      return (_this.protostubsList[domainURL]);\r\n    } else {\r\n\r\n      _this.protostubsList[domainURL] = {\r\n        status: STATUS.DEPLOYING\r\n      };\r\n\r\n      throw new Error('[Registry - discoverProtoStub ] Message Node Protostub Not Found. Creating one');\r\n\r\n    }\r\n\r\n  }\r\n\r\n  /**\r\n  * To discover protocol stubs available in the runtime for a certain remote runtime URL. If available, it returns the runtime url for the protocol stub that connects to the requested domain.\r\n  * Required by the runtime BUS to route messages to remote servers or peers (do we need something similar for Hyperties?).\r\n  * @param  {RuntimeURL}           RuntimeURL            url\r\n  * @return {p2pRequester}           RuntimeURL\r\n  */\r\n  discoverP2PStub(runtimeURL) {\r\n    let _this = this;\r\n\r\n    if (runtimeURL) {\r\n\r\n      if (_this.p2pRequesterStub.hasOwnProperty(runtimeURL) && _this.p2pRequesterStub[runtimeURL].status === STATUS.LIVE) {\r\n        return (_this.p2pRequesterStub[runtimeURL]);\r\n      } else {\r\n        _this.p2pRequesterStub[runtimeURL] = {\r\n          status: STATUS.CREATED\r\n        };\r\n\r\n        throw new Error('[Registry - discoverP2PStub ] P2P Requester Stub Not Found. Creating one');\r\n\r\n      }\r\n    } else {\r\n\r\n      if (_this.p2pHandlerStub.hasOwnProperty(_this.runtimeURL)) {\r\n        return (_this.p2pHandlerStub[_this.runtimeURL]);\r\n      } else {\r\n        _this.p2pHandlerStub[_this.runtimeURL] = {\r\n          status: STATUS.CREATED\r\n        };\r\n\r\n        throw new Error('[Registry - discoverP2PStub ] P2P Handler Stub Not Found.');\r\n      }\r\n\r\n    }\r\n\r\n  }\r\n\r\n  /**\r\n   * To register a new Protocol Stub in the runtime including as input parameters the function to postMessage, the DomainURL that is connected with the stub, which returns the RuntimeURL allocated to the new ProtocolStub.\r\n   * @param  {Sandbox}       Sandbox\r\n   * @param  {stubID}        Domain or hyperty runtime to register the stub\r\n   * @param  {descriptorURL}     Catalogue URL of the Protostub descriptor\r\n   * @param  {descriptor}     Protostub descriptor\r\n   * @return {RuntimeProtoStubURL}\r\n   */\r\n  registerStub(sandbox, stubID, p2pConfig, descriptorURL, descriptor) {\r\n    let _this = this;\r\n\r\n    let _stubDescriptor = descriptor;\r\n\r\n    return new Promise(function(resolve, reject) {\r\n\r\n      let runtimeProtoStubURL;\r\n\r\n      //check if messageBus is registered in registry or not\r\n      if (_this._messageBus === undefined) {\r\n        reject('MessageBus not found on registerStub');\r\n      }\r\n\r\n      Registry_log.info('[Registry - registerStub] - stubID ', stubID);\r\n\r\n      /* if (!stubID.indexOf('msg-node.')) {\r\n        stubID = stubID.substring(stubID.indexOf('.') + 1);\r\n      }*/\r\n\r\n      let P2PRequesterStub;\r\n\r\n      if (p2pConfig) {\r\n\r\n        if (p2pConfig.hasOwnProperty('isHandlerStub') && p2pConfig.isHandlerStub) {\r\n          runtimeProtoStubURL = _this.p2pHandlerURL;\r\n\r\n          _this.p2pHandlerStub[stubID] = {\r\n            url: runtimeProtoStubURL,\r\n            status: STATUS.CREATED\r\n          };\r\n\r\n          _this.p2pHandlerAssociation[_this.runtimeURL] = [];\r\n\r\n          _this.sandboxesList.sandbox[runtimeProtoStubURL] = sandbox;\r\n          Registry_log.info('[Registry - registerStub - P2PHandlerStub] - ', stubID, ' - ', runtimeProtoStubURL);\r\n          resolve(_this.p2pHandlerStub[stubID]);\r\n        } else {\r\n          P2PRequesterStub = p2pConfig.p2pRequesterStub;\r\n          runtimeProtoStubURL = 'runtime://' + divideURL(p2pConfig.remoteRuntimeURL).domain + '/p2prequester/' + generateGUID();\r\n          Registry_log.info('[Registry - registerStub - P2PRequesterStub] - ', P2PRequesterStub, ' - ', runtimeProtoStubURL);\r\n\r\n          // to be clarified what is this p2pHandlerAssociation\r\n          _this.p2pHandlerAssociation[_this.runtimeURL].push(runtimeProtoStubURL);\r\n          _this.p2pRequesterStub[stubID] = {\r\n            url: runtimeProtoStubURL,\r\n            status: STATUS.CREATED\r\n          };\r\n\r\n          _this.sandboxesList.sandbox[runtimeProtoStubURL] = sandbox;\r\n\r\n          //Setup P2P Requester path into MN\r\n\r\n          let msg = {\r\n            type: 'subscribe',\r\n            from: _this.registryURL,\r\n            to: 'domain://msg-node.' + _this._domain + '/sm',\r\n            body: {\r\n              subscribe: [runtimeProtoStubURL],\r\n              source: _this.registryURL\r\n            }\r\n          };\r\n\r\n          _this._messageBus.postMessage(msg, (reply) => {\r\n            // log.log('[Registry - register Stub] p2pRequester path setup: ', reply);\r\n          });\r\n\r\n          resolve(_this.p2pRequesterStub[stubID]);\r\n        }\r\n      } else {\r\n        console.log('[Registry - registerStub - Normal Stub] descriptor', descriptor);\r\n\r\n        if ( !typeof(descriptor) === 'string' && descriptor.hasOwnProperty('_interworking') && descriptor._interworking) {\r\n          runtimeProtoStubURL = 'runtime://' + stubID + '/protostub/' + 'scheme1';\r\n        } else {\r\n          runtimeProtoStubURL = 'runtime://' + stubID + '/protostub/' + generateGUID();\r\n        }\r\n\r\n        Registry_log.info('[Registry - registerStub - Normal Stub] - ', stubID);\r\n\r\n        // TODO: Optimize this\r\n        _this.protostubsList[stubID] = {\r\n          url: runtimeProtoStubURL,\r\n          status: STATUS.DEPLOYING\r\n        };\r\n\r\n        if (descriptorURL) {\r\n          _this.protostubsList[stubID].descriptorURL = descriptorURL;\r\n        }\r\n\r\n        if (_stubDescriptor && (_stubDescriptor.interworking)) {\r\n          _this.protostubsList[stubID].interworking = _stubDescriptor.interworking;\r\n        }\r\n\r\n        _this.sandboxesList.sandbox[runtimeProtoStubURL] = sandbox;\r\n\r\n        resolve(_this.protostubsList[stubID]);\r\n      }\r\n\r\n      // resolve(runtimeProtoStubURL);\r\n\r\n      _this._messageBus.addListener(runtimeProtoStubURL + '/status', (msg) => {\r\n        _this._onProtostubStatusEvent(msg);\r\n      });\r\n\r\n    });\r\n\r\n  }\r\n\r\n  /**\r\n  * To Process status events fired by protostubs\r\n  * @param  {Message}   message     Event Message\r\n  */\r\n\r\n  _onProtostubStatusEvent(msg) {\r\n\r\n    let _this = this;\r\n\r\n    // log.log('[Registry onProtostubStatusEvent]: ', msg);\r\n\r\n    let runtimeProtoStubURL = msg.from;\r\n\r\n    if (!msg.to.includes('/status')) {\r\n      Registry_log.error('[Registry onProtostubStatusEvent] Not Status Event: ', msg);\r\n      return;\r\n    } else {// broadcast Protostub status event to all Hyperties\r\n      let from =  msg.from;\r\n      msg.from = _this.runtimeURL;\r\n      msg.to = _this.runtimeURL+'/status';\r\n      msg.body.resource = from;\r\n      _this._messageBus.postMessage(msg);\r\n    }\r\n\r\n    // process status events from message node protostubs\r\n\r\n    if (runtimeProtoStubURL.includes('/protostub/')) {\r\n\r\n    // TODO: uncomment below when protostubs are updated with new status value \"live\"\r\n      Object.keys(_this.protostubsList).filter((key) => {\r\n        return _this.protostubsList[key].url === runtimeProtoStubURL;\r\n      }).map((key) => {\r\n        _this.protostubsList[key].status = msg.body.value;\r\n\r\n        // log.log('[Registry - onProtostubStatusEvent] - Protostub status: ', _this.protostubsList[key]);\r\n      });\r\n    } else { // process status events from p2p connections\r\n\r\n      if (msg.body.resource) {\r\n        let remoteRuntimeURL = msg.body.resource;\r\n\r\n        if (_this.p2pConnectionList[remoteRuntimeURL]) {\r\n          _this.p2pConnectionList[remoteRuntimeURL].status =  msg.body.value;\r\n          _this.p2pConnectionList[remoteRuntimeURL].url =  runtimeProtoStubURL;\r\n        } else {\r\n\r\n          let  p2pConnection = {\r\n            status: msg.body.value,\r\n            url: runtimeProtoStubURL\r\n          };\r\n\r\n          _this.p2pConnectionList[remoteRuntimeURL] =  p2pConnection;\r\n        }\r\n\r\n        // log.log('[Registry - onProtostubStatusEvent] - P2PConnection status: ', _this.p2pConnectionList[remoteRuntimeURL]);\r\n\r\n        // Update P2P Requester protostub if it is coming from there\r\n        if (runtimeProtoStubURL.includes('/p2prequester/')) {\r\n          _this.p2pRequesterStub[remoteRuntimeURL].status = msg.body.value;\r\n\r\n          // log.log('[Registry - onProtostubStatusEvent] - P2P Requester status: ', _this.p2pRequesterStub[remoteRuntimeURL]);\r\n        } else {\r\n          // if from P2PHandler with status disconencted, lets remove from p2pConnectionList\r\n          if (msg.body.value === 'disconnected') delete _this.p2pConnectionList[remoteRuntimeURL];\r\n        }\r\n\r\n      } else {\r\n        if (runtimeProtoStubURL.includes('/p2prequester/')) {\r\n          // It is an event from P2P Requester without mandatory \"resource\" field\r\n          Registry_log.error('[Registry onProtostubStatusEvent] resource missing: ', msg);\r\n          return;\r\n        } else {\r\n          // It is an event from P2P Handler\r\n          _this.p2pHandlerStub[_this.runtimeURL].status = msg.body.value;\r\n\r\n          // log.log('[Registry - onProtostubStatusEvent] - P2PHandler Stub status: ', _this.p2pHandlerStub[_this.runtimeURL]);\r\n        }\r\n      }\r\n\r\n    }\r\n\r\n  }\r\n\r\n  /**\r\n  * To unregister a previously registered protocol stub\r\n  * @param  {HypertyRuntimeURL}   HypertyRuntimeURL     hypertyRuntimeURL\r\n  */\r\n  unregisterStub(hypertyRuntimeURL) {\r\n    let _this = this;\r\n\r\n    return new Promise(function(resolve, reject) {\r\n\r\n      if (_this.protostubsList.hasOwnProperty(hypertyRuntimeURL)) {\r\n        delete _this.protostubsList[hypertyRuntimeURL];\r\n        resolve('ProtostubURL removed');\r\n      } else {\r\n        reject('Error on unregisterStub: Hyperty not found');\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * To register a new Identity Provider proxy in the runtime including as input parameters the function to postMessage, the DomainURL that is connected with the stub, which returns the RuntimeURL allocated to the new ProtocolStub.\r\n   * @param {Sandbox}        Sandbox\r\n   * @param  {DomainURL}     DomainURL service provider domain\r\n   * @return {RuntimeIdpProxyURL}\r\n   */\r\n  registerIdpProxy(sandbox, domainURL) {\r\n    let _this = this;\r\n\r\n    return new Promise(function(resolve, reject) {\r\n\r\n      let idpProxyStubURL;\r\n\r\n      //check if messageBus is registered in registry or not\r\n      if (_this._messageBus === undefined) {\r\n        reject('MessageBus not found on registerStub');\r\n      }\r\n\r\n      idpProxyStubURL = 'domain-idp://' + domainURL + '/stub/' + generateGUID();\r\n\r\n      // TODO: Optimize this\r\n      _this.idpProxyList[domainURL] = {\r\n        url: idpProxyStubURL,\r\n        status: STATUS.DEPLOYING\r\n      };\r\n\r\n      _this.sandboxesList.sandbox[idpProxyStubURL] = sandbox;\r\n\r\n      // sandbox.addListener('*', function(msg) {\r\n      //   _this._messageBus.postMessage(msg);\r\n      // });\r\n\r\n      resolve(idpProxyStubURL);\r\n\r\n      _this._messageBus.addListener(idpProxyStubURL + '/status', (msg) => {\r\n        _this._onIdpProxyStatusEvent(msg);\r\n      });\r\n    });\r\n  }\r\n\r\n  /**\r\n  * To Process status events fired by Idp Proxies\r\n  * @param  {Message}   message     Event Message\r\n  */\r\n\r\n  _onIdpProxyStatusEvent(msg) {\r\n\r\n    let _this = this;\r\n\r\n    // log.log('[Registry onIdpProxyStatusEvent]: ', msg);\r\n\r\n    let idpProxyURL = msg.from;\r\n\r\n    if (!msg.to.includes('/status')) {\r\n      Registry_log.error('[Registry onIdpProxyStatusEvent] Not Status Event: ', msg);\r\n      return;\r\n    }\r\n\r\n    Object.keys(_this.idpProxyList).filter((key) => {\r\n      return _this.idpProxyList[key].url === idpProxyURL;\r\n    }).map((key) => {\r\n      _this.idpProxyList[key].status = msg.body.value;\r\n\r\n      // log.log('[Registry - onIdpProxyStatusEvent] - Idp Proxy status: ', _this.idpProxyList[key]);\r\n    });\r\n\r\n  }\r\n\r\n  /**\r\n  * To discover idpProxy stubs available in the runtime for a certain domain. If available, it returns the runtime url for the idpProxy stub that connects to the requested domain. Required by the runtime BUS to route messages to remote servers or peers\r\n  * @param  {DomainURL}           DomainURL            url\r\n  * @return {RuntimeURL}           RuntimeURL         idpProxyUrl\r\n  */\r\n  discoverIdpProxy(url) {\r\n    if (!url) throw new Error('Parameter url needed');\r\n    let _this = this;\r\n\r\n    let dividedURL = divideURL(url);\r\n    let domainURL = dividedURL.domain;\r\n\r\n    if (_this.idpProxyList.hasOwnProperty(domainURL) && _this.idpProxyList[domainURL].status === STATUS.LIVE) {\r\n      return (_this.idpProxyList[domainURL]);\r\n    } else {\r\n\r\n      _this.idpProxyList[domainURL] = {\r\n        status: STATUS.PROGRESS\r\n      };\r\n\r\n      throw new Error('[Registry - discoverIdpProxy ] Idp Proxy Not Found. Creating one');\r\n\r\n    }\r\n\r\n  }\r\n\r\n  /**\r\n  * To register a new Policy Enforcer in the runtime including as input parameters the function to postMessage, the HypertyURL associated with the PEP, which returns the RuntimeURL allocated to the new Policy Enforcer component.\r\n  * @param  {Message.Message} postMessage postMessage\r\n  * @param  {HypertyURL}          HypertyURL            hyperty\r\n  * @return {HypertyRuntimeURL}   HypertyRuntimeURL\r\n  */\r\n  registerPEP(postMessage, hyperty) {\r\n    let _this = this;\r\n\r\n    return new Promise(function(resolve) {\r\n      //TODO check what parameter in the postMessage the pep is.\r\n      _this.pepList[hyperty] = postMessage;\r\n      resolve('PEP registered with success');\r\n    });\r\n\r\n  }\r\n\r\n  /**\r\n  * To unregister a previously registered protocol stub\r\n  * @param  {HypertyRuntimeURL}   HypertyRuntimeURL     HypertyRuntimeURL\r\n  */\r\n  unregisterPEP(HypertyRuntimeURL) {\r\n    let _this = this;\r\n\r\n    return new Promise(function(resolve, reject) {\r\n\r\n      let result = _this.pepList[HypertyRuntimeURL];\r\n\r\n      if (result === undefined) {\r\n        reject('Pep Not found.');\r\n      } else {\r\n        resolve('PEP successfully removed.');\r\n      }\r\n    });\r\n\r\n  }\r\n\r\n  /**\r\n  * To discover sandboxes available in the runtime for a certain domain and a certain set of capabilities. Required by the runtime UA to avoid more than one sandbox for the same domain.\r\n  * @param  {DomainURL} DomainURL url\r\n  * @return {RuntimeSandbox}           RuntimeSandbox\r\n  */\r\n  getSandbox(url, constraints) {\r\n    if (!url) throw new Error('Parameter url needed');\r\n\r\n    // log.log('[Registry getSandbox] getSandbox for: ', url, ' and capabilities: ', constraints);\r\n\r\n    let _this = this;\r\n    return new Promise(function(resolve, reject) {\r\n\r\n      let request;\r\n\r\n      //first try to find the url in the appSandbox list\r\n      request = _this.sandboxesList.appSandbox[url];\r\n\r\n      //if no appSandbox was found, try to search in the normal sandboxes list\r\n      if (!request) {\r\n        request = _this.sandboxesList.sandbox[url];\r\n\r\n        if (!request) {\r\n\r\n          let domain;\r\n\r\n          if (url.includes('://')) {\r\n            domain = divideURL(url).domain;\r\n          } else {\r\n            domain = url;\r\n          }\r\n\r\n          // search in the sandboxes list for a entry containing the domain given\r\n          for (let sandbox in _this.sandboxesList.sandbox) {\r\n            //todo: uncomment sandbox constraints match condition with runtime sharing\r\n            if (sandbox.includes(domain) && _this.sandboxesList.sandbox[sandbox].matches(constraints)) {\r\n              const current = _this.sandboxesList.sandbox[sandbox];\r\n              const match = Object.keys(constraints).filter(constraint => {\r\n                return (constraint === 'browser' && current.type === SandboxType.NORMAL) ||\r\n                      (constraint === 'windowSanbox' && current.type === SandboxType.WINDOW);\r\n\r\n              }).length > 0 ? true : false;\r\n\r\n              if (match) { request = current; }\r\n              break;\r\n            }\r\n          }\r\n        }\r\n      }\r\n\r\n      if (!request) {\r\n        reject('no sandbox found for: ' + url);\r\n      } else {\r\n        resolve(request);\r\n      }\r\n\r\n    });\r\n  }\r\n\r\n  resolveNormalStub(url) {\r\n    // log.log('resolveNormalStub ' + url);\r\n    let _this = this;\r\n\r\n    return new Promise((resolve, reject) => {\r\n\r\n      //split the url to find the domainURL. deals with the url for example as:\r\n      //\"hyperty-runtime://sp1/protostub/123\",\r\n      let dividedURL = divideURL(url);\r\n      let domainUrl = dividedURL.domain;\r\n      let type = dividedURL.type;\r\n\r\n      if (url.includes(_this.runtimeURL) || url.includes('://sandbox/')) {\r\n        Registry_log.error('[Registry - resolve] URL to be resolved should have listeners ', url);\r\n        return reject('[Registry - resolve] URL to be resolved should have listeners ', url);\r\n      }\r\n\r\n      // resolve the domain protostub in case of a message to global registry\r\n      if (url.includes('global://registry')) {\r\n        domainUrl = _this._domain;\r\n      } else {\r\n        if (!domainUrl.indexOf('msg-node.') || !domainUrl.indexOf('registry.')) {\r\n          domainUrl = domainUrl.substring(domainUrl.indexOf('.') + 1);\r\n        }\r\n      }\r\n\r\n      _this.isLegacy(url).then((isLegacy) => {\r\n\r\n        // if legacy it should resolve for <protocol>.<domain>\r\n        if (isLegacy && type !== 'domain-idp') {\r\n          domainUrl = type + '.' + getUserIdentityDomain(url);\r\n        }\r\n\r\n        Registry_log.info('[Registry.resolve] domainUrl:', domainUrl);\r\n\r\n        let registredComponent;\r\n\r\n        if (type === 'domain-idp') {\r\n          registredComponent  = _this.idpProxyList.hasOwnProperty(domainUrl) ? _this.idpProxyList[domainUrl] : false;\r\n        } else {\r\n          registredComponent  = _this.protostubsList.hasOwnProperty(domainUrl) ? _this.protostubsList[domainUrl] : false;\r\n        }\r\n\r\n        Registry_log.info('[Registry.resolve] registred:', registredComponent);\r\n\r\n        // TODO since the protostubs have other states this should be revised, because the status could change from DEPLOYED to LIVE\r\n        // TODO and this validation will trigger a new load of IDPProxy or Protostub;\r\n        if (registredComponent && registredComponent.hasOwnProperty('status') &&\r\n         (registredComponent.status === STATUS.DEPLOYED || registredComponent.status === STATUS.CREATED ||\r\n          registredComponent.status === STATUS.LIVE || registredComponent.status === STATUS.DISCONNECTED)) {\r\n          Registry_log.info('[Registry.resolve] Resolved: ', registredComponent.url, registredComponent.status);\r\n          resolve(registredComponent.url);\r\n        } else {\r\n          //todo: use switch-case to support other types of stubs\r\n          if (type === 'domain-idp') {\r\n\r\n            // The IdP Proxy does not exist, let's prepare its deployment by watching its status\r\n\r\n            _this.watchingYou.observe('idpProxyList', (change) => {\r\n\r\n              // log.log('[Registry - resolveNormalStub] idpProxyList changed ' + _this.idpProxyList);\r\n\r\n              let keypath = change.keypath;\r\n\r\n              if (keypath.includes('status'))\r\n                keypath = keypath.replace('.status', '');\r\n\r\n              if (keypath === domainUrl && change.name === 'status' && change.newValue === STATUS.CREATED) {\r\n                // log.log('[Registry - resolveNormalStub] idpProxyList is live ' + _this.idpProxyList[domainUrl]);\r\n                resolve(_this.idpProxyList[domainUrl].url);\r\n              }\r\n            });\r\n\r\n            if (!registredComponent || registredComponent.status === STATUS.FAILED ) {\r\n              // this process will load the idp proxy, because is not yet registered;\r\n              Registry_log.info('[Registry.resolveNormalStub] deploy new IDPProxy: ', domainUrl);\r\n              _this.loader.loadIdpProxy(domainUrl).then(() => {\r\n\r\n                Registry_log.info('[Registry.resolveNormalStub] IdP Proxy deployed: ', _this.idpProxyList[domainUrl]);\r\n\r\n              }).catch((reason) => {\r\n                Registry_log.error('[Registry.resolve] Error resolving Load IDPProxy: ', reason);\r\n                _this.idpProxyList[domainUrl].status = 'deployment-failed';\r\n                reject(reason);\r\n              });\r\n            }\r\n\r\n\r\n          } else {\r\n\r\n            // The protoStub does not exist, let's prepare its deployment by watching its status\r\n\r\n            _this.watchingYou.observe('protostubsList', (change) => {\r\n\r\n              // log.log('[Registry - resolveNormalStub] protostubsList changed ' + _this.protostubsList);\r\n\r\n              let keypath = change.keypath;\r\n\r\n              if (keypath.includes('status'))\r\n                keypath = keypath.replace('.status', '');\r\n\r\n              if (keypath === domainUrl && change.name === 'status' && change.newValue === STATUS.CREATED) {\r\n                // log.log('[Registry - resolve] protostub is live ' + _this.protostubsList[domainUrl]);\r\n                resolve(_this.protostubsList[domainUrl].url);\r\n              }\r\n            });\r\n\r\n            if (!registredComponent || registredComponent.status === STATUS.FAILED) {\r\n              // lets deploy the protostub\r\n              Registry_log.info('[Registry.resolve] trigger new ProtocolStub: ', domainUrl);\r\n              _this.loader.loadStub(domainUrl).then(() => {\r\n\r\n                // log.log('[Registry - resolveNormalStub] Stub deployed: ', _this.protostubsList[domainUrl]);\r\n              }).catch((reason) => {\r\n                Registry_log.error('[Registry.resolveNormalStub] Error resolving Load ProtocolStub: ', reason);\r\n                reject(reason);\r\n              });\r\n            }\r\n\r\n          }\r\n\r\n        }\r\n\r\n      }).catch((reason) => {\r\n        Registry_log.error('[Registry.resolve] Error resolving islegacy: ', reason);\r\n        reject(reason);\r\n      });\r\n\r\n    });\r\n\r\n  }\r\n\r\n  /**\r\n  * To verify if source is valid and to resolve target runtime url address if needed (eg protostub runtime url in case the message is to be dispatched to a remote endpoint).\r\n  * @param  {URL.URL}  url       url\r\n  * @return {Promise<URL.URL>}                 Promise <URL.URL>\r\n  */\r\n  resolve(msg) {\r\n    Registry_log.info('[Registry - Resolve] -  ', msg);\r\n    let _this = this;\r\n\r\n    return new Promise((resolve, reject) => {\r\n\r\n      let url = msg.to ? msg.to : msg;\r\n\r\n      let p2p = (msg.body && msg.body.p2p) ? msg.body.p2p : false;\r\n\r\n      // log.log('P2P: ', p2p, url);\r\n      // log.log('P2P - p2pHandlerStub: ', !_this.p2pHandlerStub[_this.runtimeURL], _this.p2pHandlerStub, _this.runtimeURL);\r\n      // log.log('P2P - isBackendServiceURL: ', isBackendServiceURL(url), isBackendServiceURL, url);\r\n      // log.log('P2P - includes runtimeURL: ', url.includes(_this.runtimeURL));\r\n      // log.log('P2P - includes p2phandler: ', url.includes('/p2phandler/'));\r\n      // log.log('P2P - includes p2prequester: ', url.includes('/p2prequester/'));\r\n\r\n      // Skip p2p procedure when not supported by the Runtime or for backend services\r\n\r\n      if (!_this.p2pHandlerStub[_this.runtimeURL] || isBackendServiceURL(url) || url.includes(_this.runtimeURL) || url.includes('/p2phandler/') || url.includes('/p2prequester/')) {\r\n\r\n        Registry_log.info('[Registry - resolve] - Resolve normal stub: ', _this.p2pHandlerStub, _this.runtimeURL, isBackendServiceURL(url), p2p, url);\r\n        _this.resolveNormalStub(url).then((returnURL) => {\r\n          resolve(returnURL);\r\n        });\r\n\r\n      } else {\r\n\r\n        Registry_log.info('[Registry - resolve] - checkP2P: ', p2p, url, _this._p2pConnectionResolve);\r\n        _this._p2pConnectionResolve.checkP2P(msg).then((registeredP2P) => {\r\n\r\n          // log.log('[Registry - resolve] found registered P2P: ', registeredP2P);\r\n\r\n          let p2pConnection = _this.p2pConnectionList[registeredP2P.runtime];\r\n\r\n          if (!p2pConnection) {\r\n            p2pConnection = registeredP2P;\r\n            _this.p2pConnectionList[registeredP2P.runtime] = p2pConnection;\r\n          }\r\n\r\n          switch (p2pConnection.status) {\r\n            case STATUS.LIVE:\r\n              msg.body.peer = registeredP2P.runtime;\r\n              resolve(p2pConnection.url, msg);\r\n              break;\r\n            case STATUS.CREATED: // p2p connection setup is ongoing, use MN Stub\r\n            case STATUS.PROGRESS:\r\n              _this.resolveNormalStub(url).then((returnURL) => {\r\n                resolve(returnURL);\r\n              });\r\n              break;\r\n            case STATUS.DISCONNECTED: // p2p connection stub was disconnected, let's ask to connect again\r\n              Registry_log.info('[Registry - Resolve] - p2pConnection is disconnected lets try to reconnect');\r\n              _this._p2pConnectionResolve.reconnectP2PRequester(p2pConnection).then((returnURL) => {\r\n                // log.log('[Registry - Resolve] - was reconnected with p2pRequesterStubt: ', returnURL);\r\n                resolve(returnURL);\r\n              }, (reason) => {\r\n                Registry_log.info('[Registry - Resolve] - Reason: ', reason);\r\n\r\n                _this.resolveNormalStub(url).then((returnURL) => {\r\n                  resolve(returnURL);\r\n                });\r\n              });\r\n              break;\r\n            default:\r\n\r\n              Registry_log.info('[Registry - resolve] - P2P: ', p2p);\r\n              if (!p2p) { // no p2p connection exists and the message sender does not ask one. Lets use the MN Stub\r\n                _this.resolveNormalStub(url).then((returnURL) => {\r\n                  resolve(returnURL);\r\n                });\r\n\r\n              } else {\r\n                _this._setupP2PRequester(registeredP2P).then((returnURL) => { // no p2p connection exists but the message sender is asking one. Lets try to setup one\r\n                  resolve(returnURL);\r\n                }, (reason) => {\r\n                  Registry_log.info('[Registry - Resolve] - Reason: ', reason);\r\n\r\n                  _this.resolveNormalStub(url).then((returnURL) => {\r\n                    resolve(returnURL);\r\n                  });\r\n                });\r\n              }\r\n              break;\r\n          }\r\n        }, (reason) => {\r\n          Registry_log.info('[Registry - Resolve] - Reason: ', reason);\r\n\r\n          _this.resolveNormalStub(url).then((returnURL) => {\r\n            resolve(returnURL);\r\n          });\r\n        });\r\n      }\r\n\r\n    });\r\n  }\r\n\r\n  _setupP2PRequester(input) {\r\n    let _this = this;\r\n\r\n    Registry_log.log('[Registry._setupP2PConnection] loadStub with p2pRequester: ', input);\r\n\r\n    return new Promise((resolve, reject) => {\r\n\r\n      let remoteRuntime = input.runtime;\r\n\r\n      let p2pConfig = { remoteRuntimeURL: remoteRuntime, p2pHandler: input.p2pHandler, p2pRequesterStub: true };\r\n\r\n      // lets prepare the p2pRequesterSTub deployment by setting an observer to its status changes\r\n\r\n      _this.watchingYou.observe('p2pRequesterStub', (change) => {\r\n\r\n        Registry_log.log('[Registry._setupP2PConnection] p2pRequesterStubs changed ' + _this.p2pRequesterStub);\r\n\r\n        if (change.keypath.split('.')[0] === remoteRuntime && change.name === 'status' && change.newValue === STATUS.LIVE) {\r\n          Registry_log.log('[Registry._setupP2PConnection] p2pRequester is live ' + _this.p2pRequesterStub[remoteRuntime]);\r\n          resolve(_this.p2pRequesterStub[remoteRuntime].url);\r\n        }\r\n      });\r\n\r\n      //  stub load\r\n      _this.loader.loadStub(input.p2pRequester, p2pConfig).then(() => {\r\n\r\n        Registry_log.log('[Registry._setupP2PConnection] p2pRequester deployed: ', _this.p2pRequesterStub[remoteRuntime]);\r\n\r\n\r\n      }).catch((error) => {\r\n        reject(error);\r\n      });\r\n    });\r\n  }\r\n\r\n  /**\r\n  * To verify if url is for a legacy service.\r\n  * @param  {URL.URL}  url      url\r\n  * @return {boolean}\r\n  */\r\n  isLegacy(url) {\r\n\r\n    let _this = this;\r\n\r\n    return new Promise((resolve, reject) => {\r\n\r\n      if (url === _this._domain) {\r\n        return resolve(false);\r\n      }\r\n\r\n      Registry_log.log('[Registry] [Registry.Registry.isLegacy] ', url);\r\n\r\n      // TODO: to be defined in the runtime configuration\r\n      let nonLegacy = ['hyperty-runtime', 'domain', 'global', 'hyperty'];\r\n\r\n      let urlDivided = divideURL(url);\r\n\r\n      if (nonLegacy.indexOf(urlDivided.type) !== -1 || urlDivided.domain === _this._domain) {\r\n        return resolve(false);\r\n      }\r\n\r\n      // process User URLs\r\n      if (url.split('@').length > 1) {\r\n        let domain = urlDivided.domain;\r\n\r\n        // log.log('[Registry] [Registry.Registry.isLegacy] domain: ', domain);\r\n        if (_this.idpLegacyProxyList.hasOwnProperty(domain)) {\r\n\r\n          let result = _this.idpLegacyProxyList[domain];\r\n\r\n          if (result.interworking) {\r\n            return resolve(result.interworking);\r\n          } else {\r\n            return resolve(false);\r\n          }\r\n        }\r\n\r\n        _this._loader.descriptors.getIdpProxyDescriptor(domain).then((result) => {\r\n\r\n          // log.log('[Registry] [Registry.Registry.isLegacy] Legacy stub descriptor: ', result);\r\n\r\n          if (result.interworking) {\r\n            _this.idpLegacyProxyList[domain] = result;\r\n            resolve(result.interworking);\r\n          } else {\r\n            resolve(false);\r\n          }\r\n\r\n        }).catch((reason) => {\r\n          Registry_log.warn('problem loading idp proxy descriptor for domain:', domain, ' because ', reason);\r\n          reject(reason);\r\n        });\r\n      } else { // process protostub URLs\r\n        resolve(_this.isInterworkingProtoStub(url));\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n  * To verify if URL is locally registered or not.\r\n  * @param  {URL.URL}  url      url\r\n  * @return {boolean}\r\n  */\r\n\r\n  isLocal(url) {\r\n\r\n    let runtimeScheme = ['hyperty-runtime', 'runtime'];\r\n    let hypertyScheme = ['hyperty'];\r\n    let urlScheme = url.split('://')[0];\r\n\r\n    // Process Runtime Core URLs.\r\n    // Messages originated from protostubs should also not include the runtimeURL in its URL.\r\n\r\n    if (runtimeScheme.indexOf(urlScheme) !== -1) {\r\n      return url.includes(this.runtimeURL);\r\n    }\r\n\r\n    // Process Hyperty URLs\r\n    // Todo: hypertiesList should be an object not an array\r\n\r\n    if (hypertyScheme.indexOf(urlScheme) !== -1) {\r\n\r\n      for (let index in this.hypertiesList) {\r\n        let hyperty = this.hypertiesList[index];\r\n        if (hyperty.hypertyURL === url) {\r\n          return true;\r\n        }\r\n      }\r\n\r\n      return false;\r\n    }\r\n\r\n    // Process Data Object URLs\r\n\r\n    if (url.includes('/subscription')) {\r\n      url = url.substring(0, url.indexOf('/subscription'));\r\n    }\r\n\r\n    let dataObject = this.dataObjectList[url];\r\n\r\n    if (dataObject) {\r\n      if (dataObject.interworking) {\r\n        return !dataObject.interworking;\r\n      }\r\n      return true;\r\n    }\r\n\r\n    return false;\r\n  }\r\n\r\n  /**\r\n  * To verify if protostub is to interwork with a legacy domain.\r\n  * @param  {URL.URL}  runtimeProtostubURL      The runtime URL of the Protostub\r\n  * @return {boolean}\r\n  */\r\n\r\n  isInterworkingProtoStub(runtimeProtostubURL) {\r\n\r\n    let _this = this;\r\n\r\n    if (typeof runtimeProtostubURL === 'boolean') {\r\n      return false;\r\n    }\r\n\r\n    if (!(runtimeProtostubURL.includes('/protostub/'))) {\r\n      return false;\r\n    }\r\n\r\n    let filtered = Object.keys(_this.protostubsList).filter((key) => {\r\n      return _this.protostubsList[key].url === runtimeProtostubURL;\r\n    }).map((key) => {\r\n\r\n      if (_this.protostubsList[key].hasOwnProperty('interworking')) {\r\n        return _this.protostubsList[key].interworking;\r\n      } else {\r\n        return false;\r\n      }\r\n    })[0];\r\n\r\n    return filtered;\r\n  }\r\n}\r\n\r\n/* harmony default export */ var registry_Registry = (Registry_Registry);\r\n\n// CONCATENATED MODULE: ./src/runtime/runtimeConfiguration.js\nconst runtimeConfiguration_runtimeConfiguration = {\r\n\r\n  // TODO this should be changed with the definition used for indexeddb\r\n  // look at: https://developer.mozilla.org/en-US/docs/Web/API/IDBObjectStore\r\n  // Now we are using the definition for Dexie; (http://dexie.org/docs/Version/Version.stores())\r\n  storageSchemas: {\r\n    capabilities: {\r\n      capabilities: 'key,version,value'\r\n    },\r\n    subscriptions: {\r\n      subscriptions: 'key,version,value'\r\n    },\r\n    runtime: {\r\n      'runtime:URL': 'key,version,value',\r\n      'p2pHandler:URL': 'key,version,value'\r\n    },\r\n    registry: {\r\n      'registry:DataObjectURLs': 'key,version,value',\r\n      'registry:HypertyURLs': 'key,version,value'\r\n    },\r\n    cryptoManager: {\r\n      userAsymmetricKey: 'key,version,value',\r\n      dataObjectSessionKeys: 'key,version,value'\r\n    },\r\n    identity: {\r\n      accessTokens: 'key,version,value',\r\n      identities: 'userURL, userProfile.email, userProfile.userURL, userProfile.name'\r\n    },\r\n    runtimeCatalogue: {\r\n      runtimeCatalogue: '&cguid, accessControlPolicy, constraints, dataObjects, type, objectName, sourcePackage, version, url'\r\n    },\r\n    policy: {\r\n      'rethink:activePolicy': 'key,version,value',\r\n      'rethink:groups': 'key,version,value',\r\n      'rethink:userPolicies': 'key,version,value',\r\n      'rethink:spPolicies': 'key,version,value'\r\n    },\r\n    syncherManager: {\r\n      'syncherManager:ObjectURLs': 'key,version,value',\r\n      'remotes': 'key,version,value'\r\n    },\r\n    hypertyResources: {\r\n      hypertyResources: '&resourceURL, name, contentUrl, content, created, reporter, resourceType'\r\n    }\r\n  },\r\n\r\n  runtimeURLS: {\r\n    registry: {\r\n      prefix: 'hyperty-runtime://',\r\n      suffix: 'registry'\r\n    },\r\n    identityModule: {\r\n      prefix: 'hyperty-runtime://',\r\n      suffix: '/idm'\r\n    },\r\n    runtimeUA: {\r\n      prefix: 'hyperty-runtime://',\r\n      suffix: '/ua'\r\n    },\r\n    catalogue: {\r\n      prefix: 'hyperty-runtime://',\r\n      suffix: '/catalogue'\r\n    },\r\n    graphConnector: {\r\n      prefix: 'hyperty-runtime://',\r\n      suffix: '/graph'\r\n    },\r\n    syncManager: {\r\n      prefix: 'hyperty-runtime://',\r\n      suffix: '/sm'\r\n    }\r\n  },\r\n  catalogueURLs: {\r\n    protocolstub: {\r\n      prefix: 'https://',\r\n      suffix: ':8080/.well-known/protocolstub/',\r\n      fallback: 'https://%domain%:8080/.well-known/protocolstub/'\r\n    },\r\n    'idp-proxy': {\r\n      prefix: 'https://',\r\n      suffix: ':8080/.well-known/idp-proxy/',\r\n      fallback: 'https://%domain%:8080/.well-known/idp-proxy/'\r\n    }\r\n  },\r\n  msgNodeURL: {\r\n    prefix: 'domain://msg-node.',\r\n    suffix: '',\r\n    hypertyAddressAllocation: '/hyperty-address-allocation',\r\n    objectAddressAllocation: '/object-address-allocation',\r\n    subscriptionManagement: '/sm'\r\n  },\r\n  domainRegistryURL: {\r\n    prefix: 'domain://registry.',\r\n    suffix: ''\r\n  },\r\n  globalRegistryURL: 'global://registry.',\r\n  remoteStorage: 'https://admin:admin@backup.rethink.alticelabs.com'\r\n};\r\n\n// CONCATENATED MODULE: ./src/identity/Identities.js\n// Log System\r\n\r\nlet Identities_log = loglevel[\"getLogger\"]('IdentityModule');\r\n\r\n\r\n\r\n\r\n\r\n/**\r\n* The Identity Data Model is used to model the reTHINK User entity. The Identity data model is handled by Identity Management functionality.\r\n*\r\n*/\r\nclass Identities_Identities {\r\n\r\n  constructor(type, storageManager) {\r\n    let _this = this;\r\n\r\n    _this._watchingYou = new utils_WatchingYou();\r\n\r\n    _this._storageManager = storageManager;\r\n    _this._guid;\r\n    _this._type = type;\r\n    _this._identities = {};\r\n    _this._accessTokens = _this.watchingYou.watch('accessTokens', {}, true);\r\n\r\n  }\r\n\r\n  reset() {\r\n    this._identities = {};\r\n    console.log(this);\r\n    this.currentIdentity = undefined;\r\n    this.defaultIdentity = undefined;\r\n  }\r\n\r\n  get identities() {\r\n    return this._identities;\r\n  }\r\n\r\n  get accessTokens() {\r\n    return this._accessTokens;\r\n  }\r\n\r\n  get watchingYou() {\r\n    return this._watchingYou;\r\n  }\r\n\r\n  set guid(guid) {\r\n    this._guid = guid;\r\n  }\r\n\r\n  get guid() {\r\n    return this._guid;\r\n  }\r\n\r\n  set defaultIdentity(identifier) {\r\n    if (this.identities[identifier]) this._defaultIdentity = identifier;\r\n    else throw new Error('[Identities.set defaultIdentity ] Error: identity does not exist here: ', identifier);\r\n  }\r\n\r\n  set currentIdentity(identifier) {\r\n    if (this.identities[identifier]) this._currentIdentity = identifier;\r\n    else throw '[Identities.set currentIdentity ] Error: identity does not exist here: ', identifier;\r\n  }\r\n\r\n  get defaultIdentity() {\r\n    if (this._defaultIdentity) return Object.assign({}, this.identities[this._defaultIdentity]);\r\n    else return false;\r\n  }\r\n\r\n  get currentIdentity() {\r\n    return Object.assign({}, this.identities[this._currentIdentity]);\r\n  }\r\n\r\n  get identifiers() {\r\n    return Object.keys(this._identities);\r\n  }\r\n\r\n  getIdentity(identifier) {\r\n    return Object.assign({}, this._identities[identifier]);\r\n  }\r\n\r\n  loadIdentities() {\r\n    let _this = this;\r\n    return new Promise((resolve) => {\r\n\r\n      _this._storageManager.get(null, null, 'identities').then((identities) => {\r\n\r\n        Identities_log.info('[Identities.Load Identities] identities: ', identities);\r\n\r\n        if (identities) {\r\n          _this._identities = identities;\r\n\r\n          // let's set as default identity the one that expires later\r\n\r\n          _this.identifiers.forEach((id) => {\r\n            let timeNow = secondsSinceEpoch();\r\n            let identity = _this._identities[id];\r\n            let expires = identity.expires;\r\n\r\n            //            if (!identity.hasOwnProperty('interworking')\r\n            //            || !identity.interworking) {\r\n            _this.defaultIdentity = id;\r\n\r\n            if (parseInt(expires) > timeNow) {\r\n              _this.defaultIdentity.expires = parseInt(expires);\r\n              _this.currentIdentity = id;\r\n            }\r\n\r\n          });\r\n        }\r\n\r\n        resolve();\r\n      });\r\n    });\r\n  }\r\n\r\n  loadAccessTokens() {\r\n    let _this = this;\r\n    return new Promise((resolve) => {\r\n\r\n      _this._storageManager.get('accessTokens').then((accessTokens) => {\r\n\r\n        if (accessTokens) _this._accessTokens = accessTokens;\r\n        resolve();\r\n      });\r\n    });\r\n  }\r\n\r\n  // to confirm if this function is required when the App constraints the identity selection\r\n\r\n  addIdentity(identity) {\r\n    let _this = this;\r\n\r\n    return new Promise((resolve, reject) => {\r\n      if (_this._isValid(identity)) {\r\n        let id = identity.identifiers[0];\r\n        Object.assign(this._identities[id], identity);\r\n        this._storeIdentity(identity).then(() => {\r\n          this._identities[id].status = 'created';\r\n          resolve();\r\n        });\r\n      } else { reject('[Identities.addIdentity] invalid IdAssertion'); }\r\n    });\r\n\r\n  }\r\n\r\n  addAssertion(assertion) {\r\n    let _this = this;\r\n\r\n    return new Promise((resolve, reject) => {\r\n      if (_this._isValid(assertion)) {\r\n        assertion.userProfile.guid = _this._guid;\r\n        let userUrl = assertion.userProfile.userURL;\r\n        if (!_this.identities[userUrl]) _this._identities[userUrl] = assertion;\r\n        else _this.identities[userUrl] = assertion;\r\n\r\n        _this._store().then(() => {\r\n          this._identities[userUrl].status = 'created';\r\n          if (_this.defaultIdentity == false) {\r\n            _this.defaultIdentity = userUrl;\r\n          }\r\n          resolve(assertion);\r\n        });\r\n      } else { reject('[Identities.addAssertion] invalid IdAssertion: ', assertion); }\r\n    });\r\n\r\n  }\r\n\r\n  removeIdentity(userUrl) {\r\n    let _this = this;\r\n\r\n\r\n    return new Promise((resolve, reject) => {\r\n      delete _this.identities[userUrl];\r\n\r\n      _this._store().then(() => {\r\n        resolve();\r\n      });\r\n\r\n    });\r\n\r\n  }\r\n\r\n  addAccessToken(accessToken) {\r\n    let _this = this;\r\n    Identities_log.info('[Identities.addAccessToken] ', accessToken);\r\n\r\n    return new Promise((resolve, reject) => {\r\n\r\n      if (_this._isValidAccessToken(accessToken)) {\r\n\r\n        //        let newAccessToken = deepClone(accessToken);\r\n\r\n        _this._accessTokens[accessToken.domain] = accessToken;\r\n\r\n        _this._storeAccessTokens().then(() => {\r\n          _this._accessTokens[accessToken.domain].status = 'created';\r\n          resolve(accessToken);\r\n        });\r\n      } else { reject('[Identities.addIdentity] invalid AccessToken: ', accessToken); }\r\n    });\r\n\r\n  }\r\n\r\n  setAccessTokenInProgress(domain) {\r\n\r\n    if (this._accessTokens[domain]) this._accessTokens[domain].status = 'in-progress';\r\n    else this._accessTokens[domain] = { status: 'in-progress' };\r\n  }\r\n\r\n  getAccessToken(domain, resources) {\r\n    let accessToken = this._accessTokens[domain];\r\n\r\n    if (!accessToken) { return undefined; } else if (\r\n      resources.every((i) => { return accessToken.resources.indexOf(i) != -1; })) { return this._accessTokens[domain]; } else { return new Error('[Identities.getAccessToken] Not found for ', domain); }\r\n\r\n  }\r\n\r\n  removeAccessToken(domain, resources) {\r\n    let _this = this;\r\n\r\n    return new Promise((resolve) => {\r\n      let accessToken = this._accessTokens[domain];\r\n\r\n      if (!accessToken) { resolve(); } else if (\r\n        resources.every((i) => { \r\n          return accessToken.resources.indexOf(i) != -1; \r\n        })) {\r\n           delete this._accessTokens[domain]; \r\n           _this._storeAccessTokens().then(() => {\r\n            resolve();\r\n          });\r\n          } else { \r\n            resolve();\r\n          }\r\n  \r\n    });\r\n\r\n\r\n  }\r\n\r\n  updateAssertion(assertion) {\r\n    let _this = this;\r\n\r\n    return new Promise((resolve) => {\r\n      let userUrl = assertion.userProfile.userURL;\r\n\r\n      if (!_this.identities[userUrl]) { return reject('[Identities.updateAssertion] Identity not found for ', userUrl); } else {\r\n        _this.identities[userUrl] = assertion;\r\n        _this._store().then(() => {\r\n          resolve();\r\n        });\r\n      }\r\n\r\n    });\r\n\r\n  }\r\n\r\n  updateAccessToken(accessToken) {\r\n    let _this = this;\r\n    Identities_log.info('[Identities.updateAccessToken] ', accessToken);\r\n\r\n    return new Promise((resolve, reject) => {\r\n\r\n      if (_this._isValidAccessToken(accessToken)) {\r\n\r\n        _this._accessTokens[accessToken.domain].expires = accessToken.expires;\r\n        _this._accessTokens[accessToken.domain].accessToken = accessToken.accessToken;\r\n\r\n        _this._storeAccessTokens().then(() => {\r\n          _this._accessTokens[accessToken.domain].status = 'created';\r\n          resolve(accessToken);\r\n        });\r\n      } else { reject('[Identities.updateAccessToken] invalid AccessToken: ', accessToken); }\r\n    });\r\n\r\n  }\r\n\r\n  addIdAssertion(identifier, assertion, idp, scope) {\r\n    let _this = this;\r\n\r\n    let newIdAssertion = new IdAssertion(assertion, idp, scope);\r\n\r\n    _this.idAssertionList.push(newIdAssertion);\r\n  }\r\n\r\n  //TODO: complete with more verifications. To be moved to Identity?\r\n\r\n  _isValid(identity) {\r\n    if (!identity.hasOwnProperty('assertion')) {\r\n      return false;\r\n    }\r\n\r\n    let splitedAssertion = identity.assertion.split('.');\r\n    let assertionParsed;\r\n\r\n    //verify if the token contains the 3 components, or just the assertion\r\n    try {\r\n      if (splitedAssertion[1]) {\r\n        assertionParsed = decode(splitedAssertion[1]);\r\n      } else {\r\n        assertionParsed = decode(identity.assertion);\r\n      }\r\n    } catch (err) {\r\n      return false;\r\n    }\r\n\r\n\r\n    return true;\r\n\r\n  }\r\n\r\n  _isValidAccessToken(accessToken) {\r\n\r\n    if (!accessToken.hasOwnProperty('accessToken')) {\r\n      return false;\r\n    }\r\n\r\n    if (!accessToken.hasOwnProperty('domain')) {\r\n      return false;\r\n    }\r\n\r\n    if (!(accessToken.hasOwnProperty('resources') && Array.isArray(accessToken.resources))) {\r\n      return false;\r\n    }\r\n\r\n\r\n    if (!(accessToken.hasOwnProperty('expires') && Number.isInteger(accessToken.expires))) {\r\n      return false;\r\n    }\r\n\r\n    if (!accessToken.hasOwnProperty('input')) {\r\n      return false;\r\n    }\r\n\r\n    return true;\r\n\r\n  }\r\n\r\n  //TODO: add function to only set one new identity using the new indexed storage manager\r\n\r\n  _store() {\r\n    let _this = this;\r\n\r\n    return new Promise((resolve, reject) => {\r\n\r\n      const store = Object.keys(this._identities).map((userURL) => {\r\n        return _this._storageManager.set(userURL, 0, this._identities[userURL], 'identities');\r\n      });\r\n\r\n      Promise.all(store).then(() => {\r\n        resolve();\r\n      }).catch(err => {\r\n        reject('On _sendReporterSessionKey from method storeIdentity error: ' + err);\r\n      });\r\n\r\n    });\r\n  }\r\n  _storeAccessTokens() {\r\n    let _this = this;\r\n\r\n    return new Promise((resolve, reject) => {\r\n\r\n      let accessTokens = deepClone(_this._accessTokens);\r\n\r\n      _this._storageManager.set('accessTokens', 0, accessTokens).then(() => {\r\n        resolve();\r\n      }).catch(err => {\r\n        reject('On _sendReporterSessionKey from method storeIdentity error: ' + err);\r\n      });\r\n\r\n    });\r\n  }\r\n\r\n}\r\n\r\n// move to Identity service framework?\r\n\r\nclass IdAssertion {\r\n\r\n  constructor(assertion, idp, userProfile) {\r\n    let _this = this;\r\n\r\n    _this._assertion = assertion;\r\n    _this._idp = idp;\r\n    _this._userProfile = userProfile;\r\n  }\r\n\r\n  get assertion() {\r\n    return this._assertion;\r\n  }\r\n\r\n  get idp() {\r\n    return this._idp;\r\n  }\r\n\r\n  get userProfile() {\r\n    return this._userProfile;\r\n  }\r\n\r\n}\r\n\r\nclass IdValidation {\r\n\r\n  constructor(identity, contents) {\r\n    let _this = this;\r\n    _this.identity = identity;\r\n    _this.contents = contents;\r\n  }\r\n\r\n  validates(identity, contents) {\r\n    //TODO implement the logic\r\n\r\n  }\r\n}\r\n\r\n/* harmony default export */ var identity_Identities = (Identities_Identities);\r\n\n// CONCATENATED MODULE: ./src/identity/GuiFake.js\n// Log System\r\n\r\nlet GuiFake_log = loglevel[\"getLogger\"]('IdentityModule');\r\n\r\n/**\r\n* fake class for the gui to select the identity,\r\n* TODO replace with the proper identity GUI\r\n*\r\n*/\r\nclass GuiFake {\r\n\r\n  constructor(url, messageBus) {\r\n    GuiFake_log.log('FakeGUI_deployed');\r\n    let _this = this;\r\n\r\n    _this._url = url;\r\n    _this._waitTime = 10000;\r\n    _this._messageBus = messageBus;\r\n\r\n    _this._messageBus.addListener(_this._url, msg => {\r\n\r\n      if (msg.hasOwnProperty('type') &&\r\n          msg.type === 'create' &&\r\n          msg.body.hasOwnProperty('value') &&\r\n          msg.body.value.hasOwnProperty('identities') &&\r\n          msg.body.value.hasOwnProperty('idps')) {\r\n\r\n        let identities = msg.body.value.identities;\r\n        let idps = msg.body.value.idps;\r\n\r\n        let value;\r\n\r\n        if (identities[0] !== undefined) {\r\n          value = {type: 'identity', value: identities[0], code: 200};\r\n        } else {\r\n          value = {type: 'idp', value: idps[2].domain, code: 200};\r\n        }\r\n\r\n        let replyMsg = {id: msg.id, type: 'response', to: msg.from, from: msg.to, body: value};\r\n\r\n        // to test on the identity side the listener without the timeout\r\n        // can represent the time the user takes to choose and identity\r\n        if (msg.body.value === 'wait') {\r\n\r\n          setTimeout(() => {\r\n            _this._messageBus.postMessage(replyMsg);\r\n          }, _this._waitTime);\r\n        } else {\r\n          _this._messageBus.postMessage(replyMsg);\r\n        }\r\n      } else {\r\n        GuiFake_log.log('Ignoring messages not intended to FakeGUI.', msg);\r\n      }\r\n    });\r\n  }\r\n\r\n}\r\n\r\n/* harmony default export */ var identity_GuiFake = (GuiFake);\r\n\n// CONCATENATED MODULE: ./src/identity/IdentityModule.js\n// Log System\r\n\r\nlet IdentityModule_log = loglevel[\"getLogger\"]('IdentityModule');\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n/**\r\n*\r\n* The Identity Module (Id Module) is the component responsible for handling the\r\n* user identity and the association of this identity with the Hyperty instances,\r\n* in order to make Hyperty instances identifiable. The identity in the reTHINK project\r\n* is not fixed to a unique Identity Service Provider, but obtained through several\r\n* different Identity sources. With this approach, the Id Module provides to the user the\r\n* option to choose the preferred method for authentication.\r\n* This module will thus able to support multiple Identity acquisition methods,\r\n* such as OpenID connect 1.0, Kerberos System, or authentication through smart cards.\r\n* For example, a user with a Google account can use the Google as an Identity Provider to provide Identity Tokens,\r\n*  which can be used by the Identity Module to associate it with a Hyperty instance.\r\n*\r\n* The Identity Module uses a node package, the HelloJS, which is a client-side JavaScript API for authentication\r\n* that facilitates the requests for the OpenID connect protocol. This method allows for some abstraction\r\n* when making requests for different Identity Providers, such as OpenID connect used by Google, Facebook, Microsoft, for example.\r\n*\r\n* When a request for a user identity is made using the method loginWithRP(identifier, scope),\r\n* this method will analyse the Identity Provider chosen to obtain an identity and will use the HelloJS node package\r\n* with the selected Identity Provider and identity scope. After the HelloJS request for an Access Token\r\n* to the Identity Providers, the user will be prompted to authenticate towards the Identity Provider.\r\n* Upon receiving the Access Token, this token is validated with a RESTful web service request to an endpoint\r\n* on the Identity Provider Authorization Server, and after the validation is done,\r\n* an ID token is obtained with the information according to the scope required.\r\n* This ID token is then preserved in this module that can obtained through the getIdentities()\r\n* and is passed as return value of the loginWithRP function. The methods generateAssertion and validateAssertion have not yet been developed.\r\n*\r\n*/\r\nclass IdentityModule_IdentityModule {\r\n\r\n  /**\r\n  * This is the constructor to initialise the Identity Module it does not require any input.\r\n  */\r\n  constructor(runtimeURL, runtimeCapabilities, storageManager, dataObjectsStorage, cryptoManager, runtimeCatalogue) {\r\n    let _this = this;\r\n\r\n    if (!runtimeURL) throw new Error('runtimeURL is missing.');\r\n    if (!storageManager) throw new Error('storageManager is missing');\r\n    if (!cryptoManager) throw new Error('cryptoManager is missing');\r\n    if (!runtimeCatalogue) throw new Error('runtimeCatalogue is missing');\r\n\r\n    _this._runtimeURL = runtimeURL;\r\n\r\n    _this._runtimeCatalogue = runtimeCatalogue;\r\n\r\n    _this.dataObjectsStorage = dataObjectsStorage;\r\n    _this._idmURL = _this._runtimeURL + '/idm';\r\n    _this._guiURL = _this._runtimeURL + '/identity-gui';\r\n    _this.runtimeCapabilities = runtimeCapabilities;\r\n\r\n    _this._domain = divideURL(_this._runtimeURL).domain;\r\n\r\n\r\n    //to store items with this format: {identity: identityURL, token: tokenID}\r\n    _this._identities = new identity_Identities('human', storageManager);\r\n\r\n    // to be reviewed: watchingYou identitiesList or identities?\r\n    //    _this.identitiesList = _this.watchingYou.watch('identitiesList', {}, true);\r\n    _this._crypto = cryptoManager;\r\n\r\n    /*    _this.emailsList = [];\r\n    let newIdentity = new Identity('guid', 'HUMAN');\r\n    _this.identity = newIdentity;\r\n    _this.currentIdentity;\r\n    _this.identities.defaultIdentity;*/\r\n\r\n    //stores the association of the dataObject and the Hyperty registered within\r\n    _this.dataObjectsIdentity = {}; // is this needed?\r\n\r\n    _this._listOfIdps = [];\r\n\r\n    // variable to know if the GUI is deployed to choose the identity. if the real GUI is not deployed, a fake gui is deployed instead.\r\n    _this.guiDeployed = false;\r\n\r\n  }\r\n\r\n  //******************* GET AND SET METHODS *******************\r\n\r\n  /**\r\n  * return the messageBus in this Registry\r\n  * @param {MessageBus}           messageBus\r\n  */\r\n  get messageBus() {\r\n    let _this = this;\r\n    return _this._messageBus;\r\n  }\r\n\r\n  /**\r\n  * Set the messageBus in this Registry\r\n  * @param {MessageBus}           messageBus\r\n  */\r\n  set messageBus(messageBus) {\r\n    let _this = this;\r\n    _this._messageBus = messageBus;\r\n    _this.addGUIListeners();\r\n  }\r\n\r\n  /**\r\n  * return the coreDiscovery component\r\n  * do we need this??\r\n  */\r\n  get coreDiscovery() {\r\n    let _this = this;\r\n    return _this._coreDiscovery;\r\n  }\r\n\r\n  /**\r\n  * Set the coreDiscovery component\r\n  * @param {coreDiscovery} coreDiscovery\r\n  */\r\n  set coreDiscovery(coreDiscovery) {\r\n    let _this = this;\r\n    _this._coreDiscovery = coreDiscovery;\r\n  }\r\n\r\n  /**\r\n  * return the registry in this idModule\r\n  * @param {registry}           registry\r\n  */\r\n  get registry() {\r\n    let _this = this;\r\n    return _this._registry;\r\n  }\r\n\r\n  /**\r\n  * Set the registry in this idModule\r\n  * @param {registry}     reg\r\n  */\r\n  set registry(registry) {\r\n    let _this = this;\r\n    _this._registry = registry;\r\n  }\r\n\r\n\r\n  //******************* IDENTITY RELEATED METHODS *******************\r\n  /**\r\n  * gets all the information from a given userURL\r\n  * @param  {String}  userURL     user url\r\n  * @return {JSON}    identity    identity bundle from the userURL\r\n  */\r\n  getIdentity(userURL) {\r\n    return this.identities.getIdentity(userURL);\r\n  }\r\n\r\n  /**\r\n  * Function to set the current Identity with a given Identity\r\n  * @param {Identity}        identity         identity\r\n  */\r\n\r\n  /*  setCurrentIdentity(identity) {\r\n    let _this = this;\r\n    _this.currentIdentity = identity;\r\n  }*/\r\n\r\n  /**\r\n  * Function to return all the identities registered within a session by a user.\r\n  * These identities are returned in an array containing a JSON package for each user identity.\r\n  * @return {Array<Identities>}         Identities\r\n  */\r\n  get identities() {\r\n    let _this = this;\r\n    return _this._identities;\r\n  }\r\n\r\n  set identities(identities) {\r\n    let _this = this;\r\n    _this._identities = identities;\r\n  }\r\n\r\n  get idps() {\r\n    return this._listOfIdps;\r\n  }\r\n\r\n  getIdentitiesToChoose() {\r\n    //    let identities = _this.identities.identifiers;\r\n\r\n    // let idps = [\r\n    //   { domain: 'google.com', type: 'idToken'},\r\n    //   { domain: 'microsoft.com', type: 'idToken'},\r\n    //   { domain: 'orange.fr', type: 'idToken'},\r\n    //   { domain: 'slack.com', type: 'Legacy'}\r\n    // ];\r\n\r\n    // todo: retrieve available idps from runtime catalogue\r\n    // todo: enable oauth idps\r\n    // let idps = [\r\n    //   { domain: 'google.com', type: 'idToken' },\r\n    //   { domain: 'microsoft.com', type: 'idToken' },\r\n    //   { domain: 'facebook.com', type: 'idToken' },\r\n    //   { domain: 'slack.com', type: 'idToken' }\r\n    // ];\r\n\r\n    return new Promise((resolve) => {\r\n      let prefix = runtimeConfiguration_runtimeConfiguration['catalogueURLs']['idp-proxy'].prefix;\r\n      let suffix = runtimeConfiguration_runtimeConfiguration['catalogueURLs']['idp-proxy'].suffix;\r\n\r\n      const url = prefix + this._domain + suffix;\r\n\r\n      Promise.all([\r\n        this.runtimeCapabilities.isAvailable('browser'),\r\n        this.runtimeCapabilities.isAvailable('node')])\r\n        .then((result) => {\r\n\r\n          const isBrowser = result[0];\r\n          const isNode = result[1];\r\n\r\n          const constraints = { constraints: {} };\r\n          constraints.constraints.node = isNode;\r\n          constraints.constraints.browser = isBrowser;\r\n\r\n          this._getAllIdps().then((idps) => {\r\n            const listOfIdps = idps.map(key => { return { domain: key, type: 'idToken' }; });\r\n            IdentityModule_log.info('[IdentityModule.getIdentityAssertion:getIdentitiesToChoose]', idps, listOfIdps);\r\n            this._listOfIdps = listOfIdps;\r\n            return resolve({ defaultIdentity: this.identities.defaultIdentity, identities: this.identities.identities, idps: listOfIdps });\r\n          });\r\n\r\n        });\r\n\r\n    });\r\n\r\n  }\r\n\r\n  _getAllIdps() {\r\n\r\n  let allUrl = 'https://' + this._domain + ':8080/.well-known/idp-proxy/all.json';\r\n\r\n  return new Promise(function(resolve, reject) {\r\n    fetch(allUrl).then(function(result) {\r\n/*    $.ajax({\r\n      url: hypertiesURL,\r\n      success: function(result) {*/\r\n\r\n\r\n        console.log(result);\r\n\r\n        result.json().then(function (idps) {\r\n          console.log(idps);\r\n/*          let response = [];\r\n        if (typeof hyperties === 'object') {\r\n          hyperties.forEach(function(key) {\r\n            response.push(key);\r\n          });\r\n        } else if (typeof hyperties === 'string') {\r\n          response = JSON.parse(hyperties);\r\n        }*/\r\n\r\n        resolve(idps['idps']);\r\n\r\n        })\r\n      },function(reason) {\r\n//      fail: function(reason) {\r\n        reject(reason);\r\n//        notification(reason, 'warn');\r\n      });\r\n  });    \r\n  }\r\n\r\n\r\n  /**\r\n  * Function to return the selected Identity within a session\r\n  * @return {Identity}        identity         identity\r\n  */\r\n  /*  getCurrentIdentity() {\r\n    let _this = this;\r\n    return _this.currentIdentity;\r\n  }*/\r\n\r\n  init(guid) {\r\n    let _this = this;\r\n    return new Promise((resolve) => {\r\n      _this._identities.loadIdentities().then(() => {\r\n\r\n        if (!guid) {\r\n          _this._crypto.getMyPublicKey().then((key) => {\r\n            let hash = _this._crypto.crypto._sha256(stringify(key)).then((hash) => {\r\n\r\n              guid = 'user-guid://' + hash;\r\n              _this.identities.guid = guid;\r\n              _this._identities.loadAccessTokens().then(() => {\r\n\r\n                resolve();\r\n              });\r\n            }).catch((error) => {\r\n              console.log('[IdentityModule] error', error);\r\n            });\r\n\r\n          });\r\n        } else {\r\n          _this.identities.guid = guid;\r\n          _this._identities.loadAccessTokens().then(() => {\r\n\r\n            resolve();\r\n          });\r\n        }\r\n\r\n      });\r\n\r\n    });\r\n\r\n  }\r\n\r\n  /**\r\n  * Function that fetch an identityAssertion from a user.\r\n  *\r\n  * @return {IdAssertion}              IdAssertion\r\n  */\r\n  getIdentityAssertion(identityBundle) {\r\n    IdentityModule_log.log('[IdentityModule.getIdentityAssertion:identityBundle]', identityBundle);\r\n    let _this = this;\r\n\r\n    return new Promise(function (resolve, reject) {\r\n\r\n      //CHECK whether is browser environment or nodejs\r\n      //if it is browser, then create a fake identity\r\n\r\n      _this.runtimeCapabilities.isAvailable('browser').then((result) => {\r\n        IdentityModule_log.log('runtime browser identity acquisition', result);\r\n\r\n        if (!result) return;\r\n\r\n        //todo: only idp should be mandatory when identityBundle exists\r\n\r\n        if (identityBundle &&\r\n          identityBundle.hasOwnProperty('idp')) {\r\n\r\n          let idp = identityBundle.idp;\r\n          let origin = identityBundle.hasOwnProperty('origin') ? identityBundle.origin : 'origin';\r\n          let idHint = identityBundle.hasOwnProperty('idHint') ? identityBundle.idHint : '';\r\n\r\n          if (_this.identities.defaultIdentity) {\r\n            let assertion = _this.identities.defaultIdentity;\r\n\r\n            if (assertion.expires > secondsSinceEpoch()) {\r\n              return resolve(assertion);\r\n            } else if (assertion.hasOwnProperty('refresh')) {\r\n              IdentityModule_log.log('[Identity.IdentityModule.getIdentityAssertion] refreshing assertion: ', assertion);\r\n\r\n              _this._refreshIdAssertion().then((newAssertion) => {\r\n                IdentityModule_log.log('[IdentityModule.getIdentityAssertion] refreshed assertion.', newAssertion);\r\n                return resolve(newAssertion);\r\n              }, (error) => {\r\n                IdentityModule_log.error('[IdentityModule.getIdentityAssertion] error on refresIdAssertion: ', error, ' Asking for a new IdAssertion.')\r\n                _this._getIdAssertionForDomain(origin, idp, idHint).then((assertion) => {\r\n                  resolve(assertion);\r\n                }, (error) => {\r\n                  reject(error);\r\n                });\r\n              });\r\n\r\n            } else {\r\n              _this._getIdAssertionForDomain(origin, idp, idHint).then((assertion) => {\r\n                resolve(assertion);\r\n              }, (error) => {\r\n                reject(error);\r\n              });\r\n            }\r\n          } else {\r\n            _this._getIdAssertionForDomain(origin, idp, idHint).then((assertion) => {\r\n              resolve(assertion);\r\n            }, (error) => {\r\n              reject(error);\r\n            });\r\n          }\r\n\r\n        } else if (_this.identities.defaultIdentity) {\r\n          let assertion = _this.identities.defaultIdentity;\r\n\r\n          if (assertion.expires > secondsSinceEpoch()) {\r\n            return resolve(assertion);\r\n          } else if (assertion.hasOwnProperty('refresh')) {\r\n            IdentityModule_log.log('[Identity.IdentityModule.getValidToken] refreshing assertion: ', assertion);\r\n\r\n            _this._refreshIdAssertion(assertion).then((newAssertion) => {\r\n              IdentityModule_log.log('[IdentityModule.getIdentityAssertion] refreshed assertion.', newAssertion);\r\n              return resolve(newAssertion);\r\n\r\n            }, (error) => {\r\n              IdentityModule_log.error('[IdentityModule.getIdentityAssertion] error on refresIdAssertion: ', error, ' Asking for a new IdAssertion.')\r\n\r\n              _this.selectIdentityFromGUI().then((assertion) => {\r\n\r\n                IdentityModule_log.log('[IdentityModule] Identity selected from GUI.');\r\n\r\n                _this.identities.defaultIdentity = assertion.userProfile.userURL;\r\n                return resolve(assertion);\r\n\r\n              }, (err) => {\r\n                return reject(err);\r\n              });\r\n\r\n            });\r\n\r\n          } else {\r\n            _this.selectIdentityFromGUI().then((assertion) => {\r\n\r\n              IdentityModule_log.log('[IdentityModule] Identity selected from GUI.');\r\n\r\n              _this.identities.defaultIdentity = assertion.userProfile.userURL;\r\n              return resolve(assertion);\r\n\r\n            }, (err) => {\r\n              return reject(err);\r\n            });\r\n          }\r\n        } else {\r\n          _this.selectIdentityFromGUI().then((assertion) => {\r\n\r\n            IdentityModule_log.log('[IdentityModule] Identity selected from GUI.');\r\n\r\n            _this.identities.defaultIdentity = assertion.userProfile.userURL;\r\n            return resolve(assertion);\r\n\r\n          }, (err) => {\r\n            return reject(err);\r\n          });\r\n\r\n        }\r\n      }).catch(error => {\r\n        IdentityModule_log.error('Error on identity acquisition ', error);\r\n        return reject(error);\r\n      });\r\n\r\n      _this.runtimeCapabilities.isAvailable('node').then((result) => {\r\n        IdentityModule_log.log('node identity acquisition', result);\r\n\r\n        if (!result) return;\r\n\r\n        if (_this.identities.currentIdentity) {\r\n          //TODO verify whether the token is still valid or not.\r\n          // should be needed to make further requests, to obtain a valid token\r\n          return resolve(_this.identities.currentIdentity);\r\n        } else {\r\n          IdentityModule_log.log('getIdentityAssertion for nodejs');\r\n\r\n          let idp = { type: 'idp', value: 'nodejs-idp', code: 200, auth: false };\r\n          _this.callNodeJsGenerateMethods(idp.value, 'origin').then((value) => {\r\n            resolve(value);\r\n          }, (err) => {\r\n            reject(err);\r\n          });\r\n        }\r\n\r\n      }).catch(error => {\r\n        IdentityModule_log.error('Error on identity acquisition ', error);\r\n        reject(error);\r\n      });\r\n    });\r\n  }\r\n\r\n  _getIdAssertionForDomain(origin, idp, idHint) {\r\n\r\n    let _this = this;\r\n\r\n    return new Promise((resolve, reject) => {\r\n      _this.selectIdentityForHyperty(origin, idp, idHint).then((assertion) => {\r\n        IdentityModule_log.log('[IdentityModule._getIdAssertionForDomain] Identity selected by hyperty.');\r\n        return resolve(assertion);\r\n      }, (err) => { // if it got an error then just select identity from GUI\r\n        // log.error('[IdentityModule] Could not select identity from hyperty.');\r\n\r\n        _this.selectIdentityFromGUI().then((newAssertion) => {\r\n          IdentityModule_log.log('[IdentityModule._getIdAssertionForDomain] Identity selected by hyperty.');\r\n          return resolve(newAssertion);\r\n        }, (err) => {\r\n          return reject(err);\r\n        });\r\n      });\r\n\r\n    });\r\n\r\n  }\r\n\r\n  _refreshIdAssertion(assertion) {\r\n    let _this = this;\r\n\r\n    return new Promise((resolve, reject) => {\r\n      _this.sendRefreshMessage(assertion).then((newAssertion) => {\r\n        IdentityModule_log.log('[Identity.IdentityModule.getValidToken] refreshed assertion: ', newAssertion);\r\n        _this.identities.updateAssertion(newAssertion).then(() => {\r\n          resolve(newAssertion);\r\n        }, (err) => {\r\n          IdentityModule_log.error('[IdentityModule.getValidToken] error updating the assertion ', err);\r\n          reject(err);\r\n        });\r\n      }, (err) => {\r\n        IdentityModule_log.error('[IdentityModule.getValidToken] error refreshing the assertion ', err);\r\n        reject(err);\r\n      });\r\n\r\n    });\r\n  }\r\n\r\n\r\n  /**\r\n  * Function to return all the users URLs registered within a session\r\n  * These users URLs are returned in an array of strings.\r\n  * @return {Array<String>}         users\r\n  */\r\n  getUsersIDs() {\r\n    /*  log.log('[getUsersIDs:emailFormat]', emailFormat);\r\n      log.log('getUsersIDs:emailFormat', emailFormat);\r\n      let _this = this;\r\n      let users = [];*/\r\n\r\n    //if request comes with the emailFormat option, then convert url to email format\r\n    /*    let converter = (emailFormat) ? getUserEmailFromURL : (value) => { return value; };\r\n\r\n    for (let index in _this.identities) {\r\n      let identity = _this.identities[index];\r\n      users.push(converter(identity.identity));\r\n    }*/\r\n\r\n    return this.identities.identifiers;\r\n  }\r\n\r\n  /**\r\n  * Function to remove an identity\r\n  * @param {String}    userURL      userURL\r\n  * @return {Promise}\r\n  */\r\n\r\n  deleteIdentity(userURL) {\r\n\r\n    return this.identities.removeIdentity(userURL);\r\n\r\n  }\r\n\r\n  /**\r\n  * Function to unregister an identity from the emailsList array and not show in to the GUI\r\n  * @param {String}    email      email\r\n  */\r\n  /*  unregisterIdentity(email) {\r\n    let _this = this;\r\n\r\n    for (let e in _this.emailsList) {\r\n      if (_this.emailsList[e] === email) {\r\n        _this.emailsList.splice(e, 1);\r\n      }\r\n    }\r\n  }*/\r\n\r\n  // to be used when runtime is not executed in a sandbox\r\n\r\n  listenShowAdmin(callback) {\r\n    this._showAdmin = callback;\r\n  }\r\n\r\n  /**\r\n  * Function that sends a request to the GUI using messages. Sends all identities registered and\r\n  * the Idps supported, and return the identity/idp received by the GUI\r\n  * @param {Array<identity>}  identities      list of identitiies\r\n  * @param {Array<String>}    idps            list of idps to authenticate\r\n  * @return {Promise}         returns a chosen identity or idp\r\n  */\r\n  requestIdentityToGUI(identities, idps) {\r\n    IdentityModule_log.log('[IdentityModule.requestIdentityToGUI:identities]', identities);\r\n    IdentityModule_log.log('[IdentityModule.requestIdentityToGUI:idps]', idps);\r\n\r\n    let _this = this;\r\n    return new Promise(function (resolve, reject) {\r\n\r\n      //condition to check if the real GUI is deployed. If not, deploys a fake gui\r\n      if (_this.guiDeployed === false) {\r\n        let guiFakeURL = _this._guiURL;\r\n        let guiFake = new identity_GuiFake(guiFakeURL, _this._messageBus);\r\n        _this.guiFake = guiFake;\r\n        _this.guiDeployed = true;\r\n      }\r\n\r\n      let message = {\r\n        type: 'create', to: _this._guiURL, from: _this._idmURL,\r\n        body: { value: { identities: identities, idps: idps } }\r\n      };\r\n\r\n      let callback = msg => {\r\n        _this._messageBus.removeResponseListener(_this._idmURL, msg.id);\r\n\r\n\r\n        // todo: to return the user URL and not the email or identifier\r\n\r\n        if (msg.body.code === 200) {\r\n          let selectedIdentity = msg.body;\r\n\r\n          IdentityModule_log.log('selectedIdentity: ', selectedIdentity.value);\r\n          resolve(selectedIdentity);\r\n        } else {\r\n          reject('error on requesting an identity to the GUI');\r\n        }\r\n      };\r\n\r\n      //postMessage with callback but without timeout\r\n      try {\r\n        _this._messageBus.postMessage(message, callback, false);\r\n      } catch (err) {\r\n        reject('In method callIdentityModuleFunc error: ' + err);\r\n      }\r\n    });\r\n  }\r\n\r\n  callNodeJsGenerateMethods(idp, origin) {\r\n    IdentityModule_log.log('[callNodeJsGenerateMethods:idp]', idp);\r\n    IdentityModule_log.log('[callNodeJsGenerateMethods:origin]', origin);\r\n    let _this = this;\r\n\r\n    return new Promise((resolve, reject) => {\r\n      //debugger;\r\n      let publicKey;\r\n\r\n      //let keyPair = nodeJSKeyPairPopulate;\r\n\r\n      //generates the RSA key pair\r\n      _this._crypto.getMyPublicKey().then(function (key) {\r\n\r\n        IdentityModule_log.log('[callNodeJsGenerateMethods:key]', key);\r\n\r\n        publicKey = stringify(key);\r\n\r\n        IdentityModule_log.log('[callNodeJsGenerateMethods] NO_URL');\r\n\r\n        return _this.generateAssertion(publicKey, origin, 'url', idp);\r\n\r\n      }).then(function (value) {\r\n        if (value) {\r\n          resolve(value);\r\n        } else {\r\n          reject('Error on obtaining Identity');\r\n        }\r\n      }).catch(function (err) {\r\n        IdentityModule_log.log(err);\r\n        reject(err);\r\n\r\n      });\r\n    });\r\n  }\r\n\r\n  callGenerateMethods(idp, origin) {\r\n    IdentityModule_log.log('[callGenerateMethods:idp]', idp);\r\n    IdentityModule_log.log('[callGenerateMethods:origin]', origin);\r\n    let _this = this;\r\n\r\n    return new Promise((resolve, reject) => {\r\n\r\n      let publicKey;\r\n\r\n      //generates the RSA key pair\r\n      _this._crypto.getMyPublicKey().then(function (key) {\r\n\r\n        IdentityModule_log.log('[callGenerateMethods:key]', key);\r\n\r\n        publicKey = stringify(key);\r\n\r\n        //        userkeyPair = keyPair;\r\n        IdentityModule_log.log('generateAssertion:no_hint');\r\n        return _this.generateAssertion(publicKey, origin, '', idp);\r\n\r\n      }).then(function (url) {\r\n        _this.myHint = url;\r\n        IdentityModule_log.log('generateAssertion:hint');\r\n        return _this.generateAssertion(publicKey, origin, url, idp);\r\n\r\n      }).then(function (value) {\r\n        if (value) {\r\n          resolve(value);\r\n        } else {\r\n          reject('Error on obtaining Identity');\r\n        }\r\n      }).catch(function (err) {\r\n        IdentityModule_log.error(err);\r\n        reject(err);\r\n      });\r\n    });\r\n  }\r\n\r\n\r\n  loginSelectedIdentity(publicKey, origin, idp, loginUrl) {\r\n    IdentityModule_log.log('[loginSelectedIdentity:publicKey]', publicKey);\r\n    IdentityModule_log.log('[loginSelectedIdentity:origin]', origin);\r\n    IdentityModule_log.log('[loginSelectedIdentity:idp]', idp);\r\n\r\n    //    log.log('[loginSelectedIdentity:keyPair]', keyPair);\r\n    IdentityModule_log.log('[loginSelectedIdentity:loginUrl]', loginUrl);\r\n    let _this = this;\r\n\r\n    return new Promise((resolve, reject) => {\r\n      IdentityModule_log.log('[IdentityModule] openPopup');\r\n      _this.callIdentityModuleFunc('openPopup', { urlreceived: loginUrl }).then((idCode) => {\r\n        return idCode;\r\n      }, (err) => {\r\n        IdentityModule_log.error('Error while logging in for the selected identity.');\r\n        return reject(err);\r\n      }).then((idCode) => {\r\n        _this.sendGenerateMessage(publicKey, origin, idCode, idp).then((newResponse) => {\r\n          if (newResponse.hasOwnProperty('assertion')) {\r\n            _this.identities.addAssertion(newResponse).then(result => {\r\n              resolve('Login was successfull');\r\n            }).catch(err => { reject('Login has failed:' + err); });\r\n          } else {\r\n            IdentityModule_log.error('Error while logging in for the selected identity.');\r\n            return reject('Could not generate a valid assertion for selected identity.');\r\n          }\r\n        }).catch(err => { reject('On loginSelectedIdentity from method sendGenerateMessage error:  ' + err); });\r\n      });\r\n    });\r\n  }\r\n\r\n\r\n  selectIdentityForHyperty(origin, idp, idHint) {\r\n    IdentityModule_log.log('[selectIdentityForHyperty:origin]', origin);\r\n    IdentityModule_log.log('[selectIdentityForHyperty:idp]', idp);\r\n    IdentityModule_log.log('[selectIdentityForHyperty:idHint]', idHint);\r\n    let _this = this;\r\n\r\n    return new Promise((resolve, reject) => {\r\n\r\n      //generates the RSA key pair\r\n      _this._crypto.getMyPublicKey().then(function (key) {\r\n        let publicKey = stringify(key);\r\n\r\n        _this.sendGenerateMessage(publicKey, origin, idHint, idp).then((response) => {\r\n          if (response.hasOwnProperty('assertion')) { // identity was logged in, just save it\r\n            _this.identities.addAssertion(response).then((value) => {\r\n              return resolve(response);\r\n            }, (err) => {\r\n              return reject(err);\r\n            });\r\n          } else if (response.hasOwnProperty('loginUrl')) { // identity was not logged in\r\n            _this.loginSelectedIdentity(publicKey, origin, idp, response.loginUrl).then((value) => {\r\n              return resolve(value);\r\n            }, (err) => {\r\n              return reject(err);\r\n            });\r\n          } else { // you should never get here, if you do then the IdP Proxy is not well implemented\r\n            // log.error('GenerateAssertion returned invalid response.');\r\n            IdentityModule_log.log('Proceeding by logging in.');\r\n            _this.callGenerateMethods(idp, origin).then((value) => {\r\n              return resolve(value);\r\n            }, (err) => {\r\n              return reject(err);\r\n            });\r\n          }\r\n        }).catch(err => { reject('On selectIdentityForHyperty from method sendGenerateMessage error:  ' + err); });\r\n      }).catch(err => { reject('On selectIdentityForHyperty from method generateRSAKeyPair error:  ' + err); });\r\n    });\r\n  }\r\n\r\n  selectIdentityFromGUI(origin) {\r\n    IdentityModule_log.log('[IdentityModule.selectIdentityFromGUI:origin]', origin);\r\n    let _this = this;\r\n\r\n    return new Promise((resolve, reject) => {\r\n\r\n      this.getIdentitiesToChoose().then((identitiesInfo) => {\r\n        return _this.requestIdentityToGUI(identitiesInfo.identities, identitiesInfo.idps);\r\n      }).then(value => {\r\n\r\n        if (value.type === 'identity') {\r\n\r\n          //  let chosenID = getUserURLFromEmail(value.value);\r\n          // hack while the user url is not returned from requestIdentityToGUI;\r\n\r\n          /*          let chosenID = 'user://' + _this.identities.currentIdentity.idp.domain + '/' + value.value;\r\n\r\n          _this.identities.defaultIdentity = _this.identities.currentIdentity;*/\r\n\r\n          // returns the identity info from the chosen id\r\n          //          if (_this.identities.currentIdentity) resolve(_this.identities.currentIdentity.assertion);\r\n          if (_this.identities.identities[value.value]) resolve(_this.identities.identities[value.value]);\r\n          else reject('[IdentityModule.selectIdentityFromGUI] identity not found: ', value.value);\r\n        } else if (value.type === 'idp') {\r\n\r\n          _this.callGenerateMethods(value.value, origin).then((value) => {\r\n            return resolve(value);\r\n          }, (err) => {\r\n            return reject(err);\r\n          });\r\n\r\n        } else {\r\n          return reject('error on GUI received message.');\r\n        }\r\n      }).catch(err => { reject('On selectIdentityFromGUI from method requestIdentityToGUI error:  ' + err); });\r\n    });\r\n  }\r\n\r\n\r\n  callIdentityModuleFunc(methodName, parameters, domain, resource) {\r\n    IdentityModule_log.log('[callIdentityModuleFunc:methodName]', methodName);\r\n    IdentityModule_log.log('[callIdentityModuleFunc:parameters]', parameters);\r\n    let _this = this;\r\n\r\n    return new Promise((resolve, reject) => {\r\n\r\n      if (_this._showAdmin) {\r\n        if (methodName === 'getAccessToken') {\r\n          _this._showAdmin(methodName, parameters.urlreceived, domain, resource).then((result) => {\r\n            resolve(result);\r\n          });\r\n        } else _this._showAdmin(methodName);\r\n      }\r\n      else {\r\n        let message = {\r\n          type: 'execute', to: _this._guiURL, from: _this._idmURL,\r\n          body: { resource: 'identity', method: methodName, params: parameters }\r\n        };\r\n\r\n        //post msg with callback but without timout\r\n        let callback = msg => {\r\n          _this._messageBus.removeResponseListener(_this._idmURL, msg.id);\r\n          let result = msg.body.value;\r\n          resolve(result);\r\n        };\r\n        try {\r\n\r\n          _this._messageBus.postMessage(message, callback, false);\r\n\r\n        } catch (err) {\r\n          reject('In method callIdentityModuleFunc error: ' + err);\r\n        }\r\n\r\n      }\r\n    });\r\n  }\r\n\r\n  //******************* TOKEN METHODS *******************\r\n  /**\r\n  * get a Token to be added to a message\r\n  * @param  {String}  fromURL     origin of the message\r\n  * @param  {String}  toURL     target of the messageok\r\n  * @return {JSON}    token    token to be added to the message\r\n  */\r\n  getToken(msg) {\r\n    let _this = this;\r\n    let fromURL = msg.from;\r\n    let toUrl = msg.to;\r\n    if (msg.hasOwnProperty('body') && msg.body.hasOwnProperty('source')) {\r\n      fromURL = msg.body.source;\r\n    }\r\n\r\n    if (msg.type === 'forward') {\r\n      fromURL = msg.body.from;\r\n    }\r\n\r\n    if (msg.hasOwnProperty('body') && msg.body.hasOwnProperty('subscriber')) {\r\n      fromURL = msg.body.subscriber;\r\n    }\r\n\r\n    return new Promise(function (resolve, reject) {\r\n      IdentityModule_log.log('[IdentityModule.getToken] for msg ', msg);\r\n\r\n      //log.log('toUrl', toUrl);\r\n      _this.registry.isLegacy(toUrl).then(function (result) {\r\n        // log.log('[Identity.IdentityModule.getToken] isLEGACY: ', result);\r\n        if (result) {\r\n\r\n          _this._getAccessToken(msg).then((token) => {\r\n            IdentityModule_log.log('[IdentityModule.getToken] access token ', token);\r\n            resolve(deepClone(token));\r\n          }).catch(err => { reject('[IdentityModule.getToken] Access Token error ' + err); });\r\n        } else {\r\n          _this._getValidToken(fromURL).then((token) => {\r\n            resolve(token);\r\n          }).catch(err => { reject('On getToken from method _getValidToken error: ' + err); });\r\n        }\r\n      }).catch(err => { reject('On getToken from method isLegacy error: ' + err); });\r\n    });\r\n  }\r\n\r\n\r\n  /**\r\n  * get an Id Token for a HypertyURL\r\n  * @param  {String}  hypertyURL     the Hyperty address\r\n  * @return {JSON}    token    Id token to be added to the message\r\n  */\r\n  getIdToken(hypertyURL) {\r\n    IdentityModule_log.info('getIdToken:hypertyURL ', hypertyURL);\r\n    let _this = this;\r\n    return new Promise(function (resolve, reject) {\r\n      let splitURL = hypertyURL.split('://');\r\n      let userURL;\r\n      if (splitURL[0] !== 'hyperty') { // it is a Data Object URL\r\n\r\n        _this._getHypertyFromDataObject(hypertyURL).then((returnedHypertyURL) => {\r\n\r\n          userURL = _this.registry.getHypertyOwner(returnedHypertyURL);\r\n\r\n          if (userURL) {\r\n            let identity = _this.identities.getIdentity(userURL);\r\n            if (identity) return resolve(identity);\r\n            else return reject('[IdentityModule.getIdToken] Identity not found for: ', userURL);\r\n          } else { return reject('[IdentityModule.getIdToken] User not found for hyperty: ', returnedHypertyURL); }\r\n        }).catch((reason) => {\r\n          IdentityModule_log.error('[IdentityModule.getIdToken] Error: ', reason);\r\n          reject(reason);\r\n        });\r\n      } else {\r\n        userURL = _this.registry.getHypertyOwner(hypertyURL);\r\n        if (userURL) {\r\n\r\n          let identity = _this.identities.getIdentity(userURL);\r\n          if (identity) return resolve(identity);\r\n          else return reject('[IdentityModule.getIdToken] Identity not found for: ', userURL);\r\n\r\n        } else { return reject('[IdentityModule.getIdToken] User not found for hyperty: ', userURL); }\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n  * get an Access Token for an external API\r\n  * @param  {String}  url     the external url\r\n  * @return {JSON}    token    Access token to be added to the message\r\n  */\r\n  _getAccessToken(msg) {\r\n    let url = msg.to;\r\n\r\n    let _this = this;\r\n\r\n    return new Promise((resolve) => {\r\n      if (!msg.hasOwnProperty('body')) {\r\n        return reject('[IdentityModule._getAccessToken] missing mandatory msg body: ', msg);\r\n      }\r\n      if (!msg.body.hasOwnProperty('value')) {\r\n        return reject('[IdentityModule._getAccessToken] missing mandatory msg body value: ', msg);\r\n      }\r\n      if (!msg.body.value.hasOwnProperty('resources')) {\r\n        return reject('[IdentityModule._getAccessToken] missing mandatory msg body value resources: ', msg);\r\n      }\r\n      let domainToCheck = divideURL(url).domain;\r\n\r\n      if (url.includes('protostub')) {\r\n        domainToCheck = domainToCheck.replace(domainToCheck.split('.')[0] + '.', '');\r\n      }\r\n\r\n      let resources = msg.body.value.resources;\r\n\r\n      _this._getAccessTokenForDomain(domainToCheck, resources).then((token) => {\r\n        resolve(token);\r\n      });\r\n\r\n    });\r\n\r\n\r\n\r\n  }\r\n\r\n  _getAccessTokenForDomain(domainToCheck, resources) {\r\n    let _this = this;\r\n    let token;\r\n\r\n    return new Promise((resolve, reject) => {\r\n\r\n      try {\r\n        token = _this.identities.getAccessToken(domainToCheck, resources);\r\n      } catch (e) {\r\n        return reject('[IdentityModule._getAccessTokenForDomain] Access Token error ' + err);\r\n      }\r\n\r\n      if (!token) {\r\n        _this._getNewAccessToken(domainToCheck, resources).then((token) => {\r\n          IdentityModule_log.log('[Identity.IdentityModule._getAccessTokenForDomain] new Access Token ', token);\r\n          return resolve(token);\r\n        }).catch(err => { reject('[IdentityModule._getAccessTokenForDomain] on getNewAccessToken ' + err); });\r\n      } else if (token.status === 'in-progress') {\r\n        return resolve(_this._inProgressAccessToken(domainToCheck, resources));\r\n      } else {\r\n        let timeNow = secondsSinceEpoch();\r\n\r\n        IdentityModule_log.log('[Identity.IdentityModule._getAccessTokenForDomain] found  Access Token ', token);\r\n\r\n        if (timeNow >= token.expires) {\r\n          //        if (true) {\r\n          if (token.hasOwnProperty(\"refresh\")) {\r\n            _this._refreshAccessToken(deepClone(token)).then((newToken) => {\r\n              return resolve(_this.identities.updateAccessToken(newToken));\r\n            });\r\n          } else {\r\n            _this._revokeAccessToken(token, domainToCheck, resources).then(() => {\r\n              setTimeout(() => {\r\n                return _this._getNewAccessToken(domainToCheck, resources);\r\n\r\n              }, 1000);\r\n\r\n            });\r\n\r\n          } \r\n\r\n        } else return resolve(deepClone(token));\r\n      }\r\n\r\n    });\r\n  }\r\n\r\n\r\n  _revokeAccessToken(token, domain, resources) {\r\n\r\n    let _this = this;\r\n\r\n    //    let domain = _this._resolveDomain(oldIdentity.idp);\r\n    //    let message;\r\n    //    let assertion = _this.getIdentity(oldIdentity.userProfile.userURL);\r\n\r\n    IdentityModule_log.log('[IdentityModule._revokeAccessToken] to be revoked ', token);\r\n\r\n    return new Promise((resolve, reject) => {\r\n\r\n//      let domain = _this._resolveDomain(token.domain);\r\n      let message;\r\n\r\n      message = {\r\n        type: 'execute',\r\n        to: _this._resolveDomain(token.domain),\r\n        from: _this._idmURL,\r\n        body: {\r\n          method: 'revokeAccessToken',\r\n          params: { token: token }\r\n        }\r\n      };\r\n\r\n      IdentityModule_log.log('[IdentityModule._revokeAccessToken] revoke msg ', message);\r\n\r\n      try {\r\n        _this._messageBus.postMessage(message, (res) => {\r\n\r\n          let result = res.body.value;\r\n          if (result) _this._identities.removeAccessToken(domain, resources).then(()=>{\r\n            resolve(result);\r\n\r\n          });\r\n          resolve();\r\n        });\r\n      } catch (err) {\r\n        reject('In IdentityModule._revokeAccessToken on postMessage error: ' + err);\r\n      }\r\n\r\n    });\r\n\r\n\r\n\r\n\r\n  }\r\n\r\n\r\n  _inProgressAccessToken(domain, resources) {\r\n    this.identities.watchingYou.observe('accessTokens', (change) => {\r\n\r\n      IdentityModule_log.log('[IdentityModule._inProgressAccessToken] accessTokens changed ' + this.identities.accessTokens);\r\n\r\n      let keypath = change.keypath;\r\n\r\n      if (keypath.includes('status')) {\r\n        keypath = keypath.replace('.status', '');\r\n      }\r\n\r\n      if (keypath === domain && change.name === 'status' && change.newValue === 'created') {\r\n        // log.log('[Identity.IdentityModule.getToken] token is created ' + _this.identitiesList[domain]);\r\n        return (this.identities.getAccessToken(domain, resources));\r\n      }\r\n    });\r\n\r\n  }\r\n\r\n\r\n  _getNewAccessToken(domain, resources) {\r\n    let _this = this;\r\n\r\n    return new Promise(function (resolve, reject) {\r\n\r\n      _this.identities.setAccessTokenInProgress(domain);\r\n\r\n      let message = {\r\n        type: 'execute',\r\n        to: _this._resolveDomain(domain),\r\n        from: _this._idmURL,\r\n        body: {\r\n          method: 'getAccessTokenAuthorisationEndpoint',\r\n          params: resources\r\n        }\r\n      };\r\n\r\n      //let's first get the authorisation URL from the Idp Proxy\r\n      _this._messageBus.postMessage(message, (res) => {\r\n        if (res.body.code > 299) {\r\n          return reject('[IdentityModule._getNewAccessToken] Error on getAccessTokenAuthorisationEndpoint from IdP Proxy: ', res.body.desc);\r\n        }\r\n\r\n        // let's ask the user for authorisation\r\n        _this.callIdentityModuleFunc('getAccessToken', { urlreceived: res.body.value }, domain, resources[0]).then((authorisation) => {\r\n          IdentityModule_log.log('[IdentityModule:callIdentityModuleFunc:openPopup] auhtorisation result: ', authorisation);\r\n\r\n          message.body.method = 'getAccessToken';\r\n          message.body.params = {\r\n            resources: resources,\r\n            login: authorisation\r\n          };\r\n\r\n          //wihtout callback to avoid timeout errors?\r\n\r\n          // let's ask Access Token from the Idp Proxy\r\n          _this._messageBus.postMessage(message, (res) => {\r\n            if (res.body.code > 299) return reject('[IdentityModule._getNewAccessToken] Error on getAccessToken from IdP Proxy: ', res.body.desc);\r\n\r\n            _this.identities.addAccessToken(res.body.value).then((token) => {\r\n              IdentityModule_log.info('[IdentityModule._getNewAccessToken] resolving token: ', token);\r\n              return resolve(res.body.value);\r\n\r\n            }, (err) => {\r\n              reject(err);\r\n            });\r\n          });\r\n        }, (err) => {\r\n          reject(err);\r\n        });\r\n\r\n      });\r\n\r\n    });\r\n  }\r\n\r\n\r\n  _refreshAccessToken(outdatedToken) {\r\n    let _this = this;\r\n\r\n    //    let domain = _this._resolveDomain(oldIdentity.idp);\r\n    //    let message;\r\n    //    let assertion = _this.getIdentity(oldIdentity.userProfile.userURL);\r\n\r\n    IdentityModule_log.log('IdentityModule._refreshAccessToken:outdatedToken', outdatedToken);\r\n\r\n    return new Promise((resolve, reject) => {\r\n\r\n      let domain = _this._resolveDomain(outdatedToken.domain);\r\n      let message;\r\n\r\n      message = { type: 'execute', to: domain, from: _this._idmURL, body: { method: 'refreshAccessToken', params: { token: outdatedToken } } };\r\n      try {\r\n        _this._messageBus.postMessage(message, (res) => {\r\n          let result = res.body.value;\r\n          resolve(result);\r\n        });\r\n      } catch (err) {\r\n        reject('In IdentityModule._refreshAccessToken on postMessage error: ' + err);\r\n      }\r\n\r\n    });\r\n\r\n  }\r\n\r\n  sendRefreshMessage(oldIdentity) {\r\n    let _this = this;\r\n\r\n    //    let domain = _this._resolveDomain(oldIdentity.idp);\r\n    //    let message;\r\n    //    let assertion = _this.getIdentity(oldIdentity.userProfile.userURL);\r\n\r\n    IdentityModule_log.log('sendRefreshMessage:oldIdentity', oldIdentity);\r\n\r\n    return new Promise((resolve, reject) => {\r\n      let domain = _this._resolveDomain(oldIdentity.idp.domain);\r\n      let message;\r\n      let assertion = _this.getIdentity(oldIdentity.userProfile.userURL);\r\n\r\n      IdentityModule_log.info('sendRefreshMessage:oldIdentity', oldIdentity);\r\n\r\n      message = { type: 'execute', to: domain, from: _this._idmURL, body: { resource: 'identity', method: 'refreshAssertion', params: { identity: assertion } } };\r\n      try {\r\n        _this._messageBus.postMessage(message, (res) => {\r\n          if (res.body.code < 300) {\r\n            let result = res.body.value;\r\n            resolve(result);\r\n          } else resolve(oldIdentity);\r\n        });\r\n      } catch (err) {\r\n        reject('In sendRefreshMessage on postMessage error: ' + err);\r\n      }\r\n\r\n    });\r\n\r\n  }\r\n\r\n  getAccessToken(idpDomain, resources, login) {\r\n    IdentityModule_log.log('[getAccessToken:idpDomain]', idpDomain);\r\n    let _this = this;\r\n\r\n    return new Promise((resolve, reject) => {\r\n\r\n      let domain = _this._resolveDomain(idpDomain);\r\n      let message;\r\n\r\n      message = {\r\n        type: 'execute', to: domain, from: _this._idmURL, body: { resource: 'identity', method: 'getAccessToken', params: { resources: resources, login: login } }\r\n      };\r\n      try {\r\n        _this._messageBus.postMessage(message, (res) => {\r\n\r\n          if (res.body.code < 299) {\r\n            let result = res.body.value;\r\n            resolve(result);\r\n          } else resolve(res.body);\r\n        });\r\n      } catch (err) {\r\n        reject('IdentityModule.In getAccessToken: ' + err);\r\n      }\r\n    });\r\n  }\r\n\r\n  getAccessTokenAuthorisationEndpoint(scope, idpDomain) {\r\n    IdentityModule_log.log('[getAccessTokenAuthorisationEndpoint:idpDomain]', idpDomain);\r\n    let _this = this;\r\n\r\n    return new Promise((resolve, reject) => {\r\n\r\n      let domain = _this._resolveDomain(idpDomain);\r\n      let message;\r\n\r\n      message = {\r\n        type: 'execute', to: domain, from: _this._idmURL, body: { resource: 'identity', method: 'getAccessTokenAuthorisationEndpoint', params: { resources: scope } }\r\n      };\r\n      try {\r\n        _this._messageBus.postMessage(message, (res) => {\r\n          let result = res.body.value;\r\n          resolve(result);\r\n        });\r\n      } catch (err) {\r\n        reject('In getAccessTokenAuthorisationEndpoint: ' + err);\r\n      }\r\n    });\r\n  }\r\n\r\n  sendGenerateMessage(contents, origin, usernameHint, idpDomain) {\r\n    IdentityModule_log.log('[sendGenerateMessage:contents]', contents);\r\n    IdentityModule_log.log('[sendGenerateMessage:origin]', origin);\r\n    IdentityModule_log.log('[sendGenerateMessage:usernameHint]', usernameHint);\r\n    IdentityModule_log.log('[sendGenerateMessage:idpDomain]', idpDomain);\r\n    IdentityModule_log.log('sendGenerateMessage_hint');\r\n    let _this = this;\r\n\r\n    return new Promise((resolve, reject) => {\r\n\r\n      let domain = _this._resolveDomain(idpDomain);\r\n      let message;\r\n\r\n      message = {\r\n        type: 'execute', to: domain, from: _this._idmURL, body: { resource: 'identity', method: 'generateAssertion', params: { contents: contents, origin: origin, usernameHint: usernameHint } }\r\n      };\r\n      try {\r\n        _this._messageBus.postMessage(message, (res) => {\r\n\r\n          if (res.body.code < 300) resolve(res.body.value);\r\n          else reject(res.body);\r\n        });\r\n      } catch (err) {\r\n        reject('In sendGenerateMessage: ' + err);\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n  * Requests the IdpProxy from a given Domain for an identityAssertion\r\n  *\r\n  * @param  {DOMString} contents     contents\r\n  * @param  {DOMString} origin       origin\r\n  * @param  {DOMString} usernameHint usernameHint\r\n  * @param  {JSON}      keyPair       user keyPair\r\n  * @return {IdAssertion}              IdAssertion\r\n  */\r\n  generateAssertion(contents, origin, usernameHint, idpDomain) {\r\n    IdentityModule_log.log('[generateAssertion:contents]', contents);\r\n    IdentityModule_log.log('[generateAssertion:origin]', origin);\r\n    IdentityModule_log.log('[generateAssertion:usernameHint]', usernameHint);\r\n\r\n    //    log.log('[generateAssertion:keyPair]', keyPair);\r\n    IdentityModule_log.log('[generateAssertion:idpDomain]', idpDomain);\r\n    let _this = this;\r\n\r\n    return new Promise(function (resolve, reject) {\r\n      IdentityModule_log.log('[IdentityModule:sendGenerateMessage:sendGenerateMessage]', usernameHint);\r\n      _this.sendGenerateMessage(contents, origin, usernameHint, idpDomain).then((result) => {\r\n\r\n        if (result) {\r\n\r\n          _this.identities.addAssertion(result).then((value) => {\r\n            resolve(result);\r\n          }, (err) => {\r\n            reject(err);\r\n          });\r\n\r\n        } else {\r\n          reject('error on obtaining identity information');\r\n        }\r\n\r\n      }, (error) => {\r\n        if (error.hasOwnProperty('description') && error.description.hasOwnProperty('loginUrl')) {\r\n          _this.callIdentityModuleFunc('login', { urlreceived: error.description.loginUrl }).then((value) => {\r\n            IdentityModule_log.log('[IdentityModule:callIdentityModuleFunc:openPopup]', usernameHint);\r\n\r\n            resolve(value);\r\n          }, (err) => {\r\n            reject(err);\r\n          });\r\n        } else {\r\n          IdentityModule_log.error('[IdentityModule:sendGenerateMessage] generate assertion with hint error ', error);\r\n          reject(error);\r\n        }\r\n      }).catch(err => { reject('On generateAssertion from method sendGenerateMessage error: ' + err); });\r\n    });\r\n  }\r\n\r\n  /**\r\n  * Requests the IdpProxy from a given Domain to validate an IdentityAssertion\r\n  * Returns a promise with the result from the validation.\r\n  * @param  {DOMString} assertion\r\n  * @param  {DOMString} origin       origin\r\n  * @return {Promise}         Promise         promise with the result from the validation\r\n  */\r\n  validateAssertion(assertion, origin, idpDomain) {\r\n    IdentityModule_log.log('[validateAssertion:assertion]', assertion);\r\n    IdentityModule_log.log('[validateAssertion:origin]', origin);\r\n    IdentityModule_log.log('[validateAssertion:idpDomain]', idpDomain);\r\n    let _this = this;\r\n\r\n    let domain = _this._resolveDomain(idpDomain);\r\n\r\n    let message = {\r\n      type: 'execute', to: domain, from: _this._idmURL, body: {\r\n        resource: 'identity', method: 'validateAssertion',\r\n        params: { assertion: assertion, origin: origin }\r\n      }\r\n    };\r\n\r\n    return new Promise(function (resolve, reject) {\r\n      try {\r\n        _this._messageBus.postMessage(message, (result) => {\r\n          if (result.body.code === 200) {\r\n            resolve(result.body.value);\r\n          } else {\r\n            reject('error', result.body.code);\r\n          }\r\n        });\r\n      } catch (err) {\r\n        reject('On validateAssertion from method postMessage error: ' + err);\r\n      }\r\n    });\r\n  }\r\n\r\n  addGUIListeners() {\r\n    let _this = this;\r\n\r\n    _this._messageBus.addListener(_this._idmURL, (msg) => {\r\n      let funcName = msg.body.method;\r\n\r\n      IdentityModule_log.log('[IdentityModule:addGUIListeners]', msg, msg.body, funcName);\r\n\r\n      let returnedValue;\r\n\r\n      if (funcName === 'deployGUI') {\r\n        returnedValue = _this.deployGUI();\r\n      } else if (funcName === 'getIdentitiesToChoose') {\r\n        _this.getIdentitiesToChoose().then((result) => {\r\n          // if the function requested is not a promise\r\n          let value = { type: 'execute', value: result, code: 200 };\r\n          let replyMsg = { id: msg.id, type: 'response', to: msg.from, from: msg.to, body: value };\r\n          try {\r\n            _this._messageBus.postMessage(replyMsg);\r\n          } catch (err) {\r\n            IdentityModule_log.error('On addGUIListeners from if storeIdentity method postMessage error: ' + err);\r\n          }\r\n        });\r\n        return;\r\n\r\n      } else if (funcName === 'unregisterIdentity') {\r\n        let email = msg.body.params.email;\r\n        returnedValue = _this.unregisterIdentity(email);\r\n      } else if (funcName === 'getMyPublicKey') {\r\n        // because generateRSAKeyPair is a promise\r\n        // we have to send the message only after getting the key pair\r\n        _this._crypto.getMyPublicKey().then((pubKey) => {\r\n          pubKey = stringify(pubKey);\r\n          let value = { type: 'execute', value: pubKey, code: 200 };\r\n          let replyMsg = { id: msg.id, type: 'response', to: msg.from, from: msg.to, body: value };\r\n          try {\r\n            _this._messageBus.postMessage(replyMsg);\r\n          } catch (err) {\r\n            IdentityModule_log.error('On addGUIListeners from if generateRSAKeyPair method postMessage error: ' + err);\r\n          }\r\n        });\r\n        return;\r\n      } else if (funcName === 'sendGenerateMessage') {\r\n        let contents = msg.body.params.contents;\r\n        let origin = msg.body.params.origin;\r\n        let usernameHint = msg.body.params.usernameHint;\r\n        let idpDomain = msg.body.params.idpDomain;\r\n        let replyMsg = { id: msg.id, type: 'response', to: msg.from, from: msg.to };\r\n        _this.sendGenerateMessage(contents, origin, usernameHint, idpDomain).then((returnedValue) => {\r\n          let value = { type: 'execute', value: returnedValue, code: 200 };\r\n          replyMsg.body = value;\r\n          try {\r\n            _this._messageBus.postMessage(replyMsg);\r\n          } catch (err) {\r\n            IdentityModule_log.error('IdentityModule.addGUIListeners sendGenerateMessage error: ' + err);\r\n          }\r\n\r\n        }, (err) => {\r\n          IdentityModule_log.info('IDPProxy generateAssertion reply error ' + err);\r\n          replyMsg.body = err;\r\n          _this._messageBus.postMessage(replyMsg);\r\n\r\n        });\r\n        return;\r\n      } else if (funcName === 'getAccessTokenAuthorisationEndpoint') {\r\n        let scope = msg.body.params.scope;\r\n        let idpDomain = msg.body.params.idpDomain;\r\n        _this.getAccessTokenAuthorisationEndpoint(scope, idpDomain).then((returnedValue) => {\r\n          let value = { type: 'execute', value: returnedValue, code: 200 };\r\n          let replyMsg = { id: msg.id, type: 'response', to: msg.from, from: msg.to, body: value };\r\n          try {\r\n            _this._messageBus.postMessage(replyMsg);\r\n          } catch (err) {\r\n            IdentityModule_log.error('On addGUIListeners from if sendGenerateMessage method postMessage error: ' + err);\r\n          }\r\n\r\n        });\r\n        return;\r\n      } else if (funcName === 'addAccessToken') {\r\n        let accessToken = msg.body.params;\r\n\r\n        _this.identities.addAccessToken(accessToken).then((returnedValue) => {\r\n          let value = { type: 'execute', value: returnedValue, code: 200 };\r\n          let replyMsg = { id: msg.id, type: 'response', to: msg.from, from: msg.to, body: value };\r\n          try {\r\n            _this._messageBus.postMessage(replyMsg);\r\n          } catch (err) {\r\n            IdentityModule_log.error('On addGUIListeners from if storeIdentity method postMessage error: ' + err);\r\n          }\r\n\r\n        });\r\n        return;\r\n      } else if (funcName === 'getAccessToken') {\r\n\r\n        let domain = msg.body.params.idpDomain;\r\n        let resources = msg.body.params.resources;\r\n        let login = msg.body.params.login;\r\n        let replyMsg = { id: msg.id, type: 'response', to: msg.from, from: msg.to };\r\n\r\n        _this.getAccessToken(domain, resources, login).then((returnedValue) => {\r\n          let value = { type: 'execute', value: returnedValue, code: 200 };\r\n          replyMsg.body = value;\r\n          try {\r\n            _this._messageBus.postMessage(replyMsg);\r\n          } catch (err) {\r\n            IdentityModule_log.error('On addGUIListeners from if sendGenerateMessage method postMessage error: ' + err);\r\n          }\r\n\r\n        }, (error) => {\r\n          try {\r\n            replyMsg.body = error;\r\n            _this._messageBus.postMessage(replyMsg);\r\n          } catch (err) {\r\n            IdentityModule_log.error('On addGUIListeners from if sendGenerateMessage method postMessage error: ' + err);\r\n          }\r\n\r\n        });\r\n        return;\r\n      } else if (funcName === 'addAssertion') {\r\n        let result = msg.body.params;\r\n\r\n        //        let keyPair = msg.body.params.keyPair;\r\n        _this.identities.addAssertion(result).then((returnedValue) => {\r\n          let value = { type: 'execute', value: returnedValue, code: 200 };\r\n          let replyMsg = { id: msg.id, type: 'response', to: msg.from, from: msg.to, body: value };\r\n          try {\r\n            _this._messageBus.postMessage(replyMsg);\r\n          } catch (err) {\r\n            IdentityModule_log.error('On addGUIListeners from if storeIdentity method postMessage error: ' + err);\r\n          }\r\n\r\n        });\r\n        return;\r\n      } else if (funcName === 'refreshAccessToken') {\r\n        let domain = msg.body.params.domain;\r\n        let resources = msg.body.params.resources;\r\n\r\n        _this._getAccessTokenForDomain(domain, resources).then((token) => {\r\n          let replyMsg = {\r\n            id: msg.id,\r\n            type: 'response',\r\n            to: msg.from,\r\n            from: msg.to,\r\n            body: {\r\n              value: token.accessToken,\r\n              code: 200\r\n            }\r\n          };\r\n          try {\r\n            _this._messageBus.postMessage(replyMsg);\r\n          } catch (err) {\r\n            IdentityModule_log.error('On addGUIListeners for refreshAccessToken request: ' + err);\r\n          }\r\n\r\n        });\r\n        return;\r\n      } else if (funcName === 'unauthorise') {\r\n        let domain = msg.body.params.domain;\r\n        let resources = msg.body.params.resources;\r\n\r\n        try {\r\n          _this._revokeAccessToken(_this.identities.getAccessToken(domain, resources), domain, resources);\r\n        } catch (e) {\r\n          return reject('[IdentityModule.addGUIListeners] unauthorise error ' + err);\r\n        }\r\n\r\n          let replyMsg = {\r\n            id: msg.id,\r\n            type: 'response',\r\n            to: msg.from,\r\n            from: msg.to,\r\n            body: {\r\n              value: true,\r\n              code: 200\r\n            }\r\n          };\r\n          try {\r\n            _this._messageBus.postMessage(replyMsg);\r\n          } catch (err) {\r\n            IdentityModule_log.error('On addGUIListeners for refreshAccessToken request: ' + err);\r\n          }\r\n\r\n        return;\r\n      }/*else if (funcName === 'selectIdentityForHyperty') {\r\n        let origin = msg.body.params.origin;\r\n        let idp = msg.body.params.idp;\r\n        let idHint = msg.body.params.idHint;\r\n        _this.selectIdentityForHyperty(origin, idp, idHint);\r\n        return;\r\n      }*/\r\n\r\n      // if the function requested is not a promise\r\n      let value = { type: 'execute', value: returnedValue, code: 200 };\r\n      let replyMsg = { id: msg.id, type: 'response', to: msg.from, from: msg.to, body: value };\r\n      try {\r\n        _this._messageBus.postMessage(replyMsg);\r\n      } catch (err) {\r\n        IdentityModule_log.error('On addGUIListeners from if storeIdentity method postMessage error: ' + err);\r\n      }\r\n\r\n    });\r\n  }\r\n\r\n  deployGUI() {\r\n    let _this = this;\r\n    _this.guiDeployed = true;\r\n  }\r\n\r\n  //******************* PRIVATE METHODS *******************\r\n  /**\r\n   * GetValidToken is for non legacy hyperties and verifies if the Token is still valid\r\n   * if the token is invalid it requests a new token\r\n   * @param  {String} hypertyURL hypertyURL\r\n   * @return {Promise}\r\n   */\r\n  _getValidToken(hypertyURL) {\r\n    IdentityModule_log.log('[IdentityModule._getValidToken]:hypertyURL', hypertyURL);\r\n    let _this = this;\r\n    return new Promise((resolve, reject) => {\r\n      _this.getIdToken(hypertyURL).then(function (assertion) {\r\n        IdentityModule_log.log('[IdentityModule._getValidToken] retrieved IdAssertion', assertion);\r\n        let timeNow = secondsSinceEpoch();\r\n\r\n        if (!assertion.hasOwnProperty('expires')) return resolve(assertion);\r\n\r\n        let expirationDate = assertion.expires;\r\n\r\n        /* if (completeId.hasOwnProperty('info')) {\r\n          if (completeId.info.hasOwnProperty('expires')) {\r\n            expirationDate = completeId.info.expires;\r\n          } else if (completeId.info.hasOwnProperty('tokenIDJSON')) {\r\n            expirationDate = completeId.info.tokenIDJSON.exp;\r\n          } else {\r\n            // throw 'The ID Token does not have an expiration time';\r\n            log.info('The ID Token does not have an expiration time');\r\n            resolve(assertion);\r\n          }\r\n        } else if (completeId.hasOwnProperty('infoToken') && completeId.infoToken.hasOwnProperty('exp')) {\r\n          expirationDate = completeId.infoToken.exp;\r\n        } else {\r\n          // throw 'The ID Token does not have an expiration time';\r\n          log.info('The ID Token does not have an expiration time');\r\n          resolve(assertion);\r\n        }*/\r\n\r\n        IdentityModule_log.log('[Identity.IdentityModule.getValidToken] Token expires in', expirationDate);\r\n        IdentityModule_log.log('[Identity.IdentityModule.getValidToken] time now:', timeNow);\r\n\r\n        if (timeNow >= expirationDate) {\r\n          //        if (timeNow >= 0) {\r\n          if (assertion.hasOwnProperty('refresh')) {\r\n            IdentityModule_log.log('[Identity.IdentityModule.getValidToken] refreshing assertion: ', assertion);\r\n\r\n            _this.sendRefreshMessage(assertion).then((newAssertion) => {\r\n              IdentityModule_log.log('[Identity.IdentityModule.getValidToken] refreshed assertion: ', newAssertion);\r\n              _this.identities.updateAssertion(newAssertion).then(() => {\r\n                resolve(newAssertion);\r\n              }, (err) => {\r\n                IdentityModule_log.error('[IdentityModule.getValidToken] error updating the assertion ', err);\r\n                reject(err);\r\n              });\r\n            }, (err) => {\r\n              IdentityModule_log.error('[IdentityModule.getValidToken] error refreshing the assertion ', err);\r\n              reject(err);\r\n            });\r\n          } else { // no refresh token available, user has to authenticate again to get a new assertion\r\n            // generate new idToken\r\n            _this.callGenerateMethods(assertion.idp.domain).then((value) => {\r\n              resolve(value);\r\n            }).catch(err => { reject('[IdentityModule.getValidToken] error when generating a new assertion ' + err); });\r\n          }\r\n        } else {\r\n          resolve(assertion);\r\n        }\r\n      }).catch(function (error) {\r\n        IdentityModule_log.error('[IdentityModule.getValidToken] error on getIdToken', error);\r\n        reject(error);\r\n      });\r\n    });\r\n  }\r\n\r\n  /**\r\n  * returns the reporter associated to the dataObject URL\r\n  * @param   {String}   dataObjectURL         dataObject url\r\n  * @return   {String}  reporter              dataObject url reporter\r\n  */\r\n  _getHypertyFromDataObject(dataObjectURL) {\r\n    IdentityModule_log.info('_getHypertyFromDataObject:dataObjectURL', dataObjectURL);\r\n    let _this = this;\r\n\r\n    return new Promise(function (resolve, reject) {\r\n\r\n      let splitedURL = divideURL(dataObjectURL);\r\n      let domain = splitedURL.domain;\r\n      let finalURL = parseMessageURL(dataObjectURL);\r\n\r\n      // check if is the creator of the hyperty\r\n      let reporterURL = _this.registry.getReporterURLSynchonous(finalURL);\r\n      IdentityModule_log.info('_getHypertyFromDataObject:reporterURL', reporterURL);\r\n\r\n      if (reporterURL) {\r\n        resolve(reporterURL);\r\n      } else {\r\n        // check if there is already an association from an hypertyURL to the dataObject\r\n        let storedReporterURL = _this.dataObjectsIdentity[finalURL];\r\n        IdentityModule_log.info('_getHypertyFromDataObject:storedReporterURL', storedReporterURL);\r\n\r\n        if (storedReporterURL) {\r\n          resolve(storedReporterURL);\r\n        } else {\r\n          // check if there is any hyperty that subscribed the dataObjectURL\r\n          let subscriberHyperty = _this.registry.getDataObjectSubscriberHyperty(dataObjectURL);\r\n          IdentityModule_log.info('_getHypertyFromDataObject:subscriberHyperty', subscriberHyperty);\r\n\r\n          if (subscriberHyperty) {\r\n            resolve(subscriberHyperty);\r\n          } else {\r\n            // search in domain registry for the hyperty associated to the dataObject\r\n            // search in case is a subscriber who wants to know the reporter\r\n            // To be reviewed in order to avoid the discovery transaction\r\n            _this._coreDiscovery.discoverDataObjectPerURL(finalURL, domain).then(dataObject => {\r\n              IdentityModule_log.info('_getHypertyFromDataObject:dataObject', dataObject);\r\n              _this.dataObjectsIdentity[finalURL] = dataObject.reporter;\r\n              IdentityModule_log.info('_getHypertyFromDataObject:dataObject.reporter', dataObject.reporter);\r\n              resolve(dataObject.reporter);\r\n            }, err => {\r\n              reject(err);\r\n            });\r\n          }\r\n        }\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n  * Function that resolve and create the domainURL in case it is provided one. If not, resolve the default domainURL\r\n  * @param {String}     idpDomain     idpDomain (Optional)\r\n  */\r\n  _resolveDomain(idpDomain) {\r\n    if (!idpDomain) {\r\n      return 'domain-idp://google.com';\r\n    } else {\r\n      return 'domain-idp://' + idpDomain;\r\n    }\r\n  }\r\n\r\n  /*\r\n    _secondsSinceEpoch() {\r\n      return Math.floor(Date.now() / 1000);\r\n    }*/\r\n}\r\n\r\n\r\n/* harmony default export */ var identity_IdentityModule = (IdentityModule_IdentityModule);\r\n\n// CONCATENATED MODULE: ./src/runtime/MsgBusHandlers.js\n/**\r\n *  Class where message bus handlers are built. To be used by the RuntimeUA to initialise the runtime UA.\r\n */\r\n\r\n//import { log as logLevels } from '../logLevels';\r\n\r\n// Log System\r\n\r\nlet MsgBusHandlers_log = loglevel[\"getLogger\"]('RuntimeUA');\r\n\r\nclass MsgBusHandlers {\r\n\r\n  constructor(pep, idm, crypto) {\r\n    if (!pep) throw Error('[MsgBusHandlers] pep input paramenter is mandatory');\r\n    if (!idm) throw Error('[MsgBusHandlers] idm input paramente is mandatory');\r\n    if (!crypto) throw Error('[MsgBusHandlers] crypto input paramente is mandatory');\r\n\r\n    this.policyEngine = pep;\r\n    this.identityManager = idm;\r\n    this.cryptoManager = crypto;\r\n  }\r\n\r\n  // Policy based access control for incoming messages\r\n\r\n  get pepInHandler() {\r\n    let _this = this;\r\n\r\n    return (ctx) => {\r\n      _this.policyEngine.authorise(ctx.msg, true).then((changedMgs) => {\r\n        ctx.msg = changedMgs;\r\n        ctx.next();\r\n      }).catch((reason) => {\r\n        MsgBusHandlers_log.error(reason);\r\n        ctx.fail(reason);\r\n      });\r\n    };\r\n\r\n  }\r\n\r\n  // Policy based access control for outgoing messages\r\n  get pepOutHandler() {\r\n    let _this = this;\r\n    return (ctx) => {\r\n      _this.policyEngine.authorise(ctx.msg, false).then((changedMgs) => {\r\n        ctx.msg = changedMgs;\r\n        ctx.next();\r\n      }).catch((reason) => {\r\n        MsgBusHandlers_log.error(reason);\r\n        ctx.fail(reason);\r\n      });\r\n    };\r\n  }\r\n\r\n  // Add Identity info to messages\r\n  get idmHandler() {\r\n    let _this = this;\r\n    return (ctx) => {\r\n      _this.identityManager.processMessage(ctx.msg).then((changedMgs) => {\r\n        ctx.msg = changedMgs;\r\n        ctx.next();\r\n      }).catch((reason) => {\r\n        MsgBusHandlers_log.error(reason);\r\n        ctx.fail(reason);\r\n      });\r\n    };\r\n  }\r\n\r\n  // encrypt messages\r\n\r\n  get encryptHandler() {\r\n    let _this = this;\r\n    return (ctx) => {\r\n      _this.cryptoManager.encryptMessage(ctx.msg).then((changedMgs) => {\r\n        ctx.msg = changedMgs;\r\n        ctx.next();\r\n      }).catch((reason) => {\r\n        MsgBusHandlers_log.error(reason);\r\n        ctx.fail(reason);\r\n      });\r\n    };\r\n\r\n  }\r\n\r\n  // decrypt messages\r\n\r\n  get decryptHandler() {\r\n    let _this = this;\r\n    return (ctx) => {\r\n      _this.cryptoManager.decryptMessage(ctx.msg).then((changedMgs) => {\r\n        ctx.msg = changedMgs;\r\n        ctx.next();\r\n      }).catch((reason) => {\r\n        MsgBusHandlers_log.warn(reason);\r\n        ctx.fail(reason);\r\n      });\r\n    };\r\n\r\n  }\r\n\r\n}\r\n\r\n/* harmony default export */ var runtime_MsgBusHandlers = (MsgBusHandlers);\r\n\n// CONCATENATED MODULE: ./src/identity/IdentityHandler.js\n/**\r\n* Provides an API to manage identities from msg bus pipeline\r\n* TODO: rename to something like IdentityPipelineHandler in order not to conflict with framework related IdentityHandler\r\n*/\r\n\r\n\r\n\r\n\r\nlet IdentityHandler_log = loglevel[\"getLogger\"]('IdentityHandler');\r\n\r\nclass IdentityHandler_IdentityHandler {\r\n\r\n  constructor(idm) {\r\n    let _this = this;\r\n\r\n    _this._idm = idm;\r\n\r\n  }\r\n\r\n  reset() {\r\n    console.log('IM reset');\r\n\r\n    // this._idm.identities.reset();\r\n    this._idm.identities = new identity_Identities(this._idm.identities._type, this._idm.identities._storageManager);\r\n    console.log(this._idm.identities);\r\n  }\r\n\r\n  _isToSetID(message) {\r\n    let schemasToIgnore = ['domain-idp', 'runtime', 'domain'];\r\n\r\n    let _from = message.from;\r\n\r\n    if (message.body && message.body.hasOwnProperty('source')) {\r\n      _from = message.body.source;\r\n    }\r\n\r\n    if (message.body && message.body.hasOwnProperty('subscriber')) {\r\n      _from = message.body.subscriber;\r\n    }\r\n\r\n    if (message.type === 'forward') {\r\n      return false;\r\n    }\r\n\r\n    if (message.type === 'event') {\r\n      return false;\r\n    }\r\n\r\n    // Signalling Messages between P2P Stubs don't have Identities. FFS\r\n    if (_from.includes('/p2prequester/') || _from.includes('/p2phandler/')) {\r\n      return false;\r\n    }\r\n\r\n\r\n    let splitFrom = (_from).split('://');\r\n    let fromSchema = splitFrom[0];\r\n    let isToIgnore = schemasToIgnore.indexOf(fromSchema) === -1;\r\n\r\n    return isToIgnore;\r\n  }\r\n\r\n  processMessage(message) {\r\n    IdentityHandler_log.log('[IdentityHandler.processMessage] ', message);\r\n\r\n    return new Promise((resolve, reject) => {\r\n\r\n      // skip messages that don't need identity tokens in the body\r\n\r\n      if (!this._isToSetID(message)) return resolve(message);\r\n\r\n      if (message.body && message.body.value && message.body.value.anonymous){\r\n        if (message.body.identity && message.body.identity.guid)\r\n          message.body.identity = { userProfile: { guid: message.body.identity.guid } };\r\n        else message.body.identity = { userProfile: { guid: 'anonymous' }  };\r\n        return resolve(message);\r\n  \r\n      }\r\n  \r\n\r\n      /*      let from = message.from;\r\n      let sourceURL = undefined;\r\n      if ( message.hasOwnProperty('body') && message.body.hasOwnProperty('source')) {\r\n        from = message.body.source;\r\n      }\r\n\r\n      if (message.type === 'forward') {\r\n        from = message.body.from;\r\n      }\r\n\r\n      if (message.hasOwnProperty('body') && message.body.hasOwnProperty('subscriber')) {\r\n        from = message.body.subscriber;\r\n      }*/\r\n\r\n      this._idm.getToken(message).then((identity) => {\r\n\r\n        if (!message.hasOwnProperty('body')) message.body = {};\r\n\r\n        message.body.identity = identity;\r\n        resolve(message);\r\n      }).catch((reason) => {\r\n        IdentityHandler_log.error(reason);\r\n        reject(reason);\r\n      });\r\n\r\n    });\r\n\r\n\r\n  }\r\n\r\n\r\n}\r\n\r\n/* harmony default export */ var identity_IdentityHandler = (IdentityHandler_IdentityHandler);\r\n\n// CONCATENATED MODULE: ./src/policy/ActionsService.js\nclass ActionsService {\r\n\r\n  constructor(context) {\r\n    this.context = context;\r\n  }\r\n\r\n  enforcePolicies(message, isIncomingMessage) {\r\n    let _this = this;\r\n    return new Promise((resolve, reject) => {\r\n\r\n      let policies = _this.context.getPolicies(message, isIncomingMessage);\r\n\r\n      if (policies !== undefined) {\r\n        if (policies.serviceProviderPolicy !== undefined) {\r\n          policies.serviceProviderPolicy.enforceActions(_this.context, message).then(messages => {\r\n            resolve(messages);\r\n          }, (error) => {\r\n            reject(error);\r\n          });\r\n        } else {\r\n          if (policies.userPolicy !== undefined) {\r\n            policies.userPolicy.enforceActions(_this.context, message).then(messages => {\r\n              resolve(messages);\r\n            }, (error) => {\r\n              reject(error);\r\n            });\r\n          } else {\r\n            resolve([message]);\r\n          }\r\n        }\r\n      } else {\r\n        resolve([message]);\r\n      }\r\n    });\r\n  }\r\n\r\n  forwardToID(message, email) {\r\n    let _this = this;\r\n    if (!_this.context.runtimeRegistry) throw new Error('forward message to given ID is unsupported in this environment');\r\n\r\n    return new Promise((resolve, reject) => {\r\n      if (_this.context.runtimeRegistry.hypertiesList[0].hypertyURL === message.to) {\r\n        let splitTo = (message.to).split('://');\r\n        if (splitTo[0] !== 'runtime') {\r\n          _this.context.runtimeRegistry.discoverHypertyPerUser(email).then(result => {\r\n            message.to = result.hypertyURL;\r\n            message.body.via = undefined;\r\n            resolve(message);\r\n            _this.context.runtimeRegistry._messageBus.postMessage(message);\r\n          }, (error) => {\r\n            reject(error);\r\n          });\r\n        } else {\r\n          resolve(message);\r\n        }\r\n      } else {\r\n        resolve(message);\r\n      }\r\n    });\r\n  }\r\n\r\n  forwardToHyperty(message, hypertyURL) {\r\n    let _this = this;\r\n    if (!_this.context.runtimeRegistry) throw new Error('forward message to given ID is unsupported in this environment');\r\n\r\n    return new Promise((resolve) => {\r\n      if (_this.context.runtimeRegistry.hypertiesList[0].hypertyURL === message.to) {\r\n        let splitTo = (message.to).split('://');\r\n        if (splitTo[0] !== 'runtime') {\r\n          message.to = hypertyURL;\r\n          message.body.via = undefined;\r\n          resolve(message);\r\n          _this.context.runtimeRegistry._messageBus.postMessage(message);\r\n        } else {\r\n          resolve(message);\r\n        }\r\n      } else {\r\n        resolve(message);\r\n      }\r\n    });\r\n  }\r\n\r\n  sendAutomaticMessage(message, text) {\r\n    let _this = this;\r\n    return new Promise((resolve) => {\r\n      let automaticMessage = {\r\n        from: message.to,\r\n        to: message.from,\r\n        body: {\r\n          value: text\r\n        },\r\n        type: message.type\r\n      };\r\n      resolve(message);\r\n      _this.context.runtimeRegistry._messageBus.postMessage(automaticMessage);\r\n    });\r\n  }\r\n\r\n}\r\n\r\n/* harmony default export */ var policy_ActionsService = (ActionsService);\r\n\n// CONCATENATED MODULE: ./src/policy/Operators.js\nclass Operators {\r\n\r\n  and(params) {\r\n    return params[0] && params[1];\r\n  }\r\n\r\n  between(params) {\r\n    let start = parseInt(params[0][0]);\r\n    let end = parseInt(params[0][1]);\r\n    let now = params[1];\r\n\r\n    if (end < start) {\r\n      now = (now < start) ? now += 2400 : now;\r\n      end += 2400;\r\n    }\r\n\r\n    return (now > start && now < end);\r\n  }\r\n\r\n  equals(params) {\r\n    return String(params[0]) === '*' || String(params[0]) === String(params[1]);\r\n  }\r\n\r\n  greaterThan(params) {\r\n    return params[1] > params[0];\r\n  }\r\n\r\n  in(params) {\r\n    return params[0].indexOf(params[1]) > -1;\r\n  }\r\n\r\n  lessThan(params) {\r\n    return params[1] < params[0];\r\n  }\r\n\r\n  not(params) {\r\n    return !params[0];\r\n  }\r\n\r\n  or(params) {\r\n    return params[0] || params[1];\r\n  }\r\n\r\n}\r\n\r\n/* harmony default export */ var policy_Operators = (Operators);\r\n\n// CONCATENATED MODULE: ./src/policy/PDP.js\n\r\n\r\n/**\r\n* The Policy Decision Point (PDP) decides if a message is to be authorised by checking a set of\r\n* policies. The resource to be verified is specified in the first word of the 'condition' field of\r\n* a Policy object. The implementation that verifies if the message is compliant with a policy is\r\n* specified in a hashtable to allow dynamic definition of the implementation, providing\r\n* extensibility to the Policy Engine functionalities.\r\n*/\r\nclass PDP_PDP {\r\n\r\n  constructor(context) {\r\n    this.context = context;\r\n    this.operators = new policy_Operators();\r\n  }\r\n\r\n  evaluatePolicies(message, isIncomingMessage) {\r\n    let policies = this.context.getPolicies(message, isIncomingMessage);\r\n    let result = 'Not Applicable';\r\n    if (policies !== undefined) {\r\n      result = this.evaluatePolicy(message, policies.serviceProviderPolicy, isIncomingMessage);\r\n      if (result || result === 'Not Applicable') {\r\n        let userResult = this.evaluatePolicy(message, policies.userPolicy, isIncomingMessage);\r\n        if (userResult !== 'Not Applicable') {\r\n          result = userResult;\r\n        }\r\n      }\r\n    }\r\n\r\n    return result;\r\n  }\r\n\r\n  evaluatePolicy(message, policy, isIncoming) {\r\n    let result = 'Not Applicable';\r\n    if (policy) {\r\n      result = policy.evaluateRules(this.context, message, isIncoming);\r\n    }\r\n\r\n    return result;\r\n  }\r\n\r\n}\r\n\r\n/* harmony default export */ var policy_PDP = (PDP_PDP);\r\n\n// CONCATENATED MODULE: ./src/policy/combiningAlgorithms/AllowOverrides.js\n/**\r\n* Copyright 2016 PT Inovação e Sistemas SA\r\n* Copyright 2016 INESC-ID\r\n* Copyright 2016 QUOBIS NETWORKS SL\r\n* Copyright 2016 FRAUNHOFER-GESELLSCHAFT ZUR FOERDERUNG DER ANGEWANDTEN FORSCHUNG E.V\r\n* Copyright 2016 ORANGE SA\r\n* Copyright 2016 Deutsche Telekom AG\r\n* Copyright 2016 Apizee\r\n* Copyright 2016 TECHNISCHE UNIVERSITAT BERLIN\r\n*\r\n* Licensed under the Apache License, Version 2.0 (the \"License\");\r\n* you may not use this file except in compliance with the License.\r\n* You may obtain a copy of the License at\r\n*\r\n*   http://www.apache.org/licenses/LICENSE-2.0\r\n*\r\n* Unless required by applicable law or agreed to in writing, software\r\n* distributed under the License is distributed on an \"AS IS\" BASIS,\r\n* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n* See the License for the specific language governing permissions and\r\n* limitations under the License.\r\n**/\r\n\r\n/**\r\n* @author Ana Caldeira <ana.caldeira@tecnico.ulisboa.pt>\r\n* @classdesc Class to combine the authorization decisions that result from rules evaluation.\r\n*/\r\nclass AllowOverrides {\r\n\r\n  /**\r\n  * Given an array of individual authorization decisions, prioritizes a positive one.\r\n  * @param    {boolean[]}   decisions\r\n  * @returns  {boolean}\r\n  */\r\n  combine(decisions) {\r\n    if (decisions.indexOf(true) !== -1) {\r\n      return true;\r\n    } else {\r\n      if (decisions.indexOf(false) !== -1) {\r\n        return false;\r\n      } else {\r\n        return 'Not Applicable';\r\n      }\r\n    }\r\n  }\r\n\r\n}\r\n\r\n/* harmony default export */ var combiningAlgorithms_AllowOverrides = (AllowOverrides);\r\n\n// CONCATENATED MODULE: ./src/policy/combiningAlgorithms/BlockOverrides.js\n/**\r\n* Copyright 2016 PT Inovação e Sistemas SA\r\n* Copyright 2016 INESC-ID\r\n* Copyright 2016 QUOBIS NETWORKS SL\r\n* Copyright 2016 FRAUNHOFER-GESELLSCHAFT ZUR FOERDERUNG DER ANGEWANDTEN FORSCHUNG E.V\r\n* Copyright 2016 ORANGE SA\r\n* Copyright 2016 Deutsche Telekom AG\r\n* Copyright 2016 Apizee\r\n* Copyright 2016 TECHNISCHE UNIVERSITAT BERLIN\r\n*\r\n* Licensed under the Apache License, Version 2.0 (the \"License\");\r\n* you may not use this file except in compliance with the License.\r\n* You may obtain a copy of the License at\r\n*\r\n*   http://www.apache.org/licenses/LICENSE-2.0\r\n*\r\n* Unless required by applicable law or agreed to in writing, software\r\n* distributed under the License is distributed on an \"AS IS\" BASIS,\r\n* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n* See the License for the specific language governing permissions and\r\n* limitations under the License.\r\n**/\r\n\r\n/**\r\n* @author Ana Caldeira <ana.caldeira@tecnico.ulisboa.pt>\r\n* @classdesc Class to combine the authorization decisions that result from rules evaluation.\r\n*/\r\nclass BlockOverrides {\r\n\r\n  /**\r\n  * Given an array of individual authorisation decisions, prioritises a negative one.\r\n  * @param    {boolean[]}   decisions\r\n  * @returns  {boolean}\r\n  */\r\n  combine(decisions) {\r\n    if (decisions.indexOf(false) !== -1) {\r\n      return false;\r\n    } else {\r\n      if (decisions.indexOf(true) !== -1) {\r\n        return true;\r\n      } else {\r\n        return 'Not Applicable';\r\n      }\r\n    }\r\n  }\r\n\r\n}\r\n\r\n/* harmony default export */ var combiningAlgorithms_BlockOverrides = (BlockOverrides);\r\n\n// CONCATENATED MODULE: ./src/policy/combiningAlgorithms/FirstApplicable.js\n/**\r\n* Copyright 2016 PT Inovação e Sistemas SA\r\n* Copyright 2016 INESC-ID\r\n* Copyright 2016 QUOBIS NETWORKS SL\r\n* Copyright 2016 FRAUNHOFER-GESELLSCHAFT ZUR FOERDERUNG DER ANGEWANDTEN FORSCHUNG E.V\r\n* Copyright 2016 ORANGE SA\r\n* Copyright 2016 Deutsche Telekom AG\r\n* Copyright 2016 Apizee\r\n* Copyright 2016 TECHNISCHE UNIVERSITAT BERLIN\r\n*\r\n* Licensed under the Apache License, Version 2.0 (the \"License\");\r\n* you may not use this file except in compliance with the License.\r\n* You may obtain a copy of the License at\r\n*\r\n*   http://www.apache.org/licenses/LICENSE-2.0\r\n*\r\n* Unless required by applicable law or agreed to in writing, software\r\n* distributed under the License is distributed on an \"AS IS\" BASIS,\r\n* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n* See the License for the specific language governing permissions and\r\n* limitations under the License.\r\n**/\r\n\r\n/**\r\n* @author Ana Caldeira <ana.caldeira@tecnico.ulisboa.pt>\r\n* @classdesc Class to combine the authorization decisions that result from rules evaluation.\r\n*/\r\nclass FirstApplicable {\r\n\r\n  /**\r\n  * Given an array of individual authorisation decisions, returns the first one different from 'Not Applicable', either positive or negative.\r\n  * @param    {boolean[]}     decisions\r\n  * @returns  {boolean}\r\n  */\r\n  combine(decisions) {\r\n    for (let i in decisions) {\r\n      if (decisions[i] !== 'Not Applicable') {\r\n        return decisions[i];\r\n      }\r\n    }\r\n    return 'Not Applicable';\r\n  }\r\n\r\n}\r\n\r\n/* harmony default export */ var combiningAlgorithms_FirstApplicable = (FirstApplicable);\r\n\n// CONCATENATED MODULE: ./src/policy/conditions/Condition.js\n/**\r\n* Copyright 2016 PT Inovação e Sistemas SA\r\n* Copyright 2016 INESC-ID\r\n* Copyright 2016 QUOBIS NETWORKS SL\r\n* Copyright 2016 FRAUNHOFER-GESELLSCHAFT ZUR FOERDERUNG DER ANGEWANDTEN FORSCHUNG E.V\r\n* Copyright 2016 ORANGE SA\r\n* Copyright 2016 Deutsche Telekom AG\r\n* Copyright 2016 Apizee\r\n* Copyright 2016 TECHNISCHE UNIVERSITAT BERLIN\r\n*\r\n* Licensed under the Apache License, Version 2.0 (the \"License\");\r\n* you may not use this file except in compliance with the License.\r\n* You may obtain a copy of the License at\r\n*\r\n*   http://www.apache.org/licenses/LICENSE-2.0\r\n*\r\n* Unless required by applicable law or agreed to in writing, software\r\n* distributed under the License is distributed on an \"AS IS\" BASIS,\r\n* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n* See the License for the specific language governing permissions and\r\n* limitations under the License.\r\n**/\r\n\r\n\r\n\r\n/**\r\n* @author Ana Caldeira <ana.caldeira@tecnico.ulisboa.pt>\r\n* @classdesc Class to represent a condition and evaluate its applicability.\r\n*/\r\nclass Condition_Condition {\r\n\r\n  /**\r\n  * Creates a new Condition.\r\n  * @class\r\n  * @param  {string}  attribute\r\n  * @param  {string}  operator\r\n  * @param  {*}       params\r\n  */\r\n  constructor(attribute, operator, params) {\r\n    this.attribute = attribute;\r\n    this.operator = operator;\r\n    this.params = params;\r\n    this.operators = new policy_Operators();\r\n  }\r\n\r\n  /**\r\n  * Verifies if the condition is applicable to the message. First, the system value that corresponds to the attribute is retrieved; then, that value is compared with the parameter specified in the condition by executing the operator implementation. If the operator is 'in' and the name of a group is given, then the array holding the members of the group is retrieved before the comparison.\r\n  * @param  {Object}    context   environment where the Policy Engine is being used\r\n  * @param  {Object}    message\r\n  */\r\n  isApplicable(context, message) {\r\n    context[this.attribute] = { message: message };\r\n    let value = context[this.attribute];\r\n    let tempParam;\r\n\r\n    if (this.operator === 'in') {\r\n      if (!(Array.isArray(this.params))) {\r\n        tempParam = context.getGroup(this.params, message.to);\r\n        return this.operators[this.operator]([tempParam, value]);\r\n      }\r\n    }\r\n\r\n    return this.operators[this.operator]([this.params, value]);\r\n  }\r\n\r\n}\r\n\r\n/* harmony default export */ var conditions_Condition = (Condition_Condition);\r\n\n// CONCATENATED MODULE: ./src/policy/conditions/SubscriptionCondition.js\n/**\r\n* Copyright 2016 PT Inovação e Sistemas SA\r\n* Copyright 2016 INESC-ID\r\n* Copyright 2016 QUOBIS NETWORKS SL\r\n* Copyright 2016 FRAUNHOFER-GESELLSCHAFT ZUR FOERDERUNG DER ANGEWANDTEN FORSCHUNG E.V\r\n* Copyright 2016 ORANGE SA\r\n* Copyright 2016 Deutsche Telekom AG\r\n* Copyright 2016 Apizee\r\n* Copyright 2016 TECHNISCHE UNIVERSITAT BERLIN\r\n*\r\n* Licensed under the Apache License, Version 2.0 (the \"License\");\r\n* you may not use this file except in compliance with the License.\r\n* You may obtain a copy of the License at\r\n*\r\n*   http://www.apache.org/licenses/LICENSE-2.0\r\n*\r\n* Unless required by applicable law or agreed to in writing, software\r\n* distributed under the License is distributed on an \"AS IS\" BASIS,\r\n* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n* See the License for the specific language governing permissions and\r\n* limitations under the License.\r\n**/\r\n\r\n\r\n\r\n/**\r\n* @author Ana Caldeira <ana.caldeira@tecnico.ulisboa.pt>\r\n* @classdesc Class to represent a subscription condition and evaluate its applicability.\r\n*/\r\nclass SubscriptionCondition_SubscriptionCondition extends conditions_Condition {\r\n\r\n  /**\r\n  * Creates a new SubscriptionCondition.\r\n  * @class\r\n  * @param  {string}  attribute\r\n  * @param  {string}  operator\r\n  * @param  {*}       params\r\n  */\r\n  constructor(attribute, operator, params) {\r\n    super(attribute, operator, params);\r\n  }\r\n\r\n  /**\r\n  * Verifies if the subscription condition is applicable to the message. First, verifies if the message is of the subscription type; second, verifies if the message is from a remote runtime to guarantee that the subscription is being validated in the destination runtime; third, verifies if the subscription preference is met.\r\n  * @param  {Object}    context   environment where the Policy Engine is being used\r\n  * @param  {Object}    message\r\n  */\r\n  isApplicable(context, message) {\r\n    let isSubscription = message.type === 'subscribe';\r\n    let isFromRemoteSM = context.isFromRemoteSM(message.from);\r\n    if (isSubscription & isFromRemoteSM) {\r\n      return super.isApplicable(context, message);\r\n    } else {\r\n      return false;\r\n    }\r\n  }\r\n\r\n}\r\n\r\n/* harmony default export */ var conditions_SubscriptionCondition = (SubscriptionCondition_SubscriptionCondition);\r\n\n// CONCATENATED MODULE: ./src/policy/conditions/AdvancedCondition.js\n\r\n\r\n\r\n\r\nclass AdvancedCondition_AdvancedCondition {\r\n\r\n  constructor(condition) {\r\n    this.operators = new policy_Operators();\r\n    if (condition.operators !== undefined) {\r\n      condition = condition.condition;\r\n    }\r\n    condition = this.buildCondition(condition);\r\n    this.condition = condition;\r\n  }\r\n\r\n  buildCondition(condition) {\r\n    if (Array.isArray(condition[1])) {\r\n      condition[1] = this.buildCondition(condition[1]);\r\n    } else {\r\n      if (condition[1].attribute === 'subscription') {\r\n        condition[1] = new conditions_SubscriptionCondition(condition[1].attribute, condition[1].operator, condition[1].params);\r\n      } else {\r\n        condition[1] = new conditions_Condition(condition[1].attribute, condition[1].operator, condition[1].params);\r\n      }\r\n    }\r\n\r\n    if (condition[2] !== undefined) {\r\n      if (Array.isArray(condition[2])) {\r\n        condition[2] = this.buildCondition(condition[2]);\r\n      } else {\r\n        if (condition[2].attribute === 'subscription') {\r\n          condition[2] = new conditions_SubscriptionCondition(condition[2].attribute, condition[2].operator, condition[2].params);\r\n        } else {\r\n          condition[2] = new conditions_Condition(condition[2].attribute, condition[2].operator, condition[2].params);\r\n        }\r\n      }\r\n    }\r\n    return condition;\r\n  }\r\n\r\n  isApplicable(context, message, scope, target, operator, left, right) {\r\n    if (!operator) {\r\n      operator = this.condition[0];\r\n      left = this.condition[1];\r\n      right = this.condition[2];\r\n    }\r\n\r\n    while (!(left instanceof conditions_Condition) & !(left instanceof conditions_SubscriptionCondition) & (typeof left !== 'boolean')) {\r\n      left = this.isApplicable(context, message, scope, target, left[0], left[1], left[2]);\r\n    }\r\n    if (right !== undefined) {\r\n      while (!(right instanceof conditions_Condition) & !(right instanceof conditions_SubscriptionCondition) & (typeof right !== 'boolean')) {\r\n        right = this.isApplicable(context, message, scope, target, right[0], right[1], right[2]);\r\n      }\r\n    }\r\n\r\n    let resultLeft = (typeof left === 'boolean') ? left : left.isApplicable(context, message, scope, target);\r\n    let resultRight;\r\n    if (right !== undefined) {\r\n      resultRight = (typeof right === 'boolean') ? right : right.isApplicable(context, message, scope, target);\r\n    }\r\n    return this.operators[operator]([resultLeft, resultRight]);\r\n  }\r\n\r\n}\r\n\r\n/* harmony default export */ var conditions_AdvancedCondition = (AdvancedCondition_AdvancedCondition);\r\n\n// CONCATENATED MODULE: ./src/policy/Rule.js\n\r\n\r\n\r\n\r\n\r\nclass Rule_Rule {\r\n\r\n  constructor(decision, condition, scope, target, priority) {\r\n    this.decision = decision;\r\n    this.setCondition(condition);\r\n    this.priority = priority;\r\n    this.scope = scope;\r\n    this.target = target;\r\n  }\r\n\r\n  setCondition(condition) {\r\n    if (!(condition instanceof conditions_Condition || condition instanceof conditions_AdvancedCondition || condition instanceof conditions_AdvancedCondition)) {\r\n      let attribute = condition.attribute;\r\n      switch (attribute) {\r\n        case 'subscription':\r\n          this.condition = new conditions_AdvancedCondition(condition.attribute, condition.operator, condition.params);\r\n          break;\r\n        case undefined:\r\n          this.condition = new conditions_AdvancedCondition(condition);\r\n          break;\r\n        default:\r\n          this.condition = new conditions_Condition(condition.attribute, condition.operator, condition.params);\r\n      }\r\n    } else {\r\n      this.condition = condition;\r\n    }\r\n  }\r\n\r\n  evaluate(context, message, isIncoming) {\r\n    let field = (isIncoming) ? message.to : message.from;\r\n    let hypertyName;\r\n    switch (this.scope) {\r\n      case 'global':\r\n        break;\r\n\r\n      case 'hyperty':\r\n        if (isDataObjectURL(field)) {\r\n          let reporter = context.runtimeRegistry.getReporterURLSynchonous(removePathFromURL(field));\r\n          if (reporter !== undefined) {\r\n            hypertyName = context.runtimeRegistry.getHypertyName(reporter);\r\n          }\r\n        } else {\r\n          if (field.split('://')[0] === 'hyperty') {\r\n            hypertyName = context.runtimeRegistry.getHypertyName(removePathFromURL(field));\r\n          }\r\n        }\r\n        if (hypertyName === this.target) {\r\n          break;\r\n        }\r\n\r\n        return 'Not Applicable';\r\n\r\n      case 'identity':\r\n        let owner;\r\n\r\n        if (isDataObjectURL(field)) {\r\n          let reporter = context.runtimeRegistry.getReporterURLSynchonous(removePathFromURL(field));\r\n          owner = context.runtimeRegistry.getHypertyOwner(reporter);\r\n        } else {\r\n          if (field.split('://')[0] === 'hyperty') {\r\n            owner = context.runtimeRegistry.getHypertyOwner(removePathFromURL(field));\r\n          }\r\n        }\r\n        if (owner !== undefined) {\r\n          owner = getUserEmailFromURL(owner);\r\n        }\r\n        if (owner === this.target) {\r\n          break;\r\n        }\r\n\r\n        return 'Not Applicable';\r\n    }\r\n\r\n    if (this.condition.isApplicable(context, message, this.scope, this.target)) {\r\n      return this.decision;\r\n    } else {\r\n      return 'Not Applicable';\r\n    }\r\n  }\r\n}\r\n\r\n/* harmony default export */ var policy_Rule = (Rule_Rule);\r\n\n// CONCATENATED MODULE: ./src/policy/Policy.js\n\r\n\r\n\r\n\r\n\r\nclass Policy_Policy {\r\n\r\n  constructor(key, rules, actions, combiningAlgorithm) {\r\n    if (!key) throw new Error('key is not defined');\r\n    if (!actions) throw new Error('actions are not defined');\r\n\r\n    this.actions = actions;\r\n    this.key = key;\r\n    this._setRules(rules);\r\n    this._setCombiningAlgorithm(combiningAlgorithm);\r\n  }\r\n\r\n  addAction(method, param) {\r\n    this.actions.push({ method: method, param: param });\r\n  }\r\n\r\n  createRule(decision, condition, scope, target, priority) {\r\n    if (priority === undefined) {\r\n      priority = this.getLastPriority() + 1;\r\n    }\r\n    let rule = new policy_Rule(decision, condition, scope, target, priority);\r\n    this.rules.push(rule);\r\n  }\r\n\r\n  deleteRule(rule) {\r\n    let indexToRemove = this.rules.indexOf(rule);\r\n    this.rules.splice(indexToRemove, 1);\r\n  }\r\n\r\n  enforceActions(context, message) {\r\n    return new Promise((resolve, reject) => {\r\n      let results = [];\r\n      if (this.actions.length !== 0) {\r\n        for (let i in this.actions) {\r\n          let result = context.pep.actionsService[this.actions[i].method](message, this.actions[i].param);\r\n          results.push(result);\r\n        }\r\n        Promise.all(results).then((messages) => {\r\n          resolve(messages);\r\n        }, error => {\r\n          reject(error);\r\n        });\r\n      } else {\r\n        resolve([message]);\r\n      }\r\n    });\r\n  }\r\n\r\n  evaluateRules(context, message, isIncoming) {\r\n    let results = [];\r\n    for (let i in this.rules) {\r\n      results.push(this.rules[i].evaluate(context, message, isIncoming));\r\n    }\r\n\r\n    return this.combiningAlgorithm.combine(results);\r\n  }\r\n\r\n  getLastPriority() {\r\n    let priorities = [];\r\n\r\n    if (this.rules.length !== 0) {\r\n      for (let i in this.rules) {\r\n        priorities.push(this.rules[i].priority);\r\n      }\r\n      return Math.max.apply(Math, priorities);\r\n    } else {\r\n      return -1;\r\n    }\r\n  }\r\n\r\n  getRuleByPriority(priority) {\r\n    for (let i in this.rules) {\r\n      if (String(this.rules[i].priority) === String(priority)) {\r\n        return this.rules[i];\r\n      }\r\n    }\r\n    throw Error('Rule with priority ' + priority + ' does not exist!');\r\n  }\r\n\r\n  _setCombiningAlgorithm(combiningAlgorithm) {\r\n    if (!combiningAlgorithm) {\r\n      combiningAlgorithm = 'blockOverrides';\r\n    }\r\n    switch (combiningAlgorithm) {\r\n      case 'blockOverrides':\r\n        this.combiningAlgorithm = new combiningAlgorithms_BlockOverrides();\r\n        break;\r\n      case 'allowOverrides':\r\n        this.combiningAlgorithm = new combiningAlgorithms_AllowOverrides();\r\n        break;\r\n      case 'firstApplicable':\r\n        this.combiningAlgorithm = new combiningAlgorithms_FirstApplicable();\r\n        break;\r\n      default:\r\n        throw Error('Unknown algorithm: ' + combiningAlgorithm);\r\n    }\r\n  }\r\n\r\n  _setRules(rules) {\r\n    this.rules = [];\r\n\r\n    for (let i in rules) {\r\n      let rule = rules[i];\r\n      if (rule.priority === undefined) {\r\n        rule.priority = this.getLastPriority() + 1;\r\n      }\r\n      if (!(rule instanceof policy_Rule)) {\r\n        rule = new policy_Rule(rule.decision, rule.condition, rule.scope, rule.target, rule.priority);\r\n      }\r\n      this.rules.push(rule);\r\n    }\r\n  }\r\n\r\n  sortRules() {\r\n    return this.rules.sort(function(a, b) {\r\n      let x = a.priority; let y = b.priority;\r\n      return ((x < y) ? -1 : ((x > y) ? 1 : 0));\r\n    });\r\n  }\r\n\r\n}\r\n\r\n/* harmony default export */ var policy_Policy = (Policy_Policy);\r\n\n// CONCATENATED MODULE: ./src/policy/PEP.js\n// Log System\r\n\r\nlet PEP_log = loglevel[\"getLogger\"]('PEP');\r\n\r\n\r\n\r\n\r\n\r\n\r\nclass PEP_PEP {\r\n\r\n  /**\r\n  * Creates a Policy Enforcement Point (PEP) instance\r\n  * @param    {Object}    context\r\n  */\r\n  constructor(context) {\r\n    let _this = this;\r\n\r\n    _this.pdp = new policy_PDP(context);\r\n    _this.actionsService = new policy_ActionsService(context);\r\n    _this.context = context;\r\n    context.pep = _this;\r\n\r\n    //TODO should be added a trigger to verify when the loadConfigurations is successfully completed\r\n    context.loadConfigurations();\r\n  }\r\n\r\n  /**\r\n  * return the messageBus in this Registry\r\n  * @param {MessageBus}           messageBus\r\n  */\r\n  get messageBus() {\r\n    let _this = this;\r\n    return _this.context.messageBus;\r\n  }\r\n\r\n  /**\r\n  * Set the messageBus in this Registry\r\n  * @param {MessageBus}           messageBus\r\n  */\r\n  set messageBus(messageBus) {\r\n    let _this = this;\r\n    _this.context.messageBus = messageBus;\r\n    _this.addGUIListeners();\r\n  }\r\n\r\n  addGUIListeners() {\r\n    let _this = this;\r\n\r\n    _this.context.messageBus.addListener(_this.context.pepURL, (msg) => {\r\n      let funcName = msg.body.method;\r\n\r\n      let returnedValue;\r\n      if (funcName === 'addToGroup') {\r\n        let groupName = msg.body.params.groupName;\r\n        let userEmail = msg.body.params.userEmail;\r\n        returnedValue = _this.context.addToGroup(groupName, userEmail);\r\n      } else if (funcName === 'createGroup') {\r\n        let groupName = msg.body.params.groupName;\r\n        returnedValue = _this.context.createGroup(groupName);\r\n      } else if (funcName === 'addPolicy') {\r\n        let source = msg.body.params.source;\r\n        let key = msg.body.params.key;\r\n        let policy = msg.body.params.policy;\r\n        let combiningAlgorithm = msg.body.params.combiningAlgorithm;\r\n        returnedValue = _this.addPolicy(source, key, policy, combiningAlgorithm);\r\n      } else if (funcName === 'deleteGroup') {\r\n        let groupName = msg.body.params.groupName;\r\n        returnedValue = _this.context.deleteGroup(groupName);\r\n      } else if (funcName === 'removePolicy') {\r\n        let source = msg.body.params.source;\r\n        let key = msg.body.params.key;\r\n        returnedValue = _this.removePolicy(source, key);\r\n      } else if (funcName === 'savePolicies') {\r\n        let source = msg.body.params.source;\r\n        returnedValue = _this.context.savePolicies(source);\r\n      } else if (funcName === 'userPolicies') {\r\n        returnedValue = _this.context.userPolicies;\r\n      } else if (funcName === 'activeUserPolicy') {\r\n        let userPolicy = msg.body.params.userPolicy;\r\n        if (userPolicy) { _this.context.activeUserPolicy = userPolicy; }\r\n        returnedValue = _this.context.activeUserPolicy;\r\n      } else if (funcName === 'userPolicy') {\r\n        let key = msg.body.params.key;\r\n        returnedValue = _this.context.userPolicies[key];\r\n      } else if (funcName === 'saveActivePolicy') {\r\n        returnedValue = _this.context.saveActivePolicy();\r\n      } else if (funcName === 'getMyEmails') {\r\n        returnedValue = _this.context.getMyEmails();\r\n      } else if (funcName === 'getMyHyperties') {\r\n        returnedValue = _this.context.getMyHyperties();\r\n      } else if (funcName === 'groups') {\r\n        returnedValue = _this.context.groups;\r\n      } else if (funcName === 'getGroupsNames') {\r\n        returnedValue = _this.context.getGroupsNames();\r\n      } if (funcName === 'removeFromGroup') {\r\n        let groupName = msg.body.params.groupName;\r\n        let userEmail = msg.body.params.userEmail;\r\n        returnedValue = _this.context.removeFromGroup(groupName, userEmail);\r\n      }\r\n\r\n      let value = {type: 'execute', value: returnedValue, code: 200};\r\n      let replyMsg = {id: msg.id, type: 'response', to: msg.from, from: msg.to, body: value};\r\n      _this.context.messageBus.postMessage(replyMsg);\r\n    });\r\n  }\r\n\r\n  /**\r\n  * Adds a policy to the Policy Enforcement Point (PEP). The policy can be created by the service\r\n  * provider or by the user.\r\n  * @param    {String}    source\r\n  * @param    {String}    key\r\n  * @param    {Object}    policy\r\n  */\r\n  addPolicy(source, key, policy, combiningAlgorithm) {\r\n    if (!source) throw new Error('source is not defined');\r\n    if (!key) throw new Error('key is not defined');\r\n\r\n    if (policy === undefined) {\r\n      policy = new policy_Policy(key, [], [], combiningAlgorithm);\r\n    } else {\r\n      if (!(policy instanceof policy_Policy)) {\r\n        policy = new policy_Policy(policy.key, policy.rules, policy.actions, policy.combiningAlgorithm);\r\n      }\r\n    }\r\n\r\n    switch (source) {\r\n      case 'SERVICE_PROVIDER':\r\n        this.context.savePolicies(source, policy, key);\r\n        break;\r\n      case 'USER':\r\n        this.context.userPolicies[key] = policy;\r\n        this.context.savePolicies(source);\r\n        break;\r\n      default:\r\n        throw Error('Unknown policy source: ' + source);\r\n    }\r\n  }\r\n\r\n  authorise(message, isIncoming) {\r\n    // log.log('[Policy.PEP Authorise] ', message);\r\n    // log.log(message);\r\n    if (!message) throw new Error('message is not defined');\r\n    if (!message.from) throw new Error('message.from is not defined');\r\n    if (!message.to) throw new Error('message.to is not defined');\r\n    if (!message.type) throw new Error('message.type is not defined');\r\n    message.body = message.body || {};\r\n\r\n    return new Promise((resolve, reject) => {\r\n\r\n      message.body = message.body || {};\r\n      let _this = this;\r\n\r\n      let result = _this.pdp.evaluatePolicies(message, isIncoming);\r\n      if (result === 'Not Applicable') {\r\n        result = _this.context.defaultBehaviour;\r\n        message.body.auth = false;\r\n      }\r\n      _this.actionsService.enforcePolicies(message, isIncoming).then(messages => {\r\n        for (let i in messages) {\r\n          message = messages[i];\r\n          if (result) {\r\n            message.body.auth = (message.body.auth === undefined) ? true : message.body.auth;\r\n            resolve(message);\r\n          } else {\r\n            let errorMessage = { body: { code: 403, description: 'Blocked by policy' }, from: message.to, to: message.from, type: 'response' };\r\n            reject(errorMessage);\r\n          }\r\n        }\r\n      }, (error) => {\r\n        reject(error);\r\n      });\r\n\r\n    });\r\n  }\r\n  authoriseSync(message) {\r\n    let result;\r\n    message.body = message.body || {};\r\n    result = this.pdp.evaluatePolicies(message, true);\r\n    if (result === 'Not Applicable') {\r\n      result = this.context.defaultBehaviour;\r\n    }\r\n    return result;\r\n\r\n  }\r\n\r\n  removePolicy(source, key) {\r\n    if (!source) throw new Error('source is not defined');\r\n    if (source !== '*' && !key) throw new Error('key is not defined');\r\n\r\n    switch (source) {\r\n      case '*':\r\n        this.context.serviceProviderPolicy = {};\r\n        this.context.userPolicies = {};\r\n        this.context.activeUserPolicy = undefined;\r\n        this.context.savePolicies('USER');\r\n        this.context.savePolicies('SERVICE_PROVIDER');\r\n        this.context.saveActivePolicy();\r\n        break;\r\n      case 'SERVICE_PROVIDER':\r\n        delete this.context.serviceProviderPolicy[key];\r\n        this.context.savePolicies();\r\n        break;\r\n      case 'USER':\r\n        delete this.context.userPolicies[key];\r\n        if (key === this.context.activeUserPolicy) {\r\n          this.context.activeUserPolicy = undefined;\r\n          this.context.saveActivePolicy();\r\n        }\r\n        this.context.savePolicies('USER');\r\n        break;\r\n      default:\r\n        throw Error('Unknown policy source: ' + source);\r\n    }\r\n  }\r\n\r\n}\r\n\r\n/* harmony default export */ var policy_PEP = (PEP_PEP);\r\n\n// CONCATENATED MODULE: ./src/bus/Pipeline.js\n/**\r\n* Copyright 2016 PT Inovação e Sistemas SA\r\n* Copyright 2016 INESC-ID\r\n* Copyright 2016 QUOBIS NETWORKS SL\r\n* Copyright 2016 FRAUNHOFER-GESELLSCHAFT ZUR FOERDERUNG DER ANGEWANDTEN FORSCHUNG E.V\r\n* Copyright 2016 ORANGE SA\r\n* Copyright 2016 Deutsche Telekom AG\r\n* Copyright 2016 Apizee\r\n* Copyright 2016 TECHNISCHE UNIVERSITAT BERLIN\r\n*\r\n* Licensed under the Apache License, Version 2.0 (the \"License\");\r\n* you may not use this file except in compliance with the License.\r\n* You may obtain a copy of the License at\r\n*\r\n*   http://www.apache.org/licenses/LICENSE-2.0\r\n*\r\n* Unless required by applicable law or agreed to in writing, software\r\n* distributed under the License is distributed on an \"AS IS\" BASIS,\r\n* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n* See the License for the specific language governing permissions and\r\n* limitations under the License.\r\n**/\r\n\r\nlet Pipeline_log = loglevel[\"getLogger\"]('Pipeline');\r\n\r\n/**\r\n* @author micaelpedrosa@gmail.com\r\n* Sequencial processor of methods. Similar to how Sequential Promise's work, but better fit for message processing.\r\n* Normal use for this, is to intercept all messages with configured handlers, and act accordingly.\r\n*/\r\n\r\n\r\n\r\nclass Pipeline {\r\n  /* public\r\n    handlers: ((PipeContext) => void)[]\r\n    onFail: (error) => void\r\n  */\r\n\r\n  constructor(_onFail) {\r\n    let _this = this;\r\n\r\n    _this.handlers = [];\r\n    _this.onFail = _onFail;\r\n  }\r\n\r\n  /**\r\n   * Insert a message in the pipeline queue. All messages are wrapped with a PipeContext.\r\n   * @param  {Message} msg       Message for the queue\r\n   * @param  {Callback} onDeliver When message is finished processing from all handlers, it will be delivered in this callback.\r\n   */\r\n  process(msg, onDeliver) {\r\n    let _this = this;\r\n\r\n    if (_this.handlers.length > 0) {\r\n      let iter = new Iterator(_this.handlers);\r\n      iter.next(new PipeContext(_this, iter, msg, onDeliver));\r\n    } else {\r\n      onDeliver(msg);\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n* @author micaelpedrosa@gmail.com\r\n* Wrapper around a message that adds actions that can be fired by any interceptor handler.\r\n* The Pipeline is asynchronous, so an handler should always call an action, the default one is \"next()\"\r\n*/\r\nclass PipeContext {\r\n  /* private\r\n    _inStop: boolean\r\n\r\n    _pipeline: Pipeline\r\n    _iter: Iterator\r\n    _msg: Message\r\n  */\r\n\r\n  constructor(pipeline, iter, msg, onDeliver) {\r\n    let _this = this;\r\n\r\n    _this._inStop = false;\r\n\r\n    _this._pipeline = pipeline;\r\n    _this._iter = iter;\r\n    _this._msg = msg;\r\n    _this._onDeliver = onDeliver;\r\n  }\r\n\r\n  get pipeline() { return this._pipeline; }\r\n\r\n  get msg() { return this._msg; }\r\n  set msg(inMsg) { this._msg = inMsg; }\r\n\r\n  /**\r\n   * Proceed to the next interceptor handler, unless there was an error. If it's the last one, proceed to onDeliver handler.\r\n   */\r\n  next() {\r\n    let _this = this;\r\n\r\n    if (!_this._inStop) {\r\n      if (_this._iter.hasNext) {\r\n        _this._iter.next(_this);\r\n      } else {\r\n        _this._onDeliver(_this._msg);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Proceed directly to the onDeliver handler, unless there was an error.\r\n   */\r\n  deliver() {\r\n    let _this = this;\r\n    if (!_this._inStop) {\r\n      _this._inStop = true;\r\n      _this._onDeliver(_this._msg);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Mark the context with an error and proceed to the onFail handler.\r\n   * @param  {[type]} error [description]\r\n   */\r\n  fail(error) {\r\n    let _this = this;\r\n\r\n    if (!_this._inStop) {\r\n      _this._inStop = true;\r\n      if (_this._pipeline.onFail) {\r\n        _this._pipeline.onFail(error);\r\n      }\r\n    }\r\n  }\r\n\r\n\r\n\r\n\r\n}\r\n\r\nclass Iterator {\r\n  /* private\r\n    _index: number\r\n    _array: []\r\n  */\r\n\r\n  constructor(array) {\r\n    this._index = -1;\r\n    this._array = array;\r\n  }\r\n\r\n  get hasNext() {\r\n    return this._index < this._array.length - 1;\r\n  }\r\n\r\n  get next() {\r\n    this._index++;\r\n    return this._array[this._index];\r\n  }\r\n}\r\n\r\n/* harmony default export */ var bus_Pipeline = (Pipeline);\r\n\n// CONCATENATED MODULE: ./src/bus/MessageBus.js\n/**\r\n* Copyright 2016 PT Inovação e Sistemas SA\r\n* Copyright 2016 INESC-ID\r\n* Copyright 2016 QUOBIS NETWORKS SL\r\n* Copyright 2016 FRAUNHOFER-GESELLSCHAFT ZUR FOERDERUNG DER ANGEWANDTEN FORSCHUNG E.V\r\n* Copyright 2016 ORANGE SA\r\n* Copyright 2016 Deutsche Telekom AG\r\n* Copyright 2016 Apizee\r\n* Copyright 2016 TECHNISCHE UNIVERSITAT BERLIN\r\n*\r\n* Licensed under the Apache License, Version 2.0 (the \"License\");\r\n* you may not use this file except in compliance with the License.\r\n* You may obtain a copy of the License at\r\n*\r\n*   http://www.apache.org/licenses/LICENSE-2.0\r\n*\r\n* Unless required by applicable law or agreed to in writing, software\r\n* distributed under the License is distributed on an \"AS IS\" BASIS,\r\n* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n* See the License for the specific language governing permissions and\r\n* limitations under the License.\r\n**/\r\n\r\n// Log system\r\n\r\nlet MessageBus_log = loglevel[\"getLogger\"]('MessageBus');\r\n\r\n\r\n\r\n\r\n/**\r\n* @author micaelpedrosa@gmail.com\r\n* Message BUS Interface is an extension of the Bus\r\n* It doesn't support the default '*' listener, instead it uses the registry.resolve(..)\r\n*/\r\nclass MessageBus_MessageBus extends bus_Bus {\r\n  /* private\r\n  _registry: Registry\r\n  _forwards: { <from-url>: { fl: MsgListener, sandboxToUrls: Map(Sandbox, [to-url]), urlToSandbox: { to-url: Sandbox } } }\r\n\r\n  _pipeline: Pipeline\r\n  */\r\n\r\n  //TODO: future optimization\r\n  //1. message batch processing with setInterval\r\n  //2. resolve default gateway/protostub with register.resolve\r\n\r\n  constructor(registry, runtimeUrl) {\r\n    super();\r\n    this._registry = registry;\r\n    this._forwards = {};\r\n    this._runtimeUrl = runtimeUrl;\r\n\r\n    this._pipelineIn = new bus_Pipeline((error) => {\r\n      MessageBus_log.error('PIPELINE-ERROR: ', JSON.stringify(error));\r\n    });\r\n\r\n    this._pipelineOut = new bus_Pipeline((error) => {\r\n      MessageBus_log.error('PIPELINE-ERROR: ', JSON.stringify(error));\r\n    });\r\n  }\r\n\r\n  get pipelineIn() { return this._pipelineIn; }\r\n\r\n  get pipelineOut() { return this._pipelineOut; }\r\n\r\n  /**\r\n   * Post a message for routing. It will first search for a listener, if there is no one, it sends to a external routing using the _onPostMessage.\r\n   * External routing use the registry.resolve(..) method to decide the destination sandbox.\r\n   * @param  {Message} inMsg            JSON with mandatory Message structure {id, type, from, to}\r\n   * @param  {Callback} responseCallback Optional callback if a response is expected from the request. A response will be always sent, even if it is a \"Timeout\".\r\n   * @return {number}                  the Message id\r\n   */\r\n  postMessage(inMsg, responseCallback, timeout) {\r\n    MessageBus_log.info('onPOSTMessage: ', inMsg);\r\n    let _this = this;\r\n\r\n    let deliver = (msg) => {\r\n\r\n          _this._responseCallback(inMsg, responseCallback, timeout);\r\n\r\n          if (!_this._onResponse(msg)) {\r\n            let itemList = _this._subscriptions[msg.to];\r\n            if (itemList) {\r\n              //do not publish on default address, because of loopback cycle\r\n              _this._publishOn(itemList, msg);\r\n            } else if (!msg.to.includes(_this._runtimeUrl)) {\r\n              //if there is no listener, send to external interface\r\n              _this._onPostMessage(msg);\r\n            }\r\n          }\r\n    }\r\n\r\n    _this._genId(inMsg);\r\n\r\n    if (_this._isToProcess(inMsg)) {\r\n      let isIncoming = _this._isIncomingMessage(inMsg);\r\n\r\n      if (isIncoming) _this._pipelineIn.process(inMsg, deliver);\r\n      else _this._pipelineOut.process(inMsg, deliver);\r\n    } else deliver(inMsg);\r\n\r\n    return inMsg.id;\r\n\r\n  }\r\n\r\n\r\n  _isToProcess(message) {\r\n    let schemasToIgnore = ['domain', 'domain-idp', 'global', 'hyperty-runtime', 'runtime'];\r\n    let splitFrom = (message.from).split('://');\r\n    let fromSchema = splitFrom[0];\r\n    let splitTo = (message.to).split('://');\r\n    let toSchema =  splitTo[0];\r\n    let from = message.from;\r\n    let to = message.to;\r\n\r\n    // Signalling messages between P2P Stubs don't have to be verified. FFS\r\n\r\n    if (message.body && message.body.source) {\r\n      from = message.body.source;\r\n    }\r\n\r\n    if (message.body && message.body.subscriber) {\r\n      from = message.body.subscriber;\r\n    }\r\n\r\n    if (from.indexOf('/p2phandler/') !== -1 || from.indexOf('/p2prequester/') !== -1 || to.indexOf('/p2phandler/') !== -1 || to.indexOf('/p2prequester/') !== -1) {\r\n      return false;\r\n    }\r\n\r\n    if (this._registry.isLocal(from) && this._registry.isLocal(message.to))\r\n      return false;\r\n\r\n    if (message.from === fromSchema || message.to === toSchema || message.type === 'read' || message.type === 'response' || (message.from.includes('hyperty://') && message.type === 'delete')) {\r\n      return false;\r\n    } else {\r\n      return schemasToIgnore.indexOf(fromSchema) === -1 || schemasToIgnore.indexOf(toSchema) === -1;\r\n    }\r\n  }\r\n\r\n  _isIncomingMessage(message) {\r\n    let from;\r\n\r\n    if (message.type === 'forward') {\r\n      MessageBus_log.info('[MessageBus - isIncomingMessage] - message.type: ', message.type);\r\n      from = message.body.from;\r\n    } else if (message.hasOwnProperty('body') && message.body.hasOwnProperty('source') && message.body.source) {\r\n      MessageBus_log.info('[MessageBus - isIncomingMessage] - message.body.source: ', message.body.source);\r\n      from = message.body.source;\r\n    } else if (message.hasOwnProperty('body') && message.body.hasOwnProperty('subscriber') && message.body.subscriber) {\r\n      //TODO: this subscriber validation should not exist, because is outdated\r\n      //TODO: the syncher and syncher manager not following the correct spec;\r\n      MessageBus_log.info('[MessageBus - isIncomingMessage] - message.body.subscriber: ', message.body.subscriber);\r\n      from = message.body.subscriber;\r\n    }  else if (message.hasOwnProperty('body') && message.body.hasOwnProperty('reporter') && message.body.reporter) {\r\n      //TODO: this subscriber validation should not exist, because is outdated\r\n      //TODO: the syncher and syncher manager not following the correct spec;\r\n      MessageBus_log.info('[MessageBus - isIncomingMessage] - message.body.reporter: ', message.body.reporter);\r\n      from = message.body.reporter;\r\n    } else {\r\n      MessageBus_log.info('[MessageBus - isIncomingMessage] - message.from ', message.from);\r\n      from = message.from;\r\n    }\r\n\r\n    MessageBus_log.info('[MessageBus - isIncomingMessage] - check if isLocal: ', from);\r\n    return !this._registry.isLocal(from);\r\n  }\r\n\r\n\r\n  /**\r\n   * Adds an external publish address listener. Every message for the address will be forwarded to the external routing by _onPostMessage.\r\n   * This means, even if there is a listener for the address, it will also send the message to the external routing.\r\n   * @param {URL} from Publish address.\r\n   */\r\n  addPublish(from) {\r\n    let _this = this;\r\n\r\n    //verify if forward exist\r\n    let refCount = _this._forwards[from];\r\n    if (!refCount) {\r\n      let forwardListener = _this.addListener(from, (msg) => {\r\n        MessageBus_log.info('MB-PUBLISH: ( ' + from + ' )');\r\n        // hack to skip external routes for messages coming from external hosts \r\n        // and messages targeting internal core runtime components\r\n        if (!(msg.body && msg.body.source && msg.body.source.includes('/protostub/')) &&\r\n        !msg.to.includes(_this._runtimeUrl))\r\n          _this._onPostMessage(msg);\r\n      });\r\n\r\n      refCount = {\r\n        counter: 0,\r\n        fl: forwardListener,\r\n        remove: () => {\r\n          this.counter--;\r\n          if (this.counter === 0) {\r\n            this.fl.remove();\r\n            delete _this._forwards[from];\r\n          }\r\n        }\r\n      };\r\n\r\n     _this._forwards[from] = refCount;\r\n   }\r\n\r\n   refCount.counter++;\r\n   return refCount;\r\n  }\r\n\r\n  /**\r\n   * Adds a forward listener for a message destination. Every message reaching an address will be also sent to the forward address.\r\n   * @param {URL} from Message destination, it's actually the field \"to\" of the message.\r\n   * @param {URL} to   Forward address.\r\n   */\r\n   addForward(from, to) {\r\n     let _this = this;\r\n\r\n     return _this.addListener(from, (msg) => {\r\n       MessageBus_log.info('MB-FORWARD: ( ' + from + ' to ' + to + ' )');\r\n       _this.forward(to, msg);\r\n     });\r\n   }\r\n\r\n   /**\r\n    * Just forward's a message to the forward address. Listeners should be available for the forward address.\r\n    * @param  {URL} url Forward address.\r\n    * @param  {Message} msg Message to forward\r\n    */\r\n   forward(url, msg) {\r\n     let _this = this;\r\n\r\n     let itemList = _this._subscriptions[url];\r\n     if (itemList) {\r\n       _this._publishOn(itemList, msg);\r\n     }\r\n   }\r\n\r\n   //default route, if there are no listeners available for a message destination.\r\n   _onPostMessage(msg) {\r\n     let _this = this;\r\n\r\n     //resolve external protostub...\r\n     _this._registry.resolve(msg).then((route, msg2route) => {\r\n       if (msg2route) _this.forward(route, msg2route);\r\n       else _this.forward(route, msg);\r\n     }).catch(function(e) {\r\n       MessageBus_log.error('RESOLVE-ERROR: ', e);\r\n     });\r\n   }\r\n}\r\n\r\n/* harmony default export */ var bus_MessageBus = (MessageBus_MessageBus);\r\n\n// CONCATENATED MODULE: ./src/cryptoManager/utf8.js\n// Marshals a string to Uint8Array.\r\nfunction encodeUTF8(s) {\r\n\tvar i = 0;\r\n\tvar bytes = new Uint8Array(s.length * 4);\r\n\tfor (var ci = 0; ci != s.length; ci++) {\r\n    try{\r\n      var xxx = s.charCodeAt(ci);\r\n    } catch (err){\r\n      console.log(err.message);\r\n      return;\r\n\r\n    }\r\n\t\tvar c = s.charCodeAt(ci);\r\n\t\tif (c < 128) {\r\n\t\t\tbytes[i++] = c;\r\n\t\t\tcontinue;\r\n\t\t}\r\n\t\tif (c < 2048) {\r\n\t\t\tbytes[i++] = c >> 6 | 192;\r\n\t\t} else {\r\n\t\t\tif (c > 0xd7ff && c < 0xdc00) {\r\n\t\t\t\tif (++ci == s.length) throw 'UTF-8 encode: incomplete surrogate pair';\r\n\t\t\t\tvar c2 = s.charCodeAt(ci);\r\n\t\t\t\tif (c2 < 0xdc00 || c2 > 0xdfff) throw 'UTF-8 encode: second char code 0x' + c2.toString(16) + ' at index ' + ci + ' in surrogate pair out of range';\r\n\t\t\t\tc = 0x10000 + ((c & 0x03ff) << 10) + (c2 & 0x03ff);\r\n\t\t\t\tbytes[i++] = c >> 18 | 240;\r\n\t\t\t\tbytes[i++] = c>> 12 & 63 | 128;\r\n\t\t\t} else { // c <= 0xffff\r\n\t\t\t\tbytes[i++] = c >> 12 | 224;\r\n\t\t\t}\r\n\t\t\tbytes[i++] = c >> 6 & 63 | 128;\r\n\t\t}\r\n\t\tbytes[i++] = c & 63 | 128;\r\n\t}\r\n\treturn bytes.subarray(0, i);\r\n}\r\n\r\n// Unmarshals an Uint8Array to string.\r\nfunction decodeUTF8(bytes) {\r\n\tvar s = '';\r\n\tvar i = 0;\r\n\twhile (i < bytes.length) {\r\n\t\tvar c = bytes[i++];\r\n\t\tif (c > 127) {\r\n\t\t\tif (c > 191 && c < 224) {\r\n\t\t\t\tif (i >= bytes.length) throw 'UTF-8 decode: incomplete 2-byte sequence';\r\n\t\t\t\tc = (c & 31) << 6 | bytes[i] & 63;\r\n\t\t\t} else if (c > 223 && c < 240) {\r\n\t\t\t\tif (i + 1 >= bytes.length) throw 'UTF-8 decode: incomplete 3-byte sequence';\r\n\t\t\t\tc = (c & 15) << 12 | (bytes[i] & 63) << 6 | bytes[++i] & 63;\r\n\t\t\t} else if (c > 239 && c < 248) {\r\n\t\t\t\tif (i+2 >= bytes.length) throw 'UTF-8 decode: incomplete 4-byte sequence';\r\n\t\t\t\tc = (c & 7) << 18 | (bytes[i] & 63) << 12 | (bytes[++i] & 63) << 6 | bytes[++i] & 63;\r\n\t\t\t} else throw 'UTF-8 decode: unknown multibyte start 0x' + c.toString(16) + ' at index ' + (i - 1);\r\n\t\t\t++i;\r\n\t\t}\r\n\r\n\t\tif (c <= 0xffff) s += String.fromCharCode(c);\r\n\t\telse if (c <= 0x10ffff) {\r\n\t\t\tc -= 0x10000;\r\n\t\t\ts += String.fromCharCode(c >> 10 | 0xd800)\r\n\t\t\ts += String.fromCharCode(c & 0x3FF | 0xdc00)\r\n\t\t} else throw 'UTF-8 decode: code point 0x' + c.toString(16) + ' exceeds UTF-16 reach';\r\n\t}\r\n\treturn s;\r\n}\r\n\n// CONCATENATED MODULE: ./src/cryptoManager/Crypto.js\n\r\n\r\nlet Crypto_log = loglevel[\"getLogger\"]('CryptoManager');\r\n\r\n/**\r\n* Class with the cryptographic functions for the authentication protocol\r\n*\r\n*/\r\nclass Crypto_Crypto {\r\n\r\n/**\r\n* Runtimefactory is passed in the costructor, because the nodeJS has a different crypto module\r\n* from the browser. RuntimeFactory provides a wrapper for the fuctions of nodeJS, so they can be\r\n* invoked browser like.\r\n*/\r\n  constructor(runtimeFactory) {\r\n    let _this = this;\r\n    typeof runtimeFactory.createWebcrypto === 'function' ? _this._crypto = runtimeFactory.createWebcrypto() : _this._crypto = crypto;\r\n  }\r\n\r\n  /**\r\n  * Performs a RSA encryption\r\n  * @param   {ArrayBuffer}    value    the public key\r\n  * @param   {BufferSource}    value    data to be encryped\r\n  * @return  {Uint8Array}   encrypted data\r\n  */\r\n  encryptRSA(pubKey, data) {\r\n    Crypto_log.log('encryptRSA:pubKey', pubKey);\r\n    Crypto_log.log('encryptRSA:data', data);\r\n\r\n    let _this = this;\r\n\r\n    return new Promise(function(resolve, reject) {\r\n      _this._importRSAencryptKey(new Uint8Array(pubKey)).then(function(publicKey) {\r\n\r\n        _this._crypto.subtle.encrypt(\r\n          {\r\n            name: 'RSA-OAEP'\r\n          },\r\n          publicKey, //from generateKey or importKey above\r\n          data //ArrayBuffer of data you want to encrypt\r\n        )\r\n          .then(function(encrypted) {\r\n          //returns an ArrayBuffer containing the encrypted data\r\n          // log.log('crypto-encryptRSA', new Uint8Array(encrypted));\r\n            resolve(new Uint8Array(encrypted));\r\n\r\n          }).catch(function(err) {\r\n          // log.log('crypto-encryptRSA', err);\r\n            reject(err);\r\n          });\r\n      });\r\n    });\r\n  }\r\n\r\n  /**\r\n  * Performs a RSA decryption\r\n  * @param   {ArrayBuffer}    value    the private key\r\n  * @param   {BufferSource}    value    data to be decrypted\r\n  * @return  {Uint8Array}   decrypted data\r\n  */\r\n  decryptRSA(privKey, data) {\r\n    Crypto_log.log('decryptRSA:privKey', privKey);\r\n    Crypto_log.log('decryptRSA:data', data);\r\n    let _this = this;\r\n\r\n    return new Promise(function(resolve, reject) {\r\n      _this._importRSAdecryptKey(privKey).then(function(privateKey) {\r\n\r\n        _this._crypto.subtle.decrypt(\r\n          {\r\n            name: 'RSA-OAEP'\r\n          },\r\n          privateKey, //from generateKey or importKey above\r\n          data //ArrayBuffer of the data\r\n        )\r\n          .then(function(decrypted) {\r\n\r\n            let decryptedData = new Uint8Array(decrypted);\r\n\r\n            // log.log('crypto-decryptRSA', decryptedData);\r\n            resolve(decryptedData);\r\n\r\n          }).catch(function(err) {\r\n          // log.log('crypto-decryptRSA', err);\r\n            reject(err);\r\n          });\r\n      });\r\n\r\n    });\r\n  }\r\n\r\n  /**\r\n  * Performs a RSA sign\r\n  * @param   {ArrayBuffer}    value    the private key\r\n  * @param   {BufferSource}    value    data to be signed\r\n  * @return  {Uint8Array}   data signature\r\n  */\r\n  signRSA(privKey, data) {\r\n    let _this = this;\r\n\r\n    return new Promise(function(resolve, reject) {\r\n      _this._importRSAsignKey(privKey).then(function(privateKey) {\r\n\r\n        _this._crypto.subtle.sign(\r\n          {\r\n            name: 'RSASSA-PKCS1-v1_5'\r\n          },\r\n          privateKey, //from generateKey or importKey above\r\n          encodeUTF8(data) //ArrayBuffer of data you want to sign\r\n        )\r\n          .then(function(signature) {\r\n          //returns an ArrayBuffer containing the signature\r\n          // log.log('crypto-signRSA', new Uint8Array(signature));\r\n            resolve(new Uint8Array(signature));\r\n\r\n          }).catch(function(err) {\r\n          // log.log('crypto-signRSA', err);\r\n            reject(err);\r\n          });\r\n\r\n      });\r\n\r\n    });\r\n  }\r\n\r\n  /**\r\n  * Performs a RSA signature verification\r\n  * @param   {ArrayBuffer}    value    the public key\r\n  * @param   {BufferSource}    value    data to be verified\r\n  * @return  {Boolean}   result of the signature verification\r\n  */\r\n  verifyRSA(pubKey, data, signature) {\r\n    let _this = this;\r\n\r\n    return new Promise(function(resolve, reject) {\r\n      _this._importRSAverifyKey(pubKey).then(function(publicKey) {\r\n\r\n        _this._crypto.subtle.verify(\r\n          {\r\n            name: 'RSASSA-PKCS1-v1_5'\r\n          },\r\n          publicKey, //from generateKey or importKey above\r\n          signature, //ArrayBuffer of the signature\r\n          encodeUTF8(data) //ArrayBuffer of the data\r\n        )\r\n          .then(function(isvalid) {\r\n          //returns a boolean on whether the signature is true or not\r\n          // log.log('crypto-verifyRSA', isvalid);\r\n            resolve(isvalid);\r\n\r\n          }).catch(function(err) {\r\n          // log.log('crypto-verifyRSA', err);\r\n            reject(err);\r\n          });\r\n\r\n      });\r\n\r\n    });\r\n  }\r\n\r\n  /**\r\n  * Performs a RSA signature verification\r\n  * @param   {ArrayBuffer}    value    the public key\r\n  * @param   {BufferSource}    value    data to be verified\r\n  * @return  {Boolean}   result of the signature verification\r\n  */\r\n  encryptAES(key, data, iv) {\r\n    Crypto_log.log('encryptAES:key', key);\r\n    Crypto_log.log('encryptAES:data', data);\r\n    Crypto_log.log('encryptAES:iv', iv);\r\n    let _this = this;\r\n\r\n    return new Promise(function(resolve, reject) {\r\n      _this._importAESkey(key).then(function(aesKey) {\r\n\r\n        _this._crypto.subtle.encrypt(\r\n          {\r\n            name: 'AES-CBC',\r\n\r\n            //Don't re-use initialization vectors!\r\n            //Always generate a new iv every time your encrypt!\r\n            iv: iv\r\n          },\r\n          aesKey, //from generateKey or importKey above\r\n          encodeUTF8(data) //ArrayBuffer of data you want to encrypt\r\n        )\r\n          .then(function(encrypted) {\r\n          //returns an ArrayBuffer containing the encrypted data\r\n          // log.log('crypto-encryptAES', new Uint8Array(encrypted));\r\n            resolve(new Uint8Array(encrypted));\r\n\r\n          }).catch(function(err) {\r\n          // log.log('crypto-encryptAES', err);\r\n            reject(err);\r\n          });\r\n\r\n      });\r\n\r\n    });\r\n  }\r\n\r\n  decryptAES(key, data, iv) {\r\n    Crypto_log.log('decryptAES:key', key);\r\n    Crypto_log.log('decryptAES:data', data);\r\n    Crypto_log.log('decryptAES:iv', iv);\r\n    let _this = this;\r\n\r\n    return new Promise(function(resolve, reject) {\r\n      _this._importAESkey(key).then(function(aesKey) {\r\n\r\n        _this._crypto.subtle.decrypt(\r\n          {\r\n            name: 'AES-CBC',\r\n            iv: iv\r\n          },\r\n          aesKey, //from generateKey or importKey above\r\n          data //ArrayBuffer of the data\r\n        )\r\n          .then(function(decrypted) {\r\n\r\n            let decodedData = decodeUTF8(new Uint8Array(decrypted));\r\n            Crypto_log.log('crypto-decryptAES', decodedData);\r\n            resolve(decodedData);\r\n\r\n          }).catch(function(err) {\r\n          // log.log('crypto-decryptAES', err);\r\n            reject(err);\r\n          });\r\n\r\n      });\r\n\r\n    });\r\n  }\r\n\r\n  /**\r\n  * creates a hash using the HMAC algorithm\r\n  * @param  {byteArray}    key       key to be used in the hmac\r\n  * @param  {string}      data       information to be hashed\r\n  * @return  {byteArray}   signature  resulting hash\r\n  */\r\n  hashHMAC(key, data) {\r\n    Crypto_log.log('hashHMAC:key', key);\r\n    Crypto_log.log('hashHMAC:data', data);\r\n    let _this = this;\r\n\r\n    return new Promise(function(resolve, reject) {\r\n\r\n      if (typeof data != 'string') {\r\n        data = JSON.stringify(data);\r\n        Crypto_log.log('Converting hashHMAC inpured DATA');\r\n        Crypto_log.log('HHashHMAC:', data);\r\n      }\r\n\r\n\r\n      _this._importHMACkey(key).then(function(hmacKey) {\r\n\r\n        _this._crypto.subtle.sign(\r\n          {\r\n            name: 'HMAC'\r\n          },\r\n          hmacKey, //from generateKey or importKey above\r\n          encodeUTF8(data) //ArrayBuffer of data you want to sign\r\n        )\r\n          .then(function(signature) {\r\n            Crypto_log.log('HashHMAC signature:', new Uint8Array(signature));\r\n\r\n            // log.log('crypto-hashHMAC', signature);\r\n            //returns an ArrayBuffer containing the signature\r\n            resolve(new Uint8Array(signature));\r\n\r\n          }).catch(function(err) {\r\n            // log.log('crypto-hashHMAC', err);\r\n            reject(err);\r\n          });\r\n      });\r\n    });\r\n  }\r\n\r\n  /**\r\n  * verifies an hash using the HMAC algorithm\r\n  * @param  {byteArray}    key       key to be used in the hmac\r\n  * @param  {string}      data       information to be hashed to compare\r\n  * @param  {byteArray}  signature   hash to compare with the received data\r\n  * @return  {boolean}   isvalid     boolean saying if the data corresponds to the hash received\r\n  */\r\n  verifyHMAC(key, data, signature) {\r\n    Crypto_log.log('verifyHMAC:key', key);\r\n    Crypto_log.log('verifyHMAC:data', data);\r\n    Crypto_log.log('verifyHMAC:signature', signature);\r\n    let _this = this;\r\n\r\n    return new Promise(function(resolve, reject) {\r\n\r\n      _this._importHMACkey(key).then(function(hmacKey) {\r\n\r\n        if (typeof data != 'string') {\r\n          data = JSON.stringify(data);\r\n          Crypto_log.log('Converting verifyHMAC inputed DATA:', data);\r\n        }\r\n\r\n        _this._crypto.subtle.verify(\r\n          {\r\n            name: 'HMAC'\r\n          },\r\n          hmacKey, //from generateKey or importKey above\r\n          signature, //ArrayBuffer of the signature\r\n          encodeUTF8(data) //ArrayBuffer of the data\r\n        )\r\n          .then(function(isvalid) {\r\n          //returns a boolean on whether the signature is true or not\r\n          // log.log('crypto-verifyHMAC', isvalid);\r\n            Crypto_log.log('verifyHMAC result', isvalid);\r\n            (isvalid) ? resolve(isvalid) : reject(isvalid);\r\n\r\n          }).catch(function(err) {\r\n            Crypto_log.error('crypto-verifyHMAC', err);\r\n            reject(err);\r\n          });\r\n      });\r\n    });\r\n  }\r\n\r\n  /**\r\n  * generates a RSA public/private key pair with a modulus length of 2048 bits\r\n  * @return  {JSON}   keyPair    json containing the public and private keys\r\n  */\r\n  generateRSAKeyPair() {\r\n    let _this = this;\r\n    let keyPair = {};\r\n\r\n    return new Promise(function(resolve, reject) {\r\n      _this._crypto.subtle.generateKey(\r\n        {\r\n          name: 'RSA-PSS',\r\n          modulusLength: 2048, //can be 1024, 2048, or 4096\r\n          publicExponent: new Uint8Array([0x01, 0x00, 0x01]),\r\n          hash: {name: 'SHA-256'} //can be 'SHA-1', 'SHA-256', 'SHA-384', or 'SHA-512'\r\n        },\r\n        true, //whether the key is extractable (i.e. can be used in exportKey)\r\n        ['sign', 'verify'] //can be any combination of 'sign' and 'verify'\r\n\r\n      ).then(function(key) {\r\n        //returns a keypair object\r\n        // log.log(key);\r\n\r\n        _this._crypto.subtle.exportKey(\r\n          'spki', //can be 'jwk' (public or private), 'spki' (public only), or 'pkcs8' (private only)\r\n          key.publicKey //can be a publicKey or privateKey, as long as extractable was true\r\n        ).then(function(publicKey) {\r\n          //returns the exported key data\r\n          keyPair.public  = new Uint8Array(publicKey);\r\n          return _this._crypto.subtle.exportKey(\r\n            'pkcs8', //can be 'jwk' (public or private), 'spki' (public only), or 'pkcs8' (private only)\r\n            key.privateKey //can be a publicKey or privateKey, as long as extractable was true\r\n          );\r\n        }).then(function(privateKey) {\r\n          keyPair.private  = new Uint8Array(privateKey);\r\n\r\n          // log.log('crypto-generateRSAKeyPair', keyPair);\r\n          resolve(keyPair);\r\n\r\n        }).catch(function(err) {\r\n          Crypto_log.error(err);\r\n          reject(err);\r\n        });\r\n\r\n      }).catch(function(err) {\r\n        Crypto_log.error(err);\r\n        reject(err);\r\n      });\r\n    });\r\n  }\r\n\r\n  /**\r\n  * Generates a 128 bit random value.\r\n  * @return {byteArray}  array    random value\r\n  */\r\n  generateIV() {\r\n    let _this = this;\r\n\r\n    let array = new  Uint8Array(16);\r\n    _this._crypto.getRandomValues(array);\r\n\r\n    return array;\r\n  }\r\n\r\n  /**\r\n  * Generates a 256 bit random value. 32 bits are extrated from the machine time,\r\n  * the remaining are generated randomly\r\n  * @return {byteArray}  array    random value\r\n  */\r\n  generateRandom() {\r\n    let _this = this;\r\n\r\n    let array = new  Uint8Array(32);\r\n    _this._crypto.getRandomValues(array);\r\n\r\n    let date = Date.now();\r\n\r\n    let dateEncoded = encodeUTF8(date.toString());\r\n\r\n    //extract the least significant 4 bytes in the date\r\n    let finalDate = dateEncoded.slice(dateEncoded.length - 4, dateEncoded.length);\r\n\r\n    // add in the first 4 bytes of the array the bytes extracted previously;\r\n    for (let i = 0; i < 4; i++) { array[i] = finalDate[i]; }\r\n    return array;\r\n  }\r\n\r\n  /**\r\n  * generates a premaster secret (PMS) of 48 bytes (384 bits) randomly\r\n  * @return {byteArray}  array    premaster secret key\r\n  */\r\n  generatePMS() {\r\n    let _this = this;\r\n\r\n    let array = new Uint8Array(48);\r\n    _this._crypto.getRandomValues(array);\r\n    return array;\r\n  }\r\n\r\n  /**\r\n  * generates a masterKey secret (PMS) of 48 bytes (384 bits) using the premaster secret and\r\n  * two randoms\r\n  * @return {byteArray}  array    master secret key with 48 bytes\r\n  */\r\n  generateMasterSecret(hmacKey, data) {\r\n    let _this = this;\r\n\r\n    return new Promise(function(resolve, reject) {\r\n      let key = new Uint8Array(48);\r\n      let seed = data;\r\n\r\n      _this._digest(hmacKey).then((digestedKey) => {\r\n\r\n        _this.hashHMAC(digestedKey, seed).then(function(keypart0) {\r\n\r\n          //copy the first 32 bytes into the key\r\n          for (let i = 0; i < 32; i++) { key[i] = keypart0[i]; }\r\n          return _this.hashHMAC(digestedKey, seed + keypart0);\r\n\r\n        }).then(function(keypart1) {\r\n\r\n          //copy the first 16 bytes to the key remaining 16 bytes\r\n          for (let i = 0; i < 16; i++) { key[i + 32] = keypart1[i]; }\r\n\r\n          // log.log('crypto-generateMasterSecret', key);\r\n          resolve(key);\r\n\r\n        }).catch(function(err) {\r\n          // log.log('crypto-generateMasterSecret', err);\r\n          reject(err);\r\n        });\r\n      });\r\n\r\n    });\r\n  }\r\n\r\n  /**\r\n  * generates both users MAC and encryption keys. generate as output an array\r\n  * with 4 byteArray each with 32 bytes\r\n  * @param  {byteArray}        secret       secret to be used in the HMAC function\r\n  * @param  {String}           data         information to be used as seed\r\n  * @return {Array<byteArray>} key          array with the information to generate keys\r\n  */\r\n  generateKeys(hmacKey, data) {\r\n    let _this = this;\r\n\r\n    return new Promise(function(resolve, reject) {\r\n\r\n      let key = [];\r\n      let seed = data;\r\n\r\n      // iterate 4 times to obtain a 1024 key size\r\n      _this.hashHMAC(hmacKey, seed).then(function(keypart0) {\r\n        key.push(keypart0);\r\n        return _this.hashHMAC(hmacKey, seed + keypart0);\r\n\r\n      }).then(function(keypart1) {\r\n        key.push(keypart1);\r\n        return _this.hashHMAC(hmacKey, seed + keypart1);\r\n\r\n      }).then(function(keypart2) {\r\n        key.push(keypart2);\r\n        return _this.hashHMAC(hmacKey, seed + keypart2);\r\n\r\n      }).then(function(keypart3) {\r\n        key.push(keypart3);\r\n\r\n        // log.log('crypto-generateKeys', key);\r\n        resolve(key);\r\n\r\n      }).catch(function(err) {\r\n        // log.log('crypto-generateKeys', err);\r\n        reject(err);\r\n      });\r\n\r\n      // log.log(hmacKey, data);\r\n    });\r\n  }\r\n\r\n  _importRSAsignKey(privKey) {\r\n    let _this = this;\r\n\r\n    return new Promise(function(resolve, reject) {\r\n      _this._crypto.subtle.importKey(\r\n        'pkcs8', //can be 'jwk' (public or private), 'spki' (public only), or 'pkcs8' (private only)\r\n        privKey,\r\n        {   //these are the algorithm options\r\n          name: 'RSASSA-PKCS1-v1_5',\r\n          hash: {name: 'SHA-256'} //can be 'SHA-1', 'SHA-256', 'SHA-384', or 'SHA-512'\r\n        },\r\n        true, //whether the key is extractable (i.e. can be used in exportKey)\r\n        ['sign'] //'verify' for public key import, 'sign' for private key imports\r\n      )\r\n        .then(function(privateKey) {\r\n        //returns a publicKey (or privateKey if you are importing a private key)\r\n        // log.log('crypto-_importRSAsignKey', privateKey);\r\n          resolve(privateKey);\r\n\r\n        }).catch(function(err) {\r\n          Crypto_log.error('crypto-_importRSAsignKey', err);\r\n          reject(err);\r\n        });\r\n    });\r\n  }\r\n\r\n  _importRSAverifyKey(pubKey) {\r\n    let _this = this;\r\n\r\n    return new Promise(function(resolve, reject) {\r\n      _this._crypto.subtle.importKey(\r\n        'spki', //can be 'jwk' (public or private), 'spki' (public only), or 'pkcs8' (private only)\r\n        pubKey,\r\n        {   //these are the algorithm options\r\n          name: 'RSASSA-PKCS1-v1_5',\r\n          hash: {name: 'SHA-256'} //can be 'SHA-1', 'SHA-256', 'SHA-384', or 'SHA-512'\r\n        },\r\n        true, //whether the key is extractable (i.e. can be used in exportKey)\r\n        ['verify'] //'verify' for public key import, 'sign' for private key imports\r\n      )\r\n        .then(function(publicKey) {\r\n        //returns a publicKey (or privateKey if you are importing a private key)\r\n        // log.log('crypto-_importRSAverifyKey', publicKey);\r\n          resolve(publicKey);\r\n\r\n        }).catch(function(err) {\r\n          Crypto_log.error('crypto-_importRSAverifyKey', err);\r\n          reject(err);\r\n        });\r\n    });\r\n  }\r\n\r\n  _importRSAencryptKey(pubKey) {\r\n    let _this = this;\r\n\r\n    return new Promise(function(resolve, reject) {\r\n      _this._crypto.subtle.importKey(\r\n        'spki', //can be 'jwk' (public or private), 'spki' (public only), or 'pkcs8' (private only)\r\n        pubKey,\r\n        {   //these are the algorithm options\r\n          name: 'RSA-OAEP',\r\n          hash: {name: 'SHA-256'} //can be 'SHA-1', 'SHA-256', 'SHA-384', or 'SHA-512'\r\n        },\r\n        true, //whether the key is extractable (i.e. can be used in exportKey)\r\n        ['encrypt'] //'encrypt' or 'wrapKey' for public key import or\r\n        //'decrypt' or 'unwrapKey' for private key imports\r\n      )\r\n        .then(function(publicKey) {\r\n        //returns a publicKey (or privateKey if you are importing a private key)\r\n        // log.log('crypto-_importRSAencryptKey', publicKey);\r\n          resolve(publicKey);\r\n\r\n        }).catch(function(err) {\r\n          Crypto_log.error('crypto-_importRSAencryptKey', err.name);\r\n          reject(err);\r\n        });\r\n    });\r\n  }\r\n\r\n  _importRSAdecryptKey(privKey) {\r\n    let _this = this;\r\n\r\n    return new Promise(function(resolve, reject) {\r\n      _this._crypto.subtle.importKey(\r\n        'pkcs8', //can be 'jwk' (public or private), 'spki' (public only), or 'pkcs8' (private only)\r\n        privKey,\r\n        {   //these are the algorithm options\r\n          name: 'RSA-OAEP',\r\n          hash: {name: 'SHA-256'} //can be 'SHA-1', 'SHA-256', 'SHA-384', or 'SHA-512'\r\n        },\r\n        true, //whether the key is extractable (i.e. can be used in exportKey)\r\n        ['decrypt'] //'encrypt' or 'wrapKey' for public key import or\r\n        //'decrypt' or 'unwrapKey' for private key imports\r\n      )\r\n        .then(function(privateKey) {\r\n        //returns a publicKey (or privateKey if you are importing a private key)\r\n        // log.log('crypto-_importRSAdecryptKey', privateKey);\r\n          resolve(privateKey);\r\n\r\n        }).catch(function(err) {\r\n          Crypto_log.error('crypto-_importRSAdecryptKey', err);\r\n          reject(err);\r\n        });\r\n    });\r\n  }\r\n\r\n  concatPMSwithRandoms(pms, toRandom, fromRandom) {\r\n\r\n    let finalKey = new Uint8Array(pms.length + toRandom.length + fromRandom.length);\r\n\r\n    // add PremasterKey\r\n    for (let i = 0; i < pms.length; i++) {\r\n      finalKey[i] = pms[i];\r\n    }\r\n\r\n    //add to random\r\n    for (let i = 0; i < toRandom.length; i++) {\r\n      finalKey[i + pms.length] = pms[i];\r\n    }\r\n\r\n    //add from random\r\n    for (let i = 0; i < fromRandom.length; i++) {\r\n      finalKey[i + pms.length + toRandom.length] = pms[i];\r\n    }\r\n\r\n    return finalKey;\r\n  }\r\n\r\n  _generate256bitKey() {\r\n    let _this = this;\r\n    let array = new  Uint8Array(32);\r\n    _this._crypto.getRandomValues(array);\r\n\r\n    return array;\r\n  }\r\n\r\n  /**\r\n  * imports the secret to the HMAC function\r\n  * @param  {byteArray}   arrayBuffer     bytes to import as key\r\n  * @return {JSON}       key              key ready to be used in the HMAC cryptographic function\r\n  */\r\n  _importHMACkey(arrayBuffer) {\r\n    let _this = this;\r\n\r\n    return new Promise(function(resolve, reject) {\r\n\r\n      _this._digest(arrayBuffer).then((key) => {\r\n\r\n        _this._crypto.subtle.importKey(\r\n          'raw', //can be 'jwk' or 'raw'\r\n          key,\r\n          {   //this is the algorithm options\r\n            name: 'HMAC',\r\n            hash: {name: 'SHA-256'}, //can be 'SHA-1', 'SHA-256', 'SHA-384', or 'SHA-512'\r\n            length: 256 //optional, if you want your key length to differ from the hash function's block length\r\n          },\r\n          true, //whether the key is extractable (i.e. can be used in exportKey)\r\n          ['sign', 'verify'] //can be any combination of 'sign' and 'verify'\r\n        ).then(function(key) {\r\n          //returns the symmetric key\r\n          // log.log('crypto-_importHMACkey', key);\r\n          resolve(key);\r\n        })\r\n          .catch(function(err) {\r\n            reject(err);\r\n          });\r\n      });\r\n    });\r\n  }\r\n\r\n  _digest(value) {\r\n    let _this = this;\r\n\r\n    return new Promise(function(resolve, reject) {\r\n      _this._crypto.subtle.digest(\r\n        {\r\n          name: 'SHA-256'\r\n        },\r\n        value //The data you want to hash as an ArrayBuffer\r\n      )\r\n        .then(function(hash) {\r\n        //returns the hash as an ArrayBuffer\r\n        // log.log('crypto-digest', new Uint8Array(hash));\r\n          resolve(new Uint8Array(hash));\r\n        })\r\n        .catch(function(err) {\r\n          Crypto_log.error(err);\r\n          reject(err);\r\n        });\r\n\r\n    });\r\n  }\r\n\r\n  _importAESkey(arrayBuffer) {\r\n    let _this = this;\r\n    return new Promise(function(resolve, reject) {\r\n      _this._crypto.subtle.importKey(\r\n        'raw', //can be 'jwk' or 'raw'\r\n        arrayBuffer,\r\n        {   //this is the algorithm options\r\n          name: 'AES-CBC'\r\n        },\r\n        true, //whether the key is extractable (i.e. can be used in exportKey)\r\n        ['encrypt', 'decrypt'] //can be 'encrypt', 'decrypt', 'wrapKey', or 'unwrapKey'\r\n      )\r\n        .then(function(key) {\r\n        //returns the symmetric key\r\n        // log.log('crypto-importAESkey', key);\r\n          resolve(key);\r\n        })\r\n        .catch(function(err) {\r\n          Crypto_log.error('crypto-importAESkey', err);\r\n          reject(err);\r\n        });\r\n    });\r\n  }\r\n\r\n  _sha256(str) {\r\n    let _this = this;\r\n    let buffer = new TextEncoder('utf-8').encode(str);\r\n    return _this._crypto.subtle.digest('SHA-256', buffer).then(function(hash) {\r\n      return _this._hex(hash);\r\n    });\r\n  }\r\n\r\n  _hex(buffer) {\r\n    let hexCodes = [];\r\n    let view = new DataView(buffer);\r\n    for (let i = 0; i < view.byteLength; i += 4) {\r\n      // Using getUint32 reduces the number of iterations needed (we process 4 bytes each time)\r\n      let value = view.getUint32(i)\r\n\r\n      let stringValue = value.toString(16)\r\n\r\n      let padding = '00000000'\r\n      let paddedValue = (padding + stringValue).slice(-padding.length)\r\n      hexCodes.push(paddedValue);\r\n    }\r\n\r\n    // Join all the hex strings into one\r\n    return hexCodes.join('');\r\n  }\r\n\r\n\r\n}\r\n\r\n/* harmony default export */ var cryptoManager_Crypto = (Crypto_Crypto);\r\n\n// CONCATENATED MODULE: ./src/cryptoManager/CryptoManager.js\n// Log System\r\n\r\nlet CryptoManager_log = loglevel[\"getLogger\"]('CryptoManager');\r\n\r\n\r\n\r\n\r\n/**\r\n*  The Crypto Manager provides manages cryptographic features for the runtime including:\r\n*  - Mutual Authentication between peers\r\n*  - Crypto Keys\r\n*  - e2e encryption and decription of communication between Hyperties and dta objects\r\n*\r\n*/\r\nclass CryptoManager_CryptoManager {\r\n\r\n  /**\r\n  * This is the constructor to initialise the CryptoManager, it does not require any input.\r\n  * The init() must called in order to set mandatories attributes\r\n  */\r\n\r\n  constructor(storageManager) {\r\n    this.storageManager = storageManager;\r\n    this.userDefaultKeyRef = 'userAsymmetricKey';\r\n  }\r\n\r\n  init(runtimeURL, runtimeCapabilities, storageManager, dataObjectsStorage, registry, coreDiscovery, idm, runtimeFactory) {\r\n    let _this = this;\r\n\r\n    if (!runtimeURL) throw new Error('[] runtimeURL is missing.');\r\n    if (!storageManager) throw new Error('storageManager is missing');\r\n    if (!runtimeFactory) throw new Error('runtimeFactory is missing');\r\n\r\n    _this._runtimeURL = runtimeURL;\r\n    _this._cryptoManagerURL = _this._runtimeURL + '/cryptoManager';\r\n\r\n    //_this._myURL = _this._runtimeURL + '/crypto';\r\n    _this.storageManager = storageManager;\r\n    _this.dataObjectsStorage = dataObjectsStorage;\r\n    _this.runtimeCapabilities = runtimeCapabilities;\r\n\r\n    _this._runtimeFactory = runtimeFactory;\r\n    _this._domain = divideURL(_this._runtimeURL).domain;\r\n\r\n    _this.crypto = new cryptoManager_Crypto(_this._runtimeFactory);\r\n\r\n    // hashTable to store all the crypto information between two hyperties\r\n    _this.chatKeys = {};\r\n\r\n    // hashTable to store the symmetric keys to be used in the chat group\r\n    _this.dataObjectSessionKeys = {};\r\n\r\n    //failsafe to enable/disable all the criptographic functions\r\n    _this.isToUseEncryption = true;\r\n\r\n    _this._registry = registry;\r\n    _this._coreDiscovery = coreDiscovery;\r\n\r\n    _this._idm = idm;\r\n\r\n  }\r\n\r\n  //******************* GET AND SET METHODS *******************\r\n\r\n  /**\r\n  * return the messageBus in this Registry\r\n  * @param {MessageBus}           messageBus\r\n  */\r\n  get messageBus() {\r\n    let _this = this;\r\n    return _this._messageBus;\r\n  }\r\n\r\n  /**\r\n  * Set the messageBus in this Registry\r\n  * @param {MessageBus}           messageBus\r\n  */\r\n  set messageBus(messageBus) {\r\n    let _this = this;\r\n    _this._messageBus = messageBus;\r\n\r\n    _this.addCryptoGUIListeners();\r\n  }\r\n\r\n  /**\r\n  * return the coreDiscovery component\r\n  */\r\n  get coreDiscovery() {\r\n    let _this = this;\r\n    return _this._coreDiscovery;\r\n  }\r\n\r\n  /**\r\n  * return user's public key\r\n  */\r\n\r\n  /*  getMyPublicKey() {\r\n    // to be implemented\r\n\r\n    return new Promise((resolve)=> {\r\n      resolve('mypublickey');\r\n\r\n    });\r\n  }\r\n*/\r\n  /**\r\n  * Set the coreDiscovery component\r\n  * @param {coreDiscovery} coreDiscovery\r\n  */\r\n  set coreDiscovery(coreDiscovery) {\r\n    let _this = this;\r\n    _this._coreDiscovery = coreDiscovery;\r\n  }\r\n\r\n  /**\r\n  * return the registry in this idModule\r\n  * @param {registry}           registry\r\n  */\r\n  get registry() {\r\n    let _this = this;\r\n    return _this._registry;\r\n  }\r\n\r\n  /**\r\n  * Set the registry in this idModule\r\n  * @param {registry}     reg\r\n  */\r\n  set registry(registry) {\r\n    let _this = this;\r\n    _this._registry = registry;\r\n  }\r\n\r\n\r\n  // to be used to initialise IDM with SessionKeys used in previous session\r\n\r\n  loadSessionKeys() {\r\n    let _this = this;\r\n    return new Promise((resolve) => {\r\n\r\n      _this.storageManager.get('dataObjectSessionKeys').then((sessionKeys) => {\r\n        if (sessionKeys) _this.dataObjectSessionKeys = sessionKeys;\r\n        else _this.dataObjectSessionKeys = {};\r\n        resolve();\r\n      });\r\n    });\r\n  }\r\n\r\n  _isFromRemoteSM(from) {\r\n    let splitFrom = from.split('://');\r\n    return splitFrom[0] === 'runtime' && from !== this._runtimeURL + '/sm';\r\n  }\r\n\r\n  addCryptoGUIListeners() {\r\n    //TODO: Change the GUI invocation of this method\r\n    let _this = this;\r\n\r\n    _this._messageBus.addListener(_this._cryptoManagerURL, (msg) => {\r\n      let funcName = msg.body.method;\r\n\r\n      //let returnedValue;\r\n      if (funcName === 'generateRSAKeyPair') {\r\n        _this._crypto.getMyPublicKey().then((key) => {\r\n          let value = {type: 'execute', value: key, code: 200};\r\n          let replyMsg = {id: msg.id, type: 'response', to: msg.from, from: msg.to, body: value};\r\n          try {\r\n            _this._messageBus.postMessage(replyMsg);\r\n          } catch (err) {\r\n            CryptoManager_log.error('On addGUIListeners from if generateRSAKeyPair method postMessage error: ' + err);\r\n          }\r\n        });\r\n        return;\r\n      }\r\n\r\n    });\r\n  }\r\n\r\n\r\n  //******************* ENCRYPTION METHODS *******************\r\n  /**\r\n* Identifies the messages to be encrypted\r\n* @param {Message}    message\r\n* @returns {boolean}  returns true if the message requires encryption\r\n*/\r\n\r\n  _isToEncrypt(message) {\r\n    let _this = this;\r\n    CryptoManager_log.log('[CryptoManager._isToEncrypt]', message);\r\n    let isCreate = message.type === 'create';\r\n    let isFromHyperty = message.from.includes('hyperty://');\r\n    let isToHyperty = message.to.includes('hyperty://');\r\n    let isToDataObject = isDataObjectURL(message.to);\r\n    let reporter = _this.registry.getDataObjectReporter(message.to);\r\n\r\n    let doMutualAuthentication = message.hasOwnProperty('body') && message.body.hasOwnProperty('mutual') ? message.body.mutual\r\n    :  message.hasOwnProperty('body') && message.body.hasOwnProperty('value') && message.body.value.hasOwnProperty('mutual') ? message.body.value.mutual  : true;\r\n\r\n    if (!doMutualAuthentication) return false;\r\n    if (reporter !== null && utils_isLegacy(reporter)) {\r\n      return false;\r\n    }\r\n\r\n    //if is not to apply encryption, then returns resolve\r\n    if (!this.isToUseEncryption && !(message.type === 'handshake')) {\r\n      CryptoManager_log.info('not handshake: encryption disabled');\r\n      return false;\r\n    }\r\n\r\n    if (message.type === 'update') {\r\n      CryptoManager_log.info('update:encryption disabled');\r\n      return false;\r\n    }\r\n\r\n    if (message.type === 'forward') {\r\n      CryptoManager_log.info('forward:encryption disabled');\r\n      return false;\r\n    }\r\n\r\n    if (utils_isLegacy(message.to)) return false;\r\n\r\n    return ((isCreate && isFromHyperty && isToHyperty) || (isCreate && isFromHyperty && isToDataObject && doMutualAuthentication) || message.type === 'handshake' || (message.type === 'update' && doMutualAuthentication));\r\n  }\r\n\r\n\r\n  _isToDecrypt(message) {\r\n    let _this = this;\r\n\r\n\r\n    return new Promise((resolve, reject) => {\r\n      // For sybscribe message let's start the mutualAuthentication\r\n      let isSubscription = message.type === 'subscribe';\r\n      let isFromRemoteSM = _this._isFromRemoteSM(message.from);\r\n      let mutual = message.body.hasOwnProperty('value') && message.body.value.hasOwnProperty('mutual') ? message.body.value.mutual : \r\n      message.body.hasOwnProperty('mutual') ? message.body.mutual : true;\r\n      //      let mutual = message.body.hasOwnProperty('mutual') ? message.body.mutual : false;\r\n\r\nif (isSubscription && isFromRemoteSM && mutual) {\r\n//  if (isSubscription && isFromRemoteSM ) {\r\n    CryptoManager_log.log('[CryptoManager._isToDecrypt] _doMutualAuthenticationPhase1');\r\n        console.log('[CryptoManager._isToDecrypt] ', message);\r\n        let reporter = _this.registry.getDataObjectReporter(message.to);\r\n        if (reporter !== null && utils_isLegacy(reporter)) {\r\n          return resolve(false);\r\n        }\r\n\r\n        _this._doMutualAuthenticationPhase1(message).then(() => {\r\n          resolve(false);\r\n        }, (error) => {\r\n          reject(error);\r\n        });\r\n\r\n//      } else if (message.hasOwnProperty('body') && message.body.hasOwnProperty('value') && typeof message.body.value === 'string') {\r\n      } else if (message.hasOwnProperty('body') && message.body.hasOwnProperty('value') && typeof message.body.value === 'string' && mutual) {\r\n        CryptoManager_log.log('[CryptoManager._isToDecrypt] true');\r\n        resolve(true);\r\n      } else {\r\n        CryptoManager_log.log('[CryptoManager._isToDecrypt] false');\r\n        resolve(false);\r\n      }\r\n\r\n    }).catch((error) => {\r\n      CryptoManager_log.error('[CryptoManager._isToDecrypt]', error);\r\n    });\r\n\r\n  }\r\n\r\n  encryptMessage(message) {\r\n    //log.info('encryptMessage:message', message);\r\n    let _this = this;\r\n\r\n    CryptoManager_log.log('encrypt message ');\r\n\r\n    return new Promise(function(resolve, reject) {\r\n\r\n      let isHandShakeType = message.type === 'handshake';\r\n\r\n      //if is not to apply encryption, then returns resolve\r\n      if (!_this._isToEncrypt(message)) {\r\n        // log.log('decryption disabled');\r\n        return resolve(message);\r\n      }\r\n\r\n      let dataObjectURL = parseMessageURL(message.to);\r\n\r\n      let isToDataObject = isDataObjectURL(dataObjectURL);\r\n      let isToLegacyIdentity = utils_isLegacy(message.to);\r\n      let isFromHyperty = divideURL(message.from).type === 'hyperty';\r\n      let isToHyperty = divideURL(message.to).type === 'hyperty';\r\n\r\n      if (message.type === 'update') {\r\n        CryptoManager_log.log('encrypt message: message type update');\r\n        return resolve(message);\r\n      }\r\n\r\n      if (isToLegacyIdentity) {\r\n        resolve(message);\r\n      } else if (isFromHyperty && isToHyperty) {\r\n        let userURL = _this._registry.getHypertyOwner(message.from);\r\n        if (userURL) {\r\n\r\n          // check if exists any keys between two users\r\n          let chatKeys = _this.chatKeys[message.from + '<->' + message.to];\r\n          if (!chatKeys) {\r\n            chatKeys = _this._newChatCrypto(message, userURL);\r\n\r\n            //log.log('createChatKey encrypt', message.from + message.to);\r\n            _this.chatKeys[message.from + '<->' + message.to] = chatKeys;\r\n            message.body.handshakePhase = 'startHandShake';\r\n          }\r\n\r\n          if (chatKeys.authenticated && !isHandShakeType) {\r\n\r\n            let iv = _this.crypto.generateIV();\r\n            _this.crypto.encryptAES(chatKeys.keys.hypertyFromSessionKey, stringify(message.body.value), iv).then(encryptedValue => {\r\n\r\n              let filteredMessage = _this._filterMessageToHash(message, stringify(message.body.value) +\r\n                                                                        stringify(iv), chatKeys.hypertyFrom.messageInfo);\r\n\r\n              _this.crypto.hashHMAC(chatKeys.keys.hypertyFromHashKey, filteredMessage).then(hash => {\r\n                //log.log('result of hash ', hash);\r\n                let value = {iv: encode(iv), value: encode(encryptedValue), hash: encode(hash)};\r\n                message.body.value = encode(value);\r\n\r\n                resolve(message);\r\n              });\r\n            });\r\n\r\n            // if is a handshake message, just resolve it\r\n          } else if (isHandShakeType) {\r\n            resolve(message);\r\n\r\n            // else, starts a new handshake protocol\r\n          } else {\r\n            _this._doHandShakePhase(message, chatKeys).then(function(value) {\r\n              _this.chatKeys[message.from + '<->' + message.to] = value.chatKeys;\r\n\r\n              _this._messageBus.postMessage(value.message);\r\n              reject('encrypt handshake protocol phase ');\r\n            });\r\n          }\r\n        } else {\r\n          reject('In encryptMessage: Hyperty owner URL was not found');\r\n        }\r\n\r\n      //if from hyperty to a dataObjectURL\r\n      } else if (isFromHyperty && isToDataObject) {\r\n\r\n        //log.log('dataObject value to encrypt: ', message.body.value);\r\n        //log.log('IdentityModule - encrypt from hyperty to dataobject ', message);\r\n\r\n        _this.storageManager.get('dataObjectSessionKeys').then((sessionKeys) => {\r\n          sessionKeys = chatkeysToArrayCloner(sessionKeys || {});\r\n          let dataObjectKey = sessionKeys ? sessionKeys[dataObjectURL] : null;\r\n\r\n          _this.dataObjectsStorage.getDataObject(dataObjectURL).then((isHypertyReporter) => {\r\n            //if no key exists, create a new one if is the reporter of dataObject\r\n            if (!dataObjectKey) {\r\n              // if the hyperty is the reporter of the dataObject then generates a session key\r\n              if (isHypertyReporter.reporter && isHypertyReporter.reporter === message.from) {\r\n\r\n                let sessionKey = _this.crypto.generateRandom();\r\n                _this.dataObjectSessionKeys[dataObjectURL] = {sessionKey: sessionKey, isToEncrypt: true};\r\n                let dataObjectSessionKeysClone = chatkeysToStringCloner(_this.dataObjectSessionKeys);\r\n\r\n                //TODO: check if this does not need to be stored\r\n                _this.storageManager.set('dataObjectSessionKeys', 0, dataObjectSessionKeysClone).catch(err => {\r\n                  reject('On encryptMessage from method storageManager.set error: ' + err);\r\n                });\r\n                dataObjectKey = _this.dataObjectSessionKeys[dataObjectURL];\r\n              }\r\n            }\r\n\r\n            //check if there is already a session key for the chat room\r\n            if (dataObjectKey) {\r\n\r\n              // and if is to apply encryption, encrypt the messages\r\n              if (dataObjectKey.isToEncrypt) {\r\n                let iv = _this.crypto.generateIV();\r\n                let stringifiedIV = stringify(iv);\r\n                let stringifiedMessageBody = stringify(message.body.value);\r\n\r\n                _this.crypto.encryptAES(dataObjectKey.sessionKey, stringifiedMessageBody, iv).then(encryptedValue => {\r\n                  delete message.body.identity.assertion; //TODO: Check why assertion is comming on the message!\r\n                  delete message.body.identity.expires; //TODO: Check why expires is comming on the message!\r\n                  let filteredMessage = _this._filterMessageToHash(message, stringifiedMessageBody + stringifiedIV);\r\n\r\n                  _this.crypto.hashHMAC(dataObjectKey.sessionKey, filteredMessage).then(hash => {\r\n                    // log.log('hash ', hash);\r\n\r\n                    let newValue = {value: encode(encryptedValue), iv: encode(iv), hash: encode(hash)};\r\n\r\n                    message.body.value = stringify(newValue);\r\n                    resolve(message);\r\n                  });\r\n                });\r\n\r\n              // if not, just send the message\r\n              } else {\r\n                resolve(message);\r\n              }\r\n\r\n              // start the generation of a new session Key\r\n            } else {\r\n              reject('Data object key could not be defined: Failed to decrypt message ');\r\n            }\r\n          }).catch(err => { reject('On encryptMessage from method dataObjectsStorage.getDataObject error: ' + err); });\r\n        }).catch(err => { reject('On encryptMessage from method storageManager.get error: ' + err); });\r\n      }\r\n    });\r\n  }\r\n\r\n  encryptDataObject(dataObject, sender) {\r\n    let _this = this;\r\n\r\n    return new Promise(function(resolve, reject) {\r\n      CryptoManager_log.info('dataObject value to encrypt: ', dataObject);\r\n\r\n      let dataObjectURL = parseMessageURL(sender);\r\n\r\n      _this.storageManager.get('dataObjectSessionKeys').then((sessionKeys) => {\r\n        sessionKeys = chatkeysToArrayCloner(sessionKeys || {});\r\n        let dataObjectKey = sessionKeys ? sessionKeys[dataObjectURL] : null;\r\n\r\n        //check if there is already a session key for the chat room\r\n        if (dataObjectKey) {\r\n\r\n          // and if is to apply encryption, encrypt the messages\r\n          if (dataObjectKey.isToEncrypt) {\r\n            let iv = _this.crypto.generateIV();\r\n\r\n            _this.crypto.encryptAES(dataObjectKey.sessionKey, stringify(dataObject), iv).then(encryptedValue => {\r\n              let newValue = { value: encode(encryptedValue), iv: encode(iv) };\r\n\r\n              //log.log('encrypted dataObject', newValue);\r\n              return resolve(newValue);\r\n            }).catch(err => { reject('On encryptDataObject from method encryptAES error: ' + err); });\r\n\r\n          // if not, just send the message\r\n          } else {\r\n            CryptoManager_log.info('The dataObject is not encrypted');\r\n            return resolve(dataObject);\r\n          }\r\n\r\n          // start the generation of a new session Key\r\n        } else {\r\n          return reject('No dataObjectKey for this dataObjectURL:', dataObjectURL);\r\n        }\r\n      }).catch(err => { reject('On encryptDataObject from method storageManager.get error: ' + err); });\r\n    });\r\n  }\r\n\r\n  decryptMessage(message) {\r\n    let _this = this;\r\n\r\n    //  log.log('decryptMessage:message', message);\r\n\r\n    return new Promise(function(resolve, reject) {\r\n      let isHandShakeType = message.type === 'handshake';\r\n\r\n      _this._isToDecrypt(message).then((isToDecrypt) => {\r\n\r\n        //if is not to apply encryption, then returns resolve\r\n        if (!isToDecrypt) return resolve(message);\r\n\r\n        let dataObjectURL = parseMessageURL(message.to);\r\n\r\n        let isToDataObject = isDataObjectURL(dataObjectURL);\r\n        let isFromHyperty = divideURL(message.from).type === 'hyperty';\r\n        let isToHyperty = divideURL(message.to).type === 'hyperty';\r\n\r\n        if (message.type === 'update') {\r\n          return resolve(message);\r\n        }\r\n\r\n        //is is hyperty to hyperty communication\r\n        if (isFromHyperty && isToHyperty) {\r\n          // log.log('decrypt hyperty to hyperty');\r\n          let userURL = _this._registry.getHypertyOwner(message.to);\r\n          if (userURL) {\r\n\r\n            let chatKeys = _this.chatKeys[message.to + '<->' + message.from];\r\n            if (!chatKeys) {\r\n              chatKeys = _this._newChatCrypto(message, userURL, 'decrypt');\r\n              _this.chatKeys[message.to + '<->' + message.from] = chatKeys;\r\n            }\r\n\r\n            if (chatKeys.authenticated && !isHandShakeType) {\r\n              let value = decode(message.body.value);\r\n              let iv = decodeToUint8Array(value.iv);\r\n              let data = decodeToUint8Array(value.value);\r\n              let hash = decodeToUint8Array(value.hash);\r\n              _this.crypto.decryptAES(chatKeys.keys.hypertyToSessionKey, data, iv).then(decryptedData => {\r\n                // log.log('decrypted value ', decryptedData);\r\n                message.body.value = decryptedData;\r\n\r\n                let filteredMessage = _this._filterMessageToHash(message, decryptedData + iv);\r\n\r\n                _this.crypto.verifyHMAC(chatKeys.keys.hypertyToHashKey, filteredMessage, hash).then(result => {\r\n                  //log.log('result of hash verification! ', result);\r\n                  message.body.assertedIdentity = true;\r\n                  resolve(message);\r\n                });\r\n              });\r\n\r\n            } else if (isHandShakeType) {\r\n              _this._doHandShakePhase(message, chatKeys).then(function(value) {\r\n\r\n                //if it was started by doMutualAuthentication then ends the protocol\r\n                if (value === 'handShakeEnd') {\r\n                  //reject('decrypt handshake protocol phase');\r\n\r\n                  // if was started by a message, then resend that message\r\n                } else {\r\n                  _this.chatKeys[message.to + '<->' + message.from] = value.chatKeys;\r\n                  _this._messageBus.postMessage(value.message);\r\n\r\n                  //reject('decrypt handshake protocol phase ');\r\n                }\r\n              });\r\n            } else {\r\n              reject('wrong message do decrypt');\r\n            }\r\n          } else {\r\n            reject('error on decrypt message');\r\n          }\r\n\r\n          //if from hyperty to a dataObjectURL\r\n        } else if (isFromHyperty && isToDataObject) {\r\n          // log.log('dataObject value to decrypt: ', message.body);\r\n\r\n          _this.storageManager.get('dataObjectSessionKeys').then((sessionKeys) => {\r\n            sessionKeys = chatkeysToArrayCloner(sessionKeys || {});\r\n            let dataObjectKey = sessionKeys ? sessionKeys[dataObjectURL] : null;\r\n\r\n            if (dataObjectKey) {\r\n\r\n              //check if is to apply encryption\r\n              if (dataObjectKey.isToEncrypt) {\r\n                let parsedValue = parse(message.body.value);\r\n                let iv = decodeToUint8Array(parsedValue.iv);\r\n                let encryptedValue = decodeToUint8Array(parsedValue.value);\r\n                let hash = decodeToUint8Array(parsedValue.hash);\r\n\r\n                _this.crypto.decryptAES(dataObjectKey.sessionKey, encryptedValue, iv).then(decryptedValue => {\r\n                  let parsedValue = parse(decryptedValue);\r\n\r\n                  // log.log('decrypted Value,', parsedValue);\r\n                  message.body.value = parsedValue;\r\n\r\n                  let filteredMessage = _this._filterMessageToHash(message, stringify(parsedValue) + stringify(iv));\r\n\r\n                  _this.crypto.verifyHMAC(dataObjectKey.sessionKey, filteredMessage, hash).then(result => {\r\n                    CryptoManager_log.log('Received message HMAC result', result);\r\n\r\n                    message.body.assertedIdentity = true;\r\n                    resolve(message);\r\n                  }).catch(err => { reject('Message HMAC is invalid: ' + err); });\r\n                });\r\n\r\n                //if not, just return the message\r\n              } else {\r\n                message.body.assertedIdentity = true;\r\n                resolve(message);\r\n              }\r\n\r\n            } else {\r\n              message.body.assertedIdentity = true;\r\n              resolve(message);\r\n\r\n              //reject('no sessionKey for chat room found');\r\n            }\r\n          });\r\n\r\n        } else {\r\n          reject('wrong message to decrypt');\r\n        }\r\n      });\r\n\r\n    });\r\n  }\r\n\r\n  decryptDataObject(dataObject, sender) {\r\n    let _this = this;\r\n\r\n    return new Promise(function(resolve, reject) {\r\n      //if is not to apply encryption, then returns resolve\r\n      if (!_this.isToUseEncryption) {\r\n        // log.log('decryption disabled');\r\n        return resolve(dataObject);\r\n      }\r\n\r\n      let dataObjectURL = parseMessageURL(sender);\r\n\r\n      // log.log('dataObject value to decrypt: ', dataObject);\r\n\r\n      _this.storageManager.get('dataObjectSessionKeys').then((sessionKeys) => {\r\n        sessionKeys = chatkeysToArrayCloner(sessionKeys);\r\n        let dataObjectKey = sessionKeys ? sessionKeys[dataObjectURL] : null;\r\n\r\n        if (dataObjectKey) {\r\n\r\n          //check if is to apply encryption\r\n          if (dataObjectKey.isToEncrypt) {\r\n            let iv = decodeToUint8Array(dataObject.iv);\r\n            let encryptedValue = decodeToUint8Array(dataObject.value);\r\n\r\n            _this.crypto.decryptAES(dataObjectKey.sessionKey, encryptedValue, iv).then(decryptedValue => {\r\n              let parsedValue = parse(decryptedValue);\r\n              let newValue = { value: parsedValue, iv: encode(iv) };\r\n\r\n              // log.log('decrypted dataObject,', newValue);\r\n\r\n              return resolve(newValue);\r\n            }).catch(err => { reject('On decryptDataObject from method encryptAES error: ' + err); });\r\n\r\n          //if not, just return the dataObject\r\n          } else {\r\n            // log.log('The dataObject is not encrypted');\r\n            return resolve(dataObject);\r\n          }\r\n\r\n        } else {\r\n          return reject('No dataObjectKey for this dataObjectURL:', dataObjectURL);\r\n        }\r\n      });\r\n    });\r\n  }\r\n\r\n  _doMutualAuthenticationPhase1(message) {\r\n    let _this = this;\r\n    return new Promise(function(resolve, reject) {\r\n      let to = message.to.split('/');\r\n\r\n      //let subsIndex = to.indexOf('subscription');\r\n      //let isDataObjectSubscription = subsIndex !== -1;\r\n      to.pop();\r\n      let dataObjectURL = to[0] + '//' + to[2] + '/' + to[3];\r\n      _this._doMutualAuthenticationPhase2(dataObjectURL, message.body.subscriber).then(() => {\r\n        _this._registry.registerSubscriber(dataObjectURL, message.body.subscriber);\r\n        resolve();\r\n      }, (error) => {\r\n        reject(error);\r\n      });\r\n    });\r\n  }\r\n\r\n  _doMutualAuthenticationPhase2(sender, receiver) {\r\n    CryptoManager_log.info('doMutualAuthentication:sender ', sender);\r\n    CryptoManager_log.info('doMutualAuthentication:receiver ', receiver);\r\n    let _this = this;\r\n\r\n    return new Promise(function(resolve, reject) {\r\n\r\n      let dataObjectURL;\r\n\r\n      // check if the sender is a dataObject and if so stores that value\r\n      let reporterURL = _this._registry.getReporterURLSynchonous(sender);\r\n      if (reporterURL) {\r\n        dataObjectURL = sender;\r\n        sender = reporterURL;\r\n      }\r\n\r\n      let msg = {\r\n        to: receiver,\r\n        from: sender,\r\n        callback: undefined,\r\n        body: {handshakePhase: 'startHandShake', ignore: 'ignoreMessage'}\r\n      };\r\n\r\n      if (!sender || !receiver) {\r\n        return reject('sender or receiver missing on doMutualAuthentication');\r\n      }\r\n\r\n      let chatKeys = _this.chatKeys[sender + '<->' + receiver];\r\n      let userURL = _this._registry.getHypertyOwner(sender);\r\n\r\n      if (userURL) {\r\n\r\n        if (!chatKeys) {\r\n          // callback to resolve when finish the mutual authentication\r\n          let resolved = function(value) {\r\n            // log.log('callback value:', value);\r\n            resolve(value);\r\n          };\r\n          msg.callback = resolved;\r\n          msg.dataObjectURL = dataObjectURL;\r\n\r\n          chatKeys = _this._newChatCrypto(msg, userURL);\r\n          _this.chatKeys[sender + '<->' + receiver] = chatKeys;\r\n        }\r\n\r\n        if (chatKeys.authenticated) {\r\n\r\n          let startSessionKeyExchange = {\r\n            to: sender,\r\n            from: receiver\r\n          };\r\n          chatKeys.dataObjectURL = dataObjectURL;\r\n          _this._sendReporterSessionKey(startSessionKeyExchange, chatKeys).then(value => {\r\n\r\n            _this._messageBus.postMessage(value.message);\r\n            resolve('exchange of chat sessionKey initiated');\r\n          }).catch(err => { reject('On doMutualAuthentication from method _sendReporterSessionKey error: ' + err); });\r\n        } else {\r\n          _this._doHandShakePhase(msg, chatKeys);\r\n        }\r\n      } else {\r\n        reject('Mutual authentication error: Hyperty owner could not be resolved');\r\n      }\r\n    });\r\n\r\n  }\r\n\r\n\r\n  /**\r\n  * returns the reporter associated to the dataObject URL\r\n  * @param   {String}   dataObjectURL         dataObject url\r\n  * @return   {String}  reporter              dataObject url reporter\r\n  */\r\n  /*  _getHypertyFromDataObject(dataObjectURL) {\r\n    log.info('_getHypertyFromDataObject:dataObjectURL', dataObjectURL);\r\n    let _this = this;\r\n\r\n    return new Promise(function(resolve, reject) {\r\n\r\n      let splitedURL = divideURL(dataObjectURL);\r\n      let domain = splitedURL.domain;\r\n      let finalURL = _this._parseMessageURL(dataObjectURL);\r\n\r\n      // check if is the creator of the hyperty\r\n      let reporterURL = _this.registry.getReporterURLSynchonous(finalURL);\r\n      log.info('_getHypertyFromDataObject:reporterURL', reporterURL);\r\n\r\n      if (reporterURL) {\r\n        resolve(reporterURL);\r\n      } else {\r\n        // check if there is already an association from an hypertyURL to the dataObject\r\n        let storedReporterURL = _this.dataObjectsIdentity[finalURL];\r\n        log.info('_getHypertyFromDataObject:storedReporterURL', storedReporterURL);\r\n\r\n        if (storedReporterURL) {\r\n          resolve(storedReporterURL);\r\n        } else {\r\n          // check if there is any hyperty that subscribed the dataObjectURL\r\n          let subscriberHyperty = _this.registry.getDataObjectSubscriberHyperty(dataObjectURL);\r\n          log.info('_getHypertyFromDataObject:subscriberHyperty', subscriberHyperty);\r\n\r\n          if (subscriberHyperty) {\r\n            resolve(subscriberHyperty);\r\n          } else {\r\n            // search in domain registry for the hyperty associated to the dataObject\r\n            // search in case is a subscriber who wants to know the reporter\r\n            _this._coreDiscovery.discoverDataObjectPerURL(finalURL, domain).then(dataObject => {\r\n              log.info('_getHypertyFromDataObject:dataObject', dataObject);\r\n              _this.dataObjectsIdentity[finalURL] = dataObject.reporter;\r\n              log.info('_getHypertyFromDataObject:dataObject.reporter', dataObject.reporter);\r\n              resolve(dataObject.reporter);\r\n            }, err => {\r\n              reject(err);\r\n            });\r\n          }\r\n        }\r\n      }\r\n    });\r\n  }*/\r\n\r\n  _sendReporterSessionKey(message, chatKeys) {\r\n    let _this = this;\r\n\r\n    return new Promise(function(resolve, reject) {\r\n\r\n      let sessionKeyBundle = _this.dataObjectSessionKeys[chatKeys.dataObjectURL];\r\n      let reporterSessionKeyMsg;\r\n      let valueToEncrypt;\r\n      let sessionKey;\r\n      let iv;\r\n      let value = {};\r\n\r\n      //if there is not yet a session Key, generates a new one\r\n      if (!sessionKeyBundle) {\r\n        sessionKey = _this.crypto.generateRandom();\r\n        _this.dataObjectSessionKeys[chatKeys.dataObjectURL] = {sessionKey: sessionKey, isToEncrypt: true};\r\n\r\n        let dataObjectSessionKeysClone = chatkeysToStringCloner(_this.dataObjectSessionKeys);\r\n\r\n        _this.storageManager.set('dataObjectSessionKeys', 0, dataObjectSessionKeysClone).catch(err => {\r\n          reject('On _sendReporterSessionKey from method storageManager.set(dataObjectSessionKeys...) error: ' + err);\r\n        });\r\n\r\n      } else {\r\n        sessionKey = sessionKeyBundle.sessionKey;\r\n      }\r\n\r\n      try {\r\n        valueToEncrypt = encode({value: encode(sessionKey), dataObjectURL: chatKeys.dataObjectURL});\r\n      } catch (err) {\r\n        return reject('On _sendReporterSessionKey from method storageManager.set error valueToEncrypt: ' + err);\r\n      }\r\n\r\n      iv = _this.crypto.generateIV();\r\n      value.iv = encode(iv);\r\n      _this.crypto.encryptAES(chatKeys.keys.hypertyFromSessionKey, valueToEncrypt, iv).then(encryptedValue => {\r\n\r\n        reporterSessionKeyMsg = {\r\n          type: 'handshake',\r\n          to: message.from,\r\n          from: message.to,\r\n          body: {\r\n            handshakePhase: 'reporterSessionKey',\r\n            value: encode(encryptedValue)\r\n          }\r\n        };\r\n\r\n        let filteredMessage = _this._filterMessageToHash(reporterSessionKeyMsg, valueToEncrypt + iv, chatKeys.hypertyFrom.messageInfo);\r\n\r\n        return _this.crypto.hashHMAC(chatKeys.keys.hypertyFromHashKey, filteredMessage);\r\n      }).then(hashedMessage => {\r\n        let valueWithHash = encode({value: reporterSessionKeyMsg.body.value, hash: encode(hashedMessage), iv: value.iv});\r\n\r\n        reporterSessionKeyMsg.body.value = valueWithHash;\r\n\r\n        resolve({message: reporterSessionKeyMsg, chatKeys: chatKeys});\r\n      }).catch(err => {\r\n        reject('On _sendReporterSessionKey from chained promises encryptAES error: ' + err);\r\n      });\r\n    });\r\n  }\r\n\r\n  /**\r\n  * Function that resolve and create the domainURL in case it is provided one. If not, resolve the default domainURL\r\n  * @param {String}     idpDomain     idpDomain (Optional)\r\n  */\r\n  _resolveDomain(idpDomain) {\r\n    if (!idpDomain) {\r\n      return 'domain-idp://google.com';\r\n    } else {\r\n      return 'domain-idp://' + idpDomain;\r\n    }\r\n  }\r\n\r\n  _doHandShakePhase(message, chatKeys) {\r\n  // log('_doHandShakePhase:dataObject', message);\r\n  //\tlog('_doHandShakePhase:chatKeys', chatKeys);\r\n\r\n    let _this = this;\r\n\r\n    return new Promise(function(resolve, reject) {\r\n\r\n      let handshakeType = message.body.handshakePhase;\r\n      let iv;\r\n      let hash;\r\n      let value = {};\r\n      let filteredMessage;\r\n      let privateKeyHolder;\r\n\r\n      CryptoManager_log.info('handshake phase: ', handshakeType);\r\n\r\n      switch (handshakeType) {\r\n\r\n        case 'startHandShake': {\r\n          chatKeys.keys.fromRandom = _this.crypto.generateRandom();\r\n          let startHandShakeMsg = {\r\n            type: 'handshake',\r\n            to: message.to,\r\n            from: message.from,\r\n            body: {\r\n              handshakePhase: 'senderHello',\r\n              value: encode(chatKeys.keys.fromRandom)\r\n            }\r\n          };\r\n          chatKeys.handshakeHistory.senderHello = _this._filterMessageToHash(startHandShakeMsg, undefined, chatKeys.hypertyFrom.messageInfo);\r\n\r\n          // check if was the encrypt function or the mutual authentication that request the\r\n          // start of the handShakePhase.\r\n\r\n          if (chatKeys.initialMessage) {\r\n            resolve({message: startHandShakeMsg, chatKeys: chatKeys});\r\n          } else {\r\n            _this.chatKeys[message.from + '<->' + message.to] = chatKeys;\r\n            _this._messageBus.postMessage(startHandShakeMsg);\r\n          }\r\n\r\n          break;\r\n\r\n        }\r\n        case 'senderHello': {\r\n\r\n          CryptoManager_log.log('senderHello');\r\n          chatKeys.handshakeHistory.senderHello = _this._filterMessageToHash(message);\r\n          chatKeys.keys.fromRandom = decodeToUint8Array(message.body.value);\r\n          chatKeys.keys.toRandom = _this.crypto.generateRandom();\r\n\r\n          let senderHelloMsg = {\r\n            type: 'handshake',\r\n            to: message.from,\r\n            from: message.to,\r\n            body: {\r\n              handshakePhase: 'receiverHello',\r\n              value: encode(chatKeys.keys.toRandom)\r\n            }\r\n          };\r\n          chatKeys.handshakeHistory.receiverHello = _this._filterMessageToHash(senderHelloMsg, undefined, chatKeys.hypertyFrom.messageInfo);\r\n          resolve({message: senderHelloMsg, chatKeys: chatKeys});\r\n\r\n          break;\r\n        }\r\n        case 'receiverHello': {\r\n\r\n          CryptoManager_log.log('receiverHello');\r\n          _this.getMyPrivateKey().then(privateKey =>{\r\n            privateKeyHolder = privateKey;\r\n\r\n            chatKeys.handshakeHistory.receiverHello = _this._filterMessageToHash(message);\r\n\r\n            return _this._idm.validateAssertion(message.body.identity.assertion, undefined, message.body.identity.idp.domain);\r\n          }).then((value) => {\r\n\r\n            //TODO remove later this verification as soon as all the IdP proxy are updated in the example\r\n            let encodedpublicKey = (typeof value.contents === 'string') ? value.contents : value.contents.nonce;\r\n\r\n            let receiverPublicKey = parseToUint8Array(encodedpublicKey);\r\n            let premasterSecret = _this.crypto.generatePMS();\r\n            let toRandom = message.body.value;\r\n            chatKeys.hypertyTo.assertion = message.body.identity.assertion;\r\n            chatKeys.hypertyTo.publicKey = receiverPublicKey;\r\n            chatKeys.hypertyTo.userID    = message.body.identity.userProfile.userURL;\r\n            chatKeys.keys.toRandom  = decodeToUint8Array(toRandom);\r\n            chatKeys.keys.premasterKey = premasterSecret;\r\n\r\n            let concatKey = _this.crypto.concatPMSwithRandoms(premasterSecret, chatKeys.keys.toRandom, chatKeys.keys.fromRandom);\r\n\r\n            return _this.crypto.generateMasterSecret(concatKey, 'messageHistoric' + chatKeys.keys.toRandom + chatKeys.keys.fromRandom);\r\n\r\n            //generate the master key\r\n          }).then((masterKey) => {\r\n            chatKeys.keys.masterKey = masterKey;\r\n\r\n            return _this.crypto.generateKeys(masterKey, 'key expansion' + chatKeys.keys.toRandom + chatKeys.keys.fromRandom);\r\n\r\n            //generate the symmetric and hash keys\r\n          }).then((keys) => {\r\n\r\n            chatKeys.keys.hypertyToSessionKey = new Uint8Array(keys[0]);\r\n            chatKeys.keys.hypertyFromSessionKey = new Uint8Array(keys[1]);\r\n            chatKeys.keys.hypertyToHashKey = new Uint8Array(keys[2]);\r\n            chatKeys.keys.hypertyFromHashKey = new Uint8Array(keys[3]);\r\n            iv = _this.crypto.generateIV();\r\n            value.iv = encode(iv);\r\n\r\n            let messageStructure = {\r\n              type: 'handshake',\r\n              to: message.from,\r\n              from: message.to,\r\n              body: {\r\n                handshakePhase: 'senderCertificate'\r\n              }\r\n            };\r\n\r\n            // hash the value and the iv\r\n            filteredMessage = _this._filterMessageToHash(messageStructure, 'ok' + iv, chatKeys.hypertyFrom.messageInfo);\r\n            return _this.crypto.hashHMAC(chatKeys.keys.hypertyFromHashKey, filteredMessage);\r\n          }).then((hash) => {\r\n            value.hash = encode(hash);\r\n\r\n            //encrypt the data\r\n            return _this.crypto.encryptAES(chatKeys.keys.hypertyFromSessionKey, 'ok', iv);\r\n          }).then((encryptedData) => {\r\n            value.symetricEncryption = encode(encryptedData);\r\n\r\n            return _this.crypto.encryptRSA(chatKeys.hypertyTo.publicKey, chatKeys.keys.premasterKey);\r\n\r\n          }).then((encryptedValue) => {\r\n            value.assymetricEncryption = encode(encryptedValue);\r\n\r\n            let messageStructure = {\r\n              type: 'handshake',\r\n              to: message.from,\r\n              from: message.to,\r\n              body: {\r\n                handshakePhase: 'senderCertificate'\r\n              }\r\n            };\r\n\r\n            let messageToHash = _this._filterMessageToHash(messageStructure, chatKeys.keys.premasterKey, chatKeys.hypertyFrom.messageInfo);\r\n            return _this.crypto.signRSA(privateKeyHolder, encode(chatKeys.handshakeHistory) + encode(messageToHash));\r\n          }).then(signature => {\r\n\r\n            value.signature = encode(signature);\r\n\r\n            let receiverHelloMsg = {\r\n              type: 'handshake',\r\n              to: message.from,\r\n              from: message.to,\r\n              body: {\r\n                handshakePhase: 'senderCertificate',\r\n                value: encode(value)\r\n              }\r\n            };\r\n            chatKeys.handshakeHistory.senderCertificate = _this._filterMessageToHash(receiverHelloMsg, 'ok' + iv, chatKeys.hypertyFrom.messageInfo);\r\n\r\n            resolve({message: receiverHelloMsg, chatKeys: chatKeys});\r\n\r\n          }, error => reject(error));\r\n\r\n          break;\r\n        }\r\n        case 'senderCertificate': {\r\n\r\n          CryptoManager_log.log('senderCertificate');\r\n\r\n          let receivedValue = decode(message.body.value);\r\n\r\n          _this.getMyPrivateKey().then(privateKey =>{\r\n            privateKeyHolder = privateKey;\r\n\r\n            return _this._idm.validateAssertion(message.body.identity.assertion, undefined, message.body.identity.idp.domain);\r\n          }).then((value) => {\r\n            let encryptedPMS = decodeToUint8Array(receivedValue.assymetricEncryption);\r\n\r\n            //TODO remove later this verification as soon as all the IdP proxy are updated in the example\r\n            let encodedpublicKey = (typeof value.contents === 'string') ? value.contents : value.contents.nonce;\r\n\r\n            let senderPublicKey = parseToUint8Array(encodedpublicKey);\r\n            chatKeys.hypertyTo.assertion = message.body.identity.assertion;\r\n            chatKeys.hypertyTo.publicKey = senderPublicKey;\r\n            chatKeys.hypertyTo.userID    = message.body.identity.userProfile.userURL;\r\n\r\n            return _this.crypto.decryptRSA(privateKeyHolder, encryptedPMS);\r\n\r\n          }, (error) => {\r\n            // log.log(error);\r\n            reject('Error during authentication of identity: ', error.message);\r\n\r\n            //obtain the PremasterKey using the private key\r\n          }).then(pms => {\r\n\r\n            chatKeys.keys.premasterKey = new Uint8Array(pms);\r\n\r\n            let signature = decodeToUint8Array(receivedValue.signature);\r\n\r\n            let receivedmsgToHash = _this._filterMessageToHash(message, chatKeys.keys.premasterKey);\r\n\r\n            return _this.crypto.verifyRSA(chatKeys.hypertyTo.publicKey, encode(chatKeys.handshakeHistory) + encode(receivedmsgToHash), signature);\r\n\r\n            // validates the signature received\r\n          }).then(signValidationResult => {\r\n\r\n            //log.log('SenderCertificate - signature validation result ', signValidationResult);\r\n            let concatKey = _this.crypto.concatPMSwithRandoms(chatKeys.keys.premasterKey, chatKeys.keys.toRandom, chatKeys.keys.fromRandom);\r\n\r\n            return _this.crypto.generateMasterSecret(concatKey, 'messageHistoric' + chatKeys.keys.toRandom + chatKeys.keys.fromRandom);\r\n\r\n            // generates the master keys from the Premaster key and the randoms\r\n          }).then(masterKey => {\r\n            chatKeys.keys.masterKey = masterKey;\r\n\r\n            return _this.crypto.generateKeys(masterKey, 'key expansion' + chatKeys.keys.toRandom + chatKeys.keys.fromRandom);\r\n\r\n            // generates the symmetric keys to be used in the symmetric encryption\r\n          }).then(keys => {\r\n            chatKeys.keys.hypertyFromSessionKey = new Uint8Array(keys[0]);\r\n            chatKeys.keys.hypertyToSessionKey = new Uint8Array(keys[1]);\r\n            chatKeys.keys.hypertyFromHashKey = new Uint8Array(keys[2]);\r\n            chatKeys.keys.hypertyToHashKey = new Uint8Array(keys[3]);\r\n            iv = decodeToUint8Array(receivedValue.iv);\r\n            let data = decodeToUint8Array(receivedValue.symetricEncryption);\r\n\r\n            return _this.crypto.decryptAES(chatKeys.keys.hypertyToSessionKey, data, iv);\r\n\r\n          }).then(decryptedData => {\r\n            // log.log('decryptedData', decryptedData);\r\n\r\n            chatKeys.handshakeHistory.senderCertificate = _this._filterMessageToHash(message, decryptedData + iv);\r\n\r\n            let hashReceived = decodeToUint8Array(receivedValue.hash);\r\n\r\n            filteredMessage = _this._filterMessageToHash(message, decryptedData + iv);\r\n\r\n            return _this.crypto.verifyHMAC(chatKeys.keys.hypertyToHashKey, filteredMessage, hashReceived);\r\n\r\n          }).then(verifiedHash  => {\r\n\r\n            // log.log('result of hash verification ', verifiedHash);\r\n            let receiverFinishedMessage = {\r\n              type: 'handshake',\r\n              to: message.from,\r\n              from: message.to,\r\n              body: {\r\n                handshakePhase: 'receiverFinishedMessage'\r\n              }\r\n            };\r\n            iv = _this.crypto.generateIV();\r\n            value.iv = encode(iv);\r\n\r\n            filteredMessage = _this._filterMessageToHash(receiverFinishedMessage, 'ok!' + iv, chatKeys.hypertyFrom.messageInfo);\r\n\r\n            //log.log('TIAGO: doHandShakePhase verifiedHash');\r\n            return _this.crypto.hashHMAC(chatKeys.keys.hypertyFromHashKey, filteredMessage);\r\n          }).then(hash => {\r\n\r\n            value.hash = encode(hash);\r\n            return _this.crypto.encryptAES(chatKeys.keys.hypertyFromSessionKey, 'ok!', iv);\r\n\r\n          }).then(encryptedValue => {\r\n            value.value = encode(encryptedValue);\r\n            let receiverFinishedMessage = {\r\n              type: 'handshake',\r\n              to: message.from,\r\n              from: message.to,\r\n              body: {\r\n                handshakePhase: 'receiverFinishedMessage',\r\n                value: encode(value)\r\n              }\r\n            };\r\n\r\n            chatKeys.handshakeHistory.receiverFinishedMessage = _this._filterMessageToHash(receiverFinishedMessage, 'ok!' + iv, chatKeys.hypertyFrom.messageInfo);\r\n            chatKeys.authenticated = true;\r\n            resolve({message: receiverFinishedMessage, chatKeys: chatKeys});\r\n          }).catch(err => {\r\n            reject('On _doHandShakePhase from senderCertificate error: ' + err);\r\n          });\r\n\r\n          break;\r\n        }\r\n        case 'receiverFinishedMessage': {\r\n\r\n          chatKeys.authenticated = true;\r\n\r\n          value = decode(message.body.value);\r\n\r\n          iv = decodeToUint8Array(value.iv);\r\n          let data = decodeToUint8Array(value.value);\r\n          hash = decodeToUint8Array(value.hash);\r\n\r\n          _this.crypto.decryptAES(chatKeys.keys.hypertyToSessionKey, data, iv).then(decryptedData => {\r\n            // log.log('decryptedData', decryptedData);\r\n            chatKeys.handshakeHistory.receiverFinishedMessage = _this._filterMessageToHash(message, decryptedData + iv);\r\n\r\n            let filteredMessage = _this._filterMessageToHash(message, decryptedData + iv);\r\n            _this.crypto.verifyHMAC(chatKeys.keys.hypertyToHashKey, filteredMessage, hash).then(result => {\r\n\r\n              // check if there was an initial message that was blocked and send it\r\n              if (chatKeys.initialMessage) {\r\n\r\n                let initialMessage = {\r\n                  type: 'create',\r\n                  to: message.from,\r\n                  from: message.to,\r\n                  body: {\r\n                    value: chatKeys.initialMessage.body.value\r\n                  }\r\n                };\r\n\r\n                resolve({message: initialMessage, chatKeys: chatKeys});\r\n\r\n                //sends the sessionKey to the subscriber hyperty\r\n              } else {\r\n                _this._sendReporterSessionKey(message, chatKeys).then(value => {\r\n\r\n                  resolve(value);\r\n                }).catch(err => {\r\n                  reject('On _doHandShakePhase from receiverFinishedMessage error: ' + err);\r\n                });\r\n              }\r\n            });\r\n          });\r\n\r\n          break;\r\n        }\r\n\r\n        case 'reporterSessionKey': {\r\n\r\n          CryptoManager_log.log('reporterSessionKey');\r\n\r\n          let valueIVandHash = decode(message.body.value);\r\n          hash = decodeToUint8Array(valueIVandHash.hash);\r\n          iv = decodeToUint8Array(valueIVandHash.iv);\r\n          let encryptedValue = decodeToUint8Array(valueIVandHash.value);\r\n          let parsedValue;\r\n          let sessionKey;\r\n          let dataObjectURL;\r\n          let receiverAcknowledgeMsg;\r\n\r\n          //log.log('[IdentityModule reporterSessionKey] - decryptAES: ', chatKeys.keys.hypertyToSessionKey, encryptedValue, iv);\r\n\r\n          _this.crypto.decryptAES(chatKeys.keys.hypertyToSessionKey, encryptedValue, iv).then(decryptedValue => {\r\n\r\n            parsedValue = decode(decryptedValue);\r\n            sessionKey = decodeToUint8Array(parsedValue.value);\r\n            dataObjectURL = parsedValue.dataObjectURL;\r\n\r\n            let messageToHash = _this._filterMessageToHash(message, decryptedValue + iv);\r\n\r\n            return _this.crypto.verifyHMAC(chatKeys.keys.hypertyToHashKey, messageToHash, hash);\r\n\r\n          }).then(hashResult => {\r\n\r\n\r\n            // log.log('hash successfully validated ', hashResult);\r\n\r\n            _this.dataObjectSessionKeys[dataObjectURL] =  {sessionKey: sessionKey, isToEncrypt: true};\r\n            let dataObjectSessionKeysClone = chatkeysToStringCloner(_this.dataObjectSessionKeys);\r\n            _this.storageManager.set('dataObjectSessionKeys', 0, dataObjectSessionKeysClone).catch(err => {\r\n              reject('On _sendReporterSessionKey from method reporterSessionKey error: ' + err);\r\n            });\r\n\r\n            iv = _this.crypto.generateIV();\r\n            value.iv = encode(iv);\r\n\r\n            return _this.crypto.encryptAES(chatKeys.keys.hypertyFromSessionKey, 'ok!!', iv);\r\n          }).then(encryptedValue => {\r\n\r\n            receiverAcknowledgeMsg = {\r\n              type: 'handshake',\r\n              to: message.from,\r\n              from: message.to,\r\n              body: {\r\n                handshakePhase: 'receiverAcknowledge'\r\n              }\r\n            };\r\n\r\n            value.value = encode(encryptedValue);\r\n            let messageToHash = _this._filterMessageToHash(receiverAcknowledgeMsg, 'ok!!' + iv, chatKeys.hypertyFrom.messageInfo);\r\n\r\n            return _this.crypto.hashHMAC(chatKeys.keys.hypertyFromHashKey, messageToHash);\r\n          }).then(hashedMessage => {\r\n            let finalValue = encode({value: value.value, hash: encode(hashedMessage), iv: value.iv});\r\n\r\n            receiverAcknowledgeMsg.body.value = finalValue;\r\n            resolve({message: receiverAcknowledgeMsg, chatKeys: chatKeys});\r\n          }).catch(err => {\r\n            reject('On _doHandShakePhase from reporterSessionKey error: ' + err);\r\n          });\r\n\r\n          break;\r\n        }\r\n\r\n        case 'receiverAcknowledge': {\r\n\r\n          CryptoManager_log.log('receiverAcknowledge');\r\n\r\n          let receivedvalueIVandHash = decode(message.body.value);\r\n          let receivedHash = decodeToUint8Array(receivedvalueIVandHash.hash);\r\n          iv = decodeToUint8Array(receivedvalueIVandHash.iv);\r\n          let receivedEncryptedValue = decodeToUint8Array(receivedvalueIVandHash.value);\r\n\r\n          _this.crypto.decryptAES(chatKeys.keys.hypertyToSessionKey, receivedEncryptedValue, iv).then(decryptedValue => {\r\n\r\n            let filteredMessage = _this._filterMessageToHash(message, decryptedValue + iv);\r\n            return _this.crypto.verifyHMAC(chatKeys.keys.hypertyToHashKey, filteredMessage, receivedHash);\r\n          }).then(hashResult => {\r\n            // log.log('hashResult ', hashResult);\r\n\r\n            let callback = chatKeys.callback;\r\n\r\n            if (callback) {\r\n              callback('handShakeEnd');\r\n            }\r\n            resolve('handShakeEnd');\r\n          }).catch(err => {\r\n            reject('On _doHandShakePhase from receiverAcknowledge error: ' + err);\r\n          });\r\n\r\n          break;\r\n        }\r\n\r\n        default:\r\n          reject(message);\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n  * filter the messages to hash, by removing some fields not generated by the runtime core\r\n  * @param {Message}  message                     message\r\n  * @param {String}  decryptedValue (Optional)    value from body.value in case it originally comes encrypted\r\n  * @param {JSON}  identity(Optional)    add the hyperty identity associated in case is not added to the initial message\r\n  * @return {Message}  new message filtered\r\n  */\r\n  _filterMessageToHash(message, decryptedValue, identity) {\r\n\r\n    return {\r\n      type: message.type,\r\n      from: message.from,\r\n      to: message.to,\r\n      body: {\r\n        identity: identity || message.body.identity,\r\n        value: decryptedValue || message.body.value,\r\n        handshakePhase: message.body.handshakePhase\r\n      }\r\n    };\r\n  }\r\n\r\n  /**\r\n  * generates the initial structure for the keys between two users\r\n  * @param {JSON}    message              initial message that triggers the mutual authentication\r\n  * @param {String}  userURL              userURL\r\n  * @param {boolean} receiver(Optional)  indicates if is the sender or the receiver that creates a new chat crypto\r\n  * @return {JSON} newChatCrypto  new JSON structure for the chat crypto\r\n  */\r\n  _newChatCrypto(message, userURL, receiver) {\r\n    let _this = this;\r\n\r\n    //check whether is the sender or the receiver to create a new chatCrypto\r\n    //to mantain consistency on the keys if the receiver create a new chatCrypto,\r\n    //then invert the fields\r\n    let from = (receiver) ? message.to : message.from;\r\n    let to = (receiver) ? message.from : message.to;\r\n\r\n    let userInfo = _this._idm.getIdentity(userURL);\r\n\r\n    let newChatCrypto =\r\n      {\r\n        hypertyFrom:\r\n        {\r\n          hyperty: from,\r\n          userID: userInfo.userProfile.userURL,\r\n\r\n          //privateKey: \"getMyPublicKey\",\r\n          //publicKey: \"getMyPrivateKey\",\r\n          assertion: userInfo.assertion,\r\n          messageInfo: userInfo\r\n        },\r\n        hypertyTo:\r\n        {\r\n          hyperty: to,\r\n          userID: undefined,\r\n          publicKey: undefined,\r\n          assertion: undefined\r\n        },\r\n        keys:\r\n        {\r\n          hypertyToSessionKey: undefined,\r\n          hypertyFromSessionKey: undefined,\r\n          hypertyToHashKey: undefined,\r\n          hypertyFromHashKey: undefined,\r\n          toRandom: undefined,\r\n          fromRandom: undefined,\r\n          premasterKey: undefined,\r\n          masterKey: undefined\r\n        },\r\n        handshakeHistory: {\r\n          senderHello: undefined,\r\n          receiverHello: undefined,\r\n          senderCertificate: undefined,\r\n          receiverFinishedMessage: undefined\r\n        },\r\n        initialMessage: (message.body.ignore) ? undefined : message,\r\n        callback: message.callback,\r\n        authenticated: false,\r\n        dataObjectURL: message.dataObjectURL\r\n      };\r\n\r\n    return newChatCrypto;\r\n  }\r\n\r\n  /**\r\n  * Retrieves a public keys given a user refrence. If no key is found,\r\n  generates a new key asymmetric key and retrieves the public keys.\r\n  * @param   {userRef}    String    user reference for the key pair\r\n  * @return  {Array}   public key\r\n  */\r\n  getMyPublicKey(userRef = this.userDefaultKeyRef) {\r\n    let _this = this;\r\n    return new Promise((resolve, reject) => {\r\n      _this.storageManager.get(userRef).then(storedKeyPair => {\r\n        if (storedKeyPair) {\r\n          return resolve(storedKeyPair.public);\r\n        }\r\n        _this._generateAndStoreNewAsymetricKey(userRef).then(generatedKeyPair => {\r\n          resolve(generatedKeyPair.public);\r\n        }).catch(err => {\r\n          CryptoManager_log.error('[getMyPublicKey:_generateAndStoreNewAsymetricKey:err]: ' + err.message);\r\n          reject(err);\r\n        });\r\n      }).catch(err => {\r\n        CryptoManager_log.error('[getMyPublicKey:storageManager:err]: ' + err.message);\r\n        reject(err);\r\n      });\r\n    });\r\n  }\r\n\r\n  /**\r\n  * Retrieves a private keys given a user refrence. If no key is found,\r\n  generates a new key asymmetric key and retrieves the private key.\r\n  * @param   {userRef}    String    user reference for the key pair\r\n  * @return  {Array}   private key\r\n  **/\r\n  getMyPrivateKey(userRef = this.userDefaultKeyRef) {\r\n    let _this = this;\r\n    return new Promise((resolve, reject) => {\r\n      _this.storageManager.get(userRef).then(storedKeyPair => {\r\n        if (storedKeyPair) {\r\n          return resolve(storedKeyPair.private);\r\n        }\r\n        _this._generateAndStoreNewAsymetricKey(userRef).then(generatedKeyPair => {\r\n          resolve(generatedKeyPair.private);\r\n        }).catch(err => {\r\n          CryptoManager_log.error('[getMyPrivateKey:_generateAndStoreNewAsymetricKey:err]: ' + err.message);\r\n          reject(err);\r\n        });\r\n      }).catch(err => {\r\n        CryptoManager_log.error('[getMyPrivateKey:storageManager:err]: ' + err.message);\r\n        reject(err);\r\n      });\r\n    });\r\n  }\r\n\r\n\r\n  /**\r\n  * Generates a new key pair, stores and retrives the key pair.\r\n  * @param   {userRef}    String    user reference for the key pair\r\n  * @return  {Array}   private key\r\n  **/\r\n  _generateAndStoreNewAsymetricKey(userRef) {\r\n    let _this = this;\r\n    let keyPair = undefined;\r\n    return new Promise((resolve, reject) => {\r\n//      _this.crypto.generateRSAKeyPair().then(generatedKeyPair => {\r\n        let generatedKeyPair = {};\r\n        generatedKeyPair.private = generateGUID();\r\n        generatedKeyPair.public = generateGUID();\r\n        CryptoManager_log.log('_generateAndStoreNewAsymetricKey:userAsymmetricKeyGenerated', generatedKeyPair);\r\n        keyPair = generatedKeyPair;\r\n        _this.storageManager.set(userRef, 0, generatedKeyPair);\r\n//      }).then(storedReference => {\r\n//        log.log('_generateAndStoreNewAsymetricKey:userAsymmetricKeySuccess', storedReference);\r\n        resolve(keyPair);\r\n      }).catch(err => {\r\n        CryptoManager_log.error('[_generateAndStoreNewAsymetricKey:err]: ' + err.message);\r\n        reject(err);\r\n      });\r\n//    });\r\n  }\r\n\r\n}\r\n\r\n/*\r\nconst nodeJSKeyPairPopulate = { public: [48, 130, 1, 34, 48, 13, 6, 9, 42, 134, 72, 134, 247, 13, 1, 1, 1, 5, 0, 3, 130, 1, 15, 0, 48, 130, 1, 10, 2, 130, 1, 1, 0, 228, 43, 101, 12, 121, 7, 157, 71, 81, 58, 219, 32, 10, 108, 193, 179, 212, 116, 255, 59, 217, 32, 161, 201, 53, 171, 226, 199, 137, 202, 171, 60, 82, 53, 125, 62, 177, 126, 165, 24, 141, 30, 15, 226, 59, 107, 34, 7, 13, 149, 112, 125, 10, 230, 191, 156, 164, 177, 10, 185, 13, 66, 3, 217, 166, 244, 90, 119, 111, 27, 145, 104, 71, 189, 166, 226, 255, 133, 83, 151, 231, 101, 151, 89, 22, 19, 65, 154, 10, 53, 208, 218, 252, 219, 37, 50, 212, 86, 145, 107, 132, 90, 233, 202, 227, 108, 114, 141, 29, 73, 187, 31, 13, 234, 0, 232, 24, 191, 35, 149, 179, 138, 214, 159, 245, 162, 148, 221, 118, 17, 105, 89, 151, 146, 209, 55, 236, 61, 143, 233, 228, 10, 115, 8, 81, 197, 45, 123, 187, 223, 176, 254, 165, 69, 143, 29, 100, 114, 17, 130, 226, 223, 33, 11, 240, 81, 61, 172, 191, 157, 246, 202, 87, 131, 221, 88, 48, 127, 159, 119, 160, 152, 117, 61, 253, 174, 65, 214, 203, 218, 63, 50, 78, 160, 181, 221, 211, 128, 70, 178, 191, 170, 0, 13, 122, 173, 12, 203, 252, 4, 184, 225, 252, 7, 62, 96, 116, 15, 216, 158, 55, 85, 48, 16, 9, 206, 119, 74, 112, 243, 136, 84, 184, 223, 254, 101, 91, 61, 10, 91, 85, 192, 147, 144, 57, 29, 66, 238, 199, 244, 193, 194, 150, 232, 200, 107, 2, 3, 1, 0, 1],\r\n  private: [48, 130, 4, 191, 2, 1, 0, 48, 13, 6, 9, 42, 134, 72, 134, 247, 13, 1, 1, 1, 5, 0, 4, 130, 4, 169, 48, 130, 4, 165, 2, 1, 0, 2, 130, 1, 1, 0, 228, 43, 101, 12, 121, 7, 157, 71, 81, 58, 219, 32, 10, 108, 193, 179, 212, 116, 255, 59, 217, 32, 161, 201, 53, 171, 226, 199, 137, 202, 171, 60, 82, 53, 125, 62, 177, 126, 165, 24, 141, 30, 15, 226, 59, 107, 34, 7, 13, 149, 112, 125, 10, 230, 191, 156, 164, 177, 10, 185, 13, 66, 3, 217, 166, 244, 90, 119, 111, 27, 145, 104, 71, 189, 166, 226, 255, 133, 83, 151, 231, 101, 151, 89, 22, 19, 65, 154, 10, 53, 208, 218, 252, 219, 37, 50, 212, 86, 145, 107, 132, 90, 233, 202, 227, 108, 114, 141, 29, 73, 187, 31, 13, 234, 0, 232, 24, 191, 35, 149, 179, 138, 214, 159, 245, 162, 148, 221, 118, 17, 105, 89, 151, 146, 209, 55, 236, 61, 143, 233, 228, 10, 115, 8, 81, 197, 45, 123, 187, 223, 176, 254, 165, 69, 143, 29, 100, 114, 17, 130, 226, 223, 33, 11, 240, 81, 61, 172, 191, 157, 246, 202, 87, 131, 221, 88, 48, 127, 159, 119, 160, 152, 117, 61, 253, 174, 65, 214, 203, 218, 63, 50, 78, 160, 181, 221, 211, 128, 70, 178, 191, 170, 0, 13, 122, 173, 12, 203, 252, 4, 184, 225, 252, 7, 62, 96, 116, 15, 216, 158, 55, 85, 48, 16, 9, 206, 119, 74, 112, 243, 136, 84, 184, 223, 254, 101, 91, 61, 10, 91, 85, 192, 147, 144, 57, 29, 66, 238, 199, 244, 193, 194, 150, 232, 200, 107, 2, 3, 1, 0, 1, 2, 130, 1, 0, 103, 244, 137, 118, 116, 82, 14, 203, 102, 107, 253, 88, 12, 199, 222, 60, 243, 136, 86, 157, 74, 224, 190, 53, 113, 57, 157, 250, 49, 130, 96, 31, 252, 136, 152, 70, 143, 17, 215, 96, 103, 51, 18, 35, 141, 212, 210, 205, 9, 216, 83, 70, 245, 71, 138, 119, 112, 229, 164, 176, 9, 37, 81, 161, 193, 154, 68, 249, 115, 106, 201, 6, 12, 225, 144, 126, 141, 210, 141, 242, 128, 159, 221, 163, 222, 21, 233, 230, 167, 206, 59, 24, 250, 233, 81, 122, 102, 26, 6, 233, 72, 133, 47, 77, 155, 238, 86, 6, 139, 24, 131, 163, 179, 112, 48, 247, 142, 6, 207, 204, 173, 223, 140, 199, 150, 95, 123, 152, 202, 155, 131, 238, 62, 96, 133, 4, 217, 51, 121, 30, 38, 178, 189, 216, 44, 35, 241, 93, 7, 62, 90, 111, 216, 66, 209, 243, 128, 234, 141, 84, 135, 181, 13, 38, 220, 114, 245, 240, 178, 95, 220, 206, 11, 186, 234, 213, 66, 121, 83, 68, 89, 75, 46, 183, 145, 183, 147, 160, 215, 118, 198, 125, 181, 146, 30, 251, 58, 87, 47, 209, 237, 97, 24, 47, 179, 6, 110, 242, 99, 150, 226, 148, 198, 174, 146, 101, 213, 87, 178, 10, 223, 105, 18, 56, 53, 22, 212, 158, 170, 176, 51, 86, 145, 125, 124, 44, 9, 85, 19, 144, 246, 170, 78, 124, 30, 32, 12, 166, 174, 139, 77, 63, 173, 82, 10, 153, 2, 129, 129, 0, 248, 18, 143, 246, 137, 136, 145, 219, 178, 39, 27, 94, 64, 90, 47, 163, 114, 60, 63, 187, 131, 143, 244, 16, 42, 128, 231, 117, 92, 98, 219, 155, 62, 107, 252, 17, 245, 45, 160, 225, 103, 142, 72, 36, 193, 150, 235, 214, 175, 62, 212, 56, 45, 9, 0, 60, 114, 107, 134, 228, 204, 131, 131, 214, 94, 201, 148, 159, 99, 139, 181, 13, 119, 38, 30, 107, 166, 165, 203, 43, 34, 20, 207, 171, 32, 58, 167, 62, 196, 153, 103, 204, 213, 247, 48, 111, 227, 59, 95, 97, 194, 187, 53, 10, 247, 108, 58, 86, 28, 29, 113, 8, 110, 171, 220, 245, 11, 82, 233, 223, 91, 68, 166, 117, 174, 187, 62, 77, 2, 129, 129, 0, 235, 118, 2, 105, 239, 212, 30, 104, 157, 41, 109, 11, 248, 152, 22, 236, 97, 40, 153, 131, 228, 5, 86, 187, 113, 126, 144, 76, 141, 79, 110, 250, 146, 152, 49, 58, 156, 201, 176, 92, 189, 209, 30, 112, 108, 175, 204, 204, 247, 164, 46, 129, 239, 98, 127, 49, 145, 218, 63, 193, 124, 174, 18, 98, 201, 99, 154, 162, 138, 78, 159, 253, 3, 248, 3, 209, 36, 239, 193, 155, 193, 5, 19, 236, 37, 78, 118, 135, 250, 199, 7, 141, 248, 120, 36, 136, 93, 98, 174, 60, 18, 215, 93, 174, 107, 141, 116, 145, 167, 221, 210, 169, 247, 67, 254, 222, 161, 134, 63, 221, 90, 87, 42, 99, 227, 81, 173, 151, 2, 129, 129, 0, 133, 23, 168, 103, 83, 232, 146, 160, 181, 23, 40, 38, 204, 13, 214, 203, 49, 41, 195, 227, 189, 181, 8, 243, 119, 106, 75, 67, 250, 250, 10, 234, 98, 118, 26, 250, 35, 121, 132, 124, 10, 76, 26, 198, 165, 154, 108, 19, 117, 88, 23, 17, 192, 143, 184, 177, 181, 141, 157, 4, 185, 248, 193, 77, 204, 243, 7, 170, 240, 4, 111, 113, 183, 0, 27, 136, 20, 19, 149, 74, 33, 241, 218, 108, 236, 80, 171, 148, 16, 116, 97, 109, 83, 74, 88, 145, 94, 239, 102, 192, 19, 114, 207, 5, 128, 51, 111, 164, 237, 86, 154, 99, 52, 197, 62, 57, 182, 6, 152, 245, 61, 137, 58, 105, 159, 2, 84, 109, 2, 129, 129, 0, 226, 67, 111, 132, 95, 91, 101, 177, 63, 189, 44, 53, 193, 184, 92, 230, 223, 98, 133, 74, 209, 86, 52, 7, 65, 195, 206, 100, 81, 178, 144, 65, 167, 151, 42, 79, 89, 149, 18, 173, 188, 21, 244, 251, 49, 230, 41, 150, 153, 46, 35, 38, 231, 99, 174, 56, 115, 32, 215, 253, 85, 147, 108, 197, 147, 34, 236, 216, 222, 177, 57, 90, 136, 114, 207, 48, 46, 31, 90, 220, 18, 58, 143, 239, 111, 214, 27, 95, 6, 36, 53, 229, 62, 108, 45, 39, 1, 30, 47, 178, 56, 164, 206, 56, 42, 208, 46, 193, 61, 31, 147, 45, 147, 23, 187, 22, 50, 255, 111, 229, 132, 199, 152, 75, 142, 136, 209, 151, 2, 129, 129, 0, 165, 56, 232, 76, 55, 57, 240, 159, 92, 207, 220, 143, 130, 30, 57, 234, 251, 172, 171, 180, 54, 159, 229, 96, 246, 73, 112, 146, 75, 157, 242, 201, 161, 218, 37, 176, 35, 170, 50, 90, 148, 102, 191, 199, 239, 174, 78, 72, 67, 85, 199, 45, 149, 145, 132, 161, 212, 33, 157, 75, 216, 79, 39, 233, 18, 210, 255, 26, 72, 229, 239, 44, 12, 147, 158, 176, 192, 95, 126, 32, 175, 23, 226, 131, 139, 197, 175, 193, 62, 8, 151, 252, 68, 154, 94, 89, 189, 125, 90, 30, 36, 175, 73, 230, 194, 13, 233, 247, 123, 60, 241, 47, 171, 51, 189, 112, 111, 213, 141, 89, 70, 249, 236, 63, 236, 110, 115, 208]};\r\n*/\r\n\r\n/* harmony default export */ var cryptoManager_CryptoManager = (new CryptoManager_CryptoManager());\r\n\n// CONCATENATED MODULE: ./src/runtime/Loader.js\n// Log System\r\n\r\nlet Loader_log = loglevel[\"getLogger\"]('Loader');\r\n//import path from 'path';\r\n//import System from 'systemjs/dist/system';\r\n\r\n\r\n\r\n\r\nclass Loader_Loader {\r\n\r\n  constructor(runtimeURL, runtimeConfiguration, runtimeDescriptorsInstance) {\r\n    if (!runtimeConfiguration) throw Error('[Runtime.Loader] The descriptor need to know the runtime configuration');\r\n    if (!runtimeDescriptorsInstance) throw Error('[Runtime.Loader] The descriptor need to know the runtime Descriptor instance');\r\n\r\n    this.log = Loader_log;\r\n\r\n    this.runtimeConfiguration = runtimeConfiguration;\r\n    this.descriptors = runtimeDescriptorsInstance;\r\n    console.log(System);\r\n    console.log(allocation_AddressAllocation);\r\n//    System.noConflict();\r\n\r\n  }\r\n\r\n  /**\r\n   * Set runtime url\r\n   * @param  {string} value runtimeURL\r\n   */\r\n  set runtimeURL(value) {\r\n    this._runtimeURL = value;\r\n  }\r\n\r\n  /**\r\n   * Get runtime url\r\n   * @return {string} value runtimeURL\r\n   */\r\n  get runtimeURL() {\r\n    return this._runtimeURL;\r\n  }\r\n\r\n  /**\r\n   * Set Registry component\r\n   * @param  {Registry} value Registry Component\r\n   */\r\n  set registry(value) {\r\n    this._registry = value;\r\n\r\n    // Install AddressAllocation\r\n    let addressAllocation = allocation_AddressAllocation.instance;\r\n    this._addressAllocation = addressAllocation;\r\n\r\n    Loader_log.log('[Loader - AddressAllocation] - ', addressAllocation);\r\n  }\r\n\r\n  /**\r\n   * Get Registry component\r\n   * @return {Registry} Registry component\r\n   */\r\n  get registry() {\r\n    return this._registry;\r\n  }\r\n\r\n  /**\r\n   * Set Message Bus component\r\n   * @param  {MessageBus} value Message bus component\r\n   */\r\n  set messageBus(value) {\r\n    this._messagesBus = value;\r\n  }\r\n\r\n  /**\r\n   * Get Message Bus component\r\n   * @return {MessageBus} Message Bus component\r\n   */\r\n  get messageBus() {\r\n    return this._messagesBus;\r\n  }\r\n\r\n  /**\r\n   * Set Runtime Factory component\r\n   * @param  {runtimeFactory} value Factory includes the specific implementations for each environment\r\n   */\r\n  set runtimeFactory(value) {\r\n    this._runtimeFactory = value;\r\n  }\r\n\r\n  /**\r\n   * Get Runtime Factory component\r\n   * @return {runtimeFactory} Runtime Factory component\r\n   */\r\n  get runtimeFactory() {\r\n    return this._runtimeFactory;\r\n  }\r\n\r\n\r\n\r\n  /**\r\n   * Deploy Hyperty from Catalogue URL\r\n   *\r\n   * @see https://github.com/reTHINK-project/specs/tree/master/datamodel/core/address\r\n   *\r\n   * @param {URL.HypertyCatalogueURL} hypertyCatalogueURL - The Catalogue URL used to identify descriptors in the Catalogue.\r\n   * @param {boolean|URL.HypertyURL} [reuseURL=false] reuseURL - reuseURL is used to reuse the hypertyURL previously registred, by default the reuse is disabled;\r\n   * @param {URL} appURL - the app url origin address;\r\n   * @param {object} IdpConstraint - constraints to be used when selecting the identity to be associated with the Hyperty including origin, idp, and idHint.\r\n   * @returns {Promise<Boolean, Error>} this is Promise and returns true if all components are loaded with success or an error if someone fails.\r\n   *\r\n   * @memberOf Loader\r\n   */\r\n  loadHyperty(hypertyClass, reuseURL = false, IdpConstraint, appURL) {\r\n\r\n    if (!this._readyToUse()) return false;\r\n    if (!hypertyClass) throw new Error('[Runtime.Loader] hypertyClass parameter is needed');\r\n\r\n\r\n    let _hypertyURL;\r\n    let _hypertySandbox;\r\n    let _hypertySourcePackage;\r\n    let haveError = false;\r\n    let instance = new hypertyClass();\r\n    let hyperty = instance.name;\r\n\r\n\r\n    return new Promise((resolve, reject) => {\r\n\r\n      let errorReason = (reason) => {\r\n        Loader_log.info('[Runtime.Loader] Something failed on the deploy hyperty: ', reason);\r\n        reject(reason);\r\n      };\r\n  \r\n      let handleError = (reason) => {\r\n        haveError = true;\r\n        reject(reason);\r\n      };\r\n  \r\n      Loader_log.info('[Runtime.Loader.loadHyperty] ', hyperty);\r\n      let _hypertyDescriptor = instance.descriptor;\r\n\r\n      _hypertyDescriptor.dataObjects[0] = _hypertyDescriptor.dataObjects[0].replace('%domain%', this._registry._domain);\r\n\r\n      // at this point, we have completed \"step 2 and 3\" as shown in https://github.com/reTHINK-project/core-framework/blob/master/docs/specs/runtime/dynamic-view/basics/deploy-hyperty.md\r\n      Loader_log.info('[Runtime.Loader] 1: return hyperty descriptor: ', _hypertyDescriptor);\r\n\r\n\r\n      _hypertySandbox = this.registry.getAppSandbox();\r\n\r\n\r\n\r\n      let numberOfAddresses = 1;\r\n      //debugger;\r\n      this._addressAllocation.create(this._registry._domain, numberOfAddresses, _hypertyDescriptor, 'hyperty', reuseURL)\r\n      .then((addresses) => {\r\n        if (haveError) return false;\r\n        Loader_log.info('[Runtime.Loader] 6: return the addresses for the hyperty', addresses);\r\n\r\n        // Register hyperty\r\n        return this.registry.registerHyperty(_hypertySandbox, hyperty, _hypertyDescriptor, addresses, IdpConstraint);\r\n      }, handleError)\r\n      .then((registrationResult) => {\r\n        if (haveError) return false;\r\n        Loader_log.info('[Runtime.Loader] 7: registration result', registrationResult);\r\n\r\n        // we have completed step 16 of https://github.com/reTHINK-project/core-framework/blob/master/docs/specs/runtime/dynamic-view/basics/deploy-hyperty.md right now.\r\n        _hypertyURL = registrationResult.url;\r\n\r\n        // Extend original hyperty configuration;\r\n        let configuration = {};\r\n        if (!emptyObject(_hypertyDescriptor.configuration)) {\r\n          try {\r\n            configuration = Object.assign({}, JSON.parse(_hypertyDescriptor.configuration));\r\n          } catch (e) {\r\n            configuration = _hypertyDescriptor.configuration;\r\n          }\r\n        }\r\n        configuration.runtimeURL = this._runtimeURL;\r\n\r\n        if (registrationResult.p2pHandler) {\r\n          configuration.p2pHandler = registrationResult.p2pHandler;\r\n          configuration.p2pRequester = registrationResult.p2pRequester;\r\n        }\r\n\r\n\r\n        // We will deploy the component - step 17 of https://github.com/reTHINK-project/core-framework/blob/master/docs/specs/runtime/dynamic-view/basics/deploy-hyperty.md right now.\r\n\r\n        try {\r\n          //            return _hypertySandbox.deployComponent(_hypertySourcePackage.sourceCode, _hypertyURL, configuration);\r\n          return _hypertySandbox.deployComponent(instance, _hypertyURL, configuration);\r\n        } catch (e) {\r\n          Loader_log.info('[Runtime.Loader] Error on deploy component:', e);\r\n          reject(e);\r\n        }\r\n      }, handleError)\r\n      .then((deployComponentStatus) => {\r\n        if (haveError) return false;\r\n        Loader_log.info('[Runtime.Loader] 8: Deploy component status for hyperty: ', deployComponentStatus);\r\n\r\n        // we have completed step 19 https://github.com/reTHINK-project/core-framework/blob/master/docs/specs/runtime/dynamic-view/basics/deploy-hyperty.md right now.\r\n\r\n        // Add the message bus listener to the appSandbox or hypertSandbox;\r\n        this.messageBus.addListener(_hypertyURL, (msg) => {\r\n          _hypertySandbox.postMessage(msg);\r\n        });\r\n\r\n        // Add the message bus listener to the appSandbox or hypertSandbox;\r\n        this.messageBus.addListener(this.runtimeURL + '/status', (msg) => {\r\n          _hypertySandbox.postMessage(msg);\r\n        });\r\n\r\n        // we have completed step 20 of https://github.com/reTHINK-project/core-framework/blob/master/docs/specs/runtime/dynamic-view/basics/deploy-hyperty.md right now.\r\n        let deployed = {\r\n          runtimeHypertyURL: _hypertyURL,\r\n          status: deployComponentStatus,\r\n          name: hyperty,\r\n          instance: instance\r\n        };\r\n\r\n        Loader_log.info('[Runtime.Loader] Hyperty deployed: ', deployed);\r\n        resolve(instance);\r\n\r\n        // we have completed step 21 https://github.com/reTHINK-project/core-framework/blob/master/docs/specs/runtime/dynamic-view/basics/deploy-hyperty.md right now.\r\n        Loader_log.info('[Runtime.Loader] ------------------ END ------------------------');\r\n      }, handleError)\r\n      .catch(errorReason);\r\n      });\r\n  }\r\n\r\n  /**\r\n  * Deploy Stub from Catalogue URL or domain url\r\n  * @param  {URL.URL}     protostubURL    Catalogue URL for the ProtoStub to be loaded or the domain to be target by the protostub\r\n  * @param  {Object}      p2pConfig       configuration of p2p\r\n  */\r\n  loadStub(protostubURL, p2pConfig) {\r\n\r\n    if (!this._readyToUse()) return false;\r\n    if (!protostubURL) throw new Error('[Runtime.Loader.loadStub]ProtoStub descriptor url parameter is needed');\r\n\r\n    return new Promise((resolve, reject) => {\r\n\r\n      // to analyse if domain for p2pHandlers should be something else and not the default domain itself\r\n\r\n      let domain = divideURL(protostubURL).domain;\r\n\r\n      if (!domain) {\r\n        domain = protostubURL;\r\n      }\r\n\r\n      let _stubSandbox;\r\n      let _stubDescriptor;\r\n      let _runtimeProtoStubURL;\r\n      let _stubSourcePackage;\r\n      let haveError = false;\r\n      let stubId;\r\n      let stubInstance;\r\n\r\n      let errorReason = (reason) => {\r\n        Loader_log.info('[Runtime.Loader.loadStub]Something failed on the deploy of protocolstub: ', reason);\r\n        reject(reason);\r\n      };\r\n\r\n      let handleError = (reason) => {\r\n        haveError = true;\r\n        reject(reason);\r\n      };\r\n\r\n      // Discover Protocol Stub\r\n      let discoverStub;\r\n      let isP2PHandler = false;\r\n      let isP2PRequester = false;\r\n      let stubCapabilities = {};\r\n\r\n      Loader_log.info('[Runtime.Loader.loadStub] starting loading for ', protostubURL, ' with p2pconfig ', p2pConfig);\r\n      Loader_log.info('[Runtime.Loader.loadStub]Discover or Create a new ProtoStub for domain: ', domain);\r\n\r\n      // step 2 https://github.com/reTHINK-project/core-framework/blob/master/docs/specs/runtime/dynamic-view/basics/deploy-protostub.md\r\n      try {\r\n        if (p2pConfig) {\r\n\r\n          if (p2pConfig.hasOwnProperty('isHandlerStub') && p2pConfig.isHandlerStub) {\r\n            // step 6 https://github.com/reTHINK-project/core-framework/blob/master/docs/specs/runtime/dynamic-view/basics/deploy-protostub.md\r\n            isP2PHandler = true;\r\n            stubId = this.runtimeURL;\r\n            discoverStub = this.registry.discoverP2PStub();\r\n          } else {\r\n            isP2PRequester = true;\r\n            let p2pHandlerRuntimeURL = p2pConfig.remoteRuntimeURL;\r\n            stubId = p2pHandlerRuntimeURL;\r\n\r\n            // step 4 https://github.com/reTHINK-project/core-framework/blob/master/docs/specs/runtime/dynamic-view/basics/deploy-protostub.md\r\n\r\n            // step 5 https://github.com/reTHINK-project/core-framework/blob/master/docs/specs/runtime/dynamic-view/basics/deploy-protostub.md\r\n            discoverStub = this.registry.discoverP2PStub(p2pHandlerRuntimeURL);\r\n          }\r\n\r\n        } else {\r\n          // step 3 https://github.com/reTHINK-project/core-framework/blob/master/docs/specs/runtime/dynamic-view/basics/deploy-protostub.md\r\n          stubId = domain;\r\n          discoverStub = this.registry.discoverProtostub(domain);\r\n        }\r\n\r\n        // Is registed?\r\n        Loader_log.info('[Runtime.Loader.loadStub]1. Proto Stub Discovered for ', protostubURL, ': ', discoverStub);\r\n\r\n        // step 23 https://github.com/reTHINK-project/core-framework/blob/master/docs/specs/runtime/dynamic-view/basics/deploy-protostub.md\r\n        resolve(discoverStub);\r\n        Loader_log.info(' [Runtime.Loader]------------------- END ---------------------------\\n');\r\n\r\n      } catch (reason) {\r\n\r\n        // is not registed?\r\n        Loader_log.info('[Runtime.Loader.loadStub]1. Proto Stub not found ' + reason);\r\n\r\n        // step 8 https://github.com/reTHINK-project/core-framework/blob/master/docs/specs/runtime/dynamic-view/basics/deploy-protostub.md\r\n        this._load('protocolstub', protostubURL)\r\n//        this.descriptors.getStubDescriptor(protostubURL)\r\n\r\n          .then((instance) => {\r\n\r\n\r\n            if (haveError) return false;\r\n\r\n            // step 9 https://github.com/reTHINK-project/core-framework/blob/master/docs/specs/runtime/dynamic-view/basics/deploy-protostub.md\r\n            _stubDescriptor = instance.descriptor;\r\n            Loader_log.info('[Runtime.Loader.loadStub]2. return the ProtoStub descriptor ', _stubDescriptor);\r\n            stubInstance = instance;\r\n\r\n/*            let sourcePackageURL = stubDescriptor.sourcePackageURL;\r\n\r\n            if (sourcePackageURL === '/sourcePackage') {\r\n              return stubDescriptor.sourcePackage;\r\n            }*/\r\n\r\n            // step 10 https://github.com/reTHINK-project/core-framework/blob/master/docs/specs/runtime/dynamic-view/basics/deploy-protostub.md\r\n//            return this.runtimeCatalogue.getSourcePackageFromURL(sourcePackageURL);\r\n\r\n/*          }, handleError)\r\n          .catch(errorReason)\r\n          .then((stubSourcePackage) => {\r\n            if (haveError) return false;*/\r\n\r\n            // According to debug, it seems RuntimeCatalogue does not support yet constraints. It appears empty!!!!\r\n\r\n            if (_stubDescriptor && _stubDescriptor.constraints) {\r\n              stubCapabilities = _stubDescriptor.constraints;\r\n            }\r\n\r\n            // step 11 https://github.com/reTHINK-project/core-framework/blob/master/docs/specs/runtime/dynamic-view/basics/deploy-protostub.md\r\n            Loader_log.info('[Runtime.Loader.loadStub]3. return the ProtoStub Source Code');\r\n//            _stubSourcePackage = stubSourcePackage;\r\n\r\n            // this will return the sandbox or one promise to getSandbox;\r\n            // step 12 https://github.com/reTHINK-project/core-framework/blob/master/docs/specs/runtime/dynamic-view/basics/deploy-protostub.md\r\n            return this.registry.getSandbox(domain, stubCapabilities);\r\n          })\r\n          .then((stubSandbox) => {\r\n            if (haveError) return false;\r\n\r\n            // step 15 https://github.com/reTHINK-project/core-framework/blob/master/docs/specs/runtime/dynamic-view/basics/deploy-protostub.md\r\n            Loader_log.info('[Runtime.Loader.loadStub]4. if the sandbox is registered then return the sandbox ', stubSandbox);\r\n\r\n            _stubSandbox = stubSandbox;\r\n            return stubSandbox;\r\n          })\r\n          .catch((reason) => {\r\n            if (haveError) return false;\r\n\r\n            // step 13 https://github.com/reTHINK-project/core-framework/blob/master/docs/specs/runtime/dynamic-view/basics/deploy-protostub.md\r\n            Loader_log.info('[Runtime.Loader.loadStub]5. Sandbox was not found, creating a new one ', reason);\r\n\r\n            // check if the sandbox is registed for this stub descriptor url;\r\n\r\n\r\n            // step 14 https://github.com/reTHINK-project/core-framework/blob/master/docs/specs/runtime/dynamic-view/basics/deploy-protostub.md\r\n            return this._runtimeFactory.createSandbox(stubCapabilities).then((sandbox) => {\r\n              sandbox.addListener('*', (msg) => {\r\n                this.messageBus.postMessage(msg);\r\n              });\r\n\r\n              return sandbox;\r\n            });\r\n\r\n          })\r\n          .then((sandbox) => {\r\n            if (haveError) return false;\r\n\r\n            // step 16 https://github.com/reTHINK-project/core-framework/blob/master/docs/specs/runtime/dynamic-view/basics/deploy-protostub.md\r\n            Loader_log.info('[Runtime.Loader.loadStub]6. return the sandbox instance and register', sandbox, 'to domain ', domain);\r\n\r\n            _stubSandbox = sandbox;\r\n\r\n            // we need register stub on registry - step xxx https://github.com/reTHINK-project/core-framework/blob/master/docs/specs/runtime/dynamic-view/basics/deploy-protostub.md\r\n            return this.registry.registerStub(_stubSandbox, stubId, p2pConfig, protostubURL, _stubDescriptor);\r\n          }, handleError)\r\n          .then((runtimeProtoStub) => {\r\n            if (haveError) return false;\r\n\r\n            // step 23 https://github.com/reTHINK-project/core-framework/blob/master/docs/specs/runtime/dynamic-view/basics/deploy-protostub.md\r\n            Loader_log.info('[Runtime.Loader.loadStub] 7. return the runtime protostub url: ', runtimeProtoStub);\r\n\r\n            _runtimeProtoStubURL = runtimeProtoStub.url;\r\n\r\n            // Extend original hyperty configuration;\r\n            let configuration = {};\r\n            if (!emptyObject(_stubDescriptor.configuration)) {\r\n              try {\r\n                configuration = Object.assign({}, JSON.parse(_stubDescriptor.configuration));\r\n              } catch (e) {\r\n                configuration = _stubDescriptor.configuration;\r\n              }\r\n            }\r\n\r\n            if (p2pConfig) {\r\n              try {\r\n                configuration = Object.assign(configuration, JSON.parse(p2pConfig));\r\n              } catch (e) {\r\n                configuration = Object.assign(configuration, p2pConfig);\r\n              }\r\n            }\r\n\r\n            // required for protostub session\r\n\r\n            configuration.runtimeURL = this._runtimeURL;\r\n\r\n            // step 24 https://github.com/reTHINK-project/core-framework/blob/master/docs/specs/runtime/dynamic-view/basics/deploy-protostub.md\r\n            try {\r\n              // step 26 https://github.com/reTHINK-project/core-framework/blob/master/docs/specs/runtime/dynamic-view/basics/deploy-protostub.md\r\n              Loader_log.info('[Runtime.Loader.loadStub] 8: adding sandbox listener to protostubURL : ', _runtimeProtoStubURL);\r\n\r\n              // step 27 https://github.com/reTHINK-project/core-framework/blob/master/docs/specs/runtime/dynamic-view/basics/deploy-protostub.md\r\n              // Add the message bus listener\r\n              this.messageBus.addListener(_runtimeProtoStubURL, (msg) => {\r\n                _stubSandbox.postMessage(msg);\r\n              });\r\n\r\n              return _stubSandbox.deployComponent(stubInstance, _runtimeProtoStubURL, configuration);\r\n            } catch (e) {\r\n              Loader_log.error('[Runtime.Loader.loadStub] Error on deploy component:', e);\r\n              reject(e);\r\n            }\r\n          }, handleError)\r\n          .then(() => {\r\n            if (haveError) return false;\r\n\r\n\r\n            // step 28 https://github.com/reTHINK-project/core-framework/blob/master/docs/specs/runtime/dynamic-view/basics/deploy-protostub.md\r\n            let registeredStub;\r\n            if (p2pConfig) {\r\n              Loader_log.log('[Runtime.Loader.loadStub] p2pConfig: ', p2pConfig);\r\n\r\n              if (p2pConfig.hasOwnProperty('isHandlerStub')) registeredStub = this.registry.p2pHandlerStub[this._runtimeURL];\r\n              if (p2pConfig.hasOwnProperty('p2pRequesterStub')) registeredStub = this.registry.p2pRequesterStub[p2pConfig.remoteRuntimeURL];\r\n            } else {\r\n              registeredStub = this.registry.protostubsList[domain];\r\n            }\r\n\r\n            Loader_log.log('[Runtime.Loader.loadStub] Stub: ', registeredStub);\r\n            resolve(registeredStub);\r\n            Loader_log.info('[Runtime.Loader.loadStub]------------------- END ---------------------------\\n');\r\n          }, handleError)\r\n          .catch(errorReason);\r\n\r\n      }\r\n\r\n    });\r\n\r\n  }\r\n\r\n  _load(type, url) {\r\n    return new Promise((resolve, reject) => {\r\n\r\n      let domain;\r\n      let stub;\r\n\r\n      let originDividedURL = divideURL(this.runtimeURL);\r\n      let originDomain = originDividedURL.domain;\r\n      let loader = new System.constructor();\r\n      let dividedURL = divideURL(url);\r\n      domain = dividedURL.domain;\r\n      let path = dividedURL.identity;\r\n\r\n/*      let constraints = this.constraints;\r\n\r\n      constraints.constraints.onlyAccessToken = true;\r\n      constraints.constraints.onlyIdAssertionValidation = true;\r\n      console.log('LOG HERE', constraints);*/\r\n      if (url.includes('://')) {\r\n        domain = dividedURL.domain;\r\n        if (path) {\r\n          stub = path.substring(path.lastIndexOf('/') + 1);\r\n        } else {\r\n          stub = 'default';\r\n        }\r\n\r\n      } else if (type === 'idp-proxy') {\r\n        domain = originDomain;\r\n        stub = url;\r\n      } \r\n      else {\r\n        stub = 'default';\r\n        domain = url;\r\n      }\r\n\r\n      let resource = getConfigurationResources(this.runtimeConfiguration, 'catalogueURLs', type);\r\n\r\n      let ext = type === 'idp-proxy' ? '.idp.js' : '.ps.js';\r\n\r\n\r\n      let loadingUrl = resource.prefix + domain + resource.suffix + stub + ext;\r\n      Loader_log.log('[Loader._load] first import for ' + url);\r\n\r\n      loader.import(loadingUrl).then((result) => {\r\n\r\n        let instance = new result.default();\r\n        Loader_log.log('[Loader._load] first import result ' + instance.name);\r\n        loader.delete(loadingUrl);\r\n        resolve(instance);\r\n\r\n      }).catch(() => {\r\n\r\n/*        stub = domain;\r\n        domain = originDomain;\r\n\r\n        let loadingUrl2 = buildURL(this.runtimeConfiguration, 'catalogueURLs', type, stub, true);\r\n\r\n        log.log('[Loader._load] 2nd import for ' + loadingUrl2);\r\n\r\n        loader.import(loadingUrl2).then((result2) => {\r\n\r\n//          log.log('[Loader._load] 2nd import result ' + result2);\r\n\r\n        let instance2 = new result2.default();\r\n\r\n        log.log('[Loader._load] 2nd import result ' + instance2.name);\r\n        loader.delete(loadingUrl2);\r\n\r\n        resolve(instance2);\r\n      }).catch((reason) => {*/\r\n        reject(reason);\r\n      });\r\n    });\r\n\r\n//    });\r\n  }\r\n\r\n  /**\r\n  * Deploy idpProxy from Catalogue URL or domain url\r\n  * @param  {URL.URL}     domain          domain\r\n  */\r\n\r\n  loadIdpProxy(idpProxyURL) {\r\n\r\n    if (!this._readyToUse()) return false;\r\n    if (!idpProxyURL) throw new Error('[Runtime.Loader] IdpProxy descriptor url parameter is needed');\r\n\r\n    return new Promise((resolve, reject) => {\r\n\r\n      let domain = divideURL(idpProxyURL).domain;\r\n\r\n      if (!domain) {\r\n        domain = idpProxyURL;\r\n      }\r\n\r\n      let _proxySandbox;\r\n      let _proxyDescriptor;\r\n      let _runtimeIdpProxyURL;\r\n      let _proxySourcePackage;\r\n      let haveError = false;\r\n      let idpProxy;\r\n\r\n      let errorReason = (reason) => {\r\n        Loader_log.info('[Runtime.Loader] Something failed on the deploy of IdpProxy: ', reason);\r\n        reject(reason);\r\n      };\r\n\r\n      let handleError = (reason) => {\r\n        haveError = true;\r\n        reject(reason);\r\n      };\r\n\r\n      // Discover IDPProxy\r\n      Loader_log.info('[Runtime.Loader] ------------------- IDP Proxy Deploy ---------------------------\\n');\r\n      Loader_log.info('[Runtime.Loader] Discover or Create a new IdpProxy for domain/URL: ', domain);\r\n\r\n      try {\r\n        let runtimeIdpProxyURL = this.registry.discoverIdpProxy(domain);\r\n\r\n        // Is registed?\r\n        Loader_log.info('[Runtime.Loader] 1. IDPProxy Discovered: ', runtimeIdpProxyURL);\r\n\r\n        // we have completed step 2 https://github.com/reTHINK-project/core-framework/blob/master/docs/specs/runtime/dynamic-view/basics/deploy-protostub.md\r\n\r\n        let idpProxy = this.registry.idpProxyList[domain];\r\n        Loader_log.log('Deployed: ', idpProxy);\r\n\r\n        resolve(idpProxy);\r\n        Loader_log.info('[Runtime.Loader] ------------------- END ---------------------------\\n');\r\n      } catch (reason) {\r\n\r\n        // is not registed?\r\n        Loader_log.info('[Runtime.Loader] 1. IdpProxy not found:', reason);\r\n\r\n        // we have completed step 3 https://github.com/reTHINK-project/core-framework/blob/master/docs/specs/runtime/dynamic-view/basics/deploy-protostub.md\r\n\r\n        // we need to get ProtoStub descriptor step 4 https://github.com/reTHINK-project/core-framework/blob/master/docs/specs/runtime/dynamic-view/basics/deploy-protostub.md\r\n        // this.descriptors.getIdpProxyDescriptor(idpProxyURL)\r\n\r\n        this._load('idp-proxy',idpProxyURL)\r\n          .then((instance) => {\r\n\r\n            Loader_log.info('[Runtime.Loader] 2. Return the IDPProxy descriptor');\r\n\r\n            // we have completed step 5 https://github.com/reTHINK-project/core-framework/blob/master/docs/specs/runtime/dynamic-view/basics/deploy-protostub.md\r\n            _proxyDescriptor = instance.descriptor;\r\n\r\n            idpProxy = instance;\r\n\r\n/*            let sourcePackageURL = proxyDescriptor.sourcePackageURL;\r\n\r\n            if (sourcePackageURL === '/sourcePackage') {\r\n              return proxyDescriptor.sourcePackage;\r\n            }\r\n\r\n            // we need to get ProtoStub Source code from descriptor - step 6 https://github.com/reTHINK-project/core-framework/blob/master/docs/specs/runtime/dynamic-view/basics/deploy-protostub.md\r\n            return this.runtimeCatalogue.getSourcePackageFromURL(sourcePackageURL);\r\n          }, handleError)\r\n          .then((sourcePackage) => {\r\n            if (haveError) return false;\r\n            log.info('[Runtime.Loader] 3. return the IDPProxy source package');\r\n\r\n            // we have completed step 7 https://github.com/reTHINK-project/core-framework/blob/master/docs/specs/runtime/dynamic-view/basics/deploy-protostub.md\r\n\r\n            _proxySourcePackage = sourcePackage;\r\n\r\n            // TODO: Check on PEP (policy Engine) if we need the sandbox and check if the Sandbox Factory have the context sandbox;\r\n            let policy = true;\r\n            return policy;\r\n          }, handleError)\r\n          .then((policy) => {\r\n            if (haveError) return false;*/\r\n\r\n            // this will return the sandbox or one promise to getSandbox;\r\n            return this.registry.getSandbox(domain);\r\n          })\r\n          .then((proxySandbox) => {\r\n            if (haveError) return false;\r\n            Loader_log.info('[Runtime.Loader] 4. if the sandbox is registered then return the sandbox', proxySandbox);\r\n\r\n            _proxySandbox = proxySandbox;\r\n            return proxySandbox;\r\n          })\r\n          .catch((reason) => {\r\n            if (haveError) return false;\r\n            Loader_log.info('[Runtime.Loader] 5. Sandbox was not found, creating a new one', reason);\r\n\r\n            let proxyCapabilities = {};\r\n            if (_proxyDescriptor && _proxyDescriptor.hasOwnProperty('capabilities')) {\r\n              _proxyDescriptor = _proxyDescriptor.stubCapabilities;\r\n            }\r\n\r\n            return this._runtimeFactory.createSandbox(proxyCapabilities).then((sandbox) => {\r\n\r\n              sandbox.addListener('*', (msg) => {\r\n                this.messageBus.postMessage(msg);\r\n              });\r\n\r\n              return sandbox;\r\n            });\r\n          })\r\n          .then((sandbox) => {\r\n            if (haveError) return false;\r\n            Loader_log.info('[Runtime.Loader] 6. return the sandbox instance and register', sandbox, 'to domain ', domain);\r\n\r\n            _proxySandbox = sandbox;\r\n\r\n            // we need register stub on registry - step xxx https://github.com/reTHINK-project/core-framework/blob/master/docs/specs/runtime/dynamic-view/basics/deploy-protostub.md\r\n            return this.registry.registerIdpProxy(sandbox, domain);\r\n          }, handleError)\r\n          .then((runtimeIdpProxyURL) => {\r\n            if (haveError) return false;\r\n            Loader_log.info('[Runtime.Loader] 7. Return the runtime Idp Proxy URL: ', runtimeIdpProxyURL);\r\n\r\n            // we have completed step xxx https://github.com/reTHINK-project/core-framework/blob/master/docs/specs/runtime/dynamic-view/basics/deploy-protostub.md\r\n\r\n            _runtimeIdpProxyURL = runtimeIdpProxyURL;\r\n\r\n            // Extend original hyperty configuration;\r\n            let configuration = {};\r\n            if (!emptyObject(_proxyDescriptor.configuration)) {\r\n              try {\r\n                configuration = Object.assign({}, JSON.parse(_proxyDescriptor.configuration));\r\n              } catch (e) {\r\n                configuration = _proxyDescriptor.configuration;\r\n              }\r\n            }\r\n            configuration.runtimeURL = this._runtimeURL;\r\n\r\n            // Deploy Component step xxx\r\n            try {\r\n              // we have completed step xxx https://github.com/reTHINK-project/core-framework/blob/master/docs/specs/runtime/dynamic-view/basics/deploy-protostub.md\r\n\r\n              // Add the message bus listener\r\n              this.messageBus.addListener(_runtimeIdpProxyURL, (msg) => {\r\n                _proxySandbox.postMessage(msg);\r\n              });\r\n\r\n              return _proxySandbox.deployComponent(idpProxy, runtimeIdpProxyURL, configuration);\r\n            } catch (e) {\r\n              Loader_log.info('[Runtime.Loader] Error on deploy component:', e);\r\n              reject(e);\r\n            }\r\n          }, handleError)\r\n          .then(() => {\r\n            if (haveError) return false;\r\n\r\n\r\n            // we have completed step xxx https://github.com/reTHINK-project/core-framework/blob/master/docs/specs/runtime/dynamic-view/basics/deploy-protostub.md\r\n\r\n            // Load Stub function resolved with success;\r\n            // let idpProxy = {\r\n            //   runtimeIdpProxyURL: _runtimeIdpProxyURL,\r\n            //   status: deployComponentStatus\r\n            // };\r\n\r\n            //this.registry.idpProxyList[domain].status = 'deployed';\r\n            let registeredIdpProxy = this.registry.idpProxyList[domain];\r\n\r\n            Loader_log.log('[Runtime.Loader.loadIdpProxy] 8: loaded: ', registeredIdpProxy);\r\n\r\n            resolve(registeredIdpProxy);\r\n            Loader_log.info('[Runtime.Loader.loadIdpProxy] ------------------- END ---------------------------\\n');\r\n\r\n          }, handleError)\r\n          .catch(errorReason);\r\n      }\r\n\r\n    });\r\n  }\r\n\r\n  // Check if the loader is ready to load all components\r\n  _readyToUse() {\r\n\r\n    let status = false;\r\n\r\n    if (!this._runtimeURL) throw new Error('[Runtime.Loader] The loader need the runtime url address');\r\n    if (!this._messagesBus) throw new Error('[Runtime.Loader] The loader need the messageBus component');\r\n    if (!this._registry) throw new Error('[Runtime.Loader] The loader need the registry component');\r\n    if (!this._runtimeFactory) throw new Error('[Runtime.Loader] The loader need the runtime factory component');\r\n\r\n    status = true;\r\n    return status;\r\n  }\r\n\r\n}\r\n\r\n/* harmony default export */ var runtime_Loader = (Loader_Loader);\r\n\n// CONCATENATED MODULE: ./src/runtime/Storage.js\n\r\n\r\nlet storages = {};\r\n\r\nfunction Storage_storage(runtimeFactory, runtimeStatusUpdate) {\r\n  if (!runtimeFactory) throw new Error('The runtime factory is a needed parameter');\r\n\r\n  console.log('[Storage.storage] storageSchemas ', runtimeConfiguration_runtimeConfiguration.storageSchemas);\r\n\r\n  Object.keys(runtimeConfiguration_runtimeConfiguration.storageSchemas).forEach((key) => {\r\n\r\n    if (!storages.hasOwnProperty(key)) {\r\n      storages[key] = runtimeFactory.storageManager(key, runtimeConfiguration_runtimeConfiguration.storageSchemas[key], runtimeStatusUpdate);\r\n    }\r\n\r\n  });\r\n\r\n  return storages;\r\n}\r\n\r\nfunction createSyncDB(name, runtimeFactory, url = false) {\r\n  if (!name) throw new Error('[Runtime.Storage.createSyncDB] name is a needed parameter');\r\n  if (!runtimeFactory) throw new Error('[Runtime.Storage.createSyncDB] The runtime factory is a needed parameter');\r\n\r\n  let remote = url ? url : runtimeConfiguration_runtimeConfiguration.remoteStorage;\r\n\r\n  return runtimeFactory.syncStorageManager( name, remote );\r\n\r\n}\r\n\n// CONCATENATED MODULE: ./src/runtime/Descriptors.js\n\r\n\r\n\r\n\r\nlet Descriptors_log = loglevel[\"getLogger\"]('Descriptors');\r\n\r\nclass Descriptors_Descriptors {\r\n\r\n  constructor(runtimeURL, catalogue, runtimeConfiguration) {\r\n    if (!runtimeURL) throw Error('The descriptor need to know the runtime url to be used');\r\n    if (!catalogue) throw Error('The descriptor needs the catalogue instance');\r\n    if (!runtimeConfiguration) throw Error('The descriptor needs the runtime configuration');\r\n\r\n    this.log = Descriptors_log;\r\n\r\n    this.runtimeConfiguration = runtimeConfiguration;\r\n    this.runtimeURL = runtimeURL;\r\n    this.catalogue = catalogue;\r\n\r\n    this.constraints = runtimeUtils.runtimeCapabilities;\r\n  }\r\n\r\n  getHypertyDescriptor(hypertyURL) {\r\n    return this.catalogue.getHypertyDescriptor(hypertyURL, true, this.constraints);\r\n  }\r\n\r\n  getStubDescriptor(stubURL) {\r\n\r\n    return new Promise((resolve, reject) => {\r\n\r\n      let domain;\r\n      let protostub;\r\n      let protoStubURL;\r\n\r\n      let originDividedURL = divideURL(this.runtimeURL);\r\n      let originDomain = originDividedURL.domain;\r\n\r\n      if (stubURL.includes('://')) {\r\n        let dividedURL = divideURL(stubURL);\r\n        domain = dividedURL.domain;\r\n        let path = dividedURL.identity;\r\n\r\n        if (path) {\r\n          protostub = path.substring(path.lastIndexOf('/') + 1);\r\n        } else {\r\n          protostub = 'default';\r\n        }\r\n\r\n      } else {\r\n        protostub = 'default';\r\n        domain = stubURL;\r\n      }\r\n\r\n      protoStubURL = buildURL(this.runtimeConfiguration, 'catalogueURLs', 'protocolstub', protostub);\r\n      if (domain !== this.runtimeConfiguration.domain) {\r\n        if (!stubURL.indexOf('https') || !stubURL.indexOf('hyperty-catalogue')) {\r\n          protoStubURL = stubURL;\r\n        } else {\r\n\r\n          // TODO: check how to load form different configuration domain\r\n          let resource = getConfigurationResources(this.runtimeConfiguration, 'catalogueURLs', 'protocolstub');\r\n          protoStubURL = resource.prefix + domain + resource.suffix + protostub;\r\n        }\r\n      }\r\n\r\n      Descriptors_log.log('Load ProtocolStub for domain, ' + domain + ' : ', protoStubURL);\r\n      return this.catalogue.getStubDescriptor(protoStubURL, true, this.constraints).then((result) => {\r\n\r\n        resolve(result);\r\n\r\n      }).catch((error) => {\r\n\r\n        // log.log('Error: ', error);\r\n\r\n        protostub = domain;\r\n        domain = originDomain;\r\n\r\n        let resource = getConfigurationResources(this.runtimeConfiguration, 'catalogueURLs', 'protocolstub');\r\n        protoStubURL = resource.prefix + domain + resource.suffix + protostub;\r\n\r\n        // log.log('Fallback -> Load Protocolstub for domain, ' + domain + ' : ', protostub);\r\n        return this.catalogue.getStubDescriptor(protoStubURL, true, this.constraints);\r\n      }).then((result) => {\r\n        resolve(result);\r\n      }).catch((reason) => {\r\n        reject(reason);\r\n      });\r\n\r\n    });\r\n  }\r\n\r\n  getIdpProxyDescriptor(idpProxyURL) {\r\n    return new Promise((resolve, reject) => {\r\n\r\n      let domain;\r\n      let idpproxy;\r\n\r\n      let originDividedURL = divideURL(this.runtimeURL);\r\n      let originDomain = originDividedURL.domain;\r\n      let constraints = this.constraints;\r\n\r\n      constraints.constraints.onlyAccessToken = true;\r\n      constraints.constraints.onlyIdAssertionValidation = true;\r\n      console.log('LOG HERE', constraints);\r\n      if (idpProxyURL.includes('://')) {\r\n        let dividedURL = divideURL(idpProxyURL);\r\n        domain = dividedURL.domain;\r\n        let path = dividedURL.identity;\r\n        if (path) {\r\n          idpproxy = path.substring(path.lastIndexOf('/') + 1);\r\n        } else {\r\n          idpproxy = 'default';\r\n        }\r\n\r\n      } else {\r\n        idpproxy = 'default';\r\n        domain = idpProxyURL;\r\n      }\r\n\r\n\r\n      let resource = getConfigurationResources(this.runtimeConfiguration, 'catalogueURLs', 'idpProxy');\r\n\r\n      idpProxyURL = resource.prefix + domain + resource.suffix + idpproxy;\r\n      // log.log('Load Idp Proxy for domain, ' + domain + ' : ', idpProxyURL);\r\n      return this.catalogue.getIdpProxyDescriptor(idpProxyURL, true, constraints).then((result) => {\r\n\r\n        resolve(result);\r\n\r\n      }).catch(() => {\r\n\r\n        idpproxy = domain;\r\n        domain = originDomain;\r\n\r\n        idpProxyURL = buildURL(this.runtimeConfiguration, 'catalogueURLs', 'idpProxy', idpproxy);\r\n\r\n        // log.log('Load Idp Proxy for domain, ' + domain + ' : ', idpProxyURL);\r\n        return this.catalogue.getIdpProxyDescriptor(idpProxyURL, true, constraints);\r\n      }).then((result) => {\r\n        resolve(result);\r\n      }).catch((reason) => {\r\n        reject(reason);\r\n      });\r\n\r\n    });\r\n  }\r\n}\r\n\r\n/* harmony default export */ var runtime_Descriptors = (Descriptors_Descriptors);\r\n\n// CONCATENATED MODULE: ./src/discovery/CoreDiscovery.js\n/**\r\n* Copyright 2016 PT Inovação e Sistemas SA\r\n* Copyright 2016 INESC-ID\r\n* Copyright 2016 QUOBIS NETWORKS SL\r\n* Copyright 2016 FRAUNHOFER-GESELLSCHAFT ZUR FOERDERUNG DER ANGEWANDTEN FORSCHUNG E.V\r\n* Copyright 2016 ORANGE SA\r\n* Copyright 2016 Deutsche Telekom AG\r\n* Copyright 2016 Apizee\r\n* Copyright 2016 TECHNISCHE UNIVERSITAT BERLIN\r\n*\r\n* Licensed under the Apache License, Version 2.0 (the \"License\");\r\n* you may not use this file except in compliance with the License.\r\n* You may obtain a copy of the License at\r\n*\r\n*   http://www.apache.org/licenses/LICENSE-2.0\r\n*\r\n* Unless required by applicable law or agreed to in writing, software\r\n* distributed under the License is distributed on an \"AS IS\" BASIS,\r\n* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n* See the License for the specific language governing permissions and\r\n* limitations under the License.\r\n**/\r\n\r\n// Log System\r\n\r\nlet CoreDiscovery_log = loglevel[\"getLogger\"]('CoreDiscovery');\r\n\r\n\r\n\r\n\r\n/**\r\n* Core Discovery interface\r\n* Class to allow applications to search for hyperties and DataObjects using the message bus\r\n*/\r\nclass CoreDiscovery_CoreDiscovery {\r\n\r\n  /**\r\n  * To initialise the Discovery, which will provide the support for hyperties to\r\n  * query users registered in outside the internal core.\r\n  * @param  {MessageBus}          msgbus                msgbus\r\n  * @param  {RuntimeURL}          runtimeURL            runtimeURL\r\n  * @param  {graphConnector}    graphConnector\r\n  */\r\n  constructor(runtimeURL, msgBus, graphConnector, runtimeFactory, registry) {\r\n    if (!runtimeFactory) throw Error('The catalogue needs the runtimeFactory');\r\n\r\n    let _this = this;\r\n    this._messageBus = msgBus;\r\n    _this.graphConnector = graphConnector;\r\n    _this.httpRequest = runtimeFactory.createHttpRequest();\r\n    _this.domain = divideURL(runtimeURL).domain;\r\n    _this.discoveryURL = runtimeURL + '/discovery/';\r\n    _this.registry = registry;\r\n\r\n    _this.messageBus.addListener(_this.discoveryURL, (msg) => {\r\n\r\n      _this.discoveryManager(msg).then(result =>{\r\n\r\n        //FLOW-OUT: message response\r\n        _this.messageBus.postMessage({\r\n          id: msg.id,\r\n          type: 'response',\r\n          from: msg.to,\r\n          to: msg.from,\r\n          body: {\r\n            code: 200,\r\n            value: result\r\n          }\r\n        });\r\n      })\r\n        .catch(function(err) {\r\n          let description;\r\n          let code;\r\n\r\n          if (err === 'GraphConnector') {\r\n            description = 'This search is not available at the moment. Try later.';\r\n            code = 500;\r\n          } else {\r\n            description = 'Not Found';\r\n            code = 404;\r\n          }\r\n\r\n          //FLOW-OUT: error message response\r\n          _this.messageBus.postMessage({\r\n            id: msg.id,\r\n            type: 'response',\r\n            from: msg.to,\r\n            to: msg.from,\r\n            body: {\r\n              code: code,\r\n              description: description\r\n            }\r\n          });\r\n        });\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Returns the MessageBus.\r\n   */\r\n  get messageBus() {\r\n    return this._messageBus;\r\n  }\r\n\r\n  /**\r\n   * Sets the MessageBus.\r\n   * @param {MessageBus}           messageBus    The Message Bus.\r\n   */\r\n  set messageBus(messageBus) {\r\n    this._messageBus = messageBus;\r\n  }\r\n\r\n  /* function to decide what discovery method to call and later return the response msg  */\r\n  discoveryManager(msg) {\r\n    let _this = this;\r\n    let domain = divideURL(msg.from).domain;\r\n    let atributes = msg.body.resource.split('/').filter(Boolean);\r\n    let resources = [];\r\n    let dataSchemes = [];\r\n\r\n    CoreDiscovery_log.log('[CoreDiscovery.discoveryManager] received: ', msg);\r\n\r\n    if (msg.body.criteria) {\r\n      if (msg.body.criteria.resources) { resources = msg.body.criteria.resources; }\r\n      if (msg.body.criteria.dataSchemes) { dataSchemes = msg.body.criteria.dataSchemes; }\r\n    }\r\n\r\n    switch (atributes[1]) {\r\n      case 'user':\r\n        if (atributes[0] == 'hyperty') { return _this.discoverHyperties(msg.body.resource.split('user/')[1], dataSchemes, resources, msg.body.criteria.domain); } else { return _this.discoverDataObjects(msg.body.resource.split('user/')[1], dataSchemes, resources, msg.body.criteria.domain); }\r\n        break;\r\n\r\n      case 'url':\r\n        if (atributes[0] == 'hyperty') { return _this.discoverHypertyPerURL(msg.body.resource.split('url/')[1], msg.body.criteria.domain); } else { return _this.discoverDataObjectPerURL(msg.body.resource.split('url/')[1], msg.body.criteria.domain); }\r\n        break;\r\n      case 'name':\r\n        return _this.discoverDataObjectsPerName(msg.body.resource.split('name/')[1], dataSchemes, resources, msg.body.criteria.domain);\r\n        break;\r\n      case 'reporter':\r\n        return _this.discoverDataObjectsPerReporter(msg.body.resource.split('reporter/')[1], dataSchemes, resources, msg.body.criteria.domain);\r\n        break;\r\n      case 'guid':\r\n        if (typeof _this.graphConnector !== 'undefined' &&  _this.graphConnector !== null) {\r\n          if (atributes[0] == 'hyperty') { return _this.discoverHypertiesPerGUID(msg.body.resource.split('user-guid://')[1], dataSchemes, resources); } else { return _this.discoverDataObjectsPerGUID(msg.body.resource.split('user-guid://')[1], dataSchemes, resources); }\r\n          break;\r\n        } else {\r\n          return Promise.reject('GraphConnector');\r\n          break;\r\n        }\r\n      case 'userprofile':\r\n        if (typeof _this.graphConnector !== 'undefined' &&  _this.graphConnector !== null) {\r\n          if (atributes[0] == 'hyperty') { return _this.discoverHypertiesPerUserProfileData(msg.body.resource.split('userprofile/')[1], dataSchemes, resources); } else { return _this.discoverDataObjectsPerUserProfileData(msg.body.resource.split('userprofile/')[1], dataSchemes, resources); }\r\n          break;\r\n        } else {\r\n          return Promise.reject('GraphConnector');\r\n          break;\r\n        }\r\n    }\r\n  }\r\n\r\n  /**\r\n  * Advanced Search for Hyperties registered in domain registry associated with some user identifier (eg email, name ...)\r\n  * @param  {String}           userIdentifier\r\n  * @param  {Array<string>}    dataSchemes (Optional)     types of hyperties schemas\r\n  * @param  {Array<string>}    resources (Optional)  types of hyperties resources\r\n  */\r\n  discoverHypertiesPerUserProfileData(userIdentifier, dataSchemes, resources) {\r\n    let _this = this;\r\n\r\n    return new Promise(function(resolve, reject) {\r\n\r\n      //translate user identifier (e.g. email, name...) into the associated GUIDs\r\n      _this.discoverGUIDPerUserIdentifier(userIdentifier)\r\n        .then(function(guids) {\r\n\r\n          let hypertiesPromises = guids.map(function(guid) {\r\n\r\n            return new Promise(function(resolve, reject) {\r\n              _this.discoverHypertiesPerGUID(guid, dataSchemes, resources)\r\n                .then(function(hyperties) {\r\n                  resolve(hyperties);\r\n                })\r\n                .catch(function(err) {\r\n                  resolve([]);\r\n                });\r\n            });\r\n          });\r\n\r\n          Promise.all(hypertiesPromises)\r\n            .then(function(hypertiesResult) {\r\n\r\n              let hyperties = [].concat.apply([], hypertiesResult);\r\n\r\n              if (hyperties.length === 0) {\r\n                return reject('No hyperties were found');\r\n              }\r\n\r\n              resolve(hyperties);\r\n            });\r\n        })\r\n        .catch(function(err) {\r\n          return reject(err);\r\n        });\r\n    });\r\n  }\r\n\r\n  /**\r\n  * Advanced Search for DataObjects registered in domain registry associated with some user identifier (eg email, name ...)\r\n  * @param  {String}           userIdentifier\r\n  * @param  {Array<string>}    dataSchemes (Optional)     types of hyperties schemas\r\n  * @param  {Array<string>}    resources (Optional)  types of hyperties resources\r\n  */\r\n  discoverDataObjectsPerUserProfileData(userIdentifier, dataSchemes, resources) {\r\n    let _this = this;\r\n\r\n    return new Promise(function(resolve, reject) {\r\n\r\n      //translate user identifier (e.g. email, name...) into the associated GUIDs\r\n      _this.discoverGUIDPerUserIdentifier(userIdentifier)\r\n        .then(function(guids) {\r\n\r\n          let dataObjectsPromises = guids.map(function(guid) {\r\n\r\n            return new Promise(function(resolve, reject) {\r\n              _this.discoverDataObjectsPerGUID(guid, dataSchemes, resources)\r\n                .then(function(dataObjects) {\r\n                  resolve(dataObjects);\r\n                })\r\n                .catch(function(err) {\r\n                  resolve([]);\r\n                });\r\n            });\r\n          });\r\n\r\n          Promise.all(dataObjectsPromises)\r\n            .then(function(dataObjectsResult) {\r\n\r\n              let dataObjects = [].concat.apply([], dataObjectsResult);\r\n\r\n              if (dataObjects.length === 0) {\r\n                return reject('No dataObjects were found');\r\n              }\r\n\r\n              resolve(dataObjects);\r\n            });\r\n        })\r\n        .catch(function(err) {\r\n          return reject(err);\r\n        });\r\n    });\r\n  }\r\n\r\n  /**\r\n  * Advanced Search for Hyperties registered in domain registry associated with some GUID\r\n  * @param  {String}             guid\r\n  * @param  {Array<string>}    dataSchemes (Optional)     types of hyperties schemas\r\n  * @param  {Array<string>}    resources (Optional)  types of hyperties resources\r\n  */\r\n  discoverHypertiesPerGUID(guid, dataSchemes, resources) {\r\n    let _this = this;\r\n\r\n    return new Promise(function(resolve, reject) {\r\n\r\n      //translate GUID into the user IDs to query the domain registry\r\n      _this.discoverUserIdsPerGUID(guid)\r\n        .then(function(uids) {\r\n\r\n        //translate user IDs into the associated hyperties registered in some domain\r\n          let hypertiesPromises = uids.map(function(uid) {\r\n            return new Promise(function(resolve, reject) {\r\n              _this.discoverHyperties(uid.uID, dataSchemes, resources, uid.domain)\r\n                .then(function(hyperties) {\r\n                  resolve(hyperties);\r\n                })\r\n                .catch(function(err) {\r\n                  resolve([]);\r\n                });\r\n            });\r\n          });\r\n\r\n          Promise.all(hypertiesPromises)\r\n            .then(function(hypertiesResult) {\r\n\r\n              let hyperties = [].concat.apply([], hypertiesResult);\r\n\r\n              if (hyperties.length === 0) {\r\n                return reject('No hyperties were found');\r\n              }\r\n\r\n              // log.log('Hyperties : ', hyperties);\r\n              resolve(hyperties);\r\n            });\r\n\r\n        })\r\n        .catch(function(err) {\r\n          return reject(err);\r\n        });\r\n    });\r\n  }\r\n\r\n  /**\r\n  * Advanced Search for DataObjects registered in domain registry associated with some GUID\r\n  * @param  {String}             guid\r\n  * @param  {Array<string>}    dataSchemes (Optional)     types of hyperties schemas\r\n  * @param  {Array<string>}    resources (Optional)  types of hyperties resources\r\n  */\r\n  discoverDataObjectsPerGUID(guid, dataSchemes, resources) {\r\n    let _this = this;\r\n\r\n    return new Promise(function(resolve, reject) {\r\n\r\n      //translate GUID into the user IDs to query the domain registry\r\n      _this.discoverUserIdsPerGUID(guid)\r\n        .then(function(uids) {\r\n\r\n        //translate user IDs into the associated dataObjects registered in some domain\r\n          let dataObjectPromises = uids.map(function(uid) {\r\n            return new Promise(function(resolve, reject) {\r\n              _this.discoverDataObjects(uid.uID, dataSchemes, resources, uid.domain)\r\n                .then(function(dataObjects) {\r\n                  resolve(dataObjects);\r\n                })\r\n                .catch(function(err) {\r\n                  resolve([]);\r\n                });\r\n            });\r\n          });\r\n\r\n          Promise.all(dataObjectPromises)\r\n            .then(function(dataObjectsResult) {\r\n\r\n              let dataObjects = [].concat.apply([], dataObjectsResult);\r\n\r\n              if (dataObjects.length === 0) {\r\n                return reject('No dataObjects were found');\r\n              }\r\n\r\n              // log.log('DataObjects : ', dataObjects);\r\n              resolve(dataObjects);\r\n            });\r\n\r\n        })\r\n        .catch(function(err) {\r\n          return reject(err);\r\n        });\r\n    });\r\n  }\r\n\r\n  /** Advanced Search for Hyperties registered in domain registry and associated with some user ID\r\n  * @param  {String}           user                  user identifier, either in url or email format\r\n  * @param  {Array<string>}    dataSchemes (Optional)     types of hyperties schemas\r\n  * @param  {Array<string>}    resources (Optional)  types of hyperties resources\r\n  * @param  {String}           domain (Optional)     domain of the registry to search\r\n  */\r\n  discoverHyperties(user, dataSchemes, resources, domain) {\r\n    let _this = this;\r\n    let activeDomain;\r\n\r\n    activeDomain = (!domain) ? _this.domain : domain;\r\n\r\n    let msg = {\r\n      type: 'read',\r\n      from: _this.discoveryURL,\r\n      to: 'domain://registry.' + activeDomain,\r\n      body: {\r\n\r\n      }\r\n    };\r\n\r\n    if (user.indexOf('user://') > -1) { msg.body.resource = user; } else { msg.body.resource = '/hyperty/idp-identifier/' + user; }\r\n\r\n    if (dataSchemes.length > 0) {\r\n      if (!msg.body.criteria) { msg.body.criteria = {}; }\r\n      msg.body.criteria.dataSchemes = dataSchemes;\r\n    }\r\n\r\n    if (resources.length > 0) {\r\n      if (!msg.body.criteria) { msg.body.criteria = {}; }\r\n      msg.body.criteria.resources = resources;\r\n    }\r\n\r\n    return new Promise(function(resolve, reject) {\r\n      // log.log(\"[CoreDiscovery.discoverHyperties] sending msg \", msg);\r\n\r\n      _this.messageBus.postMessage(msg, (reply) => {\r\n\r\n        // log.log(\"[CoreDiscovery.discoverHyperties] rcved reply \", reply);\r\n\r\n        if (reply.body.code === 200 || reply.body.code === 500) {\r\n          let hyperties = reply.body.value;\r\n\r\n          let finalHyperties = [];\r\n          for (var key in hyperties) finalHyperties.push(hyperties[key]);\r\n\r\n          if (finalHyperties.length > 0) {\r\n            // log.log(\"[CoreDiscovery.discoverHyperties] Hyperties Found: \", finalHyperties);\r\n            resolve(finalHyperties);\r\n          } else { return reject('No Hyperty was found'); }\r\n        } else { return reject('No Hyperty was found'); }\r\n\r\n        /*_this.registry.isLegacy(user).then((legacy) => {\r\n              if (legacy) resolve([{hypertyID: user }])\r\n              else return reject('No Hyperty was found');\r\n          });*/\r\n      });\r\n    });\r\n  }\r\n\r\n  /** Advanced Search for DataObjects registered in domain registry and associated with some user ID\r\n  * @param  {String}           user                  user identifier, either in url or email format\r\n  * @param  {Array<string>}    dataSchemes (Optional)     types of dataObjects schemas\r\n  * @param  {Array<string>}    resources (Optional)  types of dataObjects resources\r\n  * @param  {String}           domain (Optional)     domain of the registry to search\r\n  */\r\n  discoverDataObjects(user, dataSchemes, resources, domain) {\r\n    let _this = this;\r\n    let activeDomain;\r\n    let dataObjectsArray = [];\r\n\r\n    activeDomain = (!domain) ? _this.domain : domain;\r\n\r\n    return new Promise(function(resolve, reject) {\r\n\r\n      //translate user identifier (e.g. email, name...) into the associated hyperties\r\n      _this.discoverHyperties(user, [], [], activeDomain)\r\n        .then(function(hyperties) {\r\n\r\n          let finalHyperties = [];\r\n          for (var key in hyperties) finalHyperties.push(hyperties[key]);\r\n\r\n          //translate hyperties URLs into the associated dataObjects registered in some domain\r\n          let dataObjectsPromises = finalHyperties.map(function(hyperty) {\r\n            return new Promise(function(resolve, reject) {\r\n              _this.discoverDataObjectsPerReporter(hyperty.hypertyID, dataSchemes, resources, activeDomain)\r\n                .then(function(dataObject) {\r\n                  resolve(dataObject);\r\n                })\r\n                .catch(function(err) {\r\n                  resolve([]);\r\n                });\r\n            });\r\n          });\r\n\r\n          Promise.all(dataObjectsPromises)\r\n            .then(function(dataObjectsResult) {\r\n\r\n              let dataObjects = [].concat.apply([], dataObjectsResult);\r\n\r\n              dataObjects.forEach(function(dataObject) {\r\n                dataObjectsArray.push(dataObject);\r\n              });\r\n\r\n              let finalDataObjects = [];\r\n              for (var key in dataObjectsArray) finalDataObjects.push(dataObjectsArray[key]);\r\n\r\n              if (finalDataObjects.length === 0) {\r\n                return reject('No dataObjects were found');\r\n              }\r\n\r\n              // log.log('DataObjects Found: ', finalDataObjects);\r\n              resolve(finalDataObjects);\r\n            });\r\n\r\n        })\r\n        .catch(function(err) {\r\n          return reject(err);\r\n        });\r\n    });\r\n  }\r\n\r\n  /**\r\n  * function to request about hyperties registered in domain registry, and\r\n  * return the hyperty information, if found.\r\n  * @param  {String}              url  dataObject URL\r\n  * @param  {String}            domain (Optional)\r\n  * @return {Promise}          Promise\r\n  */\r\n  discoverHypertyPerURL(url, domain) {\r\n    let _this = this;\r\n    let activeDomain;\r\n\r\n    activeDomain = (!domain) ? _this.domain : domain;\r\n\r\n    let msg = {\r\n      type: 'read',\r\n      from: _this.discoveryURL,\r\n      to: 'domain://registry.' + activeDomain,\r\n      body: {\r\n        resource: url\r\n      }\r\n    };\r\n\r\n    return new Promise(function(resolve, reject) {\r\n\r\n      _this.messageBus.postMessage(msg, (reply) => {\r\n\r\n        if (reply.body.code !== 200 && reply.body.code !== 500) { return reject('No Hyperty was found'); }\r\n\r\n        let hyperty = reply.body.value;\r\n\r\n        if (hyperty) {\r\n          // log.log('Hyperty found: ', hyperty);\r\n          resolve(hyperty);\r\n        } else {\r\n          return reject('No Hyperty was found');\r\n        }\r\n      });\r\n    });\r\n  }\r\n\r\n  /**\r\n  * function to request about dataObject registered in domain registry, and\r\n  * return the dataObject information, if found.\r\n  * @param  {String}              url  dataObject URL\r\n  * @param  {String}            domain (Optional)\r\n  * @return {Promise}          Promise\r\n  */\r\n  discoverDataObjectPerURL(url, domain) {\r\n    let _this = this;\r\n    let activeDomain;\r\n\r\n    activeDomain = (!domain) ? _this.domain : domain;\r\n\r\n    let msg = {\r\n      type: 'read',\r\n      from: _this.discoveryURL,\r\n      to: 'domain://registry.' + activeDomain,\r\n      body: {\r\n        resource: url\r\n      }\r\n    };\r\n\r\n    return new Promise(function(resolve, reject) {\r\n\r\n      _this.messageBus.postMessage(msg, (reply) => {\r\n\r\n        let dataObject = reply.body.value;\r\n\r\n        if (dataObject) {\r\n          // log.log('DataObject found: ', dataObject);\r\n          resolve(dataObject);\r\n        } else {\r\n          return reject('DataObject not found');\r\n        }\r\n      });\r\n    });\r\n  }\r\n\r\n  /** Advanced Search for dataObjects registered in domain registry\r\n  * @param  {String}           name                  name of the dataObject\r\n  * @param  {Array<string>}    dataSchemes (Optional)     types of dataObject schemas\r\n  * @param  {Array<string>}    resources (Optional)  types of dataObject resources\r\n  * @param  {String}           domain (Optional)     domain of the registry to search\r\n  */\r\n  discoverDataObjectsPerName(name, dataSchemes, resources, domain) {\r\n    let _this = this;\r\n    let activeDomain;\r\n\r\n    activeDomain = (!domain) ? _this.domain : domain;\r\n\r\n    let msg = {\r\n      type: 'read',\r\n      from: _this.discoveryURL,\r\n      to: 'domain://registry.' + activeDomain,\r\n      body: {\r\n        resource: name\r\n      }\r\n    };\r\n\r\n    if (dataSchemes.length > 0) {\r\n      if (!msg.body.criteria) { msg.body.criteria = {}; }\r\n      msg.body.criteria.dataSchemes = dataSchemes;\r\n    }\r\n\r\n    if (resources.length > 0) {\r\n      if (!msg.body.criteria) { msg.body.criteria = {}; }\r\n      msg.body.criteria.resources = resources;\r\n    }\r\n\r\n    return new Promise(function(resolve, reject) {\r\n\r\n      _this.messageBus.postMessage(msg, (reply) => {\r\n\r\n        let dataObjects = reply.body.value;\r\n\r\n        let finalDataObjects = [];\r\n        for (var key in dataObjects) finalDataObjects.push(dataObjects[key]);\r\n\r\n        if (finalDataObjects.length > 0) {\r\n          // log.log(\"DataObjects Found: \", finalDataObjects);\r\n          resolve(finalDataObjects);\r\n        } else {\r\n          return reject('No DataObject was found');\r\n        }\r\n      });\r\n    });\r\n  }\r\n\r\n  /**\r\n  * function to request about specific reporter dataObject registered in domain registry, and\r\n  * return the dataObjects from that reporter.\r\n  * @param  {String}           reporter                         dataObject reporter\r\n  * @param  {Array<string>}    scdataSchemeshema                (Optional)     types of dataObjects schemas\r\n  * @param  {Array<string>}    resources                        (Optional)  types of dataObjects resources\r\n  * @param  {String}           domain                           (Optional)\r\n  */\r\n  discoverDataObjectsPerReporter(reporter, dataSchemes, resources, domain) {\r\n    let _this = this;\r\n    let activeDomain;\r\n\r\n    activeDomain = (!domain) ? _this.domain : domain;\r\n\r\n    let msg = {\r\n      type: 'read',\r\n      from: _this.discoveryURL,\r\n      to: 'domain://registry.' + activeDomain,\r\n      body: {\r\n        resource: '/comm',\r\n        criteria: {\r\n          reporter: reporter\r\n        }\r\n      }\r\n    };\r\n\r\n    if (dataSchemes.length > 0) { msg.body.criteria.dataSchemes = dataSchemes; }\r\n\r\n    if (resources.length > 0) { msg.body.criteria.resources = resources; }\r\n\r\n    return new Promise(function(resolve, reject) {\r\n\r\n      _this.messageBus.postMessage(msg, (reply) => {\r\n\r\n        let dataObjects = reply.body.value;\r\n\r\n        let finalDataObjects = [];\r\n        for (var key in dataObjects) finalDataObjects.push(dataObjects[key]);\r\n\r\n        if (finalDataObjects.length > 0) {\r\n          // log.log(\"DataObjects Found: \", finalDataObjects);\r\n          resolve(finalDataObjects);\r\n        } else {\r\n          return reject('No DataObject was found');\r\n        }\r\n      });\r\n    });\r\n  }\r\n\r\n  /**\r\n  * function to request global registry about the user IDs associated with some GUID\r\n  * @param  {String}              guid\r\n  * @return {Promise}          Promise\r\n  */\r\n  discoverUserIdsPerGUID(guid) {\r\n    let _this = this;\r\n\r\n    return new Promise(function(resolve, reject) {\r\n\r\n      // log.log(\"GO graphConnector:\", guid);\r\n\r\n      _this.graphConnector.queryGlobalRegistry(guid)\r\n        .then(function(graphConnectorContactData) {\r\n\r\n        // log.log('Information returned from Global Registry: ', graphConnectorContactData);\r\n\r\n          if (typeof graphConnectorContactData === 'string' || !graphConnectorContactData) {\r\n            return reject('Unsuccessful discover userIDs by GUID');\r\n          } else {\r\n\r\n            let userids = graphConnectorContactData.userIDs;\r\n\r\n            if (userids.length === 0) { return reject('UserIDs not available'); }\r\n\r\n            resolve(userids);\r\n          }\r\n\r\n        })\r\n        .catch(function(err) {\r\n          return reject(err);\r\n        });\r\n\r\n    });\r\n  }\r\n\r\n  /**\r\n  * function to request discovery service about the GUID associated with some user identifier (eg email, name ...)\r\n  * @param  {String}            userIdentifier\r\n  * @return {Promise}           Promise\r\n  */\r\n  discoverGUIDPerUserIdentifier(userIdentifier) {\r\n    let _this = this;\r\n\r\n    return new Promise(function(resolve, reject) {\r\n\r\n      let lookupURLDiscoveryService = 'https://rethink.tlabscloud.com/discovery/rest/discover/lookup?searchquery=';\r\n      _this.httpRequest.get(lookupURLDiscoveryService + userIdentifier)\r\n        .then(function(json) {\r\n        // log.log('discover GUID by user identifier', json);\r\n\r\n          let response = JSON.parse(json);\r\n          let filteredGuid = response.results.filter(function(x) {\r\n            return x.rethinkID != undefined;\r\n          });\r\n\r\n          if (filteredGuid.length === 0) { return reject('Unsuccessful discover GUID by user identifier'); }\r\n\r\n          let guids = filteredGuid.map(function(x) { return x.rethinkID; });\r\n\r\n          return resolve(guids);\r\n\r\n        })\r\n        .catch(function(err) {\r\n        // log.log(\"HTTP Request error: \", err);\r\n          return reject(err);\r\n        });\r\n    });\r\n  }\r\n}\r\n\r\n/* harmony default export */ var discovery_CoreDiscovery = (CoreDiscovery_CoreDiscovery);\r\n\n// CONCATENATED MODULE: ./src/store-objects/DataObjectsStorage.js\n// Log System\r\n\r\nlet DataObjectsStorage_log = loglevel[\"getLogger\"]('DataObjectsStorage');\r\n\r\n\r\n\r\n\r\n\r\nclass DataObjectsStorage_DataObjectsStorage {\r\n\r\n  constructor(storageManager, storedDataObjects = {}, factory, runtimeUrl) {\r\n    if (!storageManager) throw new Error('[Store Data Objects] - Needs the storageManager component');\r\n\r\n    this._storageManager = storageManager;\r\n\r\n    this._storeDataObject = storedDataObjects;\r\n\r\n    this._cache = {};\r\n\r\n    this._createSyncDB = createSyncDB; // to create Data Objects to be synched with remote storages\r\n    this._remotes = {}; // List of DO synched with remote storages\r\n    this._factory = factory;\r\n    this._table = 'syncherManager:ObjectURLs';\r\n    this._remoteStorageTable = 'dataObjectStorage';\r\n    this._remoteSchema = 'url';\r\n    this._runtimeUrl = runtimeUrl;\r\n  }\r\n\r\n  // load Data Objects synched with remote Storages\r\n\r\n  loadRemote(resume = false) {\r\n    let _this = this;\r\n    return new Promise((resolve, reject) => {\r\n      let loading = [];\r\n      let synching = [];\r\n\r\n      _this._storageManager.get(null, null, 'remotes').then((remotes) => {\r\n\r\n        // in case we don't have any remotes locally stored\r\n        DataObjectsStorage_log.log('[StoreDataObjects.loadRemote] remotes: ', remotes);\r\n        if (!remotes) resolve();\r\n\r\n        if (!resume) _this._remotes = remotes;\r\n\r\n        DataObjectsStorage_log.log('[StoreDataObjects.loadRemote] loading: ', _this._remotes);\r\n\r\n        let remoteObjects = Object.keys(remotes);\r\n\r\n        // in case we don't have any remotes locally stored\r\n        if (remoteObjects.length === 0) resolve();\r\n\r\n        remoteObjects.forEach((db) => {\r\n          let table = 'do-' + db.split('/')[3];\r\n          _this._remotes[db] = createSyncDB(table, this._factory);\r\n          //            _this._remotes[remote] = createSyncDB(remote, _this._factory, 'remoteDataObjectStorage' );\r\n          loading.push(_this._remotes[db].get());\r\n        });\r\n\r\n        Promise.all(loading).then((remotes) => {\r\n          DataObjectsStorage_log.log('[StoreDataObjects.loadRemote] loaded: ', remotes);\r\n          //TODO: init this._storeDataObject with loaded data objects\r\n          /*          Object.keys(remotes).forEach((remote) => {\r\n          \r\n                      synching.push(_this.sync(remote));\r\n                    });\r\n                    Promise.all(synching).then((dataObjs) => {*/\r\n\r\n          let dataObjs = remotes;\r\n\r\n          if (dataObjs.length === 0) resolve();\r\n\r\n          dataObjs.forEach((dO) => {\r\n\r\n            let dataObj = _this._remoteDoc2dataObject(dO);\r\n            //              Object.keys(dO).forEach((i) => {\r\n\r\n            DataObjectsStorage_log.log('[StoreDataObjects.loadRemote] loaded remote ', dataObj);\r\n            //              if (dO[remote].isReporter) {\r\n            let type = this._getTypeOfObject(dataObj.isReporter);\r\n\r\n            if (!_this._storeDataObject) _this._storeDataObject = {};\r\n\r\n            if (!_this._storeDataObject.hasOwnProperty(type)) _this._storeDataObject[type] = {};\r\n\r\n            _this._storeDataObject[type][dataObj.url] = dataObj;\r\n\r\n            //             });\r\n            //            });\r\n            resolve(_this._storeDataObject);\r\n\r\n          }, (error) => { reject(error) });\r\n        });\r\n      }, (error) => {\r\n        reject(error);\r\n      });\r\n\r\n      resolve();\r\n\r\n    });\r\n  }\r\n\r\n  // delete Data Objects synched with remote Storages\r\n\r\n  deleteRemotes() {\r\n    let _this = this;\r\n    return new Promise((resolve, reject) => {\r\n      let deleting = [];\r\n      let disconnecting = [];\r\n\r\n      _this._storageManager.get(null, null, 'remotes').then((remotes) => {\r\n\r\n        // in case we don't have any remotes locally stored\r\n        DataObjectsStorage_log.info('[StoreDataObjects.deleteRemotes] remotes: ', remotes);\r\n        if (!remotes) resolve();\r\n\r\n        let remoteObjects = Object.keys(_this._remotes);\r\n\r\n        // in case we don't have any remotes locally stored\r\n\r\n        if (remoteObjects.length === 0) resolve();\r\n\r\n        remoteObjects.forEach((db) => {\r\n          deleting.push(\r\n            _this._remotes[db].disconnect()\r\n          );\r\n          deleting.push(\r\n            _this._remotes[db].delete()\r\n          );\r\n        });\r\n\r\n        Promise.all(deleting).then(() => {\r\n          DataObjectsStorage_log.log('[StoreDataObjects.deleteRemotes] deleted.');\r\n\r\n          resolve();\r\n\r\n        }, (error) => { resolve(); });\r\n      });\r\n\r\n      resolve();\r\n\r\n    });\r\n  }\r\n\r\n  /**\r\n   * @description should set the initial state of the dataObjectURL to be resumed if necessary;\r\n   *\r\n   * @param {DataObjectURL} url - dataObjectURL to be saved;\r\n   * @param {Boolean} isReporter - the object to be saved is a reporter\r\n   * @param {SchemaURL} schema - the schema url\r\n   * @param {String} status - the status of current dataObject\r\n   * @param {HypertyURL} reporter - the Reporter hypertyURL\r\n   * @param {Array<HypertyURL>} subscription - list of subscriptions\r\n   * @param {Array<DataObjectChild>} children - list of childs of dataObjectURL\r\n   * @param {Array<String>} childrens - list of childrens, like, 'chatmessage';\r\n   * @param {Array<UserURL} subscriberUser - list of subscribed users;\r\n   */\r\n\r\n  set(metadata) {\r\n\r\n    return new Promise((resolve, reject) => {\r\n      let storeDataObject = this._storeDataObject ? this._storeDataObject : {};\r\n      let type = this._getTypeOfObject(metadata.isReporter);\r\n\r\n\r\n      if (!storeDataObject.hasOwnProperty(type)) storeDataObject[type] = {};\r\n\r\n      if (!storeDataObject[type].hasOwnProperty(metadata.url)) {\r\n        storeDataObject[type][metadata.url] = {};\r\n        storeDataObject[type][metadata.url].subscriptions = [];// TODO:do we need this?\r\n        storeDataObject[type][metadata.url].subscriberUsers = [];// TODO:do we need this?\r\n        storeDataObject[type][metadata.url].childrenObjects = {};\r\n        storeDataObject[type][metadata.url].data = {};\r\n      }\r\n\r\n      Object.assign(storeDataObject[type][metadata.url], metadata);\r\n      delete storeDataObject[type][metadata.url].subscriberUser;\r\n      delete storeDataObject[type][metadata.url].subscriberHyperty;\r\n\r\n      storeDataObject[type][metadata.url].backup = metadata.hasOwnProperty('backup') ? metadata.backup : false;\r\n\r\n      /*if (schema) storeDataObject[type][metadata.url].schema = schema;\r\n      if (status) storeDataObject[type][metadata.url].status = status;\r\n      if (childrenResources) storeDataObject[type][metadata.url].childrenResources = childrenResources;*/\r\n\r\n      if (metadata.subscriberHyperty && !metadata.isReporter) { // TODO: do we need this?\r\n        this._updateToArray(storeDataObject[type], metadata.url, 'subscriptions', metadata.subscriberHyperty);\r\n      }\r\n\r\n      //storeDataObject[type][metadata.url].owner = owner;\r\n\r\n      if (metadata.subscriberUser) { // TODO: do we need this?\r\n        if (storeDataObject[type][metadata.url].subscriberUsers.indexOf(metadata.subscriberUser)) {\r\n          this._updateToArray(storeDataObject[type], metadata.url, 'subscriberUsers', metadata.subscriberUser);\r\n        }\r\n      }\r\n\r\n      this._storeDataObject = storeDataObject;\r\n\r\n      let backup = metadata.hasOwnProperty('backup') ? metadata.backup : false;\r\n      let table = backup ? metadata.url : this._table;\r\n      //      let db = backup ? table.split('://')[1] : this._table;\r\n      let db = backup ? 'do-' + table.split('/')[3] : this._table;\r\n      if (backup && !this._remotes[metadata.url]) {\r\n        let schema = {};\r\n        schema[table] = this._remoteSchema;\r\n        this._remotes[metadata.url] = createSyncDB(db, this._factory);\r\n      }\r\n\r\n      // Save Data Object URL at remotes table to support resumes\r\n\r\n      if (backup) this._storageManager.set(table, 0, db, 'remotes');\r\n\r\n      let storage = backup ? this._remotes[table] : this._storageManager;\r\n\r\n      if (backup) {\r\n        // lets connect to remote storage to enable sync\r\n        storage.set(table, storeDataObject[type][metadata.url]).then(() => {\r\n          if (metadata.isReporter) storage.connect();\r\n          resolve(storeDataObject[type][metadata.url]);\r\n        }, (error) => {\r\n          DataObjectsStorage_log.error('[DataObjectStorage.set] failed to save into remote storage: ', error);\r\n          reject(error);\r\n        });\r\n      } else {\r\n        console.log('[DataObjectStorage.set] _storeDataObject before filter ', this._storeDataObject);\r\n        storage.set(db, 1, this._filterRemotes(this._storeDataObject), table).then(() => {\r\n          resolve(storeDataObject[type][metadata.url]);\r\n        });\r\n      }\r\n    });\r\n  }\r\n\r\n\r\n  // to filter Data Objects that are stored outside the ObjectURLs table\r\n\r\n  _filterRemotes(storeDataObject) {\r\n    let remotes = Object.keys(this._remotes);\r\n\r\n    let filtered = deepClone(storeDataObject);\r\n\r\n    console.log('[DataObjectStorage._filterRemotes] starting filtering ', filtered);\r\n\r\n    remotes.forEach((remote) => {\r\n      if (filtered['reporters'] && filtered['reporters'][remote]) {\r\n        delete filtered['reporters'][remote];\r\n        console.log('[DataObjectStorage._filterRemotes] filter updated ', filtered);\r\n      }\r\n      else delete filtered['observers'][remote];\r\n    });\r\n\r\n    console.log('[DataObjectStorage._filterRemotes] ', filtered);\r\n\r\n    return filtered;\r\n  }\r\n\r\n  // Initial Sync of Observer to avoid later mismatches with sync revisions\r\n  // OUtdated: not used anymore\r\n  /*\r\n    initialObserverSync(resource, backupRevision) {\r\n      // to be completed\r\n      let table = resource.split('/')[3];\r\n  \r\n      let _this = this;\r\n  \r\n      let options = {table: table, observer: true, baseRevision: backupRevision, syncedRevision: backupRevision};\r\n  \r\n      console.log('[DataObjectStorage.initialObserverSync] object: ', resource, ' revision ', backupRevision)\r\n  \r\n      _this._remotes[resource]options).then(()=> {\r\n  \r\n        console.log('[DataObjectStorage.initialObserverSync] connected ');\r\n  \r\n              setTimeout(function() {\r\n                _this._remotes[resource].disconnect().then(()=>{\r\n                  console.log('[DataObjectStorage.initialObserverSync] disconnected ');\r\n              },(error)=> {\r\n                log.error('[DataObjectStorage.initialObserverSync] Error disconnecting with remote storage');\r\n                reject(error);\r\n              });\r\n              }, 15000)\r\n  \r\n      }, (error) => {\r\n        log.error('[DataObjectStorage.initialObserverSync] Error connecting to remote storage');\r\n        reject(error)\r\n      });\r\n  \r\n    }*/\r\n\r\n  /**\r\n   * @description should save and update the current dataObject data information\r\n   *\r\n   * @param {Boolean} isReporter - the object to be saved is a reporter\r\n   * @param {DataObjectURL} resource - dataObjectURL to be saved or updated;\r\n   * @param {String} attribute - attribute inside the data which will be saved\r\n   * @param {any} data - value will be saved inside the attribute;\r\n   */\r\n  saveData(isReporter, resource, attribute, value, updateRuntimeStatus) {\r\n\r\n    let storeDataObject = this._storeDataObject;\r\n    let type = this._getTypeOfObject(isReporter);\r\n\r\n    if (!storeDataObject || !storeDataObject[type] || !storeDataObject[type][resource]) {\r\n      DataObjectsStorage_log.log('[StoreDataObjects - save data] - not saved');\r\n      return;\r\n    }\r\n\r\n    DataObjectsStorage_log.log('[StoreDataObjects - saveData] - ', isReporter, type, resource, attribute, value);\r\n\r\n    if (!storeDataObject[type][resource].hasOwnProperty('data')) {\r\n      storeDataObject[type][resource].data = {};\r\n    }\r\n\r\n    if (attribute) {\r\n      let data;\r\n      if (typeof value === 'object') data = deepClone(value);\r\n      else data = value;\r\n\r\n      utils_assign(storeDataObject[type][resource].data, attribute, data);\r\n    } else {\r\n      storeDataObject[type][resource].data = deepClone(value) || {};\r\n    }\r\n\r\n    this._storeDataObject = storeDataObject;\r\n    let db = storeDataObject[type][resource].backup ? storeDataObject[type][resource].url : 'syncherManager:ObjectURLs';\r\n    let storage = storeDataObject[type][resource].backup ? this._remotes[db] : this._storageManager;\r\n    //    let table = storeDataObject[type][resource].backup ? db.split('/')[3] : this._table;\r\n\r\n    if (storeDataObject[type][resource].backup) {// should we remove childrens?\r\n      return storage.set(db, storeDataObject[type][resource]);\r\n    } else {\r\n      return storage.set('syncherManager:ObjectURLs', 1, this._filterRemotes(storeDataObject), this._table, updateRuntimeStatus);\r\n    }\r\n\r\n  }\r\n\r\n  saveChildrens(isReporter, resource, attribute, value) {\r\n    let storeDataObject = this._storeDataObject;\r\n    let type = this._getTypeOfObject(isReporter);\r\n\r\n    if (!storeDataObject || !storeDataObject[type] || !storeDataObject[type][resource]) {\r\n      DataObjectsStorage_log.log('[StoreDataObjects - save childrens] - not saved');\r\n      return;\r\n    }\r\n\r\n    if (!storeDataObject[type][resource].hasOwnProperty('childrens')) {\r\n      storeDataObject[type][resource].childrenObjects = {};\r\n    }\r\n\r\n    /*    if (!storeDataObject[type][resource].childrenObjects.hasOwnProperty('resources')) {\r\n          storeDataObject[type][resource].childrenObjects.resources = {};\r\n        }*/\r\n\r\n    if (attribute) {\r\n      utils_assign(storeDataObject[type][resource].childrenObjects, attribute, deepClone(value));\r\n    } else {\r\n      storeDataObject[type][resource].childrenObjects = deepClone(value) || {};\r\n    }\r\n\r\n    this._storeDataObject = storeDataObject;\r\n    let db = storeDataObject[type][resource].backup ? storeDataObject[type][resource].url : 'syncherManager:ObjectURLs';\r\n    let storage = storeDataObject[type][resource].backup ? this._remotes[db] : this._storageManager;\r\n    /*   let table = storeDataObject[type][resource].backup ? db.split('/')[3] : this._table;\r\n       let data = storeDataObject[type][resource].backup ? storeDataObject[type][resource] : this._filterRemotes(storeDataObject);\r\n       storage.set(db, 1, data, table).then(() => {\r\n         return storeDataObject[type][resource];\r\n       });*/\r\n\r\n    if (storeDataObject[type][resource].backup) {\r\n\r\n      return storage.set(attribute, value).then(() => {\r\n        // backup child object if reporter is local\r\n        if (this._runtimeUrl === value.value.runtime)\r\n          storage.backup(attribute);\r\n\r\n      });\r\n    } else {\r\n      return storage.set('syncherManager:ObjectURLs', 1, this._filterRemotes(storeDataObject), this._table, updateRuntimeStatus);\r\n    }\r\n\r\n\r\n  }\r\n\r\n  /**\r\n   * @description should save and update the current dataObject information\r\n   *\r\n   * @param {Boolean} isReporter - the object to be saved is a reporter\r\n   * @param {DataObjectURL} resource - dataObjectURL to be saved or updated;\r\n   * @param {String} attribute - attribute inside the data which will be saved\r\n   * @param {any} data - value will be saved inside the attribute;\r\n   */\r\n  update(isReporter, resource, attribute, value, updateRuntimeStatus) {\r\n\r\n    let storeDataObject = this._storeDataObject;\r\n    let type = this._getTypeOfObject(isReporter);\r\n\r\n    if (!storeDataObject || !storeDataObject[type] || !storeDataObject[type][resource]) {\r\n      DataObjectsStorage_log.log('[StoreDataObjects - update] - not saved');\r\n      return;\r\n    }\r\n\r\n    DataObjectsStorage_log.log('[StoreDataObjects - update] - ', isReporter, type, resource, attribute, value);\r\n\r\n    if (storeDataObject[type] && storeDataObject[type][resource] && resource && attribute && value) {\r\n\r\n      if (attribute === 'subscriptions' || attribute === 'subscriberUsers') {\r\n        let update = true;\r\n\r\n        if (attribute === 'subscriptions') {\r\n          update = !this._isOwner(storeDataObject[type][resource], value);\r\n        }\r\n\r\n        if (update) this._updateToArray(storeDataObject[type], resource, attribute, value);\r\n\r\n      } else {\r\n        storeDataObject[type][resource][attribute] = value;\r\n      }\r\n\r\n      this._storeDataObject = storeDataObject;\r\n      let db = storeDataObject[type][resource].backup ? storeDataObject[type][resource].url : 'syncherManager:ObjectURLs';\r\n      let storage = storeDataObject[type][resource].backup ? this._remotes[db] : this._storageManager;\r\n      /*      let table = storeDataObject[type][resource].backup ? db.split('/')[3] : this._table;\r\n            let data = storeDataObject[type][resource].backup ? storeDataObject[type][resource] : this._filterRemotes(storeDataObject);\r\n            storage.set(db, 1, data, table, updateRuntimeStatus).then(() => {\r\n              return storeDataObject[type][resource];\r\n            });*/\r\n\r\n      if (storeDataObject[type][resource].backup) {//just update the attribute that is changing\r\n        return storage.set(db, storeDataObject[type][resource]);\r\n      } else {\r\n        return storage.set('syncherManager:ObjectURLs', 1, this._filterRemotes(storeDataObject), this._table, updateRuntimeStatus);\r\n      }\r\n\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @description should delete stored information from the dataObject\r\n   *\r\n   * @param {Boolean} isReporter - the object to be saved is a reporter\r\n   * @param {DataObjectURL} resource - dataObjectURL to be saved or updated;\r\n   * @param {String} attribute - attribute inside the data which will be saved\r\n   * @param {any} data - value will be saved inside the attribute;\r\n   */\r\n  delete(isReporter, resource, attribute, value) {\r\n\r\n    let storeDataObject = this._storeDataObject;\r\n    let type = this._getTypeOfObject(isReporter);\r\n\r\n    if (!storeDataObject || !storeDataObject[type] || !storeDataObject[type][resource]) {\r\n      DataObjectsStorage_log.log('[StoreDataObjects - delete] - not saved');\r\n      return;\r\n    }\r\n\r\n    if (storeDataObject[type] && storeDataObject[type][resource] && resource && attribute && value) {\r\n\r\n      if (attribute === 'subscriptions' || attribute === 'subscriberUsers') {\r\n        this._removeFromArray(storeDataObject[type], resource, attribute, value);\r\n      } else {\r\n        delete storeDataObject[type][resource][attribute];\r\n      }\r\n\r\n      this._storeDataObject = storeDataObject;\r\n      let db = storeDataObject[type][resource].backup ? storeDataObject[type][resource].url : 'syncherManager:ObjectURLs';\r\n      let storage = storeDataObject[type][resource].backup ? this._remotes[db] : this._storageManager;\r\n      /*     let table = storeDataObject[type][resource].backup ? db.split('/')[3] : this._table;\r\n           let data = storeDataObject[type][resource].backup ? storeDataObject[type][resource] : this._filterRemotes(storeDataObject);\r\n           storage.set(db, 1, data, table);\r\n     \r\n           return storeDataObject[type][resource];*/\r\n\r\n      if (storeDataObject[type][resource].backup) {\r\n        return storage.set(db, storeDataObject[type][resource]);\r\n      } else {\r\n        return storage.set(db, 1, this._filterRemotes(storeDataObject), this._table, updateRuntimeStatus);\r\n      }\r\n\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Delete Data Object from the storage\r\n   */\r\n\r\n  deleteResource(resource) {\r\n\r\n    let _this = this;\r\n\r\n    return new Promise((resolve, reject) => {\r\n\r\n      if (resource) {\r\n        //        return this.getAll().then((storedDataObjects) => {\r\n        DataObjectsStorage_log.log('[DataObjectStorage.deleteResource] deleting: ', resource);\r\n\r\n        //          let this._storeDataObject = Object.assign(this._storeDataObject || {});\r\n\r\n        let backup;\r\n        let db;\r\n        let storage;\r\n\r\n        if (_this._storeDataObject.hasOwnProperty('observers') && _this._storeDataObject.observers.hasOwnProperty(resource)) {\r\n          backup = (_this._storeDataObject.observers[resource].backup) ? _this._storeDataObject.observers[resource].backup : false;\r\n\r\n          db = backup ? _this._storeDataObject.observers[resource].url : 'syncherManager:ObjectURLs';\r\n          storage = backup ? _this._remotes[db] : _this._storageManager;\r\n          delete _this._storeDataObject.observers[resource];\r\n        }\r\n\r\n        if (_this._storeDataObject.hasOwnProperty('reporters') && _this._storeDataObject.reporters.hasOwnProperty(resource)) {\r\n          backup = (_this._storeDataObject.reporters[resource].backup) ? _this._storeDataObject.reporters[resource].backup : false;\r\n\r\n          db = backup ? _this._storeDataObject.reporters[resource].url : 'syncherManager:ObjectURLs';\r\n          storage = backup ? _this._remotes[db] : _this._storageManager;\r\n          delete _this._storeDataObject.reporters[resource];\r\n        }\r\n\r\n        //          this._storeDataObject = this._storeDataObject;\r\n\r\n        if (backup && storage) {\r\n          storage.delete().then(() => {\r\n            DataObjectsStorage_log.log('[DataObjectStorage.deleteResource] deleting sync db ', resource);\r\n            delete _this._remotes[db];\r\n            delete _this._factory.databases['do-' + db.split('/')[3]];\r\n            delete _this._factory.storeManager['do-' + db.split('/')[3]];\r\n            _this._storageManager.delete(resource, null, 'remotes');\r\n          });\r\n        } else {\r\n          delete _this._factory.databases[db];\r\n          delete _this._factory.storeManager[db];\r\n          storage.set(db, 1, this._filterRemotes(_this._storeDataObject));\r\n        }\r\n\r\n\r\n        return resolve();\r\n\r\n        //        });\r\n\r\n      } else {\r\n        reject(new Error('[StoreDataObjects] - Can\\'t delete this ' + resource));\r\n      }\r\n\r\n    });\r\n\r\n  }\r\n\r\n  /*  getAll() {\r\n  \r\n      let _this = this;\r\n  \r\n      return new Promise((resolve, reject) => {\r\n        _this._storeDataObject = this._storageManager.get('syncherManager:ObjectURLs').then((objects) => {\r\n          _this._storeDataObject = objects;\r\n          _this.loadRemote(true).then((storedObjects) => {\r\n            resolve(_this._storeDataObject);\r\n          });\r\n  \r\n        });\r\n  \r\n      });\r\n      //    return this._storageManager.get('syncherManager:ObjectURLs');\r\n    }*/\r\n\r\n  // To sync local storage with remote storage server\r\n\r\n  sync(resource) {\r\n    let _this = this;\r\n\r\n    console.log('[DataObjectStorage._sync] resource: ', resource);\r\n\r\n    return new Promise((resolve, reject) => {\r\n\r\n      if (_this._remotes[resource]) {\r\n        _this._remotes[resource].get(resource, 'isReporter').then((isReporter) => {\r\n          _this._remotes[resource].get(resource, 'subscriptions').then((subscriptions) => {\r\n            _this._remotes[resource].sync().then(() => {\r\n              _this._remotes[resource].get().then((doc) => {\r\n                //          this._remotes[resource].get().then((dataObject)=>{\r\n                DataObjectsStorage_log.info('[DataObjectStorage.sync] returning synched DO: ', doc);\r\n  \r\n                //          if (!isReporter) _this._remotes[resource].disconnect();\r\n  \r\n                // to ensure local data object as the right value for isReporter\r\n                // remote data object should always have isReporter = true.\r\n                //doc[0].isReporter = isReporter;\r\n                let dO = _this._remoteDoc2dataObject(doc);\r\n  \r\n                dO.isReporter = isReporter;\r\n                dO.subscriptions = subscriptions;\r\n  \r\n                if (_this._storeDataObject.hasOwnProperty('observers') && _this._storeDataObject.observers.hasOwnProperty(resource)) {\r\n                  _this._storeDataObject.observers[resource] = dO;\r\n                }\r\n  \r\n                if (_this._storeDataObject.hasOwnProperty('reporters') && _this._storeDataObject.reporters.hasOwnProperty(resource)) {\r\n                  _this._storeDataObject.reporters[resource] = dO;\r\n                }\r\n                _this._remotes[resource].set(resource, dO).then(() => {\r\n                  resolve(dO);\r\n                });\r\n  \r\n              }, (error) => {\r\n                DataObjectsStorage_log.error('[DataObjectStorage.sync] Error ', error);\r\n                reject(error)\r\n              });\r\n            }, (error) => {\r\n              DataObjectsStorage_log.error('[DataObjectStorage.sync] Error ', error);\r\n              reject(error)\r\n            });\r\n  \r\n          });\r\n        });\r\n      } else {\r\n        let warning = resource + ' not found in local storage.'\r\n        DataObjectsStorage_log.warn('[DataObjectStorage.sync] warning ', warning);\r\n        reject(warning);\r\n\r\n      }\r\n\r\n  \r\n\r\n\r\n    });\r\n  }\r\n\r\n  _remoteDoc2dataObject(doc) {\r\n    if (doc.length > 1) {//has childrens\r\n      let dataObject = doc[doc.length - 1];\r\n\r\n      dataObject.childrenObjects = {};\r\n\r\n      let i;\r\n\r\n      for (i = 0; i < doc.length - 1; i++) {\r\n        dataObject.childrenObjects[doc[i]._id] = doc[i];\r\n      }\r\n\r\n      return dataObject;\r\n\r\n    } else return (doc[0]);\r\n\r\n  }\r\n\r\n  stopSync(resource) {\r\n\r\n    if (this._remotes[resource]) this._remotes[resource].disconnect();\r\n\r\n  }\r\n\r\n  /**\r\n* @description should look for a specific dataObjectURL\r\n*\r\n* @param {DataObjectURL} resource - the dataObjectURL will be searched\r\n*\r\n* @returns Promise<Object> object with the dataObject information;\r\n*/\r\n  getDataObject(resource) {\r\n\r\n    return new Promise((resolve, reject) => {\r\n\r\n      /*      this._remotes[resource].get().then((dataObject)=> {\r\n              return resolve(dataObject);\r\n            } , () => {\r\n              this._storageManager.get('syncherManager:ObjectURLs').then((storedDataObject) => {*/\r\n\r\n      let storedDataObject = this._storeDataObject;\r\n\r\n      let observers = storedDataObject.hasOwnProperty('observers') ? storedDataObject.observers : {};\r\n      let reporters = storedDataObject.hasOwnProperty('reporters') ? storedDataObject.reporters : {};\r\n\r\n      let currentReporter = Object.keys(reporters).find((value) => { return value === resource; });\r\n      let currentObserver = Object.keys(observers).find((value) => { return value === resource; });\r\n      let dataObject;\r\n\r\n      if (currentObserver) { dataObject = storedDataObject.observers[currentObserver]; }\r\n      if (currentReporter) { dataObject = storedDataObject.reporters[currentReporter]; }\r\n\r\n      DataObjectsStorage_log.info('[StoreDataObjects - getDataObject] - for observer: ', currentObserver);\r\n      DataObjectsStorage_log.info('[StoreDataObjects - getDataObject] - for reporters: ', currentReporter);\r\n\r\n      DataObjectsStorage_log.info('[StoreDataObjects - getDataObject] - resolve: ', dataObject);\r\n      return dataObject ? resolve(dataObject) : reject('No dataObject was found');\r\n\r\n      //        });\r\n\r\n      //      });\r\n    });\r\n\r\n  }\r\n\r\n  /**\r\n   * @description should get the dataObject information by the message\r\n   *\r\n   * @param {Object} msg - message would be analised to get the current dataObject information\r\n   * @param {Boolean} isReporter - the object to be saved is a reporter\r\n   *\r\n   * @returns Promise<object> should retun an object with the dataObject or null\r\n   */\r\n  getResourcesByCriteria(msg, isReporter) {\r\n\r\n    return new Promise((resolve) => {\r\n\r\n      let type = this._getTypeOfObject(isReporter);\r\n\r\n      //      this.getAll(isReporter).then((storedDataObjects) => {\r\n      let storedDataObjects = this._storeDataObject;\r\n\r\n      if (!storedDataObjects) {\r\n        DataObjectsStorage_log.log('[DataObjectsStorage.getResourcesByCriteria] don\\'t have stored data objects');\r\n        return resolve(null);\r\n      }\r\n\r\n      if (msg.body && msg.body.hasOwnProperty('resume') && !msg.body.resume) {\r\n        return resolve(null);\r\n      }\r\n\r\n      // check if the message have other criteria\r\n      // if not search for on the 'from' of the message.\r\n      let result = [];\r\n      let hasSubscription = this._hasSubscription(storedDataObjects[type], msg.from);\r\n      let isOwner = this._searchOwner(storedDataObjects[type], msg.from);\r\n      let isToProtoStubResume = this._checkProtostubResume(storedDataObjects, msg);\r\n      DataObjectsStorage_log.log('[StoredDataObjects - getResourcesByCriteria]:', storedDataObjects, msg, hasSubscription, isOwner);\r\n      if (msg.hasOwnProperty('from') && hasSubscription || isOwner || isToProtoStubResume) {\r\n        let resource;\r\n\r\n        if (isOwner) {\r\n          resource = this._getResourcesByOwner(storedDataObjects[type], msg.from);\r\n        } else {\r\n          resource = this._getResourcesBySubscription(storedDataObjects[type], msg.from);\r\n        }\r\n\r\n        let identityFoundData = [];\r\n        if (msg.body && msg.body.identity) identityFoundData = this._getResourcesByIdentity(storedDataObjects[type], msg.body.identity);\r\n\r\n        //TODO: remove schema since metadata already includes the schema?\r\n\r\n        let schemaFoundData = [];\r\n        if (msg.body && msg.body.schema) schemaFoundData = this._getResourcesBySchema(storedDataObjects[type], msg.body.schema);\r\n\r\n        let metadataFound = [];\r\n        if (msg.body && msg.body.value) {\r\n          let metadata = msg.body.value;\r\n          delete metadata.data;\r\n          metadataFound = this._getResourcesByMetadata(storedDataObjects[type], metadata);\r\n        }\r\n\r\n        let dataFound = [];\r\n        if (msg.body && msg.body.value && msg.body.value.data) dataFound = this._getResourcesByData(storedDataObjects[type], msg.body.value.data);\r\n\r\n        // you can pass as arrays as you want.. it will be merged in on place\r\n        // removed duplicates;\r\n        result = this._intersection(resource, identityFoundData, schemaFoundData, dataFound, metadataFound);\r\n\r\n        if (result.length == 0 && isToProtoStubResume && type == 'observers' && msg.from.split('protostub').length > 0) {\r\n          let storedObservers = storedDataObjects[type];\r\n          let fromDomain = divideURL(msg.from).domain;\r\n          if (storedObservers) {\r\n            Object.keys(storedObservers).filter((objectURL) => {\r\n              let subscriptions = storedObservers[objectURL].subscriptions;\r\n              let hasSubscription = false;\r\n              subscriptions.forEach(function (subscription) {\r\n                let subscriptionDomain = divideURL(subscription).domain;\r\n                if (subscriptionDomain == fromDomain) {\r\n                  result.push(objectURL);\r\n                }\r\n              });\r\n            });\r\n          }\r\n\r\n        }\r\n      } else {\r\n        return resolve(null);\r\n      }\r\n\r\n      let init = {};\r\n      result.forEach((key) => {\r\n        let currentIsReporter = storedDataObjects[type][key];\r\n        init[key] = currentIsReporter;\r\n        return init;\r\n      });\r\n\r\n      DataObjectsStorage_log.log('[Store Data Objects] - ', init);\r\n\r\n      resolve(init);\r\n    });\r\n\r\n    //    });\r\n\r\n  }\r\n\r\n  /**\r\n   * @private\r\n   * @todo documentation\r\n   */\r\n  _getResourcesByIdentity(storedData, userURL) {\r\n    if (!storedData) return [];\r\n\r\n    return Object.keys(storedData).filter((objectURL) => {\r\n      return storedData[objectURL].subscriberUsers.filter((current) => {\r\n        return current === userURL;\r\n      }).length;\r\n    });\r\n  }\r\n\r\n  /**\r\n   * @private\r\n   * @todo documentation\r\n   */\r\n  _getResourcesByOwner(storedData, owner) {\r\n    if (!storedData) return [];\r\n    return Object.keys(storedData).filter((objectURL) => {\r\n      return storedData[objectURL].reporter === owner;\r\n    });\r\n  }\r\n\r\n  /**\r\n   * @private\r\n   * @todo documentation\r\n   */\r\n  _getResourcesBySubscription(storedData, subscription) {\r\n    if (!storedData) return [];\r\n\r\n    return Object.keys(storedData).filter((objectURL) => {\r\n      return storedData[objectURL].subscriptions.filter((current) => {\r\n        return current === subscription;\r\n      }).length;\r\n    });\r\n\r\n  }\r\n\r\n  /**\r\n   * @private\r\n   * @todo documentation\r\n   */\r\n  _getResourcesBySchema(storedData, schema) {\r\n    return Object.keys(storedData).filter((objectURL) => {\r\n      let currentObject = storedData[objectURL];\r\n      return Object.keys(currentObject).filter((key) => {\r\n        return key === 'schema' && currentObject[key] === schema;\r\n      }).length;\r\n    });\r\n  }\r\n\r\n  /**\r\n   * @private\r\n   * @todo documentation\r\n   */\r\n  _getResourcesByMetadata(storedData, metadata) {\r\n    if (!metadata) return [];\r\n\r\n    return Object.keys(storedData).filter((objectURL) => {\r\n      let currentObject = storedData[objectURL];\r\n      return Object.keys(currentObject).filter((key) => {\r\n        // search on storeDataObjects for specific key provided from data;\r\n        return Object.keys(metadata).filter(searchFor => {\r\n          return key === searchFor && currentObject[key] === metadata[searchFor];\r\n        }).length;\r\n\r\n      }).length;\r\n    });\r\n  }\r\n\r\n  /**\r\n   * @private\r\n   * @todo documentation\r\n   */\r\n  _getResourcesByData(storedData, data) {\r\n    if (!data) return [];\r\n\r\n    return Object.keys(storedData).filter((objectURL) => {\r\n      let currentObject = storedData[objectURL].hasOwnProperty('data') ? storedData[objectURL].data : {};\r\n      return Object.keys(currentObject).filter((key) => {\r\n        // search on storeDataObjects for specific key provided from data;\r\n        return Object.keys(data).filter(searchFor => {\r\n          return key === searchFor && currentObject[key] === data[searchFor];\r\n        }).length;\r\n\r\n      }).length;\r\n    });\r\n  }\r\n\r\n  /**\r\n   * @private\r\n   * @todo documentation\r\n   */\r\n  _hasSubscription(storedData, subscription) {\r\n    if (!storedData) return false;\r\n\r\n    return Object.keys(storedData).filter((objectURL) => {\r\n      return storedData[objectURL].subscriptions.filter((current) => {\r\n        return current === subscription;\r\n      }).length;\r\n    }).length > 0 ? true : false;\r\n  }\r\n\r\n  /**\r\n   * @private\r\n   * @todo documentation\r\n   */\r\n  _searchOwner(storedData, from) {\r\n    if (!storedData) return false;\r\n\r\n    return Object.keys(storedData).filter((objectURL) => {\r\n      return storedData[objectURL].reporter === from;\r\n    }).length > 0 ? true : false;\r\n  }\r\n\r\n  /**\r\n   * @private\r\n   * @todo documentation\r\n   */\r\n  _checkProtostubResume(storedDataObjects, msg) {\r\n\r\n    //return msg.from.includes('protostub');\r\n\r\n        if (!storedDataObjects) return false;\r\n    \r\n        if (msg.hasOwnProperty('body') && msg.body.hasOwnProperty('value') && msg.body.value.hasOwnProperty('reporter')) {\r\n          let reporter = msg.body.value.reporter;\r\n          if (storedDataObjects.hasOwnProperty('reporters')) {\r\n            let reportersStored = storedDataObjects.reporters;\r\n            return Object.keys(reportersStored).filter((objectURL) => {\r\n              return reportersStored[objectURL].reporter === reporter;\r\n            }).length > 0 ? true : false;\r\n          } else {\r\n            return false;\r\n          }\r\n        } else if (storedDataObjects.hasOwnProperty('observers')) {\r\n          let storedObservers = storedDataObjects.observers;\r\n          let fromDomain = divideURL(msg.from).domain;\r\n    \r\n          return Object.keys(storedObservers).filter((objectURL) => {\r\n            let subscriptions = storedObservers[objectURL].subscriptions;\r\n            let hasSubscription = false;\r\n            subscriptions.forEach(function (subscription) {\r\n              let subscriptionDomain = divideURL(subscription).domain;\r\n              if (subscriptionDomain == fromDomain) {\r\n                hasSubscription = true;\r\n              }\r\n            });\r\n            if (hasSubscription) {\r\n              return true;\r\n            }\r\n          }).length > 0 ? true : false;\r\n        }\r\n  }\r\n\r\n  /**\r\n   * @private\r\n   * @todo documentation\r\n   */\r\n  _isOwner(value, url) {\r\n    if (!value) return false;\r\n    return value.reporter === url ? true : false;\r\n  }\r\n\r\n  /**\r\n   * @private\r\n   * @todo documentation\r\n   */\r\n  _intersection() {\r\n    let args = Array.from(arguments);\r\n\r\n    let result = args.reduce((first, second) => {\r\n      return first.concat(second);\r\n    }).filter((value, index, self) => {\r\n      return self.indexOf(value) === index;\r\n    });\r\n    DataObjectsStorage_log.log('DataObjectsStorage._intersection] Result an unique array of strings: ', result);\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * @private\r\n   * @todo documentation\r\n   */\r\n  _updateToArray(storeDataObject, resource, key, value) {\r\n    DataObjectsStorage_log.log('[DataObjectsStorage] - _updateToArray: ', storeDataObject, resource, key, value);\r\n    if (storeDataObject[resource][key].indexOf(value) === -1) storeDataObject[resource][key].push(value);\r\n  }\r\n\r\n  /**\r\n   * @private\r\n   * @todo documentation\r\n   */\r\n  _removeFromArray(storeDataObject, resource, key, value) {\r\n    let indexOfValue = storeDataObject[resource][key].indexOf(value);\r\n    if (indexOfValue === -1) storeDataObject[resource][key].splice(indexOfValue, 1);\r\n  }\r\n\r\n  /**\r\n   * @private\r\n   * @todo documentation\r\n   */\r\n  _hasValue(obj, key, value) {\r\n    return obj.hasOwnProperty(key) && obj[key] === value;\r\n  }\r\n\r\n  /**\r\n   * @private\r\n   * @todo documentation\r\n   */\r\n  _getTypeOfObject(isReporter) {\r\n    return isReporter ? 'reporters' : 'observers';\r\n  }\r\n\r\n}\r\n\r\n/* harmony default export */ var store_objects_DataObjectsStorage = (DataObjectsStorage_DataObjectsStorage);\r\n\n// CONCATENATED MODULE: ./src/utils/PromiseQueue.js\nclass PromiseQueue {\r\n\r\n  // TODO: Improve this Queuing\r\n  constructor(concurrency) {\r\n    this.flushing = false;\r\n    this.Promise = Promise;\r\n    this.concurrency = (typeof concurrency !== 'number') ? 1 : concurrency;\r\n    this.promises = [];\r\n    this.queue = [];\r\n    this.isProcessing = false;\r\n  }\r\n\r\n  done(cb) {\r\n    this.callback = cb;\r\n  }\r\n\r\n  add(promise) {\r\n    this.queue.push(promise);\r\n\r\n    if (!this.isProcessing) {\r\n      return this.queue.reduce((promiseChain, currentTask) => {\r\n        return promiseChain.then(chainResults => currentTask.then(currentResult => [...chainResults, currentResult]));\r\n      }, Promise.resolve([])).then(arrayOfResults => {\r\n        // Do something with all results\r\n        this.isProcessing = false;\r\n      });\r\n\r\n    }\r\n  }\r\n\r\n}\r\n\r\n/* harmony default export */ var utils_PromiseQueue = (PromiseQueue);\r\n\r\n\n// CONCATENATED MODULE: ./src/hyperty-resource/HypertyResourcesStorage.js\n// Log System\r\n\r\nlet HypertyResourcesStorage_log = loglevel[\"getLogger\"]('HypertyResourcesStorage');\r\n\r\n\r\n\r\n\r\n\r\nclass HypertyResourcesStorage_HypertyResourcesStorage {\r\n\r\n  constructor(runtimeURL, bus, storageManager, hypertyResources) {\r\n\r\n    if (!storageManager) throw new Error('[HypertyResourcesStorage constructor] mandatory storageManager parameter missing');\r\n    if (!runtimeURL) throw new Error('[HypertyResourcesStorage constructor] mandatory runtimeURL parameter missing');\r\n    if (!bus) throw new Error('[HypertyResourcesStorage constructor] mandatory bus parameter missing');\r\n\r\n    let _this = this;\r\n\r\n    _this._bus = bus;\r\n\r\n    _this._storageLimit = 0.9; // the save storageLimit;\r\n\r\n    _this._url = runtimeURL + '/storage';\r\n\r\n    _this._storageManager = storageManager;\r\n\r\n    _this.promiseQueue = new utils_PromiseQueue();\r\n\r\n    _this._hypertyResources = hypertyResources;\r\n\r\n    bus.addListener(_this._url, (msg) => {\r\n      HypertyResourcesStorage_log.info('[HypertyResourcesStorage] Message RCV: ', msg);\r\n      switch (msg.type) {\r\n        case 'create': _this._onCreate(msg); break;\r\n        case 'read': _this._onRead(msg); break;\r\n        case 'delete': _this._onDelete(msg); break;\r\n      }\r\n    });\r\n\r\n  }\r\n\r\n  /**\r\n   * check the available storage quota\r\n   *\r\n   * @memberof HypertyResourcesStorage\r\n   */\r\n  checkStorageQuota() {\r\n\r\n    return new Promise((resolve, reject) => {\r\n\r\n      if (this._availableQuota && this._usage) {\r\n        return resolve(availableSpace(this._usage, this._availableQuota));\r\n      }\r\n\r\n      if (navigator) {\r\n\r\n        navigator.storage.estimate().then((estimate) => {\r\n          this._availableQuota = estimate.quota;\r\n          this._usage = estimate.usage;\r\n          resolve(availableSpace(this._usage, this._availableQuota));\r\n\r\n        }).catch((reason) => {\r\n          HypertyResourcesStorage_log.error('[HypertyResourcesStorage] CheckStorageQuota error: ', reason);\r\n          reject(reason);\r\n        });\r\n\r\n      }\r\n\r\n    });\r\n\r\n  }\r\n\r\n  /**\r\n   * @description should save an HypertyResource contained in the body of a create message request;\r\n   *\r\n   * @param {string} message - message containing the hyperty resource to be stored\r\n   */\r\n\r\n  _onCreate(message) {\r\n\r\n    let _this = this;\r\n\r\n    if (!message.body || !message.body.value) throw new Error('[HypertyResourcesStorage._onCreate] mandatory message body value missing: ', message);\r\n\r\n    let content = message.body.value;\r\n    let contentURL = content.contentURL;\r\n    let resourceURL = '';\r\n\r\n    if (!contentURL) {\r\n\r\n      contentURL = [];\r\n      resourceURL = _this._url + '/' + generateGUID();\r\n\r\n    } else {\r\n      const currentURL = contentURL[0];\r\n      const resource = currentURL.substr(currentURL.lastIndexOf('/') + 1);\r\n      resourceURL = _this._url + '/' + resource;\r\n    }\r\n\r\n    if (!_this._hypertyResources.hasOwnProperty(resourceURL)) {\r\n\r\n      contentURL.push(resourceURL);\r\n      content.contentURL = contentURL;\r\n\r\n    }\r\n\r\n    this._hypertyResources[resourceURL] = content;\r\n\r\n    this.promiseQueue.add(this._toSave(resourceURL, message, content));\r\n\r\n  }\r\n\r\n  _toSave(resourceURL, message, content) {\r\n\r\n    return new Promise((resolve, reject) => {\r\n\r\n      const error = (reason) => {\r\n        let response = {\r\n          from: message.to,\r\n          to: message.from,\r\n          id: message.id,\r\n          type: 'response',\r\n          body: { value: resourceURL, code: 500, description: reason }\r\n        };\r\n\r\n        this._bus.postMessage(response);\r\n\r\n        return reject(reason);\r\n      };\r\n\r\n      this.checkStorageQuota().then((result) => {\r\n\r\n        if (content.size > result.quota) {\r\n          const msg = 'The storage do not have space to store that resource';\r\n          error(msg);\r\n          throw Error(msg);\r\n        }\r\n\r\n        const spaceAvailable = result.quota;\r\n        const allocated = result.usage + content.size;\r\n\r\n        if (result.percent >= this._storageLimit || allocated > spaceAvailable) {\r\n          return this._getOlderResources(content.size);\r\n        } else {\r\n          return true;\r\n        }\r\n\r\n      }).then(() => {\r\n        return this._storageManager.set(resourceURL, 1, content);\r\n      }).then(() => {\r\n\r\n        let response = {\r\n          from: message.to,\r\n          to: message.from,\r\n          id: message.id,\r\n          type: 'response',\r\n          body: { value: resourceURL, code: 200 }\r\n        };\r\n\r\n        this._bus.postMessage(response);\r\n\r\n        HypertyResourcesStorage_log.log('Success');\r\n\r\n        return resolve();\r\n\r\n      }).catch(error);\r\n\r\n    });\r\n\r\n  }\r\n\r\n  _getOlderResources(size) {\r\n\r\n    return new Promise((resolve, reject) => {\r\n\r\n      this._storageManager.get().then((result) => {\r\n\r\n        const resources = Object.keys(result);\r\n\r\n        let total = 0;\r\n        const reduced = resources.sort((a, b) => result[a].created < result[b].created)\r\n          .reduce((previousResource, currentResource) => {\r\n            const current = this._hypertyResources[currentResource];\r\n\r\n            HypertyResourcesStorage_log.log('[HypertyResourcesStorage] _getOlderResources: ', total, size, currentResource, this._availableQuota);\r\n\r\n            if (total <= size) {\r\n              total += current.size;\r\n              previousResource.push(currentResource);\r\n            }\r\n\r\n            return previousResource;\r\n\r\n          }, []);\r\n\r\n        const deleting = reduced.map(key => this._storageManager.delete(key));\r\n\r\n        Promise.all(deleting).then(() => {\r\n          resolve(true);\r\n        }).catch((reason) => {\r\n          reject(reason);\r\n        });\r\n\r\n      });\r\n\r\n    });\r\n\r\n  }\r\n\r\n  /**\r\n   * @description should return an HypertyResource stored in the Storage Manager identified by the content url contained in the body of a read message request;\r\n   *\r\n   * @param {string} message - message containing the hyperty resource to be stored\r\n   */\r\n\r\n  _onRead(message) {\r\n\r\n    let _this = this;\r\n\r\n    if (!message.body || !message.body.resource) throw new Error('[HypertyResourcesStorage._onRead] mandatory message body resource missing: ', message);\r\n\r\n    let contentUrl = message.body.resource;\r\n\r\n    let response = {\r\n      from: message.to,\r\n      to: message.from,\r\n      id: message.id,\r\n      type: 'response',\r\n      body: {}\r\n    };\r\n\r\n    // let content = _this._hypertyResources[contentUrl];\r\n\r\n    HypertyResourcesStorage_log.info('[HypertyResourcesStorage._onRead] get resourceURL:', contentUrl);\r\n\r\n    this._storageManager.get('resourceURL', contentUrl).then((content) => {\r\n\r\n      HypertyResourcesStorage_log.info('[HypertyResourcesStorage._onRead] found content:', content);\r\n\r\n      if (content) {\r\n\r\n        if (content.resourceType === 'file') {\r\n          _this._onReadFile(response, content);\r\n        } else {\r\n          response.body.code = 200;\r\n          response.body.p2p = true;\r\n          response.body.value = content;\r\n          _this._bus.postMessage(response);\r\n        }\r\n\r\n      } else {\r\n        response.body.code = 404;\r\n        response.body.desc = 'Content Not Found for ' + contentUrl;\r\n        _this._bus.postMessage(response);\r\n\r\n      }\r\n\r\n    });\r\n\r\n    //response.body.code = 404;\r\n\r\n    //_this._hypertyResources[contentUrl] = message.body.value;\r\n\r\n\r\n  }\r\n\r\n  _onReadFile(response, resource) {\r\n    let _this = this;\r\n\r\n    let reader = new FileReader();\r\n\r\n    reader.onload = function(theFile) {\r\n\r\n      HypertyResourcesStorage_log.info('[FileHypertyResource.init] file loaded ', theFile);\r\n\r\n      response.body.code = 200;\r\n      response.body.p2p = true;\r\n      response.body.value = deepClone(resource);\r\n      response.body.value.content = theFile.target.result;\r\n      _this._bus.postMessage(response);\r\n    };\r\n\r\n    if (resource.mimetype.includes('text/')) {\r\n      reader.readAsText(resource.content);\r\n    } else {\r\n      const current = resource.content;\r\n\r\n      let blob;\r\n      if (Array.isArray(current)) {\r\n        blob = new Blob(current, { type: resource.mimetype});\r\n      } else {\r\n        blob = new Blob([current], { type: resource.mimetype});\r\n      }\r\n\r\n      reader.readAsArrayBuffer(blob);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @description should delete an HypertyResource from the storage;\r\n   *\r\n   * @param {string} message - message containing the content URL of the hyperty resource to be deleted\r\n   */\r\n\r\n  _onDelete(message) {\r\n\r\n    let _this = this;\r\n\r\n    if (!message.body) throw new Error('[HypertyResourcesStorage._onDelete] mandatory message body missing: ', message);\r\n\r\n    if (message.body.resource) {\r\n      delete _this._hypertyResources[message.body.resource];\r\n    } else if (message.body.resources) {\r\n      message.body.resources.forEach((resource) => {\r\n        delete _this._hypertyResources[resource];\r\n      });\r\n    } else {\r\n      throw new Error('[HypertyResourcesStorage._onDelete] mandatory resource missing: ', message);\r\n    }\r\n\r\n    _this._storageManager.delete('resourceURL', message.body.resource).then(() => {\r\n      let response = {\r\n        from: message.to,\r\n        to: message.from,\r\n        id: message.id,\r\n        type: 'response',\r\n        body: { code: 200 }\r\n      };\r\n\r\n      _this._bus.postMessage(response);\r\n    }).catch((reason) => {\r\n      let response = {\r\n        from: message.to,\r\n        to: message.from,\r\n        id: message.id,\r\n        type: 'response',\r\n        body: { code: 400, description: reason }\r\n      };\r\n\r\n      _this._bus.postMessage(response);\r\n    });\r\n\r\n  }\r\n\r\n}\r\n\r\n/* harmony default export */ var hyperty_resource_HypertyResourcesStorage = (HypertyResourcesStorage_HypertyResourcesStorage);\r\n\n// CONCATENATED MODULE: ./src/syncher/Subscription.js\n// Log System\r\n\r\nlet Subscription_log = loglevel[\"getLogger\"]('SynSubscription');\r\n\r\nclass Subscription {\r\n\r\n  constructor(bus, owner, url, isReporter) {\r\n    let _this = this;\r\n    let childBaseURL = url + '/children/';\r\n    let changeURL = url + '/changes';\r\n\r\n    //process delete message\r\n    _this._deleteListener = bus.addListener(changeURL, (msg) => {\r\n      if (msg.type === 'delete') {\r\n        Subscription_log.log('Subscription-DELETE: ', msg);\r\n\r\n        //FLOW-OUT: message sent to all subscribers\r\n        let deleteMessageToHyperty = {\r\n          type: 'delete', from: msg.from, to: owner,\r\n          body: { identity: msg.body.identity, resource: url }\r\n        };\r\n\r\n        //send delete to hyperty\r\n        bus.postMessage(deleteMessageToHyperty, (reply) => {\r\n          Subscription_log.log('Subscription-DELETE-REPLY: ', reply);\r\n          if (reply.body.code === 200) {\r\n            _this._releaseListeners();\r\n          }\r\n        });\r\n      }\r\n    });\r\n\r\n    //add change publish address or forward\r\n    if (isReporter) {\r\n      _this._changeListener = bus.addPublish(changeURL);\r\n    } else {\r\n      _this._changeListener = bus.addForward(changeURL, owner);\r\n    }\r\n\r\n    _this._childrenListeners = [];\r\n//    log.log('[Subscription] - childID', childrens);\r\n//    childrens.forEach((child) => {\r\n//    let childId = childBaseURL + child;\r\n\r\n//      log.log('[Subscription] - childID', childBaseURL);\r\n\r\n      //add children publish address\r\n      let childrenForward = bus.addPublish(childBaseURL);\r\n      _this._childrenListeners.push(childrenForward);\r\n\r\n      //add self forward if an observer\r\n      if (!isReporter) {\r\n        let selfForward = bus.addForward(childBaseURL, owner);\r\n        _this._childrenListeners.push(selfForward);\r\n      }\r\n//    });\r\n  }\r\n\r\n  _releaseListeners() {\r\n    let _this = this;\r\n\r\n    _this._deleteListener.remove();\r\n\r\n    _this._changeListener.remove();\r\n\r\n    _this._childrenListeners.forEach((forward) => {\r\n      forward.remove();\r\n    });\r\n  }\r\n\r\n}\r\n\r\n/* harmony default export */ var syncher_Subscription = (Subscription);\r\n\n// CONCATENATED MODULE: ./src/syncher/ReporterObject.js\n// Log System\r\n\r\nlet ReporterObject_log = loglevel[\"getLogger\"]('ReporterObject');\r\n\r\n\r\n\r\n\r\n\r\nclass ReporterObject_ReporterObject {\r\n\r\n  constructor(parent, owner, url, childrens, offline) {\r\n    let _this = this;\r\n\r\n    _this._parent = parent;\r\n    _this._owner = owner;\r\n    _this._url = url;\r\n\r\n    _this._bus = parent._bus;\r\n\r\n    _this._domain = divideURL(url).domain;\r\n    _this._objSubscriptorURL = _this._url + '/subscription';\r\n\r\n    _this._subscriptions = {};\r\n    _this._childrens = childrens;\r\n    _this._childrenListeners = [];\r\n\r\n    _this._forwards = {};\r\n\r\n    _this._isToSaveData = false;\r\n\r\n    _this._allocateListeners();\r\n\r\n    _this._offline = offline ? offline : false;\r\n  }\r\n\r\n  get offline(){\r\n    return this._offline;\r\n  }\r\n\r\n  _allocateListeners() {\r\n    let _this = this;\r\n\r\n    //add subscription listener...\r\n    _this._subscriptionListener = _this._bus.addListener(_this._objSubscriptorURL, (msg) => {\r\n      ReporterObject_log.info('[SyncherManager.ReporterObject received ]', msg);\r\n      switch (msg.type) {\r\n        case 'subscribe': _this._onRemoteSubscribe(msg); break;\r\n        case 'unsubscribe': _this._onRemoteUnSubscribe(msg); break;\r\n        case 'response': _this._onRemoteResponse(msg); break;\r\n        case 'forward': _this._onForwardedRemoteSubscribe(msg); break;\r\n      }\r\n    });\r\n\r\n    let changeURL = _this._url + '/changes';\r\n    _this._changeListener = _this._bus.addListener(changeURL, (msg) => {\r\n\r\n      ReporterObject_log.info('[SyncherManager.ReporterObject ] SyncherManager-' + changeURL + '-RCV: ', msg);\r\n\r\n      //do not save changes to backupRevision to avoid infinite loops\r\n      if (this._isToSaveData && msg.body.attribute ) {\r\n        let updateRuntimeStatus = msg.body.attribute !== 'backupRevision' ? true : false;\r\n        ReporterObject_log.log('[SyncherManager.ReporterObject ] SyncherManager - save data: ', msg);\r\n        _this._parent._dataObjectsStorage.update(true, _this._url, 'version', msg.body.version, updateRuntimeStatus);\r\n        _this._parent._dataObjectsStorage.update(true, _this._url, 'lastModified', msg.body.lastModified, updateRuntimeStatus);\r\n        _this._parent._dataObjectsStorage.saveData(true, _this._url, msg.body.attribute, msg.body.value, updateRuntimeStatus);\r\n      }\r\n    });\r\n  }\r\n\r\n  set isToSaveData(value) {\r\n    this._isToSaveData = value;\r\n  }\r\n\r\n  // To handle subscriptions sent while the reporter was offline ie forwarded by a Offline Subscription Manager service\r\n\r\n  _onForwardedRemoteSubscribe(msg) {\r\n    this._onRemoteSubscribe(msg.body);\r\n  }\r\n\r\n  _releaseListeners() {\r\n    let _this = this;\r\n\r\n    _this._subscriptionListener.remove();\r\n\r\n    _this._changeListener.remove();\r\n\r\n    _this._childrenListeners.forEach((cl) => {\r\n      cl.remove();\r\n    });\r\n\r\n    Object.keys(_this._forwards).forEach((key) => {\r\n      _this.forwardUnSubscribe(key);\r\n    });\r\n\r\n    //remove all subscriptions\r\n    Object.keys(_this._subscriptions).forEach((key) => {\r\n      _this._subscriptions[key]._releaseListeners();\r\n    });\r\n  }\r\n\r\n  resumeSubscriptions(subscriptions) {\r\n    let _this = this;\r\n\r\n    if (!subscriptions)\r\n      return;\r\n\r\n    Object.keys(subscriptions).forEach((key) => {\r\n      let hypertyURL = subscriptions[key];\r\n\r\n      ReporterObject_log.log('[SyncherManager.ReporterObject] - resume subscriptions', _this, hypertyURL, _this._childrens);\r\n\r\n      if (!_this._subscriptions[hypertyURL]) {\r\n        _this._subscriptions[hypertyURL] = new syncher_Subscription(_this._bus, _this._owner, _this._url, true);\r\n      }\r\n    });\r\n\r\n  }\r\n\r\n  /**\r\n   * Register a listener in the msg-node and in the local MessageBus, so that messages on this address are forwarded to the reporter object\r\n   * @param  {string} address - URL to register the listeners\r\n   * @return {Promise} Return Promise OK or error\r\n   */\r\n  forwardSubscribe(addresses) {\r\n    let _this = this;\r\n\r\n    //FLOW-OUT: message sent to the msg-node SubscriptionManager component\r\n    let nodeSubscribeMsg = {\r\n      type: 'subscribe', from: _this._parent._url, to: 'domain://msg-node.' + _this._domain + '/sm',\r\n      body: { resources: addresses, source: _this._owner }\r\n    };\r\n\r\n    return new Promise((resolve, reject) => {\r\n      _this._bus.postMessageWithRetries(nodeSubscribeMsg, 10, (reply) => {\r\n        ReporterObject_log.log('[SyncherManager.ReporterObject ]forward-subscribe-response(reporter): ', reply);\r\n        if (reply.body.code === 200) {\r\n          let newForward = _this._bus.addForward(_this._url, _this._owner);\r\n          _this._forwards[addresses[0]] = newForward;\r\n          resolve();\r\n        } else {\r\n          reject('Error on msg-node subscription: ' + reply.body.desc);\r\n        }\r\n      });\r\n    });\r\n  }\r\n\r\n  /**\r\n   * UnRegister a listener in the msg-node and in the local MessageBus, so that messages on this address are removed from forward\r\n   * @param  {string} address - URL to un-register the listeners\r\n   */\r\n  forwardUnSubscribe(address) {\r\n    let _this = this;\r\n\r\n    _this._forwards[address].remove();\r\n    delete _this._forwards[address];\r\n\r\n    //FLOW-OUT: message sent to the msg-node SubscriptionManager component\r\n    let nodeUnSubscribeMsg = {\r\n      type: 'unsubscribe', from: _this._parent._url, to: 'domain://msg-node.' + _this._domain + '/sm',\r\n      body: { resources: [address], source: _this._owner }\r\n    };\r\n\r\n    _this._bus.postMessage(nodeUnSubscribeMsg);\r\n  }\r\n\r\n  /**\r\n   * Register listeners for a list of childrens. Public channels used to transmit messages.\r\n   * @param  {string[]} childrens - channels to register\r\n   * @return {Promise} Return Promise OK or error\r\n   */\r\n  addChildrens() {\r\n    let _this = this;\r\n\r\n    return new Promise((resolve, reject) => {\r\n      if (_this._childrens.length === 0) {\r\n        resolve();\r\n        return;\r\n    }\r\n\r\n      let childBaseURL = _this._url + '/children/';\r\n      ReporterObject_log.log('[SyncherManager.ReporterObject - addChildrens] - childrens: ', childBaseURL);\r\n\r\n  /*    childrens.forEach((child) => {\r\n        _this._childrens.push(child);\r\n      });*/\r\n\r\n      /*\r\n      _this._childrens.forEach((child) => {\r\n        let childId = childBaseURL + child;\r\n\r\n        let selfForward = _this._bus.addForward(childId, owner);\r\n        _this._childrenListeners.push(selfForward);\r\n      });*/\r\n\r\n      let subscriptions = [];\r\n//      childrens.forEach((child) => subscriptions.push(childBaseURL + child));\r\n      subscriptions.push(childBaseURL );\r\n\r\n      //_this._storageSubscriptions[_this._objSubscriptorURL] = {url: _this._url, owner: _this._owner, childrens: _this._childrens};\r\n\r\n      //FLOW-OUT: message sent to the msg-node SubscriptionManager component\r\n      let nodeSubscribeMsg = {\r\n        type: 'subscribe', from: _this._parent._url, to: 'domain://msg-node.' + _this._domain + '/sm',\r\n        body: { resources: subscriptions, source: _this._owner }\r\n      };\r\n\r\n      _this._bus.postMessage(nodeSubscribeMsg, (reply) => {\r\n        ReporterObject_log.log('[SyncherManager.ReporterObject ]node-subscribe-response(reporter):', reply);\r\n        if (reply.body.code === 200) {\r\n\r\n          //add children listeners on local ...\r\n          subscriptions.forEach((childURL) => {\r\n            let childListener = _this._bus.addListener(childURL, (msg) => {\r\n              //TODO: what todo here? Save childrens?\r\n              ReporterObject_log.log('[SyncherManager.ReporterObject received]', msg);\r\n\r\n\r\n              if (msg.type === 'create' && msg.to.includes('children') && this._isToSaveData) {\r\n\r\n                // if the value is not encrypted lets encrypt it\r\n                // todo: should be subject to some policy\r\n                let splitedReporterURL = splitObjectURL(msg.to);\r\n\r\n                let url = splitedReporterURL.url;\r\n\r\n                if (!msg.body.hasOwnProperty('mutual')) msg.body.mutual = true;\r\n\r\n                //remove false when mutualAuthentication is enabled\r\n                if (!(typeof msg.body.value === 'string') && msg.body.mutual) {\r\n\r\n                  ReporterObject_log.log('[SyncherManager.ReporterObject] encrypting received data ', msg.body.value);\r\n\r\n                  cryptoManager_CryptoManager.encryptDataObject(msg.body.value, url).then((encryptedValue)=>{\r\n                    ReporterObject_log.log('[SyncherManager.ReporterObject] encrypted data ',  encryptedValue);\r\n\r\n                    _this._storeChildObject(msg, JSON.stringify(encryptedValue));\r\n                  }).catch((reason) => {\r\n                    ReporterObject_log.warn('[SyncherManager._decryptChildrens] failed : ', reason, ' Storing unencrypted');\r\n                    _this._storeChildObject(msg, msg.body.value);\r\n                  });\r\n                } else {\r\n                  _this._storeChildObject(msg, msg.body.value);\r\n                }\r\n              }\r\n\r\n            });\r\n            _this._childrenListeners.push(childListener);\r\n\r\n            let selfForward = _this._bus.addForward(childURL, _this._owner);\r\n            _this._childrenListeners.push(selfForward);\r\n          });\r\n\r\n          resolve();\r\n        } else {\r\n          reject('Error on msg-node subscription: ' + reply.body.desc);\r\n        }\r\n      });\r\n    });\r\n  }\r\n\r\n  // store childObject\r\n\r\n  _storeChildObject(msg, data) {\r\n    let _this = this;\r\n\r\n    let splitedReporterURL = splitObjectURL(msg.to);\r\n\r\n    let url = splitedReporterURL.url;\r\n\r\n    let resource = splitedReporterURL.resource;\r\n    let value;\r\n    \r\n\r\n/*    if (msg.body.identity) {\r\n      value.identity = msg.body.identity;\r\n      delete value.identity.assertion;\r\n      delete value.identity.expires;\r\n    }*/\r\n\r\n    let objectURLResource = msg.body.resource;\r\n    let attribute = resource;\r\n\r\n    if (objectURLResource === 'heartbeat' ) value = data;\r\n    else value = {\r\n      identity: msg.body.identity,\r\n      value: data\r\n    };\r\n\r\n//    if (objectURLResource) attribute += '.' + objectURLResource;\r\n    if (objectURLResource) attribute = objectURLResource;\r\n\r\n    // this identity data is not needed to be stored\r\n\r\n\r\n    console.log('[SyncherManager.ReporterObject._storeChildObject] : ', url, attribute, value);\r\n\r\n    _this._parent._dataObjectsStorage.saveChildrens(true, url, attribute, value);\r\n  }\r\n\r\n  delete() {\r\n    let _this = this;\r\n    let domain = divideURL(_this._owner).domain;\r\n\r\n    //FLOW-OUT: message sent directly to all subscribers of the reporter\r\n    _this._bus.postMessage({\r\n      type: 'delete', from: _this._objSubscriptorURL, to: _this._url + '/changes'\r\n    });\r\n\r\n    //FLOW-OUT: message sent to the msg-node ObjectAllocationManager component\r\n    _this._bus.postMessage({\r\n      type: 'delete', from: _this._parent._url, to: 'domain://msg-node.' + domain + '/object-address-allocation',\r\n      body: { resource: _this._url, childrenResources: _this._childrens }\r\n    });\r\n\r\n    _this._releaseListeners();\r\n    delete _this._parent._reporters[_this._url];\r\n  }\r\n\r\n  _onRemoteResponse(msg) {\r\n    let _this = this;\r\n\r\n    _this._bus.postMessage({\r\n      id: msg.id, type: 'response', from: msg.to, to: _this._url,\r\n      body: { code: msg.body.code, identity: msg.body.identity, source: msg.from }\r\n    });\r\n  }\r\n\r\n  //FLOW-IN: message received from Syncher -> subscribe\r\n  _onRemoteSubscribe(msg) {\r\n    let _this = this;\r\n    let hypertyURL = msg.body.subscriber;\r\n\r\n    //validate if subscription already exists?\r\n    if (_this._subscriptions[hypertyURL]) {\r\n      // let errorMsg = {\r\n      //   id: msg.id, type: 'response', from: msg.to, to: hypertyURL,\r\n      //   body: { code: 500, desc: 'Subscription for (' + _this._url + ' : ' +  hypertyURL + ') already exists!' }\r\n      // };\r\n      //\r\n      // _this._bus.postMessage(errorMsg);\r\n      // return;\r\n\r\n      // new version because of reusage\r\n      _this._subscriptions[hypertyURL]._releaseListeners();\r\n    }\r\n\r\n    //ask to subscribe to Syncher? (depends on the operation mode)\r\n    //TODO: get mode from object!\r\n    let mode = 'sub/pub';\r\n\r\n    if (mode === 'sub/pub') {\r\n      //FLOW-OUT: message sent to local hyperty address Syncher -> _onForward\r\n      let forwardMsg = {\r\n        type: 'forward', from: _this._url, to: _this._owner,\r\n        body: { type: msg.type, from: hypertyURL, to: _this._url, identity: msg.body.identity }\r\n      };\r\n\r\n      //TODO: For Further Study\r\n      if (msg.body.hasOwnProperty('mutual')) forwardMsg.body.mutual = msg.body.mutual;\r\n\r\n      _this._bus.postMessage(forwardMsg, (reply) => {\r\n        ReporterObject_log.log('[SyncherManager.ReporterObject ]forward-reply: ', reply);\r\n        if (reply.body.code === 200) {\r\n          if (!_this._subscriptions[hypertyURL]) {\r\n            ReporterObject_log.log('[SyncherManager.ReporterObject] - _onRemoteSubscribe:', _this._childrens);\r\n            _this._subscriptions[hypertyURL] = new syncher_Subscription(_this._bus, _this._owner, _this._url, true);\r\n          }\r\n        }\r\n\r\n\r\n        // Store for each reporter hyperty the dataObject\r\n        let userURL;\r\n        if (msg.body.identity && msg.body.identity.userProfile.userURL) {\r\n          userURL = msg.body.identity.userProfile.userURL;\r\n          _this._parent._dataObjectsStorage.update(true, _this._url, 'subscriberUsers', userURL);\r\n        }\r\n\r\n        //TODO: mutual and sessionkeys updates were removed. FFS\r\n\r\n        /*        if (msg.body.hasOwnProperty('mutual')) {\r\n//          _this._parent._identityModule.updateIsToEncryptForDataObjectSessionKey(_this._url, msg.body.mutual).then(()=>{\r\n            _this._parent._dataObjectsStorage.update(true, _this._url, 'mutual', msg.body.mutual);\r\n//          });\r\n        }*/\r\n\r\n        _this._parent._dataObjectsStorage.update(true, _this._url, 'subscriptions', hypertyURL);\r\n\r\n        reply.body.owner = _this._owner;\r\n\r\n        //FLOW-OUT: subscription response sent (forward from internal Hyperty)\r\n        _this._bus.postMessage({\r\n          id: msg.id, type: 'response', from: msg.to, to: msg.from,\r\n          body: reply.body\r\n        });\r\n\r\n      });\r\n    }\r\n\r\n  }\r\n\r\n  //FLOW-IN: message received from remote ObserverObject -> removeSubscription\r\n  _onRemoteUnSubscribe(msg) {\r\n    let _this = this;\r\n    let unsubscriber = msg.body.source;\r\n\r\n    let subscription = _this._subscriptions[unsubscriber];\r\n    if (subscription) {\r\n      subscription._releaseListeners();\r\n      delete _this._subscriptions[unsubscriber];\r\n\r\n      let forwardMsg = {\r\n        type: 'forward', from: _this._url, to: _this._owner,\r\n        body: { type: msg.type, from: unsubscriber, to: _this._url, identity: msg.body.identity }\r\n      };\r\n\r\n\r\n      _this._bus.postMessage(forwardMsg);\r\n    }\r\n\r\n  }\r\n\r\n}\r\n\r\n/* harmony default export */ var syncher_ReporterObject = (ReporterObject_ReporterObject);\r\n\n// CONCATENATED MODULE: ./src/syncher/ObserverObject.js\n// Log System\r\n\r\nlet ObserverObject_log = loglevel[\"getLogger\"]('ObserverObject');\r\n\r\n\r\n\r\n\r\n\r\nclass ObserverObject_ObserverObject {\r\n\r\n  constructor(parent, url, childrens) {\r\n    let _this = this;\r\n\r\n    _this._parent = parent;\r\n    _this._url = url;\r\n    _this._childrens = childrens;\r\n\r\n    _this._bus = parent._bus;\r\n\r\n    _this._subscriptions = {};\r\n    _this._storageSubscriptions = {};\r\n    _this._childrenListeners = [];\r\n\r\n    this._isToSaveData = false;\r\n\r\n    let changeURL = _this._url + '/changes';\r\n    _this._changeListener = _this._bus.addListener(changeURL, (msg) => {\r\n\r\n      ObserverObject_log.log('[SyncherManager.ObserverObject ] SyncherManager-' + changeURL + '-RCV: ', msg);\r\n\r\n      //TODO: what todo here? Save changes?\r\n      if (this._isToSaveData && msg.body.attribute) {\r\n        ObserverObject_log.log('[SyncherManager.ObserverObject ] SyncherManager - save data: ', msg);\r\n        _this._parent._dataObjectsStorage.update(false, _this._url, 'version', msg.body.version);\r\n        _this._parent._dataObjectsStorage.update(false, _this._url, 'lastModified', msg.body.lastModified);\r\n        _this._parent._dataObjectsStorage.saveData(false, _this._url, msg.body.attribute, msg.body.value);\r\n      }\r\n\r\n    });\r\n  }\r\n\r\n  set isToSaveData(value) {\r\n    this._isToSaveData = value;\r\n  }\r\n\r\n  _newSubscription(hyperty) {\r\n    let _this = this;\r\n\r\n    let subscription = _this._subscriptions[hyperty];\r\n    ObserverObject_log.log('[Observer Object - new subscription] - ',  _this._subscriptions, hyperty, _this._subscriptions.hasOwnProperty(hyperty));\r\n    if (!subscription) {\r\n      _this._subscriptions[hyperty] = new syncher_Subscription(_this._bus, hyperty, _this._url, false);\r\n    }\r\n  }\r\n\r\n  addSubscription(hyperty) {\r\n    let _this = this;\r\n\r\n    _this._newSubscription(hyperty);\r\n  }\r\n\r\n  addChildrens() {\r\n    let _this = this;\r\n\r\n    return new Promise((resolve) => {\r\n      if (_this._childrens.length === 0) {\r\n        resolve();\r\n        return;\r\n    }\r\n\r\n      let childBaseURL = _this._url + '/children/';\r\n      ObserverObject_log.log('[SyncherManager.ObserverObject - addChildrens] - childrens: ', childBaseURL);\r\n\r\n//      childrens.forEach((child) => {\r\n\r\n        let childListener = _this._bus.addListener(childBaseURL, (msg) => {\r\n          //TODO: what todo here? Save childrens?\r\n          ObserverObject_log.log('[SyncherManager.ObserverObject received]', msg);\r\n\r\n          if (msg.type === 'create' && msg.to.includes('children') && this._isToSaveData) {\r\n            let splitedReporterURL = splitObjectURL(msg.to);\r\n\r\n            let url = splitedReporterURL.url;\r\n\r\n            if (!msg.body.hasOwnProperty('mutual')) msg.body.mutual = true;\r\n\r\n            //remove false when mutualAuthentication is enabled\r\n            if (!(typeof msg.body.value === 'string') && msg.body.mutual) {\r\n\r\n              ObserverObject_log.log('[SyncherManager.ObserverObject] encrypting received data ', msg.body.value);\r\n\r\n              cryptoManager_CryptoManager.encryptDataObject(msg.body.value, url).then((encryptedValue)=>{\r\n                ObserverObject_log.log('[SyncherManager.ObserverObject] encrypted data ',  encryptedValue);\r\n\r\n                _this._storeChildObject(msg, JSON.stringify(encryptedValue));\r\n              }).catch((reason) => {\r\n                ObserverObject_log.warn('[SyncherManager.ObserverObject._encryptChild] failed, storing unencrypted ', reason);\r\n                _this._storeChildObject(msg, msg.body.value);\r\n              });\r\n            } else {\r\n              _this._storeChildObject(msg, msg.body.value);\r\n            }\r\n          }\r\n\r\n          ObserverObject_log.log('[SyncherManager.ObserverObject children Listeners]', _this._childrenListeners, childListener);\r\n          if (_this._childrenListeners.indexOf(childListener) === -1) {\r\n            _this._childrenListeners.push(childListener);\r\n          }\r\n\r\n        });\r\n\r\n      });\r\n\r\n//    });\r\n  }\r\n\r\n  // store childObject\r\n\r\n  _storeChildObject(msg, data) {\r\n    let _this = this;\r\n\r\n    let splitedReporterURL = splitObjectURL(msg.to);\r\n\r\n    let url = splitedReporterURL.url;\r\n\r\n    let resource = splitedReporterURL.resource;\r\n    let value = {};\r\n\r\n/*    let value = {\r\n      identity: msg.body.identity,\r\n      value: data\r\n    };*/\r\n\r\n    // this identity data is not needed to be stored\r\n/*    delete value.identity.assertion;\r\n    delete value.identity.expires;*/\r\n\r\n    let objectURLResource = msg.body.resource;\r\n    let attribute = resource;\r\n\r\n    if (objectURLResource === 'heartbeat') {\r\n      value = data;\r\n    } else {\r\n      value.identity= msg.body.identity;\r\n      value.value = data;\r\n    } \r\n\r\n//    if (objectURLResource) attribute += '.' + objectURLResource;\r\n    if (objectURLResource) attribute = objectURLResource;\r\n\r\n    ObserverObject_log.log('[SyncherManager.ObserverObject._storeChildObject] : ', url, attribute, value);\r\n\r\n    _this._parent._dataObjectsStorage.saveChildrens(false, url, attribute, value);\r\n  }\r\n\r\n  removeSubscription(msg) {\r\n    let _this = this;\r\n\r\n    let hyperty = msg.from;\r\n\r\n    let domain = divideURL(hyperty).domain;\r\n    let objURLSubscription = _this._url + '/subscription';\r\n\r\n    let subscription = _this._subscriptions[hyperty];\r\n    if (subscription) {\r\n      //FLOW-OUT: message sent to remote ReporterObject -> _onRemoteUnSubscribe\r\n      _this._bus.postMessage({\r\n        type: 'unsubscribe', from: _this._parent._url, to: objURLSubscription,\r\n        body: { source: hyperty, identity: msg.body.identity }\r\n      });\r\n\r\n      //TODO: should I wait for response before unsubscribe on msg-node\r\n      //FLOW-OUT: message sent to msg-node SubscriptionManager component\r\n      _this._bus.postMessage({\r\n        type: 'unsubscribe', from: _this._parent._url, to: 'domain://msg-node.' + domain + '/sm',\r\n        body: { resource: _this._url, resources: [_this._url + '/children/'] }\r\n      });\r\n\r\n      subscription._releaseListeners();\r\n      delete _this._subscriptions[hyperty];\r\n    }\r\n  }\r\n\r\n}\r\n\r\n/* harmony default export */ var syncher_ObserverObject = (ObserverObject_ObserverObject);\r\n\n// CONCATENATED MODULE: ./src/syncher/SyncherManager.js\n/**\r\n* Copyright 2016 PT Inovação e Sistemas SA\r\n* Copyright 2016 INESC-ID\r\n* Copyright 2016 QUOBIS NETWORKS SL\r\n* Copyright 2016 FRAUNHOFER-GESELLSCHAFT ZUR FOERDERUNG DER ANGEWANDTEN FORSCHUNG E.V\r\n* Copyright 2016 ORANGE SA\r\n* Copyright 2016 Deutsche Telekom AG\r\n* Copyright 2016 Apizee\r\n* Copyright 2016 TECHNISCHE UNIVERSITAT BERLIN\r\n*\r\n* Licensed under the Apache License, Version 2.0 (the \"License\");\r\n* you may not use this file except in compliance with the License.\r\n* You may obtain a copy of the License at\r\n*\r\n*   http://www.apache.org/licenses/LICENSE-2.0\r\n*\r\n* Unless required by applicable law or agreed to in writing, software\r\n* distributed under the License is distributed on an \"AS IS\" BASIS,\r\n* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n* See the License for the specific language governing permissions and\r\n* limitations under the License.\r\n**/\r\n\r\n// Log System\r\n\r\nlet SyncherManager_log = loglevel[\"getLogger\"]('SyncherManager');\r\n\r\n\r\n//import { schemaValidation } from '../utils/schemaValidation';\r\n\r\n\r\n\r\n\r\n\r\n\r\n/**\r\n * @author micaelpedrosa@gmail.com\r\n * Core Syncronization system.\r\n */\r\nclass SyncherManager_SyncherManager {\r\n  /* private\r\n  _url: URL\r\n  _bus: MiniBus\r\n  _registry: Registry\r\n  _allocator: AddressAllocation\r\n\r\n  _reporters: { ObjectURL: ReporterObject }\r\n  _observers: { ObjectURL: ObserverObject }\r\n  */\r\n\r\n  constructor(runtimeURL, bus, registry, catalog, storageManager, allocator, storeDataObjects, identityModule) {\r\n    if (!runtimeURL) throw new Error('[Syncher Manager] - needs the runtimeURL parameter');\r\n    if (!bus) throw new Error('[Syncher Manager] - needs the MessageBus instance');\r\n    if (!registry) throw new Error('[Syncher Manager] - needs the Registry instance');\r\n    if (!catalog) throw new Error('[Syncher Manager] - needs the RuntimeCatalogue instance');\r\n    if (!storageManager) throw new Error('[Syncher Manager] - need the storageManager instance');\r\n\r\n    let _this = this;\r\n\r\n    _this._bus = bus;\r\n    _this._registry = registry;\r\n    _this._catalog = catalog;\r\n    _this._storageManager = storageManager;\r\n    _this._identityModule = identityModule;\r\n\r\n    //TODO: these should be saved in persistence engine?\r\n    _this.runtimeURL = runtimeURL;\r\n    _this._url = runtimeURL + '/sm';\r\n    _this._objectURL = runtimeURL + '/object-allocation';\r\n\r\n    _this._reporters = {};\r\n    _this._observers = {};\r\n\r\n    _this._dataObjectsStorage = storeDataObjects;\r\n    console.log('[NOTSAVING] storeDataObjects', storeDataObjects);\r\n    //TODO: this should not be hardcoded!\r\n    _this._domain = divideURL(runtimeURL).domain;\r\n\r\n    if (allocator) {\r\n      _this._allocator = allocator;\r\n    } else {\r\n      _this._allocator = allocation_AddressAllocation.instance;\r\n    }\r\n\r\n    SyncherManager_log.log('[SyncherManager - AddressAllocation] - ', _this._allocator);\r\n\r\n    bus.addListener(_this._url, (msg) => {\r\n      SyncherManager_log.info('[SyncherManager] RCV: ', msg);\r\n      switch (msg.type) {\r\n        case 'create': _this._onCreate(msg); break;\r\n        case 'delete': _this._onDelete(msg); break;\r\n        case 'subscribe': _this._onLocalSubscribe(msg); break;\r\n        case 'unsubscribe': _this._onLocalUnSubscribe(msg); break;\r\n        case 'read': _this._onRead(msg); break;\r\n        case 'execute': _this._onExecute(msg); break;\r\n      }\r\n    });\r\n\r\n  }\r\n\r\n  get url() { return this._url; }\r\n\r\n      //FLOW-IN: message received from Syncher -> read\r\n      _onExecute(msg) {\r\n\r\n        let _this = this;\r\n\r\n        let reply = {\r\n          type: 'response',\r\n          from: msg.to,\r\n          to: msg.from,\r\n          id: msg.id\r\n        }\r\n\r\n        SyncherManager_log.info('[SyncherManager.onExecute] new message', msg);\r\n\r\n        if (msg.hasOwnProperty('body') && msg.body.hasOwnProperty('method') && msg.body.hasOwnProperty('params')) {\r\n\r\n        switch (msg.body.method) {\r\n          case 'sync': _this._dataObjectsStorage.sync(msg.body.params[0], msg.body.params[1], false);\r\n           break;\r\n          case 'stopSync': _this._dataObjectsStorage.stopSync(msg.body.params[0]);\r\n           break;\r\n        }\r\n\r\n            reply.body = {\r\n              code: 200\r\n            };\r\n\r\n            _this._bus.postMessage(reply);\r\n          } else {\r\n          reply.body = {\r\n            code: 400,\r\n            desc: 'missing body or body method / params mandatory fields'\r\n          };\r\n\r\n          SyncherManager_log.error('[SyncherManager.onExecute] error. Missing body or body method / params mandatory fields', msg);\r\n\r\n          _this._bus.postMessage(reply);\r\n\r\n\r\n        }\r\n\r\n      }\r\n\r\n    //FLOW-IN: message received from Syncher -> read\r\n    _onRead(msg) {\r\n\r\n      let _this = this;\r\n\r\n      let reply = {\r\n        type: 'response',\r\n        from: msg.to,\r\n        to: msg.from,\r\n        id: msg.id\r\n      }\r\n      SyncherManager_log.info('[SyncherManager.onRead] new message', msg);\r\n\r\n      if (msg.hasOwnProperty('body') && msg.body.hasOwnProperty('resource')) {\r\n        _this._dataObjectsStorage.sync(msg.body.resource, true).then((dataObject)=>{\r\n          reply.body = {\r\n            code: 200,\r\n            value: dataObject\r\n          };\r\n\r\n          SyncherManager_log.info('[SyncherManager.onRead] found object: ', dataObject);\r\n\r\n          _this._bus.postMessage(reply);\r\n        }, (error)=>{\r\n          reply.body = {\r\n            code: 404,\r\n            desc: error\r\n          };\r\n\r\n          SyncherManager_log.warn('[SyncherManager.onRead] warning: ', error);\r\n\r\n          _this._bus.postMessage(reply);\r\n\r\n        });\r\n\r\n      } else {\r\n        reply.body = {\r\n          code: 400,\r\n          desc: 'missing body or body resource mandatory fields'\r\n        };\r\n\r\n        SyncherManager_log.error('[SyncherManager.onRead] error. Missing body or body resource mandatory fields', msg);\r\n\r\n        _this._bus.postMessage(reply);\r\n\r\n\r\n      }\r\n\r\n    }\r\n\r\n  //FLOW-IN: message received from Syncher -> create\r\n  _onCreate(msg) {\r\n\r\n    let from = msg.from;\r\n    let to = msg.to;\r\n    let _this = this;\r\n\r\n    // check if message is to save new childrenObjects in the local storage\r\n    // TODO: check if message is to store new child in the local storage and call storeChild. How to distinguish from others?\r\n\r\n    //debugger;\r\n    if (msg.body.attribute) { this._storeChildrens(msg); } else {\r\n\r\n      if (!msg.body.hasOwnProperty('resume') || (msg.body.hasOwnProperty('resume') && !msg.body.resume)) {\r\n\r\n        // check if this is an invitation message\r\n        if (msg.body.authorise) {\r\n          this._authorise(msg);\r\n          SyncherManager_log.info('[SyncherManager.onCreate - invite observers]', msg);\r\n        } else { // this is to create a new data object\r\n          SyncherManager_log.info('[SyncherManager.onCreate - Create New Object]', msg);\r\n          this._newCreate(msg);\r\n        }\r\n\r\n      } else {\r\n\r\n        // If from the hyperty side, call the resumeReporter we will have resume = true'\r\n        // so we will create an resumed object and will try to resume the object previously saved;\r\n        this._dataObjectsStorage.getResourcesByCriteria(msg, true).then((result) => {\r\n\r\n          SyncherManager_log.info('[SyncherManager - Create Resumed] - ResourcesByCriteria | Message: ', msg, ' result: ', result);\r\n\r\n          if (result && Object.keys(result).length > 0) {\r\n\r\n            let listOfReporters = [];\r\n\r\n            Object.keys(result).forEach((objURL) => {\r\n\r\n              listOfReporters.push(\r\n                  _this._resumeCreate(msg, result[objURL])\r\n                );\r\n            });\r\n\r\n            Promise.all(listOfReporters).then((resumedReporters) => {\r\n              SyncherManager_log.log('[SyncherManager - Create Resumed]', resumedReporters);\r\n\r\n              // TODO: shoud send the information if some object was failing;\r\n              let successfullyResumed = Object.values(resumedReporters).filter((reporter) => {\r\n                return reporter !== false;\r\n              });\r\n\r\n              SyncherManager_log.info('[SyncherManager.onCreate] returning resumed objects : ', successfullyResumed);\r\n\r\n              //FLOW-OUT: message response to Syncher -> create resume\r\n              this._bus.postMessage({\r\n                id: msg.id, type: 'response', from: to, to: from,\r\n                body: { code: 200, value: deepClone(successfullyResumed) }\r\n              });\r\n\r\n              /*successfullyResumed.forEach((reporter) => {\r\n                if (reporter.backup) {\r\n                  this._dataObjectsStorage.sync(reporter.url);\r\n                }\r\n              });*/\r\n\r\n            });\r\n\r\n          } else {\r\n            //forward to hyperty:\r\n            let reply = {};\r\n            reply.id = msg.id;\r\n            reply.from = msg.to;\r\n            reply.to = msg.from;\r\n            reply.type = 'response';\r\n            reply.body = {\r\n              code: 404,\r\n              desc: 'No data objects reporters to be resumed'\r\n            };\r\n            this._bus.postMessage(reply);\r\n          }\r\n\r\n        });\r\n      }\r\n    }\r\n\r\n  }\r\n\r\n  _storeChildrens(msg) {\r\n    let _this = this;\r\n\r\n    let resource = msg.body.resource;\r\n    let attribute = msg.body.attribute;\r\n\r\n    if (attribute === 'childrenObjects') {\r\n      _this._dataObjectsStorage.saveChildrens(false, resource, undefined, msg.body.value);\r\n    } else { _this._dataObjectsStorage.saveChildrens(true, resource, attribute, msg.body.value);\r\n       }\r\n\r\n  }\r\n\r\n  _newCreate(msg) {\r\n    let _this = this;\r\n\r\n    let owner = msg.from;\r\n    let domain = divideURL(msg.from).domain;\r\n\r\n    // if reporter is in a Interworking Protostub the runtime domain backend services will be used\r\n    if (_this._registry.isInterworkingProtoStub(msg.from)) {\r\n      domain = divideURL(_this.runtimeURL).domain;\r\n    }\r\n\r\n//    let domainRegistration = msg.body.value.hasOwnProperty('domain_registration') ? msg.body.value.domain_registration : true;\r\n    let domainRouting = msg.body.value.hasOwnProperty('domain_routing') ? msg.body.value.domain_routing : true;\r\n\r\n    // Process invitation message to observers\r\n\r\n    /*if (msg.body.authorise) {\r\n      _this._authorise(msg);\r\n      return;\r\n    }*/\r\n\r\n    //get schema from catalogue and parse -> (scheme, children)\r\n    _this._catalog.getDataSchemaDescriptor(msg.body.schema).then((descriptor) => {\r\n\r\n\r\n\r\n\r\n      let properties = descriptor.sourcePackage.sourceCode.properties;\r\n      let scheme = properties.scheme ? properties.scheme : 'resource';\r\n      let childrens = properties.childrens ? properties.childrens : [];\r\n\r\n      // Do schema validation\r\n      // TODO: check if is need to handle with the result of validation\r\n      //      schemaValidation(scheme, descriptor, msg.body.value);\r\n\r\n      let objectInfo = {\r\n        name: msg.body.value.name,\r\n        schema: msg.body.value.schema,\r\n        reporter: msg.body.value.reporter,\r\n        resources: msg.body.value.resources\r\n      };\r\n\r\n      // should resuse data object url if it passed\r\n      let reuseDataObject = msg.body.value.resource;\r\n      let numOfAddress = 1;\r\n\r\n      //debugger;\r\n      //request address allocation of a new object from the msg-node\r\n      //_this._allocator.create(domain, numOfAddress, objectInfo, scheme, reuseDataObject).then((allocated) => {\r\n      _this._allocator.create(domain, numOfAddress, objectInfo, scheme, reuseDataObject).then((allocated) => {\r\n\r\n        let objectRegistration = deepClone(msg.body.value);\r\n        objectRegistration.url = allocated.address[0];\r\n        objectRegistration.authorise = msg.body.authorise;\r\n        objectRegistration.childrens = childrens;\r\n\r\n        //objectRegistration.expires = 30;//TODO: get it from data object configuration description when present\r\n\r\n        delete objectRegistration.data;\r\n\r\n        SyncherManager_log.log('[SyncherManager._newCreate] ALLOCATOR CREATE:', allocated);\r\n\r\n        let subscriptionURL = objectRegistration.url + '/subscription';\r\n\r\n        SyncherManager_log.log('[SyncherManager._newCreate] Subscription URL', subscriptionURL);\r\n\r\n        //To register the dataObject in the runtimeRegistry\r\n        SyncherManager_log.info('[SyncherManager._newCreate] Register Object: ', objectRegistration);\r\n\r\n        //_this._registry.registerDataObject(msg.body.value.name, msg.body.value.schema, objURL, msg.body.value.reporter, msg.body.value.resources, allocated, msg.body.authorise).then((resolve) => {\r\n        _this._registry.registerDataObject(objectRegistration).then((registeredObject) => {\r\n          SyncherManager_log.log('[SyncherManager._newCreate] DataObject successfully registered', registeredObject);\r\n\r\n          //all OK -> create reporter and register listeners\r\n          let reporter;\r\n\r\n\r\n          if (!this._reporters[objectRegistration.url]) {\r\n            let offline = objectRegistration.offline ? objectRegistration.offline : false;\r\n            reporter = new syncher_ReporterObject(_this, owner, objectRegistration.url, childrens, offline);\r\n          } else {\r\n            reporter = this._reporters[objectRegistration.url];\r\n          }\r\n\r\n          SyncherManager_log.log('[SyncherManager - new Create] - ', msg);\r\n\r\n          // Store for each reporter hyperty the dataObject\r\n          let userURL;\r\n          // let interworking = false;\r\n\r\n          if (msg.body.hasOwnProperty('identity') && msg.body.identity.userProfile && msg.body.identity.userProfile.userURL) {\r\n            userURL = msg.body.identity.userProfile.userURL;\r\n\r\n            // if (!userURL.includes('user://')) {\r\n            //   interworking = true;\r\n            // }\r\n          } else {\r\n            userURL = _this._registry.getHypertyOwner(msg.from);\r\n\r\n            // if (!userURL) {\r\n            //   interworking = true;\r\n            // }\r\n          }\r\n\r\n          // should we use the msg.body.value instead?\r\n\r\n          let metadata = deepClone(objectRegistration);\r\n          metadata.subscriberUser = userURL;\r\n          metadata.isReporter = true;\r\n\r\n          // Store the dataObject information\r\n\r\n          //if (!interworking) {\r\n\r\n          if (msg.body.hasOwnProperty('store') && msg.body.store) {\r\n            reporter.isToSaveData = true;\r\n            metadata.isToSaveData = true;\r\n            if (msg.body.value.data) {\r\n              metadata.data = deepClone(msg.body.value.data);\r\n//              _this._dataObjectsStorage.saveData(true, objectRegistration.url, null, msg.body.value.data); }\r\n//            _this._dataObjectsStorage.update(true, objectRegistration.url, 'isToSaveData', true);\r\n\r\n//            if (msg.body.value.data) { _this._dataObjectsStorage.saveData(true, objectRegistration.url, null, msg.body.value.data); }\r\n            }\r\n          }\r\n          _this._dataObjectsStorage.set(metadata).then((storeObject) => {\r\n\r\n            if (metadata.offline) { //register new DataObject at Offline Subscription Manager\r\n              msg.body.identity.guid = _this._identityModule._identities.guid;\r\n              let forward = {\r\n                from: msg.to,\r\n                to: metadata.offline + '/register',\r\n                type: 'forward',\r\n                body: msg\r\n              };\r\n\r\n              forward.body.body.resource = objectRegistration.url;\r\n\r\n              forward.body.body.value = metadata;\r\n\r\n              SyncherManager_log.log('[SyncherManager.newCreate] registering new object at offline manager ', forward);\r\n\r\n              _this._bus.postMessage(forward);\r\n\r\n\r\n            }\r\n          //}\r\n          let responseMsg = {\r\n            id: msg.id, type: 'response', from: msg.to, to: owner,\r\n            body: { code: 200, resource: objectRegistration.url, childrenResources: childrens }\r\n          };\r\n\r\n          // adding listeners to forward to reporter\r\n\r\n          if (domainRouting) {\r\n\r\n            reporter.forwardSubscribe([objectRegistration.url, subscriptionURL]).then(() => {\r\n              reporter.addChildrens().then(() => {\r\n                _this._reporters[objectRegistration.url] = reporter;\r\n\r\n\r\n                //FLOW-OUT: message response to Syncher -> create\r\n                _this._bus.postMessage(responseMsg);\r\n\r\n              });\r\n            });\r\n          } else {\r\n            reporter.addChildrens().then(() => {\r\n              _this._reporters[objectRegistration.url] = reporter;\r\n\r\n\r\n              //FLOW-OUT: message response to Syncher -> create\r\n              _this._bus.postMessage(responseMsg);\r\n\r\n            });\r\n\r\n          }\r\n          }, (error)=> {\r\n            SyncherManager_log.error(error);\r\n          });\r\n\r\n\r\n        }, function (error) {\r\n          SyncherManager_log.error(error);\r\n        });\r\n\r\n      });\r\n    }).catch((reason) => {\r\n      //FLOW-OUT: error message response to Syncher -> create\r\n      let responseMsg = {\r\n        id: msg.id, type: 'response', from: msg.to, to: owner,\r\n        body: { code: 500, desc: reason }\r\n      };\r\n\r\n      _this._bus.postMessage(responseMsg);\r\n    });\r\n\r\n  }\r\n\r\n  _resumeCreate(msg, storedObject) {\r\n\r\n    let _this = this;\r\n\r\n    return new Promise((resolve) => {\r\n\r\n      let owner = msg.from;\r\n      let schema = storedObject.schema;\r\n      let resource = storedObject.url;\r\n      let domainRegistration = storedObject.hasOwnProperty('domain_registration') ? storedObject.domain_registration : true;\r\n      let initialData = storedObject.data;\r\n\r\n      SyncherManager_log.log('[SyncherManager] - resume create', msg, storedObject);\r\n\r\n      //get schema from catalogue and parse -> (scheme, children)\r\n      _this._catalog.getDataSchemaDescriptor(schema).then((descriptor) => {\r\n\r\n        let properties = descriptor.sourcePackage.sourceCode.properties;\r\n        let scheme = properties.scheme ? properties.scheme.constant : 'resource';\r\n        let childrens = properties.childrens ? properties.childrens : [];\r\n\r\n        SyncherManager_log.log('[SyncherManager] - getDataSchemaDescriptor: ', descriptor, childrens);\r\n\r\n        // Do schema validation\r\n        // TODO: check if is need to handle with the result of validation\r\n        //        schemaValidation(scheme, descriptor, initialData);\r\n\r\n\r\n        //all OK -> create reporter and register listeners\r\n        let reporter;\r\n        let offline;\r\n\r\n        if (!this._reporters[resource]) {\r\n          offline = storedObject.offline ? storedObject.offline : false;\r\n          reporter = new syncher_ReporterObject(_this, owner, resource, childrens, offline);\r\n        } else {\r\n          reporter = this._reporters[resource];\r\n        }\r\n\r\n        reporter.isToSaveData = storedObject.isToSaveData;\r\n\r\n        if (offline) { //update new DataObject at Offline Subscription Manager\r\n          let msg = {\r\n            from: _this._url,\r\n            to: offline + '/register',\r\n            type: 'update',\r\n            body: {}\r\n          };\r\n  \r\n          SyncherManager_log.log('[SyncherManager._resumeCreate] update object at offline manager ', msg);\r\n  \r\n          _this._bus.postMessage(msg);\r\n  \r\n  \r\n        }\r\n  \r\n\r\n        if (domainRegistration) {\r\n          reporter.forwardSubscribe([storedObject.url]).then(() => {\r\n            SyncherManager_log.log('[SyncherManager._resumeCreate] resumingReporterSubscription ', storedObject);\r\n            _this._resumeReporterSubscriptions(msg, storedObject, reporter, childrens, domainRegistration).then((resumeObject)=>{\r\n              SyncherManager_log.log('[SyncherManager._resumeCreate] resolved resumed object ', resumeObject);\r\n              resolve(resumeObject);\r\n            });\r\n        });\r\n      } else resolve(_this._resumeReporterSubscriptions(msg, storedObject, reporter, childrens, domainRegistration));\r\n\r\n        //  resolve();\r\n      }).catch((reason) => {\r\n        SyncherManager_log.error('[SyncherManager - resume create] - fail on getDataSchemaDescriptor: ', reason);\r\n        resolve(false);\r\n      });\r\n    });\r\n  }\r\n\r\n  _resumeReporterSubscriptions(msg, storedObject, reporter, childrens, domainRegistration){\r\n    let _this = this;\r\n    let resource = storedObject.url;\r\n    let objectRegistration = deepClone(msg.body.value);\r\n    objectRegistration.url = storedObject.url;\r\n    objectRegistration.expires = storedObject.expires;\r\n    objectRegistration.domain_registration = domainRegistration;\r\n\r\n    delete objectRegistration.data;\r\n\r\n    return new Promise((resolve) => {\r\n\r\n\r\n    reporter.addChildrens().then(() => {\r\n\r\n      reporter.resumeSubscriptions(storedObject.subscriptions);\r\n\r\n      _this._reporters[resource] = reporter;\r\n\r\n      SyncherManager_log.info('[SyncherManager - resume create] - resolved resumed: ', storedObject);\r\n\r\n      return _this._decryptChildrens(storedObject, childrens);\r\n    }).then((decryptedObject) => {\r\n\r\n      SyncherManager_log.info('[SyncherManager._resumeReporterSubscriptions] Register Object: ', objectRegistration);\r\n      _this._registry.registerDataObject(objectRegistration).then((registered) => {\r\n        SyncherManager_log.log('[SyncherManager._resumeReporterSubscriptions] DataObject registration successfully updated', registered);\r\n        SyncherManager_log.log('[SyncherManager._resumeReporterSubscriptions] resolving object', decryptedObject);\r\n        resolve(decryptedObject);\r\n\r\n      });\r\n\r\n      // log.log('result of previous promise');\r\n    }).catch((reason) => {\r\n      SyncherManager_log.error('[SyncherManager - resume create] - fail on addChildrens: ', reason);\r\n      resolve(false);\r\n    });\r\n  });\r\n\r\n  }\r\n\r\n  // to decrypt DataChildObjects if they are encrypted\r\n\r\n  _decryptChildrens(encryptedObject, childrens) {\r\n    let _this = this;\r\n\r\n    let storedObject = deepClone(encryptedObject);\r\n    return new Promise((resolve) => {\r\n\r\n      if (!childrens) { resolve(storedObject); } else {\r\n        let childrensObj = Object.keys(storedObject.childrenObjects);\r\n\r\n        if (childrensObj.length === 0) {\r\n          resolve(storedObject);\r\n        }\r\n\r\n        childrens.forEach((children) => {\r\n\r\n//          let childObjects = storedObject.childrenObjects[children];\r\n          let childObjects = storedObject.childrenObjects;\r\n\r\n          SyncherManager_log.log('[SyncherManager._decryptChildrens] dataObjectChilds to decrypt ', childObjects);\r\n\r\n          let listOfDecryptedObjects = [];\r\n\r\n          Object.keys(childObjects).forEach((childId) => {\r\n            let child = childObjects[childId];\r\n            let owner = childId.split('#')[0];\r\n\r\n            if (typeof child.value === 'string') {\r\n\r\n              SyncherManager_log.log('[SyncherManager._decryptChildrens] createdBy ', owner, ' object: ', child.value);\r\n\r\n              let decrypted = cryptoManager_CryptoManager.decryptDataObject(JSON.parse(child.value), storedObject.url);\r\n\r\n              listOfDecryptedObjects.push(decrypted);\r\n            }\r\n          });\r\n\r\n          Promise.all(listOfDecryptedObjects).then((decryptedObjects) => {\r\n\r\n            SyncherManager_log.log('[SyncherManager._decryptChildrens] returning decrypted ', decryptedObjects);\r\n\r\n            decryptedObjects.forEach((decryptedObject) => {\r\n              const childId = decryptedObject.value.url;\r\n              storedObject.childrenObjects[childId].value = decryptedObject.value;\r\n            });\r\n\r\n            SyncherManager_log.log('[SyncherManager._decryptChildrens] storedObject ', storedObject);\r\n\r\n            resolve(storedObject);\r\n\r\n          }).catch((reason) => {\r\n            SyncherManager_log.warn('[SyncherManager._decryptChildrens] failed : ', reason);\r\n          });\r\n        });\r\n      }\r\n    });\r\n  }\r\n\r\n  // Process invitations to observers\r\n\r\n  _authorise(msg) {\r\n    let _this = this;\r\n\r\n    if (!msg.body.resource) {\r\n      throw new Error('[SyncherManager._authorise] invitation request without data object url:', msg);\r\n    }\r\n\r\n    let objSubscriptorURL = msg.body.resource + '/subscription';\r\n    let p2p = msg.body.p2p ? msg.body.p2p : false;\r\n\r\n    SyncherManager_log.log('[SyncherManager -  authorise] - ', msg);\r\n\r\n    if (msg.body.authorise) {\r\n      msg.body.authorise.forEach((hypertyURL) => {\r\n        //FLOW-OUT: send invites to list of remote Syncher -> _onRemoteCreate -> onNotification\r\n\r\n        _this._bus.postMessage({\r\n          type: 'create', from: objSubscriptorURL, to: hypertyURL,\r\n          body: { p2p: p2p, identity: msg.body.identity, source: msg.from, value: msg.body.value, schema: msg.body.schema }\r\n        }, (reply) => { // lets forward the invitation response\r\n          let response = {\r\n            from: msg.to,\r\n            to: msg.from,\r\n            id: msg.id,\r\n            type: reply.type,\r\n            body: reply.body\r\n          };\r\n\r\n          _this._bus.postMessage(response);\r\n        });\r\n      });\r\n    }\r\n  }\r\n\r\n  //FLOW-IN: message received from DataObjectReporter -> delete\r\n  _onDelete(msg) {\r\n    let _this = this;\r\n\r\n    let objURL = msg.body.resource;\r\n\r\n    let object = _this._reporters[objURL];\r\n    if (object) {\r\n      //TODO: is there any policy verification before delete?\r\n\r\n      if (object.offline) { //register new DataObject at Offline Subscription Manager\r\n        let forward = {\r\n          from: msg.to,\r\n          to: object.offline + '/register',\r\n          type: 'forward',\r\n          body: msg\r\n        };\r\n\r\n        SyncherManager_log.log('[SyncherManager._onDelete] unregistering object from offline manager ', forward);\r\n\r\n        _this._bus.postMessage(forward);\r\n\r\n\r\n      }\r\n\r\n      object.delete();\r\n\r\n      this._dataObjectsStorage.deleteResource(objURL).then((result) => {\r\n\r\n\r\n        SyncherManager_log.log('[SyncherManager - onDelete] - deleteResource: ', result);\r\n\r\n        _this._registry.unregisterDataObject(objURL);\r\n\r\n\r\n        //TODO: unregister object?\r\n        _this._bus.postMessage({\r\n          id: msg.id, type: 'response', from: msg.to, to: msg.from,\r\n          body: { code: 200 }\r\n        });\r\n\r\n      });\r\n\r\n    }\r\n  }\r\n\r\n\r\n  //FLOW-IN: message received from local Syncher -> subscribe\r\n  _onLocalSubscribe(msg) {\r\n    //debugger;\r\n\r\n    if (msg.body.hasOwnProperty('resume') && (msg.body.resume )) {\r\n      this._dataObjectsStorage.getResourcesByCriteria(msg, false).then((result) => {\r\n\r\n        SyncherManager_log.info('[SyncherManager.onLocalSubscribe. resume]: ', msg, ' result: ', result);\r\n  \r\n        if (result && Object.keys(result).length > 0) {\r\n  \r\n          let listOfObservers = [];\r\n  \r\n          // TODO: should reuse the stored information\r\n          Object.keys(result).forEach((objURL) => {\r\n            SyncherManager_log.log('[SyncherManager - resume Subscribe] - reuse current object url: ', result[objURL]);\r\n            listOfObservers.push(this._resumeSubscription(msg, result[objURL]));\r\n          });\r\n  \r\n          Promise.all(listOfObservers).then((resumedObservers) => {\r\n            SyncherManager_log.log('[SyncherManager - Observers Resumed]', resumedObservers);\r\n  \r\n            // TODO: shoud send the information if some object is failing;\r\n            let successfullyResumed = Object.values(resumedObservers).filter((observer) => {\r\n              return observer !== false;\r\n            });\r\n  \r\n            let response = {\r\n              id: msg.id, type: 'response', from: msg.to, to: msg.from,\r\n              body: { code: 200, value: successfullyResumed }\r\n            };\r\n  \r\n            SyncherManager_log.log('[SyncherManager - Observers Resumed] replying ', response);\r\n  \r\n            //FLOW-OUT: message response to Syncher -> create\r\n            this._bus.postMessage(response);\r\n  \r\n          });\r\n  \r\n       \r\n        } else {\r\n          //forward to hyperty:\r\n          let reply = {};\r\n          reply.id = msg.id;\r\n          reply.from = msg.to;\r\n          reply.to = msg.from;\r\n          reply.type = 'response';\r\n          reply.body = {\r\n            code: 404,\r\n            desc: 'No data objects observers to be resumed'\r\n          };\r\n          this._bus.postMessage(reply);\r\n        }\r\n  \r\n      });\r\n    } else {\r\n      SyncherManager_log.log('[SyncherManager.onLocalSubscribe - new Subscribe] - ', msg.body.schema, msg.body.resource);\r\n      this._newSubscription(msg);\r\n    }\r\n \r\n\r\n  }\r\n\r\n  _newSubscription(msg) {\r\n    let _this = this;\r\n\r\n    let objURL = msg.body.resource;\r\n\r\n    let hypertyURL = msg.from;\r\n    let domain = divideURL(objURL).domain;\r\n    let domainSubscription = msg.body.hasOwnProperty('domain_subscription') ? msg.body.domain_subscription : true;\r\n\r\n    let childBaseURL = objURL + '/children/';\r\n\r\n    //get schema from catalogue and parse -> (children)\r\n    _this._catalog.getDataSchemaDescriptor(msg.body.schema).then((descriptor) => {\r\n      let properties = descriptor.sourcePackage.sourceCode.properties;\r\n      let childrens = properties.childrens ? properties.childrens : [];\r\n\r\n      let subscriptions = [];\r\n      subscriptions.push(objURL + '/changes');\r\n\r\n//      childrens.forEach((child) => subscriptions.push(childBaseURL + child));\r\n      subscriptions.push(childBaseURL);\r\n\r\n      //children addresses\r\n\r\n      if (domainSubscription) {  //FLOW-OUT: subscribe message to the msg-node, registering listeners on the broker\r\n      let nodeSubscribeMsg = {\r\n        type: 'subscribe', from: _this._url, to: 'domain://msg-node.' + domain + '/sm',\r\n        body: { identity: msg.body.identity, resources: subscriptions, source: hypertyURL }\r\n      };\r\n\r\n      //subscribe in msg-node\r\n      _this._bus.postMessage(nodeSubscribeMsg, (reply) => {\r\n        SyncherManager_log.log('node-subscribe-response(observer): ', reply);\r\n        console.log('REUSETEST SyncherManager - node-subscribe-response(observer): ', reply);\r\n        if (reply.body.code === 200) {\r\n          _this._newReporterSubscribe(msg, hypertyURL, objURL, childrens);\r\n        } else {\r\n          //listener rejected\r\n          _this._bus.postMessage({\r\n            id: msg.id, type: 'response', from: msg.to, to: hypertyURL,\r\n            body: reply.body\r\n          });\r\n        }\r\n      });\r\n    } else _this._newReporterSubscribe(msg, hypertyURL, objURL, childrens);\r\n\r\n\r\n    });\r\n\r\n  }\r\n\r\n  _newReporterSubscribe(msg, hypertyURL, objURL, childrens){\r\n\r\n    let _this = this;\r\n\r\n    let objURLSubscription = objURL + '/subscription';\r\n\r\n          //FLOW-OUT: reply with provisional response\r\n          _this._bus.postMessage({\r\n            id: msg.id, type: 'response', from: msg.to, to: hypertyURL,\r\n            body: { code: 100, childrenResources: childrens, schema: msg.body.schema, resource: msg.body.resource }\r\n          });\r\n\r\n          //FLOW-OUT: subscribe message to remote ReporterObject -> _onRemoteSubscribe\r\n          let objSubscribeMsg = {\r\n            type: 'subscribe', from: _this._url, to: objURLSubscription,\r\n            body: { identity: msg.body.identity, subscriber: hypertyURL }\r\n          };\r\n\r\n          //TODO: For Further Study\r\n          if (msg.body.hasOwnProperty('mutual')) objSubscribeMsg.body.mutual = msg.body.mutual;\r\n          SyncherManager_log.log('[SyncherManager._newSubscription]', objSubscribeMsg, msg);\r\n          console.log('REUSETEST SyncherManager - [SyncherManager._newSubscription]', objSubscribeMsg, msg);\r\n          //subscribe to reporter SM\r\n          _this._bus.postMessage(objSubscribeMsg, (reply) => {\r\n            SyncherManager_log.log('reporter-subscribe-response-new: ', reply);\r\n            console.log('REUSETEST SyncherManager - reporter-subscribe-response-new: ', reply);\r\n            if (reply.body.code === 200) _this._processSuccessfullSubscription(reply, hypertyURL, objURL, childrens, msg);\r\n            else if (msg.body.offline) _this._processOfflineSubscription(objSubscribeMsg, msg.body.offline, hypertyURL, objURL, childrens, msg);\r\n            else {\r\n              //TODO: send response back to Hyperty with error message received in the reply\r\n            }\r\n          });\r\n  }\r\n\r\n  _processOfflineSubscription(subscription, redirectTo, hypertyURL, objURL, childrens, msg) {\r\n    let _this = this;\r\n\r\n    let forward = {\r\n      from: subscription.from,\r\n      type: 'forward',\r\n      to: redirectTo,\r\n      body: subscription\r\n    };\r\n\r\n    console.log('[SyncherManager._processOfflineSubscription] forwading ', forward);\r\n\r\n    _this._bus.postMessage(forward, (reply) => {\r\n      SyncherManager_log.log('[SyncherManager._processOfflineSubscription] reply ', reply);\r\n      if (reply.body.code === 200) _this._processSuccessfullSubscription(reply, hypertyURL, objURL, childrens, msg);\r\n      else {\r\n        //TODO: send response back to Hyperty with error message received in the reply\r\n      }\r\n    });\r\n\r\n\r\n  }\r\n\r\n  _processSuccessfullSubscription(reply, hypertyURL, objURL, childrens, msg) {\r\n\r\n    let _this = this;\r\n\r\n    SyncherManager_log.log('[SyncherManager._newSubscription] - observers: ', _this._observers, objURL, _this._observers[objURL]);\r\n    console.log('REUSETEST SyncherManager - 200 code[SyncherManager._newSubscription] - observers: ', _this._observers, objURL, _this._observers[objURL]);\r\n    let observer = _this._observers[objURL];\r\n    if (!observer) {\r\n      observer = new syncher_ObserverObject(_this, objURL, childrens);\r\n      SyncherManager_log.log('[SyncherManager._newSubscription] - observers: create new ObserverObject: ', observer);\r\n      _this._observers[objURL] = observer;\r\n\r\n      // register new hyperty subscription\r\n      observer.addSubscription(hypertyURL);\r\n\r\n      // add childrens and listeners to save data if necessary\r\n      observer.addChildrens();\r\n    }\r\n\r\n    let interworking = false;\r\n\r\n    //debugger;\r\n\r\n    // Store for each reporter hyperty the dataObject\r\n    let userURL;\r\n    if (msg.body.hasOwnProperty('identity') && msg.body.identity.userProfile && msg.body.identity.userProfile.userURL) {\r\n      userURL = msg.body.identity.userProfile.userURL;\r\n      if (!userURL.includes('user://')) {\r\n        interworking = true;\r\n      }\r\n    } else {\r\n      userURL = _this._registry.getHypertyOwner(msg.from);\r\n      if (!userURL) interworking = true;\r\n    }\r\n\r\n    let metadata = deepClone(reply.body.value);\r\n\r\n    // let childrenObjects = metadata.childrenObjects || {};\r\n\r\n    delete metadata.data;\r\n    delete metadata.childrenObjects;\r\n\r\n    metadata.childrens = childrens;\r\n    metadata.subscriberUser = userURL;\r\n    metadata.isReporter = false;\r\n    metadata.subscriberHyperty = hypertyURL;\r\n\r\n    if (!interworking) {\r\n      //_this._dataObjectsStorage.set(objURL, false, msg.body.schema, 'on', reply.body.owner, hypertyURL, childrens, userURL);\r\n      _this._dataObjectsStorage.set(metadata);\r\n      if ((metadata.hasOwnProperty('store') && metadata.store) || (metadata.hasOwnProperty('isToSaveData') && metadata.isToSaveData)) {\r\n        observer.isToSaveData = true;\r\n        _this._dataObjectsStorage.update(false, objURL, 'isToSaveData', true);\r\n        _this._dataObjectsStorage.saveData(false, objURL, null, reply.body.value.data);\r\n//                  if (childrens) _this._dataObjectsStorage.initialObserverSync(objURL, reply.body.value.data.backupRevision);\r\n      }\r\n    }\r\n\r\n    //forward to hyperty:\r\n    reply.id = msg.id;\r\n    reply.from = _this._url;\r\n    reply.to = hypertyURL;\r\n    reply.body.schema = msg.body.schema;\r\n    reply.body.resource = msg.body.resource;\r\n\r\n    //TODO: For Further Study\r\n    if (msg.body.hasOwnProperty('mutual')) reply.body.mutual = msg.body.mutual;\r\n    SyncherManager_log.log('[subscribe] - new subscription: ', msg, reply, observer);\r\n\r\n    this._bus.postMessage(reply);\r\n\r\n  }\r\n\r\n  _resumeSubscription(msg, storedObject) {\r\n\r\n    return new Promise((resolve) => {\r\n\r\n      let objURL = storedObject.url;\r\n      let schema = storedObject.schema;\r\n\r\n      let hypertyURL = msg.from;\r\n\r\n      // let objURLSubscription = objURL + '/subscription';\r\n\r\n      let childBaseURL = objURL + '/children/';\r\n\r\n      SyncherManager_log.log('[SyncherManager - ReuseSubscription] - objURL: ', objURL, ' - schema:', schema);\r\n\r\n      //get schema from catalogue and parse -> (children)\r\n      // TODO: remove this since children resources should be available in the DataObjectsStorage\r\n      this._catalog.getDataSchemaDescriptor(schema).then((descriptor) => {\r\n        let properties = descriptor.sourcePackage.sourceCode.properties;\r\n        let childrens = properties.childrens ? properties.childrens : [];\r\n\r\n        //children addresses\r\n        let subscriptions = [];\r\n        subscriptions.push(objURL + '/changes');\r\n//        childrens.forEach((child) => subscriptions.push(childBaseURL + child));\r\n        subscriptions.push(childBaseURL);\r\n\r\n        //FLOW-OUT: reply with provisional response\r\n        this._bus.postMessage({\r\n          id: msg.id, type: 'response', from: msg.to, to: hypertyURL,\r\n          body: { code: 100, childrenResources: childrens, schema: schema, resource: objURL }\r\n        });\r\n\r\n        //FLOW-OUT: subscribe message to remote ReporterObject -> _onRemoteSubscribe\r\n        /*let objSubscribeMsg = {\r\n          type: 'subscribe', from: this._url, to: objURLSubscription,\r\n          body: { subscriber: hypertyURL, identity: msg.body.identity }\r\n        };\r\n\r\n        //subscribe to reporter SM\r\n        this._bus.postMessage(objSubscribeMsg, (reply) => {*/\r\n\r\n        let observer = this._observers[objURL];\r\n        if (!observer) {\r\n          observer = new syncher_ObserverObject(this, objURL, childrens);\r\n          observer.isToSaveData = storedObject.isToSaveData;\r\n          this._observers[objURL] = observer;\r\n        }\r\n\r\n        //register new hyperty subscription\r\n        observer.addSubscription(hypertyURL);\r\n        observer.addChildrens();\r\n\r\n        // Object.assign(storedObject.data, reply.body.value.data);\r\n        // Object.assign(storedObject.childrens, reply.body.value.childrens);\r\n\r\n        //log.log('[subscribe] - resume subscription: ', msg, reply, storedObject, observer);\r\n\r\n        return this._decryptChildrens(storedObject, childrens);\r\n      }).then((decryptedObject) => {\r\n        // log.log('result of previous promise');\r\n        resolve(decryptedObject);\r\n      }).catch((reason) => {\r\n        SyncherManager_log.error('[SyncherManager - resume subscription] - fail on getDataSchemaDescriptor: ', reason);\r\n        resolve(false);\r\n      });\r\n    });\r\n  }\r\n\r\n  //FLOW-IN: message received from local DataObjectObserver -> unsubscribe\r\n  _onLocalUnSubscribe(msg) {\r\n    let _this = this;\r\n\r\n    let hypertyURL = msg.from;\r\n    let objURL = msg.body.resource;\r\n\r\n    let observer = _this._observers[objURL];\r\n    if (observer) {\r\n      //TODO: is there any policy verification before delete?\r\n      observer.removeSubscription(msg);\r\n\r\n      //TODO: destroy object in the registry?\r\n      _this._bus.postMessage({\r\n        id: msg.id, type: 'response', from: msg.to, to: msg.from,\r\n        body: { code: 200 }\r\n      });\r\n\r\n      this._dataObjectsStorage.deleteResource(objURL);\r\n\r\n      //TODO: remove Object if no more subscription?\r\n      delete _this._observers[objURL];\r\n    }\r\n  }\r\n\r\n}\r\n\r\n/* harmony default export */ var syncher_SyncherManager = (SyncherManager_SyncherManager);\r\n\n// CONCATENATED MODULE: ./src/subscriptionManager/Subscription.js\n// Log System\r\n\r\nlet subscriptionManager_Subscription_log = loglevel[\"getLogger\"]('Subscription');\r\n\r\nclass Subscription_Subscription {\r\n\r\n  constructor(bus, subscriber, resource) {\r\n    let _this = this;\r\n    _this._subscriber = subscriber;\r\n    _this.resource = resource;\r\n\r\n    subscriptionManager_Subscription_log.log('[SubscriptionManager.Subscription] new: ', subscriber, resource)\r\n\r\n    //add forward\r\n    _this._listener = bus.addForward(resource, subscriber);\r\n\r\n  }\r\n\r\n  _releaseListeners() {\r\n    let _this = this;\r\n\r\n    _this._listener.remove();\r\n\r\n  }\r\n\r\n}\r\n\r\n/* harmony default export */ var subscriptionManager_Subscription = (Subscription_Subscription);\r\n\n// CONCATENATED MODULE: ./src/subscriptionManager/SubscriptionManager.js\n/**\r\n* Copyright 2016 PT Inovação e Sistemas SA\r\n* Copyright 2016 INESC-ID\r\n* Copyright 2016 QUOBIS NETWORKS SL\r\n* Copyright 2016 FRAUNHOFER-GESELLSCHAFT ZUR FOERDERUNG DER ANGEWANDTEN FORSCHUNG E.V\r\n* Copyright 2016 ORANGE SA\r\n* Copyright 2016 Deutsche Telekom AG\r\n* Copyright 2016 Apizee\r\n* Copyright 2016 TECHNISCHE UNIVERSITAT BERLIN\r\n*\r\n* Licensed under the Apache License, Version 2.0 (the \"License\");\r\n* you may not use this file except in compliance with the License.\r\n* You may obtain a copy of the License at\r\n*\r\n*   http://www.apache.org/licenses/LICENSE-2.0\r\n*\r\n* Unless required by applicable law or agreed to in writing, software\r\n* distributed under the License is distributed on an \"AS IS\" BASIS,\r\n* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n* See the License for the specific language governing permissions and\r\n* limitations under the License.\r\n**/\r\n\r\n// Log System\r\n\r\nlet SubscriptionManager_log = loglevel[\"getLogger\"]('SubscriptionManager');\r\n\r\n\r\n\r\n\r\n\r\n/**\r\n * @author paulo-g-chainho@alticelabs.com\r\n * Subscription Manager used to manage routing paths at the runtime.\r\n */\r\n\r\nclass SubscriptionManager_SubscriptionManager {\r\n\r\n  constructor(runtimeURL, bus, storage) {\r\n    if (!runtimeURL) throw new Error('[SubscriptionManager] - needs the runtimeURL parameter');\r\n    if (!bus) throw new Error('[SubscriptionManager] - needs the MessageBus instance');\r\n\r\n    let _this = this;\r\n\r\n    _this._bus = bus;\r\n    _this._storage = storage;\r\n\r\n    _this._subscriptions = {};\r\n\r\n    _this._subscriptionsStorage = {};\r\n\r\n    //TODO: these should be saved in persistence engine?\r\n    _this.runtimeURL = runtimeURL;\r\n    _this._url = runtimeURL + '/subscriptions';\r\n\r\n    //TODO: this should not be hardcoded!\r\n    _this._domain = divideURL(runtimeURL).domain;\r\n\r\n    bus.addListener(_this._url, (msg) => {\r\n      SubscriptionManager_log.info('[SubscriptionManager] RCV: ', msg);\r\n      switch (msg.type) {\r\n        case 'subscribe': _this._onSubscribe(msg); break;\r\n        case 'unsubscribe': _this._onUnSubscribe(msg); break;\r\n        case 'read': _this._onRead(msg); break;\r\n      }\r\n    });\r\n\r\n  }\r\n\r\n  init() {\r\n    let _this = this;\r\n\r\n    return new Promise((resolve) => {\r\n\r\n      _this._storage.get('subscriptions').then((subscriptions) => {\r\n        SubscriptionManager_log.log('[SubscriptionManager.init] resume subscriptions: ', subscriptions);\r\n        if (subscriptions) {\r\n\r\n          _this._subscriptionsStorage = subscriptions;\r\n\r\n          Object.values(subscriptions).forEach((subscription)=>{\r\n            _this.createSubscription(subscription.domain, subscription.resources, subscription.subscriber, subscription.identity);\r\n\r\n          });\r\n\r\n        }\r\n        resolve();\r\n      });\r\n\r\n    });\r\n\r\n\r\n  }\r\n\r\n  get url() { return this._url; }\r\n\r\n\r\n  //message received to set a routing path\r\n  _onSubscribe(msg) {\r\n\r\n    let _this = this;\r\n\r\n    let resources = msg.body.resources;\r\n\r\n    let subscriber = msg.from;\r\n    let domain = divideURL(resources[0]).domain; //we are assuming resources are all from the same domain\r\n\r\n    let identity = msg.body.identity;\r\n\r\n    _this.createSubscription(domain, resources, subscriber, identity).then((reply)=>{\r\n      //forward to hyperty:\r\n      reply.id = msg.id;\r\n      reply.from = _this._url;\r\n      reply.to = subscriber;\r\n      reply.body = msg.body;\r\n      reply.body.code = 200;\r\n\r\n      SubscriptionManager_log.log('[SubscriptionManager] - craeteSubscription: ', msg, reply, subscriber);\r\n\r\n      _this._bus.postMessage(reply);\r\n\r\n\r\n      if (!_this._subscriptionsStorage[subscriber]) {\r\n\r\n\r\n        _this._subscriptionsStorage[subscriber] = {\r\n          domain: domain,\r\n          resources: resources,\r\n          subscriber: subscriber,\r\n          identity: identity\r\n        };\r\n\r\n      } else {\r\n        resources.forEach((resource) => {\r\n          if (!(_this._subscriptionsStorage[subscriber].resources.includes(resource))) {\r\n            _this._subscriptionsStorage[subscriber].resources.push(resource);\r\n          }\r\n        });\r\n      }\r\n\r\n      _this._storage.set('subscriptions', 1, _this._subscriptionsStorage);\r\n    });\r\n  }\r\n\r\n  createSubscription(domain, resources, subscriber, identity) {\r\n\r\n    let _this = this;\r\n    //debugger;\r\n    return new Promise((resolve) => {\r\n      //FLOW-OUT: subscribe message to the msg-node, registering listeners on the broker\r\n\r\n      let nodeSubscribeMsg = {\r\n        type: 'subscribe', from: _this._url, to: 'domain://msg-node.' + domain + '/sm',\r\n        body: { identity: identity, resources: resources, source: subscriber }\r\n      };\r\n\r\n      //subscribe in msg-node\r\n      _this._bus.postMessage(nodeSubscribeMsg, (reply) => {\r\n        SubscriptionManager_log.log('[SubscriptionManager] node-subscribe-response: ', reply);\r\n\r\n        //if (reply.body.code === 200) {//TODO: uncomment when  MN replies with correct response body code\r\n\r\n        //TODO: support multiple routes for multiple resources\r\n\r\n        let subscription = _this._subscriptions[subscriber];\r\n        SubscriptionManager_log.log('[SubscriptionManager] - ',  _this._subscriptions, resources, _this._subscriptions.hasOwnProperty(subscriber));\r\n        if (!subscription) {\r\n          _this._subscriptions[subscriber] = {};\r\n        }\r\n\r\n        resources.forEach((resource)=>{\r\n          _this._subscriptions[subscriber][resource] = new subscriptionManager_Subscription(_this._bus, subscriber, resource);\r\n        });\r\n\r\n        resolve(reply);\r\n\r\n      });\r\n\r\n    });\r\n  }\r\n\r\n\r\n  // message received to remove routing path\r\n  _onUnSubscribe(msg) {\r\n    let _this = this;\r\n\r\n    let unsubscriber = msg.from;\r\n    let resource = msg.body.resource;\r\n\r\n    if (_this._subscriptions[unsubscriber] && _this._subscriptions[unsubscriber][resource]) {\r\n      let domain = divideURL(resource).domain;\r\n      let subscription = _this._subscriptions[unsubscriber][resource];\r\n\r\n      //FLOW-OUT: message sent to msg-node SubscriptionManager component\r\n      _this._bus.postMessage({\r\n        type: 'unsubscribe', from: _this._url, to: 'domain://msg-node.' + domain + '/sm',\r\n        body: { resources: [resource], source: unsubscriber }\r\n      });\r\n\r\n      subscription._releaseListeners();\r\n      delete _this._subscriptions[unsubscriber][resource];\r\n\r\n      if (_this._subscriptionsStorage[unsubscriber]) {\r\n        let i = _this._subscriptionsStorage[unsubscriber].resources.indexOf(resource);\r\n        if (i != -1) {\r\n          _this._subscriptionsStorage[unsubscriber].resources.splice(i, 1);\r\n        }\r\n        _this._storage.set('subscriptions', 1, _this._subscriptionsStorage);\r\n      }\r\n    }\r\n\r\n    _this._bus.postMessage({\r\n      id: msg.id, type: 'response', from: msg.to, to: msg.from,\r\n      body: { code: 200 }\r\n    });\r\n\r\n  }\r\n\r\n  //message received to read existing routing paths. At this point limited to read all existing routing paths set for one listener\r\n  _onRead(msg) {\r\n\r\n    let _this = this;\r\n\r\n    let listenerAddress = msg.body.resource;\r\n    let reply;\r\n\r\n    SubscriptionManager_log.log('[SubscriptionManager] - request to read Subscriptions: ', msg);\r\n\r\n    _this._storage.get('subscriptions').then((subscriptions)=>{\r\n      if (subscriptions && subscriptions[listenerAddress]) {\r\n        let resources = subscriptions[listenerAddress].resources;\r\n\r\n        reply = {\r\n          id: msg.id, type: 'response', from: msg.to, to: msg.from,\r\n          body: { code: 200, value: resources }\r\n        };\r\n\r\n      } else {\r\n        reply = {\r\n          id: msg.id, type: 'response', from: msg.to, to: msg.from,\r\n          body: { code: 404, description: 'Not Found' }\r\n        };\r\n      }\r\n      _this._bus.postMessage(reply);\r\n    });\r\n  }\r\n}\r\n\r\n/* harmony default export */ var subscriptionManager_SubscriptionManager = (SubscriptionManager_SubscriptionManager);\r\n\n// CONCATENATED MODULE: ./src/policy/ReThinkCtx.js\n\r\n\r\nclass ReThinkCtx_ReThinkCtx {\r\n\r\n  constructor() {\r\n    this.defaultBehaviour = true;\r\n    this.groups = {};\r\n  }\r\n\r\n  get scheme() {\r\n    return this._scheme;\r\n  }\r\n\r\n  get date() {\r\n    return this._date;\r\n  }\r\n\r\n  get domain() {\r\n    return this._domain;\r\n  }\r\n\r\n  get type() {\r\n    return this._type;\r\n  }\r\n\r\n  get source() {\r\n    return this._source;\r\n  }\r\n\r\n  get time() {\r\n    return this._time;\r\n  }\r\n\r\n  get weekday() {\r\n    return this._weekday;\r\n  }\r\n\r\n  set scheme(params) {\r\n    let from = params.message.from;\r\n    if (isDataObjectURL(from)) {\r\n      this._scheme = divideURL(from).type;\r\n    } else {\r\n      this._scheme = undefined;\r\n    }\r\n  }\r\n\r\n  set date(now) {\r\n    let date = new Date();\r\n    let day = String(date.getDate());\r\n    if (day.length === 1) {\r\n      day = '0' + day;\r\n    }\r\n    let month = String(date.getMonth() + 1);\r\n    if (month.length === 1) {\r\n      month = '0' + month;\r\n    }\r\n    this._date = day + '/' + month + '/' + date.getFullYear();\r\n  }\r\n\r\n  set domain(params) {\r\n    if (params.message.body.identity !== undefined) {\r\n      this._domain = divideEmail(params.message.body.identity.userProfile.username).domain;\r\n    }\r\n  }\r\n\r\n  set type(params) {\r\n    let message = params.message;\r\n    if (message.body.value !== undefined) {\r\n      this._type = message.body.value.resourceType;\r\n    }\r\n  }\r\n\r\n  set source(params) {\r\n    if (params.message.body.identity !== undefined) {\r\n      this._source = params.message.body.identity.userProfile.username;\r\n    }\r\n  }\r\n\r\n  set time(now) {\r\n    now = new Date();\r\n    let minutes = String(now.getMinutes());\r\n    if (minutes.length === 1) {\r\n      minutes = '0' + minutes;\r\n    }\r\n    this._time = parseInt(String(now.getHours()) + minutes);\r\n  }\r\n\r\n  set weekday(now) {\r\n    this._weekday = String(new Date().getDay());\r\n  }\r\n\r\n}\r\n\r\n/* harmony default export */ var policy_ReThinkCtx = (ReThinkCtx_ReThinkCtx);\r\n\n// CONCATENATED MODULE: ./src/policy/context/RuntimeCoreCtx.js\n\r\nlet RuntimeCoreCtx_log = loglevel[\"getLogger\"]('PEP');\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nclass RuntimeCoreCtx_RuntimeCoreCtx extends policy_ReThinkCtx {\r\n\r\n  constructor(runtimeURL, idModule, runtimeRegistry, storageManager, runtimeCapabilities) {\r\n    super();\r\n    this._runtimeURL = runtimeURL;\r\n    this._pepURL = this._runtimeURL + '/pep';\r\n    this._guiURL = this._runtimeURL + '/policy-gui';\r\n    this.idModule = idModule;\r\n    this.runtimeRegistry = runtimeRegistry;\r\n    this.activeUserPolicy = undefined;\r\n    this.serviceProviderPolicy = {};\r\n    this.userPolicies = {};\r\n    this.storageManager = storageManager;\r\n    this.runtimeCapabilities = runtimeCapabilities;\r\n  }\r\n\r\n  get pepURL() {\r\n    let _this = this;\r\n    return _this._pepURL;\r\n  }\r\n\r\n  get guiURL() {\r\n    let _this = this;\r\n    return _this._guiURL;\r\n  }\r\n\r\n  get runtimeURL() {\r\n    let _this = this;\r\n    return _this._runtimeURL;\r\n  }\r\n\r\n  /**\r\n  * return the messageBus in this Registry\r\n  * @param {MessageBus}           messageBus\r\n  */\r\n  get messageBus() {\r\n    let _this = this;\r\n    return _this._messageBus;\r\n  }\r\n\r\n  /**\r\n  * Set the messageBus in this Registry\r\n  * @param {MessageBus}           messageBus\r\n  */\r\n  set messageBus(messageBus) {\r\n    let _this = this;\r\n    _this._messageBus = messageBus;\r\n  }\r\n\r\n  get subscription() {\r\n    return this._subscription;\r\n  }\r\n\r\n  set subscription(params) {\r\n    this._subscription = params.message.body.subscriber;\r\n  }\r\n\r\n  loadConfigurations() {\r\n    let _this = this;\r\n\r\n    return new Promise((resolve, reject) => {\r\n\r\n      console.log(_this.storageManager);\r\n\r\n      _this.storageManager.get('rethink:activePolicy').then((value) => {\r\n        _this.activeUserPolicy = value;\r\n\r\n        return _this.storageManager.get('rethink:groups');\r\n      }).then((groupInfo) => {\r\n        let groups = groupInfo;\r\n        _this.groups = (groups === undefined) ? {} : groups;\r\n\r\n        return _this.storageManager.get('rethink:spPolicies');\r\n      }).then((policiesInfo) => {\r\n        let spPolicies = policiesInfo;\r\n        _this.serviceProviderPolicy = (spPolicies === undefined) ? {} : spPolicies;\r\n\r\n        _this._loadUserPolicies().then(() => {\r\n          resolve();\r\n        });\r\n      });\r\n    });\r\n  }\r\n\r\n\r\n  getPolicies(message, isIncomingMessage) {\r\n    let policies = {};\r\n\r\n    if (this.activeUserPolicy !== undefined) {\r\n      policies.userPolicy = this.userPolicies[this.activeUserPolicy];\r\n    }\r\n\r\n    policies.serviceProviderPolicy = this.getServiceProviderPolicy(message, isIncomingMessage);\r\n\r\n    return policies;\r\n  }\r\n\r\n  _isValidUpdate(message) {\r\n    let _this = this;\r\n    return new Promise((resolve, reject) => {\r\n      if (message.from.split('://').length > 1) {\r\n        _this.idModule._getHypertyFromDataObject(message.from).then(hypertyURL => {\r\n          if (hypertyURL === message.body.source) {\r\n            resolve(message);\r\n          } else {\r\n            reject('The source of the message is not valid.');\r\n          }\r\n        }, (error) => {\r\n          reject(error);\r\n        });\r\n      } else {\r\n        resolve(message);\r\n      }\r\n    });\r\n  }\r\n\r\n\r\n\r\n  getMyEmails() {\r\n    let identities = this.idModule.getIdentities();\r\n    let emails = [];\r\n\r\n    for (let i in identities) {\r\n      emails.push(getUserEmailFromURL(identities[i].identity));\r\n    }\r\n\r\n    return emails;\r\n  }\r\n\r\n  getMyHyperties() {\r\n    let hyperties = this.runtimeRegistry.hypertiesList;\r\n    let hypertiesNames = [];\r\n\r\n    for (let i in hyperties) {\r\n      let hypertyName = hyperties[i].objectName;\r\n      if (hypertiesNames.indexOf(hypertyName) === -1) {\r\n        hypertiesNames.push(hypertyName);\r\n      }\r\n    }\r\n\r\n    return hypertiesNames;\r\n  }\r\n\r\n  getServiceProviderPolicy(message, isIncoming) {\r\n    let policy;\r\n\r\n    if (isIncoming) {\r\n      let toHyperty = this.runtimeRegistry.getHypertyName(message.to);\r\n      policy = this.serviceProviderPolicy[toHyperty];\r\n    } else {\r\n      let fromHyperty = this.runtimeRegistry.getHypertyName(message.from);\r\n      policy = this.serviceProviderPolicy[fromHyperty];\r\n    }\r\n    return policy;\r\n  }\r\n\r\n\r\n  getURL(url) {\r\n    let splitURL = url.split('/');\r\n    return splitURL[0] + '//' + splitURL[2] + '/' + splitURL[3];\r\n  }\r\n\r\n\r\n  /**\r\n  * Creates a group with the given name.\r\n  * @param  {String}  groupName\r\n  */\r\n  _loadUserPolicies() {\r\n    let _this = this;\r\n\r\n    return new Promise((resolve, reject) => {\r\n\r\n      _this.storageManager.get('rethink:userPolicies').then((value) => {\r\n        let policies = value;\r\n        if (policies !== undefined) {\r\n          for (let i in policies) {\r\n            this.pep.addPolicy('USER', i, policies[i]);\r\n          }\r\n        }\r\n        resolve();\r\n      });\r\n    });\r\n\r\n  }\r\n\r\n  _getLastComponentOfURL(url) {\r\n    let split = url.split('/');\r\n    return split[split.length - 1];\r\n  }\r\n\r\n  _getPoliciesJSON(policies) {\r\n    for (let i in policies) {\r\n      let combiningAlgorithm = policies[i].combiningAlgorithm;\r\n      if (combiningAlgorithm instanceof combiningAlgorithms_BlockOverrides) {\r\n        policies[i].combiningAlgorithm = 'blockOverrides';\r\n      } else {\r\n        if (combiningAlgorithm instanceof combiningAlgorithms_AllowOverrides) {\r\n          policies[i].combiningAlgorithm = 'allowOverrides';\r\n        } else {\r\n          if (combiningAlgorithm instanceof combiningAlgorithms_FirstApplicable) {\r\n            policies[i].combiningAlgorithm = 'firstApplicable';\r\n          } else {\r\n            policies[i].combiningAlgorithm = undefined;\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    return policies;\r\n  }\r\n\r\n  saveActivePolicy() {\r\n    let _this = this;\r\n\r\n    return new Promise((resolve, reject) => {\r\n      _this.storageManager.set('rethink:activePolicy', 0, this.activeUserPolicy).then(() => {\r\n        resolve();\r\n      });\r\n    });\r\n  }\r\n\r\n  saveGroups() {\r\n    let _this = this;\r\n\r\n    return new Promise((resolve, reject) => {\r\n      _this.storageManager.set('rethink:groups', 0, this.groups).then(() => {\r\n        resolve();\r\n      });\r\n    });\r\n  }\r\n\r\n  savePolicies(source, policy, key) {\r\n    let policiesJson;\r\n\r\n    switch (source) {\r\n      case 'USER':\r\n        policiesJson = JSON.stringify(this.userPolicies);\r\n        policiesJson = this._getPoliciesJSON(JSON.parse(policiesJson));\r\n        this.storageManager.set('rethink:userPolicies', 0, policiesJson);\r\n        break;\r\n      case 'SERVICE_PROVIDER':\r\n        if (policy !== undefined & key !== undefined) {\r\n          this.serviceProviderPolicy[key] = policy;\r\n        }\r\n        policiesJson = JSON.stringify(this.serviceProviderPolicy);\r\n        policiesJson = this._getPoliciesJSON(JSON.parse(policiesJson));\r\n        this.storageManager.set('rethink:spPolicies', 0, policiesJson);\r\n        break;\r\n      default:\r\n        throw Error('Unknown policy source: ' + source);\r\n    }\r\n  }\r\n\r\n  getGroupsNames() {\r\n    let myGroups = this.groups;\r\n    let groupsNames = [];\r\n    if (myGroups !== undefined) {\r\n      for (let groupName in myGroups) {\r\n        groupsNames.push(groupName);\r\n      }\r\n    }\r\n    return groupsNames;\r\n  }\r\n\r\n  getGroup(groupName, destination) {\r\n    let members = [];\r\n\r\n    if (groupName === 'preauthorised') {\r\n      let dataObjectURL = destination.split('/');\r\n      dataObjectURL.pop();\r\n      dataObjectURL = dataObjectURL[0] + '//' + dataObjectURL[2];\r\n      members = this.runtimeRegistry.getPreAuthSubscribers(dataObjectURL);\r\n    } else {\r\n      if (this.groups[groupName] !== undefined) {\r\n        members = this.groups[groupName];\r\n      }\r\n    }\r\n\r\n    return members;\r\n  }\r\n\r\n  /**\r\n  * Creates a group with the given name.\r\n  * @param  {String}  groupName\r\n  */\r\n  createGroup(groupName) {\r\n    this.groups[groupName] = [];\r\n    this.saveGroups();\r\n  }\r\n\r\n  deleteGroup(groupName) {\r\n    delete this.groups[groupName];\r\n    this.saveGroups();\r\n  }\r\n\r\n  /**\r\n  * Adds the given user email to the group with the given name.\r\n  * @param  {String}  userEmail\r\n  * @param  {String}  groupName\r\n  */\r\n  addToGroup(groupName, userEmail) {\r\n    let myGroups = this.groups;\r\n    if (myGroups[groupName] !== undefined) {\r\n      if (myGroups[groupName].indexOf(userEmail) === -1) {\r\n        myGroups[groupName].push(userEmail);\r\n        this.saveGroups();\r\n      }\r\n    } else {\r\n      throw Error('Group \"' + groupName + '\" does not exist!');\r\n    }\r\n  }\r\n\r\n  removeFromGroup(groupName, userEmail) {\r\n    let group = this.groups[groupName];\r\n\r\n    group.splice(group.indexOf(userEmail), 1);\r\n    this.saveGroups();\r\n  }\r\n\r\n}\r\n\r\n/* harmony default export */ var context_RuntimeCoreCtx = (RuntimeCoreCtx_RuntimeCoreCtx);\r\n\n// EXTERNAL MODULE: ./node_modules/tv4/tv4.js\nvar tv4 = __webpack_require__(90);\nvar tv4_default = /*#__PURE__*/__webpack_require__.n(tv4);\n\n// CONCATENATED MODULE: ./src/runtime-catalogue/RethinkObject.js\n/**\r\n * Copyright 2016 PT Inovação e Sistemas SA\r\n * Copyright 2016 INESC-ID\r\n * Copyright 2016 QUOBIS NETWORKS SL\r\n * Copyright 2016 FRAUNHOFER-GESELLSCHAFT ZUR FOERDERUNG DER ANGEWANDTEN FORSCHUNG E.V\r\n * Copyright 2016 ORANGE SA\r\n * Copyright 2016 Deutsche Telekom AG\r\n * Copyright 2016 Apizee\r\n * Copyright 2016 TECHNISCHE UNIVERSITAT BERLIN\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n **/\r\n\r\n\r\nclass RethinkObject_RethinkObject {\r\n\r\n    /**\r\n     * Validates this RethinkObject against the provided schema.\r\n     *\r\n     * LIMITATIONS: The provided schema cannot contain references to other schemas, since they can't be resolved.\r\n     * @param schema - schema to validate against\r\n     * @returns {boolean} true if valid, false otherwise\r\n     */\r\n    validate(schema) {\r\n        // add schema itself so local references work\r\n        tv4_default.a.addSchema(schema.id, schema);\r\n\r\n        // JSON stringify -> parse needed to have proper validation\r\n        let result = tv4_default.a.validateMultiple(JSON.parse(JSON.stringify(this)), schema);\r\n\r\n        // delete error stacks to improve logging\r\n        result.errors.forEach((error) => {\r\n            delete error.stack;\r\n        });\r\n\r\n        // print more details about validation if it fails or schema contains $refs\r\n        if (!result.valid || (result.missing.length > 0)) {\r\n            console.warn(\"Object validation \" + (result.valid ? \"succeeded, but schema contained references:\" : \"failed:\"), JSON.stringify(result, null, 2));\r\n            console.log(\"Object:\", JSON.stringify(this, null, 2));\r\n        }\r\n        return result.valid;\r\n    }\r\n}\r\n\r\n\r\n/* harmony default export */ var runtime_catalogue_RethinkObject = (RethinkObject_RethinkObject);\r\n\r\n\n// CONCATENATED MODULE: ./src/runtime-catalogue/CatalogueDataObject.js\n/**\r\n * Copyright 2016 PT Inovação e Sistemas SA\r\n * Copyright 2016 INESC-ID\r\n * Copyright 2016 QUOBIS NETWORKS SL\r\n * Copyright 2016 FRAUNHOFER-GESELLSCHAFT ZUR FOERDERUNG DER ANGEWANDTEN FORSCHUNG E.V\r\n * Copyright 2016 ORANGE SA\r\n * Copyright 2016 Deutsche Telekom AG\r\n * Copyright 2016 Apizee\r\n * Copyright 2016 TECHNISCHE UNIVERSITAT BERLIN\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n **/\r\n\r\n\r\n/**\r\n * @author alice.cheambe[at]fokus.fraunhofer.de\r\n * The CatalogueDataObject class is the representation of the reTHINK Catalogue Data Model\r\n */\r\nclass CatalogueDataObject_CatalogueDataObject extends runtime_catalogue_RethinkObject {\r\n    /**\r\n     * Creates the Catalogue Data Object\r\n     * @param guid - Global Unique identifier of the Catalogue Object (e.g. Hyperty descriptor, ProtocolStub descriptor,\r\n     * etc) enabling the same object to be stored and discovered in different Catalogues. That means, guid corresponds to\r\n     * [resource-type-id] per BNF of Resource Path. Couldn't we have problems with too long URL paths?\r\n     * @param type - indicates the type of Catalogue Data Object e.g. Hyperty, ProtocolStub, etc\r\n     * @param {string} version - Indicates the version of Catalogue Data\r\n     * @param objectName - human-understandable name of the catalogue object e.g. \"My Awesome Hyperty\"\r\n     * @param description - description of the source package\r\n     * @param language - the programming language used in the SourcePackage.SourceCode\r\n     * @param sourcePackageURL - A string containing the URL from where the source code package of the corresponding\r\n     * catalogue object, e.g. deployable packages containing executable code for Hyperties or ProtoStubs, can be downloaded\r\n     */\r\n    constructor(guid, type, version, objectName, description, language, sourcePackageURL) {\r\n        super();\r\n        this._guid = guid;\r\n        this._type = type;\r\n        this._version = version;\r\n        this._objectName = objectName;\r\n        this._description = description;\r\n        this._language = language;\r\n        this._sourcePackageURL = sourcePackageURL;\r\n\r\n        this._signature = null;\r\n        this._sourcePackage = null;\r\n    }\r\n\r\n    // Getters\r\n    get guid() {\r\n        return this._guid;\r\n    }\r\n\r\n    get type() {\r\n        return this._type;\r\n    }\r\n\r\n    get version() {\r\n        return this._version;\r\n    }\r\n\r\n    get objectName() {\r\n        return this._objectName;\r\n    }\r\n\r\n    get description() {\r\n        return this._description;\r\n    }\r\n\r\n    get language() {\r\n        return this._language;\r\n    }\r\n\r\n    get signature() {\r\n        return this._signature;\r\n    }\r\n\r\n    get sourcePackage() {\r\n        return this._sourcePackage;\r\n    }\r\n\r\n    get sourcePackageURL() {\r\n        return this._sourcePackageURL;\r\n    }\r\n\r\n\r\n    // Setters\r\n    /**\r\n     * Set the signature to enables integrity and authenticity verification\r\n     * @param signature\r\n     */\r\n    set signature(signature) {\r\n        if (signature)\r\n            this._signature = signature;\r\n    }\r\n\r\n    set sourcePackage(sourcePackage) {\r\n        if (sourcePackage)\r\n            this._sourcePackage = sourcePackage;\r\n    }\r\n\r\n    set guid(guid) {\r\n        if (guid)\r\n            this._guid = guid;\r\n    }\r\n\r\n    set type(type) {\r\n        if (type)\r\n            this._type = type;\r\n    }\r\n\r\n    set version(version) {\r\n        if (version) {\r\n            this._version = version;\r\n        }\r\n    }\r\n\r\n    set objectName(objectName) {\r\n        if (objectName)\r\n            this._objectName = objectName;\r\n    }\r\n\r\n    set description(description) {\r\n        if (description)\r\n            this._description = description;\r\n    }\r\n\r\n    set language(language) {\r\n        if (language)\r\n            this._language = language;\r\n    }\r\n\r\n    set sourcePackageURL(sourcePackageURL) {\r\n        if (sourcePackageURL)\r\n            this._sourcePackageURL = sourcePackageURL;\r\n    }\r\n}\r\n//Alice: removed POLICY_ENFORCER: 'policy_enforcer', DATA_SCHEMA: 'data_schema' from the list\r\n//wrt: https://github.com/reTHINK-project/dev-service-framework/blob/develop/docs/datamodel/core/hyperty-catalogue/readme.md#data-object-schema\r\nconst CatalogueObjectType = {\r\n    HYPERTY: 'hyperty', PROTOSTUB: 'protostub', HYPERTY_RUNTIME: 'hyperty_runtime',\r\n    HYPERTY_INTERCEPTOR: 'hyperty_inspector', HYPERTY_DATA_OBJECT: 'hyperty_data_object'\r\n};\r\nconst DataObjectSourceLanguage = {\r\n    JAVASCRIPT_ECMA6: 'javascript_ecma6', JAVASCRIPT_ECMA5: 'javascript_ecma5',\r\n    JSON_SCHEMA_V4: 'json_schema_v4', PYTHON: 'python', TYPESCRIPT: 'typescript'\r\n};\r\n/* harmony default export */ var runtime_catalogue_CatalogueDataObject = (CatalogueDataObject_CatalogueDataObject);\n// CONCATENATED MODULE: ./src/runtime-catalogue/SourcePackage.js\n/**\r\n* Copyright 2016 PT Inovação e Sistemas SA\r\n* Copyright 2016 INESC-ID\r\n* Copyright 2016 QUOBIS NETWORKS SL\r\n* Copyright 2016 FRAUNHOFER-GESELLSCHAFT ZUR FOERDERUNG DER ANGEWANDTEN FORSCHUNG E.V\r\n* Copyright 2016 ORANGE SA\r\n* Copyright 2016 Deutsche Telekom AG\r\n* Copyright 2016 Apizee\r\n* Copyright 2016 TECHNISCHE UNIVERSITAT BERLIN\r\n*\r\n* Licensed under the Apache License, Version 2.0 (the \"License\");\r\n* you may not use this file except in compliance with the License.\r\n* You may obtain a copy of the License at\r\n*\r\n*   http://www.apache.org/licenses/LICENSE-2.0\r\n*\r\n* Unless required by applicable law or agreed to in writing, software\r\n* distributed under the License is distributed on an \"AS IS\" BASIS,\r\n* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n* See the License for the specific language governing permissions and\r\n* limitations under the License.\r\n**/\r\n\r\n/**\r\n * Created by amo on 14/11/2015.\r\n */\r\nclass SourcePackage {\r\n    constructor(sourceCodeClassname, sourceCode) {\r\n        this._sourceCode = sourceCode;\r\n        this._sourceCodeClassname = sourceCodeClassname;\r\n\r\n        this._encoding = null;\r\n        this._signature = null;\r\n    }\r\n\r\n    get sourceCode() {\r\n        return this._sourceCode;\r\n    }\r\n\r\n    get sourceCodeClassname() {\r\n        return this._sourceCodeClassname;\r\n    }\r\n\r\n    get encoding() {\r\n        return this._encoding;\r\n    }\r\n\r\n    get signature() {\r\n        return this._signature;\r\n    }\r\n\r\n    set encoding(encoding) {\r\n        if (encoding)\r\n            this._encoding = encoding;\r\n    }\r\n\r\n    set signature(sign) {\r\n        if (sign)\r\n            this._signature = sign;\r\n    }\r\n\r\n    set sourceCode(sourceCode) {\r\n        if (sourceCode)\r\n            this._sourceCode = sourceCode;\r\n    }\r\n\r\n    set sourceCodeClassname(sourceCodeClassname) {\r\n        if (sourceCodeClassname)\r\n            this._sourceCodeClassname = sourceCodeClassname;\r\n    }\r\n}\r\n\r\n/* harmony default export */ var runtime_catalogue_SourcePackage = (SourcePackage);\r\n\n// CONCATENATED MODULE: ./src/runtime-catalogue/HypertyDescriptor.js\n/**\r\n* Copyright 2016 PT Inovação e Sistemas SA\r\n* Copyright 2016 INESC-ID\r\n* Copyright 2016 QUOBIS NETWORKS SL\r\n* Copyright 2016 FRAUNHOFER-GESELLSCHAFT ZUR FOERDERUNG DER ANGEWANDTEN FORSCHUNG E.V\r\n* Copyright 2016 ORANGE SA\r\n* Copyright 2016 Deutsche Telekom AG\r\n* Copyright 2016 Apizee\r\n* Copyright 2016 TECHNISCHE UNIVERSITAT BERLIN\r\n*\r\n* Licensed under the Apache License, Version 2.0 (the \"License\");\r\n* you may not use this file except in compliance with the License.\r\n* You may obtain a copy of the License at\r\n*\r\n*   http://www.apache.org/licenses/LICENSE-2.0\r\n*\r\n* Unless required by applicable law or agreed to in writing, software\r\n* distributed under the License is distributed on an \"AS IS\" BASIS,\r\n* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n* See the License for the specific language governing permissions and\r\n* limitations under the License.\r\n**/\r\n\r\n/**\r\n * Created by amo on 14/11/2015.\r\n */\r\n\r\n\r\nclass HypertyDescriptor_HypertyDescriptor extends runtime_catalogue_CatalogueDataObject {\r\n\r\n    /**\r\n     *\r\n     * @param {string} guid - Catalogue Global Unique identifier of the Catalogue Object enabling the same object to be\r\n     * stored and discovered in different Catalogues. Guid corresponds to <resource-type-id> per BNF of Resource Path.\r\n     * @param {CatalogueObjectType} catalogueType - \tIndicates the type of Catalogue Data Object\r\n     * @param {string} version\r\n     * @param {string} objectName\r\n     * @param {string} description\r\n     * @param {string} language\r\n     * @param {string} sourcePackageURL\r\n     * @param {HypertyResourceType[]} hypertyType A tag that identifies what type of hyperty is described in the object.\r\n     * @param {URL.HypertyCatalogueURLList} dataObjectUrls - It defines the Data Object Schemas supported by the Hyperty\r\n     * through a list of Catalogue URLs from where these schemas can be reached\r\n     */\r\n    constructor(guid, catalogueType, version, objectName, description, language, sourcePackageURL, hypertyType, dataObjectUrls) {\r\n        super(guid, catalogueType, version, objectName, description, language, sourcePackageURL);\r\n\r\n        this._configuration = {};\r\n        this._constraints = {};\r\n        this._policies = {};\r\n        this._messageSchema = null;\r\n\r\n        this._hypertyType = hypertyType;\r\n        this._dataObjects = dataObjectUrls;\r\n    }\r\n\r\n    get hypertyType() {\r\n        return this._hypertyType;\r\n    }\r\n\r\n    get dataObjects() {\r\n        return this._dataObjects;\r\n    }\r\n\r\n    get configuration() {\r\n        return this._configuration;\r\n    }\r\n\r\n    get constraints() {\r\n        return this._constraints;\r\n    }\r\n\r\n    get messageSchema() {\r\n        return this._messageSchema;\r\n    }\r\n\r\n    get policies() {\r\n        return this._policies;\r\n    }\r\n\r\n    set hypertyType(hType) {\r\n        if (hType)\r\n            this._hypertyType = hType;\r\n    }\r\n\r\n    set dataObjects(dataObjects) {\r\n        if (dataObjects)\r\n            this._dataObjects = dataObjects;\r\n    }\r\n\r\n    set configuration(configuration) {\r\n        if (configuration)\r\n            this._configuration = configuration;\r\n    }\r\n\r\n    set constraints(constraints) {\r\n        if (constraints)\r\n            this._constraints = constraints;\r\n    }\r\n\r\n    set messageSchema(messageSchema) {\r\n        if (messageSchema)\r\n            this._messageSchema = messageSchema;\r\n    }\r\n\r\n    set policies(policies) {\r\n        if (policies)\r\n            this._policies = policies;\r\n    }\r\n\r\n}\r\n\r\n\r\nconst RuntimeHypertyCapabilityType = {};\r\nconst HypertyType = {COMMUNICATOR: 'communicator', IDENTITY: 'identity', CONTEXT: 'context'};\r\nconst HypertyResourceType = {chat: 'CHAT', audio: 'Audio', video: 'Video', av: 'AV', screen:'SCREEN',\r\n    file: 'FILe', midi:'MIDI'};\r\n/* harmony default export */ var runtime_catalogue_HypertyDescriptor = (HypertyDescriptor_HypertyDescriptor);\n// CONCATENATED MODULE: ./src/runtime-catalogue/ProtocolStubDescriptor.js\n/**\r\n * Copyright 2016 PT Inovação e Sistemas SA\r\n * Copyright 2016 INESC-ID\r\n * Copyright 2016 QUOBIS NETWORKS SL\r\n * Copyright 2016 FRAUNHOFER-GESELLSCHAFT ZUR FOERDERUNG DER ANGEWANDTEN FORSCHUNG E.V\r\n * Copyright 2016 ORANGE SA\r\n * Copyright 2016 Deutsche Telekom AG\r\n * Copyright 2016 Apizee\r\n * Copyright 2016 TECHNISCHE UNIVERSITAT BERLIN\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n **/\r\n\r\n/**\r\n * Created by amo on 14/11/2015.\r\n */\r\n\r\n\r\n\r\nclass ProtocolStubDescriptor_ProtocolStubDescriptor extends runtime_catalogue_CatalogueDataObject {\r\n    constructor(guid, type, version, objectName, description, language, sourcePackageURL, messageSchemas, configuration,\r\n                constraints, hypertyType, dataObjects, interworking, idpProxy, mutualAuthentication) {\r\n        super(guid, type, version, objectName, description, language, sourcePackageURL);\r\n\r\n        this._messageSchemas = messageSchemas;\r\n\r\n        if (configuration)\r\n            this._configuration = configuration;\r\n        else\r\n            this._configuration = {};\r\n\r\n        if (constraints)\r\n            this._constraints = constraints;\r\n        else\r\n            this._constraints = {};\r\n\r\n        this._hypertyType = hypertyType;\r\n\r\n        if (dataObjects)\r\n            this._dataObjects = dataObjects;\r\n        else\r\n            this._dataObjects = [];\r\n        \r\n        this._interworking = interworking;\r\n        this._idpProxy = idpProxy;\r\n        this._mutualAuthentication = mutualAuthentication;\r\n\r\n    }\r\n\r\n    get messageSchemas() {\r\n        return this._messageSchemas;\r\n    }\r\n\r\n    get constraints() {\r\n        return this._constraints;\r\n    }\r\n\r\n    get configuration() {\r\n        return this._configuration;\r\n    }\r\n\r\n    set messageSchemas(messageSchemas) {\r\n        if (messageSchemas)\r\n            this._messageSchemas = messageSchemas;\r\n    }\r\n\r\n    set constraints(constraints) {\r\n        if (constraints)\r\n            this._constraints = constraints;\r\n    }\r\n\r\n    set configuration(configuration) {\r\n        if (configuration)\r\n            this._configuration = configuration;\r\n    }\r\n\r\n    get hypertyType() {\r\n        return this._hypertyType;\r\n    }\r\n\r\n    set hypertyType(value) {\r\n        this._hypertyType = value;\r\n    }\r\n\r\n    get dataObjects() {\r\n        return this._dataObjects;\r\n    }\r\n\r\n    set dataObjects(value) {\r\n        this._dataObjects = value;\r\n    }\r\n\r\n    get interworking() {\r\n        return this._interworking;\r\n    }\r\n\r\n    set interworking(value) {\r\n        this._interworking = value;\r\n    }\r\n\r\n    get idpProxy() {\r\n        return this._idpProxy;\r\n    }\r\n\r\n    set idpProxy(value) {\r\n        this._idpProxy = value;\r\n    }\r\n\r\n    get mutualAuthentication() {\r\n        return this._mutualAuthentication;\r\n    }\r\n\r\n    set mutualAuthentication(value) {\r\n        this._mutualAuthentication = value;\r\n    }\r\n}\r\n\r\n/* harmony default export */ var runtime_catalogue_ProtocolStubDescriptor = (ProtocolStubDescriptor_ProtocolStubDescriptor);\n// CONCATENATED MODULE: ./src/runtime-catalogue/HypertyRuntimeDescriptor.js\n/**\r\n * Copyright 2016 PT Inovação e Sistemas SA\r\n * Copyright 2016 INESC-ID\r\n * Copyright 2016 QUOBIS NETWORKS SL\r\n * Copyright 2016 FRAUNHOFER-GESELLSCHAFT ZUR FOERDERUNG DER ANGEWANDTEN FORSCHUNG E.V\r\n * Copyright 2016 ORANGE SA\r\n * Copyright 2016 Deutsche Telekom AG\r\n * Copyright 2016 Apizee\r\n * Copyright 2016 TECHNISCHE UNIVERSITAT BERLIN\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n **/\r\n\r\n/**\r\n * Created by amo on 14/11/2015.\r\n */\r\n\r\n\r\n\r\nclass HypertyRuntimeDescriptor_HypertyRuntimeDescriptor extends runtime_catalogue_CatalogueDataObject {\r\n\r\n    constructor(guid, catalogueType, version, objectName, description, language, sourcePackageURL, runtimeType,\r\n                hypertyCapabilities, protocolCapabilities, p2pHandlerStub, p2pRequesterStub) {\r\n        super(guid, catalogueType, version, objectName, description, language, sourcePackageURL);\r\n\r\n        this._runtimeType = runtimeType;\r\n\r\n        if (hypertyCapabilities)\r\n            this._hypertyCapabilities = hypertyCapabilities;\r\n        else\r\n            this._hypertyCapabilities = new RuntimeHypertyCapability(true, false, false, false, false);\r\n        if (protocolCapabilities)\r\n            this._protocolCapabilities = protocolCapabilities;\r\n        else\r\n            this._protocolCapabilities = new RuntimeProtocolCapability(true, false, true, false, false, false);\r\n\r\n        this._p2pHandlerStub = p2pHandlerStub;\r\n        this._p2pRequesterStub = p2pRequesterStub;\r\n    }\r\n\r\n    get runtimeType() {\r\n        return this._runtimeType;\r\n    }\r\n\r\n    get hypertyCapabilities() {\r\n        return this._hypertyCapabilities;\r\n    }\r\n\r\n    get protocolCapabilities() {\r\n        return this._hypertyCapabilities;\r\n    }\r\n\r\n    set runtimeType(runtimeType) {\r\n        if (runtimeType)\r\n            this._runtimeType = runtimeType;\r\n    }\r\n\r\n    set hypertyCapabilities(hypertyCapabilities) {\r\n        if (hypertyCapabilities)\r\n            this._hypertyCapabilities = hypertyCapabilities;\r\n    }\r\n\r\n    set protocolCapabilities(protocolCapabilities) {\r\n        if (protocolCapabilities)\r\n            this._protocolCapabilities = protocolCapabilities;\r\n    }\r\n\r\n    get p2pHandlerStub() {\r\n        return this._p2pHandlerStub;\r\n    }\r\n\r\n    set p2pHandlerStub(value) {\r\n        this._p2pHandlerStub = value;\r\n    }\r\n\r\n    get p2pRequesterStub() {\r\n        return this._p2pRequesterStub;\r\n    }\r\n\r\n    set p2pRequesterStub(value) {\r\n        this._p2pRequesterStub = value;\r\n    }\r\n}\r\n\r\n/**\r\n * A class representation of the capability set of the Runtime Hyperty\r\n */\r\nclass RuntimeHypertyCapability {\r\n    /**\r\n     * Creates an object of the Runtime Hyperty capability set\r\n     * @param {boolean} isWebRTCSupported\r\n     * @param {boolean} isMicSupported\r\n     * @param {boolean} isCameraSupported\r\n     * @param {boolean} isSensorSupported\r\n     * @param {boolean} isORTCSupported\r\n     */\r\n    constructor(isWebRTCSupported, isMicSupported, isCameraSupported, isSensorSupported, isORTCSupported) {\r\n        this._isWebRTC = isWebRTCSupported;\r\n        this._isMic = isMicSupported;\r\n        this._isCamera = isCameraSupported;\r\n        this._isSensor = isSensorSupported;\r\n        this._isORTC = isORTCSupported;\r\n    }\r\n\r\n    get isMic() {\r\n        return this._isMic;\r\n    }\r\n\r\n    get isCamera() {\r\n        return this._isCamera;\r\n    }\r\n\r\n    get isSensor() {\r\n        return this._isSensor;\r\n    }\r\n\r\n    get isWebRTC() {\r\n        return this._isWebRTC;\r\n    }\r\n\r\n    get isORTCS() {\r\n        return this._isORTC;\r\n    }\r\n\r\n    getCapabilitySet() {\r\n        return JSON.stringify(this);\r\n    }\r\n}\r\n\r\n\r\n/**\r\n * A class representation of the protocol capability set of the Runtime Hyperty\r\n */\r\nclass RuntimeProtocolCapability {\r\n\r\n    /**\r\n     * Creates an object of the runtime protocol capability\r\n     * @param {boolean} isHttp\r\n     * @param {boolean} isHttps\r\n     * @param {boolean} isWS\r\n     * @param {boolean} isWSS\r\n     * @param {boolean} isCoap\r\n     * @param {boolean} isDataChannel\r\n     */\r\n    constructor(isHttp, isHttps, isWS, isWSS, isCoap, isDataChannel) {\r\n        this._isHttp = isHttp;\r\n        this._isHttps = isHttps;\r\n        this._isWS = isWS;\r\n        this._isWSS = isWSS;\r\n        this._isCoap = isCoap;\r\n        this._isDataChannel = isDataChannel;\r\n    }\r\n\r\n    isHttp() {\r\n        return this._isHttp;\r\n    }\r\n\r\n    isHttps() {\r\n        return this._isHttps;\r\n    }\r\n\r\n    isWS() {\r\n        return this._isWS;\r\n    }\r\n\r\n    isSensorSupported() {\r\n        return this._isSensor;\r\n    }\r\n\r\n    isWSS() {\r\n        return this._isWSS;\r\n    }\r\n\r\n    isCoap() {\r\n        return this._isCoap;\r\n    }\r\n\r\n    isDataChannel() {\r\n        return this._isDataChannel;\r\n    }\r\n\r\n\r\n    getCapabilitySet() {\r\n        return JSON.stringify(this);\r\n    }\r\n}\r\n\r\nconst RuntimeType = {BROWSER: 'browser', STANDALONE: 'standalone', SERVER: 'server', GATEWAY: 'gateway'};\r\n\r\n/* harmony default export */ var runtime_catalogue_HypertyRuntimeDescriptor = (HypertyRuntimeDescriptor_HypertyRuntimeDescriptor);\r\n\n// CONCATENATED MODULE: ./src/runtime-catalogue/HypertyInterceptorDescriptor.js\n/**\r\n* Copyright 2016 PT Inovação e Sistemas SA\r\n* Copyright 2016 INESC-ID\r\n* Copyright 2016 QUOBIS NETWORKS SL\r\n* Copyright 2016 FRAUNHOFER-GESELLSCHAFT ZUR FOERDERUNG DER ANGEWANDTEN FORSCHUNG E.V\r\n* Copyright 2016 ORANGE SA\r\n* Copyright 2016 Deutsche Telekom AG\r\n* Copyright 2016 Apizee\r\n* Copyright 2016 TECHNISCHE UNIVERSITAT BERLIN\r\n*\r\n* Licensed under the Apache License, Version 2.0 (the \"License\");\r\n* you may not use this file except in compliance with the License.\r\n* You may obtain a copy of the License at\r\n*\r\n*   http://www.apache.org/licenses/LICENSE-2.0\r\n*\r\n* Unless required by applicable law or agreed to in writing, software\r\n* distributed under the License is distributed on an \"AS IS\" BASIS,\r\n* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n* See the License for the specific language governing permissions and\r\n* limitations under the License.\r\n**/\r\n\r\n/**\r\n * Created by pzu on 19.11.15.\r\n */\r\n\r\n\r\nclass HypertyInterceptorDescriptor_PolicyEnforcerDescriptor extends runtime_catalogue_CatalogueDataObject {\r\n    constructor(guid, type, version, objectName, description, language, sourcePackageURL, configuration, policies) {\r\n        super(guid, type, version, objectName, description, language, sourcePackageURL);\r\n\r\n        this._configuration = configuration;\r\n        this._policies = policies;\r\n    }\r\n\r\n    get configuration() {\r\n        return this._configuration;\r\n    }\r\n\r\n    get policies() {\r\n        return this._policies;\r\n    }\r\n\r\n    set policies(policies) {\r\n        this._policies = policies;\r\n    }\r\n\r\n    set configuration(configuration) {\r\n        this._configuration = configuration;\r\n    }\r\n}\r\n\r\n/* harmony default export */ var HypertyInterceptorDescriptor = (HypertyInterceptorDescriptor_PolicyEnforcerDescriptor);\n// CONCATENATED MODULE: ./src/runtime-catalogue/DataObjectSchema.js\n/**\r\n* Copyright 2016 PT Inovação e Sistemas SA\r\n* Copyright 2016 INESC-ID\r\n* Copyright 2016 QUOBIS NETWORKS SL\r\n* Copyright 2016 FRAUNHOFER-GESELLSCHAFT ZUR FOERDERUNG DER ANGEWANDTEN FORSCHUNG E.V\r\n* Copyright 2016 ORANGE SA\r\n* Copyright 2016 Deutsche Telekom AG\r\n* Copyright 2016 Apizee\r\n* Copyright 2016 TECHNISCHE UNIVERSITAT BERLIN\r\n*\r\n* Licensed under the Apache License, Version 2.0 (the \"License\");\r\n* you may not use this file except in compliance with the License.\r\n* You may obtain a copy of the License at\r\n*\r\n*   http://www.apache.org/licenses/LICENSE-2.0\r\n*\r\n* Unless required by applicable law or agreed to in writing, software\r\n* distributed under the License is distributed on an \"AS IS\" BASIS,\r\n* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n* See the License for the specific language governing permissions and\r\n* limitations under the License.\r\n**/\r\n\r\n/**\r\n * Created by pzu on 19.11.15.\r\n */\r\n\r\n\r\n\r\nclass DataObjectSchema_DataObjectSchema extends runtime_catalogue_CatalogueDataObject {\r\n    constructor(guid, type, version, objectName, description, language, sourcePackageURL) {\r\n        super(guid, type, version, objectName, description, language, sourcePackageURL);\r\n    }\r\n\r\n}\r\n\r\n\r\n//Children\r\nclass MessageDataObjectSchema extends DataObjectSchema_DataObjectSchema {\r\n    constructor(guid, type, version, objectName, description, language, sourcePackageURL) {\r\n        super(guid, type, version, objectName, description, language, sourcePackageURL);\r\n    }\r\n}\r\n\r\nclass HypertyDataObjectSchema extends DataObjectSchema_DataObjectSchema {\r\n    constructor(guid, type, version, objectName, description, language, sourcePackageURL, accessControlPolicy, dataUrlScheme) {\r\n        super(guid, type, version, objectName, description, language, sourcePackageURL);\r\n        this._accessControlPolicy = accessControlPolicy;\r\n        this._scheme = dataUrlScheme;\r\n    }\r\n}\r\n\r\n//Children\r\nclass CommunicationDataObjectSchema extends HypertyDataObjectSchema {\r\n    constructor(guid, type, version, objectName, description, language, sourcePackageURL, accessControlPolicy) {\r\n        super(guid, type, version, objectName, description, language, sourcePackageURL, accessControlPolicy);\r\n    }\r\n}\r\n\r\nclass ConnectionDataObjectSchema extends HypertyDataObjectSchema {\r\n    constructor(guid, type, version, objectName, description, language, sourcePackageURL, accessControlPolicy) {\r\n        super(guid, type, version, objectName, description, language, sourcePackageURL, accessControlPolicy);\r\n    }\r\n}\r\n\r\nclass IdentityDataObjectSchema extends HypertyDataObjectSchema {\r\n    constructor(guid, type, version, objectName, description, language, sourcePackageURL, accessControlPolicy) {\r\n        super(guid, type, version, objectName, description, language, sourcePackageURL, accessControlPolicy);\r\n    }\r\n}\r\n\r\nclass ContextDataObjectSchema extends HypertyDataObjectSchema {\r\n    constructor(guid, type, version, objectName, description, language, sourcePackageURL, accessControlPolicy) {\r\n        super(guid, type, version, objectName, description, language, sourcePackageURL, accessControlPolicy);\r\n    }\r\n}\r\n\r\nconst DataUrlScheme = {\r\n    COMM: 'COMM', CONNECTION: 'CONNECTION', CTXT: 'CTXT', IDENTITY: 'IDENTITY'\r\n};\r\n\r\n/* harmony default export */ var runtime_catalogue_DataObjectSchema = (DataObjectSchema_DataObjectSchema);\n// CONCATENATED MODULE: ./src/runtime-catalogue/CatalogueDataObjectFactory.js\n/**\r\n * Copyright 2016 PT Inovação e Sistemas SA\r\n * Copyright 2016 INESC-ID\r\n * Copyright 2016 QUOBIS NETWORKS SL\r\n * Copyright 2016 FRAUNHOFER-GESELLSCHAFT ZUR FOERDERUNG DER ANGEWANDTEN FORSCHUNG E.V\r\n * Copyright 2016 ORANGE SA\r\n * Copyright 2016 Deutsche Telekom AG\r\n * Copyright 2016 Apizee\r\n * Copyright 2016 TECHNISCHE UNIVERSITAT BERLIN\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n **/\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nclass CatalogueDataObjectFactory_CatalogueDataObjectFactory {\r\n\r\n    /**\r\n     * Create CatalogueDataObject\r\n     * @param {string} guid - Catalogue Global Unique identifier of the Catalogue Object\r\n     * @param {CatalogueObjectType} type - Indicates the type of Catalogue Data Object\r\n     * @param {string} version - Indicates the version of Catalogue Data\r\n     * @param {string} objectName - Human-understandable name of the catalogue object\r\n     * @param {string} description\r\n     * @param {DataObjectSourceLanguage} language - Programming language used in the SourcePackage\r\n     * @param {string} sourcePackageURL - URL from where the source code package of the corresponding catalogue object can be downloaded.\r\n     * @returns {CatalogueDataObject}\r\n     */\r\n    createCatalogueDataObject(guid, type, version, objectName, description, language, sourcePackageURL) {\r\n        if (\r\n            typeof guid === \"undefined\"\r\n            || typeof type === \"undefined\"\r\n            || typeof version === \"undefined\"\r\n            || typeof objectName === \"undefined\"\r\n            || typeof description === \"undefined\"\r\n            || typeof language === \"undefined\"\r\n            || typeof sourcePackageURL === \"undefined\"\r\n        )\r\n            throw new Error(\"Invalid parameters!\");\r\n        return new runtime_catalogue_CatalogueDataObject(guid, type, version, objectName, description, language, sourcePackageURL);\r\n    }\r\n\r\n    /**\r\n     * Create HypertyDescriptor\r\n     * @param {string} guid - Catalogue Global Unique identifier of the Catalogue Object\r\n     * @param {string} version - Indicates the version of Catalogue Data\r\n     * @param {string} objectName - Human-understandable name of the catalogue object\r\n     * @param {string} description\r\n     * @param {DataObjectSourceLanguage} language - Programming language used in the SourcePackage\r\n     * @param {string} sourcePackageURL - URL from where the source code package of the corresponding catalogue object\r\n     * can be downloaded.\r\n     * @param {HypertyResourceType[]} hypertyType - An array of HypertyResourceType that identifies what type of hyperty\r\n     * resources are handled by the object.\r\n     * @param {URL.URLList} dataObjects - Defines the Data Object Schemas supported by the Hyperty through a list of Catalogue URLs from where these schemas can be reached.\r\n     * @returns {HypertyDescriptor}\r\n     */\r\n    createHypertyDescriptorObject(guid, version, objectName, description, language, sourcePackageURL, hypertyType,\r\n                                  dataObjects) {\r\n        if (\r\n            typeof guid === \"undefined\"\r\n            || typeof version === \"undefined\"\r\n            || typeof objectName === \"undefined\"\r\n            || typeof description === \"undefined\"\r\n            || typeof language === \"undefined\"\r\n            || typeof sourcePackageURL === \"undefined\"\r\n            || typeof hypertyType === \"undefined\"\r\n            || typeof dataObjects === \"undefined\"\r\n        )\r\n            throw new Error(\"Invalid parameters!\");\r\n        return new runtime_catalogue_HypertyDescriptor(guid, CatalogueObjectType.HYPERTY, version, objectName, description,\r\n            language, sourcePackageURL, hypertyType, dataObjects);\r\n    }\r\n\r\n    /**\r\n     * Create ProtocolStubDescriptor\r\n     * @param {string} guid - Catalogue Global Unique identifier of the Catalogue Object\r\n     * @param {string} version - Indicates the version of Catalogue Data\r\n     * @param {string} objectName - Human-understandable name of the catalogue object\r\n     * @param {string} description\r\n     * @param {DataObjectSourceLanguage} language - Programming language used in the SourcePackage\r\n     * @param {string} sourcePackageURL - URL from where the source code package of the corresponding catalogue object can be downloaded.\r\n     * @param {URL.URL} messageSchemas - Defines the Schema describing the Message Data Model used by the Hyperty through the Catalogue URL from where the Message schema can be reached. If not defined, by default it is assumed the standard Message Model is used.\r\n     * @param configuration - Data required to configure the ProtocolStub\r\n     * @param constraints - Describes capabilities required from the Hyperty Runtime in order to be able to execute the ProtocolStub\r\n     * @param hypertyType\r\n     * @param dataObjects\r\n     * @param interworking\r\n     * @param idpProxy\r\n     * @param mutualAuthentication\r\n     * @returns {ProtocolStubDescriptor}\r\n     */\r\n    createProtoStubDescriptorObject(guid, version, objectName, description, language, sourcePackageURL, messageSchemas,\r\n                                    configuration, constraints, hypertyType, dataObjects, interworking, idpProxy, mutualAuthentication) {\r\n        if (\r\n            typeof guid === \"undefined\"\r\n            || typeof version === \"undefined\"\r\n            || typeof objectName === \"undefined\"\r\n            || typeof description === \"undefined\"\r\n            || typeof language === \"undefined\"\r\n            || typeof sourcePackageURL === \"undefined\"\r\n            || typeof messageSchemas === \"undefined\"\r\n            || typeof configuration === \"undefined\"\r\n            || typeof constraints === \"undefined\"\r\n        )\r\n            throw new Error(\"Invalid parameters!\");\r\n        return new runtime_catalogue_ProtocolStubDescriptor(guid, CatalogueObjectType.PROTOSTUB, version, objectName, description,\r\n            language, sourcePackageURL, messageSchemas, configuration, constraints, hypertyType, dataObjects, interworking, idpProxy, mutualAuthentication);\r\n    }\r\n\r\n    /**\r\n     * Create HypertyRuntimeDescriptor\r\n     * @param {string} guid - Catalogue Global Unique identifier of the Catalogue Object\r\n     * @param {string} version - Indicates the version of Catalogue Data\r\n     * @param {string} objectName - Human-understandable name of the catalogue object\r\n     * @param {string} description\r\n     * @param {DataObjectSourceLanguage} language - Programming language used in the SourcePackage\r\n     * @param {string} sourcePackageURL - URL from where the source code package of the corresponding catalogue object can be downloaded.\r\n     * @param {RuntimeType}runtimeType\r\n     * @param {RuntimeHypertyCapabilities} hypertyCapabilities - Supported capabilities to execute Hyperties\r\n     * @param {RuntimeProtocolCapabilities} protocolCapabilities - Supported capabilities to execute Protocol Stubs\r\n     * @param p2pHandlerStub\r\n     * @param p2pRequesterStub\r\n     * @returns {HypertyRuntimeDescriptor} the data object of the Hyperty Runtime Descriptor\r\n     */\r\n    createHypertyRuntimeDescriptorObject(guid, version, objectName, description, language, sourcePackageURL,\r\n                                         runtimeType, hypertyCapabilities, protocolCapabilities, p2pHandlerStub, p2pRequesterStub) {\r\n        if (\r\n            typeof guid === \"undefined\"\r\n            || typeof version === \"undefined\"\r\n            || typeof objectName === \"undefined\"\r\n            || typeof description === \"undefined\"\r\n            || typeof language === \"undefined\"\r\n            || typeof sourcePackageURL === \"undefined\"\r\n            || typeof runtimeType === \"undefined\"\r\n        )\r\n            throw new Error(\"Invalid parameters!\");\r\n\r\n        return new runtime_catalogue_HypertyRuntimeDescriptor(guid, CatalogueObjectType.HYPERTY_RUNTIME, version, objectName,\r\n            description, language, sourcePackageURL, runtimeType, hypertyCapabilities, protocolCapabilities, p2pHandlerStub, p2pRequesterStub);\r\n    }\r\n\r\n    /**\r\n     * Create Hyperty Interceptor Descriptor\r\n     * @param {string} guid - Catalogue Global Unique identifier of the Catalogue Object\r\n     * @param {string} version - Indicates the version of Catalogue Data\r\n     * @param {string} objectName - Human-understandable name of the catalogue object\r\n     * @param {string} description\r\n     * @param {DataObjectSourceLanguage} language - Programming language used in the SourcePackage\r\n     * @param {string} sourcePackageURL - URL from where the source code package of the corresponding catalogue object can be downloaded.\r\n     * @param configuration\r\n     * @param policies\r\n     * @returns {PolicyEnforcerDescriptor}\r\n     */\r\n    createHypertyInterceptorDescriptorObject(guid, version, objectName, description, language, sourcePackageURL, configuration,\r\n                                             policies) {\r\n        if (\r\n            typeof guid === \"undefined\"\r\n            || typeof version === \"undefined\"\r\n            || typeof objectName === \"undefined\"\r\n            || typeof description === \"undefined\"\r\n            || typeof language === \"undefined\"\r\n            || typeof sourcePackageURL === \"undefined\"\r\n        )\r\n            throw new Error(\"Invalid parameters!\");\r\n\r\n        return new HypertyInterceptorDescriptor(guid, CatalogueObjectType.HYPERTY_INTERCEPTOR, version, objectName,\r\n            description, language, sourcePackageURL, configuration, policies);\r\n    }\r\n\r\n    /**\r\n     * Create DataObjectSchema which in effect is the MessageDataObjectSchema\r\n     * @deprecated Use either createMessageDataObjectSchema or createHypertyDataObjectSchema instead\r\n     * @param {string} guid - Catalogue Global Unique identifier of the Catalogue Object\r\n     * @param {string} version - Indicates the version of Catalogue Data\r\n     * @param {string} objectName - Human-understandable name of the catalogue object\r\n     * @param {string} description\r\n     * @param {DataObjectSourceLanguage} language - Programming language used in the SourcePackage\r\n     * @param {string} sourcePackageURL - URL from where the source code package of the corresponding catalogue object can be downloaded.\r\n     * @returns {DataObjectSchema}\r\n     */\r\n    createDataObjectSchema(guid, version, objectName, description, language, sourcePackageURL) {\r\n        if (\r\n            typeof guid === \"undefined\"\r\n            || typeof version === \"undefined\"\r\n            || typeof objectName === \"undefined\"\r\n            || typeof description === \"undefined\"\r\n            || typeof language === \"undefined\"\r\n            || typeof sourcePackageURL === \"undefined\"\r\n        )\r\n            throw new Error(\"Invalid parameters!\");\r\n\r\n        return new DataObjectSchema_DataObjectSchema(guid, CatalogueObjectType.HYPERTY_DATA_OBJECT, version, objectName, description, language,\r\n            sourcePackageURL);\r\n    }\r\n\r\n    /**\r\n     * Create DataObjectSchema which in effect is the MessageDataObjectSchema\r\n     * @param {string} guid - Catalogue Global Unique identifier of the Catalogue Object\r\n     * @param {string} version - Indicates the version of Catalogue Data\r\n     * @param {string} objectName - Human-understandable name of the catalogue object\r\n     * @param {string} description\r\n     * @param {DataObjectSourceLanguage} language - Programming language used in the SourcePackage\r\n     * @param {string} sourcePackageURL - URL from where the source code package of the corresponding catalogue object can be downloaded.\r\n     * @returns {DataObjectSchema}\r\n     */\r\n    createMessageDataObjectSchema(guid, version, objectName, description, language, sourcePackageURL) {\r\n        if (\r\n            typeof guid === \"undefined\"\r\n            || typeof version === \"undefined\"\r\n            || typeof objectName === \"undefined\"\r\n            || typeof description === \"undefined\"\r\n            || typeof language === \"undefined\"\r\n            || typeof sourcePackageURL === \"undefined\"\r\n        )\r\n            throw new Error(\"Invalid parameters!\");\r\n\r\n        return new DataObjectSchema_DataObjectSchema(guid, CatalogueObjectType.HYPERTY_DATA_OBJECT, version, objectName, description, language,\r\n            sourcePackageURL);\r\n    }\r\n\r\n    /**\r\n     * Create HypertyDataObjectSchema\r\n     * @param {string} guid - Catalogue Global Unique identifier of the Catalogue Object\r\n     * @param {string} version - Indicates the version of Catalogue Data\r\n     * @param {string} objectName - Human-understandable name of the catalogue object\r\n     * @param {string} description\r\n     * @param {DataObjectSourceLanguage} language - Programming language used in the SourcePackage\r\n     * @param {string} sourcePackageURL - URL from where the source code package of the corresponding catalogue object can be downloaded.\r\n     * @param {string} accessControlPolicy - policy rule to access object (see Reporter-Observer Comm pattern)\r\n     * @param {DataUrlScheme} scheme - identifies the data scheme (COMM, CONNECTION, CTXT or IDENTITY)\r\n     * @returns {DataObjectSchema}\r\n     */\r\n    createHypertyDataObjectSchema(guid, version, objectName, description, language, sourcePackageURL,\r\n                                  accessControlPolicy, scheme) {\r\n        if (\r\n            typeof guid === \"undefined\"\r\n            || typeof version === \"undefined\"\r\n            || typeof objectName === \"undefined\"\r\n            || typeof description === \"undefined\"\r\n            || typeof language === \"undefined\"\r\n            || typeof sourcePackageURL === \"undefined\"\r\n            || typeof scheme === \"undefined\"\r\n            || typeof accessControlPolicy === \"undefined\"\r\n        )\r\n            throw new Error(\"Invalid parameters!\");\r\n\r\n        if (scheme === DataUrlScheme.COMM)\r\n            return new CommunicationDataObjectSchema(guid, CatalogueObjectType.HYPERTY_DATA_OBJECT, version, objectName, description,\r\n                language, sourcePackageURL, scheme, accessControlPolicy);\r\n        else if (scheme === DataUrlScheme.CONNECTION)\r\n            return new ConnectionDataObjectSchema(guid, CatalogueObjectType.HYPERTY_DATA_OBJECT, version, objectName, description,\r\n                language, sourcePackageURL, scheme, accessControlPolicy);\r\n        else if (scheme === DataUrlScheme.CTXT)\r\n            return new ContextDataObjectSchema(guid, CatalogueObjectType.HYPERTY_DATA_OBJECT, version, objectName, description,\r\n                language, sourcePackageURL, scheme, accessControlPolicy);\r\n        else if (scheme === DataUrlScheme.IDENTITY)\r\n            return new IdentityDataObjectSchema(guid, CatalogueObjectType.HYPERTY_DATA_OBJECT, version, objectName, description,\r\n                language, sourcePackageURL, scheme, accessControlPolicy);\r\n    }\r\n\r\n    /**\r\n     * Create SourcePackage\r\n     * @param sourceCodeClassname - The Class-name of the SourceCode\r\n     * @param sourceCode - The source code of the catalogue object\r\n     * @returns {SourcePackage}\r\n     */\r\n    createSourcePackage(sourceCodeClassname, sourceCode) {\r\n        if (\r\n            typeof sourceCode === \"undefined\"\r\n            || typeof sourceCodeClassname === \"undefined\"\r\n        )\r\n            throw new Error(\"Invalid parameters!\");\r\n\r\n        return new runtime_catalogue_SourcePackage(sourceCodeClassname, sourceCode);\r\n\r\n    }\r\n}\r\n/* harmony default export */ var runtime_catalogue_CatalogueDataObjectFactory = (CatalogueDataObjectFactory_CatalogueDataObjectFactory);\r\n\n// CONCATENATED MODULE: ./src/runtime-catalogue/RuntimeCatalogue.js\n// Log System\r\n\r\nlet RuntimeCatalogue_log = loglevel[\"getLogger\"]('RuntimeCatalogue');\r\n\r\n\r\n\r\nclass RuntimeCatalogue_RuntimeCatalogue {\r\n\r\n  constructor(runtimeFactory, name, schema) {\r\n    if (!runtimeFactory) throw Error('The catalogue needs the runtimeFactory');\r\n\r\n    this._runtimeFactory = runtimeFactory;\r\n\r\n    this._factory = new runtime_catalogue_CatalogueDataObjectFactory();\r\n    this.httpRequest = runtimeFactory.createHttpRequest();\r\n    this.atob = runtimeFactory.atob ? runtimeFactory.atob : atob;\r\n\r\n    const storageName = name ? name : 'runtimeCatalogue';\r\n    const storageSchema = schema ? schema : '&cguid, accessControlPolicy, constraints, dataObjects, type, objectName, sourcePackage, version, url';\r\n\r\n    const schemas = {};\r\n    schemas[storageName] = storageSchema;\r\n\r\n    this.storageManager = runtimeFactory.storageManager(storageName, schemas);\r\n\r\n  }\r\n\r\n  /**\r\n     * Get a Catalogue Data Object (Descriptor) from a URL, and construct it using the provided function\r\n     * @param {String} descriptorURL - e.g. mydomain.com/.well-known/hyperty/MyHyperty\r\n     * @param {function} createFunc - e.g. createHyperty\r\n     * @param {boolean} [getFull] - whether or not to get descriptor with sourcePackage, or only the descriptor part\r\n     * @param {JSON} constraints - constraints object\r\n     * @returns {Promise} - Promise that fulfills with the requested descriptor in the appropriate type.\r\n     * If constraints were provided, a descriptor is only returned if it meets the constraints, otherwise the promise will be rejected.\r\n     */\r\n    getDescriptor(descriptorURL, createFunc, getFull = true, constraints) {\r\n      RuntimeCatalogue_log.info('[RuntimeCatalogue] - getting descriptor from: ', descriptorURL, ' with constraints: ', constraints);\r\n\r\n      return new Promise ((resolve, reject)=>{\r\n        if (this._runtimeFactory.isOnline() ) {\r\n            resolve( this._getDescriptor(descriptorURL, createFunc, getFull, constraints));\r\n        } else {\r\n          this.storageManager.get('url', descriptorURL).then((descriptor) => {\r\n            console.log('[RuntimeCatalogue] saved offline descriptor ', descriptor);\r\n\r\n            if (descriptor) resolve(createFunc.apply(this, [descriptor, constraints]));\r\n            else resolve( this._getDescriptor(descriptorURL, createFunc, getFull, constraints));\r\n\r\n          });\r\n        } \r\n  \r\n      });\r\n\r\n    }\r\n\r\n    _getDescriptor(descriptorURL, createFunc, getFull = true, constraints) {\r\n\r\n    // some flags for optimization\r\n    // (later the descriptor will not be saved in case both of these booleans are true)\r\n    let isSavedDescriptor = false;\r\n    let isCompleteDescriptor = false;\r\n\r\n    // get raw descriptor\r\n    // first checks if descriptor is already in localStorage (based on cguid and version)\r\n    let descriptorPromise;\r\n    if (constraints != undefined) {\r\n      descriptorPromise = Promise.all([this.httpRequest.post(descriptorURL + '/version', {body: JSON.stringify(constraints)}), this.httpRequest.post(descriptorURL + '/cguid', {body: JSON.stringify(constraints)})])\r\n    } else {\r\n      descriptorPromise = Promise.all([this.httpRequest.get(descriptorURL + '/version'), this.httpRequest.get(descriptorURL + '/cguid')])\r\n    }\r\n    descriptorPromise = descriptorPromise.then(([version, cguid]) => {\r\n      RuntimeCatalogue_log.log('[RuntimeCatalogue.getDescriptor] - got version (' + version + ') and cguid (' + cguid + ') for descriptor ' + descriptorURL);\r\n\r\n      // check if same version is contained in localStorage\r\n      return this.storageManager.getVersion('cguid', cguid).then((dbVersion) => {\r\n        if (dbVersion >= version) {\r\n          RuntimeCatalogue_log.log('[RuntimeCatalogue.getDescriptor] local version is updated for ', descriptorURL);\r\n          isSavedDescriptor = true;\r\n          return this.storageManager.get('cguid', cguid);\r\n        } else {\r\n          RuntimeCatalogue_log.log('[RuntimeCatalogue.getDescriptor] local version not updated for ', descriptorURL, ' retrieving from remote catalogue ...');\r\n\r\n          // no saved copy, proceed with retrieving descriptor\r\n          let retrievePromise = constraints != undefined ? this.httpRequest.post(descriptorURL, {body: JSON.stringify(constraints)}) : this.httpRequest.get(descriptorURL);\r\n          return retrievePromise.then((descriptor) => {\r\n            descriptor = JSON.parse(descriptor);\r\n\r\n            //log.log(\"got descriptor:\", JSON.stringify(descriptor, null, 2));\r\n            if (descriptor['ERROR']) {\r\n              // TODO handle error properly\r\n              throw new Error(descriptor);\r\n            } else {\r\n              return descriptor;\r\n            }\r\n          });\r\n        }\r\n      })\r\n    }).catch((error) => {\r\n      let errorString = 'Unable to get descriptor for ' + descriptorURL + (constraints != undefined ? ' with constraints ' + constraints : '') + ': ' + error;\r\n      RuntimeCatalogue_log.error(errorString);\r\n      throw new Error(errorString);\r\n    });\r\n\r\n    let returnPromise = descriptorPromise;\r\n\r\n    // if getFull, attach sourcePackage\r\n    if (getFull) {\r\n      RuntimeCatalogue_log.log('adding promise to attach sourcePackage');\r\n      returnPromise = descriptorPromise.then((descriptor) => {\r\n        if (descriptor.sourcePackage) {\r\n          isCompleteDescriptor = true;\r\n          return descriptor;\r\n        } else {\r\n          isCompleteDescriptor = false;\r\n          return this.attachRawSourcePackage(descriptor);\r\n        }\r\n      })\r\n    }\r\n\r\n    // finally create object\r\n    returnPromise = returnPromise.then((descriptor) => {\r\n      // store if not saved before, or if full descriptor was requested and only partial descriptor was stored.\r\n      if (!isSavedDescriptor || (isSavedDescriptor && !isCompleteDescriptor && getFull)) {\r\n        descriptor.url = descriptorURL;\r\n        this.storageManager.set(descriptor.cguid, descriptor.version, descriptor);\r\n      }\r\n      return createFunc.apply(this, [descriptor, constraints]);\r\n    });\r\n\r\n    return returnPromise;\r\n  }\r\n\r\n  /**\r\n     * Uses the sourcePackageURL from the descriptor, requests the sourcePackage and attaches it to the descriptor.\r\n     * @param {CatalogueDataObject} descriptor\r\n     * @param {JSON} constraints - constraints object\r\n     * @returns {Promise} - fulfills with complete descriptor\r\n     */\r\n  attachRawSourcePackage(descriptor, constraints) {\r\n    RuntimeCatalogue_log.log('attaching raw sourcePackage from:', descriptor.sourcePackageURL);\r\n    return new Promise((resolve, reject) => {\r\n      let retrievePromise = constraints != undefined ? this.httpRequest.post(descriptor.sourcePackageURL, {body: JSON.stringify(constraints)}) : this.httpRequest.get(descriptor.sourcePackageURL);\r\n      retrievePromise.then((sourcePackage) => {\r\n        sourcePackage = JSON.parse(sourcePackage);\r\n\r\n        //delete descriptor.sourcePackageURL;\r\n        //log.log(\"attaching sourcePackage:\", sourcePackage);\r\n        descriptor.sourcePackage = sourcePackage;\r\n        resolve(descriptor);\r\n      }).catch((reason) => {\r\n        reject(reason);\r\n      });\r\n    });\r\n  }\r\n\r\n  /**\r\n     * Get HypertyDescriptor\r\n     * @param hypertyURL - e.g. mydomain.com/.well-known/hyperty/MyHyperty\r\n     * @param {boolean} [getFull] - boolean to decide to get the descriptor with the sourcePackage or (potentially) without\r\n     * @param {JSON} constraints - constraints object\r\n     * @returns {Promise}\r\n     */\r\n  getHypertyDescriptor(hypertyURL, getFull = true, constraints) {\r\n    return this.getDescriptor(hypertyURL, this.createHyperty, getFull, constraints)\r\n  }\r\n\r\n  /**\r\n     * Get StubDescriptor\r\n     * @param stubURL - e.g. mydomain.com/.well-known/protostub/MyProtostub\r\n     * @param {boolean} [getFull] - boolean to decide to get the descriptor with the sourcePackage or (potentially) without\r\n     * @param {JSON} constraints - constraints object\r\n     * @returns {Promise}\r\n     */\r\n  getStubDescriptor(stubURL, getFull = true, constraints) {\r\n    return this.getDescriptor(stubURL, this.createStub, getFull, constraints)\r\n  }\r\n\r\n  /**\r\n     * Get RuntimeDescriptor\r\n     * @param runtimeURL - e.g. mydomain.com/.well-known/runtime/MyRuntime\r\n     * @param {boolean} [getFull] - boolean to decide to get the descriptor with the sourcePackage or (potentially) without\r\n     * @param {JSON} constraints - constraints object\r\n     * @returns {Promise}\r\n     */\r\n  getRuntimeDescriptor(runtimeURL, getFull = true, constraints) {\r\n    return this.getDescriptor(runtimeURL, this.createRuntimeDescriptor, getFull, constraints)\r\n  }\r\n\r\n  /**\r\n     * Get DataSchemaDescriptor\r\n     * @param dataSchemaURL - e.g. mydomain.com/.well-known/dataschema/MyDataSchema\r\n     * @param {boolean} [getFull] - boolean to decide to get the descriptor with the sourcePackage or (potentially) without\r\n     * @param {JSON} constraints - constraints object\r\n     * @returns {Promise}\r\n     */\r\n  getDataSchemaDescriptor(dataSchemaURL, getFull = true, constraints) {\r\n\r\n    //    return this.getDescriptor(dataSchemaURL, this.createDataSchema, getFull, constraints)\r\n    return new Promise((resolve)=> {\r\n      let schema = dataSchemaURL.split('/dataschema/')[1];\r\n      RuntimeCatalogue_log.log('[RuntimeCatalogue.getDataSchemaDescriptor] schema ', schema);\r\n      let descriptor = {\r\n        sourcePackage: {\r\n          sourceCode: {\r\n            properties: {\r\n            }\r\n          }\r\n\r\n        }\r\n      };\r\n    //      let scheme = properties.scheme ? properties.scheme.co : [];\r\n  \r\n      switch (schema) {\r\n        case 'Context':\r\n        case 'ContextReporter':\r\n        case 'ContextObserver':\r\n          descriptor.sourcePackage.sourceCode.properties.scheme = 'context';\r\n          break;\r\n        case 'Connection':\r\n          descriptor.sourcePackage.sourceCode.properties.scheme = 'connection';\r\n          break;\r\n        case 'WalletData':\r\n          descriptor.sourcePackage.sourceCode.properties.scheme = 'walletData';\r\n          break;\r\n        case 'Communication':\r\n          descriptor.sourcePackage.sourceCode.properties.scheme = 'comm';\r\n          descriptor.sourcePackage.sourceCode.properties.childrens = ['resources'];\r\n          break;\r\n        case 'HelloWorldDataSchema':\r\n          descriptor.sourcePackage.sourceCode.properties.scheme = 'hello';\r\n          break;\r\n        default:\r\n          descriptor.sourcePackage.sourceCode.properties.scheme = 'resource';\r\n          descriptor.sourcePackage.sourceCode.properties.childrens = [];\r\n          break;\r\n      }\r\n      resolve(descriptor);\r\n\r\n    });\r\n\r\n\r\n  }\r\n\r\n  /**\r\n     * Get IDPProxyDescriptor\r\n     * @param idpProxyURL - e.g. mydomain.com/.well-known/idp-proxy/MyProxy\r\n     * @param {boolean} [getFull] - boolean to decide to get the descriptor with the sourcePackage or (potentially) without\r\n     * @param {JSON} constraints - constraints object\r\n     * @returns {Promise}\r\n     */\r\n  getIdpProxyDescriptor(idpProxyURL, getFull = true, constraints) {\r\n    return this.getDescriptor(idpProxyURL, this.createIdpProxy, getFull, constraints)\r\n  }\r\n\r\n  /**\r\n     * Create HypertyDescriptor based on raw object that contains its attributes\r\n     * @param {JSON} rawHyperty\r\n     * @returns {HypertyDescriptor}\r\n     */\r\n  createHyperty(rawHyperty) {\r\n    //log.log(\"createHyperty:\", rawHyperty);\r\n    // create the descriptor\r\n    let hyperty = this._factory.createHypertyDescriptorObject(\r\n      rawHyperty['cguid'],\r\n      rawHyperty['version'],\r\n      rawHyperty['objectName'],\r\n      rawHyperty['description'],\r\n      rawHyperty['language'],\r\n      rawHyperty['sourcePackageURL'],\r\n      rawHyperty['type'] || rawHyperty['hypertyType'],\r\n      rawHyperty['dataObjects']\r\n    );\r\n\r\n    //log.log(\"factory returned:\", hyperty);\r\n\r\n    // optional fields\r\n    hyperty.configuration = rawHyperty['configuration'];\r\n    hyperty.constraints = rawHyperty['constraints'];\r\n    hyperty.messageSchema = rawHyperty['messageSchema'];\r\n    hyperty.policies = rawHyperty['policies'];\r\n    hyperty.signature = rawHyperty['signature'];\r\n\r\n    // parse and attach sourcePackage\r\n    let sourcePackage = rawHyperty['sourcePackage'];\r\n    if (sourcePackage) {\r\n      hyperty.sourcePackage = this.createSourcePackage(sourcePackage);\r\n    }\r\n\r\n    return hyperty;\r\n  }\r\n\r\n  /**\r\n     * Create ProtocolStubDescriptor based on raw object that contains its attributes\r\n     * @param rawStub\r\n     * @returns {ProtocolStubDescriptor}\r\n     */\r\n  createStub(rawStub) {\r\n    // log.log(\"creating stub descriptor based on: \", rawStub);\r\n\r\n    // create the descriptor\r\n    let stub = this._factory.createProtoStubDescriptorObject(\r\n      rawStub['cguid'],\r\n      rawStub['version'],\r\n      rawStub['objectName'],\r\n      rawStub['description'],\r\n      rawStub['language'],\r\n      rawStub['sourcePackageURL'],\r\n      rawStub['messageSchemas'],\r\n      rawStub['configuration'],\r\n      rawStub['constraints'],\r\n      rawStub['hypertyType'],\r\n      rawStub['dataObjects'],\r\n      rawStub['interworking'],\r\n      rawStub['idpProxy'],\r\n      rawStub['mutualAuthentication']\r\n    );\r\n\r\n    // optional fields\r\n    stub.signature = rawStub['signature'];\r\n\r\n    // parse and attach the sourcePackage\r\n    let sourcePackage = rawStub['sourcePackage'];\r\n    if (sourcePackage) {\r\n      stub.sourcePackage = this.createSourcePackage(sourcePackage);\r\n    }\r\n\r\n    return stub;\r\n  }\r\n\r\n  /**\r\n     * Create HypertyRuntimeDescriptor based on raw object that contains its attributes\r\n     * @param rawRuntime\r\n     * @returns {HypertyRuntimeDescriptor}\r\n     */\r\n  createRuntimeDescriptor(rawRuntime) {\r\n    // parse capabilities first\r\n    try {\r\n      rawRuntime['hypertyCapabilities'] = JSON.parse(rawRuntime['hypertyCapabilities']);\r\n      rawRuntime['protocolCapabilities'] = JSON.parse(rawRuntime['protocolCapabilities']);\r\n    } catch (e) {\r\n      // already json object\r\n    }\r\n\r\n    //log.log(\"creating runtime descriptor based on: \", rawRuntime);\r\n\r\n\r\n    // create the descriptor\r\n    let runtime = this._factory.createHypertyRuntimeDescriptorObject(\r\n      rawRuntime['cguid'],\r\n      rawRuntime['version'],\r\n      rawRuntime['objectName'],\r\n      rawRuntime['description'],\r\n      rawRuntime['language'],\r\n      rawRuntime['sourcePackageURL'],\r\n      rawRuntime['type'] || rawRuntime['runtimeType'],\r\n      rawRuntime['hypertyCapabilities'],\r\n      rawRuntime['protocolCapabilities'],\r\n      rawRuntime['p2pHandlerStub'],\r\n      rawRuntime['p2pRequesterStub']\r\n    );\r\n\r\n    // optional fields\r\n    runtime.signature = rawRuntime['signature'];\r\n\r\n    // parse and attach sourcePackage\r\n    let sourcePackage = rawRuntime['sourcePackage'];\r\n    if (sourcePackage) {\r\n      // log.log(\"runtime has sourcePackage:\", sourcePackage);\r\n      runtime.sourcePackage = this.createSourcePackage(sourcePackage);\r\n    }\r\n    return runtime;\r\n  }\r\n\r\n  /**\r\n     * Create DataObjectSchema based on raw object that contains its attributes\r\n     * @param rawSchema\r\n     * @returns {DataObjectSchema}\r\n     */\r\n  createDataSchema(rawSchema) {\r\n    //log.log(\"creating dataSchema based on: \", rawSchema);\r\n\r\n    let dataSchema;\r\n\r\n    //log.log('1. createMessageDataObjectSchema: ', rawSchema[\"accessControlPolicy\"]);\r\n    //log.log('2. createMessageDataObjectSchema: ', rawSchema[\"scheme\"]);\r\n    if (rawSchema['accessControlPolicy'] && rawSchema['scheme']) {\r\n      dataSchema = this._factory.createHypertyDataObjectSchema(\r\n        rawSchema['cguid'],\r\n        rawSchema['version'],\r\n        rawSchema['objectName'],\r\n        rawSchema['description'],\r\n        rawSchema['language'],\r\n        rawSchema['sourcePackageURL'],\r\n        rawSchema['accessControlPolicy'],\r\n        rawSchema['scheme']\r\n      )\r\n    } else {\r\n      //log.log('3. createMessageDataObjectSchema: ', rawSchema);\r\n      dataSchema = this._factory.createMessageDataObjectSchema(\r\n        rawSchema['cguid'],\r\n        rawSchema['version'],\r\n        rawSchema['objectName'],\r\n        rawSchema['description'],\r\n        rawSchema['language'],\r\n        rawSchema['sourcePackageURL']\r\n      )\r\n    }\r\n\r\n    // optional fields\r\n    dataSchema.signature = rawSchema['signature'];\r\n\r\n    // parse and attach sourcePackage\r\n    let sourcePackage = rawSchema['sourcePackage'];\r\n    if (sourcePackage) {\r\n      //log.log(\"dataSchema has sourcePackage:\", sourcePackage);\r\n      dataSchema.sourcePackage = this.createSourcePackage(sourcePackage);\r\n\r\n      try {\r\n        dataSchema.sourcePackage.sourceCode = JSON.parse(dataSchema.sourcePackage.sourceCode);\r\n      } catch (e) {\r\n        RuntimeCatalogue_log.log('DataSchema Source code is already parsed');\r\n      }\r\n\r\n      return dataSchema;\r\n\r\n    }\r\n\r\n    //log.log(\"created dataSchema descriptor object:\", dataSchema);\r\n    return dataSchema;\r\n  }\r\n\r\n  /**\r\n     * Create ProtocolStubDescriptor based on raw object that contains its attributes\r\n     * @param rawProxy\r\n     * @returns {ProtocolStubDescriptor}\r\n     */\r\n  createIdpProxy(rawProxy) {\r\n    // log.log(\"creating idpproxy descriptor based on: \", rawProxy);\r\n\r\n    // create the descriptor\r\n    let idpproxy = this._factory.createProtoStubDescriptorObject(\r\n      rawProxy['cguid'],\r\n      rawProxy['version'],\r\n      rawProxy['objectName'],\r\n      rawProxy['description'],\r\n      rawProxy['language'],\r\n      rawProxy['sourcePackageURL'],\r\n      rawProxy['messageSchemas'],\r\n      rawProxy['configuration'],\r\n      rawProxy['constraints'],\r\n      rawProxy['hypertyType'],\r\n      rawProxy['dataObjects'],\r\n      rawProxy['interworking'],\r\n      rawProxy['idpProxy'],\r\n      rawProxy['mutualAuthentication']\r\n    );\r\n\r\n    // optional fields\r\n    idpproxy.signature = rawProxy['signature'];\r\n\r\n    // parse and attach the sourcePackage\r\n    let sourcePackage = rawProxy['sourcePackage'];\r\n    if (sourcePackage) {\r\n      sourcePackage = this.createSourcePackage(sourcePackage);\r\n      idpproxy.sourcePackage = sourcePackage;\r\n    }\r\n\r\n    return idpproxy;\r\n  }\r\n\r\n  createSourcePackage(sp) {\r\n    //log.log(\"createSourcePackage:\", sp);\r\n\r\n    // check encoding\r\n    if (sp['encoding'] === 'base64') {\r\n      sp['sourceCode'] = this.atob(sp['sourceCode']);\r\n      sp['encoding'] = 'utf-8';\r\n    }\r\n\r\n    let sourcePackage = this._factory.createSourcePackage(sp['sourceCodeClassname'], sp['sourceCode']);\r\n    if (sp['encoding'])\r\n      sourcePackage.encoding = sp['encoding'];\r\n\r\n    if (sp['signature'])\r\n      sourcePackage.signature = sp['signature'];\r\n\r\n    return sourcePackage;\r\n  }\r\n\r\n  /**\r\n     * Get source Package from a URL\r\n     * @param sourcePackageURL - e.g. mydomain.com/.well-known/hyperty/MyHyperty/sourcePackage\r\n     * @returns {Promise}\r\n     */\r\n  getSourcePackageFromURL(sourcePackageURL) {\r\n    RuntimeCatalogue_log.log('getting sourcePackage from:', sourcePackageURL);\r\n\r\n    return new Promise((resolve, reject) => {\r\n      this.httpRequest.get(sourcePackageURL).then((result) => {\r\n        //log.log(\"got raw sourcePackage:\", result);\r\n        if (result['ERROR']) {\r\n          // TODO handle error properly\r\n          reject(result);\r\n        } else {\r\n          result = JSON.parse(result);\r\n          let sourcePackage = this.createSourcePackage(result);\r\n          resolve(sourcePackage);\r\n        }\r\n      }).catch((reason) => {\r\n        reject(reason);\r\n      });\r\n\r\n    });\r\n\r\n  }\r\n\r\n  /**\r\n     * Returns the sourceCode of a given descriptor\r\n     * @param {CatalogueDataObject} descriptor - Catalogue Object that was retrieved using e.g. getHypertyDescriptor()\r\n     * @returns {Promise}\r\n     */\r\n  getSourceCodeFromDescriptor(descriptor) {\r\n    return new Promise((resolve, reject) => {\r\n      if (descriptor.sourcePackage) {\r\n        //log.log(\"descriptor has sourcePackage\");\r\n        //log.log(\"returning sourceCode:\", descriptor.sourcePackage.sourceCode);\r\n        resolve(descriptor.sourcePackage.sourceCode);\r\n      } else {\r\n        this.storageManager.getVersion(descriptor.sourcePackageURL + '/sourceCode').then((dbVersion) => {\r\n          if (dbVersion >= descriptor.version) {\r\n            RuntimeCatalogue_log.log('returning cached version from storageManager');\r\n            this.storageManager.get(descriptor.sourcePackageURL + '/sourceCode').then((sourceCode) => {\r\n              resolve(sourceCode);\r\n            }).catch((reason) => {\r\n              reject(reason);\r\n            });\r\n          } else {\r\n            this.httpRequest.get(descriptor.sourcePackageURL + '/sourceCode').then((sourceCode) => {\r\n              if (sourceCode['ERROR']) {\r\n                // TODO handle error properly\r\n                reject(sourceCode);\r\n              } else {\r\n                this.storageManager.set(descriptor.sourcePackageURL + '/sourceCode', descriptor.version, sourceCode);\r\n                resolve(sourceCode);\r\n              }\r\n            }).catch((reason) => {\r\n              reject(reason);\r\n            });\r\n          }\r\n        }).catch((reason) => {\r\n          reject(reason);\r\n        });\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n     * Returns the list of available catalogue objects for the given \"type URL\",\r\n     * i.e. a catalogue URL that specifies a type, but no catalogue object name.\r\n     * @param typeURL - URL pointing to the catalogue object type you want a list of available objects for,\r\n     * e.g. hyperty-catalogue://catalogue.fokus.fraunhofer.de/.well-known/idp-proxy\r\n     * @param {JSON} constraints - constraints object\r\n     * @returns {Promise} typeListPromise - Promise that fulfills with the list of available catalogue object names for the requested type,\r\n     * rejects on HTTP error or if the HTTP response is not in JSON.\r\n     * If constraints were provided, then the list only contains those objects that meet the constraints\r\n     */\r\n  getTypeList(typeURL, constraints) {\r\n    return new Promise((resolve, reject) => {\r\n      let requestPromise = constraints != undefined ? this.httpRequest.post(typeURL, {body: JSON.stringify(constraints)}) : this.httpRequest.get(typeURL);\r\n      requestPromise.then((typeList) => {\r\n        typeList = JSON.parse(typeList);\r\n        resolve(typeList);\r\n      }).catch((reason) => {\r\n        reject(reason);\r\n      });\r\n    });\r\n  }\r\n\r\n  set runtimeURL(runtimeURL) {\r\n    this._runtimeURL = runtimeURL;\r\n  }\r\n\r\n  get runtimeURL() {\r\n    return this._runtimeURL;\r\n  }\r\n\r\n  deleteFromPM(url) {\r\n    return this.storageManager.delete(url);\r\n  }\r\n\r\n}\r\n\r\n/* harmony default export */ var runtime_catalogue_RuntimeCatalogue = (RuntimeCatalogue_RuntimeCatalogue);\r\n\n// CONCATENATED MODULE: ./src/runtime/RuntimeUA.js\n/**\r\n* Copyright 2016 PT Inovação e Sistemas SA\r\n* Copyright 2016 INESC-ID\r\n* Copyright 2016 QUOBIS NETWORKS SL\r\n* Copyright 2016 FRAUNHOFER-GESELLSCHAFT ZUR FOERDERUNG DER ANGEWANDTEN FORSCHUNG E.V\r\n* Copyright 2016 ORANGE SA\r\n* Copyright 2016 Deutsche Telekom AG\r\n* Copyright 2016 Apizee\r\n* Copyright 2016 TECHNISCHE UNIVERSITAT BERLIN\r\n*\r\n* Licensed under the Apache License, Version 2.0 (the \"License\");\r\n* you may not use this file except in compliance with the License.\r\n* You may obtain a copy of the License at\r\n*\r\n*   http://www.apache.org/licenses/LICENSE-2.0\r\n*\r\n* Unless required by applicable law or agreed to in writing, software\r\n* distributed under the License is distributed on an \"AS IS\" BASIS,\r\n* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n* See the License for the specific language governing permissions and\r\n* limitations under the License.\r\n**/\r\n\r\n\r\n\r\n\r\n// Log System\r\n\r\nlet RuntimeUA_log = loglevel[\"getLogger\"]('RuntimeUA');\r\n\r\n//Main dependecies\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n//import GraphConnector from '../graphconnector/GraphConnector';\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n/**\r\n * Runtime User Agent Interface will process all the dependecies of the core runtime;\r\n * @author Vitor Silva [vitor-t-silva@telecom.pt]\r\n * @version 0.4.0\r\n *\r\n * @property {runtimeFactory} runtimeFactory - Specific implementation for all environments;\r\n * @property {RuntimeCatalogue} runtimeCatalogue - Catalogue of components can be installed;\r\n * @property {runtimeURL} runtimeURL - This identify the core runtime, should be unique;\r\n * @property {IdentityModule} identityModule - Identity Module;\r\n * @property {PEP} policyEngine - Policy Engine Module;\r\n * @property {Registry} registry - Registry Module;\r\n * @property {MessageBus} messageBus - Message Bus is used like a router to redirect the messages from one component to other(s)\r\n * @property {GraphConnector} graphConnector - Graph Connector handling GUID and contacts\r\n * @property {CoreDiscovery} coreDiscovery - Discovery for discovery hyperties/dataObjects\r\n */\r\nclass RuntimeUA_RuntimeUA {\r\n\r\n  /**\r\n   * Create a new instance of Runtime User Agent\r\n   * @param {descriptor} runtimeDescriptor - pass all the hyperty runtime descriptor\r\n   * @param {runtimeFactory} runtimeFactory - Specific implementation for the environment where the core runtime will run;\r\n   * @param {domain} domainURL - specify the domain base for the runtime;\r\n   */\r\n  constructor(runtimeDescriptor, runtimeFactory, domain) {\r\n    if (!runtimeDescriptor) throw new Error('The runtime descriptor is a needed parameter');\r\n    if (!runtimeFactory) throw new Error('The sandbox factory is a needed parameter');\r\n    if (!domain) throw new Error('You need the domain of runtime');\r\n\r\n    // Configuration object with information related with servers\r\n    this.runtimeConfiguration = Object.assign({ domain: domain }, runtimeConfiguration_runtimeConfiguration);\r\n    this.runtimeFactory = runtimeFactory;\r\n\r\n    this.log = RuntimeUA_log;\r\n    this.logLevels = loglevel_default.a;\r\n\r\n    if (runtimeDescriptor.p2pHandlerStub && typeof runtimeDescriptor.p2pHandlerStub === 'string' && runtimeDescriptor.p2pHandlerStub.includes('://')) {\r\n      this.p2p = true;\r\n    } else {\r\n      this.p2p = false;\r\n    }\r\n\r\n    runtimeUtils.runtimeDescriptor = runtimeDescriptor;\r\n    this.runtimeUtils = runtimeUtils;\r\n\r\n    this.storages = {};\r\n\r\n/*    if (typeof runtimeFactory.createRuntimeCatalogue === 'function') {\r\n      this.runtimeCatalogue = runtimeFactory.createRuntimeCatalogue();\r\n    } else {\r\n      throw new Error('Check your Runtime Factory because it needs the Runtime Catalogue implementation');\r\n    }*/\r\n\r\n    this.runtimeCatalogue = new runtime_catalogue_RuntimeCatalogue(runtimeFactory);\r\n\r\n\r\n\r\n/*    if (typeof runtimeFactory.persistenceManager === 'function') {\r\n      this.persistenceManager = runtimeFactory.persistenceManager();\r\n    } else {\r\n      throw new Error('Check your Runtime Factory because it needs the Persistence Manager implementation');\r\n    }*/\r\n\r\n    if (typeof runtimeFactory.storageManager === 'function') {\r\n\r\n      this.storages = Storage_storage(runtimeFactory, this);\r\n\r\n    } else {\r\n      throw new Error('Check your Runtime Factory because it needs the Storage Manager implementation');\r\n    }\r\n\r\n    if (typeof runtimeFactory.runtimeCapabilities === 'function') {\r\n      this.runtimeCapabilities = runtimeFactory.runtimeCapabilities(this.storages.capabilities);\r\n    } else {\r\n      RuntimeUA_log.info('Check your RuntimeFactory because it needs the Runtime Capabilities implementation');\r\n    }\r\n\r\n  }\r\n\r\n  /**\r\n   * Intialize the installation of runtime\r\n   *\r\n   * @access public\r\n   * @return {Promise<Boolean, Error>} this is Promise and if the installation process happened without any problems returns true otherwise the error.\r\n   *\r\n   * @memberOf RuntimeUA\r\n   */\r\n  init(guid) {\r\n    return new Promise((resolve, reject) => {\r\n\r\n      this.domain = this.runtimeConfiguration.domain;\r\n\r\n\r\n      RuntimeUA_log.info('[RuntimeUA - init] Starting ');\r\n\r\n      try {\r\n        let getCapabilities = this.runtimeCapabilities.getRuntimeCapabilities();\r\n        let getRuntimeURL = this.storages.runtime.get('runtime:URL');\r\n        let getStoredDataObjects = this.storages.syncherManager.get('syncherManager:ObjectURLs');\r\n        let getHypertyStorageObjects = this.storages.hypertyResources.get();\r\n        let getP2PHandlerURL = this.storages.runtime.get('p2pHandler:URL');\r\n//        let getRemotes = this.storages.syncherManager.get('remotes');\r\n\r\n        Promise.all([getRuntimeURL, getCapabilities, getStoredDataObjects, getHypertyStorageObjects, getP2PHandlerURL]).then((results) => {\r\n\r\n          this.runtimeURL = results[0] ? results[0].runtimeURL : results[0];\r\n          if (!this.runtimeURL) {\r\n            this.runtimeURL = 'runtime://' + this.domain + '/' + generateGUID();\r\n            this.storages.runtime.set('runtime:URL', 1, { runtimeURL: this.runtimeURL });\r\n          }\r\n\r\n\r\n          this.capabilities = results[1];\r\n          Object.assign(runtimeUtils.runtimeCapabilities.constraints, results[1]);\r\n\r\n          this._dataObjectsStorage = new store_objects_DataObjectsStorage(this.storages.syncherManager, results[2] || {}, this.runtimeFactory, this.runtimeURL );\r\n\r\n          this._hypertyResources = results[3] || {};\r\n\r\n          this.p2pHandlerURL = results[4] ? results[4].p2pHandlerURL : results[4];\r\n          if (!this.p2pHandlerURL) {\r\n            this.p2pHandlerURL = this.runtimeURL + '/p2phandler/' + generateGUID();\r\n            RuntimeUA_log.info('[RuntimeUA - init] P2PHandlerURL: ', this.p2pHandlerURL);\r\n\r\n            this.storages.runtime.set('p2pHandler:URL', 1, { p2pHandlerURL: this.p2pHandlerURL });\r\n          }\r\n\r\n/*          log.info('[RuntimeUA - init] dataObjectsStorage remote load starting');\r\n          this._dataObjectsStorage.loadRemote().then(()=> {\r\n            log.info('[RuntimeUA - init] dataObjectsStorage remote load concluded');*/\r\n            return this._loadComponents(guid);\r\n\r\n//          });\r\n\r\n\r\n        }).then((status) => {\r\n          this._setNetworkStatusListeners();\r\n\r\n          this._hypertyResourcesStorage = new hyperty_resource_HypertyResourcesStorage(this.runtimeURL, this.messageBus, this.storages.hypertyResources, this._hypertyResources);\r\n\r\n          if (this.p2p) {\r\n            RuntimeUA_log.info('[RuntimeUA - init] load p2pHandler: ', status);\r\n            return this._loadP2PHandler();\r\n          } else {\r\n            RuntimeUA_log.info('[RuntimeUA - init] P2P not supported');\r\n            return ('P2P Not Supported');\r\n          }\r\n\r\n        }).then((result) => {\r\n          RuntimeUA_log.info('[runtime ua - init] - status: ', result);\r\n          resolve(true);\r\n        }, (reason) => {\r\n          RuntimeUA_log.error('ERROR: ', reason);\r\n          resolve(true);\r\n        });\r\n\r\n      } catch (e) {\r\n        reject(e);\r\n      }\r\n\r\n    });\r\n\r\n  }\r\n\r\n  _setNetworkStatusListeners() {\r\n\r\n    this.runtimeFactory.listenOnline( this._updateRuntimeStatus('online') );\r\n    this.runtimeFactory.listenOffline( this._updateRuntimeStatus('offline') );\r\n\r\n  }\r\n\r\n  _updateRuntimeStatus(event) {\r\n\r\n    let _this = this;\r\n\r\n    _this.messageBus.postMessage({\r\n      from: this.runtimeURL,\r\n      to: this.runtimeURL+'/status',\r\n      type: 'update',\r\n      body: event\r\n    });\r\n  }\r\n\r\n  _loadP2PHandler() {\r\n\r\n    return new Promise((resolve) => {\r\n\r\n      let runtimeDescriptor = runtimeUtils.runtimeDescriptor;\r\n      let p2pStubHandler = runtimeDescriptor.p2pHandlerStub;\r\n\r\n      let p2pConfig = {\r\n        isHandlerStub: true,\r\n        runtimeURL: this.runtimeURL\r\n      };\r\n\r\n      RuntimeUA_log.log('[RuntimeUA loadP2PHandler] P2PStubHandler: ', p2pStubHandler);\r\n\r\n      this.loader.loadStub(p2pStubHandler, p2pConfig).then((result) => {\r\n\r\n        let runtimeUAURL = this.runtimeURL + '/ua';\r\n        let msg = {\r\n          type: 'subscribe',\r\n          from: runtimeUAURL,\r\n          to: 'domain://msg-node.' + this.domain + '/sm',\r\n          body: {\r\n            subscribe: [result.url],\r\n            source: this.runtimeURL\r\n          }\r\n        };\r\n\r\n        this.messageBus.addListener(runtimeUAURL, (msg) => {\r\n          RuntimeUA_log.log('[runtime ua - listener] - receive msg: ', msg);\r\n        });\r\n\r\n        this.messageBus.postMessage(msg, (reply) => {\r\n          RuntimeUA_log.log('[runtime ua - postMessage] - reply: ', reply);\r\n        });\r\n\r\n        RuntimeUA_log.info('[runtime ua - p2p installation] - success: ', result);\r\n        resolve(true);\r\n      }).catch((reason) => {\r\n        RuntimeUA_log.info('[runtime ua - p2p installation] - fail: ', reason);\r\n        resolve(false);\r\n      });\r\n\r\n    });\r\n\r\n  }\r\n\r\n  /**\r\n   *\r\n   * @access private\r\n   * @return {Promise<Boolean, Error>} this is Promise and returns true if all components are loaded with success or an error if someone fails.\r\n   *\r\n   * @memberOf RuntimeUA\r\n   */\r\n  _loadComponents(guid) {\r\n\r\n    return new Promise((resolve, reject) => {\r\n\r\n      try {\r\n\r\n        // Prepare the on instance to handle with the fallbacks and runtimeCatalogue;\r\n        this.descriptorInstance = new runtime_Descriptors(this.runtimeURL, this.runtimeCatalogue, this.runtimeConfiguration);\r\n\r\n        // Prepare the loader to load the hyperties, protostubs and idpproxy;\r\n        this.loader = new runtime_Loader(this.runtimeURL, this.runtimeConfiguration, this.descriptorInstance);\r\n\r\n        // Instantiate the identity Module\r\n        this.identityModule = new identity_IdentityModule(this.runtimeURL, this.runtimeCapabilities, this.storages.identity, this._dataObjectsStorage, cryptoManager_CryptoManager, this.runtimeCatalogue);\r\n\r\n        // Use the sandbox factory to create an AppSandbox;\r\n        // In the future can be decided by policyEngine if we need\r\n        // create a AppSandbox or not;\r\n        let appSandbox = this.runtimeFactory.createAppSandbox();\r\n\r\n        // Instantiate the Registry Module\r\n        this.registry = new registry_Registry(this.runtimeURL, appSandbox, this.identityModule, this.runtimeCatalogue, this.runtimeCapabilities, this.storages.registry, this.p2pHandlerURL);\r\n\r\n        // Set the loader to load Hyperties, Stubs and IdpProxies\r\n        this.registry.loader = this.loader;\r\n\r\n        // Instantiate the Message Bus\r\n        this.messageBus = new bus_MessageBus(this.registry, this.runtimeURL);\r\n\r\n        // Instanciate the SubscriptionManager;\r\n        this.subscriptionManager = new subscriptionManager_SubscriptionManager(this.runtimeURL, this.messageBus, this.storages.subscriptions);\r\n\r\n        // Prepare the address allocation instance;\r\n        this.addressAllocation = new allocation_AddressAllocation(this.runtimeURL, this.messageBus, this.registry, this.subscriptionManager);\r\n\r\n        // Instantiate the Policy Engine\r\n        this.policyEngine = new policy_PEP(new context_RuntimeCoreCtx(this.runtimeURL, this.identityModule, this.registry, this.storages.policy, this.runtimeCapabilities));\r\n\r\n        // Instantiate Discovery\r\n        this.coreDiscovery = new discovery_CoreDiscovery(this.runtimeURL, this.messageBus, this.graphConnector, this.runtimeFactory, this.registry);\r\n\r\n        // Instantiate the identityHandler\r\n        this.identityHandler = new identity_IdentityHandler(this.identityModule);\r\n\r\n        // initialise the CryptoManager\r\n        cryptoManager_CryptoManager.init(this.runtimeURL, this.runtimeCapabilities, this.storages.cryptoManager, this._dataObjectsStorage, this.registry, this.coreDiscovery, this.identityModule, this.runtimeFactory);\r\n\r\n        // Instantiate the Graph Connector\r\n//        this.graphConnector = process.env.MODE !== 'light' ? new GraphConnector(this.runtimeURL, this.messageBus, this.storageManager) : null;\r\n\r\n        this.handlers = new runtime_MsgBusHandlers(this.policyEngine, this.identityHandler, cryptoManager_CryptoManager);\r\n\r\n        // (un)comment bellow to not encrypt messages\r\n\r\n        this.messageBus.pipelineOut.handlers = [this.handlers.idmHandler, this.handlers.pepOutHandler];\r\n        this.messageBus.pipelineIn.handlers = [ this.handlers.pepInHandler];\r\n\r\n        // (un)comment bellow to encrypt messages\r\n\r\n//      this.messageBus.pipelineOut.handlers = [this.handlers.idmHandler, this.handlers.pepOutHandler, this.handlers.encryptHandler];\r\n//      this.messageBus.pipelineIn.handlers = [this.handlers.decryptHandler, this.handlers.pepInHandler];\r\n\r\n        // Add to App Sandbox the listener;\r\n        appSandbox.addListener('*', (msg) => {\r\n          this.messageBus.postMessage(msg);\r\n        });\r\n\r\n        cryptoManager_CryptoManager.messageBus = this.messageBus;\r\n\r\n        // Register messageBus on Registry\r\n        this.registry.messageBus = this.messageBus;\r\n\r\n        // Policy Engine\r\n        this.policyEngine.messageBus = this.messageBus;\r\n\r\n        // Register messageBus on IDM\r\n        this.identityModule.messageBus = this.messageBus;\r\n\r\n        // Register registry on IdentityModule\r\n        this.identityModule.registry = this.registry;\r\n\r\n        // Register coreDiscovery on IdentityModule\r\n        this.identityModule.coreDiscovery = this.coreDiscovery;\r\n\r\n        // Use sandbox factory to use specific methods\r\n        // and set the message bus to the factory\r\n        this.runtimeFactory.messageBus = this.messageBus;\r\n\r\n        // Instanciate the SyncherManager;\r\n        this.syncherManager = new syncher_SyncherManager(this.runtimeURL, this.messageBus, this.registry, this.runtimeCatalogue, this.storages.syncherManager, null, this._dataObjectsStorage, this.identityModule);\r\n\r\n\r\n        // Set into loader the needed components;\r\n        this.loader.runtimeURL = this.runtimeURL;\r\n        this.loader.messageBus = this.messageBus;\r\n        this.loader.registry = this.registry;\r\n        this.loader.runtimeCatalogue = this.runtimeCatalogue;\r\n        this.loader.runtimeFactory = this.runtimeFactory;\r\n\r\n        //Instantiate Discovery Lib for notification testing\r\n        // this.discovery = new Discovery(\"hyperty://localhost/test\", this.runtimeURL, this.messageBus);\r\n        // this.loadStub(\"localhost\");\r\n        // setTimeout(() => {\r\n        //   this.discovery.discoverHypertiesDO(\"user://google.com/openidtest20@gmail.com\")\r\n        //   .then(hyperties => {\r\n        //     hyperties.forEach(hyperty =>{\r\n        //       hyperty.onLive(() => log.log(`Notification from ${hyperty.data.hypertyID} changed to live`));\r\n        //       hyperty.onDisconnected(() => log.log(`Notification from ${hyperty.data.hypertyID} changed to disconnected`));\r\n        //     });\r\n        //   });\r\n        // }, 2000);\r\n\r\n\r\n        // this.subscriptionManager.init().then(()=>{\r\n        //   resolve(true);\r\n        // });\r\n\r\n        const prepareComponents = [];\r\n        prepareComponents.push(this.subscriptionManager.init());\r\n        prepareComponents.push(this.identityModule.init(guid));\r\n        prepareComponents.push(cryptoManager_CryptoManager.loadSessionKeys());\r\n        prepareComponents.push(this.registry.loadRegistry());\r\n        prepareComponents.push(this._dataObjectsStorage.loadRemote());\r\n\r\n        Promise.all(prepareComponents).then((result) => {\r\n          if (result.length === 5) {\r\n            resolve(true);\r\n          } else {\r\n            reject('[RuntimeUA._loadComponents] Error ] ', result);\r\n          }\r\n        }).catch((reason) => {\r\n          throw Error(reason);\r\n        });\r\n\r\n      } catch (e) {\r\n        reject(e);\r\n      }\r\n\r\n    });\r\n\r\n  }\r\n\r\n  /**\r\n   * Deploy Hyperty from Catalogue URL\r\n   *\r\n   * @see https://github.com/reTHINK-project/specs/tree/master/datamodel/core/address\r\n   *\r\n   * @param {URL.HypertyCatalogueURL} hypertyCatalogueURL - The Catalogue URL used to identify descriptors in the Catalogue.\r\n   * @param {boolean|URL.HypertyURL} [reuseURL=false] reuseURL - reuseURL is used to reuse the hypertyURL previously registred, by default the reuse is disabled;\r\n   * @param {URL} appURL - the app url address; // TODO: improve this description;\r\n   * @returns {Promise<Boolean, Error>} this is Promise and returns true if all components are loaded with success or an error if someone fails.\r\n   *\r\n   * @memberOf RuntimeUA\r\n   */\r\n  loadHyperty(hypertyCatalogueURL, reuseURL = false, appURL) {\r\n\r\n    if (!hypertyCatalogueURL) throw new Error('Hyperty descriptor url parameter is needed');\r\n    return this.loader.loadHyperty(hypertyCatalogueURL, reuseURL, appURL);\r\n\r\n  }\r\n\r\n  /**\r\n  * Deploy Stub from Catalogue URL or domain url\r\n  * @param  {URL.URL}     domain          domain\r\n  */\r\n  loadStub(protocolstubCatalogueURL) {\r\n\r\n    if (!protocolstubCatalogueURL) throw new Error('ProtoStub descriptor url parameter is needed');\r\n    return this.loader.loadStub(protocolstubCatalogueURL);\r\n\r\n  }\r\n\r\n  /**\r\n  * Deploy idpProxy from Catalogue URL or domain url\r\n  * @param  {URL.URL}     domain          domain\r\n  */\r\n  loadIdpProxy(ipdProxyCatalogueURL) {\r\n    RuntimeUA_log.log('ipdProxyCatalogueURL', ipdProxyCatalogueURL);\r\n\r\n    if (!ipdProxyCatalogueURL) throw new Error('The IDP Proxy URL is a needed parameter, could be a DOMAIN or a URL');\r\n    return this.loader.loadIdpProxy(ipdProxyCatalogueURL);\r\n  }\r\n\r\n  /**\r\n   * Used to close all the runtime; Unregister all hyperties;\r\n   * @return {Promise<Boolean>} result of the close method, with true or false to the operation success;\r\n   */\r\n  close(logOut) {\r\n    console.log('Runtime core logout: ', logOut);\r\n    let _this = this;\r\n    if (logOut === true) {\r\n      this.identityHandler.reset();\r\n    }\r\n\r\n    RuntimeUA_log.info('Unregister all hyperties');\r\n    return new Promise(function (resolve, reject) {\r\n\r\n      _this.registry.unregisterAllHyperties().then(function (result) {\r\n        RuntimeUA_log.info('All the hyperties are unregisted with Success:', result);\r\n        resolve(true);\r\n      }).catch(function (reason) {\r\n        RuntimeUA_log.error('Failed to unregister the hyperties', reason);\r\n        reject(false);\r\n      });\r\n\r\n    });\r\n\r\n  }\r\n\r\n  /**\r\n   * Used to reset the runtime by deleting all data from the storage manager;\r\n   * @return {Promise<Boolean>} result of the reset method, with true or false to the operation success;\r\n   */\r\n  reset() {\r\n    console.log('RuntimeUA.Runtime core reset: ');\r\n\r\n    let reseting = [];\r\n    let _this = this;\r\n\r\n    return new Promise((resolve, reject) => {\r\n      //TODO: delegate db reset operation to each component\r\n      //    this.identityManager.reset();\r\n\r\n      this._dataObjectsStorage.deleteRemotes().then(()=>{\r\n        return;\r\n      }).\r\n      then(() => {\r\n        this.storages.identity.get(false, false, 'identities').then((identities) => {\r\n          let identitiesKeys = Object.keys(identities);\r\n  \r\n          identitiesKeys.forEach((key) => {\r\n            reseting.push(this.storages.identity.delete(key, false, 'identities'));\r\n  \r\n          });\r\n  \r\n          reseting.push(this.storages.capabilities.delete('capabilities'));\r\n          reseting.push(this.storages.cryptoManager.delete('userAsymmetricKey'));\r\n          reseting.push(this.storages.hypertyResources.delete('hypertyResources'));\r\n          reseting.push(this.storages.identity.delete('accessTokens'));\r\n          reseting.push(this.storages.registry.delete('registry:DataObjectURLs'));\r\n          reseting.push(this.storages.registry.delete('registry:HypertyURLs'));\r\n          reseting.push(this.storages.runtime.delete('p2pHandler:URL'));\r\n          reseting.push(this.storages.runtime.delete('runtime:URL'));\r\n          //    reseting.push(this.storages.runtimeCatalogue.delete('runtimeCatalogue'));\r\n          reseting.push(this.storages.subscriptions.delete('subscriptions'));\r\n          reseting.push(this.storages.syncherManager.delete('syncherManager:ObjectURLs'));\r\n          reseting.push(this.storages.syncherManager.delete('remotes'));\r\n  \r\n          Promise.all(reseting).then((result) => {\r\n  \r\n            RuntimeUA_log.info('[RuntimeUA.reset] reset with Success:', result);\r\n            return resolve(true);\r\n          }).catch(function (reason) {\r\n            RuntimeUA_log.error('Failed to reset all DBs', reason);\r\n            resolve(false);\r\n          });\r\n        });\r\n      })\r\n\r\n    });\r\n\r\n  }\r\n}\r\n\r\n/* harmony default export */ var runtime_RuntimeUA = __webpack_exports__[\"default\"] = (RuntimeUA_RuntimeUA);\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMzExLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vW25hbWVdLy4vc3JjL2xvZ0xldmVscy5qcz83ZDM0Iiwid2VicGFjazovL1tuYW1lXS8uL3NyYy9ydW50aW1lL3J1bnRpbWVVdGlscy5qcz83YTFhIiwid2VicGFjazovL1tuYW1lXS8uL3NyYy91dGlscy91dGlscy5qcz9mYTdkIiwid2VicGFjazovL1tuYW1lXS8uL3NyYy9zeW5jaGVyL1Byb3h5T2JqZWN0LmpzPzRlZWIiLCJ3ZWJwYWNrOi8vW25hbWVdLy4vc3JjL3N5bmNoZXIvRGF0YU9iamVjdENoaWxkLmpzPzIxZTEiLCJ3ZWJwYWNrOi8vW25hbWVdLy4vc3JjL2h5cGVydHktcmVzb3VyY2UvSHlwZXJ0eVJlc291cmNlLmpzP2NjNmMiLCJ3ZWJwYWNrOi8vW25hbWVdLy4vc3JjL3V0aWxzL0ltYWdlVG9vbHMuanM/MWUwNyIsIndlYnBhY2s6Ly9bbmFtZV0vLi9zcmMvaHlwZXJ0eS1yZXNvdXJjZS9GaWxlSHlwZXJ0eVJlc291cmNlLmpzPzUzNmYiLCJ3ZWJwYWNrOi8vW25hbWVdLy4vc3JjL2h5cGVydHktcmVzb3VyY2UvSHlwZXJ0eVJlc291cmNlRmFjdG9yeS5qcz9mMDgzIiwid2VicGFjazovL1tuYW1lXS8uL3NyYy9zeW5jaGVyL0RhdGFPYmplY3QuanM/OWQwMiIsIndlYnBhY2s6Ly9bbmFtZV0vLi9zcmMvc3luY2hlci9EYXRhT2JqZWN0UmVwb3J0ZXIuanM/MjNmZiIsIndlYnBhY2s6Ly9bbmFtZV0vLi9zcmMvc3luY2hlci9EYXRhT2JqZWN0T2JzZXJ2ZXIuanM/YzVjMyIsIndlYnBhY2s6Ly9bbmFtZV0vLi9zcmMvc3luY2hlci9EYXRhUHJvdmlzaW9uYWwuanM/NDA0NyIsIndlYnBhY2s6Ly9bbmFtZV0vLi9zcmMvc3luY2hlci9TeW5jaGVyLmpzPzE2ZDgiLCJ3ZWJwYWNrOi8vW25hbWVdLy4vc3JjL3N5bmNoZXIvTm90aWZpY2F0aW9uSGFuZGxlci5qcz8yOGIyIiwid2VicGFjazovL1tuYW1lXS8uL3NyYy9pZGVudGl0eS9JZGVudGl0eU1hbmFnZXIuanM/MTYzOCIsIndlYnBhY2s6Ly9bbmFtZV0vLi9zcmMvZGlzY292ZXJ5L1JlZ2lzdHJhdGlvblN0YXR1cy5qcz83Yzg1Iiwid2VicGFjazovL1tuYW1lXS8uL3NyYy9kaXNjb3ZlcnkvRGlzY292ZXJlZE9iamVjdC5qcz8wMjM5Iiwid2VicGFjazovL1tuYW1lXS8uL3NyYy9kaXNjb3ZlcnkvRGlzY292ZXJ5LmpzPzRhNDYiLCJ3ZWJwYWNrOi8vW25hbWVdLy4vc3JjL3V0aWxzL1NlYXJjaC5qcz9mYzlhIiwid2VicGFjazovL1tuYW1lXS8uL3NyYy91dGlscy9FdmVudEVtaXR0ZXIuanM/OGE4YSIsIndlYnBhY2s6Ly9bbmFtZV0vLi9zcmMvY29udGV4dE1hbmFnZXIvQ29udGV4dE9ic2VydmVyLmpzP2NjZjAiLCJ3ZWJwYWNrOi8vW25hbWVdLy4vc3JjL2NvbnRleHRNYW5hZ2VyL0NvbnRleHRSZXBvcnRlci5qcz8yZGY4Iiwid2VicGFjazovL1tuYW1lXS8uL3NyYy9pZGVudGl0eS9Vc2VyUHJvZmlsZS5qcz81ODU4Iiwid2VicGFjazovL1tuYW1lXS8uL3NyYy9pZGVudGl0eS9NZXNzYWdlQm9keUlkZW50aXR5LmpzPzc1NDkiLCJ3ZWJwYWNrOi8vW25hbWVdLy4vc3JjL2NoYXRNYW5hZ2VyL2NvbW11bmljYXRpb24uanM/Mzc5YiIsIndlYnBhY2s6Ly9bbmFtZV0vLi9zcmMvY2hhdE1hbmFnZXIvSW52aXRhdGlvbnNIYW5kbGVyLmpzPzI3ZDAiLCJ3ZWJwYWNrOi8vW25hbWVdLy4vc3JjL2NoYXRNYW5hZ2VyL0NoYXRDb250cm9sbGVyLmpzPzFkOWIiLCJ3ZWJwYWNrOi8vW25hbWVdLy4vc3JjL2NoYXRNYW5hZ2VyL1VzZXJJbmZvLmpzPzU3ZDQiLCJ3ZWJwYWNrOi8vW25hbWVdLy4vc3JjL2NoYXRNYW5hZ2VyL0NoYXRNYW5hZ2VyLmpzPzhkYWYiLCJ3ZWJwYWNrOi8vW25hbWVdLy4vc3JjL2NoYXRNYW5hZ2VyL0NoYXQuanM/MDBiZCIsIndlYnBhY2s6Ly9bbmFtZV0vLi9zcmMvY2hhdE1hbmFnZXIvU2ltcGxlQ2hhdE1hbmFnZXIuanM/YTk1NSIsIndlYnBhY2s6Ly9bbmFtZV0vLi9zcmMvc2FuZGJveC9TYW5kYm94RmFjdG9yeS5qcz8wYTZhIiwid2VicGFjazovL1tuYW1lXS8uL3NyYy9zYW5kYm94L1NhbmRib3hSZWdpc3RyeS5qcz84YmU0Iiwid2VicGFjazovL1tuYW1lXS8uL3NyYy9idXMvQnVzLmpzPzJlZjIiLCJ3ZWJwYWNrOi8vW25hbWVdLy4vc3JjL2J1cy9NaW5pQnVzLmpzP2Q5YWQiLCJ3ZWJwYWNrOi8vW25hbWVdLy4vc3JjL3NhbmRib3gvU2FuZGJveC5qcz83NTYzIiwid2VicGFjazovL1tuYW1lXS8uL3NyYy9hbGxvY2F0aW9uL0FkZHJlc3NBbGxvY2F0aW9uLmpzPzU2OGQiLCJ3ZWJwYWNrOi8vW25hbWVdLy4vc3JjL3JlZ2lzdHJ5L1JlZ2lzdHJ5RGF0YU1vZGVsLmpzP2M2OWYiLCJ3ZWJwYWNrOi8vW25hbWVdLy4vc3JjL3JlZ2lzdHJ5L0h5cGVydHlJbnN0YW5jZS5qcz9hYjZhIiwid2VicGFjazovL1tuYW1lXS8uL3NyYy9yZWdpc3RyeS9Eb21haW5SZWdpc3RyYXRpb24uanM/ZWRlMSIsIndlYnBhY2s6Ly9bbmFtZV0vLi9zcmMvcmVnaXN0cnkvUDJQQ29ubmVjdGlvblJlc29sdmUuanM/NjJiZiIsIndlYnBhY2s6Ly9bbmFtZV0vLi9zcmMvdXRpbHMvV2F0Y2hpbmdZb3UuanM/MTExZiIsIndlYnBhY2s6Ly9bbmFtZV0vLi9zcmMvVXRpbHMuanM/OWM4ZSIsIndlYnBhY2s6Ly9bbmFtZV0vLi9zcmMvcmVnaXN0cnkvUmVnaXN0cnkuanM/ZDdiZCIsIndlYnBhY2s6Ly9bbmFtZV0vLi9zcmMvcnVudGltZS9ydW50aW1lQ29uZmlndXJhdGlvbi5qcz8wODNkIiwid2VicGFjazovL1tuYW1lXS8uL3NyYy9pZGVudGl0eS9JZGVudGl0aWVzLmpzP2M0MjAiLCJ3ZWJwYWNrOi8vW25hbWVdLy4vc3JjL2lkZW50aXR5L0d1aUZha2UuanM/OTA3ZSIsIndlYnBhY2s6Ly9bbmFtZV0vLi9zcmMvaWRlbnRpdHkvSWRlbnRpdHlNb2R1bGUuanM/NGVjNCIsIndlYnBhY2s6Ly9bbmFtZV0vLi9zcmMvcnVudGltZS9Nc2dCdXNIYW5kbGVycy5qcz83NjM3Iiwid2VicGFjazovL1tuYW1lXS8uL3NyYy9pZGVudGl0eS9JZGVudGl0eUhhbmRsZXIuanM/MzJmNSIsIndlYnBhY2s6Ly9bbmFtZV0vLi9zcmMvcG9saWN5L0FjdGlvbnNTZXJ2aWNlLmpzPzllNzIiLCJ3ZWJwYWNrOi8vW25hbWVdLy4vc3JjL3BvbGljeS9PcGVyYXRvcnMuanM/M2IyZiIsIndlYnBhY2s6Ly9bbmFtZV0vLi9zcmMvcG9saWN5L1BEUC5qcz8yMmVkIiwid2VicGFjazovL1tuYW1lXS8uL3NyYy9wb2xpY3kvY29tYmluaW5nQWxnb3JpdGhtcy9BbGxvd092ZXJyaWRlcy5qcz8wZDE3Iiwid2VicGFjazovL1tuYW1lXS8uL3NyYy9wb2xpY3kvY29tYmluaW5nQWxnb3JpdGhtcy9CbG9ja092ZXJyaWRlcy5qcz83ZDY3Iiwid2VicGFjazovL1tuYW1lXS8uL3NyYy9wb2xpY3kvY29tYmluaW5nQWxnb3JpdGhtcy9GaXJzdEFwcGxpY2FibGUuanM/YTEzMiIsIndlYnBhY2s6Ly9bbmFtZV0vLi9zcmMvcG9saWN5L2NvbmRpdGlvbnMvQ29uZGl0aW9uLmpzPzMzMTUiLCJ3ZWJwYWNrOi8vW25hbWVdLy4vc3JjL3BvbGljeS9jb25kaXRpb25zL1N1YnNjcmlwdGlvbkNvbmRpdGlvbi5qcz83ZTFiIiwid2VicGFjazovL1tuYW1lXS8uL3NyYy9wb2xpY3kvY29uZGl0aW9ucy9BZHZhbmNlZENvbmRpdGlvbi5qcz85YzMyIiwid2VicGFjazovL1tuYW1lXS8uL3NyYy9wb2xpY3kvUnVsZS5qcz81ZGQ4Iiwid2VicGFjazovL1tuYW1lXS8uL3NyYy9wb2xpY3kvUG9saWN5LmpzP2QxYWQiLCJ3ZWJwYWNrOi8vW25hbWVdLy4vc3JjL3BvbGljeS9QRVAuanM/OWExZiIsIndlYnBhY2s6Ly9bbmFtZV0vLi9zcmMvYnVzL1BpcGVsaW5lLmpzPzhmOGIiLCJ3ZWJwYWNrOi8vW25hbWVdLy4vc3JjL2J1cy9NZXNzYWdlQnVzLmpzPzk5NWIiLCJ3ZWJwYWNrOi8vW25hbWVdLy4vc3JjL2NyeXB0b01hbmFnZXIvdXRmOC5qcz85ZGFlIiwid2VicGFjazovL1tuYW1lXS8uL3NyYy9jcnlwdG9NYW5hZ2VyL0NyeXB0by5qcz85MzMyIiwid2VicGFjazovL1tuYW1lXS8uL3NyYy9jcnlwdG9NYW5hZ2VyL0NyeXB0b01hbmFnZXIuanM/YmI0YyIsIndlYnBhY2s6Ly9bbmFtZV0vLi9zcmMvcnVudGltZS9Mb2FkZXIuanM/ZThiZCIsIndlYnBhY2s6Ly9bbmFtZV0vLi9zcmMvcnVudGltZS9TdG9yYWdlLmpzPzczMzgiLCJ3ZWJwYWNrOi8vW25hbWVdLy4vc3JjL3J1bnRpbWUvRGVzY3JpcHRvcnMuanM/YzYyZiIsIndlYnBhY2s6Ly9bbmFtZV0vLi9zcmMvZGlzY292ZXJ5L0NvcmVEaXNjb3ZlcnkuanM/YmY3NyIsIndlYnBhY2s6Ly9bbmFtZV0vLi9zcmMvc3RvcmUtb2JqZWN0cy9EYXRhT2JqZWN0c1N0b3JhZ2UuanM/ODlkNyIsIndlYnBhY2s6Ly9bbmFtZV0vLi9zcmMvdXRpbHMvUHJvbWlzZVF1ZXVlLmpzP2Q4NjIiLCJ3ZWJwYWNrOi8vW25hbWVdLy4vc3JjL2h5cGVydHktcmVzb3VyY2UvSHlwZXJ0eVJlc291cmNlc1N0b3JhZ2UuanM/ZjllOSIsIndlYnBhY2s6Ly9bbmFtZV0vLi9zcmMvc3luY2hlci9TdWJzY3JpcHRpb24uanM/Mjg5OSIsIndlYnBhY2s6Ly9bbmFtZV0vLi9zcmMvc3luY2hlci9SZXBvcnRlck9iamVjdC5qcz81ZjllIiwid2VicGFjazovL1tuYW1lXS8uL3NyYy9zeW5jaGVyL09ic2VydmVyT2JqZWN0LmpzP2FhMzgiLCJ3ZWJwYWNrOi8vW25hbWVdLy4vc3JjL3N5bmNoZXIvU3luY2hlck1hbmFnZXIuanM/NjU5OCIsIndlYnBhY2s6Ly9bbmFtZV0vLi9zcmMvc3Vic2NyaXB0aW9uTWFuYWdlci9TdWJzY3JpcHRpb24uanM/Nzk2MCIsIndlYnBhY2s6Ly9bbmFtZV0vLi9zcmMvc3Vic2NyaXB0aW9uTWFuYWdlci9TdWJzY3JpcHRpb25NYW5hZ2VyLmpzP2QwMjMiLCJ3ZWJwYWNrOi8vW25hbWVdLy4vc3JjL3BvbGljeS9SZVRoaW5rQ3R4LmpzP2NjMzEiLCJ3ZWJwYWNrOi8vW25hbWVdLy4vc3JjL3BvbGljeS9jb250ZXh0L1J1bnRpbWVDb3JlQ3R4LmpzPzE2NGQiLCJ3ZWJwYWNrOi8vW25hbWVdLy4vc3JjL3J1bnRpbWUtY2F0YWxvZ3VlL1JldGhpbmtPYmplY3QuanM/YjkwYSIsIndlYnBhY2s6Ly9bbmFtZV0vLi9zcmMvcnVudGltZS1jYXRhbG9ndWUvQ2F0YWxvZ3VlRGF0YU9iamVjdC5qcz9mZTMxIiwid2VicGFjazovL1tuYW1lXS8uL3NyYy9ydW50aW1lLWNhdGFsb2d1ZS9Tb3VyY2VQYWNrYWdlLmpzP2FlMjkiLCJ3ZWJwYWNrOi8vW25hbWVdLy4vc3JjL3J1bnRpbWUtY2F0YWxvZ3VlL0h5cGVydHlEZXNjcmlwdG9yLmpzP2VhOWMiLCJ3ZWJwYWNrOi8vW25hbWVdLy4vc3JjL3J1bnRpbWUtY2F0YWxvZ3VlL1Byb3RvY29sU3R1YkRlc2NyaXB0b3IuanM/YjBjYiIsIndlYnBhY2s6Ly9bbmFtZV0vLi9zcmMvcnVudGltZS1jYXRhbG9ndWUvSHlwZXJ0eVJ1bnRpbWVEZXNjcmlwdG9yLmpzP2VlMjgiLCJ3ZWJwYWNrOi8vW25hbWVdLy4vc3JjL3J1bnRpbWUtY2F0YWxvZ3VlL0h5cGVydHlJbnRlcmNlcHRvckRlc2NyaXB0b3IuanM/YzY0YiIsIndlYnBhY2s6Ly9bbmFtZV0vLi9zcmMvcnVudGltZS1jYXRhbG9ndWUvRGF0YU9iamVjdFNjaGVtYS5qcz9mMTIzIiwid2VicGFjazovL1tuYW1lXS8uL3NyYy9ydW50aW1lLWNhdGFsb2d1ZS9DYXRhbG9ndWVEYXRhT2JqZWN0RmFjdG9yeS5qcz82ZTM0Iiwid2VicGFjazovL1tuYW1lXS8uL3NyYy9ydW50aW1lLWNhdGFsb2d1ZS9SdW50aW1lQ2F0YWxvZ3VlLmpzPzQwYTYiLCJ3ZWJwYWNrOi8vW25hbWVdLy4vc3JjL3J1bnRpbWUvUnVudGltZVVBLmpzPzgwYjAiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGxvZyBmcm9tICdsb2dsZXZlbCc7XHJcblxyXG5jb25zdCBhID0gbG9nLmdldExvZ2dlcignYWRkcmVzcy1hbGxvY2F0aW9uJyk7XHJcbmNvbnN0IGIgPSBsb2cuZ2V0TG9nZ2VyKCdCdXMnKTtcclxuY29uc3QgYyA9IGxvZy5nZXRMb2dnZXIoJ01lc3NhZ2VCdXMnKTtcclxuY29uc3QgZCA9IGxvZy5nZXRMb2dnZXIoJ0NvcmVEaXNjb3ZlcnknKTtcclxuY29uc3QgZSA9IGxvZy5nZXRMb2dnZXIoJ1N0b3JhZ2VNYW5hZ2VyJyk7XHJcbmNvbnN0IGYgPSBsb2cuZ2V0TG9nZ2VyKCdIeXBlcnR5UmVzb3VyY2VzU3RvcmFnZScpO1xyXG5jb25zdCBnID0gbG9nLmdldExvZ2dlcignSWRlbnRpdHlNb2R1bGUnKTtcclxuY29uc3QgaCA9IGxvZy5nZXRMb2dnZXIoJ1BFUCcpO1xyXG5jb25zdCBpID0gbG9nLmdldExvZ2dlcignUDJQQ29ubmVjdGlvblJlc29sdmUnKTtcclxuY29uc3QgaiA9IGxvZy5nZXRMb2dnZXIoJ1JlZ2lzdHJ5Jyk7XHJcbmNvbnN0IGsgPSBsb2cuZ2V0TG9nZ2VyKCdSdW50aW1lVUEnKTtcclxuY29uc3QgbCA9IGxvZy5nZXRMb2dnZXIoJ0xvYWRlcicpO1xyXG5jb25zdCBtID0gbG9nLmdldExvZ2dlcignRGVzY3JpcHRvcnMnKTtcclxuY29uc3QgbiA9IGxvZy5nZXRMb2dnZXIoJ0RhdGFPYmplY3RzU3RvcmFnZScpO1xyXG5jb25zdCBvID0gbG9nLmdldExvZ2dlcignU3Vic2NyaXB0aW9uJyk7XHJcbmNvbnN0IHAgPSBsb2cuZ2V0TG9nZ2VyKCdTdWJzY3JpcHRpb25NYW5hZ2VyJyk7XHJcbmNvbnN0IHEgPSBsb2cuZ2V0TG9nZ2VyKCdPYnNlcnZlck9iamVjdCcpO1xyXG5jb25zdCByID0gbG9nLmdldExvZ2dlcignUmVwb3J0ZXJPYmplY3QnKTtcclxuY29uc3QgcyA9IGxvZy5nZXRMb2dnZXIoJ1N5blN1YnNjcmlwdGlvbicpO1xyXG5jb25zdCB0ID0gbG9nLmdldExvZ2dlcignU3luY2hlck1hbmFnZXInKTtcclxuY29uc3QgdSA9IGxvZy5nZXRMb2dnZXIoJ0lkZW50aXR5SGFuZGxlcicpO1xyXG5jb25zdCB2ID0gbG9nLmdldExvZ2dlcignQ3J5cHRvTWFuYWdlcicpO1xyXG5jb25zdCB4ID0gbG9nLmdldExvZ2dlcignUGlwZWxpbmUnKTtcclxuY29uc3QgZjEgPSBsb2cuZ2V0TG9nZ2VyKCdTeW5jaGVyJyk7XHJcbmNvbnN0IGYyID0gbG9nLmdldExvZ2dlcignUnVudGltZUNhdGFsb2d1ZScpO1xyXG5cclxuXHJcbmV4cG9ydCB7IGxvZyB9O1xyXG5cclxuLyoqXHJcbiAgMCBhY3R1YWwgbG9nZ2luZyBtZXRob2RzLCBvcmRlcmVkIGFuZCBhdmFpbGFibGUgYXM6XHJcblxyXG4gICAgICAwIC0gbG9nLnRyYWNlKG1zZylcclxuICAgICAgMSAtIGxvZy5kZWJ1Zyhtc2cpXHJcbiAgICAgIDIgLSBsb2cuaW5mbyhtc2cpXHJcbiAgICAgIDMgLSBsb2cud2Fybihtc2cpXHJcbiAgICAgIDQgLSBsb2cuZXJyb3IobXNnKVxyXG5cclxuICBsb2cubG9nKG1zZykgaXMgYWxzbyBhdmFpbGFibGUsIGFzIGFuIGFsaWFzIGZvciBsb2cuZGVidWcobXNnKSwgdG8gaW1wcm92ZSBjb21wYXRpYmlsaXR5IHdpdGggY29uc29sZSwgYW5kIG1ha2UgbWlncmF0aW9uIGVhc2llci5cclxuXHJcbiAgRXhhY3Qgb3V0cHV0IGZvcm1hdHRpbmcgb2YgdGhlc2Ugd2lsbCBkZXBlbmQgb24gdGhlIGNvbnNvbGUgYXZhaWxhYmxlIGluIHRoZSBjdXJyZW50IGNvbnRleHQgb2YgeW91ciBhcHBsaWNhdGlvbi4gRm9yIGV4YW1wbGUsIG1hbnkgZW52aXJvbm1lbnRzIHdpbGwgaW5jbHVkZSBhIGZ1bGwgc3RhY2sgdHJhY2Ugd2l0aCBhbGwgdHJhY2UoKSBjYWxscywgYW5kIGljb25zIG9yIHNpbWlsYXIgdG8gaGlnaGxpZ2h0IG90aGVyIGNhbGxzLlxyXG5cclxuICBUaGVzZSBtZXRob2RzIHNob3VsZCBuZXZlciBmYWlsIGluIGFueSBlbnZpcm9ubWVudCwgZXZlbiBpZiBubyBjb25zb2xlIG9iamVjdCBpcyBjdXJyZW50bHkgYXZhaWxhYmxlLCBhbmQgc2hvdWxkIGFsd2F5cyBmYWxsIGJhY2sgdG8gYW4gYXZhaWxhYmxlIGxvZyBtZXRob2QgZXZlbiBpZiB0aGUgc3BlY2lmaWMgbWV0aG9kIGNhbGxlZCAoZS5nLiB3YXJuKSBpc24ndCBhdmFpbGFibGUuXHJcblxyXG4gIEJlIGF3YXJlIHRoYXQgYWxsIHRoaXMgbWVhbnMgdGhhdCB0aGVzZSBtZXRob2Qgd29uJ3QgbmVjZXNzYXJpbHkgYWx3YXlzIHByb2R1Y2UgZXhhY3RseSB0aGUgb3V0cHV0IHlvdSBleHBlY3QgaW4gZXZlcnkgZW52aXJvbm1lbnQ7IGxvZ2xldmVsIG9ubHkgZ3VhcmFudGVlcyB0aGF0IHRoZXNlIG1ldGhvZHMgd2lsbCBuZXZlciBleHBsb2RlIG9uIHlvdSwgYW5kIHRoYXQgaXQgd2lsbCBjYWxsIHRoZSBtb3N0IHJlbGV2YW50IG1ldGhvZCBpdCBjYW4gZmluZCwgd2l0aCB5b3VyIGFyZ3VtZW50LiBGaXJlZm94IGlzIGEgbm90YWJsZSBleGFtcGxlIGhlcmU6IGR1ZSB0byBhIGN1cnJlbnQgRmlyZWZveCBidWcgbG9nLnRyYWNlKG1zZykgY2FsbHMgaW4gRmlyZWZveCB3aWxsIHByaW50IG9ubHkgdGhlIHN0YWNrdHJhY2UsIGFuZCB3b24ndCBpbmNsdWRlIGFueSBwYXNzZWQgbWVzc2FnZSBhcmd1bWVudHMuXHJcblxyXG4qL1xyXG5cclxuXHJcbi8vIGFkZHJlc3MtYWxsb2NhdGlvblxyXG5hLnNldExldmVsKDApO1xyXG5cclxuLy8gQnVzXHJcbmIuc2V0TGV2ZWwoMyk7XHJcblxyXG4vLyBNZXNzYWdlQnVzXHJcbmMuc2V0TGV2ZWwoMyk7XHJcblxyXG4vLyBDb3JlRGlzY292ZXJ5XHJcbmQuc2V0TGV2ZWwoNSk7XHJcblxyXG4vLyBTdG9yYWdlTWFuYWdlclxyXG5lLnNldExldmVsKDApO1xyXG5cclxuLy8gSHlwZXJ0eVJlc291cmNlc1N0b3JhZ2VcclxuZi5zZXRMZXZlbCgzKTtcclxuXHJcbi8vIElkZW50aXR5TW9kdWxlXHJcbmcuc2V0TGV2ZWwoMCk7XHJcblxyXG4vLyBQRVBcclxuaC5zZXRMZXZlbCgzKTtcclxuXHJcbi8vIFAyUENvbm5lY3Rpb25SZXNvbHZlXHJcbmkuc2V0TGV2ZWwoMyk7XHJcblxyXG4vLyBSZWdpc3RyeVxyXG5qLnNldExldmVsKDApO1xyXG5cclxuLy8gUnVudGltZVVBXHJcbmsuc2V0TGV2ZWwoMCk7XHJcblxyXG4vLyBMb2FkZXJcclxubC5zZXRMZXZlbCgwKTtcclxuXHJcbi8vIERlc2NyaXB0b3JzXHJcbm0uc2V0TGV2ZWwoMyk7XHJcblxyXG4vLyBEYXRhT2JqZWN0c1N0b3JhZ2Vcclxubi5zZXRMZXZlbCgwKTtcclxuXHJcbi8vIFN1YnNjcmlwdGlvblxyXG5vLnNldExldmVsKDMpO1xyXG5cclxuLy8gU3Vic2NyaXB0aW9uTWFuYWdlclxyXG5wLnNldExldmVsKDMpO1xyXG5cclxuLy8gT2JzZXJ2ZXJPYmplY3RcclxucS5zZXRMZXZlbCgwKTtcclxuXHJcbi8vIFJlcG9ydGVyT2JqZWN0XHJcbnIuc2V0TGV2ZWwoMCk7XHJcblxyXG4vLyBTeW5TdWJzY3JpcHRpb25cclxucy5zZXRMZXZlbCgzKTtcclxuXHJcbi8vIFN5bmNoZXJNYW5hZ2VyXHJcbnQuc2V0TGV2ZWwoMCk7XHJcblxyXG4vLyBJZGVudGl0eUhhbmRsZXJcclxudS5zZXRMZXZlbCgzKTtcclxuXHJcbi8vIENyeXB0b01hbmFnZXJcclxudi5zZXRMZXZlbCgwKTtcclxuXHJcbi8vIFBpcGVsaW5lXHJcbnguc2V0TGV2ZWwoMCk7XHJcblxyXG4vLyBTeW5jaGVyXHJcbmYxLnNldExldmVsKDApO1xyXG5cclxuLy8gU3luY2hlciBEYXRhT2JqZWN0T2JzZXJ2ZXJcclxuZjEuc2V0TGV2ZWwoMCk7XHJcblxyXG4vLyBSdW50aW1lQ2F0YWxvZ3VlXHJcbmYyLnNldExldmVsKDApO1xyXG4iLCJleHBvcnQgbGV0IHJ1bnRpbWVVdGlscyA9IHtcclxuICBydW50aW1lRGVzY3JpcHRvcjoge30sXHJcbiAgcnVudGltZUNhcGFiaWxpdGllczoge1xyXG4gICAgY29uc3RyYWludHM6IHt9XHJcbiAgfVxyXG59O1xyXG4iLCIvKipcclxuKiBDb3B5cmlnaHQgMjAxNiBQVCBJbm92YcOnw6NvIGUgU2lzdGVtYXMgU0FcclxuKiBDb3B5cmlnaHQgMjAxNiBJTkVTQy1JRFxyXG4qIENvcHlyaWdodCAyMDE2IFFVT0JJUyBORVRXT1JLUyBTTFxyXG4qIENvcHlyaWdodCAyMDE2IEZSQVVOSE9GRVItR0VTRUxMU0NIQUZUIFpVUiBGT0VSREVSVU5HIERFUiBBTkdFV0FORFRFTiBGT1JTQ0hVTkcgRS5WXHJcbiogQ29weXJpZ2h0IDIwMTYgT1JBTkdFIFNBXHJcbiogQ29weXJpZ2h0IDIwMTYgRGV1dHNjaGUgVGVsZWtvbSBBR1xyXG4qIENvcHlyaWdodCAyMDE2IEFwaXplZVxyXG4qIENvcHlyaWdodCAyMDE2IFRFQ0hOSVNDSEUgVU5JVkVSU0lUQVQgQkVSTElOXHJcbipcclxuKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4qIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuKlxyXG4qICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbipcclxuKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4qIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4qIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuKiovXHJcbi8qKlxyXG4gKiBTdXBwb3J0IG1vZHVsZSB3aXRoIHNvbWUgZnVuY3Rpb25zIHdpbGwgYmUgdXNlZnVsXHJcbiAqIEBtb2R1bGUgdXRpbHNcclxuICovXHJcblxyXG4vKipcclxuICogQHR5cGVkZWYgZGl2aWRlVVJMXHJcbiAqIEB0eXBlIE9iamVjdFxyXG4gKiBAcHJvcGVydHkge3N0cmluZ30gdHlwZSBUaGUgdHlwZSBvZiBVUkxcclxuICogQHByb3BlcnR5IHtzdHJpbmd9IGRvbWFpbiBUaGUgZG9tYWluIG9mIFVSTFxyXG4gKiBAcHJvcGVydHkge3N0cmluZ30gaWRlbnRpdHkgVGhlIGlkZW50aXR5IG9mIFVSTFxyXG4gKi9cclxuXHJcbi8qKlxyXG4gKiBEaXZpZGUgYW4gdXJsIGluIHR5cGUsIGRvbWFpbiBhbmQgaWRlbnRpdHlcclxuICogQHBhcmFtICB7VVJMLlVSTH0gdXJsIC0gdXJsIGFkZHJlc3NcclxuICogQHJldHVybiB7ZGl2aWRlVVJMfSB0aGUgcmVzdWx0IG9mIGRpdmlkZVVSTFxyXG4gKi9cclxuZXhwb3J0IGZ1bmN0aW9uIGRpdmlkZVVSTCh1cmwpIHtcclxuXHJcbiAgZnVuY3Rpb24gcmVjdXJzZSh2YWx1ZSkge1xyXG4gICAgY29uc3QgcmVnZXggPSAvKFthLXpBLVotXSopKDpcXC9cXC8oPzpcXC4pP3w6KShbLWEtekEtWjAtOUA6JS5fK34jPV17MiwyNTZ9KShbLWEtekEtWjAtOUA6JS5fK34jPS9dKikvZ2k7XHJcbiAgICBjb25zdCBzdWJzdCA9ICckMSwkMywkNCc7XHJcbiAgICBsZXQgcGFydHMgPSB2YWx1ZS5yZXBsYWNlKHJlZ2V4LCBzdWJzdCkuc3BsaXQoJywnKTtcclxuICAgIHJldHVybiBwYXJ0cztcclxuICB9XHJcblxyXG4gIGxldCBwYXJ0cyA9IHJlY3Vyc2UodXJsKTtcclxuXHJcbiAgLy8gSWYgdGhlIHVybCBoYXMgbm8gc2NoZW1lXHJcbiAgaWYgKHBhcnRzWzBdID09PSB1cmwgJiYgIXBhcnRzWzBdLmluY2x1ZGVzKCdAJykpIHtcclxuXHJcbiAgICBsZXQgcmVzdWx0ID0ge1xyXG4gICAgICB0eXBlOiAnJyxcclxuICAgICAgZG9tYWluOiB1cmwsXHJcbiAgICAgIGlkZW50aXR5OiAnJ1xyXG4gICAgfTtcclxuXHJcbiAgICBjb25zb2xlLndhcm4oJ1tEaXZpZGVVUkxdIERpdmlkZVVSTCBkb25cXCd0IHN1cHBvcnQgdXJsIHdpdGhvdXQgc2NoZW1lLiBQbGVhc2UgcmV2aWV3IHlvdXIgdXJsIGFkZHJlc3MnLCB1cmwpO1xyXG5cclxuICAgIHJldHVybiByZXN1bHQ7XHJcbiAgfVxyXG5cclxuICAvLyBjaGVjayBpZiB0aGUgdXJsIGhhcyB0aGUgc2NoZW1lIGFuZCBpbmNsdWRlcyBhbiBAXHJcbiAgaWYgKHBhcnRzWzBdID09PSB1cmwgJiYgcGFydHNbMF0uaW5jbHVkZXMoJ0AnKSkge1xyXG4gICAgbGV0IHNjaGVtZSA9IHBhcnRzWzBdID09PSB1cmwgPyAnc210cCcgOiBwYXJ0c1swXTtcclxuICAgIHBhcnRzID0gcmVjdXJzZShzY2hlbWUgKyAnOi8vJyArIHBhcnRzWzBdKTtcclxuICB9XHJcblxyXG4gIC8vIGlmIHRoZSBkb21haW4gaW5jbHVkZXMgYW4gQCwgZGl2aWRlIGl0IHRvIGRvbWFpbiBhbmQgaWRlbnRpdHkgcmVzcGVjdGl2ZWx5XHJcbiAgaWYgKHBhcnRzWzFdLmluY2x1ZGVzKCdAJykpIHtcclxuICAgIHBhcnRzWzJdID0gcGFydHNbMF0gKyAnOi8vJyArIHBhcnRzWzFdO1xyXG4gICAgcGFydHNbMV0gPSBwYXJ0c1sxXS5zdWJzdHIocGFydHNbMV0uaW5kZXhPZignQCcpICsgMSk7XHJcbiAgfSBcdC8qZWxzZSBpZiAocGFydHNbMl0uaW5jbHVkZXMoJy8nKSkge1xyXG4gICAgcGFydHNbMl0gPSBwYXJ0c1syXS5zdWJzdHIocGFydHNbMl0ubGFzdEluZGV4T2YoJy8nKSsxKTtcclxuICB9Ki9cclxuXHJcbiAgbGV0IHJlc3VsdCA9IHtcclxuICAgIHR5cGU6IHBhcnRzWzBdLFxyXG4gICAgZG9tYWluOiBwYXJ0c1sxXSxcclxuICAgIGlkZW50aXR5OiBwYXJ0c1syXVxyXG4gIH07XHJcblxyXG4gIHJldHVybiByZXN1bHQ7XHJcblxyXG59XHJcblxyXG4vKipcclxuICogQ2hlY2sgaWYgYW4gT2JqZWN0IGlzIGVtcHR5XHJcbiAqIEBwYXJhbSAge09iamVjdH0gb2JqZWN0IE9iamVjdCB0byBiZSBjaGVja2VkXHJcbiAqIEByZXR1cm4ge0Jvb2xlYW59ICAgICAgIHN0YXR1cyBvZiBPYmplY3QsIGVtcHR5IG9yIG5vdCAodHJ1ZXxmYWxzZSk7XHJcbiAqL1xyXG5leHBvcnQgZnVuY3Rpb24gZW1wdHlPYmplY3Qob2JqZWN0KSB7XHJcbiAgcmV0dXJuIE9iamVjdC5rZXlzKG9iamVjdCkubGVuZ3RoID4gMCA/IGZhbHNlIDogdHJ1ZTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIHNlY29uZHNTaW5jZUVwb2NoKCkge1xyXG4gIHJldHVybiBNYXRoLmZsb29yKERhdGUubm93KCkgLyAxMDAwKTtcclxufVxyXG5cclxuXHJcbi8qKlxyXG4gKiBNYWtlIGEgQ09QWSBvZiB0aGUgb3JpZ2luYWwgZGF0YVxyXG4gKiBAcGFyYW0gIHtPYmplY3R9ICBvYmogLSBvYmplY3QgdG8gYmUgY2xvbmVkXHJcbiAqIEByZXR1cm4ge09iamVjdH1cclxuICovXHJcbmV4cG9ydCBmdW5jdGlvbiBkZWVwQ2xvbmUob2JqKSB7XHJcbiAgLy9UT0RPOiBzaW1wbGUgYnV0IGluZWZmaWNpZW50IEpTT04gZGVlcCBjbG9uZS4uLlxyXG4gIGlmIChvYmopIHJldHVybiBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KG9iaikpO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gcmVtb3ZlUGF0aEZyb21VUkwodXJsKSB7XHJcbiAgbGV0IHNwbGl0VVJMID0gdXJsLnNwbGl0KCcvJyk7XHJcbiAgcmV0dXJuIHNwbGl0VVJMWzBdICsgJy8vJyArIHNwbGl0VVJMWzJdICsgJy8nICsgc3BsaXRVUkxbM107XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBPYnRhaW5zIHRoZSB1c2VyIFVSTCB0aGF0IGNvcnJlc3BvbmRzIHRvIGEgZ2l2ZW4gZW1haWxcclxuICogQHBhcmFtICB7c3RyaW5nfSB1c2VyRW1haWwgVGhlIHVzZXIgZW1haWxcclxuICogQHJldHVybiB7VVJMLlVSTH0gdXNlclVSTCBUaGUgdXNlciBVUkxcclxuICovXHJcbmV4cG9ydCBmdW5jdGlvbiBnZXRVc2VyVVJMRnJvbUVtYWlsKHVzZXJFbWFpbCkge1xyXG4gIGxldCBpbmRleE9mQXQgPSB1c2VyRW1haWwuaW5kZXhPZignQCcpO1xyXG4gIHJldHVybiAndXNlcjovLycgKyB1c2VyRW1haWwuc3Vic3RyaW5nKGluZGV4T2ZBdCArIDEsIHVzZXJFbWFpbC5sZW5ndGgpICsgJy8nICsgdXNlckVtYWlsLnN1YnN0cmluZygwLCBpbmRleE9mQXQpO1xyXG59XHJcblxyXG4vKipcclxuICogT2J0YWlucyB0aGUgdXNlciBlbWFpbCB0aGF0IGNvcnJlc3BvbmRzIHRvIGEgZ2l2ZW4gVVJMXHJcbiAqIEBwYXJhbSAge1VSTC5VUkx9IHVzZXJVUkwgVGhlIHVzZXIgVVJMXHJcbiAqIEByZXR1cm4ge3N0cmluZ30gdXNlckVtYWlsIFRoZSB1c2VyIGVtYWlsXHJcbiAqL1xyXG5leHBvcnQgZnVuY3Rpb24gZ2V0VXNlckVtYWlsRnJvbVVSTCh1c2VyVVJMKSB7XHJcbiAgbGV0IHVybCA9IGRpdmlkZVVSTCh1c2VyVVJMKTtcclxuICByZXR1cm4gdXJsLmlkZW50aXR5LnJlcGxhY2UoJy8nLCAnJykgKyAnQCcgKyB1cmwuZG9tYWluOyAvLyBpZGVudGl0eSBmaWVsZCBoYXMgJy9leGFtcGxlSUQnIGluc3RlYWQgb2YgJ2V4YW1wbGVJRCdcclxufVxyXG5cclxuLyoqXHJcbiAqIENoZWNrIGlmIHRoZSB1c2VyIGlkZW50aWZpZXIgaXMgYWxyZWFkeSBpbiB0aGUgVVJMIGZvcm1hdCwgaWYgbm90LCBjb252ZXJ0IHRvIFVSTCBmb3JtYXRcclxuICogQHBhcmFtICB7c3RyaW5nfSAgIGlkZW50aWZpZXIgIHVzZXIgaWRlbnRpZmllclxyXG4gKiBAcmV0dXJuIHtzdHJpbmd9ICAgdXNlclVSTCAgICB0aGUgdXNlciBVUkxcclxuICovXHJcbmV4cG9ydCBmdW5jdGlvbiBjb252ZXJ0VG9Vc2VyVVJMKGlkZW50aWZpZXIpIHtcclxuXHJcbiAgLy8gY2hlY2sgaWYgdGhlIGlkZW50aWZpZXIgaXMgYWxyZWFkeSBpbiB0aGUgdXJsIGZvcm1hdFxyXG4gIGlmIChpZGVudGlmaWVyLnN1YnN0cmluZygwLCA3KSA9PT0gJ3VzZXI6Ly8nKSB7XHJcbiAgICBsZXQgZGl2aWRlZFVSTCA9IGRpdmlkZVVSTChpZGVudGlmaWVyKTtcclxuXHJcbiAgICAvL2NoZWNrIGlmIHRoZSB1cmwgaXMgd2VsbCBmb3JtYXRlZFxyXG4gICAgaWYgKGRpdmlkZWRVUkwuZG9tYWluICYmIGRpdmlkZWRVUkwuaWRlbnRpdHkpIHtcclxuICAgICAgcmV0dXJuIGlkZW50aWZpZXI7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB0aHJvdyAndXNlclVSTCB3aXRoIHdyb25nIGZvcm1hdCc7XHJcbiAgICB9XHJcblxyXG4gIC8vaWYgbm90LCBjb252ZXJ0IHRoZSB1c2VyIGVtYWlsIHRvIFVSTCBmb3JtYXRcclxuICB9IGVsc2Uge1xyXG4gICAgcmV0dXJuIGdldFVzZXJVUkxGcm9tRW1haWwoaWRlbnRpZmllcik7XHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gaXNEYXRhT2JqZWN0VVJMKHVybCkge1xyXG4gIGxldCBzY2hlbWFzVG9JZ25vcmUgPSBbJ2RvbWFpbi1pZHAnLCAncnVudGltZScsICdkb21haW4nLCAnaHlwZXJ0eSddO1xyXG4gIGxldCBzcGxpdFVSTCA9ICh1cmwpLnNwbGl0KCc6Ly8nKTtcclxuICBsZXQgdXJsU2NoZW1hID0gc3BsaXRVUkxbMF07XHJcblxyXG4gIHJldHVybiBzY2hlbWFzVG9JZ25vcmUuaW5kZXhPZih1cmxTY2hlbWEpID09PSAtMTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGlzTGVnYWN5KHVybCkge1xyXG4gIGlmICh1cmwuc3BsaXQoJ0AnKS5sZW5ndGggPiAxKSB7XHJcbiAgICByZXR1cm4gdHJ1ZTtcclxuICB9IGVsc2Uge1xyXG4gICAgcmV0dXJuIGZhbHNlO1xyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGlzVVJMKHVybCkge1xyXG4gIHJldHVybiAodXJsKS5zcGxpdCgnLycpLmxlbmd0aCA+PSAzO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gaXNVc2VyVVJMKHVybCkge1xyXG4gIHJldHVybiBkaXZpZGVVUkwodXJsKS50eXBlID09PSAndXNlcic7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBpc0h5cGVydHlVUkwodXJsKSB7XHJcbiAgcmV0dXJuIGRpdmlkZVVSTCh1cmwpLnR5cGUgPT09ICdoeXBlcnR5JztcclxufVxyXG5cclxuLyoqXHJcbiAqIGdldCBpbmZvcm1hdGlvbiByZWxhdGl2ZSBlYWNoIGNvbXBvbmVudCBjb25maWd1cmVkIG9uIHJ1bnRpbWUgY29uZmlndXJhdGlvbjtcclxuICogQHBhcmFtICB7b2JqZWN0fSBjb25maWd1cmF0aW9uIG9iamVjdCB3aXRoIGFsbCBjb25maWd1cmF0aW9uXHJcbiAqIEBwYXJhbSAge3N0cmluZ30gY29tcG9uZW50ICAgICBzdHJpbmcgd2l0aCB0aGUgY29tcG9uZW50IHRvIGdldCB0aGUgY29uZmlndXJhdGlvbiwgbGlrZSwgcnVudGltZVVSTFMsIGNhdGFsb2d1ZVVSTHMsIG1zZ05vZGVVUkwsIGRvbWFpblJlZ2lzdHJ5VVJMO1xyXG4gKiBAcGFyYW0gIHtzdHJpbmd9IHJlc291cmNlICAgICAgdHlwZSBvZiByZXNvdXJjZSB0byBnZXQsIGxpa2UsIGNhdGFsb2d1ZSwgcnVudGltZVVBLCBwcm90b2NvbHN0dWIsIGlkcFByb3h5XHJcbiAqIEByZXR1cm4ge29iamVjdH0gICAgICAgICAgICAgICByZXR1cm4gYW4gb2JqZWN0IHdpdGggYWxsIGNvbmZpZ3VyYXRpb25zO1xyXG4gKi9cclxuZXhwb3J0IGZ1bmN0aW9uIGdldENvbmZpZ3VyYXRpb25SZXNvdXJjZXMoY29uZmlndXJhdGlvbiwgY29tcG9uZW50LCByZXNvdXJjZSkge1xyXG4gIGxldCBvYmplY3RSZXNvdXJjZSA9IGNvbmZpZ3VyYXRpb25bY29tcG9uZW50XTtcclxuICBsZXQgcmVzb3VyY2VUeXBlID0gb2JqZWN0UmVzb3VyY2VbcmVzb3VyY2VdO1xyXG5cclxuICByZXR1cm4gcmVzb3VyY2VUeXBlO1xyXG59XHJcblxyXG4vKipcclxuICogQnVpbGQgYSBmdWxsIHVybCB3aXRoIHRoZSBydW50aW1lIGNvbmZpZ3VyYXRpb247XHJcbiAqIEBwYXJhbSAge29iamVjdH0gY29uZmlndXJhdGlvbiBvYmplY3Qgd2l0aCBhbGwgY29uZmlndXJhdGlvblxyXG4gKiBAcGFyYW0gIHtzdHJpbmd9IGNvbXBvbmVudCAgICAgc3RyaW5nIHdpdGggdGhlIGNvbXBvbmVudCB0byBnZXQgdGhlIGNvbmZpZ3VyYXRpb24sIGxpa2UsIHJ1bnRpbWVVUkxTLCBjYXRhbG9ndWVVUkxzLCBtc2dOb2RlVVJMLCBkb21haW5SZWdpc3RyeVVSTDtcclxuICogQHBhcmFtICB7c3RyaW5nfSByZXNvdXJjZSAgICAgIHR5cGUgb2YgcmVzb3VyY2UgdG8gZ2V0LCBsaWtlLCBjYXRhbG9ndWUsIHJ1bnRpbWVVQSwgcHJvdG9jb2xzdHViLCBpZHBQcm94eVxyXG4gKiBAcGFyYW0gIHtzdHJpbmd9IHR5cGUgICAgICAgICAgcmVzb3VyY2UgdG8gZ2V0LCBsaWtlIGEgaHlwZXJ0eSBuYW1lIG9yIHByb3RvY29sc3R1YiBuYW1lO1xyXG4gKiBAcGFyYW0gIHtib29sZWFufSB1c2VGYWxsYmFjayAgaWYgdHJ1ZSB0aGUgZnVuY3Rpb24gd2lsbCBjaGVjayBpZiBoYXZlIGEgZmFsbGJhY2sgdXJsO1xyXG4gKiBAcmV0dXJuIHtzdHJpbmd9ICAgICAgICAgICAgICAgcGFydGlhbCB1cmwgdG8gY29udGFjdCB0aGUgcmVzb3VyY2U7XHJcbiAqL1xyXG5leHBvcnQgZnVuY3Rpb24gYnVpbGRVUkwoY29uZmlndXJhdGlvbiwgY29tcG9uZW50LCB0eXBlLCByZXNvdXJjZSwgdXNlRmFsbGJhY2sgPSBmYWxzZSkge1xyXG4gIGxldCBvYmplY3RSZXNvdXJjZSA9IGNvbmZpZ3VyYXRpb25bY29tcG9uZW50XTtcclxuICBsZXQgdXJsO1xyXG5cclxuICBpZiAoIW9iamVjdFJlc291cmNlLmhhc093blByb3BlcnR5KHR5cGUpKSB7XHJcbiAgICB0aHJvdyBFcnJvcignVGhlIGNvbmZpZ3VyYXRpb24gJyArIEpTT04uc3RyaW5naWZ5KG9iamVjdFJlc291cmNlLCAnJywgMikgKyAnIGRvblxcJ3QgaGF2ZSB0aGUgJyArIHR5cGUgKyAnIHJlc291cmNlIHlvdSBhcmUgbG9va2luZyBmb3InKTtcclxuICB9XHJcblxyXG4gIGxldCByZXNvdXJjZVR5cGUgPSBvYmplY3RSZXNvdXJjZVt0eXBlXTtcclxuXHJcblxyXG4gIGlmICh0eXBlKSB7XHJcbiAgICBsZXQgZXh0ID0gdHlwZSA9PT0gJ2lkcC1wcm94eScgPyAnLmlkcC5qcycgOiAnLnBzLmpzJztcclxuICAgIHVybCA9IHJlc291cmNlVHlwZS5wcmVmaXggKyBjb25maWd1cmF0aW9uLmRvbWFpbiArIHJlc291cmNlVHlwZS5zdWZmaXggKyByZXNvdXJjZTtcclxuICAgIGlmIChyZXNvdXJjZVR5cGUuaGFzT3duUHJvcGVydHkoJ2ZhbGxiYWNrJykgJiYgdXNlRmFsbGJhY2spIHtcclxuICAgICAgaWYgKHJlc291cmNlVHlwZS5mYWxsYmFjay5pbmRleE9mKCclZG9tYWluJScpKSB7XHJcbiAgICAgICAgdXJsID0gcmVzb3VyY2VUeXBlLmZhbGxiYWNrLnJlcGxhY2UoLyglZG9tYWluJSkvZywgY29uZmlndXJhdGlvbi5kb21haW4pICsgcmVzb3VyY2UrZXh0O1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHVybCA9IHJlc291cmNlVHlwZS5mYWxsYmFjayArIHJlc291cmNlO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfSBlbHNlIHtcclxuICAgIHVybCA9IHJlc291cmNlVHlwZS5wcmVmaXggKyBjb25maWd1cmF0aW9uLmRvbWFpbiArIHJlc291cmNlVHlwZS5zdWZmaXg7XHJcbiAgfVxyXG5cclxuICAvLyBjb25zb2xlLmxvZyh1cmwpO1xyXG5cclxuICByZXR1cm4gdXJsO1xyXG59XHJcblxyXG4vKipcclxuICogR2VuZXJhdGUgYSBHbG9iYWwgVW5pcXVlIElEXHJcbiAqXHJcbiAqIEByZXR1cm5zIFN0cmluZztcclxuICovXHJcbmV4cG9ydCBmdW5jdGlvbiBnZW5lcmF0ZUdVSUQoKSB7XHJcblxyXG4gIGZ1bmN0aW9uIHM0KCkge1xyXG4gICAgcmV0dXJuIE1hdGguZmxvb3IoKDEgKyBNYXRoLnJhbmRvbSgpKSAqIDB4MTAwMDApXHJcbiAgICAgIC50b1N0cmluZygxNilcclxuICAgICAgLnN1YnN0cmluZygxKTtcclxuICB9XHJcblxyXG4gIHJldHVybiBzNCgpICsgczQoKSArICctJyArIHM0KCkgKyAnLScgKyBzNCgpICsgJy0nICsgczQoKSArICctJyArIHM0KCkgKyBzNCgpICsgczQoKTtcclxuXHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBnZXRVc2VySWRlbnRpdHlEb21haW4odXJsKSB7XHJcbiAgbGV0IGRpdmlkZWRVUkwgPSBkaXZpZGVVUkwodXJsKTtcclxuICBsZXQgc3BsaXRlZERvbWFpbiA9IGRpdmlkZWRVUkwuZG9tYWluLnNwbGl0KCcuJyk7XHJcbiAgbGV0IHNwbGl0ZWRMZW5ndGggPSBzcGxpdGVkRG9tYWluLmxlbmd0aDtcclxuICBpZiAoc3BsaXRlZExlbmd0aCA9PSAxKSB7XHJcbiAgICByZXR1cm4gc3BsaXRlZERvbWFpbltzcGxpdGVkTGVuZ3RoIC0gMV07XHJcbiAgfVxyXG4gIGxldCBkb21haW4gPSBzcGxpdGVkRG9tYWluW3NwbGl0ZWRMZW5ndGggLSAyXSArICcuJyArIHNwbGl0ZWREb21haW5bc3BsaXRlZExlbmd0aCAtIDFdO1xyXG4gIHJldHVybiBkb21haW47XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBDaGVjayBpZiBVUkwgaXMgZnJvbSBhIGJhY2tlbmQgc2VydmljZVxyXG4gKiBAcGFyYW0gIHtzdHJpbmd9IHVybCAgICAgVVJMIHRvIGJlIHByb2Nlc3NlZFxyXG4gKiBAcmV0dXJuIHtib29sZWFufVxyXG4gKi9cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBpc0JhY2tlbmRTZXJ2aWNlVVJMKHVybCkge1xyXG4gIGxldCBkaXZpZGVkVVJMID0gZGl2aWRlVVJMKHVybCk7XHJcbiAgbGV0IHNwbGl0ZWREb21haW4gPSBkaXZpZGVkVVJMLmRvbWFpbi5zcGxpdCgnLicpO1xyXG4gIGxldCBiYWNrZW5kU2NoZW1lcyA9IFsnZG9tYWluJywgJ2dsb2JhbCcsICdkb21haW4taWRwJ107IC8vIHNob3VsZCBiZSBkZWZpbmVkIGluIHRoZSBydW50aW1lIGNvbmZpZ3VyYXRpb25cclxuICBsZXQgYmFja2VuZFN1YkRvbWFpbnMgPSBbJ3JlZ2lzdHJ5JywgJ21zZy1ub2RlJ107IC8vIHNob3VsZCBiZSBkZWZpbmVkIGluIHRoZSBydW50aW1lIGNvbmZpZ3VyYXRpb25cclxuICBsZXQgc3ViRG9tYWluO1xyXG5cclxuICBpZiAoc3BsaXRlZERvbWFpbi5sZW5ndGggPiAxKSB7XHJcbiAgICBzdWJEb21haW4gPSBzcGxpdGVkRG9tYWluLmZpbHRlcihpdGVtID0+IGJhY2tlbmRTdWJEb21haW5zLmluZGV4T2YoaXRlbSkgIT09IC0xKVswXTtcclxuICB9XHJcblxyXG4gIGlmIChzdWJEb21haW4gJiYgYmFja2VuZFN1YkRvbWFpbnMuaW5kZXhPZihzdWJEb21haW4pICE9PSAtMSkge1xyXG4gICAgcmV0dXJuIHRydWU7XHJcbiAgfVxyXG5cclxuICBpZiAoZGl2aWRlZFVSTC50eXBlKSB7XHJcbiAgICByZXR1cm4gKGJhY2tlbmRTY2hlbWVzLmluZGV4T2YoZGl2aWRlZFVSTC50eXBlKSAhPT0gLTEpO1xyXG4gIH1cclxuXHJcbiAgcmV0dXJuIGZhbHNlO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gZGl2aWRlRW1haWwoZW1haWwpIHtcclxuICBsZXQgaW5kZXhPZkF0ID0gZW1haWwuaW5kZXhPZignQCcpO1xyXG5cclxuICBsZXQgcmVzdWx0ID0ge1xyXG4gICAgdXNlcm5hbWU6IGVtYWlsLnN1YnN0cmluZygwLCBpbmRleE9mQXQpLFxyXG4gICAgZG9tYWluOiBlbWFpbC5zdWJzdHJpbmcoaW5kZXhPZkF0ICsgMSwgZW1haWwubGVuZ3RoKVxyXG4gIH07XHJcblxyXG4gIHJldHVybiByZXN1bHQ7XHJcbn1cclxuXHJcblxyXG5leHBvcnQgZnVuY3Rpb24gYXNzaWduKG9iaiwga2V5UGF0aCwgdmFsdWUpIHtcclxuXHJcbiAgaWYgKCFvYmopIG9iaiA9IHt9O1xyXG4gIGlmICh0eXBlb2Yoa2V5UGF0aCkgPT09ICdzdHJpbmcnKSBrZXlQYXRoID0gcGFyc2VBdHRyaWJ1dGVzKGtleVBhdGgpO1xyXG5cclxuICBsZXQgbGFzdEtleUluZGV4ID0ga2V5UGF0aC5sZW5ndGggLSAxO1xyXG5cclxuICBmb3IgKHZhciBpID0gMDsgaSA8IGxhc3RLZXlJbmRleDsgKytpKSB7XHJcbiAgICBsZXQga2V5ID0ga2V5UGF0aFtpXTtcclxuICAgIGlmICghKGtleSBpbiBvYmopKSB7XHJcbiAgICAgIG9ialtrZXldID0ge307XHJcbiAgICB9XHJcblxyXG4gICAgb2JqID0gb2JqW2tleV07XHJcblxyXG4gIH1cclxuXHJcbiAgb2JqW2tleVBhdGhbbGFzdEtleUluZGV4XV0gPSB2YWx1ZTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIHNwbGl0T2JqZWN0VVJMKGRhdGFPYmplY3RVUkwpIHtcclxuICBjb25zb2xlLmluZm8oJ1t1dGlscyAtIHNwbGl0T2JqZWN0VVJMXTogJywgZGF0YU9iamVjdFVSTCk7XHJcblxyXG4gIGxldCBzcGxpdGVkVVJMID0gZGF0YU9iamVjdFVSTC5zcGxpdCgnLycpO1xyXG4gIGxldCB1cmwgPSBzcGxpdGVkVVJMWzBdICsgJy8vJyArIHNwbGl0ZWRVUkxbMl0gKyAnLycgKyBzcGxpdGVkVVJMWzNdO1xyXG4gIGxldCByZXNvdXJjZSA9IHNwbGl0ZWRVUkxbNV07XHJcblxyXG4gIGxldCByZXN1bHQgPSB7XHJcbiAgICB1cmw6IHVybCxcclxuICAgIHJlc291cmNlOiByZXNvdXJjZVxyXG4gIH07XHJcblxyXG4gIGNvbnNvbGUuaW5mbygnW3V0aWxzIC0gc3BsaXRPYmplY3RVUkxdOiAnLCByZXN1bHQpO1xyXG5cclxuICByZXR1cm4gcmVzdWx0O1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gY2hlY2tBdHRyaWJ1dGUocGF0aCkge1xyXG5cclxuICBsZXQgcmVnZXggPSAvKCgoW2EtekEtWl0rKTpcXC9cXC8oWzAtOWEtekEtWl1bLVxcd10qWzAtOWEtekEtWl1cXC4pK1thLXpBLVpdezIsOX0pXFwvW2EtekEtWjAtOS5dK0BbYS16QS1aMC05XSsoLSk/W2EtekEtWjAtOV0rKFxcLik/W2EtekEtWjAtOV17MiwxMH0/XFwuW2EtekEtWl17MiwxMH0pKC4rKD89LmlkZW50aXR5KSk/L2dtO1xyXG5cclxuICBsZXQgbGlzdCA9IFtdO1xyXG4gIGxldCBmaW5hbCA9IFtdO1xyXG4gIGxldCB0ZXN0ID0gcGF0aC5tYXRjaChyZWdleCk7XHJcblxyXG4gIGlmICh0ZXN0ID09IG51bGwpIHtcclxuICAgIGZpbmFsID0gcGF0aC5zcGxpdCgnLicpO1xyXG4gIH0gZWxzZSB7XHJcbiAgICBsZXQgbTtcclxuICAgIHdoaWxlICgobSA9IHJlZ2V4LmV4ZWMocGF0aCkpICE9PSBudWxsKSB7XHJcbiAgICAgIC8vIFRoaXMgaXMgbmVjZXNzYXJ5IHRvIGF2b2lkIGluZmluaXRlIGxvb3BzIHdpdGggemVyby13aWR0aCBtYXRjaGVzXHJcbiAgICAgIGlmIChtLmluZGV4ID09PSByZWdleC5sYXN0SW5kZXgpIHtcclxuICAgICAgICByZWdleC5sYXN0SW5kZXgrKztcclxuICAgICAgfVxyXG5cclxuICAgICAgLy8gVGhlIHJlc3VsdCBjYW4gYmUgYWNjZXNzZWQgdGhyb3VnaCB0aGUgYG1gLXZhcmlhYmxlLlxyXG4gICAgICBtLmZvckVhY2goKG1hdGNoLCBncm91cEluZGV4KSA9PiB7XHJcbiAgICAgICAgaWYgKGdyb3VwSW5kZXggPT09IDApIHtcclxuICAgICAgICAgIGxpc3QucHVzaChtYXRjaCk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KTtcclxuICAgIH1cclxuICAgIGxldCByZXN1bHQ7XHJcbiAgICBsaXN0LmZvckVhY2goKHVybCkgPT4ge1xyXG5cclxuICAgICAgcmVzdWx0ID0gcGF0aC5yZXBsYWNlKHVybCwgJyotKicpO1xyXG4gICAgICBmaW5hbCA9IHJlc3VsdC5zcGxpdCgnLicpLm1hcCgoaXRlbSkgPT4ge1xyXG5cclxuICAgICAgICBpZiAoaXRlbSA9PT0gJyotKicpIHsgcmV0dXJuIHVybDsgfVxyXG5cclxuICAgICAgICByZXR1cm4gaXRlbTtcclxuICAgICAgfSk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIGNvbnNvbGUubG9nKCdbUnVudGltZUNvcmUuVXRpbHMuY2hlY2tBdHRyaWJ1dGVdJywgZmluYWwpO1xyXG4gIHJldHVybiBmaW5hbDtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIHBhcnNlQXR0cmlidXRlcyhwYXRoKSB7XHJcbiAgbGV0IHJlZ2V4ID0gLyhbMC05YS16QS1aXVstXFx3XSopOlxcL1xcLy9nO1xyXG5cclxuICBsZXQgc3RyaW5nMyA9ICdpZGVudGl0eSc7XHJcblxyXG4gIGlmICghcGF0aC5pbmNsdWRlcygnOi8vJykpIHtcclxuICAgIHJldHVybiAocGF0aC5zcGxpdCgnLicpKTtcclxuICB9IGVsc2Uge1xyXG4gICAgbGV0IHN0cmluZzEgPSBwYXRoLnNwbGl0KHJlZ2V4KVswXTtcclxuXHJcbiAgICBsZXQgYXJyYXkxID0gc3RyaW5nMS5zcGxpdCgnLicpO1xyXG5cclxuICAgIGxldCBzdHJpbmcyID0gcGF0aC5yZXBsYWNlKHN0cmluZzEsICcnKTtcclxuXHJcbiAgICBpZiAocGF0aC5pbmNsdWRlcyhzdHJpbmczKSkge1xyXG5cclxuICAgICAgbGV0IGFycmF5MiA9IHN0cmluZzIuc3BsaXQoc3RyaW5nMyArICcuJyk7XHJcblxyXG4gICAgICBjb25zb2xlLmxvZygnYXJyYXkyICcgKyBhcnJheTIpO1xyXG5cclxuICAgICAgc3RyaW5nMiA9IGFycmF5MlswXS5zbGljZSgnLicsIC0xKTtcclxuXHJcbiAgICAgIGFycmF5MiA9IGFycmF5MlsxXS5zcGxpdCgnLicpO1xyXG5cclxuICAgICAgYXJyYXkxLnB1c2goc3RyaW5nMiwgc3RyaW5nMyk7XHJcblxyXG4gICAgICBhcnJheTEgPSBhcnJheTEuY29uY2F0KGFycmF5Mik7XHJcblxyXG4gICAgfSBlbHNlIHtcclxuICAgICAgYXJyYXkxLnB1c2goc3RyaW5nMik7XHJcblxyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiAoYXJyYXkxLmZpbHRlcihCb29sZWFuKSk7XHJcblxyXG4gIH1cclxuXHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBpc0VtcHR5KG9iaikge1xyXG4gIGZvciAodmFyIHByb3AgaW4gb2JqKSB7XHJcblxyXG4gICAgaWYgKG9iai5oYXNPd25Qcm9wZXJ0eShwcm9wKSkge1xyXG4gICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcblxyXG4gIH1cclxuXHJcbiAgcmV0dXJuIEpTT04uc3RyaW5naWZ5KG9iaikgPT09IEpTT04uc3RyaW5naWZ5KHt9KTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGNoYXRrZXlzVG9TdHJpbmdDbG9uZXIoc2Vzc2lvbktleXMpIHtcclxuICBsZXQgZGF0YU9iamVjdFNlc3Npb25LZXlzQ2xvbmUgPSB7fTtcclxuICBsZXQgZmllbGRzID0gT2JqZWN0LmtleXMoc2Vzc2lvbktleXMpO1xyXG4gIGlmIChmaWVsZHMpIHtcclxuICAgIHRyeSB7XHJcbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgIGZpZWxkcy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgIGxldCBmaWVsZCA9IGZpZWxkc1tpXTtcclxuICAgICAgICBkYXRhT2JqZWN0U2Vzc2lvbktleXNDbG9uZVtmaWVsZF0gPSB7fTtcclxuICAgICAgICBkYXRhT2JqZWN0U2Vzc2lvbktleXNDbG9uZVtmaWVsZF0uc2Vzc2lvbktleSA9IHNlc3Npb25LZXlzW2ZpZWxkXS5zZXNzaW9uS2V5LnRvU3RyaW5nKCk7XHJcbiAgICAgICAgZGF0YU9iamVjdFNlc3Npb25LZXlzQ2xvbmVbZmllbGRdLmlzVG9FbmNyeXB0ID0gc2Vzc2lvbktleXNbZmllbGRdLmlzVG9FbmNyeXB0O1xyXG4gICAgICB9XHJcbiAgICB9IGNhdGNoIChlcnIpIHtcclxuICAgICAgY29uc29sZS5lcnJvcignX2NoYXRrZXlzVG9TdHJpbmdDbG9uZXI6ZXJyJywgZXJyKTtcclxuICAgIH1cclxuICB9XHJcbiAgcmV0dXJuIGRhdGFPYmplY3RTZXNzaW9uS2V5c0Nsb25lO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gY2hhdGtleXNUb0FycmF5Q2xvbmVyKHNlc3Npb25LZXlzKSB7XHJcbiAgbGV0IGRhdGFPYmplY3RTZXNzaW9uS2V5c0Nsb25lID0ge307XHJcbiAgbGV0IGZpZWxkcyA9IE9iamVjdC5rZXlzKHNlc3Npb25LZXlzKTtcclxuICBpZiAoZmllbGRzKSB7XHJcbiAgICB0cnkge1xyXG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8ICBmaWVsZHMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICBsZXQgZmllbGQgPSBmaWVsZHNbaV07XHJcbiAgICAgICAgZGF0YU9iamVjdFNlc3Npb25LZXlzQ2xvbmVbZmllbGRdID0ge307XHJcbiAgICAgICAgbGV0IGFycmF5VmFsdWVzID0gSlNPTi5wYXJzZSgnWycgKyBzZXNzaW9uS2V5c1tmaWVsZF0uc2Vzc2lvbktleSArICddJyk7XHJcbiAgICAgICAgZGF0YU9iamVjdFNlc3Npb25LZXlzQ2xvbmVbZmllbGRdLnNlc3Npb25LZXkgPSBuZXcgVWludDhBcnJheShhcnJheVZhbHVlcyk7XHJcbiAgICAgICAgZGF0YU9iamVjdFNlc3Npb25LZXlzQ2xvbmVbZmllbGRdLmlzVG9FbmNyeXB0ID0gc2Vzc2lvbktleXNbZmllbGRdLmlzVG9FbmNyeXB0O1xyXG4gICAgICB9XHJcbiAgICB9IGNhdGNoIChlcnIpIHtcclxuICAgICAgY29uc29sZS5lcnJvcignX2NoYXRrZXlzVG9BcnJheUNsb25lcjplcnInLCBlcnIpO1xyXG4gICAgfVxyXG4gIH1cclxuICByZXR1cm4gZGF0YU9iamVjdFNlc3Npb25LZXlzQ2xvbmU7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBwYXJzZU1lc3NhZ2VVUkwoVVJMKSB7XHJcbiAgbGV0IHNwbGl0ZWRUb1VSTCA9IFVSTC5zcGxpdCgnLycpO1xyXG4gIGlmIChzcGxpdGVkVG9VUkwubGVuZ3RoIDw9IDYpIHtcclxuICAgIHJldHVybiBzcGxpdGVkVG9VUkxbMF0gKyAnLy8nICsgc3BsaXRlZFRvVVJMWzJdICsgJy8nICsgc3BsaXRlZFRvVVJMWzNdO1xyXG4gIH0gZWxzZSB7XHJcbiAgICByZXR1cm4gc3BsaXRlZFRvVVJMWzBdICsgJy8vJyArIHNwbGl0ZWRUb1VSTFsyXSArICcvJyArIHNwbGl0ZWRUb1VSTFszXSArICcvJyArIHNwbGl0ZWRUb1VSTFs0XTtcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBhdmFpbGFibGVTcGFjZSh1c2FnZSwgcXVvdGEpIHtcclxuICBjb25zdCBhdmFpbGFibGUgPSAodXNhZ2UgLyBxdW90YSkudG9GaXhlZCgyKTtcclxuICByZXR1cm4ge1xyXG4gICAgcXVvdGE6IHF1b3RhLFxyXG4gICAgdXNhZ2U6IHVzYWdlLFxyXG4gICAgcGVyY2VudDogTnVtYmVyKGF2YWlsYWJsZSlcclxuICB9O1xyXG59XHJcblxyXG4vKipcclxuKiBFbmNvZGVzIGEgSlMgb2JqZWN0IHRvIGJhc2UgNjQgZW5jb2RlXHJcbiogQHBhcmFtICAge09iamVjdH0gICAgdmFsdWUgICAgYnl0ZUFycmF5IHZhbHVlXHJcbiogQHJldHVybiAge3N0cmluZ30gICBlbmNvZGVkIHZhbHVlXHJcbiovXHJcbmV4cG9ydCBmdW5jdGlvbiBlbmNvZGUodmFsdWUpIHtcclxuICB0cnkge1xyXG4gICAgbGV0IHN0cmluZ1ZhbHVlID0gc3RyaW5naWZ5KHZhbHVlKTtcclxuICAgIHJldHVybiBidG9hKHN0cmluZ1ZhbHVlKTtcclxuICB9IGNhdGNoIChlcnIpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ1tVdGlscy5lbmNvZGU6ZXJyXSAnICsgZXJyKTtcclxuICAgIHRocm93IGVycjtcclxuICB9XHJcbn1cclxuXHJcbi8qKlxyXG4gICogRGVjb2RlIGEgYmFzZTY0IHN0cmluZyB0byBvYmplY3RcclxuICAqIEBwYXJhbSAgIHtzdHJpbmdfYjY0fSAgICB2YWx1ZSAgICB2YWx1ZSBlbmNvZGVkIGluIGJhc2UgNjRcclxuICAqIEByZXR1cm4gIHtPYmplY3R9IGRlY29kZWRWYWx1ZVxyXG4gICovXHJcbmV4cG9ydCBmdW5jdGlvbiBkZWNvZGUodmFsdWUpIHtcclxuICB0cnkge1xyXG4gICAgcmV0dXJuIEpTT04ucGFyc2UoYXRvYih2YWx1ZSkpO1xyXG4gIH0gY2F0Y2ggKGVycikge1xyXG4gICAgY29uc29sZS5sb2coJ1tVdGlscy5kZWNvZGU6ZXJyXSAnICsgZXJyKTtcclxuICAgIHRocm93IGVycjtcclxuICB9XHJcbn1cclxuXHJcbi8qKlxyXG4qIERlY29kZSBhIGJhc2U2NCBzdHJpbmcgdG8gVWludDhBcnJheVxyXG4qIEBwYXJhbSAgIHtzdHJpbmdfYjY0fSAgICB2YWx1ZSAgICBieXRlQXJyYXkgdmFsdWVcclxuKiBAcmV0dXJuICB7VWludDhBcnJheX0gICBlbmNvZGVkIHZhbHVlXHJcbiovXHJcbmV4cG9ydCBmdW5jdGlvbiBkZWNvZGVUb1VpbnQ4QXJyYXkodmFsdWUpIHtcclxuICB0cnkge1xyXG4gICAgcmV0dXJuIG5ldyBVaW50OEFycmF5KGRlY29kZSh2YWx1ZSkpO1xyXG4gIH0gY2F0Y2ggKGVycikge1xyXG4gICAgY29uc29sZS5lcnJvcignW1V0aWxzLmRlY29kZVRvVWludDhBcnJheTplcnJdICcgKyBlcnIpO1xyXG4gICAgdGhyb3cgZXJyO1xyXG4gIH1cclxufVxyXG5cclxuLyoqXHJcbiogQ29udmVydHMgYSBKUyBvYmplY3QgdG8gc3RyaW5nXHJcbiogTk9URTogU3BlY2lhbCBjb252ZXJzaW9uIGZvciBVaW50OEFycmF5c1xyXG4qIEBwYXJhbSAgIHtPYmplY3R9ICAgIHZhbHVlICAgIGJ5dGVBcnJheSB2YWx1ZVxyXG4qIEByZXR1cm4gIHtVaW50OEFycmF5fSAgIGVuY29kZWQgdmFsdWVcclxuKi9cclxuZXhwb3J0IGZ1bmN0aW9uIHN0cmluZ2lmeSh2YWx1ZSkge1xyXG4gIHRyeSB7XHJcbiAgICBsZXQgc3RyaW5nVmFsdWU7XHJcbiAgICBpZiAodmFsdWUuY29uc3RydWN0b3IgPT09IFVpbnQ4QXJyYXkpIHtcclxuICAgICAgc3RyaW5nVmFsdWUgPSAnWycgKyB2YWx1ZS50b1N0cmluZygpICsgJ10nOyAvLyB0aGUgW10gaXMgZm9yIEpTT04ucGFyc2UgY29tcGF0aWJpbGl0eVxyXG4gICAgfSBlbHNlIHtcclxuICAgICAgc3RyaW5nVmFsdWUgPSBKU09OLnN0cmluZ2lmeSh2YWx1ZSk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gc3RyaW5nVmFsdWU7XHJcbiAgfSBjYXRjaCAoZXJyKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCdbVXRpbHMuc3RyaW5naWZ5OmVycl0gJyArIGVycik7XHJcbiAgICB0aHJvdyBlcnI7XHJcbiAgfVxyXG59XHJcblxyXG4vKipcclxuKiBDb252ZXJ0cyBhIHN0cmluZ2lmaWVkIG9iamVjdCB0byBvYmplY3RcclxuKiBAcGFyYW0gICB7U3RyaW5nfSAgICB2YWx1ZSAgICBieXRlQXJyYXkgdmFsdWVcclxuKiBAcmV0dXJuICB7T2JqZWN0fSAgIGVuY29kZWQgdmFsdWVcclxuKi9cclxuZXhwb3J0IGZ1bmN0aW9uIHBhcnNlKHZhbHVlKSB7XHJcbiAgdHJ5IHtcclxuICAgIHJldHVybiBKU09OLnBhcnNlKHZhbHVlKTtcclxuICB9IGNhdGNoIChlcnIpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ1tVdGlscy5wYXJzZTplcnJdJyArIGVycik7XHJcbiAgICBjb25zb2xlLnRyYWNlKCk7XHJcbiAgICBjb25zb2xlLmVycm9yKCdUaGF0IHRoYXQgY2F1c2UgdGhlIGVycm9yOicsIHZhbHVlKTtcclxuICAgIHRocm93IGVycjtcclxuICB9XHJcbn1cclxuXHJcbi8qKlxyXG4qIENvbnZlcnRzIGEgc3RyaW5naWZpZWQgb2JqZWN0IHRvIG9iamVjdFxyXG4qIEBwYXJhbSAgIHtTdHJpbmd9ICAgIHZhbHVlICAgIGJ5dGVBcnJheSB2YWx1ZVxyXG4qIEByZXR1cm4gIHtVaW50OEFycmF5fSAgIGVuY29kZWQgdmFsdWVcclxuKi9cclxuZXhwb3J0IGZ1bmN0aW9uIHBhcnNlVG9VaW50OEFycmF5KHZhbHVlKSB7XHJcbiAgdHJ5IHtcclxuICAgIHJldHVybiBuZXcgVWludDhBcnJheShwYXJzZSh2YWx1ZSkpO1xyXG4gIH0gY2F0Y2ggKGVycikge1xyXG4gICAgY29uc29sZS5lcnJvcignW1V0aWxzLnBhcnNlVG9VaW50OEFycmF5OmVycl0nICsgZXJyKTtcclxuICAgIHRocm93IGVycjtcclxuICB9XHJcbn1cclxuIiwiaW1wb3J0ICdwcm94eS1vYnNlcnZlJztcclxuaW1wb3J0IHtwYXJzZUF0dHJpYnV0ZXN9IGZyb20gJy4uL3V0aWxzL3V0aWxzJztcclxuXHJcbmNvbnN0IG9iamVjdFR5cGUgPSB7QVJSQVk6ICdbb2JqZWN0IEFycmF5XScsIE9CSkVDVDogJ1tvYmplY3QgT2JqZWN0XScgfTtcclxuXHJcbi8qKlxyXG4gKiBAYWNjZXNzIHByaXZhdGVcclxuICogTWFpbiBjbGFzcyB0aGF0IG1haW50YWlucyBhIEpTT04gb2JqZWN0LCBhbmQgb2JzZXJ2ZXMgY2hhbmdlcyBpbiB0aGlzIG9iamVjdCwgcmVjdXJzaXZlbHkuXHJcbiAqIEludGVybmFsIG9iamVjdHMgYW5kIGFycmF5cyBhcmUgYWxzbyBvYnNlcnZlZC5cclxuICovXHJcbmNsYXNzIFN5bmNPYmplY3Qge1xyXG5cclxuICBjb25zdHJ1Y3Rvcihpbml0aWFsRGF0YSkge1xyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuXHJcbiAgICBfdGhpcy5fb2JzZXJ2ZXJzID0gW107XHJcbiAgICBfdGhpcy5fZmlsdGVycyA9IHt9O1xyXG5cclxuICAgIHRoaXMuX2RhdGEgPSBpbml0aWFsRGF0YSB8fCB7fTtcclxuXHJcbiAgICB0aGlzLl9pbnRlcm5hbE9ic2VydmUodGhpcy5fZGF0YSk7XHJcbiAgfVxyXG5cclxuICBnZXQgZGF0YSgpIHsgcmV0dXJuIHRoaXMuX2RhdGE7IH1cclxuXHJcbiAgb2JzZXJ2ZShjYWxsYmFjaykge1xyXG4gICAgdGhpcy5fb2JzZXJ2ZXJzLnB1c2goY2FsbGJhY2spO1xyXG4gIH1cclxuXHJcbiAgZmluZChwYXRoKSB7XHJcbiAgICBsZXQgbGlzdCA9IHBhcnNlQXR0cmlidXRlcyhwYXRoKTtcclxuXHJcbiAgICByZXR1cm4gdGhpcy5fZmluZFdpdGhTcGxpdChsaXN0KTtcclxuICB9XHJcblxyXG4gIGZpbmRCZWZvcmUocGF0aCkge1xyXG4gICAgbGV0IHJlc3VsdCA9IHt9O1xyXG4gICAgbGV0IGxpc3QgPSBwYXJzZUF0dHJpYnV0ZXMocGF0aCk7XHJcbiAgICByZXN1bHQubGFzdCA9IGxpc3QucG9wKCk7XHJcbiAgICByZXN1bHQub2JqID0gdGhpcy5fZmluZFdpdGhTcGxpdChsaXN0KTtcclxuXHJcbiAgICByZXR1cm4gcmVzdWx0O1xyXG4gIH1cclxuXHJcbiAgX2ZpbmRXaXRoU3BsaXQobGlzdCkge1xyXG4gICAgbGV0IG9iaiA9IHRoaXMuX2RhdGE7XHJcbiAgICBsaXN0LmZvckVhY2goKHZhbHVlKSA9PiB7XHJcbiAgICAgIG9iaiA9IG9ialt2YWx1ZV07XHJcbiAgICB9KTtcclxuXHJcbiAgICByZXR1cm4gb2JqO1xyXG4gIH1cclxuXHJcbiAgX2ludGVybmFsT2JzZXJ2ZShvYmplY3QpIHtcclxuXHJcbiAgICBsZXQgaGFuZGxlciA9IChjaGFuZ2VzZXQpID0+IHtcclxuXHJcbiAgICAgIGNoYW5nZXNldC5ldmVyeSgoY2hhbmdlKSA9PiB7XHJcbiAgICAgICAgdGhpcy5fb25DaGFuZ2VzKGNoYW5nZSk7XHJcbiAgICAgIH0pO1xyXG5cclxuICAgIH07XHJcblxyXG4gICAgdGhpcy5fZGF0YSA9IE9iamVjdC5kZWVwT2JzZXJ2ZShvYmplY3QsIGhhbmRsZXIpO1xyXG5cclxuICB9XHJcblxyXG4gIF9maXJlRXZlbnQoZXZlbnQpIHtcclxuICAgIHRoaXMuX29ic2VydmVycy5mb3JFYWNoKChjYWxsYmFjaykgPT4ge1xyXG4gICAgICBjYWxsYmFjayhldmVudCk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIF9vbkNoYW5nZXMoY2hhbmdlKSB7XHJcblxyXG4gICAgbGV0IG9iaiA9IGNoYW5nZS5vYmplY3Q7XHJcbiAgICBsZXQgb2JqVHlwZTtcclxuXHJcbiAgICBpZiAob2JqLmNvbnN0cnVjdG9yID09PSBPYmplY3QpIHtcclxuICAgICAgb2JqVHlwZSA9IE9iamVjdFR5cGUuT0JKRUNUO1xyXG4gICAgfVxyXG5cclxuICAgIGlmIChvYmouY29uc3RydWN0b3IgPT09IEFycmF5KSB7XHJcbiAgICAgIG9ialR5cGUgPSBPYmplY3RUeXBlLkFSUkFZO1xyXG4gICAgfVxyXG5cclxuICAgIGxldCBmaWVsZFN0cmluZyA9IGNoYW5nZS5rZXlwYXRoO1xyXG5cclxuICAgIC8vIGNvbnNvbGUubG9nKCdGaWVsZDonLCBmaWVsZFN0cmluZyk7XHJcbiAgICAvLyBjb25zb2xlLmxvZygndHlwZTonLCBjaGFuZ2UudHlwZSk7XHJcblxyXG4gICAgLy9sZXQgb2xkVmFsdWUgPSBjaGFuZ2Uub2xkVmFsdWU7XHJcbiAgICBsZXQgbmV3VmFsdWUgPSBvYmpbY2hhbmdlLm5hbWVdO1xyXG5cclxuICAgIC8vIGNvbnNvbGUuaW5mbyhjaGFuZ2UudHlwZSArICcgfCBGaWVsZDogJyArIGZpZWxkU3RyaW5nICsgJyB8IE5ldyBWYWx1ZTonLCBKU09OLnN0cmluZ2lmeShuZXdWYWx1ZSksIGZpZWxkU3RyaW5nLmluY2x1ZGVzKCdsZW5ndGgnKSk7XHJcblxyXG4gICAgaWYgKGNoYW5nZS50eXBlID09PSAndXBkYXRlJyAmJiAhZmllbGRTdHJpbmcuaW5jbHVkZXMoJy5sZW5ndGgnKSkge1xyXG4gICAgICB0aGlzLl9maXJlRXZlbnQoe1xyXG4gICAgICAgIGNUeXBlOiBDaGFuZ2VUeXBlLlVQREFURSxcclxuICAgICAgICBvVHlwZTogb2JqVHlwZSxcclxuICAgICAgICBmaWVsZDogZmllbGRTdHJpbmcsXHJcbiAgICAgICAgZGF0YTogbmV3VmFsdWVcclxuICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKGNoYW5nZS50eXBlID09PSAnYWRkJykge1xyXG4gICAgICB0aGlzLl9maXJlRXZlbnQoe1xyXG4gICAgICAgIGNUeXBlOiBDaGFuZ2VUeXBlLkFERCxcclxuICAgICAgICBvVHlwZTogb2JqVHlwZSxcclxuICAgICAgICBmaWVsZDogZmllbGRTdHJpbmcsXHJcbiAgICAgICAgZGF0YTogbmV3VmFsdWVcclxuICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKGNoYW5nZS50eXBlID09PSAnZGVsZXRlJykge1xyXG4gICAgICB0aGlzLl9maXJlRXZlbnQoe1xyXG4gICAgICAgIGNUeXBlOiBDaGFuZ2VUeXBlLlJFTU9WRSxcclxuICAgICAgICBvVHlwZTogb2JqVHlwZSxcclxuICAgICAgICBmaWVsZDogZmllbGRTdHJpbmdcclxuICAgICAgfSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxufVxyXG5cclxuZXhwb3J0IGxldCBDaGFuZ2VUeXBlID0ge1VQREFURTogJ3VwZGF0ZScsIEFERDogJ2FkZCcsIFJFTU9WRTogJ3JlbW92ZSd9O1xyXG5leHBvcnQgbGV0IE9iamVjdFR5cGUgPSB7T0JKRUNUOiAnb2JqZWN0JywgQVJSQVk6ICdhcnJheSd9O1xyXG5leHBvcnQgZGVmYXVsdCBTeW5jT2JqZWN0O1xyXG4iLCIvKipcclxuKiBDb3B5cmlnaHQgMjAxNiBQVCBJbm92YcOnw6NvIGUgU2lzdGVtYXMgU0FcclxuKiBDb3B5cmlnaHQgMjAxNiBJTkVTQy1JRFxyXG4qIENvcHlyaWdodCAyMDE2IFFVT0JJUyBORVRXT1JLUyBTTFxyXG4qIENvcHlyaWdodCAyMDE2IEZSQVVOSE9GRVItR0VTRUxMU0NIQUZUIFpVUiBGT0VSREVSVU5HIERFUiBBTkdFV0FORFRFTiBGT1JTQ0hVTkcgRS5WXHJcbiogQ29weXJpZ2h0IDIwMTYgT1JBTkdFIFNBXHJcbiogQ29weXJpZ2h0IDIwMTYgRGV1dHNjaGUgVGVsZWtvbSBBR1xyXG4qIENvcHlyaWdodCAyMDE2IEFwaXplZVxyXG4qIENvcHlyaWdodCAyMDE2IFRFQ0hOSVNDSEUgVU5JVkVSU0lUQVQgQkVSTElOXHJcbipcclxuKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4qIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuKlxyXG4qICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbipcclxuKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4qIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4qIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuKiovXHJcbi8vIExvZyBTeXN0ZW1cclxuaW1wb3J0ICogYXMgbG9nZ2VyIGZyb20gJ2xvZ2xldmVsJztcclxubGV0IGxvZyA9IGxvZ2dlci5nZXRMb2dnZXIoJ0RhdGFPYmplY3RDaGlsZCcpO1xyXG5cclxuaW1wb3J0IFN5bmNPYmplY3QgZnJvbSAnLi9Qcm94eU9iamVjdCc7XHJcblxyXG5pbXBvcnQgeyBkZWVwQ2xvbmUgfSBmcm9tICcuLi91dGlscy91dGlscy5qcyc7XHJcblxyXG4vKipcclxuICogVGhlIGNsYXNzIHJldHVybmVkIGZyb20gdGhlIERhdGFPYmplY3QgYWRkQ2hpbGRyZW4gY2FsbCBvciBmcm9tIG9uQWRkQ2hpbGRyZW4gaWYgcmVtb3RlbHkgY3JlYXRlZC5cclxuICovXHJcbmNsYXNzIERhdGFPYmplY3RDaGlsZCAvKiBpbXBsZW1lbnRzIFN5bmNTdGF0dXMgKi8ge1xyXG4gIC8qIHByaXZhdGVcclxuXHJcbiAgLS0tLWV2ZW50IGhhbmRsZXJzLS0tLVxyXG4gIF9vblJlc3BvbnNlSGFuZGxlcjogKGV2ZW50KSA9PiB2b2lkXHJcbiAgKi9cclxuXHJcbiAgLyoqXHJcbiAgICogQGlnbm9yZVxyXG4gICAqIFNob3VsZCBub3QgYmUgdXNlZCBkaXJlY3RseSBieSBIeXBlcnRpZXMuIEl0J3MgY2FsbGVkIGJ5IHRoZSBEYXRhT2JqZWN0LmFkZENoaWxkXHJcbiAgICovXHJcbiAgY29uc3RydWN0b3IoaW5wdXQpIHtcclxuICAgIGxldCBfdGhpcyA9IHRoaXM7XHJcblxyXG4gICAgZnVuY3Rpb24gdGhyb3dNYW5kYXRvcnlQYXJtTWlzc2luZ0Vycm9yKHBhcikge1xyXG4gICAgICB0aHJvdyAnW0RhdGFPYmplY3RDaGlsZF0gJyArIHBhciArICcgbWFuZGF0b3J5IHBhcmFtZXRlciBpcyBtaXNzaW5nJztcclxuICAgIH1cclxuXHJcbiAgICBpbnB1dC5wYXJlbnQgPyAgX3RoaXMuX3BhcmVudCA9IGlucHV0LnBhcmVudCA6IHRocm93TWFuZGF0b3J5UGFybU1pc3NpbmdFcnJvcigncGFyZW50Jyk7XHJcbiAgICBpbnB1dC51cmwgPyAgX3RoaXMuX3VybCA9IGlucHV0LnVybCA6IHRocm93TWFuZGF0b3J5UGFybU1pc3NpbmdFcnJvcigndXJsJyk7XHJcbiAgICBpbnB1dC5jcmVhdGVkID8gX3RoaXMuX2NyZWF0ZWQgPSBpbnB1dC5jcmVhdGVkIDogdGhyb3dNYW5kYXRvcnlQYXJtTWlzc2luZ0Vycm9yKCdjcmVhdGVkJyk7XHJcbiAgICBpbnB1dC5yZXBvcnRlciA/IF90aGlzLl9yZXBvcnRlciA9IGlucHV0LnJlcG9ydGVyIDogdGhyb3dNYW5kYXRvcnlQYXJtTWlzc2luZ0Vycm9yKCdyZXBvcnRlcicpO1xyXG4gICAgaW5wdXQucnVudGltZSA/IF90aGlzLl9ydW50aW1lID0gaW5wdXQucnVudGltZSA6IHRocm93TWFuZGF0b3J5UGFybU1pc3NpbmdFcnJvcigncnVudGltZScpO1xyXG4gICAgaW5wdXQuc2NoZW1hID8gX3RoaXMuX3NjaGVtYSA9IGlucHV0LnNjaGVtYSA6IHRocm93TWFuZGF0b3J5UGFybU1pc3NpbmdFcnJvcignc2NoZW1hJyk7XHJcbiAgICBpbnB1dC5wYXJlbnRPYmplY3QgPyBfdGhpcy5fcGFyZW50T2JqZWN0ID0gaW5wdXQucGFyZW50T2JqZWN0IDogdGhyb3dNYW5kYXRvcnlQYXJtTWlzc2luZ0Vycm9yKCdwYXJlbnRPYmplY3QnKTtcclxuXHJcbiAgICBpZiAoaW5wdXQubmFtZSkgX3RoaXMuX25hbWUgPSBpbnB1dC5uYW1lO1xyXG4gICAgaWYgKGlucHV0LmRlc2NyaXB0aW9uKSBfdGhpcy5fZGVzY3JpcHRpb24gPSBpbnB1dC5kZXNjcmlwdGlvbjtcclxuICAgIGlmIChpbnB1dC50YWdzKSBfdGhpcy5fdGFncyA9IGlucHV0LnRhZ3M7XHJcbiAgICBpZiAoaW5wdXQucmVzb3VyY2VzKSBfdGhpcy5fcmVzb3VyY2VzID0gaW5wdXQucmVzb3VyY2VzO1xyXG4gICAgaWYgKGlucHV0Lm9ic2VydmVyU3RvcmFnZSkgX3RoaXMuX29ic2VydmVyU3RvcmFnZSA9IGlucHV0Lm9ic2VydmVyU3RvcmFnZTtcclxuICAgIGlmIChpbnB1dC5wdWJsaWNPYnNlcnZhdGlvbikgX3RoaXMuX3B1YmxpY09ic2VydmF0aW9uID0gaW5wdXQucHVibGljT2JzZXJ2YXRpb247XHJcblxyXG4gICAgX3RoaXMuX2NoaWxkSWQgPSBpbnB1dC51cmw7XHJcblxyXG4gICAgaWYgKGlucHV0LmRhdGEpIHtcclxuICAgICAgX3RoaXMuX3N5bmNPYmogPSBuZXcgU3luY09iamVjdChpbnB1dC5kYXRhKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIF90aGlzLl9zeW5jT2JqID0gbmV3IFN5bmNPYmplY3Qoe30pO1xyXG4gICAgfVxyXG5cclxuICAgIGxvZy5sb2coJ1tEYXRhT2JqZWN0Q2hpbGQgLSAgQ29uc3RydWN0b3JdIC0gJywgX3RoaXMuX3N5bmNPYmopO1xyXG5cclxuICAgIF90aGlzLl9idXMgPSBfdGhpcy5fcGFyZW50T2JqZWN0Ll9idXM7XHJcbiAgICBfdGhpcy5fb3duZXIgPSBfdGhpcy5fcGFyZW50T2JqZWN0Ll9vd25lcjtcclxuXHJcbiAgICBfdGhpcy5fYWxsb2NhdGVMaXN0ZW5lcnMoKTtcclxuXHJcbiAgICBfdGhpcy5fbWV0YWRhdGEgPSBpbnB1dDtcclxuXHJcbiAgICAvLyBkZWxldGUgX3RoaXMuX21ldGFkYXRhLmRhdGE7XHJcbiAgICBkZWxldGUgX3RoaXMuX21ldGFkYXRhLnBhcmVudE9iamVjdDtcclxuXHJcbiAgICBfdGhpcy5fc2hhcmluZ1N0YXR1cyA9IGZhbHNlO1xyXG5cclxuICB9XHJcblxyXG4gIGdldCBzaGFyZWFibGUoKSB7XHJcbiAgICBsZXQgc2hhcmVhYmxlID0gdGhpcy5tZXRhZGF0YTtcclxuICAgIHNoYXJlYWJsZS5kYXRhID0gdGhpcy5kYXRhO1xyXG5cclxuICAgIHJldHVybiBzaGFyZWFibGU7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBUaGlzIGZ1bmN0aW9uIGlzIHVzZWQgdG8gc2hhcmUgdGhlIGNoaWxkIE9iamVjdCBhbW9uZyBhdXRob3Jpc2VkIEh5cGVydGllc1xyXG4gICAqIEBwYXJhbSAge2Jvb2xlYW59ICAgICByZXBvcnRlciAgSWYgdHJ1ZSB0aGUgY2hpbGQgb2JqZWN0IGlzIG9ubHkgc2hhcmVkIHRvIFBhcmVudCByZXBvcnRlclxyXG4gICAqIEByZXR1cm4ge1Byb21pc2U8SlNPTj59ICAgICAgICBJdCByZXR1cm5zIGEgcHJvbWlzZSB3aXRoIHRoZSBzaGFyaW5nIHJlc3VsdHMuXHJcbiAgICovXHJcblxyXG4gIHNoYXJlKHRvUmVwb3J0ZXIpIHtcclxuICAgIGxldCBfdGhpcyA9IHRoaXM7XHJcblxyXG4gICAgX3RoaXMuX3NoYXJpbmdTdGF0dXMgPSBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XHJcblxyXG4gICAgICBsZXQgdG87XHJcbiAgICAgIGxldCByZXBvcnRlciA9IHRvUmVwb3J0ZXI7XHJcblxyXG4gICAgICBpZiAocmVwb3J0ZXIpIHtcclxuICAgICAgICB0byA9IF90aGlzLm1ldGFkYXRhLnBhcmVudDtcclxuICAgICAgfSBlbHNlIHRvID0gX3RoaXMubWV0YWRhdGEucGFyZW50ICsgJy9jaGlsZHJlbi8nO1xyXG5cclxuICAgICAgbGV0IGNoaWxkVmFsdWUgPSBfdGhpcy5tZXRhZGF0YTtcclxuICAgICAgY2hpbGRWYWx1ZS5kYXRhID0gX3RoaXMuZGF0YTtcclxuXHJcbiAgICAgIC8vRkxPVy1PVVQ6IHRoaXMgbWVzc2FnZSB3aWxsIGJlIHNlbnQgZGlyZWN0bHkgdG8gYSByZXNvdXJjZSBjaGlsZCBhZGRyZXNzOiBNZXNzYWdlQnVzXHJcbiAgICAgIGxldCByZXF1ZXN0TXNnID0ge1xyXG4gICAgICAgIHR5cGU6ICdjcmVhdGUnLCBmcm9tOiBfdGhpcy5tZXRhZGF0YS5yZXBvcnRlciwgdG86IHRvLFxyXG4gICAgICAgIGJvZHk6IHsgcmVzb3VyY2U6IGNoaWxkVmFsdWUudXJsLCB2YWx1ZTogY2hpbGRWYWx1ZSB9XHJcbiAgICAgIH07XHJcblxyXG4gICAgICBpZiAoX3RoaXMuaWRlbnRpdHkpICAgICAge1xyXG4gICAgICAgIHJlcXVlc3RNc2cuYm9keS5pZGVudGl0eSA9IF90aGlzLmlkZW50aXR5O1xyXG4gICAgICB9XHJcblxyXG4gICAgICAvL3RvIGJlIHVzZWQgdG8gZGlzYWJsZSBtdXR1YWwgYXV0aGVudGljYXRpb24gZm9yIGxlZ2FjeSB1c2Vyc1xyXG5cclxuICAgICAgaWYgKF90aGlzLl9wYXJlbnRPYmplY3QuZGF0YS5oYXNPd25Qcm9wZXJ0eSgnbXV0dWFsJykpIHJlcXVlc3RNc2cuYm9keS5tdXR1YWwgPSBfdGhpcy5fcGFyZW50T2JqZWN0LmRhdGEubXV0dWFsO1xyXG5cclxuICAgICAgaWYgKF90aGlzLl9wYXJlbnRPYmplY3QubWV0YWRhdGEucmVwb3J0ZXIgPT09IF90aGlzLm1ldGFkYXRhLnJlcG9ydGVyKSB7XHJcbiAgICAgICAgX3RoaXMuX2J1cy5wb3N0TWVzc2FnZShkZWVwQ2xvbmUocmVxdWVzdE1zZykpO1xyXG4gICAgICAgIHJldHVybiByZXNvbHZlKCk7XHJcbiAgICAgIH0gZWxzZSB7XHJcblxyXG4gICAgICAgIGxldCBjYWxsYmFjayA9IChyZXBseSkgPT4ge1xyXG5cclxuICAgICAgICAgIGlmIChyZXBseS50byA9PT0gX3RoaXMuX3JlcG9ydGVyKSB7XHJcbiAgICAgICAgICAgIF90aGlzLl9idXMucmVtb3ZlUmVzcG9uc2VMaXN0ZW5lcihyZXF1ZXN0TXNnLmZyb20sIHJlcGx5LmlkKTtcclxuXHJcbiAgICAgICAgICAgIGxvZy5sb2coJ1tTeW5jaGVyLkRhdGFPYmplY3RDaGlsZC5zaGFyZV0gUGFyZW50IHJlcG9ydGVyIHJlcGx5ICcsIHJlcGx5KTtcclxuXHJcbiAgICAgICAgICAgIGxldCByZXN1bHQgPSB7XHJcbiAgICAgICAgICAgICAgY29kZTogcmVwbHkuYm9keSAmJiByZXBseS5ib2R5LmNvZGUgPyByZXBseS5ib2R5LmNvZGUgOiA1MDAsXHJcbiAgICAgICAgICAgICAgZGVzYzogcmVwbHkuYm9keSAmJiByZXBseS5ib2R5LmRlc2MgPyByZXBseS5ib2R5LmRlc2MgOiAnVW5rbm93bidcclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgIGlmIChyZXBseS5ib2R5LmNvZGUgPCAzMDApIHtcclxuICAgICAgICAgICAgICByZXR1cm4gcmVzb2x2ZShyZXN1bHQpO1xyXG4gICAgICAgICAgICB9IGVsc2UgcmV0dXJuIHJlamVjdChyZXN1bHQpO1xyXG5cclxuICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBsZXQgaWQgPSBfdGhpcy5fYnVzLnBvc3RNZXNzYWdlKGRlZXBDbG9uZShyZXF1ZXN0TXNnKSwgY2FsbGJhY2ssIGZhbHNlKTtcclxuXHJcbiAgICAgICAgc2V0VGltZW91dCgoKT0+IHtcclxuXHJcbiAgICAgICAgICAvLyBJZiBSZXBvcnRlciBkb2VzICBub3QgcmVwbHkgdGhlIHByb21pc2UgaXMgcmVqZWN0ZWRcclxuICAgICAgICAgIF90aGlzLl9idXMucmVtb3ZlUmVzcG9uc2VMaXN0ZW5lcihyZXF1ZXN0TXNnLmZyb20sIGlkKTtcclxuXHJcbiAgICAgICAgICBsZXQgcmVzdWx0ID0ge1xyXG4gICAgICAgICAgICBjb2RlOiA0MDgsXHJcbiAgICAgICAgICAgIGRlc2M6ICd0aW1vdXQnXHJcbiAgICAgICAgICB9O1xyXG4gICAgICAgICAgcmV0dXJuIHJlamVjdChyZXN1bHQpO1xyXG5cclxuICAgICAgICB9LCAzMDAwKTtcclxuXHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG5cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAgICogVGhpcyBmdW5jdGlvbiBpcyB1c2VkIHRvIHNoYXJlIHRoZSBjaGlsZCBPYmplY3QgYW1vbmcgYXV0aG9yaXNlZCBIeXBlcnRpZXNcclxuICAgICAqIEBwYXJhbSAge2Jvb2xlYW59ICAgICByZXBvcnRlciAgSWYgdHJ1ZSB0aGUgY2hpbGQgb2JqZWN0IGlzIG9ubHkgc2hhcmVkIHRvIFBhcmVudCByZXBvcnRlclxyXG4gICAgICogQHJldHVybiB7UHJvbWlzZTxKU09OPn0gICAgICAgIEl0IHJldHVybnMgYSBwcm9taXNlIHdpdGggdGhlIHNoYXJpbmcgcmVzdWx0cy5cclxuICAgICAqL1xyXG5cclxuICBzdG9yZSgpIHtcclxuICAgIGxldCBfdGhpcyA9IHRoaXM7XHJcblxyXG4gICAgbGV0IGNoaWxkID0ge307XHJcbiAgICBsZXQga2V5ID0gX3RoaXMubWV0YWRhdGEuY2hpbGRyZW4gKyAnLicgKyBfdGhpcy5tZXRhZGF0YS51cmw7XHJcblxyXG4gICAgY2hpbGQudmFsdWUgPSBfdGhpcy5tZXRhZGF0YTtcclxuICAgIGNoaWxkLmlkZW50aXR5ID0gX3RoaXMuaWRlbnRpdHk7XHJcblxyXG4gICAgbGV0IG1zZyA9IHtcclxuXHJcbiAgICAgIGZyb206IF90aGlzLm1ldGFkYXRhLnJlcG9ydGVyLFxyXG4gICAgICB0bzogX3RoaXMuX3BhcmVudE9iamVjdC5fc3luY2hlci5fc3ViVVJMLFxyXG4gICAgICB0eXBlOiAnY3JlYXRlJyxcclxuICAgICAgYm9keToge1xyXG4gICAgICAgIHJlc291cmNlOiBfdGhpcy5tZXRhZGF0YS5wYXJlbnQsXHJcbiAgICAgICAgYXR0cmlidXRlOiBrZXksXHJcbiAgICAgICAgdmFsdWU6IGNoaWxkXHJcbiAgICAgIH1cclxuICAgIH07XHJcblxyXG4gICAgbG9nLmxvZygnW0RhdGFPYmplY3RDaGlsZC5zdG9yZV06JywgbXNnKTtcclxuXHJcbiAgICBfdGhpcy5fYnVzLnBvc3RNZXNzYWdlKG1zZyk7XHJcbiAgfVxyXG5cclxuICBfYWxsb2NhdGVMaXN0ZW5lcnMoKSB7XHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG5cclxuICAgIC8vdGhpcyBpcyBvbmx5IG5lZWRlZCBmb3IgY2hpbGRyZW4gcmVwb3J0ZXJzXHJcbiAgICBpZiAoX3RoaXMuX3JlcG9ydGVyID09PSBfdGhpcy5fb3duZXIpIHtcclxuICAgICAgX3RoaXMuX2xpc3RlbmVyID0gX3RoaXMuX2J1cy5hZGRMaXN0ZW5lcihfdGhpcy5fcmVwb3J0ZXIsIChtc2cpID0+IHtcclxuICAgICAgICBpZiAobXNnLnR5cGUgPT09ICdyZXNwb25zZScgJiYgbXNnLmlkID09PSBfdGhpcy5fbXNnSWQpIHtcclxuICAgICAgICAgIGxvZy5sb2coJ0RhdGFPYmplY3RDaGlsZC5vblJlc3BvbnNlOicsIG1zZyk7XHJcbiAgICAgICAgICBfdGhpcy5fb25SZXNwb25zZShtc2cpO1xyXG4gICAgICAgIH1cclxuICAgICAgfSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBfcmVsZWFzZUxpc3RlbmVycygpIHtcclxuICAgIGxldCBfdGhpcyA9IHRoaXM7XHJcblxyXG4gICAgaWYgKF90aGlzLl9saXN0ZW5lcikge1xyXG4gICAgICBfdGhpcy5fbGlzdGVuZXIucmVtb3ZlKCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBSZWxlYXNlIGFuZCBkZWxldGUgb2JqZWN0IGRhdGFcclxuICAgKi9cclxuICBkZWxldGUoKSB7XHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG5cclxuXHJcbiAgICBfdGhpcy5fcmVsZWFzZUxpc3RlbmVycygpO1xyXG5cclxuICAgIC8vVE9ETzogc2VuZCBkZWxldGUgbWVzc2FnZSA/XHJcblxyXG4gICAgLy8gbm90aGluZyB0byBiZSBkb25lXHJcbiAgICAvLyByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHtcclxuICAgIC8vICAgbG9nLmxvZygnW0RhdGFPYmplY3RDaGlsZC5kZWxldGVdJyk7XHJcbiAgICAvLyAgIHJlc29sdmUoKTtcclxuICAgIC8vIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQWxsIE1ldGFkYXRhIGFib3V0IHRoZSBDaGlsZCBEYXRhIE9iamVjdFxyXG4gICAqIEB0eXBlIHtPYmplY3R9IC1cclxuICAgKi9cclxuICBnZXQgbWV0YWRhdGEoKSB7IHJldHVybiB0aGlzLl9tZXRhZGF0YTsgfVxyXG5cclxuICAvKipcclxuICAgKiBDaGlsZHJlbiBJRCBnZW5lcmF0ZWQgb24gYWRkQ2hpbGRyZW4uIFVuaXF1ZSBpZGVudGlmaWVyXHJcbiAgICogQHR5cGUge1VSTH0gLSBVUkwgb2YgdGhlIGZvcm1hdCA8SHlwZXJ0eVVSTD4jPG51bWVyaWMtc2VxdWVuY2U+XHJcbiAgICovXHJcbiAgZ2V0IGNoaWxkSWQoKSB7IHJldHVybiB0aGlzLl9jaGlsZElkOyB9XHJcblxyXG4gIC8qKlxyXG4gICAqIERhdGEgU3RydWN0dXJlIHRvIGJlIHN5bmNocm9uaXplZC5cclxuICAgKiBAdHlwZSB7SlNPTn0gLSBKU09OIHN0cnVjdHVyZSB0aGF0IHNob3VsZCBmb2xsb3cgdGhlIGRlZmluZWQgc2NoZW1hLCBpZiBhbnkuXHJcbiAgICovXHJcblxyXG4gIGdldCBzaGFyaW5nU3RhdHVzKCkge1xyXG4gICAgcmV0dXJuIHRoaXMuX3NoYXJpbmdTdGF0dXM7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgICogRGF0YSBTdHJ1Y3R1cmUgdG8gYmUgc3luY2hyb25pemVkLlxyXG4gICAgKiBAdHlwZSB7SlNPTn0gLSBKU09OIHN0cnVjdHVyZSB0aGF0IHNob3VsZCBmb2xsb3cgdGhlIGRlZmluZWQgc2NoZW1hLCBpZiBhbnkuXHJcbiAgICAqL1xyXG5cclxuICBnZXQgZGF0YSgpIHsgcmV0dXJuIHRoaXMuX3N5bmNPYmouZGF0YTsgfVxyXG5cclxuICAvKipcclxuICAgKiBTZXQgZm9yIHRoaXMgZGF0YU9iamVjdENoaWxkIGFuIGlkZW50aXR5XHJcbiAgICogQG1ldGhvZCBpZGVudGl0eVxyXG4gICAqIEBwYXJhbSAge0lkZW50aXR5fSBpZGVudGl0eSBpZGVudGl0eSBmcm9tIHdobyBjcmVhdGVkIHRoZSBtZXNzYWdlXHJcbiAgICovXHJcbiAgc2V0IGlkZW50aXR5KGlkZW50aXR5KSB7IHRoaXMuX2lkZW50aXR5ID0gaWRlbnRpdHk7IH1cclxuXHJcbiAgLyoqXHJcbiAgICogR2V0IGZvciB0aGlzIGRhdGFPYmplY3RDaGlsZCBhbiBpZGVudGl0eVxyXG4gICAqIEBtZXRob2QgaWRlbnRpdHlcclxuICAgKiBAcmV0dXJuIHtJZGVudGl0eX0gaWRlbnRpdHkgZnJvbSB3aG8gY3JlYXRlZCB0aGUgbWVzc2FnZVxyXG4gICAqL1xyXG4gIGdldCBpZGVudGl0eSgpIHsgcmV0dXJuIHRoaXMuX2lkZW50aXR5OyB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFJlZ2lzdGVyIHRoZSBjaGFuZ2UgbGlzdGVuZXJzIHNlbnQgYnkgdGhlIHJlcG9ydGVyIGNoaWxkXHJcbiAgICogQHBhcmFtIHtmdW5jdGlvbihldmVudDogTXNnRXZlbnQpfSBjYWxsYmFja1xyXG4gICAqL1xyXG4gIG9uQ2hhbmdlKGNhbGxiYWNrKSB7XHJcbiAgICB0aGlzLl9zeW5jT2JqLm9ic2VydmUoKGV2ZW50KSA9PiB7XHJcbiAgICAgIGxvZy5sb2coJ1tEYXRhT2JqZWN0Q2hpbGQgLSBvYnNlcnZlcl0gLSAnLCBldmVudCk7XHJcbiAgICAgIGNhbGxiYWNrKGV2ZW50KTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogU2V0dXAgdGhlIGNhbGxiYWNrIHRvIHByb2Nlc3MgcmVzcG9uc2Ugbm90aWZpY2F0aW9ucyBvZiB0aGUgY3JlYXRlc1xyXG4gICAqIEBwYXJhbSB7ZnVuY3Rpb24oZXZlbnQ6IE1zZ0V2ZW50KX0gY2FsbGJhY2tcclxuICAgKi9cclxuICBvblJlc3BvbnNlKGNhbGxiYWNrKSB7XHJcbiAgICB0aGlzLl9vblJlc3BvbnNlSGFuZGxlciA9IGNhbGxiYWNrO1xyXG4gIH1cclxuXHJcbiAgLy9GTE9XLUlOOiBtZXNzYWdlIHJlY2VpdmVkIGZyb20gYSByZW1vdGUgRGF0YU9iamVjdCAtPiBfb25DaGlsZENyZWF0ZVxyXG4gIF9vblJlc3BvbnNlKG1zZykge1xyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuXHJcbiAgICBsZXQgZXZlbnQgPSB7XHJcbiAgICAgIHR5cGU6IG1zZy50eXBlLFxyXG4gICAgICB1cmw6IG1zZy5ib2R5LnNvdXJjZSxcclxuICAgICAgY29kZTogbXNnLmJvZHkuY29kZVxyXG4gICAgfTtcclxuXHJcbiAgICBpZiAoX3RoaXMuX29uUmVzcG9uc2VIYW5kbGVyKSB7XHJcbiAgICAgIF90aGlzLl9vblJlc3BvbnNlSGFuZGxlcihldmVudCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxufVxyXG5cclxuZXhwb3J0IGRlZmF1bHQgRGF0YU9iamVjdENoaWxkO1xyXG4iLCIvKipcclxuKiBUaGUgSHlwZXJ0eSBSZXNvdXJjZSBEYXRhIE1vZGVsIGlzIHVzZWQgdG8gbW9kZWwgcmVzb3VjZXMgaGFuZGxlZCBieSBIeXBlcnRpZXMgYW5kIERhdGEgT2JqZWN0cyBpbmNsdWRpbmcgY2hhdCBtZXNzYWdlcywgZmlsZXMsIHJlYWwgdGltZSBodW1hbiBhdWRpbyBhbmQgdmlkZW8uLlxyXG4qXHJcbiovXHJcblxyXG4vLyBMb2cgU3lzdGVtXHJcbmltcG9ydCAqIGFzIGxvZ2dlciBmcm9tICdsb2dsZXZlbCc7XHJcbmxldCBsb2cgPSBsb2dnZXIuZ2V0TG9nZ2VyKCdIeXBlcnR5UmVzb3VyY2UnKTtcclxuXHJcbmltcG9ydCB7IGRlZXBDbG9uZSB9IGZyb20gJy4uL3V0aWxzL3V0aWxzLmpzJztcclxuaW1wb3J0IERhdGFPYmplY3RDaGlsZCBmcm9tICcuLi9zeW5jaGVyL0RhdGFPYmplY3RDaGlsZC5qcyc7XHJcblxyXG5jbGFzcyBIeXBlcnR5UmVzb3VyY2UgZXh0ZW5kcyBEYXRhT2JqZWN0Q2hpbGQge1xyXG5cclxuICAvKipcclxuICAqIEh5cGVydHlSZXNvdXJjZSBjb25zdHJ1Y3RvclxyXG4gICpcclxuICAqIEBwYXJhbSAge1VSTH0gbG9jYWxSdW50aW1lVVJMIFJ1bnRpbWVVUkwgb2YgbG9jYWwgcnVudGltZVxyXG4gICogQHBhcmFtICB7VVJMfSBpbnB1dC5vd25lciBIeXBlcnR5VVJMIG9mIHRoZSBIeXBlcnR5IGhhbmRsaW5nIHRoaXMgcmVzb3VyY2VcclxuICAqIEBwYXJhbSAge1VSTH0gaW5wdXQucnVudGltZSBSdW50aW1lIFVSTCB3aGVyZSB0aGlzIHJlc291cmNlIGlzIGhvc3RlZFxyXG4gICogQHBhcmFtICB7QnVzfSBpbnB1dC5idXMgc2FuZGJveCBtZXNzYWdlIGJ1c1xyXG4gICogQHBhcmFtICB7RGF0YU9iamVjdH0gaW5wdXQucGFyZW50IFBhcmVudCBEYXRhIE9iamVjdCB3aGVyZSB0aGUgSHlwZXJ0eVJlc291cmNlIGlzIGhhbmRsZWQgYXMgYSBjaGlsZFxyXG4gICogQHBhcmFtICB7Qm9vbGVhbn0gaXNTZW5kZXIgaW5kaWNhdGVzIGlmIHBhcmVudCBpcyBSZXBvcnRlciBvciBhbiBPYnNlcnZlclxyXG4gICogQHBhcmFtICB7QXJyYXl9IGlucHV0IG9wdGlvbmFsIGlucHV0IHBhcmFtZXRlcnNcclxuICAqL1xyXG5cclxuICBjb25zdHJ1Y3Rvcihpc1NlbmRlciwgaW5wdXQpIHtcclxuICAgIHN1cGVyKGlucHV0KTtcclxuICAgIGxldCBfdGhpcyA9IHRoaXM7XHJcblxyXG4gICAgX3RoaXMuYXJyYXlidWZmZXJTaXplTGltaXQgPSA1MjQyODgwOyAvL2Fib3ZlIHRoaXMgbGltaXQgY29udGVudCBpcyBub3Qgc2F2ZWQgYXMgQXJyYXlCdWZmZXJcclxuXHJcbiAgICBfdGhpcy5faXNTZW5kZXIgPSBpc1NlbmRlcjtcclxuXHJcbiAgICBfdGhpcy5fbG9jYWxTdG9yYWdlVVJMID0gX3RoaXMuX3BhcmVudE9iamVjdC5fc3luY2hlci5fcnVudGltZVVybCArICcvc3RvcmFnZSc7XHJcblxyXG4gIH1cclxuXHJcbiAgZ2V0IHJlc291cmNlVHlwZSgpIHtcclxuICAgIGxldCBfdGhpcyA9IHRoaXM7XHJcbiAgICByZXR1cm4gX3RoaXMubWV0YWRhdGEucmVzb3VyY2VUeXBlO1xyXG4gIH1cclxuXHJcbiAgZ2V0IG1pbWV0eXBlKCkge1xyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuICAgIHJldHVybiBfdGhpcy5fbWV0YWRhdGEudHlwZTtcclxuICB9XHJcblxyXG4gIGdldCBjb250ZW50KCkge1xyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuICAgIHJldHVybiBfdGhpcy5fY29udGVudDtcclxuICB9XHJcblxyXG4gIGdldCBjb250ZW50VVJMKCkge1xyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuICAgIHJldHVybiBfdGhpcy5fbWV0YWRhdGEuY29udGVudFVSTDtcclxuICB9XHJcblxyXG4gIGdldCBzaGFyZWFibGUoKSB7XHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG4gICAgbGV0IHNoYXJlYWJsZSA9IHN1cGVyLm1ldGFkYXRhO1xyXG4gICAgc2hhcmVhYmxlLnJlc291cmNlVHlwZSA9IF90aGlzLnJlc291cmNlVHlwZTtcclxuICAgIHJldHVybiBzaGFyZWFibGU7XHJcbiAgfVxyXG5cclxuICAvKlxyXG4gIHNldCBwYXJlbnQocGFyZW50KSB7XHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG4gICAgX3RoaXMuX3BhcmVudCA9IHBhcmVudDtcclxuICB9Ki9cclxuXHJcbiAgc2F2ZSgpIHtcclxuICAgIGxldCBfdGhpcyA9IHRoaXM7XHJcblxyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG5cclxuICAgICAgbGV0IG1zZyA9IHtcclxuICAgICAgICBmcm9tOiBfdGhpcy5fb3duZXIsXHJcbiAgICAgICAgdG86IF90aGlzLl9sb2NhbFN0b3JhZ2VVUkwsXHJcbiAgICAgICAgdHlwZTogJ2NyZWF0ZScsXHJcbiAgICAgICAgYm9keTogeyB2YWx1ZTogZGVlcENsb25lKF90aGlzLl9tZXRhZGF0YSkgfVxyXG4gICAgICB9O1xyXG5cclxuICAgICAgbGV0IGNhbGxiYWNrID0gKHJlcGx5KSA9PiB7XHJcbiAgICAgICAgbG9nLmluZm8oJ1tIeXBlcnR5UmVzb3VyY2Uuc2F2ZV0gcmVwbHk6ICcsIHJlcGx5KTtcclxuICAgICAgICBfdGhpcy5fYnVzLnJlbW92ZVJlc3BvbnNlTGlzdGVuZXIoX3RoaXMuX293bmVyLCByZXBseS5pZCk7XHJcbiAgICAgICAgaWYgKHJlcGx5LmJvZHkuY29kZSA9PT0gMjAwKSB7XHJcbiAgICAgICAgICBpZiAocmVwbHkuYm9keS52YWx1ZSkge1xyXG4gICAgICAgICAgICBpZiAoIV90aGlzLl9tZXRhZGF0YS5jb250ZW50VVJMKSBfdGhpcy5fbWV0YWRhdGEuY29udGVudFVSTCA9IFtdO1xyXG4gICAgICAgICAgICBfdGhpcy5fbWV0YWRhdGEuY29udGVudFVSTC5wdXNoKHJlcGx5LmJvZHkudmFsdWUpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgcmVzb2x2ZSgpO1xyXG4gICAgICAgIH0gZWxzZSByZWplY3QocmVwbHkuYm9keS5jb2RlICsgJyAnICsgcmVwbHkuYm9keS5kZXNjKTtcclxuXHJcbiAgICAgIH07XHJcblxyXG4gICAgICBtc2cuYm9keS52YWx1ZS5jb250ZW50ID0gX3RoaXMuX2NvbnRlbnQ7XHJcblxyXG4gICAgICBfdGhpcy5fYnVzLnBvc3RNZXNzYWdlKG1zZywgY2FsbGJhY2ssIGZhbHNlKTtcclxuXHJcbiAgICB9KTtcclxuXHJcbiAgfVxyXG5cclxuICAvKipcclxuICAqIEZ1bmN0aW9uIHRvIFJlYWQgSHlwZXJ0eVJlc291cmNlXHJcbiAgKlxyXG4gICogQHBhcmFtICB7fSBjYWxsYmFjayBjYWxsYmFjayB0byBiZSBjYWxsZWQgd2l0aCBwcm9ncmVzcyBpbmZvcm1hdGlvbiBpbiB0ZXJtcyBvZiBwZXJjZW50YWdlXHJcbiAgKiBAcmV0dXJuICB7UHJvbWlzZX0gIGlucHV0IG9wdGlvbmFsIGlucHV0IHBhcmFtZXRlcnNcclxuICAqL1xyXG5cclxuXHJcbiAgcmVhZChjYWxsYmFjaykge1xyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuICAgIGxvZy5pbmZvKCdbSHlwZXJ0eVJlc291cmNlLnJlYWRdICcsIHRoaXMpO1xyXG5cclxuICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuXHJcbiAgICAgIGlmIChfdGhpcy5jb250ZW50KSB7XHJcbiAgICAgICAgcmVzb2x2ZShfdGhpcyk7XHJcbiAgICAgIH0gZWxzZSB7XHJcblxyXG4gICAgICAgIC8vVE9ETzogdXNlIGFuIGl0ZXJhdGlvbiB0byBnZXQgb25saW5lIHJ1bnRpbWUgc3RvcmFnZXMgd2hlbiBzb21lIGFyZSBvZmZsaW5lXHJcbiAgICAgICAgbGV0IHN0b3JhZ2UgPSBfdGhpcy5fZ2V0QmVzdENvbnRlbnRVUkwoX3RoaXMuX21ldGFkYXRhLmNvbnRlbnRVUkwpO1xyXG5cclxuICAgICAgICBsb2cubG9nKCdTdG9yYWdlOicsIHN0b3JhZ2UpO1xyXG5cclxuICAgICAgICBsZXQgbXNnID0ge1xyXG4gICAgICAgICAgZnJvbTogX3RoaXMuX293bmVyLFxyXG4gICAgICAgICAgdG86IHN0b3JhZ2UudXJsLFxyXG4gICAgICAgICAgdHlwZTogJ3JlYWQnLFxyXG4gICAgICAgICAgYm9keTogeyByZXNvdXJjZTogc3RvcmFnZS51cmwgKyAnLycgKyBzdG9yYWdlLnJlc291cmNlLCBwMnA6IHRydWUgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGlmIChfdGhpcy5tZXRhZGF0YS5wMnBSZXF1ZXN0ZXIgJiYgX3RoaXMubWV0YWRhdGEucDJwSGFuZGxlcikge1xyXG4gICAgICAgICAgbXNnLmJvZHkucDJwUmVxdWVzdGVyID0gX3RoaXMubWV0YWRhdGEucDJwUmVxdWVzdGVyO1xyXG4gICAgICAgICAgbXNnLmJvZHkucDJwSGFuZGxlciA9IF90aGlzLm1ldGFkYXRhLnAycEhhbmRsZXI7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBnZXQgdGhlIHJlc291cmNlIGZpcnN0IG9uIHRoZSBMb2NhbCBIeXBlcnR5IFJlc291cmNlIFN0b3JhZ2U7XHJcbiAgICAgICAgX3RoaXMuX2dldEJlc3RSZXNvdXJjZShtc2csIGNhbGxiYWNrKS50aGVuKChyZXBseSkgPT4ge1xyXG4gICAgICAgICAgbG9nLmluZm8oJ1tIeXBlcnR5UmVzb3VyY2VdIC0gZ2V0IGxvY2FsbHkgdGhlIHJlc291cmNlOicsIHJlcGx5KTtcclxuICAgICAgICAgIHJlc29sdmUoX3RoaXMpO1xyXG4gICAgICAgIH0pLmNhdGNoKChyZXBseSkgPT4ge1xyXG5cclxuICAgICAgICAgIGxvZy53YXJuKCdbSHlwZXJ0eVJlc291cmNlXSAtIGdldCBsb2NhbGx5IHRoZSByZXNvdXJjZSBmYWlsJywgcmVwbHkpO1xyXG5cclxuICAgICAgICAgIC8vIEdlbmVyYXRlIG5ldyBtZXNzYWdlIHRvIG5vdCB1c2UgdGhlIHNhbWUgaWQgb2YgdGhlIGxhc3Qgb25lO1xyXG4gICAgICAgICAgbGV0IG1zZyA9IHtcclxuICAgICAgICAgICAgZnJvbTogX3RoaXMuX293bmVyLFxyXG4gICAgICAgICAgICB0bzogc3RvcmFnZS5yZW1vdGVVUkwsXHJcbiAgICAgICAgICAgIHR5cGU6ICdyZWFkJyxcclxuICAgICAgICAgICAgYm9keTogeyByZXNvdXJjZTogc3RvcmFnZS5yZW1vdGVVUkwgKyAnLycgKyBzdG9yYWdlLnJlc291cmNlLCBwMnA6IHRydWUgfVxyXG4gICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICBpZiAoX3RoaXMubWV0YWRhdGEucDJwUmVxdWVzdGVyICYmIF90aGlzLm1ldGFkYXRhLnAycEhhbmRsZXIpIHtcclxuICAgICAgICAgICAgbXNnLmJvZHkucDJwUmVxdWVzdGVyID0gX3RoaXMubWV0YWRhdGEucDJwUmVxdWVzdGVyO1xyXG4gICAgICAgICAgICBtc2cuYm9keS5wMnBIYW5kbGVyID0gX3RoaXMubWV0YWRhdGEucDJwSGFuZGxlcjtcclxuICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAvLyBnZXQgdGhlIHJlc291cmNlIG9uIHRoZSBSZW1vdGUgSHlwZXJ0eSBSZXNvdXJjZSBTdG9yYWdlO1xyXG4gICAgICAgICAgX3RoaXMuX2dldEJlc3RSZXNvdXJjZShtc2csIGNhbGxiYWNrKS50aGVuKChyZXBseSkgPT4ge1xyXG4gICAgICAgICAgICBsb2cud2FybignW0h5cGVydHlSZXNvdXJjZV0gLSBnZXQgcmVtb3RlbHkgdGhlIHJlc291cmNlJywgcmVwbHkpO1xyXG4gICAgICAgICAgICByZXNvbHZlKF90aGlzKTtcclxuICAgICAgICAgIH0pLmNhdGNoKChyZXBseSkgPT4ge1xyXG4gICAgICAgICAgICBsb2cud2FybignW0h5cGVydHlSZXNvdXJjZV0gLSBnZXQgcmVtb3RlbHkgdGhlIHJlc291cmNlIGZhaWwnLCByZXBseSk7XHJcbiAgICAgICAgICAgIHJlamVjdChyZXBseS5ib2R5LmNvZGUgKyAnICcgKyByZXBseS5ib2R5LmRlc2MpO1xyXG4gICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBfZ2V0QmVzdFJlc291cmNlKG1zZywgaW5Qcm9ncmVzc0NhbGxiYWNrKSB7XHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG5cclxuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XHJcblxyXG4gICAgICBsZXQgd2FpdEZvclJlc3BvbnNlID0gc2V0VGltZW91dCgoKSA9PiB7XHJcblxyXG4gICAgICAgIC8vIElmIFJlcG9ydGVyIGRvZXMgIG5vdCByZXBseSB0aGUgcHJvbWlzZSBpcyByZWplY3RlZFxyXG4gICAgICAgIF90aGlzLl9idXMucmVtb3ZlUmVzcG9uc2VMaXN0ZW5lcihfdGhpcy5fb3duZXIsIGlkKTtcclxuXHJcbiAgICAgICAgbXNnLmJvZHkuY29kZSA9IDQwODtcclxuICAgICAgICBtc2cuYm9keS5kZXNjID0gJ1Jlc3BvbnNlIHRpbWVvdXQnXHJcblxyXG4gICAgICAgIHJldHVybiByZWplY3QobXNnKTtcclxuXHJcbiAgICAgIH0sIDMwMDApO1xyXG5cclxuICAgICAgbGV0IGNhbGxiYWNrID0gKHJlcGx5KSA9PiB7XHJcbiAgICAgICAgbG9nLmxvZygnW0h5cGVydHlSZXNvdXJjZS5yZWFkXSByZXBseTogJywgcmVwbHkpO1xyXG4gICAgICAgIGxldCBpZCA9IHJlcGx5LmlkO1xyXG5cclxuICAgICAgICBjbGVhclRpbWVvdXQod2FpdEZvclJlc3BvbnNlKTtcclxuXHJcbiAgICAgICAgc3dpdGNoIChyZXBseS5ib2R5LmNvZGUpIHtcclxuICAgICAgICAgIGNhc2UgMjAwOlxyXG4gICAgICAgICAgICBfdGhpcy5fY29udGVudCA9IHJlcGx5LmJvZHkudmFsdWUuY29udGVudDtcclxuXHJcbiAgICAgICAgICAgIC8vIHNhdmUgbG9jYWxseSBpZiBub3QgdG9vIGJpZ1xyXG4gICAgICAgICAgICBpZiAocmVwbHkuYm9keS52YWx1ZS5zaXplIDwgX3RoaXMuYXJyYXlidWZmZXJTaXplTGltaXQpIHtcclxuICAgICAgICAgICAgICBfdGhpcy5zYXZlKCk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIF90aGlzLl9idXMucmVtb3ZlUmVzcG9uc2VMaXN0ZW5lcihfdGhpcy5fb3duZXIsIGlkKTtcclxuICAgICAgICAgICAgcmVzb2x2ZShyZXBseSk7XHJcblxyXG4gICAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgICBjYXNlIDE4MzpcclxuICAgICAgICAgICAgaW5Qcm9ncmVzc0NhbGxiYWNrKHJlcGx5LmJvZHkudmFsdWUpO1xyXG4gICAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICBfdGhpcy5fYnVzLnJlbW92ZVJlc3BvbnNlTGlzdGVuZXIoX3RoaXMuX293bmVyLCBpZCk7XHJcbiAgICAgICAgICAgIHJlamVjdChyZXBseSk7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgIH07XHJcblxyXG4gICAgICBsZXQgaWQgPSBfdGhpcy5fYnVzLnBvc3RNZXNzYWdlKG1zZywgY2FsbGJhY2ssIGZhbHNlKTtcclxuXHJcbiAgICB9KTtcclxuXHJcbiAgfVxyXG5cclxuICAvLyBSZW1vdmUgSHlwZXJ0eSBmcm9tIHRoZSBsb2NhbCBzdG9yYWdlXHJcblxyXG4gIGRlbGV0ZSgpIHtcclxuICAgIGxldCBfdGhpcyA9IHRoaXM7XHJcblxyXG4gICAgbG9nLmluZm8oJ1tIeXBlcnR5UmVzb3VyY2UuZGVsZXRlXScsIF90aGlzLm1ldGFkYXRhKTtcclxuXHJcblxyXG4gICAgbGV0IG1zZyA9IHtcclxuICAgICAgZnJvbTogX3RoaXMuX293bmVyLFxyXG4gICAgICB0bzogX3RoaXMuX2xvY2FsU3RvcmFnZVVSTCxcclxuICAgICAgdHlwZTogJ2RlbGV0ZScsXHJcbiAgICAgIGJvZHk6IHsgcmVzb3VyY2VzOiBfdGhpcy5tZXRhZGF0YS5jb250ZW50VVJMIH1cclxuICAgIH07XHJcblxyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7XHJcbiAgICAgIF90aGlzLl9idXMucG9zdE1lc3NhZ2UobXNnLCAocmVwbHkpID0+IHtcclxuICAgICAgICBpZiAocmVwbHkuYm9keS5jb2RlIDwgMzAwKSByZXNvbHZlKHRydWUpO1xyXG4gICAgICAgIGVsc2UgcmVzb2x2ZShmYWxzZSk7XHJcbiAgICAgIH0pO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBfZ2V0QmVzdENvbnRlbnRVUkwoY29udGVudFVSTExpc3QpIHtcclxuXHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG5cclxuICAgIGNvbnN0IGNvbnRlbnRVUkwgPSBjb250ZW50VVJMTGlzdFswXTtcclxuICAgIGNvbnN0IHNwbGl0ZWRSZXNvdXJjZSA9IGNvbnRlbnRVUkwuc3Vic3RyKGNvbnRlbnRVUkwubGFzdEluZGV4T2YoJy8nKSArIDEpO1xyXG4gICAgY29uc3QgdXJsID0gX3RoaXMuX2xvY2FsU3RvcmFnZVVSTDsgLy8gY29udGVudFVSTC5zdWJzdHIoMCwgY29udGVudFVSTC5sYXN0SW5kZXhPZignLycpKTtcclxuICAgIGNvbnN0IHJlbW90ZVJlc291cmNlID0gY29udGVudFVSTC5zdWJzdHIoMCwgY29udGVudFVSTC5sYXN0SW5kZXhPZignLycpKTtcclxuXHJcbiAgICByZXR1cm4ge3VybDogdXJsLCByZXNvdXJjZTogc3BsaXRlZFJlc291cmNlLCByZW1vdGVVUkw6IHJlbW90ZVJlc291cmNlIH07XHJcblxyXG4gIH1cclxuXHJcbn1cclxuXHJcblxyXG5leHBvcnQgZGVmYXVsdCBIeXBlcnR5UmVzb3VyY2U7XHJcbiIsImxldCBoYXNCbG9iQ29uc3RydWN0b3IgPSB0eXBlb2YoQmxvYikgIT09ICd1bmRlZmluZWQnICYmIChmdW5jdGlvbiAoKSB7XHJcbiAgICB0cnkge1xyXG4gICAgICAgIHJldHVybiBCb29sZWFuKG5ldyBCbG9iKCkpO1xyXG4gICAgfSBjYXRjaCAoZSkge1xyXG4gICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH1cclxufSgpKTtcclxuXHJcbmxldCBoYXNBcnJheUJ1ZmZlclZpZXdTdXBwb3J0ID0gaGFzQmxvYkNvbnN0cnVjdG9yICYmIHR5cGVvZihVaW50OEFycmF5KSAhPT0gJ3VuZGVmaW5lZCcgJiYgKGZ1bmN0aW9uICgpIHtcclxuICAgIHRyeSB7XHJcbiAgICAgICAgcmV0dXJuIG5ldyBCbG9iKFtuZXcgVWludDhBcnJheSgxMDApXSkuc2l6ZSA9PT0gMTAwO1xyXG4gICAgfSBjYXRjaCAoZSkge1xyXG4gICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH1cclxufSgpKTtcclxuXHJcbmxldCBoYXNUb0Jsb2JTdXBwb3J0ID0gKHR5cGVvZiBIVE1MQ2FudmFzRWxlbWVudCAhPT0gXCJ1bmRlZmluZWRcIiA/IEhUTUxDYW52YXNFbGVtZW50LnByb3RvdHlwZS50b0Jsb2IgOiBmYWxzZSk7XHJcblxyXG5sZXQgaGFzQmxvYlN1cHBvcnQgPSAoaGFzVG9CbG9iU3VwcG9ydCB8fCAodHlwZW9mIFVpbnQ4QXJyYXkgIT09ICd1bmRlZmluZWQnICYmIHR5cGVvZiBBcnJheUJ1ZmZlciAhPT0gJ3VuZGVmaW5lZCcgJiYgdHlwZW9mIGF0b2IgIT09ICd1bmRlZmluZWQnKSk7XHJcblxyXG5sZXQgaGFzUmVhZGVyU3VwcG9ydCA9ICh0eXBlb2YgRmlsZVJlYWRlciAhPT0gJ3VuZGVmaW5lZCcgfHwgdHlwZW9mIFVSTCAhPT0gJ3VuZGVmaW5lZCcpO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgSW1hZ2VUb29scyB7XHJcbiAgICBzdGF0aWMgcmVzaXplKGZpbGUsIG1heERpbWVuc2lvbnMsIGNhbGxiYWNrKSB7XHJcbiAgICAgICAgaWYgKHR5cGVvZiBtYXhEaW1lbnNpb25zID09PSAnZnVuY3Rpb24nKSB7XHJcbiAgICAgICAgICAgIGNhbGxiYWNrID0gbWF4RGltZW5zaW9ucztcclxuICAgICAgICAgICAgbWF4RGltZW5zaW9ucyA9IHtcclxuICAgICAgICAgICAgICAgIHdpZHRoOiA2NDAsXHJcbiAgICAgICAgICAgICAgICBoZWlnaHQ6IDQ4MFxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgbGV0IG1heFdpZHRoICA9IG1heERpbWVuc2lvbnMud2lkdGg7XHJcbiAgICAgICAgbGV0IG1heEhlaWdodCA9IG1heERpbWVuc2lvbnMuaGVpZ2h0O1xyXG5cclxuICAgICAgICBpZiAoIUltYWdlVG9vbHMuaXNTdXBwb3J0ZWQoKSB8fCAhZmlsZS50eXBlLm1hdGNoKC9pbWFnZS4qLykpIHtcclxuICAgICAgICAgICAgY2FsbGJhY2soZmlsZSwgZmFsc2UpO1xyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAoZmlsZS50eXBlLm1hdGNoKC9pbWFnZVxcL2dpZi8pKSB7XHJcbiAgICAgICAgICAgIC8vIE5vdCBhdHRlbXB0aW5nLCBjb3VsZCBiZSBhbiBhbmltYXRlZCBnaWZcclxuICAgICAgICAgICAgY2FsbGJhY2soZmlsZSwgZmFsc2UpO1xyXG4gICAgICAgICAgICAvLyBUT0RPOiB1c2UgaHR0cHM6Ly9naXRodWIuY29tL2FudGltYXR0ZXIxNS93aGFtbXkgdG8gY29udmVydCBnaWYgdG8gd2VibVxyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBsZXQgaW1hZ2UgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbWcnKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgaW1hZ2Uub25sb2FkID0gKGltZ0V2dCkgPT4ge1xyXG4gICAgICAgICAgICBsZXQgd2lkdGggID0gaW1hZ2Uud2lkdGg7XHJcbiAgICAgICAgICAgIGxldCBoZWlnaHQgPSBpbWFnZS5oZWlnaHQ7XHJcbiAgICAgICAgICAgIGxldCBpc1Rvb0xhcmdlID0gZmFsc2U7XHJcblxyXG4gICAgICAgICAgICBpZiAod2lkdGggPj0gaGVpZ2h0ICYmIHdpZHRoID4gbWF4RGltZW5zaW9ucy53aWR0aCkge1xyXG4gICAgICAgICAgICAgICAgLy8gd2lkdGggaXMgdGhlIGxhcmdlc3QgZGltZW5zaW9uLCBhbmQgaXQncyB0b28gYmlnLlxyXG4gICAgICAgICAgICAgICAgaGVpZ2h0ICo9IG1heERpbWVuc2lvbnMud2lkdGggLyB3aWR0aDtcclxuICAgICAgICAgICAgICAgIHdpZHRoID0gbWF4RGltZW5zaW9ucy53aWR0aDtcclxuICAgICAgICAgICAgICAgIGlzVG9vTGFyZ2UgPSB0cnVlO1xyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKGhlaWdodCA+IG1heERpbWVuc2lvbnMuaGVpZ2h0KSB7XHJcbiAgICAgICAgICAgICAgICAvLyBlaXRoZXIgd2lkdGggd2Fzbid0IG92ZXItc2l6ZSBvciBoZWlnaHQgaXMgdGhlIGxhcmdlc3QgZGltZW5zaW9uXHJcbiAgICAgICAgICAgICAgICAvLyBhbmQgdGhlIGhlaWdodCBpcyBvdmVyLXNpemVcclxuICAgICAgICAgICAgICAgIHdpZHRoICo9IG1heERpbWVuc2lvbnMuaGVpZ2h0IC8gaGVpZ2h0O1xyXG4gICAgICAgICAgICAgICAgaGVpZ2h0ID0gbWF4RGltZW5zaW9ucy5oZWlnaHQ7XHJcbiAgICAgICAgICAgICAgICBpc1Rvb0xhcmdlID0gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKCFpc1Rvb0xhcmdlKSB7XHJcbiAgICAgICAgICAgICAgICAvLyBlYXJseSBleGl0OyBubyBuZWVkIHRvIHJlc2l6ZVxyXG4gICAgICAgICAgICAgICAgY2FsbGJhY2soZmlsZSwgZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBsZXQgY2FudmFzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnY2FudmFzJyk7XHJcbiAgICAgICAgICAgIGNhbnZhcy53aWR0aCA9IHdpZHRoO1xyXG4gICAgICAgICAgICBjYW52YXMuaGVpZ2h0ID0gaGVpZ2h0O1xyXG5cclxuICAgICAgICAgICAgbGV0IGN0eCA9IGNhbnZhcy5nZXRDb250ZXh0KCcyZCcpO1xyXG4gICAgICAgICAgICBjdHguZHJhd0ltYWdlKGltYWdlLCAwLCAwLCB3aWR0aCwgaGVpZ2h0KTtcclxuXHJcbiAgICAgICAgICAgIGlmIChoYXNUb0Jsb2JTdXBwb3J0KSB7XHJcbiAgICAgICAgICAgICAgICBjYW52YXMudG9CbG9iKChibG9iKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soYmxvYiwgdHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICB9LCBmaWxlLnR5cGUpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgbGV0IGJsb2IgPSBJbWFnZVRvb2xzLl90b0Jsb2IoY2FudmFzLCBmaWxlLnR5cGUpO1xyXG4gICAgICAgICAgICAgICAgY2FsbGJhY2soYmxvYiwgdHJ1ZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgICAgIEltYWdlVG9vbHMuX2xvYWRJbWFnZShpbWFnZSwgZmlsZSk7XHJcblxyXG4gICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgfVxyXG5cclxuICAgIHN0YXRpYyBfdG9CbG9iKGNhbnZhcywgdHlwZSkge1xyXG4gICAgICAgIGxldCBkYXRhVVJJID0gY2FudmFzLnRvRGF0YVVSTCh0eXBlKTtcclxuICAgICAgICBsZXQgZGF0YVVSSVBhcnRzID0gZGF0YVVSSS5zcGxpdCgnLCcpO1xyXG4gICAgICAgIGxldCBieXRlU3RyaW5nO1xyXG4gICAgICAgIGlmIChkYXRhVVJJUGFydHNbMF0uaW5kZXhPZignYmFzZTY0JykgPj0gMCkge1xyXG4gICAgICAgICAgICAvLyBDb252ZXJ0IGJhc2U2NCB0byByYXcgYmluYXJ5IGRhdGEgaGVsZCBpbiBhIHN0cmluZzpcclxuICAgICAgICAgICAgYnl0ZVN0cmluZyA9IGF0b2IoZGF0YVVSSVBhcnRzWzFdKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAvLyBDb252ZXJ0IGJhc2U2NC9VUkxFbmNvZGVkIGRhdGEgY29tcG9uZW50IHRvIHJhdyBiaW5hcnkgZGF0YTpcclxuICAgICAgICAgICAgYnl0ZVN0cmluZyA9IGRlY29kZVVSSUNvbXBvbmVudChkYXRhVVJJUGFydHNbMV0pO1xyXG4gICAgICAgIH1cclxuICAgICAgICBsZXQgYXJyYXlCdWZmZXIgPSBuZXcgQXJyYXlCdWZmZXIoYnl0ZVN0cmluZy5sZW5ndGgpO1xyXG4gICAgICAgIGxldCBpbnRBcnJheSA9IG5ldyBVaW50OEFycmF5KGFycmF5QnVmZmVyKTtcclxuXHJcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBieXRlU3RyaW5nLmxlbmd0aDsgaSArPSAxKSB7XHJcbiAgICAgICAgICAgIGludEFycmF5W2ldID0gYnl0ZVN0cmluZy5jaGFyQ29kZUF0KGkpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgbGV0IG1pbWVTdHJpbmcgPSBkYXRhVVJJUGFydHNbMF0uc3BsaXQoJzonKVsxXS5zcGxpdCgnOycpWzBdO1xyXG4gICAgICAgIGxldCBibG9iID0gbnVsbDtcclxuXHJcbiAgICAgICAgaWYgKGhhc0Jsb2JDb25zdHJ1Y3Rvcikge1xyXG4gICAgICAgICAgICBibG9iID0gbmV3IEJsb2IoXHJcbiAgICAgICAgICAgICAgICBbaGFzQXJyYXlCdWZmZXJWaWV3U3VwcG9ydCA/IGludEFycmF5IDogYXJyYXlCdWZmZXJdLFxyXG4gICAgICAgICAgICAgICAge3R5cGU6IG1pbWVTdHJpbmd9XHJcbiAgICAgICAgICAgICk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgbGV0IGJiID0gbmV3IEJsb2JCdWlsZGVyKCk7XHJcbiAgICAgICAgICAgIGJiLmFwcGVuZChhcnJheUJ1ZmZlcik7XHJcbiAgICAgICAgICAgIGJsb2IgPSBiYi5nZXRCbG9iKG1pbWVTdHJpbmcpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIGJsb2I7XHJcbiAgICB9XHJcblxyXG4gICAgc3RhdGljIF9sb2FkSW1hZ2UoaW1hZ2UsIGZpbGUsIGNhbGxiYWNrKSB7XHJcbiAgICAgICAgaWYgKHR5cGVvZihVUkwpID09PSAndW5kZWZpbmVkJykge1xyXG4gICAgICAgICAgICBsZXQgcmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKTtcclxuICAgICAgICAgICAgcmVhZGVyLm9ubG9hZCA9IGZ1bmN0aW9uKGV2dCkge1xyXG4gICAgICAgICAgICAgICAgaW1hZ2Uuc3JjID0gZXZ0LnRhcmdldC5yZXN1bHQ7XHJcbiAgICAgICAgICAgICAgICBpZiAoY2FsbGJhY2spIHsgY2FsbGJhY2soKTsgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJlYWRlci5yZWFkQXNEYXRhVVJMKGZpbGUpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGltYWdlLnNyYyA9IFVSTC5jcmVhdGVPYmplY3RVUkwoZmlsZSk7XHJcbiAgICAgICAgICAgIGlmIChjYWxsYmFjaykgeyBjYWxsYmFjaygpOyB9XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuXHJcbiAgICBzdGF0aWMgaXNTdXBwb3J0ZWQoKSB7XHJcbiAgICAgICAgcmV0dXJuIChcclxuICAgICAgICAgICAgICAgKHR5cGVvZihIVE1MQ2FudmFzRWxlbWVudCkgIT09ICd1bmRlZmluZWQnKSBcclxuICAgICAgICAgICAgJiYgaGFzQmxvYlN1cHBvcnRcclxuICAgICAgICAgICAgJiYgaGFzUmVhZGVyU3VwcG9ydFxyXG4gICAgICAgICk7XHJcbiAgICB9XHJcbn1cclxuIiwiLyoqXHJcbiogVGhlIEh5cGVydHkgUmVzb3VyY2UgRGF0YSBNb2RlbCBpcyB1c2VkIHRvIG1vZGVsIHJlc291Y2VzIGhhbmRsZWQgYnkgSHlwZXJ0aWVzIGFuZCBEYXRhIE9iamVjdHMgaW5jbHVkaW5nIGNoYXQgbWVzc2FnZXMsIGZpbGVzLCByZWFsIHRpbWUgaHVtYW4gYXVkaW8gYW5kIHZpZGVvLi5cclxuKlxyXG4qL1xyXG5cclxuLy8gTG9nIFN5c3RlbVxyXG5pbXBvcnQgKiBhcyBsb2dnZXIgZnJvbSAnbG9nbGV2ZWwnO1xyXG5sZXQgbG9nID0gbG9nZ2VyLmdldExvZ2dlcignRmlsZUh5cGVydHlSZXNvdXJjZScpO1xyXG5cclxuaW1wb3J0IEh5cGVydHlSZXNvdXJjZSBmcm9tICcuL0h5cGVydHlSZXNvdXJjZSc7XHJcbmltcG9ydCB7IGRlZXBDbG9uZSB9IGZyb20gJy4uL3V0aWxzL3V0aWxzLmpzJztcclxuaW1wb3J0IEltYWdlVG9vbHMgZnJvbSAnLi4vdXRpbHMvSW1hZ2VUb29scy5qcyc7XHJcblxyXG5cclxuY2xhc3MgRmlsZUh5cGVydHlSZXNvdXJjZSBleHRlbmRzIEh5cGVydHlSZXNvdXJjZSB7XHJcblxyXG4gIC8qKlxyXG4gICogRmlsZUh5cGVydHlSZXNvdXJjZSBjb25zdHJ1Y3RvclxyXG4gICpcclxuICAqIEBwYXJhbSAge1VSTH0gb3duZXIgSHlwZXJ0eVVSTCBvZiB0aGUgSHlwZXJ0eSBoYW5kbGluZyB0aGlzIHJlc291cmNlXHJcbiAgKiBAcGFyYW0gIHtVUkx9IHJ1bnRpbWUgUnVudGltZSBVUkwgd2hlcmUgdGhpcyByZXNvdXJjZSBpcyBob3N0ZWRcclxuICAqIEBwYXJhbSAge0J1c30gYnVzIHNhbmRib3ggbWVzc2FnZSBidXNcclxuICAqIEBwYXJhbSAge0RhdGFPYmplY3R9IHBhcmVudCBQYXJlbnQgRGF0YSBPYmplY3Qgd2hlcmUgdGhlIEh5cGVydHlSZXNvdXJjZSBpcyBoYW5kbGVkIGFzIGEgY2hpbGRcclxuICAqIEBwYXJhbSAge0ZpbGV9IGZpbGUgZmlsZSB0byBiZSBlbmNvZGVkIGFzIEh5cGVydHlSZXNvdXJjZVxyXG4gICogQHBhcmFtICB7Qm9vbGVhbn0gaXNSZXBvcnRlciBpbmRpY2F0ZXMgaWYgcGFyZW50IGlzIFJlcG9ydGVyIG9yIGFuIE9ic2VydmVyXHJcbiAgKiBAcGFyYW0gIHtBcnJheX0gaW5wdXQgb3B0aW9uYWwgaW5wdXQgcGFyYW1ldGVyc1xyXG4gICovXHJcblxyXG4gIGNvbnN0cnVjdG9yKGlzU2VuZGVyLCBpbnB1dCkge1xyXG5cclxuICAgIHN1cGVyKGlzU2VuZGVyLCBpbnB1dCk7XHJcblxyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuXHJcbiAgICBfdGhpcy5tZXRhZGF0YS5yZXNvdXJjZVR5cGUgPSAnZmlsZSc7XHJcblxyXG4gIH1cclxuXHJcbiAgaW5pdChmaWxlKSB7XHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG5cclxuICAgIGlmICghZmlsZSkgdGhyb3cgbmV3IEVycm9yKCdbRmlsZUh5cGVydHlSZXNvdXJjZS5jb25zdHJ1Y3Rvcl0gbWlzc2luZyBtYW5kYXRvcnkgKmZpbGUqIGlucHV0ICcpO1xyXG5cclxuICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuXHJcbiAgICAgIF90aGlzLl9tZXRhZGF0YS5uYW1lID0gZmlsZS5uYW1lO1xyXG4gICAgICBfdGhpcy5fbWV0YWRhdGEubGFzdE1vZGlmaWVkID0gZmlsZS5sYXN0TW9kaWZpZWQ7XHJcbiAgICAgIF90aGlzLl9tZXRhZGF0YS5zaXplID0gZmlsZS5zaXplO1xyXG4gICAgICBfdGhpcy5fbWV0YWRhdGEubWltZXR5cGUgPSBmaWxlLnR5cGU7XHJcblxyXG4gICAgICBsb2cubG9nKCdbRmlsZUh5cGVydHlSZXNvdXJjZS5pbml0XSBmaWxlOiAnLCBmaWxlKTtcclxuXHJcbiAgICAgIGlmIChfdGhpcy5faXNTZW5kZXIpIHtcclxuXHJcbiAgICAgICAgbGV0IG1pbWV0eXBlID0gZmlsZS50eXBlLnNwbGl0KCcvJylbMF07XHJcblxyXG4gICAgICAgIHN3aXRjaCAobWltZXR5cGUpIHtcclxuICAgICAgICAgIGNhc2UgJ2ltYWdlJyA6XHJcbiAgICAgICAgICAgIF90aGlzLl9nZXRJbWFnZVByZXZpZXcoZmlsZSkudGhlbigocHJldmlldyk9PntcclxuICAgICAgICAgICAgICBfdGhpcy5fbWV0YWRhdGEucHJldmlldyA9IHByZXZpZXc7XHJcbiAgICAgICAgICAgICAgX3RoaXMuX2NvbnRlbnQgPSBmaWxlO1xyXG4gICAgICAgICAgICAgIHJlc29sdmUoKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgZGVmYXVsdCA6XHJcbiAgICAgICAgICAgIF90aGlzLl9jb250ZW50ID0gZmlsZTtcclxuICAgICAgICAgICAgcmVzb2x2ZSgpO1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIGlmIHRvbyBiaWcgbGV0cyBzdG9yZSBhcyBGaWxlIGFuZCBhc0FycmF5IEJ1ZmZlclxyXG5cclxuICAgICAgLy8gIGlmIChmaWxlLnNpemUgPiBfdGhpcy5hcnJheWJ1ZmZlclNpemVMaW1pdCkge1xyXG4gICAgICAvKiAgfSBlbHNlIHtcclxuXHJcbiAgICAgICAgICBsZXQgcmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKTtcclxuXHJcbiAgICAgICAgICByZWFkZXIub25sb2FkID0gZnVuY3Rpb24odGhlRmlsZSkge1xyXG5cclxuICAgICAgICAgICAgbG9nLmxvZygnW0ZpbGVIeXBlcnR5UmVzb3VyY2UuaW5pdF0gZmlsZSBsb2FkZWQgJywgdGhlRmlsZSk7XHJcblxyXG4gICAgICAgICAgICBfdGhpcy5fY29udGVudCA9IHRoZUZpbGUudGFyZ2V0LnJlc3VsdDtcclxuICAgICAgICAgICAgcmVzb2x2ZSgpO1xyXG5cclxuICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICByZWFkZXIucmVhZEFzQXJyYXlCdWZmZXIoZmlsZSk7XHJcblxyXG4gICAgICAgIH0qL1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICBfdGhpcy5fY29udGVudCA9IGZpbGUuY29udGVudDtcclxuICAgICAgaWYgKGZpbGUucHJldmlldykgX3RoaXMuX21ldGFkYXRhLnByZXZpZXcgPSBmaWxlLnByZXZpZXc7XHJcbiAgICAgIHJlc29sdmUoKTtcclxuICAgIH1cclxuXHJcbiAgICB9KTtcclxuXHJcbiAgfVxyXG5cclxuIF9nZXRJbWFnZVByZXZpZXcoaW1hZ2Upe1xyXG4gICBsZXQgcmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKTtcclxuICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLHJlamVjdCk9PntcclxuXHJcbiAgIEltYWdlVG9vbHMucmVzaXplKGltYWdlLCB7XHJcbiAgICAgICAgd2lkdGg6IDEwMCwgLy8gbWF4aW11bSB3aWR0aFxyXG4gICAgICAgIGhlaWdodDogMTAwIC8vIG1heGltdW0gaGVpZ2h0XHJcbiAgICB9LCBmdW5jdGlvbihibG9iLCBkaWRJdFJlc2l6ZSkge1xyXG4gICAgICAgIC8vIGRpZEl0UmVzaXplIHdpbGwgYmUgdHJ1ZSBpZiBpdCBtYW5hZ2VkIHRvIHJlc2l6ZSBpdCwgb3RoZXJ3aXNlIGZhbHNlIChhbmQgd2lsbCByZXR1cm4gdGhlIG9yaWdpbmFsIGZpbGUgYXMgJ2Jsb2InKVxyXG4gICAgICAgIGlmIChkaWRJdFJlc2l6ZSkge1xyXG4gICAgICAgICAgcmVhZGVyLnJlYWRBc0RhdGFVUkwoYmxvYik7XHJcblxyXG4gICAgICAgICAgcmVhZGVyLm9ubG9hZCA9IGZ1bmN0aW9uKHRoZUltYWdlKSB7XHJcbiAgICAgICAgICAgIHJlc29sdmUodGhlSW1hZ2UudGFyZ2V0LnJlc3VsdCk7XHJcbiAgICAgICAgfTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBsb2cud2FybignW0ZpbGVIeXBlcnR5UmVzb3VyY2UuX2dldEltYWdlUHJldmlld10gdW5hYmxlIHRvIGNyZWF0ZSBpbWFnZSBwcmV2aWV3IGZyb20gb3JpZ2luYWwgaW1hZ2UgJyk7XHJcbiAgICAgICAgcmVzb2x2ZSh1bmRlZmluZWQpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9KTtcclxuIH1cclxuXHJcblxyXG5cclxuICBnZXQgbmFtZSgpIHtcclxuICAgIGxldCBfdGhpcyA9IHRoaXM7XHJcbiAgICByZXR1cm4gX3RoaXMuX21ldGFkYXRhLm5hbWU7XHJcbiAgfVxyXG5cclxuICBnZXQgcHJldmlldygpIHtcclxuICAgIGxldCBfdGhpcyA9IHRoaXM7XHJcbiAgICByZXR1cm4gX3RoaXMuX21ldGFkYXRhLnByZXZpZXc7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAqIFNoYXJlIGZpbGUgYXMgYSBkYXRhIG9iamVjdCBjaGlsZCBvZiBhIGRhdGEgb2JqZWN0IHBhcmVudFxyXG4gICpcclxuICAqIEBwYXJhbSAge3N0cmluZ30gY2hpbGRyZW4gRGF0YSBPYmplY3QgUGFyZW50IGNoaWxkcmVuIG5hbWUgd2hlcmUgdGhlIGZpbGUgaXMgc2hhcmVkXHJcbiAgKi9cclxuXHJcbi8qICBzaGFyZShjaGlsZHJlbikge1xyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuXHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgIC8vdG8gYmUgaW1wcm92ZWQgYW5kIGFkYXB0ZWRcclxuXHJcbiAgICAgIGlmICghX3RoaXMuX2lzU2VuZGVyKSByZXR1cm4gcmVqZWN0KCdbRmlsZUh5cGVydHlSZXNvdXJjZS5zaGFyZV0gT2JzZXJ2ZXJzIGNhbiBub3Qgc2hhcmUgZmlsZXMnKTtcclxuXHJcbiAgICAgIGxldCBmaWxlMnNoYXJlID0gX3RoaXMuX21ldGFkYXRhO1xyXG4gICAgICBmaWxlMnNoYXJlLnR5cGUgPSBfdGhpcy5fdHlwZTtcclxuXHJcbiAgICAgIF90aGlzLl9wYXJlbnQuYWRkQ2hpbGQoY2hpbGRyZW4sIGZpbGUyc2hhcmUpLnRoZW4oZnVuY3Rpb24oZGF0YU9iamVjdENoaWxkKSB7XHJcbiAgICAgICAgbG9nLmxvZygnW0ZpbGVIeXBlcnR5UmVzb3VyY2Uuc2hhcmVdIG9iamVjdCBjaGlsZDogJywgZGF0YU9iamVjdENoaWxkKTtcclxuXHJcbiAgICAgICAgbGV0IHNoYXJlZEZpbGUgPSBkYXRhT2JqZWN0Q2hpbGQuZGF0YTtcclxuXHJcbiAgICAgICAgcmVzb2x2ZShzaGFyZWRGaWxlKTtcclxuXHJcbiAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uKHJlYXNvbikge1xyXG4gICAgICAgIGxvZy5lcnJvcignUmVhc29uOicsIHJlYXNvbik7XHJcbiAgICAgICAgcmVqZWN0KHJlYXNvbik7XHJcbiAgICAgIH0pO1xyXG5cclxuICAgIH0pO1xyXG5cclxuICB9Ki9cclxuXHJcbiAgLyoqXHJcbiAgKiBSZXR1cm5zIGZpbGUgY29udGVudCBvcHRpbWlzZWQgdG8gYmUgZGlzcGxheWVkIGluIGEgbWVzc2FnZSBsaW5lXHJcbiAgKlxyXG4gICogQHBhcmFtICB7c3RyaW5nfSBjaGlsZHJlbiBEYXRhIE9iamVjdCBQYXJlbnQgY2hpbGRyZW4gbmFtZSB3aGVyZSB0aGUgZmlsZSBpcyBzaGFyZWRcclxuICAqL1xyXG5cclxuICB0b01lc3NhZ2UoKSB7XHJcbiAgICAvL1RPRE86IHRvIGJlIGltcGxlbWVudGVkLiBJdCBzaG91bGQgcmV0dXJuIEhUTUwgd2l0aCBpbWcgYXR0cmlidXRlIGFzIGEgdGh1bWJuYWlsIHBsdXMgdGhlIG5hbWUuXHJcbiAgfVxyXG5cclxufVxyXG5cclxuXHJcbmV4cG9ydCBkZWZhdWx0IEZpbGVIeXBlcnR5UmVzb3VyY2U7XHJcbiIsIi8qKlxyXG4qIFRoZSBIeXBlcnR5IFJlc291cmNlIERhdGEgTW9kZWwgaXMgdXNlZCB0byBtb2RlbCByZXNvdWNlcyBoYW5kbGVkIGJ5IEh5cGVydGllcyBhbmQgRGF0YSBPYmplY3RzIGluY2x1ZGluZyBjaGF0IG1lc3NhZ2VzLCBmaWxlcywgcmVhbCB0aW1lIGh1bWFuIGF1ZGlvIGFuZCB2aWRlby4uXHJcbipcclxuKi9cclxuXHJcbmltcG9ydCBGaWxlSHlwZXJ0eVJlc291cmNlIGZyb20gJy4vRmlsZUh5cGVydHlSZXNvdXJjZSc7XHJcblxyXG5jbGFzcyBIeXBlcnR5UmVzb3VyY2VGYWN0b3J5IHtcclxuXHJcbiAgLyoqXHJcbiAgKiBIeXBlcnR5UmVzb3VyY2VGYWN0b3J5IGNvbnN0cnVjdG9yXHJcbiAgKlxyXG4gICovXHJcblxyXG4gIGNvbnN0cnVjdG9yKCkge1xyXG5cclxuICB9XHJcblxyXG4gIGNyZWF0ZUh5cGVydHlSZXNvdXJjZShpc1NlbmRlciwgdHlwZSwgbWV0YWRhdGEpIHtcclxuICAgIGxldCBuZXdIeXBlcnR5UmVzb3VyY2U7XHJcblxyXG4gICAgc3dpdGNoICh0eXBlKSB7XHJcbiAgICAgIGNhc2UgJ2ZpbGUnOlxyXG4gICAgICAgIG5ld0h5cGVydHlSZXNvdXJjZSA9IG5ldyBGaWxlSHlwZXJ0eVJlc291cmNlKGlzU2VuZGVyLCBtZXRhZGF0YSk7XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdbSHlwZXJ0eVJlc291cmNlRmFjdG9yeS5jcmVhdGVIeXBlcnR5UmVzb3VyY2VdIG5vdCBzdXBwb3J0ZWQgdHlwZTogJywgdHlwZSk7XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIHJldHVybihuZXdIeXBlcnR5UmVzb3VyY2UpO1xyXG5cclxuICB9XHJcblxyXG4gIGNyZWF0ZUh5cGVydHlSZXNvdXJjZVdpdGhDb250ZW50KGlzU2VuZGVyLCB0eXBlLCBjb250ZW50LCBtZXRhZGF0YSkge1xyXG4gICAgbGV0IG5ld0h5cGVydHlSZXNvdXJjZTtcclxuXHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHtcclxuXHJcbiAgICBzd2l0Y2ggKHR5cGUpIHtcclxuICAgICAgY2FzZSAnZmlsZSc6XHJcbiAgICAgICAgbmV3SHlwZXJ0eVJlc291cmNlID0gbmV3IEZpbGVIeXBlcnR5UmVzb3VyY2UoaXNTZW5kZXIsIG1ldGFkYXRhKTtcclxuICAgICAgICBicmVhaztcclxuICAgICAgZGVmYXVsdDpcclxuICAgICAgICByZWplY3QoKTtcclxuICAgICAgICBicmVhaztcclxuICAgICAgfVxyXG5cclxuICAgICAgbmV3SHlwZXJ0eVJlc291cmNlLmluaXQoY29udGVudCkudGhlbigoKT0+e1xyXG4gICAgICAgIHJldHVybiBuZXdIeXBlcnR5UmVzb3VyY2Uuc2F2ZSgpOy8vIHNraXAgc2F2ZT9cclxuICAgICAgfSkudGhlbigoKT0+e1xyXG4gICAgICAgIHJlc29sdmUobmV3SHlwZXJ0eVJlc291cmNlKTtcclxuICAgICAgfSk7XHJcblxyXG4gIH0pO1xyXG5cclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBkZWZhdWx0IEh5cGVydHlSZXNvdXJjZUZhY3Rvcnk7XHJcbiIsIi8qKlxyXG4qIENvcHlyaWdodCAyMDE2IFBUIElub3Zhw6fDo28gZSBTaXN0ZW1hcyBTQVxyXG4qIENvcHlyaWdodCAyMDE2IElORVNDLUlEXHJcbiogQ29weXJpZ2h0IDIwMTYgUVVPQklTIE5FVFdPUktTIFNMXHJcbiogQ29weXJpZ2h0IDIwMTYgRlJBVU5IT0ZFUi1HRVNFTExTQ0hBRlQgWlVSIEZPRVJERVJVTkcgREVSIEFOR0VXQU5EVEVOIEZPUlNDSFVORyBFLlZcclxuKiBDb3B5cmlnaHQgMjAxNiBPUkFOR0UgU0FcclxuKiBDb3B5cmlnaHQgMjAxNiBEZXV0c2NoZSBUZWxla29tIEFHXHJcbiogQ29weXJpZ2h0IDIwMTYgQXBpemVlXHJcbiogQ29weXJpZ2h0IDIwMTYgVEVDSE5JU0NIRSBVTklWRVJTSVRBVCBCRVJMSU5cclxuKlxyXG4qIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4qIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4qXHJcbiogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuKlxyXG4qIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4qIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4qKi9cclxuXHJcbi8vIExvZyBTeXN0ZW1cclxuaW1wb3J0ICogYXMgbG9nZ2VyIGZyb20gJ2xvZ2xldmVsJztcclxubGV0IGxvZyA9IGxvZ2dlci5nZXRMb2dnZXIoJ0RhdGFPYmplY3QnKTtcclxuXHJcbmltcG9ydCBTeW5jT2JqZWN0LCB7IENoYW5nZVR5cGUsIE9iamVjdFR5cGUgfSBmcm9tICcuL1Byb3h5T2JqZWN0JztcclxuaW1wb3J0IERhdGFPYmplY3RDaGlsZCBmcm9tICcuL0RhdGFPYmplY3RDaGlsZCc7XHJcbi8vaW1wb3J0IEhlYXJ0QmVhdCBmcm9tICcuL0hlYXJ0QmVhdCc7XHJcbmltcG9ydCB7IGRlZXBDbG9uZSwgZGl2aWRlVVJMIH0gZnJvbSAnLi4vdXRpbHMvdXRpbHMuanMnO1xyXG5pbXBvcnQgSHlwZXJ0eVJlc291cmNlRmFjdG9yeSBmcm9tICcuLi9oeXBlcnR5LXJlc291cmNlL0h5cGVydHlSZXNvdXJjZUZhY3RvcnkuanMnO1xyXG5cclxuLyoqXHJcbiAqIE1haW4gZXh0ZW5zaW9uIGNsYXNzIGZvciBvYnNlcnZlcnMgYW5kIHJlcG9ydGVycywgd2l0aCBjb21tb24gcHJvcGVydGllcyBhbmQgbWV0aG9kcy5cclxuICogQ2hpbGRyZW4gbWFuYWdlbWVudCBpcyBjb21tb24gZm9yIG9ic2VydmVycyBhbmQgcmVwb3J0ZXJzLlxyXG4gKi9cclxuY2xhc3MgRGF0YU9iamVjdCB7XHJcbiAgLyogcHJpdmF0ZVxyXG4gIF92ZXJzaW9uOiBudW1iZXJcclxuXHJcbiAgX293bmVyOiBIeXBlcnR5VVJMXHJcbiAgX3VybDogT2JqZWN0VVJMXHJcbiAgX3NjaGVtYTogU2NoZW1hXHJcbiAgX2J1czogTWluaUJ1c1xyXG4gIF9zdGF0dXM6IG9uIHwgcGF1c2VkXHJcbiAgX3N5bmNPYmo6IFN5bmNEYXRhXHJcblxyXG4gIF9jaGlsZHJlbjogeyBpZDogRGF0YU9iamVjdENoaWxkIH1cclxuICBfY2hpbGRyZW5MaXN0ZW5lcjogW01zZ0xpc3RlbmVyXVxyXG5cclxuICAtLS0tZXZlbnQgaGFuZGxlcnMtLS0tXHJcbiAgX29uQWRkQ2hpbGRIYW5kbGVyOiAoZXZlbnQpID0+IHZvaWRcclxuICAqL1xyXG5cclxuICAvKipcclxuICAgKiBAaWdub3JlXHJcbiAgICogU2hvdWxkIG5vdCBiZSB1c2VkIGRpcmVjdGx5IGJ5IEh5cGVydGllcy4gSXQncyBjYWxsZWQgYnkgdGhlIFN5bmNoZXIgY3JlYXRlIG9yIHN1YnNjcmliZSBtZXRob2Qnc1xyXG4gICAqL1xyXG5cclxuICBjb25zdHJ1Y3RvcihpbnB1dCkge1xyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuXHJcbiAgICBmdW5jdGlvbiB0aHJvd01hbmRhdG9yeVBhcm1NaXNzaW5nRXJyb3IocGFyKSB7XHJcbiAgICAgIHRocm93ICdbRGF0YU9iamVjdF0gJyArIHBhciArICcgbWFuZGF0b3J5IHBhcmFtZXRlciBpcyBtaXNzaW5nJztcclxuICAgIH1cclxuXHJcbiAgICBpbnB1dC5zeW5jaGVyID8gX3RoaXMuX3N5bmNoZXIgPSBpbnB1dC5zeW5jaGVyIDogdGhyb3dNYW5kYXRvcnlQYXJtTWlzc2luZ0Vycm9yKCdzeW5jaGVyJyk7XHJcbiAgICBpbnB1dC51cmwgPyBfdGhpcy5fdXJsID0gaW5wdXQudXJsIDogdGhyb3dNYW5kYXRvcnlQYXJtTWlzc2luZ0Vycm9yKCd1cmwnKTtcclxuICAgIGlucHV0LmNyZWF0ZWQgPyBfdGhpcy5fY3JlYXRlZCA9IGlucHV0LmNyZWF0ZWQgOiB0aHJvd01hbmRhdG9yeVBhcm1NaXNzaW5nRXJyb3IoJ2NyZWF0ZWQnKTtcclxuICAgIGlucHV0LnJlcG9ydGVyID8gX3RoaXMuX3JlcG9ydGVyID0gaW5wdXQucmVwb3J0ZXIgOiB0aHJvd01hbmRhdG9yeVBhcm1NaXNzaW5nRXJyb3IoJ3JlcG9ydGVyJyk7XHJcbiAgICBpbnB1dC5ydW50aW1lID8gX3RoaXMuX3J1bnRpbWUgPSBpbnB1dC5ydW50aW1lIDogdGhyb3dNYW5kYXRvcnlQYXJtTWlzc2luZ0Vycm9yKCdydW50aW1lJyk7XHJcbiAgICBpbnB1dC5zY2hlbWEgPyBfdGhpcy5fc2NoZW1hID0gaW5wdXQuc2NoZW1hIDogdGhyb3dNYW5kYXRvcnlQYXJtTWlzc2luZ0Vycm9yKCdzY2hlbWEnKTtcclxuICAgIGlucHV0Lm5hbWUgPyBfdGhpcy5fbmFtZSA9IGlucHV0Lm5hbWUgOiB0aHJvd01hbmRhdG9yeVBhcm1NaXNzaW5nRXJyb3IoJ25hbWUnKTtcclxuXHJcblxyXG4gICAgX3RoaXMuX3N0YXR1cyA9IGlucHV0LnN0YXR1cztcclxuXHJcbiAgICBpZiAoaW5wdXQuZGF0YSkge1xyXG4gICAgICBfdGhpcy5fc3luY09iaiA9IG5ldyBTeW5jT2JqZWN0KGlucHV0LmRhdGEpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgX3RoaXMuX3N5bmNPYmogPSBuZXcgU3luY09iamVjdCh7fSk7XHJcbiAgICB9XHJcbiAgICBfdGhpcy5fY2hpbGRyZW5zID0gaW5wdXQuY2hpbGRyZW5zO1xyXG5cclxuICAgIC8vVE9ETzogRm9yIEZ1cnRoZXIgU3R1ZHlcclxuICAgIF90aGlzLl9tdXR1YWwgPSBpbnB1dC5tdXR1YWw7XHJcblxyXG4gICAgX3RoaXMuX3ZlcnNpb24gPSAwO1xyXG4gICAgX3RoaXMuX2NoaWxkSWQgPSAxO1xyXG4gICAgX3RoaXMuX2NoaWxkcmVuTGlzdGVuZXI7IC8vYnVzIGxpc3RlbmVyIGZvciBjaGlsZHJlblxyXG4gICAgX3RoaXMuX29uQWRkQ2hpbGRyZW5IYW5kbGVyOyAvL0h5cGVydHkgc2lkZSBoYW5kbGVycyB0byBwcm9jZXNzIGNoaWxkIG9iamVjdHMgY3JlYXRlZCBieSByZW1vdGUgSHlwZXJ0aWVzXHJcblxyXG4gICAgX3RoaXMuX3Jlc3VtZWQgPSBpbnB1dC5yZXN1bWU7XHJcblxyXG4gICAgaWYgKGlucHV0LnJlc3VtZSkgeyBfdGhpcy5fdmVyc2lvbiA9IGlucHV0LnZlcnNpb247IH1cclxuXHJcbiAgICBfdGhpcy5fb3duZXIgPSBpbnB1dC5zeW5jaGVyLl9vd25lcjtcclxuICAgIF90aGlzLl9idXMgPSBpbnB1dC5zeW5jaGVyLl9idXM7XHJcblxyXG4gICAgaWYgKGlucHV0LmRlc2NyaXB0aW9uKSBfdGhpcy5fZGVzY3JpcHRpb24gPSBpbnB1dC5kZXNjcmlwdGlvbjtcclxuICAgIGlmIChpbnB1dC50YWdzKSBfdGhpcy5fdGFncyA9IGlucHV0LnRhZ3M7XHJcbiAgICBpZiAoaW5wdXQucmVzb3VyY2VzKSBfdGhpcy5fcmVzb3VyY2VzID0gaW5wdXQucmVzb3VyY2VzO1xyXG4gICAgaWYgKGlucHV0Lm9ic2VydmVyU3RvcmFnZSkgX3RoaXMuX29ic2VydmVyU3RvcmFnZSA9IGlucHV0Lm9ic2VydmVyU3RvcmFnZTtcclxuICAgIGlmIChpbnB1dC5wdWJsaWNPYnNlcnZhdGlvbikgX3RoaXMuX3B1YmxpY09ic2VydmF0aW9uID0gaW5wdXQucHVibGljT2JzZXJ2YXRpb247XHJcblxyXG4gICAgX3RoaXMuX21ldGFkYXRhID0gT2JqZWN0LmFzc2lnbihpbnB1dCk7XHJcblxyXG4gICAgLy8gICAgY29uc29sZS5sb2coJ1tEYXRhT2JqZWN0XSBtdXR1YWwgJywgX3RoaXMuX21ldGFkYXRhLm11dHVhbCk7XHJcblxyXG4gICAgaWYgKCFpbnB1dC5oYXNPd25Qcm9wZXJ0eSgncmVzdW1lJykgfHwgKGlucHV0Lmhhc093blByb3BlcnR5KCdyZXN1bWUnKSAmJiAhaW5wdXQucmVzdW1lKSkge1xyXG4gICAgICBfdGhpcy5fbWV0YWRhdGEubGFzdE1vZGlmaWVkID0gX3RoaXMuX21ldGFkYXRhLmNyZWF0ZWQ7XHJcbiAgICB9XHJcblxyXG4gICAgZGVsZXRlIF90aGlzLl9tZXRhZGF0YS5kYXRhO1xyXG4gICAgZGVsZXRlIF90aGlzLl9tZXRhZGF0YS5zeW5jaGVyO1xyXG4gICAgZGVsZXRlIF90aGlzLl9tZXRhZGF0YS5hdXRob3Jpc2U7XHJcblxyXG4gICAgX3RoaXMuX2h5cGVydHlSZXNvdXJjZUZhY3RvcnkgPSBuZXcgSHlwZXJ0eVJlc291cmNlRmFjdG9yeSgpO1xyXG4gICAgX3RoaXMuX2NoaWxkcmVuT2JqZWN0cyA9IHt9O1xyXG4gICAgX3RoaXMuX3NoYXJlZENoaWxkcyA9IFtdOyAvL2NoaWxkT2JqZWN0cyB0aGF0IHdlcmUgbm90IHNlbnQgeWV0IHRvIFJlcG9ydGVyc1xyXG5cclxuLyogICAgaWYgKGlucHV0LmJhY2t1cCAmJiBfdGhpcy5fY2hpbGRyZW5zKSB7XHJcbiAgICAgIGxldCBsYXN0SGVhcnRiZWF0ID0gKGlucHV0Lmhhc093blByb3BlcnR5KCdjaGlsZHJlbk9iamVjdHMnKSAmJiBpbnB1dC5jaGlsZHJlbk9iamVjdHMuaGFzT3duUHJvcGVydHkoJ2hlYXJ0YmVhdCcpKVxyXG4gICAgICAgID8gaW5wdXQuY2hpbGRyZW5PYmplY3RzLmhlYXJ0YmVhdCA6IDA7XHJcbiAgICAgIF90aGlzLl9oZWFydEJlYXQgPSBuZXcgSGVhcnRCZWF0KF90aGlzLl9idXMsIF90aGlzLl9vd25lciwgX3RoaXMuX3N5bmNoZXIuX3J1bnRpbWVVcmwsIHRoaXMsIDE1LCBsYXN0SGVhcnRiZWF0KTtcclxuICAgICAgaWYgKF90aGlzLl9yZXN1bWVkKSBfdGhpcy5faGVhcnRCZWF0LnN0YXJ0KHRydWUsIF90aGlzLm1ldGFkYXRhLmlzUmVwb3J0ZXIpO1xyXG4gICAgICBlbHNlIF90aGlzLl9oZWFydEJlYXQuc3RhcnQoZmFsc2UsIF90aGlzLm1ldGFkYXRhLmlzUmVwb3J0ZXIpO1xyXG5cclxuICAgIH0qL1xyXG4gIH1cclxuXHJcbiAgX2dldExhc3RDaGlsZElkKCkge1xyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuXHJcbiAgICBsZXQgY2hpbGRJZEludCA9IDA7XHJcbiAgICBsZXQgY2hpbGRJZFN0cmluZyA9IF90aGlzLl9vd25lciArICcjJyArIGNoaWxkSWRJbnQ7XHJcblxyXG5cclxuICAgIE9iamVjdC5rZXlzKF90aGlzLl9jaGlsZHJlbnMpLmZpbHRlcigoa2V5KSA9PiB7XHJcbiAgICAgIGlmIChfdGhpcy5fY2hpbGRyZW5zW2tleV0uY2hpbGRJZCA+IGNoaWxkSWRTdHJpbmcpIHtcclxuICAgICAgICBjaGlsZElkU3RyaW5nID0gX3RoaXMuX2NoaWxkcmVuc1trZXldLmNoaWxkSWQ7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG5cclxuICAgIHJldHVybiBjaGlsZElkSW50ID0gTnVtYmVyKGNoaWxkSWRTdHJpbmcuc3BsaXQoJyMnKVsxXSk7XHJcbiAgfVxyXG5cclxuICBfYWxsb2NhdGVMaXN0ZW5lcnMoKSB7XHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG5cclxuICAgIGxldCBjaGlsZEJhc2VVUkwgPSBfdGhpcy5fdXJsICsgJy9jaGlsZHJlbi8nO1xyXG4gICAgbG9nLmxvZygnW0RhdGEgT2JqZWN0IC0gQWxsb2NhdGVMaXN0ZW5lcnNdIC0gJywgX3RoaXMuX2NoaWxkcmVucyk7XHJcbiAgICBpZiAoX3RoaXMuX2NoaWxkcmVucykge1xyXG4gICAgICAvLyAgICAgIF90aGlzLl9jaGlsZHJlbnMuZm9yRWFjaCgoY2hpbGQpID0+IHtcclxuICAgICAgbGV0IGNoaWxkVVJMID0gY2hpbGRCYXNlVVJMO1xyXG4gICAgICBsZXQgbGlzdGVuZXIgPSBfdGhpcy5fYnVzLmFkZExpc3RlbmVyKGNoaWxkVVJMLCAobXNnKSA9PiB7XHJcbiAgICAgICAgLy9pZ25vcmUgbXNnIHNlbnQgYnkgaGltc2VsZlxyXG4gICAgICAgIGlmIChtc2cuZnJvbSAhPT0gdGhpcy5fb3duZXIpIHtcclxuICAgICAgICAgIGNvbnNvbGUubG9nKCdEYXRhT2JqZWN0LUNoaWxkcmVuLVJDVjogJywgbXNnKTtcclxuICAgICAgICAgIHN3aXRjaCAobXNnLnR5cGUpIHtcclxuICAgICAgICAgICAgY2FzZSAnY3JlYXRlJzogX3RoaXMuX29uQ2hpbGRDcmVhdGUobXNnKTsgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgJ2V2ZW50JzogX3RoaXMuX29uRXZlbnQobXNnKTsgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgJ2RlbGV0ZSc6IGxvZy5sb2cobXNnKTsgYnJlYWs7XHJcbiAgICAgICAgICAgIGRlZmF1bHQ6IF90aGlzLl9jaGFuZ2VDaGlsZHJlbihtc2cpOyBicmVhaztcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgLy8gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBfdGhpcy5fY2hpbGRyZW5MaXN0ZW5lciA9IGxpc3RlbmVyO1xyXG4gICAgICB9KTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIF9yZWxlYXNlTGlzdGVuZXJzKCkge1xyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuXHJcbiAgICBpZiAoX3RoaXMuX2NoaWxkcmVuTGlzdGVuZXIpIHtcclxuICAgICAgX3RoaXMuX2NoaWxkcmVuTGlzdGVuZXIucmVtb3ZlKCk7XHJcblxyXG4gICAgICBPYmplY3Qua2V5cyhfdGhpcy5fY2hpbGRyZW5PYmplY3RzKS5mb3JFYWNoKChjaGlsZCkgPT4ge1xyXG4gICAgICAgIC8qICAgICAgaWYgKGNoaWxkcmVuID09PSAncmVzb3VyY2VzJykge1xyXG4gICAgICAgICAgICAgICAgT2JqZWN0LmtleXMoX3RoaXMuX2NoaWxkcmVuT2JqZWN0c1tjaGlsZHJlbl0pLmZvckVhY2goKGNoaWxkKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgIF90aGlzLl9jaGlsZHJlbk9iamVjdHNbY2hpbGRyZW5dW2NoaWxkXS5fcmVsZWFzZUxpc3RlbmVycygpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgfSBlbHNlIHsqL1xyXG4gICAgICAgIF90aGlzLl9jaGlsZHJlbk9iamVjdHNbY2hpbGRdLl9yZWxlYXNlTGlzdGVuZXJzKCk7XHJcbiAgICAgICAgLy8gICAgICB9XHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuXHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBTeW5jIERhdGEgT2JqZWN0IE9ic2VydmVyIHdpdGggbGFzdCB2ZXJzaW9uIG9mIERhdGEgT2JqZWN0IFJlcG9ydGVyLiBVc2VmdWwgZm9yIFJlc3VtZXNcclxuICAgKiByZW1vdmUgc2luY2UgaHlwZXJ0aWVzIGNhbiBkaXJlY3RseSB1c2Ugc3luY2hlciByZWFkP1xyXG4gICAqL1xyXG4gIHN5bmMoKSB7XHJcblxyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuICAgIGxvZy5pbmZvKCdbRGF0YU9iamVjdC5zeW5jXSBzeW5jaHJvbmlzaW5nICcpO1xyXG5cclxuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XHJcblxyXG4gICAgICBsZXQgY3JpdGVyaWEgPSB7fTtcclxuXHJcbi8vICAgICAgaWYgKHRoaXMubWV0YWRhdGEuYmFja3VwUmV2aXNpb24pIGNyaXRlcmlhLmJhY2t1cFJldmlzaW9uID0gdGhpcy5tZXRhZGF0YS5iYWNrdXBSZXZpc2lvbjtcclxuXHJcbiAgICAgIF90aGlzLl9zeW5jaGVyLnJlYWQoX3RoaXMuX21ldGFkYXRhLnVybCwgY3JpdGVyaWEpLnRoZW4oKHZhbHVlKSA9PiB7XHJcbiAgICAgICAgY29uc29sZS5sb2coJ1tEYXRhT2JqZWN0LnN5bmNdIHZhbHVlIHRvIHN5bmM6ICcsIHZhbHVlKTtcclxuXHJcbiAgICAgICAgT2JqZWN0LmFzc2lnbihfdGhpcy5kYXRhLCBkZWVwQ2xvbmUodmFsdWUuZGF0YSkpO1xyXG5cclxuICAgICAgICBfdGhpcy5fdmVyc2lvbiA9IHZhbHVlLnZlcnNpb247XHJcblxyXG4gICAgICAgIF90aGlzLl9tZXRhZGF0YS5sYXN0TW9kaWZpZWQgPSB2YWx1ZS5sYXN0TW9kaWZpZWQ7XHJcblxyXG4gICAgICAgIC8vVE9ETzogY2hlY2sgZmlyc3QgaWYgdGhlcmUgYXJlIG5ldyBjaGlsZHJlbk9iamVjdHMgdG8gYXZvaWQgb3ZlcmhlYWRcclxuXHJcbiAgICAgICAgaWYgKHZhbHVlLmNoaWxkcmVuT2JqZWN0cykge1xyXG4gICAgICAgICAgX3RoaXMucmVzdW1lQ2hpbGRyZW5zKHZhbHVlLmNoaWxkcmVuT2JqZWN0cyk7XHJcbi8vICAgICAgICAgIF90aGlzLl9zdG9yZUNoaWxkcmVucygpO1xyXG4gICAgICAgICAgcmVzb2x2ZSh0cnVlKTtcclxuICAgICAgICB9IGVsc2UgcmVzb2x2ZSh0cnVlKTtcclxuXHJcblxyXG4gICAgICAgIC8qaWYgKHZhbHVlLnZlcnNpb24gIT0gX3RoaXMuX3ZlcnNpb24pIHtcclxuICAgICAgICAgIGxvZy5pbmZvKCdbRGF0YU9iamVjdC5zeW5jXSB1cGRhdGluZyBleGlzdGluZyBkYXRhOiAnLCBfdGhpcy5kYXRhKTtcclxuXHJcbiAgICAgICAgICBPYmplY3QuYXNzaWduKF90aGlzLmRhdGEgfHwge30sIGRlZXBDbG9uZSh2YWx1ZS5kYXRhKSk7XHJcblxyXG4gICAgICAgICAgX3RoaXMuX21ldGFkYXRhID0gZGVlcENsb25lKHZhbHVlKTtcclxuXHJcbiAgICAgICAgICBkZWxldGUgX3RoaXMuX21ldGFkYXRhLmRhdGE7XHJcblxyXG4gICAgICAgICAgX3RoaXMuX3ZlcnNpb24gPSB2YWx1ZS52ZXJzaW9uO1xyXG5cclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgbG9nLmluZm8oJ1tEYXRhT2JqZWN0LnN5bmNdIGV4aXN0aW5nIGRhdGEgaXMgdXBkYXRlZDogJywgdmFsdWUpO1xyXG4gICAgICAgIH0qL1xyXG5cclxuICAgICAgfSkuY2F0Y2goKHJlYXNvbikgPT4ge1xyXG4gICAgICAgIGxvZy5pbmZvKCdbRGF0YU9iamVjdC5zeW5jXSBzeW5jIGZhaWxlZDogJywgcmVhc29uKTtcclxuICAgICAgICByZXNvbHZlKGZhbHNlKTtcclxuICAgICAgfSk7XHJcblxyXG4gICAgfSk7XHJcblxyXG5cclxuICB9XHJcbiAgLyoqXHJcbiAgICpcclxuICAgKi9cclxuICByZXN1bWVDaGlsZHJlbnMoY2hpbGRyZW5zKSB7XHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG5cclxuICAgIGxldCBjaGlsZElkU3RyaW5nID0gdGhpcy5fb3duZXIuc3BsaXQoJy8nKVszXSArICcjJyArIHRoaXMuX2NoaWxkSWQ7XHJcblxyXG4gICAgLy9zZXR1cCBjaGlsZHJlbnMgZGF0YSBmcm9tIHN1YnNjcmlwdGlvblxyXG4gICAgLy8gICAgT2JqZWN0LmtleXMoY2hpbGRyZW5zKS5mb3JFYWNoKChjaGlsZHJlblJlc291cmNlKSA9PiB7XHJcbiAgICAvLyAgICAgIGxldCBjaGlsZHJlbiA9IGNoaWxkcmVuc1tjaGlsZHJlblJlc291cmNlXTtcclxuICAgIGxldCBjaGlsZHJlbiA9IGNoaWxkcmVucztcclxuXHJcbiAgICAvL190aGlzLl9jaGlsZHJlbk9iamVjdHNbY2hpbGRyZW5SZXNvdXJjZV0gPSB7fTtcclxuICAgIE9iamVjdC5rZXlzKGNoaWxkcmVuKS5mb3JFYWNoKChjaGlsZElkKSA9PiB7XHJcbiAgICAgIGxldCBuZXdDaGlsZCA9IGZhbHNlO1xyXG5cclxuLyogICAgICAgIGlmICghX3RoaXMuX2NoaWxkcmVuT2JqZWN0cy5oYXNPd25Qcm9wZXJ0eShjaGlsZHJlblJlc291cmNlKSlcclxuICAgICAgICAgIF90aGlzLl9jaGlsZHJlbk9iamVjdHNbY2hpbGRyZW5SZXNvdXJjZV0gPSB7fTsqL1xyXG5cclxuICAgICAgICAvLyBjaGVjayBpZiBpdCBpcyB0aGUgbGFzdCBoZWFydGJlYXRcclxuXHJcbiAgICAgICAgaWYgKGNoaWxkSWQgPT09ICdoZWFydGJlYXQnKSB7XHJcbi8vICAgICAgICAgIF90aGlzLl9oZWFydEJlYXQub25OZXdIZWFydGJlYXQoY2hpbGRyZW5bY2hpbGRJZF0udmFsdWUpO1xyXG4vLyAgICAgICAgICBfdGhpcy5faGVhcnRCZWF0LnN0YXJ0KHRydWUpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIGlmIChjaGlsZHJlbltjaGlsZElkXS5oYXNPd25Qcm9wZXJ0eSgndmFsdWUnKSAmJiBjaGlsZHJlbltjaGlsZElkXS52YWx1ZS5yZXNvdXJjZVR5cGUgJiYgIV90aGlzLl9jaGlsZHJlbk9iamVjdHMuaGFzT3duUHJvcGVydHkoY2hpbGRJZCkpIHtcclxuICAgICAgICBfdGhpcy5fY2hpbGRyZW5PYmplY3RzW2NoaWxkSWRdID0gX3RoaXMuX3Jlc3VtZUh5cGVydHlSZXNvdXJjZShjaGlsZHJlbltjaGlsZElkXSk7XHJcbiAgICAgICAgbmV3Q2hpbGQgPSB0cnVlO1xyXG4gICAgICB9IGVsc2UgaWYgKCFfdGhpcy5fY2hpbGRyZW5PYmplY3RzLmhhc093blByb3BlcnR5KGNoaWxkSWQpKSB7XHJcblxyXG4gICAgICAgIF90aGlzLl9jaGlsZHJlbk9iamVjdHNbY2hpbGRJZF0gPSBfdGhpcy5fcmVzdW1lQ2hpbGQoY2hpbGRyZW5bY2hpbGRJZF0pO1xyXG4gICAgICAgIGxvZy5sb2coJ1tEYXRhT2JqZWN0LnJlc3VtZUNoaWxkcmVuc10gbmV3IERhdGFPYmplY3RDaGlsZDogJywgX3RoaXMuX2NoaWxkcmVuT2JqZWN0c1tjaGlsZElkXSk7XHJcbiAgICAgICAgbmV3Q2hpbGQgPSB0cnVlO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBpZiAobmV3Q2hpbGQgJiYgY2hpbGRJZCA+IGNoaWxkSWRTdHJpbmcpIHtcclxuICAgICAgICBjaGlsZElkU3RyaW5nID0gY2hpbGRJZDtcclxuICAgICAgICBsb2cubG9nKCdbRGF0YU9iamVjdFJlcG9ydGVyLnJlc3VtZUNoaWxkcmVuc10gLSByZXN1bWluZzogJywgdGhpcy5fY2hpbGRyZW5PYmplY3RzW2NoaWxkSWRdKTtcclxuICAgICAgfVxyXG5cclxuICAgIH0pO1xyXG4gICAgLy8gICAgfSk7XHJcblxyXG4gICAgdGhpcy5fY2hpbGRJZCA9IE51bWJlcihjaGlsZElkU3RyaW5nLnNwbGl0KCcjJylbMV0pO1xyXG5cclxuICB9XHJcblxyXG4gIF9yZXN1bWVDaGlsZChpbnB1dCkge1xyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuICAgIGxldCBjaGlsZElucHV0ID0gaW5wdXQudmFsdWU7XHJcbiAgICBjaGlsZElucHV0LnBhcmVudE9iamVjdCA9IF90aGlzO1xyXG4gICAgY2hpbGRJbnB1dC5wYXJlbnQgPSBfdGhpcy5fdXJsO1xyXG5cclxuICAgIGxldCBjaGlsZCA9IG5ldyBEYXRhT2JqZWN0Q2hpbGQoY2hpbGRJbnB1dCk7XHJcblxyXG4gICAgY2hpbGQuaWRlbnRpdHkgPSBpbnB1dC5pZGVudGl0eTtcclxuXHJcbiAgICBsZXQgZXZlbnQgPSB7XHJcbiAgICAgIHR5cGU6ICdjcmVhdGUnLFxyXG4gICAgICBmcm9tOiBjaGlsZC5yZXBvcnRlcixcclxuICAgICAgdXJsOiBjaGlsZC5wYXJlbnQsXHJcbiAgICAgIHZhbHVlOiBjaGlsZC5kYXRhLFxyXG4gICAgICBjaGlsZElkOiBjaGlsZC51cmwsXHJcbiAgICAgIGlkZW50aXR5OiBjaGlsZC5pZGVudGl0eSxcclxuICAgICAgY2hpbGQ6IGNoaWxkXHJcbiAgICB9O1xyXG5cclxuICAgIGlmIChjaGlsZC5yZXNvdXJjZVR5cGUpIHtcclxuICAgICAgZXZlbnQucmVzb3VyY2UgPSBjaGlsZDtcclxuXHJcbiAgICB9XHJcblxyXG4gICAgaWYgKF90aGlzLl9vbkFkZENoaWxkcmVuSGFuZGxlcikgX3RoaXMuX29uQWRkQ2hpbGRyZW5IYW5kbGVyKGV2ZW50KTtcclxuXHJcbiAgICByZXR1cm4gY2hpbGQ7XHJcblxyXG4gIH1cclxuXHJcbiAgX3Jlc3VtZUh5cGVydHlSZXNvdXJjZShpbnB1dCkge1xyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuICAgIGxldCBjaGlsZElucHV0ID0gaW5wdXQudmFsdWU7XHJcbiAgICBjaGlsZElucHV0LnBhcmVudE9iamVjdCA9IF90aGlzO1xyXG4gICAgY2hpbGRJbnB1dC5wYXJlbnQgPSBfdGhpcy5fdXJsO1xyXG5cclxuICAgIGxldCBoeXBlcnR5UmVzb3VyY2UgPSBfdGhpcy5faHlwZXJ0eVJlc291cmNlRmFjdG9yeS5jcmVhdGVIeXBlcnR5UmVzb3VyY2UoZmFsc2UsIGNoaWxkSW5wdXQucmVzb3VyY2VUeXBlLCBjaGlsZElucHV0KVxyXG5cclxuICAgIGh5cGVydHlSZXNvdXJjZS5pZGVudGl0eSA9IGlucHV0LmlkZW50aXR5O1xyXG5cclxuICAgIGxldCBldmVudCA9IHtcclxuICAgICAgdHlwZTogJ2NyZWF0ZScsXHJcbiAgICAgIGZyb206IGh5cGVydHlSZXNvdXJjZS5yZXBvcnRlcixcclxuICAgICAgdXJsOiBoeXBlcnR5UmVzb3VyY2UucGFyZW50LFxyXG4gICAgICB2YWx1ZTogaHlwZXJ0eVJlc291cmNlLmRhdGEsXHJcbiAgICAgIGNoaWxkSWQ6IGh5cGVydHlSZXNvdXJjZS51cmwsXHJcbiAgICAgIGlkZW50aXR5OiBoeXBlcnR5UmVzb3VyY2UuaWRlbnRpdHksXHJcbiAgICAgIGNoaWxkOiBoeXBlcnR5UmVzb3VyY2VcclxuICAgIH07XHJcblxyXG4gICAgaWYgKGh5cGVydHlSZXNvdXJjZS5yZXNvdXJjZVR5cGUpIHtcclxuICAgICAgZXZlbnQucmVzb3VyY2UgPSBoeXBlcnR5UmVzb3VyY2U7XHJcblxyXG4gICAgfVxyXG5cclxuICAgIGlmIChfdGhpcy5fb25BZGRDaGlsZHJlbkhhbmRsZXIpIF90aGlzLl9vbkFkZENoaWxkcmVuSGFuZGxlcihldmVudCk7XHJcblxyXG4gICAgcmV0dXJuIGh5cGVydHlSZXNvdXJjZTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEFsbCBNZXRhZGF0YSBhYm91dCB0aGUgRGF0YSBPYmplY3RcclxuICAgKiBAdHlwZSB7T2JqZWN0fSAtXHJcbiAgICovXHJcblxyXG4gIGdldCBtZXRhZGF0YSgpIHsgcmV0dXJuIHRoaXMuX21ldGFkYXRhOyB9XHJcblxyXG4gIC8qKlxyXG4gICAqIE9iamVjdCBVUkwgb2YgcmVwb3J0ZXIgb3Igb2JzZXJ2ZXJcclxuICAgKiBAdHlwZSB7T2JqZWN0VVJMfVxyXG4gICAqL1xyXG4gIGdldCB1cmwoKSB7IHJldHVybiB0aGlzLl91cmw7IH1cclxuXHJcbiAgLyoqXHJcbiAgICogT2JqZWN0IHNjaGVtYSBVUkwgKHRoaXMgZmllbGQgaXMgbm90IHlldCBzdGFibGUsIGFuZCBpcyBzdWJzamVjdCB0byBjaGFuZ2UpXHJcbiAgICogQHR5cGUge1NjaGVtYVVSTH1cclxuICAgKi9cclxuICBnZXQgc2NoZW1hKCkgeyByZXR1cm4gdGhpcy5fc2NoZW1hOyB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFN0YXR1cyBvZiB0aGUgcmVwb3J0ZXIgb3Igb2JzZXJ2ZXIgY29ubmVjdGlvbiAodGhpcyBmaWVsZCBpcyBub3QgeWV0IHN0YWJsZSwgYW5kIGlzIHN1YnNqZWN0IHRvIGNoYW5nZSlcclxuICAgKiBAdHlwZSB7U3RhdHVzfSAtIEVudW0gb2Y6IG9uIHwgcGF1c2VkXHJcbiAgICovXHJcbiAgZ2V0IHN0YXR1cygpIHsgcmV0dXJuIHRoaXMuX3N0YXR1czsgfVxyXG5cclxuICAvKipcclxuICAgKiBEYXRhIHN0cnVjdHVyZSB0byBiZSBzeW5jaHJvbml6ZWQuXHJcbiAgICogQHR5cGUge0pTT059IC0gSlNPTiBzdHJ1Y3R1cmUgdGhhdCBzaG91bGQgZm9sbG93IHRoZSBkZWZpbmVkIHNjaGVtYSwgaWYgYW55LlxyXG4gICAqL1xyXG4gIGdldCBkYXRhKCkgeyByZXR1cm4gdGhpcy5fc3luY09iai5kYXRhOyB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEFsbCBjcmVhdGVkIGNoaWxkcmVuJ3Mgc2luY2UgdGhlIHN1YnNjcmlwdGlvbiwgZG9lc24ndCBjb250YWluIGFsbCBjaGlsZHJlbidzIHNpbmNlIHJlcG9ydGVyIGNyZWF0aW9uLlxyXG4gICAqIEB0eXBlIHtPYmplY3Q8Q2hpbGRJZCwgRGF0YU9iamVjdENoaWxkPn1cclxuICAgKi9cclxuICBnZXQgY2hpbGRyZW5zKCkgeyByZXR1cm4gdGhpcy5fY2hpbGRyZW5PYmplY3RzOyB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEBpZ25vcmVcclxuICAgKi9cclxuICBwYXVzZSgpIHtcclxuICAgIC8vVE9ETzogdGhpcyBmZWF0dXJlIG5lZWRzIG1vcmUgYW5hbGlzZVxyXG4gICAgdGhyb3cgJ05vdCBpbXBsZW1lbnRlZCc7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBAaWdub3JlXHJcbiAgICovXHJcbiAgcmVzdW1lKCkge1xyXG4gICAgLy9UT0RPOiB0aGlzIGZlYXR1cmUgbmVlZHMgbW9yZSBhbmFsaXNlXHJcbiAgICB0aHJvdyAnTm90IGltcGxlbWVudGVkJztcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEBpZ25vcmVcclxuICAgKi9cclxuICBzdG9wKCkge1xyXG4gICAgLy9UT0RPOiBzaG91bGQgcmVtb3ZlIHRoZSBzdWJzY3JpcHRpb24gYW5kIHNlbmQgbWVzc2FnZSB1bnN1YnNjcmliZT9cclxuICAgIHRocm93ICdOb3QgaW1wbGVtZW50ZWQnO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQ3JlYXRlIGFuZCBhZGQgYSBEYXRhT2JqZWN0Q2hpbGQgdG8gYSBjaGlsZHJlbiBjb2xsZWN0aW9uLlxyXG4gICAqIEBwYXJhbSB7SlNPTn0gaW5pdGlhbERhdGEgLSBJbml0aWFsIGRhdGEgb2YgdGhlIGNoaWxkXHJcbiAgICogQHBhcmFtICB7TWVzc2FnZUJvZHlJZGVudGl0eX0gaWRlbnRpdHkgLSAob3B0aW9uYWwpIGlkZW50aXR5IGRhdGEgdG8gYmUgYWRkZWQgdG8gaWRlbnRpdHkgdGhlIHVzZXIgcmVwb3J0ZXIuIFRvIGJlIHVzZWQgZm9yIGxlZ2FjeSBpZGVudGl0aWVzLlxyXG4gICAqIEBwYXJhbSAge1N5bmNDaGlsZE1ldGFkYXRhfSBpbnB1dCAtIChvcHRpb25hbCkgQWxsIGFkZGl0aW9uYWwgbWV0YWRhdGEgYWJvdXQgdGhlIERhdGFPYmplY3RDaGlsZC5cclxuICAgKiBAcmV0dXJuIHtQcm9taXNlPERhdGFPYmplY3RDaGlsZD59IC0gUmV0dXJuIFByb21pc2UgdG8gYSBuZXcgRGF0YU9iamVjdENoaWxkLlxyXG4gICAqL1xyXG5cclxuICBhZGRDaGlsZChpbml0aWFsRGF0YSwgaWRlbnRpdHksIGlucHV0KSB7XHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG4gICAgbGV0IG5ld0NoaWxkO1xyXG5cclxuICAgIC8vcmV0dXJucyBwcm9taXNlLCBpbiB0aGUgZnV0dXJlLCB0aGUgQVBJIG1heSBjaGFuZ2UgdG8gYXN5bmNocm9ub3VzIGNhbGxcclxuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4ge1xyXG5cclxuICAgICAgbGV0IG1zZ0NoaWxkUGF0aCA9IF90aGlzLl91cmwgKyAnL2NoaWxkcmVuLyc7XHJcblxyXG5cclxuICAgICAgbGV0IGNoaWxkSW5wdXQgPSBfdGhpcy5fZ2V0Q2hpbGRJbnB1dChpbnB1dCk7XHJcbiAgICAgIGNoaWxkSW5wdXQuZGF0YSA9IGluaXRpYWxEYXRhO1xyXG4gICAgICAvLyAgICAgIGNoaWxkSW5wdXQuY2hpbGRyZW4gPSBjaGlsZHJlbjtcclxuICAgICAgbmV3Q2hpbGQgPSBuZXcgRGF0YU9iamVjdENoaWxkKGNoaWxkSW5wdXQpO1xyXG5cclxuICAgICAgaWYgKGlkZW50aXR5KSBuZXdDaGlsZC5pZGVudGl0eSA9IGlkZW50aXR5O1xyXG5cclxuICAgICAgbmV3Q2hpbGQuc2hhcmUoKTtcclxuXHJcbiAgICAgIGNvbnNvbGUubG9nKCdbRGF0YU9iamVjdC5hZGRDaGlsZF0gYWRkZWQgJywgbmV3Q2hpbGQpO1xyXG5cclxuICAgICAgbmV3Q2hpbGQub25DaGFuZ2UoKGV2ZW50KSA9PiB7XHJcbiAgICAgICAgX3RoaXMuX29uQ2hhbmdlKGV2ZW50LCB7IHBhdGg6IG1zZ0NoaWxkUGF0aCwgY2hpbGRJZDogY2hpbGRJbnB1dC51cmwgfSk7XHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgLy8gICAgIGlmICghX3RoaXMuX2NoaWxkcmVuT2JqZWN0cy5oYXNPd25Qcm9wZXJ0eShjaGlsZHJlbikpIF90aGlzLl9jaGlsZHJlbk9iamVjdHNbY2hpbGRyZW5dID0ge307XHJcblxyXG4gICAgICBfdGhpcy5fY2hpbGRyZW5PYmplY3RzW2NoaWxkSW5wdXQudXJsXSA9IG5ld0NoaWxkO1xyXG5cclxuICAgICAgcmVzb2x2ZShuZXdDaGlsZCk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIF9kZWxldGVDaGlsZHJlbnMoKSB7XHJcblxyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuICAgIGxldCBkZWxldGVQcm9taXNlcyA9IFtdO1xyXG5cclxuXHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHtcclxuICAgICAgaWYgKF90aGlzLmNoaWxkcmVucykge1xyXG4gICAgICAgIGxvZy5sb2coJ1tEYXRhT2JqZWN0LmRlbGV0ZUNoaWxkcmVuc10nLCBfdGhpcy5jaGlsZHJlbnMpO1xyXG4gICAgICAgIGxldCBjaGlsZDtcclxuXHJcbiAgICAgICAgZm9yIChjaGlsZCBpbiBfdGhpcy5jaGlsZHJlbnMpIHtcclxuICAgICAgICAgIC8vICAgICAgICAgIGxldCBjaGlsZDtcclxuXHJcbiAgICAgICAgICAvKiAgICAgICAgICBpZiAoY2hpbGRyZW4gPT09ICdyZXNvdXJjZXMnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICBmb3IgKGNoaWxkIGluIF90aGlzLmNoaWxkcmVuc1tjaGlsZHJlbl0pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGNoaWxkT2JqID0gX3RoaXMuY2hpbGRyZW5zW2NoaWxkcmVuXVtjaGlsZF07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxvZy5sb2coJ1tEYXRhT2JqZWN0Ll9kZWxldGVDaGlsZHJlbnNdIGNoaWxkJyxjaGlsZE9iaik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjaGlsZE9iai5tZXRhZGF0YS5oYXNPd25Qcm9wZXJ0eSgncmVzb3VyY2VUeXBlJykpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgZGVsZXRlUHJvbWlzZXMucHVzaChfdGhpcy5jaGlsZHJlbnNbY2hpbGRyZW5dW2NoaWxkXS5kZWxldGUoKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7Ki9cclxuICAgICAgICAgIGxldCBjaGlsZE9iaiA9IF90aGlzLmNoaWxkcmVuc1tjaGlsZF07XHJcbiAgICAgICAgICBsb2cubG9nKCdbRGF0YU9iamVjdC5fZGVsZXRlQ2hpbGRyZW5zXSBjaGlsZCcsIGNoaWxkT2JqKTtcclxuICAgICAgICAgIGlmIChjaGlsZE9iai5tZXRhZGF0YS5oYXNPd25Qcm9wZXJ0eSgncmVzb3VyY2VUeXBlJykpXHJcbiAgICAgICAgICAgIGRlbGV0ZVByb21pc2VzLnB1c2goX3RoaXMuY2hpbGRyZW5zW2NoaWxkXS5kZWxldGUoKSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vICAgICAgICB9XHJcblxyXG4gICAgICAgIGxvZy5sb2coJ1tEYXRhT2JqZWN0Ll9kZWxldGVDaGlsZHJlbnNdIHByb21pc2VzICcsIGRlbGV0ZVByb21pc2VzKTtcclxuXHJcbiAgICAgICAgaWYgKGRlbGV0ZVByb21pc2VzLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgIFByb21pc2UuYWxsKGRlbGV0ZVByb21pc2VzKS50aGVuKCgpID0+IHtcclxuICAgICAgICAgICAgcmVzb2x2ZSgnW0RhdGFPYmplY3QuX2RlbGV0ZUNoaWxkcmVuc10gZG9uZScpO1xyXG4gICAgICAgICAgfSk7XHJcbiAgICAgICAgfSBlbHNlIHJlc29sdmUoJ1tEYXRhT2JqZWN0Ll9kZWxldGVDaGlsZHJlbnNdIG5vdGhpbmcgdG8gZGVsZXRlJyk7XHJcbiAgICAgIH1cclxuXHJcbiAgICB9KTtcclxuXHJcbiAgfVxyXG5cclxuICBfZ2V0Q2hpbGRJbnB1dChpbnB1dCkge1xyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuICAgIGxldCBjaGlsZElucHV0ID0gT2JqZWN0LmFzc2lnbih7fSwgaW5wdXQpO1xyXG5cclxuICAgIF90aGlzLl9jaGlsZElkKys7XHJcblxyXG4gICAgLy9yZW1vdmluZyBkb21haW4gZnJvbSBjaGlsZElkIHRvIGF2b2lkIGJhY2t1cCBpc3N1ZXMgd2l0aCAnLidcclxuXHJcbiAgICBsZXQgc3RhcnQgPSBNYXRoLmZsb29yKERhdGUubm93KCkpO1xyXG5cclxuICAgIGNvbnNvbGUubG9nKCdbRGF0YU9iamVjdC5fZ2V0Q2hpbGRJbnB1dF0gc3RhcnQgJywgc3RhcnQpO1xyXG5cclxuICAgIGNoaWxkSW5wdXQudXJsID0gc3RhcnQgKyAnLScgKyBfdGhpcy5fb3duZXIuc3BsaXQoJy8nKVszXSArICcjJyArIF90aGlzLl9jaGlsZElkO1xyXG5cclxuICAgIGNoaWxkSW5wdXQucGFyZW50T2JqZWN0ID0gX3RoaXM7XHJcbiAgICBjaGlsZElucHV0LnJlcG9ydGVyID0gX3RoaXMuX293bmVyO1xyXG4gICAgY2hpbGRJbnB1dC5jcmVhdGVkID0gKG5ldyBEYXRlKS50b0lTT1N0cmluZygpO1xyXG4gICAgY2hpbGRJbnB1dC5ydW50aW1lID0gX3RoaXMuX3N5bmNoZXIuX3J1bnRpbWVVcmw7XHJcbiAgICBjaGlsZElucHV0LnAycEhhbmRsZXIgPSBfdGhpcy5fc3luY2hlci5fcDJwSGFuZGxlcjtcclxuICAgIGNoaWxkSW5wdXQucDJwUmVxdWVzdGVyID0gX3RoaXMuX3N5bmNoZXIuX3AycFJlcXVlc3RlcjtcclxuICAgIGNoaWxkSW5wdXQuc2NoZW1hID0gX3RoaXMuX3NjaGVtYTtcclxuICAgIGNoaWxkSW5wdXQucGFyZW50ID0gX3RoaXMudXJsO1xyXG4gICAgY2hpbGRJbnB1dC5tdXR1YWwgPSBfdGhpcy5tZXRhZGF0YS5tdXR1YWw7XHJcbiAgICAvLyAgICBjb25zb2xlLmxvZygnW0RhdGFPYmplY3QuX2dldENoaWxkSW5wdXRdIG11dHVhbCAnLCBjaGlsZElucHV0Lm11dHVhbCk7XHJcblxyXG4gICAgcmV0dXJuIGNoaWxkSW5wdXQ7XHJcbiAgfVxyXG5cclxuICBhZGRIeXBlcnR5UmVzb3VyY2UodHlwZSwgcmVzb3VyY2UsIGlkZW50aXR5LCBpbnB1dCkge1xyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuXHJcbiAgICAvL3JldHVybnMgcHJvbWlzZSwgaW4gdGhlIGZ1dHVyZSwgdGhlIEFQSSBtYXkgY2hhbmdlIHRvIGFzeW5jaHJvbm91cyBjYWxsXHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHtcclxuXHJcbiAgICAgIGxldCBoeXBlcnR5UmVzb3VyY2U7XHJcbiAgICAgIGxldCBtc2dDaGlsZFBhdGggPSBfdGhpcy5fdXJsICsgJy9jaGlsZHJlbi8nO1xyXG5cclxuICAgICAgbGV0IGNoaWxkSW5wdXQgPSBfdGhpcy5fZ2V0Q2hpbGRJbnB1dChpbnB1dCk7XHJcbiAgICAgIC8vICAgICAgY2hpbGRJbnB1dC5jaGlsZHJlbiA9IGNoaWxkcmVuO1xyXG5cclxuICAgICAgX3RoaXMuX2h5cGVydHlSZXNvdXJjZUZhY3RvcnkuY3JlYXRlSHlwZXJ0eVJlc291cmNlV2l0aENvbnRlbnQodHJ1ZSwgdHlwZSwgcmVzb3VyY2UsIGNoaWxkSW5wdXQpLnRoZW4oKHJlc291cmNlKSA9PiB7XHJcbiAgICAgICAgaHlwZXJ0eVJlc291cmNlID0gcmVzb3VyY2U7XHJcblxyXG4gICAgICAgIGlmIChpZGVudGl0eSkgaHlwZXJ0eVJlc291cmNlLmlkZW50aXR5ID0gaWRlbnRpdHk7XHJcblxyXG4gICAgICAgIGh5cGVydHlSZXNvdXJjZS5zaGFyZSgpO1xyXG5cclxuICAgICAgICBsb2cubG9nKCdbRGF0YU9iamVjdC5hZGRIeXBlcnR5UmVzb3VyY2VdIGFkZGVkICcsIGh5cGVydHlSZXNvdXJjZSk7XHJcblxyXG4gICAgICAgIGh5cGVydHlSZXNvdXJjZS5vbkNoYW5nZSgoZXZlbnQpID0+IHtcclxuICAgICAgICAgIF90aGlzLl9vbkNoYW5nZShldmVudCwgeyBwYXRoOiBtc2dDaGlsZFBhdGgsIGNoaWxkSWQ6IGh5cGVydHlSZXNvdXJjZS5jaGlsZElkIH0pO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICAvLyAgICAgICAgaWYgKCFfdGhpcy5fY2hpbGRyZW5PYmplY3RzLmhhc093blByb3BlcnR5KGNoaWxkcmVuKSkgX3RoaXMuX2NoaWxkcmVuT2JqZWN0c1tjaGlsZHJlbl0gPSB7fTtcclxuXHJcbiAgICAgICAgX3RoaXMuX2NoaWxkcmVuT2JqZWN0c1toeXBlcnR5UmVzb3VyY2UuY2hpbGRJZF0gPSBoeXBlcnR5UmVzb3VyY2U7XHJcblxyXG4gICAgICAgIHJlc29sdmUoaHlwZXJ0eVJlc291cmNlKTtcclxuICAgICAgfSk7XHJcblxyXG5cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogU2V0dXAgdGhlIGNhbGxiYWNrIHRvIHByb2Nlc3MgY3JlYXRlIGFuZCBkZWxldGUgb2YgY2hpbGRyZW5zLlxyXG4gICAqIEBwYXJhbSB7ZnVuY3Rpb24oZXZlbnQ6IE1zZ0V2ZW50KX0gY2FsbGJhY2tcclxuICAgKiBUT0RPOiBhZGQgY2hpbGRyZW5JZCB0byBzdXBwb3J0IGRpZmZlcmVudCBoYW5kbGVycyBwZXIgY2hpbGRyZW5cclxuICAgKi9cclxuICBvbkFkZENoaWxkKGNhbGxiYWNrKSB7XHJcblxyXG4gICAgdGhpcy5fb25BZGRDaGlsZHJlbkhhbmRsZXIgPSBjYWxsYmFjaztcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFNldHVwIHRoZSBjYWxsYmFjayB0byBwcm9jZXNzIGV2ZW50cyBmcm9tIERhdGEgT2JqZWN0cy5cclxuICAgKiBAcGFyYW0ge2Z1bmN0aW9uKGV2ZW50OiBEYXRhT2JqZWN0RXZlbnQpfSBjYWxsYmFja1xyXG4gICAqL1xyXG4gIG9uRXZlbnQoY2FsbGJhY2spIHtcclxuXHJcbiAgICB0aGlzLl9vbkV2ZW50SGFuZGxlciA9IGNhbGxiYWNrO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogU2VuZCBEYXRhIE9iamVjdCBFdmVudHMuXHJcbiAgICogQHBhcmFtIHtmdW5jdGlvbihldmVudDogRGF0YU9iamVjdEV2ZW50KX0gY2FsbGJhY2tcclxuICAgKi9cclxuICBzZW5kRXZlbnQoZXZlbnQpIHtcclxuXHJcbiAgICBsZXQgbXNnRXZlbnQgPSB7XHJcbiAgICAgIGZyb206IHRoaXMuX293bmVyLFxyXG4gICAgICB0bzogdGhpcy5fdXJsKycvY2hpbGRyZW4vJyxcclxuICAgICAgdHlwZTogJ2V2ZW50JyxcclxuICAgICAgYm9keTogeyB2YWx1ZTogZXZlbnR9XHJcbiAgICB9XHJcblxyXG4gICAgdGhpcy5fYnVzLnBvc3RNZXNzYWdlKG1zZ0V2ZW50KTtcclxuICB9XHJcblxyXG5cclxuLy9GTE9XLUlOOiBldmVudCByZWNlaXZlZCBmcm9tIGEgcmVtb3RlIERhdGFPYmplY3RcclxuX29uRXZlbnQobXNnKSB7XHJcbiAgbGV0IF90aGlzID0gdGhpcztcclxuXHJcbiAgbGV0IGV2ZW50ID0ge1xyXG4gICAgZnJvbTogbXNnLmZyb20sXHJcbiAgICB2YWx1ZTogbXNnLmJvZHkudmFsdWUsXHJcbiAgICBpZGVudGl0eTogbXNnLmJvZHkuaWRlbnRpdHksXHJcbiAgfTtcclxuXHJcbiAgaWYgKF90aGlzLl9vbkV2ZW50SGFuZGxlcikgX3RoaXMuX29uRXZlbnRIYW5kbGVyKGV2ZW50KTsgIFxyXG5cclxufVxyXG5cclxuXHJcbiAgLy9GTE9XLUlOOiBtZXNzYWdlIHJlY2VpdmVkIGZyb20gYSByZW1vdGUgRGF0YU9iamVjdCAtPiBhZGRDaGlsZFxyXG4gIF9vbkNoaWxkQ3JlYXRlKG1zZykge1xyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuXHJcbiAgICAvLyAgICBjb25zb2xlLmxvZygnW0RhdGFPYmplY3QuX29uQ2hpbGRDcmVhdGVdIHJlY2VpdmVkQnkgJyArIF90aGlzLl9vd25lciArICcgOiAnLCBtc2cpO1xyXG5cclxuICAgIC8vIGlmIHRoaXMgaXMgYW4gaGVhcnRiZWF0IG1zZyBmb3dhcmQgaXQgdG8gaGVhdGJlYXQgaGFuZGxlclxyXG5cclxuICAgIGlmIChtc2cuYm9keS5yZXNvdXJjZSA9PT0gJ2hlYXJ0YmVhdCcpIHtcclxuLy8gICAgICBjb25zb2xlLmxvZygnW0RhdGFPYmplY3QuX29uQ2hpbGRDcmVhdGVdIG5ldyBoZWFydGJlYXQgcmVjZWl2ZWQgJyArIG1zZy5ib2R5LnZhbHVlKTtcclxuLy8gICAgICB0aGlzLl9oZWFydEJlYXQub25OZXdIZWFydGJlYXQobXNnLmJvZHkudmFsdWUpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgY29uc29sZS5sb2coJ1tEYXRhT2JqZWN0Ll9vbkNoaWxkQ3JlYXRlXSBuZXcgY2hpbGQgcmVjZWl2ZWRCeSAnICsgX3RoaXMuX293bmVyICsgJyA6ICcsIG1zZyk7XHJcbiAgICAgIGxldCByZXNwb25zZSA9IHtcclxuICAgICAgICBmcm9tOiBtc2cudG8sXHJcbiAgICAgICAgdG86IG1zZy5mcm9tLFxyXG4gICAgICAgIHR5cGU6ICdyZXNwb25zZScsXHJcbiAgICAgICAgaWQ6IG1zZy5pZCxcclxuICAgICAgICBib2R5OiB7XHJcbiAgICAgICAgICBjb2RlOiAxMDBcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIF90aGlzLl9idXMucG9zdE1lc3NhZ2UocmVzcG9uc2UpO1xyXG5cclxuICAgICAgaWYgKG1zZy5ib2R5LnZhbHVlLnJlc291cmNlVHlwZSkge1xyXG4gICAgICAgIF90aGlzLl9vbkh5cGVydHlSZXNvdXJjZUFkZGVkKG1zZyk7XHJcbiAgICAgIH0gZWxzZSBfdGhpcy5fb25DaGlsZEFkZGVkKG1zZyk7XHJcblxyXG4gICAgfVxyXG5cclxuICB9XHJcblxyXG4gIF9vbkNoaWxkQWRkZWQobXNnKSB7XHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG4gICAgbGV0IGNoaWxkSW5wdXQgPSBkZWVwQ2xvbmUobXNnLmJvZHkudmFsdWUpO1xyXG4gICAgY2hpbGRJbnB1dC5wYXJlbnRPYmplY3QgPSBfdGhpcztcclxuXHJcbiAgICAvLyAgICBsZXQgY2hpbGRyZW4gPSBjaGlsZElucHV0LmNoaWxkcmVuO1xyXG5cclxuICAgIGxldCBuZXdDaGlsZCA9IG5ldyBEYXRhT2JqZWN0Q2hpbGQoY2hpbGRJbnB1dCk7XHJcbiAgICBuZXdDaGlsZC5pZGVudGl0eSA9IG1zZy5ib2R5LmlkZW50aXR5O1xyXG5cclxuXHJcbiAgICAvLyAgICBpZiAoIV90aGlzLl9jaGlsZHJlbk9iamVjdHMuaGFzT3duUHJvcGVydHkoY2hpbGRyZW4pKSBfdGhpcy5fY2hpbGRyZW5PYmplY3RzW2NoaWxkcmVuXSA9IHt9O1xyXG5cclxuICAgIF90aGlzLl9jaGlsZHJlbk9iamVjdHNbY2hpbGRJbnB1dC51cmxdID0gbmV3Q2hpbGQ7XHJcblxyXG4gICAgaWYgKG1zZy50byA9PT0gX3RoaXMubWV0YWRhdGEudXJsKSBuZXdDaGlsZC5zdG9yZSgpO1xyXG5cclxuICAgIF90aGlzLl9oeXBlcnR5RXZ0KG1zZywgbmV3Q2hpbGQpO1xyXG4gIH1cclxuXHJcbiAgX29uSHlwZXJ0eVJlc291cmNlQWRkZWQobXNnKSB7XHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG4gICAgbGV0IGlucHV0ID0gbXNnLmJvZHkudmFsdWU7XHJcbiAgICBsZXQgaHlwZXJ0eVJlc291cmNlO1xyXG5cclxuICAgIC8vICAgIGxldCBjaGlsZHJlbiA9IGlucHV0LmNoaWxkcmVuO1xyXG5cclxuICAgIGlucHV0LnBhcmVudE9iamVjdCA9IF90aGlzO1xyXG5cclxuICAgIGh5cGVydHlSZXNvdXJjZSA9IF90aGlzLl9oeXBlcnR5UmVzb3VyY2VGYWN0b3J5LmNyZWF0ZUh5cGVydHlSZXNvdXJjZShmYWxzZSwgaW5wdXQucmVzb3VyY2VUeXBlLCBpbnB1dCk7XHJcbiAgICBoeXBlcnR5UmVzb3VyY2UuaWRlbnRpdHkgPSBtc2cuYm9keS5pZGVudGl0eTtcclxuXHJcbiAgICAvLyAgICBpZiAoIV90aGlzLl9jaGlsZHJlbk9iamVjdHMuaGFzT3duUHJvcGVydHkoY2hpbGRyZW4pKSBfdGhpcy5fY2hpbGRyZW5PYmplY3RzW2NoaWxkcmVuXSA9IHt9O1xyXG5cclxuICAgIF90aGlzLl9jaGlsZHJlbk9iamVjdHNbaHlwZXJ0eVJlc291cmNlLmNoaWxkSWRdID0gaHlwZXJ0eVJlc291cmNlO1xyXG5cclxuICAgIF90aGlzLl9oeXBlcnR5RXZ0KG1zZywgaHlwZXJ0eVJlc291cmNlKTtcclxuXHJcbiAgICAvLyBsb2NhbGx5IHN0b3JlIG1lc3NhZ2VzIHRoYXQgYXJlIGRpcmVjdGx5IHNlbnQgdG8gdGhlIGh5cGVydHlcclxuICAgIC8vIGllIHRvIHN5bmMgd2l0aCBtZXNzYWdlcyBzZW50IHdoZW4gb2ZmbGluZVxyXG5cclxuICAgIGlmIChtc2cudG8gPT09IF90aGlzLm1ldGFkYXRhLnVybCkgaHlwZXJ0eVJlc291cmNlLnN0b3JlKCk7XHJcbiAgfVxyXG5cclxuICBfaHlwZXJ0eUV2dChtc2csIGNoaWxkKSB7XHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG5cclxuICAgIGxldCBldmVudCA9IHtcclxuICAgICAgdHlwZTogbXNnLnR5cGUsXHJcbiAgICAgIGZyb206IG1zZy5mcm9tLFxyXG4gICAgICB1cmw6IG1zZy50byxcclxuICAgICAgdmFsdWU6IGNoaWxkLmRhdGEsXHJcbiAgICAgIGNoaWxkSWQ6IGNoaWxkLnVybCxcclxuICAgICAgaWRlbnRpdHk6IG1zZy5ib2R5LmlkZW50aXR5LFxyXG4gICAgICBjaGlsZDogY2hpbGRcclxuICAgIH07XHJcblxyXG4gICAgaWYgKGNoaWxkLnJlc291cmNlVHlwZSkge1xyXG4gICAgICBldmVudC5yZXNvdXJjZSA9IGNoaWxkO1xyXG5cclxuICAgIH1cclxuXHJcbiAgICBpZiAoX3RoaXMuX29uQWRkQ2hpbGRyZW5IYW5kbGVyKSBfdGhpcy5fb25BZGRDaGlsZHJlbkhhbmRsZXIoZXZlbnQpO1xyXG4gIH1cclxuXHJcbiAgLy9zZW5kIGRlbHRhIG1lc3NhZ2VzIHRvIHN1YnNjcmlwdGlvbnNcclxuICBfb25DaGFuZ2UoZXZlbnQsIGNoaWxkSW5mbykge1xyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuXHJcbiAgICBfdGhpcy5fbWV0YWRhdGEubGFzdE1vZGlmaWVkID0gKG5ldyBEYXRlKS50b0lTT1N0cmluZygpO1xyXG5cclxuICAgIF90aGlzLl92ZXJzaW9uKys7XHJcblxyXG4gICAgaWYgKF90aGlzLl9zdGF0dXMgPT09ICdsaXZlJykge1xyXG4gICAgICAvL0ZMT1ctT1VUOiB0aGlzIG1lc3NhZ2Ugd2lsbCBiZSBzZW50IGRpcmVjdGx5IHRvIGEgcmVzb3VyY2UgY2hhbmdlcyBhZGRyZXNzOiBNZXNzYWdlQnVzXHJcbiAgICAgIGxldCBjaGFuZ2VNc2cgPSB7XHJcbiAgICAgICAgdHlwZTogJ3VwZGF0ZScsIGZyb206IF90aGlzLl91cmwsIHRvOiBfdGhpcy5fdXJsICsgJy9jaGFuZ2VzJyxcclxuICAgICAgICBib2R5OiB7IHZlcnNpb246IF90aGlzLl92ZXJzaW9uLCBzb3VyY2U6IF90aGlzLl9vd25lciwgYXR0cmlidXRlOiBldmVudC5maWVsZCwgbGFzdE1vZGlmaWVkOiBfdGhpcy5fbWV0YWRhdGEubGFzdE1vZGlmaWVkIH1cclxuICAgICAgfTtcclxuXHJcbiAgICAgIGxvZy5sb2coJ1tEYXRhT2JqZWN0IC0gX29uQ2hhbmdlXSAtICcsIGV2ZW50LCBjaGlsZEluZm8sIGNoYW5nZU1zZyk7XHJcblxyXG4gICAgICBpZiAoZXZlbnQub1R5cGUgPT09IE9iamVjdFR5cGUuT0JKRUNUKSB7XHJcbiAgICAgICAgaWYgKGV2ZW50LmNUeXBlICE9PSBDaGFuZ2VUeXBlLlJFTU9WRSkge1xyXG4gICAgICAgICAgY2hhbmdlTXNnLmJvZHkudmFsdWUgPSBkZWVwQ2xvbmUoZXZlbnQuZGF0YSk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGNoYW5nZU1zZy5ib2R5LmF0dHJpYnV0ZVR5cGUgPSBldmVudC5vVHlwZTtcclxuICAgICAgICBjaGFuZ2VNc2cuYm9keS52YWx1ZSA9IGV2ZW50LmRhdGE7XHJcbiAgICAgICAgaWYgKGV2ZW50LmNUeXBlICE9PSBDaGFuZ2VUeXBlLlVQREFURSkge1xyXG4gICAgICAgICAgY2hhbmdlTXNnLmJvZHkub3BlcmF0aW9uID0gZXZlbnQuY1R5cGU7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcblxyXG4gICAgICAvL2NoaWxkSW5mbyBtdXN0IGhhdmUgKHBhdGgsIGNoaWxkSWQpXHJcbiAgICAgIGlmIChjaGlsZEluZm8pIHtcclxuICAgICAgICBjaGFuZ2VNc2cudG8gPSBjaGlsZEluZm8ucGF0aDtcclxuICAgICAgICBjaGFuZ2VNc2cuYm9keS5yZXNvdXJjZSA9IGNoaWxkSW5mby5jaGlsZElkO1xyXG4gICAgICB9XHJcblxyXG4gICAgICAvL1RPRE86IEZvciBGdXJ0aGVyIFN0dWR5XHJcbiAgICAgIGlmICghX3RoaXMuZGF0YS5fbXV0dWFsKSBjaGFuZ2VNc2cuYm9keS5tdXR1YWwgPSBfdGhpcy5fbXV0dWFsO1xyXG5cclxuICAgICAgX3RoaXMuX2J1cy5wb3N0TWVzc2FnZShjaGFuZ2VNc2cpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLy9GTE9XLUlOOiBkZWx0YSBtZXNzYWdlIHJlY2VpdmVkIGZyb20gYSByZW1vdGUgRGF0YU9iamVjdFJlcG9ydGVyIG9yIERhdGFPYmplY3RDaGlsZCB3aGVuIGNoYW5naW5nIGRhdGFcclxuICBfY2hhbmdlT2JqZWN0KHN5bmNPYmosIG1zZykge1xyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuXHJcbiAgICAvL1RPRE86IHVwZGF0ZSB2ZXJzaW9uID9cclxuICAgIC8vaG93IHRvIGhhbmRsZSBhbiBpbmNvcnJlY3QgdmVyc2lvbiA/IEV4YW1wbGU6IHJlY2VpdmUgYSB2ZXJzaW9uIDMgd2hlbiB0aGUgb2JzZXJ2ZXIgaXMgaW4gdmVyc2lvbiAxLCB3aGVyZSBpcyB0aGUgdmVyc2lvbiAyID9cclxuICAgIC8vd2lsbCB3ZSBuZWVkIHRvIGNvbmZpcm0gdGhlIHJlY2VwdGlvbiA/XHJcbiAgICBpZiAoX3RoaXMuX3ZlcnNpb24gKyAxIDw9IG1zZy5ib2R5LnZlcnNpb24pIHtcclxuICAgICAgX3RoaXMuX3ZlcnNpb24gPSBtc2cuYm9keS52ZXJzaW9uO1xyXG4gICAgICBsZXQgcGF0aCA9IG1zZy5ib2R5LmF0dHJpYnV0ZTtcclxuICAgICAgbGV0IHZhbHVlO1xyXG4gICAgICBpZiAodHlwZW9mIG1zZy5ib2R5LnZhbHVlID09PSAnb2JqZWN0JykgdmFsdWUgPSBkZWVwQ2xvbmUobXNnLmJvZHkudmFsdWUpO1xyXG4gICAgICBlbHNlIHZhbHVlID0gbXNnLmJvZHkudmFsdWU7XHJcblxyXG4gICAgICBsZXQgZmluZFJlc3VsdCA9IHN5bmNPYmouZmluZEJlZm9yZShwYXRoKTtcclxuXHJcbiAgICAgIGlmIChtc2cuYm9keS5sYXN0TW9kaWZpZWQpIHtcclxuICAgICAgICBfdGhpcy5fbWV0YWRhdGEubGFzdE1vZGlmaWVkID0gbXNnLmJvZHkubGFzdE1vZGlmaWVkO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIF90aGlzLl9tZXRhZGF0YS5sYXN0TW9kaWZpZWQgPSAobmV3IERhdGUpLnRvSVNPU3RyaW5nKCk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGlmIChtc2cuYm9keS5hdHRyaWJ1dGVUeXBlID09PSBPYmplY3RUeXBlLkFSUkFZKSB7XHJcbiAgICAgICAgaWYgKG1zZy5ib2R5Lm9wZXJhdGlvbiA9PT0gQ2hhbmdlVHlwZS5BREQpIHtcclxuICAgICAgICAgIGxldCBhcnIgPSBmaW5kUmVzdWx0Lm9iajtcclxuICAgICAgICAgIGxldCBpbmRleCA9IGZpbmRSZXN1bHQubGFzdDtcclxuICAgICAgICAgIEFycmF5LnByb3RvdHlwZS5zcGxpY2UuYXBwbHkoYXJyLCBbaW5kZXgsIDBdLmNvbmNhdCh2YWx1ZSkpO1xyXG4gICAgICAgIH0gZWxzZSBpZiAobXNnLmJvZHkub3BlcmF0aW9uID09PSBDaGFuZ2VUeXBlLlJFTU9WRSkge1xyXG4gICAgICAgICAgbGV0IGFyciA9IGZpbmRSZXN1bHQub2JqO1xyXG4gICAgICAgICAgbGV0IGluZGV4ID0gZmluZFJlc3VsdC5sYXN0O1xyXG4gICAgICAgICAgYXJyLnNwbGljZShpbmRleCwgdmFsdWUpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICBmaW5kUmVzdWx0Lm9ialtmaW5kUmVzdWx0Lmxhc3RdID0gdmFsdWU7IC8vIFVQREFURVxyXG4gICAgICAgIH1cclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBpZiAobXNnLmJvZHkuaGFzT3duUHJvcGVydHkoJ3ZhbHVlJykpIHtcclxuICAgICAgICAgIGZpbmRSZXN1bHQub2JqW2ZpbmRSZXN1bHQubGFzdF0gPSB2YWx1ZTsgLy8gVVBEQVRFIG9yIEFERFxyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICBkZWxldGUgZmluZFJlc3VsdC5vYmpbZmluZFJlc3VsdC5sYXN0XTsgLy8gUkVNT1ZFXHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAvL1RPRE86IGhvdyB0byBoYW5kbGUgdW5zeW5jaHJvbml6ZWQgdmVyc2lvbnM/XHJcbiAgICAgIGxvZy5sb2coJ1VOU1lOQ0hST05JWkVEIFZFUlNJT046IChkYXRhID0+ICcgKyBfdGhpcy5fdmVyc2lvbiArICcsIG1zZyA9PiAnICsgbXNnLmJvZHkudmVyc2lvbiArICcpJyk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvL0ZMT1ctSU46IG1lc3NhZ2UgcmVjZWl2ZWQgZnJvbSBhIHJlbW90ZSBEYXRhT2JqZWN0Q2hpbGQgd2hlbiBjaGFuZ2luZyBkYXRhXHJcbiAgX2NoYW5nZUNoaWxkcmVuKG1zZykge1xyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuICAgIGNvbnN0IGRpdmlkZWRVUkwgPSBkaXZpZGVVUkwobXNnLnRvKTtcclxuICAgIGNvbnN0IGlkZW50aXR5ID0gZGl2aWRlZFVSTC5pZGVudGl0eTtcclxuICAgIC8vICAgIGNvbnN0IHJlc291cmNlID0gaWRlbnRpdHkgPyBpZGVudGl0eS5zdWJzdHJpbmcoaWRlbnRpdHkubGFzdEluZGV4T2YoJy8nKSArIDEpIDogdW5kZWZpbmVkO1xyXG5cclxuICAgIGxldCBjaGlsZElkID0gbXNnLmJvZHkucmVzb3VyY2U7XHJcbiAgICBsZXQgY2hpbGRyZW4gPSBfdGhpcy5fY2hpbGRyZW5PYmplY3RzW2NoaWxkSWRdO1xyXG5cclxuICAgIGxvZy5sb2coJ0NoYW5nZSBjaGlsZHJlbjogJywgX3RoaXMuX293bmVyLCBtc2csIHJlc291cmNlKTtcclxuXHJcbiAgICBpZiAoY2hpbGRyZW4pIHtcclxuICAgICAgX3RoaXMuX2NoYW5nZU9iamVjdChjaGlsZHJlbi5fc3luY09iaiwgbXNnKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGxvZy53YXJuKCdObyBjaGlsZHJlbiBmb3VuZCBmb3I6ICcsIGNoaWxkSWQpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbn1cclxuXHJcbmV4cG9ydCBkZWZhdWx0IERhdGFPYmplY3Q7XHJcbiIsIi8qKlxyXG4qIENvcHlyaWdodCAyMDE2IFBUIElub3Zhw6fDo28gZSBTaXN0ZW1hcyBTQVxyXG4qIENvcHlyaWdodCAyMDE2IElORVNDLUlEXHJcbiogQ29weXJpZ2h0IDIwMTYgUVVPQklTIE5FVFdPUktTIFNMXHJcbiogQ29weXJpZ2h0IDIwMTYgRlJBVU5IT0ZFUi1HRVNFTExTQ0hBRlQgWlVSIEZPRVJERVJVTkcgREVSIEFOR0VXQU5EVEVOIEZPUlNDSFVORyBFLlZcclxuKiBDb3B5cmlnaHQgMjAxNiBPUkFOR0UgU0FcclxuKiBDb3B5cmlnaHQgMjAxNiBEZXV0c2NoZSBUZWxla29tIEFHXHJcbiogQ29weXJpZ2h0IDIwMTYgQXBpemVlXHJcbiogQ29weXJpZ2h0IDIwMTYgVEVDSE5JU0NIRSBVTklWRVJTSVRBVCBCRVJMSU5cclxuKlxyXG4qIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4qIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4qXHJcbiogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuKlxyXG4qIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4qIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4qKi9cclxuXHJcbi8vIExvZyBTeXN0ZW1cclxuaW1wb3J0ICogYXMgbG9nZ2VyIGZyb20gJ2xvZ2xldmVsJztcclxubGV0IGxvZyA9IGxvZ2dlci5nZXRMb2dnZXIoJ0RhdGFPYmplY3RSZXBvcnRlcicpO1xyXG5cclxuaW1wb3J0IERhdGFPYmplY3QgZnJvbSAnLi9EYXRhT2JqZWN0JztcclxuXHJcbmltcG9ydCB7IGRlZXBDbG9uZSwgZGl2aWRlVVJMIH0gZnJvbSAnLi4vdXRpbHMvdXRpbHMuanMnO1xyXG5cclxuLyoqXHJcbiAqIFRoZSBjbGFzcyByZXR1cm5lZCBmcm9tIHRoZSBTeW5jaGVyIGNyZWF0ZSBjYWxsLlxyXG4gKiBUbyBiZSB1c2VkIGFzIGEgcmVwb3J0ZXIgcG9pbnQsIGNoYW5nZXMgd2lsbCBiZSBzdWJtaXRlZCB0byBEYXRhT2JqZWN0T2JzZXJ2ZXIgaW5zdGFuY2VzLlxyXG4gKi9cclxuY2xhc3MgRGF0YU9iamVjdFJlcG9ydGVyIGV4dGVuZHMgRGF0YU9iamVjdCAvKiBpbXBsZW1lbnRzIFN5bmNTdGF0dXMgKi8ge1xyXG4gIC8qIHByaXZhdGVcclxuICBfc3Vic2NyaXB0aW9uczogPGh5cGVydHlVcmw6IHsgc3RhdHVzOiBzdHJpbmcgfSB9PlxyXG5cclxuICAtLS0tZXZlbnQgaGFuZGxlcnMtLS0tXHJcbiAgX29uU3Vic2NyaXB0aW9uSGFuZGxlcjogKGV2ZW50KSA9PiB2b2lkXHJcbiAgX29uUmVzcG9uc2VIYW5kbGVyOiAoZXZlbnQpID0+IHZvaWRcclxuICBfb25SZWFkSGFuZGxlcjogKGV2ZW50KSA9PiB2b2lkXHJcbiAgKi9cclxuXHJcbiAgLyoqXHJcbiAgICogQGlnbm9yZVxyXG4gICAqIFNob3VsZCBub3QgYmUgdXNlZCBkaXJlY3RseSBieSBIeXBlcnRpZXMuIEl0J3MgY2FsbGVkIGJ5IHRoZSBTeW5jaGVyLmNyZWF0ZSBtZXRob2RcclxuICAgKi9cclxuXHJcbiAgLy9jb25zdHJ1Y3RvcihzeW5jaGVyLCB1cmwsIGNyZWF0ZWQsIHJlcG9ydGVyLCBydW50aW1lLCBzY2hlbWEsIG5hbWUsIGluaXRpYWxTdGF0dXMsIGluaXRpYWxEYXRhLCBjaGlsZHJlbnMsIG11dHVhbCA9IHRydWUsIHJlc3VtZWQgPSBmYWxzZSwgZGVzY3JpcHRpb24sIHRhZ3MsIHJlc291cmNlcywgb2JzZXJ2ZXJTdG9yYWdlLCBwdWJsaWNPYnNlcnZhdGlvbikge1xyXG4gIGNvbnN0cnVjdG9yKGlucHV0KSB7XHJcblxyXG4gICAgc3VwZXIoaW5wdXQpO1xyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuXHJcbiAgICBfdGhpcy5fc3Vic2NyaXB0aW9ucyA9IHt9O1xyXG5cclxuICAgIF90aGlzLl9zeW5jT2JqLm9ic2VydmUoKGV2ZW50KSA9PiB7XHJcbiAgICAgIGxvZy5sb2coJ1tTeW5jaGVyLkRhdGFPYmplY3RSZXBvcnRlcl0gJyArIF90aGlzLnVybCArICcgcHVibGlzaCBjaGFuZ2U6ICcsIGV2ZW50KTtcclxuICAgICAgX3RoaXMuX29uQ2hhbmdlKGV2ZW50KTtcclxuICAgIH0pO1xyXG5cclxuICAgIF90aGlzLl9hbGxvY2F0ZUxpc3RlbmVycygpO1xyXG5cclxuICAgIF90aGlzLmludml0YXRpb25zID0gW107IC8vIGFycmF5IG9mIHByb21pc2VzIHdpdGggcGVuZGluZyBpbnZpdGF0aW9uc1xyXG4gICAgX3RoaXMuX2NoaWxkcmVuU2l6ZVRocmVzaG9sZCA9IDUwMDAwOy8vIHRvIGJlIHVzZWQgd2hlbiByZXBseWluZyB0byBzeW5jIHJlcXVlc3RzIHRvIGVuc3VyZSBlYWNoIHJlc3BvbnNlIG1zZyBpcyBub3QgdG9vIGxhcmdlXHJcblxyXG4gIH1cclxuXHJcbiAgX2FsbG9jYXRlTGlzdGVuZXJzKCkge1xyXG4gICAgc3VwZXIuX2FsbG9jYXRlTGlzdGVuZXJzKCk7XHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG5cclxuICAgIF90aGlzLl9vYmplY3RMaXN0ZW5lciA9IF90aGlzLl9idXMuYWRkTGlzdGVuZXIoX3RoaXMuX3VybCwgKG1zZykgPT4ge1xyXG4gICAgICBsb2cubG9nKCdbU3luY2hlci5EYXRhT2JqZWN0UmVwb3J0ZXJdIGxpc3RlbmVyICcgKyBfdGhpcy5fdXJsICsgJyBSZWNlaXZlZDogJywgbXNnKTtcclxuICAgICAgc3dpdGNoIChtc2cudHlwZSkge1xyXG4gICAgICAgIGNhc2UgJ3Jlc3BvbnNlJzogX3RoaXMuX29uUmVzcG9uc2UobXNnKTsgYnJlYWs7XHJcbiAgICAgICAgY2FzZSAncmVhZCc6IF90aGlzLl9vblJlYWQobXNnKTsgYnJlYWs7XHJcbiAgICAgICAgY2FzZSAnZXhlY3V0ZSc6IF90aGlzLl9vbkV4ZWN1dGUobXNnKTsgYnJlYWs7XHJcbiAgICAgICAgY2FzZSAnY3JlYXRlJzogX3RoaXMuX29uQ2hpbGRDcmVhdGUobXNnKTsgYnJlYWs7Ly8gdG8gY3JlYXRlIGNoaWxkIG9iamVjdHMgdGhhdCB3ZXJlIHNlbnQgd2hlbm4gb2ZmbGluZVxyXG4gICAgICB9XHJcbiAgICB9KTtcclxuXHJcbiAgICBfdGhpcy5fcnVudGltZVN0YXR1c0xpc3RlbmVyID0gX3RoaXMuX2J1cy5hZGRMaXN0ZW5lcihfdGhpcy5fc3luY2hlci5fcnVudGltZVVybCsnL3N0YXR1cycgLCAoZXZ0KSA9PiB7XHJcbiAgICAgIGNvbnNvbGUubG9nKCdbU3luY2hlci5EYXRhT2JqZWN0UmVwb3J0ZXJdIHJ1bnRpbWUgc3RhdHVzIGV2ZW50IHJlY2VpdmVkICcgKyBldnQpO1xyXG5cclxuLyogICAgICBpZiAoZXZ0LmJvZHkgJiYgZXZ0LmJvZHkucmVzb3VyY2UgJiYgZXZ0LmJvZHkucmVzb3VyY2UgPT09IF90aGlzLl91cmwgJiYgXHJcbiAgICAgICAgZXZ0LmJvZHkudmFsdWUgJiYgZXZ0LmJvZHkudmFsdWUuYmFja3VwUmV2aXNpb24gKSB7XHJcbiAgICAgICAgICAvLyBicm9hZGNhc3QgYmFja3VwUmV2aXNpb24gdXBkYXRlXHJcblxyXG4gICAgICAgICAgX3RoaXMuZGF0YS5iYWNrdXBSZXZpc2lvbiA9IGV2dC5ib2R5LnZhbHVlLmJhY2t1cFJldmlzaW9uO1xyXG4gICAgICAgICAgY29uc29sZS5sb2coJ1tTeW5jaGVyLkRhdGFPYmplY3RSZXBvcnRlcl0gRE8gdXBkYXRlZCB3aXRoIGJhY2t1cCByZXZpc2lvbiAnICsgX3RoaXMuZGF0YS5iYWNrdXBSZXZpc2lvbik7XHJcbiAgICAgICAgfSovXHJcbiAgICB9KTtcclxuXHJcbiAgfVxyXG5cclxuICBfcmVsZWFzZUxpc3RlbmVycygpIHtcclxuICAgIHN1cGVyLl9yZWxlYXNlTGlzdGVuZXJzKCk7XHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG5cclxuICAgIF90aGlzLl9vYmplY3RMaXN0ZW5lci5yZW1vdmUoKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFNlbmQgaW52aXRhdGlvbnMgKGNyZWF0ZSBtZXNzYWdlcykgdG8gaHlwZXJ0aWVzLCBvYnNlcnZlcnMgbGlzdC5cclxuICAgKiBAcGFyYW0gIHtIeXBlcnR5VVJMW119IG9ic2VydmVycyBMaXN0IG9mIEh5cGVydHkgVVJMJ3NcclxuICAgKi9cclxuICBpbnZpdGVPYnNlcnZlcnMob2JzZXJ2ZXJzLCBwMnApIHtcclxuICAgIGxldCBfdGhpcyA9IHRoaXM7XHJcblxyXG5cclxuICAgIC8vRkxPVy1PVVQ6IHRoaXMgbWVzc2FnZSB3aWxsIGJlIHNlbnQgdG8gdGhlIHJ1bnRpbWUgaW5zdGFuY2Ugb2YgU3luY2hlck1hbmFnZXIgLT4gX29uQ3JlYXRlXHJcbiAgICAvLyBUT0RPOiByZW1vdmUgdmFsdWUgYW5kIGFkZCByZXNvdXJjZXM/IHNob3VsZCBzaW1pbGFyIHRvIDFzdCBjcmVhdGVcclxuXHJcbiAgICBsZXQgdG9JbnZpdGUgPSBvYnNlcnZlcnM7XHJcblxyXG4gICAgLy8gbGV0IGludml0ZVByb21pc2VzID0gW107XHJcblxyXG4gICAgLyogIG9ic2VydmVycy5mb3JFYWNoKChvYnNlcnZlcik9PiB7XHJcbiAgICAgIGlmICghX3RoaXMuaW52aXRhdGlvbnNbb2JzZXJ2ZXJdKSB7XHJcbiAgICAgICAgdG9JbnZpdGUucHVzaChvYnNlcnZlcik7XHJcbiAgICAgICAgX3RoaXMuaW52aXRhdGlvbnNbb2JzZXJ2ZXJdID0gb2JzZXJ2ZXI7XHJcbiAgICAgIH1cclxuICAgIH0pOyovXHJcblxyXG5cclxuICAgIGlmICh0b0ludml0ZS5sZW5ndGggPiAwKSB7XHJcbiAgICAgIGxvZy5sb2coJ1tTeW5jaGVyLkRhdGFPYmplY3RSZXBvcnRlcl0gSW52aXRlT2JzZXJ2ZXJzICcsIHRvSW52aXRlLCBfdGhpcy5fbWV0YWRhdGEpO1xyXG5cclxuICAgICAgdG9JbnZpdGUuZm9yRWFjaCgob2JzZXJ2ZXIpPT57XHJcblxyXG4gICAgICAgIGxldCBpbnZpdGF0aW9uID0gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xyXG5cclxuICAgICAgICAgIGxldCBpbnZpdGVNc2cgPSB7XHJcbiAgICAgICAgICAgIHR5cGU6ICdjcmVhdGUnLCBmcm9tOiBfdGhpcy5fc3luY2hlci5fb3duZXIsIHRvOiBfdGhpcy5fc3luY2hlci5fc3ViVVJMLFxyXG4gICAgICAgICAgICBib2R5OiB7IHJlc3VtZTogZmFsc2UsIHJlc291cmNlOiBfdGhpcy5fdXJsLCBzY2hlbWE6IF90aGlzLl9zY2hlbWEsIHZhbHVlOiBfdGhpcy5fbWV0YWRhdGEsIGF1dGhvcmlzZTogW29ic2VydmVyXSB9XHJcbiAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgIGlmIChwMnApIGludml0ZU1zZy5ib2R5LnAycCA9IHAycDtcclxuXHJcbiAgICAgICAgICBpZiAoIV90aGlzLmRhdGEubXV0dWFsKSBpbnZpdGVNc2cuYm9keS5tdXR1YWwgPSBfdGhpcy5kYXRhLm11dHVhbDtcclxuXHJcbiAgICAgICAgICBfdGhpcy5fYnVzLnBvc3RNZXNzYWdlKGludml0ZU1zZywgKHJlcGx5KT0+e1xyXG4gICAgICAgICAgICBsb2cubG9nKCdbU3luY2hlci5EYXRhT2JqZWN0UmVwb3J0ZXJdIEludml0YXRpb24gcmVwbHkgJywgcmVwbHkpO1xyXG5cclxuICAgICAgICAgICAgbGV0IHJlc3VsdCA9IHtcclxuICAgICAgICAgICAgICBpbnZpdGVkOiBvYnNlcnZlcixcclxuICAgICAgICAgICAgICBjb2RlOiByZXBseS5ib2R5ICYmIHJlcGx5LmJvZHkuY29kZSA/IHJlcGx5LmJvZHkuY29kZSA6IDUwMCxcclxuICAgICAgICAgICAgICBkZXNjOiByZXBseS5ib2R5ICYmIHJlcGx5LmJvZHkuZGVzYyA/IHJlcGx5LmJvZHkuZGVzYyA6ICdVbmtub3duJ1xyXG4gICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgaWYgKHJlc3VsdC5jb2RlIDwgMzAwKSByZXNvbHZlKHJlc3VsdCk7XHJcbi8qICAgICAgICAgICAgZWxzZSBpZiAocmVzdWx0LmNvZGUgPj0gMzAwKSB7XHJcbiAgICAgICAgICAgICAgaWYgKF90aGlzLm1ldGFkYXRhLm9mZmxpbmUpIHtcclxuICAgICAgICAgICAgICAgIHJlc29sdmUoX3RoaXMuX3Byb2Nlc3NPZmZsaW5lSW52aXRhdGlvbihpbnZpdGVNc2cpKTtcclxuICAgICAgICAgICAgICB9Ki8gZWxzZSByZWplY3QocmVzdWx0KTtcclxuLy8gICAgICAgICAgICB9IFxyXG4gICAgICAgICAgfSk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIF90aGlzLmludml0YXRpb25zLnB1c2goaW52aXRhdGlvbik7XHJcblxyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIC8vICAgICAgcmV0dXJuKGludml0ZVByb21pc2VzKTtcclxuXHJcbiAgICB9XHJcbiAgfVxyXG5cclxuXHJcbiAgLyoqXHJcbiAgICogUmVsZWFzZSBhbmQgZGVsZXRlIG9iamVjdCBkYXRhXHJcbiAgICovXHJcbiAgZGVsZXRlKCkge1xyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuXHJcbiAgIGlmKF90aGlzLl9oZWFydEJlYXQpIF90aGlzLl9oZWFydEJlYXQuc3RvcCgpO1xyXG5cclxuICAgIF90aGlzLl9kZWxldGVDaGlsZHJlbnMoKS50aGVuKChyZXN1bHQpPT57XHJcbiAgICAgIGxvZy5sb2cocmVzdWx0KTtcclxuICAgICAgLy9GTE9XLU9VVDogdGhpcyBtZXNzYWdlIHdpbGwgYmUgc2VudCB0byB0aGUgcnVudGltZSBpbnN0YW5jZSBvZiBTeW5jaGVyTWFuYWdlciAtPiBfb25EZWxldGVcclxuICAgICAgbGV0IGRlbGV0ZU1zZyA9IHtcclxuICAgICAgICB0eXBlOiAnZGVsZXRlJywgZnJvbTogX3RoaXMuX293bmVyLCB0bzogX3RoaXMuX3N5bmNoZXIuX3N1YlVSTCxcclxuICAgICAgICBib2R5OiB7IHJlc291cmNlOiBfdGhpcy5fdXJsIH1cclxuICAgICAgfTtcclxuXHJcbiAgICAgIF90aGlzLl9idXMucG9zdE1lc3NhZ2UoZGVsZXRlTXNnLCAocmVwbHkpID0+IHtcclxuICAgICAgICBsb2cubG9nKCdEYXRhT2JqZWN0UmVwb3J0ZXItREVMRVRFOiAnLCByZXBseSk7XHJcbiAgICAgICAgaWYgKHJlcGx5LmJvZHkuY29kZSA9PT0gMjAwKSB7XHJcbiAgICAgICAgICBfdGhpcy5fcmVsZWFzZUxpc3RlbmVycygpO1xyXG4gICAgICAgICAgZGVsZXRlIF90aGlzLl9zeW5jaGVyLl9yZXBvcnRlcnNbX3RoaXMuX3VybF07XHJcblxyXG4gICAgICAgICAgLy9fdGhpcy5fc3luY09iai51bm9ic2VydmUoKTtcclxuICAgICAgICAgIF90aGlzLl9zeW5jT2JqID0ge307XHJcbiAgICAgICAgfVxyXG4gICAgICB9KTtcclxuICAgIH0pO1xyXG5cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFN1YnNjcmlwdGlvbnMgcmVxdWVzdGVkIGFuZCBhY2NlcHRlZCB0byB0aGlzIHJlcG9ydGVyXHJcbiAgICogQHR5cGUge09iamVjdDxIeXBlcnR5VVJMLCBTeW5jU3Vic2NyaXB0aW9uPn1cclxuICAgKi9cclxuICBnZXQgc3Vic2NyaXB0aW9ucygpIHsgcmV0dXJuIHRoaXMuX3N1YnNjcmlwdGlvbnM7IH1cclxuXHJcbiAgLyoqXHJcbiAgICogU2V0dXAgdGhlIGNhbGxiYWNrIHRvIHByb2Nlc3Mgc3Vic2NyaWJlIGFuZCB1bnN1YnNjcmliZSBub3RpZmljYXRpb25zXHJcbiAgICogQHBhcmFtIHtmdW5jdGlvbihldmVudDogTXNnRXZlbnQpfSBjYWxsYmFjayBmdW5jdGlvbiB0byByZWNlaXZlIGV2ZW50c1xyXG4gICAqL1xyXG4gIG9uU3Vic2NyaXB0aW9uKGNhbGxiYWNrKSB7XHJcbiAgICB0aGlzLl9vblN1YnNjcmlwdGlvbkhhbmRsZXIgPSBjYWxsYmFjaztcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFNldHVwIHRoZSBjYWxsYmFjayB0byBwcm9jZXNzIHJlc3BvbnNlIG5vdGlmaWNhdGlvbnMgb2YgdGhlIGNyZWF0ZSdzXHJcbiAgICogQHBhcmFtIHtmdW5jdGlvbihldmVudDogTXNnRXZlbnQpfSBjYWxsYmFjayBmdW5jdGlvbiB0byByZWNlaXZlIGV2ZW50c1xyXG4gICAqL1xyXG4gIG9uUmVzcG9uc2UoY2FsbGJhY2spIHtcclxuICAgIHRoaXMuX29uUmVzcG9uc2VIYW5kbGVyID0gY2FsbGJhY2s7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBTZXR1cCB0aGUgY2FsbGJhY2sgdG8gcHJvY2VzcyByZWFkIG5vdGlmaWNhdGlvbnNcclxuICAgKiBAcGFyYW0ge2Z1bmN0aW9uKGV2ZW50OiBNc2dFdmVudCl9IGNhbGxiYWNrXHJcbiAgICovXHJcblxyXG4gIG9uUmVhZChjYWxsYmFjaykge1xyXG4gICAgdGhpcy5fb25SZWFkSGFuZGxlciA9IGNhbGxiYWNrO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogU2V0dXAgdGhlIGNhbGxiYWNrIHRvIHByb2Nlc3MgZXhlY3V0ZSBub3RpZmljYXRpb25zXHJcbiAgICogQHBhcmFtIHtmdW5jdGlvbihldmVudDogTXNnRXZlbnQpfSBjYWxsYmFja1xyXG4gICAqL1xyXG5cclxuICBvbkV4ZWN1dGUoY2FsbGJhY2spIHtcclxuICAgIHRoaXMuX29uRXhlY3V0ZUhhbmRsZXIgPSBjYWxsYmFjaztcclxuICB9XHJcblxyXG4gIC8vRkxPVy1JTjogbWVzc2FnZSByZWNlaXZlZCBmcm9tIHBhcmVudCBTeW5jaGVyIC0+IF9vbkZvcndhcmRcclxuICBfb25Gb3J3YXJkKG1zZykge1xyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuXHJcbiAgICBsb2cubG9nKCdEYXRhT2JqZWN0UmVwb3J0ZXItUkNWOiAnLCBtc2cpO1xyXG4gICAgc3dpdGNoIChtc2cuYm9keS50eXBlKSB7XHJcbiAgICAgIGNhc2UgJ3N1YnNjcmliZSc6IF90aGlzLl9vblN1YnNjcmliZShtc2cpOyBicmVhaztcclxuICAgICAgY2FzZSAndW5zdWJzY3JpYmUnOiBfdGhpcy5fb25VblN1YnNjcmliZShtc2cpOyBicmVhaztcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8vRkxPVy1JTjogbWVzc2FnZSByZWNlaXZlZCBmcm9tIHRoaXMgLT4gX29uRm9yd2FyZDogZW1pdHRlZCBieSBhIHJlbW90ZSBTeW5jaGVyIC0+IHN1YnNjcmliZVxyXG4gIF9vblN1YnNjcmliZShtc2cpIHtcclxuICAgIGxldCBfdGhpcyA9IHRoaXM7XHJcbiAgICBsZXQgaHlwZXJ0eVVybCA9IG1zZy5ib2R5LmZyb207XHJcbiAgICBsZXQgZGl2aWRlZFVSTCA9IGRpdmlkZVVSTChoeXBlcnR5VXJsKTtcclxuICAgIGxldCBkb21haW4gPSBkaXZpZGVkVVJMLmRvbWFpbjtcclxuICAgIGxldCBtdXR1YWwgPSB0cnVlO1xyXG5cclxuICAgIGlmIChtc2cuYm9keS5oYXNPd25Qcm9wZXJ0eSgnbXV0dWFsJykgJiYgIW1zZy5ib2R5Lm11dHVhbCkgbXV0dWFsID0gZmFsc2U7XHJcblxyXG5cclxuICAgIGNvbnNvbGUubG9nKCdbRGF0YU9iamVjdFJlcG9ydGVyLl9vblN1YnNjcmliZV0nLCBtc2csIGRvbWFpbiwgZGl2aWRlZFVSTCk7XHJcblxyXG4gICAgbGV0IGV2ZW50ID0ge1xyXG4gICAgICB0eXBlOiBtc2cuYm9keS50eXBlLFxyXG4gICAgICB1cmw6IGh5cGVydHlVcmwsXHJcblxyXG4gICAgICBkb21haW46IGRvbWFpbixcclxuXHJcbiAgICAgIGlkZW50aXR5OiBtc2cuYm9keS5pZGVudGl0eSxcclxuXHJcbiAgICAgIG51dHVhbDogbXV0dWFsLFxyXG5cclxuICAgICAgYWNjZXB0OiAoKSA9PiB7XHJcbiAgICAgICAgLy9jcmVhdGUgbmV3IHN1YnNjcmlwdGlvblxyXG4gICAgICAgIGxldCBzdWIgPSB7IHVybDogaHlwZXJ0eVVybCwgc3RhdHVzOiAnbGl2ZScgfTtcclxuICAgICAgICBfdGhpcy5fc3Vic2NyaXB0aW9uc1toeXBlcnR5VXJsXSA9IHN1YjtcclxuICAgICAgICBpZiAoX3RoaXMubWV0YWRhdGEuc3Vic2NyaXB0aW9ucykgeyBfdGhpcy5tZXRhZGF0YS5zdWJzY3JpcHRpb25zLnB1c2goc3ViLnVybCk7IH1cclxuXHJcbiAgICAgICAgbGV0IG1zZ1ZhbHVlID0gZGVlcENsb25lKF90aGlzLl9tZXRhZGF0YSk7XHJcbiAgICAgICAgbXNnVmFsdWUuZGF0YSA9IGRlZXBDbG9uZShfdGhpcy5kYXRhKTtcclxuICAgICAgICBtc2dWYWx1ZS52ZXJzaW9uID0gX3RoaXMuX3ZlcnNpb247XHJcblxyXG4gICAgICAgIC8vcHJvY2VzcyBhbmQgc2VuZCBjaGlsZHJlbnMgZGF0YVxyXG4gICAgICAgIC8vIGxldCBjaGlsZHJlblZhbHVlcyA9IHt9O1xyXG4gICAgICAgIC8vXHJcbiAgICAgICAgLy8gaWYgKF90aGlzLl9jaGlsZHJlbk9iamVjdHMpIHtcclxuICAgICAgICAvLyAgIE9iamVjdC5rZXlzKF90aGlzLl9jaGlsZHJlbk9iamVjdHMpLmZvckVhY2goKGNoaWxkcmVuSWQpID0+IHtcclxuICAgICAgICAvLyAgICAgbGV0IGNoaWxkcmVuRGF0YSA9IF90aGlzLl9jaGlsZHJlbk9iamVjdHNbY2hpbGRyZW5JZF07XHJcbiAgICAgICAgLy8gICAgIGNoaWxkcmVuVmFsdWVzW2NoaWxkcmVuSWRdID0gZGVlcENsb25lKGNoaWxkcmVuRGF0YSk7XHJcbiAgICAgICAgLy8gICB9KTtcclxuICAgICAgICAvLyAgIG1zZ1ZhbHVlLmNoaWxkcmVuT2JqZWN0cyA9IGNoaWxkcmVuVmFsdWVzO1xyXG4gICAgICAgIC8vIH1cclxuXHJcbiAgICAgICAgbGV0IHNlbmRNc2cgPSB7XHJcbiAgICAgICAgICBpZDogbXNnLmlkLCB0eXBlOiAncmVzcG9uc2UnLCBmcm9tOiBtc2cudG8sIHRvOiBtc2cuZnJvbSxcclxuICAgICAgICAgIGJvZHk6IHsgY29kZTogMjAwLCBzY2hlbWE6IF90aGlzLl9zY2hlbWEsIHZhbHVlOiBtc2dWYWx1ZSB9XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgLy9UT0RPOiBGb3IgRnVydGhlciBTdHVkeVxyXG4gICAgICAgIGlmIChtc2cuYm9keS5oYXNPd25Qcm9wZXJ0eSgnbXV0dWFsJykgJiYgIW1zZy5ib2R5Lm11dHVhbCkge1xyXG4gICAgICAgICAgc2VuZE1zZy5ib2R5Lm11dHVhbCA9IG1zZy5ib2R5Lm11dHVhbDsvLyBUT0RPOiByZW1vdmU/XHJcbiAgICAgICAgICBfdGhpcy5kYXRhLm11dHVhbCA9IGZhbHNlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKF90aGlzLl9oZWFydEJlYXQpIHtcclxuICAgICAgICAgIHNlbmRNc2cuYm9keS52YWx1ZS5jaGlsZHJlbk9iamVjdHMgPSB7fTtcclxuICAgICAgICAgIHNlbmRNc2cuYm9keS52YWx1ZS5jaGlsZHJlbk9iamVjdHMuaGVhcnRiZWF0ID0gX3RoaXMuX2hlYXJ0QmVhdC5oZWFydGJlYXQ7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjb25zb2xlLmxvZygnW0RhdGFPYmplY3RSZXBvcnRlci5fb25TdWJzY3JpYmUuYWNjZXB0XSBzZW5kaW5nIHJlc3BvbnNlOiAnLCBzZW5kTXNnKVxyXG5cclxuICAgICAgICAvL3NlbmQgb2sgcmVzcG9uc2UgbWVzc2FnZVxyXG4gICAgICAgIF90aGlzLl9idXMucG9zdE1lc3NhZ2Uoc2VuZE1zZyk7XHJcblxyXG4gICAgICAgIHJldHVybiBzdWI7XHJcbiAgICAgIH0sXHJcblxyXG4gICAgICByZWplY3Q6IChyZWFzb24pID0+IHtcclxuICAgICAgICAvL3NlbmQgcmVqZWN0IHJlc3BvbnNlIG1lc3NhZ2VcclxuICAgICAgICBfdGhpcy5fYnVzLnBvc3RNZXNzYWdlKHtcclxuICAgICAgICAgIGlkOiBtc2cuaWQsIHR5cGU6ICdyZXNwb25zZScsIGZyb206IG1zZy50bywgdG86IG1zZy5mcm9tLFxyXG4gICAgICAgICAgYm9keTogeyBjb2RlOiA0MDMsIGRlc2M6IHJlYXNvbiB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH1cclxuICAgIH07XHJcblxyXG4gICAgaWYgKF90aGlzLl9vblN1YnNjcmlwdGlvbkhhbmRsZXIpIHtcclxuICAgICAgbG9nLmxvZygnU1VCU0NSSVBUSU9OLUVWRU5UOiAnLCBldmVudCk7XHJcbiAgICAgIF90aGlzLl9vblN1YnNjcmlwdGlvbkhhbmRsZXIoZXZlbnQpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLy9GTE9XLUlOOiBtZXNzYWdlIHJlY2VpdmVkIGZyb20gdGhpcyAtPiBfb25Gb3J3YXJkOiBlbWl0dGVkIGJ5IGEgcmVtb3RlIERhdGFPYmplY3RPYnNlcnZlciAtPiB1bnN1YnNjcmliZVxyXG4gIF9vblVuU3Vic2NyaWJlKG1zZykge1xyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuICAgIGxldCBoeXBlcnR5VXJsID0gbXNnLmJvZHkuZnJvbTtcclxuICAgIGxldCBkaXZpZGVkVVJMID0gZGl2aWRlVVJMKGh5cGVydHlVcmwpO1xyXG4gICAgbGV0IGRvbWFpbiA9IGRpdmlkZWRVUkwuZG9tYWluO1xyXG5cclxuICAgIGxvZy5sb2coJ1tEYXRhT2JqZWN0UmVwb3J0ZXIuX29uVW5TdWJzY3JpYmVdJywgbXNnLCBkb21haW4sIGRpdmlkZWRVUkwpO1xyXG5cclxuICAgIC8vbGV0IHN1YiA9IF90aGlzLl9zdWJzY3JpcHRpb25zW2h5cGVydHlVcmxdO1xyXG4gICAgZGVsZXRlIF90aGlzLl9zdWJzY3JpcHRpb25zW2h5cGVydHlVcmxdO1xyXG4gICAgZGVsZXRlIF90aGlzLmludml0YXRpb25zW2h5cGVydHlVcmxdO1xyXG5cclxuICAgIGxldCBldmVudCA9IHtcclxuICAgICAgdHlwZTogbXNnLmJvZHkudHlwZSxcclxuICAgICAgdXJsOiBoeXBlcnR5VXJsLFxyXG4gICAgICBkb21haW46IGRvbWFpbixcclxuICAgICAgaWRlbnRpdHk6IG1zZy5ib2R5LmlkZW50aXR5XHJcbiAgICB9O1xyXG5cclxuICAgIC8vIFRPRE86IGNoZWNrIGlmIHRoZSBfb25TdWJzY3JpcHRpb25IYW5kbGVyIGl0IGlzIHRoZSBzYW1lIG9mIHRoZSBzdWJzY3JpcHRpb25zPz8/XHJcbiAgICBpZiAoX3RoaXMuX29uU3Vic2NyaXB0aW9uSGFuZGxlcikge1xyXG4gICAgICBsb2cubG9nKCdVTi1TVUJTQ1JJUFRJT04tRVZFTlQ6ICcsIGV2ZW50KTtcclxuICAgICAgX3RoaXMuX29uU3Vic2NyaXB0aW9uSGFuZGxlcihldmVudCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvL0ZMT1ctSU46IG1lc3NhZ2UgcmVjZWl2ZWQgZnJvbSBSZXBvcnRlclVSTCBhZGRyZXNzOiBlbWl0ZWQgYnkgYSByZW1vdGUgU3luY2hlciAtPiBfb25SZW1vdGVDcmVhdGUgLT4gZXZlbnQuYWNrXHJcbiAgX29uUmVzcG9uc2UobXNnKSB7XHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG5cclxuICAgIGxldCBldmVudCA9IHtcclxuICAgICAgdHlwZTogbXNnLnR5cGUsXHJcbiAgICAgIHVybDogbXNnLmZyb20sXHJcbiAgICAgIGNvZGU6IG1zZy5ib2R5LmNvZGVcclxuICAgIH07XHJcblxyXG4gICAgaWYgKF90aGlzLl9vblJlc3BvbnNlSGFuZGxlcikge1xyXG4gICAgICBsb2cubG9nKCdSRVNQT05TRS1FVkVOVDogJywgZXZlbnQpO1xyXG4gICAgICBfdGhpcy5fb25SZXNwb25zZUhhbmRsZXIoZXZlbnQpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLy9GTE9XLUlOOiBtZXNzYWdlIHJlY2VpdmVkIGZyb20gUmVwb3J0ZXJVUkwgYWRkcmVzczogZW1pdGVkIGJ5IGEgcmVtb3RlIFN5bmNoZXIgLT4gcmVhZFxyXG4gIF9vblJlYWQobXNnKSB7XHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG4gICAgbGV0IGNoaWxkcmVuc1NpemUgPSBKU09OLnN0cmluZ2lmeShfdGhpcy5jaGlsZHJlbnNKU09OKS5sZW5ndGg7XHJcblxyXG4gICAgbGV0IGxhcmdlT2JqZWN0ID0gKGNoaWxkcmVuc1NpemUgPiBfdGhpcy5fY2hpbGRyZW5TaXplVGhyZXNob2xkKSA/IHRydWUgOiBmYWxzZTtcclxuXHJcbiAgICBsZXQgZXZlbnQgPSB7XHJcbiAgICAgIHR5cGU6IG1zZy50eXBlLFxyXG4gICAgICB1cmw6IG1zZy5mcm9tLFxyXG5cclxuICAgICAgYWNjZXB0OiAoKSA9PiB7XHJcbiAgICAgICAgaWYgKGxhcmdlT2JqZWN0KSBfdGhpcy5fc3luY1JlcGx5Rm9yTGFyZ2VEYXRhKG1zZyk7XHJcbiAgICAgICAgZWxzZSBfdGhpcy5fc3luY1JlcGx5KG1zZyk7XHJcbiAgICAgIH0sXHJcblxyXG4gICAgICByZWplY3Q6IChyZWFzb24pID0+IHtcclxuICAgICAgICBfdGhpcy5fYnVzLnBvc3RNZXNzYWdlKHtcclxuICAgICAgICAgIGlkOiBtc2cuaWQsIHR5cGU6ICdyZXNwb25zZScsIGZyb206IG1zZy50bywgdG86IG1zZy5mcm9tLFxyXG4gICAgICAgICAgYm9keTogeyBjb2RlOiA0MDEsIGRlc2M6IHJlYXNvbiB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH1cclxuICAgIH07XHJcblxyXG4gICAgLy8gaWYgdGhlIHJlcXVlc3RlciBpcyBhbiBhdXRob3Jpc2VkIG9ic2VydmVyLCB0aGUgZGF0YSBvYmplY3QgaXMgcmVzcG9uZGVkIG90aGVyd2lzZSBhbiBldmVudCBpcyB0cmlnZ2VyZWRcclxuICAgIGxldCBzdWJzY3JpcHRpb25zID0gW107XHJcblxyXG4gICAgaWYgKF90aGlzLm1ldGFkYXRhLnN1YnNjcmlwdGlvbnMpIHtcclxuICAgICAgc3Vic2NyaXB0aW9ucyA9IF90aGlzLm1ldGFkYXRhLnN1YnNjcmlwdGlvbnM7XHJcbiAgICB9IGVsc2UgaWYgKF90aGlzLl9zdWJzY3JpcHRpb25zKSB7XHJcbiAgICAgIHN1YnNjcmlwdGlvbnMgPSBPYmplY3Qua2V5cyhfdGhpcy5fc3Vic2NyaXB0aW9ucykubWFwKGZ1bmN0aW9uKGtleSkgeyByZXR1cm4gX3RoaXMuX3N1YnNjcmlwdGlvbnNba2V5XS51cmw7IH0pO1xyXG4gICAgfVxyXG5cclxuICAgIGlmIChzdWJzY3JpcHRpb25zLmluZGV4T2YobXNnLmZyb20pICE9IC0xKSB7XHJcbiAgICAgIGlmIChsYXJnZU9iamVjdCkgX3RoaXMuX3N5bmNSZXBseUZvckxhcmdlRGF0YShtc2cpO1xyXG4gICAgICBlbHNlIF90aGlzLl9zeW5jUmVwbHkobXNnKTtcclxuICAgIH0gZWxzZSBpZiAoX3RoaXMuX29uUmVhZEhhbmRsZXIpIHtcclxuICAgICAgbG9nLmxvZygnUkVBRC1FVkVOVDogJywgZXZlbnQpO1xyXG4gICAgICBfdGhpcy5fb25SZWFkSGFuZGxlcihldmVudCk7XHJcbiAgICB9XHJcblxyXG4gIH1cclxuXHJcbiAgZ2V0IGNoaWxkcmVuc0pTT04oKSB7XHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG4gICAgbGV0IGNoaWxkcmVucyA9IHt9O1xyXG5cclxuLy8gICAgbGV0IGNoaWxkcmVuO1xyXG5cclxuLy8gICAgZm9yIChjaGlsZHJlbiBpbiBfdGhpcy5fY2hpbGRyZW5PYmplY3RzKSB7XHJcbiAgICAgIGxldCBjaGlsZDtcclxuLy8gICAgICBjaGlsZHJlbnNbY2hpbGRyZW5dID0ge307XHJcbiAgICAgIGZvciAoY2hpbGQgaW4gX3RoaXMuX2NoaWxkcmVuT2JqZWN0cykge1xyXG4gICAgICAgIGNoaWxkcmVuc1tjaGlsZF0gPSB7fTtcclxuICAgICAgICBjaGlsZHJlbnNbY2hpbGRdLnZhbHVlID0gX3RoaXMuX2NoaWxkcmVuT2JqZWN0c1tjaGlsZF0ubWV0YWRhdGE7XHJcbiAgICAgICAgY2hpbGRyZW5zW2NoaWxkXS5pZGVudGl0eSA9IF90aGlzLl9jaGlsZHJlbk9iamVjdHNbY2hpbGRdLmlkZW50aXR5O1xyXG4gICAgICB9XHJcbi8vICAgIH1cclxuXHJcbiAgICByZXR1cm4gY2hpbGRyZW5zO1xyXG4gIH1cclxuXHJcbiAgX3N5bmNSZXBseShtc2cpIHtcclxuICAgIGxldCBfdGhpcyA9IHRoaXM7XHJcblxyXG4gICAgbGV0IG9iamVjdFZhbHVlID0gZGVlcENsb25lKF90aGlzLm1ldGFkYXRhKTtcclxuXHJcbiAgICBvYmplY3RWYWx1ZS5kYXRhID0gZGVlcENsb25lKF90aGlzLmRhdGEpO1xyXG4gICAgb2JqZWN0VmFsdWUuY2hpbGRyZW5PYmplY3RzID0gZGVlcENsb25lKF90aGlzLmNoaWxkcmVuc0pTT04pO1xyXG5cclxuICAgIG9iamVjdFZhbHVlLnZlcnNpb24gPSBfdGhpcy5fdmVyc2lvbjtcclxuXHJcbiAgICBsZXQgcmVzcG9uc2UgPSB7XHJcbiAgICAgIGlkOiBtc2cuaWQsIHR5cGU6ICdyZXNwb25zZScsIGZyb206IG1zZy50bywgdG86IG1zZy5mcm9tLFxyXG4gICAgICBib2R5OiB7IGNvZGU6IDIwMCwgdmFsdWU6IG9iamVjdFZhbHVlIH1cclxuICAgIH07XHJcblxyXG4gICAgX3RoaXMuX2J1cy5wb3N0TWVzc2FnZShyZXNwb25zZSk7XHJcblxyXG4gIH1cclxuXHJcbiAgLy8gVGhpcyBmdW5jdGlvbiBpcyBvbmx5IHVzZWQgaWYgdGhlIGRhdGEgb2JqZWN0IHRvIGJlIHN5bmNoZWQgaGFzIGNoaWxkcmVuT2plY3RzIHRvbyBsYXJnZVxyXG5cclxuICBfc3luY1JlcGx5Rm9yTGFyZ2VEYXRhKG1zZykge1xyXG4gIC8vc2V0IGF0dHJpYnV0ZSB3aXRoIG51bWJlciBvZiBzcGxsaXRlZCBtZXNzYWdlc1xyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuXHJcbiAgICAvLyBsZXRzIHNldCB0aGUgaW5pdGlhbCBtZXNzYWdlIHdpdGggbm8gY2hpbGRPYmplY3RzXHJcblxyXG4gICAgbGV0IG9iamVjdFZhbHVlID0gZGVlcENsb25lKF90aGlzLm1ldGFkYXRhKTtcclxuXHJcbiAgICBvYmplY3RWYWx1ZS5kYXRhID0gZGVlcENsb25lKF90aGlzLmRhdGEpO1xyXG5cclxuICAgIG9iamVjdFZhbHVlLnZlcnNpb24gPSBfdGhpcy5fdmVyc2lvbjtcclxuXHJcbiAgICBkZWxldGUgb2JqZWN0VmFsdWUuY2hpbGRyZW5PYmplY3RzO1xyXG5cclxuICAgIGxldCBjaGlsZHJlbjtcclxuICAgIGxldCB2YWx1ZXMgPSBbXTsgLy8gYXJyYXkgb2YgdmFsdWVzIHRvIGJlIHNlbnQgaW4gc2VwYXJhdGVkIHJlc3BvbnNlc1xyXG4gICAgbGV0IGNoaWxkcmVuVmFsdWUgPSB7fTsgLy8gdmFsdWUgdG8gYmUgdXNlZCBpbiBlYWNoIHJlc3BvbnNlXHJcblxyXG4gICAgZm9yIChjaGlsZCBpbiBfdGhpcy5fY2hpbGRyZW5PYmplY3RzKSB7XHJcbi8vICAgICAgbGV0IGNoaWxkO1xyXG4gICAgICBjaGlsZHJlblZhbHVlW2NoaWxkXSA9IHt9O1xyXG4vLyAgICAgIGZvciAoY2hpbGQgaW4gX3RoaXMuX2NoaWxkcmVuT2JqZWN0c1tjaGlsZHJlbl0pIHtcclxuICAgICAgICBpZiAoSlNPTi5zdHJpbmdpZnkoY2hpbGRyZW5WYWx1ZSkubGVuZ3RoID4gX3RoaXMuX2NoaWxkcmVuU2l6ZVRocmVzaG9sZCkge1xyXG4gICAgICAgICAgLy9jaGlsZHJlblZhbHVlIGJpZyBlbm91Z2ggdG8gYmUgc2VudCBpbiBhIHJlc3BvbnNlIG1lc3NhZ2VcclxuICAgICAgICAgIHZhbHVlcy5wdXNoKGNoaWxkcmVuVmFsdWUpO1xyXG4vLyAgICAgICAgICBjaGlsZHJlblZhbHVlID0ge307XHJcbi8vICAgICAgICAgIGNoaWxkcmVuVmFsdWVbY2hpbGRdID0ge307XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNoaWxkcmVuVmFsdWVbY2hpbGRdID0ge307XHJcbiAgICAgICAgY2hpbGRyZW5WYWx1ZVtjaGlsZF0udmFsdWUgPSBfdGhpcy5fY2hpbGRyZW5PYmplY3RzW2NoaWxkXS5tZXRhZGF0YTtcclxuICAgICAgICBjaGlsZHJlblZhbHVlW2NoaWxkXS5pZGVudGl0eSA9IF90aGlzLl9jaGlsZHJlbk9iamVjdHNbY2hpbGRdLmlkZW50aXR5O1xyXG4vLyAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICB2YWx1ZXMucHVzaChjaGlsZHJlblZhbHVlKTtcclxuXHJcbiAgICBvYmplY3RWYWx1ZS5yZXNwb25zZXMgPSB2YWx1ZXMubGVuZ3RoICsgMTsgLy9udW1iZXIgb2YgcmVzcG9uc2VzIHRvIGJlIHNlbnRcclxuXHJcbiAgICBsZXQgaW5pdGlhbFJlc3BvbnNlID0ge1xyXG4gICAgICBpZDogbXNnLmlkLCB0eXBlOiAncmVzcG9uc2UnLCBmcm9tOiBtc2cudG8sIHRvOiBtc2cuZnJvbSxcclxuICAgICAgYm9keTogeyBjb2RlOiAxMDAsIHZhbHVlOiBvYmplY3RWYWx1ZSB9XHJcbiAgICB9O1xyXG5cclxuICAgIF90aGlzLl9idXMucG9zdE1lc3NhZ2UoaW5pdGlhbFJlc3BvbnNlKTtcclxuXHJcbiAgICB2YWx1ZXMuZm9yRWFjaCgodmFsdWUpID0+IHtcclxuXHJcbiAgICAgIGxldCByZXNwb25zZSA9IGRlZXBDbG9uZShpbml0aWFsUmVzcG9uc2UpO1xyXG5cclxuICAgICAgcmVzcG9uc2UuYm9keS52YWx1ZSA9IHZhbHVlO1xyXG5cclxuICAgICAgcmVzcG9uc2UuYm9keS52YWx1ZS5yZXNwb25zZXMgPSBvYmplY3RWYWx1ZS5yZXNwb25zZXM7XHJcblxyXG4gICAgICBzZXRUaW1lb3V0KCgpID0+IHsgX3RoaXMuX2J1cy5wb3N0TWVzc2FnZShyZXNwb25zZSk7IH0sIDUwKTtcclxuXHJcbiAgICAgIC8vIHNob3VsZCBwdXQgYSB0aW1lb3V0P1xyXG5cclxuICAgIH0pO1xyXG5cclxuICB9XHJcblxyXG4gIC8vIEV4ZWN1dGUgcmVxdWVzdCByZWNlaXZlZFxyXG4gIF9vbkV4ZWN1dGUobXNnKSB7XHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG5cclxuICAgIGlmICghbXNnLmJvZHkubWV0aG9kKSB0aHJvdyAnW0RhdGFPYmplY3RSZXBvcnRlci5fb25FeGVjdXRlXSBtZXRob2QgbWlzc2luZyAnLCBtc2c7XHJcblxyXG4gICAgbGV0IHJlc3BvbnNlID0ge1xyXG4gICAgICBpZDogbXNnLmlkLCB0eXBlOiAncmVzcG9uc2UnLCBmcm9tOiBtc2cudG8sIHRvOiBtc2cuZnJvbSxcclxuICAgICAgYm9keTogeyBjb2RlOiAyMDAgfVxyXG4gICAgfTtcclxuXHJcbiAgICBsZXQgZXZlbnQgPSB7XHJcbiAgICAgIHR5cGU6IG1zZy50eXBlLFxyXG4gICAgICB1cmw6IG1zZy5mcm9tLFxyXG4gICAgICBtZXRob2Q6IG1zZy5ib2R5Lm1ldGhvZCxcclxuICAgICAgcGFyYW1zOiBtc2cuYm9keS5wYXJhbXMsXHJcblxyXG4gICAgICBhY2NlcHQ6ICgpID0+IHtcclxuICAgICAgICBfdGhpcy5fYnVzLnBvc3RNZXNzYWdlKHJlc3BvbnNlKTtcclxuICAgICAgfSxcclxuXHJcbiAgICAgIHJlamVjdDogKHJlYXNvbikgPT4ge1xyXG4gICAgICAgIF90aGlzLl9idXMucG9zdE1lc3NhZ2Uoe1xyXG4gICAgICAgICAgaWQ6IG1zZy5pZCwgdHlwZTogJ3Jlc3BvbnNlJywgZnJvbTogbXNnLnRvLCB0bzogbXNnLmZyb20sXHJcbiAgICAgICAgICBib2R5OiB7IGNvZGU6IDQwMSwgZGVzYzogcmVhc29uIH1cclxuICAgICAgICB9KTtcclxuICAgICAgfVxyXG4gICAgfTtcclxuXHJcbiAgICBpZiAoX3RoaXMuX29uRXhlY3V0ZUhhbmRsZXIpIHtcclxuICAgICAgbG9nLmxvZygnW0RhdGFPYmplY3RSZXBvcnRlcl0gRVhFQ1VURS1FVkVOVDogJywgZXZlbnQpO1xyXG4gICAgICBfdGhpcy5fb25FeGVjdXRlSGFuZGxlcihldmVudCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxufVxyXG5cclxuZXhwb3J0IGRlZmF1bHQgRGF0YU9iamVjdFJlcG9ydGVyO1xyXG4iLCIvKipcclxuKiBDb3B5cmlnaHQgMjAxNiBQVCBJbm92YcOnw6NvIGUgU2lzdGVtYXMgU0FcclxuKiBDb3B5cmlnaHQgMjAxNiBJTkVTQy1JRFxyXG4qIENvcHlyaWdodCAyMDE2IFFVT0JJUyBORVRXT1JLUyBTTFxyXG4qIENvcHlyaWdodCAyMDE2IEZSQVVOSE9GRVItR0VTRUxMU0NIQUZUIFpVUiBGT0VSREVSVU5HIERFUiBBTkdFV0FORFRFTiBGT1JTQ0hVTkcgRS5WXHJcbiogQ29weXJpZ2h0IDIwMTYgT1JBTkdFIFNBXHJcbiogQ29weXJpZ2h0IDIwMTYgRGV1dHNjaGUgVGVsZWtvbSBBR1xyXG4qIENvcHlyaWdodCAyMDE2IEFwaXplZVxyXG4qIENvcHlyaWdodCAyMDE2IFRFQ0hOSVNDSEUgVU5JVkVSU0lUQVQgQkVSTElOXHJcbipcclxuKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4qIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuKlxyXG4qICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbipcclxuKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4qIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4qIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuKiovXHJcblxyXG4vLyBMb2cgU3lzdGVtXHJcbmltcG9ydCAqIGFzIGxvZ2dlciBmcm9tICdsb2dsZXZlbCc7XHJcbmxldCBsb2cgPSBsb2dnZXIuZ2V0TG9nZ2VyKCdEYXRhT2JqZWN0T2JzZXJ2ZXInKTtcclxuXHJcbmltcG9ydCB7IGRlZXBDbG9uZSB9IGZyb20gJy4uL3V0aWxzL3V0aWxzJztcclxuaW1wb3J0IERhdGFPYmplY3QgZnJvbSAnLi9EYXRhT2JqZWN0JztcclxuXHJcbmxldCBGaWx0ZXJUeXBlID0ge0FOWTogJ2FueScsIFNUQVJUOiAnc3RhcnQnLCBFWEFDVDogJ2V4YWN0J307XHJcblxyXG4vKipcclxuICogVGhlIGNsYXNzIHJldHVybmVkIGZyb20gdGhlIFN5bmNoZXIgc3Vic2NyaWJlIGNhbGwuXHJcbiAqIFRvIGJlIHVzZWQgYXMgYW4gb2JzZXJ2YXRpb24gcG9pbnQgZnJvbSBhIERhdGFPYmplY3RSZXBvcnRlciBjaGFuZ2UuXHJcbiAqL1xyXG5jbGFzcyBEYXRhT2JqZWN0T2JzZXJ2ZXIgZXh0ZW5kcyBEYXRhT2JqZWN0IC8qIGltcGxlbWVudHMgU3luY1N0YXR1cyAqLyB7XHJcbiAgLyogcHJpdmF0ZVxyXG4gIF9jaGFuZ2VMaXN0ZW5lcjogTXNnTGlzdGVuZXJcclxuXHJcbiAgLS0tLWV2ZW50IGhhbmRsZXJzLS0tLVxyXG4gIF9maWx0ZXJzOiB7PGZpbHRlcj46IHt0eXBlOiA8c3RhcnQsIGV4YWN0PiwgY2FsbGJhY2s6IDxmdW5jdGlvbj59IH1cclxuICAqL1xyXG5cclxuICAvKipcclxuICAgKiBAaWdub3JlXHJcbiAgICogU2hvdWxkIG5vdCBiZSB1c2VkIGRpcmVjdGx5IGJ5IEh5cGVydGllcy4gSXQncyBjYWxsZWQgYnkgdGhlIFN5bmNoZXIuc3Vic2NyaWJlIG1ldGhvZFxyXG4gICAqL1xyXG5cclxuICAvL1RPRE86IEZvciBGdXJ0aGVyIFN0dWR5XHJcbiAgY29uc3RydWN0b3IoaW5wdXQpIHtcclxuICAgIC8vdG9kbzogY2hlY2sgd2h5XHJcbiAgICAvL2lucHV0LmluaXRpYWxEYXRhID0gaW5wdXQuaW5pdGlhbERhdGEuZGF0YTtcclxuXHJcbiAgICBzdXBlcihpbnB1dCk7XHJcblxyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuXHJcbiAgICBfdGhpcy5fdmVyc2lvbiA9IGlucHV0LnZlcnNpb247XHJcbiAgICBfdGhpcy5fZmlsdGVycyA9IHt9O1xyXG5cclxuICAgIF90aGlzLl9zeW5jT2JqLm9ic2VydmUoKGV2ZW50KSA9PiB7XHJcbiAgICAgIF90aGlzLl9vbkZpbHRlcihldmVudCk7XHJcbiAgICB9KTtcclxuXHJcblxyXG4gICAgX3RoaXMuX2FsbG9jYXRlTGlzdGVuZXJzKCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBTeW5jIERhdGEgT2JqZWN0IE9ic2VydmVyIHdpdGggbGFzdCB2ZXJzaW9uIG9mIERhdGEgT2JqZWN0IFJlcG9ydGVyLiBVc2VmdWwgZm9yIFJlc3VtZXNcclxuICAgKi9cclxuICBzeW5jKCkge1xyXG5cclxuICAgIGxldCBfdGhpcyA9IHRoaXM7XHJcbiAgICBsb2cuaW5mbygnW0RhdGFPYmplY3RPYnNlcnZlcl9zeW5jXSBzeW5jaHJvbmlzaW5nICcpO1xyXG5cclxuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XHJcblxyXG4gICAgICBsZXQgY3JpdGVyaWEgPSB7fTtcclxuXHJcbi8vICAgICAgaWYgKHRoaXMubWV0YWRhdGEuYmFja3VwUmV2aXNpb24pIGNyaXRlcmlhLmJhY2t1cFJldmlzaW9uID0gdGhpcy5tZXRhZGF0YS5iYWNrdXBSZXZpc2lvbjtcclxuXHJcbiAgICAgIF90aGlzLl9zeW5jaGVyLnJlYWQoX3RoaXMuX21ldGFkYXRhLnVybCwgY3JpdGVyaWEpLnRoZW4oKHZhbHVlKT0+e1xyXG4gICAgICAgIGxvZy5pbmZvKCdbRGF0YU9iamVjdE9ic2VydmVyX3N5bmNdIHZhbHVlIHRvIHN5bmM6ICcsIHZhbHVlKTtcclxuXHJcbiAgICAgICAgT2JqZWN0LmFzc2lnbihfdGhpcy5kYXRhLCBkZWVwQ2xvbmUodmFsdWUuZGF0YSkpO1xyXG5cclxuICAgICAgICBfdGhpcy5fdmVyc2lvbiA9IHZhbHVlLnZlcnNpb247XHJcblxyXG4gICAgICAgIF90aGlzLl9tZXRhZGF0YS5sYXN0TW9kaWZpZWQgPSB2YWx1ZS5sYXN0TW9kaWZpZWQ7XHJcblxyXG4gICAgICAgIC8vVE9ETzogY2hlY2sgZmlyc3QgaWYgdGhlcmUgYXJlIG5ldyBjaGlsZHJlbk9iamVjdHMgdG8gYXZvaWQgb3ZlcmhlYWRcclxuXHJcbiAgICAgICAgaWYgKHZhbHVlLmNoaWxkcmVuT2JqZWN0cykge1xyXG4gICAgICAgICAgX3RoaXMucmVzdW1lQ2hpbGRyZW5zKHZhbHVlLmNoaWxkcmVuT2JqZWN0cyk7XHJcbiAgICAgICAgICBfdGhpcy5fc3RvcmVDaGlsZHJlbnMoKTtcclxuICAgICAgICAgIHJlc29sdmUodHJ1ZSk7XHJcbiAgICAgICAgfSBlbHNlIHJlc29sdmUodHJ1ZSk7XHJcblxyXG5cclxuICAgICAgICAvKmlmICh2YWx1ZS52ZXJzaW9uICE9IF90aGlzLl92ZXJzaW9uKSB7XHJcbiAgICAgICAgICBsb2cuaW5mbygnW0RhdGFPYmplY3RPYnNlcnZlcl9zeW5jXSB1cGRhdGluZyBleGlzdGluZyBkYXRhOiAnLCBfdGhpcy5kYXRhKTtcclxuXHJcbiAgICAgICAgICBPYmplY3QuYXNzaWduKF90aGlzLmRhdGEgfHwge30sIGRlZXBDbG9uZSh2YWx1ZS5kYXRhKSk7XHJcblxyXG4gICAgICAgICAgX3RoaXMuX21ldGFkYXRhID0gZGVlcENsb25lKHZhbHVlKTtcclxuXHJcbiAgICAgICAgICBkZWxldGUgX3RoaXMuX21ldGFkYXRhLmRhdGE7XHJcblxyXG4gICAgICAgICAgX3RoaXMuX3ZlcnNpb24gPSB2YWx1ZS52ZXJzaW9uO1xyXG5cclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgbG9nLmluZm8oJ1tEYXRhT2JqZWN0T2JzZXJ2ZXJfc3luY10gZXhpc3RpbmcgZGF0YSBpcyB1cGRhdGVkOiAnLCB2YWx1ZSk7XHJcbiAgICAgICAgfSovXHJcblxyXG4gICAgICB9KS5jYXRjaCgocmVhc29uKSA9PiB7XHJcbiAgICAgICAgbG9nLmluZm8oJ1tEYXRhT2JqZWN0T2JzZXJ2ZXJfc3luY10gc3luYyBmYWlsZWQ6ICcsIHJlYXNvbik7XHJcbiAgICAgICAgcmVzb2x2ZShmYWxzZSk7XHJcbiAgICAgIH0pO1xyXG5cclxuICAgIH0pO1xyXG5cclxuXHJcbiAgfVxyXG5cclxuICBfc3RvcmVDaGlsZHJlbnMoKSB7XHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG5cclxuICAgIGxldCBjaGlsZHJlbnMgPSB7fTtcclxuXHJcbiAgICAvL1RPRE86IHRvIGJlIHNlbnQgdG8gSHlwZXJ0eVJlc291cmNlU3RvcmFnZSB3aGVuIHJlYWR5IHRvIGhhbmRsZSBDaGF0IE1lc3NhZ2VzXHJcblxyXG4gICAgT2JqZWN0LmtleXMoX3RoaXMuX2NoaWxkcmVuT2JqZWN0cykuZm9yRWFjaCgoY2hpbGRJZCkgPT4ge1xyXG4gICAgICBsZXQgY2hpbGRyZW4gPSBfdGhpcy5fY2hpbGRyZW5PYmplY3RzO1xyXG4vLyAgICAgIGNoaWxkcmVuc1tjaGlsZHJlblJlc291cmNlXSA9IHt9O1xyXG5cclxuLy8gICAgICBPYmplY3Qua2V5cyhjaGlsZHJlbikuZm9yRWFjaCgoY2hpbGRJZCkgPT4ge1xyXG4gICAgICAgIGNoaWxkcmVuc1tjaGlsZElkXSA9IHt9O1xyXG4gICAgICAgIGNoaWxkcmVuc1tjaGlsZElkXS52YWx1ZSA9IGNoaWxkcmVuW2NoaWxkSWRdLm1ldGFkYXRhO1xyXG4gICAgICAgIGNoaWxkcmVuc1tjaGlsZElkXS5pZGVudGl0eSA9IGNoaWxkcmVuW2NoaWxkSWRdLmlkZW50aXR5O1xyXG4vLyAgICAgIH0pO1xyXG4gICAgfSk7XHJcblxyXG4gICAgICBsZXQgbXNnID0ge1xyXG5cclxuICAgICAgICBmcm9tOiBfdGhpcy5fb3duZXIsXHJcbiAgICAgICAgdG86IF90aGlzLl9zeW5jaGVyLl9zdWJVUkwsXHJcbiAgICAgICAgdHlwZTogJ2NyZWF0ZScsXHJcbiAgICAgICAgYm9keToge1xyXG4gICAgICAgICAgcmVzb3VyY2U6IF90aGlzLl91cmwsXHJcbiAgICAgICAgICBhdHRyaWJ1dGU6ICdjaGlsZHJlbk9iamVjdHMnLFxyXG4gICAgICAgICAgdmFsdWU6IGNoaWxkcmVuc1xyXG4gICAgICAgIH1cclxuICAgICAgfTtcclxuXHJcbiAgICAgIF90aGlzLl9idXMucG9zdE1lc3NhZ2UobXNnKTtcclxuXHJcbiAgfVxyXG5cclxuICBfYWxsb2NhdGVMaXN0ZW5lcnMoKSB7XHJcbiAgICBzdXBlci5fYWxsb2NhdGVMaXN0ZW5lcnMoKTtcclxuICAgIGxldCBfdGhpcyA9IHRoaXM7XHJcblxyXG4gICAgX3RoaXMuX2NoYW5nZUxpc3RlbmVyID0gX3RoaXMuX2J1cy5hZGRMaXN0ZW5lcihfdGhpcy5fdXJsICsgJy9jaGFuZ2VzJywgKG1zZykgPT4ge1xyXG4gICAgICBpZiAobXNnLnR5cGUgPT09ICd1cGRhdGUnKSB7XHJcbiAgICAgICAgbG9nLmxvZygnRGF0YU9iamVjdE9ic2VydmVyLScgKyBfdGhpcy5fdXJsICsgJy1SQ1Y6ICcsIG1zZyk7XHJcbiAgICAgICAgX3RoaXMuX2NoYW5nZU9iamVjdChfdGhpcy5fc3luY09iaiwgbXNnKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBfcmVsZWFzZUxpc3RlbmVycygpIHtcclxuICAgIHN1cGVyLl9yZWxlYXNlTGlzdGVuZXJzKCk7XHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG5cclxuICAgIF90aGlzLl9jaGFuZ2VMaXN0ZW5lci5yZW1vdmUoKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFJlbGVhc2UgYW5kIGRlbGV0ZSBvYmplY3QgZGF0YVxyXG4gICAqL1xyXG4gIGRlbGV0ZSgpIHtcclxuICAgIGxldCBfdGhpcyA9IHRoaXM7XHJcblxyXG4gICAgaWYgKF90aGlzLl9oZWFydEJlYXQpIF90aGlzLl9oZWFydEJlYXQuc3RvcCgpO1xyXG5cclxuICAgIF90aGlzLl9kZWxldGVDaGlsZHJlbnMoKS50aGVuKCgpPT57XHJcbiAgICAgIF90aGlzLnVuc3Vic2NyaWJlKCk7XHJcbiAgICAgIF90aGlzLl9yZWxlYXNlTGlzdGVuZXJzKCk7XHJcbiAgICAgIGRlbGV0ZSBfdGhpcy5fc3luY2hlci5fb2JzZXJ2ZXJzW190aGlzLl91cmxdO1xyXG4gICAgfSk7XHJcblxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogUmVsZWFzZSBhbmQgZGVsZXRlIG9iamVjdCBkYXRhXHJcbiAgICovXHJcbiAgdW5zdWJzY3JpYmUoKSB7XHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG5cclxuICAgIC8vRkxPVy1PVVQ6IHRoaXMgbWVzc2FnZSB3aWxsIGJlIHNlbnQgdG8gdGhlIHJ1bnRpbWUgaW5zdGFuY2Ugb2YgU3luY2hlck1hbmFnZXIgLT4gX29uTG9jYWxVblN1YnNjcmliZVxyXG4gICAgbGV0IHVuU3Vic2NyaWJlTXNnID0ge1xyXG4gICAgICB0eXBlOiAndW5zdWJzY3JpYmUnLCBmcm9tOiBfdGhpcy5fb3duZXIsIHRvOiBfdGhpcy5fc3luY2hlci5fc3ViVVJMLFxyXG4gICAgICBib2R5OiB7IHJlc291cmNlOiBfdGhpcy5fdXJsIH1cclxuICAgIH07XHJcblxyXG4gICAgX3RoaXMuX2J1cy5wb3N0TWVzc2FnZSh1blN1YnNjcmliZU1zZywgKHJlcGx5KSA9PiB7XHJcbiAgICAgIGxvZy5sb2coJ0RhdGFPYmplY3RPYnNlcnZlci1VTlNVQlNDUklCRTogJywgcmVwbHkpO1xyXG4gICAgICBpZiAocmVwbHkuYm9keS5jb2RlID09PSAyMDApIHtcclxuICAgICAgICBfdGhpcy5fcmVsZWFzZUxpc3RlbmVycygpO1xyXG4gICAgICAgIGRlbGV0ZSBfdGhpcy5fc3luY2hlci5fb2JzZXJ2ZXJzW190aGlzLl91cmxdO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFJlZ2lzdGVyIHRoZSBjaGFuZ2UgbGlzdGVuZXJzIHNlbnQgYnkgdGhlIHJlcG9ydGVyXHJcbiAgICogQHBhcmFtIHtzdHJpbmd9IGZpbHRlciAtIEZpbHRlciB0aGF0IGlkZW50aWZpZXMgdGhlIGZpZWxkIChzZXBhcmF0ZWQgZG90IHBhdGgpLiBBY2NlcHRzICogYXQgdGhlIGVuZCBmb3IgYSBtb3JlIHVucmVzdHJpY3RlZCBmaWx0ZXJpbmcuXHJcbiAgICogQHBhcmFtIHtmdW5jdGlvbihldmVudDogTXNnRXZlbnQpfSBjYWxsYmFja1xyXG4gICAqL1xyXG4gIG9uQ2hhbmdlKGZpbHRlciwgY2FsbGJhY2spIHtcclxuICAgIGxldCBrZXkgPSBmaWx0ZXI7XHJcbiAgICBsZXQgZmlsdGVyT2JqID0ge1xyXG4gICAgICB0eXBlOiBGaWx0ZXJUeXBlLkVYQUNULFxyXG4gICAgICBjYWxsYmFjazogY2FsbGJhY2tcclxuICAgIH07XHJcblxyXG4gICAgbGV0IGlkeCA9IGZpbHRlci5pbmRleE9mKCcqJyk7XHJcbiAgICBpZiAoaWR4ID09PSBmaWx0ZXIubGVuZ3RoIC0gMSkge1xyXG4gICAgICBpZiAoaWR4ID09PSAwKSB7XHJcbiAgICAgICAgZmlsdGVyT2JqLnR5cGUgPSBGaWx0ZXJUeXBlLkFOWTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBmaWx0ZXJPYmoudHlwZSA9IEZpbHRlclR5cGUuU1RBUlQ7XHJcbiAgICAgICAga2V5ID0gZmlsdGVyLnN1YnN0cigwLCBmaWx0ZXIubGVuZ3RoIC0gMSk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICB0aGlzLl9maWx0ZXJzW2tleV0gPSBmaWx0ZXJPYmo7XHJcbiAgfVxyXG5cclxuICBfb25GaWx0ZXIoZXZlbnQpIHtcclxuICAgIGxldCBfdGhpcyA9IHRoaXM7XHJcblxyXG4gICAgT2JqZWN0LmtleXMoX3RoaXMuX2ZpbHRlcnMpLmZvckVhY2goKGtleSkgPT4ge1xyXG4gICAgICBsZXQgZmlsdGVyID0gX3RoaXMuX2ZpbHRlcnNba2V5XTtcclxuICAgICAgaWYgKGZpbHRlci50eXBlID09PSBGaWx0ZXJUeXBlLkFOWSkge1xyXG4gICAgICAgIC8vbWF0Y2ggYW55dGhpbmdcclxuICAgICAgICBmaWx0ZXIuY2FsbGJhY2soZXZlbnQpO1xyXG4gICAgICB9IGVsc2UgaWYgKGZpbHRlci50eXBlID09PSBGaWx0ZXJUeXBlLlNUQVJUKSB7XHJcbiAgICAgICAgLy9pZiBzdGFydHMgd2l0aCBmaWx0ZXIuLi5cclxuICAgICAgICBpZiAoZXZlbnQuZmllbGQuaW5kZXhPZihrZXkpID09PSAwKSB7XHJcbiAgICAgICAgICBmaWx0ZXIuY2FsbGJhY2soZXZlbnQpO1xyXG4gICAgICAgIH1cclxuICAgICAgfSBlbHNlIGlmIChmaWx0ZXIudHlwZSA9PT0gRmlsdGVyVHlwZS5FWEFDVCkge1xyXG4gICAgICAgIC8vZXhhY3QgbWF0Y2hcclxuICAgICAgICBpZiAoZXZlbnQuZmllbGQgPT09IGtleSkge1xyXG4gICAgICAgICAgZmlsdGVyLmNhbGxiYWNrKGV2ZW50KTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgb25EaXNjb25uZWN0ZWQoY2FsbGJhY2spIHtcclxuXHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xyXG5cclxuICAgICAgdGhpcy5fc3Vic2NyaWJlUmVnaXN0cmF0aW9uKClcclxuICAgICAgLnRoZW4oKCkgPT4ge1xyXG4gICAgICAgIHRoaXMuX29uRGlzY29ubmVjdGVkID0gY2FsbGJhY2s7XHJcbiAgICAgICAgcmVzb2x2ZSgpO1xyXG4gICAgICB9KVxyXG4gICAgICAuY2F0Y2goKGVycikgPT4gcmVqZWN0KGVycikpO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBfc3Vic2NyaWJlUmVnaXN0cmF0aW9uKCkge1xyXG5cclxuICAgIGNvbnN0IG1zZyA9IHtcclxuICAgICAgdHlwZTogJ3N1YnNjcmliZScsXHJcbiAgICAgIGZyb206IHRoaXMuX293bmVyLFxyXG4gICAgICB0bzogdGhpcy5fc3luY2hlci5fcnVudGltZVVybCArICcvc3Vic2NyaXB0aW9ucycsXHJcbiAgICAgIGJvZHk6IHtcclxuICAgICAgICByZXNvdXJjZXM6IFt0aGlzLl91cmwgKyAnL3JlZ2lzdHJhdGlvbiddXHJcbiAgICAgIH1cclxuICAgIH07XHJcblxyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcclxuXHJcbiAgICAgIHRoaXMuX2J1cy5wb3N0TWVzc2FnZShtc2csIChyZXBseSkgPT4ge1xyXG4gICAgICAgIGxvZy5sb2coYFtEYXRhT2JqZWN0T2JzZXJ2ZXIuX3N1YnNjcmliZVJlZ2lzdHJhdGlvbl0gJHt0aGlzLl91cmx9IHJjdmVkIHJlcGx5IGAsIHJlcGx5KTtcclxuXHJcbiAgICAgICAgaWYgKHJlcGx5LmJvZHkuY29kZSA9PT0gMjAwKSB7XHJcbiAgICAgICAgICB0aGlzLl9nZW5lcmF0ZUxpc3RlbmVyKHRoaXMuX3VybCArICcvcmVnaXN0cmF0aW9uJyk7XHJcbiAgICAgICAgICByZXNvbHZlKCk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIGxvZy5lcnJvcignRXJyb3Igc3Vic2NyaWJpbmcgcmVnaXN0cmF0aW9uIHN0YXR1cyBmb3IgJywgdGhpcy5fdXJsKTtcclxuICAgICAgICAgIHJlamVjdCgnRXJyb3Igc3Vic2NyaWJpbmcgcmVnaXN0cmF0aW9uIHN0YXR1cyBmb3IgJyArIHRoaXMuX3VybCk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgX2dlbmVyYXRlTGlzdGVuZXIobm90aWZpY2F0aW9uVVJMKSB7XHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG5cclxuICAgIF90aGlzLl9idXMuYWRkTGlzdGVuZXIobm90aWZpY2F0aW9uVVJMLCAobXNnKSA9PiB7XHJcbiAgICAgIGxvZy5sb2coYFtEYXRhT2JqZWN0T2JzZXJ2ZXIucmVnaXN0cmF0aW9uTm90aWZpY2F0aW9uXSAke190aGlzLl91cmx9OiBgLCBtc2cpO1xyXG4gICAgICBpZiAobXNnLmJvZHkudmFsdWUgJiYgbXNnLmJvZHkudmFsdWUgPT09ICdkaXNjb25uZWN0ZWQnICYmIF90aGlzLl9vbkRpc2Nvbm5lY3RlZCkge1xyXG4gICAgICAgIGxvZy5sb2coYFtEYXRhT2JqZWN0T2JzZXJ2ZXJdICR7X3RoaXMuX3VybH06IHdhcyBkaXNjb25uZWN0ZWQgYCwgbXNnKTtcclxuICAgICAgICBfdGhpcy5fb25EaXNjb25uZWN0ZWQoKTtcclxuICAgICAgfVxyXG5cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogUmVxdWVzdHMgdGhlIHJlcG9ydGVyIHRvIGV4ZWN1dGUgYSBtZXRob2Qgb24gdGhlIGRhdGEgb2JqZWN0XHJcbiAgICogQHBhcmFtIHtzdHJpbmd9IG1ldGhvZCAtIE5hbWUgb2YgdGhlIGZ1bmN0aW9uIHRvIGJlIGV4ZWN1dGVkLlxyXG4gICAqIEBwYXJhbSB7YXJyYXl9IHBhcmFtcyAtIGFycmF5IG9mIHBhcmFtZXRlcnMgZm9yIHRoZSByZXF1ZXN0ZWQgZnVuY3Rpb25cclxuICAgKiBAcmV0dXJuIHtwcm9taXNlfVxyXG4gICAqL1xyXG5cclxuICBleGVjdXRlKG1ldGhvZCwgcGFyYW1zKSB7XHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG5cclxuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XHJcblxyXG4gICAgICBjb25zdCBtc2cgPSB7XHJcbiAgICAgICAgdHlwZTogJ2V4ZWN1dGUnLFxyXG4gICAgICAgIGZyb206IHRoaXMuX293bmVyLFxyXG4gICAgICAgIHRvOiBfdGhpcy5fdXJsLFxyXG4gICAgICAgIGJvZHk6IHtcclxuICAgICAgICAgIG1ldGhvZDogbWV0aG9kLFxyXG4gICAgICAgICAgcGFyYW1zOiBwYXJhbXNcclxuICAgICAgICB9XHJcbiAgICAgIH07XHJcblxyXG4gICAgICBfdGhpcy5fYnVzLnBvc3RNZXNzYWdlKG1zZywgKHJlcGx5KSA9PiB7XHJcbiAgICAgICAgbG9nLmxvZyhgW0RhdGFPYmplY3RPYnNlcnZlci5leGVjdXRlXSAke190aGlzLl91cmx9IHJjdmVkIHJlcGx5IGAsIHJlcGx5KTtcclxuXHJcbiAgICAgICAgaWYgKHJlcGx5LmJvZHkuY29kZSA9PT0gMjAwKSB7XHJcbiAgICAgICAgICByZXNvbHZlKCk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIGxvZy53YXJuKGBbRGF0YU9iamVjdE9ic2VydmVyLmV4ZWN1dGVdIGV4ZWN1dGlvbiBvZiBtZXRob2QgJHttZXRob2R9IHdhcyByZWplY3QgYnkgcmVwb3J0ZXJgKTtcclxuICAgICAgICAgIHJlamVjdChgW0RhdGFPYmplY3RPYnNlcnZlci5leGVjdXRlXSBleGVjdXRpb24gb2YgbWV0aG9kICR7bWV0aG9kfSB3YXMgcmVqZWN0IGJ5IHJlcG9ydGVyYCk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KTtcclxuICAgIH0pO1xyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGRlZmF1bHQgRGF0YU9iamVjdE9ic2VydmVyO1xyXG4iLCIvKipcclxuKiBDb3B5cmlnaHQgMjAxNiBQVCBJbm92YcOnw6NvIGUgU2lzdGVtYXMgU0FcclxuKiBDb3B5cmlnaHQgMjAxNiBJTkVTQy1JRFxyXG4qIENvcHlyaWdodCAyMDE2IFFVT0JJUyBORVRXT1JLUyBTTFxyXG4qIENvcHlyaWdodCAyMDE2IEZSQVVOSE9GRVItR0VTRUxMU0NIQUZUIFpVUiBGT0VSREVSVU5HIERFUiBBTkdFV0FORFRFTiBGT1JTQ0hVTkcgRS5WXHJcbiogQ29weXJpZ2h0IDIwMTYgT1JBTkdFIFNBXHJcbiogQ29weXJpZ2h0IDIwMTYgRGV1dHNjaGUgVGVsZWtvbSBBR1xyXG4qIENvcHlyaWdodCAyMDE2IEFwaXplZVxyXG4qIENvcHlyaWdodCAyMDE2IFRFQ0hOSVNDSEUgVU5JVkVSU0lUQVQgQkVSTElOXHJcbipcclxuKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4qIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuKlxyXG4qICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbipcclxuKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4qIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4qIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuKiovXHJcblxyXG4vKipcclxuICogQGFjY2VzcyBwcml2YXRlXHJcbiAqIFRoaXMgY2xhc3MgaXMgcmVzcG9uc2libGUgZm9yIGNvbGxlY3RpbmcgZGVsdGEgY2hhbmdlcyBpbiByZW1vdGUgb2JqZWN0cywgYmVmb3JlIHRoZSByZXNwb25zZSBvZiBzdWJzY3JpcHRpb24gcmVhY2ggdGhlIG9ic2VydmVyLlxyXG4gKiBJdCdzIHVzZWQgaW4gU3luY2hlciAtPiBzdWJzY3JpYmUuIFRoZSBmbG93IGlzIGRlZmluZWQgYXM6XHJcbiAqIDEuIChvYnNlcnZlcikgLS1zdWJzY3JpYmUtLT4gKHJlcG9ydGVyKVxyXG4gKiAyLiAob2JzZXJ2ZXIpIDwtLWRlbHRhIHVwZGF0ZXMtLSAocmVwb3J0ZXIpXHJcbiAqIDMuIChvYnNlcnZlcikgPC0tc3Vic2NyaWJlIHJlc3BvbnNlLS0gKHJlcG9ydGVyKVxyXG4gKiBUaGlzIG1lYW5zIHRoYXQgdGhlcmUgY291bGQgYmUgZGVsdGEgdXBkYXRlcyB0cmFuc2ZlcnJlZCBiZWZvcmUgdGhlIHN1YnNjcmlwdGlvbiBjb25maXJtYXRpb24uXHJcbiAqIFNpbmNlIHRoZXJlIGlzIG5vIERhdGFPYmplY3RPYnNlcnZlciBiZWZvcmUgdGhlIHVic2NyaXB0aW9uIGNvbmZpcm1hdGlvbiwgdGhlcmUgc2hvdWxkIGJlIHNvbWUgb3RoZXIgb2JqZWN0IGNvbGxlY3RpbmcgdGhlIHVwZGF0ZXMuXHJcbiAqIFByb3Zpc2lvbmFsIGRhdGEgaXMgYXBwbGllZCB0byB0aGUgRGF0YU9iamVjdE9ic2VydmVyIGFmdGVyIGNvbmZpcm1hdGlvbi4gT3IgZGlzY2FyZGVkIGlmIHRoZXJlIGlzIG5vIGNvbmZpcm1hdGlvbi5cclxuICovXHJcblxyXG4vLyBMb2cgU3lzdGVtXHJcbmltcG9ydCAqIGFzIGxvZ2dlciBmcm9tICdsb2dsZXZlbCc7XHJcbmxldCBsb2cgPSBsb2dnZXIuZ2V0TG9nZ2VyKCdEYXRhUHJvdmlzaW9uYWwnKTtcclxuXHJcbmNsYXNzIERhdGFQcm92aXNpb25hbCB7XHJcbiAgLyogcHJpdmF0ZVxyXG4gIF9jaGlsZHJlbkxpc3RlbmVyczogW01zZ0xpc3RlbmVyXVxyXG4gIF9saXN0ZW5lcjogTXNnTGlzdGVuZXJcclxuXHJcbiAgX2NoYW5nZXM6IFtdXHJcbiAgKi9cclxuXHJcbiAgY29uc3RydWN0b3Iob3duZXIsIHVybCwgYnVzLCBjaGlsZHJlbikge1xyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuXHJcbiAgICBfdGhpcy5fb3duZXIgPSBvd25lcjtcclxuICAgIF90aGlzLl91cmwgPSB1cmw7XHJcbiAgICBfdGhpcy5fYnVzID0gYnVzO1xyXG4gICAgX3RoaXMuX2NoaWxkcmVuID0gY2hpbGRyZW47XHJcblxyXG4gICAgX3RoaXMuX2NoYW5nZXMgPSBbXTtcclxuICAgIF90aGlzLl9hbGxvY2F0ZUxpc3RlbmVycygpO1xyXG4gIH1cclxuXHJcbiAgX2FsbG9jYXRlTGlzdGVuZXJzKCkge1xyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuXHJcbiAgICBfdGhpcy5fbGlzdGVuZXIgPSBfdGhpcy5fYnVzLmFkZExpc3RlbmVyKF90aGlzLl91cmwsIChtc2cpID0+IHtcclxuICAgICAgbG9nLmxvZygnRGF0YVByb3Zpc2lvbmFsLScgKyBfdGhpcy5fdXJsICsgJy1SQ1Y6ICcsIG1zZyk7XHJcbiAgICAgIF90aGlzLl9jaGFuZ2VzLnB1c2gobXNnKTtcclxuICAgIH0pO1xyXG5cclxuICAgIC8qXHJcbiAgICBfdGhpcy5fY2hpbGRyZW5MaXN0ZW5lcnMgPSBbXTtcclxuICAgIGlmIChfdGhpcy5fY2hpbGRyZW4pIHtcclxuICAgICAgbGV0IGNoaWxkQmFzZVVSTCA9IHVybCArICcvY2hpbGRyZW4vJztcclxuICAgICAgX3RoaXMuX2NoaWxkcmVuLmZvckVhY2goKGNoaWxkKSA9PiB7XHJcbiAgICAgICAgbGV0IGNoaWxkVVJMID0gY2hpbGRCYXNlVVJMICsgY2hpbGQ7XHJcbiAgICAgICAgbGV0IGxpc3RlbmVyID0gX3RoaXMuX2J1cy5hZGRMaXN0ZW5lcihjaGlsZFVSTCwgKG1zZykgPT4ge1xyXG4gICAgICAgICAgLy9pZ25vcmUgbXNnIHNlbnQgYnkgaGltc2VsZlxyXG4gICAgICAgICAgaWYgKG1zZy5mcm9tICE9PSBvd25lcikge1xyXG4gICAgICAgICAgICBsb2cubG9nKG1zZyk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIF90aGlzLl9jaGlsZHJlbkxpc3RlbmVycy5wdXNoKGxpc3RlbmVyKTtcclxuICAgICAgfSk7XHJcbiAgICB9Ki9cclxuICB9XHJcblxyXG4gIF9yZWxlYXNlTGlzdGVuZXJzKCkge1xyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuXHJcbiAgICBfdGhpcy5fbGlzdGVuZXIucmVtb3ZlKCk7XHJcblxyXG4gICAgLypfdGhpcy5fY2hpbGRyZW5MaXN0ZW5lcnMuZm9yRWFjaCgobGlzdGVuZXIpID0+IHtcclxuICAgICAgbGlzdGVuZXIucmVtb3ZlKCk7XHJcbiAgICB9KTsqL1xyXG4gIH1cclxuXHJcbiAgZ2V0IGNoaWxkcmVuKCkgeyByZXR1cm4gdGhpcy5fY2hpbGRyZW47IH1cclxuXHJcbiAgYXBwbHkob2JzZXJ2ZXIpIHtcclxuICAgIGxldCBfdGhpcyA9IHRoaXM7XHJcbiAgICBfdGhpcy5fY2hhbmdlcy5mb3JFYWNoKChjaGFuZ2UpID0+IHtcclxuICAgICAgb2JzZXJ2ZXIuX2NoYW5nZU9iamVjdChvYnNlcnZlci5fc3luY09iaiwgY2hhbmdlKTtcclxuICAgIH0pO1xyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGRlZmF1bHQgRGF0YVByb3Zpc2lvbmFsO1xyXG4iLCIvKipcclxuKiBDb3B5cmlnaHQgMjAxNiBQVCBJbm92YcOnw6NvIGUgU2lzdGVtYXMgU0FcclxuKiBDb3B5cmlnaHQgMjAxNiBJTkVTQy1JRFxyXG4qIENvcHlyaWdodCAyMDE2IFFVT0JJUyBORVRXT1JLUyBTTFxyXG4qIENvcHlyaWdodCAyMDE2IEZSQVVOSE9GRVItR0VTRUxMU0NIQUZUIFpVUiBGT0VSREVSVU5HIERFUiBBTkdFV0FORFRFTiBGT1JTQ0hVTkcgRS5WXHJcbiogQ29weXJpZ2h0IDIwMTYgT1JBTkdFIFNBXHJcbiogQ29weXJpZ2h0IDIwMTYgRGV1dHNjaGUgVGVsZWtvbSBBR1xyXG4qIENvcHlyaWdodCAyMDE2IEFwaXplZVxyXG4qIENvcHlyaWdodCAyMDE2IFRFQ0hOSVNDSEUgVU5JVkVSU0lUQVQgQkVSTElOXHJcbipcclxuKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4qIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuKlxyXG4qICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbipcclxuKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4qIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4qIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuKiovXHJcblxyXG4vLyBMb2cgU3lzdGVtXHJcbmltcG9ydCAqIGFzIGxvZ2dlciBmcm9tICdsb2dsZXZlbCc7XHJcbmxldCBsb2cgPSBsb2dnZXIuZ2V0TG9nZ2VyKCdTeW5jaGVyJyk7XHJcblxyXG5pbXBvcnQgeyBkZWVwQ2xvbmUsIGRpdmlkZVVSTCB9IGZyb20gJy4uL3V0aWxzL3V0aWxzJztcclxuXHJcbmltcG9ydCBEYXRhT2JqZWN0UmVwb3J0ZXIgZnJvbSAnLi9EYXRhT2JqZWN0UmVwb3J0ZXInO1xyXG5pbXBvcnQgRGF0YU9iamVjdE9ic2VydmVyIGZyb20gJy4vRGF0YU9iamVjdE9ic2VydmVyJztcclxuaW1wb3J0IERhdGFQcm92aXNpb25hbCBmcm9tICcuL0RhdGFQcm92aXNpb25hbCc7XHJcblxyXG4vKipcclxuKiBUaGUgbWFpbiBjbGFzcyBmb3IgdGhlIHN5bmNoZXIgcGFja2FnZS5cclxuKiBUaGUgU3luY2hlciBpcyBhIHNpbmdsZXRvbiBjbGFzcyBwZXIgSHlwZXJ0eS9VUkwgYW5kIGl0IGlzIHRoZSBvd25lciBvZiBhbGwgY3JlYXRlZCBEYXRhIFN5bmMgT2JqZWN0cyBhY2NvcmRpbmcgdG8gdGhlIFJlcG9ydGVyIC0gT2JzZXJ2ZXIgcGF0dGVybi5cclxuKiBNYWluIGZ1bmN0aW9uYWxpdHkgaXMgdG8gY3JlYXRlIHJlcG9ydGVycyBhbmQgdG8gc3Vic2NyaWJlIHRvIGV4aXN0aW5nIG9uZXMuXHJcbiovXHJcbmNsYXNzIFN5bmNoZXIge1xyXG4gIC8qIHByaXZhdGVcclxuICBfb3duZXI6IFVSTFxyXG4gIF9idXM6IE1pbmlCdXNcclxuXHJcbiAgX3N1YlVSTDogVVJMXHJcblxyXG4gIF9yZXBvcnRlcnM6IDx1cmw6IERhdGFPYmplY3RSZXBvcnRlcj5cclxuICBfb2JzZXJ2ZXJzOiA8dXJsOiBEYXRhT2JqZWN0T2JzZXJ2ZXI+XHJcbiAgX3Byb3Zpc2lvbmFsczogPHVybDogRGF0YVByb3Zpc2lvbmFsPlxyXG5cclxuICAtLS0tZXZlbnQgaGFuZGxlcnMtLS0tXHJcbiAgX29uTm90aWZpY2F0aW9uSGFuZGxlcjogKGV2ZW50KSA9PiB2b2lkXHJcbiAgX29uUmVzdW1lOiAoZXZlbnQpID0+IHZvaWRcclxuICAqL1xyXG5cclxuICAvKipcclxuICAqIENvbnN0cnVjdG9yIHRoYXQgc2hvdWxkIGJlIHVzZWQgYnkgdGhlIEh5cGVydHkgb3duZXJcclxuICAqIEBwYXJhbSB7SHlwZXJ0eVVSTH0gb3duZXIgLSBIeXBlcnR5IFVSTCBvd25lci4gQW4gVVJMIGFsbG9jYXRlZCBieSB0aGUgcnVudGltZSB0aGF0IHVuaXF1ZWx5IGlkZW50aWZpZXMgdGhlIEh5cGVydHkuXHJcbiAgKiBAcGFyYW0ge01pbmlCdXN9IGJ1cyAtIEFuIGluc3RhbmNlIG9mIHRoZSBNaW5pQnVzIHByb3ZpZGVkIGluIHRoZSBzYW5kYm94LiBXaGVuIGFuIG9iamVjdCAoUmVwb3J0ZXIgb3IgT2JzZXJ2ZWQpIGlzIGNyZWF0ZWQsIHRoZSBTeW5jaGVyTWFuYWdlciB3aWxsIGFkZCBhIGxpc3RlbmVyIGluIHRoZSBNaW5pQnVzIHRvIHJlY2VpdmUvc2VuZCBNZXNzYWdlcyBvZiB0aGF0IG9iamVjdC5cclxuICAqIEBwYXJhbSB7SlNPTn0gY29uZmlnIC0gQ29uZmlndXJhdGlvbiBkYXRhLiBUaGUgb25seSByZXF1aXJlZCBmaWVsZCBmb3Igbm93IGlzIHRoZSBydW50aW1lVVJMLlxyXG4gICovXHJcbiAgY29uc3RydWN0b3Iob3duZXIsIGJ1cywgY29uZmlnKSB7XHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG5cclxuICAgIF90aGlzLl9vd25lciA9IG93bmVyO1xyXG4gICAgX3RoaXMuX2J1cyA9IGJ1cztcclxuXHJcbiAgICBfdGhpcy5fc3ViVVJMID0gY29uZmlnLnJ1bnRpbWVVUkwgKyAnL3NtJztcclxuICAgIF90aGlzLl9ydW50aW1lVXJsID0gY29uZmlnLnJ1bnRpbWVVUkw7XHJcblxyXG4gICAgX3RoaXMuX3AycEhhbmRsZXIgPSBjb25maWcucDJwSGFuZGxlcjtcclxuICAgIF90aGlzLl9wMnBSZXF1ZXN0ZXIgPSBjb25maWcucDJwUmVxdWVzdGVyO1xyXG5cclxuICAgIF90aGlzLl9yZXBvcnRlcnMgPSB7fTtcclxuICAgIF90aGlzLl9vYnNlcnZlcnMgPSB7fTtcclxuICAgIF90aGlzLl9wcm92aXNpb25hbHMgPSB7fTtcclxuXHJcbiAgICBidXMuYWRkTGlzdGVuZXIob3duZXIsIChtc2cpID0+IHtcclxuICAgICAgLy9pZ25vcmUgbXNnIHNlbnQgYnkgaGltc2VsZlxyXG4gICAgICBpZiAobXNnLmZyb20gIT09IG93bmVyKSB7XHJcbiAgICAgICAgbG9nLmluZm8oJ1tTeW5jaGVyXSBTeW5jaGVyLVJDVjogJywgbXNnLCBfdGhpcyk7XHJcbiAgICAgICAgc3dpdGNoIChtc2cudHlwZSkge1xyXG4gICAgICAgICAgY2FzZSAnZm9yd2FyZCc6IF90aGlzLl9vbkZvcndhcmQobXNnKTsgYnJlYWs7XHJcbiAgICAgICAgICBjYXNlICdjcmVhdGUnOiBfdGhpcy5fb25SZW1vdGVDcmVhdGUobXNnKTsgYnJlYWs7XHJcbiAgICAgICAgICBjYXNlICdkZWxldGUnOiBfdGhpcy5fb25SZW1vdGVEZWxldGUobXNnKTsgYnJlYWs7XHJcbiAgICAgICAgICBjYXNlICdleGVjdXRlJzogX3RoaXMuX29uRXhlY3V0ZShtc2cpOyBicmVhaztcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgKiBUaGUgb3duZXIgb2YgdGhlIFN5bmNoZXIgYW5kIGFsbCBjcmVhdGVkIHJlcG9ydGVycy5cclxuICAqIEB0eXBlIHtIeXBlcnR5VVJMfVxyXG4gICovXHJcbiAgZ2V0IG93bmVyKCkgeyByZXR1cm4gdGhpcy5fb3duZXI7IH1cclxuXHJcbiAgLyoqXHJcbiAgKiBBbGwgb3duZWQgcmVwb3J0ZXJzLCB0aGUgb25lcyB0aGF0IHdlcmUgY3JlYXRlZCBieSBhIGNyZWF0ZVxyXG4gICogQHR5cGUge09iamVjdDxVUkwsIERhdGFPYmplY3RSZXBvcnRlcj59XHJcbiAgKi9cclxuICBnZXQgcmVwb3J0ZXJzKCkgeyByZXR1cm4gdGhpcy5fcmVwb3J0ZXJzOyB9XHJcblxyXG4gIC8qKlxyXG4gICogQWxsIG93bmVkIG9ic2VydmVycywgdGhlIG9uZXMgdGhhdCB3ZXJlIGNyZWF0ZWQgYnkgYSBsb2NhbCBzdWJzY3JpcHRpb25cclxuICAqIEB0eXBlIHtPYmplY3Q8VVJMLCBEYXRhT2JqZWN0T2JzZXJ2ZXI+fVxyXG4gICovXHJcbiAgZ2V0IG9ic2VydmVycygpIHsgcmV0dXJuIHRoaXMuX29ic2VydmVyczsgfVxyXG5cclxuICAvKipcclxuICAqIFJlcXVlc3QgYSBEYXRhT2JqZWN0UmVwb3J0ZXIgY3JlYXRpb24uIFRoZSBVUkwgd2lsbCBiZSBiZSByZXF1ZXN0ZWQgYnkgdGhlIGFsbG9jYXRpb24gbWVjaGFuaXNtLlxyXG4gICogQHBhcmFtICB7U2NoZW1hVVJMfSBzY2hlbWEgLSBIeXBlcnR5IENhdGFsb2d1ZSBVUkwgYWRkcmVzcyB0aGF0IGNhbiBiZSB1c2VkIHRvIHJldHJpZXZlIHRoZSBKU09OLVNjaGVtYSBkZXNjcmliaW5nIHRoZSBEYXRhIE9iamVjdCBzY2hlbWFcclxuICAqIEBwYXJhbSAge0h5cGVydHlVUkxbXX0gb2JzZXJ2ZXJzIC0gTGlzdCBvZiBoeXBlcnRpZXMgdGhhdCBhcmUgcHJlLWF1dGhvcml6ZWQgZm9yIHN1YnNjcmlwdGlvblxyXG4gICogQHBhcmFtICB7SlNPTn0gaW5pdGlhbERhdGEgLSBJbml0aWFsIGRhdGEgb2YgdGhlIHJlcG9ydGVyXHJcbiAgKiBAcGFyYW0gIHtib29sZWFufSBzdG9yZSAtIChPcHRpb25hbCkgaWYgdHJ1ZSwgb2JqZWN0IHdpbGwgYmUgc3RvcmVkIGJ5IHRoZSBydW50aW1lXHJcbiAgKiBAcGFyYW0gIHtib29sZWFufSBwMnAgLSAoT3B0aW9uYWwpIGlmIHRydWUsIGRhdGEgc3luY2hyb25pc2F0aW9uIHN0cmVhbSB3aWxsIHVzZSBwMnAgY29ubmVjdGlvbiBhcyBtdWNoIGFzIHBvc3NpYmxlXHJcbiAgKiBAcGFyYW0gIHtzdHJpbmd9IG5hbWUgLSAoT3B0aW9uYWwpIHRoZSBuYW1lIG9mIHRoZSBkYXRhb2JqZWN0XHJcbiAgKiBAcGFyYW0gIHtNZXNzYWdlQm9keUlkZW50aXR5fSBpZGVudGl0eSAtIChvcHRpb25hbCkgaWRlbnRpdHkgZGF0YSB0byBiZSBhZGRlZCB0byBpZGVudGl0eSB0aGUgdXNlciByZXBvcnRlci4gVG8gYmUgdXNlZCBmb3IgbGVnYWN5IGlkZW50aXRpZXMuXHJcbiAgKiBAcGFyYW0gIHtTeW5jTWV0YWRhdGF9IGlucHV0IC0gKG9wdGlvbmFsKSBhbGwgbWV0YWRhdGEgcmVxdWlyZWQgdG8gc3VuYyB0aGUgRGF0YSBPYmplY3QuXHJcbiAgKiBAcmV0dXJuIHtQcm9taXNlPERhdGFPYmplY3RSZXBvcnRlcj59IFJldHVybiBQcm9taXNlIHRvIGEgbmV3IFJlcG9ydGVyLiBUaGUgcmVwb3J0ZXIgY2FuIGJlIGFjY2VwdGVkIG9yIHJlamVjdGVkIGJ5IHRoZSBQRVBcclxuICAqL1xyXG4gIGNyZWF0ZShzY2hlbWEsIG9ic2VydmVycywgaW5pdGlhbERhdGEsIHN0b3JlID0gZmFsc2UsIHAycCA9IGZhbHNlLCBuYW1lID0gJ25vIG5hbWUnLCBpZGVudGl0eSwgaW5wdXQpIHtcclxuXHJcbiAgICBpZiAoIXNjaGVtYSkgdGhyb3cgRXJyb3IoJ1tTeW5jaGVyIC0gQ3JlYXRlXSAtIFlvdSBuZWVkIHNwZWNpZnkgdGhlIGRhdGEgb2JqZWN0IHNjaGVtYScpO1xyXG4gICAgaWYgKCFvYnNlcnZlcnMpIHRocm93IEVycm9yKCdbU3luY2hlciAtIENyZWF0ZV0gLVRoZSBvYnNlcnZlcnMgc2hvdWxkIGJlIGRlZmluZWQnKTtcclxuXHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG4gICAgaW5wdXQgPSBpbnB1dCB8fCB7fTtcclxuICAgIGxldCBjcmVhdGVJbnB1dCAgPSBPYmplY3QuYXNzaWduKHt9LCBpbnB1dCk7XHJcblxyXG4gICAgY3JlYXRlSW5wdXQucDJwID0gcDJwO1xyXG4gICAgY3JlYXRlSW5wdXQuc3RvcmUgPSBzdG9yZTtcclxuICAgIGNyZWF0ZUlucHV0LnNjaGVtYSA9IHNjaGVtYTtcclxuICAgIGNyZWF0ZUlucHV0LmF1dGhvcmlzZSA9IG9ic2VydmVycztcclxuICAgIGNyZWF0ZUlucHV0LnAycEhhbmRsZXIgPSBfdGhpcy5fcDJwSGFuZGxlcjtcclxuICAgIGNyZWF0ZUlucHV0LnAycFJlcXVlc3RlciA9IF90aGlzLl9wMnBSZXF1ZXN0ZXI7XHJcbiAgICAoaW5pdGlhbERhdGEpID8gY3JlYXRlSW5wdXQuZGF0YSA9IGRlZXBDbG9uZShpbml0aWFsRGF0YSkgOiBjcmVhdGVJbnB1dC5kYXRhID0ge307XHJcbiAgICBjcmVhdGVJbnB1dC5uYW1lID0gbmFtZS5sZW5ndGggPT09IDAgPyAnbm8gbmFtZScgOiBuYW1lO1xyXG4gICAgY3JlYXRlSW5wdXQucmVwb3J0ZXIgPSAoaW5wdXQuaGFzT3duUHJvcGVydHkoJ3JlcG9ydGVyJykgJiYgKCh0eXBlb2YgaW5wdXQucmVwb3J0ZXIpICE9PSAnYm9vbGVhbicpKSA/IGlucHV0LnJlcG9ydGVyIDogX3RoaXMuX293bmVyO1xyXG4gICAgY3JlYXRlSW5wdXQucmVzdW1lID0gZmFsc2U7XHJcbiAgICBpZiAoaW5wdXQpIHtcclxuICAgICAgY3JlYXRlSW5wdXQubXV0dWFsID0gaW5wdXQuaGFzT3duUHJvcGVydHkoJ211dHVhbCcpID8gaW5wdXQubXV0dWFsIDogZmFsc2U7XHJcbiAgICAgIGNyZWF0ZUlucHV0Lm5hbWUgPSBpbnB1dC5oYXNPd25Qcm9wZXJ0eSgnbmFtZScpID8gaW5wdXQubmFtZSA6IGNyZWF0ZUlucHV0Lm5hbWU7XHJcbiAgICB9IGVsc2UgeyBjcmVhdGVJbnB1dC5tdXR1YWwgPSBmYWxzZTsgfVxyXG5cclxuICAgIGlmIChpbnB1dC5oYXNPd25Qcm9wZXJ0eSgncmV1c2VVUkwnKSkge1xyXG4gICAgICBjcmVhdGVJbnB1dC5yZXNvdXJjZSA9IGlucHV0LnJldXNlVVJMO1xyXG4gICAgfVxyXG5cclxuICAgIGlmIChpZGVudGl0eSkgICAgICB7IGNyZWF0ZUlucHV0LmlkZW50aXR5ID0gaWRlbnRpdHk7IH1cclxuXHJcbiAgICAvL09iamVjdC5hc3NpZ24oY3JlYXRlSW5wdXQsIHtyZXN1bWU6IGZhbHNlfSk7XHJcbiAgICAvL2RlYnVnZ2VyO1xyXG4vLyAgICBjb25zb2xlLmxvZygnW3N5bmNoZXIgLSBjcmVhdGVdIC0gY3JlYXRlIFJlcG9ydGVyIC0gY3JlYXRlSW5wdXQ6ICcsIGNyZWF0ZUlucHV0KTtcclxuXHJcbiAgICByZXR1cm4gX3RoaXMuX2NyZWF0ZShjcmVhdGVJbnB1dCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAqIFJlcXVlc3QgYSBEYXRhT2JqZWN0UmVwb3J0ZXIgY3JlYXRpb24uIFRoZSBVUkwgd2lsbCBiZSBiZSByZXF1ZXN0ZWQgYnkgdGhlIGFsbG9jYXRpb24gbWVjaGFuaXNtLlxyXG4gICogQHBhcmFtICB7T2JqZWN0fSBjcml0ZXJpYSAtIChvcHRpb25hbCkgaWRlbnRpdHkgZGF0YSB0byBiZSBhZGRlZCB0byBpZGVudGl0eSB0aGUgdXNlciByZXBvcnRlci4gVG8gYmUgdXNlZCBmb3IgbGVnYWN5IGlkZW50aXRpZXMuXHJcbiAgKiBAcmV0dXJuIHtQcm9taXNlPERhdGFPYmplY3RSZXBvcnRlcj5bXX0gUmV0dXJuIGEgcHJvbWlzZSB3aXRoIGEgbGlzdCBvZiBEYXRhT2JqZWN0UmVwb3J0ZXIgdG8gYmUgcmVzdW1lZDtcclxuICAqL1xyXG4gIHJlc3VtZVJlcG9ydGVycyhjcml0ZXJpYSkge1xyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuICAgIGxvZy5sb2coJ1tzeW5jaGVyIC0gY3JlYXRlXSAtIHJlc3VtZSBSZXBvcnRlciAtIGNyaXRlcmlhOiAnLCBjcml0ZXJpYSk7XHJcblxyXG4gICAgT2JqZWN0LmFzc2lnbihjcml0ZXJpYSwge3Jlc3VtZTogdHJ1ZX0pO1xyXG5cclxuICAgIHJldHVybiBfdGhpcy5fcmVzdW1lQ3JlYXRlKGNyaXRlcmlhKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICogUmVxdWVzdCBhIHN1YnNjcmlwdGlvbiB0byBhbiBleGlzdGVudCByZXBvcnRlciBvYmplY3QuXHJcbiAgKiBAcGFyYW0ge1NjaGVtYVVSTH0gc2NoZW1hIC0gSHlwZXJ0eSBDYXRhbG9ndWUgVVJMIGFkZHJlc3MgdGhhdCBjYW4gYmUgdXNlZCB0byByZXRyaWV2ZSB0aGUgSlNPTi1TY2hlbWEgZGVzY3JpYmluZyB0aGUgRGF0YSBPYmplY3Qgc2NoZW1hXHJcbiAgKiBAcGFyYW0ge09iamVjdFVSTH0gb2JqVVJMIC0gQWRkcmVzcyBvZiB0aGUgZXhpc3RlbnQgcmVwb3J0ZXIgb2JqZWN0IHRvIGJlIG9ic2VydmVkXHJcbiAgKiBAcGFyYW0ge0Jvb2xlYW59IFtzdG9yZT1mYWxzZV0gLSBTYXZlIHRoZSBzdWJzY3JpcHRpb24gb24gdGhlIFN5bmNoZXIgTWFuYWdlciBmb3IgZnVydGhlciByZXN1bWUgKERlZmF1bHQgaXMgZmFsc2UpXHJcbiAgKiBAcGFyYW0ge0Jvb2xlYW59IFtwMnA9ZmFsc2VdIC0gSW5mbyBhYm91dCBpZiBzaG91bGQgdXNlIHAycCBjb25uZWN0aW9uIChEZWZhdWx0IGlzIGZhbHNlKVxyXG4gICogQHBhcmFtIHtCb29sZWFufSBbbXV0dWFsPXRydWVdIC0gSW5mbyBhYm91dCBpZiBtZXNzYWdlcyBvZiB0aGlzIG9iamVjdCBzaG91bGQgYmUgZW5jcnlwdGVkIChEZWZhdWx0IGlzIHRydWUpXHJcbiAgKiBAcGFyYW0gIHtNZXNzYWdlQm9keUlkZW50aXR5fSBpZGVudGl0eSAtIChvcHRpb25hbCkgaWRlbnRpdHkgZGF0YSB0byBiZSBhZGRlZCB0byBpZGVudGl0eSB0aGUgdXNlciByZXBvcnRlci4gVG8gYmUgdXNlZCBmb3IgbGVnYWN5IGlkZW50aXRpZXMuXHJcbiAgKiBAcmV0dXJuIHtQcm9taXNlPERhdGFPYmplY3RPYnNlcnZlcj59IFJldHVybiBQcm9taXNlIHRvIGEgbmV3IG9ic2VydmVyLiBJdCdzIGFzc29jaWF0ZWQgd2l0aCB0aGUgcmVwb3J0ZXIuXHJcbiAgKi9cclxuXHJcbiAgc3Vic2NyaWJlKGlucHV0KSB7XHJcbiAgLyogIGxldCBfdGhpcyA9IHRoaXM7XHJcbiAgICBsZXQgY3JpdGVyaWEgPSB7fTtcclxuXHJcbiAgICBjcml0ZXJpYS5wMnAgPSBwMnA7XHJcbiAgICBjcml0ZXJpYS5zdG9yZSA9IHN0b3JlO1xyXG4gICAgY3JpdGVyaWEuc2NoZW1hID0gc2NoZW1hO1xyXG4gICAgY3JpdGVyaWEuZG9tYWluX3N1YnNjcmlwdGlvbiA9IGRvbWFpbl9zdWJzY3JpcHRpb247XHJcblxyXG4gICAgY3JpdGVyaWEucmVzb3VyY2UgPSBvYmpVUkw7XHJcbiAgICBpZiAoaWRlbnRpdHkpICAgICAgeyBjcml0ZXJpYS5pZGVudGl0eSA9IGlkZW50aXR5OyB9XHJcblxyXG4gICAgLy9UT0RPOiBGb3IgRnVydGhlciBTdHVkeVxyXG4gICAgY3JpdGVyaWEubXV0dWFsID0gbXV0dWFsO1xyXG5cclxuICAgIGxvZy5sb2coJ1tzeW5jaGVyIC0gc3Vic2NyaWJlXSAtIHN1YnNjcmliZSBjcml0ZXJpYTogJywgY3JpdGVyaWEpO1xyXG5cclxuICAgIE9iamVjdC5hc3NpZ24oY3JpdGVyaWEsIHtyZXN1bWU6IGZhbHNlfSk7Ki9cclxuXHJcbiAgICByZXR1cm4gdGhpcy5fc3Vic2NyaWJlKGlucHV0KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICogUmVxdWVzdCBhIHN1YnNjcmlwdGlvbiB0byBhbiBleGlzdGVudCByZXBvcnRlciBvYmplY3QuXHJcbiAgKiBAcGFyYW0ge2NyaXRlcmlhfSBjcml0ZXJpYSAtIEluZm9ybWF0aW9uIHRvIGRpc2NvdmVyeSB0aGUgb2JzZXJ2ZXIgb2JqZWN0XHJcbiAgKiBAcmV0dXJuIHtQcm9taXNlPERhdGFPYmplY3RPYnNlcnZlcj59IFJldHVybiBQcm9taXNlIHRvIGEgbmV3IG9ic2VydmVyLiBJdCdzIGFzc29jaWF0ZWQgd2l0aCB0aGUgcmVwb3J0ZXIuXHJcbiAgKi9cclxuICByZXN1bWVPYnNlcnZlcnMoY3JpdGVyaWEpIHtcclxuICAgIGxldCBfdGhpcyA9IHRoaXM7XHJcbiAgICBsZXQgX2NyaXRlcmlhID0gY3JpdGVyaWEgfHwge307XHJcblxyXG4gICAgT2JqZWN0LmFzc2lnbihfY3JpdGVyaWEsIHtyZXN1bWU6IHRydWV9KTtcclxuXHJcbiAgICByZXR1cm4gX3RoaXMuX3Jlc3VtZVN1YnNjcmliZShfY3JpdGVyaWEpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgKiBSZXF1ZXN0IGEgcmVhZCBhY3Rpb24gb24gdGhlIHJlcG9ydGVyIG9iamVjdFxyXG4gICogQHBhcmFtIHtPYmplY3RVUkx9IG9ialVSTCAtIFVSTCBvZiB0aGUgcmVwb3J0ZXIgb2JqZWN0IHRvIGJlIHJlYWRcclxuICAqIEByZXR1cm4ge1Byb21pc2U8T2JqZWN0Pn0gUmV0dXJuIFByb21pc2UgdG8gbGFzdCBhdmFpbGFibGUgZGF0YSBvZiB0aGUgcmVwb3J0ZXJcclxuICAqL1xyXG4gIHJlYWQob2JqVVJMLCBjcml0ZXJpYSkge1xyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuICAgIGNvbnNvbGUubG9nKCdbU3luY2hlci5yZWFkXSAnLCBvYmpVUkwpO1xyXG5cclxuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XHJcbiAgICAgLy8gaW4gY2FzZSB0aGUgb2JqZWN0IGlzIHN5bmNoZWQgaW4gYSByZW1vdGUgc3RvcmFnZSwgbGV0cyBzeW5jIHdpdGggaXRcclxuLy8gICAgICBpZiAoX3RoaXMuX29ic2VydmVyc1tvYmpVUkxdICYmIF90aGlzLl9vYnNlcnZlcnNbb2JqVVJMXS5tZXRhZGF0YS5oYXNPd25Qcm9wZXJ0eSgnYmFja3VwJykgJiYgX3RoaXMuX29ic2VydmVyc1tvYmpVUkxdLm1ldGFkYXRhLmJhY2t1cCkge1xyXG5cclxuICAgICAgICBsZXQgcmVhZE1zZyA9IHtcclxuICAgICAgICAgIHR5cGU6ICdyZWFkJywgZnJvbTogX3RoaXMuX293bmVyLCB0bzogX3RoaXMuX3N1YlVSTCwgXHJcbiAgICAgICAgICBib2R5OiB7IHJlc291cmNlOiBvYmpVUkx9XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgaWYgKGNyaXRlcmlhKSByZWFkTXNnLmJvZHkuY3JpdGVyaWEgPSBjcml0ZXJpYTtcclxuXHJcbiAgICAgICAgICBsZXQgY2FsbGJhY2sgPSAocmVwbHkpID0+IHtcclxuICAgICAgICAgICAgcmVzb2x2ZShyZXBseS5ib2R5LnZhbHVlKTtcclxuICAgICAgICAgIH07XHJcbiAgICBcclxuICAgICAgICAgIF90aGlzLl9idXMucG9zdE1lc3NhZ2UocmVhZE1zZywgY2FsbGJhY2ssIGZhbHNlKTtcclxuICAgIFxyXG4gLyogICAgIH0gZWxzZSB7XHJcbiAgICAgICAgX3RoaXMuX3JlYWRSZXBvcnRlcihvYmpVUkwpLnRoZW4oKHJlc3VsdCk9PiB7XHJcbiAgICAgICAgcmVzb2x2ZShyZXN1bHQpO1xyXG4gICAgICB9KTtcclxuICAgIH0qL1xyXG5cclxuICAgIH0pO1xyXG5cclxuICB9XHJcblxyXG4vKiAgX3JlYWRDYWxsQmFjayhyZXBseSwgcmVzb2x2ZSxyZWplY3QpIHtcclxuICAgIGxldCBfdGhpcyA9IHRoaXM7XHJcblxyXG4gICAgICBjb25zb2xlLmxvZygnW1N5bmNoZXIucmVhZF0gcmVwbHk6ICcsIHJlcGx5KTtcclxuXHJcbiAgICAgIGxldCBjaGlsZHJlbnMgPSB7fTtcclxuICAgICAgbGV0IHZhbHVlID0ge307XHJcbiAgICAgIGxldCBuID0gMDtcclxuXHJcbiAgICAgIGlmIChyZXBseS5ib2R5LmNvZGUgPCAzMDApIHtcclxuICAgICAgICBpZiAoIXJlcGx5LmJvZHkudmFsdWUuaGFzT3duUHJvcGVydHkoJ3Jlc3BvbnNlcycpKSB7XHJcbiAgICAgICAgICBfdGhpcy5fYnVzLnJlbW92ZVJlc3BvbnNlTGlzdGVuZXIocmVwbHkuZnJvbSwgcmVwbHkuaWQpO1xyXG4gICAgICAgICAgcmVzb2x2ZShyZXBseS5ib2R5LnZhbHVlKTtcclxuICAgICAgICB9IGVsc2UgeyAvL2RhdGEgb2JqZWN0IGlzIHNlbnQgaW4gc2VwYXJhdGVkIG1lc3NhZ2VzXHJcbiAgICAgICAgICBpZiAobiA9PT0gMCkgeyAvL2luaXRpYWwgcmVzcG9uc2Ugd2l0aG91dCBjaGlsZHJlbnNcclxuICAgICAgICAgICAgdmFsdWUgPSByZXBseS5ib2R5LnZhbHVlO1xyXG4gICAgICAgICAgICArK247XHJcbiAgICAgICAgICB9IGVsc2UgeyAvLyByZWNlaXZlZCByZXNwb25zZSBjb250YWlucyBjaGlsZHJlbnNcclxuICAgICAgICAgICAgZGVsZXRlIHJlcGx5LmJvZHkudmFsdWUucmVzcG9uc2VzO1xyXG4gICAgICAgICAgICBsZXQgY2hpbGRyZW47XHJcbiAgICAgICAgICAgIGZvciAoY2hpbGRyZW4gaW4gcmVwbHkuYm9keS52YWx1ZSkge1xyXG4gICAgICAgICAgICAgIGlmICghY2hpbGRyZW5zLmhhc093blByb3BlcnR5KGNoaWxkcmVuKSkgY2hpbGRyZW5zW2NoaWxkcmVuXSA9IHt9O1xyXG4gICAgICAgICAgICAgIE9iamVjdC5hc3NpZ24oY2hpbGRyZW5zW2NoaWxkcmVuXSwgcmVwbHkuYm9keS52YWx1ZVtjaGlsZHJlbl0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICsrbjtcclxuICAgICAgICAgICAgaWYgKG4gPT09IHZhbHVlLnJlc3BvbnNlcykge1xyXG4gICAgICAgICAgICAgIHZhbHVlLmNoaWxkcmVuT2JqZWN0cyA9IGNoaWxkcmVucztcclxuICAgICAgICAgICAgICBkZWxldGUgdmFsdWUucmVzcG9uc2VzO1xyXG4gICAgICAgICAgICAgIF90aGlzLl9idXMucmVtb3ZlUmVzcG9uc2VMaXN0ZW5lcihyZXBseS5mcm9tLCByZXBseS5pZCk7XHJcbiAgICAgICAgICAgICAgcmVzb2x2ZSh2YWx1ZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgIH0gZWxzZSB7XHJcblxyXG4gICAgICByZWplY3QocmVwbHkuYm9keS5kZXNjKTtcclxuICAgICAgfVxyXG5cclxuICB9Ki9cclxuXHJcbiAgX3JlYWRSZXBvcnRlcihvYmpVUkwpIHtcclxuICAgIGxldCBfdGhpcyA9IHRoaXM7XHJcblxyXG4gICAgLy9GTE9XLU9VVDogdGhpcyBtZXNzYWdlIHdpbGwgYmUgc2VudCBkaXJlY3RseSB0byByZXBvcnRlciBvYmplY3QgKG1heWJlIHRoZXJlIGlzIG5vIGxpc3RlbmVyIGF2YWlsYWJsZSwgc28gaXQgd2lsbCBiZSByZXNvbHZlZCB3aXRoIE1lc3NhZ2VCdXMgLT4gcmVzb2x2ZSlcclxuICAgIC8vd2lsbCByZWFjaCB0aGUgcmVtb3RlIG9iamVjdCBpbiBEYXRhT2JqZWN0UmVwb3J0ZXIgLT4gX29uUmVhZFxyXG4gICAgbGV0IHJlYWRNc2cgPSB7XHJcbiAgICAgIHR5cGU6ICdyZWFkJywgZnJvbTogX3RoaXMuX293bmVyLCB0bzogb2JqVVJMXHJcbiAgICB9O1xyXG5cclxuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XHJcblxyXG4gICAgICBfdGhpcy5fYnVzLnBvc3RNZXNzYWdlKHJlYWRNc2csIChyZXBseSkgPT4ge1xyXG4gICAgICAgIHJldHVybiBfdGhpcy5fcmVhZENhbGxCYWNrKHJlcGx5LCByZXNvbHZlLCByZWplY3QpO1xyXG4gICAgICB9LCBmYWxzZSk7XHJcblxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAqIFNldHVwIHRoZSBjYWxsYmFjayB0byBwcm9jZXNzIGNyZWF0ZSBhbmQgZGVsZXRlIGV2ZW50cyBvZiByZW1vdmUgUmVwb3J0ZXIgb2JqZWN0cy5cclxuICAqIFRoaXMgaXMgcmVsZWF0ZWQgdG8gdGhlIG1lc3NhZ2VucyBzZW50IGJ5IGNyZWF0ZSB0byB0aGUgb2JzZXJ2ZXJzIEh5cGVydHkgYXJyYXkuXHJcbiAgKiBAcGFyYW0ge2Z1bmN0aW9uKGV2ZW50OiBNc2dFdmVudCl9IGNhbGxiYWNrXHJcbiAgKi9cclxuICBvbk5vdGlmaWNhdGlvbihjYWxsYmFjaykge1xyXG4gICAgdGhpcy5fb25Ob3RpZmljYXRpb25IYW5kbGVyID0gY2FsbGJhY2s7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAqIFNldHVwIHRoZSBjYWxsYmFjayB0byBwcm9jZXNzIGNsb3NlIGV2ZW50cyBmcm9tIHRoZSBydW50aW1lLlxyXG4gICogQHBhcmFtIHtmdW5jdGlvbihldmVudDogTXNnRXZlbnQpfSBjYWxsYmFja1xyXG4gICovXHJcbiAgb25DbG9zZShjYWxsYmFjaykge1xyXG4gICAgdGhpcy5fb25DbG9zZSA9IGNhbGxiYWNrO1xyXG4gIH1cclxuXHJcbiAgX2NyZWF0ZShpbnB1dCkge1xyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuXHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xyXG5cclxuICAgICAgbGV0IHJlcG9ydGVySW5wdXQgID0gT2JqZWN0LmFzc2lnbih7fSwgaW5wdXQpO1xyXG5cclxuICAgICAgbGV0IHJlc3VtZSA9IGlucHV0LnJlc3VtZTtcclxuXHJcbiAgICAgIHJlcG9ydGVySW5wdXQuY3JlYXRlZCA9IChuZXcgRGF0ZSkudG9JU09TdHJpbmcoKTtcclxuICAgICAgcmVwb3J0ZXJJbnB1dC5ydW50aW1lID0gX3RoaXMuX3J1bnRpbWVVcmw7XHJcblxyXG4gICAgICBsZXQgcmVxdWVzdFZhbHVlID0gZGVlcENsb25lKHJlcG9ydGVySW5wdXQpO1xyXG5cclxuICAgICAgZGVsZXRlIHJlcXVlc3RWYWx1ZS5wMnA7XHJcbiAgICAgIGRlbGV0ZSByZXF1ZXN0VmFsdWUuc3RvcmU7XHJcbiAgICAgIGRlbGV0ZSByZXF1ZXN0VmFsdWUub2JzZXJ2ZXJzO1xyXG4gICAgICBkZWxldGUgcmVxdWVzdFZhbHVlLmlkZW50aXR5O1xyXG5cclxuICAgICAgLy9GTE9XLU9VVDogdGhpcyBtZXNzYWdlIHdpbGwgYmUgc2VudCB0byB0aGUgcnVudGltZSBpbnN0YW5jZSBvZiBTeW5jaGVyTWFuYWdlciAtPiBfb25DcmVhdGVcclxuICAgICAgLy9kZWJ1Z2dlcjtcclxuICAgICAgbGV0IHJlcXVlc3RNc2cgPSB7XHJcbiAgICAgICAgdHlwZTogJ2NyZWF0ZScsIGZyb206IF90aGlzLl9vd25lciwgdG86IF90aGlzLl9zdWJVUkwsXHJcbiAgICAgICAgYm9keTogeyByZXN1bWU6IHJlc3VtZSwgdmFsdWU6IHJlcXVlc3RWYWx1ZSAgfVxyXG4gICAgICB9O1xyXG5cclxuXHJcbiAgICAgIHJlcXVlc3RNc2cuYm9keS5zY2hlbWEgPSByZXBvcnRlcklucHV0LnNjaGVtYTtcclxuXHJcbiAgICAgIGlmIChyZXBvcnRlcklucHV0LnAycCkgcmVxdWVzdE1zZy5ib2R5LnAycCA9IHJlcG9ydGVySW5wdXQucDJwO1xyXG4gICAgICBpZiAocmVwb3J0ZXJJbnB1dC5zdG9yZSkgcmVxdWVzdE1zZy5ib2R5LnN0b3JlID0gcmVwb3J0ZXJJbnB1dC5zdG9yZTtcclxuICAgICAgaWYgKHJlcG9ydGVySW5wdXQuaWRlbnRpdHkpIHJlcXVlc3RNc2cuYm9keS5pZGVudGl0eSA9IHJlcG9ydGVySW5wdXQuaWRlbnRpdHk7XHJcblxyXG4gICAgICBjb25zb2xlLmxvZygnW3N5bmNoZXIuX2NyZWF0ZV06ICcsIHJlcG9ydGVySW5wdXQsIHJlcXVlc3RNc2cpO1xyXG5cclxuICAgICAgLy9yZXF1ZXN0IGNyZWF0ZSB0byB0aGUgYWxsb2NhdGlvbiBzeXN0ZW0uIENhbiBiZSByZWplY3RlZCBieSB0aGUgUG9saWN5RW5naW5lLlxyXG4gICAgICBfdGhpcy5fYnVzLnBvc3RNZXNzYWdlKHJlcXVlc3RNc2csIChyZXBseSkgPT4ge1xyXG4gICAgICAgIGxvZy5sb2coJ1tzeW5jaGVyIC0gY3JlYXRlXSAtIGNyZWF0ZS1yZXNwb25zZTogJywgcmVwbHkpO1xyXG4gICAgICAgIGlmIChyZXBseS5ib2R5LmNvZGUgPT09IDIwMCkge1xyXG4gICAgICAgICAgLy9yZXBvcnRlciBjcmVhdGlvbiBhY2NlcHRlZFxyXG4gICAgICAgICAgcmVwb3J0ZXJJbnB1dC51cmwgPSByZXBseS5ib2R5LnJlc291cmNlO1xyXG5cclxuLyogICAgICAgICAgaWYgKHJlcGx5LmJvZHkucDJwSGFuZGxlcikgcmVwb3J0ZXJJbnB1dC5wMnBIYW5kbGVyID0gcmVwbHkuYm9keS5wMnBIYW5kbGVyO1xyXG4gICAgICAgICAgaWYgKHJlcGx5LmJvZHkucDJwUmVxdWVzdGVyKSByZXBvcnRlcklucHV0LnAycFJlcXVlc3RlciA9IHJlcGx5LmJvZHkucDJwUmVxdWVzdGVyOyovXHJcblxyXG4gICAgICAgICAgcmVwb3J0ZXJJbnB1dC5zdGF0dXMgPSAnbGl2ZSc7Ly8gcGNoOiBkbyB3ZSBuZWQgdGhpcz9cclxuICAgICAgICAgIHJlcG9ydGVySW5wdXQuc3luY2hlciA9IF90aGlzO1xyXG4gICAgICAgICAgcmVwb3J0ZXJJbnB1dC5jaGlsZHJlbnMgPSByZXBseS5ib2R5LmNoaWxkcmVuUmVzb3VyY2VzO1xyXG5cclxuICAgICAgICAgIGxldCBuZXdPYmogPSBfdGhpcy5fcmVwb3J0ZXJzW3JlcG9ydGVySW5wdXQudXJsXTtcclxuXHJcbiAgICAgICAgICBpZiAoIW5ld09iaikge1xyXG4gICAgICAgICAgICBuZXdPYmogPSBuZXcgRGF0YU9iamVjdFJlcG9ydGVyKHJlcG9ydGVySW5wdXQpO1xyXG4gICAgICAgICAgICBfdGhpcy5fcmVwb3J0ZXJzW3JlcG9ydGVySW5wdXQudXJsXSA9IG5ld09iajtcclxuICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICBuZXdPYmouaW52aXRlT2JzZXJ2ZXJzKGlucHV0LmF1dGhvcmlzZSwgaW5wdXQucDJwKTtcclxuXHJcbiAgICAgICAgICByZXNvbHZlKG5ld09iaik7XHJcblxyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAvL3JlcG9ydGVyIGNyZWF0aW9uIHJlamVjdGVkXHJcbiAgICAgICAgICByZWplY3QocmVwbHkuYm9keS5kZXNjKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG4gICAgfSk7XHJcblxyXG4gIH1cclxuXHJcbiAgX3Jlc3VtZUNyZWF0ZShjcml0ZXJpYSkge1xyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuXHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xyXG4gICAgICBsZXQgcmVzdW1lID0gY3JpdGVyaWEucmVzdW1lO1xyXG5cclxuICAgICAgLy9GTE9XLU9VVDogdGhpcyBtZXNzYWdlIHdpbGwgYmUgc2VudCB0byB0aGUgcnVudGltZSBpbnN0YW5jZSBvZiBTeW5jaGVyTWFuYWdlciAtPiBfb25DcmVhdGVcclxuICAgICAgbGV0IHJlcXVlc3RNc2cgPSB7XHJcbiAgICAgICAgdHlwZTogJ2NyZWF0ZScsIGZyb206IF90aGlzLl9vd25lciwgdG86IF90aGlzLl9zdWJVUkwsXHJcbiAgICAgICAgYm9keTogeyByZXN1bWU6IHJlc3VtZSB9XHJcbiAgICAgIH07XHJcblxyXG4gICAgICBsb2cubG9nKCdbc3luY2hlciAtIGNyZWF0ZV06ICcsIGNyaXRlcmlhLCByZXF1ZXN0TXNnKTtcclxuICAgICAgaWYgKGNyaXRlcmlhKSB7XHJcbiAgICAgICAgcmVxdWVzdE1zZy5ib2R5LnZhbHVlID0gY3JpdGVyaWE7XHJcbiAgICAgICAgaWYgKGNyaXRlcmlhLmhhc093blByb3BlcnR5KCdyZXBvcnRlcicpKSB7XHJcbiAgICAgICAgICByZXF1ZXN0TXNnLmJvZHkudmFsdWUucmVwb3J0ZXIgPSBjcml0ZXJpYS5yZXBvcnRlcjtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgcmVxdWVzdE1zZy5ib2R5LnZhbHVlLnJlcG9ydGVyID0gX3RoaXMuX293bmVyO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG5cclxuICAgICAgaWYgKGNyaXRlcmlhLnAycCkgcmVxdWVzdE1zZy5ib2R5LnAycCA9IGNyaXRlcmlhLnAycDtcclxuICAgICAgaWYgKGNyaXRlcmlhLnN0b3JlKSByZXF1ZXN0TXNnLmJvZHkuc3RvcmUgPSBjcml0ZXJpYS5zdG9yZTtcclxuICAgICAgaWYgKGNyaXRlcmlhLm9ic2VydmVycykgcmVxdWVzdE1zZy5ib2R5LmF1dGhvcmlzZSA9IGNyaXRlcmlhLm9ic2VydmVycztcclxuICAgICAgaWYgKGNyaXRlcmlhLmlkZW50aXR5KSByZXF1ZXN0TXNnLmJvZHkuaWRlbnRpdHkgPSBjcml0ZXJpYS5pZGVudGl0eTtcclxuXHJcbiAgICAgIGxvZy5sb2coJ1tzeW5jaGVyLl9yZXN1bWVDcmVhdGVdIC0gcmVzdW1lIG1lc3NhZ2U6ICcsIHJlcXVlc3RNc2cpO1xyXG5cclxuICAgICAgLy9kZWJ1Z2dlcjtcclxuXHJcbiAgICAgIC8vcmVxdWVzdCBjcmVhdGUgdG8gdGhlIGFsbG9jYXRpb24gc3lzdGVtLiBDYW4gYmUgcmVqZWN0ZWQgYnkgdGhlIFBvbGljeUVuZ2luZS5cclxuXHJcbiAgICAgIF90aGlzLl9idXMucG9zdE1lc3NhZ2UocmVxdWVzdE1zZywgKHJlcGx5KSA9PiB7XHJcbiAgICAgICAgbG9nLmxvZygnW3N5bmNoZXIuX3Jlc3VtZUNyZWF0ZV0gLSBjcmVhdGUtcmVzdW1lZC1yZXNwb25zZTogJywgcmVwbHkpO1xyXG4gICAgICAgIGlmIChyZXBseS5ib2R5LmNvZGUgPT09IDIwMCkge1xyXG4gICAgICAgICAgLy9kZWJ1Z2dlcjtcclxuICAgICAgICAgIGxldCBsaXN0T2ZSZXBvcnRlcnMgPSByZXBseS5ib2R5LnZhbHVlO1xyXG5cclxuICAgICAgICAgIGZvciAobGV0IGluZGV4IGluIGxpc3RPZlJlcG9ydGVycykge1xyXG5cclxuICAgICAgICAgICAgbGV0IGRhdGFPYmplY3QgPSBsaXN0T2ZSZXBvcnRlcnNbaW5kZXhdO1xyXG5cclxuICAgICAgICAgICAgLy9yZXBvcnRlciBjcmVhdGlvbiBhY2NlcHRlZFxyXG5cclxuICAgICAgICAgICAgZGF0YU9iamVjdC5kYXRhID0gZGVlcENsb25lKGRhdGFPYmplY3QuZGF0YSkgfHwge307XHJcblxyXG4gICAgICAgICAgICBpZiAoZGF0YU9iamVjdC5jaGlsZHJlbk9iamVjdHMpIHsgZGF0YU9iamVjdC5jaGlsZHJlbk9iamVjdHMgPSBkZWVwQ2xvbmUoZGF0YU9iamVjdC5jaGlsZHJlbk9iamVjdHMpOyB9XHJcblxyXG4gICAgICAgICAgICBkYXRhT2JqZWN0Lm11dHVhbCA9IGZhbHNlO1xyXG4gICAgICAgICAgICBkYXRhT2JqZWN0LnJlc3VtZSA9IHRydWU7XHJcbiAgICAgICAgICAgIGRhdGFPYmplY3Quc3RhdHVzID0gJ2xpdmUnOy8vIHBjaDogZG8gd2UgbmVkIHRoaXM/XHJcbiAgICAgICAgICAgIGRhdGFPYmplY3Quc3luY2hlciA9IF90aGlzO1xyXG5cclxuICAgICAgICAgICAgbG9nLmxvZygnW3N5bmNoZXIuX3Jlc3VtZUNyZWF0ZV0gLSBjcmVhdGUtcmVzdW1lZC1kYXRhT2JqZWN0UmVwb3J0ZXInLCBkYXRhT2JqZWN0KTtcclxuXHJcbiAgICAgICAgICAgIGxldCBuZXdPYmogPSBuZXcgRGF0YU9iamVjdFJlcG9ydGVyKGRhdGFPYmplY3QpO1xyXG5cclxuICAgICAgICAgICAgaWYgKGRhdGFPYmplY3QuY2hpbGRyZW5PYmplY3RzKSB7XHJcbiAgICAgICAgICAgICAgbmV3T2JqLnJlc3VtZUNoaWxkcmVucyhkYXRhT2JqZWN0LmNoaWxkcmVuT2JqZWN0cyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgX3RoaXMuX3JlcG9ydGVyc1tkYXRhT2JqZWN0LnVybF0gPSBuZXdPYmo7XHJcblxyXG4gICAgICAgICAgfVxyXG5cclxuICAgICAgICAgIHJlc29sdmUoX3RoaXMuX3JlcG9ydGVycyk7XHJcbiAgICAgICAgICBpZiAodGhpcy5fb25SZXBvcnRlcnNSZXN1bWUpIHRoaXMuX29uUmVwb3J0ZXJzUmVzdW1lKHRoaXMuX3JlcG9ydGVycyk7XHJcblxyXG4gICAgICAgIH0gZWxzZSBpZiAocmVwbHkuYm9keS5jb2RlID09PSA0MDQpIHtcclxuICAgICAgICAgIHJlc29sdmUoe30pO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAvL3JlcG9ydGVyIGNyZWF0aW9uIHJlamVjdGVkXHJcbiAgICAgICAgICByZWplY3QocmVwbHkuYm9keS5kZXNjKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBfc3Vic2NyaWJlKGlucHV0KSB7XHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG5cclxuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XHJcblxyXG4gICAgICAvL0ZMT1ctT1VUOiB0aGlzIG1lc3NhZ2Ugd2lsbCBiZSBzZW50IHRvIHRoZSBydW50aW1lIGluc3RhbmNlIG9mIFN5bmNoZXJNYW5hZ2VyIC0+IF9vbkxvY2FsU3Vic2NyaWJlXHJcbiAgICAgIGxldCBzdWJzY3JpYmVNc2cgPSB7XHJcbiAgICAgICAgdHlwZTogJ3N1YnNjcmliZScsIGZyb206IF90aGlzLl9vd25lciwgdG86IF90aGlzLl9zdWJVUkwsXHJcbiAgICAgICAgYm9keTogaW5wdXRcclxuICAgICAgfTtcclxuXHJcbiAgICAgIC8vIEh5cGVydHkgcmVxdWVzdCB0byBiZSBhbiBPYnNlcnZlclxyXG4gICAgICAvLyBodHRwczovL2dpdGh1Yi5jb20vcmVUSElOSy1wcm9qZWN0L3NwZWNzL2Jsb2IvbWFzdGVyL21lc3NhZ2VzL2RhdGEtc3luYy1tZXNzYWdlcy5tZCNoeXBlcnR5LXJlcXVlc3QtdG8tYmUtYW4tb2JzZXJ2ZXJcclxuXHJcbiAgICAgIC8vIFJlc3VtZSBTdWJzY3JpcHRpb25zIGZvciB0aGUgc2FtZSBIeXBlcnR5IFVSTFxyXG4gICAgICAvLyBodHRwczovL2dpdGh1Yi5jb20vcmVUSElOSy1wcm9qZWN0L3NwZWNzL2Jsb2IvbWFzdGVyL21lc3NhZ2VzL2RhdGEtc3luYy1tZXNzYWdlcy5tZCNyZXN1bWUtc3Vic2NyaXB0aW9ucy1mb3ItdGhlLXNhbWUtaHlwZXJ0eS11cmxcclxuXHJcbiAgICAgIC8vIFJlc3VtZSBTdWJzY3JpcHRpb25zIGZvciBhIGNlcnRhaW4gdXNlciBhbmQgZGF0YSBzY2hlbWEgaW5kZXBlbmRlbnRseSBvZiB0aGUgSHlwZXJ0eSBVUkwuXHJcbiAgICAgIC8vIGh0dHBzOi8vZ2l0aHViLmNvbS9yZVRISU5LLXByb2plY3Qvc3BlY3MvYmxvYi9tYXN0ZXIvbWVzc2FnZXMvZGF0YS1zeW5jLW1lc3NhZ2VzLm1kI3Jlc3VtZS1zdWJzY3JpcHRpb25zLWZvci1hLWNlcnRhaW4tdXNlci1hbmQtZGF0YS1zY2hlbWEtaW5kZXBlbmRlbnRseS1vZi10aGUtaHlwZXJ0eS11cmxcclxuLyogICAgICBpZiAoaW5wdXQpIHtcclxuICAgICAgICBpZiAoaW5wdXQuaGFzT3duUHJvcGVydHkoJ3AycCcpKSBzdWJzY3JpYmVNc2cuYm9keS5wMnAgPSBpbnB1dC5wMnA7XHJcbiAgICAgICAgaWYgKGlucHV0Lmhhc093blByb3BlcnR5KCdzdG9yZScpKSBzdWJzY3JpYmVNc2cuYm9keS5zdG9yZSA9IGlucHV0LnN0b3JlO1xyXG4gICAgICAgIGlmIChpbnB1dC5oYXNPd25Qcm9wZXJ0eSgnc2NoZW1hJykpIHN1YnNjcmliZU1zZy5ib2R5LnNjaGVtYSA9IGlucHV0LnNjaGVtYTtcclxuICAgICAgICBpZiAoaW5wdXQuaGFzT3duUHJvcGVydHkoJ2lkZW50aXR5JykpIHN1YnNjcmliZU1zZy5ib2R5LmlkZW50aXR5ID0gaW5wdXQuaWRlbnRpdHk7XHJcbiAgICAgICAgaWYgKGlucHV0Lmhhc093blByb3BlcnR5KCdyZXNvdXJjZScpKSBzdWJzY3JpYmVNc2cuYm9keS5yZXNvdXJjZSA9IGlucHV0LnJlc291cmNlO1xyXG4gICAgICAgIGlmIChpbnB1dC5oYXNPd25Qcm9wZXJ0eSgnZG9tYWluX3N1YnNjcmlwdGlvbicpKSBzdWJzY3JpYmVNc2cuYm9keS5kb21haW5fc3Vic2NyaXB0aW9uID0gaW5wdXQuZG9tYWluX3N1YnNjcmlwdGlvbjtcclxuICAgICAgfVxyXG4gICAgICBcclxuXHJcbiAgICAgIHN1YnNjcmliZU1zZy5ib2R5LnJlc3VtZSA9IGlucHV0LnJlc3VtZTtcclxuXHJcbiAgICAgIC8vVE9ETzogRm9yIEZ1cnRoZXIgU3R1ZHlcclxuICAgICAgaWYgKGlucHV0Lmhhc093blByb3BlcnR5KCdtdXR1YWwnKSkgc3Vic2NyaWJlTXNnLmJvZHkubXV0dWFsID0gaW5wdXQubXV0dWFsOyovXHJcblxyXG4gICAgICBsb2cubG9nKCdbc3luY2hlcl9zdWJzY3JpYmVdIC0gc3Vic2NyaWJlIG1lc3NhZ2U6ICcsIGlucHV0LCBzdWJzY3JpYmVNc2cpO1xyXG5cclxuICAgICAgLy9yZXF1ZXN0IHN1YnNjcmlwdGlvblxyXG4gICAgICAvL1Byb3Zpc2lvbmFsIGRhdGEgaXMgYXBwbGllZCB0byB0aGUgRGF0YU9iamVjdE9ic2VydmVyIGFmdGVyIGNvbmZpcm1hdGlvbi4gT3IgZGlzY2FyZGVkIGlmIHRoZXJlIGlzIG5vIGNvbmZpcm1hdGlvbi5cclxuICAgICAgLy9mb3IgbW9yZSBpbmZvIHNlZSB0aGUgRGF0YVByb3Zpc2lvbmFsIGNsYXNzIGRvY3VtZW50YXRpb24uXHJcbiAgICAgIGxldCBtc2dJZCA9IF90aGlzLl9idXMucG9zdE1lc3NhZ2Uoc3Vic2NyaWJlTXNnKTtcclxuXHJcbiAgICAgIF90aGlzLl9idXMuYWRkUmVzcG9uc2VMaXN0ZW5lcihfdGhpcy5fb3duZXIsIG1zZ0lkLCAgKHJlcGx5KSA9PiB7XHJcblxyXG4gICAgICAgIGxvZy5sb2coJ1tzeW5jaGVyXSAtIHN1YnNjcmliZS1yZXNwb25zZTogJywgcmVwbHkpO1xyXG5cclxuICAgICAgICBsZXQgb2JqVVJMID0gcmVwbHkuYm9keS5yZXNvdXJjZTtcclxuXHJcbiAgICAgICAgbGV0IG5ld1Byb3Zpc2lvbmFsID0gX3RoaXMuX3Byb3Zpc2lvbmFsc1tvYmpVUkxdO1xyXG4gICAgICAgIGRlbGV0ZSBfdGhpcy5fcHJvdmlzaW9uYWxzW29ialVSTF07XHJcbiAgICAgICAgaWYgKG5ld1Byb3Zpc2lvbmFsKSBuZXdQcm92aXNpb25hbC5fcmVsZWFzZUxpc3RlbmVycygpO1xyXG5cclxuICAgICAgICBpZiAocmVwbHkuYm9keS5jb2RlIDwgMjAwKSB7XHJcbiAgICAgICAgICBsb2cubG9nKCdbc3luY2hlcl0gLSBuZXcgRGF0YVByb3Zpc2lvbmFsOiAnLCByZXBseS5ib2R5LmNoaWxkcmVuUmVzb3VyY2VzLCBvYmpVUkwpO1xyXG4gICAgICAgICAgbmV3UHJvdmlzaW9uYWwgPSBuZXcgRGF0YVByb3Zpc2lvbmFsKF90aGlzLl9vd25lciwgb2JqVVJMLCBfdGhpcy5fYnVzLCByZXBseS5ib2R5LmNoaWxkcmVuUmVzb3VyY2VzKTtcclxuICAgICAgICAgIF90aGlzLl9wcm92aXNpb25hbHNbb2JqVVJMXSA9IG5ld1Byb3Zpc2lvbmFsO1xyXG4gICAgICAgIH0gZWxzZSBpZiAocmVwbHkuYm9keS5jb2RlID09PSAyMDApIHtcclxuICAgICAgICAgIGxvZy5sb2coJ1tzeW5jaGVyXSAtIG5ldyBEYXRhIE9iamVjdCBPYnNlcnZlcjogJywgcmVwbHksIF90aGlzLl9wcm92aXNpb25hbHMpO1xyXG5cclxuICAgICAgICAgIGxldCBvYnNlcnZlcklucHV0ID0gcmVwbHkuYm9keS52YWx1ZTtcclxuXHJcbiAgICAgICAgICBvYnNlcnZlcklucHV0LnN5bmNoZXIgPSBfdGhpcztcclxuICAgICAgICAgIG9ic2VydmVySW5wdXQucDJwID0gaW5wdXQucDJwO1xyXG4gICAgICAgICAgb2JzZXJ2ZXJJbnB1dC5zdG9yZSA9IGlucHV0LnN0b3JlO1xyXG4gICAgICAgICAgb2JzZXJ2ZXJJbnB1dC5pZGVudGl0eSA9IGlucHV0LmlkZW50aXR5O1xyXG4gICAgICAgICAgb2JzZXJ2ZXJJbnB1dC5yZXN1bWUgPSBmYWxzZTtcclxuXHJcbiAgICAgICAgICAvLyB0b2RvOiBGb3IgRnVydGhlciBTdHVkeVxyXG4gICAgICAgICAgb2JzZXJ2ZXJJbnB1dC5tdXR1YWwgPSBpbnB1dC5tdXR1YWw7XHJcblxyXG4gICAgICAgICAgLy9vYnNlcnZlcklucHV0LmNoaWxkcmVuID0gbmV3UHJvdmlzaW9uYWwuY2hpbGRyZW47XHJcblxyXG4gICAgICAgICAgLy9UT0RPOiBtdXR1YWwgRm9yIEZ1cnRoZXIgU3R1ZHlcclxuICAgICAgICAgIGxldCBuZXdPYmogPSBfdGhpcy5fb2JzZXJ2ZXJzW29ialVSTF07XHJcbiAgICAgICAgICBpZiAoIW5ld09iaikge1xyXG4gICAgICAgICAgICBuZXdPYmogPSBuZXcgRGF0YU9iamVjdE9ic2VydmVyKG9ic2VydmVySW5wdXQpO1xyXG4gICAgICAgICAgICBfdGhpcy5fb2JzZXJ2ZXJzW29ialVSTF0gPSBuZXdPYmo7XHJcbiAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBuZXdPYmouc3luYygpO1xyXG4gICAgICAgICAgfVxyXG5cclxuICAgICAgICAgIGxvZy5sb2coJ1tzeW5jaGVyXSAtIG5ldyBEYXRhIE9iamVjdCBPYnNlcnZlciBhbHJlYWR5IGV4aXN0OiAnLCBuZXdPYmopO1xyXG5cclxuICAgICAgICAgIF90aGlzLl9idXMucmVtb3ZlUmVzcG9uc2VMaXN0ZW5lcihfdGhpcy5fb3duZXIsIG1zZ0lkKTtcclxuICAgICAgICAgIHJlc29sdmUobmV3T2JqKTtcclxuXHJcbiAgICAgICAgICBpZiAobmV3UHJvdmlzaW9uYWwpIHsgbmV3UHJvdmlzaW9uYWwuYXBwbHkobmV3T2JqKTsgfVxyXG5cclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgX3RoaXMuX2J1cy5yZW1vdmVSZXNwb25zZUxpc3RlbmVyKF90aGlzLl9vd25lciwgbXNnSWQpO1xyXG4gICAgICAgICAgcmVqZWN0KHJlcGx5LmJvZHkuZGVzYyk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KTtcclxuICAgIH0pO1xyXG4gIH1cclxuLypcclxuICBfcHJvY2Vzc09mZmxpbmVTdWJzY3JpcHRpb24oc3Vic2NyaXB0aW9uLCByZWRpcmVjdFRvKSB7XHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG5cclxuICAgIGxldCBmb3J3YXJkID0ge1xyXG4gICAgICBmcm9tOiBzdWJzY3JpcHRpb24uZnJvbSxcclxuICAgICAgdHlwZTogJ2ZvcndhcmQnLFxyXG4gICAgICB0bzogcmVkaXJlY3RUbyxcclxuICAgICAgYm9keTogc3Vic2NyaXB0aW9uXHJcbiAgICB9O1xyXG5cclxuICAgIGNvbnNvbGUubG9nKCdbU3luY2hlci5fcHJvY2Vzc09mZmxpbmVTdWJzY3JpcHRpb25dIGZvcndhZGluZyAnLCBmb3J3YXJkKTtcclxuXHJcbiAgICBfdGhpcy5fYnVzLnBvc3RNZXNzYWdlKGZvcndhcmQpO1xyXG5cclxuICAgIGxldCByZXN1bHQgPSB7XHJcbiAgICAgIGNvZGU6IDMwMixcclxuICAgICAgZGVzYzogXCJGb3VuZCBcIiArIHJlZGlyZWN0VG9cclxuICAgIH07XHJcblxyXG4gICAgcmV0dXJuKHJlc3VsdCk7XHJcblxyXG4gIH0qL1xyXG5cclxuXHJcbiAgX3Jlc3VtZVN1YnNjcmliZShjcml0ZXJpYSkge1xyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuXHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xyXG5cclxuICAgICAgLy9GTE9XLU9VVDogdGhpcyBtZXNzYWdlIHdpbGwgYmUgc2VudCB0byB0aGUgcnVudGltZSBpbnN0YW5jZSBvZiBTeW5jaGVyTWFuYWdlciAtPiBfb25Mb2NhbFN1YnNjcmliZVxyXG4gICAgICBsZXQgc3Vic2NyaWJlTXNnID0ge1xyXG4gICAgICAgIHR5cGU6ICdzdWJzY3JpYmUnLCBmcm9tOiBfdGhpcy5fb3duZXIsIHRvOiBfdGhpcy5fc3ViVVJMLFxyXG4gICAgICAgIGJvZHk6IHt9XHJcbiAgICAgIH07XHJcblxyXG4gICAgICAvLyBIeXBlcnR5IHJlcXVlc3QgdG8gYmUgYW4gT2JzZXJ2ZXJcclxuICAgICAgLy8gaHR0cHM6Ly9naXRodWIuY29tL3JlVEhJTkstcHJvamVjdC9zcGVjcy9ibG9iL21hc3Rlci9tZXNzYWdlcy9kYXRhLXN5bmMtbWVzc2FnZXMubWQjaHlwZXJ0eS1yZXF1ZXN0LXRvLWJlLWFuLW9ic2VydmVyXHJcblxyXG4gICAgICAvLyBSZXN1bWUgU3Vic2NyaXB0aW9ucyBmb3IgdGhlIHNhbWUgSHlwZXJ0eSBVUkxcclxuICAgICAgLy8gaHR0cHM6Ly9naXRodWIuY29tL3JlVEhJTkstcHJvamVjdC9zcGVjcy9ibG9iL21hc3Rlci9tZXNzYWdlcy9kYXRhLXN5bmMtbWVzc2FnZXMubWQjcmVzdW1lLXN1YnNjcmlwdGlvbnMtZm9yLXRoZS1zYW1lLWh5cGVydHktdXJsXHJcblxyXG4gICAgICAvLyBSZXN1bWUgU3Vic2NyaXB0aW9ucyBmb3IgYSBjZXJ0YWluIHVzZXIgYW5kIGRhdGEgc2NoZW1hIGluZGVwZW5kZW50bHkgb2YgdGhlIEh5cGVydHkgVVJMLlxyXG4gICAgICAvLyBodHRwczovL2dpdGh1Yi5jb20vcmVUSElOSy1wcm9qZWN0L3NwZWNzL2Jsb2IvbWFzdGVyL21lc3NhZ2VzL2RhdGEtc3luYy1tZXNzYWdlcy5tZCNyZXN1bWUtc3Vic2NyaXB0aW9ucy1mb3ItYS1jZXJ0YWluLXVzZXItYW5kLWRhdGEtc2NoZW1hLWluZGVwZW5kZW50bHktb2YtdGhlLWh5cGVydHktdXJsXHJcbiAgICAgIGlmIChjcml0ZXJpYSkge1xyXG4gICAgICAgIGlmIChjcml0ZXJpYS5oYXNPd25Qcm9wZXJ0eSgncDJwJykpIHN1YnNjcmliZU1zZy5ib2R5LnAycCA9IGNyaXRlcmlhLnAycDtcclxuICAgICAgICBpZiAoY3JpdGVyaWEuaGFzT3duUHJvcGVydHkoJ3N0b3JlJykpIHN1YnNjcmliZU1zZy5ib2R5LnN0b3JlID0gY3JpdGVyaWEuc3RvcmU7XHJcbiAgICAgICAgaWYgKGNyaXRlcmlhLmhhc093blByb3BlcnR5KCdzY2hlbWEnKSkgc3Vic2NyaWJlTXNnLmJvZHkuc2NoZW1hID0gY3JpdGVyaWEuc2NoZW1hO1xyXG4gICAgICAgIGlmIChjcml0ZXJpYS5oYXNPd25Qcm9wZXJ0eSgnaWRlbnRpdHknKSkgc3Vic2NyaWJlTXNnLmJvZHkuaWRlbnRpdHkgPSBjcml0ZXJpYS5pZGVudGl0eTtcclxuICAgICAgICBpZiAoY3JpdGVyaWEuaGFzT3duUHJvcGVydHkoJ3Jlc291cmNlJykpIHN1YnNjcmliZU1zZy5ib2R5LnJlc291cmNlID0gY3JpdGVyaWEucmVzb3VyY2U7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIHN1YnNjcmliZU1zZy5ib2R5LnJlc3VtZSA9IGNyaXRlcmlhLnJlc3VtZTtcclxuXHJcbiAgICAgIC8vVE9ETzogRm9yIEZ1cnRoZXIgU3R1ZHlcclxuICAgICAgbGV0IG11dHVhbCA9IGNyaXRlcmlhLm11dHVhbDtcclxuICAgICAgaWYgKGNyaXRlcmlhLmhhc093blByb3BlcnR5KCdtdXR1YWwnKSkgc3Vic2NyaWJlTXNnLmJvZHkubXV0dWFsID0gbXV0dWFsO1xyXG5cclxuICAgICAgY29uc29sZS5sb2coJ1tzeW5jaGVyXSAtIHN1YnNjcmliZSBtZXNzYWdlOiAnLCBjcml0ZXJpYSwgc3Vic2NyaWJlTXNnKTtcclxuXHJcbiAgICAgIC8vcmVxdWVzdCBzdWJzY3JpcHRpb25cclxuICAgICAgLy9Qcm92aXNpb25hbCBkYXRhIGlzIGFwcGxpZWQgdG8gdGhlIERhdGFPYmplY3RPYnNlcnZlciBhZnRlciBjb25maXJtYXRpb24uIE9yIGRpc2NhcmRlZCBpZiB0aGVyZSBpcyBubyBjb25maXJtYXRpb24uXHJcbiAgICAgIC8vZm9yIG1vcmUgaW5mbyBzZWUgdGhlIERhdGFQcm92aXNpb25hbCBjbGFzcyBkb2N1bWVudGF0aW9uLlxyXG4gICAgICBfdGhpcy5fYnVzLnBvc3RNZXNzYWdlKHN1YnNjcmliZU1zZywgKHJlcGx5KSA9PiB7XHJcbiAgICAgICAgY29uc29sZS5sb2coJ1tzeW5jaGVyXSAtIHN1YnNjcmliZS1yZXN1bWVkLXJlc3BvbnNlOiAnLCByZXBseSk7XHJcblxyXG4gICAgICAgIGxldCBvYmpVUkwgPSByZXBseS5ib2R5LnJlc291cmNlO1xyXG5cclxuICAgICAgICBsZXQgbmV3UHJvdmlzaW9uYWwgPSBfdGhpcy5fcHJvdmlzaW9uYWxzW29ialVSTF07XHJcbiAgICAgICAgZGVsZXRlIF90aGlzLl9wcm92aXNpb25hbHNbb2JqVVJMXTtcclxuICAgICAgICBpZiAobmV3UHJvdmlzaW9uYWwpIG5ld1Byb3Zpc2lvbmFsLl9yZWxlYXNlTGlzdGVuZXJzKCk7XHJcblxyXG4gICAgICAgIGlmIChyZXBseS5ib2R5LmNvZGUgPCAyMDApIHsgLy8gdG9kbzogY2hlY2sgaWYgdGhpcyBpcyBuZWVkZWQgZm9yIHRoZSByZXN1bWVcclxuXHJcbiAgICAgICAgICBsb2cubG9nKCdbc3luY2hlcl0gLSByZXN1bWUgbmV3IERhdGFQcm92aXNpb25hbDogJywgcmVwbHksIG9ialVSTCk7XHJcbiAgICAgICAgICBuZXdQcm92aXNpb25hbCA9IG5ldyBEYXRhUHJvdmlzaW9uYWwoX3RoaXMuX293bmVyLCBvYmpVUkwsIF90aGlzLl9idXMsIHJlcGx5LmJvZHkuY2hpbGRyZW5SZXNvdXJjZXMpO1xyXG4gICAgICAgICAgX3RoaXMuX3Byb3Zpc2lvbmFsc1tvYmpVUkxdID0gbmV3UHJvdmlzaW9uYWw7XHJcblxyXG4gICAgICAgIH0gZWxzZSBpZiAocmVwbHkuYm9keS5jb2RlID09PSAyMDApIHtcclxuXHJcbiAgICAgICAgICBsZXQgbGlzdE9mT2JzZXJ2ZXJzID0gcmVwbHkuYm9keS52YWx1ZTtcclxuXHJcbiAgICAgICAgICBmb3IgKGxldCBpbmRleCBpbiBsaXN0T2ZPYnNlcnZlcnMpIHtcclxuXHJcbiAgICAgICAgICAgIGxldCBkYXRhT2JqZWN0ID0gbGlzdE9mT2JzZXJ2ZXJzW2luZGV4XTtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coJ1tzeW5jaGVyXSAtIFJlc3VtZSBPYmplY3QgT2JzZXJ2ZXI6ICcsIHJlcGx5LCBkYXRhT2JqZWN0LCBfdGhpcy5fcHJvdmlzaW9uYWxzKTtcclxuXHJcbiAgICAgICAgICAgIGlmIChkYXRhT2JqZWN0LmNoaWxkcmVuT2JqZWN0cykgeyBkYXRhT2JqZWN0LmNoaWxkcmVuT2JqZWN0cyA9IGRlZXBDbG9uZShkYXRhT2JqZWN0LmNoaWxkcmVuT2JqZWN0cyk7IH1cclxuXHJcbiAgICAgICAgICAgIGRhdGFPYmplY3QuZGF0YSA9IGRlZXBDbG9uZShkYXRhT2JqZWN0LmRhdGEpIHx8IHt9O1xyXG4gICAgICAgICAgICBkYXRhT2JqZWN0LnJlc3VtZSA9IHRydWU7XHJcbiAgICAgICAgICAgIGRhdGFPYmplY3Quc3luY2hlciA9IF90aGlzO1xyXG5cclxuICAgICAgICAgICAgLy9UT0RPOiBtdXR1YWwgRm9yIEZ1cnRoZXIgU3R1ZHlcclxuICAgICAgICAgICAgY29uc29sZS5sb2coJ1tzeW5jaGVyLl9yZXN1bWVTdWJzY3JpYmVdIC0gY3JlYXRlIG5ldyBkYXRhT2JqZWN0OiAnLCBkYXRhT2JqZWN0KTtcclxuICAgICAgICAgICAgbGV0IG5ld09iaiA9IG5ldyBEYXRhT2JqZWN0T2JzZXJ2ZXIoZGF0YU9iamVjdCk7XHJcblxyXG4gICAgICAgICAgICBpZiAoZGF0YU9iamVjdC5jaGlsZHJlbk9iamVjdHMpIHsgbmV3T2JqLnJlc3VtZUNoaWxkcmVucyhkYXRhT2JqZWN0LmNoaWxkcmVuT2JqZWN0cyk7IH1cclxuICAgICAgICAgICAgbG9nLmxvZygnW3N5bmNoZXIuX3Jlc3VtZVN1YnNjcmliZV0gLSBuZXcgZGF0YU9iamVjdCcsIG5ld09iaik7XHJcbiAgICAgICAgICAgIF90aGlzLl9vYnNlcnZlcnNbbmV3T2JqLnVybF0gPSBuZXdPYmo7XHJcblxyXG4gICAgICAgICAgICBpZiAoX3RoaXMuX3Byb3Zpc2lvbmFsc1tuZXdPYmoudXJsXSkge1xyXG4gICAgICAgICAgICAgIF90aGlzLl9wcm92aXNpb25hbHNbbmV3T2JqLnVybF0uYXBwbHkobmV3T2JqKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy9sZXRzIHN5bmMgd2l0aCBSZXBvcnRlclxyXG4gICAgICAgICAgICAvLyBpdCB3YXMgY29tbWVudGVkIHRvIGxldCBoeXBlcnRpZXMgZGVjaWRlIHdoZW4gdG8gc3luY1xyXG4gICAgICAgICAgICAvL25ld09iai5zeW5jKCk7XHJcbiAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgcmVzb2x2ZShfdGhpcy5fb2JzZXJ2ZXJzKTtcclxuXHJcbiAgICAgICAgICBpZiAodGhpcy5fb25PYnNlcnZlcnNSZXN1bWUpIHRoaXMuX29uT2JzZXJ2ZXJzUmVzdW1lKF90aGlzLl9vYnNlcnZlcnMpO1xyXG5cclxuICAgICAgICB9IGVsc2UgaWYgKHJlcGx5LmJvZHkuY29kZSA9PT0gNDA0KSB7XHJcbiAgICAgICAgICByZXNvbHZlKHt9KTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgcmVqZWN0KHJlcGx5LmJvZHkuZGVzYyk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KTtcclxuICAgIH0pO1xyXG5cclxuICB9XHJcblxyXG4gIC8vRkxPVy1JTjogbWVzc2FnZSByZWNlaXZlZCBmcm9tIGEgbG9jYWwgcnVudGltZSBSZXBvcnRlck9iamVjdCAtPiBfb25SZW1vdGVTdWJzY3JpYmVcclxuICBfb25Gb3J3YXJkKG1zZykge1xyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuXHJcbiAgICBsZXQgcmVwb3J0ZXIgPSBfdGhpcy5fcmVwb3J0ZXJzW21zZy5ib2R5LnRvXTtcclxuICAgIHJlcG9ydGVyLl9vbkZvcndhcmQobXNnKTtcclxuICB9XHJcblxyXG4gIC8vRkxPVy1JTjogbWVzc2FnZSByZWNlaXZlZCBmcm9tIGEgcmVtb3RlIFN5bmNoZXIgLT4gY3JlYXRlICh0aGlzIGlzIGFjdHVhbGx5IGFuIGludml0YXRpb24gdG8gc3Vic2NyaWJlKVxyXG4gIF9vblJlbW90ZUNyZWF0ZShtc2cpIHtcclxuICAgIGxldCBfdGhpcyA9IHRoaXM7XHJcbiAgICBsZXQgcmVzb3VyY2UgPSBtc2cuZnJvbS5zbGljZSgwLCAtMTMpOyAvL3JlbW92ZSBcIi9zdWJzY3JpcHRpb25cIiBmcm9tIHRoZSBVUkxcclxuICAgIGxldCBkaXZpZGVkVVJMID0gZGl2aWRlVVJMKHJlc291cmNlKTtcclxuICAgIGxldCBkb21haW4gPSBkaXZpZGVkVVJMLmRvbWFpbjtcclxuXHJcbiAgICBsZXQgZXZlbnQgPSB7XHJcbiAgICAgIHR5cGU6IG1zZy50eXBlLFxyXG4gICAgICBmcm9tOiBtc2cuYm9keS5zb3VyY2UsXHJcbiAgICAgIHVybDogcmVzb3VyY2UsXHJcbiAgICAgIGRvbWFpbjogZG9tYWluLFxyXG4gICAgICBzY2hlbWE6IG1zZy5ib2R5LnNjaGVtYSxcclxuICAgICAgdmFsdWU6IG1zZy5ib2R5LnZhbHVlLFxyXG4gICAgICBpZGVudGl0eTogbXNnLmJvZHkuaWRlbnRpdHksXHJcblxyXG4gICAgICBhY2s6ICh0eXBlKSA9PiB7XHJcbiAgICAgICAgbGV0IGxUeXBlID0gMjAwO1xyXG4gICAgICAgIGlmICh0eXBlKSB7XHJcbiAgICAgICAgICBsVHlwZSA9IHR5cGU7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgIC8vc2VuZCBhY2sgcmVzcG9uc2UgbWVzc2FnZVxyXG4gICAgICAgIF90aGlzLl9idXMucG9zdE1lc3NhZ2Uoe1xyXG4gICAgICAgICAgaWQ6IG1zZy5pZCwgdHlwZTogJ3Jlc3BvbnNlJywgZnJvbTogbXNnLnRvLCB0bzogbXNnLmZyb20sXHJcbiAgICAgICAgICBib2R5OiB7IGNvZGU6IGxUeXBlIH1cclxuICAgICAgICB9KTtcclxuICAgICAgfVxyXG4gICAgfTtcclxuXHJcbiAgICBpZiAoX3RoaXMuX29uTm90aWZpY2F0aW9uSGFuZGxlcikge1xyXG4gICAgICBsb2cuaW5mbygnW1N5bmNoZXJdIE5PVElGSUNBVElPTi1FVkVOVDogJywgZXZlbnQpO1xyXG4gICAgICBfdGhpcy5fb25Ob3RpZmljYXRpb25IYW5kbGVyKGV2ZW50KTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8vRkxPVy1JTjogbWVzc2FnZSByZWNlaXZlZCBmcm9tIGEgcmVtb3RlIERhdGFPYmplY3RSZXBvcnRlciAtPiBkZWxldGVcclxuICBfb25SZW1vdGVEZWxldGUobXNnKSB7XHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG5cclxuICAgLy9yZW1vdmUgXCIvc3Vic2NyaXB0aW9uXCIgZnJvbSB0aGUgVVJMXHJcbiAgICBsZXQgcmVzb3VyY2UgPSBtc2cuYm9keS5yZXNvdXJjZTtcclxuXHJcbiAgICBsZXQgb2JqZWN0ID0gX3RoaXMuX29ic2VydmVyc1tyZXNvdXJjZV07XHJcblxyXG4gICAgbGV0IHVuc3Vic2NyaWJlID0ge1xyXG4gICAgICBmcm9tOiBfdGhpcy5vd25lcixcclxuICAgICAgdG86IF90aGlzLl9zdWJVUkwsXHJcbiAgICAgIGlkOiBtc2cuaWQsXHJcbiAgICAgIHR5cGU6ICd1bnN1YnNjcmliZScsXHJcbiAgICAgIGJvZHk6IHsgcmVzb3VyY2U6IG1zZy5ib2R5LnJlc291cmNlIH1cclxuICAgIH07XHJcblxyXG4gICAgX3RoaXMuX2J1cy5wb3N0TWVzc2FnZSh1bnN1YnNjcmliZSk7XHJcblxyXG4gICAgZGVsZXRlIF90aGlzLl9vYnNlcnZlcnNbcmVzb3VyY2VdO1xyXG5cclxuICAgIGxldCBldmVudCA9IHtcclxuICAgICAgdHlwZTogbXNnLnR5cGUsXHJcbiAgICAgIHVybDogcmVzb3VyY2UsXHJcbiAgICAgIGlkZW50aXR5OiBtc2cuYm9keS5pZGVudGl0eSxcclxuXHJcbiAgICAgIGFjazogKHR5cGUpID0+IHtcclxuICAgICAgICBsZXQgbFR5cGUgPSAyMDA7XHJcbiAgICAgICAgaWYgKHR5cGUpIHtcclxuICAgICAgICAgIGxUeXBlID0gdHlwZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgLy9UT0RPOiBhbnkgb3RoZXIgZGlmZmVyZW50IG9wdGlvbnMgZm9yIHRoZSByZWxlYXNlIHByb2Nlc3MsIGxpa2UgYWNjZXB0IGJ1dCBub3IgcmVsZWFzZSBsb2NhbD9cclxuICAgICAgICBpZiAobFR5cGUgPT09IDIwMCAmJiBvYmplY3QpIHtcclxuICAgICAgICAgIG9iamVjdC5kZWxldGUoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vc2VuZCBhY2sgcmVzcG9uc2UgbWVzc2FnZVxyXG4gICAgICAgIF90aGlzLl9idXMucG9zdE1lc3NhZ2Uoe1xyXG4gICAgICAgICAgaWQ6IG1zZy5pZCwgdHlwZTogJ3Jlc3BvbnNlJywgZnJvbTogbXNnLnRvLCB0bzogbXNnLmZyb20sXHJcbiAgICAgICAgICBib2R5OiB7IGNvZGU6IGxUeXBlLCBzb3VyY2U6IF90aGlzLl9vd25lciB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH1cclxuICAgIH07XHJcblxyXG4vLyAgICBpZiAob2JqZWN0KSB7XHJcblxyXG5cclxuICAgICAgaWYgKF90aGlzLl9vbk5vdGlmaWNhdGlvbkhhbmRsZXIpIHtcclxuICAgICAgICBsb2cubG9nKCdOT1RJRklDQVRJT04tRVZFTlQ6ICcsIGV2ZW50KTtcclxuICAgICAgICBfdGhpcy5fb25Ob3RpZmljYXRpb25IYW5kbGVyKGV2ZW50KTtcclxuICAgICAgfVxyXG4vKiAgICB9IGVsc2Uge1xyXG4gICAgICBfdGhpcy5fYnVzLnBvc3RNZXNzYWdlKHtcclxuICAgICAgICBpZDogbXNnLmlkLCB0eXBlOiAncmVzcG9uc2UnLCBmcm9tOiBtc2cudG8sIHRvOiBtc2cuZnJvbSxcclxuICAgICAgICBib2R5OiB7IGNvZGU6IDQwNCwgc291cmNlOiBfdGhpcy5fb3duZXIgfVxyXG4gICAgICB9KTtcclxuICAgIH0qL1xyXG4gIH1cclxuXHJcbiAgLy8gY2xvc2UgZXZlbnQgcmVjZWl2ZWQgZnJvbSBydW50aW1lIHJlZ2lzdHJ5XHJcbiAgX29uRXhlY3V0ZShtc2cpIHtcclxuICAgIGxldCBfdGhpcyA9IHRoaXM7XHJcblxyXG4gICAgbGV0IHJlcGx5ID0ge1xyXG4gICAgICBpZDogbXNnLmlkLCB0eXBlOiAncmVzcG9uc2UnLCBmcm9tOiBtc2cudG8sIHRvOiBtc2cuZnJvbSxcclxuICAgICAgYm9keTogeyBjb2RlOiAyMDAgfVxyXG4gICAgfTtcclxuXHJcbiAgICBpZiAoKG1zZy5mcm9tID09PSBfdGhpcy5fcnVudGltZVVybCArICcvcmVnaXN0cnkvJyB8fCBtc2cuZnJvbSA9PT0gX3RoaXMuX3J1bnRpbWVVcmwgKyAnL3JlZ2lzdHJ5JykgJiYgbXNnLmJvZHkgJiYgbXNnLmJvZHkubWV0aG9kICYmIG1zZy5ib2R5Lm1ldGhvZCA9PT0gJ2Nsb3NlJyAmJiBfdGhpcy5fb25DbG9zZSkge1xyXG4gICAgICBsZXQgZXZlbnQgPSB7XHJcbiAgICAgICAgdHlwZTogJ2Nsb3NlJyxcclxuXHJcbiAgICAgICAgYWNrOiAodHlwZSkgPT4ge1xyXG4gICAgICAgICAgaWYgKHR5cGUpIHtcclxuICAgICAgICAgICAgcmVwbHkuYm9keS5jb2RlID0gdHlwZTtcclxuICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgIC8vc2VuZCBhY2sgcmVzcG9uc2UgbWVzc2FnZVxyXG4gICAgICAgICAgX3RoaXMuX2J1cy5wb3N0TWVzc2FnZShyZXBseSk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9O1xyXG5cclxuICAgICAgbG9nLmluZm8oJ1tTeW5jaGVyXSBDbG9zZS1FVkVOVDogJywgZXZlbnQpO1xyXG4gICAgICBfdGhpcy5fb25DbG9zZShldmVudCk7XHJcblxyXG4gICAgfSBlbHNlIHtcclxuICAgICAgX3RoaXMuX2J1cy5wb3N0TWVzc2FnZShyZXBseSk7XHJcbiAgICB9XHJcblxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgKiBDYWxsYmFjayBzeXN0ZW0gdG8gdHJpZ2dlciB0aGUgcmVzdW1lZCByZXBvcnRlcnNcclxuICAqIEBwYXJhbSAge0Z1bmN0aW9ufSBjYWxsYmFjayAtIGZ1bmN0aW9uIGNhbGxiYWNrIHdoaWNoIHdpbGwgYmUgaW52b2tlZFxyXG4gICogQHJldHVybiB7T2JqZWN0PFVSTCwgRGF0YU9iamVjdFJlcG9ydGVyPn0gUmV0dXJuIG9uZSBvYmplY3Qgd2l0aCBhbGwgcmVzdW1lZCByZXBvcnRlcnM7XHJcbiAgKi9cclxuICBvblJlcG9ydGVyc1Jlc3VtZShjYWxsYmFjaykge1xyXG4gICAgdGhpcy5fb25SZXBvcnRlcnNSZXN1bWUgPSBjYWxsYmFjaztcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICogQ2FsbGJhY2sgc3lzdGVtIHRvIHRyaWdnZXIgdGhlIHJlc3VtZWQgb2JzZXJ2ZXJzXHJcbiAgKiBAcGFyYW0gIHtGdW5jdGlvbn0gY2FsbGJhY2sgLSBmdW5jdGlvbiBjYWxsYmFjayB3aGljaCB3aWxsIGJlIGludm9rZWRcclxuICAqIEByZXR1cm4ge09iamVjdDxVUkwsIERhdGFPYmplY3RPYnNlcnZlcj59IFJldHVybiBvbmUgb2JqZWN0IHdpdGggYWxsIHJlc3VtZWQgb2JzZXJ2ZXJzO1xyXG4gICovXHJcbiAgb25PYnNlcnZlcnNSZXN1bWUoY2FsbGJhY2spIHtcclxuICAgIHRoaXMuX29uT2JzZXJ2ZXJzUmVzdW1lID0gY2FsbGJhY2s7XHJcbiAgfVxyXG5cclxufVxyXG5cclxuZXhwb3J0IGRlZmF1bHQgU3luY2hlcjtcclxuIiwiLyoqXHJcbiogVGhlIE5vdGl0aWZpY2F0aW9uIEhhbmRsZXIgaXMgdXNlZCB0byBoYW5kbGUgbm90aWZpY2F0aW9ucyBub3QgcHJvY2Vzc2VkIGJ5IHRoZSBzeW5jaGVyIHdoZW4gcnVubmluZyBpbiBhIHNhbmRib3guXHJcbiovXHJcblxyXG5pbXBvcnQgeyBkaXZpZGVVUkwgfSBmcm9tICcuLi91dGlscy91dGlscyc7XHJcblxyXG5jbGFzcyBOb3RpZmljYXRpb25IYW5kbGVyIHtcclxuXHJcbiAgY29uc3RydWN0b3IoYnVzKSB7XHJcblxyXG4gICAgaWYgKCFidXMpIHRocm93IEVycm9yKCdbTm90aWZpY2F0aW9uSGFuZGxlciBDb25zdHJ1Y3Rvcl0gYnVzIGlucHV0IGlzIG1hbmRhdG9yeScpO1xyXG4gICAgdGhpcy5fYnVzID0gYnVzO1xyXG4gICAgdGhpcy5fb25Ob3RpZmljYXRpb25IYW5kbGVyID0ge307XHJcbiAgfVxyXG5cclxuICBvbk5vdGlmaWNhdGlvbihzY2hlbWUsIGNhbGxiYWNrKSB7XHJcbiAgICB0aGlzLl9vbk5vdGlmaWNhdGlvbkhhbmRsZXJbc2NoZW1lXSA9IGNhbGxiYWNrO1xyXG4gIH1cclxuXHJcbiAgb25DcmVhdGUobXNnKSB7XHJcblxyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuICAvLyAgbGV0IHJlc291cmNlID0gbXNnLmZyb20uc2xpY2UoMCwgLTEzKTsgLy9yZW1vdmUgXCIvc3Vic2NyaXB0aW9uXCIgZnJvbSB0aGUgVVJMXHJcblxyXG4gICAgbGV0IHJlc291cmNlID0gbXNnLmJvZHkuaGFzT3duUHJvcGVydHkoJ3Jlc291cmNlJykgPyBtc2cuYm9keS5yZXNvdXJjZSA6IG1zZy5mcm9tLnNsaWNlKDAsIC0xMyk7XHJcbiAgICBsZXQgZGl2aWRlZFVSTCA9IGRpdmlkZVVSTChyZXNvdXJjZSk7XHJcbiAgICBsZXQgZG9tYWluID0gZGl2aWRlZFVSTC5kb21haW47XHJcbiAgICBsZXQgc2NoZW1lID0gcmVzb3VyY2Uuc3BsaXQoJzovLycpWzBdO1xyXG5cclxuICAgIGxldCBlcnJvciA9IChyZWFzb24pID0+IHtcclxuICAgICAgX3RoaXMuX2J1cy5wb3N0TWVzc2FnZSh7XHJcbiAgICAgICAgaWQ6IG1zZy5pZCwgdHlwZTogJ3Jlc3BvbnNlJywgZnJvbTogbXNnLnRvLCB0bzogbXNnLmZyb20sXHJcbiAgICAgICAgYm9keTogeyBjb2RlOiA0MDAsIGRlc2M6ICdCYWQgUmVxdWVzdDogJyArIHJlYXNvbiB9XHJcbiAgICAgIH0pO1xyXG4gICAgfTtcclxuXHJcbiAgICBpZiAoIW1zZy5ib2R5Lmhhc093blByb3BlcnR5KCdzb3VyY2UnKSkgeyBlcnJvcignTWlzc2luZyBzb3VyY2UnKTsgfVxyXG4gICAgaWYgKCFtc2cuYm9keS5oYXNPd25Qcm9wZXJ0eSgnc2NoZW1hJykpIHsgZXJyb3IoJ01pc3Npbmcgc2NoZW1hJyk7IH1cclxuICAgIGlmICghbXNnLmJvZHkuaGFzT3duUHJvcGVydHkoJ3ZhbHVlJykpIHsgZXJyb3IoJ01pc3NpbmcgdmFsdWUnKTsgfVxyXG4gICAgaWYgKCFtc2cuYm9keS5oYXNPd25Qcm9wZXJ0eSgnaWRlbnRpdHknKSkgeyBlcnJvcignTWlzc2luZyBpZGVudGl0eScpOyB9XHJcblxyXG4gICAgbGV0IGV2ZW50ID0ge1xyXG4gICAgICB0eXBlOiBtc2cudHlwZSxcclxuICAgICAgZnJvbTogbXNnLmJvZHkuc291cmNlLFxyXG4gICAgICB1cmw6IHJlc291cmNlLFxyXG4gICAgICBkb21haW46IGRvbWFpbixcclxuICAgICAgc2NoZW1hOiBtc2cuYm9keS5zY2hlbWEsXHJcbiAgICAgIHZhbHVlOiBtc2cuYm9keS52YWx1ZSxcclxuICAgICAgaWRlbnRpdHk6IG1zZy5ib2R5LmlkZW50aXR5LFxyXG4gICAgICB0bzogbXNnLnRvLFxyXG4gICAgICB2aWE6IG1zZy5ib2R5LnZpYSxcclxuXHJcbiAgICAgIGFjazogKHR5cGUpID0+IHtcclxuICAgICAgICBsZXQgbFR5cGUgPSAyMDA7XHJcbiAgICAgICAgaWYgKHR5cGUpIHtcclxuICAgICAgICAgIGxUeXBlID0gdHlwZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgLy9zZW5kIGFjayByZXNwb25zZSBtZXNzYWdlXHJcbiAgICAgICAgX3RoaXMuX2J1cy5wb3N0TWVzc2FnZSh7XHJcbiAgICAgICAgICBpZDogbXNnLmlkLCB0eXBlOiAncmVzcG9uc2UnLCBmcm9tOiBtc2cudG8sIHRvOiBtc2cuZnJvbSxcclxuICAgICAgICAgIGJvZHk6IHsgY29kZTogbFR5cGUgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgICB9LFxyXG4gICAgICBlcnJvcjogKHJlYXNvbikgPT4ge1xyXG4gICAgICAgIGVycm9yKHJlYXNvbik7XHJcbiAgICAgIH1cclxuICAgIH07XHJcbiAgICBpZiAoX3RoaXMuX29uTm90aWZpY2F0aW9uSGFuZGxlcltzY2hlbWVdKSB7XHJcbiAgICAgIGNvbnNvbGUuaW5mbygnW05vdGlmaWNhdGlvbkhhbmRsZXJdIE5PVElGSUNBVElPTi1FVkVOVDogJywgZXZlbnQpO1xyXG4gICAgICBfdGhpcy5fb25Ob3RpZmljYXRpb25IYW5kbGVyW3NjaGVtZV0oZXZlbnQpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgb25EZWxldGUobXNnKSB7XHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG5cclxuICAgLy9yZW1vdmUgXCIvc3Vic2NyaXB0aW9uXCIgZnJvbSB0aGUgVVJMXHJcbiAgICBsZXQgcmVzb3VyY2UgPSBtc2cuYm9keS5yZXNvdXJjZTtcclxuXHJcbiAgICBsZXQgb2JqZWN0ID0gX3RoaXMuX29ic2VydmVyc1tyZXNvdXJjZV07XHJcblxyXG4gICAgbGV0IHVuc3Vic2NyaWJlID0ge1xyXG4gICAgICBmcm9tOiBfdGhpcy5vd25lcixcclxuICAgICAgdG86IF90aGlzLl9zdWJVUkwsXHJcbiAgICAgIGlkOiBtc2cuaWQsXHJcbiAgICAgIHR5cGU6ICd1bnN1YnNjcmliZScsXHJcbiAgICAgIGJvZHk6IHsgcmVzb3VyY2U6IG1zZy5ib2R5LnJlc291cmNlIH1cclxuICAgIH07XHJcblxyXG4gICAgX3RoaXMuX2J1cy5wb3N0TWVzc2FnZSh1bnN1YnNjcmliZSk7XHJcblxyXG4gICAgZGVsZXRlIF90aGlzLl9vYnNlcnZlcnNbcmVzb3VyY2VdO1xyXG5cclxuICAgIGlmIChvYmplY3QpIHtcclxuICAgICAgbGV0IGV2ZW50ID0ge1xyXG4gICAgICAgIHR5cGU6IG1zZy50eXBlLFxyXG4gICAgICAgIHVybDogcmVzb3VyY2UsXHJcbiAgICAgICAgaWRlbnRpdHk6IG1zZy5ib2R5LmlkZW50aXR5LFxyXG5cclxuICAgICAgICBhY2s6ICh0eXBlKSA9PiB7XHJcbiAgICAgICAgICBsZXQgbFR5cGUgPSAyMDA7XHJcbiAgICAgICAgICBpZiAodHlwZSkge1xyXG4gICAgICAgICAgICBsVHlwZSA9IHR5cGU7XHJcbiAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAvL1RPRE86IGFueSBvdGhlciBkaWZmZXJlbnQgb3B0aW9ucyBmb3IgdGhlIHJlbGVhc2UgcHJvY2VzcywgbGlrZSBhY2NlcHQgYnV0IG5vciByZWxlYXNlIGxvY2FsP1xyXG4gICAgICAgICAgaWYgKGxUeXBlID09PSAyMDApIHtcclxuICAgICAgICAgICAgb2JqZWN0LmRlbGV0ZSgpO1xyXG4gICAgICAgICAgfVxyXG5cclxuICAgICAgICAgIC8vc2VuZCBhY2sgcmVzcG9uc2UgbWVzc2FnZVxyXG4gICAgICAgICAgX3RoaXMuX2J1cy5wb3N0TWVzc2FnZSh7XHJcbiAgICAgICAgICAgIGlkOiBtc2cuaWQsIHR5cGU6ICdyZXNwb25zZScsIGZyb206IG1zZy50bywgdG86IG1zZy5mcm9tLFxyXG4gICAgICAgICAgICBib2R5OiB7IGNvZGU6IGxUeXBlLCBzb3VyY2U6IF90aGlzLl9vd25lciB9XHJcbiAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICAgIH07XHJcblxyXG4gICAgICBpZiAoX3RoaXMuX29uTm90aWZpY2F0aW9uSGFuZGxlcikge1xyXG4gICAgICAgIGxvZy5sb2coJ05PVElGSUNBVElPTi1FVkVOVDogJywgZXZlbnQpO1xyXG4gICAgICAgIF90aGlzLl9vbk5vdGlmaWNhdGlvbkhhbmRsZXIoZXZlbnQpO1xyXG4gICAgICB9XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBfdGhpcy5fYnVzLnBvc3RNZXNzYWdlKHtcclxuICAgICAgICBpZDogbXNnLmlkLCB0eXBlOiAncmVzcG9uc2UnLCBmcm9tOiBtc2cudG8sIHRvOiBtc2cuZnJvbSxcclxuICAgICAgICBib2R5OiB7IGNvZGU6IDQwNCwgc291cmNlOiBfdGhpcy5fb3duZXIgfVxyXG4gICAgICB9KTtcclxuICAgIH1cclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBkZWZhdWx0IE5vdGlmaWNhdGlvbkhhbmRsZXI7XHJcbiIsIi8qKlxyXG4qIENvcHlyaWdodCAyMDE2IFBUIElub3Zhw6fDo28gZSBTaXN0ZW1hcyBTQVxyXG4qIENvcHlyaWdodCAyMDE2IElORVNDLUlEXHJcbiogQ29weXJpZ2h0IDIwMTYgUVVPQklTIE5FVFdPUktTIFNMXHJcbiogQ29weXJpZ2h0IDIwMTYgRlJBVU5IT0ZFUi1HRVNFTExTQ0hBRlQgWlVSIEZPRVJERVJVTkcgREVSIEFOR0VXQU5EVEVOIEZPUlNDSFVORyBFLlZcclxuKiBDb3B5cmlnaHQgMjAxNiBPUkFOR0UgU0FcclxuKiBDb3B5cmlnaHQgMjAxNiBEZXV0c2NoZSBUZWxla29tIEFHXHJcbiogQ29weXJpZ2h0IDIwMTYgQXBpemVlXHJcbiogQ29weXJpZ2h0IDIwMTYgVEVDSE5JU0NIRSBVTklWRVJTSVRBVCBCRVJMSU5cclxuKlxyXG4qIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4qIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4qXHJcbiogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuKlxyXG4qIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4qIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4qKi9cclxuaW1wb3J0IHtkaXZpZGVVUkx9IGZyb20gJy4uL3V0aWxzL3V0aWxzJztcclxuXHJcbi8qKlxyXG4qIENvcmUgSWRlbnRpdHlNYW5hZ2VyIGludGVyZmFjZVxyXG4qIENsYXNzIHRvIGFsbG93IGFwcGxpY2F0aW9ucyB0byBzZWFyY2ggZm9yIElkZW50aXRpZXMgcmVnaXN0ZXJlZCBpbiBydW50aW1lLWNvcmVcclxuKi9cclxuY2xhc3MgSWRlbnRpdHlNYW5hZ2VyIHtcclxuXHJcbiAgLyoqXHJcbiAgKiBUbyBpbml0aWFsaXNlIHRoZSBJZGVudGl0eU1hbmFnZXIsIHdoaWNoIHdpbGwgcHJvdmlkZSB0aGUgc3VwcG9ydCBmb3IgaHlwZXJ0aWVzIHRvXHJcbiAgKiBxdWVyeSBhYm91dCBpZGVudGl0aWVzIHJlZ2lzdGVyZWRcclxuICAqIEBwYXJhbSAge1N0cmluZ30gICAgICAgICAgb3duZXIgICAgICAgICAgICBvd25lclxyXG4gICogQHBhcmFtICB7U3RyaW5nfSAgICAgICAgICBydW50aW1lVVJMICAgICAgICAgICAgcnVudGltZVVSTFxyXG4gICogQHBhcmFtICB7TWVzc2FnZUJ1c30gICAgICAgICAgbXNnYnVzICAgICAgICAgICAgICAgIG1zZ2J1c1xyXG4gICovXHJcbiAgY29uc3RydWN0b3Iob3duZXIsIHJ1bnRpbWVVUkwsIG1zZ0J1cykge1xyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuICAgIF90aGlzLm1lc3NhZ2VCdXMgPSBtc2dCdXM7XHJcblxyXG4gICAgX3RoaXMuZG9tYWluID0gZGl2aWRlVVJMKG93bmVyKS5kb21haW47XHJcbiAgICBfdGhpcy5vd25lciA9IG93bmVyO1xyXG4gICAgX3RoaXMucnVudGltZVVSTCA9IHJ1bnRpbWVVUkw7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAqIEZ1bmN0aW9uIHRvIHF1ZXJ5IHRoZSBydW50aW1lIHJlZ2lzdHJ5IGFib3V0IHRoZSBpZGVudGl0eSB0byB3aGljaCB0aGUgaHlwZXJ0eSB3YXMgYXNzb2NpYXRlZFxyXG4gICogQHBhcmFtIHtTdHJpbmd9ICAgICAgIHR5cGUgKE9wdGlvbmFsKSAgICAgICAgIHR5cGUgb2YgdXNlciBpbmZvIHJlcXVpcmVkXHJcbiAgKiBAcGFyYW0ge1N0cmluZ30gICAgICAgb3duZXIgKE9wdGlvbmFsKSAgIG93bmVyIHRvIHNlYXJjaCBmb3JcclxuICAqIEByZXR1cm4ge1Byb21pc2V9ICAgICB1c2VyVVJMICAgICAgIHVzZXJVUkwgYXNzb2NpYXRlZCB0byB0aGUgaHlwZXJ0eVxyXG4gICovXHJcbiAgZGlzY292ZXJVc2VyUmVnaXN0ZXJlZCh0eXBlLCBoeXBlcnR5KSB7XHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG5cclxuICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuXHJcbiAgICAgIGxldCBhY3RpdmVIeXBlcnR5VVJMO1xyXG5cclxuICAgICAgLy8gaWYgYW55IHR5cGUgb2Ygc2VhcmNoIGlzIHNlbGVjdGVkIHF1ZXJ5IGZvciB0aGF0IHR5cGUsIG90aGVyd2lzZSBxdWVyeSBmb3IgZGVmYXVsdCB1c2VyIGluZm9cclxuICAgICAgbGV0IHNlYXJjaFR5cGUgPSAodHlwZSkgPyB0eXBlIDogJy4nO1xyXG5cclxuICAgICAgaWYgKCFoeXBlcnR5KSB7XHJcbiAgICAgICAgYWN0aXZlSHlwZXJ0eVVSTCA9IF90aGlzLm93bmVyO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGFjdGl2ZUh5cGVydHlVUkwgPSBoeXBlcnR5O1xyXG4gICAgICB9XHJcblxyXG4gICAgICBsZXQgbXNnID0ge1xyXG4gICAgICAgIHR5cGU6ICdyZWFkJywgZnJvbTogYWN0aXZlSHlwZXJ0eVVSTCwgdG86IF90aGlzLnJ1bnRpbWVVUkwgKyAnL3JlZ2lzdHJ5LycsIGJvZHk6IHsgcmVzb3VyY2U6IHNlYXJjaFR5cGUsIGNyaXRlcmlhOiBhY3RpdmVIeXBlcnR5VVJMfVxyXG4gICAgICB9O1xyXG5cclxuICAgICAgX3RoaXMubWVzc2FnZUJ1cy5wb3N0TWVzc2FnZShtc2csIChyZXBseSkgPT4ge1xyXG5cclxuICAgICAgICBsZXQgdXNlclVSTCA9IHJlcGx5LmJvZHkucmVzb3VyY2U7XHJcblxyXG4gICAgICAgIGlmICh1c2VyVVJMICYmIHJlcGx5LmJvZHkuY29kZSA9PT0gMjAwKSB7XHJcbiAgICAgICAgICByZXNvbHZlKHVzZXJVUkwpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICByZWplY3QoJ2NvZGU6ICcgKyByZXBseS5ib2R5LmNvZGUgKyAnIE5vIHVzZXIgd2FzIGZvdW5kJyk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgKiBGdW5jdGlvbiB0byBxdWVyeSB0aGUgSWRlbnRpdHkgTW9kdWxlIGFib3V0IGF1dGhlbnRpY2F0ZWQgaWRlbnRpdGllcyBmcm9tIGEgY2VydGFpbiBkb21haW5cclxuICAqIEBwYXJhbSB7U3RyaW5nfSAgICAgICBpZHAgaWRwIGRvbWFpbiBvZiB0aGUgaWRlbnRpdHkgdG8gYmUgZGlzY292ZXJlZFxyXG4gICogQHJldHVybiB7UHJvbWlzZX0gICAgIGlkZW50aXR5XHJcbiAgKi9cclxuXHJcbiAgZGlzY292ZXJJZGVudGl0eVBlcklkUChpZHApIHtcclxuICAgIGxldCBfdGhpcyA9IHRoaXM7XHJcblxyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG5cclxuICAgICAgbGV0IG1zZyA9IHtcclxuICAgICAgICB0eXBlOiAncmVhZCcsIGZyb206IHRoaXMub3duZXIsIHRvOiBfdGhpcy5ydW50aW1lVVJMICsgJy9pZG0nLCBib2R5OiB7IHJlc291cmNlOiBpZHAsIGNyaXRlcmlhOiAnaWRwJ31cclxuICAgICAgfTtcclxuXHJcbiAgICAgIF90aGlzLm1lc3NhZ2VCdXMucG9zdE1lc3NhZ2UobXNnLCAocmVwbHkpID0+IHtcclxuXHJcbiAgICAgICAgaWYgKHJlcGx5LmJvZHkuY29kZSA9PT0gMjAwKSB7XHJcbiAgICAgICAgICByZXNvbHZlKHJlcGx5LmJvZHkudmFsdWUpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICByZWplY3QocmVwbHkuYm9keS5jb2RlICsgJyAnICsgcmVwbHkuYm9keS5kZXNjKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG4gICAgfSk7XHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgZGVmYXVsdCBJZGVudGl0eU1hbmFnZXI7XHJcbiIsIi8qKlxyXG4qIENvcHlyaWdodCAyMDE2IFBUIElub3Zhw6fDo28gZSBTaXN0ZW1hcyBTQVxyXG4qIENvcHlyaWdodCAyMDE2IElORVNDLUlEXHJcbiogQ29weXJpZ2h0IDIwMTYgUVVPQklTIE5FVFdPUktTIFNMXHJcbiogQ29weXJpZ2h0IDIwMTYgRlJBVU5IT0ZFUi1HRVNFTExTQ0hBRlQgWlVSIEZPRVJERVJVTkcgREVSIEFOR0VXQU5EVEVOIEZPUlNDSFVORyBFLlZcclxuKiBDb3B5cmlnaHQgMjAxNiBPUkFOR0UgU0FcclxuKiBDb3B5cmlnaHQgMjAxNiBEZXV0c2NoZSBUZWxla29tIEFHXHJcbiogQ29weXJpZ2h0IDIwMTYgQXBpemVlXHJcbiogQ29weXJpZ2h0IDIwMTYgVEVDSE5JU0NIRSBVTklWRVJTSVRBVCBCRVJMSU5cclxuKlxyXG4qIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4qIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4qXHJcbiogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuKlxyXG4qIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4qIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4qKi9cclxuXHJcbi8vIExvZyBTeXN0ZW1cclxuaW1wb3J0ICogYXMgbG9nZ2VyIGZyb20gJ2xvZ2xldmVsJztcclxubGV0IGxvZyA9IGxvZ2dlci5nZXRMb2dnZXIoJ1JlZ2lzdHJhdGlvblN0YXR1cycpO1xyXG5cclxuaW1wb3J0IHsgZGl2aWRlVVJMIH0gZnJvbSAnLi4vdXRpbHMvdXRpbHMnO1xyXG5cclxuLyoqXHJcbiogVGhlIFJlZ2lzdHJhdGlvblN0YXR1cyBsaWIgYWxsb3dzIHRvIG1vbml0b3IgcmVnaXN0cmF0aW9uIHN0YXR1cyBvZiBhbiBIeXBlcnR5IG9yIERhdGEgT2JqZWN0XHJcbipcclxuKi9cclxuY2xhc3MgUmVnaXN0cmF0aW9uU3RhdHVzIHtcclxuXHJcbiAgLyoqXHJcbiAgKiBAcGFyYW0ge1VSTH0gdXJsIFVSTCBhZGRyZXNzIG9mIHRoZSBlbnRpdHkgdG8gYmUgbW9uaXRvcmVkXHJcbiAgKiBAcGFyYW0ge1VSTH0gcnVudGltZVVSTCB0aGUgY3VycmVudCBVUkwgb2YgdGhlIFJ1bnRpbWUgSW5zdGFuY2UgdXNlZFxyXG4gICogQHBhcmFtIHtIeXBlcnR5VVJMfSBvd25lciB0aGUgVVJMIG9mIHRoZSBIeXBlcnR5IGluc3RhbmNlIHRoYXQgaXMgdXNpbmcgdGhpcyBsaWJcclxuICAqIEBwYXJhbSB7TWluaUJ1c30gb3duZXIgdGhlIFVSTCBvZiB0aGUgSHlwZXJ0eSBpbnN0YW5jZSB0aGF0IGlzIHVzaW5nIHRoaXMgbGliXHJcbiAgKlxyXG4gICovXHJcblxyXG4gIGNvbnN0cnVjdG9yKHVybCwgcnVudGltZVVSTCwgb3duZXIsIG1zZ0J1cykge1xyXG4gICAgdGhpcy5fcmVnaXN0cnlPYmplY3RVUkwgPSB1cmw7XHJcbiAgICB0aGlzLl9ydW50aW1lVVJMID0gcnVudGltZVVSTDtcclxuICAgIHRoaXMuX2RvbWFpbiA9IGRpdmlkZVVSTChydW50aW1lVVJMKS5kb21haW47XHJcbiAgICB0aGlzLl9kaXNjb3ZlcmVkT2JqZWN0VVJMID0gb3duZXI7XHJcbiAgICB0aGlzLl9tZXNzYWdlQnVzID0gbXNnQnVzO1xyXG4gICAgdGhpcy5fc3Vic2NyaXB0aW9uU2V0ID0gZmFsc2U7XHJcbiAgICB0aGlzLl9zdWJzY3JpYmVycyA9IHtcclxuICAgICAgbGl2ZToge30sXHJcbiAgICAgIGRpc2Nvbm5lY3RlZDoge31cclxuICAgIH07XHJcbiAgfVxyXG5cclxuXHJcbiAgb25MaXZlKHN1YnNjcmliZXIsIGNhbGxiYWNrKSB7XHJcblxyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcclxuXHJcbiAgICAgIGlmICghdGhpcy5fc3Vic2NyaXB0aW9uU2V0KSB7XHJcbiAgICAgICAgdGhpcy5fc3Vic2NyaWJlKClcclxuICAgICAgICAudGhlbigoKSA9PiB7XHJcbiAgICAgICAgICB0aGlzLl9zdWJzY3JpYmVycy5saXZlW3N1YnNjcmliZXJdID0gY2FsbGJhY2s7XHJcbiAgICAgICAgICByZXNvbHZlKCk7XHJcbiAgICAgICAgfSlcclxuICAgICAgICAuY2F0Y2goKGVycikgPT4gcmVqZWN0KGVycikpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHRoaXMuX3N1YnNjcmliZXJzLmxpdmVbc3Vic2NyaWJlcl0gPSBjYWxsYmFjaztcclxuICAgICAgICByZXNvbHZlKCk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgb25EaXNjb25uZWN0ZWQoc3Vic2NyaWJlciwgY2FsbGJhY2spIHtcclxuXHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xyXG5cclxuICAgICAgaWYgKCF0aGlzLl9zdWJzY3JpcHRpb25TZXQpIHtcclxuICAgICAgICB0aGlzLl9zdWJzY3JpYmUoKVxyXG4gICAgICAgIC50aGVuKCgpID0+IHtcclxuICAgICAgICAgIHRoaXMuX3N1YnNjcmliZXJzLmRpc2Nvbm5lY3RlZFtzdWJzY3JpYmVyXSA9IGNhbGxiYWNrO1xyXG4gICAgICAgICAgcmVzb2x2ZSgpO1xyXG4gICAgICAgIH0pXHJcbiAgICAgICAgLmNhdGNoKChlcnIpID0+IHJlamVjdChlcnIpKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICB0aGlzLl9zdWJzY3JpYmVycy5kaXNjb25uZWN0ZWRbc3Vic2NyaWJlcl0gPSBjYWxsYmFjaztcclxuICAgICAgICByZXNvbHZlKCk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgX3N1YnNjcmliZSgpIHtcclxuXHJcbiAgICBjb25zdCBtc2cgPSB7XHJcbiAgICAgIHR5cGU6ICdzdWJzY3JpYmUnLFxyXG4gICAgICBmcm9tOiB0aGlzLl9kaXNjb3ZlcmVkT2JqZWN0VVJMLFxyXG4gICAgICB0bzogdGhpcy5fcnVudGltZVVSTCArICcvc3Vic2NyaXB0aW9ucycsXHJcbiAgICAgIGJvZHk6IHtcclxuICAgICAgICByZXNvdXJjZXM6IFt0aGlzLl9yZWdpc3RyeU9iamVjdFVSTCArICcvcmVnaXN0cmF0aW9uJ11cclxuICAgICAgfVxyXG4gICAgfTtcclxuXHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xyXG5cclxuICAgICAgdGhpcy5fbWVzc2FnZUJ1cy5wb3N0TWVzc2FnZShtc2csIChyZXBseSkgPT4ge1xyXG4gICAgICAgIGxvZy5sb2coYFtEaXNjb3ZlcmVkT2JqZWN0LnN1YnNjcmliZV0gJHt0aGlzLl9yZWdpc3RyeU9iamVjdFVSTH0gcmN2ZWQgcmVwbHkgYCwgcmVwbHkpO1xyXG5cclxuICAgICAgICBpZiAocmVwbHkuYm9keS5jb2RlID09PSAyMDApIHtcclxuICAgICAgICAgIHRoaXMuX2dlbmVyYXRlTGlzdGVuZXIodGhpcy5fcmVnaXN0cnlPYmplY3RVUkwgKyAnL3JlZ2lzdHJhdGlvbicpO1xyXG4gICAgICAgICAgdGhpcy5fc3Vic2NyaXB0aW9uU2V0ID0gdHJ1ZTtcclxuICAgICAgICAgIHJlc29sdmUoKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgbG9nLmVycm9yKCdFcnJvciBzdWJzY3JpYmluZyAnLCB0aGlzLl9yZWdpc3RyeU9iamVjdFVSTCk7XHJcbiAgICAgICAgICByZWplY3QoJ0Vycm9yIHN1YnNjcmliaW5nICcgKyB0aGlzLl9yZWdpc3RyeU9iamVjdFVSTCk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgX2dlbmVyYXRlTGlzdGVuZXIobm90aWZpY2F0aW9uVVJMKSB7XHJcblxyXG4gICAgdGhpcy5fbWVzc2FnZUJ1cy5hZGRMaXN0ZW5lcihub3RpZmljYXRpb25VUkwsIChtc2cpID0+IHtcclxuICAgICAgbG9nLmxvZyhgW0Rpc2NvdmVyZWRPYmplY3Qubm90aWZpY2F0aW9uXSAke3RoaXMuX3JlZ2lzdHJ5T2JqZWN0VVJMfTogYCwgbXNnKTtcclxuICAgICAgdGhpcy5fcHJvY2Vzc05vdGlmaWNhdGlvbihtc2cpO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBfcHJvY2Vzc05vdGlmaWNhdGlvbihtc2cpIHtcclxuICAgIGNvbnN0IHN0YXR1cyA9IG1zZy5ib2R5LnZhbHVlO1xyXG5cclxuICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG5cclxuICAgICAgLy8gSGFjayB0byBnaXZlIHRpbWUgZm9yIG9uTGl2ZSBIeXBlcnRpZXMgdG8gZ2V0IHJlYWR5LiBUbyBiZSByZW1vdmVkIHdoZW4gSHlwZXJ0eSBTdGF0ZSBtYWNoYWluZSBpcyBpbXBsZW1lbnRlZFxyXG4gICAgICBPYmplY3Qua2V5cyh0aGlzLl9zdWJzY3JpYmVyc1tzdGF0dXNdKS5mb3JFYWNoKFxyXG4gICAgICAgIHN1YnNjcmliZXIgPT4gdGhpcy5fc3Vic2NyaWJlcnNbc3RhdHVzXVtzdWJzY3JpYmVyXSgpXHJcbiAgICAgICk7XHJcblxyXG4gICAgfSwgNTAwMCk7XHJcblxyXG4gIH1cclxuXHJcblxyXG4gIF91bnN1YnNjcmliZSgpIHtcclxuXHJcbiAgICBjb25zdCBtc2cgPSB7XHJcbiAgICAgIHR5cGU6ICd1bnN1YnNjcmliZScsXHJcbiAgICAgIGZyb206IHRoaXMuX2Rpc2NvdmVyZWRPYmplY3RVUkwsXHJcbiAgICAgIHRvOiB0aGlzLl9ydW50aW1lVVJMICsgJy9zdWJzY3JpcHRpb25zJyxcclxuICAgICAgYm9keToge1xyXG4gICAgICAgIHJlc291cmNlOiB0aGlzLl9yZWdpc3RyeU9iamVjdFVSTCArICcvcmVnaXN0cmF0aW9uJ1xyXG4gICAgICB9XHJcbiAgICB9O1xyXG5cclxuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XHJcblxyXG4gICAgICB0aGlzLl9tZXNzYWdlQnVzLnBvc3RNZXNzYWdlKG1zZywgKHJlcGx5KSA9PiB7XHJcbiAgICAgICAgbG9nLmxvZyhgW0Rpc2NvdmVyZWRPYmplY3QudW5zdWJzY3JpYmVdICR7dGhpcy5fcmVnaXN0cnlPYmplY3RVUkx9IHJjdmVkIHJlcGx5IGAsIHJlcGx5KTtcclxuXHJcbiAgICAgICAgaWYgKHJlcGx5LmJvZHkuY29kZSA9PT0gMjAwKSB7XHJcbiAgICAgICAgICByZXNvbHZlKCk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIGxvZy5lcnJvcignRXJyb3IgdW5zdWJzY3JpYmluZyAnLCB0aGlzLl9yZWdpc3RyeU9iamVjdFVSTCk7XHJcbiAgICAgICAgICByZWplY3QoJ0Vycm9yIHVuc3Vic2NyaWJpbmcgJyArIHRoaXMuX3JlZ2lzdHJ5T2JqZWN0VVJMKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICB1bnN1YnNjcmliZUxpdmUoc3Vic2NyaWJlcikge1xyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcclxuXHJcbiAgICAgIGlmIChzdWJzY3JpYmVyIGluIHRoaXMuX3N1YnNjcmliZXJzLmxpdmUpIHtcclxuXHJcbiAgICAgICAgICAvL1RPRE86IHVuc3Vic2NyaWJlIG91dHNpZGUgdGhpcyBjb25kaXRpb25cclxuICAgICAgICBkZWxldGUgdGhpcy5fc3Vic2NyaWJlcnMubGl2ZVtzdWJzY3JpYmVyXTtcclxuICAgICAgfVxyXG5cclxuICAgICAgaWYgKHRoaXMuX2FyZVN1YnNjcmlwdGlvbnNFbXB0eSgpKSB7XHJcbiAgICAgICAgdGhpcy5fdW5zdWJzY3JpYmUoKVxyXG4gICAgICAgICAgICAudGhlbigoKSA9PiByZXNvbHZlKCkpXHJcbiAgICAgICAgICAgIC5jYXRjaCgoZXJyKSA9PiByZWplY3QoZXJyKSk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgcmVzb2x2ZSgpO1xyXG4gICAgICB9XHJcblxyXG4gICAgICAvKiAgfSBlbHNlIHtcclxuICAgICAgICAgIHJlamVjdChgJHtzdWJzY3JpYmVyfSBkb2Vzbid0IHN1YnNjcmliZSBvbkxpdmUgZm9yICR7dGhpcy5fcmVnaXN0cnlPYmplY3RVUkx9YCk7XHJcbiAgICAgICAgfSovXHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIHVuc3Vic2NyaWJlRGlzY29ubmVjdGVkKHN1YnNjcmliZXIpIHtcclxuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XHJcblxyXG4gICAgICBpZiAoc3Vic2NyaWJlciBpbiB0aGlzLl9zdWJzY3JpYmVycy5kaXNjb25uZWN0ZWQpIHtcclxuICAgICAgICBkZWxldGUgdGhpcy5fc3Vic2NyaWJlcnMuZGlzY29ubmVjdGVkW3N1YnNjcmliZXJdO1xyXG5cclxuICAgICAgICBpZiAodGhpcy5fYXJlU3Vic2NyaXB0aW9uc0VtcHR5KCkpIHtcclxuICAgICAgICAgIHRoaXMuX3Vuc3Vic2NyaWJlKClcclxuICAgICAgICAgIC50aGVuKCgpID0+IHJlc29sdmUoKSlcclxuICAgICAgICAgIC5jYXRjaCgoZXJyKSA9PiByZWplY3QoZXJyKSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIHJlc29sdmUoKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgcmVqZWN0KGAke3N1YnNjcmliZXJ9IGRvZXNuJ3Qgc3Vic2NyaWJlIG9uRGlzY29ubmVjdGVkIGZvciAke3RoaXMuX3JlZ2lzdHJ5T2JqZWN0VVJMfWApO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIF9hcmVTdWJzY3JpcHRpb25zRW1wdHkoKSB7XHJcbiAgICByZXR1cm4gT2JqZWN0LmtleXModGhpcy5fc3Vic2NyaWJlcnMubGl2ZSkubGVuZ3RoID09PSAwXHJcbiAgICAgICYmIE9iamVjdC5rZXlzKHRoaXMuX3N1YnNjcmliZXJzLmRpc2Nvbm5lY3RlZCkubGVuZ3RoID09PSAwO1xyXG4gIH1cclxuXHJcbn1cclxuXHJcbmV4cG9ydCBkZWZhdWx0IFJlZ2lzdHJhdGlvblN0YXR1cztcclxuIiwiLyoqXHJcbiogQ29weXJpZ2h0IDIwMTYgUFQgSW5vdmHDp8OjbyBlIFNpc3RlbWFzIFNBXHJcbiogQ29weXJpZ2h0IDIwMTYgSU5FU0MtSURcclxuKiBDb3B5cmlnaHQgMjAxNiBRVU9CSVMgTkVUV09SS1MgU0xcclxuKiBDb3B5cmlnaHQgMjAxNiBGUkFVTkhPRkVSLUdFU0VMTFNDSEFGVCBaVVIgRk9FUkRFUlVORyBERVIgQU5HRVdBTkRURU4gRk9SU0NIVU5HIEUuVlxyXG4qIENvcHlyaWdodCAyMDE2IE9SQU5HRSBTQVxyXG4qIENvcHlyaWdodCAyMDE2IERldXRzY2hlIFRlbGVrb20gQUdcclxuKiBDb3B5cmlnaHQgMjAxNiBBcGl6ZWVcclxuKiBDb3B5cmlnaHQgMjAxNiBURUNITklTQ0hFIFVOSVZFUlNJVEFUIEJFUkxJTlxyXG4qXHJcbiogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbipcclxuKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4qXHJcbiogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4qIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbioqL1xyXG5cclxuLy9pbXBvcnQge2RpdmlkZVVSTCwgY29udmVydFRvVXNlclVSTH0gZnJvbSAnLi4vdXRpbHMvdXRpbHMnO1xyXG5pbXBvcnQgUmVnaXN0cmF0aW9uU3RhdHVzIGZyb20gJy4vUmVnaXN0cmF0aW9uU3RhdHVzJztcclxuXHJcbi8qKlxyXG4qIERpc2NvdmVyZWQgT2JqZWN0IGludGVyZmFjZVxyXG4qL1xyXG5jbGFzcyBEaXNjb3ZlcmVkT2JqZWN0IGV4dGVuZHMgUmVnaXN0cmF0aW9uU3RhdHVzIHtcclxuXHJcbiAgZ2V0IGRhdGEoKSB7XHJcbiAgICByZXR1cm4gdGhpcy5fZGF0YTtcclxuICB9XHJcblxyXG4gIGNvbnN0cnVjdG9yKGRhdGEsIHJ1bnRpbWVVUkwsIGRpc2NvdmVyeVVSTCwgbXNnQnVzLCBkaXNjb3ZlcnkpIHtcclxuICAgIHN1cGVyKGRhdGEuaHlwZXJ0eUlEIHx8IGRhdGEudXJsLCBydW50aW1lVVJMLCBkaXNjb3ZlcnlVUkwsIG1zZ0J1cyk7XHJcblxyXG4gICAgdGhpcy5fZGF0YSA9IGRhdGE7XHJcbiAgICB0aGlzLl9kaXNjb3ZlcnkgPSBkaXNjb3Zlcnk7XHJcbiAgfVxyXG5cclxuXHJcblxyXG5cclxuICAvKipcclxuICAqIGZ1bmN0aW9uIHRvIGNoZWNrIHRoZSBzdGF0dXMgb2YgdGhlIERpc2NvdmVyZWRPYmplY3QuXHJcbiAgKiBEZXBlbmRpbmcgb24gZXhpc3Rpbmcgc3Vic2NyaWJlcnMgaXQgbWF5IHRyaWdnZXIgb25MaXZlIG9yIG9uRGlzY29ubmVjdGVkIGV2ZW50cy5cclxuICAqXHJcbiAgKi9cclxuXHJcbiAgY2hlY2soKSB7XHJcbiAgICAvLyBxdWVyeSBEUiBmb3IgdGhlIHN0YXR1cyBhbmQgY2FsbCBwcm9jZXNzTm90aWZpY2F0aW9uIHdpdGggbXNnIHJlY2VpdmVkXHJcblxyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuICAgIGxldCBtZXNzYWdlID0ge1xyXG4gICAgICBib2R5OiB7fVxyXG4gICAgfTtcclxuXHJcbiAgICBpZiAoX3RoaXMuX2Rpc2NvdmVyZWRPYmplY3RVUkwuc3RhcnRzV2l0aCgnaHlwZXJ0eTovLycpICkge1xyXG4gICAgICBfdGhpcy5fZGlzY292ZXJ5LmRpc2NvdmVySHlwZXJ0eVBlclVSTChfdGhpcy5fZGlzY292ZXJlZE9iamVjdFVSTCkudGhlbigocmVnaXN0cmF0aW9uKT0+e1xyXG4gICAgICAgIG1lc3NhZ2UuYm9keS5zdGF0dXMgPSByZWdpc3RyYXRpb24uc3RhdHVzO1xyXG4gICAgICAgIF90aGlzLl9wcm9jZXNzTm90aWZpY2F0aW9uKG1lc3NhZ2UpO1xyXG4gICAgICB9KTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIF90aGlzLl9kaXNjb3ZlcnkuZGlzY292ZXJEYXRhT2JqZWN0c1BlclVSTChfdGhpcy5fZGlzY292ZXJlZE9iamVjdFVSTCkudGhlbigocmVnaXN0cmF0aW9uKT0+e1xyXG4gICAgICAgIG1lc3NhZ2UuYm9keS5zdGF0dXMgPSByZWdpc3RyYXRpb24uc3RhdHVzO1xyXG4gICAgICAgIF90aGlzLl9wcm9jZXNzTm90aWZpY2F0aW9uKG1lc3NhZ2UpO1xyXG4gICAgICB9KTtcclxuICAgIH1cclxuICB9XHJcblxyXG5cclxuXHJcbn1cclxuXHJcbmV4cG9ydCBkZWZhdWx0IERpc2NvdmVyZWRPYmplY3Q7XHJcbiIsIi8qKlxyXG4qIENvcHlyaWdodCAyMDE2IFBUIElub3Zhw6fDo28gZSBTaXN0ZW1hcyBTQVxyXG4qIENvcHlyaWdodCAyMDE2IElORVNDLUlEXHJcbiogQ29weXJpZ2h0IDIwMTYgUVVPQklTIE5FVFdPUktTIFNMXHJcbiogQ29weXJpZ2h0IDIwMTYgRlJBVU5IT0ZFUi1HRVNFTExTQ0hBRlQgWlVSIEZPRVJERVJVTkcgREVSIEFOR0VXQU5EVEVOIEZPUlNDSFVORyBFLlZcclxuKiBDb3B5cmlnaHQgMjAxNiBPUkFOR0UgU0FcclxuKiBDb3B5cmlnaHQgMjAxNiBEZXV0c2NoZSBUZWxla29tIEFHXHJcbiogQ29weXJpZ2h0IDIwMTYgQXBpemVlXHJcbiogQ29weXJpZ2h0IDIwMTYgVEVDSE5JU0NIRSBVTklWRVJTSVRBVCBCRVJMSU5cclxuKlxyXG4qIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4qIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4qXHJcbiogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuKlxyXG4qIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4qIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4qKi9cclxuXHJcbi8vIExvZyBTeXN0ZW1cclxuaW1wb3J0ICogYXMgbG9nZ2VyIGZyb20gJ2xvZ2xldmVsJztcclxubGV0IGxvZyA9IGxvZ2dlci5nZXRMb2dnZXIoJ0Rpc2NvdmVyeScpO1xyXG5cclxuaW1wb3J0IHtkaXZpZGVVUkwsIGNvbnZlcnRUb1VzZXJVUkx9IGZyb20gJy4uL3V0aWxzL3V0aWxzJztcclxuaW1wb3J0IERpc2NvdmVyZWRPYmplY3QgZnJvbSAnLi9EaXNjb3ZlcmVkT2JqZWN0JztcclxuXHJcbi8qKlxyXG4qIENvcmUgRGlzY292ZXJ5IGludGVyZmFjZVxyXG4qIENsYXNzIHRvIGFsbG93IGFwcGxpY2F0aW9ucyB0byBzZWFyY2ggZm9yIGh5cGVydGllcyBhbmQgRGF0YU9iamVjdHMgdXNpbmcgdGhlIG1lc3NhZ2UgYnVzXHJcbiovXHJcbmNsYXNzIERpc2NvdmVyeSB7XHJcblxyXG4gIC8qKlxyXG4gICogVG8gaW5pdGlhbGlzZSB0aGUgSHlwZXJ0eURpc2NvdmVyLCB3aGljaCB3aWxsIHByb3ZpZGUgdGhlIHN1cHBvcnQgZm9yIGh5cGVydGllcyB0b1xyXG4gICogcXVlcnkgdXNlcnMgcmVnaXN0ZXJlZCBpbiBvdXRzaWRlIHRoZSBpbnRlcm5hbCBjb3JlLlxyXG4gICogQHBhcmFtICB7TWVzc2FnZUJ1c30gICAgICAgICAgbXNnYnVzICAgICAgICAgICAgICAgIG1zZ2J1c1xyXG4gICogQHBhcmFtICB7UnVudGltZVVSTH0gICAgICAgICAgcnVudGltZVVSTCAgICAgICAgICAgIHJ1bnRpbWVVUkxcclxuICAqL1xyXG4gIGNvbnN0cnVjdG9yKGh5cGVydHlVUkwsIHJ1bnRpbWVVUkwsIG1zZ0J1cykge1xyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuICAgIF90aGlzLm1lc3NhZ2VCdXMgPSBtc2dCdXM7XHJcbiAgICBfdGhpcy5ydW50aW1lVVJMID0gcnVudGltZVVSTDtcclxuXHJcbiAgICBfdGhpcy5kb21haW4gPSBkaXZpZGVVUkwoaHlwZXJ0eVVSTCkuZG9tYWluO1xyXG4gICAgX3RoaXMuZGlzY292ZXJ5VVJMID0gaHlwZXJ0eVVSTDtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICogQWR2YW5jZWQgU2VhcmNoIGZvciBIeXBlcnRpZXMgcmVnaXN0ZXJlZCBpbiBkb21haW4gcmVnaXN0cnkgYXNzb2NpYXRlZCB3aXRoIHNvbWUgdXNlciBpZGVudGlmaWVyIChlZyBlbWFpbCwgbmFtZSAuLi4pXHJcbiAgKiBAcGFyYW0gIHtTdHJpbmd9ICAgICAgICAgICB1c2VySWRlbnRpZmllclxyXG4gICogQHBhcmFtICB7QXJyYXk8c3RyaW5nPn0gICAgc2NoZW1hIChPcHRpb25hbCkgICAgIHR5cGVzIG9mIGh5cGVydGllcyBzY2hlbWFzXHJcbiAgKiBAcGFyYW0gIHtBcnJheTxzdHJpbmc+fSAgICByZXNvdXJjZXMgKE9wdGlvbmFsKSAgdHlwZXMgb2YgaHlwZXJ0aWVzIHJlc291cmNlc1xyXG4gICovXHJcbiAgX2lzTGVnYWN5VXNlcih1c2VySWRlbnRpZmllcikge1xyXG4gICAgaWYgKHVzZXJJZGVudGlmaWVyLmluY2x1ZGVzKCc6JykgJiYgIXVzZXJJZGVudGlmaWVyLmluY2x1ZGVzKCd1c2VyOi8vJykpIHtcclxuICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAqIEFkdmFuY2VkIFNlYXJjaCBmb3IgSHlwZXJ0aWVzIHJlZ2lzdGVyZWQgaW4gZG9tYWluIHJlZ2lzdHJ5IGFzc29jaWF0ZWQgd2l0aCBzb21lIHVzZXIgaWRlbnRpZmllciAoZWcgZW1haWwsIG5hbWUgLi4uKVxyXG4gICogQHBhcmFtICB7U3RyaW5nfSAgICAgICAgICAgdXNlcklkZW50aWZpZXJcclxuICAqIEBwYXJhbSAge0FycmF5PHN0cmluZz59ICAgIHNjaGVtYSAoT3B0aW9uYWwpICAgICB0eXBlcyBvZiBoeXBlcnRpZXMgc2NoZW1hc1xyXG4gICogQHBhcmFtICB7QXJyYXk8c3RyaW5nPn0gICAgcmVzb3VyY2VzIChPcHRpb25hbCkgIHR5cGVzIG9mIGh5cGVydGllcyByZXNvdXJjZXNcclxuICAqL1xyXG4gIGRpc2NvdmVySHlwZXJ0aWVzUGVyVXNlclByb2ZpbGVEYXRhKHVzZXJJZGVudGlmaWVyLCBzY2hlbWEsIHJlc291cmNlcykge1xyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuICAgIGxldCBmaWx0ZXJlZEh5cGVydGllcyA9IFtdO1xyXG5cclxuICAgIGxldCBtc2cgPSB7XHJcbiAgICAgIHR5cGU6ICdyZWFkJyxcclxuICAgICAgZnJvbTogX3RoaXMuZGlzY292ZXJ5VVJMLFxyXG4gICAgICB0bzogX3RoaXMucnVudGltZVVSTCArICcvZGlzY292ZXJ5LycsXHJcbiAgICAgIGJvZHk6IHtcclxuICAgICAgICByZXNvdXJjZTogJy9oeXBlcnR5L3VzZXJwcm9maWxlLycgKyB1c2VySWRlbnRpZmllcixcclxuICAgICAgfVxyXG4gICAgfTtcclxuXHJcbiAgICBpZiAoc2NoZW1hIHx8IHJlc291cmNlcykge1xyXG4gICAgICBtc2cuYm9keVsnY3JpdGVyaWEnXSA9IHtcclxuICAgICAgICByZXNvdXJjZXM6IHJlc291cmNlcyxcclxuICAgICAgICBkYXRhU2NoZW1lczogc2NoZW1hXHJcbiAgICAgIH07XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG5cclxuICAgICAgaWYgKCFfdGhpcy5faXNMZWdhY3lVc2VyKHVzZXJJZGVudGlmaWVyKSkgey8vIHRvZG86IHRvIHJlb212ZSB3aGVuIGRpc2NvdmVyeSBvZiBsZWdjYXkgdXNlcnMgYXJlIHN1cHBvcnRlZFxyXG5cclxuICAgICAgICBfdGhpcy5tZXNzYWdlQnVzLnBvc3RNZXNzYWdlKG1zZywgKHJlcGx5KSA9PiB7XHJcblxyXG4gICAgICAgICAgaWYocmVwbHkuYm9keS5jb2RlID09PSAyMDApe1xyXG4gICAgICAgICAgICByZXBseS5ib2R5LnZhbHVlLm1hcChmdW5jdGlvbihoeXBlcnR5KSB7XHJcbiAgICAgICAgICAgICAgIGlmKGh5cGVydHkuaHlwZXJ0eUlEICE9IF90aGlzLmRpc2NvdmVyeVVSTClcclxuICAgICAgICAgICAgICAgICAgIGZpbHRlcmVkSHlwZXJ0aWVzLnB1c2goaHlwZXJ0eSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICBpZihmaWx0ZXJlZEh5cGVydGllcy5sZW5ndGggPT09IDApXHJcbiAgICAgICAgICAgICAgcmVzb2x2ZShbXSk7XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgIGxvZy5sb2coXCJbRGlzY292ZXJ5LmRpc2NvdmVySHlwZXJ0aWVzUGVyVXNlclByb2ZpbGVEYXRhXSBSZXBseSBsb2c6IFwiLGZpbHRlcmVkSHlwZXJ0aWVzKTtcclxuICAgICAgICAgICAgICByZXNvbHZlKGZpbHRlcmVkSHlwZXJ0aWVzKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIGxvZy53YXJuKFwiW0Rpc2NvdmVyeS5kaXNjb3Zlckh5cGVydGllc1BlclVzZXJQcm9maWxlRGF0YV0gRXJyb3IgUmVwbHkgZm9yIFwiICsgdXNlcklkZW50aWZpZXIgKyBcIiBSZWFzb246IFwiLCByZXBseS5ib2R5LmRlc2NyaXB0aW9uKTtcclxuICAgICAgICAgICAgcmVzb2x2ZShbXSk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgcmVzb2x2ZShbe2h5cGVydHlJRDogdXNlcklkZW50aWZpZXIsIHN0YXR1czogJ2xpdmUnfV0pO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICogQWR2YW5jZWQgU2VhcmNoIGZvciBIeXBlcnRpZXMgcmVnaXN0ZXJlZCBpbiBkb21haW4gcmVnaXN0cnkgYXNzb2NpYXRlZCB3aXRoIHNvbWUgdXNlciBpZGVudGlmaWVyIChlZyBlbWFpbCwgbmFtZSAuLi4pXHJcbiAgKiByZXR1cm5zIERpc2NvdmVyZWRPYmplY3RcclxuICAqIEBwYXJhbSAge1N0cmluZ30gICAgICAgICAgIHVzZXJJZGVudGlmaWVyXHJcbiAgKiBAcGFyYW0gIHtBcnJheTxzdHJpbmc+fSAgICBzY2hlbWEgKE9wdGlvbmFsKSAgICAgdHlwZXMgb2YgaHlwZXJ0aWVzIHNjaGVtYXNcclxuICAqIEBwYXJhbSAge0FycmF5PHN0cmluZz59ICAgIHJlc291cmNlcyAoT3B0aW9uYWwpICB0eXBlcyBvZiBoeXBlcnRpZXMgcmVzb3VyY2VzXHJcbiAgKi9cclxuICBkaXNjb3Zlckh5cGVydGllc1BlclVzZXJQcm9maWxlRGF0YURPKHVzZXJJZGVudGlmaWVyLCBzY2hlbWEsIHJlc291cmNlcykge1xyXG5cclxuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XHJcbiAgICAgIHRoaXMuZGlzY292ZXJIeXBlcnRpZXNQZXJVc2VyUHJvZmlsZURhdGEoLi4uYXJndW1lbnRzKVxyXG4gICAgICAudGhlbihoeXBlcnRpZXMgPT4ge1xyXG4gICAgICAgIHJlc29sdmUodGhpcy5fY29udmVydFRvRGlzY292ZXJlZE9iamVjdChoeXBlcnRpZXMpKTtcclxuICAgICAgfSlcclxuICAgICAgLmNhdGNoKGVycm9yID0+IHJlamVjdChlcnJvcikpO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAqIEFkdmFuY2VkIFNlYXJjaCBmb3IgRGF0YU9iamVjdHMgcmVnaXN0ZXJlZCBpbiBkb21haW4gcmVnaXN0cnkgYXNzb2NpYXRlZCB3aXRoIHNvbWUgdXNlciBpZGVudGlmaWVyIChlZyBlbWFpbCwgbmFtZSAuLi4pXHJcbiAgKiBAcGFyYW0gIHtTdHJpbmd9ICAgICAgICAgICB1c2VySWRlbnRpZmllclxyXG4gICogQHBhcmFtICB7QXJyYXk8c3RyaW5nPn0gICAgc2NoZW1hIChPcHRpb25hbCkgICAgIHR5cGVzIG9mIGh5cGVydGllcyBzY2hlbWFzXHJcbiAgKiBAcGFyYW0gIHtBcnJheTxzdHJpbmc+fSAgICByZXNvdXJjZXMgKE9wdGlvbmFsKSAgdHlwZXMgb2YgaHlwZXJ0aWVzIHJlc291cmNlc1xyXG4gICovXHJcbiAgZGlzY292ZXJEYXRhT2JqZWN0c1BlclVzZXJQcm9maWxlRGF0YSh1c2VySWRlbnRpZmllciwgc2NoZW1hLCByZXNvdXJjZXMpIHtcclxuICAgIGxldCBfdGhpcyA9IHRoaXM7XHJcblxyXG4gICAgbGV0IG1zZyA9IHtcclxuICAgICAgdHlwZTogJ3JlYWQnLFxyXG4gICAgICBmcm9tOiBfdGhpcy5kaXNjb3ZlcnlVUkwsXHJcbiAgICAgIHRvOiBfdGhpcy5ydW50aW1lVVJMICsgJy9kaXNjb3ZlcnkvJyxcclxuICAgICAgYm9keToge1xyXG4gICAgICAgIHJlc291cmNlOiAnL2RhdGFPYmplY3QvdXNlcnByb2ZpbGUvJyArIHVzZXJJZGVudGlmaWVyLFxyXG4gICAgICB9XHJcbiAgICB9O1xyXG5cclxuICAgIGlmKHNjaGVtYSB8fCByZXNvdXJjZXMpIHtcclxuICAgICAgbXNnLmJvZHlbJ2NyaXRlcmlhJ10gPSB7XHJcbiAgICAgICAgcmVzb3VyY2VzOiByZXNvdXJjZXMsXHJcbiAgICAgICAgZGF0YVNjaGVtZXM6IHNjaGVtYVxyXG4gICAgICB9O1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuXHJcbiAgICAgIGlmICghX3RoaXMuX2lzTGVnYWN5VXNlcih1c2VySWRlbnRpZmllcikpIHsvLyB0b2RvOiB0byByZW9tdmUgd2hlbiBkaXNjb3Zlcnkgb2YgbGVnY2F5IHVzZXJzIGFyZSBzdXBwb3J0ZWRcclxuXHJcbiAgICAgICAgX3RoaXMubWVzc2FnZUJ1cy5wb3N0TWVzc2FnZShtc2csIChyZXBseSkgPT4ge1xyXG5cclxuICAgICAgICAgIGlmKHJlcGx5LmJvZHkuY29kZSA9PT0gMjAwKXtcclxuICAgICAgICAgICAgbG9nLmxvZyhcIlJlcGx5IGxvZzogXCIscmVwbHkuYm9keS52YWx1ZSk7XHJcbiAgICAgICAgICAgIHJlc29sdmUocmVwbHkuYm9keS52YWx1ZSk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgbG9nLndhcm4oXCJbRGlzY292ZXJ5LmRpc2NvdmVyRGF0YU9iamVjdHNQZXJVc2VyUHJvZmlsZURhdGFdIEVycm9yIFJlcGx5IGZvciBcIiArIHVzZXJJZGVudGlmaWVyICsgXCIgUmVhc29uOiBcIiwgcmVwbHkuYm9keS5kZXNjcmlwdGlvbik7XHJcbiAgICAgICAgICAgIHJlc29sdmUoW10pO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgcmVzb2x2ZShbe2h5cGVydHlJRDogdXNlcklkZW50aWZpZXIsIHN0YXR1czogJ2xpdmUnfV0pO1xyXG4gICAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgKiBmdW5jdGlvbiB0byByZXF1ZXN0IGFib3V0IGRhdGFPYmplY3QgcmVnaXN0ZXJlZCBpbiBkb21haW4gcmVnaXN0cnksIGFuZFxyXG4gICogcmV0dXJucyBkaXNjb3ZlcmVkT2JqZWN0LlxyXG4gICogQHBhcmFtICB7U3RyaW5nfSAgICAgICAgICAgZ3VpZFVSTCAgICAgICAgICAgICAgICBndWlkIFVSTCBlLmcgdXNlci1ndWlkOi8vPHVuaXF1ZS11c2VyLWlkZW50aWZpZXI+XHJcbiAgKiBAcGFyYW0gIHtBcnJheTxzdHJpbmc+fSAgICBzY2hlbWEgKE9wdGlvbmFsKSAgICAgdHlwZXMgb2YgaHlwZXJ0aWVzIHNjaGVtYXNcclxuICAqIEBwYXJhbSAge0FycmF5PHN0cmluZz59ICAgIHJlc291cmNlcyAoT3B0aW9uYWwpICB0eXBlcyBvZiBoeXBlcnRpZXMgcmVzb3VyY2VzXHJcbiAgKiBAcGFyYW0gIHtTdHJpbmd9ICAgICAgICAgICBkb21haW4gKE9wdGlvbmFsKSAgICAgZG9tYWluIG9mIHRoZSByZWdpc3RyeSB0byBzZWFyY2hcclxuICAqL1xyXG4gIGRpc2NvdmVyRGF0YU9iamVjdHNQZXJVc2VyUHJvZmlsZURhdGFETyhndWlkVVJMLCBzY2hlbWEsIHJlc291cmNlcykge1xyXG5cclxuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XHJcbiAgICAgIHRoaXMuZGlzY292ZXJEYXRhT2JqZWN0c1BlclVzZXJQcm9maWxlRGF0YSguLi5hcmd1bWVudHMpXHJcbiAgICAgICAgLnRoZW4ocmVnaXN0cnlPYmplY3RzID0+IHJlc29sdmUodGhpcy5fY29udmVydFRvRGlzY292ZXJlZE9iamVjdChyZWdpc3RyeU9iamVjdHMpKSlcclxuICAgICAgICAuY2F0Y2goZXJyb3IgPT4gcmVqZWN0KGVycm9yKSk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICogQWR2YW5jZWQgU2VhcmNoIGZvciBIeXBlcnRpZXMgcmVnaXN0ZXJlZCBpbiBkb21haW4gcmVnaXN0cnkgYXNzb2NpYXRlZCB3aXRoIHNvbWUgR1VJRFxyXG4gICogQHBhcmFtICB7U3RyaW5nfSAgICAgICAgICAgZ3VpZFVSTCAgICAgICAgICAgICAgICBndWlkIFVSTCBlLmcgdXNlci1ndWlkOi8vPHVuaXF1ZS11c2VyLWlkZW50aWZpZXI+XHJcbiAgKiBAcGFyYW0gIHtBcnJheTxzdHJpbmc+fSAgICBzY2hlbWEgKE9wdGlvbmFsKSAgICAgdHlwZXMgb2YgaHlwZXJ0aWVzIHNjaGVtYXNcclxuICAqIEBwYXJhbSAge0FycmF5PHN0cmluZz59ICAgIHJlc291cmNlcyAoT3B0aW9uYWwpICB0eXBlcyBvZiBoeXBlcnRpZXMgcmVzb3VyY2VzXHJcbiAgKi9cclxuICBkaXNjb3Zlckh5cGVydGllc1BlckdVSUQoZ3VpZFVSTCwgc2NoZW1hLCByZXNvdXJjZXMpIHtcclxuICAgIGxldCBfdGhpcyA9IHRoaXM7XHJcbiAgICBsZXQgZmlsdGVyZWRIeXBlcnRpZXMgPSBbXTtcclxuXHJcbiAgICBsZXQgbXNnID0ge1xyXG4gICAgICB0eXBlOiAncmVhZCcsXHJcbiAgICAgIGZyb206IF90aGlzLmRpc2NvdmVyeVVSTCxcclxuICAgICAgdG86IF90aGlzLnJ1bnRpbWVVUkwgKyAnL2Rpc2NvdmVyeS8nLFxyXG4gICAgICBib2R5OiB7XHJcbiAgICAgICAgcmVzb3VyY2U6ICcvaHlwZXJ0eS9ndWlkLycgKyBndWlkVVJMLFxyXG4gICAgICB9XHJcbiAgICB9O1xyXG5cclxuICAgIGlmKHNjaGVtYSB8fCByZXNvdXJjZXMpIHtcclxuICAgICAgbXNnLmJvZHlbJ2NyaXRlcmlhJ10gPSB7XHJcbiAgICAgICAgcmVzb3VyY2VzOiByZXNvdXJjZXMsXHJcbiAgICAgICAgZGF0YVNjaGVtZXM6IHNjaGVtYVxyXG4gICAgICB9O1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuXHJcbiAgICAgIF90aGlzLm1lc3NhZ2VCdXMucG9zdE1lc3NhZ2UobXNnLCAocmVwbHkpID0+IHtcclxuXHJcbiAgICAgICAgaWYocmVwbHkuYm9keS5jb2RlID09PSAyMDApe1xyXG4gICAgICAgICAgcmVwbHkuYm9keS52YWx1ZS5tYXAoZnVuY3Rpb24oaHlwZXJ0eSkge1xyXG4gICAgICAgICAgICAgaWYoaHlwZXJ0eS5oeXBlcnR5SUQgIT0gX3RoaXMuZGlzY292ZXJ5VVJMKVxyXG4gICAgICAgICAgICAgICAgIGZpbHRlcmVkSHlwZXJ0aWVzLnB1c2goaHlwZXJ0eSk7XHJcbiAgICAgICAgICB9KTtcclxuICAgICAgICAgIGlmKGZpbHRlcmVkSHlwZXJ0aWVzLmxlbmd0aCA9PT0gMClcclxuICAgICAgICAgICAgcmVqZWN0KCdObyBIeXBlcnR5IHdhcyBmb3VuZCcpO1xyXG4gICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIGxvZy5sb2coXCJSZXBseSBsb2c6IFwiLGZpbHRlcmVkSHlwZXJ0aWVzKTtcclxuICAgICAgICAgICAgcmVzb2x2ZShmaWx0ZXJlZEh5cGVydGllcyk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgbG9nLndhcm4oXCJbRGlzY292ZXJ5LmRpc2NvdmVySHlwZXJ0aWVzUGVyR1VJRF0gRXJyb3IgUmVwbHkgZm9yIFwiICsgZ3VpZFVSTCArIFwiIFJlYXNvbjogXCIsIHJlcGx5LmJvZHkuZGVzY3JpcHRpb24pO1xyXG4gICAgICAgICAgcmVzb2x2ZShbXSk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgKiBBZHZhbmNlZCBTZWFyY2ggZm9yIEh5cGVydGllcyByZWdpc3RlcmVkIGluIGRvbWFpbiByZWdpc3RyeSBhc3NvY2lhdGVkIHdpdGggc29tZSBHVUlEXHJcbiAgKiByZXR1cm5zIERpc2NvdmVyZWRPYmplY3RcclxuICAqIEBwYXJhbSAge1N0cmluZ30gICAgICAgICAgIGd1aWRVUkwgICAgICAgICAgICAgICAgZ3VpZCBVUkwgZS5nIHVzZXItZ3VpZDovLzx1bmlxdWUtdXNlci1pZGVudGlmaWVyPlxyXG4gICogQHBhcmFtICB7QXJyYXk8c3RyaW5nPn0gICAgc2NoZW1hIChPcHRpb25hbCkgICAgIHR5cGVzIG9mIGh5cGVydGllcyBzY2hlbWFzXHJcbiAgKiBAcGFyYW0gIHtBcnJheTxzdHJpbmc+fSAgICByZXNvdXJjZXMgKE9wdGlvbmFsKSAgdHlwZXMgb2YgaHlwZXJ0aWVzIHJlc291cmNlc1xyXG4gICovXHJcbiAgZGlzY292ZXJIeXBlcnRpZXNQZXJHVUlERE8oZ3VpZFVSTCwgc2NoZW1hLCByZXNvdXJjZXMpIHtcclxuXHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xyXG4gICAgICB0aGlzLmRpc2NvdmVySHlwZXJ0aWVzUGVyR1VJRCguLi5hcmd1bWVudHMpXHJcbiAgICAgIC50aGVuKGh5cGVydGllcyA9PiB7XHJcbiAgICAgICAgcmVzb2x2ZSh0aGlzLl9jb252ZXJ0VG9EaXNjb3ZlcmVkT2JqZWN0KGh5cGVydGllcykpO1xyXG4gICAgICB9KVxyXG4gICAgICAuY2F0Y2goZXJyb3IgPT4gcmVqZWN0KGVycm9yKSk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICogQWR2YW5jZWQgU2VhcmNoIGZvciBEYXRhT2JqZWN0cyByZWdpc3RlcmVkIGluIGRvbWFpbiByZWdpc3RyeSBhc3NvY2lhdGVkIHdpdGggc29tZSBHVUlEXHJcbiAgKiBAcGFyYW0gIHtTdHJpbmd9ICAgICAgICAgICBndWlkVVJMICAgICAgICAgICAgICAgIGd1aWQgVVJMIGUuZyB1c2VyLWd1aWQ6Ly88dW5pcXVlLXVzZXItaWRlbnRpZmllcj5cclxuICAqIEBwYXJhbSAge0FycmF5PHN0cmluZz59ICAgIHNjaGVtYSAoT3B0aW9uYWwpICAgICB0eXBlcyBvZiBoeXBlcnRpZXMgc2NoZW1hc1xyXG4gICogQHBhcmFtICB7QXJyYXk8c3RyaW5nPn0gICAgcmVzb3VyY2VzIChPcHRpb25hbCkgIHR5cGVzIG9mIGh5cGVydGllcyByZXNvdXJjZXNcclxuICAqIEBwYXJhbSAge1N0cmluZ30gICAgICAgICAgIGRvbWFpbiAoT3B0aW9uYWwpICAgICBkb21haW4gb2YgdGhlIHJlZ2lzdHJ5IHRvIHNlYXJjaFxyXG4gICovXHJcbiAgZGlzY292ZXJEYXRhT2JqZWN0c1BlckdVSUQoZ3VpZFVSTCwgc2NoZW1hLCByZXNvdXJjZXMpIHtcclxuICAgIGxldCBfdGhpcyA9IHRoaXM7XHJcblxyXG4gICAgbGV0IG1zZyA9IHtcclxuICAgICAgdHlwZTogJ3JlYWQnLFxyXG4gICAgICBmcm9tOiBfdGhpcy5kaXNjb3ZlcnlVUkwsXHJcbiAgICAgIHRvOiBfdGhpcy5ydW50aW1lVVJMICsgJy9kaXNjb3ZlcnkvJyxcclxuICAgICAgYm9keToge1xyXG4gICAgICAgIHJlc291cmNlOiAnL2RhdGFPYmplY3QvZ3VpZC8nICsgZ3VpZFVSTCxcclxuICAgICAgfVxyXG4gICAgfTtcclxuXHJcbiAgICBpZihzY2hlbWEgfHwgcmVzb3VyY2VzKSB7XHJcbiAgICAgIG1zZy5ib2R5Wydjcml0ZXJpYSddID0ge1xyXG4gICAgICAgIHJlc291cmNlczogcmVzb3VyY2VzLFxyXG4gICAgICAgIGRhdGFTY2hlbWVzOiBzY2hlbWFcclxuICAgICAgfTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcblxyXG4gICAgICBfdGhpcy5tZXNzYWdlQnVzLnBvc3RNZXNzYWdlKG1zZywgKHJlcGx5KSA9PiB7XHJcblxyXG4gICAgICAgIGlmKHJlcGx5LmJvZHkuY29kZSA9PT0gMjAwKXtcclxuICAgICAgICAgIGxvZy5sb2coXCJSZXBseSBsb2c6IFwiLHJlcGx5LmJvZHkudmFsdWUpO1xyXG4gICAgICAgICAgcmVzb2x2ZShyZXBseS5ib2R5LnZhbHVlKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICBsb2cud2FybihcIltEaXNjb3ZlcnkuZGlzY292ZXJEYXRhT2JqZWN0c1BlckdVSURdIEVycm9yIFJlcGx5IGZvciBcIiArIGd1aWRVUkwgKyBcIiBSZWFzb246IFwiLCByZXBseS5ib2R5LmRlc2NyaXB0aW9uKTtcclxuICAgICAgICAgIHJlc29sdmUoW10pO1xyXG4gICAgICAgIH1cclxuICAgICAgfSk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICogZnVuY3Rpb24gdG8gcmVxdWVzdCBhYm91dCBkYXRhT2JqZWN0IHJlZ2lzdGVyZWQgaW4gZG9tYWluIHJlZ2lzdHJ5LCBhbmRcclxuICAqIHJldHVybnMgZGlzY292ZXJlZE9iamVjdC5cclxuICAqIEBwYXJhbSAge1N0cmluZ30gICAgICAgICAgIGd1aWRVUkwgICAgICAgICAgICAgICAgZ3VpZCBVUkwgZS5nIHVzZXItZ3VpZDovLzx1bmlxdWUtdXNlci1pZGVudGlmaWVyPlxyXG4gICogQHBhcmFtICB7QXJyYXk8c3RyaW5nPn0gICAgc2NoZW1hIChPcHRpb25hbCkgICAgIHR5cGVzIG9mIGh5cGVydGllcyBzY2hlbWFzXHJcbiAgKiBAcGFyYW0gIHtBcnJheTxzdHJpbmc+fSAgICByZXNvdXJjZXMgKE9wdGlvbmFsKSAgdHlwZXMgb2YgaHlwZXJ0aWVzIHJlc291cmNlc1xyXG4gICogQHBhcmFtICB7U3RyaW5nfSAgICAgICAgICAgZG9tYWluIChPcHRpb25hbCkgICAgIGRvbWFpbiBvZiB0aGUgcmVnaXN0cnkgdG8gc2VhcmNoXHJcbiAgKi9cclxuICBkaXNjb3ZlckRhdGFPYmplY3RzUGVyR1VJRERPKGd1aWRVUkwsIHNjaGVtYSwgcmVzb3VyY2VzKSB7XHJcblxyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcclxuICAgICAgdGhpcy5kaXNjb3ZlckRhdGFPYmplY3RzUGVyR1VJRCguLi5hcmd1bWVudHMpXHJcbiAgICAgICAgLnRoZW4ocmVnaXN0cnlPYmplY3RzID0+IHJlc29sdmUodGhpcy5fY29udmVydFRvRGlzY292ZXJlZE9iamVjdChyZWdpc3RyeU9iamVjdHMpKSlcclxuICAgICAgICAuY2F0Y2goZXJyb3IgPT4gcmVqZWN0KGVycm9yKSk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8qKiBBZHZhbmNlZCBTZWFyY2ggZm9yIEh5cGVydGllcyByZWdpc3RlcmVkIGluIGRvbWFpbiByZWdpc3RyeVxyXG4gICogQHBhcmFtICB7U3RyaW5nfSAgICAgICAgICAgdXNlciAgICAgICAgICAgICAgICAgIHVzZXIgaWRlbnRpZmllciwgZWl0aGVyIGluIHVybCBvciBlbWFpbCBmb3JtYXRcclxuICAqIEBwYXJhbSAge0FycmF5PHN0cmluZz59ICAgIHNjaGVtYSAoT3B0aW9uYWwpICAgICB0eXBlcyBvZiBoeXBlcnRpZXMgc2NoZW1hc1xyXG4gICogQHBhcmFtICB7QXJyYXk8c3RyaW5nPn0gICAgcmVzb3VyY2VzIChPcHRpb25hbCkgIHR5cGVzIG9mIGh5cGVydGllcyByZXNvdXJjZXNcclxuICAqIEBwYXJhbSAge1N0cmluZ30gICAgICAgICAgIGRvbWFpbiAoT3B0aW9uYWwpICAgICBkb21haW4gb2YgdGhlIHJlZ2lzdHJ5IHRvIHNlYXJjaFxyXG4gICovXHJcbiAgZGlzY292ZXJIeXBlcnRpZXModXNlciwgc2NoZW1hLCByZXNvdXJjZXMsIGRvbWFpbikge1xyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuICAgIGxldCBhY3RpdmVEb21haW47XHJcbiAgICBsZXQgZmlsdGVyZWRIeXBlcnRpZXMgPSBbXTtcclxuXHJcbiAgICBhY3RpdmVEb21haW4gPSAoIWRvbWFpbikgPyBfdGhpcy5kb21haW4gOiBkb21haW47XHJcblxyXG4gICAgbGV0IG1zZyA9IHtcclxuICAgICAgdHlwZTogJ3JlYWQnLFxyXG4gICAgICBmcm9tOiBfdGhpcy5kaXNjb3ZlcnlVUkwsXHJcbiAgICAgIHRvOiBfdGhpcy5ydW50aW1lVVJMICsgJy9kaXNjb3ZlcnkvJyxcclxuICAgICAgYm9keToge1xyXG4gICAgICAgIHJlc291cmNlOiAnL2h5cGVydHkvdXNlci8nICsgdXNlcixcclxuICAgICAgfVxyXG4gICAgfTtcclxuXHJcbiAgICBpZihzY2hlbWEgfHwgcmVzb3VyY2VzKSB7XHJcbiAgICAgIG1zZy5ib2R5Wydjcml0ZXJpYSddID0ge1xyXG4gICAgICAgIHJlc291cmNlczogcmVzb3VyY2VzLFxyXG4gICAgICAgIGRhdGFTY2hlbWVzOiBzY2hlbWEsXHJcbiAgICAgICAgZG9tYWluOiBhY3RpdmVEb21haW5cclxuICAgICAgfTtcclxuICAgIH1lbHNlIHtcclxuICAgICAgbXNnLmJvZHlbJ2NyaXRlcmlhJ10gPSB7XHJcbiAgICAgICAgZG9tYWluOiBhY3RpdmVEb21haW5cclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuXHJcbiAgICAgIGlmICghX3RoaXMuX2lzTGVnYWN5VXNlcih1c2VyKSkgey8vIHRvZG86IHRvIHJlb212ZSB3aGVuIGRpc2NvdmVyeSBvZiBsZWdjYXkgdXNlcnMgYXJlIHN1cHBvcnRlZFxyXG5cclxuICAgICAgICBfdGhpcy5tZXNzYWdlQnVzLnBvc3RNZXNzYWdlKG1zZywgKHJlcGx5KSA9PiB7XHJcblxyXG4gICAgICAgICAgaWYocmVwbHkuYm9keS5jb2RlID09PSAyMDAgfHwgcmVwbHkuYm9keS5jb2RlID09PSA1MDApe1xyXG4gICAgICAgICAgICByZXBseS5ib2R5LnZhbHVlLm1hcChmdW5jdGlvbihoeXBlcnR5KSB7XHJcbiAgICAgICAgICAgICAgIGlmKGh5cGVydHkuaHlwZXJ0eUlEICE9IF90aGlzLmRpc2NvdmVyeVVSTClcclxuICAgICAgICAgICAgICAgICAgIGZpbHRlcmVkSHlwZXJ0aWVzLnB1c2goaHlwZXJ0eSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4vKiAgICAgICAgICAgIGlmKGZpbHRlcmVkSHlwZXJ0aWVzLmxlbmd0aCA9PT0gMClcclxuICAgICAgICAgICAgICByZWplY3QoJ05vIEh5cGVydHkgd2FzIGZvdW5kJyk7XHJcbiAgICAgICAgICAgIGVsc2UgeyovXHJcbiAgICAgICAgICAgICAgbG9nLmxvZyhcIltEaXNjb3ZlcnkuZGlzY292ZXJIeXBlcnRpZXNdIFJlcGx5IDogXCIsZmlsdGVyZWRIeXBlcnRpZXMpO1xyXG4gICAgICAgICAgICAgIHJlc29sdmUoZmlsdGVyZWRIeXBlcnRpZXMpO1xyXG4vLyAgICAgICAgICAgIH1cclxuICAgICAgICAgIH1cclxuICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICBsb2cud2FybihcIltEaXNjb3ZlcnkuZGlzY292ZXJIeXBlcnRpZXNdIEVycm9yIFJlcGx5IGZvciBcIiArIHVzZXIgKyBcIiBSZWFzb246IFwiLCByZXBseS5ib2R5LmRlc2NyaXB0aW9uKTtcclxuICAgICAgICAgICAgcmVzb2x2ZShmaWx0ZXJlZEh5cGVydGllcyk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgcmVzb2x2ZShbe2h5cGVydHlJRDogdXNlciwgc3RhdHVzOiAnbGl2ZSd9XSk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqIEFkdmFuY2VkIFNlYXJjaCBmb3IgSHlwZXJ0aWVzIHJlZ2lzdGVyZWQgaW4gZG9tYWluIHJlZ2lzdHJ5LFxyXG4gICpyZXR1cm5zIERpc2NvdmVyZWRPYmplY3RcclxuICAqIEBwYXJhbSAge1N0cmluZ30gICAgICAgICAgIHVzZXIgICAgICAgICAgICAgICAgICB1c2VyIGlkZW50aWZpZXIsIGVpdGhlciBpbiB1cmwgb3IgZW1haWwgZm9ybWF0XHJcbiAgKiBAcGFyYW0gIHtBcnJheTxzdHJpbmc+fSAgICBzY2hlbWEgKE9wdGlvbmFsKSAgICAgdHlwZXMgb2YgaHlwZXJ0aWVzIHNjaGVtYXNcclxuICAqIEBwYXJhbSAge0FycmF5PHN0cmluZz59ICAgIHJlc291cmNlcyAoT3B0aW9uYWwpICB0eXBlcyBvZiBoeXBlcnRpZXMgcmVzb3VyY2VzXHJcbiAgKiBAcGFyYW0gIHtTdHJpbmd9ICAgICAgICAgICBkb21haW4gKE9wdGlvbmFsKSAgICAgZG9tYWluIG9mIHRoZSByZWdpc3RyeSB0byBzZWFyY2hcclxuICAqL1xyXG4gIGRpc2NvdmVySHlwZXJ0aWVzRE8odXNlciwgc2NoZW1hLCByZXNvdXJjZXMsIGRvbWFpbikge1xyXG5cclxuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XHJcbiAgICAgIHRoaXMuZGlzY292ZXJIeXBlcnRpZXMoLi4uYXJndW1lbnRzKVxyXG4gICAgICAudGhlbihoeXBlcnRpZXMgPT4ge1xyXG4gICAgICAgIHJlc29sdmUodGhpcy5fY29udmVydFRvRGlzY292ZXJlZE9iamVjdChoeXBlcnRpZXMpKTtcclxuICAgICAgfSlcclxuICAgICAgLmNhdGNoKGVycm9yID0+IHJlamVjdChlcnJvcikpO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvKiogQWR2YW5jZWQgU2VhcmNoIGZvciBEYXRhT2JqZWN0cyByZWdpc3RlcmVkIGluIGRvbWFpbiByZWdpc3RyeVxyXG4gICogQHBhcmFtICB7U3RyaW5nfSAgICAgICAgICAgdXNlciAgICAgICAgICAgICAgICAgIHVzZXIgaWRlbnRpZmllciwgZWl0aGVyIGluIHVybCBvciBlbWFpbCBmb3JtYXRcclxuICAqIEBwYXJhbSAge0FycmF5PHN0cmluZz59ICAgIHNjaGVtYSAoT3B0aW9uYWwpICAgICB0eXBlcyBvZiBkYXRhT2JqZWN0cyBzY2hlbWFzXHJcbiAgKiBAcGFyYW0gIHtBcnJheTxzdHJpbmc+fSAgICByZXNvdXJjZXMgKE9wdGlvbmFsKSAgdHlwZXMgb2YgZGF0YU9iamVjdHMgcmVzb3VyY2VzXHJcbiAgKiBAcGFyYW0gIHtTdHJpbmd9ICAgICAgICAgICBkb21haW4gKE9wdGlvbmFsKSAgICAgZG9tYWluIG9mIHRoZSByZWdpc3RyeSB0byBzZWFyY2hcclxuICAqL1xyXG4gIGRpc2NvdmVyRGF0YU9iamVjdHModXNlciwgc2NoZW1hLCByZXNvdXJjZXMsIGRvbWFpbikge1xyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuICAgIGxldCBhY3RpdmVEb21haW47XHJcblxyXG4gICAgYWN0aXZlRG9tYWluID0gKCFkb21haW4pID8gX3RoaXMuZG9tYWluIDogZG9tYWluO1xyXG5cclxuICAgIGxldCBtc2cgPSB7XHJcbiAgICAgIHR5cGU6ICdyZWFkJyxcclxuICAgICAgZnJvbTogX3RoaXMuZGlzY292ZXJ5VVJMLFxyXG4gICAgICB0bzogX3RoaXMucnVudGltZVVSTCArICcvZGlzY292ZXJ5LycsXHJcbiAgICAgIGJvZHk6IHtcclxuICAgICAgICByZXNvdXJjZTogJy9kYXRhT2JqZWN0L3VzZXIvJyArIHVzZXIsXHJcbiAgICAgIH1cclxuICAgIH07XHJcblxyXG4gICAgaWYoc2NoZW1hIHx8IHJlc291cmNlcykge1xyXG4gICAgICBtc2cuYm9keVsnY3JpdGVyaWEnXSA9IHtcclxuICAgICAgICByZXNvdXJjZXM6IHJlc291cmNlcyxcclxuICAgICAgICBkYXRhU2NoZW1lczogc2NoZW1hLFxyXG4gICAgICAgIGRvbWFpbjogYWN0aXZlRG9tYWluXHJcbiAgICAgIH07XHJcbiAgICB9ZWxzZSB7XHJcbiAgICAgIG1zZy5ib2R5Wydjcml0ZXJpYSddID0ge1xyXG4gICAgICAgIGRvbWFpbjogYWN0aXZlRG9tYWluXHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcblxyXG4gICAgICBfdGhpcy5tZXNzYWdlQnVzLnBvc3RNZXNzYWdlKG1zZywgKHJlcGx5KSA9PiB7XHJcblxyXG4gICAgICAgIGlmKHJlcGx5LmJvZHkuY29kZSA9PT0gMjAwKXtcclxuICAgICAgICAgIGxvZy5sb2coXCJSZXBseSBWYWx1ZSBMb2c6IFwiLHJlcGx5LmJvZHkudmFsdWUpO1xyXG4gICAgICAgICAgcmVzb2x2ZShyZXBseS5ib2R5LnZhbHVlKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICBsb2cud2FybihcIltEaXNjb3ZlcnkuZGlzY292ZXJEYXRhT2JqZWN0c10gRXJyb3IgUmVwbHkgZm9yIFwiICsgdXNlciArIFwiIFJlYXNvbjogXCIsIHJlcGx5LmJvZHkuZGVzY3JpcHRpb24pO1xyXG4gICAgICAgICAgcmVzb2x2ZShbXSk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgKiBmdW5jdGlvbiB0byByZXF1ZXN0IGFib3V0IGRhdGFPYmplY3QgcmVnaXN0ZXJlZCBpbiBkb21haW4gcmVnaXN0cnksIGFuZFxyXG4gICogcmV0dXJucyBkaXNjb3ZlcmVkT2JqZWN0LlxyXG4gICogQHBhcmFtICB7U3RyaW5nfSAgICAgICAgICAgdXNlciAgICAgICAgICAgICAgICAgIHVzZXIgaWRlbnRpZmllciwgZWl0aGVyIGluIHVybCBvciBlbWFpbCBmb3JtYXRcclxuICAqIEBwYXJhbSAge0FycmF5PHN0cmluZz59ICAgIHNjaGVtYSAoT3B0aW9uYWwpICAgICB0eXBlcyBvZiBkYXRhT2JqZWN0cyBzY2hlbWFzXHJcbiAgKiBAcGFyYW0gIHtBcnJheTxzdHJpbmc+fSAgICByZXNvdXJjZXMgKE9wdGlvbmFsKSAgdHlwZXMgb2YgZGF0YU9iamVjdHMgcmVzb3VyY2VzXHJcbiAgKiBAcGFyYW0gIHtTdHJpbmd9ICAgICAgICAgICBkb21haW4gKE9wdGlvbmFsKSAgICAgZG9tYWluIG9mIHRoZSByZWdpc3RyeSB0byBzZWFyY2hcclxuICAqL1xyXG4gIGRpc2NvdmVyRGF0YU9iamVjdHNETyh1c2VyLCBzY2hlbWEsIHJlc291cmNlcywgZG9tYWluKSB7XHJcblxyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcclxuICAgICAgdGhpcy5kaXNjb3ZlckRhdGFPYmplY3RzKC4uLmFyZ3VtZW50cylcclxuICAgICAgICAudGhlbihyZWdpc3RyeU9iamVjdHMgPT4gcmVzb2x2ZSh0aGlzLl9jb252ZXJ0VG9EaXNjb3ZlcmVkT2JqZWN0KHJlZ2lzdHJ5T2JqZWN0cykpKVxyXG4gICAgICAgIC5jYXRjaChlcnJvciA9PiByZWplY3QoZXJyb3IpKTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgKiBmdW5jdGlvbiB0byByZXF1ZXN0IGFib3V0IGh5cGVydGllcyByZWdpc3RlcmVkIGluIGRvbWFpbiByZWdpc3RyeSwgYW5kXHJcbiAgKiByZXR1cm4gdGhlIGh5cGVydHkgaW5mb3JtYXRpb24sIGlmIGZvdW5kLlxyXG4gICogQHBhcmFtICB7U3RyaW5nfSAgICAgICAgICAgICAgdXJsICBoeXBlcnR5IFVSTFxyXG4gICogQHBhcmFtICB7U3RyaW5nfSAgICAgICAgICAgIGRvbWFpbiAoT3B0aW9uYWwpXHJcbiAgKi9cclxuICBkaXNjb3Zlckh5cGVydHlQZXJVUkwodXJsLCBkb21haW4pIHtcclxuICAgIGxldCBfdGhpcyA9IHRoaXM7XHJcbiAgICBsZXQgYWN0aXZlRG9tYWluO1xyXG5cclxuICAgIGFjdGl2ZURvbWFpbiA9ICghZG9tYWluKSA/IF90aGlzLmRvbWFpbiA6IGRvbWFpbjtcclxuXHJcbiAgICBsZXQgbXNnID0ge1xyXG4gICAgICB0eXBlOiAncmVhZCcsXHJcbiAgICAgIGZyb206IF90aGlzLmRpc2NvdmVyeVVSTCxcclxuICAgICAgdG86IF90aGlzLnJ1bnRpbWVVUkwgKyAnL2Rpc2NvdmVyeS8nLFxyXG4gICAgICBib2R5OiB7XHJcbiAgICAgICAgcmVzb3VyY2U6ICcvaHlwZXJ0eS91cmwvJyArIHVybCxcclxuICAgICAgICBjcml0ZXJpYToge1xyXG4gICAgICAgICAgZG9tYWluOiBhY3RpdmVEb21haW5cclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH07XHJcblxyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG5cclxuICAgICAgX3RoaXMubWVzc2FnZUJ1cy5wb3N0TWVzc2FnZShtc2csIChyZXBseSkgPT4ge1xyXG5cclxuICAgICAgICBpZihyZXBseS5ib2R5LmNvZGUgPT09IDIwMCl7XHJcbiAgICAgICAgICBsb2cubG9nKFwiUmVwbHkgVmFsdWUgTG9nOiBcIixyZXBseS5ib2R5LnZhbHVlKTtcclxuICAgICAgICAgIHJlc29sdmUocmVwbHkuYm9keS52YWx1ZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgbG9nLndhcm4oXCJbRGlzY292ZXJ5LmRpc2NvdmVySHlwZXJ0eVBlclVSTF0gRXJyb3IgUmVwbHkgZm9yIFwiICsgdXJsICsgXCIgUmVhc29uOiBcIiwgcmVwbHkuYm9keS5kZXNjcmlwdGlvbik7XHJcbiAgICAgICAgICByZXNvbHZlKFtdKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAqIGZ1bmN0aW9uIHRvIHJlcXVlc3QgYWJvdXQgaHlwZXJ0aWVzIHJlZ2lzdGVyZWQgaW4gZG9tYWluIHJlZ2lzdHJ5LCBhbmRcclxuICAqIHJldHVybnMgZGlzY292ZXJlZE9iamVjdC5cclxuICAqIEBwYXJhbSAge1N0cmluZ30gICAgICAgICAgICAgIHVybCAgaHlwZXJ0eSBVUkxcclxuICAqIEBwYXJhbSAge1N0cmluZ30gICAgICAgICAgICBkb21haW4gKE9wdGlvbmFsKVxyXG4gICovXHJcbiAgZGlzY292ZXJIeXBlcnR5UGVyVVJMRE8odXJsLCBkb21haW4pIHtcclxuXHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xyXG4gICAgICB0aGlzLmRpc2NvdmVySHlwZXJ0eVBlclVSTCguLi5hcmd1bWVudHMpXHJcbiAgICAgICAgLnRoZW4oaHlwZXJ0eSA9PiByZXNvbHZlKG5ldyBEaXNjb3ZlcmVkT2JqZWN0KGh5cGVydHksIHRoaXMucnVudGltZVVSTCwgdGhpcy5kaXNjb3ZlcnlVUkwsIHRoaXMubWVzc2FnZUJ1cywgdGhpcykpKVxyXG4gICAgICAgIC5jYXRjaChlcnJvciA9PiByZWplY3QoZXJyb3IpKTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgKiBmdW5jdGlvbiB0byByZXF1ZXN0IGFib3V0IGRhdGFPYmplY3QgcmVnaXN0ZXJlZCBpbiBkb21haW4gcmVnaXN0cnksIGFuZFxyXG4gICogcmV0dXJuIHRoZSBkYXRhT2JqZWN0IGluZm9ybWF0aW9uLCBpZiBmb3VuZC5cclxuICAqIEBwYXJhbSAge1N0cmluZ30gICAgICAgICAgICAgIHVybCAgZGF0YU9iamVjdCBVUkxcclxuICAqIEBwYXJhbSAge1N0cmluZ30gICAgICAgICAgICBkb21haW4gKE9wdGlvbmFsKVxyXG4gICovXHJcbiAgZGlzY292ZXJEYXRhT2JqZWN0UGVyVVJMKHVybCwgZG9tYWluKSB7XHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG4gICAgbGV0IGFjdGl2ZURvbWFpbjtcclxuXHJcbiAgICBhY3RpdmVEb21haW4gPSAoIWRvbWFpbikgPyBfdGhpcy5kb21haW4gOiBkb21haW47XHJcblxyXG4gICAgbGV0IG1zZyA9IHtcclxuICAgICAgdHlwZTogJ3JlYWQnLFxyXG4gICAgICBmcm9tOiBfdGhpcy5kaXNjb3ZlcnlVUkwsXHJcbiAgICAgIHRvOiBfdGhpcy5ydW50aW1lVVJMICsgJy9kaXNjb3ZlcnkvJyxcclxuICAgICAgYm9keToge1xyXG4gICAgICAgIHJlc291cmNlOiAnL2RhdGFPYmplY3QvdXJsLycgKyB1cmwsXHJcbiAgICAgICAgY3JpdGVyaWE6IHtcclxuICAgICAgICAgIGRvbWFpbjogYWN0aXZlRG9tYWluXHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9O1xyXG5cclxuICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuXHJcbiAgICAgIF90aGlzLm1lc3NhZ2VCdXMucG9zdE1lc3NhZ2UobXNnLCAocmVwbHkpID0+IHtcclxuXHJcbiAgICAgICAgaWYocmVwbHkuYm9keS5jb2RlID09PSAyMDApe1xyXG4gICAgICAgICAgbG9nLmxvZyhcIlJlcGx5IFZhbHVlIExvZzogXCIscmVwbHkuYm9keS52YWx1ZSk7XHJcbiAgICAgICAgICByZXNvbHZlKHJlcGx5LmJvZHkudmFsdWUpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgIGxvZy53YXJuKFwiW0Rpc2NvdmVyeS5kaXNjb3ZlckRhdGFPYmplY3RQZXJVUkxdIEVycm9yIFJlcGx5IGZvciBcIiArIHVybCArIFwiIFJlYXNvbjogXCIsIHJlcGx5LmJvZHkuZGVzY3JpcHRpb24pO1xyXG4gICAgICAgICAgcmVzb2x2ZShbXSk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgKiBmdW5jdGlvbiB0byByZXF1ZXN0IGFib3V0IGRhdGFPYmplY3QgcmVnaXN0ZXJlZCBpbiBkb21haW4gcmVnaXN0cnksIGFuZFxyXG4gICogcmV0dXJucyBkaXNjb3ZlcmVkT2JqZWN0LlxyXG4gICogQHBhcmFtICB7U3RyaW5nfSAgICAgICAgICAgICAgdXJsICBkYXRhT2JqZWN0IFVSTFxyXG4gICogQHBhcmFtICB7U3RyaW5nfSAgICAgICAgICAgIGRvbWFpbiAoT3B0aW9uYWwpXHJcbiAgKi9cclxuICBkaXNjb3ZlckRhdGFPYmplY3RQZXJVUkxETyh1cmwsIGRvbWFpbikge1xyXG5cclxuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XHJcbiAgICAgIHRoaXMuZGlzY292ZXJEYXRhT2JqZWN0UGVyVVJMKC4uLmFyZ3VtZW50cylcclxuICAgICAgICAudGhlbihyZWdpc3RyeU9iamVjdCA9PiByZXNvbHZlKG5ldyBEaXNjb3ZlcmVkT2JqZWN0KHJlZ2lzdHJ5T2JqZWN0LCB0aGlzLnJ1bnRpbWVVUkwsIHRoaXMuZGlzY292ZXJ5VVJMLCB0aGlzLm1lc3NhZ2VCdXMsIHRoaXMpKSlcclxuICAgICAgICAuY2F0Y2goZXJyb3IgPT4gcmVqZWN0KGVycm9yKSk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICogZnVuY3Rpb24gdG8gcmVxdWVzdCBhYm91dCBhbiBkYXRhT2JqZWN0cyByZWdpc3RlcmVkIGluIGRvbWFpbiByZWdpc3RyeSB3aXRoIGEgZ2l2ZW4gbmFtZSwgYW5kXHJcbiAgKiByZXR1cm4gdGhlIGRhdGFPYmplY3RzIGluZm9ybWF0aW9uLCBpZiBmb3VuZC5cclxuICAqIEBwYXJhbSAge1N0cmluZ30gICAgICAgICAgICAgIG5hbWUgIGRhdGFPYmplY3QgVVJMXHJcbiAgKiBAcGFyYW0gIHtBcnJheTxzdHJpbmc+fSAgICBzY2hlbWEgKE9wdGlvbmFsKSAgICAgdHlwZXMgb2YgZGF0YU9iamVjdHMgc2NoZW1hc1xyXG4gICogQHBhcmFtICB7QXJyYXk8c3RyaW5nPn0gICAgcmVzb3VyY2VzIChPcHRpb25hbCkgIHR5cGVzIG9mIGRhdGFPYmplY3RzIHJlc291cmNlc1xyXG4gICogQHBhcmFtICB7U3RyaW5nfSAgICAgICAgICAgIGRvbWFpbiAoT3B0aW9uYWwpXHJcbiAgKi9cclxuICBkaXNjb3ZlckRhdGFPYmplY3RzUGVyTmFtZShuYW1lLCBzY2hlbWEsIHJlc291cmNlcywgZG9tYWluKSB7XHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG4gICAgbGV0IGFjdGl2ZURvbWFpbjtcclxuXHJcbiAgICBhY3RpdmVEb21haW4gPSAoIWRvbWFpbikgPyBfdGhpcy5kb21haW4gOiBkb21haW47XHJcblxyXG4gICAgbGV0IG1zZyA9IHtcclxuICAgICAgdHlwZTogJ3JlYWQnLFxyXG4gICAgICBmcm9tOiBfdGhpcy5kaXNjb3ZlcnlVUkwsXHJcbiAgICAgIHRvOiBfdGhpcy5ydW50aW1lVVJMICsgJy9kaXNjb3ZlcnkvJyxcclxuICAgICAgYm9keToge1xyXG4gICAgICAgIHJlc291cmNlOiAnL2RhdGFPYmplY3QvbmFtZS8nICsgbmFtZVxyXG4gICAgICB9XHJcbiAgICB9O1xyXG5cclxuICAgIGlmKHNjaGVtYSB8fCByZXNvdXJjZXMpIHtcclxuICAgICAgbXNnLmJvZHlbJ2NyaXRlcmlhJ10gPSB7XHJcbiAgICAgICAgcmVzb3VyY2VzOiByZXNvdXJjZXMsXHJcbiAgICAgICAgZGF0YVNjaGVtZXM6IHNjaGVtYSxcclxuICAgICAgICBkb21haW46IGFjdGl2ZURvbWFpblxyXG4gICAgICB9O1xyXG4gICAgfWVsc2Uge1xyXG4gICAgICBtc2cuYm9keVsnY3JpdGVyaWEnXSA9IHtcclxuICAgICAgICBkb21haW46IGFjdGl2ZURvbWFpblxyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG5cclxuICAgICAgX3RoaXMubWVzc2FnZUJ1cy5wb3N0TWVzc2FnZShtc2csIChyZXBseSkgPT4ge1xyXG5cclxuICAgICAgICBpZihyZXBseS5ib2R5LmNvZGUgPT09IDIwMCl7XHJcbiAgICAgICAgICBsb2cubG9nKFwiUmVwbHkgVmFsdWUgTG9nOiBcIixyZXBseS5ib2R5LnZhbHVlKTtcclxuICAgICAgICAgIHJlc29sdmUocmVwbHkuYm9keS52YWx1ZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgbG9nLndhcm4oXCJbRGlzY292ZXJ5LmRpc2NvdmVyRGF0YU9iamVjdHNQZXJOYW1lXSBFcnJvciBSZXBseSBmb3IgXCIgKyBuYW1lICsgXCIgUmVhc29uOiBcIiwgcmVwbHkuYm9keS5kZXNjcmlwdGlvbik7XHJcbiAgICAgICAgICByZXNvbHZlKFtdKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAqIGZ1bmN0aW9uIHRvIHJlcXVlc3QgYWJvdXQgZGF0YU9iamVjdCByZWdpc3RlcmVkIGluIGRvbWFpbiByZWdpc3RyeSwgYW5kXHJcbiAgKiByZXR1cm5zIGRpc2NvdmVyZWRPYmplY3QuXHJcbiAgKiBAcGFyYW0gIHtTdHJpbmd9ICAgICAgICAgICAgICBuYW1lICBkYXRhT2JqZWN0IFVSTFxyXG4gICogQHBhcmFtICB7QXJyYXk8c3RyaW5nPn0gICAgc2NoZW1hIChPcHRpb25hbCkgICAgIHR5cGVzIG9mIGRhdGFPYmplY3RzIHNjaGVtYXNcclxuICAqIEBwYXJhbSAge0FycmF5PHN0cmluZz59ICAgIHJlc291cmNlcyAoT3B0aW9uYWwpICB0eXBlcyBvZiBkYXRhT2JqZWN0cyByZXNvdXJjZXNcclxuICAqIEBwYXJhbSAge1N0cmluZ30gICAgICAgICAgICBkb21haW4gKE9wdGlvbmFsKVxyXG4gICovXHJcbiAgZGlzY292ZXJEYXRhT2JqZWN0c1Blck5hbWVETyhuYW1lLCBzY2hlbWEsIHJlc291cmNlcywgZG9tYWluKSB7XHJcblxyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcclxuICAgICAgdGhpcy5kaXNjb3ZlckRhdGFPYmplY3RzUGVyTmFtZSguLi5hcmd1bWVudHMpXHJcbiAgICAgICAgLnRoZW4ocmVnaXN0cnlPYmplY3RzID0+IHJlc29sdmUodGhpcy5fY29udmVydFRvRGlzY292ZXJlZE9iamVjdChyZWdpc3RyeU9iamVjdHMpKSlcclxuICAgICAgICAuY2F0Y2goZXJyb3IgPT4gcmVqZWN0KGVycm9yKSk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICogZnVuY3Rpb24gdG8gcmVxdWVzdCBhYm91dCBzcGVjaWZpYyByZXBvcnRlciBkYXRhT2JqZWN0IHJlZ2lzdGVyZWQgaW4gZG9tYWluIHJlZ2lzdHJ5LCBhbmRcclxuICAqIHJldHVybiB0aGUgZGF0YU9iamVjdHMgZnJvbSB0aGF0IHJlcG9ydGVyLlxyXG4gICogQHBhcmFtICB7U3RyaW5nfSAgICAgICAgICAgcmVwb3J0ZXIgICAgIGRhdGFPYmplY3QgcmVwb3J0ZXJcclxuICAqIEBwYXJhbSAge0FycmF5PHN0cmluZz59ICAgIHNjaGVtYSAoT3B0aW9uYWwpICAgICB0eXBlcyBvZiBkYXRhT2JqZWN0cyBzY2hlbWFzXHJcbiAgKiBAcGFyYW0gIHtBcnJheTxzdHJpbmc+fSAgICByZXNvdXJjZXMgKE9wdGlvbmFsKSAgdHlwZXMgb2YgZGF0YU9iamVjdHMgcmVzb3VyY2VzXHJcbiAgKiBAcGFyYW0gIHtTdHJpbmd9ICAgICAgICAgICBkb21haW4gICAgICAgKE9wdGlvbmFsKVxyXG4gICovXHJcbiAgZGlzY292ZXJEYXRhT2JqZWN0c1BlclJlcG9ydGVyKHJlcG9ydGVyLCBzY2hlbWEsIHJlc291cmNlcywgZG9tYWluKSB7XHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG4gICAgbGV0IGFjdGl2ZURvbWFpbjtcclxuXHJcbiAgICBhY3RpdmVEb21haW4gPSAoIWRvbWFpbikgPyBfdGhpcy5kb21haW4gOiBkb21haW47XHJcblxyXG5cclxuICAgIGxldCBtc2cgPSB7XHJcbiAgICAgIHR5cGU6ICdyZWFkJyxcclxuICAgICAgZnJvbTogX3RoaXMuZGlzY292ZXJ5VVJMLFxyXG4gICAgICB0bzogX3RoaXMucnVudGltZVVSTCArICcvZGlzY292ZXJ5LycsXHJcbiAgICAgIGJvZHk6IHtcclxuICAgICAgICByZXNvdXJjZTogJy9kYXRhT2JqZWN0L3JlcG9ydGVyLycgKyByZXBvcnRlclxyXG4gICAgICB9XHJcbiAgICB9O1xyXG5cclxuICAgIGlmKHNjaGVtYSB8fCByZXNvdXJjZXMpIHtcclxuICAgICAgbXNnLmJvZHlbJ2NyaXRlcmlhJ10gPSB7XHJcbiAgICAgICAgcmVzb3VyY2VzOiByZXNvdXJjZXMsXHJcbiAgICAgICAgZGF0YVNjaGVtZXM6IHNjaGVtYSxcclxuICAgICAgICBkb21haW46IGFjdGl2ZURvbWFpblxyXG4gICAgICB9O1xyXG4gICAgfWVsc2Uge1xyXG4gICAgICBtc2cuYm9keVsnY3JpdGVyaWEnXSA9IHtcclxuICAgICAgICBkb21haW46IGFjdGl2ZURvbWFpblxyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG5cclxuICAgICAgX3RoaXMubWVzc2FnZUJ1cy5wb3N0TWVzc2FnZShtc2csIChyZXBseSkgPT4ge1xyXG5cclxuICAgICAgICBpZihyZXBseS5ib2R5LmNvZGUgPT09IDIwMCl7XHJcbiAgICAgICAgICBsb2cubG9nKFwiUmVwbHkgVmFsdWUgTG9nOiBcIixyZXBseS5ib2R5LnZhbHVlKTtcclxuICAgICAgICAgIHJlc29sdmUocmVwbHkuYm9keS52YWx1ZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgbG9nLndhcm4oXCJbRGlzY292ZXJ5LmRpc2NvdmVyRGF0YU9iamVjdHNQZXJOYW1lXSBFcnJvciBSZXBseSBmb3IgXCIgKyByZXBvcnRlciArIFwiIFJlYXNvbjogXCIsIHJlcGx5LmJvZHkuZGVzY3JpcHRpb24pO1xyXG4gICAgICAgICAgcmVzb2x2ZShbXSk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgKiBmdW5jdGlvbiB0byByZXF1ZXN0IGFib3V0IGRhdGFPYmplY3QgcmVnaXN0ZXJlZCBpbiBkb21haW4gcmVnaXN0cnksIGFuZFxyXG4gICogcmV0dXJucyBkaXNjb3ZlcmVkT2JqZWN0LlxyXG4gICogQHBhcmFtICB7U3RyaW5nfSAgICAgICAgICAgICAgbmFtZSAgZGF0YU9iamVjdCBVUkxcclxuICAqIEBwYXJhbSAge0FycmF5PHN0cmluZz59ICAgIHNjaGVtYSAoT3B0aW9uYWwpICAgICB0eXBlcyBvZiBkYXRhT2JqZWN0cyBzY2hlbWFzXHJcbiAgKiBAcGFyYW0gIHtBcnJheTxzdHJpbmc+fSAgICByZXNvdXJjZXMgKE9wdGlvbmFsKSAgdHlwZXMgb2YgZGF0YU9iamVjdHMgcmVzb3VyY2VzXHJcbiAgKiBAcGFyYW0gIHtTdHJpbmd9ICAgICAgICAgICAgZG9tYWluIChPcHRpb25hbClcclxuICAqL1xyXG4gIGRpc2NvdmVyRGF0YU9iamVjdHNQZXJSZXBvcnRlckRPKHJlcG9ydGVyLCBzY2hlbWEsIHJlc291cmNlcywgZG9tYWluKSB7XHJcblxyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcclxuICAgICAgdGhpcy5kaXNjb3ZlckRhdGFPYmplY3RzUGVyUmVwb3J0ZXIoLi4uYXJndW1lbnRzKVxyXG4gICAgICAgIC50aGVuKHJlZ2lzdHJ5T2JqZWN0cyA9PiByZXNvbHZlKHRoaXMuX2NvbnZlcnRUb0Rpc2NvdmVyZWRPYmplY3QocmVnaXN0cnlPYmplY3RzKSkpXHJcbiAgICAgICAgLmNhdGNoKGVycm9yID0+IHJlamVjdChlcnJvcikpO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBfY29udmVydFRvRGlzY292ZXJlZE9iamVjdChyZWdpc3RyeU9iamVjdHMpIHtcclxuICAgIHJldHVybiByZWdpc3RyeU9iamVjdHMubWFwKChyZWdpc3RyeU9iamVjdCkgPT4ge1xyXG4gICAgICByZXR1cm4gbmV3IERpc2NvdmVyZWRPYmplY3QocmVnaXN0cnlPYmplY3QsIHRoaXMucnVudGltZVVSTCwgdGhpcy5kaXNjb3ZlcnlVUkwsIHRoaXMubWVzc2FnZUJ1cywgdGhpcyk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8qKiBBZHZhbmNlZCBTZWFyY2ggZm9yIGRhdGFPYmplY3RzIHJlZ2lzdGVyZWQgaW4gZG9tYWluIHJlZ2lzdHJ5XHJcbiAgKiBAZGVwcmVjYXRlZCBEZXByZWNhdGVkLiBVc2UgZGlzY292ZXJEYXRhT2JqZWN0c1Blck5hbWUgaW5zdGVhZFxyXG4gICogQHBhcmFtICB7U3RyaW5nfSAgICAgICAgICAgbmFtZSAgICAgICAgICAgICAgICAgIG5hbWUgb2YgdGhlIGRhdGFPYmplY3RcclxuICAqIEBwYXJhbSAge0FycmF5PHN0cmluZz59ICAgIHNjaGVtYSAoT3B0aW9uYWwpICAgICB0eXBlcyBvZiBkYXRhT2JqZWN0IHNjaGVtYXNcclxuICAqIEBwYXJhbSAge0FycmF5PHN0cmluZz59ICAgIHJlc291cmNlcyAoT3B0aW9uYWwpICB0eXBlcyBvZiBkYXRhT2JqZWN0IHJlc291cmNlc1xyXG4gICogQHBhcmFtICB7U3RyaW5nfSAgICAgICAgICAgZG9tYWluIChPcHRpb25hbCkgICAgIGRvbWFpbiBvZiB0aGUgcmVnaXN0cnkgdG8gc2VhcmNoXHJcbiAgKi9cclxuICBkaXNjb3ZlckRhdGFPYmplY3QobmFtZSwgc2NoZW1hLCByZXNvdXJjZXMsIGRvbWFpbikge1xyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuICAgIGxldCBhY3RpdmVEb21haW47XHJcbiAgICAvL2xldCB1c2VySWRlbnRpZmllciA9IGNvbnZlcnRUb1VzZXJVUkwodXNlcik7XHJcblxyXG4gICAgYWN0aXZlRG9tYWluID0gKCFkb21haW4pID8gX3RoaXMuZG9tYWluIDogZG9tYWluO1xyXG5cclxuICAgIGxldCBtc2cgPSB7XHJcbiAgICAgIHR5cGU6ICdyZWFkJywgZnJvbTogX3RoaXMuZGlzY292ZXJ5VVJMLCB0bzogJ2RvbWFpbjovL3JlZ2lzdHJ5LicgKyBhY3RpdmVEb21haW4sIGJvZHk6IHsgcmVzb3VyY2U6IG5hbWUsXHJcbiAgICAgIGNyaXRlcmlhOiB7cmVzb3VyY2VzOiByZXNvdXJjZXMsIGRhdGFTY2hlbWVzOiBzY2hlbWF9XHJcbiAgICAgIH1cclxuICAgIH07XHJcblxyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG5cclxuICAgICAgX3RoaXMubWVzc2FnZUJ1cy5wb3N0TWVzc2FnZShtc2csIChyZXBseSkgPT4ge1xyXG4gICAgICAgIGxvZy5sb2coJ1tEaXNjb3ZlcnldJywgcmVwbHkpXHJcblxyXG4gICAgICAgIGlmKHJlcGx5LmJvZHkuY29kZT4yOTkpIHtcclxuICAgICAgICAgIGxvZy53YXJuKFwiW0Rpc2NvdmVyeS5kaXNjb3ZlckRhdGFPYmplY3RdIEVycm9yIFJlcGx5IGZvciBcIiArIG5hbWUgKyBcIiBSZWFzb246IFwiLCByZXBseS5ib2R5LmRlc2NyaXB0aW9uKTtcclxuICAgICAgICAgIHJldHVybiByZXNvbHZlKFtdKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGxldCBoeXBlcnRpZXMgPSByZXBseS5ib2R5LnZhbHVlO1xyXG5cclxuICAgICAgICBpZiAoaHlwZXJ0aWVzKSB7XHJcbiAgICAgICAgICByZXNvbHZlKGh5cGVydGllcyk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIHJlc29sdmUoW10pO1xyXG4gICAgICAgIH1cclxuICAgICAgfSk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8qKiBBZHZhbmNlZCBTZWFyY2ggZm9yIEh5cGVydGllcyByZWdpc3RlcmVkIGluIGRvbWFpbiByZWdpc3RyeVxyXG4gICogQGRlcHJlY2F0ZWQgRGVwcmVjYXRlZC4gVXNlIGRpc2NvdmVySHlwZXJ0aWVzIGluc3RlYWRcclxuICAqIEBwYXJhbSAge1N0cmluZ30gICAgICAgICAgIHVzZXIgICAgICAgICAgICAgICAgICB1c2VyIGlkZW50aWZpZXIsIGVpdGhlciBpbiB1cmwgb3IgZW1haWwgZm9ybWF0XHJcbiAgKiBAcGFyYW0gIHtBcnJheTxzdHJpbmc+fSAgICBzY2hlbWEgKE9wdGlvbmFsKSAgICAgdHlwZXMgb2YgaHlwZXJ0aWVzIHNjaGVtYXNcclxuICAqIEBwYXJhbSAge0FycmF5PHN0cmluZz59ICAgIHJlc291cmNlcyAoT3B0aW9uYWwpICB0eXBlcyBvZiBoeXBlcnRpZXMgcmVzb3VyY2VzXHJcbiAgKiBAcGFyYW0gIHtTdHJpbmd9ICAgICAgICAgICBkb21haW4gKE9wdGlvbmFsKSAgICAgZG9tYWluIG9mIHRoZSByZWdpc3RyeSB0byBzZWFyY2hcclxuICAqL1xyXG4gIGRpc2NvdmVySHlwZXJ0eSh1c2VyLCBzY2hlbWEsIHJlc291cmNlcywgZG9tYWluKSB7XHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG4gICAgbGV0IGFjdGl2ZURvbWFpbjtcclxuICAgIGxldCB1c2VySWRlbnRpZmllciA9IGNvbnZlcnRUb1VzZXJVUkwodXNlcik7XHJcblxyXG4gICAgaWYgKCFkb21haW4pIHtcclxuICAgICAgYWN0aXZlRG9tYWluID0gX3RoaXMuZG9tYWluO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgYWN0aXZlRG9tYWluID0gZG9tYWluO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuXHJcbiAgICAgIGxvZy5sb2coJ1tEaXNjb3ZlcnkuZGlzY292ZXJIeXBlcnR5XSBBQ1RJVkUgRE9NQUlOIC0+ICcsIGFjdGl2ZURvbWFpbiwgJ3VzZXItPicsIHVzZXIsICdzY2hlbWEtPicsIHNjaGVtYSwgJ3Jlc291cmNlcy0+JywgcmVzb3VyY2VzLCAnZG9tYWluLT4nLCBkb21haW4pO1xyXG4gICAgICBpZiAodXNlci5pbmNsdWRlcygnOicpICYmICF1c2VyLmluY2x1ZGVzKCd1c2VyOi8vJykpIHtcclxuICAgICAgICBsb2cubG9nKCdbRGlzY292ZXJ5LmRpc2NvdmVySHlwZXJ0eV0gJyArIHVzZXIgKyAnIGlzIGxlZ2FjeSBkb21haW4nKTtcclxuICAgICAgICBsZXQgbGVnYWN5VXNlciA9IHsgdXNlcklEOiB1c2VyLCBoeXBlcnR5SUQ6IHVzZXIsIHNjaGVtYTogc2NoZW1hLCByZXNvdXJjZXM6IHJlc291cmNlcyB9O1xyXG4gICAgICAgIHJldHVybiByZXNvbHZlKGxlZ2FjeVVzZXIpO1xyXG4gICAgICB9XHJcbiAgICAgIGxldCBtc2cgPSB7XHJcbiAgICAgICAgdHlwZTogJ3JlYWQnLCBmcm9tOiBfdGhpcy5kaXNjb3ZlcnlVUkwsIHRvOiAnZG9tYWluOi8vcmVnaXN0cnkuJyArIGFjdGl2ZURvbWFpbiwgYm9keTogeyByZXNvdXJjZTogdXNlcklkZW50aWZpZXIsXHJcbiAgICAgICAgY3JpdGVyaWE6IHtyZXNvdXJjZXM6IHJlc291cmNlcywgZGF0YVNjaGVtZXM6IHNjaGVtYX1cclxuICAgICAgICB9XHJcbiAgICAgIH07XHJcblxyXG4gICAgICBsb2cuaW5mbygnW0Rpc2NvdmVyeV0gbXNnIHRvIHNlbmQtPicsIG1zZyk7XHJcblxyXG4gICAgICBfdGhpcy5tZXNzYWdlQnVzLnBvc3RNZXNzYWdlKG1zZywgKHJlcGx5KSA9PiB7XHJcblxyXG4gICAgICAgIGxvZy5pbmZvKCdbRGlzY292ZXJ5XSBPTiBkaXNjb3Zlckh5cGVydHktPicsIHJlcGx5KTtcclxuICAgICAgICBsZXQgaHlwZXJ0aWVzID0gcmVwbHkuYm9keS52YWx1ZTtcclxuXHJcbiAgICAgICAgaWYgKGh5cGVydGllcykge1xyXG4gICAgICAgICAgcmVzb2x2ZShoeXBlcnRpZXMpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICByZWplY3QoJ05vIEh5cGVydHkgd2FzIGZvdW5kJyk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgKiBmdW5jdGlvbiB0byByZXF1ZXN0IGFib3V0IHVzZXJzIHJlZ2lzdGVyZWQgaW4gZG9tYWluIHJlZ2lzdHJ5LCBhbmRcclxuICAqIHJldHVybiB0aGUgbGFzdCBoeXBlcnR5IGluc3RhbmNlIHJlZ2lzdGVyZWQgYnkgdGhlIHVzZXIuXHJcbiAgKiBAZGVwcmVjYXRlZCBEZXByZWNhdGVkLiBVc2UgZGlzY292ZXJIeXBlcnR5IGluc3RlYWRcclxuICAqIEBwYXJhbSAge2VtYWlsfSAgICAgICAgICAgICAgZW1haWxcclxuICAqIEBwYXJhbSAge2RvbWFpbn0gICAgICAgICAgICBkb21haW4gKE9wdGlvbmFsKVxyXG4gICovXHJcbiAgZGlzY292ZXJIeXBlcnR5UGVyVXNlcihlbWFpbCwgZG9tYWluKSB7XHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG4gICAgbGV0IGFjdGl2ZURvbWFpbjtcclxuXHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcblxyXG4gICAgICAvLyBIYWNrIGZvciBsZWdhY3kgdXNlcnNcclxuICAgICAgaWYgKGVtYWlsLmluY2x1ZGVzKCc6JykgJiYgIWVtYWlsLmluY2x1ZGVzKCd1c2VyOi8vJykpIHtcclxuICAgICAgICBsb2cubG9nKCdbRGlzY292ZXJ5LmRpc2NvdmVySHlwZXJ0eV0gJyArIGVtYWlsICsnaXMgbGVnYWN5IGRvbWFpbicpO1xyXG4gICAgICAgIGxldCBsZWdhY3lVc2VyID0geyBpZDogZW1haWwsIGh5cGVydHlVUkw6IGVtYWlsLCBkZXNjcmlwdG9yOiAndW5rbm93bicgfTtcclxuICAgICAgICByZXR1cm4gcmVzb2x2ZShsZWdhY3lVc2VyKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgaWYgKCFkb21haW4pIHtcclxuICAgICAgICBhY3RpdmVEb21haW4gPSBfdGhpcy5kb21haW47XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgYWN0aXZlRG9tYWluID0gZG9tYWluO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBsZXQgaWRlbnRpdHlVUkwgPSAndXNlcjovLycgKyBlbWFpbC5zdWJzdHJpbmcoZW1haWwuaW5kZXhPZignQCcpICsgMSwgZW1haWwubGVuZ3RoKSArICcvJyArIGVtYWlsLnN1YnN0cmluZygwLCBlbWFpbC5pbmRleE9mKCdAJykpO1xyXG5cclxuXHJcbiAgICAgIC8vIG1lc3NhZ2UgdG8gcXVlcnkgZG9tYWluIHJlZ2lzdHJ5LCBhc2tpbmcgZm9yIGEgdXNlciBoeXBlcnR5LlxyXG4gICAgICBsZXQgbWVzc2FnZSA9IHtcclxuICAgICAgICB0eXBlOiAncmVhZCcsIGZyb206IF90aGlzLmRpc2NvdmVyeVVSTCwgdG86ICdkb21haW46Ly9yZWdpc3RyeS4nICsgYWN0aXZlRG9tYWluLCBib2R5OiB7IHJlc291cmNlOiBpZGVudGl0eVVSTH1cclxuICAgICAgfTtcclxuXHJcbiAgICAgIGxvZy5pbmZvKCdbRGlzY292ZXJ5XSBNZXNzYWdlOiAnLCBtZXNzYWdlLCBhY3RpdmVEb21haW4sIGlkZW50aXR5VVJMKTtcclxuXHJcbiAgICAgIC8vbG9nLmluZm8oJ1tEaXNjb3ZlcnldIG1lc3NhZ2UgUkVBRCcsIG1lc3NhZ2UpO1xyXG5cclxuICAgICAgX3RoaXMubWVzc2FnZUJ1cy5wb3N0TWVzc2FnZShtZXNzYWdlLCAocmVwbHkpID0+IHtcclxuICAgICAgICBsb2cuaW5mbygnW0Rpc2NvdmVyeV0gbWVzc2FnZSByZXBseScsIHJlcGx5KTtcclxuXHJcbiAgICAgICAgbGV0IGh5cGVydHk7XHJcbiAgICAgICAgbGV0IG1vc3RSZWNlbnQ7XHJcbiAgICAgICAgbGV0IGxhc3RIeXBlcnR5O1xyXG4gICAgICAgIGxldCB2YWx1ZSA9IHJlcGx5LmJvZHkudmFsdWU7XHJcblxyXG4gICAgICAgIGZvciAoaHlwZXJ0eSBpbiB2YWx1ZSkge1xyXG4gICAgICAgICAgaWYgKHZhbHVlW2h5cGVydHldLmxhc3RNb2RpZmllZCAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgIGlmIChtb3N0UmVjZW50ID09PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICBtb3N0UmVjZW50ID0gbmV3IERhdGUodmFsdWVbaHlwZXJ0eV0ubGFzdE1vZGlmaWVkKTtcclxuICAgICAgICAgICAgICBsYXN0SHlwZXJ0eSA9IGh5cGVydHk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgbGV0IGh5cGVydHlEYXRlID0gbmV3IERhdGUodmFsdWVbaHlwZXJ0eV0ubGFzdE1vZGlmaWVkKTtcclxuICAgICAgICAgICAgICBpZiAobW9zdFJlY2VudC5nZXRUaW1lKCkgPCBoeXBlcnR5RGF0ZS5nZXRUaW1lKCkpIHtcclxuICAgICAgICAgICAgICAgIG1vc3RSZWNlbnQgPSBoeXBlcnR5RGF0ZTtcclxuICAgICAgICAgICAgICAgIGxhc3RIeXBlcnR5ID0gaHlwZXJ0eTtcclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGxvZy5pbmZvKCdbRGlzY292ZXJ5XSBMYXN0IEh5cGVydHk6ICcsIGxhc3RIeXBlcnR5LCBtb3N0UmVjZW50KTtcclxuXHJcbiAgICAgICAgbGV0IGh5cGVydHlVUkwgPSBsYXN0SHlwZXJ0eTtcclxuXHJcbiAgICAgICAgaWYgKGh5cGVydHlVUkwgPT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgcmV0dXJuIHJlamVjdCgnVXNlciBIeXBlcnR5IG5vdCBmb3VuZCcpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgbGV0IGlkUGFja2FnZSA9IHtcclxuICAgICAgICAgIGlkOiBlbWFpbCxcclxuICAgICAgICAgIGRlc2NyaXB0b3I6IHZhbHVlW2h5cGVydHlVUkxdLmRlc2NyaXB0b3IsXHJcbiAgICAgICAgICBoeXBlcnR5VVJMOiBoeXBlcnR5VVJMXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgbG9nLmluZm8oJ1tEaXNjb3ZlcnldID09PT4gaHlwZXJ0eURpc2NvdmVyeSBtZXNzYWdlQnVuZGxlOiAnLCBpZFBhY2thZ2UpO1xyXG4gICAgICAgIHJlc29sdmUoaWRQYWNrYWdlKTtcclxuICAgICAgfSk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICogZnVuY3Rpb24gdG8gcmVxdWVzdCBhYm91dCB1c2VycyByZWdpc3RlcmVkIGluIGRvbWFpbiByZWdpc3RyeSwgYW5kXHJcbiAgKiByZXR1cm4gdGhlIGFsbCB0aGUgaHlwZXJ0aWVzIHJlZ2lzdGVyZWQgYnkgdGhlIHVzZXJcclxuICAqIEBkZXByZWNhdGVkIERlcHJlY2F0ZWQuIFVzZSBkaXNjb3Zlckh5cGVydHkgaW5zdGVhZFxyXG4gICogQHBhcmFtICB7ZW1haWx9ICAgICAgICAgICAgICBlbWFpbFxyXG4gICogQHBhcmFtICB7ZG9tYWlufSAgICAgICAgICAgIGRvbWFpbiAoT3B0aW9uYWwpXHJcbiAgKi9cclxuICBkaXNjb3Zlckh5cGVydGllc1BlclVzZXIoZW1haWwsIGRvbWFpbikge1xyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuICAgIGxldCBhY3RpdmVEb21haW47XHJcbiAgICBsb2cubG9nKCdvbiBGdW5jdGlvbi0+JywgZW1haWwpO1xyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG5cclxuICAgICAgaWYgKGVtYWlsLmluY2x1ZGVzKCc6JykgJiYgIWVtYWlsLmluY2x1ZGVzKCd1c2VyOi8vJykpIHtcclxuICAgICAgICBsb2cubG9nKCdbRGlzY292ZXJ5LmRpc2NvdmVySHlwZXJ0eV0gaXMgbGVnYWN5IGRvbWFpbicpO1xyXG4gICAgICAgIGxldCBsZWdhY3lVc2VyID0geyB1c2VySUQ6IGVtYWlsLCBoeXBlcnR5SUQ6IGVtYWlsLCBzY2hlbWE6IHNjaGVtYSwgcmVzb3VyY2VzOiByZXNvdXJjZXMgfTtcclxuICAgICAgICByZXR1cm4gcmVzb2x2ZShsZWdhY3lVc2VyKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgaWYgKCFkb21haW4pIHtcclxuICAgICAgICBhY3RpdmVEb21haW4gPSBfdGhpcy5kb21haW47XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgYWN0aXZlRG9tYWluID0gZG9tYWluO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBsZXQgaWRlbnRpdHlVUkwgPSAndXNlcjovLycgKyBlbWFpbC5zdWJzdHJpbmcoZW1haWwuaW5kZXhPZignQCcpICsgMSwgZW1haWwubGVuZ3RoKSArICcvJyArIGVtYWlsLnN1YnN0cmluZygwLCBlbWFpbC5pbmRleE9mKCdAJykpO1xyXG5cclxuICAgICAgLy8gbWVzc2FnZSB0byBxdWVyeSBkb21haW4gcmVnaXN0cnksIGFza2luZyBmb3IgYSB1c2VyIGh5cGVydHkuXHJcbiAgICAgIGxldCBtZXNzYWdlID0ge1xyXG4gICAgICAgIHR5cGU6ICdyZWFkJywgZnJvbTogX3RoaXMuZGlzY292ZXJ5VVJMLCB0bzogJ2RvbWFpbjovL3JlZ2lzdHJ5LicgKyBhY3RpdmVEb21haW4sIGJvZHk6IHsgcmVzb3VyY2U6IGlkZW50aXR5VVJMfVxyXG4gICAgICB9O1xyXG5cclxuICAgICAgbG9nLmxvZygnW0Rpc2NvdmVyeV0gTWVzc2FnZSBkaXNjb3Zlckh5cGVydGllc1BlclVzZXI6ICcsIG1lc3NhZ2UsIGFjdGl2ZURvbWFpbiwgaWRlbnRpdHlVUkwpO1xyXG5cclxuICAgICAgLy9sb2cuaW5mbygnW0Rpc2NvdmVyeV0gbWVzc2FnZSBSRUFEJywgbWVzc2FnZSk7XHJcblxyXG4gICAgICBfdGhpcy5tZXNzYWdlQnVzLnBvc3RNZXNzYWdlKG1lc3NhZ2UsIChyZXBseSkgPT4ge1xyXG4gICAgICAgIGxvZy5pbmZvKCdbRGlzY292ZXJ5XSBkaXNjb3Zlckh5cGVydGllc1BlclVzZXIgcmVwbHknLCByZXBseSk7XHJcblxyXG4gICAgICAgIGxldCB2YWx1ZSA9IHJlcGx5LmJvZHkudmFsdWU7XHJcblxyXG4gICAgICAgIGlmICghdmFsdWUpIHtcclxuICAgICAgICAgIHJldHVybiByZWplY3QoJ1VzZXIgSHlwZXJ0eSBub3QgZm91bmQnKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJlc29sdmUodmFsdWUpO1xyXG4gICAgICB9KTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgKiBmdW5jdGlvbiB0byByZXF1ZXN0IGFib3V0IHVzZXJzIHJlZ2lzdGVyZWQgaW4gZG9tYWluIHJlZ2lzdHJ5LCBhbmRcclxuICAqIHJldHVybiB0aGUgYWxsIHRoZSBoeXBlcnRpZXMgcmVnaXN0ZXJlZCBieSB0aGUgdXNlclxyXG4gICogQGRlcHJlY2F0ZWQgRGVwcmVjYXRlZC4gVXNlIGRpc2NvdmVySHlwZXJ0eSBpbnN0ZWFkXHJcbiAgKiBAcGFyYW0gIHtlbWFpbH0gICAgICAgICAgICAgIGVtYWlsXHJcbiAgKiBAcGFyYW0gIHtkb21haW59ICAgICAgICAgICAgZG9tYWluIChPcHRpb25hbClcclxuICAqL1xyXG4gIHJlc3VtZURpc2NvdmVyaWVzKCkge1xyXG5cclxuICAgIGxldCBfdGhpcyA9IHRoaXM7XHJcblxyXG4gICAgbG9nLmxvZygnW0Rpc2NvdmVyeV0gcmVzdW1lRGlzY292ZXJpZXMnKTtcclxuXHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcblxyXG4gICAgICBsZXQgbXNnID0ge1xyXG4gICAgICAgIHR5cGU6ICdyZWFkJywgZnJvbTogX3RoaXMuZGlzY292ZXJ5VVJMLCB0bzogX3RoaXMucnVudGltZVVSTCArICcvc3Vic2NyaXB0aW9ucycsIGJvZHk6IHsgcmVzb3VyY2U6IF90aGlzLmRpc2NvdmVyeVVSTH1cclxuICAgICAgfTtcclxuXHJcbiAgICAgIF90aGlzLm1lc3NhZ2VCdXMucG9zdE1lc3NhZ2UobXNnLCAocmVwbHkpPT57XHJcbiAgICAgICAgbG9nLmxvZygnW0Rpc2NvdmVyeS5yZXN1bWVEaXNjb3Zlcmllc10gcmVwbHk6ICcsIHJlcGx5KTtcclxuXHJcbiAgICAgICAgbGV0IG5vdGlmaWNhdGlvbnMgPSBbXTtcclxuXHJcbiAgICAgICAgaWYgKHJlcGx5LmJvZHkuY29kZSA9PT0gMjAwKSB7XHJcbiAgICAgICAgICBsZXQgdXJscyA9IHJlcGx5LmJvZHkudmFsdWU7Ly8gVVJMcyB0byBhZGQgbGlzdGVuZXJzIHRvXHJcblxyXG4gICAgICAgICAgLy9sZXRzIGNyZWF0ZSBvbmUgRGlzY292ZXJ5T2JqZWN0IHBlciBub3RpZmljYXRpb25cclxuICAgICAgICAgIHVybHMuZm9yRWFjaCgodXJsKSA9PiB7XHJcbiAgICAgICAgICAgIGxldCBvYmplY3RVcmwgPSB1cmwuc3BsaXQoJy9yZWdpc3RyYXRpb24nKVswXTtcclxuICAgICAgICAgICAgbGV0IGRhdGEgPSB7fTtcclxuICAgICAgICAgICAgZGF0YS51cmwgPSBvYmplY3RVcmw7XHJcbiAgICAgICAgICAgIGxvZy5sb2coJ1tEaXNjb3ZlcnkucmVzdW1lRGlzY292ZXJpZXNdIGFkZGluZyBsaXN0ZW5lciB0bzogJywgb2JqZWN0VXJsKTtcclxuXHJcbiAgICAgICAgICAgIGlmIChvYmplY3RVcmwuaW5jbHVkZXMoJ2h5cGVydHk6Ly8nKSkge1xyXG4gICAgICAgICAgICAgIG5vdGlmaWNhdGlvbnMucHVzaChfdGhpcy5kaXNjb3Zlckh5cGVydHlQZXJVUkxETyhvYmplY3RVcmwpKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICBub3RpZmljYXRpb25zLnB1c2goX3RoaXMuZGlzY292ZXJEYXRhT2JqZWN0UGVyVVJMRE8ob2JqZWN0VXJsKSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgUHJvbWlzZS5hbGwobm90aWZpY2F0aW9ucykudGhlbih2YWx1ZXM9PnsgcmVzb2x2ZSh2YWx1ZXMpOyB9KTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgcmVzb2x2ZShbXSk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KTtcclxuXHJcbiAgICB9KTtcclxuXHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgZGVmYXVsdCBEaXNjb3Zlcnk7XHJcbiIsImNsYXNzIFNlYXJjaCB7XHJcblxyXG4gIGNvbnN0cnVjdG9yKGRpc2NvdmVyeSwgaWRlbnRpdHlNYW5hZ2VyKSB7XHJcblxyXG4gICAgaWYgKCFkaXNjb3ZlcnkpIHRocm93IG5ldyBFcnJvcignVGhlIGRpc2NvdmVyeSBjb21wb25lbnQgaXMgYSBuZWVkZWQgcGFyYW1ldGVyJyk7XHJcbiAgICBpZiAoIWlkZW50aXR5TWFuYWdlcikgdGhyb3cgbmV3IEVycm9yKCdUaGUgaWRlbnRpdHlNYW5hZ2VyIGNvbXBvbmVudCBpcyBhIG5lZWRlZCBwYXJhbWV0ZXInKTtcclxuXHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG5cclxuICAgIF90aGlzLmRpc2NvdmVyeSA9IGRpc2NvdmVyeTtcclxuICAgIF90aGlzLmlkZW50aXR5TWFuYWdlciA9IGlkZW50aXR5TWFuYWdlcjtcclxuXHJcbiAgfVxyXG5cclxuICBteUlkZW50aXR5KCkge1xyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuXHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcblxyXG4gICAgICBfdGhpcy5pZGVudGl0eU1hbmFnZXIuZGlzY292ZXJVc2VyUmVnaXN0ZXJlZCgpLnRoZW4oKHJlc3VsdCkgPT4ge1xyXG4gICAgICAgIHJlc29sdmUocmVzdWx0KTtcclxuICAgICAgfSkuY2F0Y2goKHJlYXNvbikgPT4ge1xyXG4gICAgICAgIHJlamVjdChyZWFzb24pO1xyXG4gICAgICB9KTtcclxuXHJcbiAgICB9KTtcclxuXHJcbiAgfVxyXG5cclxuICBoeXBlcnRpZXModXNlcnMsIHNjaGVtZXMsIHJlc291cmNlcywgZ2xvYmFsRmxhZyA9IGZhbHNlKSB7XHJcbiAgICAvL1RPRE86IHJldXNlIHVzZXJzIG9yIHRoZSBvdGhlciB3YXkgYXJvdW5kXHJcblxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogTGlzdCBvZiB1c2Vyc1VSTCB0byBzZWFyY2hcclxuICAgKiBAcGFyYW0gIHthcnJheTxVUkwudXNlclVSTD59ICB1c2VycyBMaXN0IG9mIFVzZXJVUiwgbGlrZSB0aGlzIGZvcm1hdCB1c2VyOi8vPGlwZGRvbWFpbj4vPHVzZXItaWRlbnRpZmllcj5cclxuICAgKiBAcmV0dXJuIHtQcm9taXNlfVxyXG4gICAqL1xyXG4gIHVzZXJzKHVzZXJzVVJMcywgcHJvdmlkZWREb21haW5zLCBzY2hlbWVzLCByZXNvdXJjZXMsIGdsb2JhbEZsYWcgPSBmYWxzZSkge1xyXG5cclxuICAgIGlmICghdXNlcnNVUkxzKSB0aHJvdyBuZXcgRXJyb3IoJ1lvdSBuZWVkIHRvIHByb3ZpZGUgYSBsaXN0IG9mIHVzZXJzJyk7XHJcbiAgICBpZiAoIXByb3ZpZGVkRG9tYWlucykgdGhyb3cgbmV3IEVycm9yKCdZb3UgbmVlZCB0byBwcm92aWRlIGEgbGlzdCBvZiBkb21haW5zJyk7XHJcbiAgICBpZiAoIXJlc291cmNlcykgdGhyb3cgbmV3IEVycm9yKCdZb3UgbmVlZCB0byBwcm92aWRlIGEgbGlzdCBvZiByZXNvdXJjZXMnKTtcclxuICAgIGlmICghc2NoZW1lcykgdGhyb3cgbmV3IEVycm9yKCdZb3UgbmVlZCB0byBwcm92aWRlIGEgbGlzdCBvZiBzY2hlbWVzJyk7XHJcblxyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuXHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcblxyXG4gICAgICBjb25zb2xlLmluZm8oJ1tTZWFyY2hdIFVzZXJzOiAnLCB1c2Vyc1VSTHMsIHVzZXJzVVJMcy5sZW5ndGgpO1xyXG4gICAgICBjb25zb2xlLmluZm8oJ1tTZWFyY2hdIERvbWFpbnM6ICcsIHByb3ZpZGVkRG9tYWlucywgcHJvdmlkZWREb21haW5zLmxlbmd0aCk7XHJcbiAgICAgIGlmICh1c2Vyc1VSTHMubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgICAgY29uc29sZS5pbmZvKCdEb25cXCd0IGhhdmUgdXNlcnMgdG8gZGlzY292ZXJ5Jyk7XHJcbiAgICAgICAgcmVzb2x2ZSh1c2Vyc1VSTHMpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGxldCBnZXRVc2VycyA9IFtdO1xyXG5cclxuICAgICAgICB1c2Vyc1VSTHMuZm9yRWFjaCgodXNlclVSTCwgaW5kZXgpID0+IHtcclxuICAgICAgICAgIGxldCBjdXJyZW50RG9tYWluID0gcHJvdmlkZWREb21haW5zW2luZGV4XTtcclxuICAgICAgICAgIGNvbnNvbGUuaW5mbygnW1NlYXJjaF0gU2VhcmNoIHVzZXIgJyArIHVzZXJVUkwgKyAnIGZvciBwcm92aWRlZCBkb21haW46JywgY3VycmVudERvbWFpbik7XHJcbiAgICAgICAgICBpZiAoIWdsb2JhbEZsYWcpIHtcclxuICAgICAgICAgICAgZ2V0VXNlcnMucHVzaChfdGhpcy5kaXNjb3ZlcnkuZGlzY292ZXJIeXBlcnRpZXModXNlclVSTCwgc2NoZW1lcywgcmVzb3VyY2VzLCBjdXJyZW50RG9tYWluKSk7XHJcbiAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBnZXRVc2Vycy5wdXNoKF90aGlzLmRpc2NvdmVyeS5kaXNjb3Zlckh5cGVydGllc1BlclVzZXJQcm9maWxlRGF0YSh1c2VyVVJMLCBzY2hlbWVzLCByZXNvdXJjZXMpKTtcclxuICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGNvbnNvbGUuaW5mbygnUmVxdWVzdHMgcHJvbWlzZXM6ICcsIGdldFVzZXJzKTtcclxuXHJcbiAgICAgICAgUHJvbWlzZS5hbGwoZ2V0VXNlcnMubWFwKChwcm9taXNlKSA9PiB7XHJcbiAgICAgICAgICByZXR1cm4gcHJvbWlzZS50aGVuKChoeXBlcnR5KSA9PiB7IHJldHVybiBoeXBlcnR5OyB9LCAoZXJyb3IpID0+IHsgcmV0dXJuIGVycm9yOyB9KTtcclxuICAgICAgICB9KSkudGhlbigoaHlwZXJ0aWVzKSA9PiB7XHJcblxyXG4gICAgICAgICAgY29uc29sZS5pbmZvKCdbU2VhcmNoXSBIeXBlcnRpZXMgZnJvbSBuZXcgRGlzY292ZXJ5JywgaHlwZXJ0aWVzKTtcclxuICAgICAgICAgIGxldCByZXN1bHQgPSBoeXBlcnRpZXMubWFwKGZ1bmN0aW9uKGh5cGVydHkpIHtcclxuXHJcbiAgICAgICAgICAgIGlmIChoeXBlcnR5Lmhhc093blByb3BlcnR5KCdoeXBlcnR5SUQnKSlcclxuICAgICAgICAgICAgICByZXR1cm4gaHlwZXJ0eTtcclxuICAgICAgICAgICAgbGV0IHJlY2VudCA9IE9iamVjdC5rZXlzKGh5cGVydHkpLnJlZHVjZVJpZ2h0KGZ1bmN0aW9uKGEsIGIpIHtcclxuICAgICAgICAgICAgICBsZXQgaHlwZXJ0eURhdGUgPSBuZXcgRGF0ZShoeXBlcnR5W2JdLmxhc3RNb2RpZmllZCk7XHJcbiAgICAgICAgICAgICAgbGV0IGh5cGVydHlEYXRlUCA9IG5ldyBEYXRlKGh5cGVydHlbYV0ubGFzdE1vZGlmaWVkKTtcclxuICAgICAgICAgICAgICBpZiAoaHlwZXJ0eURhdGVQLmdldFRpbWUoKSA8IGh5cGVydHlEYXRlLmdldFRpbWUoKSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGI7XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgIHJldHVybiBhO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiBoeXBlcnR5W3JlY2VudF07XHJcbiAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICBsZXQgY2xlYW4gPSByZXN1bHQuZmlsdGVyKChoeXBlcnR5KSA9PiB7XHJcbiAgICAgICAgICAgIHJldHVybiBoeXBlcnR5Lmhhc093blByb3BlcnR5KCdoeXBlcnR5SUQnKTtcclxuICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgIGNvbnNvbGUubG9nKCdSZXF1ZXN0cyByZXN1bHQ6ICcsIGNsZWFuKTtcclxuXHJcbiAgICAgICAgICBoeXBlcnRpZXMuZm9yRWFjaChmdW5jdGlvbihlbnRyeSkge1xyXG4gICAgICAgICAgICBpZiAoZW50cnkgIT09ICdObyBIeXBlcnR5IHdhcyBmb3VuZCcpIHtcclxuICAgICAgICAgICAgICByZXR1cm4gcmVzb2x2ZShjbGVhbik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgIHJlamVjdCgnTm8gSHlwZXJ0eSB3YXMgZm91bmQnKTtcclxuXHJcbiAgICAgICAgfSkuY2F0Y2goKHJlYXNvbikgPT4ge1xyXG4gICAgICAgICAgY29uc29sZS5lcnJvcihyZWFzb24pO1xyXG4gICAgICAgICAgcmVzb2x2ZSh1c2Vyc1VSTHMpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBkZWZhdWx0IFNlYXJjaDtcclxuIiwiLyoqXHJcbiogQ29weXJpZ2h0IDIwMTYgUFQgSW5vdmHDp8OjbyBlIFNpc3RlbWFzIFNBXHJcbiogQ29weXJpZ2h0IDIwMTYgSU5FU0MtSURcclxuKiBDb3B5cmlnaHQgMjAxNiBRVU9CSVMgTkVUV09SS1MgU0xcclxuKiBDb3B5cmlnaHQgMjAxNiBGUkFVTkhPRkVSLUdFU0VMTFNDSEFGVCBaVVIgRk9FUkRFUlVORyBERVIgQU5HRVdBTkRURU4gRk9SU0NIVU5HIEUuVlxyXG4qIENvcHlyaWdodCAyMDE2IE9SQU5HRSBTQVxyXG4qIENvcHlyaWdodCAyMDE2IERldXRzY2hlIFRlbGVrb20gQUdcclxuKiBDb3B5cmlnaHQgMjAxNiBBcGl6ZWVcclxuKiBDb3B5cmlnaHQgMjAxNiBURUNITklTQ0hFIFVOSVZFUlNJVEFUIEJFUkxJTlxyXG4qXHJcbiogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbipcclxuKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4qXHJcbiogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4qIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbioqL1xyXG4vKipcclxuICogRXZlbnRFbWl0dGVyXHJcbiAqIEFsbCBjbGFzc2VzIHdoaWNoIGV4dGVuZHMgdGhpcywgY2FuIGhhdmUgYWRkRXZlbnRMaXN0ZW5lciBhbmQgdHJpZ2dlciBldmVudHM7XHJcbiAqL1xyXG5jbGFzcyBFdmVudEVtaXR0ZXIge1xyXG5cclxuICAvKipcclxuICAgKiBhZGRFdmVudExpc3RlbmVyIGxpc3RlbiBmb3IgYW4gZXZlbnRUeXBlXHJcbiAgICogQHBhcmFtICB7c3RyaW5nfSAgICAgICAgIGV2ZW50VHlwZSAtIGxpc3RlbmluZyBmb3IgdGhpcyB0eXBlIG9mIGV2ZW50XHJcbiAgICogQHBhcmFtICB7RnVuY3Rpb259ICAgICAgIGNiICAgICAgICAtIGNhbGxiYWNrIGZ1bmN0aW9uIHdpbGwgYmUgZXhlY3V0ZWQgd2hlbiB0aGUgZXZlbnQgaXQgaXMgaW52b2tlZFxyXG4gICAqL1xyXG4gIGFkZEV2ZW50TGlzdGVuZXIoZXZlbnRUeXBlLCBjYikge1xyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuICAgIF90aGlzW2V2ZW50VHlwZV0gPSBjYjtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEludm9rZSB0aGUgZXZlbnRUeXBlXHJcbiAgICogQHBhcmFtICB7c3RyaW5nfSBldmVudFR5cGUgLSBldmVudCB3aWxsIGJlIGludm9rZWRcclxuICAgKiBAcGFyYW0gIHtvYmplY3R9IHBhcmFtcyAtIHBhcmFtZXRlcnMgd2lsbCBiZSBwYXNzZWQgdG8gdGhlIGFkZEV2ZW50TGlzdGVuZXJcclxuICAgKi9cclxuICB0cmlnZ2VyKGV2ZW50VHlwZSwgcGFyYW1zKSB7XHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG5cclxuICAgIGlmIChfdGhpc1tldmVudFR5cGVdKSB7XHJcbiAgICAgIF90aGlzW2V2ZW50VHlwZV0ocGFyYW1zKTtcclxuICAgIH1cclxuICB9XHJcblxyXG59XHJcblxyXG5leHBvcnQgZGVmYXVsdCBFdmVudEVtaXR0ZXI7XHJcbiIsIi8vaW1wb3J0IElkZW50aXR5TWFuYWdlciBmcm9tICcuLi9pZGVudGl0eU1hbmFnZXIvSWRlbnRpdHlNYW5hZ2VyJztcclxuLy9pbXBvcnQgU3luY2hlciBmcm9tICcuLi9zeW5jaGVyL1N5bmNoZXIuanMnO1xyXG4vL2ltcG9ydCBEaXNjb3ZlcnkgZnJvbSAnLi4vZGlzY292ZXJ5L0Rpc2NvdmVyeS5qcyc7XHJcbi8vaW1wb3J0IHtkaXZpZGVVUkx9IGZyb20gJy4uL3V0aWxzL3V0aWxzJztcclxuXHJcbi8vaW1wb3J0IFNlYXJjaCBmcm9tICcuLi91dGlscy9TZWFyY2gnO1xyXG5pbXBvcnQgRXZlbnRFbWl0dGVyIGZyb20gJy4uL3V0aWxzL0V2ZW50RW1pdHRlcic7XHJcblxyXG4vKipcclxuKiBDb250ZXh0IE9ic2VydmVyO1xyXG4qIEBhdXRob3IgUGF1bG8gQ2hhaW5obyBbcGF1bG8tZy1jaGFpbmhvQGFsdGljZWxhYnMuY29tXVxyXG4qL1xyXG5cclxuY2xhc3MgQ29udGV4dE9ic2VydmVyIGV4dGVuZHMgRXZlbnRFbWl0dGVyIHtcclxuXHJcbiAgY29uc3RydWN0b3IoaHlwZXJ0eVVSTCwgYnVzLCBjb25maWd1cmF0aW9uLCBjb250ZXh0UmVzb3VyY2VUeXBlcywgZmFjdG9yeSwgc3luY2hlcikge1xyXG4gICAgaWYgKCFoeXBlcnR5VVJMKSB0aHJvdyBuZXcgRXJyb3IoJ1RoZSBoeXBlcnR5VVJMIGlzIGEgbmVlZGVkIHBhcmFtZXRlcicpO1xyXG4gICAgaWYgKCFidXMpIHRocm93IG5ldyBFcnJvcignVGhlIE1pbmlCdXMgaXMgYSBuZWVkZWQgcGFyYW1ldGVyJyk7XHJcbiAgICBpZiAoIWNvbmZpZ3VyYXRpb24pIHRocm93IG5ldyBFcnJvcignVGhlIGNvbmZpZ3VyYXRpb24gaXMgYSBuZWVkZWQgcGFyYW1ldGVyICcpO1xyXG4gICAgaWYgKCFmYWN0b3J5KSB0aHJvdyBuZXcgRXJyb3IoJ1RoZSBmYWN0b3J5IGlzIGEgbmVlZGVkIHBhcmFtZXRlciAnKTtcclxuXHJcbiAgICBzdXBlcigpO1xyXG5cclxuICAgIGxldCBfdGhpcyA9IHRoaXM7XHJcblxyXG4gICAgX3RoaXMuX2NvbnRleHRSZXNvdXJjZVR5cGVzID0gY29udGV4dFJlc291cmNlVHlwZXM7XHJcbiAgICBfdGhpcy5fdXJsID0gaHlwZXJ0eVVSTDtcclxuICAgIF90aGlzLl9kaXNjb3ZlclVzZXJzUHJvbWlzZXMgPSB7fTsgLy8gb2JqZWN0IHdpdGggcHJvbWlzZXMgZXhlY3V0ZWQgYXQgZGlzY292ZXJVc2VycyBmdW5jdGlvblxyXG4gICAgX3RoaXMuX29ic2VydmVQcm9taXNlcyA9IHt9OyAvLyBvYmplY3Qgd2l0aCBwcm9taXNlcyBleGVjdXRlZCBhdCBvYnNlcnZlIGZ1bmN0aW9uXHJcblxyXG5cclxuICAgIC8vbGV0IGlkZW50aXR5TWFuYWdlciA9IG5ldyBJZGVudGl0eU1hbmFnZXIoaHlwZXJ0eVVSTCwgY29uZmlndXJhdGlvbi5ydW50aW1lVVJMLCBidXMpO1xyXG4gICAgY29uc29sZS5sb2coJ1tDb250ZXh0T2JzZXJ2ZXJdIHN0YXJ0ZWQgd2l0aCBoeXBlcnR5VVJMLT4nLCBoeXBlcnR5VVJMKTtcclxuICAgIF90aGlzLl9kb21haW4gPSBmYWN0b3J5LmRpdmlkZVVSTChjb25maWd1cmF0aW9uLnJ1bnRpbWVVUkwpLmRvbWFpbjtcclxuICAgIF90aGlzLl9vYmplY3REZXNjVVJMID0gJ2h5cGVydHktY2F0YWxvZ3VlOi8vY2F0YWxvZ3VlLicgKyBfdGhpcy5fZG9tYWluICsgJy8ud2VsbC1rbm93bi9kYXRhc2NoZW1hL0NvbnRleHQnO1xyXG5cclxuICAgIF90aGlzLl91c2VyczJvYnNlcnZlID0gW107XHJcbiAgICBfdGhpcy5fb2JzZXJ2ZXJzID0ge307XHJcblxyXG4gICAgdGhpcy5fc3luY2hlciA9IHN5bmNoZXIgPyBzeW5jaGVyIDogZmFjdG9yeS5jcmVhdGVTeW5jaGVyKGh5cGVydHlVUkwsIGJ1cywgY29uZmlndXJhdGlvbik7XHJcblxyXG4gICAgbGV0IGRpc2NvdmVyeSA9IGZhY3RvcnkuY3JlYXRlRGlzY292ZXJ5KGh5cGVydHlVUkwsIGNvbmZpZ3VyYXRpb24ucnVudGltZVVSTCwgYnVzKTtcclxuICAgIF90aGlzLl9kaXNjb3ZlcnkgPSBkaXNjb3Zlcnk7XHJcblxyXG4gICAgX3RoaXMuX2Rpc2NvdmVyaWVzID0ge307IC8vbGlzdCBvZiBkaXNjb3ZlcmVkIG9iamVjdHNcclxuICAgIC8vX3RoaXMuaWRlbnRpdHlNYW5hZ2VyID0gaWRlbnRpdHlNYW5hZ2VyO1xyXG4gICAgLy9fdGhpcy5zZWFyY2ggPSBuZXcgU2VhcmNoKGRpc2NvdmVyeSwgaWRlbnRpdHlNYW5hZ2VyKTtcclxuICAgIHdpbmRvdy5kaXNjb3ZlcnkgPSBfdGhpcy5fZGlzY292ZXJ5O1xyXG4gIH1cclxuXHJcblxyXG4gIHN0YXJ0KHJlc3VtZWRDb250ZXh0LCBkaXNjb25uZWN0ZWRDYWxsQmFjaykge1xyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuICAgIGNvbnNvbGUubG9nKCdbQ29udGV4dE9ic2VydmVyLnN0YXJ0XSAnKTtcclxuXHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xyXG4gICAgICBfdGhpcy5fc3luY2hlci5yZXN1bWVPYnNlcnZlcnMoe3N0b3JlOiB0cnVlfSkudGhlbigob2JzZXJ2ZXJzKSA9PiB7XHJcblxyXG4gICAgICAgIGxldCBvYnNlcnZlcnNMaXN0ID0gT2JqZWN0LmtleXMob2JzZXJ2ZXJzKTtcclxuXHJcbiAgICAgICAgaWYgKG9ic2VydmVyc0xpc3QubGVuZ3RoICA+IDApIHtcclxuXHJcbiAgICAgICAgICBjb25zb2xlLmxvZygnW0NvbnRleHRPYnNlcnZlci5zdGFydF0gcmVzdW1pbmc6ICcsIG9ic2VydmVycyk7XHJcblxyXG4gICAgICAgICAgLypvYnNlcnZlcnNMaXN0LmZvckVhY2goKGkpPT57XHJcbiAgICAgICAgICBfdGhpcy5fdXNlcnMyb2JzZXJ2ZS5wdXNoKG5ldyBVc2VyQXZhaWxhYmlsaXR5Q29udHJvbGxlcihvYnNlcnZlcnNbaV0pKTtcclxuICAgICAgICB9KTsqL1xyXG4gICAgICAgICAgX3RoaXMuX29ic2VydmVycyA9IG9ic2VydmVycztcclxuXHJcbiAgICAgICAgICByZXNvbHZlKG9ic2VydmVycyk7XHJcblxyXG4gICAgICAgICAgb2JzZXJ2ZXJzTGlzdC5mb3JFYWNoKChvYnNlcnZlcikgPT57XHJcbiAgICAgICAgICAgIGxldCBDb250ZXh0ID0gb2JzZXJ2ZXJzW29ic2VydmVyXTtcclxuXHJcbiAgICAgICAgICAgIC8vIEJ5IGRlZmF1bHQgcmVzdW1lZCBjb250ZXh0IGlzIHNldCB3aXRoIHJlc3VtZWRDb250ZXh0LlxyXG4gICAgICAgICAgICBpZiAocmVzdW1lZENvbnRleHQpIGNvbnRleHQuZGF0YS52YWx1ZXMgPSByZXN1bWVkQ29udGV4dDtcclxuXHJcbiAgICAgICAgICAgIC8vIENvbnRleHQgd2lsbCB3aWxsIGJlIHVwZGF0ZWQgd2l0aCB2YWx1ZSBzeW5jaHJvbml6ZWQgd2l0aCByZXBvcnRlciBpZiBjb25uZWN0ZWRcclxuICAgICAgICAgICAgQ29udGV4dC5zeW5jKCk7XHJcblxyXG4gICAgICAgICAgICAvL0FkZCBsaXN0ZW5lciB0byBiZSBub3RpZmllZCB3aGVuIHJlcG9ydGVyIGlzIGFicnVwdGx5IGRpc2Nvbm5lY3RlZFxyXG4gICAgICAgICAgICBpZiAoZGlzY29ubmVjdGVkQ2FsbEJhY2spIENvbnRleHQub25EaXNjb25uZWN0ZWQoZGlzY29ubmVjdGVkQ2FsbEJhY2spO1xyXG4gICAgICAgICAgfSk7XHJcblxyXG5cclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgcmVzb2x2ZShmYWxzZSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgfSkuY2F0Y2goKHJlYXNvbikgPT4ge1xyXG4gICAgICAgIGNvbnNvbGUuaW5mbygnW0NvbnRleHRPYnNlcnZlcl0gUmVzdW1lIE9ic2VydmVyIGZhaWxlZCB8ICcsIHJlYXNvbik7XHJcbiAgICAgICAgcmVzb2x2ZShmYWxzZSk7XHJcbiAgICAgIH0pO1xyXG4gICAgfSkuY2F0Y2goKHJlYXNvbikgPT4ge1xyXG4gICAgICByZWplY3QoJ1tDb250ZXh0T2JzZXJ2ZXJdIFN0YXJ0IGZhaWxlZCB8ICcsIHJlYXNvbik7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIHJlc3VtZURpc2NvdmVyaWVzKCkge1xyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuXHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xyXG4gICAgICBfdGhpcy5fZGlzY292ZXJ5LnJlc3VtZURpc2NvdmVyaWVzKCkudGhlbigoZGlzY292ZXJpZXMpID0+IHtcclxuXHJcbiAgICAgICAgY29uc29sZS5sb2coJ1tDb250ZXh0T2JzZXJ2ZXIuX3Jlc3VtZURpc2NvdmVyaWVzXSBmb3VuZDogJywgZGlzY292ZXJpZXMpO1xyXG5cclxuICAgICAgICBkaXNjb3Zlcmllcy5mb3JFYWNoKChkaXNjb3ZlcnkpID0+e1xyXG5cclxuICAgICAgICAgIGlmIChkaXNjb3ZlcnkuZGF0YS5yZXNvdXJjZXMgJiYgZGlzY292ZXJ5LmRhdGEucmVzb3VyY2VzWzBdID09PSBfdGhpcy5fY29udGV4dFJlc291cmNlVHlwZXNbMF0pIHtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coJ1tDb250ZXh0T2JzZXJ2ZXIuX3Jlc3VtZURpc2NvdmVyaWVzXSByZXN1bWluZzogJywgZGlzY292ZXJ5KTtcclxuXHJcbiAgICAgICAgICAgIGlmIChkaXNjb3ZlcnkuZGF0YS5zdGF0dXMgPT09ICdsaXZlJykgeyAvLyBwcmV2aW91c2x5IGRpc2NvdmVyZWQgb2JqZWN0IGlzIG5vdyBsaXZlXHJcbiAgICAgICAgICAgICAgcmVzb2x2ZShbZGlzY292ZXJ5LmRhdGFdKTtcclxuICAgICAgICAgICAgICBkaXNjb3ZlcnkudW5zdWJzY3JpYmVMaXZlKF90aGlzLl91cmwpO1xyXG4gICAgICAgICAgICB9IGVsc2UgeyAvLyBwcmV2aW91c2x5IGRpc2NvdmVyZWQgb2JqZWN0IGlzIHN0aWxsIGRpc2Nvbm5lY3RlZFxyXG4gICAgICAgICAgICAgIGRpc2NvdmVyeS5vbkxpdmUoX3RoaXMuX3VybCwgKCk9PntcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdbQ29udGV4dE9ic2VydmVyLl9yZXN1bWVEaXNjb3Zlcmllc10gZGlzY29ubmVjdGVkIEh5cGVydHkgaXMgYmFjayB0byBsaXZlJywgZGlzY292ZXJ5KTtcclxuICAgICAgICAgICAgICAgIHJlc29sdmUoW2Rpc2NvdmVyeS5kYXRhXSk7XHJcbiAgICAgICAgICAgICAgICBkaXNjb3ZlcnkudW5zdWJzY3JpYmVMaXZlKF90aGlzLl91cmwpO1xyXG4gICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH0pO1xyXG4gICAgfSkuY2F0Y2goKHJlYXNvbikgPT4ge1xyXG4gICAgICByZWplY3QoJ1tDb250ZXh0T2JzZXJ2ZXJdIHJlc3VtZURpc2NvdmVyaWVzIGZhaWxlZCB8ICcsIHJlYXNvbik7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIG9uUmVzdW1lT2JzZXJ2ZXIoY2FsbGJhY2spIHtcclxuICAgIGxldCBfdGhpcyA9IHRoaXM7XHJcbiAgICBfdGhpcy5fb25SZXN1bWVPYnNlcnZlciA9IGNhbGxiYWNrO1xyXG4gIH1cclxuXHJcblxyXG4gIGRpc2NvdmVyVXNlcnMoZW1haWwsIGRvbWFpbikge1xyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuXHJcblxyXG4gICAgbGV0IHVzZXIgPSBlbWFpbCArICdAJyArIGRvbWFpbjtcclxuXHJcbiAgICBpZiAoIV90aGlzLl9kaXNjb3ZlclVzZXJzUHJvbWlzZXNbdXNlcl0pIHtcclxuICAgICAgX3RoaXMuX2Rpc2NvdmVyVXNlcnNQcm9taXNlc1t1c2VyXSA9IG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG5cclxuICAgICAgICBfdGhpcy5fZGlzY292ZXJ5LmRpc2NvdmVySHlwZXJ0aWVzRE8oZW1haWwsIFsnY29udGV4dCddLCBfdGhpcy5fY29udGV4dFJlc291cmNlVHlwZXMsIGRvbWFpbikudGhlbihoeXBlcnRpZXMgPT57XHJcbiAgICAgICAgICAvL190aGlzLnNlYXJjaC51c2VycyhbZW1haWxdLCBbZG9tYWluXSwgWydjb250ZXh0J10sIFsnQ29udGV4dF9jb250ZXh0J10pLnRoZW4oZnVuY3Rpb24oYSkge1xyXG4gICAgICAgICAgY29uc29sZS5sb2coJ1tDb250ZXh0T2JzZXJ2ZXIuZGlzY292ZXJVc2Vyc10gZGlzY292ZXJ5IHJlc3VsdC0+JywgaHlwZXJ0aWVzKTtcclxuICAgICAgICAgIGxldCBkaXNjb3ZlcmVkID0gW107XHJcbiAgICAgICAgICBsZXQgZGlzY29ubmVjdGVkID0gW107XHJcbiAgICAgICAgICBoeXBlcnRpZXMuZm9yRWFjaChoeXBlcnR5ID0+e1xyXG4gICAgICAgICAgICBfdGhpcy5fZGlzY292ZXJpZXNbaHlwZXJ0eS5kYXRhLmh5cGVydHlJRF0gPSBoeXBlcnR5O1xyXG4gICAgICAgICAgICBpZiAoaHlwZXJ0eS5kYXRhLnN0YXR1cyA9PT0gJ2xpdmUnKSB7XHJcbiAgICAgICAgICAgICAgZGlzY292ZXJlZC5wdXNoKGh5cGVydHkuZGF0YSk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgZGlzY29ubmVjdGVkLnB1c2goaHlwZXJ0eSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH0pO1xyXG5cclxuXHJcbiAgICAgICAgICBpZiAoZGlzY292ZXJlZC5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdbQ29udGV4dE9ic2VydmVyLmRpc2NvdmVyVXNlcnNdIHJldHVybmluZyBkaXNjb3ZlcmVkIGh5cGVydGllcyBkYXRhLT4nLCBkaXNjb3ZlcmVkKTtcclxuICAgICAgICAgICAgcmVzb2x2ZShkaXNjb3ZlcmVkKTtcclxuICAgICAgICAgIH0gZWxzZSBpZiAoZGlzY29ubmVjdGVkLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coJ1tDb250ZXh0T2JzZXJ2ZXIuZGlzY292ZXJVc2Vyc10gZGlzY29ubmVjdGVkIEh5cGVydGllcyAnLCBkaXNjb25uZWN0ZWQpO1xyXG5cclxuICAgICAgICAgICAgLy9yZXNvbHZlKFtdKTtcclxuXHJcbiAgICAgICAgICAgIGRpc2Nvbm5lY3RlZFswXS5vbkxpdmUoX3RoaXMuX3VybCwgKCk9PntcclxuICAgICAgICAgICAgICBjb25zb2xlLmxvZygnW0NvbnRleHRPYnNlcnZlci5kaXNjb3ZlclVzZXJzXSBkaXNjb25uZWN0ZWQgSHlwZXJ0eSBpcyBiYWNrIHRvIGxpdmUnLCBkaXNjb25uZWN0ZWRbMF0pO1xyXG5cclxuICAgICAgICAgICAgICBkaXNjb3ZlcmVkLnB1c2goZGlzY29ubmVjdGVkWzBdLmRhdGEpO1xyXG4gICAgICAgICAgICAgIHJlc29sdmUoZGlzY292ZXJlZCk7XHJcbiAgICAgICAgICAgICAgZGlzY29ubmVjdGVkWzBdLnVuc3Vic2NyaWJlTGl2ZShfdGhpcy5fdXJsKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIF90aGlzLl9kaXNjb3ZlclVzZXJzUHJvbWlzZXNbdXNlcl07XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBUaGlzIGZ1bmN0aW9uIGlzIHVzZWQgdG8gc3RhcnQgdGhlIHVzZXIgQ29udGV4dCBvYnNlcnZhdGlvbiBmb3IgYSBjZXJ0YWluIHVzZXIgQ29udGV4dCByZXBvcnRlclxyXG4gICAqIEBwYXJhbSAge0Rpc2NvdmVyZWRPYmplY3R9IGh5cGVydHkgICAgICAgSHlwZXJ0eSB0byBiZSBvYnNlcnZlZC5cclxuICAgKiBAcmV0dXJuIHs8UHJvbWlzZT4gRGF0YU9iamVjdE9ic2VydmVyfSAgICAgIEl0IHJldHVybnMgYXMgYSBQcm9taXNlIHRoZSBVc2VyQXZhaWxhYmlsaXR5IERhdGEgT2JqZWN0IE9ic2VydmVyLlxyXG4gICAqL1xyXG5cclxuICBvYnNlcnZlKGh5cGVydHksIGRvbWFpblN1YnNjcmlwdGlvbiA9IHRydWUpIHtcclxuICAgIGxldCBfdGhpcyA9IHRoaXM7XHJcbiAgICBpZiAoIV90aGlzLl9vYnNlcnZlUHJvbWlzZXNbaHlwZXJ0eS5oeXBlcnR5SURdKSB7XHJcbiAgICAgIF90aGlzLl9vYnNlcnZlUHJvbWlzZXNbaHlwZXJ0eS5oeXBlcnR5SURdID0gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgIC8vY2hlY2sgaWYgd2UgYXJlIGFscmVhZHkgb2JzZXJ2aW5nIGl0XHJcbiAgICAgICAgX3RoaXMuX3VzZXJzMm9ic2VydmUuZm9yRWFjaCgoQ29udGV4dCkgPT4ge1xyXG4gICAgICAgICAgaWYgKENvbnRleHQuX3JlcG9ydGVyID09PSBoeXBlcnR5Lmh5cGVydHlJRCkgcmV0dXJuIHJlc29sdmUoQ29udGV4dCk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIF90aGlzLl9kaXNjb3ZlcnkuZGlzY292ZXJEYXRhT2JqZWN0c1BlclJlcG9ydGVyKGh5cGVydHkuaHlwZXJ0eUlELCBbJ2NvbnRleHQnXSwgX3RoaXMuX2NvbnRleHRSZXNvdXJjZVR5cGVzLCAgX3RoaXMuX2RvbWFpbikudGhlbihmdW5jdGlvbihkYXRhT2JqZWN0cykge1xyXG4gICAgICAgICAgY29uc29sZS5sb2coJ1tDb250ZXh0T2JzZXJ2ZXIuZGlzY292ZXJBdmFpbGFiaWxpdHldIGRpc2NvdmVyZWQgY29udGV4dCBvYmplY3RzICcsIGRhdGFPYmplY3RzKTtcclxuICAgICAgICAgIGxldCBsYXN0ID0gMDtcclxuICAgICAgICAgIGxldCB1cmw7XHJcblxyXG4gICAgICAgICAgZGF0YU9iamVjdHMuZm9yRWFjaCgoZGF0YU9iamVjdCkgPT4ge1xyXG4gICAgICAgICAgICBpZiAoZGF0YU9iamVjdC5oYXNPd25Qcm9wZXJ0eSgnbGFzdE1vZGlmaWVkJykgJiYgZGF0YU9iamVjdC5oYXNPd25Qcm9wZXJ0eSgndXJsJykgJiYgRGF0ZS5wYXJzZShkYXRhT2JqZWN0Lmxhc3RNb2RpZmllZCkgPiBsYXN0KSB7XHJcbiAgICAgICAgICAgICAgbGFzdCA9IGRhdGFPYmplY3QubGFzdE1vZGlmaWVkO1xyXG4gICAgICAgICAgICAgIHVybCA9IGRhdGFPYmplY3QudXJsO1xyXG5cclxuICAgICAgICAgICAgLy9jb25zb2xlLmxvZygnVVJMIERBVEEgT2JqZWN0JywgdXJsKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfSk7XHJcbiAgICAgICAgICBpZiAobGFzdCAhPSAwICYmIHVybCkge1xyXG4gICAgICAgICAgICByZXNvbHZlKF90aGlzLl9zdWJzY3JpYmVDb250ZXh0KGh5cGVydHksIHVybCwgZG9tYWluU3Vic2NyaXB0aW9uKSk7XHJcbiAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICByZWplY3QoJ1tDb250ZXh0T2JzZXJ2ZXIub2JzZXJ2ZV0gZGlzY292ZXJlZCBEYXRhT2JqZWNzIGFyZSBpbnZhbGlkJywgZGF0YU9iamVjdHMpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgICB9KTtcclxuICAgIH1cclxuICAgIHJldHVybiBfdGhpcy5fb2JzZXJ2ZVByb21pc2VzW2h5cGVydHkuaHlwZXJ0eUlEXTtcclxuICB9XHJcblxyXG4gIF9zdWJzY3JpYmVDb250ZXh0KGh5cGVydHksIHVybCwgZG9tYWluU3Vic2NyaXB0aW9uID0gdHJ1ZSkge1xyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuXHJcbiAgICAvLyBhdm9pZCBkdXBsaWNhdGVkIHN1YnNjcmlwdGlvbnNcclxuXHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgIF90aGlzLl91c2VyczJvYnNlcnZlLmZvckVhY2goKENvbnRleHQpID0+IHtcclxuICAgICAgICBpZiAoQ29udGV4dC51cmwgPT09IHVybCkgcmV0dXJuIHJlc29sdmUoQ29udGV4dCk7XHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgbGV0IGlucHV0ID0ge1xyXG4gICAgICAgIHNjaGVtYTogX3RoaXMuX29iamVjdERlc2NVUkwsXHJcbiAgICAgICAgcmVzb3VyY2U6IHVybCxcclxuICAgICAgICBzdG9yZTogbnVsbCxcclxuICAgICAgICBwMnA6IG51bGwsXHJcbiAgICAgICAgbXV0dWFsOiBudWxsLFxyXG4gICAgICAgIGRvbWFpbl9zdWJzY3JpcHRpb246IGRvbWFpblN1YnNjcmlwdGlvblxyXG4gICAgICB9O1xyXG5cclxuICAgICAgX3RoaXMuX3N5bmNoZXIuc3Vic2NyaWJlKGlucHV0KS50aGVuKChDb250ZXh0KSA9PiB7XHJcbiAgICAgICAgY29uc29sZS5sb2coJ1tDb250ZXh0T2JzZXJ2ZXIuX3N1YnNjcmliZUNvbnRleHRdIG9ic2VydmVyIG9iamVjdCcsIENvbnRleHQpO1xyXG5cclxuICAgICAgICAvL2xldCBuZXdVc2VyQXZhaWxhYmlsaXR5ID0gbmV3IFVzZXJBdmFpbGFiaWxpdHlDb250cm9sbGVyKENvbnRleHQsIHVzZXJJRCk7XHJcblxyXG4gICAgICAgIF90aGlzLl91c2VyczJvYnNlcnZlLnB1c2goQ29udGV4dCk7XHJcblxyXG4gICAgICAgIC8vIFdoZW4gT2JqZWN0IGlzIGRpc2Nvbm5lY3RlZCBzZXQgdXNlciBDb250ZXh0IHN0YXR1cyBhcyB1bmF2YWlsYWJsZVxyXG4gICAgICAgIENvbnRleHQub25EaXNjb25uZWN0ZWQoKCk9PntcclxuICAgICAgICAgIGNvbnNvbGUubG9nKCdbQ29udGV4dE9ic2VydmVyLm9uRGlzY29ubmVjdGVkXTogJywgQ29udGV4dCk7XHJcblxyXG4gICAgICAgICAgQ29udGV4dC5kYXRhLnZhbHVlc1swXS52YWx1ZSA9ICd1bmF2YWlsYWJsZSc7XHJcbiAgICAgICAgICBDb250ZXh0LnN5bmMoKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgcmVzb2x2ZShDb250ZXh0KTtcclxuICAgICAgfSk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIF9kaXNjb3ZlckFuZFN1YnNjcmliZUxlZ2FjeVVzZXJzKG5hbWUpIHtcclxuICAgIGxldCBfdGhpcyA9IHRoaXM7XHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgIF90aGlzLl9kaXNjb3ZlcnkuZGlzY292ZXJEYXRhT2JqZWN0c1Blck5hbWUobmFtZSkudGhlbihmdW5jdGlvbihyZXN1bHQpIHtcclxuICAgICAgICBjb25zb2xlLmxvZygnW0NvbnRleHRPYnNlcnZlci5fZGlzY292ZXJBbmRTdWJzY3JpYmVMZWdhY3lVc2Vyc10gQWxsIERhdGFPYmplY3RzIFJlc3VsdCcsIHJlc3VsdCk7XHJcbiAgICAgICAgcmVzdWx0LmZvckVhY2goZnVuY3Rpb24ob2JqKSB7XHJcbiAgICAgICAgICBpZiAob2JqLnN0YXR1cyA9PT0gJ2xpdmUnKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdMaXZlIG9iaicsIG9iaik7XHJcbiAgICAgICAgICAgIGlmICghb2JqLmh5cGVydHlJRCkge1xyXG4gICAgICAgICAgICAgIG9iai5oeXBlcnR5SUQgPSBvYmoucmVwb3J0ZXI7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgX3RoaXMuX3N1YnNjcmliZUNvbnRleHQob2JqLnNjaGVtYSwgb2JqLnVybCkudGhlbihmdW5jdGlvbihyZXN1bHRTdWJzY3JpYmUpIHtcclxuICAgICAgICAgICAgICBjb25zb2xlLmxvZygnW0NvbnRleHRPYnNlcnZlci5fZGlzY292ZXJBbmRTdWJzY3JpYmVMZWdhY3lVc2Vyc10gX3N1YnNjcmliZUNvbnRleHQnLCByZXN1bHRTdWJzY3JpYmUpO1xyXG4gICAgICAgICAgICAgIHJldHVybiByZXNvbHZlKHJlc3VsdFN1YnNjcmliZSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgICB9KS5jYXRjaChmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICBjb25zb2xlLmxvZygnZXJyb3IgJywgZXJyKTtcclxuICAgICAgfSk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gKiBUaGlzIGZ1bmN0aW9uIGlzIHVzZWQgdG8gc3RvcCB0aGUgdXNlciBDb250ZXh0IG9ic2VydmF0aW9uIGZvciBhIGNlcnRhaW4gdXNlclxyXG4gKiBAcGFyYW0gIHtzdHJpbmd9IENvbnRleHQgICAgICAgdGhlIFVzZXJBdmFpbGFiaWxpdHkgRGF0YSBPYmplY3QgT2JzZXJ2ZXIgVVJMIHRvIGJlIHVub2JzZXJ2ZWQuXHJcbiAqL1xyXG5cclxuICB1bm9ic2VydmUoQ29udGV4dCkge1xyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuXHJcbiAgICBfdGhpcy5fdXNlcnMyb2JzZXJ2ZS5mb3JFYWNoKCh1c2VyLCBpbmRleCkgPT4ge1xyXG4gICAgICBpZiAodXNlci51cmwgPT09IENvbnRleHQpIHtcclxuICAgICAgICB1c2VyLnVuc3Vic2NyaWJlKCk7XHJcbiAgICAgICAgX3RoaXMuX3VzZXJzMm9ic2VydmUuc3BsaWNlKGluZGV4LCAxKTtcclxuICAgICAgfVxyXG5cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbn1cclxuXHJcbmV4cG9ydCBkZWZhdWx0IENvbnRleHRPYnNlcnZlcjtcclxuIiwiLyoqXHJcbiogQ29weXJpZ2h0IDIwMTYgUFQgSW5vdmHDp8OjbyBlIFNpc3RlbWFzIFNBXHJcbiogQ29weXJpZ2h0IDIwMTYgSU5FU0MtSURcclxuKiBDb3B5cmlnaHQgMjAxNiBRVU9CSVMgTkVUV09SS1MgU0xcclxuKiBDb3B5cmlnaHQgMjAxNiBGUkFVTkhPRkVSLUdFU0VMTFNDSEFGVCBaVVIgRk9FUkRFUlVORyBERVIgQU5HRVdBTkRURU4gRk9SU0NIVU5HIEUuVlxyXG4qIENvcHlyaWdodCAyMDE2IE9SQU5HRSBTQVxyXG4qIENvcHlyaWdodCAyMDE2IERldXRzY2hlIFRlbGVrb20gQUdcclxuKiBDb3B5cmlnaHQgMjAxNiBBcGl6ZWVcclxuKiBDb3B5cmlnaHQgMjAxNiBURUNITklTQ0hFIFVOSVZFUlNJVEFUIEJFUkxJTlxyXG4qXHJcbiogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbipcclxuKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4qXHJcbiogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4qIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbioqL1xyXG5cclxuLy8gU2VydmljZSBGcmFtZXdvcmtcclxuLy9pbXBvcnQgU3luY2hlciBmcm9tICcuLi9zeW5jaGVyL1N5bmNoZXInO1xyXG5cclxuLy8gVXRpbHNcclxuaW1wb3J0IEV2ZW50RW1pdHRlciBmcm9tICcuLi91dGlscy9FdmVudEVtaXR0ZXIuanMnO1xyXG4vL2ltcG9ydCB7ZGl2aWRlVVJMfSBmcm9tICcuLi91dGlscy91dGlscy5qcyc7XHJcblxyXG4vLyBpbXBvcnQgYXZhaWxhYmlsaXR5IGZyb20gJy4vYXZhaWxhYmlsaXR5LmpzJztcclxuXHJcbi8qKlxyXG4qIENvbnRleHQgUmVwb3J0ZXI7XHJcbiogQGF1dGhvciBQYXVsbyBDaGFpbmhvIFtwYXVsby1nLWNoYWluaG9AYWx0aWNlbGFicy5jb21dXHJcbiovXHJcbmNsYXNzIENvbnRleHRSZXBvcnRlciBleHRlbmRzIEV2ZW50RW1pdHRlciB7XHJcblxyXG4gIGNvbnN0cnVjdG9yKGh5cGVydHlVUkwsIGJ1cywgY29uZmlndXJhdGlvbiwgZmFjdG9yeSwgc3luY2hlcikge1xyXG4gICAgaWYgKCFoeXBlcnR5VVJMKSB0aHJvdyBuZXcgRXJyb3IoJ1RoZSBoeXBlcnR5VVJMIGlzIGEgbmVlZGVkIHBhcmFtZXRlcicpO1xyXG4gICAgaWYgKCFidXMpIHRocm93IG5ldyBFcnJvcignVGhlIE1pbmlCdXMgaXMgYSBuZWVkZWQgcGFyYW1ldGVyJyk7XHJcbiAgICBpZiAoIWNvbmZpZ3VyYXRpb24pIHRocm93IG5ldyBFcnJvcignVGhlIGNvbmZpZ3VyYXRpb24gaXMgYSBuZWVkZWQgcGFyYW1ldGVyJyk7XHJcblxyXG4gICAgc3VwZXIoaHlwZXJ0eVVSTCwgYnVzLCBjb25maWd1cmF0aW9uKTtcclxuXHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG5cclxuICAgIGNvbnNvbGUuaW5mbygnW0NvbnRleHRSZXBvcnRlcl0gc3RhcnRlZCB3aXRoIHVybDogJywgaHlwZXJ0eVVSTCk7XHJcblxyXG4gICAgdGhpcy5zeW5jaGVyID0gc3luY2hlciA/IHN5bmNoZXIgOiBmYWN0b3J5LmNyZWF0ZVN5bmNoZXIoaHlwZXJ0eVVSTCwgYnVzLCBjb25maWd1cmF0aW9uKTtcclxuXHJcblxyXG4gICAgLy8gICAgdGhpcy5kaXNjb3ZlcnkgPSBuZXcgRGlzY292ZXJ5KGh5cGVydHlVUkwsIGJ1cyk7XHJcbiAgICB0aGlzLmRvbWFpbiA9IGZhY3RvcnkuZGl2aWRlVVJMKGNvbmZpZ3VyYXRpb24ucnVudGltZVVSTCkuZG9tYWluO1xyXG4gICAgdGhpcy5jb250ZXh0cyA9IHt9O1xyXG5cclxuICAgIHRoaXMuY29udGV4dERlc2NVUkwgPSAnaHlwZXJ0eS1jYXRhbG9ndWU6Ly9jYXRhbG9ndWUuJyArIHRoaXMuZG9tYWluICsgJy8ud2VsbC1rbm93bi9kYXRhc2NoZW1hL0NvbnRleHQnO1xyXG5cclxuXHJcbiAgICAvLyAgICB0aGlzLmhlYXJ0YmVhdCA9IFtdO1xyXG5cclxuICAgIHRoaXMuc3luY2hlci5vbk5vdGlmaWNhdGlvbigoZXZlbnQpID0+IHtcclxuICAgICAgbGV0IF90aGlzID0gdGhpcztcclxuICAgICAgX3RoaXMub25Ob3RpZmljYXRpb24oZXZlbnQpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgLy9UT0RPOiB1bmNvbW1lbnQgd2hlbiB1c2VkIHdpdGggc2VydmljZSBmcmFtZXdvcmsgZGV2ZWxvcCBicmFuY2hcclxuXHJcbiAgICB0aGlzLnN5bmNoZXIub25DbG9zZSgoZXZlbnQpID0+IHtcclxuXHJcbiAgICAgIGNvbnNvbGUubG9nKCdbQ29udGV4dFJlcG9ydGVyLm9uQ2xvc2VdJyk7XHJcbiAgICAgIGxldCBfdGhpcyA9IHRoaXM7XHJcbiAgICAgIF90aGlzLnNldFN0YXR1cyhldmVudC5pZCwgJ3VuYXZhaWxhYmxlJyk7XHJcbiAgICAgIGV2ZW50LmFjaygpO1xyXG4gICAgfSk7XHJcblxyXG4gIH1cclxuXHJcbiAgLy9UT0RPOiBtb3ZlIHRvIFVzZXIgYXZhaWxhYmlsaXR5IFJlcG9ydGVyIG9yIHRvIGFic3RyYWN0IEh5cGVydHlDb250ZXh0UmVwb3J0ZXJcclxuXHJcbiAgc3RhcnQoKSB7XHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG5cclxuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XHJcblxyXG4gICAgICB0aGlzLnN5bmNoZXIucmVzdW1lUmVwb3J0ZXJzKHtzdG9yZTogdHJ1ZX0pLnRoZW4oKHJlcG9ydGVycykgPT4ge1xyXG5cclxuICAgICAgICBsZXQgcmVwb3J0ZXJzTGlzdCA9IE9iamVjdC5rZXlzKHJlcG9ydGVycyk7XHJcblxyXG4gICAgICAgIGlmIChyZXBvcnRlcnNMaXN0Lmxlbmd0aCAgPiAwKSB7XHJcblxyXG4gICAgICAgICAgY29uc29sZS5sb2coJ1tDb250ZXh0UmVwb3J0ZXIuc3RhcnRdIHJlc3VtaW5nICcsIHJlcG9ydGVyc1tyZXBvcnRlcnNMaXN0WzBdXSk7XHJcblxyXG4gICAgICAgICAgLy8gc2V0IGF2YWlsYWJpbGl0eSB0byBhdmFpbGFibGVcclxuXHJcbiAgICAgICAgICBfdGhpcy5jb250ZXh0cyA9IHJlcG9ydGVycztcclxuXHJcbiAgICAgICAgICAvL1RPRE86XHJcbiAgICAgICAgICByZXBvcnRlcnNMaXN0LmZvckVhY2goKGNvbnRleHQpID0+IHtcclxuICAgICAgICAgICAgX3RoaXMuX29uU3Vic2NyaXB0aW9uKF90aGlzLmNvbnRleHRzW2NvbnRleHRdKTtcclxuICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgIHJlc29sdmUoX3RoaXMuY29udGV4dHMpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICBjb25zb2xlLmxvZygnW0NvbnRleHRSZXBvcnRlci5zdGFydF0gbm90aGluZyB0byByZXN1bWUgJywgcmVwb3J0ZXJzKTtcclxuICAgICAgICAgIHJlc29sdmUoZmFsc2UpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgIH0pLmNhdGNoKChyZWFzb24pID0+IHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKCdbQ29udGV4dFJlcG9ydGVyXSBSZXN1bWUgZmFpbGVkIHwgJywgcmVhc29uKTtcclxuICAgICAgfSk7XHJcbiAgICB9KS5jYXRjaCgocmVhc29uKSA9PiB7XHJcbiAgICAgIHJlamVjdCgnW0NvbnRleHRSZXBvcnRlcl0gU3RhcnQgZmFpbGVkIHwgJywgcmVhc29uKTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcblxyXG4gIHByb2Nlc3NOb3RpZmljYXRpb24oZXZlbnQpIHtcclxuICAgIGxldCBfdGhpcyA9IHRoaXM7XHJcbiAgICBjb25zb2xlLmxvZygnW0NvbnRleHRSZXBvcnRlci5wcm9jZXNzTm90aWZpY2F0aW9uOiAnLCBldmVudCk7XHJcblxyXG4gICAgZXZlbnQuYWNrKCk7XHJcblxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogVGhpcyBmdW5jdGlvbiBpcyB1c2VkIHRvIGNyZWF0ZSBhIG5ldyBzdGF0dXMgb2JqZWN0IHN5bmNoZXJcclxuICAgKiBAcGFyYW0gIHtVUkwuVXNlclVSTH0gY29udGFjdHMgTGlzdCBvZiBVc2Vyc1xyXG4gICAqIEByZXR1cm4ge1Byb21pc2V9XHJcbiAgICovXHJcbiAgY3JlYXRlKGlkLCBpbml0LCByZXNvdXJjZXMsIG5hbWUgPSAnbXlDb250ZXh0JywgcmVwb3J0ZXIgPSBudWxsLCByZXVzZVVSTCA9IG51bGwpIHtcclxuICAgIC8vZGVidWdnZXI7XHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG4gICAgbGV0IGlucHV0O1xyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcclxuICAgICAgaWYgKCFyZXBvcnRlciAmJiAhcmV1c2VVUkwpIHtcclxuICAgICAgICBpbnB1dCA9IHtyZXNvdXJjZXM6IHJlc291cmNlcywgZXhwaXJlczogMzB9O1xyXG4gICAgICB9IGVsc2UgaWYgKHJlcG9ydGVyICYmICFyZXVzZVVSTCkge1xyXG4gICAgICAgIGlucHV0ID0ge3Jlc291cmNlczogcmVzb3VyY2VzLCBleHBpcmVzOiAzMCwgcmVwb3J0ZXI6IHJlcG9ydGVyfTtcclxuICAgICAgfSBlbHNlIGlmICghcmVwb3J0ZXIgJiYgcmV1c2VVUkwpIHtcclxuICAgICAgICBpbnB1dCA9IHtyZXNvdXJjZXM6IHJlc291cmNlcywgZXhwaXJlczogMzAsIHJldXNlVVJMOiByZXVzZVVSTH07XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgaW5wdXQgPSB7cmVzb3VyY2VzOiByZXNvdXJjZXMsIGV4cGlyZXM6IDMwLCByZXVzZVVSTDogcmV1c2VVUkwsIHJlcG9ydGVyOiByZXBvcnRlcn07XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGNvbnNvbGUuaW5mbygnW0NvbnRleHRSZXBvcnRlci5jcmVhdGVdIGxldHMgY3JlYXRlIGEgbmV3IFVzZXIgYXZhaWxhYmlsaXR5IENvbnRleHQgT2JqZWN0ICcsIGlucHV0KTtcclxuICAgICAgX3RoaXMuc3luY2hlci5jcmVhdGUoX3RoaXMuY29udGV4dERlc2NVUkwsIFtdLCBpbml0LCB0cnVlLCBmYWxzZSwgbmFtZSwgbnVsbCwgaW5wdXQpXHJcbiAgICAgICAgLnRoZW4oKGNvbnRleHQpID0+IHtcclxuICAgICAgICAgIF90aGlzLmNvbnRleHRzW2lkXSA9IGNvbnRleHQ7XHJcblxyXG4gICAgICAgICAgX3RoaXMuX29uU3Vic2NyaXB0aW9uKGNvbnRleHQpO1xyXG4gICAgICAgICAgcmVzb2x2ZShjb250ZXh0KTtcclxuXHJcbiAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24ocmVhc29uKSB7XHJcbiAgICAgICAgICByZWplY3QocmVhc29uKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICB9KTtcclxuXHJcbiAgfVxyXG5cclxuICBfb25TdWJzY3JpcHRpb24oY29udGV4dCkge1xyXG4gICAgY29udGV4dC5vblN1YnNjcmlwdGlvbigoZXZlbnQpID0+IHtcclxuICAgICAgY29uc29sZS5pbmZvKCdbQ29udGV4dFJlcG9ydGVyLl9vblN1YnNjcmlwdGlvbl0gYWNjZXB0aW5nOiAnLCBldmVudCk7XHJcbiAgICAgIGV2ZW50LmFjY2VwdCgpO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBzZXRDb250ZXh0KGlkLCBuZXdDb250ZXh0KSB7XHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG4gICAgY29uc29sZS5sb2coJ1RISVMgW0NvbnRleHRSZXBvcnRlci5zZXRDb250ZXh0XSBiZWZvcmUgY2hhbmdlIDonLCBfdGhpcy5jb250ZXh0c1tpZF0pO1xyXG4gICAgY29uc29sZS5sb2coJ1tDb250ZXh0UmVwb3J0ZXIuc2V0Q29udGV4dF0gYmVmb3JlIGNoYW5nZSA6JywgX3RoaXMuY29udGV4dHNbaWRdLmRhdGEpO1xyXG5cclxuICAgIC8vICAgIF90aGlzLmNvbnRleHRzW2lkXS5kYXRhLnZhbHVlc1swXS52YWx1ZSA9IG5ld0NvbnRleHQ7XHJcblxyXG4gICAgX3RoaXMuY29udGV4dHNbaWRdLmRhdGEudmFsdWVzID0gbmV3Q29udGV4dDtcclxuICAgIGNvbnNvbGUuZGVidWcoJ1tDb250ZXh0UmVwb3J0ZXIuc2V0Q29udGV4dF0gYWZ0ZXIgY2hhbmdlIDonLCBfdGhpcy5jb250ZXh0c1tpZF0uZGF0YSk7XHJcbiAgICBfdGhpcy50cmlnZ2VyKGlkICsgJy1jb250ZXh0LXVwZGF0ZScsIG5ld0NvbnRleHQpO1xyXG5cclxuICB9XHJcblxyXG5cclxufVxyXG5cclxuZXhwb3J0IGRlZmF1bHQgQ29udGV4dFJlcG9ydGVyO1xyXG4iLCIvKipcclxuKiBUaGUgVXNlclByb2ZpbGUgYWNjb3JkaW5nIHRvIFVzZXIgSWRlbnRpdHkgRGF0YSBNb2RlbFxyXG4qL1xyXG5cclxuXHJcbmNsYXNzIFVzZXJQcm9maWxlIHtcclxuXHJcbiAgY29uc3RydWN0b3IodXNlcm5hbWUsIHVzZXJVUkwsIHBpY3R1cmUsIG5hbWUsIGxvY2FsZSwgcHJvZmlsZSkge1xyXG5cclxuICAgIGlmICh1c2VybmFtZSkgeyB0aGlzLnByZWZlcnJlZF91c2VybmFtZSA9IHVzZXJuYW1lOyB9XHJcbiAgICBpZiAocGljdHVyZSkgeyB0aGlzLnBpY3R1cmUgPSBwaWN0dXJlOyB9XHJcbiAgICBpZiAobmFtZSkgeyB0aGlzLm5hbWUgPSBuYW1lOyB9XHJcbiAgICBpZiAobG9jYWxlKSB7IHRoaXMubG9jYWxlID0gbG9jYWxlOyB9XHJcbiAgICBpZiAodXNlclVSTCkgeyB0aGlzLnVzZXJVUkwgPSB1c2VyVVJMOyB9XHJcbiAgICBpZiAocHJvZmlsZSkgT2JqZWN0LmFzc2lnbih0aGlzLCBwcm9maWxlKTtcclxuXHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgZGVmYXVsdCBVc2VyUHJvZmlsZTtcclxuIiwiLyoqXHJcbiogVGhlIElkZW50aXR5IGluZm8gdG8gYmUgYWRkZWQgdG8gTWVzc2FnZS5Cb2R5LklkZW50aXR5XHJcbiovXHJcblxyXG5pbXBvcnQgVXNlclByb2ZpbGUgZnJvbSAnLi9Vc2VyUHJvZmlsZSc7XHJcblxyXG5jbGFzcyBNZXNzYWdlQm9keUlkZW50aXR5IHtcclxuXHJcbiAgY29uc3RydWN0b3IodXNlcm5hbWUsIHVzZXJVUkwsIHBpY3R1cmUsIG5hbWUsIGxvY2FsZSwgaWRwLCBhc3NlcnRpb24sIHByb2ZpbGUpIHtcclxuXHJcbiAgICBpZiAoIWlkcCkgdGhyb3cgbmV3IEVycm9yKCdJRFAgc2hvdWxkIGJlIGEgcGFyYW1ldGVyJyk7XHJcbiAgICBpZiAoIXVzZXJuYW1lKSB0aHJvdyBuZXcgRXJyb3IoJ3VzZXJuYW1lIHNob3VsZCBiZSBhIHBhcmFtZXRlcicpO1xyXG5cclxuICAgIHRoaXMuaWRwID0gaWRwO1xyXG5cclxuICAgIGlmIChhc3NlcnRpb24pICAgICAgeyB0aGlzLmFzc2VydGlvbiA9IGFzc2VydGlvbjsgfVxyXG4gICAgdGhpcy51c2VyUHJvZmlsZSA9IG5ldyBVc2VyUHJvZmlsZSh1c2VybmFtZSwgdXNlclVSTCwgcGljdHVyZSwgbmFtZSwgbG9jYWxlLCBwcm9maWxlKTtcclxuXHJcbiAgfVxyXG5cclxufVxyXG5cclxuXHJcbmV4cG9ydCBkZWZhdWx0IE1lc3NhZ2VCb2R5SWRlbnRpdHk7XHJcbiIsIi8qKlxyXG4qIENvcHlyaWdodCAyMDE2IFBUIElub3Zhw6fDo28gZSBTaXN0ZW1hcyBTQVxyXG4qIENvcHlyaWdodCAyMDE2IElORVNDLUlEXHJcbiogQ29weXJpZ2h0IDIwMTYgUVVPQklTIE5FVFdPUktTIFNMXHJcbiogQ29weXJpZ2h0IDIwMTYgRlJBVU5IT0ZFUi1HRVNFTExTQ0hBRlQgWlVSIEZPRVJERVJVTkcgREVSIEFOR0VXQU5EVEVOIEZPUlNDSFVORyBFLlZcclxuKiBDb3B5cmlnaHQgMjAxNiBPUkFOR0UgU0FcclxuKiBDb3B5cmlnaHQgMjAxNiBEZXV0c2NoZSBUZWxla29tIEFHXHJcbiogQ29weXJpZ2h0IDIwMTYgQXBpemVlXHJcbiogQ29weXJpZ2h0IDIwMTYgVEVDSE5JU0NIRSBVTklWRVJTSVRBVCBCRVJMSU5cclxuKlxyXG4qIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4qIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4qXHJcbiogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuKlxyXG4qIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4qIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4qKi9cclxuXHJcbmV4cG9ydCBjb25zdCBDb21tdW5pY2F0aW9uU3RhdHVzID0ge1xyXG4gIE9QRU46ICdvcGVuJyxcclxuICBQRU5ESU5HOiAncGVuZGluZycsXHJcbiAgQ0xPU0VEOiAnY2xvc2VkJyxcclxuICBQQVVTRUQ6ICdwYXVzZWQnLFxyXG4gIEZBSUxFRDogJ2ZhaWxlZCdcclxufTtcclxuXHJcbmV4cG9ydCBsZXQgY29tbXVuaWNhdGlvbk9iamVjdCA9IHtcclxuICBzdGFydGluZ1RpbWU6ICcnLFxyXG4gIHN0YXR1czogJycsXHJcbiAgcGFydGljaXBhbnRzOiB7fVxyXG59O1xyXG5cclxuZXhwb3J0IGxldCBjb21tdW5pY2F0aW9uQ2hpbGRyZW4gPSB7XHJcbiAgXCJwYXJlbnRcIiA6IFwiY29tbXVuaWNhdGlvblwiLFxyXG4gIFwibGlzdGVuZXJcIiA6IFwicmVzb3VyY2VzXCIsXHJcbiAgXCJ0eXBlXCIgOiBcIkh5cGVydHlSZXNvdXJjZVwiXHJcbn07XHJcblxyXG4vKlxyXG5leHBvcnQgbGV0IGNvbW11bmljYXRpb25PYmplY3QgPSB7XHJcbiAgaWQ6ICcnLFxyXG4gIG5hbWU6ICcnLFxyXG4gIG93bmVyOiAnJyxcclxuICBzY2hlbWU6ICdjb21tJyxcclxuICBzdGFydGluZ1RpbWU6ICcnLFxyXG4gIGxhc3RNb2RpZmllZDogJycsXHJcbiAgZHVyYXRpb246ICcnLFxyXG4gIHN0YXR1czogJycsXHJcbiAgcGFydGljaXBhbnRzOiBbXVxyXG59O1xyXG4qL1xyXG4iLCIvKipcclxuKiBDb3B5cmlnaHQgMjAxNiBQVCBJbm92YcOnw6NvIGUgU2lzdGVtYXMgU0FcclxuKiBDb3B5cmlnaHQgMjAxNiBJTkVTQy1JRFxyXG4qIENvcHlyaWdodCAyMDE2IFFVT0JJUyBORVRXT1JLUyBTTFxyXG4qIENvcHlyaWdodCAyMDE2IEZSQVVOSE9GRVItR0VTRUxMU0NIQUZUIFpVUiBGT0VSREVSVU5HIERFUiBBTkdFV0FORFRFTiBGT1JTQ0hVTkcgRS5WXHJcbiogQ29weXJpZ2h0IDIwMTYgT1JBTkdFIFNBXHJcbiogQ29weXJpZ2h0IDIwMTYgRGV1dHNjaGUgVGVsZWtvbSBBR1xyXG4qIENvcHlyaWdodCAyMDE2IEFwaXplZVxyXG4qIENvcHlyaWdodCAyMDE2IFRFQ0hOSVNDSEUgVU5JVkVSU0lUQVQgQkVSTElOXHJcbipcclxuKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4qIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuKlxyXG4qICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbipcclxuKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4qIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4qIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuKiovXHJcblxyXG4vKipcclxuKiBUbyBtYW5hZ2UgR3JvdXAgQ2hhdCBJbnZpdGF0aW9uc1xyXG4qIEBhdXRob3IgUGF1bG8gQ2hhaW5obyBbcGF1bG8tZy1jaGFpbmhvQGFsdGljZWxhYnMuY29tXVxyXG4qIEB2ZXJzaW9uIDAuMS4wXHJcbiovXHJcblxyXG4vLyBUT0RPOiBoYXZlIGFuIGluc3RhbmNlIHBlciBDaGF0Q29udHJvbGxlclxyXG5cclxuY2xhc3MgSW52aXRhdGlvbnNIYW5kbGVyIHtcclxuXHJcbiAgY29uc3RydWN0b3IoaHlwZXJ0eVVSTCkge1xyXG5cclxuICAgIGlmICghaHlwZXJ0eVVSTCkgdGhyb3cgRXJyb3IoJ2h5cGVydHlVUkwgaXMgYSBuZWNlc3NhcnkgZGVwZW5kZWN5Jyk7XHJcblxyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuICAgIF90aGlzLl9oeXBlcnR5VVJMID0gaHlwZXJ0eVVSTDtcclxuXHJcbiAgICBfdGhpcy5fcGVuZGluZyA9IHt9OyAvLyBBbGwgcGVuZGluZyBpbnZpdGF0aW9uc1xyXG4gIH1cclxuXHJcbiAgc2V0IGludml0YXRpb25SZXNwb25zZShjYWxsYmFjaykge1xyXG4gICAgdGhpcy5faW52aXRhdGlvbnNSZXNwb25zZSA9IGNhbGxiYWNrO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogVGhpcyBmdW5jdGlvbiBpcyB1c2VkIHRvIGhhbmRsZSBub3RpZmljYXRpb25zIGZvciBkaXNjb25uZWN0ZWQgSHkrZXJ0aWVzLlxyXG4gICAqIEBwYXJhbSAge0Rpc2NvdmVyZWRPYmplY3RbXX0gICAgZGlzY29ubmVjdGVkICBhcnJheSBvZiBkaXNjb3ZlcmVkIGh5cGVydGllcyB0aGF0IGFyZSBkaXNjb25uZWN0ZWRcclxuICAgKiBAcGFyYW0gIHtEYXRhT2JqZWN0UmVwb3J0ZXJ9ICAgIERhdGFPYmplY3RSZXBvcnRlciAgIERhdGEgT2JqZWN0IFJlcG9ydGVyIGFkZHJlc3NlZCBieSBpbnZpdGF0aW9uc1xyXG4gICAqL1xyXG5cclxuICBpbnZpdGVEaXNjb25uZWN0ZWRIeXBlcnRpZXMoZGlzY29ubmVjdGVkLCBkYXRhT2JqZWN0UmVwb3J0ZXIpIHtcclxuXHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG4gICAgY29uc29sZS5sb2coJ1tHcm91cENoYXRNYW5hZ2VyLkludml0YXRpb25zSGFuZGxlci5pbnZpdGVEaXNjb25uZWN0ZWRIeXBlcnRpZXNdIGxldHMgaW52aXRlICcsIGRpc2Nvbm5lY3RlZCk7XHJcblxyXG4gICAgZGlzY29ubmVjdGVkLmZvckVhY2goKGRpc2Nvbm5lY3RlZEh5cGVydHkpPT57XHJcblxyXG4gICAgICBpZiAoIV90aGlzLl9wZW5kaW5nW2RhdGFPYmplY3RSZXBvcnRlcl0pIHtcclxuICAgICAgICBfdGhpcy5fcGVuZGluZ1tkYXRhT2JqZWN0UmVwb3J0ZXJdID0ge307XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIF90aGlzLl9wZW5kaW5nW2RhdGFPYmplY3RSZXBvcnRlcl1bZGlzY29ubmVjdGVkSHlwZXJ0eS5kYXRhLmh5cGVydHlJRF0gPSBkaXNjb25uZWN0ZWRIeXBlcnR5O1xyXG5cclxuICAgICAgZGlzY29ubmVjdGVkSHlwZXJ0eS5vbkxpdmUoX3RoaXMuX2h5cGVydHlVUkwsKCk9PntcclxuICAgICAgICBjb25zb2xlLmxvZygnW0dyb3VwQ2hhdE1hbmFnZXIuY3JlYXRlXSBkaXNjb25uZWN0ZWQgSHlwZXJ0eSBpcyBiYWNrIHRvIGxpdmUnLCBkaXNjb25uZWN0ZWRIeXBlcnR5KTtcclxuXHJcbiAgICAgICAgZGF0YU9iamVjdFJlcG9ydGVyLmludml0ZU9ic2VydmVycyhbZGlzY29ubmVjdGVkSHlwZXJ0eS5kYXRhLmh5cGVydHlJRF0pO1xyXG5cclxuICAgICAgICBkaXNjb25uZWN0ZWRIeXBlcnR5LnVuc3Vic2NyaWJlTGl2ZShfdGhpcy5faHlwZXJ0eVVSTCk7XHJcblxyXG4gICAgICAgIGRlbGV0ZSBfdGhpcy5fcGVuZGluZ1tkYXRhT2JqZWN0UmVwb3J0ZXJdW2Rpc2Nvbm5lY3RlZEh5cGVydHkuZGF0YS5oeXBlcnR5SURdO1xyXG5cclxuICAgICAgfSk7XHJcblxyXG4gICAgfSk7XHJcblxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogVGhpcyBmdW5jdGlvbiBpcyB1c2VkIHRvIHByb2Nlc3Mgc2VudCBpbnZpdGF0aW9ucy4gSW4gY2FzZSBpbnZpdGF0aW9ucyBhcmUgbm90IGFja25vd2xlZGdlIGJ5IHJlY2lwaWVudCBpdCB3aWxsIGJlIGhhbmRsZWQgYXMgYSBkaXNjb25uZWN0ZWQgaHlwZXJ0eVxyXG4gICAqIEBwYXJhbSAge0Rpc2NvdmVyZWRPYmplY3RbXX0gICAgbGl2ZSAgYXJyYXkgb2YgZGlzY292ZXJlZCBoeXBlcnRpZXMgdGhhdCBhcmUgb3Igd2VyZSBsaXZlXHJcbiAgICogQHBhcmFtICB7RGF0YU9iamVjdFJlcG9ydGVyfSAgICBEYXRhT2JqZWN0UmVwb3J0ZXIgICBEYXRhIE9iamVjdCBSZXBvcnRlciBhZGRyZXNzZWQgYnkgaW52aXRhdGlvbnNcclxuICAgKi9cclxuXHJcbiAgcHJvY2Vzc0ludml0YXRpb25zKGxpdmUsIGRhdGFPYmplY3RSZXBvcnRlcikge1xyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuXHJcbiAgICBsZXQgaW52aXRhdGlvbnMgPSBkYXRhT2JqZWN0UmVwb3J0ZXIuaW52aXRhdGlvbnMgfHwgW107XHJcblxyXG4gICAgY29uc29sZS5sb2coJ1tHcm91cENoYXRNYW5hZ2VyLkludml0YXRpb25zSGFuZGxlci5wcm9jZXNzSW52aXRhdGlvbnNdIHdhaXRpbmcgZm9yIHJlcGxpZXMgJywgaW52aXRhdGlvbnMsIHRoaXMuX2ludml0YXRpb25zUmVzcG9uc2UpO1xyXG5cclxuICAgIGludml0YXRpb25zLmZvckVhY2goKGludml0YXRpb24pID0+IHtcclxuICAgICAgaW52aXRhdGlvbi50aGVuKChyZXN1bHQpID0+IHtcclxuICAgICAgICBjb25zb2xlLmxvZygnW0dyb3VwQ2hhdE1hbmFnZXIuSW52aXRhdGlvbnNIYW5kbGVyLnByb2Nlc3NJbnZpdGF0aW9uc10gLSBPSzogJywgcmVzdWx0LCB0aGlzLl9pbnZpdGF0aW9uc1Jlc3BvbnNlKTtcclxuICAgICAgICBpZiAodGhpcy5faW52aXRhdGlvbnNSZXNwb25zZSkgeyB0aGlzLl9pbnZpdGF0aW9uc1Jlc3BvbnNlKHJlc3VsdCk7IH1cclxuICAgICAgfSkuY2F0Y2goKHJlc3VsdCkgPT4ge1xyXG4gICAgICAgIGNvbnNvbGUubG9nKCdbR3JvdXBDaGF0TWFuYWdlci5JbnZpdGF0aW9uc0hhbmRsZXIucHJvY2Vzc0ludml0YXRpb25zXSAtIE5PVCBPSzogJywgcmVzdWx0LCB0aGlzLl9pbnZpdGF0aW9uc1Jlc3BvbnNlKTtcclxuICAgICAgICBpZiAodGhpcy5faW52aXRhdGlvbnNSZXNwb25zZSkgeyB0aGlzLl9pbnZpdGF0aW9uc1Jlc3BvbnNlKHJlc3VsdCk7IH1cclxuICAgICAgICBfdGhpcy5pbnZpdGVEaXNjb25uZWN0ZWRIeXBlcnRpZXMoW2xpdmVbcmVzdWx0Lmludml0ZWRdXSwgZGF0YU9iamVjdFJlcG9ydGVyKTtcclxuICAgICAgfSk7XHJcbiAgICB9KTtcclxuXHJcbiAgfVxyXG5cclxuICByZXN1bWVEaXNjb3ZlcmllcyhkaXNjb3ZlcnlFbmdpbmUsIGdyb3VwQ2hhdCkge1xyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuXHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xyXG5cclxuICAgICAgbGV0IGxpdmUgPSB7fTtcclxuICAgICAgbGV0IGxpdmVIeXBlcnRpZXMgPSBbXTtcclxuICAgICAgbGV0IGRpc2Nvbm5lY3RlZCA9IFtdO1xyXG4gICAgICBsZXQgdW5zdWJzY3JpcHRvblByb21pc2VzID0gW107XHJcblxyXG4gICAgICBkaXNjb3ZlcnlFbmdpbmUucmVzdW1lRGlzY292ZXJpZXMoKS50aGVuKChkaXNjb3ZlcmllcykgPT4ge1xyXG5cclxuICAgICAgICBjb25zb2xlLmxvZygnW0dyb3VwQ2hhdE1hbmFnZXIuSW52aXRhdGlvbnNIYW5kbGVyLnJlc3VtZURpc2NvdmVyaWVzXSBmb3VuZDogJywgZGlzY292ZXJpZXMpO1xyXG5cclxuICAgICAgICBkaXNjb3Zlcmllcy5mb3JFYWNoKChkaXNjb3ZlcnkpID0+e1xyXG5cclxuICAgICAgICAgIGlmIChkaXNjb3ZlcnkuZGF0YS5yZXNvdXJjZXMgJiYgZGlzY292ZXJ5LmRhdGEucmVzb3VyY2VzWzBdID09PSAnY2hhdCcpIHtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coJ1tHcm91cENoYXRNYW5hZ2VyLkludml0YXRpb25zSGFuZGxlci5yZXN1bWVEaXNjb3Zlcmllc10gcmVzdW1pbmc6ICcsIGRpc2NvdmVyeSk7XHJcblxyXG4gICAgICAgICAgICBpZiAoZGlzY292ZXJ5LmRhdGEuc3RhdHVzID09PSAnbGl2ZScgKSB7Ly8gcHJldmlvdXNseSBkaXNjb3ZlcmVkIG9iamVjdCBpcyBub3cgbGl2ZVxyXG4gICAgICAgICAgICAgIGxpdmVbZGlzY292ZXJ5LmRhdGEuaHlwZXJ0eUlEXSA9IGRpc2NvdmVyeTtcclxuICAgICAgICAgICAgICBsaXZlSHlwZXJ0aWVzLnB1c2goZGlzY292ZXJ5LmRhdGEuaHlwZXJ0eUlEKTtcclxuICAgICAgICAgICAgICB1bnN1YnNjcmlwdG9uUHJvbWlzZXMucHVzaCggZGlzY292ZXJ5LnVuc3Vic2NyaWJlTGl2ZShfdGhpcy5faHlwZXJ0eVVSTCkgKTtcclxuICAgICAgICAgICAgfSBlbHNlIHsvLyBwcmV2aW91c2x5IGRpc2NvdmVyZWQgb2JqZWN0IGlzIHN0aWxsIGRpc2Nvbm5lY3RlZFxyXG4gICAgICAgICAgICAgIGRpc2Nvbm5lY3RlZC5wdXNoKGRpc2NvdmVyeSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgICBpZiAoZGlzY29ubmVjdGVkLmxlbmd0aCA+IDApIF90aGlzLmludml0ZURpc2Nvbm5lY3RlZEh5cGVydGllcyhkaXNjb25uZWN0ZWQsIGdyb3VwQ2hhdCk7XHJcblxyXG4gICAgICAgIGlmICggT2JqZWN0LmtleXMobGl2ZSkubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgZ3JvdXBDaGF0Lmludml0ZU9ic2VydmVycyhsaXZlSHlwZXJ0aWVzKTtcclxuXHJcbiAgICAgICAgICBpZiAoZ3JvdXBDaGF0Lmludml0YXRpb25zLmxlbmd0aCA+IDApIF90aGlzLnByb2Nlc3NJbnZpdGF0aW9ucyhsaXZlLCBncm91cENoYXQpO1xyXG5cclxuICAgICAgICAgIFByb21pc2UuYWxsKHVuc3Vic2NyaXB0b25Qcm9taXNlcykudGhlbigoKT0+eyByZXNvbHZlKCl9KTtcclxuXHJcbiAgICAgICAgfSBlbHNlIHJlc29sdmUoKTtcclxuXHJcbiAgICAgIH0pO1xyXG4gICAgfSkuY2F0Y2goKHJlYXNvbikgPT4ge1xyXG4gICAgcmVqZWN0KCdbR3JvdXBDaGF0TWFuYWdlci5JbnZpdGF0aW9uc0hhbmRsZXIucmVzdW1lRGlzY292ZXJpZXNdIGZhaWxlZCB8ICcsIHJlYXNvbik7XHJcbiAgfSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBUaGlzIGZ1bmN0aW9uIGlzIHVzZWQgdG8gcmVtb3ZlIGFuZCBjbGVhbiBhbGwgcGVuZGluZyBpbnZpdGF0aW9ucy5cclxuICAgKiBAcGFyYW0gIHtEYXRhT2JqZWN0UmVwb3J0ZXJ9ICAgIERhdGFPYmplY3RSZXBvcnRlciAgIERhdGEgT2JqZWN0IFJlcG9ydGVyIGFkZHJlc3NlZCBieSBpbnZpdGF0aW9uc1xyXG4gICAqIEByZXR1cm4ge1Byb21pc2V9IHJldHVybiBhIHByb21pc2Ugd2hlbiBhbGwgdW5zdWJzY3JpcHRvbnMgZm9yIHBlbmRpbmcgaW52aXRhdGlvbnMgYXJlIGZpbmlzaGVkXHJcbiAgICovXHJcblxyXG4gIGNsZWFuSW52aXRhdGlvbnMoZGF0YU9iamVjdFJlcG9ydGVyKSB7XHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG5cclxuICAgIGxldCBjaGF0SW52aXRhdGlvbnMgPSBfdGhpcy5fcGVuZGluZ1tkYXRhT2JqZWN0UmVwb3J0ZXJdO1xyXG5cclxuICAgIGNvbnNvbGUubG9nKCdbR3JvdXBDaGF0TWFuYWdlci5JbnZpdGF0aW9uc0hhbmRsZXIuY2xlYW5JbnZpdGF0aW9uc10gJywgY2hhdEludml0YXRpb25zKTtcclxuXHJcbiAgICBpZiAoY2hhdEludml0YXRpb25zKSB7XHJcblxyXG4gICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xyXG4gICAgICAgIGxldCBwZW5kaW5nSW52aXRhdGlvbnMgPSBPYmplY3Qua2V5cyhjaGF0SW52aXRhdGlvbnMpO1xyXG5cclxuICAgICAgICBsZXQgdW5zdWJzY3JpcHRvblByb21pc2VzID0gW107XHJcblxyXG4gICAgICAgIHBlbmRpbmdJbnZpdGF0aW9ucy5mb3JFYWNoKChpbnZpdGF0aW9uKT0+e1xyXG4gICAgICAgICAgdW5zdWJzY3JpcHRvblByb21pc2VzLnB1c2goIGNoYXRJbnZpdGF0aW9uc1tpbnZpdGF0aW9uXS51bnN1YnNjcmliZUxpdmUoX3RoaXMuX2h5cGVydHlVUkwpICk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIFByb21pc2UuYWxsKHBlbmRpbmdJbnZpdGF0aW9ucykudGhlbigoKT0+eyByZXNvbHZlKCk7IH0pO1xyXG5cclxuICAgICAgfSk7XHJcblxyXG4gICAgfSBlbHNlIHJldHVybiBQcm9taXNlLnJlc29sdmUoKTtcclxuXHJcblxyXG4gIH1cclxuXHJcbn1cclxuXHJcbmV4cG9ydCBkZWZhdWx0IEludml0YXRpb25zSGFuZGxlcjtcclxuIiwiLyoqXHJcbiogQ29weXJpZ2h0IDIwMTYgUFQgSW5vdmHDp8OjbyBlIFNpc3RlbWFzIFNBXHJcbiogQ29weXJpZ2h0IDIwMTYgSU5FU0MtSURcclxuKiBDb3B5cmlnaHQgMjAxNiBRVU9CSVMgTkVUV09SS1MgU0xcclxuKiBDb3B5cmlnaHQgMjAxNiBGUkFVTkhPRkVSLUdFU0VMTFNDSEFGVCBaVVIgRk9FUkRFUlVORyBERVIgQU5HRVdBTkRURU4gRk9SU0NIVU5HIEUuVlxyXG4qIENvcHlyaWdodCAyMDE2IE9SQU5HRSBTQVxyXG4qIENvcHlyaWdodCAyMDE2IERldXRzY2hlIFRlbGVrb20gQUdcclxuKiBDb3B5cmlnaHQgMjAxNiBBcGl6ZWVcclxuKiBDb3B5cmlnaHQgMjAxNiBURUNITklTQ0hFIFVOSVZFUlNJVEFUIEJFUkxJTlxyXG4qXHJcbiogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbipcclxuKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4qXHJcbiogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4qIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbioqL1xyXG5cclxuLyoqXHJcbiogVGhlIEdyb3VwIENoYXQgQVBJIGlzIHVzZWQgdG8gY29udHJvbCBhIEdyb3VwIENoYXQgaW5zdGFuY2UuXHJcbiogQGF1dGhvciBWaXRvciBTaWx2YSBbdml0b3ItdC1zaWx2YUB0ZWxlY29tLnB0XVxyXG4qIEB2ZXJzaW9uIDAuMS4wXHJcbiovXHJcblxyXG4vL2ltcG9ydCB7IFVzZXJJbmZvIH0gZnJvbSAnLi9Vc2VySW5mbyc7XHJcbmltcG9ydCBSZWdpc3RyYXRpb25TdGF0dXMgZnJvbSAnLi4vZGlzY292ZXJ5L1JlZ2lzdHJhdGlvblN0YXR1cyc7XHJcbmltcG9ydCBJbnZpdGF0aW9uc0hhbmRsZXIgZnJvbSAnLi9JbnZpdGF0aW9uc0hhbmRsZXInO1xyXG5cclxuY2xhc3MgQ2hhdENvbnRyb2xsZXIge1xyXG5cclxuICBjb25zdHJ1Y3RvcihzeW5jaGVyLCBkaXNjb3ZlcnksIGRvbWFpbiwgc2VhcmNoLCBpZGVudGl0eSwgbWFuYWdlcikge1xyXG5cclxuICAgIGlmICghc3luY2hlcikgdGhyb3cgRXJyb3IoJ1N5bmNoZXIgaXMgYSBuZWNlc3NhcnkgZGVwZW5kZWN5Jyk7XHJcbiAgICBpZiAoIWRpc2NvdmVyeSkgdGhyb3cgRXJyb3IoJ0Rpc2NvdmVyIGlzIGEgbmVjZXNzYXJ5IGRlcGVuZGVjeScpO1xyXG4gICAgaWYgKCFkb21haW4pIHRocm93IEVycm9yKCdEb21haW4gaXMgYSBuZWNlc3NhcnkgZGVwZW5kZWN5Jyk7XHJcbiAgICBpZiAoIXNlYXJjaCkgdGhyb3cgRXJyb3IoJ1NlYXJjaCBpcyBhIG5lY2Vzc2FyeSBkZXBlbmRlY3knKTtcclxuXHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG4gICAgX3RoaXMuX3N5bmNoZXIgPSBzeW5jaGVyO1xyXG4gICAgX3RoaXMuZGlzY292ZXJ5ID0gZGlzY292ZXJ5O1xyXG4gICAgX3RoaXMuc2VhcmNoID0gc2VhcmNoO1xyXG4gICAgX3RoaXMubXlJZGVudGl0eSA9IGlkZW50aXR5O1xyXG4gICAgX3RoaXMuY29udHJvbGxlck1vZGUgPSAncmVwb3J0ZXInO1xyXG4gICAgX3RoaXMuY2hpbGRfY3NlcSA9IDA7XHJcbiAgICBfdGhpcy5kb21haW4gPSBkb21haW47XHJcblxyXG4gICAgX3RoaXMuX21hbmFnZXIgPSBtYW5hZ2VyO1xyXG5cclxuICAgIGNvbnN0IGh5cGVydHlVUkwgPSBzeW5jaGVyLm93bmVyO1xyXG5cclxuICAgIF90aGlzLl9vYmplY3REZXNjVVJMID0gJ2h5cGVydHktY2F0YWxvZ3VlOi8vY2F0YWxvZ3VlLicgKyBkb21haW4gKyAnLy53ZWxsLWtub3duL2RhdGFzY2hlbWEvQ29tbXVuaWNhdGlvbic7XHJcblxyXG4gICAgX3RoaXMuX2ludml0YXRpb25zSGFuZGxlciA9IG5ldyBJbnZpdGF0aW9uc0hhbmRsZXIoaHlwZXJ0eVVSTCk7XHJcblxyXG4gIH1cclxuXHJcbiAgZ2V0IGludml0YXRpb25zSGFuZGxlcigpIHtcclxuICAgIHJldHVybiB0aGlzLl9pbnZpdGF0aW9uc0hhbmRsZXI7XHJcbiAgfVxyXG5cclxuICBnZXQgdXJsKCkge1xyXG4gICAgcmV0dXJuIHRoaXMuY29udHJvbGxlck1vZGUgPT09ICdyZXBvcnRlcicgPyB0aGlzLmRhdGFPYmplY3RSZXBvcnRlci51cmwgOiB0aGlzLmRhdGFPYmplY3RPYnNlcnZlci51cmw7XHJcbiAgfVxyXG5cclxuICBzZXQgZGF0YU9iamVjdFJlcG9ydGVyKGRhdGFPYmplY3RSZXBvcnRlcikge1xyXG5cclxuICAgIGlmICghZGF0YU9iamVjdFJlcG9ydGVyKSB0aHJvdyBuZXcgRXJyb3IoJ1tDaGF0Q29udHJvbGxlcl0gVGhlIGRhdGEgb2JqZWN0IHJlcG9ydGVyIGlzIG5lY2Vzc2FyeSBwYXJhbWV0ZXIgJyk7XHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG5cclxuICAgIF90aGlzLmNvbnRyb2xsZXJNb2RlID0gJ3JlcG9ydGVyJztcclxuXHJcbiAgICAvLyBIYW5kbGVyIHRvIHByb2Nlc3MgcmVjZWl2ZWQgZmlsZXNcclxuXHJcbiAgICAvLyBkYXRhT2JqZWN0UmVwb3J0ZXIub25SZXNwb25zZShmdW5jdGlvbihldmVudCkge1xyXG4gICAgLy8gICBjb25zb2xlLmxvZygnW0RhdGFPYmplY3RSZXBvcnRlciAtIG9uUmVzcG9uc2VdJywgZXZlbnQpO1xyXG4gICAgLy8gICBpZiAoX3RoaXMuX29uSW52aXRhdGlvblJlc3BvbnNlKSB7XHJcbiAgICAvLyAgICAgX3RoaXMuX29uSW52aXRhdGlvblJlc3BvbnNlKGV2ZW50KTtcclxuICAgIC8vICAgfVxyXG4gICAgLy9cclxuICAgIC8vIH0pO1xyXG5cclxuICAgIGRhdGFPYmplY3RSZXBvcnRlci5vblN1YnNjcmlwdGlvbihmdW5jdGlvbihldmVudCkge1xyXG5cclxuICAgICAgc3dpdGNoIChldmVudC50eXBlKSB7XHJcbiAgICAgICAgY2FzZSAnc3Vic2NyaWJlJzogX3RoaXMuX29uU3Vic2NyaWJlKGV2ZW50KTsgYnJlYWs7XHJcbiAgICAgICAgY2FzZSAndW5zdWJzY3JpYmUnOiBfdGhpcy5fb25VbnN1YnNjcmliZShldmVudCk7IGJyZWFrO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuXHJcbiAgICBfdGhpcy5fc2V0T25BZGRDaGlsZExpc3RlbmVyKGRhdGFPYmplY3RSZXBvcnRlcik7XHJcblxyXG4gICAgZGF0YU9iamVjdFJlcG9ydGVyLm9uUmVhZCgoZXZlbnQpID0+IHtcclxuICAgICAgZXZlbnQuYWNjZXB0KCk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBkYXRhT2JqZWN0UmVwb3J0ZXIub25FeGVjdXRlKChldmVudCkgPT4ge1xyXG4gICAgICBzd2l0Y2ggKGV2ZW50Lm1ldGhvZCkge1xyXG4gICAgICAgIGNhc2UgJ2FkZFVzZXInOlxyXG4gICAgICAgICAgX3RoaXMuYWRkVXNlcihldmVudC5wYXJhbXNbMF0pLnRoZW4oKCkgPT4ge1xyXG4gICAgICAgICAgICBldmVudC5hY2NlcHQoKTtcclxuICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uKHJlYXNvbikge1xyXG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKCdSZWFzb246JywgcmVhc29uKTtcclxuICAgICAgICAgICAgZXZlbnQucmVqZWN0KHJlYXNvbik7XHJcbiAgICAgICAgICB9KTtcclxuICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgY2FzZSAncmVtb3ZlVXNlcic6XHJcbiAgICAgICAgICAgIF90aGlzLnJlbW92ZVVzZXIoZXZlbnQucGFyYW1zKS50aGVuKCgpID0+IHtcclxuICAgICAgICAgICAgICBldmVudC5hY2NlcHQoKTtcclxuICAgICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24ocmVhc29uKSB7XHJcbiAgICAgICAgICAgICAgY29uc29sZS5lcnJvcignUmVhc29uOicsIHJlYXNvbik7XHJcbiAgICAgICAgICAgICAgZXZlbnQucmVqZWN0KHJlYXNvbik7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICBkZWZhdWx0OiBldmVudC5yZWplY3QoJ1tDaGF0Q29udHJvbGxlci5vbkV4ZWN1dGVdIENoYXQgbWV0aG9kIGV4ZWN1dGlvbiBub3QgYWNjZXB0ZWQgYnkgUmVwb3J0ZXInKTtcclxuICAgICAgICAgIGJyZWFrO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuXHJcbiAgICBfdGhpcy5fZGF0YU9iamVjdFJlcG9ydGVyID0gZGF0YU9iamVjdFJlcG9ydGVyO1xyXG5cclxuICB9XHJcblxyXG4gIGdldCBkYXRhT2JqZWN0UmVwb3J0ZXIoKSB7XHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG4gICAgcmV0dXJuIF90aGlzLl9kYXRhT2JqZWN0UmVwb3J0ZXI7XHJcbiAgfVxyXG5cclxuICBnZXQgbWVzc2FnZXMoKSB7XHJcblxyXG4gICAgcmV0dXJuIHRoaXMuY29udHJvbGxlck1vZGUgPT09ICdyZXBvcnRlcicgPyB0aGlzLl9kYXRhT2JqZWN0UmVwb3J0ZXIuX2NoaWxkcmVuT2JqZWN0cyA6IHRoaXMuX2RhdGFPYmplY3RPYnNlcnZlci5fY2hpbGRyZW5PYmplY3RzO1xyXG4gIH1cclxuXHJcbiAgc2V0IGRhdGFPYmplY3RPYnNlcnZlcihkYXRhT2JqZWN0T2JzZXJ2ZXIpIHtcclxuICAgIGxldCBfdGhpcyA9IHRoaXM7XHJcblxyXG4gICAgX3RoaXMuY29udHJvbGxlck1vZGUgPSAnb2JzZXJ2ZXInO1xyXG5cclxuICAgIF90aGlzLl9kYXRhT2JqZWN0T2JzZXJ2ZXIgPSBkYXRhT2JqZWN0T2JzZXJ2ZXI7XHJcblxyXG4gICAgZGF0YU9iamVjdE9ic2VydmVyLm9uQ2hhbmdlKCcqJywgZnVuY3Rpb24oZXZlbnQpIHtcclxuICAgICAgY29uc29sZS5pbmZvKCdbQ2hhdE1hbmFnZXIuQ2hhdENvbnRyb2xsZXJdT2JzZXJ2ZXIgLSBvbkNoYW5nZScsIGV2ZW50KTtcclxuXHJcbiAgICAgIGlmIChldmVudC5maWVsZC5pbmNsdWRlcygncGFydGljaXBhbnRzJykpIHtcclxuICAgICAgICBzd2l0Y2ggKGV2ZW50LmNUeXBlKSB7XHJcbiAgICAgICAgICBjYXNlICdhZGQnOlxyXG4gICAgICAgICAgICBpZiAoX3RoaXMuX29uVXNlckFkZGVkKSBfdGhpcy5fb25Vc2VyQWRkZWQoZXZlbnQpO1xyXG4gICAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgICBjYXNlICdyZW1vdmUnOlxyXG4gICAgICAgICAgICBpZiAoX3RoaXMuX29uVXNlclJlbW92ZWQpIF90aGlzLl9vblVzZXJSZW1vdmVkKGV2ZW50KTtcclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcblxyXG4gICAgICBpZiAoX3RoaXMuX29uQ2hhbmdlKSBfdGhpcy5fb25DaGFuZ2UoZXZlbnQpO1xyXG5cclxuICAgIH0pO1xyXG5cclxuICAgIF90aGlzLl9zZXRPbkFkZENoaWxkTGlzdGVuZXIoZGF0YU9iamVjdE9ic2VydmVyKTtcclxuXHJcbiAgICAvLyBsZXQgY2hpbGRyZW5zID0gZGF0YU9iamVjdE9ic2VydmVyLmNoaWxkcmVucztcclxuICAgIC8vIE9iamVjdC5rZXlzKGNoaWxkcmVucykuZm9yRWFjaCgoY2hpbGQpID0+IHtcclxuICAgIC8vICAgaWYgKF90aGlzLl9vbk1lc3NhZ2UpIF90aGlzLl9vbk1lc3NhZ2Uoe1xyXG4gICAgLy8gICAgIGNoaWxkSWQ6IGNoaWxkLFxyXG4gICAgLy8gICAgIGlkZW50aXR5OiBjaGlsZHJlbnNbY2hpbGRdLmlkZW50aXR5LFxyXG4gICAgLy8gICAgIHZhbHVlOiBjaGlsZHJlbnNbY2hpbGRdLmRhdGFcclxuICAgIC8vICAgfSk7XHJcbiAgICAvLyB9KVxyXG5cclxuICB9XHJcblxyXG4gIGdldCBkYXRhT2JqZWN0T2JzZXJ2ZXIoKSB7XHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG4gICAgcmV0dXJuIF90aGlzLl9kYXRhT2JqZWN0T2JzZXJ2ZXI7XHJcbiAgfVxyXG5cclxuICBfc2V0T25BZGRDaGlsZExpc3RlbmVyKGRhdGFPYmplY3QpIHtcclxuXHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG5cclxuICAgIGRhdGFPYmplY3Qub25BZGRDaGlsZChmdW5jdGlvbihjaGlsZCkge1xyXG4gICAgICBfdGhpcy5jaGlsZF9jc2VxICs9MTtcclxuICAgICAgY29uc29sZS5pbmZvKCdbQ2hhdE1hbmFnZXIuQ2hhdENvbnRyb2xsZXIuX3NldE9uQWRkQ2hpbGRMaXN0ZW5lcl0gbmV3IENoaWxkIHJlY2VpdmVkOiAnLCBjaGlsZCk7XHJcblxyXG4gICAgICBpZiAoX3RoaXMuX29uTWVzc2FnZSkgX3RoaXMuX29uTWVzc2FnZShjaGlsZCk7XHJcbiAgICB9KTtcclxuXHJcbiAgfVxyXG5cclxuXHJcbiAgZ2V0IGRhdGFPYmplY3QoKSB7XHJcbiAgICByZXR1cm4gdGhpcy5jb250cm9sbGVyTW9kZSA9PT0gJ3JlcG9ydGVyJyA/IHRoaXMuZGF0YU9iamVjdFJlcG9ydGVyIDogdGhpcy5kYXRhT2JqZWN0T2JzZXJ2ZXI7XHJcbiAgfVxyXG5cclxuICBzZXQgY2xvc2VFdmVudChldmVudCkge1xyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuICAgIF90aGlzLl9jbG9zZUV2ZW50ID0gZXZlbnQ7XHJcblxyXG4gICAgaWYgKF90aGlzLl9vbkNsb3NlKSBfdGhpcy5fb25DbG9zZShldmVudCk7XHJcbiAgfVxyXG5cclxuICBnZXQgY2xvc2VFdmVudCgpIHtcclxuICAgIGxldCBfdGhpcyA9IHRoaXM7XHJcbiAgICByZXR1cm4gX3RoaXMuX2Nsb3NlRXZlbnQ7XHJcbiAgfVxyXG5cclxuXHJcblxyXG4gIF9vblN1YnNjcmliZShldmVudCkge1xyXG5cclxuICAgIGxldCBkYXRhT2JqZWN0UmVwb3J0ZXIgPSB0aGlzLl9kYXRhT2JqZWN0UmVwb3J0ZXI7XHJcblxyXG4gICAgZXZlbnQuYWNjZXB0KCk7XHJcblxyXG5cclxuICAgIGNvbnNvbGUubG9nKCdbQ2hhdE1hbmFnZXIuQ2hhdENvbnRyb2xsZXIub25TdWJzY3JpYmVdIGV2ZW50JywgZXZlbnQsIGRhdGFPYmplY3RSZXBvcnRlci51cmwpO1xyXG4gICAgY29uc29sZS5sb2coJ1tDaGF0TWFuYWdlci5DaGF0Q29udHJvbGxlci5vblN1YnNjcmliZV0gTmV3IHVzZXIgaGFzIHN1YnNjcmliZSB0aGlzIG9iamVjdDogJywgZGF0YU9iamVjdFJlcG9ydGVyLmRhdGEsIGV2ZW50LmlkZW50aXR5KTtcclxuXHJcbiAgICBsZXQgaWRlbnRpdHkgPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KGV2ZW50LmlkZW50aXR5KSk7XHJcblxyXG4gICAgaWYgKGlkZW50aXR5Lmhhc093blByb3BlcnR5KCdhc3NlcnRpb24nKSkge1xyXG4gICAgICBkZWxldGUgaWRlbnRpdHkuYXNzZXJ0aW9uXHJcbiAgICB9XHJcblxyXG4gICAgbGV0IHVzZXJJbmZvID0ge1xyXG4gICAgICBoeXBlcnR5VVJMOiBldmVudC51cmwsXHJcbiAgICAgIGRvbWFpbjogZXZlbnQuZG9tYWluLFxyXG4gICAgICBpZGVudGl0eTogaWRlbnRpdHlcclxuICAgIH1cclxuICAgIGxldCB1c2VyVVJMID0gZXZlbnQuaWRlbnRpdHkudXNlclByb2ZpbGUuZ3VpZDtcclxuXHJcbiAgICBjb25zb2xlLmxvZygnW0NoYXRNYW5hZ2VyLkNoYXRDb250cm9sbGVyLm9uU3Vic2NyaWJlXSAgbmV3IHBhcnRpY2lwYW50JywgdXNlckluZm8pO1xyXG4gICAgaWYgKGV2ZW50LmlkZW50aXR5LmxlZ2FjeSkge1xyXG4gICAgIHVzZXJJbmZvLmxlZ2FjeSA9IGV2ZW50LmlkZW50aXR5LmxlZ2FjeTtcclxuICAgIH1cclxuXHJcbiAgICBkYXRhT2JqZWN0UmVwb3J0ZXIuZGF0YS5wYXJ0aWNpcGFudHNbdXNlclVSTF0gPSB1c2VySW5mbztcclxuXHJcbiAgICBjb25zb2xlLmxvZygnW0NoYXRNYW5hZ2VyLkNoYXRDb250cm9sbGVyLm9uU3Vic2NyaWJlXSBjb21tdW5pY2F0aW9uT2JqZWN0IE9CSiBjaGF0Y29udHJvbGxlcicsIGRhdGFPYmplY3RSZXBvcnRlci5kYXRhLnBhcnRpY2lwYW50cyk7XHJcbiAgICBjb25zb2xlLmxvZygnW0NoYXRNYW5hZ2VyLkNoYXRDb250cm9sbGVyLm9uU3Vic2NyaWJlIC0gb25TdWJzY3JpcHRpb25dICcsIHVzZXJJbmZvKTtcclxuICAgIC8vIGNvbnNvbGUubG9nKCdbQ2hhdE1hbmFnZXIuQ2hhdENvbnRyb2xsZXIub25TdWJzY3JpYmUgLSB0aGlzLl9vblVzZXJBZGRlZF0gJywgdGhpcy5fb25Vc2VyQWRkZWQpO1xyXG5cclxuICAgIGlmICh0aGlzLl9vblVzZXJBZGRlZCkgdGhpcy5fb25Vc2VyQWRkZWQodXNlckluZm8pO1xyXG4gIH1cclxuXHJcbiAgX29uVW5zdWJzY3JpYmUoZXZlbnQpIHtcclxuICAgIGxldCBkYXRhT2JqZWN0UmVwb3J0ZXIgPSB0aGlzLl9kYXRhT2JqZWN0UmVwb3J0ZXI7XHJcblxyXG4gICAgY29uc29sZS5sb2coJ1tDaGF0TWFuYWdlci5DaGF0Q29udHJvbGxlci5vblVuc3Vic2NyaWJlXSBldmVudCcsIGV2ZW50LCBkYXRhT2JqZWN0UmVwb3J0ZXIudXJsKTtcclxuXHJcbiAgICBsZXQgcGFydGljaXBhbnQgPSBldmVudC5pZGVudGl0eS51c2VyUHJvZmlsZTtcclxuXHJcbiAgICBjb25zb2xlLmxvZygnW0NoYXRNYW5hZ2VyLkNoYXRDb250cm9sbGVyLm9uVW5zdWJzY3JpYmVdICBwYXJ0aWNpcGFudCBsZWZ0JywgcGFydGljaXBhbnQpO1xyXG4gICAgaWYgKGV2ZW50LmlkZW50aXR5LmxlZ2FjeSkge1xyXG4gICAgICBwYXJ0aWNpcGFudC5sZWdhY3kgPSBldmVudC5pZGVudGl0eS5sZWdhY3k7XHJcbiAgICB9XHJcblxyXG4gICAgZGVsZXRlIGRhdGFPYmplY3RSZXBvcnRlci5kYXRhLnBhcnRpY2lwYW50c1twYXJ0aWNpcGFudC51c2VyVVJMXTtcclxuXHJcbiAgICBjb25zb2xlLmxvZygnW0NoYXRNYW5hZ2VyLkNoYXRDb250cm9sbGVyLm9uVW5zdWJzY3JpYmUgLSB0aGlzLl9vblVzZXJSZW1vdmVkXSAnLCB0aGlzLm9uVXNlclJlbW92ZWQpO1xyXG4gICAgaWYgKHRoaXMuX29uVXNlclJlbW92ZWQpIHRoaXMuX29uVXNlclJlbW92ZWQocGFydGljaXBhbnQpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogVGhpcyBmdW5jdGlvbiBpcyB1c2VkIHRvIHNlbmQgYSBmaWxlLlxyXG4gICAqIEBwYXJhbSAge3N0cmluZ30gICAgIGZpbGUgICAgICAgICAgICAgICAgICAgICAgICBJcyB0aGUgZmlsZSB0byBiZSBzZW50LlxyXG4gICAqIEByZXR1cm4ge1Byb21pc2U8Q29tbXVuaWNhdGlvbi5DaGF0TWVzc2FnZT59ICAgICAgICBJdCByZXR1cm5zIHRoZSBDaGF0TWVzc2FnZSBjaGlsZCBvYmplY3QgY3JlYXRlZCBieSB0aGUgU3luY2hlciBhcyBhIFByb21pc2UuXHJcbiAgICovXHJcbiAgc2VuZEZpbGUoZmlsZSkge1xyXG5cclxuICAgIGxldCBfdGhpcyA9IHRoaXM7XHJcbiAgICBsZXQgbW9kZSA9IF90aGlzLmNvbnRyb2xsZXJNb2RlO1xyXG4gICAgbGV0IGRhdGFPYmplY3QgPSBtb2RlID09PSAncmVwb3J0ZXInID8gX3RoaXMuZGF0YU9iamVjdFJlcG9ydGVyIDogX3RoaXMuZGF0YU9iamVjdE9ic2VydmVyO1xyXG5cclxuICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuXHJcbiAgICAgIGxldCBpZGVudGl0eSA9IHtcclxuICAgICAgICB1c2VyUHJvZmlsZTogX3RoaXMubXlJZGVudGl0eVxyXG4gICAgICB9O1xyXG5cclxuICAgICAgZGF0YU9iamVjdC5hZGRIeXBlcnR5UmVzb3VyY2UoJ3Jlc291cmNlcycsICdmaWxlJywgIGZpbGUsIGlkZW50aXR5KS50aGVuKGZ1bmN0aW9uKHJlc291cmNlRmlsZSkge1xyXG5cclxuICAgICAgICAgIGxldCBpZGVudGl0eSA9IHtcclxuICAgICAgICAgICAgICB1c2VyUHJvZmlsZTogX3RoaXMubXlJZGVudGl0eVxyXG4gICAgICAgICAgfTtcclxuICAgICAgICAgIGxldCBmaWxlU2VudEV2dCA9IHsgdmFsdWUgOiByZXNvdXJjZUZpbGUsIGlkZW50aXR5OiBpZGVudGl0eSwgcmVzb3VyY2U6IHJlc291cmNlRmlsZX07XHJcblxyXG4gICAgICAgICAgbGV0IHJlcG9ydGVyU3RhdHVzID0gbmV3IFJlZ2lzdHJhdGlvblN0YXR1cyhkYXRhT2JqZWN0LnVybCwgX3RoaXMuX21hbmFnZXIuX3J1bnRpbWVVUkwsIF90aGlzLl9tYW5hZ2VyLl9oeXBlcnR5VVJMLCBfdGhpcy5fbWFuYWdlci5fYnVzICk7XHJcblxyXG4gICAgICAgICAgLy8gcmVjdXJzaXZlIGZ1bmN0aW9uIHRvIHN5bmMgd2l0aCBjaGF0IHJlcG9ydGVyXHJcblxyXG4gICAgICAgICAgICBsZXQgc2hhcmUyUmVwb3J0ZXIgPSBmdW5jdGlvbihmaWxlLCBzdWJzY3JpYmVyLCBldnQsIHN0YXR1cykge1xyXG4gICAgICAgICAgICAgIGxldCBzdGF0dXNPZlJlcG9ydGVyID0gc3RhdHVzO1xyXG4gICAgICAgICAgICAgIGZpbGUuc2hhcmluZ1N0YXR1cy50aGVuKHJlc29sdmUoZXZ0KSkuY2F0Y2goKHJlc3VsdCk9PntcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdbQ2hhdE1hbmFnZXIuQ2hhdENvbnRyb2xsZXIuc2VuZEZpbGVdIHNoYXJlIGZhaWxlZDogJywgcmVzdWx0KTtcclxuXHJcbiAgICAgICAgICAgICAgICBzdGF0dXNPZlJlcG9ydGVyLm9uTGl2ZSggc3Vic2NyaWJlciwgKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgc3RhdHVzT2ZSZXBvcnRlci51bnN1YnNjcmliZUxpdmUoc3Vic2NyaWJlcik7XHJcbiAgICAgICAgICAgICAgICBmaWxlLnNoYXJlKHRydWUpO1xyXG4gICAgICAgICAgICAgICAgc2hhcmUyUmVwb3J0ZXIoZmlsZSwgc3Vic2NyaWJlciwgZXZ0LCBzdGF0dXNPZlJlcG9ydGVyKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAvL1RPRE86IHN1YnNjcmliZSB0byBzeW5jIHdoZW4gcmVwb3J0ZXIgaXMgbGl2ZS4gTmV3IHN5bmNoZWQgbWVzc2FnZXMgc2hvdWxkIHRyaWdnZXIgb25NZXNzYWdlIGllIG9uQ2hpbGRcclxuICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgc2hhcmUyUmVwb3J0ZXIocmVzb3VyY2VGaWxlLCBfdGhpcy5fbWFuYWdlci5faHlwZXJ0eVVSTCwgZmlsZVNlbnRFdnQsIHJlcG9ydGVyU3RhdHVzKTtcclxuICAgICAgICB9KTtcclxuICAgIH0pLmNhdGNoKGZ1bmN0aW9uKHJlYXNvbikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdSZWFzb246JywgcmVhc29uKTtcclxuICAgICAgcmVqZWN0KHJlYXNvbik7XHJcbiAgICB9KTtcclxuXHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBUaGlzIGZ1bmN0aW9uIGlzIHVzZWQgdG8gc2VuZCBhIGNoYXQgbWVzc2FnZS5cclxuICAgKiBAcGFyYW0gIHtzdHJpbmd9ICAgICBtZXNzYWdlICAgICAgICAgICAgICAgICAgICAgICAgSXMgdGhlIENoYXRNZXNzYWdlIHRvIGJlIHNlbnQuXHJcbiAgICogQHJldHVybiB7UHJvbWlzZTxDb21tdW5pY2F0aW9uLkNoYXRNZXNzYWdlPn0gICAgICAgIEl0IHJldHVybnMgdGhlIENoYXRNZXNzYWdlIGNoaWxkIG9iamVjdCBjcmVhdGVkIGJ5IHRoZSBTeW5jaGVyIGFzIGEgUHJvbWlzZS5cclxuICAgKi9cclxuICBzZW5kKG1lc3NhZ2UsIGlkZW50aXR5KSB7XHJcblxyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuICAgIGxldCBtb2RlID0gX3RoaXMuY29udHJvbGxlck1vZGU7XHJcbiAgICBsZXQgZGF0YU9iamVjdCA9IG1vZGUgPT09ICdyZXBvcnRlcicgPyBfdGhpcy5kYXRhT2JqZWN0UmVwb3J0ZXIgOiBfdGhpcy5kYXRhT2JqZWN0T2JzZXJ2ZXI7XHJcblxyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG5cclxuLy8gICAgICBsZXQgX2RhdGFPYmplY3RDaGlsZDtcclxuICAgICAgX3RoaXMuY2hpbGRfY3NlcSArPSAxO1xyXG4gICAgICBsZXQgbXNnID0ge1xyXG5cclxuLyogICAgICAgIHVybDogZGF0YU9iamVjdC5kYXRhLnVybCxcclxuICAgICAgICBjc2VxOiBfdGhpcy5jaGlsZF9jc2VxLFxyXG4gICAgICAgIHJlcG9ydGVyOiBkYXRhT2JqZWN0LmRhdGEucmVwb3J0ZXIsXHJcbiAgICAgICAgc2NoZW1hOiBkYXRhT2JqZWN0LmRhdGEuc2NoZW1hLFxyXG4gICAgICAgIG5hbWU6IGRhdGFPYmplY3QuZGF0YS5uYW1lLFxyXG4gICAgICAgIGNyZWF0ZWQgOiBuZXcgRGF0ZSgpLnRvSlNPTigpLCovXHJcblxyXG4gICAgICAgIHR5cGU6ICdjaGF0JyxcclxuICAgICAgICBjb250ZW50OiBtZXNzYWdlXHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGxldCBzZW5kZXIgPSBpZGVudGl0eSA/IGlkZW50aXR5IDoge1xyXG4gICAgICAgIHVzZXJQcm9maWxlOiBfdGhpcy5teUlkZW50aXR5XHJcbiAgICAgIH07XHJcblxyXG5cclxuICAgICAgLy8gVE9ETzogY2hhbmdlIGNoYXRtZXNzYWdlcyB0byByZXNvdXJjZSAtIGNoYXQsIGZpbGVcclxuICAgICAgLy8gVE9ETzogY2hhbmdlIG1lc3NhZ2UgdG8gaHlwZXJ0eVJlc291cmNlIC0gaHR0cHM6Ly9naXRodWIuY29tL3JlVEhJTkstcHJvamVjdC9kZXYtc2VydmljZS1mcmFtZXdvcmsvdHJlZS9kZXZlbG9wL2RvY3MvZGF0YW1vZGVsL2RhdGEtb2JqZWN0cy9oeXBlcnR5LXJlc291cmNlXHJcbiAgICAgIC8vIFRPRE86IGhhbmRsZSB3aXRoIG11bHRpcGxlIHJlc291cmNlcyAtIGlmIHRoZSBcIm1lc3NhZ2VcIiB3aWxsIGJlIGRpZmZlcmVudCBmb3IgZWFjaCB0eXBlIG9mIHJlc291cmNlc1xyXG4gICAgICBkYXRhT2JqZWN0LmFkZENoaWxkKG1zZywgc2VuZGVyKS50aGVuKGZ1bmN0aW9uKGRhdGFPYmplY3RDaGlsZCkge1xyXG4gICAgICAgIGNvbnNvbGUubG9nKCdbQ2hhdE1hbmFnZXIuQ2hhdENvbnRyb2xsZXJdW2FkZENoaWxkIC0gQ2hhdCBNZXNzYWdlXTogJywgZGF0YU9iamVjdENoaWxkKTtcclxuICAgICAgICAvL3Jlc29sdmUoZGF0YU9iamVjdENoaWxkKTtcclxuXHJcbiAgICAgICAgLy9UT0RPOiBtb3ZlIHRvIHNlcGFyYXRlIGZ1bmN0aW9uXHJcblxyXG5cclxuICAgICAgICBsZXQgbXNnID0ge1xyXG4gICAgICAgICAgY2hpbGRJZDogZGF0YU9iamVjdENoaWxkLl9jaGlsZElkLFxyXG4gICAgICAgICAgZnJvbTogZGF0YU9iamVjdENoaWxkLl9vd25lcixcclxuICAgICAgICAgIHZhbHVlOiBkYXRhT2JqZWN0Q2hpbGQuZGF0YSxcclxuICAgICAgICAgIHR5cGU6ICdjcmVhdGUnLFxyXG4gICAgICAgICAgaWRlbnRpdHk6IHNlbmRlclxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGxldCByZXBvcnRlclN0YXR1cyA9IG5ldyBSZWdpc3RyYXRpb25TdGF0dXMoZGF0YU9iamVjdC51cmwsIF90aGlzLl9tYW5hZ2VyLl9ydW50aW1lVVJMLCBfdGhpcy5fbWFuYWdlci5faHlwZXJ0eVVSTCwgX3RoaXMuX21hbmFnZXIuX2J1cyApO1xyXG5cclxuICAgICAgICAvLyByZWN1cnNpdmUgZnVuY3Rpb24gdG8gc3luYyB3aXRoIGNoYXQgcmVwb3J0ZXJcclxuXHJcbiAgICAgICAgICBsZXQgc2hhcmUyUmVwb3J0ZXIgPSBmdW5jdGlvbihjaGlsZCwgc3Vic2NyaWJlciwgbXNnLCBzdGF0dXMpIHtcclxuICAgICAgICAgICAgbGV0IHN0YXR1c09mUmVwb3J0ZXIgPSBzdGF0dXM7XHJcbiAgICAgICAgICAgIGNoaWxkLnNoYXJpbmdTdGF0dXMudGhlbihyZXNvbHZlKG1zZykpLmNhdGNoKChyZXN1bHQpPT57XHJcblxyXG4gICAgICAgICAgICAgICAgc3RhdHVzT2ZSZXBvcnRlci5vbkxpdmUoIHN1YnNjcmliZXIsICgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgc3RhdHVzT2ZSZXBvcnRlci51bnN1YnNjcmliZUxpdmUoc3Vic2NyaWJlcik7XHJcbiAgICAgICAgICAgICAgICAgIGNoaWxkLnNoYXJlKHRydWUpO1xyXG4gICAgICAgICAgICAgICAgICBzaGFyZTJSZXBvcnRlcihjaGlsZCwgc3Vic2NyaWJlciwgbXNnLCBzdGF0dXNPZlJlcG9ydGVyKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgLy9UT0RPOiBzdWJzY3JpYmUgdG8gc3luYyB3aGVuIHJlcG9ydGVyIGlzIGxpdmUuIE5ldyBzeW5jaGVkIG1lc3NhZ2VzIHNob3VsZCB0cmlnZ2VyIG9uTWVzc2FnZSBpZSBvbkNoaWxkXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgfVxyXG5cclxuICAgICAgICAgIHNoYXJlMlJlcG9ydGVyKGRhdGFPYmplY3RDaGlsZCwgX3RoaXMuX21hbmFnZXIuX2h5cGVydHlVUkwsIG1zZywgcmVwb3J0ZXJTdGF0dXMpO1xyXG5cclxuICAgICAgICB9KS5jYXRjaChmdW5jdGlvbihyZWFzb24pIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKCdSZWFzb246JywgcmVhc29uKTtcclxuICAgICAgICByZWplY3QocmVhc29uKTtcclxuICAgICAgfSk7XHJcblxyXG4gICAgfSk7XHJcblxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogW29uQ2hhbmdlIGRlc2NyaXB0aW9uXVxyXG4gICAqIEBwYXJhbSAge0Z1bmN0aW9ufSBjYWxsYmFjayBbZGVzY3JpcHRpb25dXHJcbiAgICogQHJldHVybiB7W3R5cGVdfSAgICAgICAgICAgIFtkZXNjcmlwdGlvbl1cclxuICAgKi9cclxuICBvbkNoYW5nZShjYWxsYmFjaykge1xyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuICAgIF90aGlzLl9vbkNoYW5nZSA9IGNhbGxiYWNrO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogVGhpcyBmdW5jdGlvbiBpcyB1c2VkIHRvIHJlY2VpdmUgbmV3IG1lc3NhZ2VzLlxyXG4gICAqIEBwYXJhbSAge0Z1bmN0aW9ufSBjYWxsYmFjayBGdW5jdGlvbiB0byBoYW5kbGUgd2l0aCBuZXcgbWVzc2FnZXNcclxuICAgKiBAcmV0dXJuIHtDb21tdW5pY2F0aW9uLkNoYXRNZXNzYWdlfSBtXHJcbiAgICovXHJcbiAgb25NZXNzYWdlKGNhbGxiYWNrKSB7XHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG4gICAgX3RoaXMuX29uTWVzc2FnZSA9IGNhbGxiYWNrO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogW29uVXNlckFkZGVkIGRlc2NyaXB0aW9uXVxyXG4gICAqIEBwYXJhbSAge0Z1bmN0aW9ufSBjYWxsYmFjayBbZGVzY3JpcHRpb25dXHJcbiAgICogQHJldHVybiB7W3R5cGVdfSAgICAgICAgICAgIFtkZXNjcmlwdGlvbl1cclxuICAgKi9cclxuICBvblVzZXJBZGRlZChjYWxsYmFjaykge1xyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuICAgIF90aGlzLl9vblVzZXJBZGRlZCA9IGNhbGxiYWNrO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogV2hlbiB0aGUgYW4gdXNlciB3YXMgcmVtb3ZlZFxyXG4gICAqIEBwYXJhbSAge0Z1bmN0aW9ufSBjYWxsYmFjayBGdW5jdGlvbiBoYW5kbGUgd2l0aCB0aGUgcmVtb3ZlZCB1c2VyXHJcbiAgICogQHJldHVybiB7W3R5cGVdfSAgICAgICAgICAgIFtkZXNjcmlwdGlvbl1cclxuICAgKi9cclxuICBvblVzZXJSZW1vdmVkKGNhbGxiYWNrKSB7XHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG4gICAgX3RoaXMuX29uVXNlclJlbW92ZWQgPSBjYWxsYmFjaztcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFRoaXMgZnVuY3Rpb24gaXMgdXNlZCB0byByZWNlaXZlIHJlcXVlc3RzIHRvIGNsb3NlIHRoZSBHcm91cCBDaGF0IGluc3RhbmNlLlxyXG4gICAqIEByZXR1cm4ge0RlbGV0ZUV2ZW50fSBUaGUgRGVsZXRlRXZlbnQgZmlyZWQgYnkgdGhlIFN5bmNoZXIgd2hlbiB0aGUgQ2hhdCBpcyBjbG9zZWQuXHJcbiAgICovXHJcbiAgb25DbG9zZShjYWxsYmFjaykge1xyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuICAgIF90aGlzLl9vbkNsb3NlID0gY2FsbGJhY2s7XHJcbiAgfVxyXG5cclxuICBvblJlc3BvbnNlKGNhbGxiYWNrKSB7XHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG4gICAgX3RoaXMuX29uUmVzcG9uc2UgPSBjYWxsYmFjaztcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFRoaXMgZnVuY3Rpb24gaXMgdXNlZCB0byBhZGQgLyBpbnZpdGUgbmV3IHVzZXIgb24gYW4gZXhpc3RpbmcgR3JvdXAgQ2hhdCBpbnN0YW5jZS5cclxuICAgKiBPbmx5IHRoZSBSZXBvcnRlciwgaS5lLiB0aGUgSHlwZXJ0eSB0aGF0IGhhcyBjcmVhdGVkIHRoZSBHcm91cCBDaGF0LCBpcyBhbGxvd2VkIHRvIHVzZSB0aGlzIGZ1bmN0aW9uLlxyXG4gICAqIEBwYXJhbSB7VVJMLlVzZXJVUkx9ICB1c2VycyAgVXNlciB0byBiZSBpbnZpdGVkIHRvIGpvaW4gdGhlIEdyb3VwIENoYXQgdGhhdCBpcyBpZGVudGlmaWVkIHdpdGggcmVUSElOSyBVc2VyIFVSTC5cclxuICAgKiBAcmV0dXJuIHtQcm9taXNlPGJvb2xlYW4+fSAgIEl0IHJldHVybnMgYXMgYSBQcm9taXNlIHRydWUgaWYgc3VjY2Vzc2Z1bGx5IGludml0ZWQgb3IgZmFsc2Ugb3RoZXJ3aXNlLlxyXG4gICAqL1xyXG4gIGFkZFVzZXIodXNlcnMpIHtcclxuXHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG5cclxuICAgIGxldCBoYXZlRW1wdHlFbGVtZW50cyA9IChlbGVtZW50KSA9PiB7XHJcbiAgICAgIGNvbnNvbGUubG9nKCdFbGVtZW50OicsIGVsZW1lbnQubGVuZ3RoKTtcclxuICAgICAgcmV0dXJuIGVsZW1lbnQubGVuZ3RoICE9PSAwO1xyXG4gICAgfTtcclxuXHJcbiAgICBsZXQgbm90Rm91bmRFbGVtZW50cyA9IChlbGVtZW50KSA9PiB7XHJcbiAgICAgIGNvbnNvbGUubG9nKCd1c2VyIG5vdCBmb3VuZDogJywgZWxlbWVudCk7XHJcbiAgICAgIHJldHVybiAhKGVsZW1lbnQgaW5zdGFuY2VvZiBTdHJpbmcpO1xyXG4gICAgfTtcclxuXHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcblxyXG4gICAgICBpZiAodXNlcnMuZmlsdGVyKGhhdmVFbXB0eUVsZW1lbnRzKS5sZW5ndGggPT09IDApIHtcclxuICAgICAgICByZXR1cm4gcmVqZWN0KCdEb25cXCd0IGhhdmUgdXNlcnMgdG8gaW52aXRlJyk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGNvbnNvbGUuaW5mbygnW0NoYXRNYW5hZ2VyLkNoYXRDb250cm9sbGVyLmFkZFVzZXJzIF06ICcsIHVzZXJzKTtcclxuXHJcbiAgICAgIC8qX3RoaXMuc2VhcmNoLnVzZXJzKHVzZXJzLCBkb21haW5zLCBbJ2NvbW0nXSwgWydjaGF0J10pXHJcblxyXG4gICAgLnRoZW4oKGh5cGVydGllc0lEcykgPT4ge1xyXG5cclxuICAgICAgaWYgKGh5cGVydGllc0lEcy5maWx0ZXIobm90Rm91bmRFbGVtZW50cykubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgICAgdGhyb3cgJ1VzZXIocykgbm90IGZvdW5kJztcclxuICAgICAgfVxyXG5cclxuICAgICAgbGV0IHNlbGVjdGVkSHlwZXJ0aWVzID0gaHlwZXJ0aWVzSURzLm1hcCgoaHlwZXJ0eSkgPT4ge1xyXG4gICAgICAgIHJldHVybiBoeXBlcnR5Lmh5cGVydHlJRDtcclxuICAgICAgfSk7Ki9cclxuXHJcbiAgICAgIGxldCB1c2Vyc0Rpc2NvdmVyeSA9IFtdO1xyXG4gICAgICBsZXQgZGlzY29ubmVjdGVkID0gW107XHJcbiAgICAgIGxldCBsaXZlID0ge307XHJcblxyXG4gICAgICB1c2Vycy5mb3JFYWNoKCh1c2VyKSA9PiB7XHJcbiAgICAgICAgbGV0IHVzZXJEaXNjb3ZlcnlQcm9taXNlID0gX3RoaXMuZGlzY292ZXJ5LmRpc2NvdmVySHlwZXJ0aWVzRE8odXNlci51c2VyLCBbJ2NvbW0nXSwgWydjaGF0J10sIHVzZXIuZG9tYWluKTtcclxuICAgICAgICAgIHVzZXJzRGlzY292ZXJ5LnB1c2godXNlckRpc2NvdmVyeVByb21pc2UpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgUHJvbWlzZS5hbGwodXNlcnNEaXNjb3ZlcnkpLnRoZW4oKHVzZXJEaXNjb3ZlcnlSZXN1bHRzKSA9PiB7XHJcbiAgICAgICAgY29uc29sZS5sb2coJ1tDaGF0TWFuYWdlci5DaGF0Q29udHJvbGxlci5hZGRVc2Vyc10gVXNlcnMgRGlzY292ZXJ5IFJlc3VsdHMtPicsIHVzZXJEaXNjb3ZlcnlSZXN1bHRzKTtcclxuXHJcbiAgICAgICAgbGV0IHNlbGVjdGVkSHlwZXJ0aWVzID0gW107XHJcblxyXG4gICAgICAgICB1c2VyRGlzY292ZXJ5UmVzdWx0cy5mb3JFYWNoKCh1c2VyRGlzY292ZXJ5UmVzdWx0KSA9PiB7XHJcblxyXG4gICAgICAgICAgIHVzZXJEaXNjb3ZlcnlSZXN1bHQuZm9yRWFjaCgoZGlzY292ZXJlZCk9PntcclxuICAgICAgICAgICAgIGlmIChkaXNjb3ZlcmVkLmRhdGEuc3RhdHVzID09PSAnbGl2ZScpe1xyXG4gICAgICAgICAgICAgICBzZWxlY3RlZEh5cGVydGllcy5wdXNoKGRpc2NvdmVyZWQuZGF0YS5oeXBlcnR5SUQpO1xyXG4gICAgICAgICAgICAgICBsaXZlW2Rpc2NvdmVyZWQuZGF0YS5oeXBlcnR5SURdID0gZGlzY292ZXJlZDtcclxuICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgIGVsc2UgaWYgKGRpc2Nvbm5lY3RlZC5sZW5ndGggPCA1KSBkaXNjb25uZWN0ZWQucHVzaChkaXNjb3ZlcmVkKTtcclxuICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGNvbnNvbGUuaW5mbygnW0NoYXRNYW5hZ2VyLkNoYXRDb250cm9sbGVyXS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSBTeW5jaGVyIENyZWF0ZSAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tIFxcbicpO1xyXG4gICAgICAgIGNvbnNvbGUuaW5mbygnW0NoYXRNYW5hZ2VyLkNoYXRDb250cm9sbGVyXVNlbGVjdGVkIEh5cGVydGllczogISEhICcsIHNlbGVjdGVkSHlwZXJ0aWVzKTtcclxuICAgICAgICBjb25zb2xlLmluZm8oYEhhdmUgJHtzZWxlY3RlZEh5cGVydGllcy5sZW5ndGh9IHVzZXJzO2ApO1xyXG4vLyAgICAgICAgY29uc29sZS5pbmZvKCdbQ2hhdE1hbmFnZXJdIEh5cGVydGllc0lEcyAnLCBoeXBlcnRpZXNJRHMpO1xyXG5cclxuICAgICAgICBsZXQgZGF0YU9iamVjdCA9IF90aGlzLmNvbnRyb2xsZXJNb2RlID09PSAncmVwb3J0ZXInID8gX3RoaXMuZGF0YU9iamVjdFJlcG9ydGVyIDogX3RoaXMuZGF0YU9iamVjdE9ic2VydmVyO1xyXG5cclxuICAgICAgICBpZiAoZGlzY29ubmVjdGVkLmxlbmd0aCA+IDApIF90aGlzLl9pbnZpdGF0aW9uc0hhbmRsZXIuaW52aXRlRGlzY29ubmVjdGVkSHlwZXJ0aWVzKGRpc2Nvbm5lY3RlZCwgZGF0YU9iamVjdCk7XHJcblxyXG4gICAgICAgIGRhdGFPYmplY3QuaW52aXRlT2JzZXJ2ZXJzKHNlbGVjdGVkSHlwZXJ0aWVzKTtcclxuXHJcbiAgICAgICAgaWYgKGRhdGFPYmplY3QuaW52aXRhdGlvbnMubGVuZ3RoID4gMCkgX3RoaXMuX2ludml0YXRpb25zSGFuZGxlci5wcm9jZXNzSW52aXRhdGlvbnMobGl2ZSwgZGF0YU9iamVjdCk7XHJcblxyXG4gICAgICAgIHJldHVybjtcclxuXHJcbiAgICAgICAgfSlcclxuICAgICAgICAudGhlbigoKSA9PiB7XHJcbiAgICAgICAgICBjb25zb2xlLmluZm8oJ1tDaGF0TWFuYWdlci5DaGF0Q29udHJvbGxlcl1BcmUgaW52aXRlZCB3aXRoIHN1Y2Nlc3MgJyArIHVzZXJzLmxlbmd0aCArICcgdXNlcnM7Jyk7XHJcbiAgICAgICAgICByZXNvbHZlKHRydWUpO1xyXG5cclxuXHJcblxyXG4gICAgICAgIH0pLmNhdGNoKChyZWFzb24pID0+IHtcclxuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0FuIGVycm9yIG9jY3VycmVkIHdoZW4gdHJ5aW5nIHRvIGludml0ZSB1c2VycztcXG4nLCByZWFzb24pO1xyXG4gICAgICAgICAgcmVqZWN0KHJlYXNvbik7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgfSk7XHJcblxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogVGhpcyBmdW5jdGlvbiBpcyB1c2VkIHRvIHJlcXVlc3QgdGhlIFJlcG9ydGVyIHRvIGFkZCAvIGludml0ZSBuZXcgdXNlciBvbiBhbiBleGlzdGluZyBHcm91cCBDaGF0IGluc3RhbmNlLlxyXG4gICAqIE9ubHkgT2JzZXJ2ZXJzIGFyZSBhbGxvd2VkIHRvIHVzZSB0aGlzIGZ1bmN0aW9uLlxyXG4gICAqIEBwYXJhbSB7VVJMLlVzZXJVUkx9ICB1c2VycyAgVXNlciB0byBiZSBpbnZpdGVkIHRvIGpvaW4gdGhlIEdyb3VwIENoYXQgdGhhdCBpcyBpZGVudGlmaWVkIHdpdGggcmVUSElOSyBVc2VyIFVSTC5cclxuICAgKiBAcmV0dXJuIHtQcm9taXNlPGJvb2xlYW4+fSAgIEl0IHJldHVybnMgYXMgYSBQcm9taXNlIHRydWUgaWYgc3VjY2Vzc2Z1bGx5IGludml0ZWQgb3IgZmFsc2Ugb3RoZXJ3aXNlLlxyXG4gICAqL1xyXG4gIGFkZFVzZXJSZXEodXNlcnMpIHtcclxuXHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG5cclxuICAgIC8vY2hlY2sgaXMgT2JzZXJ2ZXIgYW5kIGludm9rZSBvYnNlcnZlci5leGVjdXRlKCkgd2l0aCBuZXcgcHJvbWlzZVxyXG4gICAgbGV0IGhhdmVFbXB0eUVsZW1lbnRzID0gKGVsZW1lbnQpID0+IHtcclxuICAgICAgY29uc29sZS5sb2coJ0VsZW1lbnQ6JywgZWxlbWVudC5sZW5ndGgpO1xyXG4gICAgICByZXR1cm4gZWxlbWVudC5sZW5ndGggIT09IDA7XHJcbiAgICB9O1xyXG5cclxuICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuXHJcbiAgICAgIGlmICh1c2Vycy5maWx0ZXIoaGF2ZUVtcHR5RWxlbWVudHMpLmxlbmd0aCA9PT0gMCkge1xyXG4gICAgICAgIHJldHVybiByZWplY3QoJ1tDaGF0TWFuYWdlci5DaGF0Q29udHJvbGxlci5hZGRVc2VyUmVxXSBEb25cXCd0IGhhdmUgdXNlcnMgdG8gYWRkJyk7XHJcbiAgICAgIH1cclxuICAgICAgaWYgKCFfdGhpcy5jb250cm9sbGVyTW9kZSA9PT0gJ29ic2VydmVyJykge1xyXG4gICAgICAgIHJldHVybiByZWplY3QoJ1tDaGF0TWFuYWdlci5DaGF0Q29udHJvbGxlci5hZGRVc2VyUmVxXSBvbmx5IGFsbG93ZWQgdG8gQ2hhdCBPYnNlcnZlcicpO1xyXG5cclxuICAgICAgbGV0IGFkZFVzZXIgPSBfdGhpcy5hZGRVc2VyKHVzZXJzKTtcclxuXHJcbiAgICAgIGlmIChfdGhpcy5fZGF0YU9iamVjdE9ic2VydmVyKSB7XHJcbiAgICAgICAgYWRkVXNlciA9IF90aGlzLl9kYXRhT2JqZWN0T2JzZXJ2ZXIuZXhlY3V0ZSgnYWRkVXNlcicsIHVzZXJzKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgYWRkVXNlci50aGVuKCgpID0+IHtcclxuICAgICAgICBjb25zb2xlLmluZm8oJ1tDaGF0TWFuYWdlci5DaGF0Q29udHJvbGxlci5hZGRVc2VyUmVxXSBSZXF1ZXN0IGFjY2VwdGVkIGJ5IFJlcG9ydGVyICcpO1xyXG4gICAgICAgIHJlc29sdmUodHJ1ZSk7XHJcbiAgICAgIH0pLmNhdGNoKChyZWFzb24pID0+IHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKCdbQ2hhdE1hbmFnZXIuQ2hhdENvbnRyb2xsZXIuYWRkVXNlclJlcV0gUmVxdWVzdCByZWplY3RlZCBieSBSZXBvcnRlcjtcXG4nLCByZWFzb24pO1xyXG4gICAgICAgIHJlamVjdChyZWFzb24pO1xyXG4gICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgfSk7XHJcblxyXG59XHJcblxyXG4gIG9uSW52aXRhdGlvblJlc3BvbnNlKGNhbGxiYWNrKSB7XHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG4gICAgX3RoaXMuX29uSW52aXRhdGlvblJlc3BvbnNlID0gY2FsbGJhY2s7XHJcbiAgICBfdGhpcy5faW52aXRhdGlvbnNIYW5kbGVyLmludml0YXRpb25SZXNwb25zZSA9IGNhbGxiYWNrO1xyXG4gIH1cclxuXHJcblxyXG4gIC8qKlxyXG4gICAqIFRoaXMgZnVuY3Rpb24gaXMgdXNlZCB0byByZW1vdmUgYSB1c2VyIGZyb20gYW4gZXhpc3RpbmcgR3JvdXAgQ2hhdCBpbnN0YW5jZS5cclxuICAgKiBPbmx5IHRoZSBSZXBvcnRlciwgaS5lLiB0aGUgSHlwZXJ0eSB0aGF0IGhhcyBjcmVhdGVkIHRoZSBHcm91cCBDaGF0LCBpcyBhbGxvd2VkIHRvIHVzZSB0aGlzIGZ1bmN0aW9uLlxyXG4gICAqIEByZXR1cm4gezxQcm9taXNlPiBib29sZWFufSBQcm9taXNlIHdpdGggdGhlIHN0YXR1c1xyXG4gICAqL1xyXG5cclxuICAvKipcclxuICAgKiBUaGlzIGZ1bmN0aW9uIGlzIHVzZWQgdG8gcmVtb3ZlIGEgdXNlciBmcm9tIGFuIGV4aXN0aW5nIEdyb3VwIENoYXQgaW5zdGFuY2UuXHJcbiAgICogT25seSB0aGUgUmVwb3J0ZXIsIGkuZS4gdGhlIEh5cGVydHkgdGhhdCBoYXMgY3JlYXRlZCB0aGUgR3JvdXAgQ2hhdCwgaXMgYWxsb3dlZCB0byB1c2UgdGhpcyBmdW5jdGlvbi5cclxuICAgKiBAcGFyYW0gIHtVUkwuVXNlclVSTH0gdXNlciAgICAgICBVc2VyIHRvIGJlIHJlbW92ZWQgZnJvbSB0aGUgR3JvdXAgQ2hhdCB0aGF0IGlzIGlkZW50aWZpZWQgd2l0aCByZVRISU5LIFVzZXIgVVJMLlxyXG4gICAqIEByZXR1cm4gezxQcm9taXNlPiBib29sZWFufSAgICAgIEl0IHJldHVybnMgYXMgYSBQcm9taXNlIHRydWUgaWYgc3VjY2Vzc2Z1bGx5IHJlbW92ZWQgb3IgZmFsc2Ugb3RoZXJ3aXNlLlxyXG4gICAqL1xyXG4gIHJlbW92ZVVzZXIodXNlcikge1xyXG5cclxuICAgIC8vIFRPRE86IGltcGxlbWVudCB0aGUgcmVtb3ZlVXNlcjtcclxuICAgIGNvbnNvbGUubG9nKCdbQ2hhdE1hbmFnZXIuQ2hhdENvbnRyb2xsZXJdTm90IHlldCBpbXBsZW1lbnRlZDogJywgdXNlcik7XHJcblxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogVGhpcyBmdW5jdGlvbiBpcyB1c2VkIHRvIGNsb3NlIGFuIGV4aXN0aW5nIEdyb3VwIENoYXQgaW5zdGFuY2UuXHJcbiAgICogT25seSBhdmFpbGFibGUgdG8gQ2hhdCBHcm91cCBSZXBvcnRlcnMgaS5lLiB0aGUgSHlwZXJ0eSBpbnN0YW5jZSB0aGF0IGNyZWF0ZWQgdGhlIEdyb3VwIENoYXQuXHJcbiAgICogQHJldHVybiB7PFByb21pc2U+Qm9vbGVhbn0gSXQgcmV0dXJucyBhcyBhIFByb21pc2UgdHJ1ZSBpZiBzdWNjZXNzZnVsbHkgY2xvc2VkIG9yIGZhbHNlIG90aGVyd2lzZS5cclxuICAgKi9cclxuICBjbG9zZShkZWwgPSB0cnVlKSB7XHJcbiAgICAvLyBUT0RPOiB0aGUgZGF0YU9iamVjdFJlcG9ydGVyLmRlbGV0ZSBzaG91bGQgYmUgYSBQcm9taXNlO1xyXG5cclxuICAgIGxldCBfdGhpcyA9IHRoaXM7XHJcbiAgICBcclxuICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgXHJcbiAgICAgIGlmIChfdGhpcy5jb250cm9sbGVyTW9kZSA9PT0gJ3JlcG9ydGVyJykge1xyXG4gICAgICAgIC8vIHJlcG9ydGVyXHJcbiAgICAgICAgX3RoaXMuX2ludml0YXRpb25zSGFuZGxlci5jbGVhbkludml0YXRpb25zKF90aGlzLmRhdGFPYmplY3RSZXBvcnRlcikudGhlbigoKSA9PiB7XHJcbiAgICAgICAgICBpZiAoIWRlbCkge1xyXG4gICAgICAgICAgICBfdGhpcy5fbWFuYWdlci5jb21tdW5pY2F0aW9uT2JqZWN0LnN0YXR1cyA9ICdjbG9zZWQnO1xyXG4gICAgICAgICAgICAgIHJlc29sdmUodHJ1ZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZXtcclxuXHJcbiAgICAgICAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgZGVsZXRlIF90aGlzLl9tYW5hZ2VyLl9yZXBvcnRlcnNDb250cm9sbGVyc1tfdGhpcy5kYXRhT2JqZWN0UmVwb3J0ZXIudXJsXTtcclxuICAgICAgICAgICAgICAgIF90aGlzLmRhdGFPYmplY3RSZXBvcnRlci5kZWxldGUoKTtcclxuICAgICAgICAgICAgICAgIHJlc29sdmUodHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICBpZiAoX3RoaXMuX29uQ2xvc2UpIF90aGlzLl9vbkNsb3NlKHtcclxuICAgICAgICAgICAgICAgICAgY29kZTogMjAwLFxyXG4gICAgICAgICAgICAgICAgICBkZXNjOiAnZGVsZXRlZCcsXHJcbiAgICAgICAgICAgICAgICAgIHVybDogX3RoaXMuZGF0YU9iamVjdFJlcG9ydGVyLnVybFxyXG4gICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICB9IGNhdGNoIChlKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKGUpO1xyXG4gICAgICAgICAgICAgICAgcmVqZWN0KGZhbHNlKTtcclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICB9KTtcclxuXHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgLy8gb2JzZXJ2ZXJcclxuICAgICAgICBpZihkZWwpe1xyXG4gICAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgZGVsZXRlIF90aGlzLl9tYW5hZ2VyLl9vYnNlcnZlcnNDb250cm9sbGVyc1tfdGhpcy5kYXRhT2JqZWN0T2JzZXJ2ZXIudXJsXTtcclxuICAgICAgICAgICAgX3RoaXMuZGF0YU9iamVjdE9ic2VydmVyLnVuc3Vic2NyaWJlKCk7XHJcbiAgICAgICAgICAgIHJlc29sdmUodHJ1ZSk7XHJcbiAgICAgICAgICB9IGNhdGNoIChlKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZSk7XHJcbiAgICAgICAgICAgIHJlamVjdChmYWxzZSk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2V7XHJcbiAgICAgICAgICAvLyBUT0RPOiBzZW5kIG1lc3NhZ2UgXHJcbiAgICAgICAgICByZXNvbHZlKHRydWUpO1xyXG4gICAgICAgIH0gXHJcbiAgICAgICAgXHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG5cclxuICB9XHJcblxyXG59XHJcblxyXG5leHBvcnQgZGVmYXVsdCBDaGF0Q29udHJvbGxlcjtcclxuIiwiaW1wb3J0IHsgZGVlcENsb25lIH0gZnJvbSAnLi4vdXRpbHMvdXRpbHMnO1xyXG5cclxuZXhwb3J0IGNsYXNzIFVzZXJJbmZvIHtcclxuXHJcbiAgY29uc3RydWN0b3IoaHlwZXJ0eVVSTCwgZG9tYWluLCBpZGVudGl0eSkge1xyXG5cclxuICAgIGxldCBjb21wbGV0ZUlkZW50aXR5ID0gZGVlcENsb25lKGlkZW50aXR5KTtcclxuICAgIGlmICghaWRlbnRpdHkuaGFzT3duUHJvcGVydHkoJ3VzZXJQcm9maWxlJykpIHtcclxuICAgICAgY29tcGxldGVJZGVudGl0eVsndXNlclByb2ZpbGUnXSA9IGlkZW50aXR5O1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiB7XHJcbiAgICAgIGh5cGVydHlVUkw6IGh5cGVydHlVUkwsXHJcbiAgICAgIGRvbWFpbiwgZG9tYWluLFxyXG4gICAgICBpZGVudGl0eTogY29tcGxldGVJZGVudGl0eVxyXG4gICAgfVxyXG5cclxuICB9XHJcblxyXG59XHJcbiIsIlxyXG4vKipcclxuKiBDb3B5cmlnaHQgMjAxNiBQVCBJbm92YcOnw6NvIGUgU2lzdGVtYXMgU0FcclxuKiBDb3B5cmlnaHQgMjAxNiBJTkVTQy1JRFxyXG4qIENvcHlyaWdodCAyMDE2IFFVT0JJUyBORVRXT1JLUyBTTFxyXG4qIENvcHlyaWdodCAyMDE2IEZSQVVOSE9GRVItR0VTRUxMU0NIQUZUIFpVUiBGT0VSREVSVU5HIERFUiBBTkdFV0FORFRFTiBGT1JTQ0hVTkcgRS5WXHJcbiogQ29weXJpZ2h0IDIwMTYgT1JBTkdFIFNBXHJcbiogQ29weXJpZ2h0IDIwMTYgRGV1dHNjaGUgVGVsZWtvbSBBR1xyXG4qIENvcHlyaWdodCAyMDE2IEFwaXplZVxyXG4qIENvcHlyaWdodCAyMDE2IFRFQ0hOSVNDSEUgVU5JVkVSU0lUQVQgQkVSTElOXHJcbipcclxuKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4qIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuKlxyXG4qICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbipcclxuKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4qIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4qIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuKiovXHJcblxyXG4vLyBTZXJ2aWNlIEZyYW1ld29ya1xyXG4vL2ltcG9ydCBJZGVudGl0eU1hbmFnZXIgZnJvbSAnLi4vaWRlbnRpdHlNYW5hZ2VyL0lkZW50aXR5TWFuYWdlcic7XHJcbi8vaW1wb3J0IFJlZ2lzdHJhdGlvblN0YXR1cyBmcm9tICcuLi9kaXNjb3ZlcnkvUmVnaXN0cmF0aW9uU3RhdHVzJztcclxuLy9pbXBvcnQgRGlzY292ZXJ5IGZyb20gJy4uL2Rpc2NvdmVyeS9EaXNjb3ZlcnknO1xyXG4vL2ltcG9ydCBTeW5jaGVyIGZyb20gJy4uL3N5bmNoZXIvU3luY2hlcic7XHJcblxyXG4vLyBVdGlsc1xyXG4vL2ltcG9ydCB7ZGl2aWRlVVJMfSBmcm9tICcuLi91dGlscy91dGlscyc7XHJcbi8vaW1wb3J0IFNlYXJjaCBmcm9tICcuLi91dGlscy9TZWFyY2gnO1xyXG5cclxuLy8gSW50ZXJuYWxzXHJcbmltcG9ydCB7IGNvbW11bmljYXRpb25PYmplY3QsIENvbW11bmljYXRpb25TdGF0dXMsIGNvbW11bmljYXRpb25DaGlsZHJlbiB9IGZyb20gJy4vY29tbXVuaWNhdGlvbic7XHJcbmltcG9ydCBDaGF0Q29udHJvbGxlciBmcm9tICcuL0NoYXRDb250cm9sbGVyJztcclxuaW1wb3J0IHsgVXNlckluZm8gfSBmcm9tICcuL1VzZXJJbmZvJztcclxuXHJcbi8qKlxyXG4qIEh5cGVydHkgR3JvdXAgQ2hhdCBNYW5hZ2VyIEFQSSAoSHlwZXJ0eUNoYXQpXHJcbiogQGF1dGhvciBWaXRvciBTaWx2YSBbdml0b3ItdC1zaWx2YUB0ZWxlY29tLnB0XVxyXG4qIEB2ZXJzaW9uIDAuMS4wXHJcbiovXHJcbmNsYXNzIENoYXRNYW5hZ2VyIHtcclxuXHJcbiAgY29uc3RydWN0b3IobXlVcmwsIGJ1cywgY29uZmlndXJhdGlvbiwgc3luY2hlciwgZmFjdG9yeSkge1xyXG4gICAgaWYgKCFteVVybCkgdGhyb3cgbmV3IEVycm9yKCdbQ2hhdE1hbmFnZXIuY29uc3RydWN0b3JdIFRoZSBteVVybCBpcyBhIG5lZWRlZCBwYXJhbWV0ZXInKTtcclxuICAgIGlmICghYnVzKSB0aHJvdyBuZXcgRXJyb3IoJ1tDaGF0TWFuYWdlci5jb25zdHJ1Y3Rvcl0gVGhlIE1pbmlCdXMgaXMgYSBuZWVkZWQgcGFyYW1ldGVyJyk7XHJcbiAgICBpZiAoIWNvbmZpZ3VyYXRpb24pIHRocm93IG5ldyBFcnJvcignW0NoYXRNYW5hZ2VyLmNvbnN0cnVjdG9yXSBUaGUgY29uZmlndXJhdGlvbiBpcyBhIG5lZWRlZCBwYXJhbWV0ZXInKTtcclxuXHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG4gICAgaWYgKCFzeW5jaGVyKSB7XHJcbiAgICAgIHN5bmNoZXIgPSBmYWN0b3J5LmNyZWF0ZVN5bmNoZXIobXlVcmwsIGJ1cywgY29uZmlndXJhdGlvbik7XHJcbiAgICB9XHJcblxyXG4gICAgX3RoaXMuX3J1bnRpbWVVUkwgPSBjb25maWd1cmF0aW9uLnJ1bnRpbWVVUkw7XHJcblxyXG4gICAgbGV0IGRvbWFpbiA9IGZhY3RvcnkuZGl2aWRlVVJMKF90aGlzLl9ydW50aW1lVVJMKS5kb21haW47XHJcbiAgICBsZXQgZGlzY292ZXJ5ID0gZmFjdG9yeS5jcmVhdGVEaXNjb3ZlcnkobXlVcmwsIGNvbmZpZ3VyYXRpb24ucnVudGltZVVSTCwgYnVzKTtcclxuICAgIGxldCBpZGVudGl0eU1hbmFnZXIgPSBmYWN0b3J5LmNyZWF0ZUlkZW50aXR5TWFuYWdlcihteVVybCwgY29uZmlndXJhdGlvbi5ydW50aW1lVVJMLCBidXMpO1xyXG5cclxuICAgIF90aGlzLl9vYmplY3REZXNjVVJMID0gJ2h5cGVydHktY2F0YWxvZ3VlOi8vY2F0YWxvZ3VlLicgKyBkb21haW4gKyAnLy53ZWxsLWtub3duL2RhdGFzY2hlbWEvQ29tbXVuaWNhdGlvbic7XHJcblxyXG4gICAgX3RoaXMuX3JlcG9ydGVyc0NvbnRyb2xsZXJzID0ge307XHJcbiAgICBfdGhpcy5fb2JzZXJ2ZXJzQ29udHJvbGxlcnMgPSB7fTtcclxuXHJcbiAgICBfdGhpcy5fbXlVcmwgPSBteVVybDtcclxuICAgIF90aGlzLl9idXMgPSBidXM7XHJcbiAgICBfdGhpcy5fc3luY2hlciA9IHN5bmNoZXI7XHJcbiAgICBfdGhpcy5fZG9tYWluID0gZG9tYWluO1xyXG5cclxuICAgIF90aGlzLmRpc2NvdmVyeSA9IGRpc2NvdmVyeTtcclxuICAgIF90aGlzLmlkZW50aXR5TWFuYWdlciA9IGlkZW50aXR5TWFuYWdlcjtcclxuICAgIF90aGlzLmN1cnJlbnRJZGVudGl0eTtcclxuXHJcbiAgICBfdGhpcy5zZWFyY2ggPSBmYWN0b3J5LmNyZWF0ZVNlYXJjaChkaXNjb3ZlcnksIGlkZW50aXR5TWFuYWdlcik7XHJcblxyXG4gICAgX3RoaXMuY29tbXVuaWNhdGlvbk9iamVjdCA9IGNvbW11bmljYXRpb25PYmplY3Q7XHJcblxyXG4gICAgX3RoaXMuY29tbXVuaWNhdGlvbkNoaWxkcmVuID0gY29tbXVuaWNhdGlvbkNoaWxkcmVuO1xyXG5cclxuICAgIGNvbnNvbGUubG9nKCdbQ2hhdE1hbmFnZXJdIERpc2NvdmVyICcsIGRpc2NvdmVyeSk7XHJcbiAgICBjb25zb2xlLmxvZygnW0NoYXRNYW5hZ2VyXSBJZGVudGl0eSBNYW5hZ2VyICcsIGlkZW50aXR5TWFuYWdlcik7XHJcblxyXG5cclxuICB9XHJcblxyXG4gIHNldCBvZmZsaW5lKG9mZmxpbmUpIHtcclxuICAgIHRoaXMuX29mZmxpbmUgPSBvZmZsaW5lO1xyXG4gIH1cclxuXHJcbiAgZ2V0IG9mZmxpbmUoKSB7XHJcbiAgICByZXR1cm4gdGhpcy5fb2ZmbGluZSA/IHRoaXMuX29mZmxpbmUgOiBmYWxzZTtcclxuICB9XHJcblxyXG5cclxuICBwcm9jZXNzTm90aWZpY2F0aW9uKGV2ZW50KSB7XHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG4gICAgY29uc29sZS5sb2coJ1tDaGF0TWFuYWdlci5wcm9jZXNzTm90aWZpY2F0aW9uOiAnLCBldmVudCk7XHJcblxyXG4gICAgaWYgKGV2ZW50LnR5cGUgPT09ICdjcmVhdGUnKSB7XHJcblxyXG4gICAgICAvLyBUT0RPOiByZXBsYWNlIHRoZSAxMDAgZm9yIE1lc3NhZ2UuUmVzcG9uc2VcclxuICAgICAgLy8gZXZlbnQuYWNrKDIwMCk7XHJcblxyXG4gICAgICBpZiAoX3RoaXMuX29uSW52aXRhdGlvbikgeyBfdGhpcy5fb25JbnZpdGF0aW9uKGV2ZW50KTsgfVxyXG4gICAgfVxyXG5cclxuICAgIGlmIChldmVudC50eXBlID09PSAnZGVsZXRlJykge1xyXG4gICAgICAvLyBUT0RPOiByZXBsYWNlIHRoZSAyMDAgZm9yIE1lc3NhZ2UuUmVzcG9uc2VcclxuICAgICAgZXZlbnQuYWNrKDIwMCk7XHJcblxyXG4gICAgICBfdGhpcy5fb2JzZXJ2ZXJzQ29udHJvbGxlcnNbZXZlbnQudXJsXS5jbG9zZUV2ZW50ID0gZXZlbnQ7XHJcblxyXG4gICAgICBkZWxldGUgX3RoaXMuX29ic2VydmVyc0NvbnRyb2xsZXJzW2V2ZW50LnVybF07XHJcblxyXG4gICAgICBfdGhpcy5fb2JzZXJ2ZXJzQ29udHJvbGxlcnMuY2xvc2VFdmVudCA9IGV2ZW50O1xyXG5cclxuICAgICAgX3RoaXMuY29tbXVuaWNhdGlvbk9iamVjdCA9IGNvbW11bmljYXRpb25PYmplY3Q7XHJcblxyXG5cclxuICAgICAgZm9yIChsZXQgdXJsIGluIHRoaXMuX3JlcG9ydGVyc0NvbnRyb2xsZXJzKSB7XHJcbiAgICAgICAgdGhpcy5fcmVwb3J0ZXJzQ29udHJvbGxlcnNbdXJsXS5jbG9zZShldmVudCk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGZvciAobGV0IHVybCBpbiB0aGlzLl9vYnNlcnZlcnNDb250cm9sbGVycykge1xyXG4gICAgICAgIHRoaXMuX29ic2VydmVyc0NvbnRyb2xsZXJzW3VybF0uY2xvc2UoZXZlbnQpO1xyXG4gICAgICB9XHJcblxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgbXlJZGVudGl0eShpZGVudGl0eSkge1xyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuXHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xyXG4gICAgICBjb25zb2xlLmluZm8oJ1tDaGF0TWFuYWdlci5teUlkZW50aXR5XScpO1xyXG4gICAgICBpZiAoaWRlbnRpdHkpIHJldHVybiByZXNvbHZlKGlkZW50aXR5KTtcclxuXHJcbiAgICAgIGlmIChfdGhpcy5fbXlVcmwuaW5jbHVkZXMoJ2h5cGVydHk6Ly8nKSkge1xyXG4gICAgICAgIF90aGlzLmlkZW50aXR5TWFuYWdlci5kaXNjb3ZlclVzZXJSZWdpc3RlcmVkKCkudGhlbigoaWRlbnRpdHkpID0+IHtcclxuICAgICAgICAgIHJlc29sdmUoaWRlbnRpdHkpO1xyXG4gICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uKHJlYXNvbikge1xyXG4gICAgICAgICAgcmVqZWN0KHJlYXNvbik7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgX3RoaXMuaWRlbnRpdHlNYW5hZ2VyLmRpc2NvdmVySWRlbnRpdHlQZXJJZFAoKS50aGVuKChpZGVudGl0eSkgPT4ge1xyXG4gICAgICAgICAgcmVzb2x2ZShpZGVudGl0eSk7XHJcbiAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24ocmVhc29uKSB7XHJcbiAgICAgICAgICByZWplY3QocmVhc29uKTtcclxuICAgICAgICB9KTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBUaGlzIGZ1bmN0aW9uIGlzIHVzZWQgdG8gY3JlYXRlIGEgbmV3IEdyb3VwIENoYXQgcHJvdmlkaW5nIHRoZSBuYW1lIGFuZCB0aGUgaWRlbnRpZmllcnMgb2YgdXNlcnMgdG8gYmUgaW52aXRlZC5cclxuICAgKiBAcGFyYW0gIHtzdHJpbmd9ICAgICAgICAgICAgICAgICAgICAgbmFtZSAgSXMgYSBzdHJpbmcgdG8gaWRlbnRpZnkgdGhlIEdyb3VwIENoYXRcclxuICAgKiBAcGFyYW0gIHthcnJheTxVUkwudXNlclVSTD59ICAgICAgICAgdXNlcnMgQXJyYXkgb2YgdXNlcnMgdG8gYmUgaW52aXRlZCB0byBqb2luIHRoZSBHcm91cCBDaGF0LiBVc2VycyBhcmUgaWRlbnRpZmllZCB3aXRoIHJlVEhJTksgVXNlciBVUkwsIGxpa2UgdGhpcyBmb3JtYXQgdXNlcjovLzxpcGRkb21haW4+Lzx1c2VyLWlkZW50aWZpZXI+XHJcbiAgICogQHJldHVybiB7PFByb21pc2U+Q2hhdENvbnRyb2xsZXJ9ICAgIEEgQ2hhdENvbnRyb2xsZXIgb2JqZWN0IGFzIGEgUHJvbWlzZS5cclxuICAgKi9cclxuICBjcmVhdGUobmFtZSwgdXNlcnMsIGV4dHJhID0ge30pIHtcclxuXHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG4gICAgbGV0IHN5bmNoZXIgPSBfdGhpcy5fc3luY2hlcjtcclxuXHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xyXG5cclxuICAgICAgX3RoaXMuY29tbXVuaWNhdGlvbk9iamVjdCA9IGNvbW11bmljYXRpb25PYmplY3Q7XHJcbiAgICAgIF90aGlzLmNvbW11bmljYXRpb25PYmplY3QuY3NlcSA9IDE7XHJcbiAgICAgIF90aGlzLmNvbW11bmljYXRpb25PYmplY3Quc3RhcnRpbmdUaW1lID0gbmV3IERhdGUoKS50b0pTT04oKTtcclxuICAgICAgX3RoaXMuY29tbXVuaWNhdGlvbk9iamVjdC5zdGF0dXMgPSAgQ29tbXVuaWNhdGlvblN0YXR1cy5PUEVOO1xyXG5cclxuICAgICAgbGV0IG15SWRlbnRpdHk7XHJcblxyXG4gICAgICBfdGhpcy5teUlkZW50aXR5KCkudGhlbigoaWRlbnRpdHkpID0+IHtcclxuICAgICAgICBteUlkZW50aXR5ID0gaWRlbnRpdHk7XHJcbiAgICAgICAgY29uc29sZS5sb2coJ1tDaGF0TWFuYWdlci5jcmVhdGUgXSBNeSBJZGVudGl0eScsIGlkZW50aXR5KTtcclxuXHJcbiAgICAgICAgLy8gbGV0IHVybCA9IF90aGlzLmNvbW11bmljYXRpb25PYmplY3QucmVwb3J0ZXI7XHJcblxyXG4gICAgICAgIGxldCB1c2VySW5mbyA9IG5ldyBVc2VySW5mbyhfdGhpcy5fbXlVcmwsIF90aGlzLl9kb21haW4sIGlkZW50aXR5KTtcclxuXHJcbiAgICAgICAgLy8gQWRkIG15IGlkZW50aXR5XHJcbiAgICAgICAgX3RoaXMuY29tbXVuaWNhdGlvbk9iamVjdC5wYXJ0aWNpcGFudHNbaWRlbnRpdHkuZ3VpZF0gPSB1c2VySW5mbztcclxuXHJcbiAgICAgICAgY29uc29sZS5sb2coJ1tDaGF0TWFuYWdlci5jcmVhdGUgXSBwYXJ0aWNpcGFudHM6ICcsIF90aGlzLmNvbW11bmljYXRpb25PYmplY3QucGFydGljaXBhbnRzKTtcclxuICAgICAgICBjb25zb2xlLmxvZygnW0NoYXRNYW5hZ2VyLmNyZWF0ZSBdIGNvbW11bmljYXRpb25PYmplY3QnLCBfdGhpcy5jb21tdW5pY2F0aW9uT2JqZWN0KTtcclxuICAgICAgICBjb25zb2xlLmluZm8oJ1tDaGF0TWFuYWdlci5jcmVhdGVdIHNlYXJjaGluZyAnICsgdXNlcnMpO1xyXG5cclxuICAgICAgICAvL2xldCB1c2Vyc1NlYXJjaCA9IF90aGlzLnNlYXJjaC51c2Vycyh1c2VycywgZG9tYWlucywgWydjb21tJ10sIFsnY2hhdCddKTtcclxuXHJcbiAgICAgICAgbGV0IHVzZXJzRGlzY292ZXJ5ID0gW107XHJcblxyXG4gICAgICAgIGxldCBkaXNjb25uZWN0ZWQgPSBbXTtcclxuICAgICAgICBsZXQgbGl2ZSA9IHt9O1xyXG5cclxuICAgICAgICB1c2Vycy5mb3JFYWNoKCh1c2VyKSA9PiB7XHJcbiAgICAgICAgICBsZXQgdXNlckRpc2NvdmVyeVByb21pc2UgPSBfdGhpcy5kaXNjb3ZlcnkuZGlzY292ZXJIeXBlcnRpZXNETyh1c2VyLnVzZXIsIFsnY29tbSddLCBbJ2NoYXQnXSwgdXNlci5kb21haW4pO1xyXG4gICAgICAgICAgdXNlcnNEaXNjb3ZlcnkucHVzaCh1c2VyRGlzY292ZXJ5UHJvbWlzZSk7XHJcblxyXG4gICAgICAgICAgLy9pZiAodXNlci51c2VyLmluY2x1ZGVzKCc6Ly8nKSkgbXV0dWFsID0gZmFsc2U7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIFByb21pc2UuYWxsKHVzZXJzRGlzY292ZXJ5KS50aGVuKCh1c2VyRGlzY292ZXJ5UmVzdWx0cykgPT4ge1xyXG4gICAgICAgICAgY29uc29sZS5sb2coJ1tDaGF0TWFuYWdlci5jcmVhdGVdIFVzZXJzIERpc2NvdmVyeSBSZXN1bHRzLT4nLCB1c2VyRGlzY292ZXJ5UmVzdWx0cyk7XHJcblxyXG4gICAgICAgICAgbGV0IHNlbGVjdGVkSHlwZXJ0aWVzID0gW107XHJcblxyXG4gICAgICAgICAgdXNlckRpc2NvdmVyeVJlc3VsdHMuZm9yRWFjaCgodXNlckRpc2NvdmVyeVJlc3VsdCkgPT4ge1xyXG5cclxuICAgICAgICAgICAgdXNlckRpc2NvdmVyeVJlc3VsdC5mb3JFYWNoKChkaXNjb3ZlcmVkKT0+e1xyXG4gICAgICAgICAgICAgIGlmIChkaXNjb3ZlcmVkLmRhdGEuc3RhdHVzID09PSAnbGl2ZScpIHtcclxuICAgICAgICAgICAgICAgIHNlbGVjdGVkSHlwZXJ0aWVzLnB1c2goZGlzY292ZXJlZC5kYXRhLmh5cGVydHlJRCk7XHJcbiAgICAgICAgICAgICAgICBsaXZlW2Rpc2NvdmVyZWQuZGF0YS5oeXBlcnR5SURdID0gZGlzY292ZXJlZDtcclxuICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgLy8gVG8gY29udHJvbCB0aGUgbnVtYmVyIG9mIHN1YnNjcmlwdGlvbnMgdG8gZGlzY29ubmVjdGVkIGRldmljZXNcclxuICAgICAgICAgICAgICAgICBpZiAoZGlzY29ubmVjdGVkLmxlbmd0aCA8IDUpIHtcclxuICAgICAgICAgICAgICAgICAgICBkaXNjb25uZWN0ZWQucHVzaChkaXNjb3ZlcmVkKTtcclxuICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgfSk7XHJcblxyXG5cclxuICAgICAgICAgIC8qICAgICAgICByZXR1cm4gdXNlcnNTZWFyY2g7XHJcbiAgICAgIH0pLnRoZW4oKGh5cGVydGllc0lEcykgPT4ge1xyXG4gICAgICAgIGxldCBzZWxlY3RlZEh5cGVydGllcyA9IGh5cGVydGllc0lEcy5tYXAoKGh5cGVydHkpID0+IHtcclxuICAgICAgICAgIHJldHVybiBoeXBlcnR5Lmh5cGVydHlJRDtcclxuICAgICAgICB9KTsgKi9cclxuXHJcbiAgICAgICAgICBjb25zb2xlLmluZm8oJ1tDaGF0TWFuYWdlcl0gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSBTeW5jaGVyIENyZWF0ZSAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tIFxcbicpO1xyXG4gICAgICAgICAgY29uc29sZS5pbmZvKCdbQ2hhdE1hbmFnZXJdIFNlbGVjdGVkIEh5cGVydGllczogISEhICcsIHNlbGVjdGVkSHlwZXJ0aWVzKTtcclxuICAgICAgICAgIGNvbnNvbGUuaW5mbyhgSGF2ZSAke3NlbGVjdGVkSHlwZXJ0aWVzLmxlbmd0aH0gdXNlcnM7YCk7XHJcbiAgICAgICAgICBsZXQgbXV0dWFsID0gZXh0cmEubXV0dWFsID8gZXh0cmEubXV0dWFsIDogdHJ1ZTtcclxuXHJcbiAgICAgICAgICBsZXQgaW5wdXQgPSBPYmplY3QuYXNzaWduKHtyZXNvdXJjZXM6IFsnY2hhdCddLCBtdXR1YWw6IG11dHVhbH0sIGV4dHJhKTtcclxuICAgICAgICAgIGRlbGV0ZSBpbnB1dC5uYW1lO1xyXG5cclxuICAgICAgICAgIGlmIChfdGhpcy5vZmZsaW5lKSBpbnB1dC5vZmZsaW5lID0gX3RoaXMub2ZmbGluZTtcclxuXHJcbiAgICAgICAgICBjb25zb2xlLmluZm8oJ1tDaGF0TWFuYWdlcl0gaW5wdXQgZGF0YTonLCBpbnB1dCk7XHJcbiAgICAgICAgICByZXR1cm4gc3luY2hlci5jcmVhdGUoX3RoaXMuX29iamVjdERlc2NVUkwsIHNlbGVjdGVkSHlwZXJ0aWVzLCBfdGhpcy5jb21tdW5pY2F0aW9uT2JqZWN0LCB0cnVlLCBmYWxzZSwgbmFtZSwge30sIGlucHV0KTtcclxuICAgICAgICB9KS50aGVuKGZ1bmN0aW9uKGRhdGFPYmplY3RSZXBvcnRlcikge1xyXG5cclxuICAgICAgICAgIGNvbnNvbGUuaW5mbygnW0NoYXRNYW5hZ2VyXSAzLiBSZXR1cm4gQ3JlYXRlIERhdGEgT2JqZWN0IFJlcG9ydGVyJywgZGF0YU9iamVjdFJlcG9ydGVyKTtcclxuXHJcbiAgICAgICAgICBsZXQgY2hhdENvbnRyb2xsZXIgPSBuZXcgQ2hhdENvbnRyb2xsZXIoc3luY2hlciwgX3RoaXMuZGlzY292ZXJ5LCBfdGhpcy5fZG9tYWluLCBfdGhpcy5zZWFyY2gsIG15SWRlbnRpdHksIF90aGlzKTtcclxuICAgICAgICAgIGNoYXRDb250cm9sbGVyLmRhdGFPYmplY3RSZXBvcnRlciA9IGRhdGFPYmplY3RSZXBvcnRlcjtcclxuXHJcbiAgICAgICAgICBfdGhpcy5fcmVwb3J0ZXJzQ29udHJvbGxlcnNbZGF0YU9iamVjdFJlcG9ydGVyLnVybF0gPSBjaGF0Q29udHJvbGxlcjtcclxuXHJcbiAgICAgICAgICBjb25zb2xlLmxvZygnW0NoYXRNYW5hZ2VyXSBjaGF0Q29udHJvbGxlciBpbnZpdGF0aW9uc0hhbmRsZXI6ICcsICAgY2hhdENvbnRyb2xsZXIuaW52aXRhdGlvbnNIYW5kbGVyKTtcclxuXHJcbiAgICAgICAgICAvLyBwcm9jZXNzIGludml0YXRpb25zIHRvIGhhbmRsZSBub3QgcmVjZWl2ZWQgaW52aXRhdGlvbnNcclxuICAgICAgICAgIGlmIChkYXRhT2JqZWN0UmVwb3J0ZXIuaW52aXRhdGlvbnMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICBjaGF0Q29udHJvbGxlci5pbnZpdGF0aW9uc0hhbmRsZXIucHJvY2Vzc0ludml0YXRpb25zKGxpdmUsIGRhdGFPYmplY3RSZXBvcnRlcik7XHJcbiAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgLy8gSWYgYW55IGludml0ZWQgVXNlciBpcyBkaXNjb25uZWN0ZWQgbGV0J3Mgd2FpdCB1bnRpbCBpdCBpcyBjb25uZWN0ZWQgYWdhaW5cclxuICAgICAgICAgIGlmIChkaXNjb25uZWN0ZWQubGVuZ3RoID4gMCkgY2hhdENvbnRyb2xsZXIuaW52aXRhdGlvbnNIYW5kbGVyLmludml0ZURpc2Nvbm5lY3RlZEh5cGVydGllcyhkaXNjb25uZWN0ZWQsIGRhdGFPYmplY3RSZXBvcnRlcik7XHJcblxyXG4gICAgICAgICAgcmVzb2x2ZShjaGF0Q29udHJvbGxlcik7XHJcblxyXG4gICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uKHJlYXNvbikge1xyXG4gICAgICAgICAgcmVqZWN0KHJlYXNvbik7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICB9KS5jYXRjaCgocmVhc29uKSA9PiB7XHJcbiAgICAgICAgY29uc29sZS5sb2coJ1tDaGF0TWFuYWdlci5jcmVhdGVdIE15SWRlbnRpdHkgRXJyb3I6JywgcmVhc29uKTtcclxuICAgICAgICByZXR1cm4gcmVqZWN0KHJlYXNvbik7XHJcbiAgICAgIH0pO1xyXG4gICAgfSk7XHJcblxyXG4gIH1cclxuXHJcblxyXG4gIC8qKlxyXG4gICAqIFRoaXMgZnVuY3Rpb24gaXMgdXNlZCB0byBoYW5kbGUgbm90aWZpY2F0aW9ucyBhYm91dCBpbmNvbWluZyBpbnZpdGF0aW9ucyB0byBqb2luIGEgR3JvdXAgQ2hhdC5cclxuICAgKiBAcGFyYW0gIHtGdW5jdGlvbn0gQ3JlYXRlRXZlbnQgVGhlIENyZWF0ZUV2ZW50IGZpcmVkIGJ5IHRoZSBTeW5jaGVyIHdoZW4gYW4gaW52aXRhaW9uIGlzIHJlY2VpdmVkXHJcbiAgICovXHJcbiAgb25JbnZpdGF0aW9uKGNhbGxiYWNrKSB7XHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG4gICAgX3RoaXMuX29uSW52aXRhdGlvbiA9IGNhbGxiYWNrO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogVGhpcyBmdW5jdGlvbiBpcyB1c2VkIHRvIGpvaW4gYSBHcm91cCBDaGF0LlxyXG4gICAqIEBwYXJhbSAge1VSTC5Db21tdW5pY2F0aW9uVVJMfSBpbnZpdGF0aW9uVVJMICBUaGUgQ29tbXVuaWNhdGlvbiBVUkwgb2YgdGhlIEdyb3VwIENoYXQgdG8gam9pbiB0aGF0IGlzIHByb3ZpZGVkIGluIHRoZSBpbnZpdGF0aW9uIGV2ZW50XHJcbiAgICogQHJldHVybiB7PFByb21pc2U+Q2hhdENvbnRyb2xsZXJ9ICAgICAgICAgICAgIEl0IHJldHVybnMgdGhlIENoYXRDb250cm9sbGVyIG9iamVjdCBhcyBhIFByb21pc2VcclxuICAgKi9cclxuICBqb2luKGludml0YXRpb25VUkwsIG11dHVhbCA9IHRydWUsIGlkZW50aXR5KSB7XHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG5cclxuICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgbGV0IHN5bmNoZXIgPSBfdGhpcy5fc3luY2hlcjtcclxuICAgICAgbGV0IG15SWRlbnRpdHk7XHJcblxyXG4gICAgICBjb25zb2xlLmluZm8oJ1tDaGF0TWFuYWdlcl0gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tIFN5bmNoZXIgc3Vic2NyaWJlIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gXFxuJyk7XHJcbiAgICAgIGNvbnNvbGUuaW5mbygnaW52aXRhdGlvblVSTCcsIGludml0YXRpb25VUkwpO1xyXG4gICAgICBfdGhpcy5teUlkZW50aXR5KGlkZW50aXR5KS50aGVuKChpZGVudGl0eSkgPT4ge1xyXG4gICAgICAgIG15SWRlbnRpdHkgPSBpZGVudGl0eTtcclxuICAgICAgICBsZXQgaW5wdXQgPSB7XHJcbiAgICAgICAgICBzY2hlbWE6IF90aGlzLl9vYmplY3REZXNjVVJMLFxyXG4gICAgICAgICAgcmVzb3VyY2U6IGludml0YXRpb25VUkwsXHJcbiAgICAgICAgICBzdG9yZTogdHJ1ZSxcclxuICAgICAgICAgIHAycDogZmFsc2UsXHJcbiAgICAgICAgICBtdXR1YWw6IG11dHVhbCxcclxuICAgICAgICAgIGRvbWFpbl9zdWJzY3JpcHRpb246IHRydWUsXHJcbiAgICAgICAgICBpZGVudGl0eTogaWRlbnRpdHlcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBpZiAoX3RoaXMub2ZmbGluZSkgaW5wdXQub2ZmbGluZSA9IF90aGlzLm9mZmxpbmU7XHJcblxyXG4gICAgICAgIHJldHVybiBzeW5jaGVyLnN1YnNjcmliZShpbnB1dCk7XHJcblxyXG4gICAgICB9KS50aGVuKGZ1bmN0aW9uKGRhdGFPYmplY3RPYnNlcnZlcikge1xyXG4gICAgICAgIGNvbnNvbGUuaW5mbygnRGF0YSBPYmplY3QgT2JzZXJ2ZXI6ICcsIGRhdGFPYmplY3RPYnNlcnZlcik7XHJcblxyXG4gICAgICAgIGxldCBjaGF0Q29udHJvbGxlciA9IG5ldyBDaGF0Q29udHJvbGxlcihzeW5jaGVyLCBfdGhpcy5kaXNjb3ZlcnksIF90aGlzLl9kb21haW4sIF90aGlzLnNlYXJjaCwgbXlJZGVudGl0eSwgX3RoaXMpO1xyXG4gICAgICAgIHJlc29sdmUoY2hhdENvbnRyb2xsZXIpO1xyXG5cclxuICAgICAgICBjaGF0Q29udHJvbGxlci5kYXRhT2JqZWN0T2JzZXJ2ZXIgPSBkYXRhT2JqZWN0T2JzZXJ2ZXI7XHJcblxyXG4gICAgICAgIF90aGlzLl9vYnNlcnZlcnNDb250cm9sbGVyc1tkYXRhT2JqZWN0T2JzZXJ2ZXIudXJsXSA9IGNoYXRDb250cm9sbGVyO1xyXG5cclxuICAgICAgfSkuY2F0Y2goZnVuY3Rpb24ocmVhc29uKSB7XHJcbiAgICAgICAgcmVqZWN0KHJlYXNvbik7XHJcbiAgICAgIH0pO1xyXG4gICAgfSk7XHJcblxyXG4gIH1cclxuXHJcbn1cclxuXHJcbmV4cG9ydCBkZWZhdWx0IENoYXRNYW5hZ2VyO1xyXG4iLCIvKipcclxuKiBDb3B5cmlnaHQgMjAxNiBQVCBJbm92YcOnw6NvIGUgU2lzdGVtYXMgU0FcclxuKiBDb3B5cmlnaHQgMjAxNiBJTkVTQy1JRFxyXG4qIENvcHlyaWdodCAyMDE2IFFVT0JJUyBORVRXT1JLUyBTTFxyXG4qIENvcHlyaWdodCAyMDE2IEZSQVVOSE9GRVItR0VTRUxMU0NIQUZUIFpVUiBGT0VSREVSVU5HIERFUiBBTkdFV0FORFRFTiBGT1JTQ0hVTkcgRS5WXHJcbiogQ29weXJpZ2h0IDIwMTYgT1JBTkdFIFNBXHJcbiogQ29weXJpZ2h0IDIwMTYgRGV1dHNjaGUgVGVsZWtvbSBBR1xyXG4qIENvcHlyaWdodCAyMDE2IEFwaXplZVxyXG4qIENvcHlyaWdodCAyMDE2IFRFQ0hOSVNDSEUgVU5JVkVSU0lUQVQgQkVSTElOXHJcbipcclxuKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4qIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuKlxyXG4qICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbipcclxuKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4qIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4qIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuKiovXHJcblxyXG4vKipcclxuKiBUaGUgR3JvdXAgQ2hhdCBBUEkgaXMgdXNlZCB0byBjb250cm9sIGEgR3JvdXAgQ2hhdCBpbnN0YW5jZS5cclxuKiBAYXV0aG9yIFZpdG9yIFNpbHZhIFt2aXRvci10LXNpbHZhQHRlbGVjb20ucHRdXHJcbiogQHZlcnNpb24gMC4xLjBcclxuKi9cclxuXHJcbi8vaW1wb3J0IHsgVXNlckluZm8gfSBmcm9tICcuL1VzZXJJbmZvJztcclxuLy9pbXBvcnQgUmVnaXN0cmF0aW9uU3RhdHVzIGZyb20gJy4uL2Rpc2NvdmVyeS9SZWdpc3RyYXRpb25TdGF0dXMnO1xyXG4vL2ltcG9ydCBJbnZpdGF0aW9uc0hhbmRsZXIgZnJvbSAnLi9JbnZpdGF0aW9uc0hhbmRsZXInO1xyXG5cclxuY2xhc3MgQ2hhdCB7XHJcblxyXG4gIGNvbnN0cnVjdG9yKHN5bmNoZXIsIGRvbWFpbiwgaWRlbnRpdHksIG1hbmFnZXIpIHtcclxuXHJcbiAgICBpZiAoIXN5bmNoZXIpIHRocm93IEVycm9yKCdTeW5jaGVyIGlzIGEgbmVjZXNzYXJ5IGRlcGVuZGVjeScpO1xyXG4vLyAgICBpZiAoIWRpc2NvdmVyeSkgdGhyb3cgRXJyb3IoJ0Rpc2NvdmVyIGlzIGEgbmVjZXNzYXJ5IGRlcGVuZGVjeScpO1xyXG4gICAgaWYgKCFkb21haW4pIHRocm93IEVycm9yKCdEb21haW4gaXMgYSBuZWNlc3NhcnkgZGVwZW5kZWN5Jyk7XHJcbi8vICAgIGlmICghc2VhcmNoKSB0aHJvdyBFcnJvcignU2VhcmNoIGlzIGEgbmVjZXNzYXJ5IGRlcGVuZGVjeScpO1xyXG5cclxuICAgIGxldCBfdGhpcyA9IHRoaXM7XHJcbiAgICBfdGhpcy5fc3luY2hlciA9IHN5bmNoZXI7XHJcbi8vICAgIF90aGlzLmRpc2NvdmVyeSA9IGRpc2NvdmVyeTtcclxuLy8gICAgX3RoaXMuc2VhcmNoID0gc2VhcmNoO1xyXG4gICAgX3RoaXMubXlJZGVudGl0eSA9IGlkZW50aXR5O1xyXG4gICAgX3RoaXMuY29udHJvbGxlck1vZGUgPSAncmVwb3J0ZXInO1xyXG4gICAgX3RoaXMuY2hpbGRfY3NlcSA9IDA7XHJcbiAgICBfdGhpcy5kb21haW4gPSBkb21haW47XHJcblxyXG4gICAgX3RoaXMuX21hbmFnZXIgPSBtYW5hZ2VyO1xyXG5cclxuICAgIGNvbnN0IGh5cGVydHlVUkwgPSBzeW5jaGVyLm93bmVyO1xyXG5cclxuICAgIF90aGlzLl9vYmplY3REZXNjVVJMID0gJ2h5cGVydHktY2F0YWxvZ3VlOi8vY2F0YWxvZ3VlLicgKyBkb21haW4gKyAnLy53ZWxsLWtub3duL2RhdGFzY2hlbWEvQ29tbXVuaWNhdGlvbic7XHJcblxyXG4vLyAgICBfdGhpcy5faW52aXRhdGlvbnNIYW5kbGVyID0gbmV3IEludml0YXRpb25zSGFuZGxlcihoeXBlcnR5VVJMKTtcclxuXHJcbiAgfVxyXG5cclxuLyogIGdldCBpbnZpdGF0aW9uc0hhbmRsZXIoKSB7XHJcbiAgICByZXR1cm4gdGhpcy5faW52aXRhdGlvbnNIYW5kbGVyO1xyXG4gIH0qL1xyXG5cclxuICBnZXQgdXJsKCkge1xyXG4gICAgcmV0dXJuIHRoaXMuY29udHJvbGxlck1vZGUgPT09ICdyZXBvcnRlcicgPyB0aGlzLmRhdGFPYmplY3RSZXBvcnRlci51cmwgOiB0aGlzLmRhdGFPYmplY3RPYnNlcnZlci51cmw7XHJcbiAgfVxyXG5cclxuICBzZXQgZGF0YU9iamVjdFJlcG9ydGVyKGRhdGFPYmplY3RSZXBvcnRlcikge1xyXG5cclxuICAgIGlmICghZGF0YU9iamVjdFJlcG9ydGVyKSB0aHJvdyBuZXcgRXJyb3IoJ1tDaGF0Q29udHJvbGxlcl0gVGhlIGRhdGEgb2JqZWN0IHJlcG9ydGVyIGlzIG5lY2Vzc2FyeSBwYXJhbWV0ZXIgJyk7XHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG5cclxuXHJcbiAgICBfdGhpcy5jb250cm9sbGVyTW9kZSA9ICdyZXBvcnRlcic7XHJcblxyXG4gICAgLy8gSGFuZGxlciB0byBwcm9jZXNzIHJlY2VpdmVkIGZpbGVzXHJcblxyXG4gICAgLy8gZGF0YU9iamVjdFJlcG9ydGVyLm9uUmVzcG9uc2UoZnVuY3Rpb24oZXZlbnQpIHtcclxuICAgIC8vICAgY29uc29sZS5sb2coJ1tEYXRhT2JqZWN0UmVwb3J0ZXIgLSBvblJlc3BvbnNlXScsIGV2ZW50KTtcclxuICAgIC8vICAgaWYgKF90aGlzLl9vbkludml0YXRpb25SZXNwb25zZSkge1xyXG4gICAgLy8gICAgIF90aGlzLl9vbkludml0YXRpb25SZXNwb25zZShldmVudCk7XHJcbiAgICAvLyAgIH1cclxuICAgIC8vXHJcbiAgICAvLyB9KTtcclxuXHJcbiAgICBkYXRhT2JqZWN0UmVwb3J0ZXIub25TdWJzY3JpcHRpb24oZnVuY3Rpb24oZXZlbnQpIHtcclxuXHJcbiAgICAgIHN3aXRjaCAoZXZlbnQudHlwZSkge1xyXG4gICAgICAgIGNhc2UgJ3N1YnNjcmliZSc6IF90aGlzLl9vblN1YnNjcmliZShldmVudCk7IGJyZWFrO1xyXG4gICAgICAgIGNhc2UgJ3Vuc3Vic2NyaWJlJzogX3RoaXMuX29uVW5zdWJzY3JpYmUoZXZlbnQpOyBicmVhaztcclxuICAgICAgfVxyXG4gICAgfSk7XHJcblxyXG4gICAgX3RoaXMuX3NldE9uQWRkQ2hpbGRMaXN0ZW5lcihkYXRhT2JqZWN0UmVwb3J0ZXIpO1xyXG5cclxuICAgIGRhdGFPYmplY3RSZXBvcnRlci5vblJlYWQoKGV2ZW50KSA9PiB7XHJcbiAgICAgIGV2ZW50LmFjY2VwdCgpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgZGF0YU9iamVjdFJlcG9ydGVyLm9uRXhlY3V0ZSgoZXZlbnQpID0+IHtcclxuICAgICAgc3dpdGNoIChldmVudC5tZXRob2QpIHtcclxuICAgICAgICBjYXNlICdhZGRVc2VyJzpcclxuICAgICAgICAgIF90aGlzLmFkZFVzZXIoZXZlbnQucGFyYW1zWzBdKS50aGVuKCgpID0+IHtcclxuICAgICAgICAgICAgZXZlbnQuYWNjZXB0KCk7XHJcbiAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbihyZWFzb24pIHtcclxuICAgICAgICAgICAgY29uc29sZS5lcnJvcignUmVhc29uOicsIHJlYXNvbik7XHJcbiAgICAgICAgICAgIGV2ZW50LnJlamVjdChyZWFzb24pO1xyXG4gICAgICAgICAgfSk7XHJcbiAgICAgICAgICBicmVhaztcclxuICAgICAgICAgIGNhc2UgJ3JlbW92ZVVzZXInOlxyXG4gICAgICAgICAgICBfdGhpcy5yZW1vdmVVc2VyKGV2ZW50LnBhcmFtcykudGhlbigoKSA9PiB7XHJcbiAgICAgICAgICAgICAgZXZlbnQuYWNjZXB0KCk7XHJcbiAgICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uKHJlYXNvbikge1xyXG4gICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ1JlYXNvbjonLCByZWFzb24pO1xyXG4gICAgICAgICAgICAgIGV2ZW50LnJlamVjdChyZWFzb24pO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgZGVmYXVsdDogZXZlbnQucmVqZWN0KCdbQ2hhdENvbnRyb2xsZXIub25FeGVjdXRlXSBDaGF0IG1ldGhvZCBleGVjdXRpb24gbm90IGFjY2VwdGVkIGJ5IFJlcG9ydGVyJyk7XHJcbiAgICAgICAgICBicmVhaztcclxuICAgICAgfVxyXG4gICAgfSk7XHJcblxyXG4gICAgX3RoaXMuX2RhdGFPYmplY3RSZXBvcnRlciA9IGRhdGFPYmplY3RSZXBvcnRlcjtcclxuXHJcbiAgfVxyXG5cclxuICBnZXQgZGF0YU9iamVjdFJlcG9ydGVyKCkge1xyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuICAgIHJldHVybiBfdGhpcy5fZGF0YU9iamVjdFJlcG9ydGVyO1xyXG4gIH1cclxuXHJcbiAgZ2V0IG1lc3NhZ2VzKCkge1xyXG5cclxuICAgIHJldHVybiB0aGlzLmNvbnRyb2xsZXJNb2RlID09PSAncmVwb3J0ZXInID8gdGhpcy5fZGF0YU9iamVjdFJlcG9ydGVyLl9jaGlsZHJlbk9iamVjdHMgOiB0aGlzLl9kYXRhT2JqZWN0T2JzZXJ2ZXIuX2NoaWxkcmVuT2JqZWN0cztcclxuICB9XHJcblxyXG4gIHNldCBkYXRhT2JqZWN0T2JzZXJ2ZXIoZGF0YU9iamVjdE9ic2VydmVyKSB7XHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG5cclxuICAgIF90aGlzLmNvbnRyb2xsZXJNb2RlID0gJ29ic2VydmVyJztcclxuXHJcbiAgICBfdGhpcy5fZGF0YU9iamVjdE9ic2VydmVyID0gZGF0YU9iamVjdE9ic2VydmVyO1xyXG5cclxuICAgIGRhdGFPYmplY3RPYnNlcnZlci5vbkNoYW5nZSgnKicsIGZ1bmN0aW9uKGV2ZW50KSB7XHJcbiAgICAgIGNvbnNvbGUuaW5mbygnW0NoYXRNYW5hZ2VyLkNoYXRDb250cm9sbGVyXU9ic2VydmVyIC0gb25DaGFuZ2UnLCBldmVudCk7XHJcblxyXG4gICAgICBpZiAoZXZlbnQuZmllbGQuaW5jbHVkZXMoJ3BhcnRpY2lwYW50cycpKSB7XHJcbiAgICAgICAgc3dpdGNoIChldmVudC5jVHlwZSkge1xyXG4gICAgICAgICAgY2FzZSAnYWRkJzpcclxuICAgICAgICAgICAgaWYgKF90aGlzLl9vblVzZXJBZGRlZCkgX3RoaXMuX29uVXNlckFkZGVkKGV2ZW50KTtcclxuICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgICAgY2FzZSAncmVtb3ZlJzpcclxuICAgICAgICAgICAgaWYgKF90aGlzLl9vblVzZXJSZW1vdmVkKSBfdGhpcy5fb25Vc2VyUmVtb3ZlZChldmVudCk7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG5cclxuICAgICAgaWYgKF90aGlzLl9vbkNoYW5nZSkgX3RoaXMuX29uQ2hhbmdlKGV2ZW50KTtcclxuXHJcbiAgICB9KTtcclxuXHJcbiAgICBfdGhpcy5fc2V0T25BZGRDaGlsZExpc3RlbmVyKGRhdGFPYmplY3RPYnNlcnZlcik7XHJcblxyXG4gICAgLy8gbGV0IGNoaWxkcmVucyA9IGRhdGFPYmplY3RPYnNlcnZlci5jaGlsZHJlbnM7XHJcbiAgICAvLyBPYmplY3Qua2V5cyhjaGlsZHJlbnMpLmZvckVhY2goKGNoaWxkKSA9PiB7XHJcbiAgICAvLyAgIGlmIChfdGhpcy5fb25NZXNzYWdlKSBfdGhpcy5fb25NZXNzYWdlKHtcclxuICAgIC8vICAgICBjaGlsZElkOiBjaGlsZCxcclxuICAgIC8vICAgICBpZGVudGl0eTogY2hpbGRyZW5zW2NoaWxkXS5pZGVudGl0eSxcclxuICAgIC8vICAgICB2YWx1ZTogY2hpbGRyZW5zW2NoaWxkXS5kYXRhXHJcbiAgICAvLyAgIH0pO1xyXG4gICAgLy8gfSlcclxuXHJcbiAgfVxyXG5cclxuICBnZXQgZGF0YU9iamVjdE9ic2VydmVyKCkge1xyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuICAgIHJldHVybiBfdGhpcy5fZGF0YU9iamVjdE9ic2VydmVyO1xyXG4gIH1cclxuXHJcbiAgX3NldE9uQWRkQ2hpbGRMaXN0ZW5lcihkYXRhT2JqZWN0KSB7XHJcblxyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuXHJcbiAgICBkYXRhT2JqZWN0Lm9uQWRkQ2hpbGQoZnVuY3Rpb24oY2hpbGQpIHtcclxuICAgICAgX3RoaXMuY2hpbGRfY3NlcSArPTE7XHJcbiAgICAgIGNvbnNvbGUuaW5mbygnW0NoYXRNYW5hZ2VyLkNoYXRDb250cm9sbGVyLl9zZXRPbkFkZENoaWxkTGlzdGVuZXJdIG5ldyBDaGlsZCByZWNlaXZlZDogJywgY2hpbGQpO1xyXG5cclxuICAgICAgaWYgKF90aGlzLl9vbk1lc3NhZ2UpIF90aGlzLl9vbk1lc3NhZ2UoY2hpbGQpO1xyXG4gICAgfSk7XHJcblxyXG4gIH1cclxuXHJcblxyXG4gIGdldCBkYXRhT2JqZWN0KCkge1xyXG4gICAgcmV0dXJuIHRoaXMuY29udHJvbGxlck1vZGUgPT09ICdyZXBvcnRlcicgPyB0aGlzLmRhdGFPYmplY3RSZXBvcnRlciA6IHRoaXMuZGF0YU9iamVjdE9ic2VydmVyO1xyXG4gIH1cclxuXHJcbiAgc2V0IGNsb3NlRXZlbnQoZXZlbnQpIHtcclxuICAgIGxldCBfdGhpcyA9IHRoaXM7XHJcbiAgICBfdGhpcy5fY2xvc2VFdmVudCA9IGV2ZW50O1xyXG5cclxuICAgIGlmIChfdGhpcy5fb25DbG9zZSkgX3RoaXMuX29uQ2xvc2UoZXZlbnQpO1xyXG4gIH1cclxuXHJcbiAgZ2V0IGNsb3NlRXZlbnQoKSB7XHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG4gICAgcmV0dXJuIF90aGlzLl9jbG9zZUV2ZW50O1xyXG4gIH1cclxuXHJcblxyXG5cclxuICBfb25TdWJzY3JpYmUoZXZlbnQpIHtcclxuXHJcbiAgICBsZXQgZGF0YU9iamVjdFJlcG9ydGVyID0gdGhpcy5fZGF0YU9iamVjdFJlcG9ydGVyO1xyXG5cclxuICAgIGV2ZW50LmFjY2VwdCgpO1xyXG5cclxuXHJcbiAgICBjb25zb2xlLmxvZygnW0NoYXRNYW5hZ2VyLkNoYXRDb250cm9sbGVyLm9uU3Vic2NyaWJlXSBldmVudCcsIGV2ZW50LCBkYXRhT2JqZWN0UmVwb3J0ZXIudXJsKTtcclxuICAgIGNvbnNvbGUubG9nKCdbQ2hhdE1hbmFnZXIuQ2hhdENvbnRyb2xsZXIub25TdWJzY3JpYmVdIE5ldyB1c2VyIGhhcyBzdWJzY3JpYmUgdGhpcyBvYmplY3Q6ICcsIGRhdGFPYmplY3RSZXBvcnRlci5kYXRhLCBldmVudC5pZGVudGl0eSk7XHJcblxyXG4gICAgbGV0IGlkZW50aXR5ID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShldmVudC5pZGVudGl0eSkpO1xyXG5cclxuICAgIGlmIChpZGVudGl0eS5oYXNPd25Qcm9wZXJ0eSgnYXNzZXJ0aW9uJykpIHtcclxuICAgICAgZGVsZXRlIGlkZW50aXR5LmFzc2VydGlvblxyXG4gICAgfVxyXG5cclxuICAgIGxldCB1c2VySW5mbyA9IHtcclxuICAgICAgaHlwZXJ0eVVSTDogZXZlbnQudXJsLFxyXG4gICAgICBkb21haW46IGV2ZW50LmRvbWFpbixcclxuICAgICAgaWRlbnRpdHk6IGlkZW50aXR5XHJcbiAgICB9XHJcbiAgICBsZXQgdXNlclVSTCA9IGV2ZW50LmlkZW50aXR5LnVzZXJQcm9maWxlLmd1aWQ7XHJcblxyXG4gICAgY29uc29sZS5sb2coJ1tDaGF0TWFuYWdlci5DaGF0Q29udHJvbGxlci5vblN1YnNjcmliZV0gIG5ldyBwYXJ0aWNpcGFudCcsIHVzZXJJbmZvKTtcclxuICAgIGlmIChldmVudC5pZGVudGl0eS5sZWdhY3kpIHtcclxuICAgICB1c2VySW5mby5sZWdhY3kgPSBldmVudC5pZGVudGl0eS5sZWdhY3k7XHJcbiAgICB9XHJcblxyXG4gICAgZGF0YU9iamVjdFJlcG9ydGVyLmRhdGEucGFydGljaXBhbnRzW3VzZXJVUkxdID0gdXNlckluZm87XHJcblxyXG4gICAgY29uc29sZS5sb2coJ1tDaGF0TWFuYWdlci5DaGF0Q29udHJvbGxlci5vblN1YnNjcmliZV0gY29tbXVuaWNhdGlvbk9iamVjdCBPQkogY2hhdGNvbnRyb2xsZXInLCBkYXRhT2JqZWN0UmVwb3J0ZXIuZGF0YS5wYXJ0aWNpcGFudHMpO1xyXG4gICAgY29uc29sZS5sb2coJ1tDaGF0TWFuYWdlci5DaGF0Q29udHJvbGxlci5vblN1YnNjcmliZSAtIG9uU3Vic2NyaXB0aW9uXSAnLCB1c2VySW5mbyk7XHJcbiAgICAvLyBjb25zb2xlLmxvZygnW0NoYXRNYW5hZ2VyLkNoYXRDb250cm9sbGVyLm9uU3Vic2NyaWJlIC0gdGhpcy5fb25Vc2VyQWRkZWRdICcsIHRoaXMuX29uVXNlckFkZGVkKTtcclxuXHJcbiAgICBpZiAodGhpcy5fb25Vc2VyQWRkZWQpIHRoaXMuX29uVXNlckFkZGVkKHVzZXJJbmZvKTtcclxuICB9XHJcblxyXG4gIF9vblVuc3Vic2NyaWJlKGV2ZW50KSB7XHJcbiAgICBsZXQgZGF0YU9iamVjdFJlcG9ydGVyID0gdGhpcy5fZGF0YU9iamVjdFJlcG9ydGVyO1xyXG5cclxuICAgIGNvbnNvbGUubG9nKCdbQ2hhdE1hbmFnZXIuQ2hhdENvbnRyb2xsZXIub25VbnN1YnNjcmliZV0gZXZlbnQnLCBldmVudCwgZGF0YU9iamVjdFJlcG9ydGVyLnVybCk7XHJcblxyXG4gICAgbGV0IHBhcnRpY2lwYW50ID0gZXZlbnQuaWRlbnRpdHkudXNlclByb2ZpbGU7XHJcblxyXG4gICAgY29uc29sZS5sb2coJ1tDaGF0TWFuYWdlci5DaGF0Q29udHJvbGxlci5vblVuc3Vic2NyaWJlXSAgcGFydGljaXBhbnQgbGVmdCcsIHBhcnRpY2lwYW50KTtcclxuICAgIGlmIChldmVudC5pZGVudGl0eS5sZWdhY3kpIHtcclxuICAgICAgcGFydGljaXBhbnQubGVnYWN5ID0gZXZlbnQuaWRlbnRpdHkubGVnYWN5O1xyXG4gICAgfVxyXG5cclxuICAgIGRlbGV0ZSBkYXRhT2JqZWN0UmVwb3J0ZXIuZGF0YS5wYXJ0aWNpcGFudHNbcGFydGljaXBhbnQudXNlclVSTF07XHJcblxyXG4gICAgY29uc29sZS5sb2coJ1tDaGF0TWFuYWdlci5DaGF0Q29udHJvbGxlci5vblVuc3Vic2NyaWJlIC0gdGhpcy5fb25Vc2VyUmVtb3ZlZF0gJywgdGhpcy5vblVzZXJSZW1vdmVkKTtcclxuICAgIGlmICh0aGlzLl9vblVzZXJSZW1vdmVkKSB0aGlzLl9vblVzZXJSZW1vdmVkKHBhcnRpY2lwYW50KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFRoaXMgZnVuY3Rpb24gaXMgdXNlZCB0byBzZW5kIGEgZmlsZS5cclxuICAgKiBAcGFyYW0gIHtzdHJpbmd9ICAgICBmaWxlICAgICAgICAgICAgICAgICAgICAgICAgSXMgdGhlIGZpbGUgdG8gYmUgc2VudC5cclxuICAgKiBAcmV0dXJuIHtQcm9taXNlPENvbW11bmljYXRpb24uQ2hhdE1lc3NhZ2U+fSAgICAgICAgSXQgcmV0dXJucyB0aGUgQ2hhdE1lc3NhZ2UgY2hpbGQgb2JqZWN0IGNyZWF0ZWQgYnkgdGhlIFN5bmNoZXIgYXMgYSBQcm9taXNlLlxyXG4gICAqL1xyXG4gIHNlbmRGaWxlKGZpbGUpIHtcclxuXHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG4gICAgbGV0IG1vZGUgPSBfdGhpcy5jb250cm9sbGVyTW9kZTtcclxuICAgIGxldCBkYXRhT2JqZWN0ID0gbW9kZSA9PT0gJ3JlcG9ydGVyJyA/IF90aGlzLmRhdGFPYmplY3RSZXBvcnRlciA6IF90aGlzLmRhdGFPYmplY3RPYnNlcnZlcjtcclxuXHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcblxyXG4gICAgICBsZXQgaWRlbnRpdHkgPSB7XHJcbiAgICAgICAgdXNlclByb2ZpbGU6IF90aGlzLm15SWRlbnRpdHlcclxuICAgICAgfTtcclxuXHJcbiAgICAgIGRhdGFPYmplY3QuYWRkSHlwZXJ0eVJlc291cmNlKCdyZXNvdXJjZXMnLCAnZmlsZScsICBmaWxlLCBpZGVudGl0eSkudGhlbihmdW5jdGlvbihyZXNvdXJjZUZpbGUpIHtcclxuXHJcbiAgICAgICAgICBsZXQgaWRlbnRpdHkgPSB7XHJcbiAgICAgICAgICAgICAgdXNlclByb2ZpbGU6IF90aGlzLm15SWRlbnRpdHlcclxuICAgICAgICAgIH07XHJcbiAgICAgICAgICBsZXQgZmlsZVNlbnRFdnQgPSB7IHZhbHVlIDogcmVzb3VyY2VGaWxlLCBpZGVudGl0eTogaWRlbnRpdHksIHJlc291cmNlOiByZXNvdXJjZUZpbGV9O1xyXG5cclxuLyogICAgICAgICAgbGV0IHJlcG9ydGVyU3RhdHVzID0gbmV3IFJlZ2lzdHJhdGlvblN0YXR1cyhkYXRhT2JqZWN0LnVybCwgX3RoaXMuX21hbmFnZXIuX3J1bnRpbWVVUkwsIF90aGlzLl9tYW5hZ2VyLl9oeXBlcnR5VVJMLCBfdGhpcy5fbWFuYWdlci5fYnVzICk7XHJcblxyXG4gICAgICAgICAgLy8gcmVjdXJzaXZlIGZ1bmN0aW9uIHRvIHN5bmMgd2l0aCBjaGF0IHJlcG9ydGVyXHJcblxyXG4gICAgICAgICAgICBsZXQgc2hhcmUyUmVwb3J0ZXIgPSBmdW5jdGlvbihmaWxlLCBzdWJzY3JpYmVyLCBldnQsIHN0YXR1cykge1xyXG4gICAgICAgICAgICAgIGxldCBzdGF0dXNPZlJlcG9ydGVyID0gc3RhdHVzO1xyXG4gICAgICAgICAgICAgIGZpbGUuc2hhcmluZ1N0YXR1cy50aGVuKHJlc29sdmUoZXZ0KSkuY2F0Y2goKHJlc3VsdCk9PntcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdbQ2hhdE1hbmFnZXIuQ2hhdENvbnRyb2xsZXIuc2VuZEZpbGVdIHNoYXJlIGZhaWxlZDogJywgcmVzdWx0KTtcclxuXHJcbiAgICAgICAgICAgICAgICBzdGF0dXNPZlJlcG9ydGVyLm9uTGl2ZSggc3Vic2NyaWJlciwgKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgc3RhdHVzT2ZSZXBvcnRlci51bnN1YnNjcmliZUxpdmUoc3Vic2NyaWJlcik7XHJcbiAgICAgICAgICAgICAgICBmaWxlLnNoYXJlKHRydWUpO1xyXG4gICAgICAgICAgICAgICAgc2hhcmUyUmVwb3J0ZXIoZmlsZSwgc3Vic2NyaWJlciwgZXZ0LCBzdGF0dXNPZlJlcG9ydGVyKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAvL1RPRE86IHN1YnNjcmliZSB0byBzeW5jIHdoZW4gcmVwb3J0ZXIgaXMgbGl2ZS4gTmV3IHN5bmNoZWQgbWVzc2FnZXMgc2hvdWxkIHRyaWdnZXIgb25NZXNzYWdlIGllIG9uQ2hpbGRcclxuICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSovXHJcblxyXG4vLyAgICAgICAgICAgIHJlc291cmNlRmlsZS5zaGFyZSh0cnVlKS50aGVuKCgpPT57XHJcbiAgICAgICAgICAgICAgcmVzb2x2ZShmaWxlU2VudEV2dCk7XHJcbi8vICAgICAgICAgICAgfSk7XHJcbi8vICAgICAgICAgICAgc2hhcmUyUmVwb3J0ZXIocmVzb3VyY2VGaWxlLCBfdGhpcy5fbWFuYWdlci5faHlwZXJ0eVVSTCwgZmlsZVNlbnRFdnQsIHJlcG9ydGVyU3RhdHVzKTtcclxuICAgICAgICB9KTtcclxuICAgIH0pLmNhdGNoKGZ1bmN0aW9uKHJlYXNvbikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdSZWFzb246JywgcmVhc29uKTtcclxuICAgICAgcmVqZWN0KHJlYXNvbik7XHJcbiAgICB9KTtcclxuXHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBUaGlzIGZ1bmN0aW9uIGlzIHVzZWQgdG8gc2VuZCBhIGNoYXQgbWVzc2FnZS5cclxuICAgKiBAcGFyYW0gIHtzdHJpbmd9ICAgICBtZXNzYWdlICAgICAgICAgICAgICAgICAgICAgICAgSXMgdGhlIENoYXRNZXNzYWdlIHRvIGJlIHNlbnQuXHJcbiAgICogQHJldHVybiB7UHJvbWlzZTxDb21tdW5pY2F0aW9uLkNoYXRNZXNzYWdlPn0gICAgICAgIEl0IHJldHVybnMgdGhlIENoYXRNZXNzYWdlIGNoaWxkIG9iamVjdCBjcmVhdGVkIGJ5IHRoZSBTeW5jaGVyIGFzIGEgUHJvbWlzZS5cclxuICAgKi9cclxuICBzZW5kKG1lc3NhZ2UsIGlkZW50aXR5KSB7XHJcblxyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuICAgIGxldCBtb2RlID0gX3RoaXMuY29udHJvbGxlck1vZGU7XHJcbiAgICBsZXQgZGF0YU9iamVjdCA9IG1vZGUgPT09ICdyZXBvcnRlcicgPyBfdGhpcy5kYXRhT2JqZWN0UmVwb3J0ZXIgOiBfdGhpcy5kYXRhT2JqZWN0T2JzZXJ2ZXI7XHJcblxyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG5cclxuLy8gICAgICBsZXQgX2RhdGFPYmplY3RDaGlsZDtcclxuICAgICAgX3RoaXMuY2hpbGRfY3NlcSArPSAxO1xyXG4gICAgICBsZXQgbXNnID0ge1xyXG5cclxuLyogICAgICAgIHVybDogZGF0YU9iamVjdC5kYXRhLnVybCxcclxuICAgICAgICBjc2VxOiBfdGhpcy5jaGlsZF9jc2VxLFxyXG4gICAgICAgIHJlcG9ydGVyOiBkYXRhT2JqZWN0LmRhdGEucmVwb3J0ZXIsXHJcbiAgICAgICAgc2NoZW1hOiBkYXRhT2JqZWN0LmRhdGEuc2NoZW1hLFxyXG4gICAgICAgIG5hbWU6IGRhdGFPYmplY3QuZGF0YS5uYW1lLFxyXG4gICAgICAgIGNyZWF0ZWQgOiBuZXcgRGF0ZSgpLnRvSlNPTigpLCovXHJcblxyXG4gICAgICAgIHR5cGU6ICdjaGF0JyxcclxuICAgICAgICBjb250ZW50OiBtZXNzYWdlXHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGxldCBzZW5kZXIgPSBpZGVudGl0eSA/IGlkZW50aXR5IDoge1xyXG4gICAgICAgIHVzZXJQcm9maWxlOiBfdGhpcy5teUlkZW50aXR5XHJcbiAgICAgIH07XHJcblxyXG4gICAgICBsZXQgaW5wdXQgPSB7fTtcclxuICAgICAgaW5wdXQuYW5vbnltb3VzID0gdHJ1ZTtcclxuXHJcblxyXG4gICAgICAvLyBUT0RPOiBjaGFuZ2UgY2hhdG1lc3NhZ2VzIHRvIHJlc291cmNlIC0gY2hhdCwgZmlsZVxyXG4gICAgICAvLyBUT0RPOiBjaGFuZ2UgbWVzc2FnZSB0byBoeXBlcnR5UmVzb3VyY2UgLSBodHRwczovL2dpdGh1Yi5jb20vcmVUSElOSy1wcm9qZWN0L2Rldi1zZXJ2aWNlLWZyYW1ld29yay90cmVlL2RldmVsb3AvZG9jcy9kYXRhbW9kZWwvZGF0YS1vYmplY3RzL2h5cGVydHktcmVzb3VyY2VcclxuICAgICAgLy8gVE9ETzogaGFuZGxlIHdpdGggbXVsdGlwbGUgcmVzb3VyY2VzIC0gaWYgdGhlIFwibWVzc2FnZVwiIHdpbGwgYmUgZGlmZmVyZW50IGZvciBlYWNoIHR5cGUgb2YgcmVzb3VyY2VzXHJcbiAgICAgIGRhdGFPYmplY3QuYWRkQ2hpbGQobXNnLCBzZW5kZXIsIGlucHV0KS50aGVuKGZ1bmN0aW9uKGRhdGFPYmplY3RDaGlsZCkge1xyXG4gICAgICAgIGNvbnNvbGUubG9nKCdbQ2hhdE1hbmFnZXIuQ2hhdENvbnRyb2xsZXJdW2FkZENoaWxkIC0gQ2hhdCBNZXNzYWdlXTogJywgZGF0YU9iamVjdENoaWxkKTtcclxuICAgICAgICAvL3Jlc29sdmUoZGF0YU9iamVjdENoaWxkKTtcclxuXHJcbiAgICAgICAgLy9UT0RPOiBtb3ZlIHRvIHNlcGFyYXRlIGZ1bmN0aW9uXHJcblxyXG5cclxuICAgICAgICBsZXQgbXNnID0ge1xyXG4gICAgICAgICAgY2hpbGRJZDogZGF0YU9iamVjdENoaWxkLl9jaGlsZElkLFxyXG4gICAgICAgICAgZnJvbTogZGF0YU9iamVjdENoaWxkLl9vd25lcixcclxuICAgICAgICAgIHZhbHVlOiBkYXRhT2JqZWN0Q2hpbGQuZGF0YSxcclxuICAgICAgICAgIHR5cGU6ICdjcmVhdGUnLFxyXG4gICAgICAgICAgaWRlbnRpdHk6IHNlbmRlclxyXG4gICAgICAgIH07XHJcblxyXG4vKiAgICAgICAgbGV0IHJlcG9ydGVyU3RhdHVzID0gbmV3IFJlZ2lzdHJhdGlvblN0YXR1cyhkYXRhT2JqZWN0LnVybCwgX3RoaXMuX21hbmFnZXIuX3J1bnRpbWVVUkwsIF90aGlzLl9tYW5hZ2VyLl9oeXBlcnR5VVJMLCBfdGhpcy5fbWFuYWdlci5fYnVzICk7XHJcblxyXG4gICAgICAgIC8vIHJlY3Vyc2l2ZSBmdW5jdGlvbiB0byBzeW5jIHdpdGggY2hhdCByZXBvcnRlclxyXG5cclxuICAgICAgICAgIGxldCBzaGFyZTJSZXBvcnRlciA9IGZ1bmN0aW9uKGNoaWxkLCBzdWJzY3JpYmVyLCBtc2csIHN0YXR1cykge1xyXG4gICAgICAgICAgICBsZXQgc3RhdHVzT2ZSZXBvcnRlciA9IHN0YXR1cztcclxuICAgICAgICAgICAgY2hpbGQuc2hhcmluZ1N0YXR1cy50aGVuKHJlc29sdmUobXNnKSkuY2F0Y2goKHJlc3VsdCk9PntcclxuXHJcbiAgICAgICAgICAgICAgICBzdGF0dXNPZlJlcG9ydGVyLm9uTGl2ZSggc3Vic2NyaWJlciwgKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICBzdGF0dXNPZlJlcG9ydGVyLnVuc3Vic2NyaWJlTGl2ZShzdWJzY3JpYmVyKTtcclxuICAgICAgICAgICAgICAgICAgY2hpbGQuc2hhcmUodHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICAgIHNoYXJlMlJlcG9ydGVyKGNoaWxkLCBzdWJzY3JpYmVyLCBtc2csIHN0YXR1c09mUmVwb3J0ZXIpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAvL1RPRE86IHN1YnNjcmliZSB0byBzeW5jIHdoZW4gcmVwb3J0ZXIgaXMgbGl2ZS4gTmV3IHN5bmNoZWQgbWVzc2FnZXMgc2hvdWxkIHRyaWdnZXIgb25NZXNzYWdlIGllIG9uQ2hpbGRcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICB9Ki9cclxuXHJcbi8vICAgICAgICAgIHNoYXJlMlJlcG9ydGVyKGRhdGFPYmplY3RDaGlsZCwgX3RoaXMuX21hbmFnZXIuX2h5cGVydHlVUkwsIG1zZywgcmVwb3J0ZXJTdGF0dXMpO1xyXG4vLyAgICAgICAgZGF0YU9iamVjdENoaWxkLnNoYXJlKHRydWUpO1xyXG4gICAgICAgICAgcmVzb2x2ZShtc2cpO1xyXG5cclxuXHJcbiAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24ocmVhc29uKSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcignUmVhc29uOicsIHJlYXNvbik7XHJcbiAgICAgICAgcmVqZWN0KHJlYXNvbik7XHJcbiAgICAgIH0pO1xyXG5cclxuICAgIH0pO1xyXG5cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFtvbkNoYW5nZSBkZXNjcmlwdGlvbl1cclxuICAgKiBAcGFyYW0gIHtGdW5jdGlvbn0gY2FsbGJhY2sgW2Rlc2NyaXB0aW9uXVxyXG4gICAqIEByZXR1cm4ge1t0eXBlXX0gICAgICAgICAgICBbZGVzY3JpcHRpb25dXHJcbiAgICovXHJcbiAgb25DaGFuZ2UoY2FsbGJhY2spIHtcclxuICAgIGxldCBfdGhpcyA9IHRoaXM7XHJcbiAgICBfdGhpcy5fb25DaGFuZ2UgPSBjYWxsYmFjaztcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFRoaXMgZnVuY3Rpb24gaXMgdXNlZCB0byByZWNlaXZlIG5ldyBtZXNzYWdlcy5cclxuICAgKiBAcGFyYW0gIHtGdW5jdGlvbn0gY2FsbGJhY2sgRnVuY3Rpb24gdG8gaGFuZGxlIHdpdGggbmV3IG1lc3NhZ2VzXHJcbiAgICogQHJldHVybiB7Q29tbXVuaWNhdGlvbi5DaGF0TWVzc2FnZX0gbVxyXG4gICAqL1xyXG4gIG9uTWVzc2FnZShjYWxsYmFjaykge1xyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuICAgIF90aGlzLl9vbk1lc3NhZ2UgPSBjYWxsYmFjaztcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFRoaXMgZnVuY3Rpb24gaXMgdXNlZCB0byByZWNlaXZlIHR5cGluZyBldmVudHMuXHJcbiAgICogQHBhcmFtICB7RnVuY3Rpb259IGNhbGxiYWNrIEZ1bmN0aW9uIHRvIGhhbmRsZSB0eXBpbmcgZXZlbnRcclxuICAgKi9cclxuXHJcbiAgb25UeXBpbmcoY2FsbGJhY2spIHtcclxuICAgICAgaWYgKHRoaXMuX2RhdGFPYmplY3RSZXBvcnRlcikgdGhpcy5fZGF0YU9iamVjdFJlcG9ydGVyLm9uRXZlbnQoKGV2ZW50KT0+e1xyXG4gICAgICAgIGlmIChldmVudC52YWx1ZSA9PT0gJ3R5cGluZycpIHtcclxuICAgICAgICAgIGNhbGxiYWNrKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KTtcclxuICAgICAgZWxzZSB0aGlzLl9kYXRhT2JqZWN0T2JzZXJ2ZXIub25FdmVudCgoZXZlbnQpPT57XHJcbiAgICAgICAgaWYgKGV2ZW50LnZhbHVlID09PSAndHlwaW5nJykge1xyXG4gICAgICAgICAgY2FsbGJhY2soKTtcclxuICAgICAgICB9IFxyXG4gICAgICB9KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFRoaXMgZnVuY3Rpb24gaXMgdXNlZCB0byB0cmlnZ2VyIHR5cGluZyBldmVudHMuXHJcbiAgICovXHJcblxyXG4gIHR5cGluZygpIHtcclxuICAgICAgaWYgKHRoaXMuX2RhdGFPYmplY3RSZXBvcnRlcikgdGhpcy5fZGF0YU9iamVjdFJlcG9ydGVyLnNlbmRFdmVudCgndHlwaW5nJyk7XHJcbiAgICAgIGVsc2UgdGhpcy5fZGF0YU9iamVjdE9ic2VydmVyLnNlbmRFdmVudCgndHlwaW5nJyk7XHJcbiAgfVxyXG5cclxuXHJcbiAgLyoqXHJcbiAgICogW29uVXNlckFkZGVkIGRlc2NyaXB0aW9uXVxyXG4gICAqIEBwYXJhbSAge0Z1bmN0aW9ufSBjYWxsYmFjayBbZGVzY3JpcHRpb25dXHJcbiAgICogQHJldHVybiB7W3R5cGVdfSAgICAgICAgICAgIFtkZXNjcmlwdGlvbl1cclxuICAgKi9cclxuICBvblVzZXJBZGRlZChjYWxsYmFjaykge1xyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuICAgIF90aGlzLl9vblVzZXJBZGRlZCA9IGNhbGxiYWNrO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogV2hlbiB0aGUgYW4gdXNlciB3YXMgcmVtb3ZlZFxyXG4gICAqIEBwYXJhbSAge0Z1bmN0aW9ufSBjYWxsYmFjayBGdW5jdGlvbiBoYW5kbGUgd2l0aCB0aGUgcmVtb3ZlZCB1c2VyXHJcbiAgICogQHJldHVybiB7W3R5cGVdfSAgICAgICAgICAgIFtkZXNjcmlwdGlvbl1cclxuICAgKi9cclxuICBvblVzZXJSZW1vdmVkKGNhbGxiYWNrKSB7XHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG4gICAgX3RoaXMuX29uVXNlclJlbW92ZWQgPSBjYWxsYmFjaztcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFRoaXMgZnVuY3Rpb24gaXMgdXNlZCB0byByZWNlaXZlIHJlcXVlc3RzIHRvIGNsb3NlIHRoZSBHcm91cCBDaGF0IGluc3RhbmNlLlxyXG4gICAqIEByZXR1cm4ge0RlbGV0ZUV2ZW50fSBUaGUgRGVsZXRlRXZlbnQgZmlyZWQgYnkgdGhlIFN5bmNoZXIgd2hlbiB0aGUgQ2hhdCBpcyBjbG9zZWQuXHJcbiAgICovXHJcbiAgb25DbG9zZShjYWxsYmFjaykge1xyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuICAgIF90aGlzLl9vbkNsb3NlID0gY2FsbGJhY2s7XHJcbiAgfVxyXG5cclxuICBvblJlc3BvbnNlKGNhbGxiYWNrKSB7XHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG4gICAgX3RoaXMuX29uUmVzcG9uc2UgPSBjYWxsYmFjaztcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFRoaXMgZnVuY3Rpb24gaXMgdXNlZCB0byBhZGQgLyBpbnZpdGUgbmV3IHVzZXIgb24gYW4gZXhpc3RpbmcgR3JvdXAgQ2hhdCBpbnN0YW5jZS5cclxuICAgKiBPbmx5IHRoZSBSZXBvcnRlciwgaS5lLiB0aGUgSHlwZXJ0eSB0aGF0IGhhcyBjcmVhdGVkIHRoZSBHcm91cCBDaGF0LCBpcyBhbGxvd2VkIHRvIHVzZSB0aGlzIGZ1bmN0aW9uLlxyXG4gICAqIEBwYXJhbSB7VVJMLlVzZXJVUkx9ICB1c2VycyAgVXNlciB0byBiZSBpbnZpdGVkIHRvIGpvaW4gdGhlIEdyb3VwIENoYXQgdGhhdCBpcyBpZGVudGlmaWVkIHdpdGggcmVUSElOSyBVc2VyIFVSTC5cclxuICAgKiBAcmV0dXJuIHtQcm9taXNlPGJvb2xlYW4+fSAgIEl0IHJldHVybnMgYXMgYSBQcm9taXNlIHRydWUgaWYgc3VjY2Vzc2Z1bGx5IGludml0ZWQgb3IgZmFsc2Ugb3RoZXJ3aXNlLlxyXG4gICAqL1xyXG4vKiAgYWRkVXNlcih1c2Vycykge1xyXG5cclxuICAgIGxldCBfdGhpcyA9IHRoaXM7XHJcblxyXG4gICAgbGV0IGhhdmVFbXB0eUVsZW1lbnRzID0gKGVsZW1lbnQpID0+IHtcclxuICAgICAgY29uc29sZS5sb2coJ0VsZW1lbnQ6JywgZWxlbWVudC5sZW5ndGgpO1xyXG4gICAgICByZXR1cm4gZWxlbWVudC5sZW5ndGggIT09IDA7XHJcbiAgICB9O1xyXG5cclxuICAgIGxldCBub3RGb3VuZEVsZW1lbnRzID0gKGVsZW1lbnQpID0+IHtcclxuICAgICAgY29uc29sZS5sb2coJ3VzZXIgbm90IGZvdW5kOiAnLCBlbGVtZW50KTtcclxuICAgICAgcmV0dXJuICEoZWxlbWVudCBpbnN0YW5jZW9mIFN0cmluZyk7XHJcbiAgICB9O1xyXG5cclxuICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuXHJcbiAgICAgIGlmICh1c2Vycy5maWx0ZXIoaGF2ZUVtcHR5RWxlbWVudHMpLmxlbmd0aCA9PT0gMCkge1xyXG4gICAgICAgIHJldHVybiByZWplY3QoJ0RvblxcJ3QgaGF2ZSB1c2VycyB0byBpbnZpdGUnKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgY29uc29sZS5pbmZvKCdbQ2hhdE1hbmFnZXIuQ2hhdENvbnRyb2xsZXIuYWRkVXNlcnMgXTogJywgdXNlcnMpO1xyXG5cclxuICAgICAgLypfdGhpcy5zZWFyY2gudXNlcnModXNlcnMsIGRvbWFpbnMsIFsnY29tbSddLCBbJ2NoYXQnXSlcclxuXHJcbiAgICAudGhlbigoaHlwZXJ0aWVzSURzKSA9PiB7XHJcblxyXG4gICAgICBpZiAoaHlwZXJ0aWVzSURzLmZpbHRlcihub3RGb3VuZEVsZW1lbnRzKS5sZW5ndGggPT09IDApIHtcclxuICAgICAgICB0aHJvdyAnVXNlcihzKSBub3QgZm91bmQnO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBsZXQgc2VsZWN0ZWRIeXBlcnRpZXMgPSBoeXBlcnRpZXNJRHMubWFwKChoeXBlcnR5KSA9PiB7XHJcbiAgICAgICAgcmV0dXJuIGh5cGVydHkuaHlwZXJ0eUlEO1xyXG4gICAgICB9KTsqL1xyXG5cclxuLyogICAgICBsZXQgdXNlcnNEaXNjb3ZlcnkgPSBbXTtcclxuICAgICAgbGV0IGRpc2Nvbm5lY3RlZCA9IFtdO1xyXG4gICAgICBsZXQgbGl2ZSA9IHt9O1xyXG5cclxuICAgICAgdXNlcnMuZm9yRWFjaCgodXNlcikgPT4ge1xyXG4gICAgICAgIGxldCB1c2VyRGlzY292ZXJ5UHJvbWlzZSA9IF90aGlzLmRpc2NvdmVyeS5kaXNjb3Zlckh5cGVydGllc0RPKHVzZXIudXNlciwgWydjb21tJ10sIFsnY2hhdCddLCB1c2VyLmRvbWFpbik7XHJcbiAgICAgICAgICB1c2Vyc0Rpc2NvdmVyeS5wdXNoKHVzZXJEaXNjb3ZlcnlQcm9taXNlKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgIFByb21pc2UuYWxsKHVzZXJzRGlzY292ZXJ5KS50aGVuKCh1c2VyRGlzY292ZXJ5UmVzdWx0cykgPT4ge1xyXG4gICAgICAgIGNvbnNvbGUubG9nKCdbQ2hhdE1hbmFnZXIuQ2hhdENvbnRyb2xsZXIuYWRkVXNlcnNdIFVzZXJzIERpc2NvdmVyeSBSZXN1bHRzLT4nLCB1c2VyRGlzY292ZXJ5UmVzdWx0cyk7XHJcblxyXG4gICAgICAgIGxldCBzZWxlY3RlZEh5cGVydGllcyA9IFtdO1xyXG5cclxuICAgICAgICAgdXNlckRpc2NvdmVyeVJlc3VsdHMuZm9yRWFjaCgodXNlckRpc2NvdmVyeVJlc3VsdCkgPT4ge1xyXG5cclxuICAgICAgICAgICB1c2VyRGlzY292ZXJ5UmVzdWx0LmZvckVhY2goKGRpc2NvdmVyZWQpPT57XHJcbiAgICAgICAgICAgICBpZiAoZGlzY292ZXJlZC5kYXRhLnN0YXR1cyA9PT0gJ2xpdmUnKXtcclxuICAgICAgICAgICAgICAgc2VsZWN0ZWRIeXBlcnRpZXMucHVzaChkaXNjb3ZlcmVkLmRhdGEuaHlwZXJ0eUlEKTtcclxuICAgICAgICAgICAgICAgbGl2ZVtkaXNjb3ZlcmVkLmRhdGEuaHlwZXJ0eUlEXSA9IGRpc2NvdmVyZWQ7XHJcbiAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICBlbHNlIGlmIChkaXNjb25uZWN0ZWQubGVuZ3RoIDwgNSkgZGlzY29ubmVjdGVkLnB1c2goZGlzY292ZXJlZCk7XHJcbiAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBjb25zb2xlLmluZm8oJ1tDaGF0TWFuYWdlci5DaGF0Q29udHJvbGxlcl0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gU3luY2hlciBDcmVhdGUgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSBcXG4nKTtcclxuICAgICAgICBjb25zb2xlLmluZm8oJ1tDaGF0TWFuYWdlci5DaGF0Q29udHJvbGxlcl1TZWxlY3RlZCBIeXBlcnRpZXM6ICEhISAnLCBzZWxlY3RlZEh5cGVydGllcyk7XHJcbiAgICAgICAgY29uc29sZS5pbmZvKGBIYXZlICR7c2VsZWN0ZWRIeXBlcnRpZXMubGVuZ3RofSB1c2VycztgKTtcclxuLy8gICAgICAgIGNvbnNvbGUuaW5mbygnW0NoYXRNYW5hZ2VyXSBIeXBlcnRpZXNJRHMgJywgaHlwZXJ0aWVzSURzKTtcclxuXHJcbiAgICAgICAgbGV0IGRhdGFPYmplY3QgPSBfdGhpcy5jb250cm9sbGVyTW9kZSA9PT0gJ3JlcG9ydGVyJyA/IF90aGlzLmRhdGFPYmplY3RSZXBvcnRlciA6IF90aGlzLmRhdGFPYmplY3RPYnNlcnZlcjtcclxuXHJcbiAgICAgICAgaWYgKGRpc2Nvbm5lY3RlZC5sZW5ndGggPiAwKSBfdGhpcy5faW52aXRhdGlvbnNIYW5kbGVyLmludml0ZURpc2Nvbm5lY3RlZEh5cGVydGllcyhkaXNjb25uZWN0ZWQsIGRhdGFPYmplY3QpO1xyXG5cclxuICAgICAgICBkYXRhT2JqZWN0Lmludml0ZU9ic2VydmVycyhzZWxlY3RlZEh5cGVydGllcyk7XHJcblxyXG4gICAgICAgIGlmIChkYXRhT2JqZWN0Lmludml0YXRpb25zLmxlbmd0aCA+IDApIF90aGlzLl9pbnZpdGF0aW9uc0hhbmRsZXIucHJvY2Vzc0ludml0YXRpb25zKGxpdmUsIGRhdGFPYmplY3QpO1xyXG5cclxuICAgICAgICByZXR1cm47XHJcblxyXG4gICAgICAgIH0pXHJcbiAgICAgICAgLnRoZW4oKCkgPT4ge1xyXG4gICAgICAgICAgY29uc29sZS5pbmZvKCdbQ2hhdE1hbmFnZXIuQ2hhdENvbnRyb2xsZXJdQXJlIGludml0ZWQgd2l0aCBzdWNjZXNzICcgKyB1c2Vycy5sZW5ndGggKyAnIHVzZXJzOycpO1xyXG4gICAgICAgICAgcmVzb2x2ZSh0cnVlKTtcclxuXHJcblxyXG5cclxuICAgICAgICB9KS5jYXRjaCgocmVhc29uKSA9PiB7XHJcbiAgICAgICAgICBjb25zb2xlLmVycm9yKCdBbiBlcnJvciBvY2N1cnJlZCB3aGVuIHRyeWluZyB0byBpbnZpdGUgdXNlcnM7XFxuJywgcmVhc29uKTtcclxuICAgICAgICAgIHJlamVjdChyZWFzb24pO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgIH0pO1xyXG5cclxuICB9Ki9cclxuXHJcbiAgLyoqXHJcbiAgICogVGhpcyBmdW5jdGlvbiBpcyB1c2VkIHRvIHJlcXVlc3QgdGhlIFJlcG9ydGVyIHRvIGFkZCAvIGludml0ZSBuZXcgdXNlciBvbiBhbiBleGlzdGluZyBHcm91cCBDaGF0IGluc3RhbmNlLlxyXG4gICAqIE9ubHkgT2JzZXJ2ZXJzIGFyZSBhbGxvd2VkIHRvIHVzZSB0aGlzIGZ1bmN0aW9uLlxyXG4gICAqIEBwYXJhbSB7VVJMLlVzZXJVUkx9ICB1c2VycyAgVXNlciB0byBiZSBpbnZpdGVkIHRvIGpvaW4gdGhlIEdyb3VwIENoYXQgdGhhdCBpcyBpZGVudGlmaWVkIHdpdGggcmVUSElOSyBVc2VyIFVSTC5cclxuICAgKiBAcmV0dXJuIHtQcm9taXNlPGJvb2xlYW4+fSAgIEl0IHJldHVybnMgYXMgYSBQcm9taXNlIHRydWUgaWYgc3VjY2Vzc2Z1bGx5IGludml0ZWQgb3IgZmFsc2Ugb3RoZXJ3aXNlLlxyXG4gICAqL1xyXG4vKiAgYWRkVXNlclJlcSh1c2Vycykge1xyXG5cclxuICAgIGxldCBfdGhpcyA9IHRoaXM7XHJcblxyXG4gICAgLy9jaGVjayBpcyBPYnNlcnZlciBhbmQgaW52b2tlIG9ic2VydmVyLmV4ZWN1dGUoKSB3aXRoIG5ldyBwcm9taXNlXHJcbiAgICBsZXQgaGF2ZUVtcHR5RWxlbWVudHMgPSAoZWxlbWVudCkgPT4ge1xyXG4gICAgICBjb25zb2xlLmxvZygnRWxlbWVudDonLCBlbGVtZW50Lmxlbmd0aCk7XHJcbiAgICAgIHJldHVybiBlbGVtZW50Lmxlbmd0aCAhPT0gMDtcclxuICAgIH07XHJcblxyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG5cclxuICAgICAgaWYgKHVzZXJzLmZpbHRlcihoYXZlRW1wdHlFbGVtZW50cykubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgICAgcmV0dXJuIHJlamVjdCgnW0NoYXRNYW5hZ2VyLkNoYXRDb250cm9sbGVyLmFkZFVzZXJSZXFdIERvblxcJ3QgaGF2ZSB1c2VycyB0byBhZGQnKTtcclxuICAgICAgfVxyXG4gICAgICBpZiAoIV90aGlzLmNvbnRyb2xsZXJNb2RlID09PSAnb2JzZXJ2ZXInKSB7XHJcbiAgICAgICAgcmV0dXJuIHJlamVjdCgnW0NoYXRNYW5hZ2VyLkNoYXRDb250cm9sbGVyLmFkZFVzZXJSZXFdIG9ubHkgYWxsb3dlZCB0byBDaGF0IE9ic2VydmVyJyk7XHJcblxyXG4gICAgICBsZXQgYWRkVXNlciA9IF90aGlzLmFkZFVzZXIodXNlcnMpO1xyXG5cclxuICAgICAgaWYgKF90aGlzLl9kYXRhT2JqZWN0T2JzZXJ2ZXIpIHtcclxuICAgICAgICBhZGRVc2VyID0gX3RoaXMuX2RhdGFPYmplY3RPYnNlcnZlci5leGVjdXRlKCdhZGRVc2VyJywgdXNlcnMpO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBhZGRVc2VyLnRoZW4oKCkgPT4ge1xyXG4gICAgICAgIGNvbnNvbGUuaW5mbygnW0NoYXRNYW5hZ2VyLkNoYXRDb250cm9sbGVyLmFkZFVzZXJSZXFdIFJlcXVlc3QgYWNjZXB0ZWQgYnkgUmVwb3J0ZXIgJyk7XHJcbiAgICAgICAgcmVzb2x2ZSh0cnVlKTtcclxuICAgICAgfSkuY2F0Y2goKHJlYXNvbikgPT4ge1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ1tDaGF0TWFuYWdlci5DaGF0Q29udHJvbGxlci5hZGRVc2VyUmVxXSBSZXF1ZXN0IHJlamVjdGVkIGJ5IFJlcG9ydGVyO1xcbicsIHJlYXNvbik7XHJcbiAgICAgICAgcmVqZWN0KHJlYXNvbik7XHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICB9KTtcclxuXHJcbn0qL1xyXG5cclxuICBvbkludml0YXRpb25SZXNwb25zZShjYWxsYmFjaykge1xyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuICAgIF90aGlzLl9vbkludml0YXRpb25SZXNwb25zZSA9IGNhbGxiYWNrO1xyXG4vLyAgICBfdGhpcy5faW52aXRhdGlvbnNIYW5kbGVyLmludml0YXRpb25SZXNwb25zZSA9IGNhbGxiYWNrO1xyXG4gIH1cclxuXHJcblxyXG4gIC8qKlxyXG4gICAqIFRoaXMgZnVuY3Rpb24gaXMgdXNlZCB0byByZW1vdmUgYSB1c2VyIGZyb20gYW4gZXhpc3RpbmcgR3JvdXAgQ2hhdCBpbnN0YW5jZS5cclxuICAgKiBPbmx5IHRoZSBSZXBvcnRlciwgaS5lLiB0aGUgSHlwZXJ0eSB0aGF0IGhhcyBjcmVhdGVkIHRoZSBHcm91cCBDaGF0LCBpcyBhbGxvd2VkIHRvIHVzZSB0aGlzIGZ1bmN0aW9uLlxyXG4gICAqIEByZXR1cm4gezxQcm9taXNlPiBib29sZWFufSBQcm9taXNlIHdpdGggdGhlIHN0YXR1c1xyXG4gICAqL1xyXG5cclxuICAvKipcclxuICAgKiBUaGlzIGZ1bmN0aW9uIGlzIHVzZWQgdG8gcmVtb3ZlIGEgdXNlciBmcm9tIGFuIGV4aXN0aW5nIEdyb3VwIENoYXQgaW5zdGFuY2UuXHJcbiAgICogT25seSB0aGUgUmVwb3J0ZXIsIGkuZS4gdGhlIEh5cGVydHkgdGhhdCBoYXMgY3JlYXRlZCB0aGUgR3JvdXAgQ2hhdCwgaXMgYWxsb3dlZCB0byB1c2UgdGhpcyBmdW5jdGlvbi5cclxuICAgKiBAcGFyYW0gIHtVUkwuVXNlclVSTH0gdXNlciAgICAgICBVc2VyIHRvIGJlIHJlbW92ZWQgZnJvbSB0aGUgR3JvdXAgQ2hhdCB0aGF0IGlzIGlkZW50aWZpZWQgd2l0aCByZVRISU5LIFVzZXIgVVJMLlxyXG4gICAqIEByZXR1cm4gezxQcm9taXNlPiBib29sZWFufSAgICAgIEl0IHJldHVybnMgYXMgYSBQcm9taXNlIHRydWUgaWYgc3VjY2Vzc2Z1bGx5IHJlbW92ZWQgb3IgZmFsc2Ugb3RoZXJ3aXNlLlxyXG4gICAqL1xyXG4gIHJlbW92ZVVzZXIodXNlcikge1xyXG5cclxuICAgIC8vIFRPRE86IGltcGxlbWVudCB0aGUgcmVtb3ZlVXNlcjtcclxuICAgIGNvbnNvbGUubG9nKCdbQ2hhdE1hbmFnZXIuQ2hhdENvbnRyb2xsZXJdTm90IHlldCBpbXBsZW1lbnRlZDogJywgdXNlcik7XHJcblxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogVGhpcyBmdW5jdGlvbiBpcyB1c2VkIHRvIGNsb3NlIGFuIGV4aXN0aW5nIEdyb3VwIENoYXQgaW5zdGFuY2UuXHJcbiAgICogT25seSBhdmFpbGFibGUgdG8gQ2hhdCBHcm91cCBSZXBvcnRlcnMgaS5lLiB0aGUgSHlwZXJ0eSBpbnN0YW5jZSB0aGF0IGNyZWF0ZWQgdGhlIEdyb3VwIENoYXQuXHJcbiAgICogQHJldHVybiB7PFByb21pc2U+Qm9vbGVhbn0gSXQgcmV0dXJucyBhcyBhIFByb21pc2UgdHJ1ZSBpZiBzdWNjZXNzZnVsbHkgY2xvc2VkIG9yIGZhbHNlIG90aGVyd2lzZS5cclxuICAgKi9cclxuICBjbG9zZShkZWwgPSB0cnVlKSB7XHJcbiAgICAvLyBUT0RPOiB0aGUgZGF0YU9iamVjdFJlcG9ydGVyLmRlbGV0ZSBzaG91bGQgYmUgYSBQcm9taXNlO1xyXG5cclxuICAgIGxldCBfdGhpcyA9IHRoaXM7XHJcbiAgICBcclxuICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgXHJcbiAgICAgIGlmIChfdGhpcy5jb250cm9sbGVyTW9kZSA9PT0gJ3JlcG9ydGVyJykge1xyXG4gICAgICAgIC8vIHJlcG9ydGVyXHJcbi8vICAgICAgICBfdGhpcy5faW52aXRhdGlvbnNIYW5kbGVyLmNsZWFuSW52aXRhdGlvbnMoX3RoaXMuZGF0YU9iamVjdFJlcG9ydGVyKS50aGVuKCgpID0+IHtcclxuICAgICAgICAgIGlmICghZGVsKSB7XHJcbiAgICAgICAgICAgIF90aGlzLl9tYW5hZ2VyLmNvbW11bmljYXRpb25PYmplY3Quc3RhdHVzID0gJ2Nsb3NlZCc7XHJcbiAgICAgICAgICAgICAgcmVzb2x2ZSh0cnVlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNle1xyXG5cclxuICAgICAgICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgICBkZWxldGUgX3RoaXMuX21hbmFnZXIuX3JlcG9ydGVyc0NvbnRyb2xsZXJzW190aGlzLmRhdGFPYmplY3RSZXBvcnRlci51cmxdO1xyXG4gICAgICAgICAgICAgICAgX3RoaXMuZGF0YU9iamVjdFJlcG9ydGVyLmRlbGV0ZSgpO1xyXG4gICAgICAgICAgICAgICAgcmVzb2x2ZSh0cnVlKTtcclxuICAgICAgICAgICAgICAgIGlmIChfdGhpcy5fb25DbG9zZSkgX3RoaXMuX29uQ2xvc2Uoe1xyXG4gICAgICAgICAgICAgICAgICBjb2RlOiAyMDAsXHJcbiAgICAgICAgICAgICAgICAgIGRlc2M6ICdkZWxldGVkJyxcclxuICAgICAgICAgICAgICAgICAgdXJsOiBfdGhpcy5kYXRhT2JqZWN0UmVwb3J0ZXIudXJsXHJcbiAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZSk7XHJcbiAgICAgICAgICAgICAgICByZWplY3QoZmFsc2UpO1xyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuLy8gICAgICAgICAgfSk7XHJcblxyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIC8vIG9ic2VydmVyXHJcbiAgICAgICAgaWYoZGVsKXtcclxuICAgICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgIGRlbGV0ZSBfdGhpcy5fbWFuYWdlci5fb2JzZXJ2ZXJzQ29udHJvbGxlcnNbX3RoaXMuZGF0YU9iamVjdE9ic2VydmVyLnVybF07XHJcbiAgICAgICAgICAgIF90aGlzLmRhdGFPYmplY3RPYnNlcnZlci51bnN1YnNjcmliZSgpO1xyXG4gICAgICAgICAgICByZXNvbHZlKHRydWUpO1xyXG4gICAgICAgICAgfSBjYXRjaCAoZSkge1xyXG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKGUpO1xyXG4gICAgICAgICAgICByZWplY3QoZmFsc2UpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNle1xyXG4gICAgICAgICAgLy8gVE9ETzogc2VuZCBtZXNzYWdlIFxyXG4gICAgICAgICAgcmVzb2x2ZSh0cnVlKTtcclxuICAgICAgICB9IFxyXG4gICAgICAgIFxyXG4gICAgICB9XHJcbiAgICB9KTtcclxuXHJcbiAgfVxyXG5cclxufVxyXG5cclxuZXhwb3J0IGRlZmF1bHQgQ2hhdDtcclxuIiwiXHJcbi8qKlxyXG4qIENvcHlyaWdodCAyMDE2IFBUIElub3Zhw6fDo28gZSBTaXN0ZW1hcyBTQVxyXG4qIENvcHlyaWdodCAyMDE2IElORVNDLUlEXHJcbiogQ29weXJpZ2h0IDIwMTYgUVVPQklTIE5FVFdPUktTIFNMXHJcbiogQ29weXJpZ2h0IDIwMTYgRlJBVU5IT0ZFUi1HRVNFTExTQ0hBRlQgWlVSIEZPRVJERVJVTkcgREVSIEFOR0VXQU5EVEVOIEZPUlNDSFVORyBFLlZcclxuKiBDb3B5cmlnaHQgMjAxNiBPUkFOR0UgU0FcclxuKiBDb3B5cmlnaHQgMjAxNiBEZXV0c2NoZSBUZWxla29tIEFHXHJcbiogQ29weXJpZ2h0IDIwMTYgQXBpemVlXHJcbiogQ29weXJpZ2h0IDIwMTYgVEVDSE5JU0NIRSBVTklWRVJTSVRBVCBCRVJMSU5cclxuKlxyXG4qIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4qIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4qXHJcbiogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuKlxyXG4qIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4qIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4qKi9cclxuXHJcbi8vIFNlcnZpY2UgRnJhbWV3b3JrXHJcbi8vaW1wb3J0IElkZW50aXR5TWFuYWdlciBmcm9tICcuLi9pZGVudGl0eU1hbmFnZXIvSWRlbnRpdHlNYW5hZ2VyJztcclxuLy9pbXBvcnQgUmVnaXN0cmF0aW9uU3RhdHVzIGZyb20gJy4uL2Rpc2NvdmVyeS9SZWdpc3RyYXRpb25TdGF0dXMnO1xyXG4vL2ltcG9ydCBEaXNjb3ZlcnkgZnJvbSAnLi4vZGlzY292ZXJ5L0Rpc2NvdmVyeSc7XHJcbi8vaW1wb3J0IFN5bmNoZXIgZnJvbSAnLi4vc3luY2hlci9TeW5jaGVyJztcclxuXHJcbi8vIFV0aWxzXHJcbi8vaW1wb3J0IHtkaXZpZGVVUkx9IGZyb20gJy4uL3V0aWxzL3V0aWxzJztcclxuLy9pbXBvcnQgU2VhcmNoIGZyb20gJy4uL3V0aWxzL1NlYXJjaCc7XHJcblxyXG4vLyBJbnRlcm5hbHNcclxuaW1wb3J0IHsgY29tbXVuaWNhdGlvbk9iamVjdCwgQ29tbXVuaWNhdGlvblN0YXR1cywgY29tbXVuaWNhdGlvbkNoaWxkcmVuIH0gZnJvbSAnLi9jb21tdW5pY2F0aW9uJztcclxuaW1wb3J0IENoYXQgZnJvbSAnLi9DaGF0JztcclxuaW1wb3J0IHsgVXNlckluZm8gfSBmcm9tICcuL1VzZXJJbmZvJztcclxuXHJcbi8qKlxyXG4qIEh5cGVydHkgU2ltcGxlIEdyb3VwIENoYXQgTWFuYWdlciBBUElcclxuKiBAYXV0aG9yIFZpdG9yIFNpbHZhIFt2aXRvci10LXNpbHZhQHRlbGVjb20ucHRdXHJcbiogQHZlcnNpb24gMC4xLjBcclxuKi9cclxuY2xhc3MgU2ltcGxlQ2hhdE1hbmFnZXIge1xyXG5cclxuICBjb25zdHJ1Y3RvcihteVVybCwgYnVzLCBjb25maWd1cmF0aW9uLCBzeW5jaGVyLCBmYWN0b3J5KSB7XHJcbiAgICBpZiAoIW15VXJsKSB0aHJvdyBuZXcgRXJyb3IoJ1tTaW1wbGVDaGF0TWFuYWdlci5jb25zdHJ1Y3Rvcl0gVGhlIG15VXJsIGlzIGEgbmVlZGVkIHBhcmFtZXRlcicpO1xyXG4gICAgaWYgKCFidXMpIHRocm93IG5ldyBFcnJvcignW1NpbXBsZUNoYXRNYW5hZ2VyLmNvbnN0cnVjdG9yXSBUaGUgTWluaUJ1cyBpcyBhIG5lZWRlZCBwYXJhbWV0ZXInKTtcclxuICAgIGlmICghY29uZmlndXJhdGlvbikgdGhyb3cgbmV3IEVycm9yKCdbU2ltcGxlQ2hhdE1hbmFnZXIuY29uc3RydWN0b3JdIFRoZSBjb25maWd1cmF0aW9uIGlzIGEgbmVlZGVkIHBhcmFtZXRlcicpO1xyXG5cclxuICAgIGxldCBfdGhpcyA9IHRoaXM7XHJcbiAgICBpZiAoIXN5bmNoZXIpIHtcclxuICAgICAgc3luY2hlciA9IGZhY3RvcnkuY3JlYXRlU3luY2hlcihteVVybCwgYnVzLCBjb25maWd1cmF0aW9uKTtcclxuICAgIH1cclxuXHJcbiAgICBfdGhpcy5fcnVudGltZVVSTCA9IGNvbmZpZ3VyYXRpb24ucnVudGltZVVSTDtcclxuXHJcbiAgICBsZXQgZG9tYWluID0gZmFjdG9yeS5kaXZpZGVVUkwoX3RoaXMuX3J1bnRpbWVVUkwpLmRvbWFpbjtcclxuLy8gICAgbGV0IGRpc2NvdmVyeSA9IGZhY3RvcnkuY3JlYXRlRGlzY292ZXJ5KG15VXJsLCBjb25maWd1cmF0aW9uLnJ1bnRpbWVVUkwsIGJ1cyk7XHJcbiAgICBsZXQgaWRlbnRpdHlNYW5hZ2VyID0gZmFjdG9yeS5jcmVhdGVJZGVudGl0eU1hbmFnZXIobXlVcmwsIGNvbmZpZ3VyYXRpb24ucnVudGltZVVSTCwgYnVzKTtcclxuXHJcbiAgICBfdGhpcy5fb2JqZWN0RGVzY1VSTCA9ICdoeXBlcnR5LWNhdGFsb2d1ZTovL2NhdGFsb2d1ZS4nICsgZG9tYWluICsgJy8ud2VsbC1rbm93bi9kYXRhc2NoZW1hL0NvbW11bmljYXRpb24nO1xyXG5cclxuICAgIF90aGlzLl9yZXBvcnRlcnNDb250cm9sbGVycyA9IHt9O1xyXG4gICAgX3RoaXMuX29ic2VydmVyc0NvbnRyb2xsZXJzID0ge307XHJcblxyXG4gICAgX3RoaXMuX215VXJsID0gbXlVcmw7XHJcbiAgICBfdGhpcy5fYnVzID0gYnVzO1xyXG4gICAgX3RoaXMuX3N5bmNoZXIgPSBzeW5jaGVyO1xyXG4gICAgX3RoaXMuX2RvbWFpbiA9IGRvbWFpbjtcclxuICAgIF90aGlzLl9kZWZhdWx0U3R1YlRyaWdnZXJlZCA9IGZhbHNlO1xyXG5cclxuLy8gICAgX3RoaXMuZGlzY292ZXJ5ID0gZGlzY292ZXJ5O1xyXG4gICAgX3RoaXMuaWRlbnRpdHlNYW5hZ2VyID0gaWRlbnRpdHlNYW5hZ2VyO1xyXG4gICAgX3RoaXMuY3VycmVudElkZW50aXR5O1xyXG5cclxuLy8gICAgX3RoaXMuc2VhcmNoID0gZmFjdG9yeS5jcmVhdGVTZWFyY2goZGlzY292ZXJ5LCBpZGVudGl0eU1hbmFnZXIpO1xyXG5cclxuICAgIF90aGlzLmNvbW11bmljYXRpb25PYmplY3QgPSBjb21tdW5pY2F0aW9uT2JqZWN0O1xyXG5cclxuICAgIF90aGlzLmNvbW11bmljYXRpb25DaGlsZHJlbiA9IGNvbW11bmljYXRpb25DaGlsZHJlbjtcclxuXHJcbi8vICAgIGNvbnNvbGUubG9nKCdbU2ltcGxlQ2hhdE1hbmFnZXJdIERpc2NvdmVyICcsIGRpc2NvdmVyeSk7XHJcbiAgICBjb25zb2xlLmxvZygnW1NpbXBsZUNoYXRNYW5hZ2VyXSBJZGVudGl0eSBNYW5hZ2VyICcsIGlkZW50aXR5TWFuYWdlcik7XHJcblxyXG5cclxuICB9XHJcblxyXG4gIHNldCBvZmZsaW5lKG9mZmxpbmUpIHtcclxuICAgIHRoaXMuX29mZmxpbmUgPSBvZmZsaW5lO1xyXG4gIH1cclxuXHJcbiAgZ2V0IG9mZmxpbmUoKSB7XHJcbiAgICByZXR1cm4gdGhpcy5fb2ZmbGluZSA/IHRoaXMuX29mZmxpbmUgOiBmYWxzZTtcclxuICB9XHJcblxyXG4gIHNldCBiYWNrdXAoYmFja3VwKSB7XHJcbiAgICB0aGlzLl9iYWNrdXAgPSBiYWNrdXA7XHJcbiAgfVxyXG5cclxuICBnZXQgYmFja3VwKCkge1xyXG4gICAgcmV0dXJuIHRoaXMuX2JhY2t1cCA/IHRoaXMuX2JhY2t1cCA6IGZhbHNlO1xyXG4gIH1cclxuXHJcbiAgcHJvY2Vzc05vdGlmaWNhdGlvbihldmVudCkge1xyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuICAgIGNvbnNvbGUubG9nKCdbU2ltcGxlQ2hhdE1hbmFnZXIucHJvY2Vzc05vdGlmaWNhdGlvbjogJywgZXZlbnQpO1xyXG5cclxuICAgIGlmIChldmVudC50eXBlID09PSAnY3JlYXRlJykge1xyXG5cclxuICAgICAgLy8gVE9ETzogcmVwbGFjZSB0aGUgMTAwIGZvciBNZXNzYWdlLlJlc3BvbnNlXHJcbiAgICAgIC8vIGV2ZW50LmFjaygyMDApO1xyXG5cclxuICAgICAgaWYgKF90aGlzLl9vbkludml0YXRpb24pIHsgX3RoaXMuX29uSW52aXRhdGlvbihldmVudCk7IH1cclxuICAgIH1cclxuXHJcbiAgICBpZiAoZXZlbnQudHlwZSA9PT0gJ2RlbGV0ZScpIHtcclxuICAgICAgLy8gVE9ETzogcmVwbGFjZSB0aGUgMjAwIGZvciBNZXNzYWdlLlJlc3BvbnNlXHJcbiAgICAgIGV2ZW50LmFjaygyMDApO1xyXG5cclxuICAgICAgaWYgKF90aGlzLl9vbk5vdGlmaWNhdGlvbikgeyBfdGhpcy5fb25Ob3RpZmljYXRpb24oZXZlbnQpOyB9XHJcblxyXG4gICAgICBpZiAoIF90aGlzLl9vYnNlcnZlcnNDb250cm9sbGVyc1tldmVudC51cmxdKXtcclxuICAgICAgICBfdGhpcy5fb2JzZXJ2ZXJzQ29udHJvbGxlcnNbZXZlbnQudXJsXS5jbG9zZUV2ZW50ID0gZXZlbnQ7XHJcblxyXG4gICAgICAgIGRlbGV0ZSBfdGhpcy5fb2JzZXJ2ZXJzQ29udHJvbGxlcnNbZXZlbnQudXJsXTtcclxuXHJcbiAgICAgICAgX3RoaXMuX29ic2VydmVyc0NvbnRyb2xsZXJzLmNsb3NlRXZlbnQgPSBldmVudDtcclxuXHJcbiAgICAgICAgX3RoaXMuY29tbXVuaWNhdGlvbk9iamVjdCA9IGNvbW11bmljYXRpb25PYmplY3Q7XHJcblxyXG4gICAgICB9XHJcblxyXG5cclxuLypcclxuICAgICAgZm9yIChsZXQgdXJsIGluIHRoaXMuX3JlcG9ydGVyc0NvbnRyb2xsZXJzKSB7XHJcbiAgICAgICAgdGhpcy5fcmVwb3J0ZXJzQ29udHJvbGxlcnNbdXJsXS5jbG9zZShldmVudCk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGZvciAobGV0IHVybCBpbiB0aGlzLl9vYnNlcnZlcnNDb250cm9sbGVycykge1xyXG4gICAgICAgIHRoaXMuX29ic2VydmVyc0NvbnRyb2xsZXJzW3VybF0uY2xvc2UoZXZlbnQpO1xyXG4gICAgICB9Ki9cclxuXHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBteUlkZW50aXR5KGlkZW50aXR5KSB7XHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG5cclxuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XHJcbiAgICAgIGNvbnNvbGUuaW5mbygnW1NpbXBsZUNoYXRNYW5hZ2VyLm15SWRlbnRpdHldJyk7XHJcbiAgICAgIGlmIChpZGVudGl0eSkgcmV0dXJuIHJlc29sdmUoaWRlbnRpdHkpO1xyXG5cclxuICAgICAgaWYgKF90aGlzLl9teVVybC5pbmNsdWRlcygnaHlwZXJ0eTovLycpKSB7XHJcbiAgICAgICAgX3RoaXMuaWRlbnRpdHlNYW5hZ2VyLmRpc2NvdmVyVXNlclJlZ2lzdGVyZWQoKS50aGVuKChpZGVudGl0eSkgPT4ge1xyXG4gICAgICAgICAgX3RoaXMuY3VycmVudElkZW50aXR5ID0gaWRlbnRpdHk7XHJcbiAgICAgICAgICByZXNvbHZlKGlkZW50aXR5KTtcclxuICAgICAgICB9KS5jYXRjaChmdW5jdGlvbihyZWFzb24pIHtcclxuICAgICAgICAgIHJlamVjdChyZWFzb24pO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIF90aGlzLmlkZW50aXR5TWFuYWdlci5kaXNjb3ZlcklkZW50aXR5UGVySWRQKCkudGhlbigoaWRlbnRpdHkpID0+IHtcclxuICAgICAgICAgIF90aGlzLmN1cnJlbnRJZGVudGl0eSA9IGlkZW50aXR5O1xyXG4gICAgICAgICAgcmVzb2x2ZShpZGVudGl0eSk7XHJcbiAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24ocmVhc29uKSB7XHJcbiAgICAgICAgICByZWplY3QocmVhc29uKTtcclxuICAgICAgICB9KTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBUaGlzIGZ1bmN0aW9uIGlzIHVzZWQgdG8gY3JlYXRlIGEgbmV3IEdyb3VwIENoYXQgcHJvdmlkaW5nIHRoZSBuYW1lIGFuZCB0aGUgaWRlbnRpZmllcnMgb2YgdXNlcnMgdG8gYmUgaW52aXRlZC5cclxuICAgKiBAcGFyYW0gIHtzdHJpbmd9ICAgICAgICAgICAgICAgICAgICAgbmFtZSAgSXMgYSBzdHJpbmcgdG8gaWRlbnRpZnkgdGhlIEdyb3VwIENoYXRcclxuICAgKiBAcGFyYW0gIHthcnJheTxVUkwuSHlwZXJ0eVVSTD59ICAgICAgICAgaHlwZXJ0aWVzIEFycmF5IG9mIGh5cGVydGllcyB0byBiZSBpbnZpdGVkIHRvIGpvaW4gdGhlIEdyb3VwIENoYXQuIFVzZXJzIGFyZSBpZGVudGlmaWVkIHdpdGggcmVUSElOSyBVc2VyIFVSTCwgbGlrZSB0aGlzIGZvcm1hdCB1c2VyOi8vPGlwZGRvbWFpbj4vPHVzZXItaWRlbnRpZmllcj5cclxuICAgKiBAcmV0dXJuIHs8UHJvbWlzZT5DaGF0Q29udHJvbGxlcn0gICAgQSBDaGF0Q29udHJvbGxlciBvYmplY3QgYXMgYSBQcm9taXNlLlxyXG4gICAqL1xyXG4gIGNyZWF0ZShuYW1lLCBoeXBlcnRpZXMsIGV4dHJhID0ge30pIHtcclxuXHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG4gICAgbGV0IHN5bmNoZXIgPSBfdGhpcy5fc3luY2hlcjtcclxuXHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xyXG5cclxuICAgICAgX3RoaXMuY29tbXVuaWNhdGlvbk9iamVjdCA9IGNvbW11bmljYXRpb25PYmplY3Q7XHJcbiAgICAgIF90aGlzLmNvbW11bmljYXRpb25PYmplY3QuY3NlcSA9IDE7XHJcbiAgICAgIF90aGlzLmNvbW11bmljYXRpb25PYmplY3Quc3RhcnRpbmdUaW1lID0gbmV3IERhdGUoKS50b0pTT04oKTtcclxuICAgICAgX3RoaXMuY29tbXVuaWNhdGlvbk9iamVjdC5zdGF0dXMgPSAgQ29tbXVuaWNhdGlvblN0YXR1cy5PUEVOO1xyXG5cclxuICAgICAgbGV0IG15SWRlbnRpdHk7XHJcblxyXG4gICAgICBfdGhpcy5teUlkZW50aXR5KCkudGhlbigoaWRlbnRpdHkpID0+IHtcclxuICAgICAgICBteUlkZW50aXR5ID0gaWRlbnRpdHk7XHJcbiAgICAgICAgY29uc29sZS5sb2coJ1tTaW1wbGVDaGF0TWFuYWdlci5jcmVhdGUgXSBNeSBJZGVudGl0eScsIGlkZW50aXR5KTtcclxuXHJcbiAgICAgICAgLy8gbGV0IHVybCA9IF90aGlzLmNvbW11bmljYXRpb25PYmplY3QucmVwb3J0ZXI7XHJcblxyXG4gICAgICAgIGxldCB1c2VySW5mbyA9IG5ldyBVc2VySW5mbyhfdGhpcy5fbXlVcmwsIF90aGlzLl9kb21haW4sIGlkZW50aXR5KTtcclxuXHJcbiAgICAgICAgLy8gQWRkIG15IGlkZW50aXR5XHJcbiAgICAgICAgX3RoaXMuY29tbXVuaWNhdGlvbk9iamVjdC5wYXJ0aWNpcGFudHNbaWRlbnRpdHkuZ3VpZF0gPSB1c2VySW5mbztcclxuXHJcbiAgICAgICAgY29uc29sZS5sb2coJ1tTaW1wbGVDaGF0TWFuYWdlci5jcmVhdGUgXSBwYXJ0aWNpcGFudHM6ICcsIF90aGlzLmNvbW11bmljYXRpb25PYmplY3QucGFydGljaXBhbnRzKTtcclxuICAgICAgICBjb25zb2xlLmxvZygnW1NpbXBsZUNoYXRNYW5hZ2VyLmNyZWF0ZSBdIGNvbW11bmljYXRpb25PYmplY3QnLCBfdGhpcy5jb21tdW5pY2F0aW9uT2JqZWN0KTtcclxuXHJcblxyXG4gICAgICAgICAgY29uc29sZS5pbmZvKCdbU2ltcGxlQ2hhdE1hbmFnZXJdIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gU3luY2hlciBDcmVhdGUgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSBcXG4nKTtcclxuICAgICAgICAgIGNvbnNvbGUuaW5mbygnW1NpbXBsZUNoYXRNYW5hZ2VyXSBTZWxlY3RlZCBIeXBlcnRpZXM6ICEhISAnLCBoeXBlcnRpZXMpO1xyXG4vLyAgICAgICAgICBjb25zb2xlLmluZm8oYEhhdmUgJHtoeXBlcnRpZXMubGVuZ3RofSB1c2VycztgKTtcclxuICAgICAgICAgIGxldCBtdXR1YWwgPSBleHRyYS5tdXR1YWwgPyBleHRyYS5tdXR1YWwgOiB0cnVlO1xyXG5cclxuICAgICAgICAgIGxldCBpbnB1dCA9IE9iamVjdC5hc3NpZ24oe3Jlc291cmNlczogWydjaGF0J10sIG11dHVhbDogbXV0dWFsfSwgZXh0cmEpO1xyXG4gICAgICAgICAgZGVsZXRlIGlucHV0Lm5hbWU7XHJcblxyXG4gICAgICAgICAgaWYgKF90aGlzLm9mZmxpbmUpIGlucHV0Lm9mZmxpbmUgPSBfdGhpcy5vZmZsaW5lO1xyXG4gICAgICAgICAgaWYgKF90aGlzLmJhY2t1cCkgaW5wdXQuYmFja3VwID0gX3RoaXMuYmFja3VwO1xyXG5cclxuICAgICAgICAgIGNvbnNvbGUubG9nKCdbU2ltcGxlQ2hhdE1hbmFnZXJdIGlucHV0IGRhdGE6JywgaW5wdXQpO1xyXG4gICAgICAgICAgcmV0dXJuIHN5bmNoZXIuY3JlYXRlKF90aGlzLl9vYmplY3REZXNjVVJMLCBoeXBlcnRpZXMsIF90aGlzLmNvbW11bmljYXRpb25PYmplY3QsIHRydWUsIGZhbHNlLCBuYW1lLCB7fSwgaW5wdXQpO1xyXG4gICAgICAgIH0pLnRoZW4oZnVuY3Rpb24oZGF0YU9iamVjdFJlcG9ydGVyKSB7XHJcblxyXG4gICAgICAgICAgY29uc29sZS5pbmZvKCdbU2ltcGxlQ2hhdE1hbmFnZXJdIDMuIFJldHVybiBDcmVhdGUgRGF0YSBPYmplY3QgUmVwb3J0ZXInLCBkYXRhT2JqZWN0UmVwb3J0ZXIpO1xyXG5cclxuICAgICAgICAgIGxldCBjaGF0ID0gbmV3IENoYXQoc3luY2hlciwgX3RoaXMuX2RvbWFpbiwgbXlJZGVudGl0eSwgX3RoaXMpO1xyXG4gICAgICAgICAgY2hhdC5kYXRhT2JqZWN0UmVwb3J0ZXIgPSBkYXRhT2JqZWN0UmVwb3J0ZXI7XHJcblxyXG4gICAgICAgICAgX3RoaXMuX3JlcG9ydGVyc0NvbnRyb2xsZXJzW2RhdGFPYmplY3RSZXBvcnRlci51cmxdID0gY2hhdDtcclxuXHJcbi8vICAgICAgICAgIGNvbnNvbGUubG9nKCdbU2ltcGxlQ2hhdE1hbmFnZXJdIGNoYXQgaW52aXRhdGlvbnNIYW5kbGVyOiAnLCAgIGNoYXQuaW52aXRhdGlvbnNIYW5kbGVyKTtcclxuXHJcbiAgICAgICAgICAvLyBwcm9jZXNzIGludml0YXRpb25zIHRvIGhhbmRsZSBub3QgcmVjZWl2ZWQgaW52aXRhdGlvbnNcclxuLyogICAgICAgICAgaWYgKGRhdGFPYmplY3RSZXBvcnRlci5pbnZpdGF0aW9ucy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgIGNoYXQuaW52aXRhdGlvbnNIYW5kbGVyLnByb2Nlc3NJbnZpdGF0aW9ucyhsaXZlLCBkYXRhT2JqZWN0UmVwb3J0ZXIpO1xyXG4gICAgICAgICAgfVxyXG5cclxuICAgICAgICAgIC8vIElmIGFueSBpbnZpdGVkIFVzZXIgaXMgZGlzY29ubmVjdGVkIGxldCdzIHdhaXQgdW50aWwgaXQgaXMgY29ubmVjdGVkIGFnYWluXHJcbiAgICAgICAgICBpZiAoZGlzY29ubmVjdGVkLmxlbmd0aCA+IDApIGNoYXQuaW52aXRhdGlvbnNIYW5kbGVyLmludml0ZURpc2Nvbm5lY3RlZEh5cGVydGllcyhkaXNjb25uZWN0ZWQsIGRhdGFPYmplY3RSZXBvcnRlcik7XHJcbiovXHJcbiAgICAgICAgICByZXNvbHZlKGNoYXQpO1xyXG5cclxuICAgICAgICB9KS5jYXRjaChmdW5jdGlvbihyZWFzb24pIHtcclxuICAgICAgICAgIHJlamVjdChyZWFzb24pO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgfSkuY2F0Y2goKHJlYXNvbikgPT4ge1xyXG4gICAgICAgIGNvbnNvbGUubG9nKCdbU2ltcGxlQ2hhdE1hbmFnZXIuY3JlYXRlXSBNeUlkZW50aXR5IEVycm9yOicsIHJlYXNvbik7XHJcbiAgICAgICAgcmV0dXJuIHJlamVjdChyZWFzb24pO1xyXG4gICAgICB9KTtcclxuLy8gICAgfSk7XHJcblxyXG4gIH1cclxuXHJcblxyXG4gIC8qKlxyXG4gICAqIFRoaXMgZnVuY3Rpb24gaXMgdXNlZCB0byBoYW5kbGUgbm90aWZpY2F0aW9ucyBhYm91dCBpbmNvbWluZyBpbnZpdGF0aW9ucyB0byBqb2luIGEgR3JvdXAgQ2hhdC5cclxuICAgKiBAcGFyYW0gIHtGdW5jdGlvbn0gQ3JlYXRlRXZlbnQgVGhlIENyZWF0ZUV2ZW50IGZpcmVkIGJ5IHRoZSBTeW5jaGVyIHdoZW4gYW4gaW52aXRhaW9uIGlzIHJlY2VpdmVkXHJcbiAgICovXHJcbiAgb25JbnZpdGF0aW9uKGNhbGxiYWNrKSB7XHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG4gICAgX3RoaXMuX29uSW52aXRhdGlvbiA9IGNhbGxiYWNrO1xyXG5cclxuICAgIF90aGlzLl90cmlnZ2VyRGVmYXVsdFN0dWJEZXBsb3ltZW50KCk7XHJcbiAgfVxyXG5cclxuICAvLyBzZW5kIG1lc3NhZ2UgdG8gdHJpZ2dlciBkb21haW4gZGVmYXVsdCBzdHViIHRvIGVuc3VyZSBpbmNvbWluZyBtZXNzYWdlcyBhcmUgcmVjZWl2ZWRcclxuXHJcbiAgX3RyaWdnZXJEZWZhdWx0U3R1YkRlcGxveW1lbnQoKXtcclxuICAgIGxldCBwaW5nTWVzc2FnZSA9IHsgZnJvbTogdGhpcy5fbXlVcmwsIHRvOiB0aGlzLl9kb21haW4sIHR5cGU6ICdleGVjdXRlJyAgfTtcclxuICAgIGlmICghdGhpcy5fZGVmYXVsdFN0dWJUcmlnZ2VyZWQpIHRoaXMuX2J1cy5wb3N0TWVzc2FnZShwaW5nTWVzc2FnZSk7XHJcbiAgICB0aGlzLl9kZWZhdWx0U3R1YlRyaWdnZXJlZCA9IHRydWU7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBUaGlzIGZ1bmN0aW9uIGlzIHVzZWQgdG8gaGFuZGxlIG5vdGlmaWNhdGlvbnMgYWJvdXQgaW5jb21pbmcgaW52aXRhdGlvbnMgdG8gam9pbiBhIEdyb3VwIENoYXQuXHJcbiAgICogQHBhcmFtICB7RnVuY3Rpb259IENyZWF0ZUV2ZW50IFRoZSBDcmVhdGVFdmVudCBmaXJlZCBieSB0aGUgU3luY2hlciB3aGVuIGFuIGludml0YWlvbiBpcyByZWNlaXZlZFxyXG4gICAqL1xyXG4gIG9uTm90aWZpY2F0aW9uKGNhbGxiYWNrKSB7XHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG4gICAgX3RoaXMuX29uTm90aWZpY2F0aW9uID0gY2FsbGJhY2s7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBUaGlzIGZ1bmN0aW9uIGlzIHVzZWQgdG8gam9pbiBhIEdyb3VwIENoYXQuXHJcbiAgICogQHBhcmFtICB7VVJMLkNvbW11bmljYXRpb25VUkx9IGludml0YXRpb25VUkwgIFRoZSBDb21tdW5pY2F0aW9uIFVSTCBvZiB0aGUgR3JvdXAgQ2hhdCB0byBqb2luIHRoYXQgaXMgcHJvdmlkZWQgaW4gdGhlIGludml0YXRpb24gZXZlbnRcclxuICAgKiBAcmV0dXJuIHs8UHJvbWlzZT5DaGF0Q29udHJvbGxlcn0gICAgICAgICAgICAgSXQgcmV0dXJucyB0aGUgQ2hhdENvbnRyb2xsZXIgb2JqZWN0IGFzIGEgUHJvbWlzZVxyXG4gICAqL1xyXG4gIGpvaW4oaW52aXRhdGlvblVSTCwgbXV0dWFsID0gZmFsc2UsIGlkZW50aXR5KSB7XHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG5cclxuICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgbGV0IHN5bmNoZXIgPSBfdGhpcy5fc3luY2hlcjtcclxuICAgICAgbGV0IG15SWRlbnRpdHk7XHJcblxyXG4gICAgICBjb25zb2xlLmluZm8oJ1tTaW1wbGVDaGF0TWFuYWdlcl0gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tIFN5bmNoZXIgc3Vic2NyaWJlIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gXFxuJyk7XHJcbiAgICAgIGNvbnNvbGUuaW5mbygnaW52aXRhdGlvblVSTCcsIGludml0YXRpb25VUkwpO1xyXG4gICAgICBfdGhpcy5teUlkZW50aXR5KGlkZW50aXR5KS50aGVuKChpZGVudGl0eSkgPT4ge1xyXG4gICAgICAgIG15SWRlbnRpdHkgPSBpZGVudGl0eTtcclxuICAgICAgICBsZXQgaW5wdXQgPSB7XHJcbiAgICAgICAgICBzY2hlbWE6IF90aGlzLl9vYmplY3REZXNjVVJMLFxyXG4gICAgICAgICAgcmVzb3VyY2U6IGludml0YXRpb25VUkwsXHJcbiAgICAgICAgICBzdG9yZTogdHJ1ZSxcclxuICAgICAgICAgIHAycDogZmFsc2UsXHJcbiAgICAgICAgICBtdXR1YWw6IG11dHVhbCxcclxuICAgICAgICAgIGRvbWFpbl9zdWJzY3JpcHRpb246IHRydWUsXHJcbiAgICAgICAgICBpZGVudGl0eTogaWRlbnRpdHlcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBpZiAoX3RoaXMub2ZmbGluZSkgaW5wdXQub2ZmbGluZSA9IF90aGlzLm9mZmxpbmU7XHJcblxyXG4gICAgICAgIHJldHVybiBzeW5jaGVyLnN1YnNjcmliZShpbnB1dCk7XHJcblxyXG4gICAgICB9KS50aGVuKGZ1bmN0aW9uKGRhdGFPYmplY3RPYnNlcnZlcikge1xyXG4gICAgICAgIGNvbnNvbGUuaW5mbygnRGF0YSBPYmplY3QgT2JzZXJ2ZXI6ICcsIGRhdGFPYmplY3RPYnNlcnZlcik7XHJcblxyXG4gICAgICAgIGxldCBjaGF0ID0gbmV3IENoYXQoc3luY2hlciwgX3RoaXMuX2RvbWFpbiwgbXlJZGVudGl0eSwgX3RoaXMpO1xyXG4gICAgICAgIHJlc29sdmUoY2hhdCk7XHJcblxyXG4gICAgICAgIGNoYXQuZGF0YU9iamVjdE9ic2VydmVyID0gZGF0YU9iamVjdE9ic2VydmVyO1xyXG5cclxuICAgICAgICBfdGhpcy5fb2JzZXJ2ZXJzQ29udHJvbGxlcnNbZGF0YU9iamVjdE9ic2VydmVyLnVybF0gPSBjaGF0O1xyXG5cclxuICAgICAgfSkuY2F0Y2goZnVuY3Rpb24ocmVhc29uKSB7XHJcbiAgICAgICAgcmVqZWN0KHJlYXNvbik7XHJcbiAgICAgIH0pO1xyXG4gICAgfSk7XHJcblxyXG4gIH1cclxuXHJcbn1cclxuXHJcbmV4cG9ydCBkZWZhdWx0IFNpbXBsZUNoYXRNYW5hZ2VyO1xyXG4iLCIvKipcclxuKiBDb3B5cmlnaHQgMjAxNiBQVCBJbm92YcOnw6NvIGUgU2lzdGVtYXMgU0FcclxuKiBDb3B5cmlnaHQgMjAxNiBJTkVTQy1JRFxyXG4qIENvcHlyaWdodCAyMDE2IFFVT0JJUyBORVRXT1JLUyBTTFxyXG4qIENvcHlyaWdodCAyMDE2IEZSQVVOSE9GRVItR0VTRUxMU0NIQUZUIFpVUiBGT0VSREVSVU5HIERFUiBBTkdFV0FORFRFTiBGT1JTQ0hVTkcgRS5WXHJcbiogQ29weXJpZ2h0IDIwMTYgT1JBTkdFIFNBXHJcbiogQ29weXJpZ2h0IDIwMTYgRGV1dHNjaGUgVGVsZWtvbSBBR1xyXG4qIENvcHlyaWdodCAyMDE2IEFwaXplZVxyXG4qIENvcHlyaWdodCAyMDE2IFRFQ0hOSVNDSEUgVU5JVkVSU0lUQVQgQkVSTElOXHJcbipcclxuKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4qIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuKlxyXG4qICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbipcclxuKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4qIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4qIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuKiovXHJcbmltcG9ydCBTeW5jaGVyIGZyb20gJy4uL3N5bmNoZXIvU3luY2hlcic7XHJcbmltcG9ydCBOb3RpZmljYXRpb25IYW5kbGVyIGZyb20gJy4uL3N5bmNoZXIvTm90aWZpY2F0aW9uSGFuZGxlcic7XHJcbmltcG9ydCB7ZGl2aWRlVVJMfSBmcm9tICcuLi91dGlscy91dGlscyc7XHJcbmltcG9ydCBJZGVudGl0eU1hbmFnZXIgZnJvbSAnLi4vaWRlbnRpdHkvSWRlbnRpdHlNYW5hZ2VyJztcclxuaW1wb3J0IERpc2NvdmVyeSBmcm9tICcuLi9kaXNjb3ZlcnkvRGlzY292ZXJ5JztcclxuaW1wb3J0IFJlZ2lzdHJhdGlvblN0YXR1cyBmcm9tICcuLi9kaXNjb3ZlcnkvUmVnaXN0cmF0aW9uU3RhdHVzJztcclxuaW1wb3J0IFNlYXJjaCBmcm9tICcuLi91dGlscy9TZWFyY2gnO1xyXG5pbXBvcnQgQ29udGV4dE9ic2VydmVyIGZyb20gJy4uL2NvbnRleHRNYW5hZ2VyL0NvbnRleHRPYnNlcnZlcic7XHJcbmltcG9ydCBDb250ZXh0UmVwb3J0ZXIgZnJvbSAnLi4vY29udGV4dE1hbmFnZXIvQ29udGV4dFJlcG9ydGVyJztcclxuaW1wb3J0IE1lc3NhZ2VCb2R5SWRlbnRpdHkgZnJvbSAnLi4vaWRlbnRpdHkvTWVzc2FnZUJvZHlJZGVudGl0eSc7XHJcbmltcG9ydCBDaGF0TWFuYWdlciBmcm9tICcuLi9jaGF0TWFuYWdlci9DaGF0TWFuYWdlcic7XHJcbmltcG9ydCBDaGF0Q29udHJvbGxlciBmcm9tICcuLi9jaGF0TWFuYWdlci9DaGF0Q29udHJvbGxlcic7XHJcbmltcG9ydCBTaW1wbGVDaGF0TWFuYWdlciBmcm9tICcuLi9jaGF0TWFuYWdlci9TaW1wbGVDaGF0TWFuYWdlcic7XHJcbmltcG9ydCBDaGF0IGZyb20gJy4uL2NoYXRNYW5hZ2VyL0NoYXQnO1xyXG5cclxuLyoqXHJcbiAqIEludGVybmFsIGNvbXBvbmVudCB0byBpbnN0YW50aWF0ZSBmcmFtZXdvcmsgZnVuY3Rpb25hbGl0aWVzLlxyXG4gKi9cclxuY2xhc3MgU2FuZGJveEZhY3Rvcnkge1xyXG4gIC8qIHByaXZhdGVcclxuICBfY29tcG9uZW50czogPHVybDogaW5zdGFuY2U+XHJcbiAgKi9cclxuXHJcbiAgY29uc3RydWN0b3IoYnVzKSB7XHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG4gICAgX3RoaXMuX2J1cyA9IGJ1cztcclxuICAgIF90aGlzLl9kaXZpZGVVUkwgPSBkaXZpZGVVUkw7XHJcblxyXG4gIH1cclxuXHJcbiAgY3JlYXRlU3luY2hlcihvd25lciwgYnVzLCBjb25maWcpIHsgXHJcbiAgICByZXR1cm4gbmV3IFN5bmNoZXIob3duZXIsIGJ1cywgY29uZmlnKTtcclxuICAgfVxyXG5cclxuICAgY3JlYXRlSWRlbnRpdHlNYW5hZ2VyKGh5cGVydHlVUkwsIHJ1bnRpbWVVUkwsIGJ1cykgeyBcclxuICAgIGxldCBfdGhpcyA9IHRoaXM7XHJcbiAgICByZXR1cm4gbmV3IElkZW50aXR5TWFuYWdlcihoeXBlcnR5VVJMLCBydW50aW1lVVJMLCBidXMpO1xyXG4gICB9XHJcblxyXG4gICBjcmVhdGVEaXNjb3ZlcnkoaHlwZXJ0eVVSTCwgcnVudGltZVVSTCwgYnVzKSB7IFxyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuICAgIHJldHVybiBuZXcgRGlzY292ZXJ5KGh5cGVydHlVUkwsIHJ1bnRpbWVVUkwsIGJ1cyk7XHJcbiAgIH1cclxuXHJcbiAgIGNyZWF0ZVNlYXJjaChkaXNjb3ZlcnksIGlkZW50aXR5TWFuYWdlcikgeyBcclxuICAgIGxldCBfdGhpcyA9IHRoaXM7XHJcbiAgICByZXR1cm4gbmV3IFNlYXJjaChkaXNjb3ZlcnksIGlkZW50aXR5TWFuYWdlcik7XHJcbiAgIH1cclxuXHJcbiAgIGNyZWF0ZUNvbnRleHRPYnNlcnZlcihoeXBlcnR5VVJMLCBidXMsIGNvbmZpZywgc2NoZW1lcykgeyBcclxuICAgIHJldHVybiBuZXcgQ29udGV4dE9ic2VydmVyKGh5cGVydHlVUkwsIGJ1cywgY29uZmlnLCBzY2hlbWVzLCB0aGlzKTtcclxuICAgfVxyXG5cclxuICAgY3JlYXRlQ29udGV4dFJlcG9ydGVyKGh5cGVydHlVUkwsIGJ1cywgY29uZmlnKSB7IFxyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuICAgIHJldHVybiBuZXcgQ29udGV4dFJlcG9ydGVyKGh5cGVydHlVUkwsIGJ1cywgY29uZmlnLCB0aGlzKTtcclxuICAgfVxyXG5cclxuICAgY3JlYXRlTm90aWZpY2F0aW9uSGFuZGxlcihidXMpIHsgXHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG4gICAgcmV0dXJuIG5ldyBOb3RpZmljYXRpb25IYW5kbGVyKGJ1cyk7XHJcbiAgIH1cclxuXHJcbiAgIGNyZWF0ZU1lc3NhZ2VCb2R5SWRlbnRpdHkodXNlcm5hbWUsIHVzZXJVUkwsIHBpY3R1cmUsIG5hbWUsIGxvY2FsZSwgaWRwLCBhc3NlcnRpb24sIHByb2ZpbGUpIHsgXHJcbiAgICByZXR1cm4gbmV3IE1lc3NhZ2VCb2R5SWRlbnRpdHkodXNlcm5hbWUsIHVzZXJVUkwsIHBpY3R1cmUsIG5hbWUsIGxvY2FsZSwgaWRwLCBhc3NlcnRpb24sIHByb2ZpbGUpO1xyXG4gICB9XHJcblxyXG4gICBjcmVhdGVDaGF0TWFuYWdlcihoeXBlcnR5VVJMLCBidXMsIGNvbmZpZ3VyYXRpb24sIHN5bmNoZXIpIHsgXHJcbiAgICByZXR1cm4gbmV3IENoYXRNYW5hZ2VyKGh5cGVydHlVUkwsIGJ1cywgY29uZmlndXJhdGlvbiwgc3luY2hlciwgdGhpcyk7XHJcbiAgIH1cclxuXHJcbiAgIGNyZWF0ZUNoYXRDb250cm9sbGVyKHN5bmNoZXIsIGRpc2NvdmVyeSwgZG9tYWluLCBzZWFyY2gsIGlkZW50aXR5LCBtYW5hZ2VyKSB7IFxyXG4gICAgcmV0dXJuIG5ldyBDaGF0Q29udHJvbGxlcihzeW5jaGVyLCBkaXNjb3ZlcnksIGRvbWFpbiwgc2VhcmNoLCBpZGVudGl0eSwgbWFuYWdlcik7XHJcbiAgIH1cclxuXHJcbiAgIGNyZWF0ZVNpbXBsZUNoYXRNYW5hZ2VyKGh5cGVydHlVUkwsIGJ1cywgY29uZmlndXJhdGlvbiwgc3luY2hlcikgeyBcclxuICAgIHJldHVybiBuZXcgU2ltcGxlQ2hhdE1hbmFnZXIoaHlwZXJ0eVVSTCwgYnVzLCBjb25maWd1cmF0aW9uLCBzeW5jaGVyLCB0aGlzKTtcclxuICAgfVxyXG5cclxuICAgY3JlYXRlQ2hhdChzeW5jaGVyLCBkb21haW4sIGlkZW50aXR5LCBtYW5hZ2VyKSB7IFxyXG4gICAgcmV0dXJuIG5ldyBDaGF0KHN5bmNoZXIsIGRvbWFpbiwgaWRlbnRpdHksIG1hbmFnZXIpO1xyXG4gICB9XHJcbiAgIGdldCBkaXZpZGVVUkwoKXtcclxuICAgICByZXR1cm4gdGhpcy5fZGl2aWRlVVJMO1xyXG4gICB9XHJcblxyXG4gICBjcmVhdGVSZWdpc3RyYXRpb25TdGF0dXMob2JzZXJ2ZXIsIHJ1bnRpbWVVUkwsIGNoYXRVcmwsIGJ1cykge1xyXG4gICAgcmV0dXJuIG5ldyBSZWdpc3RyYXRpb25TdGF0dXMob2JzZXJ2ZXIsIHJ1bnRpbWVVUkwsIGNoYXRVcmwsIGJ1cyk7XHJcblxyXG4gIH1cclxuXHJcblxyXG5cclxufVxyXG5cclxuXHJcbmV4cG9ydCBkZWZhdWx0IFNhbmRib3hGYWN0b3J5O1xyXG4iLCIvKipcclxuKiBDb3B5cmlnaHQgMjAxNiBQVCBJbm92YcOnw6NvIGUgU2lzdGVtYXMgU0FcclxuKiBDb3B5cmlnaHQgMjAxNiBJTkVTQy1JRFxyXG4qIENvcHlyaWdodCAyMDE2IFFVT0JJUyBORVRXT1JLUyBTTFxyXG4qIENvcHlyaWdodCAyMDE2IEZSQVVOSE9GRVItR0VTRUxMU0NIQUZUIFpVUiBGT0VSREVSVU5HIERFUiBBTkdFV0FORFRFTiBGT1JTQ0hVTkcgRS5WXHJcbiogQ29weXJpZ2h0IDIwMTYgT1JBTkdFIFNBXHJcbiogQ29weXJpZ2h0IDIwMTYgRGV1dHNjaGUgVGVsZWtvbSBBR1xyXG4qIENvcHlyaWdodCAyMDE2IEFwaXplZVxyXG4qIENvcHlyaWdodCAyMDE2IFRFQ0hOSVNDSEUgVU5JVkVSU0lUQVQgQkVSTElOXHJcbipcclxuKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4qIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuKlxyXG4qICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbipcclxuKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4qIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4qIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuKiovXHJcbi8qKlxyXG4gKiBAYXV0aG9yIG1pY2FlbHBlZHJvc2FAZ21haWwuY29tXHJcbiAqIEJhc2UgY2xhc3MgdG8gaW1wbGVtZW50IGludGVybmFsIGRlcGxveSBtYW5hZ2VyIG9mIGNvbXBvbmVudHMuXHJcbiAqL1xyXG5pbXBvcnQgU2FuZGJveEZhY3RvcnkgZnJvbSAnLi9TYW5kYm94RmFjdG9yeSc7XHJcblxyXG4vKipcclxuICogQGF1dGhvciBtaWNhZWxwZWRyb3NhQGdtYWlsLmNvbVxyXG4gKiBJbnRlcm5hbCBjb21wb25lbnQgcmVnaXN0cnkgb2YgYWxsIHNhbmRib3hlcy5cclxuICogUHJvY2VzcyBpbnRlcm5hbCByZXF1ZXN0J3MgZm9yIGNvbXBvbmVudCBkZXBsb3kuXHJcbiAqL1xyXG5jbGFzcyBTYW5kYm94UmVnaXN0cnkge1xyXG4gIC8qIHByaXZhdGVcclxuICBfY29tcG9uZW50czogPHVybDogaW5zdGFuY2U+XHJcbiAgKi9cclxuXHJcbiAgY29uc3RydWN0b3IoYnVzKSB7XHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG5cclxuICAgIF90aGlzLl9idXMgPSBidXM7XHJcbiAgICBfdGhpcy5fZmFjdG9yeSA9IG5ldyBTYW5kYm94RmFjdG9yeShidXMpO1xyXG4gICAgX3RoaXMuX2NvbXBvbmVudHMgPSB7fTtcclxuXHJcbiAgICBidXMuYWRkTGlzdGVuZXIoU2FuZGJveFJlZ2lzdHJ5LkludGVybmFsRGVwbG95QWRkcmVzcywgKG1zZykgPT4ge1xyXG4gICAgICBjb25zb2xlLmxvZygnU2FuZGJveFJlZ2lzdHJ5LVJDVjogJywgbXNnKTtcclxuICAgICAgLy8gbGV0IHJlc3BvbnNlTXNnID0ge1xyXG4gICAgICAvLyAgIGlkOiBtc2cuaWQsIHR5cGU6ICdyZXNwb25zZScsIGZyb206IFNhbmRib3hSZWdpc3RyeS5JbnRlcm5hbERlcGxveUFkZHJlc3MsIHRvOiBTYW5kYm94UmVnaXN0cnkuRXh0ZXJuYWxEZXBsb3lBZGRyZXNzXHJcbiAgICAgIC8vIH07XHJcblxyXG4gICAgICBzd2l0Y2ggKG1zZy50eXBlKSB7XHJcbiAgICAgICAgY2FzZSAnY3JlYXRlJzogX3RoaXMuX29uRGVwbG95KG1zZyk7IGJyZWFrO1xyXG4gICAgICAgIGNhc2UgJ2RlbGV0ZSc6IF90aGlzLl9vblJlbW92ZShtc2cpOyBicmVhaztcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBnZXQgY29tcG9uZW50cygpIHsgcmV0dXJuIHRoaXMuX2NvbXBvbmVudHM7IH1cclxuXHJcbiAgX3Jlc3BvbnNlTXNnKG1zZywgY29kZSwgdmFsdWUpIHtcclxuXHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG5cclxuICAgIC8vIGxldCBtZXNzYWdlRmFjdG9yeSA9IF90aGlzLm1lc3NhZ2VGYWN0b3J5O1xyXG5cclxuICAgIC8vRkxPVy1PVVQ6IGdlbmVyaWMgcmVzcG9uc2UgbWVzc2FnZSB0byBleHRlcm5hbCBTYW5kYm94IChkZXBsb3kgYW5kIHVuLWRlcGxveSByZXNwb25zZXMpXHJcbiAgICBsZXQgcmVzcG9uc2VNc2cgPSB7XHJcbiAgICAgIGlkOiBtc2cuaWQsIHR5cGU6ICdyZXNwb25zZScsIGZyb206IFNhbmRib3hSZWdpc3RyeS5JbnRlcm5hbERlcGxveUFkZHJlc3MsIHRvOiBTYW5kYm94UmVnaXN0cnkuRXh0ZXJuYWxEZXBsb3lBZGRyZXNzXHJcbiAgICB9O1xyXG5cclxuICAgIC8vIENoYW5lZ2UgdGhlIG9yaWdpbiBtZXNzYWdlLCBiZWNhdXNlIHRoZSByZXNwb25zZTtcclxuICAgIC8vIG1zZy5mcm9tID0gU2FuZGJveFJlZ2lzdHJ5LkludGVybmFsRGVwbG95QWRkcmVzcztcclxuICAgIC8vIG1zZy50byA9IFNhbmRib3hSZWdpc3RyeS5FeHRlcm5hbERlcGxveUFkZHJlc3M7XHJcblxyXG4gICAgbGV0IGJvZHkgPSB7fTtcclxuICAgIGlmIChjb2RlKSBib2R5LmNvZGUgPSBjb2RlO1xyXG4gICAgaWYgKHZhbHVlKSBib2R5LmRlc2MgPSB2YWx1ZTtcclxuXHJcbiAgICByZXNwb25zZU1zZy5ib2R5ID0gYm9keTtcclxuXHJcbiAgICAvLyByZXR1cm4gbWVzc2FnZUZhY3RvcnkuY3JlYXRlUmVzcG9uc2UobXNnLCBjb2RlLCB2YWx1ZSk7XHJcbiAgICByZXR1cm4gcmVzcG9uc2VNc2c7XHJcbiAgfVxyXG5cclxuICAvL0ZMT1ctSU46IG1lc3NhZ2UgZnJvbSB0aGUgcnVudGltZSBjb3JlIFNhbmRib3ggLT4gZGVwbG95Q29tcG9uZW50XHJcbiAgX29uRGVwbG95KG1zZykge1xyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuICAgIGxldCBjb25maWcgPSBtc2cuYm9keS5jb25maWc7XHJcbiAgICBsZXQgY29tcG9uZW50VVJMID0gbXNnLmJvZHkudXJsO1xyXG4gICAgbGV0IHNvdXJjZUNvZGUgPSBtc2cuYm9keS5zb3VyY2VDb2RlO1xyXG4gICAgbGV0IHJlc3BvbnNlQ29kZTtcclxuICAgIGxldCByZXNwb25zZURlc2M7XHJcblxyXG4gICAgaWYgKCFfdGhpcy5fY29tcG9uZW50cy5oYXNPd25Qcm9wZXJ0eShjb21wb25lbnRVUkwpKSB7XHJcbiAgICAgIHRyeSB7XHJcbiAgICAgIGNvbnNvbGUubG9nKCdTYW5kYm94UmVnaXN0cnktb25EZXBsb3k6ICcsIG1zZyk7XHJcbiAgICAgIF90aGlzLl9jb21wb25lbnRzW2NvbXBvbmVudFVSTF0gPSBfdGhpcy5fY3JlYXRlKGNvbXBvbmVudFVSTCwgc291cmNlQ29kZSwgY29uZmlnLCBfdGhpcy5fZmFjdG9yeSApO1xyXG4gICAgICAgIHJlc3BvbnNlQ29kZSA9IDIwMDtcclxuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgICByZXNwb25zZUNvZGUgPSA1MDA7XHJcbiAgICAgICAgcmVzcG9uc2VEZXNjID0gZXJyb3I7XHJcbiAgICAgIH1cclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHJlc3BvbnNlQ29kZSA9IDUwMDtcclxuICAgICAgcmVzcG9uc2VEZXNjID0gJ0luc3RhbmNlICcgKyBjb21wb25lbnRVUkwgKyAnIGFscmVhZHkgZXhpc3QhJztcclxuICAgIH1cclxuXHJcbiAgICBsZXQgcmVzcG9uc2VNc2cgPSBfdGhpcy5fcmVzcG9uc2VNc2cobXNnLCByZXNwb25zZUNvZGUsIHJlc3BvbnNlRGVzYyk7XHJcbiAgICBfdGhpcy5fYnVzLnBvc3RNZXNzYWdlKHJlc3BvbnNlTXNnKTtcclxuICB9XHJcblxyXG4gIC8vRkxPVy1JTjogbWVzc2FnZSBmcm9tIHRoZSBydW50aW1lIGNvcmUgU2FuZGJveCAtPiByZW1vdmVDb21wb25lbnRcclxuICBfb25SZW1vdmUobXNnKSB7XHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG4gICAgbGV0IGNvbXBvbmVudFVSTCA9IG1zZy5ib2R5LnVybDtcclxuICAgIGxldCByZXNwb25zZUNvZGU7XHJcbiAgICBsZXQgcmVzcG9uc2VEZXNjO1xyXG5cclxuICAgIGlmIChfdGhpcy5fY29tcG9uZW50cy5oYXNPd25Qcm9wZXJ0eShjb21wb25lbnRVUkwpKSB7XHJcbiAgICAgIC8vcmVtb3ZlIGNvbXBvbmVudCBmcm9tIHRoZSBwb29sIGFuZCBhbGwgbGlzdGVuZXJzXHJcbiAgICAgIGRlbGV0ZSBfdGhpcy5fY29tcG9uZW50c1tjb21wb25lbnRVUkxdO1xyXG4gICAgICBfdGhpcy5fYnVzLnJlbW92ZUFsbExpc3RlbmVyc09mKGNvbXBvbmVudFVSTCk7XHJcbiAgICAgIHJlc3BvbnNlQ29kZSA9IDIwMDtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHJlc3BvbnNlQ29kZSA9IDUwMDtcclxuICAgICAgcmVzcG9uc2VEZXNjID0gJ0luc3RhbmNlICcgKyBjb21wb25lbnRVUkwgKyAnIGRvZXNuXFwndCBleGlzdCEnO1xyXG4gICAgfVxyXG5cclxuICAgIGxldCByZXNwb25zZU1zZyA9IF90aGlzLl9yZXNwb25zZU1zZyhtc2csIHJlc3BvbnNlQ29kZSwgcmVzcG9uc2VEZXNjKTtcclxuXHJcbiAgICBfdGhpcy5fYnVzLnBvc3RNZXNzYWdlKHJlc3BvbnNlTXNnKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFRoaXMgbWV0aG9kIHNob3VsZCBiZSBpbXBsZW1lbnRlZCBieSB0aGUgaW50ZXJuYWwgc2FuZGJveCBjb2RlLlxyXG4gICAqIEBwYXJhbSAge0NvbXBvbmVudFVSTH0gdXJsIFVSTCB1c2VkIGZvciB0aGUgaW5zdGFuY2VcclxuICAgKiBAcGFyYW0gIHtzdHJpbmd9IHNvdXJjZUNvZGUgQ29kZSBvZiB0aGUgY29tcG9uZW50XHJcbiAgICogQHBhcmFtICB7Q29uZmlnfSBjb25maWcgQ29uZmlndXJhdGlvbiBwYXJhbWV0ZXJzXHJcbiAgICogQHJldHVybiB7T2JqZWN0fSBSZXR1cm5zIGluc3RhbmNlIG9mIHRoZSBjb21wb25lbnQgb3IgdGhyb3cgYW4gZXJyb3IgXCJ0aHJvdyAnZXJyb3IgbWVzc2FnZSdcIlxyXG4gICAqL1xyXG4gIF9jcmVhdGUodXJsLCBzb3VyY2VDb2RlLCBjb25maWcsIGZhY3RvcnkpIHtcclxuICAgIC8vaW1wbGVtZW50YXRpb24gc3BlY2lmaWNcclxuICAgIC8qIGV4YW1wbGUgY29kZTpcclxuICAgICAgZXZhbChzb3VyY2VDb2RlKTtcclxuICAgICAgcmV0dXJuIGFjdGl2YXRlKHVybCwgX3RoaXMuX2J1cywgY29uZmlnKTtcclxuICAgICovXHJcbiAgfVxyXG59XHJcblxyXG5TYW5kYm94UmVnaXN0cnkuRXh0ZXJuYWxEZXBsb3lBZGRyZXNzID0gJ2h5cGVydHktcnVudGltZTovL3NhbmRib3gvZXh0ZXJuYWwnO1xyXG5TYW5kYm94UmVnaXN0cnkuSW50ZXJuYWxEZXBsb3lBZGRyZXNzID0gJ2h5cGVydHktcnVudGltZTovL3NhbmRib3gvaW50ZXJuYWwnO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgU2FuZGJveFJlZ2lzdHJ5O1xyXG4iLCIvKipcclxuKiBDb3B5cmlnaHQgMjAxNiBQVCBJbm92YcOnw6NvIGUgU2lzdGVtYXMgU0FcclxuKiBDb3B5cmlnaHQgMjAxNiBJTkVTQy1JRFxyXG4qIENvcHlyaWdodCAyMDE2IFFVT0JJUyBORVRXT1JLUyBTTFxyXG4qIENvcHlyaWdodCAyMDE2IEZSQVVOSE9GRVItR0VTRUxMU0NIQUZUIFpVUiBGT0VSREVSVU5HIERFUiBBTkdFV0FORFRFTiBGT1JTQ0hVTkcgRS5WXHJcbiogQ29weXJpZ2h0IDIwMTYgT1JBTkdFIFNBXHJcbiogQ29weXJpZ2h0IDIwMTYgRGV1dHNjaGUgVGVsZWtvbSBBR1xyXG4qIENvcHlyaWdodCAyMDE2IEFwaXplZVxyXG4qIENvcHlyaWdodCAyMDE2IFRFQ0hOSVNDSEUgVU5JVkVSU0lUQVQgQkVSTElOXHJcbipcclxuKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4qIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuKlxyXG4qICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbipcclxuKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4qIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4qIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuKiovXHJcblxyXG4vLyBMb2cgc3lzdGVtXHJcbmltcG9ydCAqIGFzIGxvZ2dlciBmcm9tICdsb2dsZXZlbCc7XHJcbmxldCBsb2cgPSBsb2dnZXIuZ2V0TG9nZ2VyKCdCdXMnKTtcclxuXHJcbi8qKlxyXG4qIEBhdXRob3IgbWljYWVscGVkcm9zYUBnbWFpbC5jb21cclxuKiBNaW5pbWFsIGludGVyZmFjZSBhbmQgaW1wbGVtZW50YXRpb24gdG8gc2VuZCBhbmQgcmVjZWl2ZSBtZXNzYWdlcy4gSXQgY2FuIGJlIHJldXNlZCBpbiBtYW55IHR5cGUgb2YgY29tcG9uZW50cy5cclxuKiBDb21wb25lbnRzIHRoYXQgbmVlZCBhIG1lc3NhZ2Ugc3lzdGVtIHNob3VsZCByZWNlaXZlIHRoaXMgY2xhc3MgYXMgYSBkZXBlbmRlbmN5IG9yIGV4dGVuZCBpdC5cclxuKiBFeHRlbnNpb25zIHNob3VsZCBpbXBsZW1lbnQgdGhlIGZvbGxvd2luZyBwcml2YXRlIG1ldGhvZHM6IF9vblBvc3RNZXNzYWdlIGFuZCBfcmVnaXN0ZXJFeHRlcm5hbExpc3RlbmVyXHJcbiovXHJcbmNsYXNzIEJ1cyB7XHJcbiAgLyogcHJpdmF0ZVxyXG4gIF9tc2dJZDogbnVtYmVyO1xyXG4gIF9zdWJzY3JpcHRpb25zOiA8dXJsOiBNc2dMaXN0ZW5lcltdPlxyXG5cclxuICBfcmVzcG9uc2VUaW1lT3V0OiBudW1iZXJcclxuICBfcmVzcG9uc2VDYWxsYmFja3M6IDx1cmwraWQ6IChtc2cpID0+IHZvaWQ+XHJcblxyXG4gICovXHJcblxyXG4gIGNvbnN0cnVjdG9yKCkge1xyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuICAgIF90aGlzLl9tc2dJZCA9IDA7XHJcbiAgICBfdGhpcy5fc3Vic2NyaXB0aW9ucyA9IHt9O1xyXG5cclxuICAgIF90aGlzLl9yZXNwb25zZVRpbWVPdXQgPSAxNTAwMDsgLy9kZWZhdWx0IHRvIDNzXHJcbiAgICBfdGhpcy5fcmVzcG9uc2VDYWxsYmFja3MgPSB7fTtcclxuXHJcbiAgICBfdGhpcy5fcmVnaXN0ZXJFeHRlcm5hbExpc3RlbmVyKCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAqIFJlZ2lzdGVyIGxpc3RlbmVyIHRvIHJlY2VpdmUgbWVzc2FnZSB3aGVuIFwibXNnLnRvID09PSB1cmxcIi5cclxuICAqIFNwZWNpYWwgdXJsIFwiKlwiIGZvciBkZWZhdWx0IGxpc3RlbmVyIGlzIGFjY2VwdGVkIHRvIGludGVyY2VwdCBhbGwgbWVzc2FnZXMuXHJcbiAgKiBAcGFyYW0ge1VSTH0gdXJsIEFkZHJlc3MgdG8gaW50ZXJjZXB0LCB0aGEgaXMgaW4gdGhlIG1lc3NhZ2UgXCJ0b1wiXHJcbiAgKiBAcGFyYW0ge0xpc3RlbmVyfSBsaXN0ZW5lciBsaXN0ZW5lclxyXG4gICogQHJldHVybiB7TXNnTGlzdGVuZXJ9IGluc3RhbmNlIG9mIE1zZ0xpc3RlbmVyXHJcbiAgKi9cclxuICBhZGRMaXN0ZW5lcih1cmwsIGxpc3RlbmVyKSB7XHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG5cclxuICAgIGxldCBpdGVtID0gbmV3IE1zZ0xpc3RlbmVyKF90aGlzLl9zdWJzY3JpcHRpb25zLCB1cmwsIGxpc3RlbmVyKTtcclxuICAgIGxldCBpdGVtTGlzdCA9IF90aGlzLl9zdWJzY3JpcHRpb25zW3VybF07XHJcbiAgICBpZiAoIWl0ZW1MaXN0KSB7XHJcbiAgICAgIGl0ZW1MaXN0ID0gW107XHJcbiAgICAgIF90aGlzLl9zdWJzY3JpcHRpb25zW3VybF0gPSBpdGVtTGlzdDtcclxuICAgIH1cclxuXHJcbiAgICBpdGVtTGlzdC5wdXNoKGl0ZW0pO1xyXG4gICAgcmV0dXJuIGl0ZW07XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBNYW51YWxseSBhZGQgYSByZXNwb25zZSBsaXN0ZW5lci4gT25seSBvbmUgbGlzdGVuZXIgcGVyIG1lc3NhZ2UgSUQgc2hvdWxkIGV4aXN0LlxyXG4gICAqIEFURU5USU9OLCB0aGVyZSBpcyBubyB0aW1lb3V0IGZvciB0aGlzIGxpc3RlbmVyLlxyXG4gICAqIFRoZSBsaXN0ZW5lciBzaG91bGQgYmUgcmVtb3ZlZCB3aXRoIGEgcmVtb3ZlUmVzcG9uc2VMaXN0ZW5lciwgZmFpbGluZyB0byBkbyB0aGlzIHdpbGwgcmVzdWx0IGluIGEgdW5yZWxlYXNlZCBtZW1vcnkgcHJvYmxlbS5cclxuICAgKiBAcGFyYW0ge1VSTH0gdXJsIE9yaWdpbiBhZGRyZXNzIG9mIHRoZSBtZXNzYWdlIHNlbnQsIFwibXNnLmZyb21cIi5cclxuICAgKiBAcGFyYW0ge251bWJlcn0gbXNnSWQgTWVzc2FnZSBJRCB0aGF0IGlzIHJldHVybmVkIGZyb20gdGhlIHBvc3RNZXNzYWdlLlxyXG4gICAqIEBwYXJhbSB7RnVuY3Rpb259IHJlc3BvbnNlTGlzdGVuZXIgQ2FsbGJhY2sgZnVuY3Rpb24gZm9yIHRoZSByZXNwb25zZVxyXG4gICAqL1xyXG4gIGFkZFJlc3BvbnNlTGlzdGVuZXIodXJsLCBtc2dJZCwgcmVzcG9uc2VMaXN0ZW5lcikge1xyXG4gICAgdGhpcy5fcmVzcG9uc2VDYWxsYmFja3NbdXJsICsgbXNnSWRdID0gcmVzcG9uc2VMaXN0ZW5lcjtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFJlbW92ZSB0aGUgcmVzcG9uc2UgbGlzdGVuZXIuXHJcbiAgICogQHBhcmFtIHtVUkx9IHVybCBPcmlnaW4gYWRkcmVzcyBvZiB0aGUgbWVzc2FnZSBzZW50LCBcIm1zZy5mcm9tXCIuXHJcbiAgICogQHBhcmFtIHtudW1iZXJ9IG1zZ0lkICBNZXNzYWdlIElEIHRoYXQgaXMgcmV0dXJuZWQgZnJvbSB0aGUgcG9zdE1lc3NhZ2VcclxuICAgKi9cclxuICByZW1vdmVSZXNwb25zZUxpc3RlbmVyKHVybCwgbXNnSWQpIHtcclxuICAgIGRlbGV0ZSB0aGlzLl9yZXNwb25zZUNhbGxiYWNrc1t1cmwgKyBtc2dJZF07XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBSZW1vdmUgYWxsIGV4aXN0ZW50IGxpc3RlbmVycyBmb3IgdGhlIFVSTFxyXG4gICAqIEBwYXJhbSAge1VSTH0gdXJsIEFkZHJlc3MgcmVnaXN0ZXJlZFxyXG4gICAqL1xyXG4gIHJlbW92ZUFsbExpc3RlbmVyc09mKHVybCkge1xyXG4gICAgZGVsZXRlIHRoaXMuX3N1YnNjcmlwdGlvbnNbdXJsXTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEhlbHBlciBtZXRob2QgdG8gYmluZCBsaXN0ZW5lcnMgKGluIGJvdGggZGlyZWN0aW9ucykgaW50byBvdGhlciBNaW5pQnVzIHRhcmdldC5cclxuICAgKiBAcGFyYW0gIHtVUkx9IG91dFVybCBPdXRib3VuZCBVUkwsIHJlZ2lzdGVyIGxpc3RlbmVyIGZvciB1cmwgaW4gZGlyZWN0aW9uIFwidGhpcyAtPiB0YXJnZXRcIlxyXG4gICAqIEBwYXJhbSAge1VSTH0gaW5VcmwgSW5ib3VuZCBVUkwsIHJlZ2lzdGVyIGxpc3RlbmVyIGZvciB1cmwgaW4gZGlyZWN0aW9uIFwidGFyZ2V0IC0+IHRoaXNcIlxyXG4gICAqIEBwYXJhbSAge01pbmlCdXN9IHRhcmdldCBUaGUgb3RoZXIgdGFyZ2V0IE1pbmlCdXNcclxuICAgKiBAcmV0dXJuIHtCb3VuZH0gYW4gb2JqZWN0IHRoYXQgY29udGFpbnMgdGhlIHByb3BlcnRpZXMgW3RoaXNMaXN0ZW5lciwgdGFyZ2V0TGlzdGVuZXJdIGFuZCB0aGUgdW5iaW5kIG1ldGhvZC5cclxuICAgKi9cclxuICBiaW5kKG91dFVybCwgaW5VcmwsIHRhcmdldCkge1xyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuXHJcbiAgICBsZXQgdGhpc0xpc3RuID0gX3RoaXMuYWRkTGlzdGVuZXIob3V0VXJsLCAobXNnKSA9PiB7XHJcbiAgICAgIHRhcmdldC5wb3N0TWVzc2FnZShtc2cpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgbGV0IHRhcmdldExpc3RuID0gdGFyZ2V0LmFkZExpc3RlbmVyKGluVXJsLCAobXNnKSA9PiB7XHJcbiAgICAgIF90aGlzLnBvc3RNZXNzYWdlKG1zZyk7XHJcbiAgICB9KTtcclxuXHJcbiAgICByZXR1cm4ge1xyXG4gICAgICB0aGlzTGlzdGVuZXI6IHRoaXNMaXN0bixcclxuICAgICAgdGFyZ2V0TGlzdGVuZXI6IHRhcmdldExpc3RuLFxyXG4gICAgICB1bmJpbmQ6ICgpID0+IHtcclxuICAgICAgICB0aGlzLnRoaXNMaXN0ZW5lci5yZW1vdmUoKTtcclxuICAgICAgICB0aGlzLnRhcmdldExpc3RlbmVyLnJlbW92ZSgpO1xyXG4gICAgICB9XHJcbiAgICB9O1xyXG4gIH1cclxuXHJcbiAgLy9wdWJsaXNoIG9uIGRlZmF1bHQgbGlzdGVuZXJzXHJcbiAgX3B1Ymxpc2hPbkRlZmF1bHQobXNnKSB7XHJcbiAgICAvL2lzIHRoZXJlIGFueSBcIipcIiAoZGVmYXVsdCkgbGlzdGVuZXJzP1xyXG4gICAgbGV0IGl0ZW1MaXN0ID0gdGhpcy5fc3Vic2NyaXB0aW9uc1snKiddO1xyXG4gICAgaWYgKGl0ZW1MaXN0KSB7XHJcbiAgICAgIHRoaXMuX3B1Ymxpc2hPbihpdGVtTGlzdCwgbXNnKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8vcHVibGlzaCBvbiBhIHN1YnNjcmlwdGlvbiBsaXN0LlxyXG4gIF9wdWJsaXNoT24oaXRlbUxpc3QsIG1zZykge1xyXG4gICAgaXRlbUxpc3QuZm9yRWFjaCgoc3ViKSA9PiB7XHJcbiAgICAgIHN1Yi5fY2FsbGJhY2sobXNnKTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgX3Jlc3BvbnNlQ2FsbGJhY2soaW5Nc2csIHJlc3BvbnNlQ2FsbGJhY2ssIHRpbWVvdXQgPSB0cnVlKSB7XHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG5cclxuICAgIC8vYXV0b21hdGljIG1hbmFnZW1lbnQgb2YgcmVzcG9uc2UgaGFuZGxlcnNcclxuICAgIGlmIChyZXNwb25zZUNhbGxiYWNrKSB7XHJcbiAgICAgIGxldCByZXNwb25zZUlkID0gaW5Nc2cuZnJvbSArIGluTXNnLmlkO1xyXG4gICAgICBfdGhpcy5fcmVzcG9uc2VDYWxsYmFja3NbcmVzcG9uc2VJZF0gPSByZXNwb25zZUNhbGxiYWNrO1xyXG5cclxuICAgICAgaWYgKHRpbWVvdXQpIHtcclxuICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICAgIGxldCByZXNwb25zZUZ1biA9IF90aGlzLl9yZXNwb25zZUNhbGxiYWNrc1tyZXNwb25zZUlkXTtcclxuICAgICAgICAgIGRlbGV0ZSBfdGhpcy5fcmVzcG9uc2VDYWxsYmFja3NbcmVzcG9uc2VJZF07XHJcblxyXG4gICAgICAgICAgaWYgKHJlc3BvbnNlRnVuKSB7XHJcbiAgICAgICAgICAgIGxldCBlcnJvck1zZyA9IHtcclxuICAgICAgICAgICAgICBpZDogaW5Nc2cuaWQsIHR5cGU6ICdyZXNwb25zZScsXHJcbiAgICAgICAgICAgICAgYm9keTogeyBjb2RlOiA0MDgsIGRlc2M6ICdSZXNwb25zZSB0aW1lb3V0IScsIHZhbHVlOiBpbk1zZyB9XHJcbiAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICByZXNwb25zZUZ1bihlcnJvck1zZyk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSwgX3RoaXMuX3Jlc3BvbnNlVGltZU91dCk7XHJcbiAgICAgIH1cclxuXHJcbiAgICB9XHJcbiAgfVxyXG5cclxuLy9UT0RPOiBwcm92aXNpb25hbCByZXNwb25zZXMgc2hvdWxkIHJlc2V0IHRpbWVvdXRcclxuICBfb25SZXNwb25zZShtc2cpIHtcclxuICAgIGxldCBfdGhpcyA9IHRoaXM7XHJcblxyXG4gICAgaWYgKG1zZy50eXBlID09PSAncmVzcG9uc2UnKSB7XHJcbiAgICAgIGxldCByZXNwb25zZUlkID0gbXNnLnRvICsgbXNnLmlkO1xyXG4gICAgICBsZXQgcmVzcG9uc2VGdW4gPSBfdGhpcy5fcmVzcG9uc2VDYWxsYmFja3NbcmVzcG9uc2VJZF07XHJcblxyXG4gICAgICBpZiAobXNnLmJvZHkuY29kZSA+PSAyMDApIHsgLy9pZiBpdCdzIGEgcHJvdmlzaW9uYWwgcmVzcG9uc2UsIGRvbid0IGRlbGV0ZSByZXNwb25zZSBsaXN0ZW5lclxyXG4gICAgICAgIGRlbGV0ZSBfdGhpcy5fcmVzcG9uc2VDYWxsYmFja3NbcmVzcG9uc2VJZF07XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGlmIChyZXNwb25zZUZ1bikge1xyXG4gICAgICAgIHJlc3BvbnNlRnVuKG1zZyk7XHJcbiAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgIH1cclxuXHJcblxyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBmYWxzZTtcclxuICB9XHJcblxyXG4gIC8vcmVjZWl2ZSBtZXNzYWdlcyBmcm9tIGV4dGVybmFsIGludGVyZmFjZVxyXG4gIF9vbk1lc3NhZ2UobXNnKSB7XHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG5cclxuICAgIGlmICghX3RoaXMuX29uUmVzcG9uc2UobXNnKSkge1xyXG4gICAgICBsZXQgaXRlbUxpc3QgPSBfdGhpcy5fc3Vic2NyaXB0aW9uc1ttc2cudG9dO1xyXG4gICAgICBpZiAoaXRlbUxpc3QpIHtcclxuICAgICAgICBfdGhpcy5fcHVibGlzaE9uKGl0ZW1MaXN0LCBtc2cpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIF90aGlzLl9wdWJsaXNoT25EZWZhdWx0KG1zZyk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcblxyXG4gIF9nZW5JZChpbk1zZykge1xyXG4gICAgLy9UT0RPOiBob3cgZG8gd2UgbWFuYWdlIG1lc3NhZ2UgSUQncz8gU2hvdWxkIGl0IGJlIGEgZ2xvYmFsIHJ1bnRpbWUgY291bnRlciwgb3IgcGVyIFVSTCBhZGRyZXNzP1xyXG4gICAgLy9HbG9iYWwgY291bnRlciB3aWxsIG5vdCB3b3JrLCBiZWNhdXNlIHRoZXJlIHdpbGwgYmUgbXVsdGlwbGUgTWluaUJ1cyBpbnN0YW5jZXMhXHJcbiAgICAvL1BlciBVUkwsIGNhbiBiZSBhIGxvdCBvZiBkYXRhIHRvIG1haW50YWluIVxyXG4gICAgLy9NYXliZSBhIGNvdW50ZXIgcGVyIE1pbmlCdXMgaW5zdGFuY2UuIFRoaXMgaXMgdGhlIGFzc3VtZWQgc29sdXRpb24gZm9yIG5vdy5cclxuICAgIGlmICghaW5Nc2cuaWQgfHwgaW5Nc2cuaWQgPT09IDApIHtcclxuICAgICAgdGhpcy5fbXNnSWQrKztcclxuICAgICAgaW5Nc2cuaWQgPSB0aGlzLl9tc2dJZDtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICogU2VuZCBtZXNzYWdlcyB0byBsb2NhbCBsaXN0ZW5lcnMsIG9yIGlmIG5vdCBleGlzdHMgdG8gZXh0ZXJuYWwgbGlzdGVuZXJzLlxyXG4gICogSXQncyBoYXMgYW4gb3B0aW9uYWwgbWVjaGFuaXNtIGZvciBhdXRvbWF0aWMgbWFuYWdlbWVudCBvZiByZXNwb25zZSBoYW5kbGVycy5cclxuICAqIFRoZSByZXNwb25zZSBoYW5kbGVyIHdpbGwgYmUgdW5yZWdpc3RlcmVkIGFmdGVyIHJlY2VpdmluZyB0aGUgcmVzcG9uc2UsIG9yIGFmdGVyIHJlc3BvbnNlIHRpbWVvdXQgKGRlZmF1bHQgdG8gM3MpLlxyXG4gICogQHBhcmFtICB7TWVzc2FnZX0gbXNnIE1lc3NhZ2UgdG8gc2VuZC4gTWVzc2FnZSBJRCBpcyBhdXRvbWF0aWNhbGx5IGFkZGVkIHRvIHRoZSBtZXNzYWdlLlxyXG4gICogQHBhcmFtICB7RnVuY3Rpb259IHJlc3BvbnNlQ2FsbGJhY2sgT3B0aW9uYWwgcGFyYW1ldGVyLCBpZiB0aGUgZGV2ZWxvcGVyIHdoYXQncyBhdXRvbWF0aWMgcmVzcG9uc2UgbWFuYWdlbWVudC5cclxuICAqIEByZXR1cm4ge251bWJlcn0gUmV0dXJucyB0aGUgbWVzc2FnZSBJRCwgaW4gY2FzZSBpdCBzaG91bGQgYmUgbmVlZGVkIGZvciBtYW51YWwgbWFuYWdlbWVudCBvZiB0aGUgcmVzcG9uc2UgaGFuZGxlci5cclxuICAqL1xyXG4gIHBvc3RNZXNzYWdlKGluTXNnLCByZXNwb25zZUNhbGxiYWNrKSB7IH1cclxuXHJcbiAgLyoqXHJcbiAgICogRnVuY3Rpb24gdG8gcG9zdCBtZXNzYWdlcyB3aXRoIGEgbnVtYmVyIG9mIHJldHJpZXMgaW4gY2FzZSB0aW1lb3V0cyBvY2N1ci5cclxuICAgKiBAcGFyYW0gIHtNZXNzYWdlfSBtc2cgTWVzc2FnZSB0byBzZW5kLiBNZXNzYWdlIElEIGlzIGF1dG9tYXRpY2FsbHkgYWRkZWQgdG8gdGhlIG1lc3NhZ2UuXHJcbiAgICogQHBhcmFtICB7RnVuY3Rpb259IHJlc3BvbnNlQ2FsbGJhY2sgT3B0aW9uYWwgcGFyYW1ldGVyLCBpZiB0aGUgZGV2ZWxvcGVyIHdoYXQncyBhdXRvbWF0aWMgcmVzcG9uc2UgbWFuYWdlbWVudC5cclxuICAgKiBAcGFyYW0gIHtpbnRlZ2VyfSByZXRyaWVzIG51bWJlciBvZiByZXRyaWVzIHdoZW4gdGltZW91dHMgb2NjdXJcclxuICAgKiBAcmV0dXJuIHtib29sZWFufSBtZXNzYWdlIGRlbGl2ZXJ5IHJlc3VsdDtcclxuICAgKi9cclxuXHJcblxyXG4gIHBvc3RNZXNzYWdlV2l0aFJldHJpZXMobXNnLCByZXRyaWVzLCBjYWxsYmFjaykge1xyXG5cclxuICAgIGxldCBfdGhpcyA9IHRoaXM7XHJcblxyXG4gICAgbGV0IHJldHJ5ID0gMDtcclxuICAgIC8vbGV0IHRpbWVvdXQgPSB0cnVlO1xyXG5cclxuICAgIGxldCBzZW5kTXNnID0gZnVuY3Rpb24oKSB7XHJcblxyXG4gICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xyXG4gICAgICAgIF90aGlzLnBvc3RNZXNzYWdlKG1zZywgKHJlcGx5KSA9PiB7XHJcbiAgICAgICAgICBpZiAocmVwbHkuYm9keS5jb2RlID09PSA0MDggfHwgcmVwbHkuYm9keS5jb2RlID09PSA1MDApIHJlamVjdCgpO1xyXG4gICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIGxvZy5pbmZvKCdbQnVzLnBvc3RNZXNzYWdlV2l0aFJldHJpZXNdIG1zZyBkZWxpdmVyZWQ6ICcsIG1zZyk7XHJcbiAgICAgICAgICAgIGNhbGxiYWNrKHJlcGx5KTtcclxuICAgICAgICAgICAgcmVzb2x2ZSgpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgICB9KTtcclxuICAgIH07XHJcblxyXG4gICAgbGV0IHRyeUFnYWluID0gKCkgPT4ge1xyXG4gICAgICBzZW5kTXNnKCkudGhlbigoKT0+e1xyXG4gICAgICAgIC8vdGltZW91dCA9IGZhbHNlO1xyXG4gICAgICAgIHJldHVybjtcclxuICAgICAgfSwgKCk9PntcclxuICAgICAgICBsb2cud2FybihgW0J1cy5wb3N0TWVzc2FnZVdpdGhSZXRyaWVzXSBNZXNzYWdlIEJvdW5jZWQgKHJldHJ5ICR7cmV0cnl9KTogJ2AsIG1zZyk7XHJcbiAgICAgICAgaWYgKHJldHJ5KysgPCByZXRyaWVzKSB7XHJcbiAgICAgICAgICB0cnlBZ2FpbigpO1xyXG4gICAgICAgICAgLy8gc2V0VGltZW91dCgoKSA9PiB7IHRyeUFnYWluKCk7IH0sIDEwMDApO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICBjb25zdCBlcnJvciA9IGBbRXJyb3JdIE1lc3NhZ2UgQm91bmNlZCAoZGVsaXZlcnkgYXR0ZW1wdHMgJHtyZXRyaWVzfSk6ICdgO1xyXG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGVycm9yICsgbXNnKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG4gICAgfTtcclxuICAgIHRyeUFnYWluKCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBOb3QgcHVibGljIGF2YWlsYWJsZSwgdXNlZCBieSB0aGUgY2xhc3MgZXh0ZW5zaW9uIGltcGxlbWVudGF0aW9uLCB0byBwcm9jZXNzIG1lc3NhZ2VzIGZyb20gdGhlIHB1YmxpYyBcInBvc3RNZXNzYWdlXCIgd2l0aG91dCBhIHJlZ2lzdGVyZWQgbGlzdGVuZXIuXHJcbiAgICogVXNlZCB0byBzZW5kIHRoZSBtZXNzYWdlIHRvIGFuIGV4dGVybmFsIGludGVyZmFjZSwgbGlrZSBhIFdlYldvcmtlciwgSUZyYW1lLCBldGMuXHJcbiAgICogQHBhcmFtICB7TWVzc2FnZS5NZXNzYWdlfSBtc2cgTWVzc2FnZVxyXG4gICAqL1xyXG4gIF9vblBvc3RNZXNzYWdlKG1zZykgeyAvKmltcGxlbWVudGF0aW9uIHdpbGwgc2VuZCBtZXNzYWdlIHRvIGV4dGVybmFsIHN5c3RlbSovIH1cclxuXHJcbiAgLyoqXHJcbiAgICogTm90IHB1YmxpYyBhdmFpbGFibGUsIHVzZWQgYnkgdGhlIGNsYXNzIGV4dGVuc2lvbiBpbXBsZW1lbnRhdGlvbiwgdG8gcHJvY2VzcyBhbGwgbWVzc2FnZXMgdGhhdCBlbnRlciB0aGUgTWluaUJ1cyBmcm9tIGFuIGV4dGVybmFsIGludGVyZmFjZSwgbGlrZSBhIFdlYldvcmtlciwgSUZyYW1lLCBldGMuXHJcbiAgICogVGhpcyBtZXRob2QgaXMgY2FsbGVkIG9uZSB0aW1lIGluIHRoZSBjb25zdHJ1Y3RvciB0byByZWdpc3RlciBleHRlcm5hbCBsaXN0ZW5lcnMuXHJcbiAgICogVGhlIGltcGxlbWVudGF0aW9uIHdpbGwgcHJvYmFibHkgY2FsbCB0aGUgXCJfb25NZXNzYWdlXCIgbWV0aG9kIHRvIHB1Ymxpc2ggaW4gdGhlIGxvY2FsIGxpc3RlbmVycy5cclxuICAgKiBETyBOT1QgY2FsbCBcInBvc3RNZXNzYWdlXCIsIHRoZXJlIGlzIGEgZGFuZ2VyIHRoYXQgdGhlIG1lc3NhZ2UgZW50ZXJzIGluIGEgY3ljbGUhXHJcbiAgICovXHJcbiAgX3JlZ2lzdGVyRXh0ZXJuYWxMaXN0ZW5lcigpIHsgLyppbXBsZW1lbnRhdGlvbiB3aWxsIHJlZ2lzdGVyIGV4dGVybmFsIGxpc3RlbmVyIGFuZCBjYWxsIFwidGhpcy5fb25NZXNzYWdlKG1zZylcIiAqLyB9XHJcblxyXG59XHJcblxyXG5jbGFzcyBNc2dMaXN0ZW5lciB7XHJcbiAgLyogcHJpdmF0ZVxyXG4gIF9zdWJzY3JpcHRpb25zOiA8c3RyaW5nOiBNc2dMaXN0ZW5lcltdPjtcclxuICBfdXJsOiBzdHJpbmc7XHJcbiAgX2NhbGxiYWNrOiAobXNnKSA9PiB2b2lkO1xyXG4gICovXHJcblxyXG4gIGNvbnN0cnVjdG9yKHN1YnNjcmlwdGlvbnMsIHVybCwgY2FsbGJhY2spIHtcclxuICAgIGxldCBfdGhpcyA9IHRoaXM7XHJcblxyXG4gICAgX3RoaXMuX3N1YnNjcmlwdGlvbnMgPSBzdWJzY3JpcHRpb25zO1xyXG4gICAgX3RoaXMuX3VybCA9IHVybDtcclxuICAgIF90aGlzLl9jYWxsYmFjayA9IGNhbGxiYWNrO1xyXG4gIH1cclxuXHJcbiAgZ2V0IHVybCgpIHsgcmV0dXJuIHRoaXMuX3VybDsgfVxyXG5cclxuICAvKipcclxuICAgKiBSZW1vdmUgdGhpcyBsaXN0ZW5lciBmcm9tIHRoZSBCdXNcclxuICAgKi9cclxuICByZW1vdmUoKSB7XHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG5cclxuICAgIGxldCBzdWJzID0gX3RoaXMuX3N1YnNjcmlwdGlvbnNbX3RoaXMuX3VybF07XHJcbiAgICBpZiAoc3Vicykge1xyXG4gICAgICBsZXQgaW5kZXggPSBzdWJzLmluZGV4T2YoX3RoaXMpO1xyXG4gICAgICBzdWJzLnNwbGljZShpbmRleCwgMSk7XHJcblxyXG4gICAgICAvL2lmIHRoZXJlIGFyZSBubyBsaXN0ZW5lcnMsIHJlbW92ZSB0aGUgc3Vic2NyaXB0aW9uIGVudGlyZWx5LlxyXG4gICAgICBpZiAoc3Vicy5sZW5ndGggPT09IDApIHtcclxuICAgICAgICBkZWxldGUgX3RoaXMuX3N1YnNjcmlwdGlvbnNbX3RoaXMuX3VybF07XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBkZWZhdWx0IEJ1cztcclxuIiwiLyoqXHJcbiogQ29weXJpZ2h0IDIwMTYgUFQgSW5vdmHDp8OjbyBlIFNpc3RlbWFzIFNBXHJcbiogQ29weXJpZ2h0IDIwMTYgSU5FU0MtSURcclxuKiBDb3B5cmlnaHQgMjAxNiBRVU9CSVMgTkVUV09SS1MgU0xcclxuKiBDb3B5cmlnaHQgMjAxNiBGUkFVTkhPRkVSLUdFU0VMTFNDSEFGVCBaVVIgRk9FUkRFUlVORyBERVIgQU5HRVdBTkRURU4gRk9SU0NIVU5HIEUuVlxyXG4qIENvcHlyaWdodCAyMDE2IE9SQU5HRSBTQVxyXG4qIENvcHlyaWdodCAyMDE2IERldXRzY2hlIFRlbGVrb20gQUdcclxuKiBDb3B5cmlnaHQgMjAxNiBBcGl6ZWVcclxuKiBDb3B5cmlnaHQgMjAxNiBURUNITklTQ0hFIFVOSVZFUlNJVEFUIEJFUkxJTlxyXG4qXHJcbiogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbipcclxuKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4qXHJcbiogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4qIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbioqL1xyXG5pbXBvcnQgQnVzIGZyb20gJy4vQnVzJztcclxuXHJcbi8qKlxyXG4qIEBhdXRob3IgbWljYWVscGVkcm9zYUBnbWFpbC5jb21cclxuKiBNZXNzYWdlIEJVUyBJbnRlcmZhY2UgaXMgYW4gZXh0ZW5zaW9uIG9mIHRoZSBCdXNcclxuKiBJdCBpcyB1c2VkIG1haW5seSBpbiB0aGUgaW50ZXJuYWwgc2FuZGJveCByb3V0aW5nLlxyXG4qL1xyXG5jbGFzcyBNaW5pQnVzIGV4dGVuZHMgQnVzIHtcclxuXHJcbiAgY29uc3RydWN0b3IoKSB7XHJcbiAgICBzdXBlcigpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogUG9zdCBhIG1lc3NhZ2UgZm9yIHJvdXRpbmcuIE1lc3NhZ2UgaXMgcm91dGVkIGRpcmVjdGx5IHRvIHRoZSBleHRlcm5hbCByb3V0aW5nIF9vblBvc3RNZXNzYWdlLlxyXG4gICAqIEBwYXJhbSAge01lc3NhZ2V9IGluTXNnICAgICAgICAgICAgSlNPTiB3aXRoIG1hbmRhdG9yeSBNZXNzYWdlIHN0cnVjdHVyZSB7aWQsIHR5cGUsIGZyb20sIHRvfVxyXG4gICAqIEBwYXJhbSAge0NhbGxiYWNrfSByZXNwb25zZUNhbGxiYWNrIE9wdGlvbmFsIGNhbGxiYWNrIGlmIGEgcmVzcG9uc2UgaXMgZXhwZWN0ZWQgZnJvbSB0aGUgcmVxdWVzdC4gQSByZXNwb25zZSB3aWxsIGJlIGFsd2F5cyBzZW50LCBldmVuIGlmIGl0IGlzIGEgXCJUaW1lb3V0XCIuXHJcbiAgICogQHJldHVybiB7bnVtYmVyfSAgICAgICAgICAgICAgICAgIHRoZSBNZXNzYWdlIGlkXHJcbiAgICovXHJcbiAgcG9zdE1lc3NhZ2UoaW5Nc2csIHJlc3BvbnNlQ2FsbGJhY2ssIHRpbWVvdXQpIHtcclxuICAgIGxldCBfdGhpcyA9IHRoaXM7XHJcblxyXG4gICAgX3RoaXMuX2dlbklkKGluTXNnKTtcclxuICAgIF90aGlzLl9yZXNwb25zZUNhbGxiYWNrKGluTXNnLCByZXNwb25zZUNhbGxiYWNrLCB0aW1lb3V0KTtcclxuXHJcbiAgICAvL2Fsd2F5cyBzZW5kIHRvIGV4dGVybmFsICh0byBjb3JlIE1lc3NhZ2VCdXMpXHJcbiAgICBfdGhpcy5fb25Qb3N0TWVzc2FnZShpbk1zZyk7XHJcblxyXG4gICAgcmV0dXJuIGluTXNnLmlkO1xyXG4gIH1cclxuXHJcbiAgLy9pbnRlcm5hbCBtZXRob2QgdXNlZCB3aGVuIGEgbWVzc2FnZSBpcyByZWNlaXZlZCBieSBhbiBleHRlcm5hbCByb3V0aW5nIHN5c3RlbVxyXG4gIF9vbk1lc3NhZ2UobXNnKSB7XHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG5cclxuICAgIGlmICghX3RoaXMuX29uUmVzcG9uc2UobXNnKSkge1xyXG4gICAgICBsZXQgaXRlbUxpc3QgPSBfdGhpcy5fc3Vic2NyaXB0aW9uc1ttc2cudG9dO1xyXG4gICAgICBpZiAoaXRlbUxpc3QpIHtcclxuICAgICAgICBfdGhpcy5fcHVibGlzaE9uKGl0ZW1MaXN0LCBtc2cpO1xyXG4gICAgICAgIGlmICghbXNnLnRvLnN0YXJ0c1dpdGgoJ2h5cGVydHknKSkge1xyXG4gICAgICAgICAgX3RoaXMuX3B1Ymxpc2hPbkRlZmF1bHQobXNnKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgX3RoaXMuX3B1Ymxpc2hPbkRlZmF1bHQobXNnKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbn1cclxuXHJcbmV4cG9ydCBkZWZhdWx0IE1pbmlCdXM7XHJcbiIsIi8qKlxyXG4qIENvcHlyaWdodCAyMDE2IFBUIElub3Zhw6fDo28gZSBTaXN0ZW1hcyBTQVxyXG4qIENvcHlyaWdodCAyMDE2IElORVNDLUlEXHJcbiogQ29weXJpZ2h0IDIwMTYgUVVPQklTIE5FVFdPUktTIFNMXHJcbiogQ29weXJpZ2h0IDIwMTYgRlJBVU5IT0ZFUi1HRVNFTExTQ0hBRlQgWlVSIEZPRVJERVJVTkcgREVSIEFOR0VXQU5EVEVOIEZPUlNDSFVORyBFLlZcclxuKiBDb3B5cmlnaHQgMjAxNiBPUkFOR0UgU0FcclxuKiBDb3B5cmlnaHQgMjAxNiBEZXV0c2NoZSBUZWxla29tIEFHXHJcbiogQ29weXJpZ2h0IDIwMTYgQXBpemVlXHJcbiogQ29weXJpZ2h0IDIwMTYgVEVDSE5JU0NIRSBVTklWRVJTSVRBVCBCRVJMSU5cclxuKlxyXG4qIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4qIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4qXHJcbiogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuKlxyXG4qIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4qIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4qKi9cclxuaW1wb3J0IFNhbmRib3hSZWdpc3RyeSBmcm9tICcuL1NhbmRib3hSZWdpc3RyeSc7XHJcbmltcG9ydCBNaW5pQnVzIGZyb20gJy4uL2J1cy9NaW5pQnVzJztcclxuXHJcblxyXG5leHBvcnQgbGV0IFNhbmRib3hUeXBlID0ge0FQUDogJ2FwcCcsIE5PUk1BTDogJ25vcm1hbCcsIFdJTkRPVzogJ3dpbmRvdyd9O1xyXG5cclxuLyoqXHJcbiAqIEBhdXRob3IgbWljYWVscGVkcm9zYUBnbWFpbC5jb21cclxuICogQmFzZSBjbGFzcyB0byBpbXBsZW1lbnQgZXh0ZXJuYWwgc2FuZGJveCBjb21wb25lbnRcclxuICovXHJcbmNsYXNzIFNhbmRib3ggZXh0ZW5kcyBNaW5pQnVzIHtcclxuXHJcbiAgY29uc3RydWN0b3IoY2FwYWJpbGl0aWVzKSB7XHJcblxyXG4gICAgc3VwZXIoKTtcclxuXHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG5cclxuICAgIGlmIChjYXBhYmlsaXRpZXMpICAgICAgeyBfdGhpcy5jYXBhYmlsaXRpZXMgPSBjYXBhYmlsaXRpZXM7IH1cclxuXHJcblxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogRGVwbG95IGFuIGluc3RhbmNlIG9mIHRoZSBjb21wb25lbnQgaW50byB0aGUgc2FuZGJveC5cclxuICAgKiBAcGFyYW0gIHtzdHJpbmd9IGNvbXBvbmVudFNvdXJjZUNvZGUgQ29tcG9uZW50IHNvdXJjZSBjb2RlIChIeXBlcnR5LCBQcm90b1N0dWIsIGV0YylcclxuICAgKiBAcGFyYW0gIHtVUkx9IGNvbXBvbmVudFVSTCBIeXBlcnR5LCBQcm90b1N0dWIsIG9yIGFueSBvdGhlciBjb21wb25lbnQgYWRkcmVzcy5cclxuICAgKiBAcGFyYW0gIHtDb25maWd9IGNvbmZpZ3VyYXRpb24gQ29uZmlnIHBhcmFtZXRlcnMgb2YgdGhlIGNvbXBvbmVudFxyXG4gICAqIEByZXR1cm4ge1Byb21pc2U8c3RyaW5nPn0gcmV0dXJuIGRlcGxveWVkIGlmIHN1Y2Nlc3NmdWwsIG9yIGFueSBvdGhlciBzdHJpbmcgd2l0aCBhbiBlcnJvclxyXG4gICAqL1xyXG4gIGRlcGxveUNvbXBvbmVudChjb21wb25lbnRTb3VyY2VDb2RlLCBjb21wb25lbnRVUkwsIGNvbmZpZ3VyYXRpb24pIHtcclxuXHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG5cclxuICAgIC8vIGxldCBtZXNzYWdlRmFjdG9yeSA9IF90aGlzLm1lc3NhZ2VGYWN0b3J5O1xyXG5cclxuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XHJcbiAgICAgIC8vRkxPVy1PVVQ6IGRlcGxveSBtZXNzYWdlIGZvciB0aGUgaW50ZXJuYWwgU2FuZGJveFJlZ2lzdHJ5IC0+IF9vbkRlcGxveVxyXG4gICAgICBsZXQgZGVwbG95TWVzc2FnZSA9IHtcclxuICAgICAgICB0eXBlOiAnY3JlYXRlJywgZnJvbTogU2FuZGJveFJlZ2lzdHJ5LkV4dGVybmFsRGVwbG95QWRkcmVzcywgdG86IFNhbmRib3hSZWdpc3RyeS5JbnRlcm5hbERlcGxveUFkZHJlc3MsXHJcbiAgICAgICAgYm9keTogeyB1cmw6IGNvbXBvbmVudFVSTCwgc291cmNlQ29kZTogY29tcG9uZW50U291cmNlQ29kZSwgY29uZmlnOiBjb25maWd1cmF0aW9uIH1cclxuICAgICAgfTtcclxuXHJcbiAgICAgIC8vc2VuZCBtZXNzYWdlIGludG8gdGhlIHNhbmRib3ggaW50ZXJuYWxzIGFuZCB3YWl0IGZvciByZXBseVxyXG4gICAgICBfdGhpcy5wb3N0TWVzc2FnZShkZXBsb3lNZXNzYWdlLCAocmVwbHkpID0+IHtcclxuICAgICAgICBpZiAocmVwbHkuYm9keS5jb2RlID09PSAyMDApIHtcclxuICAgICAgICAgIC8vaXMgdGhpcyByZXNwb25zZSBjb21wbGFpbnQgd2l0aCB0aGUgc3BlYz9cclxuICAgICAgICAgIHJlc29sdmUoJ2RlcGxveWVkJyk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIHJlamVjdChyZXBseS5ib2R5LmRlc2MpO1xyXG4gICAgICAgIH1cclxuICAgICAgfSk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFJlbW92ZSB0aGUgaW5zdGFuY2Ugb2YgYSBwcmV2aW91c2x5IGRlcGxveWVkIGNvbXBvbmVudC5cclxuICAgKiBAcGFyYW0gIHtVUkx9IGNvbXBvbmVudFVSTCBIeXBlcnR5LCBQcm90b1N0dWIsIG9yIGFueSBvdGhlciBjb21wb25lbnQgYWRkcmVzcy5cclxuICAgKiBAcmV0dXJuIHtQcm9taXNlPHN0cmluZz59IHJldHVybiB1bmRlcGxveWVkIGlmIHN1Y2Nlc3NmdWwsIG9yIGFueSBvdGhlciBzdHJpbmcgd2l0aCBhbiBlcnJvclxyXG4gICAqL1xyXG4gIHJlbW92ZUNvbXBvbmVudChjb21wb25lbnRVUkwpIHtcclxuICAgIGxldCBfdGhpcyA9IHRoaXM7XHJcblxyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcclxuICAgICAgLy9GTE9XLU9VVDogdW4tZGVwbG95IG1lc3NhZ2UgZm9yIHRoZSBpbnRlcm5hbCBTYW5kYm94UmVnaXN0cnkgLT4gX29uUmVtb3ZlXHJcbiAgICAgIGxldCByZW1vdmVNZXNzYWdlID0ge1xyXG4gICAgICAgIHR5cGU6ICdkZWxldGUnLCBmcm9tOiBTYW5kYm94UmVnaXN0cnkuRXh0ZXJuYWxEZXBsb3lBZGRyZXNzLCB0bzogU2FuZGJveFJlZ2lzdHJ5LkludGVybmFsRGVwbG95QWRkcmVzcyxcclxuICAgICAgICBib2R5OiB7IHVybDogY29tcG9uZW50VVJMIH1cclxuICAgICAgfTtcclxuXHJcbiAgICAgIC8vc2VuZCBtZXNzYWdlIGludG8gdGhlIHNhbmRib3ggaW50ZXJuYWxzIGFuZCB3YWl0IGZvciByZXBseVxyXG4gICAgICBfdGhpcy5wb3N0TWVzc2FnZShyZW1vdmVNZXNzYWdlLCAocmVwbHkpID0+IHtcclxuICAgICAgICBpZiAocmVwbHkuYm9keS5jb2RlID09PSAyMDApIHtcclxuICAgICAgICAgIC8vaXMgdGhpcyByZXNwb25zZSBjb21wbGFpbnQgd2l0aCB0aGUgc3BlYz9cclxuICAgICAgICAgIHJlc29sdmUoJ3VuZGVwbG95ZWQnKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgcmVqZWN0KHJlcGx5LmJvZHkuZGVzYyk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgKiBNYXRjaGVzIFNhbmRib3ggY2FwYWJpbGl0aWVzIGFnYWluc3QgcHJvdmlkZWQgY2FwYWJpbGl0aWVzLiBVc2VkIHRvIGNoZWNrIGlmIHNhbmRib3ggcHJvdmlkZXMgYWxsIHJlcXVpcmVkIGNhcGFiaWxpdGllc1xyXG4gICogQHBhcmFtICB7UnVudGltZUNhcGFiaWxpdGllc30gY29uc3RyYWludHMgc2V0IG9mIFJ1bnRpbWVDYXBhYmlsaXRpZXMgdG8gbWF0Y2ggd2l0aC5cclxuICAqIEByZXR1cm4ge2Jvb2xlYW59IHJldHVybiB0cnVlIGlmIGNvbnN0cmFpbnRzIGFyZSBtYXRjaGVkIGZhbHNlIG90aGVyd2lzZVxyXG4gICAqL1xyXG5cclxuICBtYXRjaGVzKGNvbnN0cmFpbnRzKSB7XHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG5cclxuICAgIGxldCBmaWx0ZXJlZCA9IE9iamVjdC5rZXlzKGNvbnN0cmFpbnRzKS5maWx0ZXIoKGtleSkgPT4ge1xyXG4gICAgICByZXR1cm4gIShfdGhpcy5jYXBhYmlsaXRpZXNba2V5XSAmJiBfdGhpcy5jYXBhYmlsaXRpZXNba2V5XSA9PT0gY29uc3RyYWludHNba2V5XSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpZiAoZmlsdGVyZWQubGVuZ3RoID09PSAwKSAgICAgIHsgcmV0dXJuIHRydWU7IH0gICAgZWxzZSAgICAgIHsgcmV0dXJuICEoY29uc3RyYWludHNbZmlsdGVyZWRdKTsgfVxyXG4gIH1cclxuXHJcbn1cclxuXHJcbmV4cG9ydCBkZWZhdWx0IFNhbmRib3g7XHJcbiIsIi8qKlxyXG4qIENvcHlyaWdodCAyMDE2IFBUIElub3Zhw6fDo28gZSBTaXN0ZW1hcyBTQVxyXG4qIENvcHlyaWdodCAyMDE2IElORVNDLUlEXHJcbiogQ29weXJpZ2h0IDIwMTYgUVVPQklTIE5FVFdPUktTIFNMXHJcbiogQ29weXJpZ2h0IDIwMTYgRlJBVU5IT0ZFUi1HRVNFTExTQ0hBRlQgWlVSIEZPRVJERVJVTkcgREVSIEFOR0VXQU5EVEVOIEZPUlNDSFVORyBFLlZcclxuKiBDb3B5cmlnaHQgMjAxNiBPUkFOR0UgU0FcclxuKiBDb3B5cmlnaHQgMjAxNiBEZXV0c2NoZSBUZWxla29tIEFHXHJcbiogQ29weXJpZ2h0IDIwMTYgQXBpemVlXHJcbiogQ29weXJpZ2h0IDIwMTYgVEVDSE5JU0NIRSBVTklWRVJTSVRBVCBCRVJMSU5cclxuKlxyXG4qIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4qIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4qXHJcbiogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuKlxyXG4qIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4qIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4qKi9cclxuXHJcbi8vIExvZyBzeXN0ZW1cclxuaW1wb3J0ICogYXMgbG9nZ2VyIGZyb20gJ2xvZ2xldmVsJztcclxubGV0IGxvZyA9IGxvZ2dlci5nZXRMb2dnZXIoJ2FkZHJlc3MtYWxsb2NhdGlvbicpO1xyXG5cclxuXHJcbmltcG9ydCB7aXNVUkwsIGdlbmVyYXRlR1VJRH0gZnJvbSAnLi4vdXRpbHMvdXRpbHMnO1xyXG5cclxuLy8gVE9ETzogdGhpcyBjb3VsZCBub3QgYmUgdGhlIGJlc3Qgd2F5IHRvIGRvIGEgU2luZ2xldG9uIGJ1dCBhdCB0aGlzIG1vbWVudCBpdCB3b3JrcztcclxuXHJcbmxldCBpbnN0YW5jZTtcclxuXHJcbi8qKlxyXG4gKiBDbGFzcyB3aWxsIGFzayB0byB0aGUgbWVzc2FnZSBub2RlIGZvciBhZGRyZXNzZXNcclxuICovXHJcbmNsYXNzIEFkZHJlc3NBbGxvY2F0aW9uIHtcclxuICAvKiBwcml2YXRlXHJcbiAgX3VybDogVVJMXHJcbiAgX2J1czogTWluaUJ1c1xyXG4gICovXHJcblxyXG4gIC8qKlxyXG4gICAqIENyZWF0ZSBhbiBBZGRyZXNzIEFsbG9jYXRpb25cclxuICAgKiBAcGFyYW0gIHtVUkwuVVJMfSAgICAgIHVybCAtIHVybCBmcm9tIHdobyBpcyBzZW5kaW5nIHRoZSBtZXNzYWdlXHJcbiAgICogQHBhcmFtICB7TWluaUJ1c30gICAgICBidXMgLSBNaW5pQnVzIHVzZWQgZm9yIGFkZHJlc3MgYWxsb2NhdGlvblxyXG4gICAqL1xyXG4gIGNvbnN0cnVjdG9yKHVybCwgYnVzLCByZWdpc3RyeSwgc3Vic2NyaXB0aW9uTWFuYWdlcikge1xyXG5cclxuICAgIGlmICghaW5zdGFuY2UpIHtcclxuICAgICAgdGhpcy5fdXJsID0gdXJsICsgJy9hZGRyZXNzLWFsbG9jYXRpb24nO1xyXG4gICAgICB0aGlzLl9idXMgPSBidXM7XHJcbiAgICAgIHRoaXMuX3JlZ2lzdHJ5ID0gcmVnaXN0cnk7XHJcbiAgICAgIHRoaXMuX3N1YnNjcmlwdGlvbk1hbmFnZXIgPSBzdWJzY3JpcHRpb25NYW5hZ2VyO1xyXG4gICAgICBpbnN0YW5jZSA9IHRoaXM7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICByZXR1cm4gaW5zdGFuY2U7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBzdGF0aWMgZ2V0IGluc3RhbmNlKCkge1xyXG4gICAgaWYgKCFpbnN0YW5jZSkge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ1RoZSBhZGRyZXNzIGFsbG9jYXRpb24gd2FzIG5vdCBpbnN0YW50aWF0ZWQnKTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gaW5zdGFuY2VcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIGdldCB0aGUgVVJMIHZhbHVlXHJcbiAgICogQHJldHVybiB7c3RyaW5nfSBUaGUgdXJsIHZhbHVlO1xyXG4gICAqL1xyXG4gIGdldCB1cmwoKSB7IHJldHVybiB0aGlzLl91cmw7IH1cclxuXHJcblxyXG4gIC8qKlxyXG4gICAqXHJcbiAgICogQXNrIGZvciBjcmVhdGlvbiBvZiBhIG51bWJlciBvZiBIeXBlcnR5IGFkZHJlc3NlcywgdG8gdGhlIGRvbWFpbiBtZXNzYWdlIG5vZGUuXHJcbiAgICpcclxuICAgKiBAcGFyYW0ge0RvbWFpbn0gZG9tYWluIC0gZG9tYWluIG9mIHRoZSBtZXNzYWdlIG5vZGVcclxuICAgKiBAcGFyYW0ge051bWJlcn0gbnVtYmVyIC0gbnVtYmVyIG9mIGFkZHJlc3MgdG8gYmUgYWxsb2NhdGVkXHJcbiAgICogQHBhcmFtIHtEZXNjcmlwdG9yfSBpbmZvIC0gZGVzY3JpcHRvciB0byBzZWFyY2ggZm9yIHRoZSBoeXBlcnR5IChUT0RPOi8vIHRoaXMgc2hvdWxkIGJlIGNvbmZpcm1lZClcclxuICAgKiBAc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9yZVRISU5LLXByb2plY3Qvc3BlY3MvYmxvYi9tYXN0ZXIvZGF0YW1vZGVsL2NvcmUvaHlwZXJ0eS1jYXRhbG9ndWUvcmVhZG1lLm1kI2NhdGFsb2d1ZS1kYXRhLW1vZGVsXHJcbiAgICogQHBhcmFtIHtzY2hlbWV9IHNjaGVtZSAtIHNjaGVtZSBvZiBhZGRyZXNzIHRvIGJlIGNyZWF0ZWQgb3IgcmV1c2VkLCBsaWtlOiBoeXBlcnR5LCBjb21tLCBjb250ZXh0LCBldGM7XHJcbiAgICogQHBhcmFtIHtib29sZWFufFVSTC5IeXBlcnR5VVJMfSByZXVzZVVSTCAtIHJldXNlVVJMIGlzIHVzZWQgdG8gcmV1c2UgdGhlIGh5cGVydHlVUkwgcHJldmlvdXNseSByZWdpc3RyZWQ7XHJcbiAgICogQHJldHVybnMge1Byb21pc2U8T2JqZWN0LCBFcnJvcj59IHRoaXMgaXMgUHJvbWlzZSBhbmQgcmV0dXJucyBhbiBvYmplY3Qgd2l0aCB0aGUgYWRkcmVzcyBpbmZvcm1hdGlvblxyXG4gICAqXHJcbiAgICogQG1lbWJlck9mIEFkZHJlc3NBbGxvY2F0aW9uXHJcbiAgICovXHJcbiAgY3JlYXRlKGRvbWFpbiwgbnVtYmVyLCBpbmZvLCBzY2hlbWUsIHJldXNlVVJMKSB7XHJcblxyXG4gICAgbG9nLmxvZygnW0FkZHJlc3NBbGxvY2F0aW9uLmNyZWF0ZV0gaW5mbyAnLCBpbmZvKTtcclxuICAgIC8vZGVidWdnZXI7XHJcbiAgICBpZiAocmV1c2VVUkwpIHtcclxuXHJcbiAgICAgIGlmICh0eXBlb2YocmV1c2VVUkwpID09PSAnYm9vbGVhbicpIHtcclxuXHJcbiAgICAgICAgaWYgKHJldXNlVVJMKSB7XHJcbiAgICAgICAgICByZXR1cm4gdGhpcy5fcmV1c2VBbGxvY2F0ZWRBZGRyZXNzKGRvbWFpbiwgbnVtYmVyLCBpbmZvLCBzY2hlbWUsIHJldXNlVVJMKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgcmV0dXJuIHRoaXMuX2FsbG9jYXRlTmV3QWRkcmVzcyhkb21haW4sIHNjaGVtZSwgbnVtYmVyLCBpbmZvKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICB9XHJcblxyXG4gICAgICBpZiAodHlwZW9mKHJldXNlVVJMKSA9PT0gJ3N0cmluZycgJiYgaXNVUkwocmV1c2VVUkwpKSB7XHJcbiAgICAgICAgLy9yZXR1cm4gdGhpcy5fcmV1c2VBbGxvY2F0ZWRBZGRyZXNzKGRvbWFpbiwgbnVtYmVyLCBpbmZvLCBzY2hlbWUsIHJldXNlVVJMKTtcclxuICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xyXG4gICAgICAgICAgbGV0IHZhbHVlID0geyBuZXdBZGRyZXNzOiBmYWxzZSwgYWRkcmVzczogW3JldXNlVVJMXSB9O1xyXG4gICAgICAgICAgcmV0dXJuIHJlc29sdmUodmFsdWUpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICB9XHJcblxyXG4gICAgfSBlbHNlIHtcclxuICAgICAgbG9nLmxvZygnW0FkZHJlc3NBbGxvY2F0aW9uXSAtIG5ldyBhZGRyZXNzIHdpbGwgYmUgYWxsb2NhdGVkJyk7XHJcblxyXG4gICAgICAvLyBpZiB0aGVyZSBpcyBubyBVUkwgc2F2ZWQgcmVxdWVzdCBhIG5ldyBVUkxcclxuICAgICAgcmV0dXJuIHRoaXMuX2FsbG9jYXRlTmV3QWRkcmVzcyhkb21haW4sIHNjaGVtZSwgbnVtYmVyLCBpbmZvKTtcclxuICAgIH1cclxuXHJcbiAgfVxyXG5cclxuICBfcmV1c2VBbGxvY2F0ZWRBZGRyZXNzKGRvbWFpbiwgbnVtYmVyLCBpbmZvLCBzY2hlbWUsIHJldXNlVVJMKSB7XHJcblxyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcclxuXHJcbiAgICAgIGNvbnNvbGUubG9nKCdSRVVTRVRFU1QgLSAgX3JldXNlQWxsb2NhdGVkQWRkcmVzcycsIGRvbWFpbiwgbnVtYmVyLCBpbmZvLCBzY2hlbWUsIHJldXNlVVJMKTtcclxuICAgICAgdGhpcy5fcmVnaXN0cnkuY2hlY2tSZWdpc3RlcmVkVVJMcyhpbmZvLCByZXVzZVVSTCkudGhlbigodXJscykgPT4ge1xyXG4gICAgICAgIGNvbnNvbGUubG9nKCdSRVVTRVRFU1QgLSAgcmVnaXN0ZXJlZHVybHMnLCB1cmxzKTtcclxuICAgICAgICBpZiAodXJscykge1xyXG4gICAgICAgICAgbG9nLmluZm8oJ1tBZGRyZXNzQWxsb2NhdGlvbiAtICcgKyBzY2hlbWUgKyAnXSAtIFJldXNlIFVSTCcpO1xyXG4gICAgICAgICAgbGV0IHZhbHVlID0ge25ld0FkZHJlc3M6IGZhbHNlLCBhZGRyZXNzOiB1cmxzfTtcclxuICAgICAgICAgIHJlc29sdmUodmFsdWUpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcblxyXG4gICAgICAgICAgaWYgKHR5cGVvZihyZXVzZVVSTCkgPT09ICdzdHJpbmcnKSB7XHJcbiAgICAgICAgICAgIGxvZy5pbmZvKCdbQWRkcmVzc0FsbG9jYXRpb24gLSByZXVzZVVSTF0gLSBPYmplY3QgJyArIHJldXNlVVJMICsgJyBub3QgZm91bmQnKTtcclxuICAgICAgICAgICAgcmVqZWN0KCdVUkwgTm90IEZvdW5kJyk7XHJcbiAgICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZihyZXVzZVVSTCkgPT09ICdib29sZWFuJykge1xyXG4gICAgICAgICAgICB0aGlzLl9hbGxvY2F0ZU5ld0FkZHJlc3MoZG9tYWluLCBzY2hlbWUsIG51bWJlciwgaW5mbykudGhlbihyZXNvbHZlKS5jYXRjaChyZWplY3QpO1xyXG4gICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgcmVqZWN0KCdVUkwgTm90IEZvdW5kJyk7XHJcbiAgICAgICAgICB9XHJcblxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgIH0pO1xyXG5cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgX2FsbG9jYXRlTmV3QWRkcmVzcyhkb21haW4sIHNjaGVtZSwgbnVtYmVyLCBpbmZvKSB7XHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG5cclxuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XHJcblxyXG4gICAgICBsZXQgYWRkcmVzc2VzID0gW107XHJcbiAgICAgIHZhciBpO1xyXG5cclxuICAgICAgZm9yIChpPTA7IGk8IG51bWJlcjsgaSsrKSB7XHJcbiAgICAgICAgYWRkcmVzc2VzLnB1c2goc2NoZW1lKyc6Ly8nICsgZG9tYWluICsgJy8nICsgZ2VuZXJhdGVHVUlEKCkpXHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGxldCByZXN1bHQgPSB7bmV3QWRkcmVzczogdHJ1ZSwgYWRkcmVzczogYWRkcmVzc2VzfTtcclxuXHJcbiAgICAgIGlmIChzY2hlbWUgPT09ICdoeXBlcnR5JyApIHtcclxuICAgICAgICBpZiAoaW5mby5oYXNPd25Qcm9wZXJ0eSgnY29uZmlndXJhdGlvbicpICYmIGluZm8uY29uZmlndXJhdGlvbi5oYXNPd25Qcm9wZXJ0eSgnZG9tYWluX3JvdXRpbmcnKSAmJiAhaW5mby5jb25maWd1cmF0aW9uLmRvbWFpbl9yb3V0aW5nKSBcclxuICAgICAgICAgIHJlc29sdmUocmVzdWx0KTtcclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgIF90aGlzLl9zdWJzY3JpcHRpb25NYW5hZ2VyLmNyZWF0ZVN1YnNjcmlwdGlvbihkb21haW4sYWRkcmVzc2VzLCBfdGhpcy5fdXJsKS50aGVuKCgpPT57XHJcbiAgICAgICAgICAgIHJlc29sdmUocmVzdWx0KTtcclxuICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICB9XHJcbiAgICAgIH0gZWxzZSByZXNvbHZlKHJlc3VsdCk7XHJcblxyXG5cclxuLyogICAgICBsZXQgbXNnID0ge1xyXG4gICAgICAgIHR5cGU6ICdjcmVhdGUnLCBmcm9tOiB0aGlzLl91cmwsIHRvOiAnZG9tYWluOi8vbXNnLW5vZGUuJyArIGRvbWFpbiArICcvYWRkcmVzcy1hbGxvY2F0aW9uJyxcclxuICAgICAgICBib2R5OiB7dmFsdWU6IHsgbnVtYmVyOiBudW1iZXIgfSB9XHJcbiAgICAgIH07XHJcblxyXG4gICAgICBpZiAoc2NoZW1lICE9PSAnaHlwZXJ0eScpIG1zZy5ib2R5LnNjaGVtZSA9IHNjaGVtZTtcclxuXHJcbiAgICAgIGxvZy5pbmZvKCdbQWRkcmVzc0FsbG9jYXRpb24gLSAnICsgc2NoZW1lICsgJ10gLSBSZXF1ZXN0IG5ldyBVUkwnKTtcclxuXHJcbiAgICAgIHRoaXMuX2J1cy5wb3N0TWVzc2FnZShtc2csIChyZXBseSkgPT4ge1xyXG4gICAgICAgIGlmIChyZXBseS5ib2R5LmNvZGUgPT09IDIwMCkge1xyXG4gICAgICAgICAgbGV0IHJlc3VsdCA9IHtuZXdBZGRyZXNzOiB0cnVlLCBhZGRyZXNzOiByZXBseS5ib2R5LnZhbHVlLmFsbG9jYXRlZH07XHJcbiAgICAgICAgICByZXNvbHZlKHJlc3VsdCk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIHJlamVjdChyZXBseS5ib2R5LmRlc2MpO1xyXG4gICAgICAgIH1cclxuICAgICAgfSk7Ki9cclxuXHJcbiAgICAgIH0pO1xyXG5cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICogU2VuZCBhIHJlcXVlc3QgdG8gdGhlIGRvbWFpbiBtZXNzYWdlIG5vZGUsIHRvIGRlYWxsb2NhdGUgb25lIG9yIG1vcmUgYWRkcmVzc2VzXHJcbiAgKiBAcGFyYW0gIHtEb21haW59IGRvbWFpbiAtIERvbWFpbiBvZiB0aGUgbWVzc2FnZSBub2RlLlxyXG4gICogQHBhcmFtICB7YWRkcmVzc2VzfSBhZGRyZXNzZXMgdG8gcmVxdWVzdCB0aGUgZGVhbGxvY2F0aW9uXHJcbiAgKiBAcmV0dXJucyB7UHJvbWlzZX0gIHRoZSByZXNwb25zZSBieSB0aGUgbWVzc2FnZSBub2RlXHJcbiAgKi9cclxuICBkZWxldGUoZG9tYWluLCBhZGRyZXNzZXMpIHtcclxuICAgIGxldCBfdGhpcyA9IHRoaXM7XHJcblxyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcclxuXHJcbiAgICAgIHJlc29sdmUoMjAwKTtcclxuXHJcbi8qICAgICAgbGV0IG1lc3NhZ2UgPSB7XHJcbiAgICAgICAgdHlwZTogJ2RlbGV0ZScsIGZyb206IF90aGlzLl91cmwsIHRvOiAnZG9tYWluOi8vbXNnLW5vZGUuJyArIGRvbWFpbiArICcvYWRkcmVzcy1hbGxvY2F0aW9uJyxcclxuICAgICAgICBib2R5OiB7Y2hpbGRyZW5SZXNvdXJjZXM6IGFkZHJlc3Nlc31cclxuICAgICAgfTtcclxuXHJcbiAgICAgIF90aGlzLl9idXMucG9zdE1lc3NhZ2UobWVzc2FnZSwgKHJlcGx5KSA9PiB7XHJcbiAgICAgICAgaWYgKHJlcGx5LmJvZHkuY29kZSA9PT0gMjAwKSB7XHJcbiAgICAgICAgICByZXNvbHZlKHJlcGx5LmJvZHkuY29kZSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIHJlamVjdChyZXBseS5ib2R5LmRlc2MpO1xyXG4gICAgICAgIH1cclxuICAgICAgfSk7Ki9cclxuICAgIH0pO1xyXG5cclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBkZWZhdWx0IEFkZHJlc3NBbGxvY2F0aW9uO1xyXG4iLCIvKipcclxuKiBDb3B5cmlnaHQgMjAxNiBQVCBJbm92YcOnw6NvIGUgU2lzdGVtYXMgU0FcclxuKiBDb3B5cmlnaHQgMjAxNiBJTkVTQy1JRFxyXG4qIENvcHlyaWdodCAyMDE2IFFVT0JJUyBORVRXT1JLUyBTTFxyXG4qIENvcHlyaWdodCAyMDE2IEZSQVVOSE9GRVItR0VTRUxMU0NIQUZUIFpVUiBGT0VSREVSVU5HIERFUiBBTkdFV0FORFRFTiBGT1JTQ0hVTkcgRS5WXHJcbiogQ29weXJpZ2h0IDIwMTYgT1JBTkdFIFNBXHJcbiogQ29weXJpZ2h0IDIwMTYgRGV1dHNjaGUgVGVsZWtvbSBBR1xyXG4qIENvcHlyaWdodCAyMDE2IEFwaXplZVxyXG4qIENvcHlyaWdodCAyMDE2IFRFQ0hOSVNDSEUgVU5JVkVSU0lUQVQgQkVSTElOXHJcbipcclxuKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4qIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuKlxyXG4qICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbipcclxuKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4qIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4qIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuKiovXHJcbi8qKlxyXG4qICAgQGF1dGhvcjogR2lsIERpYXMgKGdpbC5kaWFzQHRlY25pY28udWxpc2JvYS5wdClcclxuKiAgIFJlZ2lzdHJ5IERhdGEgTW9kZWwgaW5jbHVkZXMgYWxsIE9iamVjdHMgdG8gYmUgaGFuZGxlZCBieSB0aGUgUmVnaXN0cnkgZnVuY3Rpb25hbGl0eSBpbmNsdWRpbmdcclxuKi9cclxuY2xhc3MgUmVnaXN0cnlEYXRhTW9kZWwge1xyXG5cclxuICBjb25zdHJ1Y3RvcihpZCwgdXJsLCBkZXNjcmlwdG9yVVJMLCBwMnBSZXF1ZXN0ZXIsIHN0YXJ0aW5nVGltZSwgbGFzdE1vZGlmaWVkLCBzdGF0dXMsIHN0dWJzLCBzdHVic0NvbmZpZ3VyYXRpb24pIHtcclxuICAgIGxldCBfdGhpcyA9IHRoaXM7XHJcblxyXG4gICAgX3RoaXMuX2lkID0gaWQ7XHJcbiAgICBfdGhpcy5fdXJsID0gdXJsO1xyXG4gICAgX3RoaXMuX2Rlc2NyaXB0b3JVUkwgPSBkZXNjcmlwdG9yVVJMO1xyXG4gICAgX3RoaXMuX3N0YXJ0aW5nVGltZSA9IHN0YXJ0aW5nVGltZTtcclxuICAgIF90aGlzLl9sYXN0TW9kaWZpZWQgPSBsYXN0TW9kaWZpZWQ7XHJcbiAgICBfdGhpcy5fc3RhdHVzID0gc3RhdHVzO1xyXG4gICAgX3RoaXMuX3N0dWJzID0gc3R1YnM7XHJcbiAgICBfdGhpcy5fc3R1YnNDb25maWd1cmF0aW9uID0gc3R1YnNDb25maWd1cmF0aW9uO1xyXG4gICAgX3RoaXMuX3AycFJlcXVlc3RlciA9IHAycFJlcXVlc3RlcjtcclxuICB9XHJcblxyXG4gIGdldCBpZCgpIHtcclxuICAgIGxldCBfdGhpcyA9IHRoaXM7XHJcbiAgICByZXR1cm4gX3RoaXMuX2lkO1xyXG4gIH1cclxuXHJcbiAgZ2V0IHVybCgpIHtcclxuICAgIGxldCBfdGhpcyA9IHRoaXM7XHJcbiAgICByZXR1cm4gX3RoaXMuX3VybDtcclxuICB9XHJcblxyXG4gIGdldCBkZXNjcmlwdG9yVVJMKCkge1xyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuICAgIHJldHVybiBfdGhpcy5fZGVzY3JpcHRvclVSTDtcclxuICB9XHJcblxyXG4gIGdldCBwMnBSZXF1ZXN0ZXIoKSB7XHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG4gICAgcmV0dXJuIF90aGlzLl9wMnBSZXF1ZXN0ZXI7XHJcbiAgfVxyXG5cclxuICBnZXQgbGFzdE1vZGlmaWVkKCkge1xyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuICAgIHJldHVybiBfdGhpcy5fbGFzdE1vZGlmaWVkO1xyXG4gIH1cclxuXHJcbn1cclxuXHJcbmV4cG9ydCBkZWZhdWx0IFJlZ2lzdHJ5RGF0YU1vZGVsO1xyXG4iLCIvKipcclxuKiBDb3B5cmlnaHQgMjAxNiBQVCBJbm92YcOnw6NvIGUgU2lzdGVtYXMgU0FcclxuKiBDb3B5cmlnaHQgMjAxNiBJTkVTQy1JRFxyXG4qIENvcHlyaWdodCAyMDE2IFFVT0JJUyBORVRXT1JLUyBTTFxyXG4qIENvcHlyaWdodCAyMDE2IEZSQVVOSE9GRVItR0VTRUxMU0NIQUZUIFpVUiBGT0VSREVSVU5HIERFUiBBTkdFV0FORFRFTiBGT1JTQ0hVTkcgRS5WXHJcbiogQ29weXJpZ2h0IDIwMTYgT1JBTkdFIFNBXHJcbiogQ29weXJpZ2h0IDIwMTYgRGV1dHNjaGUgVGVsZWtvbSBBR1xyXG4qIENvcHlyaWdodCAyMDE2IEFwaXplZVxyXG4qIENvcHlyaWdodCAyMDE2IFRFQ0hOSVNDSEUgVU5JVkVSU0lUQVQgQkVSTElOXHJcbipcclxuKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4qIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuKlxyXG4qICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbipcclxuKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4qIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4qIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuKiovXHJcbmltcG9ydCBSZWdpc3RyeURhdGFNb2RlbCBmcm9tICcuL1JlZ2lzdHJ5RGF0YU1vZGVsJztcclxuXHJcbi8qKlxyXG4qICAgQGF1dGhvcjogR2lsIERpYXMgKGdpbC5kaWFzQHRlY25pY28udWxpc2JvYS5wdClcclxuKiAgIEh5cGVydHlJbnN0YW5jZSBEYXRhIE1vZGVsIHVzZWQgdG8gbW9kZWwgaW5zdGFuY2VzIG9mIEh5cGVydGllcyBydW5uaW5nIGluIGRldmljZXMgYW5kIHNlcnZlcnMuXHJcbiovXHJcbmNsYXNzIEh5cGVydHlJbnN0YW5jZSBleHRlbmRzIFJlZ2lzdHJ5RGF0YU1vZGVsIHtcclxuXHJcbiAgY29uc3RydWN0b3IoaWQsIHVybCwgZGVzY3JpcHRvclVSTCwgZGVzY3JpcHRvciwgaHlwZXJ0eVVSTCwgdXNlciwgZ3VpZCwgcnVudGltZSwgY29udGV4dCwgcDJwSGFuZGxlciwgcDJwUmVxdWVzdGVyLCBkYXRhU2NoZW1lcywgcmVzb3VyY2VzLCBzdGFydGluZ1RpbWUsIGxhc3RNb2RpZmllZCkge1xyXG4gICAgc3VwZXIoaWQsIHVybCwgZGVzY3JpcHRvclVSTCwgcDJwUmVxdWVzdGVyLCBzdGFydGluZ1RpbWUsIGxhc3RNb2RpZmllZCk7XHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG4gICAgX3RoaXMuX2Rlc2NyaXB0b3IgPSBkZXNjcmlwdG9yO1xyXG4gICAgX3RoaXMuX2h5cGVydHlVUkwgPSBoeXBlcnR5VVJMO1xyXG4gICAgX3RoaXMuX3VzZXIgPSB1c2VyO1xyXG4gICAgX3RoaXMuX2d1aWQgPSBndWlkO1xyXG4gICAgX3RoaXMuX3J1bnRpbWUgPSBydW50aW1lO1xyXG4gICAgX3RoaXMuX2NvbnRleHQgPSBjb250ZXh0O1xyXG4gICAgX3RoaXMuX3AycEhhbmRsZXIgPSBwMnBIYW5kbGVyO1xyXG4gICAgX3RoaXMuX2RhdGFTY2hlbWVzID0gZGF0YVNjaGVtZXM7XHJcbiAgICBfdGhpcy5fcmVzb3VyY2VzID0gcmVzb3VyY2VzO1xyXG4gIH1cclxuXHJcbiAgc2V0IHVzZXIoaWRlbnRpdHkpIHtcclxuICAgIGxldCBfdGhpcyA9IHRoaXM7XHJcbiAgICBfdGhpcy51c2VyID0gaWRlbnRpdHk7XHJcbiAgfVxyXG5cclxuICBnZXQgdXNlcigpIHtcclxuICAgIGxldCBfdGhpcyA9IHRoaXM7XHJcbiAgICByZXR1cm4gX3RoaXMuX3VzZXI7XHJcbiAgfVxyXG5cclxuICBnZXQgaHlwZXJ0eVVSTCgpIHtcclxuICAgIGxldCBfdGhpcyA9IHRoaXM7XHJcbiAgICByZXR1cm4gX3RoaXMuX2h5cGVydHlVUkw7XHJcbiAgfVxyXG5cclxuICBnZXQgZGVzY3JpcHRvcigpIHtcclxuICAgIGxldCBfdGhpcyA9IHRoaXM7XHJcbiAgICByZXR1cm4gX3RoaXMuX2Rlc2NyaXB0b3I7XHJcbiAgfVxyXG5cclxuICBnZXQgb2JqZWN0TmFtZSgpIHtcclxuICAgIGxldCBfdGhpcyA9IHRoaXM7XHJcbiAgICByZXR1cm4gX3RoaXMuX2Rlc2NyaXB0b3IuX29iamVjdE5hbWU7XHJcbiAgfVxyXG5cclxuICBnZXQgcDJwSGFuZGxlcigpIHtcclxuICAgIGxldCBfdGhpcyA9IHRoaXM7XHJcbiAgICByZXR1cm4gX3RoaXMuX3AycEhhbmRsZXI7XHJcbiAgfVxyXG5cclxuICBnZXQgZGF0YVNjaGVtZXMoKSB7XHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG4gICAgcmV0dXJuIF90aGlzLl9kYXRhU2NoZW1lcztcclxuICB9XHJcblxyXG4gIGdldCByZXNvdXJjZXMoKSB7XHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG4gICAgcmV0dXJuIF90aGlzLl9yZXNvdXJjZXM7XHJcbiAgfVxyXG5cclxuICBnZXQgcnVudGltZVVSTCgpIHtcclxuICAgIGxldCBfdGhpcyA9IHRoaXM7XHJcbiAgICByZXR1cm4gX3RoaXMuX3J1bnRpbWU7XHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgZGVmYXVsdCBIeXBlcnR5SW5zdGFuY2U7XHJcbiIsIi8qKlxyXG4qIENvcHlyaWdodCAyMDE2IFBUIElub3Zhw6fDo28gZSBTaXN0ZW1hcyBTQVxyXG4qIENvcHlyaWdodCAyMDE2IElORVNDLUlEXHJcbiogQ29weXJpZ2h0IDIwMTYgUVVPQklTIE5FVFdPUktTIFNMXHJcbiogQ29weXJpZ2h0IDIwMTYgRlJBVU5IT0ZFUi1HRVNFTExTQ0hBRlQgWlVSIEZPRVJERVJVTkcgREVSIEFOR0VXQU5EVEVOIEZPUlNDSFVORyBFLlZcclxuKiBDb3B5cmlnaHQgMjAxNiBPUkFOR0UgU0FcclxuKiBDb3B5cmlnaHQgMjAxNiBEZXV0c2NoZSBUZWxla29tIEFHXHJcbiogQ29weXJpZ2h0IDIwMTYgQXBpemVlXHJcbiogQ29weXJpZ2h0IDIwMTYgVEVDSE5JU0NIRSBVTklWRVJTSVRBVCBCRVJMSU5cclxuKlxyXG4qIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4qIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4qXHJcbiogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuKlxyXG4qIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4qIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4qKi9cclxuXHJcbi8vIExvZyBTeXN0ZW1cclxuaW1wb3J0ICogYXMgbG9nZ2VyIGZyb20gJ2xvZ2xldmVsJztcclxubGV0IGxvZyA9IGxvZ2dlci5nZXRMb2dnZXIoJ1JlZ2lzdHJ5Jyk7XHJcblxyXG5pbXBvcnQgeyBydW50aW1lVXRpbHMgIH0gZnJvbSAnLi4vcnVudGltZS9ydW50aW1lVXRpbHMnO1xyXG5cclxuaW1wb3J0IEh5cGVydHlJbnN0YW5jZSBmcm9tICcuL0h5cGVydHlJbnN0YW5jZSc7XHJcblxyXG5cclxuLyoqXHJcbiogUnVudGltZSBEb21haW5SZWdpc3RyYXRpb24gSW50ZXJmYWNlXHJcbiovXHJcbmNsYXNzIERvbWFpblJlZ2lzdHJhdGlvbiB7XHJcblxyXG4gIC8qKlxyXG4gICogVG8gaW5pdGlhbGlzZSB0aGUgUnVudGltZSBSZWdpc3RyeSB3aXRoIHRoZSBSdW50aW1lVVJMIHRoYXQgd2lsbCBiZSB0aGUgYmFzaXMgdG8gZGVyaXZlIHRoZSBpbnRlcm5hbCBydW50aW1lIGFkZHJlc3NlcyB3aGVuIGFsbG9jYXRpbmcgYWRkcmVzc2VzIHRvIGludGVybmFsIHJ1bnRpbWUgY29tcG9uZW50LiBJbiBhZGRpdGlvbiwgdGhlIFJlZ2lzdHJ5IGRvbWFpbiBiYWNrLWVuZCB0byBiZSB1c2VkIHRvIHJlbW90ZWx5IHJlZ2lzdGVyIFJ1bnRpbWUgY29tcG9uZW50cywgaXMgYWxzbyBwYXNzZWQgYXMgaW5wdXQgcGFyYW1ldGVyLlxyXG4gICogQHBhcmFtICB7TWVzc2FnZUJ1c30gICAgICAgICAgbWVzc2FnZUJ1cyAgICAgICAgICAgICAgICBtc2didXNcclxuICAqIEBwYXJhbSAge0h5cGVydHlSdW50aW1lVVJMfSAgIHJ1bnRpbWVVUkwgICAgICAgICAgICBydW50aW1lVVJMXHJcbiAgKiBAcGFyYW0gIHtEb21haW5VUkx9ICAgICAgICAgICBkb21haW4gICAgICAgIHJlbW90ZVJlZ2lzdHJ5XHJcbiAgKi9cclxuICBjb25zdHJ1Y3RvcihydW50aW1lVVJMLCByZWdpc3RyeVVSTCwgZG9tYWluLCBtZXNzYWdlQnVzKSB7XHJcblxyXG4gICAgaWYgKCFydW50aW1lVVJMKSB0aHJvdyBuZXcgRXJyb3IoJ3J1bnRpbWVVUkwgaXMgbWlzc2luZy4nKTtcclxuICAgIGlmICghcmVnaXN0cnlVUkwpIHRocm93IG5ldyBFcnJvcigncmVnaXN0cnlVUkwgaXMgbWlzc2luZy4nKTtcclxuICAgIGlmICghZG9tYWluKSB0aHJvdyBuZXcgRXJyb3IoJ2RvbWFpbiBpcyBtaXNzaW5nLicpO1xyXG4gICAgaWYgKCFtZXNzYWdlQnVzKSB0aHJvdyBuZXcgRXJyb3IoJ21lc3NhZ2VCdXMgaXMgbWlzc2luZy4nKTtcclxuXHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG5cclxuICAgIF90aGlzLnJlZ2lzdHJ5VVJMID0gcmVnaXN0cnlVUkw7XHJcbiAgICBfdGhpcy5ydW50aW1lVVJMID0gcnVudGltZVVSTDtcclxuICAgIF90aGlzLl9yZWdpc3RyYXRpb25SZXRyaWVzID0gNTsvLyBudW1iZXIgb2YgYXR0ZW1wdHMgdG8gcmVnaXN0ZXIgSHlwZXJ0aWVzIGFuZCBEYXRhT2JqZWN0cyB3aGVuIGVycm9ycyBvY2N1cnNcclxuXHJcbiAgICAvLyB0aGUgZXhwaXJlcyBpbiAzNjAwLCByZXByZXNlbnRzIDEgaG91clxyXG4gICAgLy90aGUgZXhwaXJlcyBpcyBpbiBzZWNvbmRzLCB1bml0IG9mIG1lYXN1cmUgcmVjZWl2ZWQgYnkgdGhlIGRvbWFpbiByZWdpc3RyeVxyXG4gICAgX3RoaXMuZXhwaXJlc1RpbWUgPSAzNjAwO1xyXG5cclxuICAgIF90aGlzLl9kb21haW4gPSBkb21haW47XHJcbiAgICBfdGhpcy5fbWVzc2FnZUJ1cyA9IG1lc3NhZ2VCdXM7XHJcbiAgfVxyXG5cclxuXHJcbiAgLyoqXHJcbiAgKiAgZnVuY3Rpb24gdG8gdW5yZWdpc3RlciBhbiBoeXBlcnR5SW5zdGFuY2UgaW4gdGhlIERvbWFpbiBSZWdpc3RyeVxyXG4gICogIEBwYXJhbSAgIHtTdHJpbmd9ICAgICAgaHlwZXJ0eUluc3RhbmNlICAgSHlwZXJ0eUluc250YW5jZSB1cmxcclxuICAqXHJcbiAgKi9cclxuICB1bnJlZ2lzdGVySHlwZXJ0eShoeXBlcnR5SW5zdGFuY2UpIHtcclxuICAgIGxldCBfdGhpcyA9IHRoaXM7XHJcblxyXG4gICAgICBsZXQgbWVzc2FnZSA9IHsgdHlwZTogJ3VwZGF0ZScsIGZyb206IF90aGlzLnJlZ2lzdHJ5VVJMLFxyXG4gICAgICAgIHRvOiAnZG9tYWluOi8vcmVnaXN0cnkuJyArIF90aGlzLl9kb21haW4sXHJcbiAgICAgICAgYm9keTogeyByZXNvdXJjZTogJy9oeXBlcnR5LycgKyBoeXBlcnR5SW5zdGFuY2UsIHZhbHVlOiAnZGlzY29ubmVjdGVkJywgYXR0cmlidXRlOiAnc3RhdHVzJyB9fTtcclxuXHJcbiAgICAgIF90aGlzLl9tZXNzYWdlQnVzLnBvc3RNZXNzYWdlKG1lc3NhZ2UsIChyZXBseSkgPT4ge1xyXG4gICAgICAgIGxvZy5sb2coJ1tEb21haW5SZWdpc3RyYXRpb25dIHVucmVnaXN0ZXIgaHlwZXJ0eSBSZXBseScsIHJlcGx5KTtcclxuXHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICogIGZ1bmN0aW9uIHRvIHVucmVnaXN0ZXIgYSBEYXRhIE9iamVjdCBpbiB0aGUgRG9tYWluIFJlZ2lzdHJ5XHJcbiAgKiAgQHBhcmFtICAge1N0cmluZ30gICAgICBoeXBlcnR5SW5zdGFuY2UgICBIeXBlcnR5SW5zbnRhbmNlIHVybFxyXG4gICpcclxuICAqL1xyXG4gIHVucmVnaXN0ZXJEYXRhT2JqZWN0KHVybCkge1xyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuXHJcbiAgICBsZXQgbWVzc2FnZSA9IHsgdHlwZTogJ3VwZGF0ZScsIGZyb206IF90aGlzLnJlZ2lzdHJ5VVJMLFxyXG4gICAgICB0bzogJ2RvbWFpbjovL3JlZ2lzdHJ5LicgKyBfdGhpcy5fZG9tYWluLFxyXG4gICAgICBib2R5OiB7XHJcbiAgICAgICAgcmVzb3VyY2U6IHVybCxcclxuICAgICAgICB2YWx1ZToge1xyXG4gICAgICAgICAgc3RhdHVzOiAnZGlzY29ubmVjdGVkJ1xyXG4gICAgICAgIH1cclxuICAgICAgfX07XHJcblxyXG4gICAgX3RoaXMuX21lc3NhZ2VCdXMucG9zdE1lc3NhZ2UobWVzc2FnZSwgKHJlcGx5KSA9PiB7XHJcbiAgICAgIGxvZy5sb2coJ1tEb21haW5SZWdpc3RyYXRpb25dIHVucmVnaXN0ZXIgZGF0YU9iamVjdCBSZXBseScsIHJlcGx5KTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgKiAgZnVuY3Rpb24gdG8gZGVsZXRlIGFuIGRhdGFPYmplY3RJbnN0YW5jZSBpbiB0aGUgRG9tYWluIFJlZ2lzdHJ5XHJcbiAgKiAgQHBhcmFtICAge1N0cmluZ30gICAgbmFtZSAgICAgIERhdGFPYmplY3ROYW1lXHJcbiAgKi9cclxuICBkZWxldGVEYXRhT2JqZWN0SW5zdGFuY2UobmFtZSkge1xyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuXHJcbiAgICBsZXQgbWVzc2FnZSA9IHsgdHlwZTogJ2RlbGV0ZScsIGZyb206IF90aGlzLnJlZ2lzdHJ5VVJMLFxyXG4gICAgICB0bzogJ2RvbWFpbjovL3JlZ2lzdHJ5LicgKyBfdGhpcy5fZG9tYWluLFxyXG4gICAgICBib2R5OiB7IHZhbHVlOiB7bmFtZTogbmFtZX19fTtcclxuXHJcbiAgICBfdGhpcy5fbWVzc2FnZUJ1cy5wb3N0TWVzc2FnZShtZXNzYWdlLCAocmVwbHkpID0+IHtcclxuICAgICAgbG9nLmxvZygnW0RvbWFpblJlZ2lzdHJhdGlvbl0gdW5yZWdpc3RlciBkYXRhT2JqZWN0IFJlcGx5JywgcmVwbHkpO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAqIEZ1bmN0aW9uIHRvIHVwZGF0ZSBhbiBIeXBlcnR5XHJcbiAgKi9cclxuICB1cGRhdGVIeXBlcnR5SW5zdGFuY2UocmVzb3VyY2UsIHZhbHVlKSB7XHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG5cclxuICAgIGxldCBtZXNzYWdlID0geyB0eXBlOiAnVVBEQVRFJywgZnJvbTogX3RoaXMucmVnaXN0cnlVUkwsXHJcbiAgICAgIHRvOiAnZG9tYWluOi8vcmVnaXN0cnkuJyArIF90aGlzLl9kb21haW4sXHJcbiAgICAgIGJvZHk6IHsgcmVzb3VyY2U6IHJlc291cmNlLCB2YWx1ZTogdmFsdWV9fTtcclxuXHJcbiAgICBfdGhpcy5fbWVzc2FnZUJ1cy5wb3N0LnBvc3RNZXNzYWdlKG1lc3NhZ2UsIChyZXBseSkgPT4ge1xyXG4gICAgICAvLyBsb2cubG9nKCdbUmVnaXN0cnldIFVwZGF0ZWQgaHlwZXJ0eSByZXBseScsIHJlcGx5KTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcblxyXG4gIC8qKlxyXG4gICogVG8gcmVnaXN0ZXIgYSBuZXcgRGF0YSBPYmplY3QgaW4gdGhlIERvbWFpbiBSZWdpc3RyeS5cclxuICAqIEBwYXJhbSAge0pTT059ICAgICByZWdpc3RyYXRpb24gICAgICAgICAgICAgICAgICAgcmVnaXN0cmF0aW9uIGRhdGEgdG8gYmUgdXNlZFxyXG4gICogQHBhcmFtICB7Ym9vbGVhbn0gICAgIHJlc3VtZSAgICAgICAgICAgICAgICAgICAgIGlmIHRoaXMgaXMganVzdCB0byB1cGRhdGUgdGhlIHJlZ2lzdHJhdGlvbiB3aXRoIHRoZSByZXN1bWUgb2YgYSBkYXRhIG9iamVjdFxyXG4gICovXHJcblxyXG4gIHJlZ2lzdGVyRGF0YU9iamVjdChyZWdpc3RyYXRpb24sIHJlc3VtZSwgcDJwSGFuZGxlclN0dWIpIHtcclxuXHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG5cclxuICAgIGxldCBwMnBIYW5kbGVyO1xyXG4gICAgbGV0IHAycFJlcXVlc3RlcjtcclxuXHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcblxyXG4gICAgICBsZXQgZGF0YVNjaGVtZSA9IFtdO1xyXG4gICAgICBsZXQgZmlsdGVyZWREYXRhU2NoZW1lID0gcmVnaXN0cmF0aW9uLnVybC5zcGxpdCgnOicpO1xyXG4gICAgICBkYXRhU2NoZW1lLnB1c2goZmlsdGVyZWREYXRhU2NoZW1lWzBdKTtcclxuXHJcbiAgICAgIGlmIChPYmplY3Qua2V5cyhwMnBIYW5kbGVyU3R1YikubGVuZ3RoICE9PSAwKSB7XHJcbiAgICAgIHAycEhhbmRsZXIgPSBwMnBIYW5kbGVyU3R1YltfdGhpcy5ydW50aW1lVVJMXS51cmw7XHJcbiAgICAgIHAycFJlcXVlc3RlciA9IHJ1bnRpbWVVdGlscy5ydW50aW1lRGVzY3JpcHRvci5wMnBSZXF1ZXN0ZXJTdHViO1xyXG4gICAgfVxyXG5cclxuICAgIHJlZ2lzdHJhdGlvbi5zdGFydGluZ1RpbWUgPSByZWdpc3RyYXRpb24uY3JlYXRlZDtcclxuXHJcbiAgICBkZWxldGUgcmVnaXN0cmF0aW9uLmF1dGhvcmlzZTtcclxuICAgIGRlbGV0ZSByZWdpc3RyYXRpb24uY3JlYXRlZDtcclxuICAgIGRlbGV0ZSByZWdpc3RyYXRpb24ubXV0dWFsO1xyXG4gICAgZGVsZXRlIHJlZ2lzdHJhdGlvbi5yZXN1bWU7XHJcblxyXG4gICAgaWYgKCFyZWdpc3RyYXRpb24uZXhwaXJlcykgcmVnaXN0cmF0aW9uLmV4cGlyZXMgPSBfdGhpcy5leHBpcmVzVGltZTtcclxuXHJcbiAgICByZWdpc3RyYXRpb24uZGF0YVNjaGVtZXMgPSBkYXRhU2NoZW1lO1xyXG5cclxuICAgIGlmIChwMnBIYW5kbGVyKSB7XHJcbiAgICAgIHJlZ2lzdHJhdGlvbi5wMnBIYW5kbGVyID0gcDJwSGFuZGxlcjtcclxuICAgICAgcmVnaXN0cmF0aW9uLnAycFJlcXVlc3RlciA9IHAycFJlcXVlc3RlcjtcclxuICAgIH1cclxuXHJcbiAgICByZWdpc3RyYXRpb24uc3RhdHVzID0gJ2xpdmUnO1xyXG5cclxuICAgIGxldCBtZXNzYWdlO1xyXG5cclxuICAgIGlmICghcmVzdW1lKSB7XHJcblxyXG4gICAgICBsb2cubG9nKCdbUmVnaXN0cnkucmVnaXN0ZXJEYXRhT2JqZWN0XSByZWdpc3RlcmluZyBuZXcgZGF0YSBvYmplY3QgVVJMJywgcmVnaXN0cmF0aW9uKTtcclxuXHJcbiAgICAgIG1lc3NhZ2UgPSB7IHR5cGU6ICdjcmVhdGUnLCBmcm9tOiBfdGhpcy5yZWdpc3RyeVVSTCwgdG86ICdkb21haW46Ly9yZWdpc3RyeS4nICsgX3RoaXMuX2RvbWFpbiwgYm9keTogeyB2YWx1ZTogcmVnaXN0cmF0aW9uLCBwb2xpY3k6ICdwb2xpY3knIH0gfTtcclxuXHJcbiAgICB9IGVsc2Uge1xyXG5cclxuICAgICAgbG9nLmxvZygnW1JlZ2lzdHJ5LnJlZ2lzdGVyRGF0YU9iamVjdF0gcmVnaXN0ZXJpbmcgcHJldmlvdXNseSByZWdpc3RlcmVkIGRhdGEgb2JqZWN0IFVSTCcsIHJlZ2lzdHJhdGlvbik7XHJcblxyXG4gICAgICBtZXNzYWdlID0ge1xyXG4gICAgICAgIHR5cGU6ICd1cGRhdGUnLFxyXG4gICAgICAgIHRvOiAnZG9tYWluOi8vcmVnaXN0cnkuJyArIF90aGlzLl9kb21haW4sXHJcbiAgICAgICAgZnJvbTogX3RoaXMucmVnaXN0cnlVUkwsXHJcbiAgICAgICAgYm9keTogeyByZXNvdXJjZTogcmVnaXN0cmF0aW9uLnVybCwgdmFsdWU6IHsgc3RhdHVzOiAnbGl2ZScgfSB9XHJcbiAgICAgIH07XHJcblxyXG4gICAgfVxyXG5cclxuICAgIHRyeSB7XHJcbiAgICAgIF90aGlzLl9tZXNzYWdlQnVzLnBvc3RNZXNzYWdlV2l0aFJldHJpZXMobWVzc2FnZSwgX3RoaXMuX3JlZ2lzdHJhdGlvblJldHJpZXMsIChyZXBseSkgPT4ge1xyXG4gICAgICAgIC8vIGxvZy5sb2coJ1tSZWdpc3RyeS5yZWdpc3RlckRhdGFPYmplY3RdID09PT4gcmVnaXN0ZXJEYXRhT2JqZWN0IFJlcGx5OiAnLCByZXBseSk7XHJcbiAgICAgICAgaWYgKHJlcGx5LmJvZHkuY29kZSA9PT0gMjAwKSB7XHJcbiAgICAgICAgICByZXNvbHZlKHJlZ2lzdHJhdGlvbik7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIHJlamVjdCgnZXJyb3Igb24gcmVnaXN0ZXIgRGF0YU9iamVjdCcpO1xyXG4gICAgICAgIH1cclxuICAgICAgfSk7XHJcbiAgICB9IGNhdGNoIChlKSB7XHJcbiAgICAgIGxvZy5lcnJvcihlKTtcclxuICAgICAgcmVqZWN0KGUpO1xyXG4gICAgfVxyXG5cclxuXHJcbiAgICAvL3RpbWVyIHRvIGtlZXAgdGhlIHJlZ2lzdHJhdGlvbiBhbGl2ZVxyXG4gICAgLy8gdGhlIHRpbWUgaXMgZGVmaW5lZCBieSBhIGxpdHRsZSBsZXNzIHRoYW4gaGFsZiBvZiB0aGUgZXhwaXJlcyB0aW1lIGRlZmluZWRcclxuICAgIGxldCBrZWVwQWxpdmVUaW1lciA9IHNldEludGVydmFsKGZ1bmN0aW9uICgpIHtcclxuXHJcbiAgICAgIGxldCBtZXNzYWdlID0ge1xyXG4gICAgICAgIHR5cGU6ICd1cGRhdGUnLFxyXG4gICAgICAgIGZyb206IF90aGlzLnJlZ2lzdHJ5VVJMLFxyXG4gICAgICAgIHRvOiAnZG9tYWluOi8vcmVnaXN0cnkuJyArIF90aGlzLl9kb21haW4sXHJcbiAgICAgICAgYm9keTogeyByZXNvdXJjZTogcmVnaXN0cmF0aW9uLnVybCwgdmFsdWU6IHsgc3RhdHVzOiAnbGl2ZScgfSwgbWV0aG9kOiAncmVmcmVzaCcgfVxyXG4gICAgICB9O1xyXG5cclxuICAgICAgX3RoaXMuX21lc3NhZ2VCdXMucG9zdE1lc3NhZ2UobWVzc2FnZSwgKHJlcGx5KSA9PiB7XHJcbiAgICAgICAgLy8gbG9nLmxvZygnW1JlZ2lzdHJ5LnJlZ2lzdGVyRGF0YU9iamVjdF0gS2VlcEFsaXZlIFJlcGx5OiAnLCByZXBseSk7XHJcbiAgICAgIH0pO1xyXG4gICAgfSwgKCgocmVnaXN0cmF0aW9uLmV4cGlyZXMgLyAxLjEpIC8gMikgKiAxMDAwKSk7XHJcblxyXG4gIH0pO1xyXG5cclxuXHJcbiAgfVxyXG5cclxuXHJcblxyXG5cclxuICAvKipcclxuICAqIFRvIHJlZ2lzdGVyIGEgbmV3IEh5cGVydHkgaW4gdGhlIERvbWFpbiBSZWdpc3RyeS5cclxuICAqIEBwYXJhbSAge0h5cGVydHlJbnN0YW5jZX0gICAgIGh5cGVydHkgICAgICAgICAgICBIeXBlcnR5IHRvIGJlIHJlZ2lzdGVyZWRcclxuICAqIEBwYXJhbSAge2Jvb2xlYW59ICAgICByZXN1bWUgICAgICAgICAgICAgICAgICAgICBpZiB0aGlzIGlzIGp1c3QgdG8gdXBkYXRlIHRoZSByZWdpc3RyYXRpb24gd2l0aCB0aGUgcmVzdW1lIG9mIGEgZGF0YSBvYmplY3RcclxuICAqL1xyXG5cclxuXHJcbiAgcmVnaXN0ZXJIeXBlcnR5KGh5cGVydHksIHJlc3VtZSl7XHJcblxyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuXHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcblxyXG4gICAgbGV0IHJ1bnRpbWUgPSBfdGhpcy5ydW50aW1lVVJMO1xyXG4gICAgbGV0IHN0YXR1cyA9ICdsaXZlJztcclxuXHJcbiAgICAvL21lc3NhZ2UgdG8gcmVnaXN0ZXIgdGhlIG5ldyBoeXBlcnR5LCB3aXRoaW4gdGhlIGRvbWFpbiByZWdpc3RyeVxyXG4gICAgbGV0IG1lc3NhZ2U7XHJcbiAgICBsZXQgcmVnaXN0cmF0aW9uRXhwaXJlcyA9IF90aGlzLmV4cGlyZXNUaW1lO1xyXG5cclxuICAgIGxldCBtZXNzYWdlVmFsdWUgPSB7XHJcbiAgICAgIHVzZXI6IGh5cGVydHkudXNlci5lbWFpbCxcclxuICAgICAgZGVzY3JpcHRvcjogaHlwZXJ0eS5kZXNjcmlwdG9yVVJMLFxyXG4gICAgICB1cmw6IGh5cGVydHkuaHlwZXJ0eVVSTCxcclxuICAgICAgZXhwaXJlczogcmVnaXN0cmF0aW9uRXhwaXJlcyxcclxuICAgICAgcmVzb3VyY2VzOiBoeXBlcnR5LnJlc291cmNlcyxcclxuICAgICAgZGF0YVNjaGVtZXM6IGh5cGVydHkuZGF0YVNjaGVtZXMsXHJcbiAgICAgIHJ1bnRpbWU6IHJ1bnRpbWUsXHJcbiAgICAgIHN0YXR1czogc3RhdHVzXHJcbiAgICB9O1xyXG5cclxuICAgIC8vIHNldCBhIGRpZmZlcmVudCBleHBpcmVzIGlmIGRlZmluZWQgaW4gdGhlIGh5cGVydHkgY29uZmlndXJhdGlvblxyXG5cclxuICAgIGlmIChoeXBlcnR5LnAycEhhbmRsZXIpIHtcclxuICAgICAgbWVzc2FnZVZhbHVlLnAycEhhbmRsZXIgPSBoeXBlcnR5LnAycEhhbmRsZXI7XHJcbiAgICAgIG1lc3NhZ2VWYWx1ZS5wMnBSZXF1ZXN0ZXIgPSBoeXBlcnR5LnAycFJlcXVlc3RlcjtcclxuICAgIH1cclxuXHJcbiAgICAvLyBzZXQgYSBkaWZmZXJlbnQgZXhwaXJlcyB2YWx1ZSBpZiBjb25maWd1cmVkIGluIHRoZSBIeXBlcnR5IGRlc2NyaXB0b3JcclxuXHJcbiAgICBpZiAoaHlwZXJ0eS5kZXNjcmlwdG9yLmNvbmZpZ3VyYXRpb24gJiYgaHlwZXJ0eS5kZXNjcmlwdG9yLmNvbmZpZ3VyYXRpb24uZXhwaXJlcykgcmVnaXN0cmF0aW9uRXhwaXJlcyA9IGh5cGVydHkuZGVzY3JpcHRvci5jb25maWd1cmF0aW9uLmV4cGlyZXM7XHJcblxyXG4gICAgaWYgKCFyZXN1bWUpIHtcclxuICAgICAgLy8gbG9nLmxvZygnW1JlZ2lzdHJ5IHJlZ2lzdGVySHlwZXJ0eV0gcmVnaXN0ZXJpbmcgbmV3IEh5cGVydHkgVVJMJywgYWRkcmVzc1VSTC5hZGRyZXNzWzBdKTtcclxuXHJcblxyXG4gICAgICAvLyBzZXQgYSBkaWZmZXJlbnQgZXhwaXJlcyBpZiBkZWZpbmVkIGluIHRoZSBoeXBlcnR5IGNvbmZpZ3VyYXRpb25cclxuXHJcblxyXG4gICAgICAvLyBsb2cubG9nKCdbUmVnaXN0cnkgcmVnaXN0ZXJIeXBlcnR5XSByZWdpc3RlcmluZyBuZXcgSHlwZXJ0eSBhdCBkb21haW4gcmVnaXN0cnkgJywgbWVzc2FnZVZhbHVlKTtcclxuXHJcbiAgICAgIG1lc3NhZ2UgPSB7dHlwZTogJ2NyZWF0ZScsIGZyb206IF90aGlzLnJlZ2lzdHJ5VVJMLCB0bzogJ2RvbWFpbjovL3JlZ2lzdHJ5LicgKyBfdGhpcy5fZG9tYWluLCBib2R5OiB7dmFsdWU6IG1lc3NhZ2VWYWx1ZSwgcG9saWN5OiAncG9saWN5J319O1xyXG5cclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIC8vIGxvZy5sb2coJ1tSZWdpc3RyeSByZWdpc3Rlckh5cGVydHldIHJlZ2lzdGVyaW5nIHByZXZpb3VzbHkgcmVnaXN0ZXJlZCBIeXBlcnR5IFVSTCcsIGFkZHJlc3NVUkwuYWRkcmVzc1swXSk7XHJcblxyXG4gICAgICBtZXNzYWdlID0ge1xyXG4gICAgICAgIHR5cGU6ICd1cGRhdGUnLFxyXG4gICAgICAgIHRvOiAnZG9tYWluOi8vcmVnaXN0cnkuJyArIF90aGlzLl9kb21haW4sXHJcbiAgICAgICAgZnJvbTogX3RoaXMucmVnaXN0cnlVUkwsXHJcbiAgICAgICAgYm9keToge3Jlc291cmNlOiBoeXBlcnR5Lmh5cGVydHlVUkwsIHZhbHVlOiB7IHN0YXR1czogJ2xpdmUnLCB1c2VyOiBoeXBlcnR5LnVzZXIuZW1haWwgfX1cclxuICAgICAgfTtcclxuXHJcbiAgICAgIGlmIChoeXBlcnR5LnAycEhhbmRsZXIpIHtcclxuICAgICAgICBtZXNzYWdlLmJvZHkudmFsdWUucDJwSGFuZGxlciA9IGh5cGVydHkucDJwSGFuZGxlcjtcclxuICAgICAgICBtZXNzYWdlLmJvZHkudmFsdWUucDJwUmVxdWVzdGVyID0gaHlwZXJ0eS5wMnBSZXF1ZXN0ZXI7XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvLyBsb2cubG9nKCdbUmVnaXN0cnkgcmVnaXN0ZXJIeXBlcnR5XSBIeXBlcnR5IHJlZ2lzdHJhdGlvbiBhdCBkb21haW4gcmVnaXN0cnkgIC0gJywgbWVzc2FnZSk7XHJcblxyXG4gICAgICB0cnkge1xyXG4gICAgICAgIF90aGlzLl9tZXNzYWdlQnVzLnBvc3RNZXNzYWdlV2l0aFJldHJpZXMobWVzc2FnZSwgX3RoaXMuX3JlZ2lzdHJhdGlvblJldHJpZXMsIChyZXBseSkgPT4ge1xyXG4gICAgICAgICAgLy8gbG9nLmxvZygnW1JlZ2lzdHJ5IHJlZ2lzdGVySHlwZXJ0eV0gSHlwZXJ0eSByZWdpc3RyYXRpb24gcmVzcG9uc2U6ICcsIHJlcGx5KTtcclxuXHJcbiAgICAgICAgICBpZiAocmVwbHkuYm9keS5jb2RlID09PSAyMDApIHtcclxuICAgICAgICAgICAgbGV0IHJlc3VsdCA9IHsgdXJsOiBoeXBlcnR5Lmh5cGVydHlVUkx9O1xyXG4gICAgICAgICAgICBpZiAoaHlwZXJ0eS5wMnBIYW5kbGVyKSB7XHJcbiAgICAgICAgICAgICAgcmVzdWx0LnAycEhhbmRsZXIgPSBoeXBlcnR5LnAycEhhbmRsZXI7XHJcbiAgICAgICAgICAgICAgcmVzdWx0LnAycFJlcXVlc3RlciA9IGh5cGVydHkucDJwUmVxdWVzdGVyO1xyXG4gICAgICAgICAgICB9XHJcblxyXG5cclxuXHJcbiAgICAgICAgICAgIHJlc29sdmUocmVzdWx0KTtcclxuICAgICAgICAgIH0gZWxzZSBpZiAocmVwbHkuYm9keS5jb2RlID09PSA0MDQpIHtcclxuICAgICAgICAgICAgLy8gbG9nLmxvZygnW1JlZ2lzdHJ5IHJlZ2lzdGVySHlwZXJ0eV0gVGhlIHVwZGF0ZSB3YXMgbm90IHBvc3NpYmxlLiBSZWdpc3RlcmluZyBuZXcgSHlwZXJ0eSBhdCBkb21haW4gcmVnaXN0cnknKTtcclxuXHJcbiAgICAgICAgICAgIG1lc3NhZ2UgPSB7dHlwZTogJ2NyZWF0ZScsIGZyb206IF90aGlzLnJlZ2lzdHJ5VVJMLCB0bzogJ2RvbWFpbjovL3JlZ2lzdHJ5LicgKyBfdGhpcy5fZG9tYWluLCBib2R5OiB7dmFsdWU6IG1lc3NhZ2VWYWx1ZSwgcG9saWN5OiAncG9saWN5J319O1xyXG5cclxuICAgICAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgICBfdGhpcy5fbWVzc2FnZUJ1cy5wb3N0TWVzc2FnZVdpdGhSZXRyaWVzKG1lc3NhZ2UsIF90aGlzLl9yZWdpc3RyYXRpb25SZXRyaWVzLCAocmVwbHkpID0+e1xyXG4gICAgICAgICAgICAgICAgLy8gbG9nLmxvZygnW1JlZ2lzdHJ5IHJlZ2lzdGVySHlwZXJ0eV0gSHlwZXJ0eSByZWdpc3RyYXRpb24gdXBkYXRlIHJlc3BvbnNlOiAnLCByZXBseSk7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKHJlcGx5LmJvZHkuY29kZSA9PT0gMjAwKSB7XHJcbiAgICAgICAgICAgICAgICAgIGxldCByZXN1bHQgPSB7IHVybDogaHlwZXJ0eS5oeXBlcnR5VVJMfTtcclxuICAgICAgICAgICAgICAgICAgaWYgKGh5cGVydHkucDJwSGFuZGxlcikge1xyXG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdC5wMnBIYW5kbGVyID0gaHlwZXJ0eS5wMnBIYW5kbGVyO1xyXG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdC5wMnBSZXF1ZXN0ZXIgPSBoeXBlcnR5LnAycFJlcXVlc3RlcjtcclxuICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgIFxyXG4gICAgICAgICAgICAgICAgICByZXNvbHZlKHJlc3VsdCk7XHJcblxyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdGYWlsZWQgdG8gcmVnaXN0ZXIgYW4gSHlwZXJ0eTogJyArIHJlcGx5KTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgICAgICAgICBsb2cuZXJyb3IoZSk7XHJcbiAgICAgICAgICAgICAgcmVqZWN0KGUpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ZhaWxlZCB0byByZWdpc3RlciBhbiBIeXBlcnR5IHRvIGRvbWFpbjogJywgcmVwbHkpO1xyXG4gICAgICAgICAgfVxyXG5cclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgICBsb2cuZXJyb3IoZSk7XHJcbiAgICAgICAgcmVqZWN0KGUpO1xyXG4gICAgICB9XHJcblxyXG4gICAgICAvL3RpbWVyIHRvIGtlZXAgdGhlIHJlZ2lzdHJhdGlvbiBhbGl2ZVxyXG4gICAgICAvLyB0aGUgdGltZSBpcyBkZWZpbmVkIGJ5IGEgbGl0dGxlIGxlc3MgdGhhbiBoYWxmIG9mIHRoZSBleHBpcmVzIHRpbWUgZGVmaW5lZFxyXG4gICAgICBsZXQga2VlcEFsaXZlVGltZXIgPSBzZXRJbnRlcnZhbChmdW5jdGlvbigpIHtcclxuXHJcbiAgICAgICAgbGV0IG1lc3NhZ2UgPSB7XHJcbiAgICAgICAgICB0eXBlOiAndXBkYXRlJyxcclxuICAgICAgICAgIGZyb206IF90aGlzLnJlZ2lzdHJ5VVJMLFxyXG4gICAgICAgICAgdG86ICdkb21haW46Ly9yZWdpc3RyeS4nICsgX3RoaXMuX2RvbWFpbixcclxuICAgICAgICAgIGJvZHk6IHsgcmVzb3VyY2U6IGh5cGVydHkuaHlwZXJ0eVVSTCwgdmFsdWU6IHtzdGF0dXM6ICdsaXZlJ30sIG1ldGhvZDogJ3JlZnJlc2gnIH19O1xyXG5cclxuICAgICAgICBfdGhpcy5fbWVzc2FnZUJ1cy5wb3N0TWVzc2FnZShtZXNzYWdlLCAocmVwbHkpID0+IHtcclxuICAgICAgICAgIC8vIGxvZy5sb2coJ1tSZWdpc3RyeSByZWdpc3Rlckh5cGVydHldIEtlZXBBbGl2ZSBSZXBseTogJywgcmVwbHkpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICB9LCAoKChyZWdpc3RyYXRpb25FeHBpcmVzIC8gMS4xKSAvIDIpICogMTAwMCkpO1xyXG4gICAgfSk7XHJcblxyXG4gIH1cclxuXHJcbn1cclxuXHJcbmV4cG9ydCBkZWZhdWx0IERvbWFpblJlZ2lzdHJhdGlvbjtcclxuIiwiLyoqXHJcbiogQ29weXJpZ2h0IDIwMTYgUFQgSW5vdmHDp8OjbyBlIFNpc3RlbWFzIFNBXHJcbiogQ29weXJpZ2h0IDIwMTYgSU5FU0MtSURcclxuKiBDb3B5cmlnaHQgMjAxNiBRVU9CSVMgTkVUV09SS1MgU0xcclxuKiBDb3B5cmlnaHQgMjAxNiBGUkFVTkhPRkVSLUdFU0VMTFNDSEFGVCBaVVIgRk9FUkRFUlVORyBERVIgQU5HRVdBTkRURU4gRk9SU0NIVU5HIEUuVlxyXG4qIENvcHlyaWdodCAyMDE2IE9SQU5HRSBTQVxyXG4qIENvcHlyaWdodCAyMDE2IERldXRzY2hlIFRlbGVrb20gQUdcclxuKiBDb3B5cmlnaHQgMjAxNiBBcGl6ZWVcclxuKiBDb3B5cmlnaHQgMjAxNiBURUNITklTQ0hFIFVOSVZFUlNJVEFUIEJFUkxJTlxyXG4qXHJcbiogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbipcclxuKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4qXHJcbiogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4qIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbioqL1xyXG5cclxuLy8gTG9nIFN5c3RlbVxyXG5pbXBvcnQgKiBhcyBsb2dnZXIgZnJvbSAnbG9nbGV2ZWwnO1xyXG5sZXQgbG9nID0gbG9nZ2VyLmdldExvZ2dlcignUDJQQ29ubmVjdGlvblJlc29sdmUnKTtcclxuXHJcbi8qKlxyXG4qICAgVG8gcHJvY2VzcyBhZGRyZXNzIHJlc29sdXRpb24gZm9yIHAycCBjb25uZWN0aW9uc1xyXG4qL1xyXG5jbGFzcyBQMlBDb25uZWN0aW9uUmVzb2x2ZSAge1xyXG5cclxuICBjb25zdHJ1Y3RvcihyZWdpc3RyeSkge1xyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuICAgIF90aGlzLl9yZWdpc3RyeSA9IHJlZ2lzdHJ5O1xyXG4gICAgX3RoaXMuX3JlbW90ZVAyUEVudGl0aWVzID0ge307IC8vIEFsbCByZW1vdGUgZW50aXRpZXMgYW5kIGFzc29jaWF0ZWQgcnVudGltZSB1cmwgdGhhdCBhcmUgcmVhY2hhYmxlIHdpdGggZXhpc3RpbmcgcDJwIGNvbm5lY3Rpb25zXHJcblxyXG4gIH1cclxuXHJcblxyXG4gIC8qKlxyXG4gICogVmVyaWZpZXMgaWYgcmVtb3RlIEVudGl0eSBjYW4gYmUgcmVhY2hlZCB3aXRoIGEgUDJQIENvbm5lY3Rpb24uXHJcbiAgKiBAcGFyYW0gIHtVUkwuVVJMfSAgICAgICAgaW5mbyAgICAgICAgICAgb2JqZWN0IFVSTFxyXG4gICogQHJldHVybiB7SHlwZXJ0eURhdGFPYmplY3RJbnN0YW5jZX0gIGFkZHJlc3NVUkwgICAgIHJldHVybiB0aGUgRGF0YSBPYmplY3QgaW5zdGFuY2UgcmVnaXN0ZXJlZCBVUkwsIHJldHVybiB1bmRlZmluZWQgb3RoZXJ3aXNlXHJcbiAgKi9cclxuXHJcbiAgY2hlY2tQMlAobXNnKSB7XHJcblxyXG4gICAgaWYgKCFtc2cuaGFzT3duUHJvcGVydHkoJ3RvJykpIHtcclxuICAgICAgLy8gdGhyb3cgRXJyb3IoJ1RoZSBwMnAgdmVyaWZpY2F0aW9uIHdhcyBmYWlsZWQnKTtcclxuICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KCdUaGUgcDJwIHZlcmlmaWNhdGlvbiB3YXMgZmFpbGVkJyk7XHJcbiAgICB9XHJcblxyXG4gICAgbGV0IHNjaGVtZSA9IG1zZy50by5zcGxpdCgnOi8vJylbMF07XHJcblxyXG4gICAgbGV0IGNvbXAgPSBtc2cudG8uc3BsaXQoJzovLycpWzFdLnNwbGl0KCcvJylbMl07XHJcblxyXG4gICAgbGV0IHVybDtcclxuXHJcbiAgICBpZiAoY29tcCkgdXJsID0gbXNnLnRvLnN1YnN0cmluZygwLCBtc2cudG8uaW5kZXhPZignLycgKyBjb21wKSk7XHJcbiAgICBlbHNlIHVybCA9IG1zZy50bztcclxuXHJcbiAgICBsZXQgcDJwID0ge307XHJcblxyXG4gICAgaWYgKG1zZy5ib2R5ICYmIG1zZy5ib2R5LnAycCkgcDJwLnAycCA9IG1zZy5ib2R5LnAycDtcclxuXHJcbiAgICBpZiAobXNnLmJvZHkgJiYgbXNnLmJvZHkucDJwSGFuZGxlciAmJiBtc2cuYm9keS5wMnBSZXF1ZXN0ZXIpIHtcclxuICAgICAgcDJwLnAycEhhbmRsZXIgPSBtc2cuYm9keS5wMnBIYW5kbGVyO1xyXG4gICAgICBwMnAucDJwUmVxdWVzdGVyID0gbXNnLmJvZHkucDJwUmVxdWVzdGVyO1xyXG4gICAgICBwMnAucnVudGltZSA9IG1zZy5ib2R5LnAycEhhbmRsZXIuc3BsaXQoJy9wMnBoYW5kbGVyLycpWzBdO1xyXG4gICAgfVxyXG5cclxuICAgIHN3aXRjaCAoc2NoZW1lKSB7XHJcbiAgICAgIGNhc2UgJ3J1bnRpbWUnOlxyXG4gICAgICAgIHJldHVybiB0aGlzLmNoZWNrUDJQUnVudGltZSh1cmwsIHAycCk7XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuY2hlY2tQMlBFbnRpdHkodXJsLCBwMnApO1xyXG4gICAgICAgIGJyZWFrO1xyXG5cclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICogVmVyaWZpZXMgaWYgcmVtb3RlIEVudGl0eSAoSHlwZXJ0eSBvciBEYXRhIE9iamVjdCkgY2FuIGJlIHJlYWNoZWQgd2l0aCBhIFAyUCBDb25uZWN0aW9uLlxyXG4gICogQHBhcmFtICB7c3RyaW5nfSAgICAgICAgdXJsICAgICAgICAgICBSZW1vdGUgRW50aXR5IFVSTCB0byBiZSBjaGVja2VkXHJcbiAgKiBAcGFyYW0gIHtvYmplY3R9ICAgICAgICBwMnAgICAgICAgICAgIHAycCBpbmZvcm1hdGlvbiB0byBiZSB1c2VkIGluY2x1ZGluZyDCtHJ1bnRpbWXCtCB3aXRoIHJlbW90ZSBSdW50aW1lIFVSTCwgJ3AycEhhbmRsZXInIHJlbW90ZSBQMlAgSGFuZGxlciBTdHViIFVSTCBhbmQgcDJwUmVxdWVzdGVyIHdpdGggQ2F0YWxvZ3VlIFVSTCBvZiBQMlAgUmVxdWVzdGVyIHRvIGJlIHVzZWRcclxuICAqIEByZXR1cm4ge3Byb21pc2V9IHJlZ2lzdGVyZWRFbnRpdHkgICAgIGlmIHAycCBjb25uZWN0aW9uIGlzIHBvc3NpYmxlIGl0IHJldHVybnMgcDJwIGluZm9ybWF0aW9uIHRvIGJlIHVzZWQgaW4gdGhlIGNvbm5lY3Rpb24sIG90aGVyd2lzZSB0aGUgcHJvbWlzZSBpcyByZWplY3RlZFxyXG4gICovXHJcblxyXG4gIGNoZWNrUDJQRW50aXR5KHVybCwgcDJwKSB7XHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG5cclxuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XHJcbiAgICAgIGxldCByZW1vdGVFbnRpdHkgPSBfdGhpcy5fcmVtb3RlUDJQRW50aXRpZXNbdXJsXTtcclxuXHJcbiAgICAgIGlmIChyZW1vdGVFbnRpdHkpIHJlc29sdmUocmVtb3RlRW50aXR5KTtcclxuICAgICAgZWxzZSBpZiAocDJwLnJ1bnRpbWUpIHJlc29sdmUocDJwKTsgLy8gdXNlIHByb3ZpZGVkIHAycCBpZiBhdmFpbGFibGUgaW4gdGhlIG1lc3NhZ2UgYm9keVxyXG4gICAgICBlbHNlIGlmIChwMnAucDJwKSB7IC8vIG90aGVyd2lzZSBsb29rIG9uIERvbWFpbiBSZWdpc3RyeVxyXG5cclxuICAgICAgICBsb2cubG9nKCdbUmVnaXN0cnkgLSBjaGVja1AyUEVudGl0eV0gLSBzZWFyY2ggaW4gRG9tYWluIFJlZ2lzdHJ5OiAnLCB1cmwpO1xyXG5cclxuICAgICAgICBsZXQgbWVzc2FnZSA9IHtcclxuICAgICAgICAgIHR5cGU6ICdyZWFkJyxcclxuICAgICAgICAgIGZyb206IF90aGlzLl9yZWdpc3RyeS5yZWdpc3RyeVVSTCxcclxuICAgICAgICAgIHRvOiAnZG9tYWluOi8vcmVnaXN0cnkuJyArIF90aGlzLl9yZWdpc3RyeS5fZG9tYWluLFxyXG4gICAgICAgICAgYm9keToge1xyXG4gICAgICAgICAgICByZXNvdXJjZTogdXJsXHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgX3RoaXMuX3JlZ2lzdHJ5Ll9tZXNzYWdlQnVzLnBvc3RNZXNzYWdlKG1lc3NhZ2UsIChyZXBseSkgPT4ge1xyXG4gICAgICAgICAgbG9nLmxvZygnW1JlZ2lzdHJ5IC0gY2hlY2tQMlBFbnRpdHldIERvbWFpbiBSZWdpc3RyeSByZXBseScsIHJlcGx5KTtcclxuICAgICAgICAgIGlmICgndmFsdWUnIGluIHJlcGx5LmJvZHkpIHtcclxuXHJcbiAgICAgICAgICAgIC8vdG9kbzogc3RvcmUgcmV0cmlldmVkIGVudGl0eVxyXG4gICAgICAgICAgICBsZXQgcmVzb2x2ZWRFbnRpdHkgPSByZXBseS5ib2R5LnZhbHVlO1xyXG5cclxuICAgICAgICAgICAgaWYgKHJlc29sdmVkRW50aXR5Lmhhc093blByb3BlcnR5KCdwMnBIYW5kbGVyJykpIHtcclxuICAgICAgICAgICAgICByZXNvbHZlKHJlc29sdmVkRW50aXR5KTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICByZWplY3QoJ1tSZWdpc3RyeSBjaGVja1AyUEVudGl0eV0gSHlwZXJ0eSBmb3VuZCBkb2VzIG5vdCBzdXBwb3J0IFAyUCcsIHJlcGx5LmJvZHkudmFsdWUpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgcmVqZWN0KCdbUmVnaXN0cnkgY2hlY2tQMlBFbnRpdHldIEh5cGVydHkgd2l0aCBQMlBIYW5kbGVyIG5vdCBmb3VuZCcsIHJlcGx5LmJvZHkuY29kZSk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH0gZWxzZSByZWplY3QoJ1tSZWdpc3RyeSBjaGVja1AyUEVudGl0eV0gTm8gUDJQIENvbm5lY3Rpb24gYXZhaWxhYmxlIGZvciAnLCB1cmwpO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAqIFZlcmlmaWVzIGlmIHJlbW90ZSBSdW50aW1lIGNhbiBiZSByZWFjaGVkIHdpdGggYSBQMlAgQ29ubmVjdGlvbi5cclxuICAqIEBwYXJhbSAge1VSTC5VUkx9ICAgICAgICBydW50aW1lVVJMICAgICAgICAgICBSdW50aW1lIFVSTFxyXG4gICogQHJldHVybiB7T2JqZWN0fSAgcDJwQ29ubmVjdGlvbiAgICByZXR1cm4gdGhlIFAyUENvbm5lY3Rpb24gaW5zdGFuY2UgcmVnaXN0ZXJlZCBVUkwsIHJldHVybiB1bmRlZmluZWQgb3RoZXJ3aXNlXHJcbiAgKi9cclxuXHJcbiAgY2hlY2tQMlBSdW50aW1lKHJ1bnRpbWVVUkwsIHAycCkge1xyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuXHJcbiAgICBsZXQgcmVnaXN0ZXJlZFJ1bnRpbWUgPSB7fTtcclxuXHJcbiAgICAvLyBsb29rIG9uIGxvY2FsbHkgc3RvcmVkIHAycCBjb25uZWN0aW9uc1xyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcclxuICAgICAgaWYgKF90aGlzLl9yZWdpc3RyeS5wMnBDb25uZWN0aW9uTGlzdFtydW50aW1lVVJMXSkge1xyXG4gICAgICAgIHJlc29sdmUoe3J1bnRpbWU6IHJ1bnRpbWVVUkx9KTtcclxuICAgICAgfSBlbHNlIGlmICggcDJwLnJ1bnRpbWUpIHtcclxuICAgICAgICByZWdpc3RlcmVkUnVudGltZSA9IHAycDtcclxuICAgICAgICByZXNvbHZlKHJlZ2lzdGVyZWRSdW50aW1lKTtcclxuICAgICAgfSBlbHNlIHJlamVjdCgnW1JlZ2lzdHJ5LlAyUENvbm5lY3Rpb25SZXNvbHZlLmNoZWNrUDJQUnVudGltZV0gTm8gUDJQIENvbm5lY3Rpb24gZm91bmQgdG8gJywgcnVudGltZVVSTCk7XHJcblxyXG4gICAgfSk7XHJcblxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgKiBWZXJpZmllcyBpZiByZW1vdGUgSHlwZXJ0eSBjYW4gYmUgcmVhY2hlZCB3aXRoIGEgUDJQIENvbm5lY3Rpb24uXHJcbiAgKiBAcGFyYW0gIHtKU09OfSAgICAgICAgaW5mbyAgICAgICAgICAgb2JqZWN0IG9yIGVudGl0eSBjaGFyYXRlcmlzdGljcyBpbmZvXHJcbiAgKiBAcmV0dXJuIHthZGRyZXNzVVJMfSAgYWRkcmVzc1VSTCAgICAgcmV0dXJuIHRoZSBVUkwgaWYgdGhlcmUgaXMgYW55IHByZXZpb3VzeSByZWdpc3RlcmVkIFVSTCwgcmV0dXJuIHVuZGVmaW5lZCBvdGhlcndpc2VcclxuICAqL1xyXG5cclxuICBjaGVja1AyUEh5cGVydHkoaHlwZXJ0eVVSTCwgcDJwKSB7XHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG5cclxuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XHJcbiAgICAgIGxldCBoeXBlcnR5O1xyXG5cclxuXHJcbiAgICAgIC8vIGxvb2sgb24gbG9jYWxseSBzdG9yZWQgaHlwZXJ0aWVzXHJcblxyXG4gICAgICBmb3IgKGxldCBpIGluIF90aGlzLl9yZWdpc3RyeS5yZW1vdGVIeXBlcnR5TGlzdCkge1xyXG4gICAgICAgIGh5cGVydHkgPSBfdGhpcy5fcmVnaXN0cnkucmVtb3RlSHlwZXJ0eUxpc3RbaV07XHJcblxyXG4gICAgICAgIGxvZy5sb2coJ1tSZWdpc3RyeSAtIGNoZWNrUDJQSHlwZXJ0eV0gLSBmb3IgZWFjaCBIeXBlcnR5OiAnLCBoeXBlcnR5KTtcclxuXHJcbiAgICAgICAgLy8gdG9kbzogY2hhbmdlIHRvIFwiaHlwZXJ0eS51cmxcIiB0byBiZSBhbGlnbmVkIHdpdGggaHlwZXJ0eSBpbnN0YW5jZSBkYXRhIG1vZGVsIHNwZWNcclxuXHJcbiAgICAgICAgaWYgKGh5cGVydHkuaHlwZXJ0eUlEID09PSBoeXBlcnR5VVJMKSB7XHJcblxyXG4gICAgICAgICAgaWYgKGh5cGVydHkuaGFzT3duUHJvcGVydHkoJ3AycEhhbmRsZXInKSkge1xyXG4gICAgICAgICAgICByZXNvbHZlKGh5cGVydHkpO1xyXG4gICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgcmVqZWN0KCdbUmVnaXN0cnkgY2hlY2tQMlBIeXBlcnR5XSBIeXBlcnR5IGZvdW5kIGRvZXMgbm90IHN1cHBvcnQgUDJQJywgaHlwZXJ0eSk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcblxyXG4gICAgICBpZiAoIWh5cGVydHkgJiYgcDJwLnJ1bnRpbWUpIHJlc29sdmUocDJwKTsgLy8gdXNlIHByb3ZpZGVkIHAycCBpZiBhdmFpbGFibGUgaW4gdGhlIG1lc3NhZ2UgYm9keVxyXG4gICAgICBlbHNlIGlmICghaHlwZXJ0eSAmJiBwMnAucDJwKSB7IC8vIG90aGVyd2lzZSBsb29rIG9uIERvbWFpbiBSZWdpc3RyeVxyXG5cclxuICAgICAgICBsb2cubG9nKCdbUmVnaXN0cnkgLSBjaGVja1AyUEh5cGVydHldIC0gc2VhcmNoIGluIERvbWFpbiBSZWdpc3RyeTogJywgaHlwZXJ0eSk7XHJcblxyXG4gICAgICAgIGxldCBtZXNzYWdlID0ge1xyXG4gICAgICAgICAgdHlwZTogJ3JlYWQnLFxyXG4gICAgICAgICAgZnJvbTogX3RoaXMuX3JlZ2lzdHJ5LnJlZ2lzdHJ5VVJMLFxyXG4gICAgICAgICAgdG86ICdkb21haW46Ly9yZWdpc3RyeS4nICsgX3RoaXMuX3JlZ2lzdHJ5Ll9kb21haW4sXHJcbiAgICAgICAgICBib2R5OiB7XHJcbiAgICAgICAgICAgIHJlc291cmNlOiBoeXBlcnR5VVJMXHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgX3RoaXMuX3JlZ2lzdHJ5Ll9tZXNzYWdlQnVzLnBvc3RNZXNzYWdlKG1lc3NhZ2UsIChyZXBseSkgPT4ge1xyXG4gICAgICAgICAgbG9nLmxvZygnW1JlZ2lzdHJ5IC0gY2hlY2tQMlBIeXBlcnR5XSBEb21haW4gUmVnaXN0cnkgcmVwbHknLCByZXBseSk7XHJcbiAgICAgICAgICBpZiAoJ3ZhbHVlJyBpbiByZXBseS5ib2R5KSB7XHJcblxyXG4gICAgICAgICAgICAvL3RvZG86IHN0b3JlIHJldHJpZXZlZCBoeXBlcnR5XHJcbiAgICAgICAgICAgIGxldCByZXNvbHZlZEh5cGVydHkgPSByZXBseS5ib2R5LnZhbHVlO1xyXG5cclxuICAgICAgICAgICAgX3RoaXMuX3JlZ2lzdHJ5LnJlbW90ZUh5cGVydHlMaXN0LnB1c2gocmVzb2x2ZWRIeXBlcnR5KTtcclxuXHJcbiAgICAgICAgICAgIGlmIChyZXNvbHZlZEh5cGVydHkuaGFzT3duUHJvcGVydHkoJ3AycEhhbmRsZXInKSkge1xyXG4gICAgICAgICAgICAgIHJlc29sdmUocmVzb2x2ZWRIeXBlcnR5KTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICByZWplY3QoJ1tSZWdpc3RyeSBjaGVja1AyUEh5cGVydHldIEh5cGVydHkgZm91bmQgZG9lcyBub3Qgc3VwcG9ydCBQMlAnLCByZXBseS5ib2R5LnZhbHVlKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHJlamVjdCgnW1JlZ2lzdHJ5IGNoZWNrUDJQSHlwZXJ0eV0gSHlwZXJ0eSB3aXRoIFAyUEhhbmRsZXIgbm90IGZvdW5kJywgcmVwbHkuYm9keS5jb2RlKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgfSBlbHNlIHJlamVjdCgnW1JlZ2lzdHJ5IGNoZWNrUDJQSHlwZXJ0eV0gTm8gUDJQIENvbm5lY3Rpb24gYXZhaWxhYmxlIGZvciAnLCBoeXBlcnR5VVJMKTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgKiBWZXJpZmllcyBpZiByZW1vdGUgRGF0YSBPYmplY3QgY2FuIGJlIHJlYWNoZWQgd2l0aCBhIFAyUCBDb25uZWN0aW9uLlxyXG4gICogQHBhcmFtICB7VVJMLlVSTH0gICAgICAgIERhdGFPYmplY3RVUkwgICAgICAgICAgIG9iamVjdCBVUkxcclxuICAqIEByZXR1cm4ge0h5cGVydHlEYXRhT2JqZWN0SW5zdGFuY2V9ICBhZGRyZXNzVVJMICAgICByZXR1cm4gdGhlIERhdGEgT2JqZWN0IGluc3RhbmNlIHJlZ2lzdGVyZWQgVVJMLCByZXR1cm4gdW5kZWZpbmVkIG90aGVyd2lzZVxyXG4gICovXHJcblxyXG4gIGNoZWNrUDJQRGF0YU9iamVjdCh1cmwsIHAycCkge1xyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuXHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xyXG5cclxuICAgICAgLy8gbG9vayBvbiBsb2NhbGx5IHN0b3JlZCBSZW1vdGUgRGF0YSBPYmplY3RzXHJcblxyXG4gICAgICBsZXQgZGF0YW9iamVjdCA9IF90aGlzLl9yZWdpc3RyeS5yZW1vdGVEYXRhT2JqZWN0TGlzdC5maWx0ZXIoKGkpID0+IHtcclxuICAgICAgICByZXR1cm4gKF90aGlzLl9yZWdpc3RyeS5yZW1vdGVEYXRhT2JqZWN0TGlzdFtpXS51cmwgPT09IHVybCk7XHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgaWYgKGRhdGFvYmplY3QubGVuZ3RoICE9PSAwICYmIGRhdGFvYmplY3RbMF0ucDJwUmVxdWVzdGVyKSB7XHJcbiAgICAgICAgcmVzb2x2ZShkYXRhb2JqZWN0WzBdKTtcclxuICAgICAgfSBlbHNlIGlmIChkYXRhb2JqZWN0Lmxlbmd0aCAhPT0gMCkge1xyXG4gICAgICAgIHJlamVjdCgnW1JlZ2lzdHJ5IGNoZWNrUDJQRGF0YU9iamVjdF0gRGF0YSBPYmplY3QgZm91bmQgZG9lcyBub3Qgc3VwcG9ydCBQMlAnLCBkYXRhb2JqZWN0WzBdKTtcclxuICAgICAgfSBlbHNlIGlmIChkYXRhb2JqZWN0Lmxlbmd0aCA9PT0gMCAmJiBwMnAucnVudGltZSkgcmVzb2x2ZShwMnApOyAvLyB1c2UgcHJvdmlkZWQgcDJwIGluZm8gaWYgYXZhaWxhYmxlIGluIHRoZSBtZXNzYWdlIGJvZHlcclxuICAgICAgZWxzZSBpZiAoZGF0YW9iamVjdC5sZW5ndGggJiYgcDJwLnAycCkgeyAvLyBvdGhlcndpc2UgbG9vayBvbiBEb21haW4gUmVnaXN0cnlcclxuXHJcbiAgICAgIC8vIGxvb2sgb24gRG9tYWluIFJlZ2lzdHJ5XHJcblxyXG4gICAgICAgIGxldCBtZXNzYWdlID0ge1xyXG4gICAgICAgICAgdHlwZTogJ3JlYWQnLFxyXG4gICAgICAgICAgZnJvbTogX3RoaXMuX3JlZ2lzdHJ5LnJlZ2lzdHJ5VVJMLFxyXG4gICAgICAgICAgdG86ICdkb21haW46Ly9yZWdpc3RyeS4nICsgX3RoaXMuX3JlZ2lzdHJ5Ll9kb21haW4sXHJcbiAgICAgICAgICBib2R5OiB7XHJcbiAgICAgICAgICAgIHJlc291cmNlOiB1cmxcclxuICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBfdGhpcy5fcmVnaXN0cnkuX21lc3NhZ2VCdXMucG9zdE1lc3NhZ2UobWVzc2FnZSwgKHJlcGx5KSA9PiB7XHJcbiAgICAgICAgICBsb2cubG9nKCdkaXNjb3ZlciBkYXRhIG9iamVjdCBwZXIgdXJsIHJlcGx5JywgcmVwbHkpO1xyXG4gICAgICAgICAgaWYgKCd2YWx1ZScgaW4gcmVwbHkuYm9keSkge1xyXG5cclxuICAgICAgICAgICAgLy90b2RvOiBzdG9yZSByZXRyaWV2ZWQgaHlwZXJ0eVxyXG4gICAgICAgICAgICBsZXQgcmVzb2x2ZWREYXRhT2JqZWN0ID0gcmVwbHkuYm9keS52YWx1ZTtcclxuXHJcbiAgICAgICAgICAgIF90aGlzLl9yZWdpc3RyeS5yZW1vdGVEYXRhT2JqZWN0TGlzdC5wdXNoKHJlc29sdmVkRGF0YU9iamVjdCk7XHJcblxyXG4gICAgICAgICAgICBpZiAocmVzb2x2ZWREYXRhT2JqZWN0LnAycFJlcXVlc3Rlcikge1xyXG4gICAgICAgICAgICAgIHJlc29sdmUocmVzb2x2ZWREYXRhT2JqZWN0KTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICByZWplY3QoJ1tSZWdpc3RyeSBjaGVja1AyUERhdGFPYmplY3RdIERhdGEgT2JqZWN0IGZvdW5kIGRvZXMgbm90IHN1cHBvcnQgUDJQJywgcmVwbHkuYm9keS52YWx1ZSk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICByZWplY3QoJ1tSZWdpc3RyeSBjaGVja1AyUERhdGFPYmplY3RdIG5vdCBmb3VuZCcsIHJlcGx5LmJvZHkuY29kZSk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH0gZWxzZSByZWplY3QoJ1tSZWdpc3RyeSBjaGVja1AyUERhdGFPYmplY3RdIG5vIFAyUCBDb25uZWN0aW9uIGZvdW5kJyk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIGFkZFJlbW90ZVAyUEVudGl0eSh1cmwsIHJ1bnRpbWUpIHtcclxuICAgIHRoaXMuX3JlbW90ZVAyUEVudGl0aWVzW3VybF0gPSBydW50aW1lO1xyXG4gIH1cclxuXHJcbiAgcmVtb3ZlUmVtb3RlUDJQRW50aXR5KHVybCkge1xyXG4gICAgZGVsZXRlIHRoaXMuX3JlbW90ZVAyUEVudGl0aWVzW3VybF07XHJcbiAgfVxyXG5cclxuICByZWNvbm5lY3RQMlBSZXF1ZXN0ZXIocDJwUmVxdWVzdGVyKSB7XHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG5cclxuICAgIGxvZy5sb2coJ1tQMlBDb25lbmN0aW9uUmVzb2x2ZS5yZWNvbm5lY3RQMlBSZXF1ZXN0ZXJdIGxldHMgdHJ5IHRvIHJlY29ubmVjdCBQMlAgUmVxdWVzdGVyIFN0dWI6ICcsIHAycFJlcXVlc3Rlcik7XHJcblxyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcclxuXHJcbiAgICAgIGxldCByZW1vdGVSdW50aW1lID0gcDJwUmVxdWVzdGVyLnJ1bnRpbWU7XHJcblxyXG4gICAgICBsZXQgbWVzc2FnZSA9IHtcclxuICAgICAgICB0eXBlOiAnZXhlY3V0ZScsXHJcbiAgICAgICAgZnJvbTogX3RoaXMuX3JlZ2lzdHJ5LnJlZ2lzdHJ5VVJMLFxyXG4gICAgICAgIHRvOiBwMnBSZXF1ZXN0ZXIudXJsLFxyXG4gICAgICAgIGJvZHk6IHtcclxuICAgICAgICAgIG1ldGhvZDogJ2Nvbm5lY3QnLFxyXG4gICAgICAgICAgcGFyYW1zOiBbcDJwUmVxdWVzdGVyLnAycEhhbmRsZXJdXHJcbiAgICAgICAgfVxyXG4gICAgICB9O1xyXG5cclxuICAgICAgLy8gbGV0cyBwcmVwYXJlIHRoZSBwMnBSZXF1ZXN0ZXJTVHViIHJlY29ubmVjdCBieSBzZXR0aW5nIGFuIG9ic2VydmVyIHRvIGl0cyBzdGF0dXMgY2hhbmdlc1xyXG5cclxuICAgICAgX3RoaXMuX3JlZ2lzdHJ5LndhdGNoaW5nWW91Lm9ic2VydmUoJ3AycFJlcXVlc3RlclN0dWInLCAoY2hhbmdlKSA9PiB7XHJcblxyXG4gICAgICAgIGxvZy5sb2coJ1tQMlBDb25lbmN0aW9uUmVzb2x2ZS5yZWNvbm5lY3RQMlBSZXF1ZXN0ZXJdIHAycFJlcXVlc3RlclN0dWJzIGNoYW5nZWQgJyArIF90aGlzLl9yZWdpc3RyeS5wMnBSZXF1ZXN0ZXJTdHViKTtcclxuXHJcbiAgICAgICAgaWYgKGNoYW5nZS5rZXlwYXRoLnNwbGl0KCcuJylbMF0gPT09IHJlbW90ZVJ1bnRpbWUgJiYgY2hhbmdlLm5hbWUgPT09ICdzdGF0dXMnKSB7XHJcbiAgICAgICAgICBzd2l0Y2ggKGNoYW5nZS5uZXdWYWx1ZSkge1xyXG4gICAgICAgICAgICBjYXNlICdsaXZlJzpcclxuICAgICAgICAgICAgICBsb2cubG9nKCdbUDJQQ29uZW5jdGlvblJlc29sdmUucmVjb25uZWN0UDJQUmVxdWVzdGVyXSBwMnBSZXF1ZXN0ZXIgaXMgbGl2ZSAnICsgX3RoaXMuX3JlZ2lzdHJ5LnAycFJlcXVlc3RlclN0dWJbcmVtb3RlUnVudGltZV0pO1xyXG4gICAgICAgICAgICAgIHJlc29sdmUoX3RoaXMuX3JlZ2lzdHJ5LnAycFJlcXVlc3RlclN0dWJbcmVtb3RlUnVudGltZV0udXJsKTtcclxuICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSAnZmFpbGVkJzpcclxuICAgICAgICAgICAgICBsb2cubG9nKCdbUDJQQ29uZW5jdGlvblJlc29sdmUucmVjb25uZWN0UDJQUmVxdWVzdGVyXSBwMnBSZXF1ZXN0ZXIgcmVjb25uZWN0IGZhaWxlZCAnICsgX3RoaXMuX3JlZ2lzdHJ5LnAycFJlcXVlc3RlclN0dWJbcmVtb3RlUnVudGltZV0pO1xyXG4gICAgICAgICAgICAgIHJlamVjdCgnUDJQIFJlcXVlc3RlciByZWNvbm5lY3QgZmFpbGVkJyk7XHJcbiAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIC8vICBzdHViIGxvYWRcclxuICAgICAgX3RoaXMuX3JlZ2lzdHJ5Ll9tZXNzYWdlQnVzLnBvc3RNZXNzYWdlKG1lc3NhZ2UsIChyZXBseSkgPT4ge1xyXG4gICAgICAgIGxvZy5sb2coJ1tQMlBDb25lbmN0aW9uUmVzb2x2ZS5yZWNvbm5lY3RQMlBSZXF1ZXN0ZXJdIHJlY29ubmVjdCByZXF1ZXN0IHJlcGx5JywgcmVwbHkpO1xyXG4gICAgICB9KTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbn1cclxuXHJcbmV4cG9ydCBkZWZhdWx0IFAyUENvbm5lY3Rpb25SZXNvbHZlO1xyXG4iLCJpbXBvcnQgJ3Byb3h5LW9ic2VydmUnO1xyXG5cclxuY2xhc3MgV2F0Y2hpbmdZb3Uge1xyXG5cclxuICBjb25zdHJ1Y3RvcigpIHtcclxuICAgIHRoaXMuX3dhdGNoaW5nID0ge307XHJcbiAgICB0aGlzLl9vYnNlcnZlcnMgPSBbXTtcclxuICB9XHJcblxyXG4gIHdhdGNoKGtleSwgb2JqZWN0LCBkZWVwID0gZmFsc2UpIHtcclxuICAgIGlmIChkZWVwKSB7XHJcbiAgICAgIHRoaXMuX3dhdGNoaW5nW2tleV0gPSBPYmplY3QuZGVlcE9ic2VydmUob2JqZWN0LCAoY2hhbmdlcykgPT4ge1xyXG4gICAgICAgIGNoYW5nZXMuZXZlcnkoKGNoYW5nZSkgPT4ge1xyXG4gICAgICAgICAgdGhpcy5fZmlyZUV2ZW50KGtleSwgY2hhbmdlKTtcclxuICAgICAgICB9KTtcclxuICAgICAgfSk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB0aGlzLl93YXRjaGluZ1trZXldID0gT2JqZWN0Lm9ic2VydmUob2JqZWN0LCAoY2hhbmdlcykgPT4ge1xyXG4gICAgICAgIGNoYW5nZXMuZXZlcnkoKGNoYW5nZSkgPT4ge1xyXG4gICAgICAgICAgdGhpcy5fZmlyZUV2ZW50KGtleSwgY2hhbmdlKTtcclxuICAgICAgICB9KTtcclxuICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gdGhpcy5fd2F0Y2hpbmdba2V5XTtcclxuICB9XHJcblxyXG4gIG9ic2VydmUoa2V5LCBjYWxsYmFjaykge1xyXG4gICAgdGhpcy5fb2JzZXJ2ZXJzLnB1c2goe2tleToga2V5LCBjYWxsYmFjazogY2FsbGJhY2t9KTtcclxuICB9XHJcblxyXG4gIF9maXJlRXZlbnQoa2V5LCBjaGFuZ2UpIHtcclxuXHJcbiAgICB0aGlzLl9vYnNlcnZlcnMuZmlsdGVyKChvYnNlcnZlKSA9PiB7XHJcbiAgICAgIHJldHVybiBvYnNlcnZlLmtleSA9PT0ga2V5O1xyXG4gICAgfSkuZm9yRWFjaCgob2JzZXJ2ZSkgPT4ge1xyXG4gICAgICBvYnNlcnZlLmNhbGxiYWNrKGNoYW5nZSk7XHJcbiAgICB9KTtcclxuXHJcbiAgfVxyXG5cclxufVxyXG5cclxuZXhwb3J0IGRlZmF1bHQgV2F0Y2hpbmdZb3U7XHJcblxyXG4vKmxldCB3YXRjaENoYW5nZXMgPSBuZXcgV2F0Y2hDaGFuZ2VzKCk7XHJcbmxldCBwMnBSZXF1ZXN0ZXJTdHViID0gd2F0Y2hDaGFuZ2VzLndhdGNoKCdwMnAnLCB7fSwgdHJ1ZSk7XHJcbmxldCBzdHViID0gd2F0Y2hDaGFuZ2VzLndhdGNoKCdzdHViJywge30pO1xyXG5cclxud2F0Y2hDaGFuZ2VzLm9ic2VydmUoJ3AycCcsIChjaGFuZ2UpID0+IHtcclxuICBjb25zb2xlLmxvZygncDJwUmVxdWVzdGVyU3R1YjogJyArIGNoYW5nZS5uYW1lICsgJyAtICcgKyBKU09OLnN0cmluZ2lmeShjaGFuZ2UubmV3VmFsdWUpKTtcclxufSk7XHJcblxyXG53YXRjaENoYW5nZXMub2JzZXJ2ZSgncDJwJywgKGNoYW5nZSkgPT4ge1xyXG4gIGNvbnNvbGUubG9nKCdwMnBSZXF1ZXN0ZXJTdHViOiAnICsgY2hhbmdlLm5hbWUgKyAnIC0gJyArIEpTT04uc3RyaW5naWZ5KGNoYW5nZS5uZXdWYWx1ZSkpO1xyXG59KTtcclxuXHJcbndhdGNoQ2hhbmdlcy5vYnNlcnZlKCdzdHViJywgKGNoYW5nZSkgPT4ge1xyXG4gIGNvbnNvbGUubG9nKCdzdHViICcgKyBjaGFuZ2UubmFtZSk7XHJcbn0pO1xyXG5cclxucDJwUmVxdWVzdGVyU3R1Yi5hID0ge307XHJcbnN0dWIuYiA9IHtuYW1lOiAndml0b3InfTtcclxucDJwUmVxdWVzdGVyU3R1Yi5hLm5hbWUgPSAnSGVsbG8nO1xyXG5zdHViLmIgPSB7bmFtZTogJ3ZpdG9yJ307XHJcbnAycFJlcXVlc3RlclN0dWIuYS5hZ2UgPSAnMzInO1xyXG5wMnBSZXF1ZXN0ZXJTdHViLmEubmFtZSA9ICdXb3JsZCc7Ki9cclxuIiwiaW1wb3J0IFdhdGNoaW5nWW91IGZyb20gJy4vdXRpbHMvV2F0Y2hpbmdZb3UnO1xyXG5cclxuZXhwb3J0IHsgV2F0Y2hpbmdZb3UgfTtcclxuIiwiLyoqXHJcbiogQ29weXJpZ2h0IDIwMTYgUFQgSW5vdmHDp8OjbyBlIFNpc3RlbWFzIFNBXHJcbiogQ29weXJpZ2h0IDIwMTYgSU5FU0MtSURcclxuKiBDb3B5cmlnaHQgMjAxNiBRVU9CSVMgTkVUV09SS1MgU0xcclxuKiBDb3B5cmlnaHQgMjAxNiBGUkFVTkhPRkVSLUdFU0VMTFNDSEFGVCBaVVIgRk9FUkRFUlVORyBERVIgQU5HRVdBTkRURU4gRk9SU0NIVU5HIEUuVlxyXG4qIENvcHlyaWdodCAyMDE2IE9SQU5HRSBTQVxyXG4qIENvcHlyaWdodCAyMDE2IERldXRzY2hlIFRlbGVrb20gQUdcclxuKiBDb3B5cmlnaHQgMjAxNiBBcGl6ZWVcclxuKiBDb3B5cmlnaHQgMjAxNiBURUNITklTQ0hFIFVOSVZFUlNJVEFUIEJFUkxJTlxyXG4qXHJcbiogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbipcclxuKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4qXHJcbiogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4qIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbioqL1xyXG5cclxuLy8gTG9nIFN5c3RlbVxyXG5pbXBvcnQgKiBhcyBsb2dnZXIgZnJvbSAnbG9nbGV2ZWwnO1xyXG5sZXQgbG9nID0gbG9nZ2VyLmdldExvZ2dlcignUmVnaXN0cnknKTtcclxuXHJcbmltcG9ydCB7IHJ1bnRpbWVVdGlscyB9IGZyb20gJy4uL3J1bnRpbWUvcnVudGltZVV0aWxzJztcclxuaW1wb3J0IHsgU2FuZGJveFR5cGV9IGZyb20gJy4uL3NhbmRib3gvU2FuZGJveCc7XHJcblxyXG5pbXBvcnQgQWRkcmVzc0FsbG9jYXRpb24gZnJvbSAnLi4vYWxsb2NhdGlvbi9BZGRyZXNzQWxsb2NhdGlvbic7XHJcbmltcG9ydCBIeXBlcnR5SW5zdGFuY2UgZnJvbSAnLi9IeXBlcnR5SW5zdGFuY2UnO1xyXG5pbXBvcnQgRG9tYWluUmVnaXN0cmF0aW9uIGZyb20gJy4vRG9tYWluUmVnaXN0cmF0aW9uJztcclxuaW1wb3J0IFAyUENvbm5lY3Rpb25SZXNvbHZlIGZyb20gJy4vUDJQQ29ubmVjdGlvblJlc29sdmUnO1xyXG5cclxuaW1wb3J0IHsgZGl2aWRlVVJMLCBpc0h5cGVydHlVUkwsIGlzVVJMLCBpc1VzZXJVUkwsIGdlbmVyYXRlR1VJRCwgZ2V0VXNlcklkZW50aXR5RG9tYWluLCBpc0JhY2tlbmRTZXJ2aWNlVVJMLCBkZWVwQ2xvbmUsIHJlbW92ZVBhdGhGcm9tVVJMIH0gZnJvbSAnLi4vdXRpbHMvdXRpbHMuanMnO1xyXG5cclxuaW1wb3J0ICdwcm94eS1vYnNlcnZlJztcclxuaW1wb3J0IHsgV2F0Y2hpbmdZb3UgfSBmcm9tICcuLi9VdGlscyc7XHJcblxyXG4vLyBpbXBvcnQgRGlzY292ZXJ5U2VydmljZUZyYW1ld29yayBmcm9tICcuL0Rpc2NvdmVyeVNlcnZpY2VGcmFtZXdvcmsnO1xyXG5cclxuY29uc3QgU1RBVFVTID0geyBDUkVBVEVEOiAnY3JlYXRlZCcsIExJVkU6ICdsaXZlJywgREVQTE9ZSU5HOiAnZGVwbG95aW5nJywgREVQTE9ZRUQ6ICdkZXBsb3llZCcsIFBST0dSRVNTOiAnaW4tcHJvZ3Jlc3MnLCBESVNDT05ORUNURUQ6ICdkaXNjb25uZWN0ZWQnLCBGQUlMRUQ6ICdkZXBsb3ltZW50LWZhaWxlZCcsIERFQUQ6ICdkZWFkJyB9O1xyXG5cclxuLyppbXBvcnQgSWRlbnRpdHlNYW5hZ2VyIGZyb20gJy4vSWRlbnRpdHlNYW5hZ2VyJztcclxuaW1wb3J0IERpc2NvdmVyeSBmcm9tICcuL0Rpc2NvdmVyeSc7Ki9cclxuXHJcbi8qKlxyXG4qIFJ1bnRpbWUgUmVnaXN0cnkgSW50ZXJmYWNlXHJcbiovXHJcbmNsYXNzIFJlZ2lzdHJ5IHtcclxuXHJcbiAgLyoqXHJcbiAgKiBUbyBpbml0aWFsaXNlIHRoZSBSdW50aW1lIFJlZ2lzdHJ5IHdpdGggdGhlIFJ1bnRpbWVVUkwgdGhhdCB3aWxsIGJlIHRoZSBiYXNpcyB0byBkZXJpdmUgdGhlIGludGVybmFsIHJ1bnRpbWUgYWRkcmVzc2VzIHdoZW4gYWxsb2NhdGluZyBhZGRyZXNzZXMgdG8gaW50ZXJuYWwgcnVudGltZSBjb21wb25lbnQuIEluIGFkZGl0aW9uLCB0aGUgUmVnaXN0cnkgZG9tYWluIGJhY2stZW5kIHRvIGJlIHVzZWQgdG8gcmVtb3RlbHkgcmVnaXN0ZXIgUnVudGltZSBjb21wb25lbnRzLCBpcyBhbHNvIHBhc3NlZCBhcyBpbnB1dCBwYXJhbWV0ZXIuXHJcbiAgKiBAcGFyYW0gIHtNZXNzYWdlQnVzfSAgICAgICAgICBtc2didXMgICAgICAgICAgICAgICAgbXNnYnVzXHJcbiAgKiBAcGFyYW0gIHtIeXBlcnR5UnVudGltZVVSTH0gICBydW50aW1lVVJMICAgICAgICAgICAgcnVudGltZVVSTFxyXG4gICogQHBhcmFtICB7QXBwU2FuZGJveH0gICAgICAgICAgYXBwU2FuZGJveCAgICAgICAgICAgIGFwcFNhbmRib3hcclxuICAqIEBwYXJhbSAge3J1bnRpbWVDYXRhbG9ndWV9ICAgIHJ1bnRpbWVDYXRhbG9ndWUgICAgICBydW50aW1lQ2F0YWxvZ3VlXHJcbiAgKiBAcGFyYW0gIHtEb21haW5VUkx9ICAgICAgICAgICByZW1vdGVSZWdpc3RyeSAgICAgICAgcmVtb3RlUmVnaXN0cnlcclxuICAqIEBwYXJhbSAge3N0b3JhZ2VNYW5hZ2VyfSAgICAgIHN0b3JhZ2VNYW5hZ2VyXHJcbiAgKi9cclxuICBjb25zdHJ1Y3RvcihydW50aW1lVVJMLCBhcHBTYW5kYm94LCBpZGVudGl0eU1vZHVsZSwgcnVudGltZUNhdGFsb2d1ZSwgcnVudGltZUNhcGFiaWxpdGllcywgc3RvcmFnZU1hbmFnZXIsIHAycEhhbmRsZXJVUkwsIHJlbW90ZVJlZ2lzdHJ5KSB7XHJcblxyXG4gICAgLy8gaG93IHNvbWUgZnVuY3Rpb25zIHJlY2VpdmUgdGhlIHBhcmFtZXRlcnMgZm9yIGV4YW1wbGU6XHJcbiAgICAvLyBuZXcgUmVnaXN0cnkoJ2h5cGVydHktcnVudGltZTovL3NwMS8xMjMnLCBhcHBTYW5kYm94LCBpZE1vZHVsZSwgcmVtb3RlUmVnaXN0cnkpO1xyXG4gICAgLy8gcmVnaXN0cnkucmVnaXN0ZXJTdHViKHNhbmRib3gsICdzcDEnKTtcclxuICAgIC8vIHJlZ2lzdHJ5LnJlZ2lzdGVySHlwZXJ0eShzYW5kQm94LCAnaHlwZXJ0eS1ydW50aW1lOi8vc3AxLzEyMycpO1xyXG4gICAgLy8gcmVnaXN0cnkucmVzb2x2ZSgnaHlwZXJ0eS1ydW50aW1lOi8vc3AxLzEyMycpO1xyXG5cclxuICAgIGlmICghcnVudGltZVVSTCkgdGhyb3cgbmV3IEVycm9yKCdydW50aW1lVVJMIGlzIG1pc3NpbmcuJyk7XHJcbiAgICBpZiAoIXN0b3JhZ2VNYW5hZ2VyKSB0aHJvdyBuZXcgRXJyb3IoJ3N0b3JhZ2VNYW5hZ2VyIGlzIG1pc3NpbmcuJyk7XHJcblxyXG4gICAgLyppZiAoIXJlbW90ZVJlZ2lzdHJ5KSB0aHJvdyBuZXcgRXJyb3IoJ3JlbW90ZVJlZ2lzdHJ5IGlzIG1pc3NpbmcnKTsqL1xyXG5cclxuICAgIGxldCBfdGhpcyA9IHRoaXM7XHJcblxyXG4gICAgX3RoaXMucmVnaXN0cnlVUkwgPSBydW50aW1lVVJMICsgJy9yZWdpc3RyeS8nO1xyXG4gICAgX3RoaXMuYXBwU2FuZGJveCA9IGFwcFNhbmRib3g7XHJcbiAgICBfdGhpcy5ydW50aW1lVVJMID0gcnVudGltZVVSTDtcclxuICAgIF90aGlzLnAycEhhbmRsZXJVUkwgPSBwMnBIYW5kbGVyVVJMO1xyXG4gICAgX3RoaXMucnVudGltZUNhdGFsb2d1ZSA9IHJ1bnRpbWVDYXRhbG9ndWU7XHJcbiAgICBfdGhpcy5yZW1vdGVSZWdpc3RyeSA9IHJlbW90ZVJlZ2lzdHJ5O1xyXG4gICAgX3RoaXMuaWRNb2R1bGUgPSBpZGVudGl0eU1vZHVsZTtcclxuICAgIF90aGlzLnN0b3JhZ2VNYW5hZ2VyID0gc3RvcmFnZU1hbmFnZXI7XHJcbiAgICBfdGhpcy5ydW50aW1lQ2FwYWJpbGl0aWVzID0gcnVudGltZUNhcGFiaWxpdGllcztcclxuICAgIF90aGlzLmlkZW50aWZpZXIgPSBnZW5lcmF0ZUdVSUQoKTtcclxuXHJcbiAgICBfdGhpcy5oeXBlcnRpZXNMaXN0VG9SZW1vdmUgPSB7fTtcclxuICAgIF90aGlzLmh5cGVydGllc0xpc3QgPSBbXTtcclxuICAgIF90aGlzLnJlbW90ZUh5cGVydHlMaXN0ID0gW107XHJcbiAgICBfdGhpcy5yZW1vdGVEYXRhT2JqZWN0TGlzdCA9IFtdO1xyXG4gICAgX3RoaXMuaWRwTGVnYWN5UHJveHlMaXN0ID0ge307XHJcblxyXG4gICAgX3RoaXMud2F0Y2hpbmdZb3UgPSBuZXcgV2F0Y2hpbmdZb3UoKTtcclxuICAgIF90aGlzLnAycEhhbmRsZXJTdHViID0ge307XHJcbiAgICBfdGhpcy5wMnBSZXF1ZXN0ZXJTdHViID0gX3RoaXMud2F0Y2hpbmdZb3Uud2F0Y2goJ3AycFJlcXVlc3RlclN0dWInLCB7fSwgdHJ1ZSk7XHJcbiAgICBfdGhpcy5wMnBDb25uZWN0aW9uTGlzdCA9IF90aGlzLndhdGNoaW5nWW91LndhdGNoKCdwMnBDb25uZWN0aW9uTGlzdCcsIHt9LCB0cnVlKTtcclxuICAgIF90aGlzLnAycEhhbmRsZXJBc3NvY2lhdGlvbiA9IHt9O1xyXG5cclxuICAgIF90aGlzLnByb3Rvc3R1YnNMaXN0ID0gX3RoaXMud2F0Y2hpbmdZb3Uud2F0Y2goJ3Byb3Rvc3R1YnNMaXN0Jywge30sIHRydWUpO1xyXG4gICAgX3RoaXMuaWRwUHJveHlMaXN0ID0gX3RoaXMud2F0Y2hpbmdZb3Uud2F0Y2goJ2lkcFByb3h5TGlzdCcsIHt9LCB0cnVlKTtcclxuICAgIF90aGlzLmRhdGFPYmplY3RMaXN0ID0ge307XHJcbiAgICBfdGhpcy5zdWJzY3JpYmVkRGF0YU9iamVjdExpc3QgPSB7fTtcclxuICAgIF90aGlzLnNhbmRib3hlc0xpc3QgPSB7c2FuZGJveDoge30sIGFwcFNhbmRib3g6IHt9IH07XHJcbiAgICBfdGhpcy5wZXBMaXN0ID0ge307XHJcbiAgICBfdGhpcy5yZWdpc3RyaWVzID0ge307XHJcblxyXG4gICAgX3RoaXMuX2RvbWFpbiA9IGRpdmlkZVVSTChfdGhpcy5yZWdpc3RyeVVSTCkuZG9tYWluO1xyXG4gICAgX3RoaXMuc2FuZGJveGVzTGlzdC5hcHBTYW5kYm94W3J1bnRpbWVVUkxdID0gYXBwU2FuZGJveDtcclxuICAgIGxldCBwMnBDb25uZWN0aW9uUmVzb2x2ZSA9IG5ldyBQMlBDb25uZWN0aW9uUmVzb2x2ZShfdGhpcyk7XHJcblxyXG4gICAgX3RoaXMuX3AycENvbm5lY3Rpb25SZXNvbHZlID0gcDJwQ29ubmVjdGlvblJlc29sdmU7XHJcblxyXG4gICAgX3RoaXMuX2h5cGVydHlVcmxzID0ge307XHJcbiAgICBfdGhpcy5fZGF0YU9iamVjdFVybHMgPSB7fTtcclxuICB9XHJcblxyXG4gIGxvYWRSZWdpc3RyeSgpIHtcclxuXHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG5cclxuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4ge1xyXG4gICAgICBfdGhpcy5zdG9yYWdlTWFuYWdlci5nZXQoJ3JlZ2lzdHJ5Okh5cGVydHlVUkxzJykudGhlbigodXJsc0xpc3QpID0+IHtcclxuICAgICAgICBpZiAodXJsc0xpc3QpIF90aGlzLl9oeXBlcnR5VXJscyA9IHVybHNMaXN0O1xyXG4gICAgICAgIF90aGlzLnN0b3JhZ2VNYW5hZ2VyLmdldCgncmVnaXN0cnk6RGF0YU9iamVjdFVSTHMnKS50aGVuKCh1cmxzTGlzdCkgPT4ge1xyXG4gICAgICAgICAgaWYgKHVybHNMaXN0KSBfdGhpcy5fZGF0YU9iamVjdFVybHMgPSB1cmxzTGlzdDtcclxuICAgICAgICAgIHJlc29sdmUoKTtcclxuICAgICAgICB9KTtcclxuICAgICAgfSk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIHNldCBsb2FkZXIobG9hZGVyKSB7XHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG4gICAgX3RoaXMuX2xvYWRlciA9IGxvYWRlcjtcclxuICB9XHJcblxyXG4gIGdldCBsb2FkZXIoKSB7XHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG4gICAgcmV0dXJuIF90aGlzLl9sb2FkZXI7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAqIHJldHVybiB0aGUgbWVzc2FnZUJ1cyBpbiB0aGlzIFJlZ2lzdHJ5XHJcbiAgKiBAcGFyYW0ge01lc3NhZ2VCdXN9ICAgICAgICAgICBtZXNzYWdlQnVzXHJcbiAgKi9cclxuICBnZXQgbWVzc2FnZUJ1cygpIHtcclxuICAgIGxldCBfdGhpcyA9IHRoaXM7XHJcbiAgICByZXR1cm4gX3RoaXMuX21lc3NhZ2VCdXM7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAqIFNldCB0aGUgbWVzc2FnZUJ1cyBpbiB0aGlzIFJlZ2lzdHJ5XHJcbiAgKiBAcGFyYW0ge01lc3NhZ2VCdXN9ICAgICAgICAgICBtZXNzYWdlQnVzXHJcbiAgKi9cclxuICBzZXQgbWVzc2FnZUJ1cyhtZXNzYWdlQnVzKSB7XHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG4gICAgX3RoaXMuX21lc3NhZ2VCdXMgPSBtZXNzYWdlQnVzO1xyXG5cclxuICAgIF90aGlzLl9tZXNzYWdlQnVzLmFkZExpc3RlbmVyKF90aGlzLnJlZ2lzdHJ5VVJMLCBmdW5jdGlvbihtc2cpIHtcclxuXHJcbiAgICAgIC8vIGxvZy5sb2coJ1tSZWdpc3RyeSBsaXN0ZW5lcl0gJywgbXNnKTtcclxuXHJcbiAgICAgIGxldCBpc0h5cGVydHkgPSBpc0h5cGVydHlVUkwobXNnLmZyb20pO1xyXG4gICAgICBsZXQgaGFzQ3JpdGVyaWEgPSBtc2cuYm9keS5oYXNPd25Qcm9wZXJ0eSgnY3JpdGVyaWEnKTtcclxuICAgICAgbGV0IGlzVVJMUmVzb3VyY2U7XHJcbiAgICAgIGxldCBpc1VzZXJSZXNvdXJjZTtcclxuICAgICAgbGV0IGlzSHlwZXJ0eVJlc291cmNlO1xyXG5cclxuICAgICAgaWYgKG1zZy5ib2R5Lmhhc093blByb3BlcnR5KCdyZXNvdXJjZScpICYmIG1zZy5ib2R5LnJlc291cmNlICE9PSAnLicpIHtcclxuICAgICAgICBpc1VSTFJlc291cmNlID0gaXNVUkwobXNnLmJvZHkucmVzb3VyY2UpO1xyXG4gICAgICAgIGlzVXNlclJlc291cmNlID0gaXNVc2VyVVJMKG1zZy5ib2R5LnJlc291cmNlKTtcclxuICAgICAgICBpc0h5cGVydHlSZXNvdXJjZSA9IGlzSHlwZXJ0eVVSTChtc2cuYm9keS5yZXNvdXJjZSk7XHJcbiAgICAgIH1cclxuICAgICAgbGV0IGlzRGVsZXRlID0gbXNnLnR5cGUgPT09ICdkZWxldGUnO1xyXG4gICAgICBsZXQgaGFzTmFtZTtcclxuICAgICAgbGV0IGhhc1VzZXI7XHJcblxyXG4gICAgICBpZiAobXNnLmJvZHkuaGFzT3duUHJvcGVydHkoJ3ZhbHVlJykpIHtcclxuICAgICAgICBoYXNOYW1lID0gbXNnLmJvZHkudmFsdWUuaGFzT3duUHJvcGVydHkoJ25hbWUnKTtcclxuICAgICAgICBoYXNVc2VyID0gbXNnLmJvZHkudmFsdWUuaGFzT3duUHJvcGVydHkoJ3VzZXInKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgaWYgKG1zZy50eXBlID09PSAncmVzcG9uc2UnKSB7XHJcbiAgICAgICAgbG9nLmVycm9yKCdbUmVnaXN0ZXIgbGlzdGVuZXJdIHNraXBwaW5nICcsIG1zZyk7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyBtc2cgc2VudCBieSBpZGVudGl0eSBtYW5hZ2VyIGxpYnJhcnlcclxuICAgICAgbGV0IHVzZXJVcmwgPSBfdGhpcy5fZ2V0SWRlbnRpdHlBc3NvY2lhdGVkKG1zZy5ib2R5LnJlc291cmNlLCBtc2cuYm9keS5jcml0ZXJpYSk7XHJcblxyXG4gICAgICBsZXQgcmVwbHkgPSB7aWQ6IG1zZy5pZCwgdHlwZTogJ3Jlc3BvbnNlJywgdG86IG1zZy5mcm9tLCBmcm9tOiBtc2cudG8sIGJvZHk6IHtyZXNvdXJjZTogdXNlclVybH19O1xyXG4gICAgICByZXBseS5ib2R5LmNvZGUgPSAodXNlclVybCkgPyAyMDAgOiA0MDQ7XHJcblxyXG4gICAgICBfdGhpcy5fbWVzc2FnZUJ1cy5wb3N0TWVzc2FnZShyZXBseSk7XHJcblxyXG4gICAgfSk7XHJcblxyXG4gICAgLy8gSW5zdGFsbCBBZGRyZXNzQWxsb2NhdGlvblxyXG4gICAgbGV0IGFkZHJlc3NBbGxvY2F0aW9uID0gQWRkcmVzc0FsbG9jYXRpb24uaW5zdGFuY2U7XHJcbiAgICBfdGhpcy5hZGRyZXNzQWxsb2NhdGlvbiA9IGFkZHJlc3NBbGxvY2F0aW9uO1xyXG5cclxuICAgIF90aGlzLl9kb21haW5SZWdpc3RyYXRpb24gPSBuZXcgRG9tYWluUmVnaXN0cmF0aW9uKF90aGlzLnJ1bnRpbWVVUkwsX3RoaXMucmVnaXN0cnlVUkwsIF90aGlzLl9kb21haW4sIG1lc3NhZ2VCdXMpO1xyXG5cclxuICAgIC8vIGxvZy5sb2coJ1tSZWdpc3RyeSAtIEFkZHJlc3NBbGxvY2F0aW9uXSAtICcsIGFkZHJlc3NBbGxvY2F0aW9uKTtcclxuICB9XHJcblxyXG5cclxuICBfZ2V0SWRlbnRpdHlBc3NvY2lhdGVkKHR5cGUsIGh5cGVydHlVUkwpIHtcclxuICAgIGxldCBfdGhpcyA9IHRoaXM7XHJcblxyXG4gICAgZm9yIChsZXQgaHlwZXJ0eSBpbiBfdGhpcy5oeXBlcnRpZXNMaXN0KSB7XHJcbiAgICAgIGxldCB2YWx1ZSA9IF90aGlzLmh5cGVydGllc0xpc3RbaHlwZXJ0eV07XHJcblxyXG4gICAgICBpZiAodmFsdWUuX2h5cGVydHlVUkwgPT09IGh5cGVydHlVUkwpIHtcclxuICAgICAgICBzd2l0Y2ggKHR5cGUpIHtcclxuICAgICAgICAgIGNhc2UgJ3VzZXJuYW1lJzpcclxuICAgICAgICAgICAgcmV0dXJuIHZhbHVlLl91c2VyLnVzZXJuYW1lO1xyXG4gICAgICAgICAgY2FzZSAnY24nOlxyXG4gICAgICAgICAgICByZXR1cm4gdmFsdWUuX3VzZXIuY247XHJcbiAgICAgICAgICBjYXNlICdsb2NhbGUnOlxyXG4gICAgICAgICAgICByZXR1cm4gdmFsdWUuX3VzZXIubG9jYWxlO1xyXG4gICAgICAgICAgY2FzZSAnYXZhdGFyJzpcclxuICAgICAgICAgICAgcmV0dXJuIHZhbHVlLl91c2VyLmF2YXRhcjtcclxuICAgICAgICAgIGNhc2UgJ3VzZXJVUkwnOlxyXG4gICAgICAgICAgICByZXR1cm4gdmFsdWUuX3VzZXIudXNlclVSTDtcclxuICAgICAgICAgIGNhc2UgJy4nOlxyXG4gICAgICAgICAgICByZXR1cm4gdmFsdWUuX3VzZXI7XHJcbiAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICByZXR1cm4gJyc7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICByZXR1cm4gJyc7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAqIFRoaXMgZnVuY3Rpb24gaXMgdXNlZCB0byByZXR1cm4gdGhlIHNhbmRib3ggaW5zdGFuY2Ugd2hlcmUgdGhlIEFwcGxpY2F0aW9uIGlzIGV4ZWN1dGluZy4gSXQgaXMgYXNzdW1lZCB0aGVyZSBpcyBqdXN0IG9uZSBBcHAgcGVyIFJ1bnRpbWUgaW5zdGFuY2UuXHJcbiAgKi9cclxuICBnZXRBcHBTYW5kYm94KCkge1xyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuICAgIHJldHVybiBfdGhpcy5hcHBTYW5kYm94O1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgKiBUaGlzIGZ1bmN0aW9uIHJldHVybnMgdGhlIHVzZXIgYXNzb2NpYXRlZCB0byB0aGUgaHlwZXJ0eSBVUkxcclxuICAqIEBwYXJhbSAgICB7U3RyaW5nfSAgICBoeXBlcnR5VVJMICAgICAgaHlwZXJ0eSBVUkxcclxuICAqIEByZXR1cm4gICB7U3RyaW5nfSAgICB1c2VyVVJMICAgICAgICAgdXNlciBVUkxcclxuICAqL1xyXG4gIGdldEh5cGVydHlPd25lcihoeXBlcnR5VVJMKSB7XHJcblxyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuICAgIGxldCB1c2VyVVJMO1xyXG5cclxuICAgIGZvciAobGV0IGluZGV4IGluIF90aGlzLmh5cGVydGllc0xpc3QpIHtcclxuICAgICAgbGV0IGh5cGVydHkgPSBfdGhpcy5oeXBlcnRpZXNMaXN0W2luZGV4XTtcclxuXHJcbiAgICAgIGlmIChoeXBlcnR5Lmh5cGVydHlVUkwgPT09IGh5cGVydHlVUkwpIHtcclxuICAgICAgICByZXR1cm4gaHlwZXJ0eS51c2VyLnVzZXJVUkw7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIHJldHVybiB1c2VyVVJMO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgKiBUaGlzIGZ1bmN0aW9uIHJldHVybnMgdGhlIHVzZXIgYXNzb2NpYXRlZCB0byB0aGUgaHlwZXJ0eSBVUkxcclxuICAqIEBwYXJhbSAgICB7U3RyaW5nfSAgICBkYXRhT2JqZWN0VVJMICAgICAgZGF0YU9iamVjdFVSTCBVUkxcclxuICAqIEByZXR1cm4gICB7U3RyaW5nfSAgICB1c2VyVVJMICAgICAgICAgdXNlciBVUkxcclxuICAqL1xyXG4gIGdldERhdGFPYmplY3RSZXBvcnRlcihkYXRhT2JqZWN0VVJMKSB7XHJcblxyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuICAgIGxldCBET3VybCA9IHJlbW92ZVBhdGhGcm9tVVJMKGRhdGFPYmplY3RVUkwpO1xyXG4gICAgZm9yIChsZXQgaW5kZXggaW4gX3RoaXMuZGF0YU9iamVjdExpc3QpIHtcclxuICAgICAgbGV0IGRhdGFPYmplY3QgPSBfdGhpcy5kYXRhT2JqZWN0TGlzdFtpbmRleF07XHJcblxyXG4gICAgICBpZiAoZGF0YU9iamVjdC51cmwgPT09IERPdXJsKSB7XHJcbiAgICAgICAgcmV0dXJuIGRhdGFPYmplY3QucmVwb3J0ZXI7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIHJldHVybiBudWxsO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgKiByZXR1cm5zIHRoZSBoeXBlcnR5IE5hbWUgZnJvbSBhIGdpdmVuIHVybC4gVGhpcyB1cmwgY291bGQgYmUgZnJvbSBhIGRhdGFPYmplY3Qgb3IgaHlwZXJ0eVxyXG4gICogQHBhcmFtICAgIHtTdHJpbmd9ICAgIHVybCAgICAgIGh5cGVydHkgb3IgZGF0YU9iamVjdCBVUkxcclxuICAqIEByZXR1cm4gICB7U3RyaW5nfSAgICBoeXBlcnR5TmFtZSAgICAgaHlwZXJ0eSBOYW1lXHJcbiAgKi9cclxuICBnZXRIeXBlcnR5TmFtZSh1cmwpIHtcclxuICAgIGxldCBfdGhpcyA9IHRoaXM7XHJcblxyXG4gICAgbGV0IGlzSHlwZXJ0eVVSTCA9IGRpdmlkZVVSTCh1cmwpLnR5cGUgPT09ICdoeXBlcnR5JztcclxuXHJcbiAgICAvL3ZhbHVlIHRvIGJlIHJldHVybmVkIGluIHRoZSBlbmRcclxuICAgIGxldCBoeXBlcnR5TmFtZTtcclxuXHJcbiAgICAvL2lmIGlzIG5vdCBhbiBoeXBlcnR5LCBjaGVjayBpZiBpcyBhIGRhdGFPYmplY3QgYW5kIG9idGFpbiBoaXMgcmVwb3J0ZXJcclxuICAgIGxldCBoeXBlcnR5VVJMID0gaXNIeXBlcnR5VVJMID8gdXJsIDogX3RoaXMuZ2V0UmVwb3J0ZXJVUkxTeW5jaG9ub3VzKHVybCk7XHJcblxyXG4gICAgZm9yIChsZXQgaW5kZXggaW4gX3RoaXMuaHlwZXJ0aWVzTGlzdCkge1xyXG4gICAgICBsZXQgaHlwZXJ0eSA9IF90aGlzLmh5cGVydGllc0xpc3RbaW5kZXhdO1xyXG4gICAgICBpZiAoaHlwZXJ0eS5oeXBlcnR5VVJMID09PSBoeXBlcnR5VVJMKSB7XHJcbiAgICAgICAgaHlwZXJ0eU5hbWUgPSBoeXBlcnR5Lm9iamVjdE5hbWU7XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIHJldHVybiBoeXBlcnR5TmFtZTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICogZnVuY3Rpb24gdG8gcmV0dXJuIHRoZSByZXBvcnRlclVSTCBhc3NvY2lhdGVkIHdpdGggdGhlIGRhdGFvYmplY3QgVVJMXHJcbiAgKiBAcGFyYW0gICAge1N0cmluZ30gICAgIGRhdGFPYmplY3RVUkwgICAgZGF0YU9iamVjdFVSTFxyXG4gICogQHJldHVybiAgIHtTdHJpbmd9ICAgICByZXBvcnRlclVSTCAgICAgIHJlcG9ydGVyVVJMXHJcbiAgKi9cclxuICBnZXRSZXBvcnRlclVSTChkYXRhT2JqZWN0VVJMKSB7XHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG5cclxuICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuXHJcbiAgICAgIGxldCBkYXRhT2JqZWN0ID0gX3RoaXMuZGF0YU9iamVjdExpc3RbZGF0YU9iamVjdFVSTF07XHJcblxyXG4gICAgICBpZiAoZGF0YU9iamVjdCkge1xyXG4gICAgICAgIHJlc29sdmUoZGF0YU9iamVjdC5yZXBvcnRlcik7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgcmVqZWN0KCdObyByZXBvcnRlciB3YXMgZm91bmQnKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAqIGZ1bmN0aW9uIHRvIHJldHVybiB0aGUgcmVwb3J0ZXJVUkwgYXNzb2NpYXRlZCB3aXRoIHRoZSBkYXRhb2JqZWN0IFVSTC4gbm8gcHJvbWlzZSByZXR1cm5lZFxyXG4gICogQHBhcmFtICAgIHtTdHJpbmd9ICAgICBkYXRhT2JqZWN0VVJMICAgIGRhdGFPYmplY3RVUkxcclxuICAqIEByZXR1cm4gICB7U3RyaW5nfSAgICAgcmVwb3J0ZXJVUkwgICAgICByZXBvcnRlclVSTFxyXG4gICovXHJcbiAgZ2V0UmVwb3J0ZXJVUkxTeW5jaG9ub3VzKGRhdGFPYmplY3RVUkwpIHtcclxuICAgIGxldCBfdGhpcyA9IHRoaXM7XHJcblxyXG4gICAgbGV0IGRhdGFPYmplY3QgPSBfdGhpcy5kYXRhT2JqZWN0TGlzdFtkYXRhT2JqZWN0VVJMXTtcclxuXHJcbiAgICByZXR1cm4gKGRhdGFPYmplY3QpID8gZGF0YU9iamVjdC5yZXBvcnRlciA6IHVuZGVmaW5lZDtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICogcmV0dXJucyB0aGUgaHlwZXJ0eSBVUkwgdGhhdCBzdWJzY3JpYmVkIHRoZSBkYXRhT2JqZWN0XHJcbiAgKiBAcGFyYW0gICAge1N0cmluZ30gICAgIHVybCAgICAgICAgICAgIHVybCBmb3JtYXRcclxuICAqIEByZXR1cm4gICB7U3RyaW5nfSAgICBIeXBlcnR5IFVSTCBzdWJzY3JpYmVkIHRvIHRoZSBVUkxcclxuICAqL1xyXG4gIGdldERhdGFPYmplY3RTdWJzY3JpYmVySHlwZXJ0eSh1cmwpIHtcclxuICAgIGxldCBfdGhpcyA9IHRoaXM7XHJcblxyXG4gICAgcmV0dXJuIF90aGlzLnN1YnNjcmliZWREYXRhT2JqZWN0TGlzdFt1cmxdO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgKiByZWdpc3RlciBhIGRlc2lyZWQgZGF0YU9iamVjdCB0byBzdWJzY3JpYmVcclxuICAqIEBwYXJhbSAgICB7U3RyaW5nfSAgICBkYXRhT2JqZWN0VVJMICAgICAgZGF0YU9iamVjdCBVUkxcclxuICAqL1xyXG4gIHJlZ2lzdGVyU3Vic2NyaWJlZERhdGFPYmplY3QoZGF0YU9iamVjdFVSTCwgaHlwZXJ0eVVSTCkge1xyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuICAgIGlmIChfdGhpcy5zdWJzY3JpYmVkRGF0YU9iamVjdExpc3RbZGF0YU9iamVjdFVSTF0gPT09IHVuZGVmaW5lZCkge1xyXG4gICAgICBfdGhpcy5zdWJzY3JpYmVkRGF0YU9iamVjdExpc3RbZGF0YU9iamVjdFVSTF0gPSBoeXBlcnR5VVJMO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgKiBGdW5jdGlvbiB0byByZXR1cm4gdGhlIGxpc3Qgb2YgcHJlIGF1dGhvcmlzZWQgdXNlcnMgcmVjZWl2ZWQgaW4gdGhlIGNyZWF0aW9uIG9mIGEgZGF0YSBvYmplY3RcclxuICAqIEBwYXJhbSAgICB7U3RyaW5nfSAgICAgICAgICAgIGRhdGFPYmplY3RVUkwgICAgZGF0YU9iamVjdFVSTFxyXG4gICogQHJldHVybiAgIHtBcnJheTxTdHJpbmc+fSAgICAgcHJlQXV0aCAgICAgICAgIExpc3Qgb2YgcHJlIGF1dGhvcmlzZWQgdXNlcnNcclxuICAqL1xyXG4gIGdldFByZUF1dGhTdWJzY3JpYmVycyhkYXRhT2JqZWN0VVJMKSB7XHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG4gICAgbGV0IGRhdGFPYmplY3QgPSBfdGhpcy5kYXRhT2JqZWN0TGlzdFtkYXRhT2JqZWN0VVJMXTtcclxuICAgIGxldCBwcmVBdXRoID0gW107XHJcblxyXG4gICAgaWYgKGRhdGFPYmplY3QpIHtcclxuICAgICAgcHJlQXV0aCA9IGRhdGFPYmplY3QuYXV0aG9yaXNlO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHByZUF1dGg7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAqIHNlbmQgcmVxdWVzdHMgdG8gdW5yZWdpc3RlciBhbGwgaHlwZXJ0aWVzIHJlZ2lzdGVyZWQgaW4gZG9tYWluIHJlZ2lzdHJ5XHJcbiAgKiBAcmV0dXJuICAge1Byb21pc2V9ICAgICByZXR1cm4gYSBwcm9taXNlIGlmIHRoZSByZXN1bHQgb2YgdW5yZWdpc3RyYXRpb24gYWxsIGh5cGVydGllc1xyXG4gICovXHJcbiAgdW5yZWdpc3RlckFsbEh5cGVydGllcygpIHtcclxuICAgIGxldCBfdGhpcyA9IHRoaXM7XHJcblxyXG4gICAgbGV0IHVucmVnaXN0ZXJSZXN1bHRzID0gW107XHJcblxyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG5cclxuICAgICAgZm9yIChsZXQgaW5kZXggaW4gX3RoaXMuaHlwZXJ0aWVzTGlzdCkge1xyXG4gICAgICAgIGxldCBoeXBlcnR5ID0gX3RoaXMuaHlwZXJ0aWVzTGlzdFtpbmRleF07XHJcbiAgICAgICAgbGV0IHJlc3VsdCA9IF90aGlzLnVucmVnaXN0ZXJIeXBlcnR5SW5zdGFuY2UoaHlwZXJ0eS5oeXBlcnR5VVJMKTtcclxuICAgICAgICB1bnJlZ2lzdGVyUmVzdWx0cy5wdXNoKHJlc3VsdCk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIFByb21pc2UuYWxsKHVucmVnaXN0ZXJSZXN1bHRzKS50aGVuKCgpID0+IHtcclxuXHJcbiAgICAgICAgcmVzb2x2ZSgnc3VjY2Vzc2Z1bGx5IHVucmVnaXN0ZXJlZCBhbGwgaHlwZXJ0aWVzJyk7XHJcbiAgICAgIH0sIGVycm9yID0+IHsgcmVqZWN0KGVycm9yKTsgfSk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICogIGZ1bmN0aW9uIHRvIHVucmVnaXN0ZXIgYW4gaHlwZXJ0eUluc3RhbmNlIGluIHRoZSBEb21haW4gUmVnaXN0cnlcclxuICAqICBAcGFyYW0gICB7U3RyaW5nfSAgICAgIGh5cGVydHlJbnN0YW5jZSAgIEh5cGVydHlJbnNudGFuY2UgdXJsXHJcbiAgKlxyXG4gICovXHJcbiAgdW5yZWdpc3Rlckh5cGVydHlJbnN0YW5jZShoeXBlcnR5SW5zdGFuY2UpIHtcclxuICAgIC8vVE9ETyB3b3JraW5nIGJ1dCB0aGUgdXNlclxyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuXHJcbiAgICBsZXQgY2xvc2VNc2cgPSB7IHR5cGU6ICdleGVjdXRlJywgZnJvbTogX3RoaXMucmVnaXN0cnlVUkwsXHJcbiAgICAgIHRvOiBoeXBlcnR5SW5zdGFuY2UsXHJcbiAgICAgIGJvZHk6IHsgbWV0aG9kOiAnY2xvc2UnIH19O1xyXG5cclxuICAgIC8vIFNlbmQgbWVzc2FnZSB0byBoeXBlcnR5IHRvIGNsb3NlXHJcbiAgICBfdGhpcy5fbWVzc2FnZUJ1cy5wb3N0TWVzc2FnZShjbG9zZU1zZywgKHJlcGx5KSA9PiB7XHJcbiAgICAgIGxvZy5sb2coJ1tSZWdpc3RyeS51bnJlZ2lzdGVySHlwZXJ0eUluc3RhbmNlXSBDbG9zZSBSZXBseScsIHJlcGx5KTtcclxuXHJcbiAgICAgIF90aGlzLl9kb21haW5SZWdpc3RyYXRpb24udW5yZWdpc3Rlckh5cGVydHkoaHlwZXJ0eUluc3RhbmNlKTtcclxuXHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICogIGZ1bmN0aW9uIHRvIHVucmVnaXN0ZXIgYSBEYXRhIE9iamVjdCBpbiB0aGUgRG9tYWluIFJlZ2lzdHJ5XHJcbiAgKiAgQHBhcmFtICAge1N0cmluZ30gICAgICBoeXBlcnR5SW5zdGFuY2UgICBIeXBlcnR5SW5zbnRhbmNlIHVybFxyXG4gICpcclxuICAqL1xyXG4gIHVucmVnaXN0ZXJEYXRhT2JqZWN0KHVybCkge1xyXG4gICAgdGhpcy5fZG9tYWluUmVnaXN0cmF0aW9uLnVucmVnaXN0ZXJEYXRhT2JqZWN0KHVybCk7XHJcbiAgfVxyXG5cclxuXHJcbiAgLyoqXHJcbiAgKiByZWdpc3RlciBhIG5ldyBzdWJzY3JpYmVyIGluIHRoZSBkYXRhT2JqZWN0IHJlZ2lzdGVyZWRcclxuICAqIEBwYXJhbSAge1N0cmluZ30gICBkYXRhT2JqZWN0VVJMICAgIGRhdGFPYmplY3QgVVJMXHJcbiAgKiBAcGFyYW0gIHtTdHJpbmd9ICAgc3Vic2NyaWJlclVSTCAgICBzdWJzY3JpYmVyIFVSTFxyXG4gICovXHJcbiAgcmVnaXN0ZXJTdWJzY3JpYmVyKGRhdGFPYmplY3RVUkwsIHN1YnNjcmliZXJVUkwpIHtcclxuICAgIGxldCBfdGhpcyA9IHRoaXM7XHJcbiAgICBsZXQgZGF0YU9iamVjdCA9IF90aGlzLmRhdGFPYmplY3RMaXN0W2RhdGFPYmplY3RVUkxdO1xyXG5cclxuICAgIGlmIChkYXRhT2JqZWN0KSB7XHJcblxyXG4gICAgICBpZiAoIWRhdGFPYmplY3Quc3Vic2NyaWJlcnMpIGRhdGFPYmplY3Quc3Vic2NyaWJlcnMgPSBbXTtcclxuXHJcbiAgICAgIGRhdGFPYmplY3Quc3Vic2NyaWJlcnMucHVzaChzdWJzY3JpYmVyVVJMKTtcclxuICAgICAgX3RoaXMuZGF0YU9iamVjdExpc3RbZGF0YU9iamVjdFVSTF0gPSBkYXRhT2JqZWN0O1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgKiBnZXQgdGhlIHN1YnNjcmliZXJzIHJlZ2lzdGVyZWQgd2l0aGluIGEgZGF0YU9iamVjdFxyXG4gICogQHBhcmFtICB7U3RyaW5nfSAgICAgICAgICBkYXRhT2JqZWN0VVJMICAgIGRhdGFPYmplY3QgVVJMXHJcbiAgKiBAcGFyYW0gIHtBcnJheTxTdHJpbmc+fSAgIFN1YnN0cmliZXJzIExpc3RcclxuICAqL1xyXG4gIGdldERhdGFPYmplY3RTdWJzY3JpYmVycyhkYXRhT2JqZWN0VVJMKSB7XHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG4gICAgbGV0IGRhdGFPYmplY3QgPSBfdGhpcy5kYXRhT2JqZWN0TGlzdFtkYXRhT2JqZWN0VVJMXTtcclxuXHJcbiAgICBpZiAoZGF0YU9iamVjdCkge1xyXG4gICAgICByZXR1cm4gZGF0YU9iamVjdC5zdWJzY3JpYmVycztcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRocm93ICdObyBkYXRhT2JqZWN0IHdhcyBmb3VuZCc7XHJcbiAgICB9XHJcblxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgKiBUbyByZWdpc3RlciBhIG5ldyBEYXRhIE9iamVjdCBpbiB0aGUgcnVudGltZSB3aGljaCByZXR1cm5zIHRoZSBkYXRhT2JqZWN0VVJMIGFsbG9jYXRlZCB0byB0aGUgbmV3IERhdGEgT2JqZWN0LlxyXG4gICogQHBhcmFtICB7U3RyaW5nfSAgICAgIGlkZW50aWZpZXIgICAgICAgICAgICAgICAgICBpZGVudGlmaWVyXHJcbiAgKiBAcGFyYW0gIHtTdHJpbmd9ICAgICAgZGF0YU9iamVjdHNjaGVtYSAgICAgICAgICAgIGRhdGFPYmplY3RzY2hlbWFcclxuICAqIEBwYXJhbSAge1N0cmluZ30gICAgICBkYXRhT2JqZWN0VXJsICAgICAgICAgICAgICAgZGF0YU9iamVjdFVybFxyXG4gICogQHBhcmFtIHtTdHJpbmd9ICAgICAgZGF0YU9iamVjdFJlcG9ydGVyICAgICAgICAgICBkYXRhT2JqZWN0UmVwb3J0ZXJcclxuICAqIEBwYXJhbSAge0FycmF5fSAgICAgcmVzb3VyY2VzICAgICAgICAgICAgICAgICAgICAgZGF0YU9iamVjdCByZXNvdXJjZXNcclxuICAqIEBwYXJhbSAge0FycmF5fSAgICAgYXV0aG9yaXNlICAgICAgICAgICAgICAgICAgICAgbGlzdCBvZiBwcmUgYXV0aG9yaXNlZCBhdXRob3Jpc2VkIElEc1xyXG4gICovXHJcbiAgLy9yZWdpc3RlckRhdGFPYmplY3QoaWRlbnRpZmllciwgZGF0YU9iamVjdHNjaGVtYSwgZGF0YU9iamVjdFVybCwgZGF0YU9iamVjdFJlcG9ydGVyLCByZXNvdXJjZXMsIGFkZHJlc3NVUkwsIGF1dGhvcmlzZSkge1xyXG4gIHJlZ2lzdGVyRGF0YU9iamVjdChvYmplY3RSZWdpc3RyYXRpb24pIHtcclxuICAgIGxldCBfdGhpcyA9IHRoaXM7XHJcblxyXG4gICAgbGV0IHJlZ2lzdHJhdGlvbiA9IGRlZXBDbG9uZShvYmplY3RSZWdpc3RyYXRpb24pO1xyXG5cclxuICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuXHJcblxyXG4gICAgICBfdGhpcy5kYXRhT2JqZWN0TGlzdFtvYmplY3RSZWdpc3RyYXRpb24udXJsXSA9IG9iamVjdFJlZ2lzdHJhdGlvbjtcclxuXHJcbi8vICAgICAgX3RoaXMuc3RvcmFnZU1hbmFnZXIuZ2V0KCdyZWdpc3RyeTpEYXRhT2JqZWN0VVJMcycpLnRoZW4oKHVybHNMaXN0KSA9PiB7XHJcblxyXG4vKiAgICAgICAgaWYgKCF1cmxzTGlzdCkge1xyXG4gICAgICAgICAgdXJsc0xpc3QgPSB7fTtcclxuICAgICAgICB9Ki9cclxuXHJcbiAgICAgICAgLy91cGRhdGUgdGhlIGxpc3Qgd2l0aCB0aGUgbmV3IGVsZW1lbnRzXHJcbiAgICAgICAgX3RoaXMuX2RhdGFPYmplY3RVcmxzW29iamVjdFJlZ2lzdHJhdGlvbi5uYW1lICsgb2JqZWN0UmVnaXN0cmF0aW9uLnNjaGVtYSArIG9iamVjdFJlZ2lzdHJhdGlvbi5yZXNvdXJjZXMgKyBvYmplY3RSZWdpc3RyYXRpb24ucmVwb3J0ZXJdID0gb2JqZWN0UmVnaXN0cmF0aW9uLnVybDtcclxuXHJcbiAgICAgICAgLy8gc3RlcCB0byBvYnRhaW4gdGhlIGxpc3Qgb2YgYWxsIFVSTCByZWdpc3RlcmVkIHRvIHVwZGF0ZWQgd2l0aCB0aGUgbmV3IG9uZS5cclxuICAgICAgICBfdGhpcy5zdG9yYWdlTWFuYWdlci5zZXQoJ3JlZ2lzdHJ5OkRhdGFPYmplY3RVUkxzJywgMCwgX3RoaXMuX2RhdGFPYmplY3RVcmxzKS50aGVuKCgpID0+IHtcclxuXHJcbiAgICAgICAgICBpZiAoX3RoaXMuaXNJbnRlcndvcmtpbmdQcm90b1N0dWIocmVnaXN0cmF0aW9uLnJlcG9ydGVyKSkge1xyXG4gICAgICAgICAgICByZWdpc3RyYXRpb24uaW50ZXJ3b3JraW5nID0gdHJ1ZTtcclxuICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICBsZXQgZG9tYWluUmVnaXN0cmF0aW9uID0gdHJ1ZTtcclxuXHJcbiAgICAgICAgICBpZiAocmVnaXN0cmF0aW9uLmhhc093blByb3BlcnR5KFwiZG9tYWluX3JlZ2lzdHJhdGlvblwiKSlcclxuICAgICAgICAgIGRvbWFpblJlZ2lzdHJhdGlvbiA9IHJlZ2lzdHJhdGlvbi5kb21haW5fcmVnaXN0cmF0aW9uO1xyXG5cclxuICAgICAgICAgIGlmIChkb21haW5SZWdpc3RyYXRpb24pXHJcbiAgICAgICAgICAgIF90aGlzLl9kb21haW5SZWdpc3RyYXRpb24ucmVnaXN0ZXJEYXRhT2JqZWN0KHJlZ2lzdHJhdGlvbixvYmplY3RSZWdpc3RyYXRpb24ucmVzdW1lLCBfdGhpcy5wMnBIYW5kbGVyU3R1YikudGhlbigoIHJlZ2lzdGVyZWQgKSA9PnsgcmVzb2x2ZShyZWdpc3RlcmVkKSB9KTtcclxuICAgICAgICAgIGVsc2UgcmVzb2x2ZShyZWdpc3RyYXRpb24pO1xyXG5cclxuICAgICAgICB9KS5jYXRjaChmdW5jdGlvbihyZWFzb24pIHtcclxuICAgICAgICAgIGxvZy5lcnJvcignW1JlZ2lzdHJ5IHJlZ2lzdGVyRGF0YU9iamVjdF0gRXJyb3I6ICcsIHJlYXNvbik7XHJcbiAgICAgICAgICByZWplY3QocmVhc29uKTtcclxuICAgICAgICB9KTtcclxuICAgICAgfSk7XHJcbi8vICAgIH0pO1xyXG4gIH1cclxuXHJcblxyXG4gIF9nZXRSZXNvdXJjZXNBbmRTY2hlbWVzKGRlc2NyaXB0b3IpIHtcclxuICAgIGxldCBfdGhpcyA9IHRoaXM7XHJcblxyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlKT0+IHtcclxuXHJcbiAgICAgIGxldCByZXNvdXJjZXM7XHJcblxyXG4gICAgICAvLyBjaGVjayBpZiB0aGUgaHlwZXJ0eSByZXNvdXJjZXMgaXMgYSB2ZWN0b3Igb3IgYSBzdHJpbmdcclxuICAgICAgLy8gVE9ETyBkZWxldGUgbGF0ZXIgd2hlbiBjYXRhbG9ndWUgaXMgZml4ZWRcclxuICAgICAgaWYgKHR5cGVvZiAoZGVzY3JpcHRvci5oeXBlcnR5VHlwZSkgPT09ICdzdHJpbmcnKSB7XHJcbiAgICAgICAgcmVzb3VyY2VzID0gW107XHJcbiAgICAgICAgcmVzb3VyY2VzLnB1c2goZGVzY3JpcHRvci5oeXBlcnR5VHlwZSk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgcmVzb3VyY2VzID0gZGVzY3JpcHRvci5oeXBlcnR5VHlwZTtcclxuICAgICAgfVxyXG5cclxuICAgICAgbGV0IG9iak5hbWUgPSBkZXNjcmlwdG9yLm9iamVjdE5hbWU7XHJcblxyXG4gICAgICBsZXQgZGVzY3JpcHRvckRhdGFTY2hlbWEgPSBkZXNjcmlwdG9yLmRhdGFPYmplY3RzO1xyXG4gICAgICBsZXQgZGF0YVNjaGVtYXNBcnJheSA9IFtdO1xyXG5cclxuICAgICAgLy90aGlzIHdpbGwgY3JlYXRlIGEgYXJyYXkgd2l0aCBhIFByb21pc2UgaW4gZWFjaCBwb3NpdGlvblxyXG4gICAgICBmb3IgKGxldCBpbmRleCBpbiBkZXNjcmlwdG9yRGF0YVNjaGVtYSkge1xyXG4gICAgICAgIGRhdGFTY2hlbWFzQXJyYXkucHVzaChfdGhpcy5ydW50aW1lQ2F0YWxvZ3VlLmdldERhdGFTY2hlbWFEZXNjcmlwdG9yKGRlc2NyaXB0b3JEYXRhU2NoZW1hW2luZGV4XSkpO1xyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyBhcyBzb29uIGFzIHRoZSBwcmV2aW91cyBhcnJheSBpcyBjb21wbGV0ZWQsIHRoaXMgd2lsbCB3YWl0IGZvciB0aGUgcmVzb2x2ZSBvZiBhbGwgcHJvbWlzZXMgaW4gdGhlIGFycmF5XHJcbiAgICAgIFByb21pc2UuYWxsKGRhdGFTY2hlbWFzQXJyYXkpLnRoZW4oZnVuY3Rpb24oZGF0YVNjaGVtYXMpIHtcclxuXHJcbiAgICAgICAgbGV0IGZpbHRlcmVkRGF0YVNjaGVtYXMgPSBbXTtcclxuICAgICAgICBmb3IgKGxldCBpbmRleCBpbiBkYXRhU2NoZW1hcykge1xyXG4gICAgICAgICAgbGV0IGRhdGFTY2hlbWEgPSBkYXRhU2NoZW1hc1tpbmRleF07XHJcbiAgICAgICAgICBmaWx0ZXJlZERhdGFTY2hlbWFzLnB1c2goZGF0YVNjaGVtYS5zb3VyY2VQYWNrYWdlLnNvdXJjZUNvZGUucHJvcGVydGllcy5zY2hlbWUpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gbG9nLmxvZygnW1JlZ2lzdHJ5XSBIeXBlcnR5IFNjaGVtYXMnLCBmaWx0ZXJlZERhdGFTY2hlbWFzKTtcclxuICAgICAgICAvLyBsb2cubG9nKCdbUmVnaXN0cnldIEh5cGVydHkgcmVzb3VyY2VzJywgcmVzb3VyY2VzKTtcclxuXHJcbiAgICAgICAgcmVzb2x2ZSh7cmVzb3VyY2VzOiByZXNvdXJjZXMsIGRhdGFTY2hlbWE6IGZpbHRlcmVkRGF0YVNjaGVtYXMsIG5hbWU6IG9iak5hbWV9KTtcclxuICAgICAgfSk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICogbWV0aG9kIHRoYXQgcmV0dXJucyBwcmV2aW91c2x5IHJlZ2lzdGVyZWQgSHlwZXJ0eSBvciBEYXRhT2JqZWN0cyBVUkxTLCBmb3IgZ2l2ZW4gY2hhcmFjdGVyaXN0aWNzXHJcbiAgKiBAcGFyYW0gIHtKU09OfSAgICAgICAgaW5mbyAgICAgICAgICAgb2JqZWN0IG9yIGh5cGVydHkgY2hhcmF0ZXJpc3RpY3MgaW5mb1xyXG4gICogQHJldHVybiB7YWRkcmVzc1VSTH0gIGFkZHJlc3NVUkwgICAgIHJldHVybiB0aGUgVVJMIGlmIHRoZXJlIGlzIGFueSBwcmV2aW91c3kgcmVnaXN0ZXJlZCBVUkwsIHJldHVybiB1bmRlZmluZWQgb3RoZXJ3aXNlXHJcbiAgKi9cclxuICBjaGVja1JlZ2lzdGVyZWRVUkxzKGluZm8sIHJldXNlVVJMKSB7XHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG5cclxuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4ge1xyXG5cclxuICAgICAgbGV0IG9iamVjdFR5cGUgPSAoaW5mby5yZXBvcnRlcikgPyAncmVnaXN0cnk6RGF0YU9iamVjdFVSTHMnIDogJ3JlZ2lzdHJ5Okh5cGVydHlVUkxzJztcclxuXHJcbiAgICAgIGlmICh0eXBlb2YocmV1c2VVUkwpID09PSAnc3RyaW5nJykge1xyXG4gICAgICAgIG9iamVjdFR5cGUgPSByZXVzZVVSTCAmJiBkaXZpZGVVUkwocmV1c2VVUkwpLnR5cGUgIT09ICdoeXBlcnR5JyA/ICdyZWdpc3RyeTpEYXRhT2JqZWN0VVJMcycgOiAncmVnaXN0cnk6SHlwZXJ0eVVSTHMnO1xyXG4gICAgICB9XHJcbiAgICAgIC8vZGVidWdnZXI7XHJcbiAgICAgIF90aGlzLnN0b3JhZ2VNYW5hZ2VyLmdldChvYmplY3RUeXBlKS50aGVuKCh1cmxzTGlzdCkgPT4ge1xyXG5cclxuICAgICAgICBpZiAoIXVybHNMaXN0KSB7XHJcbiAgICAgICAgICB1cmxzTGlzdCA9IHt9O1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKHR5cGVvZihyZXVzZVVSTCkgPT09ICdzdHJpbmcnKSB7XHJcbiAgICAgICAgICBsb2cuaW5mbygnW1JlZ2lzdHJ5IC0gY2hlY2tSZWdpc3RlcmVkVVJMc10gLSBsb29rIGZvciAnICsgcmV1c2VVUkwgKyAnIG9uICcsIHVybHNMaXN0KTtcclxuXHJcbiAgICAgICAgICBsZXQgc2VhcmNoUmVzdWx0ID0gT2JqZWN0LmtleXModXJsc0xpc3QpLm1hcCgoa2V5KSA9PiB7XHJcbiAgICAgICAgICAgIGxldCBpbmRleE9mID0gdXJsc0xpc3Rba2V5XS5pbmRleE9mKHJldXNlVVJMKTtcclxuICAgICAgICAgICAgcmV0dXJuIHVybHNMaXN0W2tleV1baW5kZXhPZl07XHJcbiAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICBsb2cuaW5mbygnW1JlZ2lzdHJ5IC0gY2hlY2tSZWdpc3RlcmVkVVJMc10gLSBmb3VuZCAnICsgc2VhcmNoUmVzdWx0Lmxlbmd0aCArICcgcmVzdWx0cyBvbiAnLCBzZWFyY2hSZXN1bHQpO1xyXG4gICAgICAgICAgaWYgKHNlYXJjaFJlc3VsdC5sZW5ndGggPT09IDEpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHJlc29sdmUoc2VhcmNoUmVzdWx0KTtcclxuICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHJldHVybiByZXNvbHZlKHVuZGVmaW5lZCk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAob2JqZWN0VHlwZSA9PT0gJ3JlZ2lzdHJ5Okh5cGVydHlVUkxzJykge1xyXG4gICAgICAgICAgX3RoaXMuX2dldFJlc291cmNlc0FuZFNjaGVtZXMoaW5mbykudGhlbigodmFsdWUpID0+IHtcclxuICAgICAgICAgICAgaWYgKHVybHNMaXN0W3ZhbHVlLnJlc291cmNlcyArIHZhbHVlLmRhdGFTY2hlbWEgKyB2YWx1ZS5uYW1lXSkge1xyXG4gICAgICAgICAgICAgIC8vIGxvZy5sb2coJ1tSZWdpc3RyeV0gcmV1c2FnZSBvZiBoeXBlcnR5IFVSTCcpO1xyXG4gICAgICAgICAgICAgIHJldHVybiByZXNvbHZlKHVybHNMaXN0W3ZhbHVlLnJlc291cmNlcyArIHZhbHVlLmRhdGFTY2hlbWEgKyB2YWx1ZS5uYW1lXSk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgLy8gbG9nLmxvZygnW1JlZ2lzdHJ5XSBubyBoeXBlcnR5IFVSTCB3YXMgcHJldmlvdXNseSByZWdpc3RlcmVkICcpO1xyXG4gICAgICAgICAgICAgIHJldHVybiByZXNvbHZlKHVuZGVmaW5lZCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcblxyXG4gICAgICAgICAgbGV0IGNoYXJhY3RlcmlzdGljcyA9IGluZm8ubmFtZSArIGluZm8uc2NoZW1hICsgaW5mby5yZXNvdXJjZXMgKyBpbmZvLnJlcG9ydGVyO1xyXG5cclxuICAgICAgICAgIGlmICh1cmxzTGlzdFtjaGFyYWN0ZXJpc3RpY3NdKSB7XHJcbiAgICAgICAgICAgIC8vIGxvZy5sb2coJ1tSZWdpc3RyeV0gcmV1c2FnZSBvZiBkYXRhT2JqZWN0IFVSTCcpO1xyXG4gICAgICAgICAgICBpZiAodHlwZW9mKHVybHNMaXN0W2NoYXJhY3RlcmlzdGljc10pID09PSAnc3RyaW5nJykge1xyXG4gICAgICAgICAgICAgIGxldCBhcnJheVRvUmVzb2x2ZSA9IFtdO1xyXG4gICAgICAgICAgICAgIGFycmF5VG9SZXNvbHZlLnB1c2godXJsc0xpc3RbY2hhcmFjdGVyaXN0aWNzXSk7XHJcbiAgICAgICAgICAgICAgcmV0dXJuIHJlc29sdmUoYXJyYXlUb1Jlc29sdmUpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgIHJldHVybiByZXNvbHZlKHVybHNMaXN0W2NoYXJhY3RlcmlzdGljc10pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAvLyBsb2cubG9nKCdbUmVnaXN0cnldIG5vIGRhdGFPYmplY3QgVVJMIHdhcyBwcmV2aW91c2x5IHJlZ2lzdGVyZWQnKTtcclxuICAgICAgICAgICAgcmV0dXJuIHJlc29sdmUodW5kZWZpbmVkKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICB9KTtcclxuXHJcbiAgICB9KTtcclxuICB9XHJcblxyXG5cclxuICAvKipcclxuICAqIFRvIHJlZ2lzdGVyIGEgbmV3IEh5cGVydHkgaW4gdGhlIHJ1bnRpbWUgd2hpY2ggcmV0dXJucyB0aGUgSHlwZXJ0eVVSTCBhbGxvY2F0ZWQgdG8gdGhlIG5ldyBIeXBlcnR5LlxyXG4gICogQHBhcmFtICB7U2FuZGJveH0gICAgICAgICAgICAgc2FuZGJveCAgICAgICAgICAgICAgIHNhbmRib3hcclxuICAqIEBwYXJhbSAge0h5cGVydHlDYXRhbG9ndWVVUkx9IEh5cGVydHlDYXRhbG9ndWVVUkwgICBkZXNjcmlwdG9yXHJcbiAgKiBAcGFyYW0ge29iamVjdH0gSWRwQ29uc3RyYWludCAtIGNvbnN0cmFpbnRzIHRvIGJlIHVzZWQgd2hlbiBzZWxlY3RpbmcgdGhlIGlkZW50aXR5IHRvIGJlIGFzc29jaWF0ZWQgd2l0aCB0aGUgSHlwZXJ0eSBpbmNsdWRpbmcgb3JpZ2luLCBpZHAsIGFuZCBpZEhpbnQuXHJcbiAgKiBAcmV0dXJuIHtIeXBlcnR5VVJMfSAgICAgICAgICBIeXBlcnR5VVJMXHJcbiAgKi9cclxuICByZWdpc3Rlckh5cGVydHkoc2FuZGJveCwgaW1wb3J0UGF0aCwgZGVzY3JpcHRvciwgYWRkcmVzc1VSTCwgSWRwQ29uc3RyYWludCkge1xyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuXHJcbiAgICBsZXQgaHlwZXJ0eUNhcGFiaWxpdGllcztcclxuXHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcblxyXG5cclxuICAgICAgX3RoaXMuaWRNb2R1bGUuZ2V0SWRlbnRpdHlBc3NlcnRpb24oSWRwQ29uc3RyYWludCkudGhlbihmdW5jdGlvbihyZXN1bHQpIHtcclxuXHJcbiAgICAgICAgbGV0IHVzZXJQcm9maWxlID0gcmVzdWx0LnVzZXJQcm9maWxlO1xyXG5cclxuICAgICAgICAvLyBsb2cubG9nKCdbUmVnaXN0cnkgcmVnaXN0ZXJIeXBlcnR5XSB1c2VyUHJvZmlsZScsIHVzZXJQcm9maWxlKTtcclxuXHJcbiAgICAgICAgaWYgKF90aGlzLl9tZXNzYWdlQnVzID09PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgIHJlamVjdCgnW1JlZ2lzdHJ5IHJlZ2lzdGVySHlwZXJ0eV0gTWVzc2FnZUJ1cyBpcyB1bmRlZmluZWQnKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgLy9jYWxsIGNoZWNrIGlmIHRoZSBwcm90b3N0dWIgZXhpc3Q6IHRvIGJlIHJlbW92ZWRcclxuICAgICAgICAgIC8qICBfdGhpcy5yZXNvbHZlKGRvbWFpblVybCkudGhlbihmdW5jdGlvbihhKSB7XHJcbiAgICAgICAgICAgIC8vIGxvZy5sb2coJ1tSZWdpc3RyeSByZWdpc3Rlckh5cGVydHldIHN0dWIgdG8gZG9tYWluIHJlZ2lzdHJ5LSAnLCBhKTsqL1xyXG5cclxuLy8gICAgICAgICAgX3RoaXMuc3RvcmFnZU1hbmFnZXIuZ2V0KCdyZWdpc3RyeTpIeXBlcnR5VVJMcycpLnRoZW4oKHVybHNMaXN0KSA9PiB7XHJcblxyXG4gICAgICAgIFxyXG5cclxuICAgICAgICAgICAgLy8gbG9nLmxvZygnW1JlZ2lzdHJ5IHJlZ2lzdGVySHlwZXJ0eV0gc3RvcmFnZU1hbmFnZXJdIC0gJywgdXJsc0xpc3QpO1xyXG5cclxuICAgICAgICAgICAgX3RoaXMuX2dldFJlc291cmNlc0FuZFNjaGVtZXMoZGVzY3JpcHRvcikudGhlbigodmFsdWUpID0+IHtcclxuXHJcbiAgICAgICAgICAgICAgaHlwZXJ0eUNhcGFiaWxpdGllcyA9IHZhbHVlO1xyXG5cclxuLyogICAgICAgICAgICAgIGlmICghdXJsc0xpc3QpIHtcclxuICAgICAgICAgICAgICAgIHVybHNMaXN0ID0ge307XHJcbiAgICAgICAgICAgICAgfSovXHJcblxyXG4gICAgICAgICAgICAgIF90aGlzLl9oeXBlcnR5VXJsc1toeXBlcnR5Q2FwYWJpbGl0aWVzLnJlc291cmNlcyArIGh5cGVydHlDYXBhYmlsaXRpZXMuZGF0YVNjaGVtYSArIGh5cGVydHlDYXBhYmlsaXRpZXMubmFtZV0gPSBhZGRyZXNzVVJMLmFkZHJlc3M7XHJcbiAgICAgICAgICAgICAgX3RoaXMuc3RvcmFnZU1hbmFnZXIuc2V0KCdyZWdpc3RyeTpIeXBlcnR5VVJMcycsIDAsIF90aGlzLl9oeXBlcnR5VXJscykudGhlbigoKSA9PiB7XHJcblxyXG5cclxuICAgICAgICAgICAgICAgIC8vY2hlY2sgd2hldGhlciB0aGUgcmVjZWl2ZWQgc2FuYm94IGUgQXBwbGljYXRpb25TYW5kYm94IG9yIGEgbm9ybWFsIHNhbmRib3hcclxuICAgICAgICAgICAgICAgIGlmIChzYW5kYm94LnR5cGUgPT09ICdhcHAnKSB7XHJcbiAgICAgICAgICAgICAgICAgIF90aGlzLnNhbmRib3hlc0xpc3QuYXBwU2FuZGJveFthZGRyZXNzVVJMLmFkZHJlc3NbMF1dID0gc2FuZGJveDtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoc2FuZGJveC50eXBlID09PSAnbm9ybWFsJykge1xyXG4gICAgICAgICAgICAgICAgICBfdGhpcy5zYW5kYm94ZXNMaXN0LnNhbmRib3hbYWRkcmVzc1VSTC5hZGRyZXNzWzBdXSA9IHNhbmRib3g7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICByZWplY3QoJ1dyb25nIFNhbmRib3hUeXBlJyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgbGV0IHAycEhhbmRsZXI7XHJcbiAgICAgICAgICAgICAgICBsZXQgcDJwUmVxdWVzdGVyO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmIChPYmplY3Qua2V5cyhfdGhpcy5wMnBIYW5kbGVyU3R1YikubGVuZ3RoICE9PSAwKSB7XHJcbiAgICAgICAgICAgICAgICAgIHAycEhhbmRsZXIgPSBfdGhpcy5wMnBIYW5kbGVyU3R1YltfdGhpcy5ydW50aW1lVVJMXS51cmw7XHJcbiAgICAgICAgICAgICAgICAgIHAycFJlcXVlc3RlciA9IHJ1bnRpbWVVdGlscy5ydW50aW1lRGVzY3JpcHRvci5wMnBSZXF1ZXN0ZXJTdHViO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGxldCBoeXBlcnR5ID0gbmV3IEh5cGVydHlJbnN0YW5jZShfdGhpcy5pZGVudGlmaWVyLCBfdGhpcy5yZWdpc3RyeVVSTCwgaW1wb3J0UGF0aCwgZGVzY3JpcHRvcixcclxuICAgICAgICAgICAgICAgICAgYWRkcmVzc1VSTC5hZGRyZXNzWzBdLCB1c2VyUHJvZmlsZSwgJ2d1aWQnLCBfdGhpcy5ydW50aW1lVVJMLCAnY3R4JywgcDJwSGFuZGxlcixcclxuICAgICAgICAgICAgICAgICBwMnBSZXF1ZXN0ZXIsIGh5cGVydHlDYXBhYmlsaXRpZXMuZGF0YVNjaGVtYSwgaHlwZXJ0eUNhcGFiaWxpdGllcy5yZXNvdXJjZXMpO1xyXG5cclxuICAgICAgICAgICAgICAgIF90aGlzLmh5cGVydGllc0xpc3QucHVzaChoeXBlcnR5KTtcclxuXHJcbiAgICAgICAgICAgICAgICAvKi0tLSBzdGFydCBoZXJlIG1vdmUgcDJwIGFuZCBkb21haW4gcmVnaXN0cnkgcmVsYXRlZCBmZWF0dXJlcyB0byBhIHNlcGFyYXRlZCBmdW5jdGlvbi4tLS0tLS0tLi4qL1xyXG5cclxuICAgICAgICAgICAgICAgIGxldCByZWdpc3RyYXRpb25BdGRvbWFpbiA9IHRydWU7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKCBkZXNjcmlwdG9yLmhhc093blByb3BlcnR5KFwiY29uZmlndXJhdGlvblwiKSAmJiBkZXNjcmlwdG9yLmNvbmZpZ3VyYXRpb24uaGFzT3duUHJvcGVydHkoXCJkb21haW5fcmVnaXN0cmF0aW9uXCIpKSB7XHJcbiAgICAgICAgICAgICAgICAgIHJlZ2lzdHJhdGlvbkF0ZG9tYWluID0gZGVzY3JpcHRvci5jb25maWd1cmF0aW9uLmRvbWFpbl9yZWdpc3RyYXRpb247XHJcbiAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgIGlmIChyZWdpc3RyYXRpb25BdGRvbWFpbikgX3RoaXMuX2RvbWFpblJlZ2lzdHJhdGlvbi5yZWdpc3Rlckh5cGVydHkoaHlwZXJ0eSwgYWRkcmVzc1VSTC5uZXdBZGRyZXNzKS50aGVuKChyZWdpc3RlcmVkKT0+IHtyZXNvbHZlKHJlZ2lzdGVyZWQpfSk7XHJcbiAgICAgICAgICAgICAgICAgIGVsc2UgcmVzb2x2ZSh7IHVybDogaHlwZXJ0eS5oeXBlcnR5VVJMfSk7XHJcblxyXG4gICAgICAgICAgICAgLyotLS0tLS0tLS0tLS0tLS0tLS0tIEVORCBIRVJFIE1PVkUgRE9NQUlOIFJFR0lTVFJZIC0tLS0tLS0tLS0tLS0tLS0tLSovXHJcbiAgICAgICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24ocmVhc29uKSB7XHJcbiAgICAgICAgICAgICAgICAvLyBsb2cubG9nKCdbUmVnaXN0cnkgcmVnaXN0ZXJIeXBlcnR5XSBFcnJvcjogJywgcmVhc29uKTtcclxuICAgICAgICAgICAgICAgIHJlamVjdChyZWFzb24pO1xyXG4gICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9KTtcclxuLy8gICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9LCBmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICByZWplY3QoJ1tSZWdpc3RyeSByZWdpc3Rlckh5cGVydHldICcsIGVycik7XHJcbiAgICAgIH0pO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuXHJcblxyXG4gIC8qKlxyXG4gICogVG8gdW5yZWdpc3RlciBhIHByZXZpb3VzbHkgcmVnaXN0ZXJlZCBIeXBlcnR5XHJcbiAgKiBAcGFyYW0gIHtIeXBlcnR5VVJMfSAgICAgICAgICBIeXBlcnR5VVJMIHVybCAgICAgICAgdXJsXHJcbiAgKi9cclxuICB1bnJlZ2lzdGVySHlwZXJ0eSh1cmwpIHtcclxuICAgIGxldCBfdGhpcyA9IHRoaXM7XHJcblxyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG5cclxuICAgICAgbGV0IGZvdW5kID0gZmFsc2U7XHJcbiAgICAgIGxldCBpbmRleCA9IDA7XHJcblxyXG4gICAgICBmb3JcdChpbmRleCA9IDA7IGluZGV4IDwgX3RoaXMuaHlwZXJ0aWVzTGlzdC5sZW5ndGg7IGluZGV4KyspIHtcclxuICAgICAgICBsZXQgaHlwZXJ0eSA9IF90aGlzLmh5cGVydGllc0xpc3RbaW5kZXhdO1xyXG4gICAgICAgIGlmIChoeXBlcnR5ICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgIGlmIChoeXBlcnR5Lmh5cGVydHlVUkwgPT09IHVybCkge1xyXG4gICAgICAgICAgICBmb3VuZCA9IHRydWU7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG5cclxuICAgICAgaWYgKGZvdW5kID09PSBmYWxzZSkge1xyXG4gICAgICAgIHJlamVjdCgnSHlwZXJ0eSBub3QgZm91bmQnKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBkZWxldGUgX3RoaXMuaHlwZXJ0aWVzTGlzdFtpbmRleF07XHJcbiAgICAgICAgcmVzb2x2ZSgnSHlwZXJ0eSBzdWNjZXNzZnVsbHkgZGVsZXRlZCcpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuXHJcbiAgfVxyXG5cclxuICAvKipcclxuICAqIFRvIGRpc2NvdmVyIHByb3RvY29sIHN0dWJzIGF2YWlsYWJsZSBpbiB0aGUgcnVudGltZSBmb3IgYSBjZXJ0YWluIGRvbWFpbi4gSWYgYXZhaWxhYmxlLCBpdCByZXR1cm5zIHRoZSBydW50aW1lIHVybCBmb3IgdGhlIHByb3RvY29sIHN0dWIgdGhhdCBjb25uZWN0cyB0byB0aGUgcmVxdWVzdGVkIGRvbWFpbi4gUmVxdWlyZWQgYnkgdGhlIHJ1bnRpbWUgQlVTIHRvIHJvdXRlIG1lc3NhZ2VzIHRvIHJlbW90ZSBzZXJ2ZXJzIG9yIHBlZXJzIChkbyB3ZSBuZWVkIHNvbWV0aGluZyBzaW1pbGFyIGZvciBIeXBlcnRpZXM/KS5cclxuICAqIEBwYXJhbSAge0RvbWFpblVSTH0gICAgICAgICAgIERvbWFpblVSTCAgICAgICAgICAgIHVybFxyXG4gICogQHJldHVybiB7UnVudGltZVVSTH0gICAgICAgICAgIFJ1bnRpbWVVUkxcclxuICAqL1xyXG4gIGRpc2NvdmVyUHJvdG9zdHViKHVybCkge1xyXG4gICAgaWYgKCF1cmwpIHRocm93IG5ldyBFcnJvcignUGFyYW1ldGVyIHVybCBuZWVkZWQnKTtcclxuICAgIGxldCBfdGhpcyA9IHRoaXM7XHJcblxyXG4gICAgbGV0IGRpdmlkZWRVUkwgPSBkaXZpZGVVUkwodXJsKTtcclxuICAgIGxldCBkb21haW5VUkwgPSBkaXZpZGVkVVJMLmRvbWFpbjtcclxuXHJcbiAgICBpZiAoX3RoaXMucHJvdG9zdHVic0xpc3QuaGFzT3duUHJvcGVydHkoZG9tYWluVVJMKSAmJiBfdGhpcy5wcm90b3N0dWJzTGlzdFtkb21haW5VUkxdLnN0YXR1cyA9PT0gU1RBVFVTLkxJVkUpIHtcclxuICAgICAgcmV0dXJuIChfdGhpcy5wcm90b3N0dWJzTGlzdFtkb21haW5VUkxdKTtcclxuICAgIH0gZWxzZSB7XHJcblxyXG4gICAgICBfdGhpcy5wcm90b3N0dWJzTGlzdFtkb21haW5VUkxdID0ge1xyXG4gICAgICAgIHN0YXR1czogU1RBVFVTLkRFUExPWUlOR1xyXG4gICAgICB9O1xyXG5cclxuICAgICAgdGhyb3cgbmV3IEVycm9yKCdbUmVnaXN0cnkgLSBkaXNjb3ZlclByb3RvU3R1YiBdIE1lc3NhZ2UgTm9kZSBQcm90b3N0dWIgTm90IEZvdW5kLiBDcmVhdGluZyBvbmUnKTtcclxuXHJcbiAgICB9XHJcblxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgKiBUbyBkaXNjb3ZlciBwcm90b2NvbCBzdHVicyBhdmFpbGFibGUgaW4gdGhlIHJ1bnRpbWUgZm9yIGEgY2VydGFpbiByZW1vdGUgcnVudGltZSBVUkwuIElmIGF2YWlsYWJsZSwgaXQgcmV0dXJucyB0aGUgcnVudGltZSB1cmwgZm9yIHRoZSBwcm90b2NvbCBzdHViIHRoYXQgY29ubmVjdHMgdG8gdGhlIHJlcXVlc3RlZCBkb21haW4uXHJcbiAgKiBSZXF1aXJlZCBieSB0aGUgcnVudGltZSBCVVMgdG8gcm91dGUgbWVzc2FnZXMgdG8gcmVtb3RlIHNlcnZlcnMgb3IgcGVlcnMgKGRvIHdlIG5lZWQgc29tZXRoaW5nIHNpbWlsYXIgZm9yIEh5cGVydGllcz8pLlxyXG4gICogQHBhcmFtICB7UnVudGltZVVSTH0gICAgICAgICAgIFJ1bnRpbWVVUkwgICAgICAgICAgICB1cmxcclxuICAqIEByZXR1cm4ge3AycFJlcXVlc3Rlcn0gICAgICAgICAgIFJ1bnRpbWVVUkxcclxuICAqL1xyXG4gIGRpc2NvdmVyUDJQU3R1YihydW50aW1lVVJMKSB7XHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG5cclxuICAgIGlmIChydW50aW1lVVJMKSB7XHJcblxyXG4gICAgICBpZiAoX3RoaXMucDJwUmVxdWVzdGVyU3R1Yi5oYXNPd25Qcm9wZXJ0eShydW50aW1lVVJMKSAmJiBfdGhpcy5wMnBSZXF1ZXN0ZXJTdHViW3J1bnRpbWVVUkxdLnN0YXR1cyA9PT0gU1RBVFVTLkxJVkUpIHtcclxuICAgICAgICByZXR1cm4gKF90aGlzLnAycFJlcXVlc3RlclN0dWJbcnVudGltZVVSTF0pO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIF90aGlzLnAycFJlcXVlc3RlclN0dWJbcnVudGltZVVSTF0gPSB7XHJcbiAgICAgICAgICBzdGF0dXM6IFNUQVRVUy5DUkVBVEVEXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdbUmVnaXN0cnkgLSBkaXNjb3ZlclAyUFN0dWIgXSBQMlAgUmVxdWVzdGVyIFN0dWIgTm90IEZvdW5kLiBDcmVhdGluZyBvbmUnKTtcclxuXHJcbiAgICAgIH1cclxuICAgIH0gZWxzZSB7XHJcblxyXG4gICAgICBpZiAoX3RoaXMucDJwSGFuZGxlclN0dWIuaGFzT3duUHJvcGVydHkoX3RoaXMucnVudGltZVVSTCkpIHtcclxuICAgICAgICByZXR1cm4gKF90aGlzLnAycEhhbmRsZXJTdHViW190aGlzLnJ1bnRpbWVVUkxdKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBfdGhpcy5wMnBIYW5kbGVyU3R1YltfdGhpcy5ydW50aW1lVVJMXSA9IHtcclxuICAgICAgICAgIHN0YXR1czogU1RBVFVTLkNSRUFURURcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1tSZWdpc3RyeSAtIGRpc2NvdmVyUDJQU3R1YiBdIFAyUCBIYW5kbGVyIFN0dWIgTm90IEZvdW5kLicpO1xyXG4gICAgICB9XHJcblxyXG4gICAgfVxyXG5cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFRvIHJlZ2lzdGVyIGEgbmV3IFByb3RvY29sIFN0dWIgaW4gdGhlIHJ1bnRpbWUgaW5jbHVkaW5nIGFzIGlucHV0IHBhcmFtZXRlcnMgdGhlIGZ1bmN0aW9uIHRvIHBvc3RNZXNzYWdlLCB0aGUgRG9tYWluVVJMIHRoYXQgaXMgY29ubmVjdGVkIHdpdGggdGhlIHN0dWIsIHdoaWNoIHJldHVybnMgdGhlIFJ1bnRpbWVVUkwgYWxsb2NhdGVkIHRvIHRoZSBuZXcgUHJvdG9jb2xTdHViLlxyXG4gICAqIEBwYXJhbSAge1NhbmRib3h9ICAgICAgIFNhbmRib3hcclxuICAgKiBAcGFyYW0gIHtzdHViSUR9ICAgICAgICBEb21haW4gb3IgaHlwZXJ0eSBydW50aW1lIHRvIHJlZ2lzdGVyIHRoZSBzdHViXHJcbiAgICogQHBhcmFtICB7ZGVzY3JpcHRvclVSTH0gICAgIENhdGFsb2d1ZSBVUkwgb2YgdGhlIFByb3Rvc3R1YiBkZXNjcmlwdG9yXHJcbiAgICogQHBhcmFtICB7ZGVzY3JpcHRvcn0gICAgIFByb3Rvc3R1YiBkZXNjcmlwdG9yXHJcbiAgICogQHJldHVybiB7UnVudGltZVByb3RvU3R1YlVSTH1cclxuICAgKi9cclxuICByZWdpc3RlclN0dWIoc2FuZGJveCwgc3R1YklELCBwMnBDb25maWcsIGRlc2NyaXB0b3JVUkwsIGRlc2NyaXB0b3IpIHtcclxuICAgIGxldCBfdGhpcyA9IHRoaXM7XHJcblxyXG4gICAgbGV0IF9zdHViRGVzY3JpcHRvciA9IGRlc2NyaXB0b3I7XHJcblxyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG5cclxuICAgICAgbGV0IHJ1bnRpbWVQcm90b1N0dWJVUkw7XHJcblxyXG4gICAgICAvL2NoZWNrIGlmIG1lc3NhZ2VCdXMgaXMgcmVnaXN0ZXJlZCBpbiByZWdpc3RyeSBvciBub3RcclxuICAgICAgaWYgKF90aGlzLl9tZXNzYWdlQnVzID09PSB1bmRlZmluZWQpIHtcclxuICAgICAgICByZWplY3QoJ01lc3NhZ2VCdXMgbm90IGZvdW5kIG9uIHJlZ2lzdGVyU3R1YicpO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBsb2cuaW5mbygnW1JlZ2lzdHJ5IC0gcmVnaXN0ZXJTdHViXSAtIHN0dWJJRCAnLCBzdHViSUQpO1xyXG5cclxuICAgICAgLyogaWYgKCFzdHViSUQuaW5kZXhPZignbXNnLW5vZGUuJykpIHtcclxuICAgICAgICBzdHViSUQgPSBzdHViSUQuc3Vic3RyaW5nKHN0dWJJRC5pbmRleE9mKCcuJykgKyAxKTtcclxuICAgICAgfSovXHJcblxyXG4gICAgICBsZXQgUDJQUmVxdWVzdGVyU3R1YjtcclxuXHJcbiAgICAgIGlmIChwMnBDb25maWcpIHtcclxuXHJcbiAgICAgICAgaWYgKHAycENvbmZpZy5oYXNPd25Qcm9wZXJ0eSgnaXNIYW5kbGVyU3R1YicpICYmIHAycENvbmZpZy5pc0hhbmRsZXJTdHViKSB7XHJcbiAgICAgICAgICBydW50aW1lUHJvdG9TdHViVVJMID0gX3RoaXMucDJwSGFuZGxlclVSTDtcclxuXHJcbiAgICAgICAgICBfdGhpcy5wMnBIYW5kbGVyU3R1YltzdHViSURdID0ge1xyXG4gICAgICAgICAgICB1cmw6IHJ1bnRpbWVQcm90b1N0dWJVUkwsXHJcbiAgICAgICAgICAgIHN0YXR1czogU1RBVFVTLkNSRUFURURcclxuICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgX3RoaXMucDJwSGFuZGxlckFzc29jaWF0aW9uW190aGlzLnJ1bnRpbWVVUkxdID0gW107XHJcblxyXG4gICAgICAgICAgX3RoaXMuc2FuZGJveGVzTGlzdC5zYW5kYm94W3J1bnRpbWVQcm90b1N0dWJVUkxdID0gc2FuZGJveDtcclxuICAgICAgICAgIGxvZy5pbmZvKCdbUmVnaXN0cnkgLSByZWdpc3RlclN0dWIgLSBQMlBIYW5kbGVyU3R1Yl0gLSAnLCBzdHViSUQsICcgLSAnLCBydW50aW1lUHJvdG9TdHViVVJMKTtcclxuICAgICAgICAgIHJlc29sdmUoX3RoaXMucDJwSGFuZGxlclN0dWJbc3R1YklEXSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIFAyUFJlcXVlc3RlclN0dWIgPSBwMnBDb25maWcucDJwUmVxdWVzdGVyU3R1YjtcclxuICAgICAgICAgIHJ1bnRpbWVQcm90b1N0dWJVUkwgPSAncnVudGltZTovLycgKyBkaXZpZGVVUkwocDJwQ29uZmlnLnJlbW90ZVJ1bnRpbWVVUkwpLmRvbWFpbiArICcvcDJwcmVxdWVzdGVyLycgKyBnZW5lcmF0ZUdVSUQoKTtcclxuICAgICAgICAgIGxvZy5pbmZvKCdbUmVnaXN0cnkgLSByZWdpc3RlclN0dWIgLSBQMlBSZXF1ZXN0ZXJTdHViXSAtICcsIFAyUFJlcXVlc3RlclN0dWIsICcgLSAnLCBydW50aW1lUHJvdG9TdHViVVJMKTtcclxuXHJcbiAgICAgICAgICAvLyB0byBiZSBjbGFyaWZpZWQgd2hhdCBpcyB0aGlzIHAycEhhbmRsZXJBc3NvY2lhdGlvblxyXG4gICAgICAgICAgX3RoaXMucDJwSGFuZGxlckFzc29jaWF0aW9uW190aGlzLnJ1bnRpbWVVUkxdLnB1c2gocnVudGltZVByb3RvU3R1YlVSTCk7XHJcbiAgICAgICAgICBfdGhpcy5wMnBSZXF1ZXN0ZXJTdHViW3N0dWJJRF0gPSB7XHJcbiAgICAgICAgICAgIHVybDogcnVudGltZVByb3RvU3R1YlVSTCxcclxuICAgICAgICAgICAgc3RhdHVzOiBTVEFUVVMuQ1JFQVRFRFxyXG4gICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICBfdGhpcy5zYW5kYm94ZXNMaXN0LnNhbmRib3hbcnVudGltZVByb3RvU3R1YlVSTF0gPSBzYW5kYm94O1xyXG5cclxuICAgICAgICAgIC8vU2V0dXAgUDJQIFJlcXVlc3RlciBwYXRoIGludG8gTU5cclxuXHJcbiAgICAgICAgICBsZXQgbXNnID0ge1xyXG4gICAgICAgICAgICB0eXBlOiAnc3Vic2NyaWJlJyxcclxuICAgICAgICAgICAgZnJvbTogX3RoaXMucmVnaXN0cnlVUkwsXHJcbiAgICAgICAgICAgIHRvOiAnZG9tYWluOi8vbXNnLW5vZGUuJyArIF90aGlzLl9kb21haW4gKyAnL3NtJyxcclxuICAgICAgICAgICAgYm9keToge1xyXG4gICAgICAgICAgICAgIHN1YnNjcmliZTogW3J1bnRpbWVQcm90b1N0dWJVUkxdLFxyXG4gICAgICAgICAgICAgIHNvdXJjZTogX3RoaXMucmVnaXN0cnlVUkxcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICBfdGhpcy5fbWVzc2FnZUJ1cy5wb3N0TWVzc2FnZShtc2csIChyZXBseSkgPT4ge1xyXG4gICAgICAgICAgICAvLyBsb2cubG9nKCdbUmVnaXN0cnkgLSByZWdpc3RlciBTdHViXSBwMnBSZXF1ZXN0ZXIgcGF0aCBzZXR1cDogJywgcmVwbHkpO1xyXG4gICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgcmVzb2x2ZShfdGhpcy5wMnBSZXF1ZXN0ZXJTdHViW3N0dWJJRF0pO1xyXG4gICAgICAgIH1cclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBjb25zb2xlLmxvZygnW1JlZ2lzdHJ5IC0gcmVnaXN0ZXJTdHViIC0gTm9ybWFsIFN0dWJdIGRlc2NyaXB0b3InLCBkZXNjcmlwdG9yKTtcclxuXHJcbiAgICAgICAgaWYgKCAhdHlwZW9mKGRlc2NyaXB0b3IpID09PSAnc3RyaW5nJyAmJiBkZXNjcmlwdG9yLmhhc093blByb3BlcnR5KCdfaW50ZXJ3b3JraW5nJykgJiYgZGVzY3JpcHRvci5faW50ZXJ3b3JraW5nKSB7XHJcbiAgICAgICAgICBydW50aW1lUHJvdG9TdHViVVJMID0gJ3J1bnRpbWU6Ly8nICsgc3R1YklEICsgJy9wcm90b3N0dWIvJyArICdzY2hlbWUxJztcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgcnVudGltZVByb3RvU3R1YlVSTCA9ICdydW50aW1lOi8vJyArIHN0dWJJRCArICcvcHJvdG9zdHViLycgKyBnZW5lcmF0ZUdVSUQoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGxvZy5pbmZvKCdbUmVnaXN0cnkgLSByZWdpc3RlclN0dWIgLSBOb3JtYWwgU3R1Yl0gLSAnLCBzdHViSUQpO1xyXG5cclxuICAgICAgICAvLyBUT0RPOiBPcHRpbWl6ZSB0aGlzXHJcbiAgICAgICAgX3RoaXMucHJvdG9zdHVic0xpc3Rbc3R1YklEXSA9IHtcclxuICAgICAgICAgIHVybDogcnVudGltZVByb3RvU3R1YlVSTCxcclxuICAgICAgICAgIHN0YXR1czogU1RBVFVTLkRFUExPWUlOR1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGlmIChkZXNjcmlwdG9yVVJMKSB7XHJcbiAgICAgICAgICBfdGhpcy5wcm90b3N0dWJzTGlzdFtzdHViSURdLmRlc2NyaXB0b3JVUkwgPSBkZXNjcmlwdG9yVVJMO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKF9zdHViRGVzY3JpcHRvciAmJiAoX3N0dWJEZXNjcmlwdG9yLmludGVyd29ya2luZykpIHtcclxuICAgICAgICAgIF90aGlzLnByb3Rvc3R1YnNMaXN0W3N0dWJJRF0uaW50ZXJ3b3JraW5nID0gX3N0dWJEZXNjcmlwdG9yLmludGVyd29ya2luZztcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIF90aGlzLnNhbmRib3hlc0xpc3Quc2FuZGJveFtydW50aW1lUHJvdG9TdHViVVJMXSA9IHNhbmRib3g7XHJcblxyXG4gICAgICAgIHJlc29sdmUoX3RoaXMucHJvdG9zdHVic0xpc3Rbc3R1YklEXSk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vIHJlc29sdmUocnVudGltZVByb3RvU3R1YlVSTCk7XHJcblxyXG4gICAgICBfdGhpcy5fbWVzc2FnZUJ1cy5hZGRMaXN0ZW5lcihydW50aW1lUHJvdG9TdHViVVJMICsgJy9zdGF0dXMnLCAobXNnKSA9PiB7XHJcbiAgICAgICAgX3RoaXMuX29uUHJvdG9zdHViU3RhdHVzRXZlbnQobXNnKTtcclxuICAgICAgfSk7XHJcblxyXG4gICAgfSk7XHJcblxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgKiBUbyBQcm9jZXNzIHN0YXR1cyBldmVudHMgZmlyZWQgYnkgcHJvdG9zdHVic1xyXG4gICogQHBhcmFtICB7TWVzc2FnZX0gICBtZXNzYWdlICAgICBFdmVudCBNZXNzYWdlXHJcbiAgKi9cclxuXHJcbiAgX29uUHJvdG9zdHViU3RhdHVzRXZlbnQobXNnKSB7XHJcblxyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuXHJcbiAgICAvLyBsb2cubG9nKCdbUmVnaXN0cnkgb25Qcm90b3N0dWJTdGF0dXNFdmVudF06ICcsIG1zZyk7XHJcblxyXG4gICAgbGV0IHJ1bnRpbWVQcm90b1N0dWJVUkwgPSBtc2cuZnJvbTtcclxuXHJcbiAgICBpZiAoIW1zZy50by5pbmNsdWRlcygnL3N0YXR1cycpKSB7XHJcbiAgICAgIGxvZy5lcnJvcignW1JlZ2lzdHJ5IG9uUHJvdG9zdHViU3RhdHVzRXZlbnRdIE5vdCBTdGF0dXMgRXZlbnQ6ICcsIG1zZyk7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH0gZWxzZSB7Ly8gYnJvYWRjYXN0IFByb3Rvc3R1YiBzdGF0dXMgZXZlbnQgdG8gYWxsIEh5cGVydGllc1xyXG4gICAgICBsZXQgZnJvbSA9ICBtc2cuZnJvbTtcclxuICAgICAgbXNnLmZyb20gPSBfdGhpcy5ydW50aW1lVVJMO1xyXG4gICAgICBtc2cudG8gPSBfdGhpcy5ydW50aW1lVVJMKycvc3RhdHVzJztcclxuICAgICAgbXNnLmJvZHkucmVzb3VyY2UgPSBmcm9tO1xyXG4gICAgICBfdGhpcy5fbWVzc2FnZUJ1cy5wb3N0TWVzc2FnZShtc2cpO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIHByb2Nlc3Mgc3RhdHVzIGV2ZW50cyBmcm9tIG1lc3NhZ2Ugbm9kZSBwcm90b3N0dWJzXHJcblxyXG4gICAgaWYgKHJ1bnRpbWVQcm90b1N0dWJVUkwuaW5jbHVkZXMoJy9wcm90b3N0dWIvJykpIHtcclxuXHJcbiAgICAvLyBUT0RPOiB1bmNvbW1lbnQgYmVsb3cgd2hlbiBwcm90b3N0dWJzIGFyZSB1cGRhdGVkIHdpdGggbmV3IHN0YXR1cyB2YWx1ZSBcImxpdmVcIlxyXG4gICAgICBPYmplY3Qua2V5cyhfdGhpcy5wcm90b3N0dWJzTGlzdCkuZmlsdGVyKChrZXkpID0+IHtcclxuICAgICAgICByZXR1cm4gX3RoaXMucHJvdG9zdHVic0xpc3Rba2V5XS51cmwgPT09IHJ1bnRpbWVQcm90b1N0dWJVUkw7XHJcbiAgICAgIH0pLm1hcCgoa2V5KSA9PiB7XHJcbiAgICAgICAgX3RoaXMucHJvdG9zdHVic0xpc3Rba2V5XS5zdGF0dXMgPSBtc2cuYm9keS52YWx1ZTtcclxuXHJcbiAgICAgICAgLy8gbG9nLmxvZygnW1JlZ2lzdHJ5IC0gb25Qcm90b3N0dWJTdGF0dXNFdmVudF0gLSBQcm90b3N0dWIgc3RhdHVzOiAnLCBfdGhpcy5wcm90b3N0dWJzTGlzdFtrZXldKTtcclxuICAgICAgfSk7XHJcbiAgICB9IGVsc2UgeyAvLyBwcm9jZXNzIHN0YXR1cyBldmVudHMgZnJvbSBwMnAgY29ubmVjdGlvbnNcclxuXHJcbiAgICAgIGlmIChtc2cuYm9keS5yZXNvdXJjZSkge1xyXG4gICAgICAgIGxldCByZW1vdGVSdW50aW1lVVJMID0gbXNnLmJvZHkucmVzb3VyY2U7XHJcblxyXG4gICAgICAgIGlmIChfdGhpcy5wMnBDb25uZWN0aW9uTGlzdFtyZW1vdGVSdW50aW1lVVJMXSkge1xyXG4gICAgICAgICAgX3RoaXMucDJwQ29ubmVjdGlvbkxpc3RbcmVtb3RlUnVudGltZVVSTF0uc3RhdHVzID0gIG1zZy5ib2R5LnZhbHVlO1xyXG4gICAgICAgICAgX3RoaXMucDJwQ29ubmVjdGlvbkxpc3RbcmVtb3RlUnVudGltZVVSTF0udXJsID0gIHJ1bnRpbWVQcm90b1N0dWJVUkw7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuXHJcbiAgICAgICAgICBsZXQgIHAycENvbm5lY3Rpb24gPSB7XHJcbiAgICAgICAgICAgIHN0YXR1czogbXNnLmJvZHkudmFsdWUsXHJcbiAgICAgICAgICAgIHVybDogcnVudGltZVByb3RvU3R1YlVSTFxyXG4gICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICBfdGhpcy5wMnBDb25uZWN0aW9uTGlzdFtyZW1vdGVSdW50aW1lVVJMXSA9ICBwMnBDb25uZWN0aW9uO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gbG9nLmxvZygnW1JlZ2lzdHJ5IC0gb25Qcm90b3N0dWJTdGF0dXNFdmVudF0gLSBQMlBDb25uZWN0aW9uIHN0YXR1czogJywgX3RoaXMucDJwQ29ubmVjdGlvbkxpc3RbcmVtb3RlUnVudGltZVVSTF0pO1xyXG5cclxuICAgICAgICAvLyBVcGRhdGUgUDJQIFJlcXVlc3RlciBwcm90b3N0dWIgaWYgaXQgaXMgY29taW5nIGZyb20gdGhlcmVcclxuICAgICAgICBpZiAocnVudGltZVByb3RvU3R1YlVSTC5pbmNsdWRlcygnL3AycHJlcXVlc3Rlci8nKSkge1xyXG4gICAgICAgICAgX3RoaXMucDJwUmVxdWVzdGVyU3R1YltyZW1vdGVSdW50aW1lVVJMXS5zdGF0dXMgPSBtc2cuYm9keS52YWx1ZTtcclxuXHJcbiAgICAgICAgICAvLyBsb2cubG9nKCdbUmVnaXN0cnkgLSBvblByb3Rvc3R1YlN0YXR1c0V2ZW50XSAtIFAyUCBSZXF1ZXN0ZXIgc3RhdHVzOiAnLCBfdGhpcy5wMnBSZXF1ZXN0ZXJTdHViW3JlbW90ZVJ1bnRpbWVVUkxdKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgLy8gaWYgZnJvbSBQMlBIYW5kbGVyIHdpdGggc3RhdHVzIGRpc2NvbmVuY3RlZCwgbGV0cyByZW1vdmUgZnJvbSBwMnBDb25uZWN0aW9uTGlzdFxyXG4gICAgICAgICAgaWYgKG1zZy5ib2R5LnZhbHVlID09PSAnZGlzY29ubmVjdGVkJykgZGVsZXRlIF90aGlzLnAycENvbm5lY3Rpb25MaXN0W3JlbW90ZVJ1bnRpbWVVUkxdO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgaWYgKHJ1bnRpbWVQcm90b1N0dWJVUkwuaW5jbHVkZXMoJy9wMnByZXF1ZXN0ZXIvJykpIHtcclxuICAgICAgICAgIC8vIEl0IGlzIGFuIGV2ZW50IGZyb20gUDJQIFJlcXVlc3RlciB3aXRob3V0IG1hbmRhdG9yeSBcInJlc291cmNlXCIgZmllbGRcclxuICAgICAgICAgIGxvZy5lcnJvcignW1JlZ2lzdHJ5IG9uUHJvdG9zdHViU3RhdHVzRXZlbnRdIHJlc291cmNlIG1pc3Npbmc6ICcsIG1zZyk7XHJcbiAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIC8vIEl0IGlzIGFuIGV2ZW50IGZyb20gUDJQIEhhbmRsZXJcclxuICAgICAgICAgIF90aGlzLnAycEhhbmRsZXJTdHViW190aGlzLnJ1bnRpbWVVUkxdLnN0YXR1cyA9IG1zZy5ib2R5LnZhbHVlO1xyXG5cclxuICAgICAgICAgIC8vIGxvZy5sb2coJ1tSZWdpc3RyeSAtIG9uUHJvdG9zdHViU3RhdHVzRXZlbnRdIC0gUDJQSGFuZGxlciBTdHViIHN0YXR1czogJywgX3RoaXMucDJwSGFuZGxlclN0dWJbX3RoaXMucnVudGltZVVSTF0pO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG5cclxuICAgIH1cclxuXHJcbiAgfVxyXG5cclxuICAvKipcclxuICAqIFRvIHVucmVnaXN0ZXIgYSBwcmV2aW91c2x5IHJlZ2lzdGVyZWQgcHJvdG9jb2wgc3R1YlxyXG4gICogQHBhcmFtICB7SHlwZXJ0eVJ1bnRpbWVVUkx9ICAgSHlwZXJ0eVJ1bnRpbWVVUkwgICAgIGh5cGVydHlSdW50aW1lVVJMXHJcbiAgKi9cclxuICB1bnJlZ2lzdGVyU3R1YihoeXBlcnR5UnVudGltZVVSTCkge1xyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuXHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcblxyXG4gICAgICBpZiAoX3RoaXMucHJvdG9zdHVic0xpc3QuaGFzT3duUHJvcGVydHkoaHlwZXJ0eVJ1bnRpbWVVUkwpKSB7XHJcbiAgICAgICAgZGVsZXRlIF90aGlzLnByb3Rvc3R1YnNMaXN0W2h5cGVydHlSdW50aW1lVVJMXTtcclxuICAgICAgICByZXNvbHZlKCdQcm90b3N0dWJVUkwgcmVtb3ZlZCcpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHJlamVjdCgnRXJyb3Igb24gdW5yZWdpc3RlclN0dWI6IEh5cGVydHkgbm90IGZvdW5kJyk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogVG8gcmVnaXN0ZXIgYSBuZXcgSWRlbnRpdHkgUHJvdmlkZXIgcHJveHkgaW4gdGhlIHJ1bnRpbWUgaW5jbHVkaW5nIGFzIGlucHV0IHBhcmFtZXRlcnMgdGhlIGZ1bmN0aW9uIHRvIHBvc3RNZXNzYWdlLCB0aGUgRG9tYWluVVJMIHRoYXQgaXMgY29ubmVjdGVkIHdpdGggdGhlIHN0dWIsIHdoaWNoIHJldHVybnMgdGhlIFJ1bnRpbWVVUkwgYWxsb2NhdGVkIHRvIHRoZSBuZXcgUHJvdG9jb2xTdHViLlxyXG4gICAqIEBwYXJhbSB7U2FuZGJveH0gICAgICAgIFNhbmRib3hcclxuICAgKiBAcGFyYW0gIHtEb21haW5VUkx9ICAgICBEb21haW5VUkwgc2VydmljZSBwcm92aWRlciBkb21haW5cclxuICAgKiBAcmV0dXJuIHtSdW50aW1lSWRwUHJveHlVUkx9XHJcbiAgICovXHJcbiAgcmVnaXN0ZXJJZHBQcm94eShzYW5kYm94LCBkb21haW5VUkwpIHtcclxuICAgIGxldCBfdGhpcyA9IHRoaXM7XHJcblxyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG5cclxuICAgICAgbGV0IGlkcFByb3h5U3R1YlVSTDtcclxuXHJcbiAgICAgIC8vY2hlY2sgaWYgbWVzc2FnZUJ1cyBpcyByZWdpc3RlcmVkIGluIHJlZ2lzdHJ5IG9yIG5vdFxyXG4gICAgICBpZiAoX3RoaXMuX21lc3NhZ2VCdXMgPT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgIHJlamVjdCgnTWVzc2FnZUJ1cyBub3QgZm91bmQgb24gcmVnaXN0ZXJTdHViJyk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGlkcFByb3h5U3R1YlVSTCA9ICdkb21haW4taWRwOi8vJyArIGRvbWFpblVSTCArICcvc3R1Yi8nICsgZ2VuZXJhdGVHVUlEKCk7XHJcblxyXG4gICAgICAvLyBUT0RPOiBPcHRpbWl6ZSB0aGlzXHJcbiAgICAgIF90aGlzLmlkcFByb3h5TGlzdFtkb21haW5VUkxdID0ge1xyXG4gICAgICAgIHVybDogaWRwUHJveHlTdHViVVJMLFxyXG4gICAgICAgIHN0YXR1czogU1RBVFVTLkRFUExPWUlOR1xyXG4gICAgICB9O1xyXG5cclxuICAgICAgX3RoaXMuc2FuZGJveGVzTGlzdC5zYW5kYm94W2lkcFByb3h5U3R1YlVSTF0gPSBzYW5kYm94O1xyXG5cclxuICAgICAgLy8gc2FuZGJveC5hZGRMaXN0ZW5lcignKicsIGZ1bmN0aW9uKG1zZykge1xyXG4gICAgICAvLyAgIF90aGlzLl9tZXNzYWdlQnVzLnBvc3RNZXNzYWdlKG1zZyk7XHJcbiAgICAgIC8vIH0pO1xyXG5cclxuICAgICAgcmVzb2x2ZShpZHBQcm94eVN0dWJVUkwpO1xyXG5cclxuICAgICAgX3RoaXMuX21lc3NhZ2VCdXMuYWRkTGlzdGVuZXIoaWRwUHJveHlTdHViVVJMICsgJy9zdGF0dXMnLCAobXNnKSA9PiB7XHJcbiAgICAgICAgX3RoaXMuX29uSWRwUHJveHlTdGF0dXNFdmVudChtc2cpO1xyXG4gICAgICB9KTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgKiBUbyBQcm9jZXNzIHN0YXR1cyBldmVudHMgZmlyZWQgYnkgSWRwIFByb3hpZXNcclxuICAqIEBwYXJhbSAge01lc3NhZ2V9ICAgbWVzc2FnZSAgICAgRXZlbnQgTWVzc2FnZVxyXG4gICovXHJcblxyXG4gIF9vbklkcFByb3h5U3RhdHVzRXZlbnQobXNnKSB7XHJcblxyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuXHJcbiAgICAvLyBsb2cubG9nKCdbUmVnaXN0cnkgb25JZHBQcm94eVN0YXR1c0V2ZW50XTogJywgbXNnKTtcclxuXHJcbiAgICBsZXQgaWRwUHJveHlVUkwgPSBtc2cuZnJvbTtcclxuXHJcbiAgICBpZiAoIW1zZy50by5pbmNsdWRlcygnL3N0YXR1cycpKSB7XHJcbiAgICAgIGxvZy5lcnJvcignW1JlZ2lzdHJ5IG9uSWRwUHJveHlTdGF0dXNFdmVudF0gTm90IFN0YXR1cyBFdmVudDogJywgbXNnKTtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG5cclxuICAgIE9iamVjdC5rZXlzKF90aGlzLmlkcFByb3h5TGlzdCkuZmlsdGVyKChrZXkpID0+IHtcclxuICAgICAgcmV0dXJuIF90aGlzLmlkcFByb3h5TGlzdFtrZXldLnVybCA9PT0gaWRwUHJveHlVUkw7XHJcbiAgICB9KS5tYXAoKGtleSkgPT4ge1xyXG4gICAgICBfdGhpcy5pZHBQcm94eUxpc3Rba2V5XS5zdGF0dXMgPSBtc2cuYm9keS52YWx1ZTtcclxuXHJcbiAgICAgIC8vIGxvZy5sb2coJ1tSZWdpc3RyeSAtIG9uSWRwUHJveHlTdGF0dXNFdmVudF0gLSBJZHAgUHJveHkgc3RhdHVzOiAnLCBfdGhpcy5pZHBQcm94eUxpc3Rba2V5XSk7XHJcbiAgICB9KTtcclxuXHJcbiAgfVxyXG5cclxuICAvKipcclxuICAqIFRvIGRpc2NvdmVyIGlkcFByb3h5IHN0dWJzIGF2YWlsYWJsZSBpbiB0aGUgcnVudGltZSBmb3IgYSBjZXJ0YWluIGRvbWFpbi4gSWYgYXZhaWxhYmxlLCBpdCByZXR1cm5zIHRoZSBydW50aW1lIHVybCBmb3IgdGhlIGlkcFByb3h5IHN0dWIgdGhhdCBjb25uZWN0cyB0byB0aGUgcmVxdWVzdGVkIGRvbWFpbi4gUmVxdWlyZWQgYnkgdGhlIHJ1bnRpbWUgQlVTIHRvIHJvdXRlIG1lc3NhZ2VzIHRvIHJlbW90ZSBzZXJ2ZXJzIG9yIHBlZXJzXHJcbiAgKiBAcGFyYW0gIHtEb21haW5VUkx9ICAgICAgICAgICBEb21haW5VUkwgICAgICAgICAgICB1cmxcclxuICAqIEByZXR1cm4ge1J1bnRpbWVVUkx9ICAgICAgICAgICBSdW50aW1lVVJMICAgICAgICAgaWRwUHJveHlVcmxcclxuICAqL1xyXG4gIGRpc2NvdmVySWRwUHJveHkodXJsKSB7XHJcbiAgICBpZiAoIXVybCkgdGhyb3cgbmV3IEVycm9yKCdQYXJhbWV0ZXIgdXJsIG5lZWRlZCcpO1xyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuXHJcbiAgICBsZXQgZGl2aWRlZFVSTCA9IGRpdmlkZVVSTCh1cmwpO1xyXG4gICAgbGV0IGRvbWFpblVSTCA9IGRpdmlkZWRVUkwuZG9tYWluO1xyXG5cclxuICAgIGlmIChfdGhpcy5pZHBQcm94eUxpc3QuaGFzT3duUHJvcGVydHkoZG9tYWluVVJMKSAmJiBfdGhpcy5pZHBQcm94eUxpc3RbZG9tYWluVVJMXS5zdGF0dXMgPT09IFNUQVRVUy5MSVZFKSB7XHJcbiAgICAgIHJldHVybiAoX3RoaXMuaWRwUHJveHlMaXN0W2RvbWFpblVSTF0pO1xyXG4gICAgfSBlbHNlIHtcclxuXHJcbiAgICAgIF90aGlzLmlkcFByb3h5TGlzdFtkb21haW5VUkxdID0ge1xyXG4gICAgICAgIHN0YXR1czogU1RBVFVTLlBST0dSRVNTXHJcbiAgICAgIH07XHJcblxyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ1tSZWdpc3RyeSAtIGRpc2NvdmVySWRwUHJveHkgXSBJZHAgUHJveHkgTm90IEZvdW5kLiBDcmVhdGluZyBvbmUnKTtcclxuXHJcbiAgICB9XHJcblxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgKiBUbyByZWdpc3RlciBhIG5ldyBQb2xpY3kgRW5mb3JjZXIgaW4gdGhlIHJ1bnRpbWUgaW5jbHVkaW5nIGFzIGlucHV0IHBhcmFtZXRlcnMgdGhlIGZ1bmN0aW9uIHRvIHBvc3RNZXNzYWdlLCB0aGUgSHlwZXJ0eVVSTCBhc3NvY2lhdGVkIHdpdGggdGhlIFBFUCwgd2hpY2ggcmV0dXJucyB0aGUgUnVudGltZVVSTCBhbGxvY2F0ZWQgdG8gdGhlIG5ldyBQb2xpY3kgRW5mb3JjZXIgY29tcG9uZW50LlxyXG4gICogQHBhcmFtICB7TWVzc2FnZS5NZXNzYWdlfSBwb3N0TWVzc2FnZSBwb3N0TWVzc2FnZVxyXG4gICogQHBhcmFtICB7SHlwZXJ0eVVSTH0gICAgICAgICAgSHlwZXJ0eVVSTCAgICAgICAgICAgIGh5cGVydHlcclxuICAqIEByZXR1cm4ge0h5cGVydHlSdW50aW1lVVJMfSAgIEh5cGVydHlSdW50aW1lVVJMXHJcbiAgKi9cclxuICByZWdpc3RlclBFUChwb3N0TWVzc2FnZSwgaHlwZXJ0eSkge1xyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuXHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSkge1xyXG4gICAgICAvL1RPRE8gY2hlY2sgd2hhdCBwYXJhbWV0ZXIgaW4gdGhlIHBvc3RNZXNzYWdlIHRoZSBwZXAgaXMuXHJcbiAgICAgIF90aGlzLnBlcExpc3RbaHlwZXJ0eV0gPSBwb3N0TWVzc2FnZTtcclxuICAgICAgcmVzb2x2ZSgnUEVQIHJlZ2lzdGVyZWQgd2l0aCBzdWNjZXNzJyk7XHJcbiAgICB9KTtcclxuXHJcbiAgfVxyXG5cclxuICAvKipcclxuICAqIFRvIHVucmVnaXN0ZXIgYSBwcmV2aW91c2x5IHJlZ2lzdGVyZWQgcHJvdG9jb2wgc3R1YlxyXG4gICogQHBhcmFtICB7SHlwZXJ0eVJ1bnRpbWVVUkx9ICAgSHlwZXJ0eVJ1bnRpbWVVUkwgICAgIEh5cGVydHlSdW50aW1lVVJMXHJcbiAgKi9cclxuICB1bnJlZ2lzdGVyUEVQKEh5cGVydHlSdW50aW1lVVJMKSB7XHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG5cclxuICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuXHJcbiAgICAgIGxldCByZXN1bHQgPSBfdGhpcy5wZXBMaXN0W0h5cGVydHlSdW50aW1lVVJMXTtcclxuXHJcbiAgICAgIGlmIChyZXN1bHQgPT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgIHJlamVjdCgnUGVwIE5vdCBmb3VuZC4nKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICByZXNvbHZlKCdQRVAgc3VjY2Vzc2Z1bGx5IHJlbW92ZWQuJyk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG5cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICogVG8gZGlzY292ZXIgc2FuZGJveGVzIGF2YWlsYWJsZSBpbiB0aGUgcnVudGltZSBmb3IgYSBjZXJ0YWluIGRvbWFpbiBhbmQgYSBjZXJ0YWluIHNldCBvZiBjYXBhYmlsaXRpZXMuIFJlcXVpcmVkIGJ5IHRoZSBydW50aW1lIFVBIHRvIGF2b2lkIG1vcmUgdGhhbiBvbmUgc2FuZGJveCBmb3IgdGhlIHNhbWUgZG9tYWluLlxyXG4gICogQHBhcmFtICB7RG9tYWluVVJMfSBEb21haW5VUkwgdXJsXHJcbiAgKiBAcmV0dXJuIHtSdW50aW1lU2FuZGJveH0gICAgICAgICAgIFJ1bnRpbWVTYW5kYm94XHJcbiAgKi9cclxuICBnZXRTYW5kYm94KHVybCwgY29uc3RyYWludHMpIHtcclxuICAgIGlmICghdXJsKSB0aHJvdyBuZXcgRXJyb3IoJ1BhcmFtZXRlciB1cmwgbmVlZGVkJyk7XHJcblxyXG4gICAgLy8gbG9nLmxvZygnW1JlZ2lzdHJ5IGdldFNhbmRib3hdIGdldFNhbmRib3ggZm9yOiAnLCB1cmwsICcgYW5kIGNhcGFiaWxpdGllczogJywgY29uc3RyYWludHMpO1xyXG5cclxuICAgIGxldCBfdGhpcyA9IHRoaXM7XHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcblxyXG4gICAgICBsZXQgcmVxdWVzdDtcclxuXHJcbiAgICAgIC8vZmlyc3QgdHJ5IHRvIGZpbmQgdGhlIHVybCBpbiB0aGUgYXBwU2FuZGJveCBsaXN0XHJcbiAgICAgIHJlcXVlc3QgPSBfdGhpcy5zYW5kYm94ZXNMaXN0LmFwcFNhbmRib3hbdXJsXTtcclxuXHJcbiAgICAgIC8vaWYgbm8gYXBwU2FuZGJveCB3YXMgZm91bmQsIHRyeSB0byBzZWFyY2ggaW4gdGhlIG5vcm1hbCBzYW5kYm94ZXMgbGlzdFxyXG4gICAgICBpZiAoIXJlcXVlc3QpIHtcclxuICAgICAgICByZXF1ZXN0ID0gX3RoaXMuc2FuZGJveGVzTGlzdC5zYW5kYm94W3VybF07XHJcblxyXG4gICAgICAgIGlmICghcmVxdWVzdCkge1xyXG5cclxuICAgICAgICAgIGxldCBkb21haW47XHJcblxyXG4gICAgICAgICAgaWYgKHVybC5pbmNsdWRlcygnOi8vJykpIHtcclxuICAgICAgICAgICAgZG9tYWluID0gZGl2aWRlVVJMKHVybCkuZG9tYWluO1xyXG4gICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgZG9tYWluID0gdXJsO1xyXG4gICAgICAgICAgfVxyXG5cclxuICAgICAgICAgIC8vIHNlYXJjaCBpbiB0aGUgc2FuZGJveGVzIGxpc3QgZm9yIGEgZW50cnkgY29udGFpbmluZyB0aGUgZG9tYWluIGdpdmVuXHJcbiAgICAgICAgICBmb3IgKGxldCBzYW5kYm94IGluIF90aGlzLnNhbmRib3hlc0xpc3Quc2FuZGJveCkge1xyXG4gICAgICAgICAgICAvL3RvZG86IHVuY29tbWVudCBzYW5kYm94IGNvbnN0cmFpbnRzIG1hdGNoIGNvbmRpdGlvbiB3aXRoIHJ1bnRpbWUgc2hhcmluZ1xyXG4gICAgICAgICAgICBpZiAoc2FuZGJveC5pbmNsdWRlcyhkb21haW4pICYmIF90aGlzLnNhbmRib3hlc0xpc3Quc2FuZGJveFtzYW5kYm94XS5tYXRjaGVzKGNvbnN0cmFpbnRzKSkge1xyXG4gICAgICAgICAgICAgIGNvbnN0IGN1cnJlbnQgPSBfdGhpcy5zYW5kYm94ZXNMaXN0LnNhbmRib3hbc2FuZGJveF07XHJcbiAgICAgICAgICAgICAgY29uc3QgbWF0Y2ggPSBPYmplY3Qua2V5cyhjb25zdHJhaW50cykuZmlsdGVyKGNvbnN0cmFpbnQgPT4ge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIChjb25zdHJhaW50ID09PSAnYnJvd3NlcicgJiYgY3VycmVudC50eXBlID09PSBTYW5kYm94VHlwZS5OT1JNQUwpIHx8XHJcbiAgICAgICAgICAgICAgICAgICAgICAoY29uc3RyYWludCA9PT0gJ3dpbmRvd1NhbmJveCcgJiYgY3VycmVudC50eXBlID09PSBTYW5kYm94VHlwZS5XSU5ET1cpO1xyXG5cclxuICAgICAgICAgICAgICB9KS5sZW5ndGggPiAwID8gdHJ1ZSA6IGZhbHNlO1xyXG5cclxuICAgICAgICAgICAgICBpZiAobWF0Y2gpIHsgcmVxdWVzdCA9IGN1cnJlbnQ7IH1cclxuICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG5cclxuICAgICAgaWYgKCFyZXF1ZXN0KSB7XHJcbiAgICAgICAgcmVqZWN0KCdubyBzYW5kYm94IGZvdW5kIGZvcjogJyArIHVybCk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgcmVzb2x2ZShyZXF1ZXN0KTtcclxuICAgICAgfVxyXG5cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgcmVzb2x2ZU5vcm1hbFN0dWIodXJsKSB7XHJcbiAgICAvLyBsb2cubG9nKCdyZXNvbHZlTm9ybWFsU3R1YiAnICsgdXJsKTtcclxuICAgIGxldCBfdGhpcyA9IHRoaXM7XHJcblxyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcclxuXHJcbiAgICAgIC8vc3BsaXQgdGhlIHVybCB0byBmaW5kIHRoZSBkb21haW5VUkwuIGRlYWxzIHdpdGggdGhlIHVybCBmb3IgZXhhbXBsZSBhczpcclxuICAgICAgLy9cImh5cGVydHktcnVudGltZTovL3NwMS9wcm90b3N0dWIvMTIzXCIsXHJcbiAgICAgIGxldCBkaXZpZGVkVVJMID0gZGl2aWRlVVJMKHVybCk7XHJcbiAgICAgIGxldCBkb21haW5VcmwgPSBkaXZpZGVkVVJMLmRvbWFpbjtcclxuICAgICAgbGV0IHR5cGUgPSBkaXZpZGVkVVJMLnR5cGU7XHJcblxyXG4gICAgICBpZiAodXJsLmluY2x1ZGVzKF90aGlzLnJ1bnRpbWVVUkwpIHx8IHVybC5pbmNsdWRlcygnOi8vc2FuZGJveC8nKSkge1xyXG4gICAgICAgIGxvZy5lcnJvcignW1JlZ2lzdHJ5IC0gcmVzb2x2ZV0gVVJMIHRvIGJlIHJlc29sdmVkIHNob3VsZCBoYXZlIGxpc3RlbmVycyAnLCB1cmwpO1xyXG4gICAgICAgIHJldHVybiByZWplY3QoJ1tSZWdpc3RyeSAtIHJlc29sdmVdIFVSTCB0byBiZSByZXNvbHZlZCBzaG91bGQgaGF2ZSBsaXN0ZW5lcnMgJywgdXJsKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgLy8gcmVzb2x2ZSB0aGUgZG9tYWluIHByb3Rvc3R1YiBpbiBjYXNlIG9mIGEgbWVzc2FnZSB0byBnbG9iYWwgcmVnaXN0cnlcclxuICAgICAgaWYgKHVybC5pbmNsdWRlcygnZ2xvYmFsOi8vcmVnaXN0cnknKSkge1xyXG4gICAgICAgIGRvbWFpblVybCA9IF90aGlzLl9kb21haW47XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgaWYgKCFkb21haW5VcmwuaW5kZXhPZignbXNnLW5vZGUuJykgfHwgIWRvbWFpblVybC5pbmRleE9mKCdyZWdpc3RyeS4nKSkge1xyXG4gICAgICAgICAgZG9tYWluVXJsID0gZG9tYWluVXJsLnN1YnN0cmluZyhkb21haW5VcmwuaW5kZXhPZignLicpICsgMSk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcblxyXG4gICAgICBfdGhpcy5pc0xlZ2FjeSh1cmwpLnRoZW4oKGlzTGVnYWN5KSA9PiB7XHJcblxyXG4gICAgICAgIC8vIGlmIGxlZ2FjeSBpdCBzaG91bGQgcmVzb2x2ZSBmb3IgPHByb3RvY29sPi48ZG9tYWluPlxyXG4gICAgICAgIGlmIChpc0xlZ2FjeSAmJiB0eXBlICE9PSAnZG9tYWluLWlkcCcpIHtcclxuICAgICAgICAgIGRvbWFpblVybCA9IHR5cGUgKyAnLicgKyBnZXRVc2VySWRlbnRpdHlEb21haW4odXJsKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGxvZy5pbmZvKCdbUmVnaXN0cnkucmVzb2x2ZV0gZG9tYWluVXJsOicsIGRvbWFpblVybCk7XHJcblxyXG4gICAgICAgIGxldCByZWdpc3RyZWRDb21wb25lbnQ7XHJcblxyXG4gICAgICAgIGlmICh0eXBlID09PSAnZG9tYWluLWlkcCcpIHtcclxuICAgICAgICAgIHJlZ2lzdHJlZENvbXBvbmVudCAgPSBfdGhpcy5pZHBQcm94eUxpc3QuaGFzT3duUHJvcGVydHkoZG9tYWluVXJsKSA/IF90aGlzLmlkcFByb3h5TGlzdFtkb21haW5VcmxdIDogZmFsc2U7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIHJlZ2lzdHJlZENvbXBvbmVudCAgPSBfdGhpcy5wcm90b3N0dWJzTGlzdC5oYXNPd25Qcm9wZXJ0eShkb21haW5VcmwpID8gX3RoaXMucHJvdG9zdHVic0xpc3RbZG9tYWluVXJsXSA6IGZhbHNlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgbG9nLmluZm8oJ1tSZWdpc3RyeS5yZXNvbHZlXSByZWdpc3RyZWQ6JywgcmVnaXN0cmVkQ29tcG9uZW50KTtcclxuXHJcbiAgICAgICAgLy8gVE9ETyBzaW5jZSB0aGUgcHJvdG9zdHVicyBoYXZlIG90aGVyIHN0YXRlcyB0aGlzIHNob3VsZCBiZSByZXZpc2VkLCBiZWNhdXNlIHRoZSBzdGF0dXMgY291bGQgY2hhbmdlIGZyb20gREVQTE9ZRUQgdG8gTElWRVxyXG4gICAgICAgIC8vIFRPRE8gYW5kIHRoaXMgdmFsaWRhdGlvbiB3aWxsIHRyaWdnZXIgYSBuZXcgbG9hZCBvZiBJRFBQcm94eSBvciBQcm90b3N0dWI7XHJcbiAgICAgICAgaWYgKHJlZ2lzdHJlZENvbXBvbmVudCAmJiByZWdpc3RyZWRDb21wb25lbnQuaGFzT3duUHJvcGVydHkoJ3N0YXR1cycpICYmXHJcbiAgICAgICAgIChyZWdpc3RyZWRDb21wb25lbnQuc3RhdHVzID09PSBTVEFUVVMuREVQTE9ZRUQgfHwgcmVnaXN0cmVkQ29tcG9uZW50LnN0YXR1cyA9PT0gU1RBVFVTLkNSRUFURUQgfHxcclxuICAgICAgICAgIHJlZ2lzdHJlZENvbXBvbmVudC5zdGF0dXMgPT09IFNUQVRVUy5MSVZFIHx8IHJlZ2lzdHJlZENvbXBvbmVudC5zdGF0dXMgPT09IFNUQVRVUy5ESVNDT05ORUNURUQpKSB7XHJcbiAgICAgICAgICBsb2cuaW5mbygnW1JlZ2lzdHJ5LnJlc29sdmVdIFJlc29sdmVkOiAnLCByZWdpc3RyZWRDb21wb25lbnQudXJsLCByZWdpc3RyZWRDb21wb25lbnQuc3RhdHVzKTtcclxuICAgICAgICAgIHJlc29sdmUocmVnaXN0cmVkQ29tcG9uZW50LnVybCk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIC8vdG9kbzogdXNlIHN3aXRjaC1jYXNlIHRvIHN1cHBvcnQgb3RoZXIgdHlwZXMgb2Ygc3R1YnNcclxuICAgICAgICAgIGlmICh0eXBlID09PSAnZG9tYWluLWlkcCcpIHtcclxuXHJcbiAgICAgICAgICAgIC8vIFRoZSBJZFAgUHJveHkgZG9lcyBub3QgZXhpc3QsIGxldCdzIHByZXBhcmUgaXRzIGRlcGxveW1lbnQgYnkgd2F0Y2hpbmcgaXRzIHN0YXR1c1xyXG5cclxuICAgICAgICAgICAgX3RoaXMud2F0Y2hpbmdZb3Uub2JzZXJ2ZSgnaWRwUHJveHlMaXN0JywgKGNoYW5nZSkgPT4ge1xyXG5cclxuICAgICAgICAgICAgICAvLyBsb2cubG9nKCdbUmVnaXN0cnkgLSByZXNvbHZlTm9ybWFsU3R1Yl0gaWRwUHJveHlMaXN0IGNoYW5nZWQgJyArIF90aGlzLmlkcFByb3h5TGlzdCk7XHJcblxyXG4gICAgICAgICAgICAgIGxldCBrZXlwYXRoID0gY2hhbmdlLmtleXBhdGg7XHJcblxyXG4gICAgICAgICAgICAgIGlmIChrZXlwYXRoLmluY2x1ZGVzKCdzdGF0dXMnKSlcclxuICAgICAgICAgICAgICAgIGtleXBhdGggPSBrZXlwYXRoLnJlcGxhY2UoJy5zdGF0dXMnLCAnJyk7XHJcblxyXG4gICAgICAgICAgICAgIGlmIChrZXlwYXRoID09PSBkb21haW5VcmwgJiYgY2hhbmdlLm5hbWUgPT09ICdzdGF0dXMnICYmIGNoYW5nZS5uZXdWYWx1ZSA9PT0gU1RBVFVTLkNSRUFURUQpIHtcclxuICAgICAgICAgICAgICAgIC8vIGxvZy5sb2coJ1tSZWdpc3RyeSAtIHJlc29sdmVOb3JtYWxTdHViXSBpZHBQcm94eUxpc3QgaXMgbGl2ZSAnICsgX3RoaXMuaWRwUHJveHlMaXN0W2RvbWFpblVybF0pO1xyXG4gICAgICAgICAgICAgICAgcmVzb2x2ZShfdGhpcy5pZHBQcm94eUxpc3RbZG9tYWluVXJsXS51cmwpO1xyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICBpZiAoIXJlZ2lzdHJlZENvbXBvbmVudCB8fCByZWdpc3RyZWRDb21wb25lbnQuc3RhdHVzID09PSBTVEFUVVMuRkFJTEVEICkge1xyXG4gICAgICAgICAgICAgIC8vIHRoaXMgcHJvY2VzcyB3aWxsIGxvYWQgdGhlIGlkcCBwcm94eSwgYmVjYXVzZSBpcyBub3QgeWV0IHJlZ2lzdGVyZWQ7XHJcbiAgICAgICAgICAgICAgbG9nLmluZm8oJ1tSZWdpc3RyeS5yZXNvbHZlTm9ybWFsU3R1Yl0gZGVwbG95IG5ldyBJRFBQcm94eTogJywgZG9tYWluVXJsKTtcclxuICAgICAgICAgICAgICBfdGhpcy5sb2FkZXIubG9hZElkcFByb3h5KGRvbWFpblVybCkudGhlbigoKSA9PiB7XHJcblxyXG4gICAgICAgICAgICAgICAgbG9nLmluZm8oJ1tSZWdpc3RyeS5yZXNvbHZlTm9ybWFsU3R1Yl0gSWRQIFByb3h5IGRlcGxveWVkOiAnLCBfdGhpcy5pZHBQcm94eUxpc3RbZG9tYWluVXJsXSk7XHJcblxyXG4gICAgICAgICAgICAgIH0pLmNhdGNoKChyZWFzb24pID0+IHtcclxuICAgICAgICAgICAgICAgIGxvZy5lcnJvcignW1JlZ2lzdHJ5LnJlc29sdmVdIEVycm9yIHJlc29sdmluZyBMb2FkIElEUFByb3h5OiAnLCByZWFzb24pO1xyXG4gICAgICAgICAgICAgICAgX3RoaXMuaWRwUHJveHlMaXN0W2RvbWFpblVybF0uc3RhdHVzID0gJ2RlcGxveW1lbnQtZmFpbGVkJztcclxuICAgICAgICAgICAgICAgIHJlamVjdChyZWFzb24pO1xyXG4gICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICAgIH0gZWxzZSB7XHJcblxyXG4gICAgICAgICAgICAvLyBUaGUgcHJvdG9TdHViIGRvZXMgbm90IGV4aXN0LCBsZXQncyBwcmVwYXJlIGl0cyBkZXBsb3ltZW50IGJ5IHdhdGNoaW5nIGl0cyBzdGF0dXNcclxuXHJcbiAgICAgICAgICAgIF90aGlzLndhdGNoaW5nWW91Lm9ic2VydmUoJ3Byb3Rvc3R1YnNMaXN0JywgKGNoYW5nZSkgPT4ge1xyXG5cclxuICAgICAgICAgICAgICAvLyBsb2cubG9nKCdbUmVnaXN0cnkgLSByZXNvbHZlTm9ybWFsU3R1Yl0gcHJvdG9zdHVic0xpc3QgY2hhbmdlZCAnICsgX3RoaXMucHJvdG9zdHVic0xpc3QpO1xyXG5cclxuICAgICAgICAgICAgICBsZXQga2V5cGF0aCA9IGNoYW5nZS5rZXlwYXRoO1xyXG5cclxuICAgICAgICAgICAgICBpZiAoa2V5cGF0aC5pbmNsdWRlcygnc3RhdHVzJykpXHJcbiAgICAgICAgICAgICAgICBrZXlwYXRoID0ga2V5cGF0aC5yZXBsYWNlKCcuc3RhdHVzJywgJycpO1xyXG5cclxuICAgICAgICAgICAgICBpZiAoa2V5cGF0aCA9PT0gZG9tYWluVXJsICYmIGNoYW5nZS5uYW1lID09PSAnc3RhdHVzJyAmJiBjaGFuZ2UubmV3VmFsdWUgPT09IFNUQVRVUy5DUkVBVEVEKSB7XHJcbiAgICAgICAgICAgICAgICAvLyBsb2cubG9nKCdbUmVnaXN0cnkgLSByZXNvbHZlXSBwcm90b3N0dWIgaXMgbGl2ZSAnICsgX3RoaXMucHJvdG9zdHVic0xpc3RbZG9tYWluVXJsXSk7XHJcbiAgICAgICAgICAgICAgICByZXNvbHZlKF90aGlzLnByb3Rvc3R1YnNMaXN0W2RvbWFpblVybF0udXJsKTtcclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgaWYgKCFyZWdpc3RyZWRDb21wb25lbnQgfHwgcmVnaXN0cmVkQ29tcG9uZW50LnN0YXR1cyA9PT0gU1RBVFVTLkZBSUxFRCkge1xyXG4gICAgICAgICAgICAgIC8vIGxldHMgZGVwbG95IHRoZSBwcm90b3N0dWJcclxuICAgICAgICAgICAgICBsb2cuaW5mbygnW1JlZ2lzdHJ5LnJlc29sdmVdIHRyaWdnZXIgbmV3IFByb3RvY29sU3R1YjogJywgZG9tYWluVXJsKTtcclxuICAgICAgICAgICAgICBfdGhpcy5sb2FkZXIubG9hZFN0dWIoZG9tYWluVXJsKS50aGVuKCgpID0+IHtcclxuXHJcbiAgICAgICAgICAgICAgICAvLyBsb2cubG9nKCdbUmVnaXN0cnkgLSByZXNvbHZlTm9ybWFsU3R1Yl0gU3R1YiBkZXBsb3llZDogJywgX3RoaXMucHJvdG9zdHVic0xpc3RbZG9tYWluVXJsXSk7XHJcbiAgICAgICAgICAgICAgfSkuY2F0Y2goKHJlYXNvbikgPT4ge1xyXG4gICAgICAgICAgICAgICAgbG9nLmVycm9yKCdbUmVnaXN0cnkucmVzb2x2ZU5vcm1hbFN0dWJdIEVycm9yIHJlc29sdmluZyBMb2FkIFByb3RvY29sU3R1YjogJywgcmVhc29uKTtcclxuICAgICAgICAgICAgICAgIHJlamVjdChyZWFzb24pO1xyXG4gICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgfVxyXG5cclxuICAgICAgICB9XHJcblxyXG4gICAgICB9KS5jYXRjaCgocmVhc29uKSA9PiB7XHJcbiAgICAgICAgbG9nLmVycm9yKCdbUmVnaXN0cnkucmVzb2x2ZV0gRXJyb3IgcmVzb2x2aW5nIGlzbGVnYWN5OiAnLCByZWFzb24pO1xyXG4gICAgICAgIHJlamVjdChyZWFzb24pO1xyXG4gICAgICB9KTtcclxuXHJcbiAgICB9KTtcclxuXHJcbiAgfVxyXG5cclxuICAvKipcclxuICAqIFRvIHZlcmlmeSBpZiBzb3VyY2UgaXMgdmFsaWQgYW5kIHRvIHJlc29sdmUgdGFyZ2V0IHJ1bnRpbWUgdXJsIGFkZHJlc3MgaWYgbmVlZGVkIChlZyBwcm90b3N0dWIgcnVudGltZSB1cmwgaW4gY2FzZSB0aGUgbWVzc2FnZSBpcyB0byBiZSBkaXNwYXRjaGVkIHRvIGEgcmVtb3RlIGVuZHBvaW50KS5cclxuICAqIEBwYXJhbSAge1VSTC5VUkx9ICB1cmwgICAgICAgdXJsXHJcbiAgKiBAcmV0dXJuIHtQcm9taXNlPFVSTC5VUkw+fSAgICAgICAgICAgICAgICAgUHJvbWlzZSA8VVJMLlVSTD5cclxuICAqL1xyXG4gIHJlc29sdmUobXNnKSB7XHJcbiAgICBsb2cuaW5mbygnW1JlZ2lzdHJ5IC0gUmVzb2x2ZV0gLSAgJywgbXNnKTtcclxuICAgIGxldCBfdGhpcyA9IHRoaXM7XHJcblxyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcclxuXHJcbiAgICAgIGxldCB1cmwgPSBtc2cudG8gPyBtc2cudG8gOiBtc2c7XHJcblxyXG4gICAgICBsZXQgcDJwID0gKG1zZy5ib2R5ICYmIG1zZy5ib2R5LnAycCkgPyBtc2cuYm9keS5wMnAgOiBmYWxzZTtcclxuXHJcbiAgICAgIC8vIGxvZy5sb2coJ1AyUDogJywgcDJwLCB1cmwpO1xyXG4gICAgICAvLyBsb2cubG9nKCdQMlAgLSBwMnBIYW5kbGVyU3R1YjogJywgIV90aGlzLnAycEhhbmRsZXJTdHViW190aGlzLnJ1bnRpbWVVUkxdLCBfdGhpcy5wMnBIYW5kbGVyU3R1YiwgX3RoaXMucnVudGltZVVSTCk7XHJcbiAgICAgIC8vIGxvZy5sb2coJ1AyUCAtIGlzQmFja2VuZFNlcnZpY2VVUkw6ICcsIGlzQmFja2VuZFNlcnZpY2VVUkwodXJsKSwgaXNCYWNrZW5kU2VydmljZVVSTCwgdXJsKTtcclxuICAgICAgLy8gbG9nLmxvZygnUDJQIC0gaW5jbHVkZXMgcnVudGltZVVSTDogJywgdXJsLmluY2x1ZGVzKF90aGlzLnJ1bnRpbWVVUkwpKTtcclxuICAgICAgLy8gbG9nLmxvZygnUDJQIC0gaW5jbHVkZXMgcDJwaGFuZGxlcjogJywgdXJsLmluY2x1ZGVzKCcvcDJwaGFuZGxlci8nKSk7XHJcbiAgICAgIC8vIGxvZy5sb2coJ1AyUCAtIGluY2x1ZGVzIHAycHJlcXVlc3RlcjogJywgdXJsLmluY2x1ZGVzKCcvcDJwcmVxdWVzdGVyLycpKTtcclxuXHJcbiAgICAgIC8vIFNraXAgcDJwIHByb2NlZHVyZSB3aGVuIG5vdCBzdXBwb3J0ZWQgYnkgdGhlIFJ1bnRpbWUgb3IgZm9yIGJhY2tlbmQgc2VydmljZXNcclxuXHJcbiAgICAgIGlmICghX3RoaXMucDJwSGFuZGxlclN0dWJbX3RoaXMucnVudGltZVVSTF0gfHwgaXNCYWNrZW5kU2VydmljZVVSTCh1cmwpIHx8IHVybC5pbmNsdWRlcyhfdGhpcy5ydW50aW1lVVJMKSB8fCB1cmwuaW5jbHVkZXMoJy9wMnBoYW5kbGVyLycpIHx8IHVybC5pbmNsdWRlcygnL3AycHJlcXVlc3Rlci8nKSkge1xyXG5cclxuICAgICAgICBsb2cuaW5mbygnW1JlZ2lzdHJ5IC0gcmVzb2x2ZV0gLSBSZXNvbHZlIG5vcm1hbCBzdHViOiAnLCBfdGhpcy5wMnBIYW5kbGVyU3R1YiwgX3RoaXMucnVudGltZVVSTCwgaXNCYWNrZW5kU2VydmljZVVSTCh1cmwpLCBwMnAsIHVybCk7XHJcbiAgICAgICAgX3RoaXMucmVzb2x2ZU5vcm1hbFN0dWIodXJsKS50aGVuKChyZXR1cm5VUkwpID0+IHtcclxuICAgICAgICAgIHJlc29sdmUocmV0dXJuVVJMKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgIH0gZWxzZSB7XHJcblxyXG4gICAgICAgIGxvZy5pbmZvKCdbUmVnaXN0cnkgLSByZXNvbHZlXSAtIGNoZWNrUDJQOiAnLCBwMnAsIHVybCwgX3RoaXMuX3AycENvbm5lY3Rpb25SZXNvbHZlKTtcclxuICAgICAgICBfdGhpcy5fcDJwQ29ubmVjdGlvblJlc29sdmUuY2hlY2tQMlAobXNnKS50aGVuKChyZWdpc3RlcmVkUDJQKSA9PiB7XHJcblxyXG4gICAgICAgICAgLy8gbG9nLmxvZygnW1JlZ2lzdHJ5IC0gcmVzb2x2ZV0gZm91bmQgcmVnaXN0ZXJlZCBQMlA6ICcsIHJlZ2lzdGVyZWRQMlApO1xyXG5cclxuICAgICAgICAgIGxldCBwMnBDb25uZWN0aW9uID0gX3RoaXMucDJwQ29ubmVjdGlvbkxpc3RbcmVnaXN0ZXJlZFAyUC5ydW50aW1lXTtcclxuXHJcbiAgICAgICAgICBpZiAoIXAycENvbm5lY3Rpb24pIHtcclxuICAgICAgICAgICAgcDJwQ29ubmVjdGlvbiA9IHJlZ2lzdGVyZWRQMlA7XHJcbiAgICAgICAgICAgIF90aGlzLnAycENvbm5lY3Rpb25MaXN0W3JlZ2lzdGVyZWRQMlAucnVudGltZV0gPSBwMnBDb25uZWN0aW9uO1xyXG4gICAgICAgICAgfVxyXG5cclxuICAgICAgICAgIHN3aXRjaCAocDJwQ29ubmVjdGlvbi5zdGF0dXMpIHtcclxuICAgICAgICAgICAgY2FzZSBTVEFUVVMuTElWRTpcclxuICAgICAgICAgICAgICBtc2cuYm9keS5wZWVyID0gcmVnaXN0ZXJlZFAyUC5ydW50aW1lO1xyXG4gICAgICAgICAgICAgIHJlc29sdmUocDJwQ29ubmVjdGlvbi51cmwsIG1zZyk7XHJcbiAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgU1RBVFVTLkNSRUFURUQ6IC8vIHAycCBjb25uZWN0aW9uIHNldHVwIGlzIG9uZ29pbmcsIHVzZSBNTiBTdHViXHJcbiAgICAgICAgICAgIGNhc2UgU1RBVFVTLlBST0dSRVNTOlxyXG4gICAgICAgICAgICAgIF90aGlzLnJlc29sdmVOb3JtYWxTdHViKHVybCkudGhlbigocmV0dXJuVVJMKSA9PiB7XHJcbiAgICAgICAgICAgICAgICByZXNvbHZlKHJldHVyblVSTCk7XHJcbiAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgU1RBVFVTLkRJU0NPTk5FQ1RFRDogLy8gcDJwIGNvbm5lY3Rpb24gc3R1YiB3YXMgZGlzY29ubmVjdGVkLCBsZXQncyBhc2sgdG8gY29ubmVjdCBhZ2FpblxyXG4gICAgICAgICAgICAgIGxvZy5pbmZvKCdbUmVnaXN0cnkgLSBSZXNvbHZlXSAtIHAycENvbm5lY3Rpb24gaXMgZGlzY29ubmVjdGVkIGxldHMgdHJ5IHRvIHJlY29ubmVjdCcpO1xyXG4gICAgICAgICAgICAgIF90aGlzLl9wMnBDb25uZWN0aW9uUmVzb2x2ZS5yZWNvbm5lY3RQMlBSZXF1ZXN0ZXIocDJwQ29ubmVjdGlvbikudGhlbigocmV0dXJuVVJMKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAvLyBsb2cubG9nKCdbUmVnaXN0cnkgLSBSZXNvbHZlXSAtIHdhcyByZWNvbm5lY3RlZCB3aXRoIHAycFJlcXVlc3RlclN0dWJ0OiAnLCByZXR1cm5VUkwpO1xyXG4gICAgICAgICAgICAgICAgcmVzb2x2ZShyZXR1cm5VUkwpO1xyXG4gICAgICAgICAgICAgIH0sIChyZWFzb24pID0+IHtcclxuICAgICAgICAgICAgICAgIGxvZy5pbmZvKCdbUmVnaXN0cnkgLSBSZXNvbHZlXSAtIFJlYXNvbjogJywgcmVhc29uKTtcclxuXHJcbiAgICAgICAgICAgICAgICBfdGhpcy5yZXNvbHZlTm9ybWFsU3R1Yih1cmwpLnRoZW4oKHJldHVyblVSTCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICByZXNvbHZlKHJldHVyblVSTCk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgZGVmYXVsdDpcclxuXHJcbiAgICAgICAgICAgICAgbG9nLmluZm8oJ1tSZWdpc3RyeSAtIHJlc29sdmVdIC0gUDJQOiAnLCBwMnApO1xyXG4gICAgICAgICAgICAgIGlmICghcDJwKSB7IC8vIG5vIHAycCBjb25uZWN0aW9uIGV4aXN0cyBhbmQgdGhlIG1lc3NhZ2Ugc2VuZGVyIGRvZXMgbm90IGFzayBvbmUuIExldHMgdXNlIHRoZSBNTiBTdHViXHJcbiAgICAgICAgICAgICAgICBfdGhpcy5yZXNvbHZlTm9ybWFsU3R1Yih1cmwpLnRoZW4oKHJldHVyblVSTCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICByZXNvbHZlKHJldHVyblVSTCk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIF90aGlzLl9zZXR1cFAyUFJlcXVlc3RlcihyZWdpc3RlcmVkUDJQKS50aGVuKChyZXR1cm5VUkwpID0+IHsgLy8gbm8gcDJwIGNvbm5lY3Rpb24gZXhpc3RzIGJ1dCB0aGUgbWVzc2FnZSBzZW5kZXIgaXMgYXNraW5nIG9uZS4gTGV0cyB0cnkgdG8gc2V0dXAgb25lXHJcbiAgICAgICAgICAgICAgICAgIHJlc29sdmUocmV0dXJuVVJMKTtcclxuICAgICAgICAgICAgICAgIH0sIChyZWFzb24pID0+IHtcclxuICAgICAgICAgICAgICAgICAgbG9nLmluZm8oJ1tSZWdpc3RyeSAtIFJlc29sdmVdIC0gUmVhc29uOiAnLCByZWFzb24pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgX3RoaXMucmVzb2x2ZU5vcm1hbFN0dWIodXJsKS50aGVuKChyZXR1cm5VUkwpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHJldHVyblVSTCk7XHJcbiAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0sIChyZWFzb24pID0+IHtcclxuICAgICAgICAgIGxvZy5pbmZvKCdbUmVnaXN0cnkgLSBSZXNvbHZlXSAtIFJlYXNvbjogJywgcmVhc29uKTtcclxuXHJcbiAgICAgICAgICBfdGhpcy5yZXNvbHZlTm9ybWFsU3R1Yih1cmwpLnRoZW4oKHJldHVyblVSTCkgPT4ge1xyXG4gICAgICAgICAgICByZXNvbHZlKHJldHVyblVSTCk7XHJcbiAgICAgICAgICB9KTtcclxuICAgICAgICB9KTtcclxuICAgICAgfVxyXG5cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgX3NldHVwUDJQUmVxdWVzdGVyKGlucHV0KSB7XHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG5cclxuICAgIGxvZy5sb2coJ1tSZWdpc3RyeS5fc2V0dXBQMlBDb25uZWN0aW9uXSBsb2FkU3R1YiB3aXRoIHAycFJlcXVlc3RlcjogJywgaW5wdXQpO1xyXG5cclxuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XHJcblxyXG4gICAgICBsZXQgcmVtb3RlUnVudGltZSA9IGlucHV0LnJ1bnRpbWU7XHJcblxyXG4gICAgICBsZXQgcDJwQ29uZmlnID0geyByZW1vdGVSdW50aW1lVVJMOiByZW1vdGVSdW50aW1lLCBwMnBIYW5kbGVyOiBpbnB1dC5wMnBIYW5kbGVyLCBwMnBSZXF1ZXN0ZXJTdHViOiB0cnVlIH07XHJcblxyXG4gICAgICAvLyBsZXRzIHByZXBhcmUgdGhlIHAycFJlcXVlc3RlclNUdWIgZGVwbG95bWVudCBieSBzZXR0aW5nIGFuIG9ic2VydmVyIHRvIGl0cyBzdGF0dXMgY2hhbmdlc1xyXG5cclxuICAgICAgX3RoaXMud2F0Y2hpbmdZb3Uub2JzZXJ2ZSgncDJwUmVxdWVzdGVyU3R1YicsIChjaGFuZ2UpID0+IHtcclxuXHJcbiAgICAgICAgbG9nLmxvZygnW1JlZ2lzdHJ5Ll9zZXR1cFAyUENvbm5lY3Rpb25dIHAycFJlcXVlc3RlclN0dWJzIGNoYW5nZWQgJyArIF90aGlzLnAycFJlcXVlc3RlclN0dWIpO1xyXG5cclxuICAgICAgICBpZiAoY2hhbmdlLmtleXBhdGguc3BsaXQoJy4nKVswXSA9PT0gcmVtb3RlUnVudGltZSAmJiBjaGFuZ2UubmFtZSA9PT0gJ3N0YXR1cycgJiYgY2hhbmdlLm5ld1ZhbHVlID09PSBTVEFUVVMuTElWRSkge1xyXG4gICAgICAgICAgbG9nLmxvZygnW1JlZ2lzdHJ5Ll9zZXR1cFAyUENvbm5lY3Rpb25dIHAycFJlcXVlc3RlciBpcyBsaXZlICcgKyBfdGhpcy5wMnBSZXF1ZXN0ZXJTdHViW3JlbW90ZVJ1bnRpbWVdKTtcclxuICAgICAgICAgIHJlc29sdmUoX3RoaXMucDJwUmVxdWVzdGVyU3R1YltyZW1vdGVSdW50aW1lXS51cmwpO1xyXG4gICAgICAgIH1cclxuICAgICAgfSk7XHJcblxyXG4gICAgICAvLyAgc3R1YiBsb2FkXHJcbiAgICAgIF90aGlzLmxvYWRlci5sb2FkU3R1YihpbnB1dC5wMnBSZXF1ZXN0ZXIsIHAycENvbmZpZykudGhlbigoKSA9PiB7XHJcblxyXG4gICAgICAgIGxvZy5sb2coJ1tSZWdpc3RyeS5fc2V0dXBQMlBDb25uZWN0aW9uXSBwMnBSZXF1ZXN0ZXIgZGVwbG95ZWQ6ICcsIF90aGlzLnAycFJlcXVlc3RlclN0dWJbcmVtb3RlUnVudGltZV0pO1xyXG5cclxuXHJcbiAgICAgIH0pLmNhdGNoKChlcnJvcikgPT4ge1xyXG4gICAgICAgIHJlamVjdChlcnJvcik7XHJcbiAgICAgIH0pO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAqIFRvIHZlcmlmeSBpZiB1cmwgaXMgZm9yIGEgbGVnYWN5IHNlcnZpY2UuXHJcbiAgKiBAcGFyYW0gIHtVUkwuVVJMfSAgdXJsICAgICAgdXJsXHJcbiAgKiBAcmV0dXJuIHtib29sZWFufVxyXG4gICovXHJcbiAgaXNMZWdhY3kodXJsKSB7XHJcblxyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuXHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xyXG5cclxuICAgICAgaWYgKHVybCA9PT0gX3RoaXMuX2RvbWFpbikge1xyXG4gICAgICAgIHJldHVybiByZXNvbHZlKGZhbHNlKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgbG9nLmxvZygnW1JlZ2lzdHJ5XSBbUmVnaXN0cnkuUmVnaXN0cnkuaXNMZWdhY3ldICcsIHVybCk7XHJcblxyXG4gICAgICAvLyBUT0RPOiB0byBiZSBkZWZpbmVkIGluIHRoZSBydW50aW1lIGNvbmZpZ3VyYXRpb25cclxuICAgICAgbGV0IG5vbkxlZ2FjeSA9IFsnaHlwZXJ0eS1ydW50aW1lJywgJ2RvbWFpbicsICdnbG9iYWwnLCAnaHlwZXJ0eSddO1xyXG5cclxuICAgICAgbGV0IHVybERpdmlkZWQgPSBkaXZpZGVVUkwodXJsKTtcclxuXHJcbiAgICAgIGlmIChub25MZWdhY3kuaW5kZXhPZih1cmxEaXZpZGVkLnR5cGUpICE9PSAtMSB8fCB1cmxEaXZpZGVkLmRvbWFpbiA9PT0gX3RoaXMuX2RvbWFpbikge1xyXG4gICAgICAgIHJldHVybiByZXNvbHZlKGZhbHNlKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgLy8gcHJvY2VzcyBVc2VyIFVSTHNcclxuICAgICAgaWYgKHVybC5zcGxpdCgnQCcpLmxlbmd0aCA+IDEpIHtcclxuICAgICAgICBsZXQgZG9tYWluID0gdXJsRGl2aWRlZC5kb21haW47XHJcblxyXG4gICAgICAgIC8vIGxvZy5sb2coJ1tSZWdpc3RyeV0gW1JlZ2lzdHJ5LlJlZ2lzdHJ5LmlzTGVnYWN5XSBkb21haW46ICcsIGRvbWFpbik7XHJcbiAgICAgICAgaWYgKF90aGlzLmlkcExlZ2FjeVByb3h5TGlzdC5oYXNPd25Qcm9wZXJ0eShkb21haW4pKSB7XHJcblxyXG4gICAgICAgICAgbGV0IHJlc3VsdCA9IF90aGlzLmlkcExlZ2FjeVByb3h5TGlzdFtkb21haW5dO1xyXG5cclxuICAgICAgICAgIGlmIChyZXN1bHQuaW50ZXJ3b3JraW5nKSB7XHJcbiAgICAgICAgICAgIHJldHVybiByZXNvbHZlKHJlc3VsdC5pbnRlcndvcmtpbmcpO1xyXG4gICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgcmV0dXJuIHJlc29sdmUoZmFsc2UpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgX3RoaXMuX2xvYWRlci5kZXNjcmlwdG9ycy5nZXRJZHBQcm94eURlc2NyaXB0b3IoZG9tYWluKS50aGVuKChyZXN1bHQpID0+IHtcclxuXHJcbiAgICAgICAgICAvLyBsb2cubG9nKCdbUmVnaXN0cnldIFtSZWdpc3RyeS5SZWdpc3RyeS5pc0xlZ2FjeV0gTGVnYWN5IHN0dWIgZGVzY3JpcHRvcjogJywgcmVzdWx0KTtcclxuXHJcbiAgICAgICAgICBpZiAocmVzdWx0LmludGVyd29ya2luZykge1xyXG4gICAgICAgICAgICBfdGhpcy5pZHBMZWdhY3lQcm94eUxpc3RbZG9tYWluXSA9IHJlc3VsdDtcclxuICAgICAgICAgICAgcmVzb2x2ZShyZXN1bHQuaW50ZXJ3b3JraW5nKTtcclxuICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHJlc29sdmUoZmFsc2UpO1xyXG4gICAgICAgICAgfVxyXG5cclxuICAgICAgICB9KS5jYXRjaCgocmVhc29uKSA9PiB7XHJcbiAgICAgICAgICBsb2cud2FybigncHJvYmxlbSBsb2FkaW5nIGlkcCBwcm94eSBkZXNjcmlwdG9yIGZvciBkb21haW46JywgZG9tYWluLCAnIGJlY2F1c2UgJywgcmVhc29uKTtcclxuICAgICAgICAgIHJlamVjdChyZWFzb24pO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICB9IGVsc2UgeyAvLyBwcm9jZXNzIHByb3Rvc3R1YiBVUkxzXHJcbiAgICAgICAgcmVzb2x2ZShfdGhpcy5pc0ludGVyd29ya2luZ1Byb3RvU3R1Yih1cmwpKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAqIFRvIHZlcmlmeSBpZiBVUkwgaXMgbG9jYWxseSByZWdpc3RlcmVkIG9yIG5vdC5cclxuICAqIEBwYXJhbSAge1VSTC5VUkx9ICB1cmwgICAgICB1cmxcclxuICAqIEByZXR1cm4ge2Jvb2xlYW59XHJcbiAgKi9cclxuXHJcbiAgaXNMb2NhbCh1cmwpIHtcclxuXHJcbiAgICBsZXQgcnVudGltZVNjaGVtZSA9IFsnaHlwZXJ0eS1ydW50aW1lJywgJ3J1bnRpbWUnXTtcclxuICAgIGxldCBoeXBlcnR5U2NoZW1lID0gWydoeXBlcnR5J107XHJcbiAgICBsZXQgdXJsU2NoZW1lID0gdXJsLnNwbGl0KCc6Ly8nKVswXTtcclxuXHJcbiAgICAvLyBQcm9jZXNzIFJ1bnRpbWUgQ29yZSBVUkxzLlxyXG4gICAgLy8gTWVzc2FnZXMgb3JpZ2luYXRlZCBmcm9tIHByb3Rvc3R1YnMgc2hvdWxkIGFsc28gbm90IGluY2x1ZGUgdGhlIHJ1bnRpbWVVUkwgaW4gaXRzIFVSTC5cclxuXHJcbiAgICBpZiAocnVudGltZVNjaGVtZS5pbmRleE9mKHVybFNjaGVtZSkgIT09IC0xKSB7XHJcbiAgICAgIHJldHVybiB1cmwuaW5jbHVkZXModGhpcy5ydW50aW1lVVJMKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBQcm9jZXNzIEh5cGVydHkgVVJMc1xyXG4gICAgLy8gVG9kbzogaHlwZXJ0aWVzTGlzdCBzaG91bGQgYmUgYW4gb2JqZWN0IG5vdCBhbiBhcnJheVxyXG5cclxuICAgIGlmIChoeXBlcnR5U2NoZW1lLmluZGV4T2YodXJsU2NoZW1lKSAhPT0gLTEpIHtcclxuXHJcbiAgICAgIGZvciAobGV0IGluZGV4IGluIHRoaXMuaHlwZXJ0aWVzTGlzdCkge1xyXG4gICAgICAgIGxldCBoeXBlcnR5ID0gdGhpcy5oeXBlcnRpZXNMaXN0W2luZGV4XTtcclxuICAgICAgICBpZiAoaHlwZXJ0eS5oeXBlcnR5VVJMID09PSB1cmwpIHtcclxuICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG5cclxuICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIFByb2Nlc3MgRGF0YSBPYmplY3QgVVJMc1xyXG5cclxuICAgIGlmICh1cmwuaW5jbHVkZXMoJy9zdWJzY3JpcHRpb24nKSkge1xyXG4gICAgICB1cmwgPSB1cmwuc3Vic3RyaW5nKDAsIHVybC5pbmRleE9mKCcvc3Vic2NyaXB0aW9uJykpO1xyXG4gICAgfVxyXG5cclxuICAgIGxldCBkYXRhT2JqZWN0ID0gdGhpcy5kYXRhT2JqZWN0TGlzdFt1cmxdO1xyXG5cclxuICAgIGlmIChkYXRhT2JqZWN0KSB7XHJcbiAgICAgIGlmIChkYXRhT2JqZWN0LmludGVyd29ya2luZykge1xyXG4gICAgICAgIHJldHVybiAhZGF0YU9iamVjdC5pbnRlcndvcmtpbmc7XHJcbiAgICAgIH1cclxuICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIGZhbHNlO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgKiBUbyB2ZXJpZnkgaWYgcHJvdG9zdHViIGlzIHRvIGludGVyd29yayB3aXRoIGEgbGVnYWN5IGRvbWFpbi5cclxuICAqIEBwYXJhbSAge1VSTC5VUkx9ICBydW50aW1lUHJvdG9zdHViVVJMICAgICAgVGhlIHJ1bnRpbWUgVVJMIG9mIHRoZSBQcm90b3N0dWJcclxuICAqIEByZXR1cm4ge2Jvb2xlYW59XHJcbiAgKi9cclxuXHJcbiAgaXNJbnRlcndvcmtpbmdQcm90b1N0dWIocnVudGltZVByb3Rvc3R1YlVSTCkge1xyXG5cclxuICAgIGxldCBfdGhpcyA9IHRoaXM7XHJcblxyXG4gICAgaWYgKHR5cGVvZiBydW50aW1lUHJvdG9zdHViVVJMID09PSAnYm9vbGVhbicpIHtcclxuICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG5cclxuICAgIGlmICghKHJ1bnRpbWVQcm90b3N0dWJVUkwuaW5jbHVkZXMoJy9wcm90b3N0dWIvJykpKSB7XHJcbiAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH1cclxuXHJcbiAgICBsZXQgZmlsdGVyZWQgPSBPYmplY3Qua2V5cyhfdGhpcy5wcm90b3N0dWJzTGlzdCkuZmlsdGVyKChrZXkpID0+IHtcclxuICAgICAgcmV0dXJuIF90aGlzLnByb3Rvc3R1YnNMaXN0W2tleV0udXJsID09PSBydW50aW1lUHJvdG9zdHViVVJMO1xyXG4gICAgfSkubWFwKChrZXkpID0+IHtcclxuXHJcbiAgICAgIGlmIChfdGhpcy5wcm90b3N0dWJzTGlzdFtrZXldLmhhc093blByb3BlcnR5KCdpbnRlcndvcmtpbmcnKSkge1xyXG4gICAgICAgIHJldHVybiBfdGhpcy5wcm90b3N0dWJzTGlzdFtrZXldLmludGVyd29ya2luZztcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgIH1cclxuICAgIH0pWzBdO1xyXG5cclxuICAgIHJldHVybiBmaWx0ZXJlZDtcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBkZWZhdWx0IFJlZ2lzdHJ5O1xyXG4iLCJleHBvcnQgY29uc3QgcnVudGltZUNvbmZpZ3VyYXRpb24gPSB7XHJcblxyXG4gIC8vIFRPRE8gdGhpcyBzaG91bGQgYmUgY2hhbmdlZCB3aXRoIHRoZSBkZWZpbml0aW9uIHVzZWQgZm9yIGluZGV4ZWRkYlxyXG4gIC8vIGxvb2sgYXQ6IGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuLVVTL2RvY3MvV2ViL0FQSS9JREJPYmplY3RTdG9yZVxyXG4gIC8vIE5vdyB3ZSBhcmUgdXNpbmcgdGhlIGRlZmluaXRpb24gZm9yIERleGllOyAoaHR0cDovL2RleGllLm9yZy9kb2NzL1ZlcnNpb24vVmVyc2lvbi5zdG9yZXMoKSlcclxuICBzdG9yYWdlU2NoZW1hczoge1xyXG4gICAgY2FwYWJpbGl0aWVzOiB7XHJcbiAgICAgIGNhcGFiaWxpdGllczogJ2tleSx2ZXJzaW9uLHZhbHVlJ1xyXG4gICAgfSxcclxuICAgIHN1YnNjcmlwdGlvbnM6IHtcclxuICAgICAgc3Vic2NyaXB0aW9uczogJ2tleSx2ZXJzaW9uLHZhbHVlJ1xyXG4gICAgfSxcclxuICAgIHJ1bnRpbWU6IHtcclxuICAgICAgJ3J1bnRpbWU6VVJMJzogJ2tleSx2ZXJzaW9uLHZhbHVlJyxcclxuICAgICAgJ3AycEhhbmRsZXI6VVJMJzogJ2tleSx2ZXJzaW9uLHZhbHVlJ1xyXG4gICAgfSxcclxuICAgIHJlZ2lzdHJ5OiB7XHJcbiAgICAgICdyZWdpc3RyeTpEYXRhT2JqZWN0VVJMcyc6ICdrZXksdmVyc2lvbix2YWx1ZScsXHJcbiAgICAgICdyZWdpc3RyeTpIeXBlcnR5VVJMcyc6ICdrZXksdmVyc2lvbix2YWx1ZSdcclxuICAgIH0sXHJcbiAgICBjcnlwdG9NYW5hZ2VyOiB7XHJcbiAgICAgIHVzZXJBc3ltbWV0cmljS2V5OiAna2V5LHZlcnNpb24sdmFsdWUnLFxyXG4gICAgICBkYXRhT2JqZWN0U2Vzc2lvbktleXM6ICdrZXksdmVyc2lvbix2YWx1ZSdcclxuICAgIH0sXHJcbiAgICBpZGVudGl0eToge1xyXG4gICAgICBhY2Nlc3NUb2tlbnM6ICdrZXksdmVyc2lvbix2YWx1ZScsXHJcbiAgICAgIGlkZW50aXRpZXM6ICd1c2VyVVJMLCB1c2VyUHJvZmlsZS5lbWFpbCwgdXNlclByb2ZpbGUudXNlclVSTCwgdXNlclByb2ZpbGUubmFtZSdcclxuICAgIH0sXHJcbiAgICBydW50aW1lQ2F0YWxvZ3VlOiB7XHJcbiAgICAgIHJ1bnRpbWVDYXRhbG9ndWU6ICcmY2d1aWQsIGFjY2Vzc0NvbnRyb2xQb2xpY3ksIGNvbnN0cmFpbnRzLCBkYXRhT2JqZWN0cywgdHlwZSwgb2JqZWN0TmFtZSwgc291cmNlUGFja2FnZSwgdmVyc2lvbiwgdXJsJ1xyXG4gICAgfSxcclxuICAgIHBvbGljeToge1xyXG4gICAgICAncmV0aGluazphY3RpdmVQb2xpY3knOiAna2V5LHZlcnNpb24sdmFsdWUnLFxyXG4gICAgICAncmV0aGluazpncm91cHMnOiAna2V5LHZlcnNpb24sdmFsdWUnLFxyXG4gICAgICAncmV0aGluazp1c2VyUG9saWNpZXMnOiAna2V5LHZlcnNpb24sdmFsdWUnLFxyXG4gICAgICAncmV0aGluazpzcFBvbGljaWVzJzogJ2tleSx2ZXJzaW9uLHZhbHVlJ1xyXG4gICAgfSxcclxuICAgIHN5bmNoZXJNYW5hZ2VyOiB7XHJcbiAgICAgICdzeW5jaGVyTWFuYWdlcjpPYmplY3RVUkxzJzogJ2tleSx2ZXJzaW9uLHZhbHVlJyxcclxuICAgICAgJ3JlbW90ZXMnOiAna2V5LHZlcnNpb24sdmFsdWUnXHJcbiAgICB9LFxyXG4gICAgaHlwZXJ0eVJlc291cmNlczoge1xyXG4gICAgICBoeXBlcnR5UmVzb3VyY2VzOiAnJnJlc291cmNlVVJMLCBuYW1lLCBjb250ZW50VXJsLCBjb250ZW50LCBjcmVhdGVkLCByZXBvcnRlciwgcmVzb3VyY2VUeXBlJ1xyXG4gICAgfVxyXG4gIH0sXHJcblxyXG4gIHJ1bnRpbWVVUkxTOiB7XHJcbiAgICByZWdpc3RyeToge1xyXG4gICAgICBwcmVmaXg6ICdoeXBlcnR5LXJ1bnRpbWU6Ly8nLFxyXG4gICAgICBzdWZmaXg6ICdyZWdpc3RyeSdcclxuICAgIH0sXHJcbiAgICBpZGVudGl0eU1vZHVsZToge1xyXG4gICAgICBwcmVmaXg6ICdoeXBlcnR5LXJ1bnRpbWU6Ly8nLFxyXG4gICAgICBzdWZmaXg6ICcvaWRtJ1xyXG4gICAgfSxcclxuICAgIHJ1bnRpbWVVQToge1xyXG4gICAgICBwcmVmaXg6ICdoeXBlcnR5LXJ1bnRpbWU6Ly8nLFxyXG4gICAgICBzdWZmaXg6ICcvdWEnXHJcbiAgICB9LFxyXG4gICAgY2F0YWxvZ3VlOiB7XHJcbiAgICAgIHByZWZpeDogJ2h5cGVydHktcnVudGltZTovLycsXHJcbiAgICAgIHN1ZmZpeDogJy9jYXRhbG9ndWUnXHJcbiAgICB9LFxyXG4gICAgZ3JhcGhDb25uZWN0b3I6IHtcclxuICAgICAgcHJlZml4OiAnaHlwZXJ0eS1ydW50aW1lOi8vJyxcclxuICAgICAgc3VmZml4OiAnL2dyYXBoJ1xyXG4gICAgfSxcclxuICAgIHN5bmNNYW5hZ2VyOiB7XHJcbiAgICAgIHByZWZpeDogJ2h5cGVydHktcnVudGltZTovLycsXHJcbiAgICAgIHN1ZmZpeDogJy9zbSdcclxuICAgIH1cclxuICB9LFxyXG4gIGNhdGFsb2d1ZVVSTHM6IHtcclxuICAgIHByb3RvY29sc3R1Yjoge1xyXG4gICAgICBwcmVmaXg6ICdodHRwczovLycsXHJcbiAgICAgIHN1ZmZpeDogJzo4MDgwLy53ZWxsLWtub3duL3Byb3RvY29sc3R1Yi8nLFxyXG4gICAgICBmYWxsYmFjazogJ2h0dHBzOi8vJWRvbWFpbiU6ODA4MC8ud2VsbC1rbm93bi9wcm90b2NvbHN0dWIvJ1xyXG4gICAgfSxcclxuICAgICdpZHAtcHJveHknOiB7XHJcbiAgICAgIHByZWZpeDogJ2h0dHBzOi8vJyxcclxuICAgICAgc3VmZml4OiAnOjgwODAvLndlbGwta25vd24vaWRwLXByb3h5LycsXHJcbiAgICAgIGZhbGxiYWNrOiAnaHR0cHM6Ly8lZG9tYWluJTo4MDgwLy53ZWxsLWtub3duL2lkcC1wcm94eS8nXHJcbiAgICB9XHJcbiAgfSxcclxuICBtc2dOb2RlVVJMOiB7XHJcbiAgICBwcmVmaXg6ICdkb21haW46Ly9tc2ctbm9kZS4nLFxyXG4gICAgc3VmZml4OiAnJyxcclxuICAgIGh5cGVydHlBZGRyZXNzQWxsb2NhdGlvbjogJy9oeXBlcnR5LWFkZHJlc3MtYWxsb2NhdGlvbicsXHJcbiAgICBvYmplY3RBZGRyZXNzQWxsb2NhdGlvbjogJy9vYmplY3QtYWRkcmVzcy1hbGxvY2F0aW9uJyxcclxuICAgIHN1YnNjcmlwdGlvbk1hbmFnZW1lbnQ6ICcvc20nXHJcbiAgfSxcclxuICBkb21haW5SZWdpc3RyeVVSTDoge1xyXG4gICAgcHJlZml4OiAnZG9tYWluOi8vcmVnaXN0cnkuJyxcclxuICAgIHN1ZmZpeDogJydcclxuICB9LFxyXG4gIGdsb2JhbFJlZ2lzdHJ5VVJMOiAnZ2xvYmFsOi8vcmVnaXN0cnkuJyxcclxuICByZW1vdGVTdG9yYWdlOiAnaHR0cHM6Ly9hZG1pbjphZG1pbkBiYWNrdXAucmV0aGluay5hbHRpY2VsYWJzLmNvbSdcclxufTtcclxuIiwiLy8gTG9nIFN5c3RlbVxyXG5pbXBvcnQgKiBhcyBsb2dnZXIgZnJvbSAnbG9nbGV2ZWwnO1xyXG5sZXQgbG9nID0gbG9nZ2VyLmdldExvZ2dlcignSWRlbnRpdHlNb2R1bGUnKTtcclxuXHJcbmltcG9ydCB7IGRlY29kZSwgc2Vjb25kc1NpbmNlRXBvY2gsIGRlZXBDbG9uZSB9IGZyb20gJy4uL3V0aWxzL3V0aWxzLmpzJztcclxuaW1wb3J0IHsgV2F0Y2hpbmdZb3UgfSBmcm9tICcuLi9VdGlscyc7XHJcblxyXG5cclxuLyoqXHJcbiogVGhlIElkZW50aXR5IERhdGEgTW9kZWwgaXMgdXNlZCB0byBtb2RlbCB0aGUgcmVUSElOSyBVc2VyIGVudGl0eS4gVGhlIElkZW50aXR5IGRhdGEgbW9kZWwgaXMgaGFuZGxlZCBieSBJZGVudGl0eSBNYW5hZ2VtZW50IGZ1bmN0aW9uYWxpdHkuXHJcbipcclxuKi9cclxuY2xhc3MgSWRlbnRpdGllcyB7XHJcblxyXG4gIGNvbnN0cnVjdG9yKHR5cGUsIHN0b3JhZ2VNYW5hZ2VyKSB7XHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG5cclxuICAgIF90aGlzLl93YXRjaGluZ1lvdSA9IG5ldyBXYXRjaGluZ1lvdSgpO1xyXG5cclxuICAgIF90aGlzLl9zdG9yYWdlTWFuYWdlciA9IHN0b3JhZ2VNYW5hZ2VyO1xyXG4gICAgX3RoaXMuX2d1aWQ7XHJcbiAgICBfdGhpcy5fdHlwZSA9IHR5cGU7XHJcbiAgICBfdGhpcy5faWRlbnRpdGllcyA9IHt9O1xyXG4gICAgX3RoaXMuX2FjY2Vzc1Rva2VucyA9IF90aGlzLndhdGNoaW5nWW91LndhdGNoKCdhY2Nlc3NUb2tlbnMnLCB7fSwgdHJ1ZSk7XHJcblxyXG4gIH1cclxuXHJcbiAgcmVzZXQoKSB7XHJcbiAgICB0aGlzLl9pZGVudGl0aWVzID0ge307XHJcbiAgICBjb25zb2xlLmxvZyh0aGlzKTtcclxuICAgIHRoaXMuY3VycmVudElkZW50aXR5ID0gdW5kZWZpbmVkO1xyXG4gICAgdGhpcy5kZWZhdWx0SWRlbnRpdHkgPSB1bmRlZmluZWQ7XHJcbiAgfVxyXG5cclxuICBnZXQgaWRlbnRpdGllcygpIHtcclxuICAgIHJldHVybiB0aGlzLl9pZGVudGl0aWVzO1xyXG4gIH1cclxuXHJcbiAgZ2V0IGFjY2Vzc1Rva2VucygpIHtcclxuICAgIHJldHVybiB0aGlzLl9hY2Nlc3NUb2tlbnM7XHJcbiAgfVxyXG5cclxuICBnZXQgd2F0Y2hpbmdZb3UoKSB7XHJcbiAgICByZXR1cm4gdGhpcy5fd2F0Y2hpbmdZb3U7XHJcbiAgfVxyXG5cclxuICBzZXQgZ3VpZChndWlkKSB7XHJcbiAgICB0aGlzLl9ndWlkID0gZ3VpZDtcclxuICB9XHJcblxyXG4gIGdldCBndWlkKCkge1xyXG4gICAgcmV0dXJuIHRoaXMuX2d1aWQ7XHJcbiAgfVxyXG5cclxuICBzZXQgZGVmYXVsdElkZW50aXR5KGlkZW50aWZpZXIpIHtcclxuICAgIGlmICh0aGlzLmlkZW50aXRpZXNbaWRlbnRpZmllcl0pIHRoaXMuX2RlZmF1bHRJZGVudGl0eSA9IGlkZW50aWZpZXI7XHJcbiAgICBlbHNlIHRocm93IG5ldyBFcnJvcignW0lkZW50aXRpZXMuc2V0IGRlZmF1bHRJZGVudGl0eSBdIEVycm9yOiBpZGVudGl0eSBkb2VzIG5vdCBleGlzdCBoZXJlOiAnLCBpZGVudGlmaWVyKTtcclxuICB9XHJcblxyXG4gIHNldCBjdXJyZW50SWRlbnRpdHkoaWRlbnRpZmllcikge1xyXG4gICAgaWYgKHRoaXMuaWRlbnRpdGllc1tpZGVudGlmaWVyXSkgdGhpcy5fY3VycmVudElkZW50aXR5ID0gaWRlbnRpZmllcjtcclxuICAgIGVsc2UgdGhyb3cgJ1tJZGVudGl0aWVzLnNldCBjdXJyZW50SWRlbnRpdHkgXSBFcnJvcjogaWRlbnRpdHkgZG9lcyBub3QgZXhpc3QgaGVyZTogJywgaWRlbnRpZmllcjtcclxuICB9XHJcblxyXG4gIGdldCBkZWZhdWx0SWRlbnRpdHkoKSB7XHJcbiAgICBpZiAodGhpcy5fZGVmYXVsdElkZW50aXR5KSByZXR1cm4gT2JqZWN0LmFzc2lnbih7fSwgdGhpcy5pZGVudGl0aWVzW3RoaXMuX2RlZmF1bHRJZGVudGl0eV0pO1xyXG4gICAgZWxzZSByZXR1cm4gZmFsc2U7XHJcbiAgfVxyXG5cclxuICBnZXQgY3VycmVudElkZW50aXR5KCkge1xyXG4gICAgcmV0dXJuIE9iamVjdC5hc3NpZ24oe30sIHRoaXMuaWRlbnRpdGllc1t0aGlzLl9jdXJyZW50SWRlbnRpdHldKTtcclxuICB9XHJcblxyXG4gIGdldCBpZGVudGlmaWVycygpIHtcclxuICAgIHJldHVybiBPYmplY3Qua2V5cyh0aGlzLl9pZGVudGl0aWVzKTtcclxuICB9XHJcblxyXG4gIGdldElkZW50aXR5KGlkZW50aWZpZXIpIHtcclxuICAgIHJldHVybiBPYmplY3QuYXNzaWduKHt9LCB0aGlzLl9pZGVudGl0aWVzW2lkZW50aWZpZXJdKTtcclxuICB9XHJcblxyXG4gIGxvYWRJZGVudGl0aWVzKCkge1xyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4ge1xyXG5cclxuICAgICAgX3RoaXMuX3N0b3JhZ2VNYW5hZ2VyLmdldChudWxsLCBudWxsLCAnaWRlbnRpdGllcycpLnRoZW4oKGlkZW50aXRpZXMpID0+IHtcclxuXHJcbiAgICAgICAgbG9nLmluZm8oJ1tJZGVudGl0aWVzLkxvYWQgSWRlbnRpdGllc10gaWRlbnRpdGllczogJywgaWRlbnRpdGllcyk7XHJcblxyXG4gICAgICAgIGlmIChpZGVudGl0aWVzKSB7XHJcbiAgICAgICAgICBfdGhpcy5faWRlbnRpdGllcyA9IGlkZW50aXRpZXM7XHJcblxyXG4gICAgICAgICAgLy8gbGV0J3Mgc2V0IGFzIGRlZmF1bHQgaWRlbnRpdHkgdGhlIG9uZSB0aGF0IGV4cGlyZXMgbGF0ZXJcclxuXHJcbiAgICAgICAgICBfdGhpcy5pZGVudGlmaWVycy5mb3JFYWNoKChpZCkgPT4ge1xyXG4gICAgICAgICAgICBsZXQgdGltZU5vdyA9IHNlY29uZHNTaW5jZUVwb2NoKCk7XHJcbiAgICAgICAgICAgIGxldCBpZGVudGl0eSA9IF90aGlzLl9pZGVudGl0aWVzW2lkXTtcclxuICAgICAgICAgICAgbGV0IGV4cGlyZXMgPSBpZGVudGl0eS5leHBpcmVzO1xyXG5cclxuICAgICAgICAgICAgLy8gICAgICAgICAgICBpZiAoIWlkZW50aXR5Lmhhc093blByb3BlcnR5KCdpbnRlcndvcmtpbmcnKVxyXG4gICAgICAgICAgICAvLyAgICAgICAgICAgIHx8ICFpZGVudGl0eS5pbnRlcndvcmtpbmcpIHtcclxuICAgICAgICAgICAgX3RoaXMuZGVmYXVsdElkZW50aXR5ID0gaWQ7XHJcblxyXG4gICAgICAgICAgICBpZiAocGFyc2VJbnQoZXhwaXJlcykgPiB0aW1lTm93KSB7XHJcbiAgICAgICAgICAgICAgX3RoaXMuZGVmYXVsdElkZW50aXR5LmV4cGlyZXMgPSBwYXJzZUludChleHBpcmVzKTtcclxuICAgICAgICAgICAgICBfdGhpcy5jdXJyZW50SWRlbnRpdHkgPSBpZDtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmVzb2x2ZSgpO1xyXG4gICAgICB9KTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgbG9hZEFjY2Vzc1Rva2VucygpIHtcclxuICAgIGxldCBfdGhpcyA9IHRoaXM7XHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHtcclxuXHJcbiAgICAgIF90aGlzLl9zdG9yYWdlTWFuYWdlci5nZXQoJ2FjY2Vzc1Rva2VucycpLnRoZW4oKGFjY2Vzc1Rva2VucykgPT4ge1xyXG5cclxuICAgICAgICBpZiAoYWNjZXNzVG9rZW5zKSBfdGhpcy5fYWNjZXNzVG9rZW5zID0gYWNjZXNzVG9rZW5zO1xyXG4gICAgICAgIHJlc29sdmUoKTtcclxuICAgICAgfSk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8vIHRvIGNvbmZpcm0gaWYgdGhpcyBmdW5jdGlvbiBpcyByZXF1aXJlZCB3aGVuIHRoZSBBcHAgY29uc3RyYWludHMgdGhlIGlkZW50aXR5IHNlbGVjdGlvblxyXG5cclxuICBhZGRJZGVudGl0eShpZGVudGl0eSkge1xyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuXHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xyXG4gICAgICBpZiAoX3RoaXMuX2lzVmFsaWQoaWRlbnRpdHkpKSB7XHJcbiAgICAgICAgbGV0IGlkID0gaWRlbnRpdHkuaWRlbnRpZmllcnNbMF07XHJcbiAgICAgICAgT2JqZWN0LmFzc2lnbih0aGlzLl9pZGVudGl0aWVzW2lkXSwgaWRlbnRpdHkpO1xyXG4gICAgICAgIHRoaXMuX3N0b3JlSWRlbnRpdHkoaWRlbnRpdHkpLnRoZW4oKCkgPT4ge1xyXG4gICAgICAgICAgdGhpcy5faWRlbnRpdGllc1tpZF0uc3RhdHVzID0gJ2NyZWF0ZWQnO1xyXG4gICAgICAgICAgcmVzb2x2ZSgpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICB9IGVsc2UgeyByZWplY3QoJ1tJZGVudGl0aWVzLmFkZElkZW50aXR5XSBpbnZhbGlkIElkQXNzZXJ0aW9uJyk7IH1cclxuICAgIH0pO1xyXG5cclxuICB9XHJcblxyXG4gIGFkZEFzc2VydGlvbihhc3NlcnRpb24pIHtcclxuICAgIGxldCBfdGhpcyA9IHRoaXM7XHJcblxyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcclxuICAgICAgaWYgKF90aGlzLl9pc1ZhbGlkKGFzc2VydGlvbikpIHtcclxuICAgICAgICBhc3NlcnRpb24udXNlclByb2ZpbGUuZ3VpZCA9IF90aGlzLl9ndWlkO1xyXG4gICAgICAgIGxldCB1c2VyVXJsID0gYXNzZXJ0aW9uLnVzZXJQcm9maWxlLnVzZXJVUkw7XHJcbiAgICAgICAgaWYgKCFfdGhpcy5pZGVudGl0aWVzW3VzZXJVcmxdKSBfdGhpcy5faWRlbnRpdGllc1t1c2VyVXJsXSA9IGFzc2VydGlvbjtcclxuICAgICAgICBlbHNlIF90aGlzLmlkZW50aXRpZXNbdXNlclVybF0gPSBhc3NlcnRpb247XHJcblxyXG4gICAgICAgIF90aGlzLl9zdG9yZSgpLnRoZW4oKCkgPT4ge1xyXG4gICAgICAgICAgdGhpcy5faWRlbnRpdGllc1t1c2VyVXJsXS5zdGF0dXMgPSAnY3JlYXRlZCc7XHJcbiAgICAgICAgICBpZiAoX3RoaXMuZGVmYXVsdElkZW50aXR5ID09IGZhbHNlKSB7XHJcbiAgICAgICAgICAgIF90aGlzLmRlZmF1bHRJZGVudGl0eSA9IHVzZXJVcmw7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICByZXNvbHZlKGFzc2VydGlvbik7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH0gZWxzZSB7IHJlamVjdCgnW0lkZW50aXRpZXMuYWRkQXNzZXJ0aW9uXSBpbnZhbGlkIElkQXNzZXJ0aW9uOiAnLCBhc3NlcnRpb24pOyB9XHJcbiAgICB9KTtcclxuXHJcbiAgfVxyXG5cclxuICByZW1vdmVJZGVudGl0eSh1c2VyVXJsKSB7XHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG5cclxuXHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xyXG4gICAgICBkZWxldGUgX3RoaXMuaWRlbnRpdGllc1t1c2VyVXJsXTtcclxuXHJcbiAgICAgIF90aGlzLl9zdG9yZSgpLnRoZW4oKCkgPT4ge1xyXG4gICAgICAgIHJlc29sdmUoKTtcclxuICAgICAgfSk7XHJcblxyXG4gICAgfSk7XHJcblxyXG4gIH1cclxuXHJcbiAgYWRkQWNjZXNzVG9rZW4oYWNjZXNzVG9rZW4pIHtcclxuICAgIGxldCBfdGhpcyA9IHRoaXM7XHJcbiAgICBsb2cuaW5mbygnW0lkZW50aXRpZXMuYWRkQWNjZXNzVG9rZW5dICcsIGFjY2Vzc1Rva2VuKTtcclxuXHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xyXG5cclxuICAgICAgaWYgKF90aGlzLl9pc1ZhbGlkQWNjZXNzVG9rZW4oYWNjZXNzVG9rZW4pKSB7XHJcblxyXG4gICAgICAgIC8vICAgICAgICBsZXQgbmV3QWNjZXNzVG9rZW4gPSBkZWVwQ2xvbmUoYWNjZXNzVG9rZW4pO1xyXG5cclxuICAgICAgICBfdGhpcy5fYWNjZXNzVG9rZW5zW2FjY2Vzc1Rva2VuLmRvbWFpbl0gPSBhY2Nlc3NUb2tlbjtcclxuXHJcbiAgICAgICAgX3RoaXMuX3N0b3JlQWNjZXNzVG9rZW5zKCkudGhlbigoKSA9PiB7XHJcbiAgICAgICAgICBfdGhpcy5fYWNjZXNzVG9rZW5zW2FjY2Vzc1Rva2VuLmRvbWFpbl0uc3RhdHVzID0gJ2NyZWF0ZWQnO1xyXG4gICAgICAgICAgcmVzb2x2ZShhY2Nlc3NUb2tlbik7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH0gZWxzZSB7IHJlamVjdCgnW0lkZW50aXRpZXMuYWRkSWRlbnRpdHldIGludmFsaWQgQWNjZXNzVG9rZW46ICcsIGFjY2Vzc1Rva2VuKTsgfVxyXG4gICAgfSk7XHJcblxyXG4gIH1cclxuXHJcbiAgc2V0QWNjZXNzVG9rZW5JblByb2dyZXNzKGRvbWFpbikge1xyXG5cclxuICAgIGlmICh0aGlzLl9hY2Nlc3NUb2tlbnNbZG9tYWluXSkgdGhpcy5fYWNjZXNzVG9rZW5zW2RvbWFpbl0uc3RhdHVzID0gJ2luLXByb2dyZXNzJztcclxuICAgIGVsc2UgdGhpcy5fYWNjZXNzVG9rZW5zW2RvbWFpbl0gPSB7IHN0YXR1czogJ2luLXByb2dyZXNzJyB9O1xyXG4gIH1cclxuXHJcbiAgZ2V0QWNjZXNzVG9rZW4oZG9tYWluLCByZXNvdXJjZXMpIHtcclxuICAgIGxldCBhY2Nlc3NUb2tlbiA9IHRoaXMuX2FjY2Vzc1Rva2Vuc1tkb21haW5dO1xyXG5cclxuICAgIGlmICghYWNjZXNzVG9rZW4pIHsgcmV0dXJuIHVuZGVmaW5lZDsgfSBlbHNlIGlmIChcclxuICAgICAgcmVzb3VyY2VzLmV2ZXJ5KChpKSA9PiB7IHJldHVybiBhY2Nlc3NUb2tlbi5yZXNvdXJjZXMuaW5kZXhPZihpKSAhPSAtMTsgfSkpIHsgcmV0dXJuIHRoaXMuX2FjY2Vzc1Rva2Vuc1tkb21haW5dOyB9IGVsc2UgeyByZXR1cm4gbmV3IEVycm9yKCdbSWRlbnRpdGllcy5nZXRBY2Nlc3NUb2tlbl0gTm90IGZvdW5kIGZvciAnLCBkb21haW4pOyB9XHJcblxyXG4gIH1cclxuXHJcbiAgcmVtb3ZlQWNjZXNzVG9rZW4oZG9tYWluLCByZXNvdXJjZXMpIHtcclxuICAgIGxldCBfdGhpcyA9IHRoaXM7XHJcblxyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7XHJcbiAgICAgIGxldCBhY2Nlc3NUb2tlbiA9IHRoaXMuX2FjY2Vzc1Rva2Vuc1tkb21haW5dO1xyXG5cclxuICAgICAgaWYgKCFhY2Nlc3NUb2tlbikgeyByZXNvbHZlKCk7IH0gZWxzZSBpZiAoXHJcbiAgICAgICAgcmVzb3VyY2VzLmV2ZXJ5KChpKSA9PiB7IFxyXG4gICAgICAgICAgcmV0dXJuIGFjY2Vzc1Rva2VuLnJlc291cmNlcy5pbmRleE9mKGkpICE9IC0xOyBcclxuICAgICAgICB9KSkge1xyXG4gICAgICAgICAgIGRlbGV0ZSB0aGlzLl9hY2Nlc3NUb2tlbnNbZG9tYWluXTsgXHJcbiAgICAgICAgICAgX3RoaXMuX3N0b3JlQWNjZXNzVG9rZW5zKCkudGhlbigoKSA9PiB7XHJcbiAgICAgICAgICAgIHJlc29sdmUoKTtcclxuICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgfSBlbHNlIHsgXHJcbiAgICAgICAgICAgIHJlc29sdmUoKTtcclxuICAgICAgICAgIH1cclxuICBcclxuICAgIH0pO1xyXG5cclxuXHJcbiAgfVxyXG5cclxuICB1cGRhdGVBc3NlcnRpb24oYXNzZXJ0aW9uKSB7XHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG5cclxuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4ge1xyXG4gICAgICBsZXQgdXNlclVybCA9IGFzc2VydGlvbi51c2VyUHJvZmlsZS51c2VyVVJMO1xyXG5cclxuICAgICAgaWYgKCFfdGhpcy5pZGVudGl0aWVzW3VzZXJVcmxdKSB7IHJldHVybiByZWplY3QoJ1tJZGVudGl0aWVzLnVwZGF0ZUFzc2VydGlvbl0gSWRlbnRpdHkgbm90IGZvdW5kIGZvciAnLCB1c2VyVXJsKTsgfSBlbHNlIHtcclxuICAgICAgICBfdGhpcy5pZGVudGl0aWVzW3VzZXJVcmxdID0gYXNzZXJ0aW9uO1xyXG4gICAgICAgIF90aGlzLl9zdG9yZSgpLnRoZW4oKCkgPT4ge1xyXG4gICAgICAgICAgcmVzb2x2ZSgpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICB9XHJcblxyXG4gICAgfSk7XHJcblxyXG4gIH1cclxuXHJcbiAgdXBkYXRlQWNjZXNzVG9rZW4oYWNjZXNzVG9rZW4pIHtcclxuICAgIGxldCBfdGhpcyA9IHRoaXM7XHJcbiAgICBsb2cuaW5mbygnW0lkZW50aXRpZXMudXBkYXRlQWNjZXNzVG9rZW5dICcsIGFjY2Vzc1Rva2VuKTtcclxuXHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xyXG5cclxuICAgICAgaWYgKF90aGlzLl9pc1ZhbGlkQWNjZXNzVG9rZW4oYWNjZXNzVG9rZW4pKSB7XHJcblxyXG4gICAgICAgIF90aGlzLl9hY2Nlc3NUb2tlbnNbYWNjZXNzVG9rZW4uZG9tYWluXS5leHBpcmVzID0gYWNjZXNzVG9rZW4uZXhwaXJlcztcclxuICAgICAgICBfdGhpcy5fYWNjZXNzVG9rZW5zW2FjY2Vzc1Rva2VuLmRvbWFpbl0uYWNjZXNzVG9rZW4gPSBhY2Nlc3NUb2tlbi5hY2Nlc3NUb2tlbjtcclxuXHJcbiAgICAgICAgX3RoaXMuX3N0b3JlQWNjZXNzVG9rZW5zKCkudGhlbigoKSA9PiB7XHJcbiAgICAgICAgICBfdGhpcy5fYWNjZXNzVG9rZW5zW2FjY2Vzc1Rva2VuLmRvbWFpbl0uc3RhdHVzID0gJ2NyZWF0ZWQnO1xyXG4gICAgICAgICAgcmVzb2x2ZShhY2Nlc3NUb2tlbik7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH0gZWxzZSB7IHJlamVjdCgnW0lkZW50aXRpZXMudXBkYXRlQWNjZXNzVG9rZW5dIGludmFsaWQgQWNjZXNzVG9rZW46ICcsIGFjY2Vzc1Rva2VuKTsgfVxyXG4gICAgfSk7XHJcblxyXG4gIH1cclxuXHJcbiAgYWRkSWRBc3NlcnRpb24oaWRlbnRpZmllciwgYXNzZXJ0aW9uLCBpZHAsIHNjb3BlKSB7XHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG5cclxuICAgIGxldCBuZXdJZEFzc2VydGlvbiA9IG5ldyBJZEFzc2VydGlvbihhc3NlcnRpb24sIGlkcCwgc2NvcGUpO1xyXG5cclxuICAgIF90aGlzLmlkQXNzZXJ0aW9uTGlzdC5wdXNoKG5ld0lkQXNzZXJ0aW9uKTtcclxuICB9XHJcblxyXG4gIC8vVE9ETzogY29tcGxldGUgd2l0aCBtb3JlIHZlcmlmaWNhdGlvbnMuIFRvIGJlIG1vdmVkIHRvIElkZW50aXR5P1xyXG5cclxuICBfaXNWYWxpZChpZGVudGl0eSkge1xyXG4gICAgaWYgKCFpZGVudGl0eS5oYXNPd25Qcm9wZXJ0eSgnYXNzZXJ0aW9uJykpIHtcclxuICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG5cclxuICAgIGxldCBzcGxpdGVkQXNzZXJ0aW9uID0gaWRlbnRpdHkuYXNzZXJ0aW9uLnNwbGl0KCcuJyk7XHJcbiAgICBsZXQgYXNzZXJ0aW9uUGFyc2VkO1xyXG5cclxuICAgIC8vdmVyaWZ5IGlmIHRoZSB0b2tlbiBjb250YWlucyB0aGUgMyBjb21wb25lbnRzLCBvciBqdXN0IHRoZSBhc3NlcnRpb25cclxuICAgIHRyeSB7XHJcbiAgICAgIGlmIChzcGxpdGVkQXNzZXJ0aW9uWzFdKSB7XHJcbiAgICAgICAgYXNzZXJ0aW9uUGFyc2VkID0gZGVjb2RlKHNwbGl0ZWRBc3NlcnRpb25bMV0pO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGFzc2VydGlvblBhcnNlZCA9IGRlY29kZShpZGVudGl0eS5hc3NlcnRpb24pO1xyXG4gICAgICB9XHJcbiAgICB9IGNhdGNoIChlcnIpIHtcclxuICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG5cclxuXHJcbiAgICByZXR1cm4gdHJ1ZTtcclxuXHJcbiAgfVxyXG5cclxuICBfaXNWYWxpZEFjY2Vzc1Rva2VuKGFjY2Vzc1Rva2VuKSB7XHJcblxyXG4gICAgaWYgKCFhY2Nlc3NUb2tlbi5oYXNPd25Qcm9wZXJ0eSgnYWNjZXNzVG9rZW4nKSkge1xyXG4gICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKCFhY2Nlc3NUb2tlbi5oYXNPd25Qcm9wZXJ0eSgnZG9tYWluJykpIHtcclxuICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG5cclxuICAgIGlmICghKGFjY2Vzc1Rva2VuLmhhc093blByb3BlcnR5KCdyZXNvdXJjZXMnKSAmJiBBcnJheS5pc0FycmF5KGFjY2Vzc1Rva2VuLnJlc291cmNlcykpKSB7XHJcbiAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH1cclxuXHJcblxyXG4gICAgaWYgKCEoYWNjZXNzVG9rZW4uaGFzT3duUHJvcGVydHkoJ2V4cGlyZXMnKSAmJiBOdW1iZXIuaXNJbnRlZ2VyKGFjY2Vzc1Rva2VuLmV4cGlyZXMpKSkge1xyXG4gICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKCFhY2Nlc3NUb2tlbi5oYXNPd25Qcm9wZXJ0eSgnaW5wdXQnKSkge1xyXG4gICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHRydWU7XHJcblxyXG4gIH1cclxuXHJcbiAgLy9UT0RPOiBhZGQgZnVuY3Rpb24gdG8gb25seSBzZXQgb25lIG5ldyBpZGVudGl0eSB1c2luZyB0aGUgbmV3IGluZGV4ZWQgc3RvcmFnZSBtYW5hZ2VyXHJcblxyXG4gIF9zdG9yZSgpIHtcclxuICAgIGxldCBfdGhpcyA9IHRoaXM7XHJcblxyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcclxuXHJcbiAgICAgIGNvbnN0IHN0b3JlID0gT2JqZWN0LmtleXModGhpcy5faWRlbnRpdGllcykubWFwKCh1c2VyVVJMKSA9PiB7XHJcbiAgICAgICAgcmV0dXJuIF90aGlzLl9zdG9yYWdlTWFuYWdlci5zZXQodXNlclVSTCwgMCwgdGhpcy5faWRlbnRpdGllc1t1c2VyVVJMXSwgJ2lkZW50aXRpZXMnKTtcclxuICAgICAgfSk7XHJcblxyXG4gICAgICBQcm9taXNlLmFsbChzdG9yZSkudGhlbigoKSA9PiB7XHJcbiAgICAgICAgcmVzb2x2ZSgpO1xyXG4gICAgICB9KS5jYXRjaChlcnIgPT4ge1xyXG4gICAgICAgIHJlamVjdCgnT24gX3NlbmRSZXBvcnRlclNlc3Npb25LZXkgZnJvbSBtZXRob2Qgc3RvcmVJZGVudGl0eSBlcnJvcjogJyArIGVycik7XHJcbiAgICAgIH0pO1xyXG5cclxuICAgIH0pO1xyXG4gIH1cclxuICBfc3RvcmVBY2Nlc3NUb2tlbnMoKSB7XHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG5cclxuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XHJcblxyXG4gICAgICBsZXQgYWNjZXNzVG9rZW5zID0gZGVlcENsb25lKF90aGlzLl9hY2Nlc3NUb2tlbnMpO1xyXG5cclxuICAgICAgX3RoaXMuX3N0b3JhZ2VNYW5hZ2VyLnNldCgnYWNjZXNzVG9rZW5zJywgMCwgYWNjZXNzVG9rZW5zKS50aGVuKCgpID0+IHtcclxuICAgICAgICByZXNvbHZlKCk7XHJcbiAgICAgIH0pLmNhdGNoKGVyciA9PiB7XHJcbiAgICAgICAgcmVqZWN0KCdPbiBfc2VuZFJlcG9ydGVyU2Vzc2lvbktleSBmcm9tIG1ldGhvZCBzdG9yZUlkZW50aXR5IGVycm9yOiAnICsgZXJyKTtcclxuICAgICAgfSk7XHJcblxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxufVxyXG5cclxuLy8gbW92ZSB0byBJZGVudGl0eSBzZXJ2aWNlIGZyYW1ld29yaz9cclxuXHJcbmNsYXNzIElkQXNzZXJ0aW9uIHtcclxuXHJcbiAgY29uc3RydWN0b3IoYXNzZXJ0aW9uLCBpZHAsIHVzZXJQcm9maWxlKSB7XHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG5cclxuICAgIF90aGlzLl9hc3NlcnRpb24gPSBhc3NlcnRpb247XHJcbiAgICBfdGhpcy5faWRwID0gaWRwO1xyXG4gICAgX3RoaXMuX3VzZXJQcm9maWxlID0gdXNlclByb2ZpbGU7XHJcbiAgfVxyXG5cclxuICBnZXQgYXNzZXJ0aW9uKCkge1xyXG4gICAgcmV0dXJuIHRoaXMuX2Fzc2VydGlvbjtcclxuICB9XHJcblxyXG4gIGdldCBpZHAoKSB7XHJcbiAgICByZXR1cm4gdGhpcy5faWRwO1xyXG4gIH1cclxuXHJcbiAgZ2V0IHVzZXJQcm9maWxlKCkge1xyXG4gICAgcmV0dXJuIHRoaXMuX3VzZXJQcm9maWxlO1xyXG4gIH1cclxuXHJcbn1cclxuXHJcbmNsYXNzIElkVmFsaWRhdGlvbiB7XHJcblxyXG4gIGNvbnN0cnVjdG9yKGlkZW50aXR5LCBjb250ZW50cykge1xyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuICAgIF90aGlzLmlkZW50aXR5ID0gaWRlbnRpdHk7XHJcbiAgICBfdGhpcy5jb250ZW50cyA9IGNvbnRlbnRzO1xyXG4gIH1cclxuXHJcbiAgdmFsaWRhdGVzKGlkZW50aXR5LCBjb250ZW50cykge1xyXG4gICAgLy9UT0RPIGltcGxlbWVudCB0aGUgbG9naWNcclxuXHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgZGVmYXVsdCBJZGVudGl0aWVzO1xyXG4iLCIvLyBMb2cgU3lzdGVtXHJcbmltcG9ydCAqIGFzIGxvZ2dlciBmcm9tICdsb2dsZXZlbCc7XHJcbmxldCBsb2cgPSBsb2dnZXIuZ2V0TG9nZ2VyKCdJZGVudGl0eU1vZHVsZScpO1xyXG5cclxuLyoqXHJcbiogZmFrZSBjbGFzcyBmb3IgdGhlIGd1aSB0byBzZWxlY3QgdGhlIGlkZW50aXR5LFxyXG4qIFRPRE8gcmVwbGFjZSB3aXRoIHRoZSBwcm9wZXIgaWRlbnRpdHkgR1VJXHJcbipcclxuKi9cclxuY2xhc3MgR3VpRmFrZSB7XHJcblxyXG4gIGNvbnN0cnVjdG9yKHVybCwgbWVzc2FnZUJ1cykge1xyXG4gICAgbG9nLmxvZygnRmFrZUdVSV9kZXBsb3llZCcpO1xyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuXHJcbiAgICBfdGhpcy5fdXJsID0gdXJsO1xyXG4gICAgX3RoaXMuX3dhaXRUaW1lID0gMTAwMDA7XHJcbiAgICBfdGhpcy5fbWVzc2FnZUJ1cyA9IG1lc3NhZ2VCdXM7XHJcblxyXG4gICAgX3RoaXMuX21lc3NhZ2VCdXMuYWRkTGlzdGVuZXIoX3RoaXMuX3VybCwgbXNnID0+IHtcclxuXHJcbiAgICAgIGlmIChtc2cuaGFzT3duUHJvcGVydHkoJ3R5cGUnKSAmJlxyXG4gICAgICAgICAgbXNnLnR5cGUgPT09ICdjcmVhdGUnICYmXHJcbiAgICAgICAgICBtc2cuYm9keS5oYXNPd25Qcm9wZXJ0eSgndmFsdWUnKSAmJlxyXG4gICAgICAgICAgbXNnLmJvZHkudmFsdWUuaGFzT3duUHJvcGVydHkoJ2lkZW50aXRpZXMnKSAmJlxyXG4gICAgICAgICAgbXNnLmJvZHkudmFsdWUuaGFzT3duUHJvcGVydHkoJ2lkcHMnKSkge1xyXG5cclxuICAgICAgICBsZXQgaWRlbnRpdGllcyA9IG1zZy5ib2R5LnZhbHVlLmlkZW50aXRpZXM7XHJcbiAgICAgICAgbGV0IGlkcHMgPSBtc2cuYm9keS52YWx1ZS5pZHBzO1xyXG5cclxuICAgICAgICBsZXQgdmFsdWU7XHJcblxyXG4gICAgICAgIGlmIChpZGVudGl0aWVzWzBdICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgIHZhbHVlID0ge3R5cGU6ICdpZGVudGl0eScsIHZhbHVlOiBpZGVudGl0aWVzWzBdLCBjb2RlOiAyMDB9O1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICB2YWx1ZSA9IHt0eXBlOiAnaWRwJywgdmFsdWU6IGlkcHNbMl0uZG9tYWluLCBjb2RlOiAyMDB9O1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgbGV0IHJlcGx5TXNnID0ge2lkOiBtc2cuaWQsIHR5cGU6ICdyZXNwb25zZScsIHRvOiBtc2cuZnJvbSwgZnJvbTogbXNnLnRvLCBib2R5OiB2YWx1ZX07XHJcblxyXG4gICAgICAgIC8vIHRvIHRlc3Qgb24gdGhlIGlkZW50aXR5IHNpZGUgdGhlIGxpc3RlbmVyIHdpdGhvdXQgdGhlIHRpbWVvdXRcclxuICAgICAgICAvLyBjYW4gcmVwcmVzZW50IHRoZSB0aW1lIHRoZSB1c2VyIHRha2VzIHRvIGNob29zZSBhbmQgaWRlbnRpdHlcclxuICAgICAgICBpZiAobXNnLmJvZHkudmFsdWUgPT09ICd3YWl0Jykge1xyXG5cclxuICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgICAgICBfdGhpcy5fbWVzc2FnZUJ1cy5wb3N0TWVzc2FnZShyZXBseU1zZyk7XHJcbiAgICAgICAgICB9LCBfdGhpcy5fd2FpdFRpbWUpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICBfdGhpcy5fbWVzc2FnZUJ1cy5wb3N0TWVzc2FnZShyZXBseU1zZyk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGxvZy5sb2coJ0lnbm9yaW5nIG1lc3NhZ2VzIG5vdCBpbnRlbmRlZCB0byBGYWtlR1VJLicsIG1zZyk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbn1cclxuXHJcbmV4cG9ydCBkZWZhdWx0IEd1aUZha2U7XHJcbiIsIi8vIExvZyBTeXN0ZW1cclxuaW1wb3J0ICogYXMgbG9nZ2VyIGZyb20gJ2xvZ2xldmVsJztcclxubGV0IGxvZyA9IGxvZ2dlci5nZXRMb2dnZXIoJ0lkZW50aXR5TW9kdWxlJyk7XHJcblxyXG5pbXBvcnQgeyBzZWNvbmRzU2luY2VFcG9jaCwgZGl2aWRlVVJMLCBwYXJzZU1lc3NhZ2VVUkwsIHN0cmluZ2lmeSwgZGVlcENsb25lIH0gZnJvbSAnLi4vdXRpbHMvdXRpbHMuanMnO1xyXG5pbXBvcnQgeyBydW50aW1lQ29uZmlndXJhdGlvbiB9IGZyb20gJy4uL3J1bnRpbWUvcnVudGltZUNvbmZpZ3VyYXRpb24nO1xyXG5cclxuaW1wb3J0IElkZW50aXRpZXMgZnJvbSAnLi9JZGVudGl0aWVzJztcclxuaW1wb3J0IEd1aUZha2UgZnJvbSAnLi9HdWlGYWtlJztcclxuXHJcbi8qKlxyXG4qXHJcbiogVGhlIElkZW50aXR5IE1vZHVsZSAoSWQgTW9kdWxlKSBpcyB0aGUgY29tcG9uZW50IHJlc3BvbnNpYmxlIGZvciBoYW5kbGluZyB0aGVcclxuKiB1c2VyIGlkZW50aXR5IGFuZCB0aGUgYXNzb2NpYXRpb24gb2YgdGhpcyBpZGVudGl0eSB3aXRoIHRoZSBIeXBlcnR5IGluc3RhbmNlcyxcclxuKiBpbiBvcmRlciB0byBtYWtlIEh5cGVydHkgaW5zdGFuY2VzIGlkZW50aWZpYWJsZS4gVGhlIGlkZW50aXR5IGluIHRoZSByZVRISU5LIHByb2plY3RcclxuKiBpcyBub3QgZml4ZWQgdG8gYSB1bmlxdWUgSWRlbnRpdHkgU2VydmljZSBQcm92aWRlciwgYnV0IG9idGFpbmVkIHRocm91Z2ggc2V2ZXJhbFxyXG4qIGRpZmZlcmVudCBJZGVudGl0eSBzb3VyY2VzLiBXaXRoIHRoaXMgYXBwcm9hY2gsIHRoZSBJZCBNb2R1bGUgcHJvdmlkZXMgdG8gdGhlIHVzZXIgdGhlXHJcbiogb3B0aW9uIHRvIGNob29zZSB0aGUgcHJlZmVycmVkIG1ldGhvZCBmb3IgYXV0aGVudGljYXRpb24uXHJcbiogVGhpcyBtb2R1bGUgd2lsbCB0aHVzIGFibGUgdG8gc3VwcG9ydCBtdWx0aXBsZSBJZGVudGl0eSBhY3F1aXNpdGlvbiBtZXRob2RzLFxyXG4qIHN1Y2ggYXMgT3BlbklEIGNvbm5lY3QgMS4wLCBLZXJiZXJvcyBTeXN0ZW0sIG9yIGF1dGhlbnRpY2F0aW9uIHRocm91Z2ggc21hcnQgY2FyZHMuXHJcbiogRm9yIGV4YW1wbGUsIGEgdXNlciB3aXRoIGEgR29vZ2xlIGFjY291bnQgY2FuIHVzZSB0aGUgR29vZ2xlIGFzIGFuIElkZW50aXR5IFByb3ZpZGVyIHRvIHByb3ZpZGUgSWRlbnRpdHkgVG9rZW5zLFxyXG4qICB3aGljaCBjYW4gYmUgdXNlZCBieSB0aGUgSWRlbnRpdHkgTW9kdWxlIHRvIGFzc29jaWF0ZSBpdCB3aXRoIGEgSHlwZXJ0eSBpbnN0YW5jZS5cclxuKlxyXG4qIFRoZSBJZGVudGl0eSBNb2R1bGUgdXNlcyBhIG5vZGUgcGFja2FnZSwgdGhlIEhlbGxvSlMsIHdoaWNoIGlzIGEgY2xpZW50LXNpZGUgSmF2YVNjcmlwdCBBUEkgZm9yIGF1dGhlbnRpY2F0aW9uXHJcbiogdGhhdCBmYWNpbGl0YXRlcyB0aGUgcmVxdWVzdHMgZm9yIHRoZSBPcGVuSUQgY29ubmVjdCBwcm90b2NvbC4gVGhpcyBtZXRob2QgYWxsb3dzIGZvciBzb21lIGFic3RyYWN0aW9uXHJcbiogd2hlbiBtYWtpbmcgcmVxdWVzdHMgZm9yIGRpZmZlcmVudCBJZGVudGl0eSBQcm92aWRlcnMsIHN1Y2ggYXMgT3BlbklEIGNvbm5lY3QgdXNlZCBieSBHb29nbGUsIEZhY2Vib29rLCBNaWNyb3NvZnQsIGZvciBleGFtcGxlLlxyXG4qXHJcbiogV2hlbiBhIHJlcXVlc3QgZm9yIGEgdXNlciBpZGVudGl0eSBpcyBtYWRlIHVzaW5nIHRoZSBtZXRob2QgbG9naW5XaXRoUlAoaWRlbnRpZmllciwgc2NvcGUpLFxyXG4qIHRoaXMgbWV0aG9kIHdpbGwgYW5hbHlzZSB0aGUgSWRlbnRpdHkgUHJvdmlkZXIgY2hvc2VuIHRvIG9idGFpbiBhbiBpZGVudGl0eSBhbmQgd2lsbCB1c2UgdGhlIEhlbGxvSlMgbm9kZSBwYWNrYWdlXHJcbiogd2l0aCB0aGUgc2VsZWN0ZWQgSWRlbnRpdHkgUHJvdmlkZXIgYW5kIGlkZW50aXR5IHNjb3BlLiBBZnRlciB0aGUgSGVsbG9KUyByZXF1ZXN0IGZvciBhbiBBY2Nlc3MgVG9rZW5cclxuKiB0byB0aGUgSWRlbnRpdHkgUHJvdmlkZXJzLCB0aGUgdXNlciB3aWxsIGJlIHByb21wdGVkIHRvIGF1dGhlbnRpY2F0ZSB0b3dhcmRzIHRoZSBJZGVudGl0eSBQcm92aWRlci5cclxuKiBVcG9uIHJlY2VpdmluZyB0aGUgQWNjZXNzIFRva2VuLCB0aGlzIHRva2VuIGlzIHZhbGlkYXRlZCB3aXRoIGEgUkVTVGZ1bCB3ZWIgc2VydmljZSByZXF1ZXN0IHRvIGFuIGVuZHBvaW50XHJcbiogb24gdGhlIElkZW50aXR5IFByb3ZpZGVyIEF1dGhvcml6YXRpb24gU2VydmVyLCBhbmQgYWZ0ZXIgdGhlIHZhbGlkYXRpb24gaXMgZG9uZSxcclxuKiBhbiBJRCB0b2tlbiBpcyBvYnRhaW5lZCB3aXRoIHRoZSBpbmZvcm1hdGlvbiBhY2NvcmRpbmcgdG8gdGhlIHNjb3BlIHJlcXVpcmVkLlxyXG4qIFRoaXMgSUQgdG9rZW4gaXMgdGhlbiBwcmVzZXJ2ZWQgaW4gdGhpcyBtb2R1bGUgdGhhdCBjYW4gb2J0YWluZWQgdGhyb3VnaCB0aGUgZ2V0SWRlbnRpdGllcygpXHJcbiogYW5kIGlzIHBhc3NlZCBhcyByZXR1cm4gdmFsdWUgb2YgdGhlIGxvZ2luV2l0aFJQIGZ1bmN0aW9uLiBUaGUgbWV0aG9kcyBnZW5lcmF0ZUFzc2VydGlvbiBhbmQgdmFsaWRhdGVBc3NlcnRpb24gaGF2ZSBub3QgeWV0IGJlZW4gZGV2ZWxvcGVkLlxyXG4qXHJcbiovXHJcbmNsYXNzIElkZW50aXR5TW9kdWxlIHtcclxuXHJcbiAgLyoqXHJcbiAgKiBUaGlzIGlzIHRoZSBjb25zdHJ1Y3RvciB0byBpbml0aWFsaXNlIHRoZSBJZGVudGl0eSBNb2R1bGUgaXQgZG9lcyBub3QgcmVxdWlyZSBhbnkgaW5wdXQuXHJcbiAgKi9cclxuICBjb25zdHJ1Y3RvcihydW50aW1lVVJMLCBydW50aW1lQ2FwYWJpbGl0aWVzLCBzdG9yYWdlTWFuYWdlciwgZGF0YU9iamVjdHNTdG9yYWdlLCBjcnlwdG9NYW5hZ2VyLCBydW50aW1lQ2F0YWxvZ3VlKSB7XHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG5cclxuICAgIGlmICghcnVudGltZVVSTCkgdGhyb3cgbmV3IEVycm9yKCdydW50aW1lVVJMIGlzIG1pc3NpbmcuJyk7XHJcbiAgICBpZiAoIXN0b3JhZ2VNYW5hZ2VyKSB0aHJvdyBuZXcgRXJyb3IoJ3N0b3JhZ2VNYW5hZ2VyIGlzIG1pc3NpbmcnKTtcclxuICAgIGlmICghY3J5cHRvTWFuYWdlcikgdGhyb3cgbmV3IEVycm9yKCdjcnlwdG9NYW5hZ2VyIGlzIG1pc3NpbmcnKTtcclxuICAgIGlmICghcnVudGltZUNhdGFsb2d1ZSkgdGhyb3cgbmV3IEVycm9yKCdydW50aW1lQ2F0YWxvZ3VlIGlzIG1pc3NpbmcnKTtcclxuXHJcbiAgICBfdGhpcy5fcnVudGltZVVSTCA9IHJ1bnRpbWVVUkw7XHJcblxyXG4gICAgX3RoaXMuX3J1bnRpbWVDYXRhbG9ndWUgPSBydW50aW1lQ2F0YWxvZ3VlO1xyXG5cclxuICAgIF90aGlzLmRhdGFPYmplY3RzU3RvcmFnZSA9IGRhdGFPYmplY3RzU3RvcmFnZTtcclxuICAgIF90aGlzLl9pZG1VUkwgPSBfdGhpcy5fcnVudGltZVVSTCArICcvaWRtJztcclxuICAgIF90aGlzLl9ndWlVUkwgPSBfdGhpcy5fcnVudGltZVVSTCArICcvaWRlbnRpdHktZ3VpJztcclxuICAgIF90aGlzLnJ1bnRpbWVDYXBhYmlsaXRpZXMgPSBydW50aW1lQ2FwYWJpbGl0aWVzO1xyXG5cclxuICAgIF90aGlzLl9kb21haW4gPSBkaXZpZGVVUkwoX3RoaXMuX3J1bnRpbWVVUkwpLmRvbWFpbjtcclxuXHJcblxyXG4gICAgLy90byBzdG9yZSBpdGVtcyB3aXRoIHRoaXMgZm9ybWF0OiB7aWRlbnRpdHk6IGlkZW50aXR5VVJMLCB0b2tlbjogdG9rZW5JRH1cclxuICAgIF90aGlzLl9pZGVudGl0aWVzID0gbmV3IElkZW50aXRpZXMoJ2h1bWFuJywgc3RvcmFnZU1hbmFnZXIpO1xyXG5cclxuICAgIC8vIHRvIGJlIHJldmlld2VkOiB3YXRjaGluZ1lvdSBpZGVudGl0aWVzTGlzdCBvciBpZGVudGl0aWVzP1xyXG4gICAgLy8gICAgX3RoaXMuaWRlbnRpdGllc0xpc3QgPSBfdGhpcy53YXRjaGluZ1lvdS53YXRjaCgnaWRlbnRpdGllc0xpc3QnLCB7fSwgdHJ1ZSk7XHJcbiAgICBfdGhpcy5fY3J5cHRvID0gY3J5cHRvTWFuYWdlcjtcclxuXHJcbiAgICAvKiAgICBfdGhpcy5lbWFpbHNMaXN0ID0gW107XHJcbiAgICBsZXQgbmV3SWRlbnRpdHkgPSBuZXcgSWRlbnRpdHkoJ2d1aWQnLCAnSFVNQU4nKTtcclxuICAgIF90aGlzLmlkZW50aXR5ID0gbmV3SWRlbnRpdHk7XHJcbiAgICBfdGhpcy5jdXJyZW50SWRlbnRpdHk7XHJcbiAgICBfdGhpcy5pZGVudGl0aWVzLmRlZmF1bHRJZGVudGl0eTsqL1xyXG5cclxuICAgIC8vc3RvcmVzIHRoZSBhc3NvY2lhdGlvbiBvZiB0aGUgZGF0YU9iamVjdCBhbmQgdGhlIEh5cGVydHkgcmVnaXN0ZXJlZCB3aXRoaW5cclxuICAgIF90aGlzLmRhdGFPYmplY3RzSWRlbnRpdHkgPSB7fTsgLy8gaXMgdGhpcyBuZWVkZWQ/XHJcblxyXG4gICAgX3RoaXMuX2xpc3RPZklkcHMgPSBbXTtcclxuXHJcbiAgICAvLyB2YXJpYWJsZSB0byBrbm93IGlmIHRoZSBHVUkgaXMgZGVwbG95ZWQgdG8gY2hvb3NlIHRoZSBpZGVudGl0eS4gaWYgdGhlIHJlYWwgR1VJIGlzIG5vdCBkZXBsb3llZCwgYSBmYWtlIGd1aSBpcyBkZXBsb3llZCBpbnN0ZWFkLlxyXG4gICAgX3RoaXMuZ3VpRGVwbG95ZWQgPSBmYWxzZTtcclxuXHJcbiAgfVxyXG5cclxuICAvLyoqKioqKioqKioqKioqKioqKiogR0VUIEFORCBTRVQgTUVUSE9EUyAqKioqKioqKioqKioqKioqKioqXHJcblxyXG4gIC8qKlxyXG4gICogcmV0dXJuIHRoZSBtZXNzYWdlQnVzIGluIHRoaXMgUmVnaXN0cnlcclxuICAqIEBwYXJhbSB7TWVzc2FnZUJ1c30gICAgICAgICAgIG1lc3NhZ2VCdXNcclxuICAqL1xyXG4gIGdldCBtZXNzYWdlQnVzKCkge1xyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuICAgIHJldHVybiBfdGhpcy5fbWVzc2FnZUJ1cztcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICogU2V0IHRoZSBtZXNzYWdlQnVzIGluIHRoaXMgUmVnaXN0cnlcclxuICAqIEBwYXJhbSB7TWVzc2FnZUJ1c30gICAgICAgICAgIG1lc3NhZ2VCdXNcclxuICAqL1xyXG4gIHNldCBtZXNzYWdlQnVzKG1lc3NhZ2VCdXMpIHtcclxuICAgIGxldCBfdGhpcyA9IHRoaXM7XHJcbiAgICBfdGhpcy5fbWVzc2FnZUJ1cyA9IG1lc3NhZ2VCdXM7XHJcbiAgICBfdGhpcy5hZGRHVUlMaXN0ZW5lcnMoKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICogcmV0dXJuIHRoZSBjb3JlRGlzY292ZXJ5IGNvbXBvbmVudFxyXG4gICogZG8gd2UgbmVlZCB0aGlzPz9cclxuICAqL1xyXG4gIGdldCBjb3JlRGlzY292ZXJ5KCkge1xyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuICAgIHJldHVybiBfdGhpcy5fY29yZURpc2NvdmVyeTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICogU2V0IHRoZSBjb3JlRGlzY292ZXJ5IGNvbXBvbmVudFxyXG4gICogQHBhcmFtIHtjb3JlRGlzY292ZXJ5fSBjb3JlRGlzY292ZXJ5XHJcbiAgKi9cclxuICBzZXQgY29yZURpc2NvdmVyeShjb3JlRGlzY292ZXJ5KSB7XHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG4gICAgX3RoaXMuX2NvcmVEaXNjb3ZlcnkgPSBjb3JlRGlzY292ZXJ5O1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgKiByZXR1cm4gdGhlIHJlZ2lzdHJ5IGluIHRoaXMgaWRNb2R1bGVcclxuICAqIEBwYXJhbSB7cmVnaXN0cnl9ICAgICAgICAgICByZWdpc3RyeVxyXG4gICovXHJcbiAgZ2V0IHJlZ2lzdHJ5KCkge1xyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuICAgIHJldHVybiBfdGhpcy5fcmVnaXN0cnk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAqIFNldCB0aGUgcmVnaXN0cnkgaW4gdGhpcyBpZE1vZHVsZVxyXG4gICogQHBhcmFtIHtyZWdpc3RyeX0gICAgIHJlZ1xyXG4gICovXHJcbiAgc2V0IHJlZ2lzdHJ5KHJlZ2lzdHJ5KSB7XHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG4gICAgX3RoaXMuX3JlZ2lzdHJ5ID0gcmVnaXN0cnk7XHJcbiAgfVxyXG5cclxuXHJcbiAgLy8qKioqKioqKioqKioqKioqKioqIElERU5USVRZIFJFTEVBVEVEIE1FVEhPRFMgKioqKioqKioqKioqKioqKioqKlxyXG4gIC8qKlxyXG4gICogZ2V0cyBhbGwgdGhlIGluZm9ybWF0aW9uIGZyb20gYSBnaXZlbiB1c2VyVVJMXHJcbiAgKiBAcGFyYW0gIHtTdHJpbmd9ICB1c2VyVVJMICAgICB1c2VyIHVybFxyXG4gICogQHJldHVybiB7SlNPTn0gICAgaWRlbnRpdHkgICAgaWRlbnRpdHkgYnVuZGxlIGZyb20gdGhlIHVzZXJVUkxcclxuICAqL1xyXG4gIGdldElkZW50aXR5KHVzZXJVUkwpIHtcclxuICAgIHJldHVybiB0aGlzLmlkZW50aXRpZXMuZ2V0SWRlbnRpdHkodXNlclVSTCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAqIEZ1bmN0aW9uIHRvIHNldCB0aGUgY3VycmVudCBJZGVudGl0eSB3aXRoIGEgZ2l2ZW4gSWRlbnRpdHlcclxuICAqIEBwYXJhbSB7SWRlbnRpdHl9ICAgICAgICBpZGVudGl0eSAgICAgICAgIGlkZW50aXR5XHJcbiAgKi9cclxuXHJcbiAgLyogIHNldEN1cnJlbnRJZGVudGl0eShpZGVudGl0eSkge1xyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuICAgIF90aGlzLmN1cnJlbnRJZGVudGl0eSA9IGlkZW50aXR5O1xyXG4gIH0qL1xyXG5cclxuICAvKipcclxuICAqIEZ1bmN0aW9uIHRvIHJldHVybiBhbGwgdGhlIGlkZW50aXRpZXMgcmVnaXN0ZXJlZCB3aXRoaW4gYSBzZXNzaW9uIGJ5IGEgdXNlci5cclxuICAqIFRoZXNlIGlkZW50aXRpZXMgYXJlIHJldHVybmVkIGluIGFuIGFycmF5IGNvbnRhaW5pbmcgYSBKU09OIHBhY2thZ2UgZm9yIGVhY2ggdXNlciBpZGVudGl0eS5cclxuICAqIEByZXR1cm4ge0FycmF5PElkZW50aXRpZXM+fSAgICAgICAgIElkZW50aXRpZXNcclxuICAqL1xyXG4gIGdldCBpZGVudGl0aWVzKCkge1xyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuICAgIHJldHVybiBfdGhpcy5faWRlbnRpdGllcztcclxuICB9XHJcblxyXG4gIHNldCBpZGVudGl0aWVzKGlkZW50aXRpZXMpIHtcclxuICAgIGxldCBfdGhpcyA9IHRoaXM7XHJcbiAgICBfdGhpcy5faWRlbnRpdGllcyA9IGlkZW50aXRpZXM7XHJcbiAgfVxyXG5cclxuICBnZXQgaWRwcygpIHtcclxuICAgIHJldHVybiB0aGlzLl9saXN0T2ZJZHBzO1xyXG4gIH1cclxuXHJcbiAgZ2V0SWRlbnRpdGllc1RvQ2hvb3NlKCkge1xyXG4gICAgLy8gICAgbGV0IGlkZW50aXRpZXMgPSBfdGhpcy5pZGVudGl0aWVzLmlkZW50aWZpZXJzO1xyXG5cclxuICAgIC8vIGxldCBpZHBzID0gW1xyXG4gICAgLy8gICB7IGRvbWFpbjogJ2dvb2dsZS5jb20nLCB0eXBlOiAnaWRUb2tlbid9LFxyXG4gICAgLy8gICB7IGRvbWFpbjogJ21pY3Jvc29mdC5jb20nLCB0eXBlOiAnaWRUb2tlbid9LFxyXG4gICAgLy8gICB7IGRvbWFpbjogJ29yYW5nZS5mcicsIHR5cGU6ICdpZFRva2VuJ30sXHJcbiAgICAvLyAgIHsgZG9tYWluOiAnc2xhY2suY29tJywgdHlwZTogJ0xlZ2FjeSd9XHJcbiAgICAvLyBdO1xyXG5cclxuICAgIC8vIHRvZG86IHJldHJpZXZlIGF2YWlsYWJsZSBpZHBzIGZyb20gcnVudGltZSBjYXRhbG9ndWVcclxuICAgIC8vIHRvZG86IGVuYWJsZSBvYXV0aCBpZHBzXHJcbiAgICAvLyBsZXQgaWRwcyA9IFtcclxuICAgIC8vICAgeyBkb21haW46ICdnb29nbGUuY29tJywgdHlwZTogJ2lkVG9rZW4nIH0sXHJcbiAgICAvLyAgIHsgZG9tYWluOiAnbWljcm9zb2Z0LmNvbScsIHR5cGU6ICdpZFRva2VuJyB9LFxyXG4gICAgLy8gICB7IGRvbWFpbjogJ2ZhY2Vib29rLmNvbScsIHR5cGU6ICdpZFRva2VuJyB9LFxyXG4gICAgLy8gICB7IGRvbWFpbjogJ3NsYWNrLmNvbScsIHR5cGU6ICdpZFRva2VuJyB9XHJcbiAgICAvLyBdO1xyXG5cclxuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4ge1xyXG4gICAgICBsZXQgcHJlZml4ID0gcnVudGltZUNvbmZpZ3VyYXRpb25bJ2NhdGFsb2d1ZVVSTHMnXVsnaWRwLXByb3h5J10ucHJlZml4O1xyXG4gICAgICBsZXQgc3VmZml4ID0gcnVudGltZUNvbmZpZ3VyYXRpb25bJ2NhdGFsb2d1ZVVSTHMnXVsnaWRwLXByb3h5J10uc3VmZml4O1xyXG5cclxuICAgICAgY29uc3QgdXJsID0gcHJlZml4ICsgdGhpcy5fZG9tYWluICsgc3VmZml4O1xyXG5cclxuICAgICAgUHJvbWlzZS5hbGwoW1xyXG4gICAgICAgIHRoaXMucnVudGltZUNhcGFiaWxpdGllcy5pc0F2YWlsYWJsZSgnYnJvd3NlcicpLFxyXG4gICAgICAgIHRoaXMucnVudGltZUNhcGFiaWxpdGllcy5pc0F2YWlsYWJsZSgnbm9kZScpXSlcclxuICAgICAgICAudGhlbigocmVzdWx0KSA9PiB7XHJcblxyXG4gICAgICAgICAgY29uc3QgaXNCcm93c2VyID0gcmVzdWx0WzBdO1xyXG4gICAgICAgICAgY29uc3QgaXNOb2RlID0gcmVzdWx0WzFdO1xyXG5cclxuICAgICAgICAgIGNvbnN0IGNvbnN0cmFpbnRzID0geyBjb25zdHJhaW50czoge30gfTtcclxuICAgICAgICAgIGNvbnN0cmFpbnRzLmNvbnN0cmFpbnRzLm5vZGUgPSBpc05vZGU7XHJcbiAgICAgICAgICBjb25zdHJhaW50cy5jb25zdHJhaW50cy5icm93c2VyID0gaXNCcm93c2VyO1xyXG5cclxuICAgICAgICAgIHRoaXMuX2dldEFsbElkcHMoKS50aGVuKChpZHBzKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IGxpc3RPZklkcHMgPSBpZHBzLm1hcChrZXkgPT4geyByZXR1cm4geyBkb21haW46IGtleSwgdHlwZTogJ2lkVG9rZW4nIH07IH0pO1xyXG4gICAgICAgICAgICBsb2cuaW5mbygnW0lkZW50aXR5TW9kdWxlLmdldElkZW50aXR5QXNzZXJ0aW9uOmdldElkZW50aXRpZXNUb0Nob29zZV0nLCBpZHBzLCBsaXN0T2ZJZHBzKTtcclxuICAgICAgICAgICAgdGhpcy5fbGlzdE9mSWRwcyA9IGxpc3RPZklkcHM7XHJcbiAgICAgICAgICAgIHJldHVybiByZXNvbHZlKHsgZGVmYXVsdElkZW50aXR5OiB0aGlzLmlkZW50aXRpZXMuZGVmYXVsdElkZW50aXR5LCBpZGVudGl0aWVzOiB0aGlzLmlkZW50aXRpZXMuaWRlbnRpdGllcywgaWRwczogbGlzdE9mSWRwcyB9KTtcclxuICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICB9KTtcclxuXHJcbiAgICB9KTtcclxuXHJcbiAgfVxyXG5cclxuICBfZ2V0QWxsSWRwcygpIHtcclxuXHJcbiAgbGV0IGFsbFVybCA9ICdodHRwczovLycgKyB0aGlzLl9kb21haW4gKyAnOjgwODAvLndlbGwta25vd24vaWRwLXByb3h5L2FsbC5qc29uJztcclxuXHJcbiAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgZmV0Y2goYWxsVXJsKS50aGVuKGZ1bmN0aW9uKHJlc3VsdCkge1xyXG4vKiAgICAkLmFqYXgoe1xyXG4gICAgICB1cmw6IGh5cGVydGllc1VSTCxcclxuICAgICAgc3VjY2VzczogZnVuY3Rpb24ocmVzdWx0KSB7Ki9cclxuXHJcblxyXG4gICAgICAgIGNvbnNvbGUubG9nKHJlc3VsdCk7XHJcblxyXG4gICAgICAgIHJlc3VsdC5qc29uKCkudGhlbihmdW5jdGlvbiAoaWRwcykge1xyXG4gICAgICAgICAgY29uc29sZS5sb2coaWRwcyk7XHJcbi8qICAgICAgICAgIGxldCByZXNwb25zZSA9IFtdO1xyXG4gICAgICAgIGlmICh0eXBlb2YgaHlwZXJ0aWVzID09PSAnb2JqZWN0Jykge1xyXG4gICAgICAgICAgaHlwZXJ0aWVzLmZvckVhY2goZnVuY3Rpb24oa2V5KSB7XHJcbiAgICAgICAgICAgIHJlc3BvbnNlLnB1c2goa2V5KTtcclxuICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0gZWxzZSBpZiAodHlwZW9mIGh5cGVydGllcyA9PT0gJ3N0cmluZycpIHtcclxuICAgICAgICAgIHJlc3BvbnNlID0gSlNPTi5wYXJzZShoeXBlcnRpZXMpO1xyXG4gICAgICAgIH0qL1xyXG5cclxuICAgICAgICByZXNvbHZlKGlkcHNbJ2lkcHMnXSk7XHJcblxyXG4gICAgICAgIH0pXHJcbiAgICAgIH0sZnVuY3Rpb24ocmVhc29uKSB7XHJcbi8vICAgICAgZmFpbDogZnVuY3Rpb24ocmVhc29uKSB7XHJcbiAgICAgICAgcmVqZWN0KHJlYXNvbik7XHJcbi8vICAgICAgICBub3RpZmljYXRpb24ocmVhc29uLCAnd2FybicpO1xyXG4gICAgICB9KTtcclxuICB9KTsgICAgXHJcbiAgfVxyXG5cclxuXHJcbiAgLyoqXHJcbiAgKiBGdW5jdGlvbiB0byByZXR1cm4gdGhlIHNlbGVjdGVkIElkZW50aXR5IHdpdGhpbiBhIHNlc3Npb25cclxuICAqIEByZXR1cm4ge0lkZW50aXR5fSAgICAgICAgaWRlbnRpdHkgICAgICAgICBpZGVudGl0eVxyXG4gICovXHJcbiAgLyogIGdldEN1cnJlbnRJZGVudGl0eSgpIHtcclxuICAgIGxldCBfdGhpcyA9IHRoaXM7XHJcbiAgICByZXR1cm4gX3RoaXMuY3VycmVudElkZW50aXR5O1xyXG4gIH0qL1xyXG5cclxuICBpbml0KGd1aWQpIHtcclxuICAgIGxldCBfdGhpcyA9IHRoaXM7XHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHtcclxuICAgICAgX3RoaXMuX2lkZW50aXRpZXMubG9hZElkZW50aXRpZXMoKS50aGVuKCgpID0+IHtcclxuXHJcbiAgICAgICAgaWYgKCFndWlkKSB7XHJcbiAgICAgICAgICBfdGhpcy5fY3J5cHRvLmdldE15UHVibGljS2V5KCkudGhlbigoa2V5KSA9PiB7XHJcbiAgICAgICAgICAgIGxldCBoYXNoID0gX3RoaXMuX2NyeXB0by5jcnlwdG8uX3NoYTI1NihzdHJpbmdpZnkoa2V5KSkudGhlbigoaGFzaCkgPT4ge1xyXG5cclxuICAgICAgICAgICAgICBndWlkID0gJ3VzZXItZ3VpZDovLycgKyBoYXNoO1xyXG4gICAgICAgICAgICAgIF90aGlzLmlkZW50aXRpZXMuZ3VpZCA9IGd1aWQ7XHJcbiAgICAgICAgICAgICAgX3RoaXMuX2lkZW50aXRpZXMubG9hZEFjY2Vzc1Rva2VucygpLnRoZW4oKCkgPT4ge1xyXG5cclxuICAgICAgICAgICAgICAgIHJlc29sdmUoKTtcclxuICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSkuY2F0Y2goKGVycm9yKSA9PiB7XHJcbiAgICAgICAgICAgICAgY29uc29sZS5sb2coJ1tJZGVudGl0eU1vZHVsZV0gZXJyb3InLCBlcnJvcik7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICBfdGhpcy5pZGVudGl0aWVzLmd1aWQgPSBndWlkO1xyXG4gICAgICAgICAgX3RoaXMuX2lkZW50aXRpZXMubG9hZEFjY2Vzc1Rva2VucygpLnRoZW4oKCkgPT4ge1xyXG5cclxuICAgICAgICAgICAgcmVzb2x2ZSgpO1xyXG4gICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgfSk7XHJcblxyXG4gICAgfSk7XHJcblxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgKiBGdW5jdGlvbiB0aGF0IGZldGNoIGFuIGlkZW50aXR5QXNzZXJ0aW9uIGZyb20gYSB1c2VyLlxyXG4gICpcclxuICAqIEByZXR1cm4ge0lkQXNzZXJ0aW9ufSAgICAgICAgICAgICAgSWRBc3NlcnRpb25cclxuICAqL1xyXG4gIGdldElkZW50aXR5QXNzZXJ0aW9uKGlkZW50aXR5QnVuZGxlKSB7XHJcbiAgICBsb2cubG9nKCdbSWRlbnRpdHlNb2R1bGUuZ2V0SWRlbnRpdHlBc3NlcnRpb246aWRlbnRpdHlCdW5kbGVdJywgaWRlbnRpdHlCdW5kbGUpO1xyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuXHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xyXG5cclxuICAgICAgLy9DSEVDSyB3aGV0aGVyIGlzIGJyb3dzZXIgZW52aXJvbm1lbnQgb3Igbm9kZWpzXHJcbiAgICAgIC8vaWYgaXQgaXMgYnJvd3NlciwgdGhlbiBjcmVhdGUgYSBmYWtlIGlkZW50aXR5XHJcblxyXG4gICAgICBfdGhpcy5ydW50aW1lQ2FwYWJpbGl0aWVzLmlzQXZhaWxhYmxlKCdicm93c2VyJykudGhlbigocmVzdWx0KSA9PiB7XHJcbiAgICAgICAgbG9nLmxvZygncnVudGltZSBicm93c2VyIGlkZW50aXR5IGFjcXVpc2l0aW9uJywgcmVzdWx0KTtcclxuXHJcbiAgICAgICAgaWYgKCFyZXN1bHQpIHJldHVybjtcclxuXHJcbiAgICAgICAgLy90b2RvOiBvbmx5IGlkcCBzaG91bGQgYmUgbWFuZGF0b3J5IHdoZW4gaWRlbnRpdHlCdW5kbGUgZXhpc3RzXHJcblxyXG4gICAgICAgIGlmIChpZGVudGl0eUJ1bmRsZSAmJlxyXG4gICAgICAgICAgaWRlbnRpdHlCdW5kbGUuaGFzT3duUHJvcGVydHkoJ2lkcCcpKSB7XHJcblxyXG4gICAgICAgICAgbGV0IGlkcCA9IGlkZW50aXR5QnVuZGxlLmlkcDtcclxuICAgICAgICAgIGxldCBvcmlnaW4gPSBpZGVudGl0eUJ1bmRsZS5oYXNPd25Qcm9wZXJ0eSgnb3JpZ2luJykgPyBpZGVudGl0eUJ1bmRsZS5vcmlnaW4gOiAnb3JpZ2luJztcclxuICAgICAgICAgIGxldCBpZEhpbnQgPSBpZGVudGl0eUJ1bmRsZS5oYXNPd25Qcm9wZXJ0eSgnaWRIaW50JykgPyBpZGVudGl0eUJ1bmRsZS5pZEhpbnQgOiAnJztcclxuXHJcbiAgICAgICAgICBpZiAoX3RoaXMuaWRlbnRpdGllcy5kZWZhdWx0SWRlbnRpdHkpIHtcclxuICAgICAgICAgICAgbGV0IGFzc2VydGlvbiA9IF90aGlzLmlkZW50aXRpZXMuZGVmYXVsdElkZW50aXR5O1xyXG5cclxuICAgICAgICAgICAgaWYgKGFzc2VydGlvbi5leHBpcmVzID4gc2Vjb25kc1NpbmNlRXBvY2goKSkge1xyXG4gICAgICAgICAgICAgIHJldHVybiByZXNvbHZlKGFzc2VydGlvbik7XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoYXNzZXJ0aW9uLmhhc093blByb3BlcnR5KCdyZWZyZXNoJykpIHtcclxuICAgICAgICAgICAgICBsb2cubG9nKCdbSWRlbnRpdHkuSWRlbnRpdHlNb2R1bGUuZ2V0SWRlbnRpdHlBc3NlcnRpb25dIHJlZnJlc2hpbmcgYXNzZXJ0aW9uOiAnLCBhc3NlcnRpb24pO1xyXG5cclxuICAgICAgICAgICAgICBfdGhpcy5fcmVmcmVzaElkQXNzZXJ0aW9uKCkudGhlbigobmV3QXNzZXJ0aW9uKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBsb2cubG9nKCdbSWRlbnRpdHlNb2R1bGUuZ2V0SWRlbnRpdHlBc3NlcnRpb25dIHJlZnJlc2hlZCBhc3NlcnRpb24uJywgbmV3QXNzZXJ0aW9uKTtcclxuICAgICAgICAgICAgICAgIHJldHVybiByZXNvbHZlKG5ld0Fzc2VydGlvbik7XHJcbiAgICAgICAgICAgICAgfSwgKGVycm9yKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBsb2cuZXJyb3IoJ1tJZGVudGl0eU1vZHVsZS5nZXRJZGVudGl0eUFzc2VydGlvbl0gZXJyb3Igb24gcmVmcmVzSWRBc3NlcnRpb246ICcsIGVycm9yLCAnIEFza2luZyBmb3IgYSBuZXcgSWRBc3NlcnRpb24uJylcclxuICAgICAgICAgICAgICAgIF90aGlzLl9nZXRJZEFzc2VydGlvbkZvckRvbWFpbihvcmlnaW4sIGlkcCwgaWRIaW50KS50aGVuKChhc3NlcnRpb24pID0+IHtcclxuICAgICAgICAgICAgICAgICAgcmVzb2x2ZShhc3NlcnRpb24pO1xyXG4gICAgICAgICAgICAgICAgfSwgKGVycm9yKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgIHJlamVjdChlcnJvcik7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgX3RoaXMuX2dldElkQXNzZXJ0aW9uRm9yRG9tYWluKG9yaWdpbiwgaWRwLCBpZEhpbnQpLnRoZW4oKGFzc2VydGlvbikgPT4ge1xyXG4gICAgICAgICAgICAgICAgcmVzb2x2ZShhc3NlcnRpb24pO1xyXG4gICAgICAgICAgICAgIH0sIChlcnJvcikgPT4ge1xyXG4gICAgICAgICAgICAgICAgcmVqZWN0KGVycm9yKTtcclxuICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgX3RoaXMuX2dldElkQXNzZXJ0aW9uRm9yRG9tYWluKG9yaWdpbiwgaWRwLCBpZEhpbnQpLnRoZW4oKGFzc2VydGlvbikgPT4ge1xyXG4gICAgICAgICAgICAgIHJlc29sdmUoYXNzZXJ0aW9uKTtcclxuICAgICAgICAgICAgfSwgKGVycm9yKSA9PiB7XHJcbiAgICAgICAgICAgICAgcmVqZWN0KGVycm9yKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICB9XHJcblxyXG4gICAgICAgIH0gZWxzZSBpZiAoX3RoaXMuaWRlbnRpdGllcy5kZWZhdWx0SWRlbnRpdHkpIHtcclxuICAgICAgICAgIGxldCBhc3NlcnRpb24gPSBfdGhpcy5pZGVudGl0aWVzLmRlZmF1bHRJZGVudGl0eTtcclxuXHJcbiAgICAgICAgICBpZiAoYXNzZXJ0aW9uLmV4cGlyZXMgPiBzZWNvbmRzU2luY2VFcG9jaCgpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiByZXNvbHZlKGFzc2VydGlvbik7XHJcbiAgICAgICAgICB9IGVsc2UgaWYgKGFzc2VydGlvbi5oYXNPd25Qcm9wZXJ0eSgncmVmcmVzaCcpKSB7XHJcbiAgICAgICAgICAgIGxvZy5sb2coJ1tJZGVudGl0eS5JZGVudGl0eU1vZHVsZS5nZXRWYWxpZFRva2VuXSByZWZyZXNoaW5nIGFzc2VydGlvbjogJywgYXNzZXJ0aW9uKTtcclxuXHJcbiAgICAgICAgICAgIF90aGlzLl9yZWZyZXNoSWRBc3NlcnRpb24oYXNzZXJ0aW9uKS50aGVuKChuZXdBc3NlcnRpb24pID0+IHtcclxuICAgICAgICAgICAgICBsb2cubG9nKCdbSWRlbnRpdHlNb2R1bGUuZ2V0SWRlbnRpdHlBc3NlcnRpb25dIHJlZnJlc2hlZCBhc3NlcnRpb24uJywgbmV3QXNzZXJ0aW9uKTtcclxuICAgICAgICAgICAgICByZXR1cm4gcmVzb2x2ZShuZXdBc3NlcnRpb24pO1xyXG5cclxuICAgICAgICAgICAgfSwgKGVycm9yKSA9PiB7XHJcbiAgICAgICAgICAgICAgbG9nLmVycm9yKCdbSWRlbnRpdHlNb2R1bGUuZ2V0SWRlbnRpdHlBc3NlcnRpb25dIGVycm9yIG9uIHJlZnJlc0lkQXNzZXJ0aW9uOiAnLCBlcnJvciwgJyBBc2tpbmcgZm9yIGEgbmV3IElkQXNzZXJ0aW9uLicpXHJcblxyXG4gICAgICAgICAgICAgIF90aGlzLnNlbGVjdElkZW50aXR5RnJvbUdVSSgpLnRoZW4oKGFzc2VydGlvbikgPT4ge1xyXG5cclxuICAgICAgICAgICAgICAgIGxvZy5sb2coJ1tJZGVudGl0eU1vZHVsZV0gSWRlbnRpdHkgc2VsZWN0ZWQgZnJvbSBHVUkuJyk7XHJcblxyXG4gICAgICAgICAgICAgICAgX3RoaXMuaWRlbnRpdGllcy5kZWZhdWx0SWRlbnRpdHkgPSBhc3NlcnRpb24udXNlclByb2ZpbGUudXNlclVSTDtcclxuICAgICAgICAgICAgICAgIHJldHVybiByZXNvbHZlKGFzc2VydGlvbik7XHJcblxyXG4gICAgICAgICAgICAgIH0sIChlcnIpID0+IHtcclxuICAgICAgICAgICAgICAgIHJldHVybiByZWplY3QoZXJyKTtcclxuICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIF90aGlzLnNlbGVjdElkZW50aXR5RnJvbUdVSSgpLnRoZW4oKGFzc2VydGlvbikgPT4ge1xyXG5cclxuICAgICAgICAgICAgICBsb2cubG9nKCdbSWRlbnRpdHlNb2R1bGVdIElkZW50aXR5IHNlbGVjdGVkIGZyb20gR1VJLicpO1xyXG5cclxuICAgICAgICAgICAgICBfdGhpcy5pZGVudGl0aWVzLmRlZmF1bHRJZGVudGl0eSA9IGFzc2VydGlvbi51c2VyUHJvZmlsZS51c2VyVVJMO1xyXG4gICAgICAgICAgICAgIHJldHVybiByZXNvbHZlKGFzc2VydGlvbik7XHJcblxyXG4gICAgICAgICAgICB9LCAoZXJyKSA9PiB7XHJcbiAgICAgICAgICAgICAgcmV0dXJuIHJlamVjdChlcnIpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgX3RoaXMuc2VsZWN0SWRlbnRpdHlGcm9tR1VJKCkudGhlbigoYXNzZXJ0aW9uKSA9PiB7XHJcblxyXG4gICAgICAgICAgICBsb2cubG9nKCdbSWRlbnRpdHlNb2R1bGVdIElkZW50aXR5IHNlbGVjdGVkIGZyb20gR1VJLicpO1xyXG5cclxuICAgICAgICAgICAgX3RoaXMuaWRlbnRpdGllcy5kZWZhdWx0SWRlbnRpdHkgPSBhc3NlcnRpb24udXNlclByb2ZpbGUudXNlclVSTDtcclxuICAgICAgICAgICAgcmV0dXJuIHJlc29sdmUoYXNzZXJ0aW9uKTtcclxuXHJcbiAgICAgICAgICB9LCAoZXJyKSA9PiB7XHJcbiAgICAgICAgICAgIHJldHVybiByZWplY3QoZXJyKTtcclxuICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICB9XHJcbiAgICAgIH0pLmNhdGNoKGVycm9yID0+IHtcclxuICAgICAgICBsb2cuZXJyb3IoJ0Vycm9yIG9uIGlkZW50aXR5IGFjcXVpc2l0aW9uICcsIGVycm9yKTtcclxuICAgICAgICByZXR1cm4gcmVqZWN0KGVycm9yKTtcclxuICAgICAgfSk7XHJcblxyXG4gICAgICBfdGhpcy5ydW50aW1lQ2FwYWJpbGl0aWVzLmlzQXZhaWxhYmxlKCdub2RlJykudGhlbigocmVzdWx0KSA9PiB7XHJcbiAgICAgICAgbG9nLmxvZygnbm9kZSBpZGVudGl0eSBhY3F1aXNpdGlvbicsIHJlc3VsdCk7XHJcblxyXG4gICAgICAgIGlmICghcmVzdWx0KSByZXR1cm47XHJcblxyXG4gICAgICAgIGlmIChfdGhpcy5pZGVudGl0aWVzLmN1cnJlbnRJZGVudGl0eSkge1xyXG4gICAgICAgICAgLy9UT0RPIHZlcmlmeSB3aGV0aGVyIHRoZSB0b2tlbiBpcyBzdGlsbCB2YWxpZCBvciBub3QuXHJcbiAgICAgICAgICAvLyBzaG91bGQgYmUgbmVlZGVkIHRvIG1ha2UgZnVydGhlciByZXF1ZXN0cywgdG8gb2J0YWluIGEgdmFsaWQgdG9rZW5cclxuICAgICAgICAgIHJldHVybiByZXNvbHZlKF90aGlzLmlkZW50aXRpZXMuY3VycmVudElkZW50aXR5KTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgbG9nLmxvZygnZ2V0SWRlbnRpdHlBc3NlcnRpb24gZm9yIG5vZGVqcycpO1xyXG5cclxuICAgICAgICAgIGxldCBpZHAgPSB7IHR5cGU6ICdpZHAnLCB2YWx1ZTogJ25vZGVqcy1pZHAnLCBjb2RlOiAyMDAsIGF1dGg6IGZhbHNlIH07XHJcbiAgICAgICAgICBfdGhpcy5jYWxsTm9kZUpzR2VuZXJhdGVNZXRob2RzKGlkcC52YWx1ZSwgJ29yaWdpbicpLnRoZW4oKHZhbHVlKSA9PiB7XHJcbiAgICAgICAgICAgIHJlc29sdmUodmFsdWUpO1xyXG4gICAgICAgICAgfSwgKGVycikgPT4ge1xyXG4gICAgICAgICAgICByZWplY3QoZXJyKTtcclxuICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgIH0pLmNhdGNoKGVycm9yID0+IHtcclxuICAgICAgICBsb2cuZXJyb3IoJ0Vycm9yIG9uIGlkZW50aXR5IGFjcXVpc2l0aW9uICcsIGVycm9yKTtcclxuICAgICAgICByZWplY3QoZXJyb3IpO1xyXG4gICAgICB9KTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgX2dldElkQXNzZXJ0aW9uRm9yRG9tYWluKG9yaWdpbiwgaWRwLCBpZEhpbnQpIHtcclxuXHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG5cclxuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XHJcbiAgICAgIF90aGlzLnNlbGVjdElkZW50aXR5Rm9ySHlwZXJ0eShvcmlnaW4sIGlkcCwgaWRIaW50KS50aGVuKChhc3NlcnRpb24pID0+IHtcclxuICAgICAgICBsb2cubG9nKCdbSWRlbnRpdHlNb2R1bGUuX2dldElkQXNzZXJ0aW9uRm9yRG9tYWluXSBJZGVudGl0eSBzZWxlY3RlZCBieSBoeXBlcnR5LicpO1xyXG4gICAgICAgIHJldHVybiByZXNvbHZlKGFzc2VydGlvbik7XHJcbiAgICAgIH0sIChlcnIpID0+IHsgLy8gaWYgaXQgZ290IGFuIGVycm9yIHRoZW4ganVzdCBzZWxlY3QgaWRlbnRpdHkgZnJvbSBHVUlcclxuICAgICAgICAvLyBsb2cuZXJyb3IoJ1tJZGVudGl0eU1vZHVsZV0gQ291bGQgbm90IHNlbGVjdCBpZGVudGl0eSBmcm9tIGh5cGVydHkuJyk7XHJcblxyXG4gICAgICAgIF90aGlzLnNlbGVjdElkZW50aXR5RnJvbUdVSSgpLnRoZW4oKG5ld0Fzc2VydGlvbikgPT4ge1xyXG4gICAgICAgICAgbG9nLmxvZygnW0lkZW50aXR5TW9kdWxlLl9nZXRJZEFzc2VydGlvbkZvckRvbWFpbl0gSWRlbnRpdHkgc2VsZWN0ZWQgYnkgaHlwZXJ0eS4nKTtcclxuICAgICAgICAgIHJldHVybiByZXNvbHZlKG5ld0Fzc2VydGlvbik7XHJcbiAgICAgICAgfSwgKGVycikgPT4ge1xyXG4gICAgICAgICAgcmV0dXJuIHJlamVjdChlcnIpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICB9KTtcclxuXHJcbiAgICB9KTtcclxuXHJcbiAgfVxyXG5cclxuICBfcmVmcmVzaElkQXNzZXJ0aW9uKGFzc2VydGlvbikge1xyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuXHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xyXG4gICAgICBfdGhpcy5zZW5kUmVmcmVzaE1lc3NhZ2UoYXNzZXJ0aW9uKS50aGVuKChuZXdBc3NlcnRpb24pID0+IHtcclxuICAgICAgICBsb2cubG9nKCdbSWRlbnRpdHkuSWRlbnRpdHlNb2R1bGUuZ2V0VmFsaWRUb2tlbl0gcmVmcmVzaGVkIGFzc2VydGlvbjogJywgbmV3QXNzZXJ0aW9uKTtcclxuICAgICAgICBfdGhpcy5pZGVudGl0aWVzLnVwZGF0ZUFzc2VydGlvbihuZXdBc3NlcnRpb24pLnRoZW4oKCkgPT4ge1xyXG4gICAgICAgICAgcmVzb2x2ZShuZXdBc3NlcnRpb24pO1xyXG4gICAgICAgIH0sIChlcnIpID0+IHtcclxuICAgICAgICAgIGxvZy5lcnJvcignW0lkZW50aXR5TW9kdWxlLmdldFZhbGlkVG9rZW5dIGVycm9yIHVwZGF0aW5nIHRoZSBhc3NlcnRpb24gJywgZXJyKTtcclxuICAgICAgICAgIHJlamVjdChlcnIpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICB9LCAoZXJyKSA9PiB7XHJcbiAgICAgICAgbG9nLmVycm9yKCdbSWRlbnRpdHlNb2R1bGUuZ2V0VmFsaWRUb2tlbl0gZXJyb3IgcmVmcmVzaGluZyB0aGUgYXNzZXJ0aW9uICcsIGVycik7XHJcbiAgICAgICAgcmVqZWN0KGVycik7XHJcbiAgICAgIH0pO1xyXG5cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcblxyXG4gIC8qKlxyXG4gICogRnVuY3Rpb24gdG8gcmV0dXJuIGFsbCB0aGUgdXNlcnMgVVJMcyByZWdpc3RlcmVkIHdpdGhpbiBhIHNlc3Npb25cclxuICAqIFRoZXNlIHVzZXJzIFVSTHMgYXJlIHJldHVybmVkIGluIGFuIGFycmF5IG9mIHN0cmluZ3MuXHJcbiAgKiBAcmV0dXJuIHtBcnJheTxTdHJpbmc+fSAgICAgICAgIHVzZXJzXHJcbiAgKi9cclxuICBnZXRVc2Vyc0lEcygpIHtcclxuICAgIC8qICBsb2cubG9nKCdbZ2V0VXNlcnNJRHM6ZW1haWxGb3JtYXRdJywgZW1haWxGb3JtYXQpO1xyXG4gICAgICBsb2cubG9nKCdnZXRVc2Vyc0lEczplbWFpbEZvcm1hdCcsIGVtYWlsRm9ybWF0KTtcclxuICAgICAgbGV0IF90aGlzID0gdGhpcztcclxuICAgICAgbGV0IHVzZXJzID0gW107Ki9cclxuXHJcbiAgICAvL2lmIHJlcXVlc3QgY29tZXMgd2l0aCB0aGUgZW1haWxGb3JtYXQgb3B0aW9uLCB0aGVuIGNvbnZlcnQgdXJsIHRvIGVtYWlsIGZvcm1hdFxyXG4gICAgLyogICAgbGV0IGNvbnZlcnRlciA9IChlbWFpbEZvcm1hdCkgPyBnZXRVc2VyRW1haWxGcm9tVVJMIDogKHZhbHVlKSA9PiB7IHJldHVybiB2YWx1ZTsgfTtcclxuXHJcbiAgICBmb3IgKGxldCBpbmRleCBpbiBfdGhpcy5pZGVudGl0aWVzKSB7XHJcbiAgICAgIGxldCBpZGVudGl0eSA9IF90aGlzLmlkZW50aXRpZXNbaW5kZXhdO1xyXG4gICAgICB1c2Vycy5wdXNoKGNvbnZlcnRlcihpZGVudGl0eS5pZGVudGl0eSkpO1xyXG4gICAgfSovXHJcblxyXG4gICAgcmV0dXJuIHRoaXMuaWRlbnRpdGllcy5pZGVudGlmaWVycztcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICogRnVuY3Rpb24gdG8gcmVtb3ZlIGFuIGlkZW50aXR5XHJcbiAgKiBAcGFyYW0ge1N0cmluZ30gICAgdXNlclVSTCAgICAgIHVzZXJVUkxcclxuICAqIEByZXR1cm4ge1Byb21pc2V9XHJcbiAgKi9cclxuXHJcbiAgZGVsZXRlSWRlbnRpdHkodXNlclVSTCkge1xyXG5cclxuICAgIHJldHVybiB0aGlzLmlkZW50aXRpZXMucmVtb3ZlSWRlbnRpdHkodXNlclVSTCk7XHJcblxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgKiBGdW5jdGlvbiB0byB1bnJlZ2lzdGVyIGFuIGlkZW50aXR5IGZyb20gdGhlIGVtYWlsc0xpc3QgYXJyYXkgYW5kIG5vdCBzaG93IGluIHRvIHRoZSBHVUlcclxuICAqIEBwYXJhbSB7U3RyaW5nfSAgICBlbWFpbCAgICAgIGVtYWlsXHJcbiAgKi9cclxuICAvKiAgdW5yZWdpc3RlcklkZW50aXR5KGVtYWlsKSB7XHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG5cclxuICAgIGZvciAobGV0IGUgaW4gX3RoaXMuZW1haWxzTGlzdCkge1xyXG4gICAgICBpZiAoX3RoaXMuZW1haWxzTGlzdFtlXSA9PT0gZW1haWwpIHtcclxuICAgICAgICBfdGhpcy5lbWFpbHNMaXN0LnNwbGljZShlLCAxKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH0qL1xyXG5cclxuICAvLyB0byBiZSB1c2VkIHdoZW4gcnVudGltZSBpcyBub3QgZXhlY3V0ZWQgaW4gYSBzYW5kYm94XHJcblxyXG4gIGxpc3RlblNob3dBZG1pbihjYWxsYmFjaykge1xyXG4gICAgdGhpcy5fc2hvd0FkbWluID0gY2FsbGJhY2s7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAqIEZ1bmN0aW9uIHRoYXQgc2VuZHMgYSByZXF1ZXN0IHRvIHRoZSBHVUkgdXNpbmcgbWVzc2FnZXMuIFNlbmRzIGFsbCBpZGVudGl0aWVzIHJlZ2lzdGVyZWQgYW5kXHJcbiAgKiB0aGUgSWRwcyBzdXBwb3J0ZWQsIGFuZCByZXR1cm4gdGhlIGlkZW50aXR5L2lkcCByZWNlaXZlZCBieSB0aGUgR1VJXHJcbiAgKiBAcGFyYW0ge0FycmF5PGlkZW50aXR5Pn0gIGlkZW50aXRpZXMgICAgICBsaXN0IG9mIGlkZW50aXRpaWVzXHJcbiAgKiBAcGFyYW0ge0FycmF5PFN0cmluZz59ICAgIGlkcHMgICAgICAgICAgICBsaXN0IG9mIGlkcHMgdG8gYXV0aGVudGljYXRlXHJcbiAgKiBAcmV0dXJuIHtQcm9taXNlfSAgICAgICAgIHJldHVybnMgYSBjaG9zZW4gaWRlbnRpdHkgb3IgaWRwXHJcbiAgKi9cclxuICByZXF1ZXN0SWRlbnRpdHlUb0dVSShpZGVudGl0aWVzLCBpZHBzKSB7XHJcbiAgICBsb2cubG9nKCdbSWRlbnRpdHlNb2R1bGUucmVxdWVzdElkZW50aXR5VG9HVUk6aWRlbnRpdGllc10nLCBpZGVudGl0aWVzKTtcclxuICAgIGxvZy5sb2coJ1tJZGVudGl0eU1vZHVsZS5yZXF1ZXN0SWRlbnRpdHlUb0dVSTppZHBzXScsIGlkcHMpO1xyXG5cclxuICAgIGxldCBfdGhpcyA9IHRoaXM7XHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xyXG5cclxuICAgICAgLy9jb25kaXRpb24gdG8gY2hlY2sgaWYgdGhlIHJlYWwgR1VJIGlzIGRlcGxveWVkLiBJZiBub3QsIGRlcGxveXMgYSBmYWtlIGd1aVxyXG4gICAgICBpZiAoX3RoaXMuZ3VpRGVwbG95ZWQgPT09IGZhbHNlKSB7XHJcbiAgICAgICAgbGV0IGd1aUZha2VVUkwgPSBfdGhpcy5fZ3VpVVJMO1xyXG4gICAgICAgIGxldCBndWlGYWtlID0gbmV3IEd1aUZha2UoZ3VpRmFrZVVSTCwgX3RoaXMuX21lc3NhZ2VCdXMpO1xyXG4gICAgICAgIF90aGlzLmd1aUZha2UgPSBndWlGYWtlO1xyXG4gICAgICAgIF90aGlzLmd1aURlcGxveWVkID0gdHJ1ZTtcclxuICAgICAgfVxyXG5cclxuICAgICAgbGV0IG1lc3NhZ2UgPSB7XHJcbiAgICAgICAgdHlwZTogJ2NyZWF0ZScsIHRvOiBfdGhpcy5fZ3VpVVJMLCBmcm9tOiBfdGhpcy5faWRtVVJMLFxyXG4gICAgICAgIGJvZHk6IHsgdmFsdWU6IHsgaWRlbnRpdGllczogaWRlbnRpdGllcywgaWRwczogaWRwcyB9IH1cclxuICAgICAgfTtcclxuXHJcbiAgICAgIGxldCBjYWxsYmFjayA9IG1zZyA9PiB7XHJcbiAgICAgICAgX3RoaXMuX21lc3NhZ2VCdXMucmVtb3ZlUmVzcG9uc2VMaXN0ZW5lcihfdGhpcy5faWRtVVJMLCBtc2cuaWQpO1xyXG5cclxuXHJcbiAgICAgICAgLy8gdG9kbzogdG8gcmV0dXJuIHRoZSB1c2VyIFVSTCBhbmQgbm90IHRoZSBlbWFpbCBvciBpZGVudGlmaWVyXHJcblxyXG4gICAgICAgIGlmIChtc2cuYm9keS5jb2RlID09PSAyMDApIHtcclxuICAgICAgICAgIGxldCBzZWxlY3RlZElkZW50aXR5ID0gbXNnLmJvZHk7XHJcblxyXG4gICAgICAgICAgbG9nLmxvZygnc2VsZWN0ZWRJZGVudGl0eTogJywgc2VsZWN0ZWRJZGVudGl0eS52YWx1ZSk7XHJcbiAgICAgICAgICByZXNvbHZlKHNlbGVjdGVkSWRlbnRpdHkpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICByZWplY3QoJ2Vycm9yIG9uIHJlcXVlc3RpbmcgYW4gaWRlbnRpdHkgdG8gdGhlIEdVSScpO1xyXG4gICAgICAgIH1cclxuICAgICAgfTtcclxuXHJcbiAgICAgIC8vcG9zdE1lc3NhZ2Ugd2l0aCBjYWxsYmFjayBidXQgd2l0aG91dCB0aW1lb3V0XHJcbiAgICAgIHRyeSB7XHJcbiAgICAgICAgX3RoaXMuX21lc3NhZ2VCdXMucG9zdE1lc3NhZ2UobWVzc2FnZSwgY2FsbGJhY2ssIGZhbHNlKTtcclxuICAgICAgfSBjYXRjaCAoZXJyKSB7XHJcbiAgICAgICAgcmVqZWN0KCdJbiBtZXRob2QgY2FsbElkZW50aXR5TW9kdWxlRnVuYyBlcnJvcjogJyArIGVycik7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgY2FsbE5vZGVKc0dlbmVyYXRlTWV0aG9kcyhpZHAsIG9yaWdpbikge1xyXG4gICAgbG9nLmxvZygnW2NhbGxOb2RlSnNHZW5lcmF0ZU1ldGhvZHM6aWRwXScsIGlkcCk7XHJcbiAgICBsb2cubG9nKCdbY2FsbE5vZGVKc0dlbmVyYXRlTWV0aG9kczpvcmlnaW5dJywgb3JpZ2luKTtcclxuICAgIGxldCBfdGhpcyA9IHRoaXM7XHJcblxyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcclxuICAgICAgLy9kZWJ1Z2dlcjtcclxuICAgICAgbGV0IHB1YmxpY0tleTtcclxuXHJcbiAgICAgIC8vbGV0IGtleVBhaXIgPSBub2RlSlNLZXlQYWlyUG9wdWxhdGU7XHJcblxyXG4gICAgICAvL2dlbmVyYXRlcyB0aGUgUlNBIGtleSBwYWlyXHJcbiAgICAgIF90aGlzLl9jcnlwdG8uZ2V0TXlQdWJsaWNLZXkoKS50aGVuKGZ1bmN0aW9uIChrZXkpIHtcclxuXHJcbiAgICAgICAgbG9nLmxvZygnW2NhbGxOb2RlSnNHZW5lcmF0ZU1ldGhvZHM6a2V5XScsIGtleSk7XHJcblxyXG4gICAgICAgIHB1YmxpY0tleSA9IHN0cmluZ2lmeShrZXkpO1xyXG5cclxuICAgICAgICBsb2cubG9nKCdbY2FsbE5vZGVKc0dlbmVyYXRlTWV0aG9kc10gTk9fVVJMJyk7XHJcblxyXG4gICAgICAgIHJldHVybiBfdGhpcy5nZW5lcmF0ZUFzc2VydGlvbihwdWJsaWNLZXksIG9yaWdpbiwgJ3VybCcsIGlkcCk7XHJcblxyXG4gICAgICB9KS50aGVuKGZ1bmN0aW9uICh2YWx1ZSkge1xyXG4gICAgICAgIGlmICh2YWx1ZSkge1xyXG4gICAgICAgICAgcmVzb2x2ZSh2YWx1ZSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIHJlamVjdCgnRXJyb3Igb24gb2J0YWluaW5nIElkZW50aXR5Jyk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZXJyKSB7XHJcbiAgICAgICAgbG9nLmxvZyhlcnIpO1xyXG4gICAgICAgIHJlamVjdChlcnIpO1xyXG5cclxuICAgICAgfSk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIGNhbGxHZW5lcmF0ZU1ldGhvZHMoaWRwLCBvcmlnaW4pIHtcclxuICAgIGxvZy5sb2coJ1tjYWxsR2VuZXJhdGVNZXRob2RzOmlkcF0nLCBpZHApO1xyXG4gICAgbG9nLmxvZygnW2NhbGxHZW5lcmF0ZU1ldGhvZHM6b3JpZ2luXScsIG9yaWdpbik7XHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG5cclxuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XHJcblxyXG4gICAgICBsZXQgcHVibGljS2V5O1xyXG5cclxuICAgICAgLy9nZW5lcmF0ZXMgdGhlIFJTQSBrZXkgcGFpclxyXG4gICAgICBfdGhpcy5fY3J5cHRvLmdldE15UHVibGljS2V5KCkudGhlbihmdW5jdGlvbiAoa2V5KSB7XHJcblxyXG4gICAgICAgIGxvZy5sb2coJ1tjYWxsR2VuZXJhdGVNZXRob2RzOmtleV0nLCBrZXkpO1xyXG5cclxuICAgICAgICBwdWJsaWNLZXkgPSBzdHJpbmdpZnkoa2V5KTtcclxuXHJcbiAgICAgICAgLy8gICAgICAgIHVzZXJrZXlQYWlyID0ga2V5UGFpcjtcclxuICAgICAgICBsb2cubG9nKCdnZW5lcmF0ZUFzc2VydGlvbjpub19oaW50Jyk7XHJcbiAgICAgICAgcmV0dXJuIF90aGlzLmdlbmVyYXRlQXNzZXJ0aW9uKHB1YmxpY0tleSwgb3JpZ2luLCAnJywgaWRwKTtcclxuXHJcbiAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHVybCkge1xyXG4gICAgICAgIF90aGlzLm15SGludCA9IHVybDtcclxuICAgICAgICBsb2cubG9nKCdnZW5lcmF0ZUFzc2VydGlvbjpoaW50Jyk7XHJcbiAgICAgICAgcmV0dXJuIF90aGlzLmdlbmVyYXRlQXNzZXJ0aW9uKHB1YmxpY0tleSwgb3JpZ2luLCB1cmwsIGlkcCk7XHJcblxyXG4gICAgICB9KS50aGVuKGZ1bmN0aW9uICh2YWx1ZSkge1xyXG4gICAgICAgIGlmICh2YWx1ZSkge1xyXG4gICAgICAgICAgcmVzb2x2ZSh2YWx1ZSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIHJlamVjdCgnRXJyb3Igb24gb2J0YWluaW5nIElkZW50aXR5Jyk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZXJyKSB7XHJcbiAgICAgICAgbG9nLmVycm9yKGVycik7XHJcbiAgICAgICAgcmVqZWN0KGVycik7XHJcbiAgICAgIH0pO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuXHJcbiAgbG9naW5TZWxlY3RlZElkZW50aXR5KHB1YmxpY0tleSwgb3JpZ2luLCBpZHAsIGxvZ2luVXJsKSB7XHJcbiAgICBsb2cubG9nKCdbbG9naW5TZWxlY3RlZElkZW50aXR5OnB1YmxpY0tleV0nLCBwdWJsaWNLZXkpO1xyXG4gICAgbG9nLmxvZygnW2xvZ2luU2VsZWN0ZWRJZGVudGl0eTpvcmlnaW5dJywgb3JpZ2luKTtcclxuICAgIGxvZy5sb2coJ1tsb2dpblNlbGVjdGVkSWRlbnRpdHk6aWRwXScsIGlkcCk7XHJcblxyXG4gICAgLy8gICAgbG9nLmxvZygnW2xvZ2luU2VsZWN0ZWRJZGVudGl0eTprZXlQYWlyXScsIGtleVBhaXIpO1xyXG4gICAgbG9nLmxvZygnW2xvZ2luU2VsZWN0ZWRJZGVudGl0eTpsb2dpblVybF0nLCBsb2dpblVybCk7XHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG5cclxuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XHJcbiAgICAgIGxvZy5sb2coJ1tJZGVudGl0eU1vZHVsZV0gb3BlblBvcHVwJyk7XHJcbiAgICAgIF90aGlzLmNhbGxJZGVudGl0eU1vZHVsZUZ1bmMoJ29wZW5Qb3B1cCcsIHsgdXJscmVjZWl2ZWQ6IGxvZ2luVXJsIH0pLnRoZW4oKGlkQ29kZSkgPT4ge1xyXG4gICAgICAgIHJldHVybiBpZENvZGU7XHJcbiAgICAgIH0sIChlcnIpID0+IHtcclxuICAgICAgICBsb2cuZXJyb3IoJ0Vycm9yIHdoaWxlIGxvZ2dpbmcgaW4gZm9yIHRoZSBzZWxlY3RlZCBpZGVudGl0eS4nKTtcclxuICAgICAgICByZXR1cm4gcmVqZWN0KGVycik7XHJcbiAgICAgIH0pLnRoZW4oKGlkQ29kZSkgPT4ge1xyXG4gICAgICAgIF90aGlzLnNlbmRHZW5lcmF0ZU1lc3NhZ2UocHVibGljS2V5LCBvcmlnaW4sIGlkQ29kZSwgaWRwKS50aGVuKChuZXdSZXNwb25zZSkgPT4ge1xyXG4gICAgICAgICAgaWYgKG5ld1Jlc3BvbnNlLmhhc093blByb3BlcnR5KCdhc3NlcnRpb24nKSkge1xyXG4gICAgICAgICAgICBfdGhpcy5pZGVudGl0aWVzLmFkZEFzc2VydGlvbihuZXdSZXNwb25zZSkudGhlbihyZXN1bHQgPT4ge1xyXG4gICAgICAgICAgICAgIHJlc29sdmUoJ0xvZ2luIHdhcyBzdWNjZXNzZnVsbCcpO1xyXG4gICAgICAgICAgICB9KS5jYXRjaChlcnIgPT4geyByZWplY3QoJ0xvZ2luIGhhcyBmYWlsZWQ6JyArIGVycik7IH0pO1xyXG4gICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgbG9nLmVycm9yKCdFcnJvciB3aGlsZSBsb2dnaW5nIGluIGZvciB0aGUgc2VsZWN0ZWQgaWRlbnRpdHkuJyk7XHJcbiAgICAgICAgICAgIHJldHVybiByZWplY3QoJ0NvdWxkIG5vdCBnZW5lcmF0ZSBhIHZhbGlkIGFzc2VydGlvbiBmb3Igc2VsZWN0ZWQgaWRlbnRpdHkuJyk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSkuY2F0Y2goZXJyID0+IHsgcmVqZWN0KCdPbiBsb2dpblNlbGVjdGVkSWRlbnRpdHkgZnJvbSBtZXRob2Qgc2VuZEdlbmVyYXRlTWVzc2FnZSBlcnJvcjogICcgKyBlcnIpOyB9KTtcclxuICAgICAgfSk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG5cclxuICBzZWxlY3RJZGVudGl0eUZvckh5cGVydHkob3JpZ2luLCBpZHAsIGlkSGludCkge1xyXG4gICAgbG9nLmxvZygnW3NlbGVjdElkZW50aXR5Rm9ySHlwZXJ0eTpvcmlnaW5dJywgb3JpZ2luKTtcclxuICAgIGxvZy5sb2coJ1tzZWxlY3RJZGVudGl0eUZvckh5cGVydHk6aWRwXScsIGlkcCk7XHJcbiAgICBsb2cubG9nKCdbc2VsZWN0SWRlbnRpdHlGb3JIeXBlcnR5OmlkSGludF0nLCBpZEhpbnQpO1xyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuXHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xyXG5cclxuICAgICAgLy9nZW5lcmF0ZXMgdGhlIFJTQSBrZXkgcGFpclxyXG4gICAgICBfdGhpcy5fY3J5cHRvLmdldE15UHVibGljS2V5KCkudGhlbihmdW5jdGlvbiAoa2V5KSB7XHJcbiAgICAgICAgbGV0IHB1YmxpY0tleSA9IHN0cmluZ2lmeShrZXkpO1xyXG5cclxuICAgICAgICBfdGhpcy5zZW5kR2VuZXJhdGVNZXNzYWdlKHB1YmxpY0tleSwgb3JpZ2luLCBpZEhpbnQsIGlkcCkudGhlbigocmVzcG9uc2UpID0+IHtcclxuICAgICAgICAgIGlmIChyZXNwb25zZS5oYXNPd25Qcm9wZXJ0eSgnYXNzZXJ0aW9uJykpIHsgLy8gaWRlbnRpdHkgd2FzIGxvZ2dlZCBpbiwganVzdCBzYXZlIGl0XHJcbiAgICAgICAgICAgIF90aGlzLmlkZW50aXRpZXMuYWRkQXNzZXJ0aW9uKHJlc3BvbnNlKS50aGVuKCh2YWx1ZSkgPT4ge1xyXG4gICAgICAgICAgICAgIHJldHVybiByZXNvbHZlKHJlc3BvbnNlKTtcclxuICAgICAgICAgICAgfSwgKGVycikgPT4ge1xyXG4gICAgICAgICAgICAgIHJldHVybiByZWplY3QoZXJyKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLmhhc093blByb3BlcnR5KCdsb2dpblVybCcpKSB7IC8vIGlkZW50aXR5IHdhcyBub3QgbG9nZ2VkIGluXHJcbiAgICAgICAgICAgIF90aGlzLmxvZ2luU2VsZWN0ZWRJZGVudGl0eShwdWJsaWNLZXksIG9yaWdpbiwgaWRwLCByZXNwb25zZS5sb2dpblVybCkudGhlbigodmFsdWUpID0+IHtcclxuICAgICAgICAgICAgICByZXR1cm4gcmVzb2x2ZSh2YWx1ZSk7XHJcbiAgICAgICAgICAgIH0sIChlcnIpID0+IHtcclxuICAgICAgICAgICAgICByZXR1cm4gcmVqZWN0KGVycik7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgfSBlbHNlIHsgLy8geW91IHNob3VsZCBuZXZlciBnZXQgaGVyZSwgaWYgeW91IGRvIHRoZW4gdGhlIElkUCBQcm94eSBpcyBub3Qgd2VsbCBpbXBsZW1lbnRlZFxyXG4gICAgICAgICAgICAvLyBsb2cuZXJyb3IoJ0dlbmVyYXRlQXNzZXJ0aW9uIHJldHVybmVkIGludmFsaWQgcmVzcG9uc2UuJyk7XHJcbiAgICAgICAgICAgIGxvZy5sb2coJ1Byb2NlZWRpbmcgYnkgbG9nZ2luZyBpbi4nKTtcclxuICAgICAgICAgICAgX3RoaXMuY2FsbEdlbmVyYXRlTWV0aG9kcyhpZHAsIG9yaWdpbikudGhlbigodmFsdWUpID0+IHtcclxuICAgICAgICAgICAgICByZXR1cm4gcmVzb2x2ZSh2YWx1ZSk7XHJcbiAgICAgICAgICAgIH0sIChlcnIpID0+IHtcclxuICAgICAgICAgICAgICByZXR1cm4gcmVqZWN0KGVycik7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0pLmNhdGNoKGVyciA9PiB7IHJlamVjdCgnT24gc2VsZWN0SWRlbnRpdHlGb3JIeXBlcnR5IGZyb20gbWV0aG9kIHNlbmRHZW5lcmF0ZU1lc3NhZ2UgZXJyb3I6ICAnICsgZXJyKTsgfSk7XHJcbiAgICAgIH0pLmNhdGNoKGVyciA9PiB7IHJlamVjdCgnT24gc2VsZWN0SWRlbnRpdHlGb3JIeXBlcnR5IGZyb20gbWV0aG9kIGdlbmVyYXRlUlNBS2V5UGFpciBlcnJvcjogICcgKyBlcnIpOyB9KTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgc2VsZWN0SWRlbnRpdHlGcm9tR1VJKG9yaWdpbikge1xyXG4gICAgbG9nLmxvZygnW0lkZW50aXR5TW9kdWxlLnNlbGVjdElkZW50aXR5RnJvbUdVSTpvcmlnaW5dJywgb3JpZ2luKTtcclxuICAgIGxldCBfdGhpcyA9IHRoaXM7XHJcblxyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcclxuXHJcbiAgICAgIHRoaXMuZ2V0SWRlbnRpdGllc1RvQ2hvb3NlKCkudGhlbigoaWRlbnRpdGllc0luZm8pID0+IHtcclxuICAgICAgICByZXR1cm4gX3RoaXMucmVxdWVzdElkZW50aXR5VG9HVUkoaWRlbnRpdGllc0luZm8uaWRlbnRpdGllcywgaWRlbnRpdGllc0luZm8uaWRwcyk7XHJcbiAgICAgIH0pLnRoZW4odmFsdWUgPT4ge1xyXG5cclxuICAgICAgICBpZiAodmFsdWUudHlwZSA9PT0gJ2lkZW50aXR5Jykge1xyXG5cclxuICAgICAgICAgIC8vICBsZXQgY2hvc2VuSUQgPSBnZXRVc2VyVVJMRnJvbUVtYWlsKHZhbHVlLnZhbHVlKTtcclxuICAgICAgICAgIC8vIGhhY2sgd2hpbGUgdGhlIHVzZXIgdXJsIGlzIG5vdCByZXR1cm5lZCBmcm9tIHJlcXVlc3RJZGVudGl0eVRvR1VJO1xyXG5cclxuICAgICAgICAgIC8qICAgICAgICAgIGxldCBjaG9zZW5JRCA9ICd1c2VyOi8vJyArIF90aGlzLmlkZW50aXRpZXMuY3VycmVudElkZW50aXR5LmlkcC5kb21haW4gKyAnLycgKyB2YWx1ZS52YWx1ZTtcclxuXHJcbiAgICAgICAgICBfdGhpcy5pZGVudGl0aWVzLmRlZmF1bHRJZGVudGl0eSA9IF90aGlzLmlkZW50aXRpZXMuY3VycmVudElkZW50aXR5OyovXHJcblxyXG4gICAgICAgICAgLy8gcmV0dXJucyB0aGUgaWRlbnRpdHkgaW5mbyBmcm9tIHRoZSBjaG9zZW4gaWRcclxuICAgICAgICAgIC8vICAgICAgICAgIGlmIChfdGhpcy5pZGVudGl0aWVzLmN1cnJlbnRJZGVudGl0eSkgcmVzb2x2ZShfdGhpcy5pZGVudGl0aWVzLmN1cnJlbnRJZGVudGl0eS5hc3NlcnRpb24pO1xyXG4gICAgICAgICAgaWYgKF90aGlzLmlkZW50aXRpZXMuaWRlbnRpdGllc1t2YWx1ZS52YWx1ZV0pIHJlc29sdmUoX3RoaXMuaWRlbnRpdGllcy5pZGVudGl0aWVzW3ZhbHVlLnZhbHVlXSk7XHJcbiAgICAgICAgICBlbHNlIHJlamVjdCgnW0lkZW50aXR5TW9kdWxlLnNlbGVjdElkZW50aXR5RnJvbUdVSV0gaWRlbnRpdHkgbm90IGZvdW5kOiAnLCB2YWx1ZS52YWx1ZSk7XHJcbiAgICAgICAgfSBlbHNlIGlmICh2YWx1ZS50eXBlID09PSAnaWRwJykge1xyXG5cclxuICAgICAgICAgIF90aGlzLmNhbGxHZW5lcmF0ZU1ldGhvZHModmFsdWUudmFsdWUsIG9yaWdpbikudGhlbigodmFsdWUpID0+IHtcclxuICAgICAgICAgICAgcmV0dXJuIHJlc29sdmUodmFsdWUpO1xyXG4gICAgICAgICAgfSwgKGVycikgPT4ge1xyXG4gICAgICAgICAgICByZXR1cm4gcmVqZWN0KGVycik7XHJcbiAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIHJldHVybiByZWplY3QoJ2Vycm9yIG9uIEdVSSByZWNlaXZlZCBtZXNzYWdlLicpO1xyXG4gICAgICAgIH1cclxuICAgICAgfSkuY2F0Y2goZXJyID0+IHsgcmVqZWN0KCdPbiBzZWxlY3RJZGVudGl0eUZyb21HVUkgZnJvbSBtZXRob2QgcmVxdWVzdElkZW50aXR5VG9HVUkgZXJyb3I6ICAnICsgZXJyKTsgfSk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG5cclxuICBjYWxsSWRlbnRpdHlNb2R1bGVGdW5jKG1ldGhvZE5hbWUsIHBhcmFtZXRlcnMsIGRvbWFpbiwgcmVzb3VyY2UpIHtcclxuICAgIGxvZy5sb2coJ1tjYWxsSWRlbnRpdHlNb2R1bGVGdW5jOm1ldGhvZE5hbWVdJywgbWV0aG9kTmFtZSk7XHJcbiAgICBsb2cubG9nKCdbY2FsbElkZW50aXR5TW9kdWxlRnVuYzpwYXJhbWV0ZXJzXScsIHBhcmFtZXRlcnMpO1xyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuXHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xyXG5cclxuICAgICAgaWYgKF90aGlzLl9zaG93QWRtaW4pIHtcclxuICAgICAgICBpZiAobWV0aG9kTmFtZSA9PT0gJ2dldEFjY2Vzc1Rva2VuJykge1xyXG4gICAgICAgICAgX3RoaXMuX3Nob3dBZG1pbihtZXRob2ROYW1lLCBwYXJhbWV0ZXJzLnVybHJlY2VpdmVkLCBkb21haW4sIHJlc291cmNlKS50aGVuKChyZXN1bHQpID0+IHtcclxuICAgICAgICAgICAgcmVzb2x2ZShyZXN1bHQpO1xyXG4gICAgICAgICAgfSk7XHJcbiAgICAgICAgfSBlbHNlIF90aGlzLl9zaG93QWRtaW4obWV0aG9kTmFtZSk7XHJcbiAgICAgIH1cclxuICAgICAgZWxzZSB7XHJcbiAgICAgICAgbGV0IG1lc3NhZ2UgPSB7XHJcbiAgICAgICAgICB0eXBlOiAnZXhlY3V0ZScsIHRvOiBfdGhpcy5fZ3VpVVJMLCBmcm9tOiBfdGhpcy5faWRtVVJMLFxyXG4gICAgICAgICAgYm9keTogeyByZXNvdXJjZTogJ2lkZW50aXR5JywgbWV0aG9kOiBtZXRob2ROYW1lLCBwYXJhbXM6IHBhcmFtZXRlcnMgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIC8vcG9zdCBtc2cgd2l0aCBjYWxsYmFjayBidXQgd2l0aG91dCB0aW1vdXRcclxuICAgICAgICBsZXQgY2FsbGJhY2sgPSBtc2cgPT4ge1xyXG4gICAgICAgICAgX3RoaXMuX21lc3NhZ2VCdXMucmVtb3ZlUmVzcG9uc2VMaXN0ZW5lcihfdGhpcy5faWRtVVJMLCBtc2cuaWQpO1xyXG4gICAgICAgICAgbGV0IHJlc3VsdCA9IG1zZy5ib2R5LnZhbHVlO1xyXG4gICAgICAgICAgcmVzb2x2ZShyZXN1bHQpO1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgdHJ5IHtcclxuXHJcbiAgICAgICAgICBfdGhpcy5fbWVzc2FnZUJ1cy5wb3N0TWVzc2FnZShtZXNzYWdlLCBjYWxsYmFjaywgZmFsc2UpO1xyXG5cclxuICAgICAgICB9IGNhdGNoIChlcnIpIHtcclxuICAgICAgICAgIHJlamVjdCgnSW4gbWV0aG9kIGNhbGxJZGVudGl0eU1vZHVsZUZ1bmMgZXJyb3I6ICcgKyBlcnIpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLy8qKioqKioqKioqKioqKioqKioqIFRPS0VOIE1FVEhPRFMgKioqKioqKioqKioqKioqKioqKlxyXG4gIC8qKlxyXG4gICogZ2V0IGEgVG9rZW4gdG8gYmUgYWRkZWQgdG8gYSBtZXNzYWdlXHJcbiAgKiBAcGFyYW0gIHtTdHJpbmd9ICBmcm9tVVJMICAgICBvcmlnaW4gb2YgdGhlIG1lc3NhZ2VcclxuICAqIEBwYXJhbSAge1N0cmluZ30gIHRvVVJMICAgICB0YXJnZXQgb2YgdGhlIG1lc3NhZ2Vva1xyXG4gICogQHJldHVybiB7SlNPTn0gICAgdG9rZW4gICAgdG9rZW4gdG8gYmUgYWRkZWQgdG8gdGhlIG1lc3NhZ2VcclxuICAqL1xyXG4gIGdldFRva2VuKG1zZykge1xyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuICAgIGxldCBmcm9tVVJMID0gbXNnLmZyb207XHJcbiAgICBsZXQgdG9VcmwgPSBtc2cudG87XHJcbiAgICBpZiAobXNnLmhhc093blByb3BlcnR5KCdib2R5JykgJiYgbXNnLmJvZHkuaGFzT3duUHJvcGVydHkoJ3NvdXJjZScpKSB7XHJcbiAgICAgIGZyb21VUkwgPSBtc2cuYm9keS5zb3VyY2U7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKG1zZy50eXBlID09PSAnZm9yd2FyZCcpIHtcclxuICAgICAgZnJvbVVSTCA9IG1zZy5ib2R5LmZyb207XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKG1zZy5oYXNPd25Qcm9wZXJ0eSgnYm9keScpICYmIG1zZy5ib2R5Lmhhc093blByb3BlcnR5KCdzdWJzY3JpYmVyJykpIHtcclxuICAgICAgZnJvbVVSTCA9IG1zZy5ib2R5LnN1YnNjcmliZXI7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgbG9nLmxvZygnW0lkZW50aXR5TW9kdWxlLmdldFRva2VuXSBmb3IgbXNnICcsIG1zZyk7XHJcblxyXG4gICAgICAvL2xvZy5sb2coJ3RvVXJsJywgdG9VcmwpO1xyXG4gICAgICBfdGhpcy5yZWdpc3RyeS5pc0xlZ2FjeSh0b1VybCkudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7XHJcbiAgICAgICAgLy8gbG9nLmxvZygnW0lkZW50aXR5LklkZW50aXR5TW9kdWxlLmdldFRva2VuXSBpc0xFR0FDWTogJywgcmVzdWx0KTtcclxuICAgICAgICBpZiAocmVzdWx0KSB7XHJcblxyXG4gICAgICAgICAgX3RoaXMuX2dldEFjY2Vzc1Rva2VuKG1zZykudGhlbigodG9rZW4pID0+IHtcclxuICAgICAgICAgICAgbG9nLmxvZygnW0lkZW50aXR5TW9kdWxlLmdldFRva2VuXSBhY2Nlc3MgdG9rZW4gJywgdG9rZW4pO1xyXG4gICAgICAgICAgICByZXNvbHZlKGRlZXBDbG9uZSh0b2tlbikpO1xyXG4gICAgICAgICAgfSkuY2F0Y2goZXJyID0+IHsgcmVqZWN0KCdbSWRlbnRpdHlNb2R1bGUuZ2V0VG9rZW5dIEFjY2VzcyBUb2tlbiBlcnJvciAnICsgZXJyKTsgfSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIF90aGlzLl9nZXRWYWxpZFRva2VuKGZyb21VUkwpLnRoZW4oKHRva2VuKSA9PiB7XHJcbiAgICAgICAgICAgIHJlc29sdmUodG9rZW4pO1xyXG4gICAgICAgICAgfSkuY2F0Y2goZXJyID0+IHsgcmVqZWN0KCdPbiBnZXRUb2tlbiBmcm9tIG1ldGhvZCBfZ2V0VmFsaWRUb2tlbiBlcnJvcjogJyArIGVycik7IH0pO1xyXG4gICAgICAgIH1cclxuICAgICAgfSkuY2F0Y2goZXJyID0+IHsgcmVqZWN0KCdPbiBnZXRUb2tlbiBmcm9tIG1ldGhvZCBpc0xlZ2FjeSBlcnJvcjogJyArIGVycik7IH0pO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuXHJcbiAgLyoqXHJcbiAgKiBnZXQgYW4gSWQgVG9rZW4gZm9yIGEgSHlwZXJ0eVVSTFxyXG4gICogQHBhcmFtICB7U3RyaW5nfSAgaHlwZXJ0eVVSTCAgICAgdGhlIEh5cGVydHkgYWRkcmVzc1xyXG4gICogQHJldHVybiB7SlNPTn0gICAgdG9rZW4gICAgSWQgdG9rZW4gdG8gYmUgYWRkZWQgdG8gdGhlIG1lc3NhZ2VcclxuICAqL1xyXG4gIGdldElkVG9rZW4oaHlwZXJ0eVVSTCkge1xyXG4gICAgbG9nLmluZm8oJ2dldElkVG9rZW46aHlwZXJ0eVVSTCAnLCBoeXBlcnR5VVJMKTtcclxuICAgIGxldCBfdGhpcyA9IHRoaXM7XHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICBsZXQgc3BsaXRVUkwgPSBoeXBlcnR5VVJMLnNwbGl0KCc6Ly8nKTtcclxuICAgICAgbGV0IHVzZXJVUkw7XHJcbiAgICAgIGlmIChzcGxpdFVSTFswXSAhPT0gJ2h5cGVydHknKSB7IC8vIGl0IGlzIGEgRGF0YSBPYmplY3QgVVJMXHJcblxyXG4gICAgICAgIF90aGlzLl9nZXRIeXBlcnR5RnJvbURhdGFPYmplY3QoaHlwZXJ0eVVSTCkudGhlbigocmV0dXJuZWRIeXBlcnR5VVJMKSA9PiB7XHJcblxyXG4gICAgICAgICAgdXNlclVSTCA9IF90aGlzLnJlZ2lzdHJ5LmdldEh5cGVydHlPd25lcihyZXR1cm5lZEh5cGVydHlVUkwpO1xyXG5cclxuICAgICAgICAgIGlmICh1c2VyVVJMKSB7XHJcbiAgICAgICAgICAgIGxldCBpZGVudGl0eSA9IF90aGlzLmlkZW50aXRpZXMuZ2V0SWRlbnRpdHkodXNlclVSTCk7XHJcbiAgICAgICAgICAgIGlmIChpZGVudGl0eSkgcmV0dXJuIHJlc29sdmUoaWRlbnRpdHkpO1xyXG4gICAgICAgICAgICBlbHNlIHJldHVybiByZWplY3QoJ1tJZGVudGl0eU1vZHVsZS5nZXRJZFRva2VuXSBJZGVudGl0eSBub3QgZm91bmQgZm9yOiAnLCB1c2VyVVJMKTtcclxuICAgICAgICAgIH0gZWxzZSB7IHJldHVybiByZWplY3QoJ1tJZGVudGl0eU1vZHVsZS5nZXRJZFRva2VuXSBVc2VyIG5vdCBmb3VuZCBmb3IgaHlwZXJ0eTogJywgcmV0dXJuZWRIeXBlcnR5VVJMKTsgfVxyXG4gICAgICAgIH0pLmNhdGNoKChyZWFzb24pID0+IHtcclxuICAgICAgICAgIGxvZy5lcnJvcignW0lkZW50aXR5TW9kdWxlLmdldElkVG9rZW5dIEVycm9yOiAnLCByZWFzb24pO1xyXG4gICAgICAgICAgcmVqZWN0KHJlYXNvbik7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgdXNlclVSTCA9IF90aGlzLnJlZ2lzdHJ5LmdldEh5cGVydHlPd25lcihoeXBlcnR5VVJMKTtcclxuICAgICAgICBpZiAodXNlclVSTCkge1xyXG5cclxuICAgICAgICAgIGxldCBpZGVudGl0eSA9IF90aGlzLmlkZW50aXRpZXMuZ2V0SWRlbnRpdHkodXNlclVSTCk7XHJcbiAgICAgICAgICBpZiAoaWRlbnRpdHkpIHJldHVybiByZXNvbHZlKGlkZW50aXR5KTtcclxuICAgICAgICAgIGVsc2UgcmV0dXJuIHJlamVjdCgnW0lkZW50aXR5TW9kdWxlLmdldElkVG9rZW5dIElkZW50aXR5IG5vdCBmb3VuZCBmb3I6ICcsIHVzZXJVUkwpO1xyXG5cclxuICAgICAgICB9IGVsc2UgeyByZXR1cm4gcmVqZWN0KCdbSWRlbnRpdHlNb2R1bGUuZ2V0SWRUb2tlbl0gVXNlciBub3QgZm91bmQgZm9yIGh5cGVydHk6ICcsIHVzZXJVUkwpOyB9XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgKiBnZXQgYW4gQWNjZXNzIFRva2VuIGZvciBhbiBleHRlcm5hbCBBUElcclxuICAqIEBwYXJhbSAge1N0cmluZ30gIHVybCAgICAgdGhlIGV4dGVybmFsIHVybFxyXG4gICogQHJldHVybiB7SlNPTn0gICAgdG9rZW4gICAgQWNjZXNzIHRva2VuIHRvIGJlIGFkZGVkIHRvIHRoZSBtZXNzYWdlXHJcbiAgKi9cclxuICBfZ2V0QWNjZXNzVG9rZW4obXNnKSB7XHJcbiAgICBsZXQgdXJsID0gbXNnLnRvO1xyXG5cclxuICAgIGxldCBfdGhpcyA9IHRoaXM7XHJcblxyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7XHJcbiAgICAgIGlmICghbXNnLmhhc093blByb3BlcnR5KCdib2R5JykpIHtcclxuICAgICAgICByZXR1cm4gcmVqZWN0KCdbSWRlbnRpdHlNb2R1bGUuX2dldEFjY2Vzc1Rva2VuXSBtaXNzaW5nIG1hbmRhdG9yeSBtc2cgYm9keTogJywgbXNnKTtcclxuICAgICAgfVxyXG4gICAgICBpZiAoIW1zZy5ib2R5Lmhhc093blByb3BlcnR5KCd2YWx1ZScpKSB7XHJcbiAgICAgICAgcmV0dXJuIHJlamVjdCgnW0lkZW50aXR5TW9kdWxlLl9nZXRBY2Nlc3NUb2tlbl0gbWlzc2luZyBtYW5kYXRvcnkgbXNnIGJvZHkgdmFsdWU6ICcsIG1zZyk7XHJcbiAgICAgIH1cclxuICAgICAgaWYgKCFtc2cuYm9keS52YWx1ZS5oYXNPd25Qcm9wZXJ0eSgncmVzb3VyY2VzJykpIHtcclxuICAgICAgICByZXR1cm4gcmVqZWN0KCdbSWRlbnRpdHlNb2R1bGUuX2dldEFjY2Vzc1Rva2VuXSBtaXNzaW5nIG1hbmRhdG9yeSBtc2cgYm9keSB2YWx1ZSByZXNvdXJjZXM6ICcsIG1zZyk7XHJcbiAgICAgIH1cclxuICAgICAgbGV0IGRvbWFpblRvQ2hlY2sgPSBkaXZpZGVVUkwodXJsKS5kb21haW47XHJcblxyXG4gICAgICBpZiAodXJsLmluY2x1ZGVzKCdwcm90b3N0dWInKSkge1xyXG4gICAgICAgIGRvbWFpblRvQ2hlY2sgPSBkb21haW5Ub0NoZWNrLnJlcGxhY2UoZG9tYWluVG9DaGVjay5zcGxpdCgnLicpWzBdICsgJy4nLCAnJyk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGxldCByZXNvdXJjZXMgPSBtc2cuYm9keS52YWx1ZS5yZXNvdXJjZXM7XHJcblxyXG4gICAgICBfdGhpcy5fZ2V0QWNjZXNzVG9rZW5Gb3JEb21haW4oZG9tYWluVG9DaGVjaywgcmVzb3VyY2VzKS50aGVuKCh0b2tlbikgPT4ge1xyXG4gICAgICAgIHJlc29sdmUodG9rZW4pO1xyXG4gICAgICB9KTtcclxuXHJcbiAgICB9KTtcclxuXHJcblxyXG5cclxuICB9XHJcblxyXG4gIF9nZXRBY2Nlc3NUb2tlbkZvckRvbWFpbihkb21haW5Ub0NoZWNrLCByZXNvdXJjZXMpIHtcclxuICAgIGxldCBfdGhpcyA9IHRoaXM7XHJcbiAgICBsZXQgdG9rZW47XHJcblxyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcclxuXHJcbiAgICAgIHRyeSB7XHJcbiAgICAgICAgdG9rZW4gPSBfdGhpcy5pZGVudGl0aWVzLmdldEFjY2Vzc1Rva2VuKGRvbWFpblRvQ2hlY2ssIHJlc291cmNlcyk7XHJcbiAgICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgICByZXR1cm4gcmVqZWN0KCdbSWRlbnRpdHlNb2R1bGUuX2dldEFjY2Vzc1Rva2VuRm9yRG9tYWluXSBBY2Nlc3MgVG9rZW4gZXJyb3IgJyArIGVycik7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGlmICghdG9rZW4pIHtcclxuICAgICAgICBfdGhpcy5fZ2V0TmV3QWNjZXNzVG9rZW4oZG9tYWluVG9DaGVjaywgcmVzb3VyY2VzKS50aGVuKCh0b2tlbikgPT4ge1xyXG4gICAgICAgICAgbG9nLmxvZygnW0lkZW50aXR5LklkZW50aXR5TW9kdWxlLl9nZXRBY2Nlc3NUb2tlbkZvckRvbWFpbl0gbmV3IEFjY2VzcyBUb2tlbiAnLCB0b2tlbik7XHJcbiAgICAgICAgICByZXR1cm4gcmVzb2x2ZSh0b2tlbik7XHJcbiAgICAgICAgfSkuY2F0Y2goZXJyID0+IHsgcmVqZWN0KCdbSWRlbnRpdHlNb2R1bGUuX2dldEFjY2Vzc1Rva2VuRm9yRG9tYWluXSBvbiBnZXROZXdBY2Nlc3NUb2tlbiAnICsgZXJyKTsgfSk7XHJcbiAgICAgIH0gZWxzZSBpZiAodG9rZW4uc3RhdHVzID09PSAnaW4tcHJvZ3Jlc3MnKSB7XHJcbiAgICAgICAgcmV0dXJuIHJlc29sdmUoX3RoaXMuX2luUHJvZ3Jlc3NBY2Nlc3NUb2tlbihkb21haW5Ub0NoZWNrLCByZXNvdXJjZXMpKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBsZXQgdGltZU5vdyA9IHNlY29uZHNTaW5jZUVwb2NoKCk7XHJcblxyXG4gICAgICAgIGxvZy5sb2coJ1tJZGVudGl0eS5JZGVudGl0eU1vZHVsZS5fZ2V0QWNjZXNzVG9rZW5Gb3JEb21haW5dIGZvdW5kICBBY2Nlc3MgVG9rZW4gJywgdG9rZW4pO1xyXG5cclxuICAgICAgICBpZiAodGltZU5vdyA+PSB0b2tlbi5leHBpcmVzKSB7XHJcbiAgICAgICAgICAvLyAgICAgICAgaWYgKHRydWUpIHtcclxuICAgICAgICAgIGlmICh0b2tlbi5oYXNPd25Qcm9wZXJ0eShcInJlZnJlc2hcIikpIHtcclxuICAgICAgICAgICAgX3RoaXMuX3JlZnJlc2hBY2Nlc3NUb2tlbihkZWVwQ2xvbmUodG9rZW4pKS50aGVuKChuZXdUb2tlbikgPT4ge1xyXG4gICAgICAgICAgICAgIHJldHVybiByZXNvbHZlKF90aGlzLmlkZW50aXRpZXMudXBkYXRlQWNjZXNzVG9rZW4obmV3VG9rZW4pKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBfdGhpcy5fcmV2b2tlQWNjZXNzVG9rZW4odG9rZW4sIGRvbWFpblRvQ2hlY2ssIHJlc291cmNlcykudGhlbigoKSA9PiB7XHJcbiAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gX3RoaXMuX2dldE5ld0FjY2Vzc1Rva2VuKGRvbWFpblRvQ2hlY2ssIHJlc291cmNlcyk7XHJcblxyXG4gICAgICAgICAgICAgIH0sIDEwMDApO1xyXG5cclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgfSBcclxuXHJcbiAgICAgICAgfSBlbHNlIHJldHVybiByZXNvbHZlKGRlZXBDbG9uZSh0b2tlbikpO1xyXG4gICAgICB9XHJcblxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuXHJcbiAgX3Jldm9rZUFjY2Vzc1Rva2VuKHRva2VuLCBkb21haW4sIHJlc291cmNlcykge1xyXG5cclxuICAgIGxldCBfdGhpcyA9IHRoaXM7XHJcblxyXG4gICAgLy8gICAgbGV0IGRvbWFpbiA9IF90aGlzLl9yZXNvbHZlRG9tYWluKG9sZElkZW50aXR5LmlkcCk7XHJcbiAgICAvLyAgICBsZXQgbWVzc2FnZTtcclxuICAgIC8vICAgIGxldCBhc3NlcnRpb24gPSBfdGhpcy5nZXRJZGVudGl0eShvbGRJZGVudGl0eS51c2VyUHJvZmlsZS51c2VyVVJMKTtcclxuXHJcbiAgICBsb2cubG9nKCdbSWRlbnRpdHlNb2R1bGUuX3Jldm9rZUFjY2Vzc1Rva2VuXSB0byBiZSByZXZva2VkICcsIHRva2VuKTtcclxuXHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xyXG5cclxuLy8gICAgICBsZXQgZG9tYWluID0gX3RoaXMuX3Jlc29sdmVEb21haW4odG9rZW4uZG9tYWluKTtcclxuICAgICAgbGV0IG1lc3NhZ2U7XHJcblxyXG4gICAgICBtZXNzYWdlID0ge1xyXG4gICAgICAgIHR5cGU6ICdleGVjdXRlJyxcclxuICAgICAgICB0bzogX3RoaXMuX3Jlc29sdmVEb21haW4odG9rZW4uZG9tYWluKSxcclxuICAgICAgICBmcm9tOiBfdGhpcy5faWRtVVJMLFxyXG4gICAgICAgIGJvZHk6IHtcclxuICAgICAgICAgIG1ldGhvZDogJ3Jldm9rZUFjY2Vzc1Rva2VuJyxcclxuICAgICAgICAgIHBhcmFtczogeyB0b2tlbjogdG9rZW4gfVxyXG4gICAgICAgIH1cclxuICAgICAgfTtcclxuXHJcbiAgICAgIGxvZy5sb2coJ1tJZGVudGl0eU1vZHVsZS5fcmV2b2tlQWNjZXNzVG9rZW5dIHJldm9rZSBtc2cgJywgbWVzc2FnZSk7XHJcblxyXG4gICAgICB0cnkge1xyXG4gICAgICAgIF90aGlzLl9tZXNzYWdlQnVzLnBvc3RNZXNzYWdlKG1lc3NhZ2UsIChyZXMpID0+IHtcclxuXHJcbiAgICAgICAgICBsZXQgcmVzdWx0ID0gcmVzLmJvZHkudmFsdWU7XHJcbiAgICAgICAgICBpZiAocmVzdWx0KSBfdGhpcy5faWRlbnRpdGllcy5yZW1vdmVBY2Nlc3NUb2tlbihkb21haW4sIHJlc291cmNlcykudGhlbigoKT0+e1xyXG4gICAgICAgICAgICByZXNvbHZlKHJlc3VsdCk7XHJcblxyXG4gICAgICAgICAgfSk7XHJcbiAgICAgICAgICByZXNvbHZlKCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH0gY2F0Y2ggKGVycikge1xyXG4gICAgICAgIHJlamVjdCgnSW4gSWRlbnRpdHlNb2R1bGUuX3Jldm9rZUFjY2Vzc1Rva2VuIG9uIHBvc3RNZXNzYWdlIGVycm9yOiAnICsgZXJyKTtcclxuICAgICAgfVxyXG5cclxuICAgIH0pO1xyXG5cclxuXHJcblxyXG5cclxuICB9XHJcblxyXG5cclxuICBfaW5Qcm9ncmVzc0FjY2Vzc1Rva2VuKGRvbWFpbiwgcmVzb3VyY2VzKSB7XHJcbiAgICB0aGlzLmlkZW50aXRpZXMud2F0Y2hpbmdZb3Uub2JzZXJ2ZSgnYWNjZXNzVG9rZW5zJywgKGNoYW5nZSkgPT4ge1xyXG5cclxuICAgICAgbG9nLmxvZygnW0lkZW50aXR5TW9kdWxlLl9pblByb2dyZXNzQWNjZXNzVG9rZW5dIGFjY2Vzc1Rva2VucyBjaGFuZ2VkICcgKyB0aGlzLmlkZW50aXRpZXMuYWNjZXNzVG9rZW5zKTtcclxuXHJcbiAgICAgIGxldCBrZXlwYXRoID0gY2hhbmdlLmtleXBhdGg7XHJcblxyXG4gICAgICBpZiAoa2V5cGF0aC5pbmNsdWRlcygnc3RhdHVzJykpIHtcclxuICAgICAgICBrZXlwYXRoID0ga2V5cGF0aC5yZXBsYWNlKCcuc3RhdHVzJywgJycpO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBpZiAoa2V5cGF0aCA9PT0gZG9tYWluICYmIGNoYW5nZS5uYW1lID09PSAnc3RhdHVzJyAmJiBjaGFuZ2UubmV3VmFsdWUgPT09ICdjcmVhdGVkJykge1xyXG4gICAgICAgIC8vIGxvZy5sb2coJ1tJZGVudGl0eS5JZGVudGl0eU1vZHVsZS5nZXRUb2tlbl0gdG9rZW4gaXMgY3JlYXRlZCAnICsgX3RoaXMuaWRlbnRpdGllc0xpc3RbZG9tYWluXSk7XHJcbiAgICAgICAgcmV0dXJuICh0aGlzLmlkZW50aXRpZXMuZ2V0QWNjZXNzVG9rZW4oZG9tYWluLCByZXNvdXJjZXMpKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcblxyXG4gIH1cclxuXHJcblxyXG4gIF9nZXROZXdBY2Nlc3NUb2tlbihkb21haW4sIHJlc291cmNlcykge1xyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuXHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xyXG5cclxuICAgICAgX3RoaXMuaWRlbnRpdGllcy5zZXRBY2Nlc3NUb2tlbkluUHJvZ3Jlc3MoZG9tYWluKTtcclxuXHJcbiAgICAgIGxldCBtZXNzYWdlID0ge1xyXG4gICAgICAgIHR5cGU6ICdleGVjdXRlJyxcclxuICAgICAgICB0bzogX3RoaXMuX3Jlc29sdmVEb21haW4oZG9tYWluKSxcclxuICAgICAgICBmcm9tOiBfdGhpcy5faWRtVVJMLFxyXG4gICAgICAgIGJvZHk6IHtcclxuICAgICAgICAgIG1ldGhvZDogJ2dldEFjY2Vzc1Rva2VuQXV0aG9yaXNhdGlvbkVuZHBvaW50JyxcclxuICAgICAgICAgIHBhcmFtczogcmVzb3VyY2VzXHJcbiAgICAgICAgfVxyXG4gICAgICB9O1xyXG5cclxuICAgICAgLy9sZXQncyBmaXJzdCBnZXQgdGhlIGF1dGhvcmlzYXRpb24gVVJMIGZyb20gdGhlIElkcCBQcm94eVxyXG4gICAgICBfdGhpcy5fbWVzc2FnZUJ1cy5wb3N0TWVzc2FnZShtZXNzYWdlLCAocmVzKSA9PiB7XHJcbiAgICAgICAgaWYgKHJlcy5ib2R5LmNvZGUgPiAyOTkpIHtcclxuICAgICAgICAgIHJldHVybiByZWplY3QoJ1tJZGVudGl0eU1vZHVsZS5fZ2V0TmV3QWNjZXNzVG9rZW5dIEVycm9yIG9uIGdldEFjY2Vzc1Rva2VuQXV0aG9yaXNhdGlvbkVuZHBvaW50IGZyb20gSWRQIFByb3h5OiAnLCByZXMuYm9keS5kZXNjKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIGxldCdzIGFzayB0aGUgdXNlciBmb3IgYXV0aG9yaXNhdGlvblxyXG4gICAgICAgIF90aGlzLmNhbGxJZGVudGl0eU1vZHVsZUZ1bmMoJ2dldEFjY2Vzc1Rva2VuJywgeyB1cmxyZWNlaXZlZDogcmVzLmJvZHkudmFsdWUgfSwgZG9tYWluLCByZXNvdXJjZXNbMF0pLnRoZW4oKGF1dGhvcmlzYXRpb24pID0+IHtcclxuICAgICAgICAgIGxvZy5sb2coJ1tJZGVudGl0eU1vZHVsZTpjYWxsSWRlbnRpdHlNb2R1bGVGdW5jOm9wZW5Qb3B1cF0gYXVodG9yaXNhdGlvbiByZXN1bHQ6ICcsIGF1dGhvcmlzYXRpb24pO1xyXG5cclxuICAgICAgICAgIG1lc3NhZ2UuYm9keS5tZXRob2QgPSAnZ2V0QWNjZXNzVG9rZW4nO1xyXG4gICAgICAgICAgbWVzc2FnZS5ib2R5LnBhcmFtcyA9IHtcclxuICAgICAgICAgICAgcmVzb3VyY2VzOiByZXNvdXJjZXMsXHJcbiAgICAgICAgICAgIGxvZ2luOiBhdXRob3Jpc2F0aW9uXHJcbiAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgIC8vd2lodG91dCBjYWxsYmFjayB0byBhdm9pZCB0aW1lb3V0IGVycm9ycz9cclxuXHJcbiAgICAgICAgICAvLyBsZXQncyBhc2sgQWNjZXNzIFRva2VuIGZyb20gdGhlIElkcCBQcm94eVxyXG4gICAgICAgICAgX3RoaXMuX21lc3NhZ2VCdXMucG9zdE1lc3NhZ2UobWVzc2FnZSwgKHJlcykgPT4ge1xyXG4gICAgICAgICAgICBpZiAocmVzLmJvZHkuY29kZSA+IDI5OSkgcmV0dXJuIHJlamVjdCgnW0lkZW50aXR5TW9kdWxlLl9nZXROZXdBY2Nlc3NUb2tlbl0gRXJyb3Igb24gZ2V0QWNjZXNzVG9rZW4gZnJvbSBJZFAgUHJveHk6ICcsIHJlcy5ib2R5LmRlc2MpO1xyXG5cclxuICAgICAgICAgICAgX3RoaXMuaWRlbnRpdGllcy5hZGRBY2Nlc3NUb2tlbihyZXMuYm9keS52YWx1ZSkudGhlbigodG9rZW4pID0+IHtcclxuICAgICAgICAgICAgICBsb2cuaW5mbygnW0lkZW50aXR5TW9kdWxlLl9nZXROZXdBY2Nlc3NUb2tlbl0gcmVzb2x2aW5nIHRva2VuOiAnLCB0b2tlbik7XHJcbiAgICAgICAgICAgICAgcmV0dXJuIHJlc29sdmUocmVzLmJvZHkudmFsdWUpO1xyXG5cclxuICAgICAgICAgICAgfSwgKGVycikgPT4ge1xyXG4gICAgICAgICAgICAgIHJlamVjdChlcnIpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0sIChlcnIpID0+IHtcclxuICAgICAgICAgIHJlamVjdChlcnIpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgfSk7XHJcblxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuXHJcbiAgX3JlZnJlc2hBY2Nlc3NUb2tlbihvdXRkYXRlZFRva2VuKSB7XHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG5cclxuICAgIC8vICAgIGxldCBkb21haW4gPSBfdGhpcy5fcmVzb2x2ZURvbWFpbihvbGRJZGVudGl0eS5pZHApO1xyXG4gICAgLy8gICAgbGV0IG1lc3NhZ2U7XHJcbiAgICAvLyAgICBsZXQgYXNzZXJ0aW9uID0gX3RoaXMuZ2V0SWRlbnRpdHkob2xkSWRlbnRpdHkudXNlclByb2ZpbGUudXNlclVSTCk7XHJcblxyXG4gICAgbG9nLmxvZygnSWRlbnRpdHlNb2R1bGUuX3JlZnJlc2hBY2Nlc3NUb2tlbjpvdXRkYXRlZFRva2VuJywgb3V0ZGF0ZWRUb2tlbik7XHJcblxyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcclxuXHJcbiAgICAgIGxldCBkb21haW4gPSBfdGhpcy5fcmVzb2x2ZURvbWFpbihvdXRkYXRlZFRva2VuLmRvbWFpbik7XHJcbiAgICAgIGxldCBtZXNzYWdlO1xyXG5cclxuICAgICAgbWVzc2FnZSA9IHsgdHlwZTogJ2V4ZWN1dGUnLCB0bzogZG9tYWluLCBmcm9tOiBfdGhpcy5faWRtVVJMLCBib2R5OiB7IG1ldGhvZDogJ3JlZnJlc2hBY2Nlc3NUb2tlbicsIHBhcmFtczogeyB0b2tlbjogb3V0ZGF0ZWRUb2tlbiB9IH0gfTtcclxuICAgICAgdHJ5IHtcclxuICAgICAgICBfdGhpcy5fbWVzc2FnZUJ1cy5wb3N0TWVzc2FnZShtZXNzYWdlLCAocmVzKSA9PiB7XHJcbiAgICAgICAgICBsZXQgcmVzdWx0ID0gcmVzLmJvZHkudmFsdWU7XHJcbiAgICAgICAgICByZXNvbHZlKHJlc3VsdCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH0gY2F0Y2ggKGVycikge1xyXG4gICAgICAgIHJlamVjdCgnSW4gSWRlbnRpdHlNb2R1bGUuX3JlZnJlc2hBY2Nlc3NUb2tlbiBvbiBwb3N0TWVzc2FnZSBlcnJvcjogJyArIGVycik7XHJcbiAgICAgIH1cclxuXHJcbiAgICB9KTtcclxuXHJcbiAgfVxyXG5cclxuICBzZW5kUmVmcmVzaE1lc3NhZ2Uob2xkSWRlbnRpdHkpIHtcclxuICAgIGxldCBfdGhpcyA9IHRoaXM7XHJcblxyXG4gICAgLy8gICAgbGV0IGRvbWFpbiA9IF90aGlzLl9yZXNvbHZlRG9tYWluKG9sZElkZW50aXR5LmlkcCk7XHJcbiAgICAvLyAgICBsZXQgbWVzc2FnZTtcclxuICAgIC8vICAgIGxldCBhc3NlcnRpb24gPSBfdGhpcy5nZXRJZGVudGl0eShvbGRJZGVudGl0eS51c2VyUHJvZmlsZS51c2VyVVJMKTtcclxuXHJcbiAgICBsb2cubG9nKCdzZW5kUmVmcmVzaE1lc3NhZ2U6b2xkSWRlbnRpdHknLCBvbGRJZGVudGl0eSk7XHJcblxyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcclxuICAgICAgbGV0IGRvbWFpbiA9IF90aGlzLl9yZXNvbHZlRG9tYWluKG9sZElkZW50aXR5LmlkcC5kb21haW4pO1xyXG4gICAgICBsZXQgbWVzc2FnZTtcclxuICAgICAgbGV0IGFzc2VydGlvbiA9IF90aGlzLmdldElkZW50aXR5KG9sZElkZW50aXR5LnVzZXJQcm9maWxlLnVzZXJVUkwpO1xyXG5cclxuICAgICAgbG9nLmluZm8oJ3NlbmRSZWZyZXNoTWVzc2FnZTpvbGRJZGVudGl0eScsIG9sZElkZW50aXR5KTtcclxuXHJcbiAgICAgIG1lc3NhZ2UgPSB7IHR5cGU6ICdleGVjdXRlJywgdG86IGRvbWFpbiwgZnJvbTogX3RoaXMuX2lkbVVSTCwgYm9keTogeyByZXNvdXJjZTogJ2lkZW50aXR5JywgbWV0aG9kOiAncmVmcmVzaEFzc2VydGlvbicsIHBhcmFtczogeyBpZGVudGl0eTogYXNzZXJ0aW9uIH0gfSB9O1xyXG4gICAgICB0cnkge1xyXG4gICAgICAgIF90aGlzLl9tZXNzYWdlQnVzLnBvc3RNZXNzYWdlKG1lc3NhZ2UsIChyZXMpID0+IHtcclxuICAgICAgICAgIGlmIChyZXMuYm9keS5jb2RlIDwgMzAwKSB7XHJcbiAgICAgICAgICAgIGxldCByZXN1bHQgPSByZXMuYm9keS52YWx1ZTtcclxuICAgICAgICAgICAgcmVzb2x2ZShyZXN1bHQpO1xyXG4gICAgICAgICAgfSBlbHNlIHJlc29sdmUob2xkSWRlbnRpdHkpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICB9IGNhdGNoIChlcnIpIHtcclxuICAgICAgICByZWplY3QoJ0luIHNlbmRSZWZyZXNoTWVzc2FnZSBvbiBwb3N0TWVzc2FnZSBlcnJvcjogJyArIGVycik7XHJcbiAgICAgIH1cclxuXHJcbiAgICB9KTtcclxuXHJcbiAgfVxyXG5cclxuICBnZXRBY2Nlc3NUb2tlbihpZHBEb21haW4sIHJlc291cmNlcywgbG9naW4pIHtcclxuICAgIGxvZy5sb2coJ1tnZXRBY2Nlc3NUb2tlbjppZHBEb21haW5dJywgaWRwRG9tYWluKTtcclxuICAgIGxldCBfdGhpcyA9IHRoaXM7XHJcblxyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcclxuXHJcbiAgICAgIGxldCBkb21haW4gPSBfdGhpcy5fcmVzb2x2ZURvbWFpbihpZHBEb21haW4pO1xyXG4gICAgICBsZXQgbWVzc2FnZTtcclxuXHJcbiAgICAgIG1lc3NhZ2UgPSB7XHJcbiAgICAgICAgdHlwZTogJ2V4ZWN1dGUnLCB0bzogZG9tYWluLCBmcm9tOiBfdGhpcy5faWRtVVJMLCBib2R5OiB7IHJlc291cmNlOiAnaWRlbnRpdHknLCBtZXRob2Q6ICdnZXRBY2Nlc3NUb2tlbicsIHBhcmFtczogeyByZXNvdXJjZXM6IHJlc291cmNlcywgbG9naW46IGxvZ2luIH0gfVxyXG4gICAgICB9O1xyXG4gICAgICB0cnkge1xyXG4gICAgICAgIF90aGlzLl9tZXNzYWdlQnVzLnBvc3RNZXNzYWdlKG1lc3NhZ2UsIChyZXMpID0+IHtcclxuXHJcbiAgICAgICAgICBpZiAocmVzLmJvZHkuY29kZSA8IDI5OSkge1xyXG4gICAgICAgICAgICBsZXQgcmVzdWx0ID0gcmVzLmJvZHkudmFsdWU7XHJcbiAgICAgICAgICAgIHJlc29sdmUocmVzdWx0KTtcclxuICAgICAgICAgIH0gZWxzZSByZXNvbHZlKHJlcy5ib2R5KTtcclxuICAgICAgICB9KTtcclxuICAgICAgfSBjYXRjaCAoZXJyKSB7XHJcbiAgICAgICAgcmVqZWN0KCdJZGVudGl0eU1vZHVsZS5JbiBnZXRBY2Nlc3NUb2tlbjogJyArIGVycik7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgZ2V0QWNjZXNzVG9rZW5BdXRob3Jpc2F0aW9uRW5kcG9pbnQoc2NvcGUsIGlkcERvbWFpbikge1xyXG4gICAgbG9nLmxvZygnW2dldEFjY2Vzc1Rva2VuQXV0aG9yaXNhdGlvbkVuZHBvaW50OmlkcERvbWFpbl0nLCBpZHBEb21haW4pO1xyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuXHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xyXG5cclxuICAgICAgbGV0IGRvbWFpbiA9IF90aGlzLl9yZXNvbHZlRG9tYWluKGlkcERvbWFpbik7XHJcbiAgICAgIGxldCBtZXNzYWdlO1xyXG5cclxuICAgICAgbWVzc2FnZSA9IHtcclxuICAgICAgICB0eXBlOiAnZXhlY3V0ZScsIHRvOiBkb21haW4sIGZyb206IF90aGlzLl9pZG1VUkwsIGJvZHk6IHsgcmVzb3VyY2U6ICdpZGVudGl0eScsIG1ldGhvZDogJ2dldEFjY2Vzc1Rva2VuQXV0aG9yaXNhdGlvbkVuZHBvaW50JywgcGFyYW1zOiB7IHJlc291cmNlczogc2NvcGUgfSB9XHJcbiAgICAgIH07XHJcbiAgICAgIHRyeSB7XHJcbiAgICAgICAgX3RoaXMuX21lc3NhZ2VCdXMucG9zdE1lc3NhZ2UobWVzc2FnZSwgKHJlcykgPT4ge1xyXG4gICAgICAgICAgbGV0IHJlc3VsdCA9IHJlcy5ib2R5LnZhbHVlO1xyXG4gICAgICAgICAgcmVzb2x2ZShyZXN1bHQpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICB9IGNhdGNoIChlcnIpIHtcclxuICAgICAgICByZWplY3QoJ0luIGdldEFjY2Vzc1Rva2VuQXV0aG9yaXNhdGlvbkVuZHBvaW50OiAnICsgZXJyKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBzZW5kR2VuZXJhdGVNZXNzYWdlKGNvbnRlbnRzLCBvcmlnaW4sIHVzZXJuYW1lSGludCwgaWRwRG9tYWluKSB7XHJcbiAgICBsb2cubG9nKCdbc2VuZEdlbmVyYXRlTWVzc2FnZTpjb250ZW50c10nLCBjb250ZW50cyk7XHJcbiAgICBsb2cubG9nKCdbc2VuZEdlbmVyYXRlTWVzc2FnZTpvcmlnaW5dJywgb3JpZ2luKTtcclxuICAgIGxvZy5sb2coJ1tzZW5kR2VuZXJhdGVNZXNzYWdlOnVzZXJuYW1lSGludF0nLCB1c2VybmFtZUhpbnQpO1xyXG4gICAgbG9nLmxvZygnW3NlbmRHZW5lcmF0ZU1lc3NhZ2U6aWRwRG9tYWluXScsIGlkcERvbWFpbik7XHJcbiAgICBsb2cubG9nKCdzZW5kR2VuZXJhdGVNZXNzYWdlX2hpbnQnKTtcclxuICAgIGxldCBfdGhpcyA9IHRoaXM7XHJcblxyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcclxuXHJcbiAgICAgIGxldCBkb21haW4gPSBfdGhpcy5fcmVzb2x2ZURvbWFpbihpZHBEb21haW4pO1xyXG4gICAgICBsZXQgbWVzc2FnZTtcclxuXHJcbiAgICAgIG1lc3NhZ2UgPSB7XHJcbiAgICAgICAgdHlwZTogJ2V4ZWN1dGUnLCB0bzogZG9tYWluLCBmcm9tOiBfdGhpcy5faWRtVVJMLCBib2R5OiB7IHJlc291cmNlOiAnaWRlbnRpdHknLCBtZXRob2Q6ICdnZW5lcmF0ZUFzc2VydGlvbicsIHBhcmFtczogeyBjb250ZW50czogY29udGVudHMsIG9yaWdpbjogb3JpZ2luLCB1c2VybmFtZUhpbnQ6IHVzZXJuYW1lSGludCB9IH1cclxuICAgICAgfTtcclxuICAgICAgdHJ5IHtcclxuICAgICAgICBfdGhpcy5fbWVzc2FnZUJ1cy5wb3N0TWVzc2FnZShtZXNzYWdlLCAocmVzKSA9PiB7XHJcblxyXG4gICAgICAgICAgaWYgKHJlcy5ib2R5LmNvZGUgPCAzMDApIHJlc29sdmUocmVzLmJvZHkudmFsdWUpO1xyXG4gICAgICAgICAgZWxzZSByZWplY3QocmVzLmJvZHkpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICB9IGNhdGNoIChlcnIpIHtcclxuICAgICAgICByZWplY3QoJ0luIHNlbmRHZW5lcmF0ZU1lc3NhZ2U6ICcgKyBlcnIpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICogUmVxdWVzdHMgdGhlIElkcFByb3h5IGZyb20gYSBnaXZlbiBEb21haW4gZm9yIGFuIGlkZW50aXR5QXNzZXJ0aW9uXHJcbiAgKlxyXG4gICogQHBhcmFtICB7RE9NU3RyaW5nfSBjb250ZW50cyAgICAgY29udGVudHNcclxuICAqIEBwYXJhbSAge0RPTVN0cmluZ30gb3JpZ2luICAgICAgIG9yaWdpblxyXG4gICogQHBhcmFtICB7RE9NU3RyaW5nfSB1c2VybmFtZUhpbnQgdXNlcm5hbWVIaW50XHJcbiAgKiBAcGFyYW0gIHtKU09OfSAgICAgIGtleVBhaXIgICAgICAgdXNlciBrZXlQYWlyXHJcbiAgKiBAcmV0dXJuIHtJZEFzc2VydGlvbn0gICAgICAgICAgICAgIElkQXNzZXJ0aW9uXHJcbiAgKi9cclxuICBnZW5lcmF0ZUFzc2VydGlvbihjb250ZW50cywgb3JpZ2luLCB1c2VybmFtZUhpbnQsIGlkcERvbWFpbikge1xyXG4gICAgbG9nLmxvZygnW2dlbmVyYXRlQXNzZXJ0aW9uOmNvbnRlbnRzXScsIGNvbnRlbnRzKTtcclxuICAgIGxvZy5sb2coJ1tnZW5lcmF0ZUFzc2VydGlvbjpvcmlnaW5dJywgb3JpZ2luKTtcclxuICAgIGxvZy5sb2coJ1tnZW5lcmF0ZUFzc2VydGlvbjp1c2VybmFtZUhpbnRdJywgdXNlcm5hbWVIaW50KTtcclxuXHJcbiAgICAvLyAgICBsb2cubG9nKCdbZ2VuZXJhdGVBc3NlcnRpb246a2V5UGFpcl0nLCBrZXlQYWlyKTtcclxuICAgIGxvZy5sb2coJ1tnZW5lcmF0ZUFzc2VydGlvbjppZHBEb21haW5dJywgaWRwRG9tYWluKTtcclxuICAgIGxldCBfdGhpcyA9IHRoaXM7XHJcblxyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgbG9nLmxvZygnW0lkZW50aXR5TW9kdWxlOnNlbmRHZW5lcmF0ZU1lc3NhZ2U6c2VuZEdlbmVyYXRlTWVzc2FnZV0nLCB1c2VybmFtZUhpbnQpO1xyXG4gICAgICBfdGhpcy5zZW5kR2VuZXJhdGVNZXNzYWdlKGNvbnRlbnRzLCBvcmlnaW4sIHVzZXJuYW1lSGludCwgaWRwRG9tYWluKS50aGVuKChyZXN1bHQpID0+IHtcclxuXHJcbiAgICAgICAgaWYgKHJlc3VsdCkge1xyXG5cclxuICAgICAgICAgIF90aGlzLmlkZW50aXRpZXMuYWRkQXNzZXJ0aW9uKHJlc3VsdCkudGhlbigodmFsdWUpID0+IHtcclxuICAgICAgICAgICAgcmVzb2x2ZShyZXN1bHQpO1xyXG4gICAgICAgICAgfSwgKGVycikgPT4ge1xyXG4gICAgICAgICAgICByZWplY3QoZXJyKTtcclxuICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgcmVqZWN0KCdlcnJvciBvbiBvYnRhaW5pbmcgaWRlbnRpdHkgaW5mb3JtYXRpb24nKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICB9LCAoZXJyb3IpID0+IHtcclxuICAgICAgICBpZiAoZXJyb3IuaGFzT3duUHJvcGVydHkoJ2Rlc2NyaXB0aW9uJykgJiYgZXJyb3IuZGVzY3JpcHRpb24uaGFzT3duUHJvcGVydHkoJ2xvZ2luVXJsJykpIHtcclxuICAgICAgICAgIF90aGlzLmNhbGxJZGVudGl0eU1vZHVsZUZ1bmMoJ2xvZ2luJywgeyB1cmxyZWNlaXZlZDogZXJyb3IuZGVzY3JpcHRpb24ubG9naW5VcmwgfSkudGhlbigodmFsdWUpID0+IHtcclxuICAgICAgICAgICAgbG9nLmxvZygnW0lkZW50aXR5TW9kdWxlOmNhbGxJZGVudGl0eU1vZHVsZUZ1bmM6b3BlblBvcHVwXScsIHVzZXJuYW1lSGludCk7XHJcblxyXG4gICAgICAgICAgICByZXNvbHZlKHZhbHVlKTtcclxuICAgICAgICAgIH0sIChlcnIpID0+IHtcclxuICAgICAgICAgICAgcmVqZWN0KGVycik7XHJcbiAgICAgICAgICB9KTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgbG9nLmVycm9yKCdbSWRlbnRpdHlNb2R1bGU6c2VuZEdlbmVyYXRlTWVzc2FnZV0gZ2VuZXJhdGUgYXNzZXJ0aW9uIHdpdGggaGludCBlcnJvciAnLCBlcnJvcik7XHJcbiAgICAgICAgICByZWplY3QoZXJyb3IpO1xyXG4gICAgICAgIH1cclxuICAgICAgfSkuY2F0Y2goZXJyID0+IHsgcmVqZWN0KCdPbiBnZW5lcmF0ZUFzc2VydGlvbiBmcm9tIG1ldGhvZCBzZW5kR2VuZXJhdGVNZXNzYWdlIGVycm9yOiAnICsgZXJyKTsgfSk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICogUmVxdWVzdHMgdGhlIElkcFByb3h5IGZyb20gYSBnaXZlbiBEb21haW4gdG8gdmFsaWRhdGUgYW4gSWRlbnRpdHlBc3NlcnRpb25cclxuICAqIFJldHVybnMgYSBwcm9taXNlIHdpdGggdGhlIHJlc3VsdCBmcm9tIHRoZSB2YWxpZGF0aW9uLlxyXG4gICogQHBhcmFtICB7RE9NU3RyaW5nfSBhc3NlcnRpb25cclxuICAqIEBwYXJhbSAge0RPTVN0cmluZ30gb3JpZ2luICAgICAgIG9yaWdpblxyXG4gICogQHJldHVybiB7UHJvbWlzZX0gICAgICAgICBQcm9taXNlICAgICAgICAgcHJvbWlzZSB3aXRoIHRoZSByZXN1bHQgZnJvbSB0aGUgdmFsaWRhdGlvblxyXG4gICovXHJcbiAgdmFsaWRhdGVBc3NlcnRpb24oYXNzZXJ0aW9uLCBvcmlnaW4sIGlkcERvbWFpbikge1xyXG4gICAgbG9nLmxvZygnW3ZhbGlkYXRlQXNzZXJ0aW9uOmFzc2VydGlvbl0nLCBhc3NlcnRpb24pO1xyXG4gICAgbG9nLmxvZygnW3ZhbGlkYXRlQXNzZXJ0aW9uOm9yaWdpbl0nLCBvcmlnaW4pO1xyXG4gICAgbG9nLmxvZygnW3ZhbGlkYXRlQXNzZXJ0aW9uOmlkcERvbWFpbl0nLCBpZHBEb21haW4pO1xyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuXHJcbiAgICBsZXQgZG9tYWluID0gX3RoaXMuX3Jlc29sdmVEb21haW4oaWRwRG9tYWluKTtcclxuXHJcbiAgICBsZXQgbWVzc2FnZSA9IHtcclxuICAgICAgdHlwZTogJ2V4ZWN1dGUnLCB0bzogZG9tYWluLCBmcm9tOiBfdGhpcy5faWRtVVJMLCBib2R5OiB7XHJcbiAgICAgICAgcmVzb3VyY2U6ICdpZGVudGl0eScsIG1ldGhvZDogJ3ZhbGlkYXRlQXNzZXJ0aW9uJyxcclxuICAgICAgICBwYXJhbXM6IHsgYXNzZXJ0aW9uOiBhc3NlcnRpb24sIG9yaWdpbjogb3JpZ2luIH1cclxuICAgICAgfVxyXG4gICAgfTtcclxuXHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICB0cnkge1xyXG4gICAgICAgIF90aGlzLl9tZXNzYWdlQnVzLnBvc3RNZXNzYWdlKG1lc3NhZ2UsIChyZXN1bHQpID0+IHtcclxuICAgICAgICAgIGlmIChyZXN1bHQuYm9keS5jb2RlID09PSAyMDApIHtcclxuICAgICAgICAgICAgcmVzb2x2ZShyZXN1bHQuYm9keS52YWx1ZSk7XHJcbiAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICByZWplY3QoJ2Vycm9yJywgcmVzdWx0LmJvZHkuY29kZSk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH0gY2F0Y2ggKGVycikge1xyXG4gICAgICAgIHJlamVjdCgnT24gdmFsaWRhdGVBc3NlcnRpb24gZnJvbSBtZXRob2QgcG9zdE1lc3NhZ2UgZXJyb3I6ICcgKyBlcnIpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIGFkZEdVSUxpc3RlbmVycygpIHtcclxuICAgIGxldCBfdGhpcyA9IHRoaXM7XHJcblxyXG4gICAgX3RoaXMuX21lc3NhZ2VCdXMuYWRkTGlzdGVuZXIoX3RoaXMuX2lkbVVSTCwgKG1zZykgPT4ge1xyXG4gICAgICBsZXQgZnVuY05hbWUgPSBtc2cuYm9keS5tZXRob2Q7XHJcblxyXG4gICAgICBsb2cubG9nKCdbSWRlbnRpdHlNb2R1bGU6YWRkR1VJTGlzdGVuZXJzXScsIG1zZywgbXNnLmJvZHksIGZ1bmNOYW1lKTtcclxuXHJcbiAgICAgIGxldCByZXR1cm5lZFZhbHVlO1xyXG5cclxuICAgICAgaWYgKGZ1bmNOYW1lID09PSAnZGVwbG95R1VJJykge1xyXG4gICAgICAgIHJldHVybmVkVmFsdWUgPSBfdGhpcy5kZXBsb3lHVUkoKTtcclxuICAgICAgfSBlbHNlIGlmIChmdW5jTmFtZSA9PT0gJ2dldElkZW50aXRpZXNUb0Nob29zZScpIHtcclxuICAgICAgICBfdGhpcy5nZXRJZGVudGl0aWVzVG9DaG9vc2UoKS50aGVuKChyZXN1bHQpID0+IHtcclxuICAgICAgICAgIC8vIGlmIHRoZSBmdW5jdGlvbiByZXF1ZXN0ZWQgaXMgbm90IGEgcHJvbWlzZVxyXG4gICAgICAgICAgbGV0IHZhbHVlID0geyB0eXBlOiAnZXhlY3V0ZScsIHZhbHVlOiByZXN1bHQsIGNvZGU6IDIwMCB9O1xyXG4gICAgICAgICAgbGV0IHJlcGx5TXNnID0geyBpZDogbXNnLmlkLCB0eXBlOiAncmVzcG9uc2UnLCB0bzogbXNnLmZyb20sIGZyb206IG1zZy50bywgYm9keTogdmFsdWUgfTtcclxuICAgICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgIF90aGlzLl9tZXNzYWdlQnVzLnBvc3RNZXNzYWdlKHJlcGx5TXNnKTtcclxuICAgICAgICAgIH0gY2F0Y2ggKGVycikge1xyXG4gICAgICAgICAgICBsb2cuZXJyb3IoJ09uIGFkZEdVSUxpc3RlbmVycyBmcm9tIGlmIHN0b3JlSWRlbnRpdHkgbWV0aG9kIHBvc3RNZXNzYWdlIGVycm9yOiAnICsgZXJyKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgICByZXR1cm47XHJcblxyXG4gICAgICB9IGVsc2UgaWYgKGZ1bmNOYW1lID09PSAndW5yZWdpc3RlcklkZW50aXR5Jykge1xyXG4gICAgICAgIGxldCBlbWFpbCA9IG1zZy5ib2R5LnBhcmFtcy5lbWFpbDtcclxuICAgICAgICByZXR1cm5lZFZhbHVlID0gX3RoaXMudW5yZWdpc3RlcklkZW50aXR5KGVtYWlsKTtcclxuICAgICAgfSBlbHNlIGlmIChmdW5jTmFtZSA9PT0gJ2dldE15UHVibGljS2V5Jykge1xyXG4gICAgICAgIC8vIGJlY2F1c2UgZ2VuZXJhdGVSU0FLZXlQYWlyIGlzIGEgcHJvbWlzZVxyXG4gICAgICAgIC8vIHdlIGhhdmUgdG8gc2VuZCB0aGUgbWVzc2FnZSBvbmx5IGFmdGVyIGdldHRpbmcgdGhlIGtleSBwYWlyXHJcbiAgICAgICAgX3RoaXMuX2NyeXB0by5nZXRNeVB1YmxpY0tleSgpLnRoZW4oKHB1YktleSkgPT4ge1xyXG4gICAgICAgICAgcHViS2V5ID0gc3RyaW5naWZ5KHB1YktleSk7XHJcbiAgICAgICAgICBsZXQgdmFsdWUgPSB7IHR5cGU6ICdleGVjdXRlJywgdmFsdWU6IHB1YktleSwgY29kZTogMjAwIH07XHJcbiAgICAgICAgICBsZXQgcmVwbHlNc2cgPSB7IGlkOiBtc2cuaWQsIHR5cGU6ICdyZXNwb25zZScsIHRvOiBtc2cuZnJvbSwgZnJvbTogbXNnLnRvLCBib2R5OiB2YWx1ZSB9O1xyXG4gICAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgX3RoaXMuX21lc3NhZ2VCdXMucG9zdE1lc3NhZ2UocmVwbHlNc2cpO1xyXG4gICAgICAgICAgfSBjYXRjaCAoZXJyKSB7XHJcbiAgICAgICAgICAgIGxvZy5lcnJvcignT24gYWRkR1VJTGlzdGVuZXJzIGZyb20gaWYgZ2VuZXJhdGVSU0FLZXlQYWlyIG1ldGhvZCBwb3N0TWVzc2FnZSBlcnJvcjogJyArIGVycik7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgICB9IGVsc2UgaWYgKGZ1bmNOYW1lID09PSAnc2VuZEdlbmVyYXRlTWVzc2FnZScpIHtcclxuICAgICAgICBsZXQgY29udGVudHMgPSBtc2cuYm9keS5wYXJhbXMuY29udGVudHM7XHJcbiAgICAgICAgbGV0IG9yaWdpbiA9IG1zZy5ib2R5LnBhcmFtcy5vcmlnaW47XHJcbiAgICAgICAgbGV0IHVzZXJuYW1lSGludCA9IG1zZy5ib2R5LnBhcmFtcy51c2VybmFtZUhpbnQ7XHJcbiAgICAgICAgbGV0IGlkcERvbWFpbiA9IG1zZy5ib2R5LnBhcmFtcy5pZHBEb21haW47XHJcbiAgICAgICAgbGV0IHJlcGx5TXNnID0geyBpZDogbXNnLmlkLCB0eXBlOiAncmVzcG9uc2UnLCB0bzogbXNnLmZyb20sIGZyb206IG1zZy50byB9O1xyXG4gICAgICAgIF90aGlzLnNlbmRHZW5lcmF0ZU1lc3NhZ2UoY29udGVudHMsIG9yaWdpbiwgdXNlcm5hbWVIaW50LCBpZHBEb21haW4pLnRoZW4oKHJldHVybmVkVmFsdWUpID0+IHtcclxuICAgICAgICAgIGxldCB2YWx1ZSA9IHsgdHlwZTogJ2V4ZWN1dGUnLCB2YWx1ZTogcmV0dXJuZWRWYWx1ZSwgY29kZTogMjAwIH07XHJcbiAgICAgICAgICByZXBseU1zZy5ib2R5ID0gdmFsdWU7XHJcbiAgICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICBfdGhpcy5fbWVzc2FnZUJ1cy5wb3N0TWVzc2FnZShyZXBseU1zZyk7XHJcbiAgICAgICAgICB9IGNhdGNoIChlcnIpIHtcclxuICAgICAgICAgICAgbG9nLmVycm9yKCdJZGVudGl0eU1vZHVsZS5hZGRHVUlMaXN0ZW5lcnMgc2VuZEdlbmVyYXRlTWVzc2FnZSBlcnJvcjogJyArIGVycik7XHJcbiAgICAgICAgICB9XHJcblxyXG4gICAgICAgIH0sIChlcnIpID0+IHtcclxuICAgICAgICAgIGxvZy5pbmZvKCdJRFBQcm94eSBnZW5lcmF0ZUFzc2VydGlvbiByZXBseSBlcnJvciAnICsgZXJyKTtcclxuICAgICAgICAgIHJlcGx5TXNnLmJvZHkgPSBlcnI7XHJcbiAgICAgICAgICBfdGhpcy5fbWVzc2FnZUJ1cy5wb3N0TWVzc2FnZShyZXBseU1zZyk7XHJcblxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHJldHVybjtcclxuICAgICAgfSBlbHNlIGlmIChmdW5jTmFtZSA9PT0gJ2dldEFjY2Vzc1Rva2VuQXV0aG9yaXNhdGlvbkVuZHBvaW50Jykge1xyXG4gICAgICAgIGxldCBzY29wZSA9IG1zZy5ib2R5LnBhcmFtcy5zY29wZTtcclxuICAgICAgICBsZXQgaWRwRG9tYWluID0gbXNnLmJvZHkucGFyYW1zLmlkcERvbWFpbjtcclxuICAgICAgICBfdGhpcy5nZXRBY2Nlc3NUb2tlbkF1dGhvcmlzYXRpb25FbmRwb2ludChzY29wZSwgaWRwRG9tYWluKS50aGVuKChyZXR1cm5lZFZhbHVlKSA9PiB7XHJcbiAgICAgICAgICBsZXQgdmFsdWUgPSB7IHR5cGU6ICdleGVjdXRlJywgdmFsdWU6IHJldHVybmVkVmFsdWUsIGNvZGU6IDIwMCB9O1xyXG4gICAgICAgICAgbGV0IHJlcGx5TXNnID0geyBpZDogbXNnLmlkLCB0eXBlOiAncmVzcG9uc2UnLCB0bzogbXNnLmZyb20sIGZyb206IG1zZy50bywgYm9keTogdmFsdWUgfTtcclxuICAgICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgIF90aGlzLl9tZXNzYWdlQnVzLnBvc3RNZXNzYWdlKHJlcGx5TXNnKTtcclxuICAgICAgICAgIH0gY2F0Y2ggKGVycikge1xyXG4gICAgICAgICAgICBsb2cuZXJyb3IoJ09uIGFkZEdVSUxpc3RlbmVycyBmcm9tIGlmIHNlbmRHZW5lcmF0ZU1lc3NhZ2UgbWV0aG9kIHBvc3RNZXNzYWdlIGVycm9yOiAnICsgZXJyKTtcclxuICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgICB9IGVsc2UgaWYgKGZ1bmNOYW1lID09PSAnYWRkQWNjZXNzVG9rZW4nKSB7XHJcbiAgICAgICAgbGV0IGFjY2Vzc1Rva2VuID0gbXNnLmJvZHkucGFyYW1zO1xyXG5cclxuICAgICAgICBfdGhpcy5pZGVudGl0aWVzLmFkZEFjY2Vzc1Rva2VuKGFjY2Vzc1Rva2VuKS50aGVuKChyZXR1cm5lZFZhbHVlKSA9PiB7XHJcbiAgICAgICAgICBsZXQgdmFsdWUgPSB7IHR5cGU6ICdleGVjdXRlJywgdmFsdWU6IHJldHVybmVkVmFsdWUsIGNvZGU6IDIwMCB9O1xyXG4gICAgICAgICAgbGV0IHJlcGx5TXNnID0geyBpZDogbXNnLmlkLCB0eXBlOiAncmVzcG9uc2UnLCB0bzogbXNnLmZyb20sIGZyb206IG1zZy50bywgYm9keTogdmFsdWUgfTtcclxuICAgICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgIF90aGlzLl9tZXNzYWdlQnVzLnBvc3RNZXNzYWdlKHJlcGx5TXNnKTtcclxuICAgICAgICAgIH0gY2F0Y2ggKGVycikge1xyXG4gICAgICAgICAgICBsb2cuZXJyb3IoJ09uIGFkZEdVSUxpc3RlbmVycyBmcm9tIGlmIHN0b3JlSWRlbnRpdHkgbWV0aG9kIHBvc3RNZXNzYWdlIGVycm9yOiAnICsgZXJyKTtcclxuICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgICB9IGVsc2UgaWYgKGZ1bmNOYW1lID09PSAnZ2V0QWNjZXNzVG9rZW4nKSB7XHJcblxyXG4gICAgICAgIGxldCBkb21haW4gPSBtc2cuYm9keS5wYXJhbXMuaWRwRG9tYWluO1xyXG4gICAgICAgIGxldCByZXNvdXJjZXMgPSBtc2cuYm9keS5wYXJhbXMucmVzb3VyY2VzO1xyXG4gICAgICAgIGxldCBsb2dpbiA9IG1zZy5ib2R5LnBhcmFtcy5sb2dpbjtcclxuICAgICAgICBsZXQgcmVwbHlNc2cgPSB7IGlkOiBtc2cuaWQsIHR5cGU6ICdyZXNwb25zZScsIHRvOiBtc2cuZnJvbSwgZnJvbTogbXNnLnRvIH07XHJcblxyXG4gICAgICAgIF90aGlzLmdldEFjY2Vzc1Rva2VuKGRvbWFpbiwgcmVzb3VyY2VzLCBsb2dpbikudGhlbigocmV0dXJuZWRWYWx1ZSkgPT4ge1xyXG4gICAgICAgICAgbGV0IHZhbHVlID0geyB0eXBlOiAnZXhlY3V0ZScsIHZhbHVlOiByZXR1cm5lZFZhbHVlLCBjb2RlOiAyMDAgfTtcclxuICAgICAgICAgIHJlcGx5TXNnLmJvZHkgPSB2YWx1ZTtcclxuICAgICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgIF90aGlzLl9tZXNzYWdlQnVzLnBvc3RNZXNzYWdlKHJlcGx5TXNnKTtcclxuICAgICAgICAgIH0gY2F0Y2ggKGVycikge1xyXG4gICAgICAgICAgICBsb2cuZXJyb3IoJ09uIGFkZEdVSUxpc3RlbmVycyBmcm9tIGlmIHNlbmRHZW5lcmF0ZU1lc3NhZ2UgbWV0aG9kIHBvc3RNZXNzYWdlIGVycm9yOiAnICsgZXJyKTtcclxuICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgfSwgKGVycm9yKSA9PiB7XHJcbiAgICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICByZXBseU1zZy5ib2R5ID0gZXJyb3I7XHJcbiAgICAgICAgICAgIF90aGlzLl9tZXNzYWdlQnVzLnBvc3RNZXNzYWdlKHJlcGx5TXNnKTtcclxuICAgICAgICAgIH0gY2F0Y2ggKGVycikge1xyXG4gICAgICAgICAgICBsb2cuZXJyb3IoJ09uIGFkZEdVSUxpc3RlbmVycyBmcm9tIGlmIHNlbmRHZW5lcmF0ZU1lc3NhZ2UgbWV0aG9kIHBvc3RNZXNzYWdlIGVycm9yOiAnICsgZXJyKTtcclxuICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgICB9IGVsc2UgaWYgKGZ1bmNOYW1lID09PSAnYWRkQXNzZXJ0aW9uJykge1xyXG4gICAgICAgIGxldCByZXN1bHQgPSBtc2cuYm9keS5wYXJhbXM7XHJcblxyXG4gICAgICAgIC8vICAgICAgICBsZXQga2V5UGFpciA9IG1zZy5ib2R5LnBhcmFtcy5rZXlQYWlyO1xyXG4gICAgICAgIF90aGlzLmlkZW50aXRpZXMuYWRkQXNzZXJ0aW9uKHJlc3VsdCkudGhlbigocmV0dXJuZWRWYWx1ZSkgPT4ge1xyXG4gICAgICAgICAgbGV0IHZhbHVlID0geyB0eXBlOiAnZXhlY3V0ZScsIHZhbHVlOiByZXR1cm5lZFZhbHVlLCBjb2RlOiAyMDAgfTtcclxuICAgICAgICAgIGxldCByZXBseU1zZyA9IHsgaWQ6IG1zZy5pZCwgdHlwZTogJ3Jlc3BvbnNlJywgdG86IG1zZy5mcm9tLCBmcm9tOiBtc2cudG8sIGJvZHk6IHZhbHVlIH07XHJcbiAgICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICBfdGhpcy5fbWVzc2FnZUJ1cy5wb3N0TWVzc2FnZShyZXBseU1zZyk7XHJcbiAgICAgICAgICB9IGNhdGNoIChlcnIpIHtcclxuICAgICAgICAgICAgbG9nLmVycm9yKCdPbiBhZGRHVUlMaXN0ZW5lcnMgZnJvbSBpZiBzdG9yZUlkZW50aXR5IG1ldGhvZCBwb3N0TWVzc2FnZSBlcnJvcjogJyArIGVycik7XHJcbiAgICAgICAgICB9XHJcblxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHJldHVybjtcclxuICAgICAgfSBlbHNlIGlmIChmdW5jTmFtZSA9PT0gJ3JlZnJlc2hBY2Nlc3NUb2tlbicpIHtcclxuICAgICAgICBsZXQgZG9tYWluID0gbXNnLmJvZHkucGFyYW1zLmRvbWFpbjtcclxuICAgICAgICBsZXQgcmVzb3VyY2VzID0gbXNnLmJvZHkucGFyYW1zLnJlc291cmNlcztcclxuXHJcbiAgICAgICAgX3RoaXMuX2dldEFjY2Vzc1Rva2VuRm9yRG9tYWluKGRvbWFpbiwgcmVzb3VyY2VzKS50aGVuKCh0b2tlbikgPT4ge1xyXG4gICAgICAgICAgbGV0IHJlcGx5TXNnID0ge1xyXG4gICAgICAgICAgICBpZDogbXNnLmlkLFxyXG4gICAgICAgICAgICB0eXBlOiAncmVzcG9uc2UnLFxyXG4gICAgICAgICAgICB0bzogbXNnLmZyb20sXHJcbiAgICAgICAgICAgIGZyb206IG1zZy50byxcclxuICAgICAgICAgICAgYm9keToge1xyXG4gICAgICAgICAgICAgIHZhbHVlOiB0b2tlbi5hY2Nlc3NUb2tlbixcclxuICAgICAgICAgICAgICBjb2RlOiAyMDBcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfTtcclxuICAgICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgIF90aGlzLl9tZXNzYWdlQnVzLnBvc3RNZXNzYWdlKHJlcGx5TXNnKTtcclxuICAgICAgICAgIH0gY2F0Y2ggKGVycikge1xyXG4gICAgICAgICAgICBsb2cuZXJyb3IoJ09uIGFkZEdVSUxpc3RlbmVycyBmb3IgcmVmcmVzaEFjY2Vzc1Rva2VuIHJlcXVlc3Q6ICcgKyBlcnIpO1xyXG4gICAgICAgICAgfVxyXG5cclxuICAgICAgICB9KTtcclxuICAgICAgICByZXR1cm47XHJcbiAgICAgIH0gZWxzZSBpZiAoZnVuY05hbWUgPT09ICd1bmF1dGhvcmlzZScpIHtcclxuICAgICAgICBsZXQgZG9tYWluID0gbXNnLmJvZHkucGFyYW1zLmRvbWFpbjtcclxuICAgICAgICBsZXQgcmVzb3VyY2VzID0gbXNnLmJvZHkucGFyYW1zLnJlc291cmNlcztcclxuXHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgIF90aGlzLl9yZXZva2VBY2Nlc3NUb2tlbihfdGhpcy5pZGVudGl0aWVzLmdldEFjY2Vzc1Rva2VuKGRvbWFpbiwgcmVzb3VyY2VzKSwgZG9tYWluLCByZXNvdXJjZXMpO1xyXG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgICAgIHJldHVybiByZWplY3QoJ1tJZGVudGl0eU1vZHVsZS5hZGRHVUlMaXN0ZW5lcnNdIHVuYXV0aG9yaXNlIGVycm9yICcgKyBlcnIpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgICBsZXQgcmVwbHlNc2cgPSB7XHJcbiAgICAgICAgICAgIGlkOiBtc2cuaWQsXHJcbiAgICAgICAgICAgIHR5cGU6ICdyZXNwb25zZScsXHJcbiAgICAgICAgICAgIHRvOiBtc2cuZnJvbSxcclxuICAgICAgICAgICAgZnJvbTogbXNnLnRvLFxyXG4gICAgICAgICAgICBib2R5OiB7XHJcbiAgICAgICAgICAgICAgdmFsdWU6IHRydWUsXHJcbiAgICAgICAgICAgICAgY29kZTogMjAwXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH07XHJcbiAgICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICBfdGhpcy5fbWVzc2FnZUJ1cy5wb3N0TWVzc2FnZShyZXBseU1zZyk7XHJcbiAgICAgICAgICB9IGNhdGNoIChlcnIpIHtcclxuICAgICAgICAgICAgbG9nLmVycm9yKCdPbiBhZGRHVUlMaXN0ZW5lcnMgZm9yIHJlZnJlc2hBY2Nlc3NUb2tlbiByZXF1ZXN0OiAnICsgZXJyKTtcclxuICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgICB9LyplbHNlIGlmIChmdW5jTmFtZSA9PT0gJ3NlbGVjdElkZW50aXR5Rm9ySHlwZXJ0eScpIHtcclxuICAgICAgICBsZXQgb3JpZ2luID0gbXNnLmJvZHkucGFyYW1zLm9yaWdpbjtcclxuICAgICAgICBsZXQgaWRwID0gbXNnLmJvZHkucGFyYW1zLmlkcDtcclxuICAgICAgICBsZXQgaWRIaW50ID0gbXNnLmJvZHkucGFyYW1zLmlkSGludDtcclxuICAgICAgICBfdGhpcy5zZWxlY3RJZGVudGl0eUZvckh5cGVydHkob3JpZ2luLCBpZHAsIGlkSGludCk7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgICB9Ki9cclxuXHJcbiAgICAgIC8vIGlmIHRoZSBmdW5jdGlvbiByZXF1ZXN0ZWQgaXMgbm90IGEgcHJvbWlzZVxyXG4gICAgICBsZXQgdmFsdWUgPSB7IHR5cGU6ICdleGVjdXRlJywgdmFsdWU6IHJldHVybmVkVmFsdWUsIGNvZGU6IDIwMCB9O1xyXG4gICAgICBsZXQgcmVwbHlNc2cgPSB7IGlkOiBtc2cuaWQsIHR5cGU6ICdyZXNwb25zZScsIHRvOiBtc2cuZnJvbSwgZnJvbTogbXNnLnRvLCBib2R5OiB2YWx1ZSB9O1xyXG4gICAgICB0cnkge1xyXG4gICAgICAgIF90aGlzLl9tZXNzYWdlQnVzLnBvc3RNZXNzYWdlKHJlcGx5TXNnKTtcclxuICAgICAgfSBjYXRjaCAoZXJyKSB7XHJcbiAgICAgICAgbG9nLmVycm9yKCdPbiBhZGRHVUlMaXN0ZW5lcnMgZnJvbSBpZiBzdG9yZUlkZW50aXR5IG1ldGhvZCBwb3N0TWVzc2FnZSBlcnJvcjogJyArIGVycik7XHJcbiAgICAgIH1cclxuXHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIGRlcGxveUdVSSgpIHtcclxuICAgIGxldCBfdGhpcyA9IHRoaXM7XHJcbiAgICBfdGhpcy5ndWlEZXBsb3llZCA9IHRydWU7XHJcbiAgfVxyXG5cclxuICAvLyoqKioqKioqKioqKioqKioqKiogUFJJVkFURSBNRVRIT0RTICoqKioqKioqKioqKioqKioqKipcclxuICAvKipcclxuICAgKiBHZXRWYWxpZFRva2VuIGlzIGZvciBub24gbGVnYWN5IGh5cGVydGllcyBhbmQgdmVyaWZpZXMgaWYgdGhlIFRva2VuIGlzIHN0aWxsIHZhbGlkXHJcbiAgICogaWYgdGhlIHRva2VuIGlzIGludmFsaWQgaXQgcmVxdWVzdHMgYSBuZXcgdG9rZW5cclxuICAgKiBAcGFyYW0gIHtTdHJpbmd9IGh5cGVydHlVUkwgaHlwZXJ0eVVSTFxyXG4gICAqIEByZXR1cm4ge1Byb21pc2V9XHJcbiAgICovXHJcbiAgX2dldFZhbGlkVG9rZW4oaHlwZXJ0eVVSTCkge1xyXG4gICAgbG9nLmxvZygnW0lkZW50aXR5TW9kdWxlLl9nZXRWYWxpZFRva2VuXTpoeXBlcnR5VVJMJywgaHlwZXJ0eVVSTCk7XHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcclxuICAgICAgX3RoaXMuZ2V0SWRUb2tlbihoeXBlcnR5VVJMKS50aGVuKGZ1bmN0aW9uIChhc3NlcnRpb24pIHtcclxuICAgICAgICBsb2cubG9nKCdbSWRlbnRpdHlNb2R1bGUuX2dldFZhbGlkVG9rZW5dIHJldHJpZXZlZCBJZEFzc2VydGlvbicsIGFzc2VydGlvbik7XHJcbiAgICAgICAgbGV0IHRpbWVOb3cgPSBzZWNvbmRzU2luY2VFcG9jaCgpO1xyXG5cclxuICAgICAgICBpZiAoIWFzc2VydGlvbi5oYXNPd25Qcm9wZXJ0eSgnZXhwaXJlcycpKSByZXR1cm4gcmVzb2x2ZShhc3NlcnRpb24pO1xyXG5cclxuICAgICAgICBsZXQgZXhwaXJhdGlvbkRhdGUgPSBhc3NlcnRpb24uZXhwaXJlcztcclxuXHJcbiAgICAgICAgLyogaWYgKGNvbXBsZXRlSWQuaGFzT3duUHJvcGVydHkoJ2luZm8nKSkge1xyXG4gICAgICAgICAgaWYgKGNvbXBsZXRlSWQuaW5mby5oYXNPd25Qcm9wZXJ0eSgnZXhwaXJlcycpKSB7XHJcbiAgICAgICAgICAgIGV4cGlyYXRpb25EYXRlID0gY29tcGxldGVJZC5pbmZvLmV4cGlyZXM7XHJcbiAgICAgICAgICB9IGVsc2UgaWYgKGNvbXBsZXRlSWQuaW5mby5oYXNPd25Qcm9wZXJ0eSgndG9rZW5JREpTT04nKSkge1xyXG4gICAgICAgICAgICBleHBpcmF0aW9uRGF0ZSA9IGNvbXBsZXRlSWQuaW5mby50b2tlbklESlNPTi5leHA7XHJcbiAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAvLyB0aHJvdyAnVGhlIElEIFRva2VuIGRvZXMgbm90IGhhdmUgYW4gZXhwaXJhdGlvbiB0aW1lJztcclxuICAgICAgICAgICAgbG9nLmluZm8oJ1RoZSBJRCBUb2tlbiBkb2VzIG5vdCBoYXZlIGFuIGV4cGlyYXRpb24gdGltZScpO1xyXG4gICAgICAgICAgICByZXNvbHZlKGFzc2VydGlvbik7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSBlbHNlIGlmIChjb21wbGV0ZUlkLmhhc093blByb3BlcnR5KCdpbmZvVG9rZW4nKSAmJiBjb21wbGV0ZUlkLmluZm9Ub2tlbi5oYXNPd25Qcm9wZXJ0eSgnZXhwJykpIHtcclxuICAgICAgICAgIGV4cGlyYXRpb25EYXRlID0gY29tcGxldGVJZC5pbmZvVG9rZW4uZXhwO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAvLyB0aHJvdyAnVGhlIElEIFRva2VuIGRvZXMgbm90IGhhdmUgYW4gZXhwaXJhdGlvbiB0aW1lJztcclxuICAgICAgICAgIGxvZy5pbmZvKCdUaGUgSUQgVG9rZW4gZG9lcyBub3QgaGF2ZSBhbiBleHBpcmF0aW9uIHRpbWUnKTtcclxuICAgICAgICAgIHJlc29sdmUoYXNzZXJ0aW9uKTtcclxuICAgICAgICB9Ki9cclxuXHJcbiAgICAgICAgbG9nLmxvZygnW0lkZW50aXR5LklkZW50aXR5TW9kdWxlLmdldFZhbGlkVG9rZW5dIFRva2VuIGV4cGlyZXMgaW4nLCBleHBpcmF0aW9uRGF0ZSk7XHJcbiAgICAgICAgbG9nLmxvZygnW0lkZW50aXR5LklkZW50aXR5TW9kdWxlLmdldFZhbGlkVG9rZW5dIHRpbWUgbm93OicsIHRpbWVOb3cpO1xyXG5cclxuICAgICAgICBpZiAodGltZU5vdyA+PSBleHBpcmF0aW9uRGF0ZSkge1xyXG4gICAgICAgICAgLy8gICAgICAgIGlmICh0aW1lTm93ID49IDApIHtcclxuICAgICAgICAgIGlmIChhc3NlcnRpb24uaGFzT3duUHJvcGVydHkoJ3JlZnJlc2gnKSkge1xyXG4gICAgICAgICAgICBsb2cubG9nKCdbSWRlbnRpdHkuSWRlbnRpdHlNb2R1bGUuZ2V0VmFsaWRUb2tlbl0gcmVmcmVzaGluZyBhc3NlcnRpb246ICcsIGFzc2VydGlvbik7XHJcblxyXG4gICAgICAgICAgICBfdGhpcy5zZW5kUmVmcmVzaE1lc3NhZ2UoYXNzZXJ0aW9uKS50aGVuKChuZXdBc3NlcnRpb24pID0+IHtcclxuICAgICAgICAgICAgICBsb2cubG9nKCdbSWRlbnRpdHkuSWRlbnRpdHlNb2R1bGUuZ2V0VmFsaWRUb2tlbl0gcmVmcmVzaGVkIGFzc2VydGlvbjogJywgbmV3QXNzZXJ0aW9uKTtcclxuICAgICAgICAgICAgICBfdGhpcy5pZGVudGl0aWVzLnVwZGF0ZUFzc2VydGlvbihuZXdBc3NlcnRpb24pLnRoZW4oKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgcmVzb2x2ZShuZXdBc3NlcnRpb24pO1xyXG4gICAgICAgICAgICAgIH0sIChlcnIpID0+IHtcclxuICAgICAgICAgICAgICAgIGxvZy5lcnJvcignW0lkZW50aXR5TW9kdWxlLmdldFZhbGlkVG9rZW5dIGVycm9yIHVwZGF0aW5nIHRoZSBhc3NlcnRpb24gJywgZXJyKTtcclxuICAgICAgICAgICAgICAgIHJlamVjdChlcnIpO1xyXG4gICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9LCAoZXJyKSA9PiB7XHJcbiAgICAgICAgICAgICAgbG9nLmVycm9yKCdbSWRlbnRpdHlNb2R1bGUuZ2V0VmFsaWRUb2tlbl0gZXJyb3IgcmVmcmVzaGluZyB0aGUgYXNzZXJ0aW9uICcsIGVycik7XHJcbiAgICAgICAgICAgICAgcmVqZWN0KGVycik7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgfSBlbHNlIHsgLy8gbm8gcmVmcmVzaCB0b2tlbiBhdmFpbGFibGUsIHVzZXIgaGFzIHRvIGF1dGhlbnRpY2F0ZSBhZ2FpbiB0byBnZXQgYSBuZXcgYXNzZXJ0aW9uXHJcbiAgICAgICAgICAgIC8vIGdlbmVyYXRlIG5ldyBpZFRva2VuXHJcbiAgICAgICAgICAgIF90aGlzLmNhbGxHZW5lcmF0ZU1ldGhvZHMoYXNzZXJ0aW9uLmlkcC5kb21haW4pLnRoZW4oKHZhbHVlKSA9PiB7XHJcbiAgICAgICAgICAgICAgcmVzb2x2ZSh2YWx1ZSk7XHJcbiAgICAgICAgICAgIH0pLmNhdGNoKGVyciA9PiB7IHJlamVjdCgnW0lkZW50aXR5TW9kdWxlLmdldFZhbGlkVG9rZW5dIGVycm9yIHdoZW4gZ2VuZXJhdGluZyBhIG5ldyBhc3NlcnRpb24gJyArIGVycik7IH0pO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICByZXNvbHZlKGFzc2VydGlvbik7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZXJyb3IpIHtcclxuICAgICAgICBsb2cuZXJyb3IoJ1tJZGVudGl0eU1vZHVsZS5nZXRWYWxpZFRva2VuXSBlcnJvciBvbiBnZXRJZFRva2VuJywgZXJyb3IpO1xyXG4gICAgICAgIHJlamVjdChlcnJvcik7XHJcbiAgICAgIH0pO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAqIHJldHVybnMgdGhlIHJlcG9ydGVyIGFzc29jaWF0ZWQgdG8gdGhlIGRhdGFPYmplY3QgVVJMXHJcbiAgKiBAcGFyYW0gICB7U3RyaW5nfSAgIGRhdGFPYmplY3RVUkwgICAgICAgICBkYXRhT2JqZWN0IHVybFxyXG4gICogQHJldHVybiAgIHtTdHJpbmd9ICByZXBvcnRlciAgICAgICAgICAgICAgZGF0YU9iamVjdCB1cmwgcmVwb3J0ZXJcclxuICAqL1xyXG4gIF9nZXRIeXBlcnR5RnJvbURhdGFPYmplY3QoZGF0YU9iamVjdFVSTCkge1xyXG4gICAgbG9nLmluZm8oJ19nZXRIeXBlcnR5RnJvbURhdGFPYmplY3Q6ZGF0YU9iamVjdFVSTCcsIGRhdGFPYmplY3RVUkwpO1xyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuXHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xyXG5cclxuICAgICAgbGV0IHNwbGl0ZWRVUkwgPSBkaXZpZGVVUkwoZGF0YU9iamVjdFVSTCk7XHJcbiAgICAgIGxldCBkb21haW4gPSBzcGxpdGVkVVJMLmRvbWFpbjtcclxuICAgICAgbGV0IGZpbmFsVVJMID0gcGFyc2VNZXNzYWdlVVJMKGRhdGFPYmplY3RVUkwpO1xyXG5cclxuICAgICAgLy8gY2hlY2sgaWYgaXMgdGhlIGNyZWF0b3Igb2YgdGhlIGh5cGVydHlcclxuICAgICAgbGV0IHJlcG9ydGVyVVJMID0gX3RoaXMucmVnaXN0cnkuZ2V0UmVwb3J0ZXJVUkxTeW5jaG9ub3VzKGZpbmFsVVJMKTtcclxuICAgICAgbG9nLmluZm8oJ19nZXRIeXBlcnR5RnJvbURhdGFPYmplY3Q6cmVwb3J0ZXJVUkwnLCByZXBvcnRlclVSTCk7XHJcblxyXG4gICAgICBpZiAocmVwb3J0ZXJVUkwpIHtcclxuICAgICAgICByZXNvbHZlKHJlcG9ydGVyVVJMKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICAvLyBjaGVjayBpZiB0aGVyZSBpcyBhbHJlYWR5IGFuIGFzc29jaWF0aW9uIGZyb20gYW4gaHlwZXJ0eVVSTCB0byB0aGUgZGF0YU9iamVjdFxyXG4gICAgICAgIGxldCBzdG9yZWRSZXBvcnRlclVSTCA9IF90aGlzLmRhdGFPYmplY3RzSWRlbnRpdHlbZmluYWxVUkxdO1xyXG4gICAgICAgIGxvZy5pbmZvKCdfZ2V0SHlwZXJ0eUZyb21EYXRhT2JqZWN0OnN0b3JlZFJlcG9ydGVyVVJMJywgc3RvcmVkUmVwb3J0ZXJVUkwpO1xyXG5cclxuICAgICAgICBpZiAoc3RvcmVkUmVwb3J0ZXJVUkwpIHtcclxuICAgICAgICAgIHJlc29sdmUoc3RvcmVkUmVwb3J0ZXJVUkwpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAvLyBjaGVjayBpZiB0aGVyZSBpcyBhbnkgaHlwZXJ0eSB0aGF0IHN1YnNjcmliZWQgdGhlIGRhdGFPYmplY3RVUkxcclxuICAgICAgICAgIGxldCBzdWJzY3JpYmVySHlwZXJ0eSA9IF90aGlzLnJlZ2lzdHJ5LmdldERhdGFPYmplY3RTdWJzY3JpYmVySHlwZXJ0eShkYXRhT2JqZWN0VVJMKTtcclxuICAgICAgICAgIGxvZy5pbmZvKCdfZ2V0SHlwZXJ0eUZyb21EYXRhT2JqZWN0OnN1YnNjcmliZXJIeXBlcnR5Jywgc3Vic2NyaWJlckh5cGVydHkpO1xyXG5cclxuICAgICAgICAgIGlmIChzdWJzY3JpYmVySHlwZXJ0eSkge1xyXG4gICAgICAgICAgICByZXNvbHZlKHN1YnNjcmliZXJIeXBlcnR5KTtcclxuICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIC8vIHNlYXJjaCBpbiBkb21haW4gcmVnaXN0cnkgZm9yIHRoZSBoeXBlcnR5IGFzc29jaWF0ZWQgdG8gdGhlIGRhdGFPYmplY3RcclxuICAgICAgICAgICAgLy8gc2VhcmNoIGluIGNhc2UgaXMgYSBzdWJzY3JpYmVyIHdobyB3YW50cyB0byBrbm93IHRoZSByZXBvcnRlclxyXG4gICAgICAgICAgICAvLyBUbyBiZSByZXZpZXdlZCBpbiBvcmRlciB0byBhdm9pZCB0aGUgZGlzY292ZXJ5IHRyYW5zYWN0aW9uXHJcbiAgICAgICAgICAgIF90aGlzLl9jb3JlRGlzY292ZXJ5LmRpc2NvdmVyRGF0YU9iamVjdFBlclVSTChmaW5hbFVSTCwgZG9tYWluKS50aGVuKGRhdGFPYmplY3QgPT4ge1xyXG4gICAgICAgICAgICAgIGxvZy5pbmZvKCdfZ2V0SHlwZXJ0eUZyb21EYXRhT2JqZWN0OmRhdGFPYmplY3QnLCBkYXRhT2JqZWN0KTtcclxuICAgICAgICAgICAgICBfdGhpcy5kYXRhT2JqZWN0c0lkZW50aXR5W2ZpbmFsVVJMXSA9IGRhdGFPYmplY3QucmVwb3J0ZXI7XHJcbiAgICAgICAgICAgICAgbG9nLmluZm8oJ19nZXRIeXBlcnR5RnJvbURhdGFPYmplY3Q6ZGF0YU9iamVjdC5yZXBvcnRlcicsIGRhdGFPYmplY3QucmVwb3J0ZXIpO1xyXG4gICAgICAgICAgICAgIHJlc29sdmUoZGF0YU9iamVjdC5yZXBvcnRlcik7XHJcbiAgICAgICAgICAgIH0sIGVyciA9PiB7XHJcbiAgICAgICAgICAgICAgcmVqZWN0KGVycik7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAqIEZ1bmN0aW9uIHRoYXQgcmVzb2x2ZSBhbmQgY3JlYXRlIHRoZSBkb21haW5VUkwgaW4gY2FzZSBpdCBpcyBwcm92aWRlZCBvbmUuIElmIG5vdCwgcmVzb2x2ZSB0aGUgZGVmYXVsdCBkb21haW5VUkxcclxuICAqIEBwYXJhbSB7U3RyaW5nfSAgICAgaWRwRG9tYWluICAgICBpZHBEb21haW4gKE9wdGlvbmFsKVxyXG4gICovXHJcbiAgX3Jlc29sdmVEb21haW4oaWRwRG9tYWluKSB7XHJcbiAgICBpZiAoIWlkcERvbWFpbikge1xyXG4gICAgICByZXR1cm4gJ2RvbWFpbi1pZHA6Ly9nb29nbGUuY29tJztcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHJldHVybiAnZG9tYWluLWlkcDovLycgKyBpZHBEb21haW47XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKlxyXG4gICAgX3NlY29uZHNTaW5jZUVwb2NoKCkge1xyXG4gICAgICByZXR1cm4gTWF0aC5mbG9vcihEYXRlLm5vdygpIC8gMTAwMCk7XHJcbiAgICB9Ki9cclxufVxyXG5cclxuXHJcbmV4cG9ydCBkZWZhdWx0IElkZW50aXR5TW9kdWxlO1xyXG4iLCIvKipcclxuICogIENsYXNzIHdoZXJlIG1lc3NhZ2UgYnVzIGhhbmRsZXJzIGFyZSBidWlsdC4gVG8gYmUgdXNlZCBieSB0aGUgUnVudGltZVVBIHRvIGluaXRpYWxpc2UgdGhlIHJ1bnRpbWUgVUEuXHJcbiAqL1xyXG5cclxuLy9pbXBvcnQgeyBsb2cgYXMgbG9nTGV2ZWxzIH0gZnJvbSAnLi4vbG9nTGV2ZWxzJztcclxuXHJcbi8vIExvZyBTeXN0ZW1cclxuaW1wb3J0ICogYXMgbG9nZ2VyIGZyb20gJ2xvZ2xldmVsJztcclxubGV0IGxvZyA9IGxvZ2dlci5nZXRMb2dnZXIoJ1J1bnRpbWVVQScpO1xyXG5cclxuY2xhc3MgTXNnQnVzSGFuZGxlcnMge1xyXG5cclxuICBjb25zdHJ1Y3RvcihwZXAsIGlkbSwgY3J5cHRvKSB7XHJcbiAgICBpZiAoIXBlcCkgdGhyb3cgRXJyb3IoJ1tNc2dCdXNIYW5kbGVyc10gcGVwIGlucHV0IHBhcmFtZW50ZXIgaXMgbWFuZGF0b3J5Jyk7XHJcbiAgICBpZiAoIWlkbSkgdGhyb3cgRXJyb3IoJ1tNc2dCdXNIYW5kbGVyc10gaWRtIGlucHV0IHBhcmFtZW50ZSBpcyBtYW5kYXRvcnknKTtcclxuICAgIGlmICghY3J5cHRvKSB0aHJvdyBFcnJvcignW01zZ0J1c0hhbmRsZXJzXSBjcnlwdG8gaW5wdXQgcGFyYW1lbnRlIGlzIG1hbmRhdG9yeScpO1xyXG5cclxuICAgIHRoaXMucG9saWN5RW5naW5lID0gcGVwO1xyXG4gICAgdGhpcy5pZGVudGl0eU1hbmFnZXIgPSBpZG07XHJcbiAgICB0aGlzLmNyeXB0b01hbmFnZXIgPSBjcnlwdG87XHJcbiAgfVxyXG5cclxuICAvLyBQb2xpY3kgYmFzZWQgYWNjZXNzIGNvbnRyb2wgZm9yIGluY29taW5nIG1lc3NhZ2VzXHJcblxyXG4gIGdldCBwZXBJbkhhbmRsZXIoKSB7XHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG5cclxuICAgIHJldHVybiAoY3R4KSA9PiB7XHJcbiAgICAgIF90aGlzLnBvbGljeUVuZ2luZS5hdXRob3Jpc2UoY3R4Lm1zZywgdHJ1ZSkudGhlbigoY2hhbmdlZE1ncykgPT4ge1xyXG4gICAgICAgIGN0eC5tc2cgPSBjaGFuZ2VkTWdzO1xyXG4gICAgICAgIGN0eC5uZXh0KCk7XHJcbiAgICAgIH0pLmNhdGNoKChyZWFzb24pID0+IHtcclxuICAgICAgICBsb2cuZXJyb3IocmVhc29uKTtcclxuICAgICAgICBjdHguZmFpbChyZWFzb24pO1xyXG4gICAgICB9KTtcclxuICAgIH07XHJcblxyXG4gIH1cclxuXHJcbiAgLy8gUG9saWN5IGJhc2VkIGFjY2VzcyBjb250cm9sIGZvciBvdXRnb2luZyBtZXNzYWdlc1xyXG4gIGdldCBwZXBPdXRIYW5kbGVyKCkge1xyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuICAgIHJldHVybiAoY3R4KSA9PiB7XHJcbiAgICAgIF90aGlzLnBvbGljeUVuZ2luZS5hdXRob3Jpc2UoY3R4Lm1zZywgZmFsc2UpLnRoZW4oKGNoYW5nZWRNZ3MpID0+IHtcclxuICAgICAgICBjdHgubXNnID0gY2hhbmdlZE1ncztcclxuICAgICAgICBjdHgubmV4dCgpO1xyXG4gICAgICB9KS5jYXRjaCgocmVhc29uKSA9PiB7XHJcbiAgICAgICAgbG9nLmVycm9yKHJlYXNvbik7XHJcbiAgICAgICAgY3R4LmZhaWwocmVhc29uKTtcclxuICAgICAgfSk7XHJcbiAgICB9O1xyXG4gIH1cclxuXHJcbiAgLy8gQWRkIElkZW50aXR5IGluZm8gdG8gbWVzc2FnZXNcclxuICBnZXQgaWRtSGFuZGxlcigpIHtcclxuICAgIGxldCBfdGhpcyA9IHRoaXM7XHJcbiAgICByZXR1cm4gKGN0eCkgPT4ge1xyXG4gICAgICBfdGhpcy5pZGVudGl0eU1hbmFnZXIucHJvY2Vzc01lc3NhZ2UoY3R4Lm1zZykudGhlbigoY2hhbmdlZE1ncykgPT4ge1xyXG4gICAgICAgIGN0eC5tc2cgPSBjaGFuZ2VkTWdzO1xyXG4gICAgICAgIGN0eC5uZXh0KCk7XHJcbiAgICAgIH0pLmNhdGNoKChyZWFzb24pID0+IHtcclxuICAgICAgICBsb2cuZXJyb3IocmVhc29uKTtcclxuICAgICAgICBjdHguZmFpbChyZWFzb24pO1xyXG4gICAgICB9KTtcclxuICAgIH07XHJcbiAgfVxyXG5cclxuICAvLyBlbmNyeXB0IG1lc3NhZ2VzXHJcblxyXG4gIGdldCBlbmNyeXB0SGFuZGxlcigpIHtcclxuICAgIGxldCBfdGhpcyA9IHRoaXM7XHJcbiAgICByZXR1cm4gKGN0eCkgPT4ge1xyXG4gICAgICBfdGhpcy5jcnlwdG9NYW5hZ2VyLmVuY3J5cHRNZXNzYWdlKGN0eC5tc2cpLnRoZW4oKGNoYW5nZWRNZ3MpID0+IHtcclxuICAgICAgICBjdHgubXNnID0gY2hhbmdlZE1ncztcclxuICAgICAgICBjdHgubmV4dCgpO1xyXG4gICAgICB9KS5jYXRjaCgocmVhc29uKSA9PiB7XHJcbiAgICAgICAgbG9nLmVycm9yKHJlYXNvbik7XHJcbiAgICAgICAgY3R4LmZhaWwocmVhc29uKTtcclxuICAgICAgfSk7XHJcbiAgICB9O1xyXG5cclxuICB9XHJcblxyXG4gIC8vIGRlY3J5cHQgbWVzc2FnZXNcclxuXHJcbiAgZ2V0IGRlY3J5cHRIYW5kbGVyKCkge1xyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuICAgIHJldHVybiAoY3R4KSA9PiB7XHJcbiAgICAgIF90aGlzLmNyeXB0b01hbmFnZXIuZGVjcnlwdE1lc3NhZ2UoY3R4Lm1zZykudGhlbigoY2hhbmdlZE1ncykgPT4ge1xyXG4gICAgICAgIGN0eC5tc2cgPSBjaGFuZ2VkTWdzO1xyXG4gICAgICAgIGN0eC5uZXh0KCk7XHJcbiAgICAgIH0pLmNhdGNoKChyZWFzb24pID0+IHtcclxuICAgICAgICBsb2cud2FybihyZWFzb24pO1xyXG4gICAgICAgIGN0eC5mYWlsKHJlYXNvbik7XHJcbiAgICAgIH0pO1xyXG4gICAgfTtcclxuXHJcbiAgfVxyXG5cclxufVxyXG5cclxuZXhwb3J0IGRlZmF1bHQgTXNnQnVzSGFuZGxlcnM7XHJcbiIsIi8qKlxyXG4qIFByb3ZpZGVzIGFuIEFQSSB0byBtYW5hZ2UgaWRlbnRpdGllcyBmcm9tIG1zZyBidXMgcGlwZWxpbmVcclxuKiBUT0RPOiByZW5hbWUgdG8gc29tZXRoaW5nIGxpa2UgSWRlbnRpdHlQaXBlbGluZUhhbmRsZXIgaW4gb3JkZXIgbm90IHRvIGNvbmZsaWN0IHdpdGggZnJhbWV3b3JrIHJlbGF0ZWQgSWRlbnRpdHlIYW5kbGVyXHJcbiovXHJcblxyXG5pbXBvcnQgKiBhcyBsb2dnZXIgZnJvbSAnbG9nbGV2ZWwnO1xyXG5pbXBvcnQgSWRlbnRpdGllcyBmcm9tICcuL0lkZW50aXRpZXMnO1xyXG5pbXBvcnQgTXNnQnVzSGFuZGxlcnMgZnJvbSAnLi4vcnVudGltZS9Nc2dCdXNIYW5kbGVycyc7XHJcbmxldCBsb2cgPSBsb2dnZXIuZ2V0TG9nZ2VyKCdJZGVudGl0eUhhbmRsZXInKTtcclxuXHJcbmNsYXNzIElkZW50aXR5SGFuZGxlciB7XHJcblxyXG4gIGNvbnN0cnVjdG9yKGlkbSkge1xyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuXHJcbiAgICBfdGhpcy5faWRtID0gaWRtO1xyXG5cclxuICB9XHJcblxyXG4gIHJlc2V0KCkge1xyXG4gICAgY29uc29sZS5sb2coJ0lNIHJlc2V0Jyk7XHJcblxyXG4gICAgLy8gdGhpcy5faWRtLmlkZW50aXRpZXMucmVzZXQoKTtcclxuICAgIHRoaXMuX2lkbS5pZGVudGl0aWVzID0gbmV3IElkZW50aXRpZXModGhpcy5faWRtLmlkZW50aXRpZXMuX3R5cGUsIHRoaXMuX2lkbS5pZGVudGl0aWVzLl9zdG9yYWdlTWFuYWdlcik7XHJcbiAgICBjb25zb2xlLmxvZyh0aGlzLl9pZG0uaWRlbnRpdGllcyk7XHJcbiAgfVxyXG5cclxuICBfaXNUb1NldElEKG1lc3NhZ2UpIHtcclxuICAgIGxldCBzY2hlbWFzVG9JZ25vcmUgPSBbJ2RvbWFpbi1pZHAnLCAncnVudGltZScsICdkb21haW4nXTtcclxuXHJcbiAgICBsZXQgX2Zyb20gPSBtZXNzYWdlLmZyb207XHJcblxyXG4gICAgaWYgKG1lc3NhZ2UuYm9keSAmJiBtZXNzYWdlLmJvZHkuaGFzT3duUHJvcGVydHkoJ3NvdXJjZScpKSB7XHJcbiAgICAgIF9mcm9tID0gbWVzc2FnZS5ib2R5LnNvdXJjZTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAobWVzc2FnZS5ib2R5ICYmIG1lc3NhZ2UuYm9keS5oYXNPd25Qcm9wZXJ0eSgnc3Vic2NyaWJlcicpKSB7XHJcbiAgICAgIF9mcm9tID0gbWVzc2FnZS5ib2R5LnN1YnNjcmliZXI7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKG1lc3NhZ2UudHlwZSA9PT0gJ2ZvcndhcmQnKSB7XHJcbiAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAobWVzc2FnZS50eXBlID09PSAnZXZlbnQnKSB7XHJcbiAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBTaWduYWxsaW5nIE1lc3NhZ2VzIGJldHdlZW4gUDJQIFN0dWJzIGRvbid0IGhhdmUgSWRlbnRpdGllcy4gRkZTXHJcbiAgICBpZiAoX2Zyb20uaW5jbHVkZXMoJy9wMnByZXF1ZXN0ZXIvJykgfHwgX2Zyb20uaW5jbHVkZXMoJy9wMnBoYW5kbGVyLycpKSB7XHJcbiAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH1cclxuXHJcblxyXG4gICAgbGV0IHNwbGl0RnJvbSA9IChfZnJvbSkuc3BsaXQoJzovLycpO1xyXG4gICAgbGV0IGZyb21TY2hlbWEgPSBzcGxpdEZyb21bMF07XHJcbiAgICBsZXQgaXNUb0lnbm9yZSA9IHNjaGVtYXNUb0lnbm9yZS5pbmRleE9mKGZyb21TY2hlbWEpID09PSAtMTtcclxuXHJcbiAgICByZXR1cm4gaXNUb0lnbm9yZTtcclxuICB9XHJcblxyXG4gIHByb2Nlc3NNZXNzYWdlKG1lc3NhZ2UpIHtcclxuICAgIGxvZy5sb2coJ1tJZGVudGl0eUhhbmRsZXIucHJvY2Vzc01lc3NhZ2VdICcsIG1lc3NhZ2UpO1xyXG5cclxuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XHJcblxyXG4gICAgICAvLyBza2lwIG1lc3NhZ2VzIHRoYXQgZG9uJ3QgbmVlZCBpZGVudGl0eSB0b2tlbnMgaW4gdGhlIGJvZHlcclxuXHJcbiAgICAgIGlmICghdGhpcy5faXNUb1NldElEKG1lc3NhZ2UpKSByZXR1cm4gcmVzb2x2ZShtZXNzYWdlKTtcclxuXHJcbiAgICAgIGlmIChtZXNzYWdlLmJvZHkgJiYgbWVzc2FnZS5ib2R5LnZhbHVlICYmIG1lc3NhZ2UuYm9keS52YWx1ZS5hbm9ueW1vdXMpe1xyXG4gICAgICAgIGlmIChtZXNzYWdlLmJvZHkuaWRlbnRpdHkgJiYgbWVzc2FnZS5ib2R5LmlkZW50aXR5Lmd1aWQpXHJcbiAgICAgICAgICBtZXNzYWdlLmJvZHkuaWRlbnRpdHkgPSB7IHVzZXJQcm9maWxlOiB7IGd1aWQ6IG1lc3NhZ2UuYm9keS5pZGVudGl0eS5ndWlkIH0gfTtcclxuICAgICAgICBlbHNlIG1lc3NhZ2UuYm9keS5pZGVudGl0eSA9IHsgdXNlclByb2ZpbGU6IHsgZ3VpZDogJ2Fub255bW91cycgfSAgfTtcclxuICAgICAgICByZXR1cm4gcmVzb2x2ZShtZXNzYWdlKTtcclxuICBcclxuICAgICAgfVxyXG4gIFxyXG5cclxuICAgICAgLyogICAgICBsZXQgZnJvbSA9IG1lc3NhZ2UuZnJvbTtcclxuICAgICAgbGV0IHNvdXJjZVVSTCA9IHVuZGVmaW5lZDtcclxuICAgICAgaWYgKCBtZXNzYWdlLmhhc093blByb3BlcnR5KCdib2R5JykgJiYgbWVzc2FnZS5ib2R5Lmhhc093blByb3BlcnR5KCdzb3VyY2UnKSkge1xyXG4gICAgICAgIGZyb20gPSBtZXNzYWdlLmJvZHkuc291cmNlO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBpZiAobWVzc2FnZS50eXBlID09PSAnZm9yd2FyZCcpIHtcclxuICAgICAgICBmcm9tID0gbWVzc2FnZS5ib2R5LmZyb207XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGlmIChtZXNzYWdlLmhhc093blByb3BlcnR5KCdib2R5JykgJiYgbWVzc2FnZS5ib2R5Lmhhc093blByb3BlcnR5KCdzdWJzY3JpYmVyJykpIHtcclxuICAgICAgICBmcm9tID0gbWVzc2FnZS5ib2R5LnN1YnNjcmliZXI7XHJcbiAgICAgIH0qL1xyXG5cclxuICAgICAgdGhpcy5faWRtLmdldFRva2VuKG1lc3NhZ2UpLnRoZW4oKGlkZW50aXR5KSA9PiB7XHJcblxyXG4gICAgICAgIGlmICghbWVzc2FnZS5oYXNPd25Qcm9wZXJ0eSgnYm9keScpKSBtZXNzYWdlLmJvZHkgPSB7fTtcclxuXHJcbiAgICAgICAgbWVzc2FnZS5ib2R5LmlkZW50aXR5ID0gaWRlbnRpdHk7XHJcbiAgICAgICAgcmVzb2x2ZShtZXNzYWdlKTtcclxuICAgICAgfSkuY2F0Y2goKHJlYXNvbikgPT4ge1xyXG4gICAgICAgIGxvZy5lcnJvcihyZWFzb24pO1xyXG4gICAgICAgIHJlamVjdChyZWFzb24pO1xyXG4gICAgICB9KTtcclxuXHJcbiAgICB9KTtcclxuXHJcblxyXG4gIH1cclxuXHJcblxyXG59XHJcblxyXG5leHBvcnQgZGVmYXVsdCBJZGVudGl0eUhhbmRsZXI7XHJcbiIsImNsYXNzIEFjdGlvbnNTZXJ2aWNlIHtcclxuXHJcbiAgY29uc3RydWN0b3IoY29udGV4dCkge1xyXG4gICAgdGhpcy5jb250ZXh0ID0gY29udGV4dDtcclxuICB9XHJcblxyXG4gIGVuZm9yY2VQb2xpY2llcyhtZXNzYWdlLCBpc0luY29taW5nTWVzc2FnZSkge1xyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XHJcblxyXG4gICAgICBsZXQgcG9saWNpZXMgPSBfdGhpcy5jb250ZXh0LmdldFBvbGljaWVzKG1lc3NhZ2UsIGlzSW5jb21pbmdNZXNzYWdlKTtcclxuXHJcbiAgICAgIGlmIChwb2xpY2llcyAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgaWYgKHBvbGljaWVzLnNlcnZpY2VQcm92aWRlclBvbGljeSAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICBwb2xpY2llcy5zZXJ2aWNlUHJvdmlkZXJQb2xpY3kuZW5mb3JjZUFjdGlvbnMoX3RoaXMuY29udGV4dCwgbWVzc2FnZSkudGhlbihtZXNzYWdlcyA9PiB7XHJcbiAgICAgICAgICAgIHJlc29sdmUobWVzc2FnZXMpO1xyXG4gICAgICAgICAgfSwgKGVycm9yKSA9PiB7XHJcbiAgICAgICAgICAgIHJlamVjdChlcnJvcik7XHJcbiAgICAgICAgICB9KTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgaWYgKHBvbGljaWVzLnVzZXJQb2xpY3kgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICBwb2xpY2llcy51c2VyUG9saWN5LmVuZm9yY2VBY3Rpb25zKF90aGlzLmNvbnRleHQsIG1lc3NhZ2UpLnRoZW4obWVzc2FnZXMgPT4ge1xyXG4gICAgICAgICAgICAgIHJlc29sdmUobWVzc2FnZXMpO1xyXG4gICAgICAgICAgICB9LCAoZXJyb3IpID0+IHtcclxuICAgICAgICAgICAgICByZWplY3QoZXJyb3IpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHJlc29sdmUoW21lc3NhZ2VdKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgcmVzb2x2ZShbbWVzc2FnZV0pO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIGZvcndhcmRUb0lEKG1lc3NhZ2UsIGVtYWlsKSB7XHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG4gICAgaWYgKCFfdGhpcy5jb250ZXh0LnJ1bnRpbWVSZWdpc3RyeSkgdGhyb3cgbmV3IEVycm9yKCdmb3J3YXJkIG1lc3NhZ2UgdG8gZ2l2ZW4gSUQgaXMgdW5zdXBwb3J0ZWQgaW4gdGhpcyBlbnZpcm9ubWVudCcpO1xyXG5cclxuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XHJcbiAgICAgIGlmIChfdGhpcy5jb250ZXh0LnJ1bnRpbWVSZWdpc3RyeS5oeXBlcnRpZXNMaXN0WzBdLmh5cGVydHlVUkwgPT09IG1lc3NhZ2UudG8pIHtcclxuICAgICAgICBsZXQgc3BsaXRUbyA9IChtZXNzYWdlLnRvKS5zcGxpdCgnOi8vJyk7XHJcbiAgICAgICAgaWYgKHNwbGl0VG9bMF0gIT09ICdydW50aW1lJykge1xyXG4gICAgICAgICAgX3RoaXMuY29udGV4dC5ydW50aW1lUmVnaXN0cnkuZGlzY292ZXJIeXBlcnR5UGVyVXNlcihlbWFpbCkudGhlbihyZXN1bHQgPT4ge1xyXG4gICAgICAgICAgICBtZXNzYWdlLnRvID0gcmVzdWx0Lmh5cGVydHlVUkw7XHJcbiAgICAgICAgICAgIG1lc3NhZ2UuYm9keS52aWEgPSB1bmRlZmluZWQ7XHJcbiAgICAgICAgICAgIHJlc29sdmUobWVzc2FnZSk7XHJcbiAgICAgICAgICAgIF90aGlzLmNvbnRleHQucnVudGltZVJlZ2lzdHJ5Ll9tZXNzYWdlQnVzLnBvc3RNZXNzYWdlKG1lc3NhZ2UpO1xyXG4gICAgICAgICAgfSwgKGVycm9yKSA9PiB7XHJcbiAgICAgICAgICAgIHJlamVjdChlcnJvcik7XHJcbiAgICAgICAgICB9KTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgcmVzb2x2ZShtZXNzYWdlKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgcmVzb2x2ZShtZXNzYWdlKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBmb3J3YXJkVG9IeXBlcnR5KG1lc3NhZ2UsIGh5cGVydHlVUkwpIHtcclxuICAgIGxldCBfdGhpcyA9IHRoaXM7XHJcbiAgICBpZiAoIV90aGlzLmNvbnRleHQucnVudGltZVJlZ2lzdHJ5KSB0aHJvdyBuZXcgRXJyb3IoJ2ZvcndhcmQgbWVzc2FnZSB0byBnaXZlbiBJRCBpcyB1bnN1cHBvcnRlZCBpbiB0aGlzIGVudmlyb25tZW50Jyk7XHJcblxyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7XHJcbiAgICAgIGlmIChfdGhpcy5jb250ZXh0LnJ1bnRpbWVSZWdpc3RyeS5oeXBlcnRpZXNMaXN0WzBdLmh5cGVydHlVUkwgPT09IG1lc3NhZ2UudG8pIHtcclxuICAgICAgICBsZXQgc3BsaXRUbyA9IChtZXNzYWdlLnRvKS5zcGxpdCgnOi8vJyk7XHJcbiAgICAgICAgaWYgKHNwbGl0VG9bMF0gIT09ICdydW50aW1lJykge1xyXG4gICAgICAgICAgbWVzc2FnZS50byA9IGh5cGVydHlVUkw7XHJcbiAgICAgICAgICBtZXNzYWdlLmJvZHkudmlhID0gdW5kZWZpbmVkO1xyXG4gICAgICAgICAgcmVzb2x2ZShtZXNzYWdlKTtcclxuICAgICAgICAgIF90aGlzLmNvbnRleHQucnVudGltZVJlZ2lzdHJ5Ll9tZXNzYWdlQnVzLnBvc3RNZXNzYWdlKG1lc3NhZ2UpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICByZXNvbHZlKG1lc3NhZ2UpO1xyXG4gICAgICAgIH1cclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICByZXNvbHZlKG1lc3NhZ2UpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIHNlbmRBdXRvbWF0aWNNZXNzYWdlKG1lc3NhZ2UsIHRleHQpIHtcclxuICAgIGxldCBfdGhpcyA9IHRoaXM7XHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHtcclxuICAgICAgbGV0IGF1dG9tYXRpY01lc3NhZ2UgPSB7XHJcbiAgICAgICAgZnJvbTogbWVzc2FnZS50byxcclxuICAgICAgICB0bzogbWVzc2FnZS5mcm9tLFxyXG4gICAgICAgIGJvZHk6IHtcclxuICAgICAgICAgIHZhbHVlOiB0ZXh0XHJcbiAgICAgICAgfSxcclxuICAgICAgICB0eXBlOiBtZXNzYWdlLnR5cGVcclxuICAgICAgfTtcclxuICAgICAgcmVzb2x2ZShtZXNzYWdlKTtcclxuICAgICAgX3RoaXMuY29udGV4dC5ydW50aW1lUmVnaXN0cnkuX21lc3NhZ2VCdXMucG9zdE1lc3NhZ2UoYXV0b21hdGljTWVzc2FnZSk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG59XHJcblxyXG5leHBvcnQgZGVmYXVsdCBBY3Rpb25zU2VydmljZTtcclxuIiwiY2xhc3MgT3BlcmF0b3JzIHtcclxuXHJcbiAgYW5kKHBhcmFtcykge1xyXG4gICAgcmV0dXJuIHBhcmFtc1swXSAmJiBwYXJhbXNbMV07XHJcbiAgfVxyXG5cclxuICBiZXR3ZWVuKHBhcmFtcykge1xyXG4gICAgbGV0IHN0YXJ0ID0gcGFyc2VJbnQocGFyYW1zWzBdWzBdKTtcclxuICAgIGxldCBlbmQgPSBwYXJzZUludChwYXJhbXNbMF1bMV0pO1xyXG4gICAgbGV0IG5vdyA9IHBhcmFtc1sxXTtcclxuXHJcbiAgICBpZiAoZW5kIDwgc3RhcnQpIHtcclxuICAgICAgbm93ID0gKG5vdyA8IHN0YXJ0KSA/IG5vdyArPSAyNDAwIDogbm93O1xyXG4gICAgICBlbmQgKz0gMjQwMDtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gKG5vdyA+IHN0YXJ0ICYmIG5vdyA8IGVuZCk7XHJcbiAgfVxyXG5cclxuICBlcXVhbHMocGFyYW1zKSB7XHJcbiAgICByZXR1cm4gU3RyaW5nKHBhcmFtc1swXSkgPT09ICcqJyB8fCBTdHJpbmcocGFyYW1zWzBdKSA9PT0gU3RyaW5nKHBhcmFtc1sxXSk7XHJcbiAgfVxyXG5cclxuICBncmVhdGVyVGhhbihwYXJhbXMpIHtcclxuICAgIHJldHVybiBwYXJhbXNbMV0gPiBwYXJhbXNbMF07XHJcbiAgfVxyXG5cclxuICBpbihwYXJhbXMpIHtcclxuICAgIHJldHVybiBwYXJhbXNbMF0uaW5kZXhPZihwYXJhbXNbMV0pID4gLTE7XHJcbiAgfVxyXG5cclxuICBsZXNzVGhhbihwYXJhbXMpIHtcclxuICAgIHJldHVybiBwYXJhbXNbMV0gPCBwYXJhbXNbMF07XHJcbiAgfVxyXG5cclxuICBub3QocGFyYW1zKSB7XHJcbiAgICByZXR1cm4gIXBhcmFtc1swXTtcclxuICB9XHJcblxyXG4gIG9yKHBhcmFtcykge1xyXG4gICAgcmV0dXJuIHBhcmFtc1swXSB8fCBwYXJhbXNbMV07XHJcbiAgfVxyXG5cclxufVxyXG5cclxuZXhwb3J0IGRlZmF1bHQgT3BlcmF0b3JzO1xyXG4iLCJpbXBvcnQgT3BlcmF0b3JzIGZyb20gJy4vT3BlcmF0b3JzJztcclxuXHJcbi8qKlxyXG4qIFRoZSBQb2xpY3kgRGVjaXNpb24gUG9pbnQgKFBEUCkgZGVjaWRlcyBpZiBhIG1lc3NhZ2UgaXMgdG8gYmUgYXV0aG9yaXNlZCBieSBjaGVja2luZyBhIHNldCBvZlxyXG4qIHBvbGljaWVzLiBUaGUgcmVzb3VyY2UgdG8gYmUgdmVyaWZpZWQgaXMgc3BlY2lmaWVkIGluIHRoZSBmaXJzdCB3b3JkIG9mIHRoZSAnY29uZGl0aW9uJyBmaWVsZCBvZlxyXG4qIGEgUG9saWN5IG9iamVjdC4gVGhlIGltcGxlbWVudGF0aW9uIHRoYXQgdmVyaWZpZXMgaWYgdGhlIG1lc3NhZ2UgaXMgY29tcGxpYW50IHdpdGggYSBwb2xpY3kgaXNcclxuKiBzcGVjaWZpZWQgaW4gYSBoYXNodGFibGUgdG8gYWxsb3cgZHluYW1pYyBkZWZpbml0aW9uIG9mIHRoZSBpbXBsZW1lbnRhdGlvbiwgcHJvdmlkaW5nXHJcbiogZXh0ZW5zaWJpbGl0eSB0byB0aGUgUG9saWN5IEVuZ2luZSBmdW5jdGlvbmFsaXRpZXMuXHJcbiovXHJcbmNsYXNzIFBEUCB7XHJcblxyXG4gIGNvbnN0cnVjdG9yKGNvbnRleHQpIHtcclxuICAgIHRoaXMuY29udGV4dCA9IGNvbnRleHQ7XHJcbiAgICB0aGlzLm9wZXJhdG9ycyA9IG5ldyBPcGVyYXRvcnMoKTtcclxuICB9XHJcblxyXG4gIGV2YWx1YXRlUG9saWNpZXMobWVzc2FnZSwgaXNJbmNvbWluZ01lc3NhZ2UpIHtcclxuICAgIGxldCBwb2xpY2llcyA9IHRoaXMuY29udGV4dC5nZXRQb2xpY2llcyhtZXNzYWdlLCBpc0luY29taW5nTWVzc2FnZSk7XHJcbiAgICBsZXQgcmVzdWx0ID0gJ05vdCBBcHBsaWNhYmxlJztcclxuICAgIGlmIChwb2xpY2llcyAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgIHJlc3VsdCA9IHRoaXMuZXZhbHVhdGVQb2xpY3kobWVzc2FnZSwgcG9saWNpZXMuc2VydmljZVByb3ZpZGVyUG9saWN5LCBpc0luY29taW5nTWVzc2FnZSk7XHJcbiAgICAgIGlmIChyZXN1bHQgfHwgcmVzdWx0ID09PSAnTm90IEFwcGxpY2FibGUnKSB7XHJcbiAgICAgICAgbGV0IHVzZXJSZXN1bHQgPSB0aGlzLmV2YWx1YXRlUG9saWN5KG1lc3NhZ2UsIHBvbGljaWVzLnVzZXJQb2xpY3ksIGlzSW5jb21pbmdNZXNzYWdlKTtcclxuICAgICAgICBpZiAodXNlclJlc3VsdCAhPT0gJ05vdCBBcHBsaWNhYmxlJykge1xyXG4gICAgICAgICAgcmVzdWx0ID0gdXNlclJlc3VsdDtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gcmVzdWx0O1xyXG4gIH1cclxuXHJcbiAgZXZhbHVhdGVQb2xpY3kobWVzc2FnZSwgcG9saWN5LCBpc0luY29taW5nKSB7XHJcbiAgICBsZXQgcmVzdWx0ID0gJ05vdCBBcHBsaWNhYmxlJztcclxuICAgIGlmIChwb2xpY3kpIHtcclxuICAgICAgcmVzdWx0ID0gcG9saWN5LmV2YWx1YXRlUnVsZXModGhpcy5jb250ZXh0LCBtZXNzYWdlLCBpc0luY29taW5nKTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gcmVzdWx0O1xyXG4gIH1cclxuXHJcbn1cclxuXHJcbmV4cG9ydCBkZWZhdWx0IFBEUDtcclxuIiwiLyoqXHJcbiogQ29weXJpZ2h0IDIwMTYgUFQgSW5vdmHDp8OjbyBlIFNpc3RlbWFzIFNBXHJcbiogQ29weXJpZ2h0IDIwMTYgSU5FU0MtSURcclxuKiBDb3B5cmlnaHQgMjAxNiBRVU9CSVMgTkVUV09SS1MgU0xcclxuKiBDb3B5cmlnaHQgMjAxNiBGUkFVTkhPRkVSLUdFU0VMTFNDSEFGVCBaVVIgRk9FUkRFUlVORyBERVIgQU5HRVdBTkRURU4gRk9SU0NIVU5HIEUuVlxyXG4qIENvcHlyaWdodCAyMDE2IE9SQU5HRSBTQVxyXG4qIENvcHlyaWdodCAyMDE2IERldXRzY2hlIFRlbGVrb20gQUdcclxuKiBDb3B5cmlnaHQgMjAxNiBBcGl6ZWVcclxuKiBDb3B5cmlnaHQgMjAxNiBURUNITklTQ0hFIFVOSVZFUlNJVEFUIEJFUkxJTlxyXG4qXHJcbiogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbipcclxuKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4qXHJcbiogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4qIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbioqL1xyXG5cclxuLyoqXHJcbiogQGF1dGhvciBBbmEgQ2FsZGVpcmEgPGFuYS5jYWxkZWlyYUB0ZWNuaWNvLnVsaXNib2EucHQ+XHJcbiogQGNsYXNzZGVzYyBDbGFzcyB0byBjb21iaW5lIHRoZSBhdXRob3JpemF0aW9uIGRlY2lzaW9ucyB0aGF0IHJlc3VsdCBmcm9tIHJ1bGVzIGV2YWx1YXRpb24uXHJcbiovXHJcbmNsYXNzIEFsbG93T3ZlcnJpZGVzIHtcclxuXHJcbiAgLyoqXHJcbiAgKiBHaXZlbiBhbiBhcnJheSBvZiBpbmRpdmlkdWFsIGF1dGhvcml6YXRpb24gZGVjaXNpb25zLCBwcmlvcml0aXplcyBhIHBvc2l0aXZlIG9uZS5cclxuICAqIEBwYXJhbSAgICB7Ym9vbGVhbltdfSAgIGRlY2lzaW9uc1xyXG4gICogQHJldHVybnMgIHtib29sZWFufVxyXG4gICovXHJcbiAgY29tYmluZShkZWNpc2lvbnMpIHtcclxuICAgIGlmIChkZWNpc2lvbnMuaW5kZXhPZih0cnVlKSAhPT0gLTEpIHtcclxuICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBpZiAoZGVjaXNpb25zLmluZGV4T2YoZmFsc2UpICE9PSAtMSkge1xyXG4gICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICByZXR1cm4gJ05vdCBBcHBsaWNhYmxlJztcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbn1cclxuXHJcbmV4cG9ydCBkZWZhdWx0IEFsbG93T3ZlcnJpZGVzO1xyXG4iLCIvKipcclxuKiBDb3B5cmlnaHQgMjAxNiBQVCBJbm92YcOnw6NvIGUgU2lzdGVtYXMgU0FcclxuKiBDb3B5cmlnaHQgMjAxNiBJTkVTQy1JRFxyXG4qIENvcHlyaWdodCAyMDE2IFFVT0JJUyBORVRXT1JLUyBTTFxyXG4qIENvcHlyaWdodCAyMDE2IEZSQVVOSE9GRVItR0VTRUxMU0NIQUZUIFpVUiBGT0VSREVSVU5HIERFUiBBTkdFV0FORFRFTiBGT1JTQ0hVTkcgRS5WXHJcbiogQ29weXJpZ2h0IDIwMTYgT1JBTkdFIFNBXHJcbiogQ29weXJpZ2h0IDIwMTYgRGV1dHNjaGUgVGVsZWtvbSBBR1xyXG4qIENvcHlyaWdodCAyMDE2IEFwaXplZVxyXG4qIENvcHlyaWdodCAyMDE2IFRFQ0hOSVNDSEUgVU5JVkVSU0lUQVQgQkVSTElOXHJcbipcclxuKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4qIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuKlxyXG4qICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbipcclxuKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4qIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4qIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuKiovXHJcblxyXG4vKipcclxuKiBAYXV0aG9yIEFuYSBDYWxkZWlyYSA8YW5hLmNhbGRlaXJhQHRlY25pY28udWxpc2JvYS5wdD5cclxuKiBAY2xhc3NkZXNjIENsYXNzIHRvIGNvbWJpbmUgdGhlIGF1dGhvcml6YXRpb24gZGVjaXNpb25zIHRoYXQgcmVzdWx0IGZyb20gcnVsZXMgZXZhbHVhdGlvbi5cclxuKi9cclxuY2xhc3MgQmxvY2tPdmVycmlkZXMge1xyXG5cclxuICAvKipcclxuICAqIEdpdmVuIGFuIGFycmF5IG9mIGluZGl2aWR1YWwgYXV0aG9yaXNhdGlvbiBkZWNpc2lvbnMsIHByaW9yaXRpc2VzIGEgbmVnYXRpdmUgb25lLlxyXG4gICogQHBhcmFtICAgIHtib29sZWFuW119ICAgZGVjaXNpb25zXHJcbiAgKiBAcmV0dXJucyAge2Jvb2xlYW59XHJcbiAgKi9cclxuICBjb21iaW5lKGRlY2lzaW9ucykge1xyXG4gICAgaWYgKGRlY2lzaW9ucy5pbmRleE9mKGZhbHNlKSAhPT0gLTEpIHtcclxuICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgaWYgKGRlY2lzaW9ucy5pbmRleE9mKHRydWUpICE9PSAtMSkge1xyXG4gICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHJldHVybiAnTm90IEFwcGxpY2FibGUnO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfVxyXG5cclxufVxyXG5cclxuZXhwb3J0IGRlZmF1bHQgQmxvY2tPdmVycmlkZXM7XHJcbiIsIi8qKlxyXG4qIENvcHlyaWdodCAyMDE2IFBUIElub3Zhw6fDo28gZSBTaXN0ZW1hcyBTQVxyXG4qIENvcHlyaWdodCAyMDE2IElORVNDLUlEXHJcbiogQ29weXJpZ2h0IDIwMTYgUVVPQklTIE5FVFdPUktTIFNMXHJcbiogQ29weXJpZ2h0IDIwMTYgRlJBVU5IT0ZFUi1HRVNFTExTQ0hBRlQgWlVSIEZPRVJERVJVTkcgREVSIEFOR0VXQU5EVEVOIEZPUlNDSFVORyBFLlZcclxuKiBDb3B5cmlnaHQgMjAxNiBPUkFOR0UgU0FcclxuKiBDb3B5cmlnaHQgMjAxNiBEZXV0c2NoZSBUZWxla29tIEFHXHJcbiogQ29weXJpZ2h0IDIwMTYgQXBpemVlXHJcbiogQ29weXJpZ2h0IDIwMTYgVEVDSE5JU0NIRSBVTklWRVJTSVRBVCBCRVJMSU5cclxuKlxyXG4qIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4qIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4qXHJcbiogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuKlxyXG4qIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4qIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4qKi9cclxuXHJcbi8qKlxyXG4qIEBhdXRob3IgQW5hIENhbGRlaXJhIDxhbmEuY2FsZGVpcmFAdGVjbmljby51bGlzYm9hLnB0PlxyXG4qIEBjbGFzc2Rlc2MgQ2xhc3MgdG8gY29tYmluZSB0aGUgYXV0aG9yaXphdGlvbiBkZWNpc2lvbnMgdGhhdCByZXN1bHQgZnJvbSBydWxlcyBldmFsdWF0aW9uLlxyXG4qL1xyXG5jbGFzcyBGaXJzdEFwcGxpY2FibGUge1xyXG5cclxuICAvKipcclxuICAqIEdpdmVuIGFuIGFycmF5IG9mIGluZGl2aWR1YWwgYXV0aG9yaXNhdGlvbiBkZWNpc2lvbnMsIHJldHVybnMgdGhlIGZpcnN0IG9uZSBkaWZmZXJlbnQgZnJvbSAnTm90IEFwcGxpY2FibGUnLCBlaXRoZXIgcG9zaXRpdmUgb3IgbmVnYXRpdmUuXHJcbiAgKiBAcGFyYW0gICAge2Jvb2xlYW5bXX0gICAgIGRlY2lzaW9uc1xyXG4gICogQHJldHVybnMgIHtib29sZWFufVxyXG4gICovXHJcbiAgY29tYmluZShkZWNpc2lvbnMpIHtcclxuICAgIGZvciAobGV0IGkgaW4gZGVjaXNpb25zKSB7XHJcbiAgICAgIGlmIChkZWNpc2lvbnNbaV0gIT09ICdOb3QgQXBwbGljYWJsZScpIHtcclxuICAgICAgICByZXR1cm4gZGVjaXNpb25zW2ldO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICByZXR1cm4gJ05vdCBBcHBsaWNhYmxlJztcclxuICB9XHJcblxyXG59XHJcblxyXG5leHBvcnQgZGVmYXVsdCBGaXJzdEFwcGxpY2FibGU7XHJcbiIsIi8qKlxyXG4qIENvcHlyaWdodCAyMDE2IFBUIElub3Zhw6fDo28gZSBTaXN0ZW1hcyBTQVxyXG4qIENvcHlyaWdodCAyMDE2IElORVNDLUlEXHJcbiogQ29weXJpZ2h0IDIwMTYgUVVPQklTIE5FVFdPUktTIFNMXHJcbiogQ29weXJpZ2h0IDIwMTYgRlJBVU5IT0ZFUi1HRVNFTExTQ0hBRlQgWlVSIEZPRVJERVJVTkcgREVSIEFOR0VXQU5EVEVOIEZPUlNDSFVORyBFLlZcclxuKiBDb3B5cmlnaHQgMjAxNiBPUkFOR0UgU0FcclxuKiBDb3B5cmlnaHQgMjAxNiBEZXV0c2NoZSBUZWxla29tIEFHXHJcbiogQ29weXJpZ2h0IDIwMTYgQXBpemVlXHJcbiogQ29weXJpZ2h0IDIwMTYgVEVDSE5JU0NIRSBVTklWRVJTSVRBVCBCRVJMSU5cclxuKlxyXG4qIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4qIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4qXHJcbiogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuKlxyXG4qIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4qIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4qKi9cclxuXHJcbmltcG9ydCBPcGVyYXRvcnMgZnJvbSAnLi4vT3BlcmF0b3JzJztcclxuXHJcbi8qKlxyXG4qIEBhdXRob3IgQW5hIENhbGRlaXJhIDxhbmEuY2FsZGVpcmFAdGVjbmljby51bGlzYm9hLnB0PlxyXG4qIEBjbGFzc2Rlc2MgQ2xhc3MgdG8gcmVwcmVzZW50IGEgY29uZGl0aW9uIGFuZCBldmFsdWF0ZSBpdHMgYXBwbGljYWJpbGl0eS5cclxuKi9cclxuY2xhc3MgQ29uZGl0aW9uIHtcclxuXHJcbiAgLyoqXHJcbiAgKiBDcmVhdGVzIGEgbmV3IENvbmRpdGlvbi5cclxuICAqIEBjbGFzc1xyXG4gICogQHBhcmFtICB7c3RyaW5nfSAgYXR0cmlidXRlXHJcbiAgKiBAcGFyYW0gIHtzdHJpbmd9ICBvcGVyYXRvclxyXG4gICogQHBhcmFtICB7Kn0gICAgICAgcGFyYW1zXHJcbiAgKi9cclxuICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGUsIG9wZXJhdG9yLCBwYXJhbXMpIHtcclxuICAgIHRoaXMuYXR0cmlidXRlID0gYXR0cmlidXRlO1xyXG4gICAgdGhpcy5vcGVyYXRvciA9IG9wZXJhdG9yO1xyXG4gICAgdGhpcy5wYXJhbXMgPSBwYXJhbXM7XHJcbiAgICB0aGlzLm9wZXJhdG9ycyA9IG5ldyBPcGVyYXRvcnMoKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICogVmVyaWZpZXMgaWYgdGhlIGNvbmRpdGlvbiBpcyBhcHBsaWNhYmxlIHRvIHRoZSBtZXNzYWdlLiBGaXJzdCwgdGhlIHN5c3RlbSB2YWx1ZSB0aGF0IGNvcnJlc3BvbmRzIHRvIHRoZSBhdHRyaWJ1dGUgaXMgcmV0cmlldmVkOyB0aGVuLCB0aGF0IHZhbHVlIGlzIGNvbXBhcmVkIHdpdGggdGhlIHBhcmFtZXRlciBzcGVjaWZpZWQgaW4gdGhlIGNvbmRpdGlvbiBieSBleGVjdXRpbmcgdGhlIG9wZXJhdG9yIGltcGxlbWVudGF0aW9uLiBJZiB0aGUgb3BlcmF0b3IgaXMgJ2luJyBhbmQgdGhlIG5hbWUgb2YgYSBncm91cCBpcyBnaXZlbiwgdGhlbiB0aGUgYXJyYXkgaG9sZGluZyB0aGUgbWVtYmVycyBvZiB0aGUgZ3JvdXAgaXMgcmV0cmlldmVkIGJlZm9yZSB0aGUgY29tcGFyaXNvbi5cclxuICAqIEBwYXJhbSAge09iamVjdH0gICAgY29udGV4dCAgIGVudmlyb25tZW50IHdoZXJlIHRoZSBQb2xpY3kgRW5naW5lIGlzIGJlaW5nIHVzZWRcclxuICAqIEBwYXJhbSAge09iamVjdH0gICAgbWVzc2FnZVxyXG4gICovXHJcbiAgaXNBcHBsaWNhYmxlKGNvbnRleHQsIG1lc3NhZ2UpIHtcclxuICAgIGNvbnRleHRbdGhpcy5hdHRyaWJ1dGVdID0geyBtZXNzYWdlOiBtZXNzYWdlIH07XHJcbiAgICBsZXQgdmFsdWUgPSBjb250ZXh0W3RoaXMuYXR0cmlidXRlXTtcclxuICAgIGxldCB0ZW1wUGFyYW07XHJcblxyXG4gICAgaWYgKHRoaXMub3BlcmF0b3IgPT09ICdpbicpIHtcclxuICAgICAgaWYgKCEoQXJyYXkuaXNBcnJheSh0aGlzLnBhcmFtcykpKSB7XHJcbiAgICAgICAgdGVtcFBhcmFtID0gY29udGV4dC5nZXRHcm91cCh0aGlzLnBhcmFtcywgbWVzc2FnZS50byk7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMub3BlcmF0b3JzW3RoaXMub3BlcmF0b3JdKFt0ZW1wUGFyYW0sIHZhbHVlXSk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gdGhpcy5vcGVyYXRvcnNbdGhpcy5vcGVyYXRvcl0oW3RoaXMucGFyYW1zLCB2YWx1ZV0pO1xyXG4gIH1cclxuXHJcbn1cclxuXHJcbmV4cG9ydCBkZWZhdWx0IENvbmRpdGlvbjtcclxuIiwiLyoqXHJcbiogQ29weXJpZ2h0IDIwMTYgUFQgSW5vdmHDp8OjbyBlIFNpc3RlbWFzIFNBXHJcbiogQ29weXJpZ2h0IDIwMTYgSU5FU0MtSURcclxuKiBDb3B5cmlnaHQgMjAxNiBRVU9CSVMgTkVUV09SS1MgU0xcclxuKiBDb3B5cmlnaHQgMjAxNiBGUkFVTkhPRkVSLUdFU0VMTFNDSEFGVCBaVVIgRk9FUkRFUlVORyBERVIgQU5HRVdBTkRURU4gRk9SU0NIVU5HIEUuVlxyXG4qIENvcHlyaWdodCAyMDE2IE9SQU5HRSBTQVxyXG4qIENvcHlyaWdodCAyMDE2IERldXRzY2hlIFRlbGVrb20gQUdcclxuKiBDb3B5cmlnaHQgMjAxNiBBcGl6ZWVcclxuKiBDb3B5cmlnaHQgMjAxNiBURUNITklTQ0hFIFVOSVZFUlNJVEFUIEJFUkxJTlxyXG4qXHJcbiogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbipcclxuKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4qXHJcbiogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4qIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbioqL1xyXG5cclxuaW1wb3J0IENvbmRpdGlvbiBmcm9tICcuL0NvbmRpdGlvbic7XHJcblxyXG4vKipcclxuKiBAYXV0aG9yIEFuYSBDYWxkZWlyYSA8YW5hLmNhbGRlaXJhQHRlY25pY28udWxpc2JvYS5wdD5cclxuKiBAY2xhc3NkZXNjIENsYXNzIHRvIHJlcHJlc2VudCBhIHN1YnNjcmlwdGlvbiBjb25kaXRpb24gYW5kIGV2YWx1YXRlIGl0cyBhcHBsaWNhYmlsaXR5LlxyXG4qL1xyXG5jbGFzcyBTdWJzY3JpcHRpb25Db25kaXRpb24gZXh0ZW5kcyBDb25kaXRpb24ge1xyXG5cclxuICAvKipcclxuICAqIENyZWF0ZXMgYSBuZXcgU3Vic2NyaXB0aW9uQ29uZGl0aW9uLlxyXG4gICogQGNsYXNzXHJcbiAgKiBAcGFyYW0gIHtzdHJpbmd9ICBhdHRyaWJ1dGVcclxuICAqIEBwYXJhbSAge3N0cmluZ30gIG9wZXJhdG9yXHJcbiAgKiBAcGFyYW0gIHsqfSAgICAgICBwYXJhbXNcclxuICAqL1xyXG4gIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZSwgb3BlcmF0b3IsIHBhcmFtcykge1xyXG4gICAgc3VwZXIoYXR0cmlidXRlLCBvcGVyYXRvciwgcGFyYW1zKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICogVmVyaWZpZXMgaWYgdGhlIHN1YnNjcmlwdGlvbiBjb25kaXRpb24gaXMgYXBwbGljYWJsZSB0byB0aGUgbWVzc2FnZS4gRmlyc3QsIHZlcmlmaWVzIGlmIHRoZSBtZXNzYWdlIGlzIG9mIHRoZSBzdWJzY3JpcHRpb24gdHlwZTsgc2Vjb25kLCB2ZXJpZmllcyBpZiB0aGUgbWVzc2FnZSBpcyBmcm9tIGEgcmVtb3RlIHJ1bnRpbWUgdG8gZ3VhcmFudGVlIHRoYXQgdGhlIHN1YnNjcmlwdGlvbiBpcyBiZWluZyB2YWxpZGF0ZWQgaW4gdGhlIGRlc3RpbmF0aW9uIHJ1bnRpbWU7IHRoaXJkLCB2ZXJpZmllcyBpZiB0aGUgc3Vic2NyaXB0aW9uIHByZWZlcmVuY2UgaXMgbWV0LlxyXG4gICogQHBhcmFtICB7T2JqZWN0fSAgICBjb250ZXh0ICAgZW52aXJvbm1lbnQgd2hlcmUgdGhlIFBvbGljeSBFbmdpbmUgaXMgYmVpbmcgdXNlZFxyXG4gICogQHBhcmFtICB7T2JqZWN0fSAgICBtZXNzYWdlXHJcbiAgKi9cclxuICBpc0FwcGxpY2FibGUoY29udGV4dCwgbWVzc2FnZSkge1xyXG4gICAgbGV0IGlzU3Vic2NyaXB0aW9uID0gbWVzc2FnZS50eXBlID09PSAnc3Vic2NyaWJlJztcclxuICAgIGxldCBpc0Zyb21SZW1vdGVTTSA9IGNvbnRleHQuaXNGcm9tUmVtb3RlU00obWVzc2FnZS5mcm9tKTtcclxuICAgIGlmIChpc1N1YnNjcmlwdGlvbiAmIGlzRnJvbVJlbW90ZVNNKSB7XHJcbiAgICAgIHJldHVybiBzdXBlci5pc0FwcGxpY2FibGUoY29udGV4dCwgbWVzc2FnZSk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxufVxyXG5cclxuZXhwb3J0IGRlZmF1bHQgU3Vic2NyaXB0aW9uQ29uZGl0aW9uO1xyXG4iLCJpbXBvcnQgQ29uZGl0aW9uIGZyb20gJy4vQ29uZGl0aW9uJztcclxuaW1wb3J0IE9wZXJhdG9ycyBmcm9tICcuLi9PcGVyYXRvcnMnO1xyXG5pbXBvcnQgU3Vic2NyaXB0aW9uQ29uZGl0aW9uIGZyb20gJy4vU3Vic2NyaXB0aW9uQ29uZGl0aW9uJztcclxuXHJcbmNsYXNzIEFkdmFuY2VkQ29uZGl0aW9uIHtcclxuXHJcbiAgY29uc3RydWN0b3IoY29uZGl0aW9uKSB7XHJcbiAgICB0aGlzLm9wZXJhdG9ycyA9IG5ldyBPcGVyYXRvcnMoKTtcclxuICAgIGlmIChjb25kaXRpb24ub3BlcmF0b3JzICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgY29uZGl0aW9uID0gY29uZGl0aW9uLmNvbmRpdGlvbjtcclxuICAgIH1cclxuICAgIGNvbmRpdGlvbiA9IHRoaXMuYnVpbGRDb25kaXRpb24oY29uZGl0aW9uKTtcclxuICAgIHRoaXMuY29uZGl0aW9uID0gY29uZGl0aW9uO1xyXG4gIH1cclxuXHJcbiAgYnVpbGRDb25kaXRpb24oY29uZGl0aW9uKSB7XHJcbiAgICBpZiAoQXJyYXkuaXNBcnJheShjb25kaXRpb25bMV0pKSB7XHJcbiAgICAgIGNvbmRpdGlvblsxXSA9IHRoaXMuYnVpbGRDb25kaXRpb24oY29uZGl0aW9uWzFdKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGlmIChjb25kaXRpb25bMV0uYXR0cmlidXRlID09PSAnc3Vic2NyaXB0aW9uJykge1xyXG4gICAgICAgIGNvbmRpdGlvblsxXSA9IG5ldyBTdWJzY3JpcHRpb25Db25kaXRpb24oY29uZGl0aW9uWzFdLmF0dHJpYnV0ZSwgY29uZGl0aW9uWzFdLm9wZXJhdG9yLCBjb25kaXRpb25bMV0ucGFyYW1zKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBjb25kaXRpb25bMV0gPSBuZXcgQ29uZGl0aW9uKGNvbmRpdGlvblsxXS5hdHRyaWJ1dGUsIGNvbmRpdGlvblsxXS5vcGVyYXRvciwgY29uZGl0aW9uWzFdLnBhcmFtcyk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBpZiAoY29uZGl0aW9uWzJdICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgaWYgKEFycmF5LmlzQXJyYXkoY29uZGl0aW9uWzJdKSkge1xyXG4gICAgICAgIGNvbmRpdGlvblsyXSA9IHRoaXMuYnVpbGRDb25kaXRpb24oY29uZGl0aW9uWzJdKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBpZiAoY29uZGl0aW9uWzJdLmF0dHJpYnV0ZSA9PT0gJ3N1YnNjcmlwdGlvbicpIHtcclxuICAgICAgICAgIGNvbmRpdGlvblsyXSA9IG5ldyBTdWJzY3JpcHRpb25Db25kaXRpb24oY29uZGl0aW9uWzJdLmF0dHJpYnV0ZSwgY29uZGl0aW9uWzJdLm9wZXJhdG9yLCBjb25kaXRpb25bMl0ucGFyYW1zKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgY29uZGl0aW9uWzJdID0gbmV3IENvbmRpdGlvbihjb25kaXRpb25bMl0uYXR0cmlidXRlLCBjb25kaXRpb25bMl0ub3BlcmF0b3IsIGNvbmRpdGlvblsyXS5wYXJhbXMpO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgcmV0dXJuIGNvbmRpdGlvbjtcclxuICB9XHJcblxyXG4gIGlzQXBwbGljYWJsZShjb250ZXh0LCBtZXNzYWdlLCBzY29wZSwgdGFyZ2V0LCBvcGVyYXRvciwgbGVmdCwgcmlnaHQpIHtcclxuICAgIGlmICghb3BlcmF0b3IpIHtcclxuICAgICAgb3BlcmF0b3IgPSB0aGlzLmNvbmRpdGlvblswXTtcclxuICAgICAgbGVmdCA9IHRoaXMuY29uZGl0aW9uWzFdO1xyXG4gICAgICByaWdodCA9IHRoaXMuY29uZGl0aW9uWzJdO1xyXG4gICAgfVxyXG5cclxuICAgIHdoaWxlICghKGxlZnQgaW5zdGFuY2VvZiBDb25kaXRpb24pICYgIShsZWZ0IGluc3RhbmNlb2YgU3Vic2NyaXB0aW9uQ29uZGl0aW9uKSAmICh0eXBlb2YgbGVmdCAhPT0gJ2Jvb2xlYW4nKSkge1xyXG4gICAgICBsZWZ0ID0gdGhpcy5pc0FwcGxpY2FibGUoY29udGV4dCwgbWVzc2FnZSwgc2NvcGUsIHRhcmdldCwgbGVmdFswXSwgbGVmdFsxXSwgbGVmdFsyXSk7XHJcbiAgICB9XHJcbiAgICBpZiAocmlnaHQgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICB3aGlsZSAoIShyaWdodCBpbnN0YW5jZW9mIENvbmRpdGlvbikgJiAhKHJpZ2h0IGluc3RhbmNlb2YgU3Vic2NyaXB0aW9uQ29uZGl0aW9uKSAmICh0eXBlb2YgcmlnaHQgIT09ICdib29sZWFuJykpIHtcclxuICAgICAgICByaWdodCA9IHRoaXMuaXNBcHBsaWNhYmxlKGNvbnRleHQsIG1lc3NhZ2UsIHNjb3BlLCB0YXJnZXQsIHJpZ2h0WzBdLCByaWdodFsxXSwgcmlnaHRbMl0pO1xyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgbGV0IHJlc3VsdExlZnQgPSAodHlwZW9mIGxlZnQgPT09ICdib29sZWFuJykgPyBsZWZ0IDogbGVmdC5pc0FwcGxpY2FibGUoY29udGV4dCwgbWVzc2FnZSwgc2NvcGUsIHRhcmdldCk7XHJcbiAgICBsZXQgcmVzdWx0UmlnaHQ7XHJcbiAgICBpZiAocmlnaHQgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICByZXN1bHRSaWdodCA9ICh0eXBlb2YgcmlnaHQgPT09ICdib29sZWFuJykgPyByaWdodCA6IHJpZ2h0LmlzQXBwbGljYWJsZShjb250ZXh0LCBtZXNzYWdlLCBzY29wZSwgdGFyZ2V0KTtcclxuICAgIH1cclxuICAgIHJldHVybiB0aGlzLm9wZXJhdG9yc1tvcGVyYXRvcl0oW3Jlc3VsdExlZnQsIHJlc3VsdFJpZ2h0XSk7XHJcbiAgfVxyXG5cclxufVxyXG5cclxuZXhwb3J0IGRlZmF1bHQgQWR2YW5jZWRDb25kaXRpb247XHJcbiIsImltcG9ydCBBZHZhbmNlZENvbmRpdGlvbiBmcm9tICcuL2NvbmRpdGlvbnMvQWR2YW5jZWRDb25kaXRpb24nO1xyXG5pbXBvcnQgQ29uZGl0aW9uIGZyb20gJy4vY29uZGl0aW9ucy9Db25kaXRpb24nO1xyXG5pbXBvcnQge2dldFVzZXJFbWFpbEZyb21VUkwsIGlzRGF0YU9iamVjdFVSTCwgcmVtb3ZlUGF0aEZyb21VUkx9IGZyb20gJy4uL3V0aWxzL3V0aWxzJztcclxuaW1wb3J0IFN1YnNjcmlwdGlvbkNvbmRpdGlvbiBmcm9tICcuL2NvbmRpdGlvbnMvQWR2YW5jZWRDb25kaXRpb24nO1xyXG5cclxuY2xhc3MgUnVsZSB7XHJcblxyXG4gIGNvbnN0cnVjdG9yKGRlY2lzaW9uLCBjb25kaXRpb24sIHNjb3BlLCB0YXJnZXQsIHByaW9yaXR5KSB7XHJcbiAgICB0aGlzLmRlY2lzaW9uID0gZGVjaXNpb247XHJcbiAgICB0aGlzLnNldENvbmRpdGlvbihjb25kaXRpb24pO1xyXG4gICAgdGhpcy5wcmlvcml0eSA9IHByaW9yaXR5O1xyXG4gICAgdGhpcy5zY29wZSA9IHNjb3BlO1xyXG4gICAgdGhpcy50YXJnZXQgPSB0YXJnZXQ7XHJcbiAgfVxyXG5cclxuICBzZXRDb25kaXRpb24oY29uZGl0aW9uKSB7XHJcbiAgICBpZiAoIShjb25kaXRpb24gaW5zdGFuY2VvZiBDb25kaXRpb24gfHwgY29uZGl0aW9uIGluc3RhbmNlb2YgU3Vic2NyaXB0aW9uQ29uZGl0aW9uIHx8IGNvbmRpdGlvbiBpbnN0YW5jZW9mIEFkdmFuY2VkQ29uZGl0aW9uKSkge1xyXG4gICAgICBsZXQgYXR0cmlidXRlID0gY29uZGl0aW9uLmF0dHJpYnV0ZTtcclxuICAgICAgc3dpdGNoIChhdHRyaWJ1dGUpIHtcclxuICAgICAgICBjYXNlICdzdWJzY3JpcHRpb24nOlxyXG4gICAgICAgICAgdGhpcy5jb25kaXRpb24gPSBuZXcgU3Vic2NyaXB0aW9uQ29uZGl0aW9uKGNvbmRpdGlvbi5hdHRyaWJ1dGUsIGNvbmRpdGlvbi5vcGVyYXRvciwgY29uZGl0aW9uLnBhcmFtcyk7XHJcbiAgICAgICAgICBicmVhaztcclxuICAgICAgICBjYXNlIHVuZGVmaW5lZDpcclxuICAgICAgICAgIHRoaXMuY29uZGl0aW9uID0gbmV3IEFkdmFuY2VkQ29uZGl0aW9uKGNvbmRpdGlvbik7XHJcbiAgICAgICAgICBicmVhaztcclxuICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgdGhpcy5jb25kaXRpb24gPSBuZXcgQ29uZGl0aW9uKGNvbmRpdGlvbi5hdHRyaWJ1dGUsIGNvbmRpdGlvbi5vcGVyYXRvciwgY29uZGl0aW9uLnBhcmFtcyk7XHJcbiAgICAgIH1cclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRoaXMuY29uZGl0aW9uID0gY29uZGl0aW9uO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgZXZhbHVhdGUoY29udGV4dCwgbWVzc2FnZSwgaXNJbmNvbWluZykge1xyXG4gICAgbGV0IGZpZWxkID0gKGlzSW5jb21pbmcpID8gbWVzc2FnZS50byA6IG1lc3NhZ2UuZnJvbTtcclxuICAgIGxldCBoeXBlcnR5TmFtZTtcclxuICAgIHN3aXRjaCAodGhpcy5zY29wZSkge1xyXG4gICAgICBjYXNlICdnbG9iYWwnOlxyXG4gICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgY2FzZSAnaHlwZXJ0eSc6XHJcbiAgICAgICAgaWYgKGlzRGF0YU9iamVjdFVSTChmaWVsZCkpIHtcclxuICAgICAgICAgIGxldCByZXBvcnRlciA9IGNvbnRleHQucnVudGltZVJlZ2lzdHJ5LmdldFJlcG9ydGVyVVJMU3luY2hvbm91cyhyZW1vdmVQYXRoRnJvbVVSTChmaWVsZCkpO1xyXG4gICAgICAgICAgaWYgKHJlcG9ydGVyICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgaHlwZXJ0eU5hbWUgPSBjb250ZXh0LnJ1bnRpbWVSZWdpc3RyeS5nZXRIeXBlcnR5TmFtZShyZXBvcnRlcik7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIGlmIChmaWVsZC5zcGxpdCgnOi8vJylbMF0gPT09ICdoeXBlcnR5Jykge1xyXG4gICAgICAgICAgICBoeXBlcnR5TmFtZSA9IGNvbnRleHQucnVudGltZVJlZ2lzdHJ5LmdldEh5cGVydHlOYW1lKHJlbW92ZVBhdGhGcm9tVVJMKGZpZWxkKSk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChoeXBlcnR5TmFtZSA9PT0gdGhpcy50YXJnZXQpIHtcclxuICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuICdOb3QgQXBwbGljYWJsZSc7XHJcblxyXG4gICAgICBjYXNlICdpZGVudGl0eSc6XHJcbiAgICAgICAgbGV0IG93bmVyO1xyXG5cclxuICAgICAgICBpZiAoaXNEYXRhT2JqZWN0VVJMKGZpZWxkKSkge1xyXG4gICAgICAgICAgbGV0IHJlcG9ydGVyID0gY29udGV4dC5ydW50aW1lUmVnaXN0cnkuZ2V0UmVwb3J0ZXJVUkxTeW5jaG9ub3VzKHJlbW92ZVBhdGhGcm9tVVJMKGZpZWxkKSk7XHJcbiAgICAgICAgICBvd25lciA9IGNvbnRleHQucnVudGltZVJlZ2lzdHJ5LmdldEh5cGVydHlPd25lcihyZXBvcnRlcik7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIGlmIChmaWVsZC5zcGxpdCgnOi8vJylbMF0gPT09ICdoeXBlcnR5Jykge1xyXG4gICAgICAgICAgICBvd25lciA9IGNvbnRleHQucnVudGltZVJlZ2lzdHJ5LmdldEh5cGVydHlPd25lcihyZW1vdmVQYXRoRnJvbVVSTChmaWVsZCkpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAob3duZXIgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgb3duZXIgPSBnZXRVc2VyRW1haWxGcm9tVVJMKG93bmVyKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKG93bmVyID09PSB0aGlzLnRhcmdldCkge1xyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gJ05vdCBBcHBsaWNhYmxlJztcclxuICAgIH1cclxuXHJcbiAgICBpZiAodGhpcy5jb25kaXRpb24uaXNBcHBsaWNhYmxlKGNvbnRleHQsIG1lc3NhZ2UsIHRoaXMuc2NvcGUsIHRoaXMudGFyZ2V0KSkge1xyXG4gICAgICByZXR1cm4gdGhpcy5kZWNpc2lvbjtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHJldHVybiAnTm90IEFwcGxpY2FibGUnO1xyXG4gICAgfVxyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGRlZmF1bHQgUnVsZTtcclxuIiwiaW1wb3J0IEFsbG93T3ZlcnJpZGVzIGZyb20gJy4vY29tYmluaW5nQWxnb3JpdGhtcy9BbGxvd092ZXJyaWRlcyc7XHJcbmltcG9ydCBCbG9ja092ZXJyaWRlcyBmcm9tICcuL2NvbWJpbmluZ0FsZ29yaXRobXMvQmxvY2tPdmVycmlkZXMnO1xyXG5pbXBvcnQgRmlyc3RBcHBsaWNhYmxlIGZyb20gJy4vY29tYmluaW5nQWxnb3JpdGhtcy9GaXJzdEFwcGxpY2FibGUnO1xyXG5pbXBvcnQgUnVsZSBmcm9tICcuL1J1bGUnO1xyXG5cclxuY2xhc3MgUG9saWN5IHtcclxuXHJcbiAgY29uc3RydWN0b3Ioa2V5LCBydWxlcywgYWN0aW9ucywgY29tYmluaW5nQWxnb3JpdGhtKSB7XHJcbiAgICBpZiAoIWtleSkgdGhyb3cgbmV3IEVycm9yKCdrZXkgaXMgbm90IGRlZmluZWQnKTtcclxuICAgIGlmICghYWN0aW9ucykgdGhyb3cgbmV3IEVycm9yKCdhY3Rpb25zIGFyZSBub3QgZGVmaW5lZCcpO1xyXG5cclxuICAgIHRoaXMuYWN0aW9ucyA9IGFjdGlvbnM7XHJcbiAgICB0aGlzLmtleSA9IGtleTtcclxuICAgIHRoaXMuX3NldFJ1bGVzKHJ1bGVzKTtcclxuICAgIHRoaXMuX3NldENvbWJpbmluZ0FsZ29yaXRobShjb21iaW5pbmdBbGdvcml0aG0pO1xyXG4gIH1cclxuXHJcbiAgYWRkQWN0aW9uKG1ldGhvZCwgcGFyYW0pIHtcclxuICAgIHRoaXMuYWN0aW9ucy5wdXNoKHsgbWV0aG9kOiBtZXRob2QsIHBhcmFtOiBwYXJhbSB9KTtcclxuICB9XHJcblxyXG4gIGNyZWF0ZVJ1bGUoZGVjaXNpb24sIGNvbmRpdGlvbiwgc2NvcGUsIHRhcmdldCwgcHJpb3JpdHkpIHtcclxuICAgIGlmIChwcmlvcml0eSA9PT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgIHByaW9yaXR5ID0gdGhpcy5nZXRMYXN0UHJpb3JpdHkoKSArIDE7XHJcbiAgICB9XHJcbiAgICBsZXQgcnVsZSA9IG5ldyBSdWxlKGRlY2lzaW9uLCBjb25kaXRpb24sIHNjb3BlLCB0YXJnZXQsIHByaW9yaXR5KTtcclxuICAgIHRoaXMucnVsZXMucHVzaChydWxlKTtcclxuICB9XHJcblxyXG4gIGRlbGV0ZVJ1bGUocnVsZSkge1xyXG4gICAgbGV0IGluZGV4VG9SZW1vdmUgPSB0aGlzLnJ1bGVzLmluZGV4T2YocnVsZSk7XHJcbiAgICB0aGlzLnJ1bGVzLnNwbGljZShpbmRleFRvUmVtb3ZlLCAxKTtcclxuICB9XHJcblxyXG4gIGVuZm9yY2VBY3Rpb25zKGNvbnRleHQsIG1lc3NhZ2UpIHtcclxuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XHJcbiAgICAgIGxldCByZXN1bHRzID0gW107XHJcbiAgICAgIGlmICh0aGlzLmFjdGlvbnMubGVuZ3RoICE9PSAwKSB7XHJcbiAgICAgICAgZm9yIChsZXQgaSBpbiB0aGlzLmFjdGlvbnMpIHtcclxuICAgICAgICAgIGxldCByZXN1bHQgPSBjb250ZXh0LnBlcC5hY3Rpb25zU2VydmljZVt0aGlzLmFjdGlvbnNbaV0ubWV0aG9kXShtZXNzYWdlLCB0aGlzLmFjdGlvbnNbaV0ucGFyYW0pO1xyXG4gICAgICAgICAgcmVzdWx0cy5wdXNoKHJlc3VsdCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIFByb21pc2UuYWxsKHJlc3VsdHMpLnRoZW4oKG1lc3NhZ2VzKSA9PiB7XHJcbiAgICAgICAgICByZXNvbHZlKG1lc3NhZ2VzKTtcclxuICAgICAgICB9LCBlcnJvciA9PiB7XHJcbiAgICAgICAgICByZWplY3QoZXJyb3IpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHJlc29sdmUoW21lc3NhZ2VdKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBldmFsdWF0ZVJ1bGVzKGNvbnRleHQsIG1lc3NhZ2UsIGlzSW5jb21pbmcpIHtcclxuICAgIGxldCByZXN1bHRzID0gW107XHJcbiAgICBmb3IgKGxldCBpIGluIHRoaXMucnVsZXMpIHtcclxuICAgICAgcmVzdWx0cy5wdXNoKHRoaXMucnVsZXNbaV0uZXZhbHVhdGUoY29udGV4dCwgbWVzc2FnZSwgaXNJbmNvbWluZykpO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiB0aGlzLmNvbWJpbmluZ0FsZ29yaXRobS5jb21iaW5lKHJlc3VsdHMpO1xyXG4gIH1cclxuXHJcbiAgZ2V0TGFzdFByaW9yaXR5KCkge1xyXG4gICAgbGV0IHByaW9yaXRpZXMgPSBbXTtcclxuXHJcbiAgICBpZiAodGhpcy5ydWxlcy5sZW5ndGggIT09IDApIHtcclxuICAgICAgZm9yIChsZXQgaSBpbiB0aGlzLnJ1bGVzKSB7XHJcbiAgICAgICAgcHJpb3JpdGllcy5wdXNoKHRoaXMucnVsZXNbaV0ucHJpb3JpdHkpO1xyXG4gICAgICB9XHJcbiAgICAgIHJldHVybiBNYXRoLm1heC5hcHBseShNYXRoLCBwcmlvcml0aWVzKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHJldHVybiAtMTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIGdldFJ1bGVCeVByaW9yaXR5KHByaW9yaXR5KSB7XHJcbiAgICBmb3IgKGxldCBpIGluIHRoaXMucnVsZXMpIHtcclxuICAgICAgaWYgKFN0cmluZyh0aGlzLnJ1bGVzW2ldLnByaW9yaXR5KSA9PT0gU3RyaW5nKHByaW9yaXR5KSkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLnJ1bGVzW2ldO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICB0aHJvdyBFcnJvcignUnVsZSB3aXRoIHByaW9yaXR5ICcgKyBwcmlvcml0eSArICcgZG9lcyBub3QgZXhpc3QhJyk7XHJcbiAgfVxyXG5cclxuICBfc2V0Q29tYmluaW5nQWxnb3JpdGhtKGNvbWJpbmluZ0FsZ29yaXRobSkge1xyXG4gICAgaWYgKCFjb21iaW5pbmdBbGdvcml0aG0pIHtcclxuICAgICAgY29tYmluaW5nQWxnb3JpdGhtID0gJ2Jsb2NrT3ZlcnJpZGVzJztcclxuICAgIH1cclxuICAgIHN3aXRjaCAoY29tYmluaW5nQWxnb3JpdGhtKSB7XHJcbiAgICAgIGNhc2UgJ2Jsb2NrT3ZlcnJpZGVzJzpcclxuICAgICAgICB0aGlzLmNvbWJpbmluZ0FsZ29yaXRobSA9IG5ldyBCbG9ja092ZXJyaWRlcygpO1xyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgICBjYXNlICdhbGxvd092ZXJyaWRlcyc6XHJcbiAgICAgICAgdGhpcy5jb21iaW5pbmdBbGdvcml0aG0gPSBuZXcgQWxsb3dPdmVycmlkZXMoKTtcclxuICAgICAgICBicmVhaztcclxuICAgICAgY2FzZSAnZmlyc3RBcHBsaWNhYmxlJzpcclxuICAgICAgICB0aGlzLmNvbWJpbmluZ0FsZ29yaXRobSA9IG5ldyBGaXJzdEFwcGxpY2FibGUoKTtcclxuICAgICAgICBicmVhaztcclxuICAgICAgZGVmYXVsdDpcclxuICAgICAgICB0aHJvdyBFcnJvcignVW5rbm93biBhbGdvcml0aG06ICcgKyBjb21iaW5pbmdBbGdvcml0aG0pO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgX3NldFJ1bGVzKHJ1bGVzKSB7XHJcbiAgICB0aGlzLnJ1bGVzID0gW107XHJcblxyXG4gICAgZm9yIChsZXQgaSBpbiBydWxlcykge1xyXG4gICAgICBsZXQgcnVsZSA9IHJ1bGVzW2ldO1xyXG4gICAgICBpZiAocnVsZS5wcmlvcml0eSA9PT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgcnVsZS5wcmlvcml0eSA9IHRoaXMuZ2V0TGFzdFByaW9yaXR5KCkgKyAxO1xyXG4gICAgICB9XHJcbiAgICAgIGlmICghKHJ1bGUgaW5zdGFuY2VvZiBSdWxlKSkge1xyXG4gICAgICAgIHJ1bGUgPSBuZXcgUnVsZShydWxlLmRlY2lzaW9uLCBydWxlLmNvbmRpdGlvbiwgcnVsZS5zY29wZSwgcnVsZS50YXJnZXQsIHJ1bGUucHJpb3JpdHkpO1xyXG4gICAgICB9XHJcbiAgICAgIHRoaXMucnVsZXMucHVzaChydWxlKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHNvcnRSdWxlcygpIHtcclxuICAgIHJldHVybiB0aGlzLnJ1bGVzLnNvcnQoZnVuY3Rpb24oYSwgYikge1xyXG4gICAgICBsZXQgeCA9IGEucHJpb3JpdHk7IGxldCB5ID0gYi5wcmlvcml0eTtcclxuICAgICAgcmV0dXJuICgoeCA8IHkpID8gLTEgOiAoKHggPiB5KSA/IDEgOiAwKSk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG59XHJcblxyXG5leHBvcnQgZGVmYXVsdCBQb2xpY3k7XHJcbiIsIi8vIExvZyBTeXN0ZW1cclxuaW1wb3J0ICogYXMgbG9nZ2VyIGZyb20gJ2xvZ2xldmVsJztcclxubGV0IGxvZyA9IGxvZ2dlci5nZXRMb2dnZXIoJ1BFUCcpO1xyXG5cclxuaW1wb3J0IEFjdGlvbnNTZXJ2aWNlIGZyb20gJy4vQWN0aW9uc1NlcnZpY2UnO1xyXG5pbXBvcnQgUERQIGZyb20gJy4vUERQJztcclxuaW1wb3J0IFBvbGljeSBmcm9tICcuL1BvbGljeSc7XHJcbmltcG9ydCB7aXNIeXBlcnR5VVJMfSBmcm9tICcuLi91dGlscy91dGlscyc7XHJcblxyXG5jbGFzcyBQRVAge1xyXG5cclxuICAvKipcclxuICAqIENyZWF0ZXMgYSBQb2xpY3kgRW5mb3JjZW1lbnQgUG9pbnQgKFBFUCkgaW5zdGFuY2VcclxuICAqIEBwYXJhbSAgICB7T2JqZWN0fSAgICBjb250ZXh0XHJcbiAgKi9cclxuICBjb25zdHJ1Y3Rvcihjb250ZXh0KSB7XHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG5cclxuICAgIF90aGlzLnBkcCA9IG5ldyBQRFAoY29udGV4dCk7XHJcbiAgICBfdGhpcy5hY3Rpb25zU2VydmljZSA9IG5ldyBBY3Rpb25zU2VydmljZShjb250ZXh0KTtcclxuICAgIF90aGlzLmNvbnRleHQgPSBjb250ZXh0O1xyXG4gICAgY29udGV4dC5wZXAgPSBfdGhpcztcclxuXHJcbiAgICAvL1RPRE8gc2hvdWxkIGJlIGFkZGVkIGEgdHJpZ2dlciB0byB2ZXJpZnkgd2hlbiB0aGUgbG9hZENvbmZpZ3VyYXRpb25zIGlzIHN1Y2Nlc3NmdWxseSBjb21wbGV0ZWRcclxuICAgIGNvbnRleHQubG9hZENvbmZpZ3VyYXRpb25zKCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAqIHJldHVybiB0aGUgbWVzc2FnZUJ1cyBpbiB0aGlzIFJlZ2lzdHJ5XHJcbiAgKiBAcGFyYW0ge01lc3NhZ2VCdXN9ICAgICAgICAgICBtZXNzYWdlQnVzXHJcbiAgKi9cclxuICBnZXQgbWVzc2FnZUJ1cygpIHtcclxuICAgIGxldCBfdGhpcyA9IHRoaXM7XHJcbiAgICByZXR1cm4gX3RoaXMuY29udGV4dC5tZXNzYWdlQnVzO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgKiBTZXQgdGhlIG1lc3NhZ2VCdXMgaW4gdGhpcyBSZWdpc3RyeVxyXG4gICogQHBhcmFtIHtNZXNzYWdlQnVzfSAgICAgICAgICAgbWVzc2FnZUJ1c1xyXG4gICovXHJcbiAgc2V0IG1lc3NhZ2VCdXMobWVzc2FnZUJ1cykge1xyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuICAgIF90aGlzLmNvbnRleHQubWVzc2FnZUJ1cyA9IG1lc3NhZ2VCdXM7XHJcbiAgICBfdGhpcy5hZGRHVUlMaXN0ZW5lcnMoKTtcclxuICB9XHJcblxyXG4gIGFkZEdVSUxpc3RlbmVycygpIHtcclxuICAgIGxldCBfdGhpcyA9IHRoaXM7XHJcblxyXG4gICAgX3RoaXMuY29udGV4dC5tZXNzYWdlQnVzLmFkZExpc3RlbmVyKF90aGlzLmNvbnRleHQucGVwVVJMLCAobXNnKSA9PiB7XHJcbiAgICAgIGxldCBmdW5jTmFtZSA9IG1zZy5ib2R5Lm1ldGhvZDtcclxuXHJcbiAgICAgIGxldCByZXR1cm5lZFZhbHVlO1xyXG4gICAgICBpZiAoZnVuY05hbWUgPT09ICdhZGRUb0dyb3VwJykge1xyXG4gICAgICAgIGxldCBncm91cE5hbWUgPSBtc2cuYm9keS5wYXJhbXMuZ3JvdXBOYW1lO1xyXG4gICAgICAgIGxldCB1c2VyRW1haWwgPSBtc2cuYm9keS5wYXJhbXMudXNlckVtYWlsO1xyXG4gICAgICAgIHJldHVybmVkVmFsdWUgPSBfdGhpcy5jb250ZXh0LmFkZFRvR3JvdXAoZ3JvdXBOYW1lLCB1c2VyRW1haWwpO1xyXG4gICAgICB9IGVsc2UgaWYgKGZ1bmNOYW1lID09PSAnY3JlYXRlR3JvdXAnKSB7XHJcbiAgICAgICAgbGV0IGdyb3VwTmFtZSA9IG1zZy5ib2R5LnBhcmFtcy5ncm91cE5hbWU7XHJcbiAgICAgICAgcmV0dXJuZWRWYWx1ZSA9IF90aGlzLmNvbnRleHQuY3JlYXRlR3JvdXAoZ3JvdXBOYW1lKTtcclxuICAgICAgfSBlbHNlIGlmIChmdW5jTmFtZSA9PT0gJ2FkZFBvbGljeScpIHtcclxuICAgICAgICBsZXQgc291cmNlID0gbXNnLmJvZHkucGFyYW1zLnNvdXJjZTtcclxuICAgICAgICBsZXQga2V5ID0gbXNnLmJvZHkucGFyYW1zLmtleTtcclxuICAgICAgICBsZXQgcG9saWN5ID0gbXNnLmJvZHkucGFyYW1zLnBvbGljeTtcclxuICAgICAgICBsZXQgY29tYmluaW5nQWxnb3JpdGhtID0gbXNnLmJvZHkucGFyYW1zLmNvbWJpbmluZ0FsZ29yaXRobTtcclxuICAgICAgICByZXR1cm5lZFZhbHVlID0gX3RoaXMuYWRkUG9saWN5KHNvdXJjZSwga2V5LCBwb2xpY3ksIGNvbWJpbmluZ0FsZ29yaXRobSk7XHJcbiAgICAgIH0gZWxzZSBpZiAoZnVuY05hbWUgPT09ICdkZWxldGVHcm91cCcpIHtcclxuICAgICAgICBsZXQgZ3JvdXBOYW1lID0gbXNnLmJvZHkucGFyYW1zLmdyb3VwTmFtZTtcclxuICAgICAgICByZXR1cm5lZFZhbHVlID0gX3RoaXMuY29udGV4dC5kZWxldGVHcm91cChncm91cE5hbWUpO1xyXG4gICAgICB9IGVsc2UgaWYgKGZ1bmNOYW1lID09PSAncmVtb3ZlUG9saWN5Jykge1xyXG4gICAgICAgIGxldCBzb3VyY2UgPSBtc2cuYm9keS5wYXJhbXMuc291cmNlO1xyXG4gICAgICAgIGxldCBrZXkgPSBtc2cuYm9keS5wYXJhbXMua2V5O1xyXG4gICAgICAgIHJldHVybmVkVmFsdWUgPSBfdGhpcy5yZW1vdmVQb2xpY3koc291cmNlLCBrZXkpO1xyXG4gICAgICB9IGVsc2UgaWYgKGZ1bmNOYW1lID09PSAnc2F2ZVBvbGljaWVzJykge1xyXG4gICAgICAgIGxldCBzb3VyY2UgPSBtc2cuYm9keS5wYXJhbXMuc291cmNlO1xyXG4gICAgICAgIHJldHVybmVkVmFsdWUgPSBfdGhpcy5jb250ZXh0LnNhdmVQb2xpY2llcyhzb3VyY2UpO1xyXG4gICAgICB9IGVsc2UgaWYgKGZ1bmNOYW1lID09PSAndXNlclBvbGljaWVzJykge1xyXG4gICAgICAgIHJldHVybmVkVmFsdWUgPSBfdGhpcy5jb250ZXh0LnVzZXJQb2xpY2llcztcclxuICAgICAgfSBlbHNlIGlmIChmdW5jTmFtZSA9PT0gJ2FjdGl2ZVVzZXJQb2xpY3knKSB7XHJcbiAgICAgICAgbGV0IHVzZXJQb2xpY3kgPSBtc2cuYm9keS5wYXJhbXMudXNlclBvbGljeTtcclxuICAgICAgICBpZiAodXNlclBvbGljeSkgeyBfdGhpcy5jb250ZXh0LmFjdGl2ZVVzZXJQb2xpY3kgPSB1c2VyUG9saWN5OyB9XHJcbiAgICAgICAgcmV0dXJuZWRWYWx1ZSA9IF90aGlzLmNvbnRleHQuYWN0aXZlVXNlclBvbGljeTtcclxuICAgICAgfSBlbHNlIGlmIChmdW5jTmFtZSA9PT0gJ3VzZXJQb2xpY3knKSB7XHJcbiAgICAgICAgbGV0IGtleSA9IG1zZy5ib2R5LnBhcmFtcy5rZXk7XHJcbiAgICAgICAgcmV0dXJuZWRWYWx1ZSA9IF90aGlzLmNvbnRleHQudXNlclBvbGljaWVzW2tleV07XHJcbiAgICAgIH0gZWxzZSBpZiAoZnVuY05hbWUgPT09ICdzYXZlQWN0aXZlUG9saWN5Jykge1xyXG4gICAgICAgIHJldHVybmVkVmFsdWUgPSBfdGhpcy5jb250ZXh0LnNhdmVBY3RpdmVQb2xpY3koKTtcclxuICAgICAgfSBlbHNlIGlmIChmdW5jTmFtZSA9PT0gJ2dldE15RW1haWxzJykge1xyXG4gICAgICAgIHJldHVybmVkVmFsdWUgPSBfdGhpcy5jb250ZXh0LmdldE15RW1haWxzKCk7XHJcbiAgICAgIH0gZWxzZSBpZiAoZnVuY05hbWUgPT09ICdnZXRNeUh5cGVydGllcycpIHtcclxuICAgICAgICByZXR1cm5lZFZhbHVlID0gX3RoaXMuY29udGV4dC5nZXRNeUh5cGVydGllcygpO1xyXG4gICAgICB9IGVsc2UgaWYgKGZ1bmNOYW1lID09PSAnZ3JvdXBzJykge1xyXG4gICAgICAgIHJldHVybmVkVmFsdWUgPSBfdGhpcy5jb250ZXh0Lmdyb3VwcztcclxuICAgICAgfSBlbHNlIGlmIChmdW5jTmFtZSA9PT0gJ2dldEdyb3Vwc05hbWVzJykge1xyXG4gICAgICAgIHJldHVybmVkVmFsdWUgPSBfdGhpcy5jb250ZXh0LmdldEdyb3Vwc05hbWVzKCk7XHJcbiAgICAgIH0gaWYgKGZ1bmNOYW1lID09PSAncmVtb3ZlRnJvbUdyb3VwJykge1xyXG4gICAgICAgIGxldCBncm91cE5hbWUgPSBtc2cuYm9keS5wYXJhbXMuZ3JvdXBOYW1lO1xyXG4gICAgICAgIGxldCB1c2VyRW1haWwgPSBtc2cuYm9keS5wYXJhbXMudXNlckVtYWlsO1xyXG4gICAgICAgIHJldHVybmVkVmFsdWUgPSBfdGhpcy5jb250ZXh0LnJlbW92ZUZyb21Hcm91cChncm91cE5hbWUsIHVzZXJFbWFpbCk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGxldCB2YWx1ZSA9IHt0eXBlOiAnZXhlY3V0ZScsIHZhbHVlOiByZXR1cm5lZFZhbHVlLCBjb2RlOiAyMDB9O1xyXG4gICAgICBsZXQgcmVwbHlNc2cgPSB7aWQ6IG1zZy5pZCwgdHlwZTogJ3Jlc3BvbnNlJywgdG86IG1zZy5mcm9tLCBmcm9tOiBtc2cudG8sIGJvZHk6IHZhbHVlfTtcclxuICAgICAgX3RoaXMuY29udGV4dC5tZXNzYWdlQnVzLnBvc3RNZXNzYWdlKHJlcGx5TXNnKTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgKiBBZGRzIGEgcG9saWN5IHRvIHRoZSBQb2xpY3kgRW5mb3JjZW1lbnQgUG9pbnQgKFBFUCkuIFRoZSBwb2xpY3kgY2FuIGJlIGNyZWF0ZWQgYnkgdGhlIHNlcnZpY2VcclxuICAqIHByb3ZpZGVyIG9yIGJ5IHRoZSB1c2VyLlxyXG4gICogQHBhcmFtICAgIHtTdHJpbmd9ICAgIHNvdXJjZVxyXG4gICogQHBhcmFtICAgIHtTdHJpbmd9ICAgIGtleVxyXG4gICogQHBhcmFtICAgIHtPYmplY3R9ICAgIHBvbGljeVxyXG4gICovXHJcbiAgYWRkUG9saWN5KHNvdXJjZSwga2V5LCBwb2xpY3ksIGNvbWJpbmluZ0FsZ29yaXRobSkge1xyXG4gICAgaWYgKCFzb3VyY2UpIHRocm93IG5ldyBFcnJvcignc291cmNlIGlzIG5vdCBkZWZpbmVkJyk7XHJcbiAgICBpZiAoIWtleSkgdGhyb3cgbmV3IEVycm9yKCdrZXkgaXMgbm90IGRlZmluZWQnKTtcclxuXHJcbiAgICBpZiAocG9saWN5ID09PSB1bmRlZmluZWQpIHtcclxuICAgICAgcG9saWN5ID0gbmV3IFBvbGljeShrZXksIFtdLCBbXSwgY29tYmluaW5nQWxnb3JpdGhtKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGlmICghKHBvbGljeSBpbnN0YW5jZW9mIFBvbGljeSkpIHtcclxuICAgICAgICBwb2xpY3kgPSBuZXcgUG9saWN5KHBvbGljeS5rZXksIHBvbGljeS5ydWxlcywgcG9saWN5LmFjdGlvbnMsIHBvbGljeS5jb21iaW5pbmdBbGdvcml0aG0pO1xyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgc3dpdGNoIChzb3VyY2UpIHtcclxuICAgICAgY2FzZSAnU0VSVklDRV9QUk9WSURFUic6XHJcbiAgICAgICAgdGhpcy5jb250ZXh0LnNhdmVQb2xpY2llcyhzb3VyY2UsIHBvbGljeSwga2V5KTtcclxuICAgICAgICBicmVhaztcclxuICAgICAgY2FzZSAnVVNFUic6XHJcbiAgICAgICAgdGhpcy5jb250ZXh0LnVzZXJQb2xpY2llc1trZXldID0gcG9saWN5O1xyXG4gICAgICAgIHRoaXMuY29udGV4dC5zYXZlUG9saWNpZXMoc291cmNlKTtcclxuICAgICAgICBicmVhaztcclxuICAgICAgZGVmYXVsdDpcclxuICAgICAgICB0aHJvdyBFcnJvcignVW5rbm93biBwb2xpY3kgc291cmNlOiAnICsgc291cmNlKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIGF1dGhvcmlzZShtZXNzYWdlLCBpc0luY29taW5nKSB7XHJcbiAgICAvLyBsb2cubG9nKCdbUG9saWN5LlBFUCBBdXRob3Jpc2VdICcsIG1lc3NhZ2UpO1xyXG4gICAgLy8gbG9nLmxvZyhtZXNzYWdlKTtcclxuICAgIGlmICghbWVzc2FnZSkgdGhyb3cgbmV3IEVycm9yKCdtZXNzYWdlIGlzIG5vdCBkZWZpbmVkJyk7XHJcbiAgICBpZiAoIW1lc3NhZ2UuZnJvbSkgdGhyb3cgbmV3IEVycm9yKCdtZXNzYWdlLmZyb20gaXMgbm90IGRlZmluZWQnKTtcclxuICAgIGlmICghbWVzc2FnZS50bykgdGhyb3cgbmV3IEVycm9yKCdtZXNzYWdlLnRvIGlzIG5vdCBkZWZpbmVkJyk7XHJcbiAgICBpZiAoIW1lc3NhZ2UudHlwZSkgdGhyb3cgbmV3IEVycm9yKCdtZXNzYWdlLnR5cGUgaXMgbm90IGRlZmluZWQnKTtcclxuICAgIG1lc3NhZ2UuYm9keSA9IG1lc3NhZ2UuYm9keSB8fCB7fTtcclxuXHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xyXG5cclxuICAgICAgbWVzc2FnZS5ib2R5ID0gbWVzc2FnZS5ib2R5IHx8IHt9O1xyXG4gICAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG5cclxuICAgICAgbGV0IHJlc3VsdCA9IF90aGlzLnBkcC5ldmFsdWF0ZVBvbGljaWVzKG1lc3NhZ2UsIGlzSW5jb21pbmcpO1xyXG4gICAgICBpZiAocmVzdWx0ID09PSAnTm90IEFwcGxpY2FibGUnKSB7XHJcbiAgICAgICAgcmVzdWx0ID0gX3RoaXMuY29udGV4dC5kZWZhdWx0QmVoYXZpb3VyO1xyXG4gICAgICAgIG1lc3NhZ2UuYm9keS5hdXRoID0gZmFsc2U7XHJcbiAgICAgIH1cclxuICAgICAgX3RoaXMuYWN0aW9uc1NlcnZpY2UuZW5mb3JjZVBvbGljaWVzKG1lc3NhZ2UsIGlzSW5jb21pbmcpLnRoZW4obWVzc2FnZXMgPT4ge1xyXG4gICAgICAgIGZvciAobGV0IGkgaW4gbWVzc2FnZXMpIHtcclxuICAgICAgICAgIG1lc3NhZ2UgPSBtZXNzYWdlc1tpXTtcclxuICAgICAgICAgIGlmIChyZXN1bHQpIHtcclxuICAgICAgICAgICAgbWVzc2FnZS5ib2R5LmF1dGggPSAobWVzc2FnZS5ib2R5LmF1dGggPT09IHVuZGVmaW5lZCkgPyB0cnVlIDogbWVzc2FnZS5ib2R5LmF1dGg7XHJcbiAgICAgICAgICAgIHJlc29sdmUobWVzc2FnZSk7XHJcbiAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBsZXQgZXJyb3JNZXNzYWdlID0geyBib2R5OiB7IGNvZGU6IDQwMywgZGVzY3JpcHRpb246ICdCbG9ja2VkIGJ5IHBvbGljeScgfSwgZnJvbTogbWVzc2FnZS50bywgdG86IG1lc3NhZ2UuZnJvbSwgdHlwZTogJ3Jlc3BvbnNlJyB9O1xyXG4gICAgICAgICAgICByZWplY3QoZXJyb3JNZXNzYWdlKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgIH0sIChlcnJvcikgPT4ge1xyXG4gICAgICAgIHJlamVjdChlcnJvcik7XHJcbiAgICAgIH0pO1xyXG5cclxuICAgIH0pO1xyXG4gIH1cclxuICBhdXRob3Jpc2VTeW5jKG1lc3NhZ2UpIHtcclxuICAgIGxldCByZXN1bHQ7XHJcbiAgICBtZXNzYWdlLmJvZHkgPSBtZXNzYWdlLmJvZHkgfHwge307XHJcbiAgICByZXN1bHQgPSB0aGlzLnBkcC5ldmFsdWF0ZVBvbGljaWVzKG1lc3NhZ2UsIHRydWUpO1xyXG4gICAgaWYgKHJlc3VsdCA9PT0gJ05vdCBBcHBsaWNhYmxlJykge1xyXG4gICAgICByZXN1bHQgPSB0aGlzLmNvbnRleHQuZGVmYXVsdEJlaGF2aW91cjtcclxuICAgIH1cclxuICAgIHJldHVybiByZXN1bHQ7XHJcblxyXG4gIH1cclxuXHJcbiAgcmVtb3ZlUG9saWN5KHNvdXJjZSwga2V5KSB7XHJcbiAgICBpZiAoIXNvdXJjZSkgdGhyb3cgbmV3IEVycm9yKCdzb3VyY2UgaXMgbm90IGRlZmluZWQnKTtcclxuICAgIGlmIChzb3VyY2UgIT09ICcqJyAmJiAha2V5KSB0aHJvdyBuZXcgRXJyb3IoJ2tleSBpcyBub3QgZGVmaW5lZCcpO1xyXG5cclxuICAgIHN3aXRjaCAoc291cmNlKSB7XHJcbiAgICAgIGNhc2UgJyonOlxyXG4gICAgICAgIHRoaXMuY29udGV4dC5zZXJ2aWNlUHJvdmlkZXJQb2xpY3kgPSB7fTtcclxuICAgICAgICB0aGlzLmNvbnRleHQudXNlclBvbGljaWVzID0ge307XHJcbiAgICAgICAgdGhpcy5jb250ZXh0LmFjdGl2ZVVzZXJQb2xpY3kgPSB1bmRlZmluZWQ7XHJcbiAgICAgICAgdGhpcy5jb250ZXh0LnNhdmVQb2xpY2llcygnVVNFUicpO1xyXG4gICAgICAgIHRoaXMuY29udGV4dC5zYXZlUG9saWNpZXMoJ1NFUlZJQ0VfUFJPVklERVInKTtcclxuICAgICAgICB0aGlzLmNvbnRleHQuc2F2ZUFjdGl2ZVBvbGljeSgpO1xyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgICBjYXNlICdTRVJWSUNFX1BST1ZJREVSJzpcclxuICAgICAgICBkZWxldGUgdGhpcy5jb250ZXh0LnNlcnZpY2VQcm92aWRlclBvbGljeVtrZXldO1xyXG4gICAgICAgIHRoaXMuY29udGV4dC5zYXZlUG9saWNpZXMoKTtcclxuICAgICAgICBicmVhaztcclxuICAgICAgY2FzZSAnVVNFUic6XHJcbiAgICAgICAgZGVsZXRlIHRoaXMuY29udGV4dC51c2VyUG9saWNpZXNba2V5XTtcclxuICAgICAgICBpZiAoa2V5ID09PSB0aGlzLmNvbnRleHQuYWN0aXZlVXNlclBvbGljeSkge1xyXG4gICAgICAgICAgdGhpcy5jb250ZXh0LmFjdGl2ZVVzZXJQb2xpY3kgPSB1bmRlZmluZWQ7XHJcbiAgICAgICAgICB0aGlzLmNvbnRleHQuc2F2ZUFjdGl2ZVBvbGljeSgpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmNvbnRleHQuc2F2ZVBvbGljaWVzKCdVU0VSJyk7XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgdGhyb3cgRXJyb3IoJ1Vua25vd24gcG9saWN5IHNvdXJjZTogJyArIHNvdXJjZSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxufVxyXG5cclxuZXhwb3J0IGRlZmF1bHQgUEVQO1xyXG4iLCIvKipcclxuKiBDb3B5cmlnaHQgMjAxNiBQVCBJbm92YcOnw6NvIGUgU2lzdGVtYXMgU0FcclxuKiBDb3B5cmlnaHQgMjAxNiBJTkVTQy1JRFxyXG4qIENvcHlyaWdodCAyMDE2IFFVT0JJUyBORVRXT1JLUyBTTFxyXG4qIENvcHlyaWdodCAyMDE2IEZSQVVOSE9GRVItR0VTRUxMU0NIQUZUIFpVUiBGT0VSREVSVU5HIERFUiBBTkdFV0FORFRFTiBGT1JTQ0hVTkcgRS5WXHJcbiogQ29weXJpZ2h0IDIwMTYgT1JBTkdFIFNBXHJcbiogQ29weXJpZ2h0IDIwMTYgRGV1dHNjaGUgVGVsZWtvbSBBR1xyXG4qIENvcHlyaWdodCAyMDE2IEFwaXplZVxyXG4qIENvcHlyaWdodCAyMDE2IFRFQ0hOSVNDSEUgVU5JVkVSU0lUQVQgQkVSTElOXHJcbipcclxuKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4qIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuKlxyXG4qICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbipcclxuKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4qIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4qIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuKiovXHJcbmltcG9ydCAqIGFzIGxvZ2dlciBmcm9tICdsb2dsZXZlbCc7XHJcbmxldCBsb2cgPSBsb2dnZXIuZ2V0TG9nZ2VyKCdQaXBlbGluZScpO1xyXG5cclxuLyoqXHJcbiogQGF1dGhvciBtaWNhZWxwZWRyb3NhQGdtYWlsLmNvbVxyXG4qIFNlcXVlbmNpYWwgcHJvY2Vzc29yIG9mIG1ldGhvZHMuIFNpbWlsYXIgdG8gaG93IFNlcXVlbnRpYWwgUHJvbWlzZSdzIHdvcmssIGJ1dCBiZXR0ZXIgZml0IGZvciBtZXNzYWdlIHByb2Nlc3NpbmcuXHJcbiogTm9ybWFsIHVzZSBmb3IgdGhpcywgaXMgdG8gaW50ZXJjZXB0IGFsbCBtZXNzYWdlcyB3aXRoIGNvbmZpZ3VyZWQgaGFuZGxlcnMsIGFuZCBhY3QgYWNjb3JkaW5nbHkuXHJcbiovXHJcblxyXG5pbXBvcnQge2lzRGF0YU9iamVjdFVSTH0gZnJvbSAnLi4vdXRpbHMvdXRpbHMnO1xyXG5cclxuY2xhc3MgUGlwZWxpbmUge1xyXG4gIC8qIHB1YmxpY1xyXG4gICAgaGFuZGxlcnM6ICgoUGlwZUNvbnRleHQpID0+IHZvaWQpW11cclxuICAgIG9uRmFpbDogKGVycm9yKSA9PiB2b2lkXHJcbiAgKi9cclxuXHJcbiAgY29uc3RydWN0b3IoX29uRmFpbCkge1xyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuXHJcbiAgICBfdGhpcy5oYW5kbGVycyA9IFtdO1xyXG4gICAgX3RoaXMub25GYWlsID0gX29uRmFpbDtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEluc2VydCBhIG1lc3NhZ2UgaW4gdGhlIHBpcGVsaW5lIHF1ZXVlLiBBbGwgbWVzc2FnZXMgYXJlIHdyYXBwZWQgd2l0aCBhIFBpcGVDb250ZXh0LlxyXG4gICAqIEBwYXJhbSAge01lc3NhZ2V9IG1zZyAgICAgICBNZXNzYWdlIGZvciB0aGUgcXVldWVcclxuICAgKiBAcGFyYW0gIHtDYWxsYmFja30gb25EZWxpdmVyIFdoZW4gbWVzc2FnZSBpcyBmaW5pc2hlZCBwcm9jZXNzaW5nIGZyb20gYWxsIGhhbmRsZXJzLCBpdCB3aWxsIGJlIGRlbGl2ZXJlZCBpbiB0aGlzIGNhbGxiYWNrLlxyXG4gICAqL1xyXG4gIHByb2Nlc3MobXNnLCBvbkRlbGl2ZXIpIHtcclxuICAgIGxldCBfdGhpcyA9IHRoaXM7XHJcblxyXG4gICAgaWYgKF90aGlzLmhhbmRsZXJzLmxlbmd0aCA+IDApIHtcclxuICAgICAgbGV0IGl0ZXIgPSBuZXcgSXRlcmF0b3IoX3RoaXMuaGFuZGxlcnMpO1xyXG4gICAgICBpdGVyLm5leHQobmV3IFBpcGVDb250ZXh0KF90aGlzLCBpdGVyLCBtc2csIG9uRGVsaXZlcikpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgb25EZWxpdmVyKG1zZyk7XHJcbiAgICB9XHJcbiAgfVxyXG59XHJcblxyXG4vKipcclxuKiBAYXV0aG9yIG1pY2FlbHBlZHJvc2FAZ21haWwuY29tXHJcbiogV3JhcHBlciBhcm91bmQgYSBtZXNzYWdlIHRoYXQgYWRkcyBhY3Rpb25zIHRoYXQgY2FuIGJlIGZpcmVkIGJ5IGFueSBpbnRlcmNlcHRvciBoYW5kbGVyLlxyXG4qIFRoZSBQaXBlbGluZSBpcyBhc3luY2hyb25vdXMsIHNvIGFuIGhhbmRsZXIgc2hvdWxkIGFsd2F5cyBjYWxsIGFuIGFjdGlvbiwgdGhlIGRlZmF1bHQgb25lIGlzIFwibmV4dCgpXCJcclxuKi9cclxuY2xhc3MgUGlwZUNvbnRleHQge1xyXG4gIC8qIHByaXZhdGVcclxuICAgIF9pblN0b3A6IGJvb2xlYW5cclxuXHJcbiAgICBfcGlwZWxpbmU6IFBpcGVsaW5lXHJcbiAgICBfaXRlcjogSXRlcmF0b3JcclxuICAgIF9tc2c6IE1lc3NhZ2VcclxuICAqL1xyXG5cclxuICBjb25zdHJ1Y3RvcihwaXBlbGluZSwgaXRlciwgbXNnLCBvbkRlbGl2ZXIpIHtcclxuICAgIGxldCBfdGhpcyA9IHRoaXM7XHJcblxyXG4gICAgX3RoaXMuX2luU3RvcCA9IGZhbHNlO1xyXG5cclxuICAgIF90aGlzLl9waXBlbGluZSA9IHBpcGVsaW5lO1xyXG4gICAgX3RoaXMuX2l0ZXIgPSBpdGVyO1xyXG4gICAgX3RoaXMuX21zZyA9IG1zZztcclxuICAgIF90aGlzLl9vbkRlbGl2ZXIgPSBvbkRlbGl2ZXI7XHJcbiAgfVxyXG5cclxuICBnZXQgcGlwZWxpbmUoKSB7IHJldHVybiB0aGlzLl9waXBlbGluZTsgfVxyXG5cclxuICBnZXQgbXNnKCkgeyByZXR1cm4gdGhpcy5fbXNnOyB9XHJcbiAgc2V0IG1zZyhpbk1zZykgeyB0aGlzLl9tc2cgPSBpbk1zZzsgfVxyXG5cclxuICAvKipcclxuICAgKiBQcm9jZWVkIHRvIHRoZSBuZXh0IGludGVyY2VwdG9yIGhhbmRsZXIsIHVubGVzcyB0aGVyZSB3YXMgYW4gZXJyb3IuIElmIGl0J3MgdGhlIGxhc3Qgb25lLCBwcm9jZWVkIHRvIG9uRGVsaXZlciBoYW5kbGVyLlxyXG4gICAqL1xyXG4gIG5leHQoKSB7XHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG5cclxuICAgIGlmICghX3RoaXMuX2luU3RvcCkge1xyXG4gICAgICBpZiAoX3RoaXMuX2l0ZXIuaGFzTmV4dCkge1xyXG4gICAgICAgIF90aGlzLl9pdGVyLm5leHQoX3RoaXMpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIF90aGlzLl9vbkRlbGl2ZXIoX3RoaXMuX21zZyk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFByb2NlZWQgZGlyZWN0bHkgdG8gdGhlIG9uRGVsaXZlciBoYW5kbGVyLCB1bmxlc3MgdGhlcmUgd2FzIGFuIGVycm9yLlxyXG4gICAqL1xyXG4gIGRlbGl2ZXIoKSB7XHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG4gICAgaWYgKCFfdGhpcy5faW5TdG9wKSB7XHJcbiAgICAgIF90aGlzLl9pblN0b3AgPSB0cnVlO1xyXG4gICAgICBfdGhpcy5fb25EZWxpdmVyKF90aGlzLl9tc2cpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogTWFyayB0aGUgY29udGV4dCB3aXRoIGFuIGVycm9yIGFuZCBwcm9jZWVkIHRvIHRoZSBvbkZhaWwgaGFuZGxlci5cclxuICAgKiBAcGFyYW0gIHtbdHlwZV19IGVycm9yIFtkZXNjcmlwdGlvbl1cclxuICAgKi9cclxuICBmYWlsKGVycm9yKSB7XHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG5cclxuICAgIGlmICghX3RoaXMuX2luU3RvcCkge1xyXG4gICAgICBfdGhpcy5faW5TdG9wID0gdHJ1ZTtcclxuICAgICAgaWYgKF90aGlzLl9waXBlbGluZS5vbkZhaWwpIHtcclxuICAgICAgICBfdGhpcy5fcGlwZWxpbmUub25GYWlsKGVycm9yKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxuXHJcblxyXG5cclxuXHJcbn1cclxuXHJcbmNsYXNzIEl0ZXJhdG9yIHtcclxuICAvKiBwcml2YXRlXHJcbiAgICBfaW5kZXg6IG51bWJlclxyXG4gICAgX2FycmF5OiBbXVxyXG4gICovXHJcblxyXG4gIGNvbnN0cnVjdG9yKGFycmF5KSB7XHJcbiAgICB0aGlzLl9pbmRleCA9IC0xO1xyXG4gICAgdGhpcy5fYXJyYXkgPSBhcnJheTtcclxuICB9XHJcblxyXG4gIGdldCBoYXNOZXh0KCkge1xyXG4gICAgcmV0dXJuIHRoaXMuX2luZGV4IDwgdGhpcy5fYXJyYXkubGVuZ3RoIC0gMTtcclxuICB9XHJcblxyXG4gIGdldCBuZXh0KCkge1xyXG4gICAgdGhpcy5faW5kZXgrKztcclxuICAgIHJldHVybiB0aGlzLl9hcnJheVt0aGlzLl9pbmRleF07XHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgZGVmYXVsdCBQaXBlbGluZTtcclxuIiwiLyoqXHJcbiogQ29weXJpZ2h0IDIwMTYgUFQgSW5vdmHDp8OjbyBlIFNpc3RlbWFzIFNBXHJcbiogQ29weXJpZ2h0IDIwMTYgSU5FU0MtSURcclxuKiBDb3B5cmlnaHQgMjAxNiBRVU9CSVMgTkVUV09SS1MgU0xcclxuKiBDb3B5cmlnaHQgMjAxNiBGUkFVTkhPRkVSLUdFU0VMTFNDSEFGVCBaVVIgRk9FUkRFUlVORyBERVIgQU5HRVdBTkRURU4gRk9SU0NIVU5HIEUuVlxyXG4qIENvcHlyaWdodCAyMDE2IE9SQU5HRSBTQVxyXG4qIENvcHlyaWdodCAyMDE2IERldXRzY2hlIFRlbGVrb20gQUdcclxuKiBDb3B5cmlnaHQgMjAxNiBBcGl6ZWVcclxuKiBDb3B5cmlnaHQgMjAxNiBURUNITklTQ0hFIFVOSVZFUlNJVEFUIEJFUkxJTlxyXG4qXHJcbiogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbipcclxuKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4qXHJcbiogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4qIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbioqL1xyXG5cclxuLy8gTG9nIHN5c3RlbVxyXG5pbXBvcnQgKiBhcyBsb2dnZXIgZnJvbSAnbG9nbGV2ZWwnO1xyXG5sZXQgbG9nID0gbG9nZ2VyLmdldExvZ2dlcignTWVzc2FnZUJ1cycpO1xyXG5cclxuaW1wb3J0IEJ1cyBmcm9tICcuL0J1cyc7XHJcbmltcG9ydCBQaXBlbGluZSBmcm9tICcuL1BpcGVsaW5lJztcclxuXHJcbi8qKlxyXG4qIEBhdXRob3IgbWljYWVscGVkcm9zYUBnbWFpbC5jb21cclxuKiBNZXNzYWdlIEJVUyBJbnRlcmZhY2UgaXMgYW4gZXh0ZW5zaW9uIG9mIHRoZSBCdXNcclxuKiBJdCBkb2Vzbid0IHN1cHBvcnQgdGhlIGRlZmF1bHQgJyonIGxpc3RlbmVyLCBpbnN0ZWFkIGl0IHVzZXMgdGhlIHJlZ2lzdHJ5LnJlc29sdmUoLi4pXHJcbiovXHJcbmNsYXNzIE1lc3NhZ2VCdXMgZXh0ZW5kcyBCdXMge1xyXG4gIC8qIHByaXZhdGVcclxuICBfcmVnaXN0cnk6IFJlZ2lzdHJ5XHJcbiAgX2ZvcndhcmRzOiB7IDxmcm9tLXVybD46IHsgZmw6IE1zZ0xpc3RlbmVyLCBzYW5kYm94VG9VcmxzOiBNYXAoU2FuZGJveCwgW3RvLXVybF0pLCB1cmxUb1NhbmRib3g6IHsgdG8tdXJsOiBTYW5kYm94IH0gfSB9XHJcblxyXG4gIF9waXBlbGluZTogUGlwZWxpbmVcclxuICAqL1xyXG5cclxuICAvL1RPRE86IGZ1dHVyZSBvcHRpbWl6YXRpb25cclxuICAvLzEuIG1lc3NhZ2UgYmF0Y2ggcHJvY2Vzc2luZyB3aXRoIHNldEludGVydmFsXHJcbiAgLy8yLiByZXNvbHZlIGRlZmF1bHQgZ2F0ZXdheS9wcm90b3N0dWIgd2l0aCByZWdpc3Rlci5yZXNvbHZlXHJcblxyXG4gIGNvbnN0cnVjdG9yKHJlZ2lzdHJ5LCBydW50aW1lVXJsKSB7XHJcbiAgICBzdXBlcigpO1xyXG4gICAgdGhpcy5fcmVnaXN0cnkgPSByZWdpc3RyeTtcclxuICAgIHRoaXMuX2ZvcndhcmRzID0ge307XHJcbiAgICB0aGlzLl9ydW50aW1lVXJsID0gcnVudGltZVVybDtcclxuXHJcbiAgICB0aGlzLl9waXBlbGluZUluID0gbmV3IFBpcGVsaW5lKChlcnJvcikgPT4ge1xyXG4gICAgICBsb2cuZXJyb3IoJ1BJUEVMSU5FLUVSUk9SOiAnLCBKU09OLnN0cmluZ2lmeShlcnJvcikpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgdGhpcy5fcGlwZWxpbmVPdXQgPSBuZXcgUGlwZWxpbmUoKGVycm9yKSA9PiB7XHJcbiAgICAgIGxvZy5lcnJvcignUElQRUxJTkUtRVJST1I6ICcsIEpTT04uc3RyaW5naWZ5KGVycm9yKSk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIGdldCBwaXBlbGluZUluKCkgeyByZXR1cm4gdGhpcy5fcGlwZWxpbmVJbjsgfVxyXG5cclxuICBnZXQgcGlwZWxpbmVPdXQoKSB7IHJldHVybiB0aGlzLl9waXBlbGluZU91dDsgfVxyXG5cclxuICAvKipcclxuICAgKiBQb3N0IGEgbWVzc2FnZSBmb3Igcm91dGluZy4gSXQgd2lsbCBmaXJzdCBzZWFyY2ggZm9yIGEgbGlzdGVuZXIsIGlmIHRoZXJlIGlzIG5vIG9uZSwgaXQgc2VuZHMgdG8gYSBleHRlcm5hbCByb3V0aW5nIHVzaW5nIHRoZSBfb25Qb3N0TWVzc2FnZS5cclxuICAgKiBFeHRlcm5hbCByb3V0aW5nIHVzZSB0aGUgcmVnaXN0cnkucmVzb2x2ZSguLikgbWV0aG9kIHRvIGRlY2lkZSB0aGUgZGVzdGluYXRpb24gc2FuZGJveC5cclxuICAgKiBAcGFyYW0gIHtNZXNzYWdlfSBpbk1zZyAgICAgICAgICAgIEpTT04gd2l0aCBtYW5kYXRvcnkgTWVzc2FnZSBzdHJ1Y3R1cmUge2lkLCB0eXBlLCBmcm9tLCB0b31cclxuICAgKiBAcGFyYW0gIHtDYWxsYmFja30gcmVzcG9uc2VDYWxsYmFjayBPcHRpb25hbCBjYWxsYmFjayBpZiBhIHJlc3BvbnNlIGlzIGV4cGVjdGVkIGZyb20gdGhlIHJlcXVlc3QuIEEgcmVzcG9uc2Ugd2lsbCBiZSBhbHdheXMgc2VudCwgZXZlbiBpZiBpdCBpcyBhIFwiVGltZW91dFwiLlxyXG4gICAqIEByZXR1cm4ge251bWJlcn0gICAgICAgICAgICAgICAgICB0aGUgTWVzc2FnZSBpZFxyXG4gICAqL1xyXG4gIHBvc3RNZXNzYWdlKGluTXNnLCByZXNwb25zZUNhbGxiYWNrLCB0aW1lb3V0KSB7XHJcbiAgICBsb2cuaW5mbygnb25QT1NUTWVzc2FnZTogJywgaW5Nc2cpO1xyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuXHJcbiAgICBsZXQgZGVsaXZlciA9IChtc2cpID0+IHtcclxuXHJcbiAgICAgICAgICBfdGhpcy5fcmVzcG9uc2VDYWxsYmFjayhpbk1zZywgcmVzcG9uc2VDYWxsYmFjaywgdGltZW91dCk7XHJcblxyXG4gICAgICAgICAgaWYgKCFfdGhpcy5fb25SZXNwb25zZShtc2cpKSB7XHJcbiAgICAgICAgICAgIGxldCBpdGVtTGlzdCA9IF90aGlzLl9zdWJzY3JpcHRpb25zW21zZy50b107XHJcbiAgICAgICAgICAgIGlmIChpdGVtTGlzdCkge1xyXG4gICAgICAgICAgICAgIC8vZG8gbm90IHB1Ymxpc2ggb24gZGVmYXVsdCBhZGRyZXNzLCBiZWNhdXNlIG9mIGxvb3BiYWNrIGN5Y2xlXHJcbiAgICAgICAgICAgICAgX3RoaXMuX3B1Ymxpc2hPbihpdGVtTGlzdCwgbXNnKTtcclxuICAgICAgICAgICAgfSBlbHNlIGlmICghbXNnLnRvLmluY2x1ZGVzKF90aGlzLl9ydW50aW1lVXJsKSkge1xyXG4gICAgICAgICAgICAgIC8vaWYgdGhlcmUgaXMgbm8gbGlzdGVuZXIsIHNlbmQgdG8gZXh0ZXJuYWwgaW50ZXJmYWNlXHJcbiAgICAgICAgICAgICAgX3RoaXMuX29uUG9zdE1lc3NhZ2UobXNnKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIF90aGlzLl9nZW5JZChpbk1zZyk7XHJcblxyXG4gICAgaWYgKF90aGlzLl9pc1RvUHJvY2Vzcyhpbk1zZykpIHtcclxuICAgICAgbGV0IGlzSW5jb21pbmcgPSBfdGhpcy5faXNJbmNvbWluZ01lc3NhZ2UoaW5Nc2cpO1xyXG5cclxuICAgICAgaWYgKGlzSW5jb21pbmcpIF90aGlzLl9waXBlbGluZUluLnByb2Nlc3MoaW5Nc2csIGRlbGl2ZXIpO1xyXG4gICAgICBlbHNlIF90aGlzLl9waXBlbGluZU91dC5wcm9jZXNzKGluTXNnLCBkZWxpdmVyKTtcclxuICAgIH0gZWxzZSBkZWxpdmVyKGluTXNnKTtcclxuXHJcbiAgICByZXR1cm4gaW5Nc2cuaWQ7XHJcblxyXG4gIH1cclxuXHJcblxyXG4gIF9pc1RvUHJvY2VzcyhtZXNzYWdlKSB7XHJcbiAgICBsZXQgc2NoZW1hc1RvSWdub3JlID0gWydkb21haW4nLCAnZG9tYWluLWlkcCcsICdnbG9iYWwnLCAnaHlwZXJ0eS1ydW50aW1lJywgJ3J1bnRpbWUnXTtcclxuICAgIGxldCBzcGxpdEZyb20gPSAobWVzc2FnZS5mcm9tKS5zcGxpdCgnOi8vJyk7XHJcbiAgICBsZXQgZnJvbVNjaGVtYSA9IHNwbGl0RnJvbVswXTtcclxuICAgIGxldCBzcGxpdFRvID0gKG1lc3NhZ2UudG8pLnNwbGl0KCc6Ly8nKTtcclxuICAgIGxldCB0b1NjaGVtYSA9ICBzcGxpdFRvWzBdO1xyXG4gICAgbGV0IGZyb20gPSBtZXNzYWdlLmZyb207XHJcbiAgICBsZXQgdG8gPSBtZXNzYWdlLnRvO1xyXG5cclxuICAgIC8vIFNpZ25hbGxpbmcgbWVzc2FnZXMgYmV0d2VlbiBQMlAgU3R1YnMgZG9uJ3QgaGF2ZSB0byBiZSB2ZXJpZmllZC4gRkZTXHJcblxyXG4gICAgaWYgKG1lc3NhZ2UuYm9keSAmJiBtZXNzYWdlLmJvZHkuc291cmNlKSB7XHJcbiAgICAgIGZyb20gPSBtZXNzYWdlLmJvZHkuc291cmNlO1xyXG4gICAgfVxyXG5cclxuICAgIGlmIChtZXNzYWdlLmJvZHkgJiYgbWVzc2FnZS5ib2R5LnN1YnNjcmliZXIpIHtcclxuICAgICAgZnJvbSA9IG1lc3NhZ2UuYm9keS5zdWJzY3JpYmVyO1xyXG4gICAgfVxyXG5cclxuICAgIGlmIChmcm9tLmluZGV4T2YoJy9wMnBoYW5kbGVyLycpICE9PSAtMSB8fCBmcm9tLmluZGV4T2YoJy9wMnByZXF1ZXN0ZXIvJykgIT09IC0xIHx8IHRvLmluZGV4T2YoJy9wMnBoYW5kbGVyLycpICE9PSAtMSB8fCB0by5pbmRleE9mKCcvcDJwcmVxdWVzdGVyLycpICE9PSAtMSkge1xyXG4gICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKHRoaXMuX3JlZ2lzdHJ5LmlzTG9jYWwoZnJvbSkgJiYgdGhpcy5fcmVnaXN0cnkuaXNMb2NhbChtZXNzYWdlLnRvKSlcclxuICAgICAgcmV0dXJuIGZhbHNlO1xyXG5cclxuICAgIGlmIChtZXNzYWdlLmZyb20gPT09IGZyb21TY2hlbWEgfHwgbWVzc2FnZS50byA9PT0gdG9TY2hlbWEgfHwgbWVzc2FnZS50eXBlID09PSAncmVhZCcgfHwgbWVzc2FnZS50eXBlID09PSAncmVzcG9uc2UnIHx8IChtZXNzYWdlLmZyb20uaW5jbHVkZXMoJ2h5cGVydHk6Ly8nKSAmJiBtZXNzYWdlLnR5cGUgPT09ICdkZWxldGUnKSkge1xyXG4gICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICByZXR1cm4gc2NoZW1hc1RvSWdub3JlLmluZGV4T2YoZnJvbVNjaGVtYSkgPT09IC0xIHx8IHNjaGVtYXNUb0lnbm9yZS5pbmRleE9mKHRvU2NoZW1hKSA9PT0gLTE7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBfaXNJbmNvbWluZ01lc3NhZ2UobWVzc2FnZSkge1xyXG4gICAgbGV0IGZyb207XHJcblxyXG4gICAgaWYgKG1lc3NhZ2UudHlwZSA9PT0gJ2ZvcndhcmQnKSB7XHJcbiAgICAgIGxvZy5pbmZvKCdbTWVzc2FnZUJ1cyAtIGlzSW5jb21pbmdNZXNzYWdlXSAtIG1lc3NhZ2UudHlwZTogJywgbWVzc2FnZS50eXBlKTtcclxuICAgICAgZnJvbSA9IG1lc3NhZ2UuYm9keS5mcm9tO1xyXG4gICAgfSBlbHNlIGlmIChtZXNzYWdlLmhhc093blByb3BlcnR5KCdib2R5JykgJiYgbWVzc2FnZS5ib2R5Lmhhc093blByb3BlcnR5KCdzb3VyY2UnKSAmJiBtZXNzYWdlLmJvZHkuc291cmNlKSB7XHJcbiAgICAgIGxvZy5pbmZvKCdbTWVzc2FnZUJ1cyAtIGlzSW5jb21pbmdNZXNzYWdlXSAtIG1lc3NhZ2UuYm9keS5zb3VyY2U6ICcsIG1lc3NhZ2UuYm9keS5zb3VyY2UpO1xyXG4gICAgICBmcm9tID0gbWVzc2FnZS5ib2R5LnNvdXJjZTtcclxuICAgIH0gZWxzZSBpZiAobWVzc2FnZS5oYXNPd25Qcm9wZXJ0eSgnYm9keScpICYmIG1lc3NhZ2UuYm9keS5oYXNPd25Qcm9wZXJ0eSgnc3Vic2NyaWJlcicpICYmIG1lc3NhZ2UuYm9keS5zdWJzY3JpYmVyKSB7XHJcbiAgICAgIC8vVE9ETzogdGhpcyBzdWJzY3JpYmVyIHZhbGlkYXRpb24gc2hvdWxkIG5vdCBleGlzdCwgYmVjYXVzZSBpcyBvdXRkYXRlZFxyXG4gICAgICAvL1RPRE86IHRoZSBzeW5jaGVyIGFuZCBzeW5jaGVyIG1hbmFnZXIgbm90IGZvbGxvd2luZyB0aGUgY29ycmVjdCBzcGVjO1xyXG4gICAgICBsb2cuaW5mbygnW01lc3NhZ2VCdXMgLSBpc0luY29taW5nTWVzc2FnZV0gLSBtZXNzYWdlLmJvZHkuc3Vic2NyaWJlcjogJywgbWVzc2FnZS5ib2R5LnN1YnNjcmliZXIpO1xyXG4gICAgICBmcm9tID0gbWVzc2FnZS5ib2R5LnN1YnNjcmliZXI7XHJcbiAgICB9ICBlbHNlIGlmIChtZXNzYWdlLmhhc093blByb3BlcnR5KCdib2R5JykgJiYgbWVzc2FnZS5ib2R5Lmhhc093blByb3BlcnR5KCdyZXBvcnRlcicpICYmIG1lc3NhZ2UuYm9keS5yZXBvcnRlcikge1xyXG4gICAgICAvL1RPRE86IHRoaXMgc3Vic2NyaWJlciB2YWxpZGF0aW9uIHNob3VsZCBub3QgZXhpc3QsIGJlY2F1c2UgaXMgb3V0ZGF0ZWRcclxuICAgICAgLy9UT0RPOiB0aGUgc3luY2hlciBhbmQgc3luY2hlciBtYW5hZ2VyIG5vdCBmb2xsb3dpbmcgdGhlIGNvcnJlY3Qgc3BlYztcclxuICAgICAgbG9nLmluZm8oJ1tNZXNzYWdlQnVzIC0gaXNJbmNvbWluZ01lc3NhZ2VdIC0gbWVzc2FnZS5ib2R5LnJlcG9ydGVyOiAnLCBtZXNzYWdlLmJvZHkucmVwb3J0ZXIpO1xyXG4gICAgICBmcm9tID0gbWVzc2FnZS5ib2R5LnJlcG9ydGVyO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgbG9nLmluZm8oJ1tNZXNzYWdlQnVzIC0gaXNJbmNvbWluZ01lc3NhZ2VdIC0gbWVzc2FnZS5mcm9tICcsIG1lc3NhZ2UuZnJvbSk7XHJcbiAgICAgIGZyb20gPSBtZXNzYWdlLmZyb207XHJcbiAgICB9XHJcblxyXG4gICAgbG9nLmluZm8oJ1tNZXNzYWdlQnVzIC0gaXNJbmNvbWluZ01lc3NhZ2VdIC0gY2hlY2sgaWYgaXNMb2NhbDogJywgZnJvbSk7XHJcbiAgICByZXR1cm4gIXRoaXMuX3JlZ2lzdHJ5LmlzTG9jYWwoZnJvbSk7XHJcbiAgfVxyXG5cclxuXHJcbiAgLyoqXHJcbiAgICogQWRkcyBhbiBleHRlcm5hbCBwdWJsaXNoIGFkZHJlc3MgbGlzdGVuZXIuIEV2ZXJ5IG1lc3NhZ2UgZm9yIHRoZSBhZGRyZXNzIHdpbGwgYmUgZm9yd2FyZGVkIHRvIHRoZSBleHRlcm5hbCByb3V0aW5nIGJ5IF9vblBvc3RNZXNzYWdlLlxyXG4gICAqIFRoaXMgbWVhbnMsIGV2ZW4gaWYgdGhlcmUgaXMgYSBsaXN0ZW5lciBmb3IgdGhlIGFkZHJlc3MsIGl0IHdpbGwgYWxzbyBzZW5kIHRoZSBtZXNzYWdlIHRvIHRoZSBleHRlcm5hbCByb3V0aW5nLlxyXG4gICAqIEBwYXJhbSB7VVJMfSBmcm9tIFB1Ymxpc2ggYWRkcmVzcy5cclxuICAgKi9cclxuICBhZGRQdWJsaXNoKGZyb20pIHtcclxuICAgIGxldCBfdGhpcyA9IHRoaXM7XHJcblxyXG4gICAgLy92ZXJpZnkgaWYgZm9yd2FyZCBleGlzdFxyXG4gICAgbGV0IHJlZkNvdW50ID0gX3RoaXMuX2ZvcndhcmRzW2Zyb21dO1xyXG4gICAgaWYgKCFyZWZDb3VudCkge1xyXG4gICAgICBsZXQgZm9yd2FyZExpc3RlbmVyID0gX3RoaXMuYWRkTGlzdGVuZXIoZnJvbSwgKG1zZykgPT4ge1xyXG4gICAgICAgIGxvZy5pbmZvKCdNQi1QVUJMSVNIOiAoICcgKyBmcm9tICsgJyApJyk7XHJcbiAgICAgICAgLy8gaGFjayB0byBza2lwIGV4dGVybmFsIHJvdXRlcyBmb3IgbWVzc2FnZXMgY29taW5nIGZyb20gZXh0ZXJuYWwgaG9zdHMgXHJcbiAgICAgICAgLy8gYW5kIG1lc3NhZ2VzIHRhcmdldGluZyBpbnRlcm5hbCBjb3JlIHJ1bnRpbWUgY29tcG9uZW50c1xyXG4gICAgICAgIGlmICghKG1zZy5ib2R5ICYmIG1zZy5ib2R5LnNvdXJjZSAmJiBtc2cuYm9keS5zb3VyY2UuaW5jbHVkZXMoJy9wcm90b3N0dWIvJykpICYmXHJcbiAgICAgICAgIW1zZy50by5pbmNsdWRlcyhfdGhpcy5fcnVudGltZVVybCkpXHJcbiAgICAgICAgICBfdGhpcy5fb25Qb3N0TWVzc2FnZShtc2cpO1xyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIHJlZkNvdW50ID0ge1xyXG4gICAgICAgIGNvdW50ZXI6IDAsXHJcbiAgICAgICAgZmw6IGZvcndhcmRMaXN0ZW5lcixcclxuICAgICAgICByZW1vdmU6ICgpID0+IHtcclxuICAgICAgICAgIHRoaXMuY291bnRlci0tO1xyXG4gICAgICAgICAgaWYgKHRoaXMuY291bnRlciA9PT0gMCkge1xyXG4gICAgICAgICAgICB0aGlzLmZsLnJlbW92ZSgpO1xyXG4gICAgICAgICAgICBkZWxldGUgX3RoaXMuX2ZvcndhcmRzW2Zyb21dO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgfTtcclxuXHJcbiAgICAgX3RoaXMuX2ZvcndhcmRzW2Zyb21dID0gcmVmQ291bnQ7XHJcbiAgIH1cclxuXHJcbiAgIHJlZkNvdW50LmNvdW50ZXIrKztcclxuICAgcmV0dXJuIHJlZkNvdW50O1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQWRkcyBhIGZvcndhcmQgbGlzdGVuZXIgZm9yIGEgbWVzc2FnZSBkZXN0aW5hdGlvbi4gRXZlcnkgbWVzc2FnZSByZWFjaGluZyBhbiBhZGRyZXNzIHdpbGwgYmUgYWxzbyBzZW50IHRvIHRoZSBmb3J3YXJkIGFkZHJlc3MuXHJcbiAgICogQHBhcmFtIHtVUkx9IGZyb20gTWVzc2FnZSBkZXN0aW5hdGlvbiwgaXQncyBhY3R1YWxseSB0aGUgZmllbGQgXCJ0b1wiIG9mIHRoZSBtZXNzYWdlLlxyXG4gICAqIEBwYXJhbSB7VVJMfSB0byAgIEZvcndhcmQgYWRkcmVzcy5cclxuICAgKi9cclxuICAgYWRkRm9yd2FyZChmcm9tLCB0bykge1xyXG4gICAgIGxldCBfdGhpcyA9IHRoaXM7XHJcblxyXG4gICAgIHJldHVybiBfdGhpcy5hZGRMaXN0ZW5lcihmcm9tLCAobXNnKSA9PiB7XHJcbiAgICAgICBsb2cuaW5mbygnTUItRk9SV0FSRDogKCAnICsgZnJvbSArICcgdG8gJyArIHRvICsgJyApJyk7XHJcbiAgICAgICBfdGhpcy5mb3J3YXJkKHRvLCBtc2cpO1xyXG4gICAgIH0pO1xyXG4gICB9XHJcblxyXG4gICAvKipcclxuICAgICogSnVzdCBmb3J3YXJkJ3MgYSBtZXNzYWdlIHRvIHRoZSBmb3J3YXJkIGFkZHJlc3MuIExpc3RlbmVycyBzaG91bGQgYmUgYXZhaWxhYmxlIGZvciB0aGUgZm9yd2FyZCBhZGRyZXNzLlxyXG4gICAgKiBAcGFyYW0gIHtVUkx9IHVybCBGb3J3YXJkIGFkZHJlc3MuXHJcbiAgICAqIEBwYXJhbSAge01lc3NhZ2V9IG1zZyBNZXNzYWdlIHRvIGZvcndhcmRcclxuICAgICovXHJcbiAgIGZvcndhcmQodXJsLCBtc2cpIHtcclxuICAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG5cclxuICAgICBsZXQgaXRlbUxpc3QgPSBfdGhpcy5fc3Vic2NyaXB0aW9uc1t1cmxdO1xyXG4gICAgIGlmIChpdGVtTGlzdCkge1xyXG4gICAgICAgX3RoaXMuX3B1Ymxpc2hPbihpdGVtTGlzdCwgbXNnKTtcclxuICAgICB9XHJcbiAgIH1cclxuXHJcbiAgIC8vZGVmYXVsdCByb3V0ZSwgaWYgdGhlcmUgYXJlIG5vIGxpc3RlbmVycyBhdmFpbGFibGUgZm9yIGEgbWVzc2FnZSBkZXN0aW5hdGlvbi5cclxuICAgX29uUG9zdE1lc3NhZ2UobXNnKSB7XHJcbiAgICAgbGV0IF90aGlzID0gdGhpcztcclxuXHJcbiAgICAgLy9yZXNvbHZlIGV4dGVybmFsIHByb3Rvc3R1Yi4uLlxyXG4gICAgIF90aGlzLl9yZWdpc3RyeS5yZXNvbHZlKG1zZykudGhlbigocm91dGUsIG1zZzJyb3V0ZSkgPT4ge1xyXG4gICAgICAgaWYgKG1zZzJyb3V0ZSkgX3RoaXMuZm9yd2FyZChyb3V0ZSwgbXNnMnJvdXRlKTtcclxuICAgICAgIGVsc2UgX3RoaXMuZm9yd2FyZChyb3V0ZSwgbXNnKTtcclxuICAgICB9KS5jYXRjaChmdW5jdGlvbihlKSB7XHJcbiAgICAgICBsb2cuZXJyb3IoJ1JFU09MVkUtRVJST1I6ICcsIGUpO1xyXG4gICAgIH0pO1xyXG4gICB9XHJcbn1cclxuXHJcbmV4cG9ydCBkZWZhdWx0IE1lc3NhZ2VCdXM7XHJcbiIsIi8vIE1hcnNoYWxzIGEgc3RyaW5nIHRvIFVpbnQ4QXJyYXkuXHJcbmV4cG9ydCBmdW5jdGlvbiBlbmNvZGVVVEY4KHMpIHtcclxuXHR2YXIgaSA9IDA7XHJcblx0dmFyIGJ5dGVzID0gbmV3IFVpbnQ4QXJyYXkocy5sZW5ndGggKiA0KTtcclxuXHRmb3IgKHZhciBjaSA9IDA7IGNpICE9IHMubGVuZ3RoOyBjaSsrKSB7XHJcbiAgICB0cnl7XHJcbiAgICAgIHZhciB4eHggPSBzLmNoYXJDb2RlQXQoY2kpO1xyXG4gICAgfSBjYXRjaCAoZXJyKXtcclxuICAgICAgY29uc29sZS5sb2coZXJyLm1lc3NhZ2UpO1xyXG4gICAgICByZXR1cm47XHJcblxyXG4gICAgfVxyXG5cdFx0dmFyIGMgPSBzLmNoYXJDb2RlQXQoY2kpO1xyXG5cdFx0aWYgKGMgPCAxMjgpIHtcclxuXHRcdFx0Ynl0ZXNbaSsrXSA9IGM7XHJcblx0XHRcdGNvbnRpbnVlO1xyXG5cdFx0fVxyXG5cdFx0aWYgKGMgPCAyMDQ4KSB7XHJcblx0XHRcdGJ5dGVzW2krK10gPSBjID4+IDYgfCAxOTI7XHJcblx0XHR9IGVsc2Uge1xyXG5cdFx0XHRpZiAoYyA+IDB4ZDdmZiAmJiBjIDwgMHhkYzAwKSB7XHJcblx0XHRcdFx0aWYgKCsrY2kgPT0gcy5sZW5ndGgpIHRocm93ICdVVEYtOCBlbmNvZGU6IGluY29tcGxldGUgc3Vycm9nYXRlIHBhaXInO1xyXG5cdFx0XHRcdHZhciBjMiA9IHMuY2hhckNvZGVBdChjaSk7XHJcblx0XHRcdFx0aWYgKGMyIDwgMHhkYzAwIHx8IGMyID4gMHhkZmZmKSB0aHJvdyAnVVRGLTggZW5jb2RlOiBzZWNvbmQgY2hhciBjb2RlIDB4JyArIGMyLnRvU3RyaW5nKDE2KSArICcgYXQgaW5kZXggJyArIGNpICsgJyBpbiBzdXJyb2dhdGUgcGFpciBvdXQgb2YgcmFuZ2UnO1xyXG5cdFx0XHRcdGMgPSAweDEwMDAwICsgKChjICYgMHgwM2ZmKSA8PCAxMCkgKyAoYzIgJiAweDAzZmYpO1xyXG5cdFx0XHRcdGJ5dGVzW2krK10gPSBjID4+IDE4IHwgMjQwO1xyXG5cdFx0XHRcdGJ5dGVzW2krK10gPSBjPj4gMTIgJiA2MyB8IDEyODtcclxuXHRcdFx0fSBlbHNlIHsgLy8gYyA8PSAweGZmZmZcclxuXHRcdFx0XHRieXRlc1tpKytdID0gYyA+PiAxMiB8IDIyNDtcclxuXHRcdFx0fVxyXG5cdFx0XHRieXRlc1tpKytdID0gYyA+PiA2ICYgNjMgfCAxMjg7XHJcblx0XHR9XHJcblx0XHRieXRlc1tpKytdID0gYyAmIDYzIHwgMTI4O1xyXG5cdH1cclxuXHRyZXR1cm4gYnl0ZXMuc3ViYXJyYXkoMCwgaSk7XHJcbn1cclxuXHJcbi8vIFVubWFyc2hhbHMgYW4gVWludDhBcnJheSB0byBzdHJpbmcuXHJcbmV4cG9ydCBmdW5jdGlvbiBkZWNvZGVVVEY4KGJ5dGVzKSB7XHJcblx0dmFyIHMgPSAnJztcclxuXHR2YXIgaSA9IDA7XHJcblx0d2hpbGUgKGkgPCBieXRlcy5sZW5ndGgpIHtcclxuXHRcdHZhciBjID0gYnl0ZXNbaSsrXTtcclxuXHRcdGlmIChjID4gMTI3KSB7XHJcblx0XHRcdGlmIChjID4gMTkxICYmIGMgPCAyMjQpIHtcclxuXHRcdFx0XHRpZiAoaSA+PSBieXRlcy5sZW5ndGgpIHRocm93ICdVVEYtOCBkZWNvZGU6IGluY29tcGxldGUgMi1ieXRlIHNlcXVlbmNlJztcclxuXHRcdFx0XHRjID0gKGMgJiAzMSkgPDwgNiB8IGJ5dGVzW2ldICYgNjM7XHJcblx0XHRcdH0gZWxzZSBpZiAoYyA+IDIyMyAmJiBjIDwgMjQwKSB7XHJcblx0XHRcdFx0aWYgKGkgKyAxID49IGJ5dGVzLmxlbmd0aCkgdGhyb3cgJ1VURi04IGRlY29kZTogaW5jb21wbGV0ZSAzLWJ5dGUgc2VxdWVuY2UnO1xyXG5cdFx0XHRcdGMgPSAoYyAmIDE1KSA8PCAxMiB8IChieXRlc1tpXSAmIDYzKSA8PCA2IHwgYnl0ZXNbKytpXSAmIDYzO1xyXG5cdFx0XHR9IGVsc2UgaWYgKGMgPiAyMzkgJiYgYyA8IDI0OCkge1xyXG5cdFx0XHRcdGlmIChpKzIgPj0gYnl0ZXMubGVuZ3RoKSB0aHJvdyAnVVRGLTggZGVjb2RlOiBpbmNvbXBsZXRlIDQtYnl0ZSBzZXF1ZW5jZSc7XHJcblx0XHRcdFx0YyA9IChjICYgNykgPDwgMTggfCAoYnl0ZXNbaV0gJiA2MykgPDwgMTIgfCAoYnl0ZXNbKytpXSAmIDYzKSA8PCA2IHwgYnl0ZXNbKytpXSAmIDYzO1xyXG5cdFx0XHR9IGVsc2UgdGhyb3cgJ1VURi04IGRlY29kZTogdW5rbm93biBtdWx0aWJ5dGUgc3RhcnQgMHgnICsgYy50b1N0cmluZygxNikgKyAnIGF0IGluZGV4ICcgKyAoaSAtIDEpO1xyXG5cdFx0XHQrK2k7XHJcblx0XHR9XHJcblxyXG5cdFx0aWYgKGMgPD0gMHhmZmZmKSBzICs9IFN0cmluZy5mcm9tQ2hhckNvZGUoYyk7XHJcblx0XHRlbHNlIGlmIChjIDw9IDB4MTBmZmZmKSB7XHJcblx0XHRcdGMgLT0gMHgxMDAwMDtcclxuXHRcdFx0cyArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKGMgPj4gMTAgfCAweGQ4MDApXHJcblx0XHRcdHMgKz0gU3RyaW5nLmZyb21DaGFyQ29kZShjICYgMHgzRkYgfCAweGRjMDApXHJcblx0XHR9IGVsc2UgdGhyb3cgJ1VURi04IGRlY29kZTogY29kZSBwb2ludCAweCcgKyBjLnRvU3RyaW5nKDE2KSArICcgZXhjZWVkcyBVVEYtMTYgcmVhY2gnO1xyXG5cdH1cclxuXHRyZXR1cm4gcztcclxufVxyXG4iLCJpbXBvcnQge2VuY29kZVVURjgsIGRlY29kZVVURjh9IGZyb20gJy4vdXRmOC5qcyc7XHJcbmltcG9ydCAqIGFzIGxvZ2dlciBmcm9tICdsb2dsZXZlbCc7XHJcbmxldCBsb2cgPSBsb2dnZXIuZ2V0TG9nZ2VyKCdDcnlwdG9NYW5hZ2VyJyk7XHJcblxyXG4vKipcclxuKiBDbGFzcyB3aXRoIHRoZSBjcnlwdG9ncmFwaGljIGZ1bmN0aW9ucyBmb3IgdGhlIGF1dGhlbnRpY2F0aW9uIHByb3RvY29sXHJcbipcclxuKi9cclxuY2xhc3MgQ3J5cHRvIHtcclxuXHJcbi8qKlxyXG4qIFJ1bnRpbWVmYWN0b3J5IGlzIHBhc3NlZCBpbiB0aGUgY29zdHJ1Y3RvciwgYmVjYXVzZSB0aGUgbm9kZUpTIGhhcyBhIGRpZmZlcmVudCBjcnlwdG8gbW9kdWxlXHJcbiogZnJvbSB0aGUgYnJvd3Nlci4gUnVudGltZUZhY3RvcnkgcHJvdmlkZXMgYSB3cmFwcGVyIGZvciB0aGUgZnVjdGlvbnMgb2Ygbm9kZUpTLCBzbyB0aGV5IGNhbiBiZVxyXG4qIGludm9rZWQgYnJvd3NlciBsaWtlLlxyXG4qL1xyXG4gIGNvbnN0cnVjdG9yKHJ1bnRpbWVGYWN0b3J5KSB7XHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG4gICAgdHlwZW9mIHJ1bnRpbWVGYWN0b3J5LmNyZWF0ZVdlYmNyeXB0byA9PT0gJ2Z1bmN0aW9uJyA/IF90aGlzLl9jcnlwdG8gPSBydW50aW1lRmFjdG9yeS5jcmVhdGVXZWJjcnlwdG8oKSA6IF90aGlzLl9jcnlwdG8gPSBjcnlwdG87XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAqIFBlcmZvcm1zIGEgUlNBIGVuY3J5cHRpb25cclxuICAqIEBwYXJhbSAgIHtBcnJheUJ1ZmZlcn0gICAgdmFsdWUgICAgdGhlIHB1YmxpYyBrZXlcclxuICAqIEBwYXJhbSAgIHtCdWZmZXJTb3VyY2V9ICAgIHZhbHVlICAgIGRhdGEgdG8gYmUgZW5jcnlwZWRcclxuICAqIEByZXR1cm4gIHtVaW50OEFycmF5fSAgIGVuY3J5cHRlZCBkYXRhXHJcbiAgKi9cclxuICBlbmNyeXB0UlNBKHB1YktleSwgZGF0YSkge1xyXG4gICAgbG9nLmxvZygnZW5jcnlwdFJTQTpwdWJLZXknLCBwdWJLZXkpO1xyXG4gICAgbG9nLmxvZygnZW5jcnlwdFJTQTpkYXRhJywgZGF0YSk7XHJcblxyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuXHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgIF90aGlzLl9pbXBvcnRSU0FlbmNyeXB0S2V5KG5ldyBVaW50OEFycmF5KHB1YktleSkpLnRoZW4oZnVuY3Rpb24ocHVibGljS2V5KSB7XHJcblxyXG4gICAgICAgIF90aGlzLl9jcnlwdG8uc3VidGxlLmVuY3J5cHQoXHJcbiAgICAgICAgICB7XHJcbiAgICAgICAgICAgIG5hbWU6ICdSU0EtT0FFUCdcclxuICAgICAgICAgIH0sXHJcbiAgICAgICAgICBwdWJsaWNLZXksIC8vZnJvbSBnZW5lcmF0ZUtleSBvciBpbXBvcnRLZXkgYWJvdmVcclxuICAgICAgICAgIGRhdGEgLy9BcnJheUJ1ZmZlciBvZiBkYXRhIHlvdSB3YW50IHRvIGVuY3J5cHRcclxuICAgICAgICApXHJcbiAgICAgICAgICAudGhlbihmdW5jdGlvbihlbmNyeXB0ZWQpIHtcclxuICAgICAgICAgIC8vcmV0dXJucyBhbiBBcnJheUJ1ZmZlciBjb250YWluaW5nIHRoZSBlbmNyeXB0ZWQgZGF0YVxyXG4gICAgICAgICAgLy8gbG9nLmxvZygnY3J5cHRvLWVuY3J5cHRSU0EnLCBuZXcgVWludDhBcnJheShlbmNyeXB0ZWQpKTtcclxuICAgICAgICAgICAgcmVzb2x2ZShuZXcgVWludDhBcnJheShlbmNyeXB0ZWQpKTtcclxuXHJcbiAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgIC8vIGxvZy5sb2coJ2NyeXB0by1lbmNyeXB0UlNBJywgZXJyKTtcclxuICAgICAgICAgICAgcmVqZWN0KGVycik7XHJcbiAgICAgICAgICB9KTtcclxuICAgICAgfSk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICogUGVyZm9ybXMgYSBSU0EgZGVjcnlwdGlvblxyXG4gICogQHBhcmFtICAge0FycmF5QnVmZmVyfSAgICB2YWx1ZSAgICB0aGUgcHJpdmF0ZSBrZXlcclxuICAqIEBwYXJhbSAgIHtCdWZmZXJTb3VyY2V9ICAgIHZhbHVlICAgIGRhdGEgdG8gYmUgZGVjcnlwdGVkXHJcbiAgKiBAcmV0dXJuICB7VWludDhBcnJheX0gICBkZWNyeXB0ZWQgZGF0YVxyXG4gICovXHJcbiAgZGVjcnlwdFJTQShwcml2S2V5LCBkYXRhKSB7XHJcbiAgICBsb2cubG9nKCdkZWNyeXB0UlNBOnByaXZLZXknLCBwcml2S2V5KTtcclxuICAgIGxvZy5sb2coJ2RlY3J5cHRSU0E6ZGF0YScsIGRhdGEpO1xyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuXHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgIF90aGlzLl9pbXBvcnRSU0FkZWNyeXB0S2V5KHByaXZLZXkpLnRoZW4oZnVuY3Rpb24ocHJpdmF0ZUtleSkge1xyXG5cclxuICAgICAgICBfdGhpcy5fY3J5cHRvLnN1YnRsZS5kZWNyeXB0KFxyXG4gICAgICAgICAge1xyXG4gICAgICAgICAgICBuYW1lOiAnUlNBLU9BRVAnXHJcbiAgICAgICAgICB9LFxyXG4gICAgICAgICAgcHJpdmF0ZUtleSwgLy9mcm9tIGdlbmVyYXRlS2V5IG9yIGltcG9ydEtleSBhYm92ZVxyXG4gICAgICAgICAgZGF0YSAvL0FycmF5QnVmZmVyIG9mIHRoZSBkYXRhXHJcbiAgICAgICAgKVxyXG4gICAgICAgICAgLnRoZW4oZnVuY3Rpb24oZGVjcnlwdGVkKSB7XHJcblxyXG4gICAgICAgICAgICBsZXQgZGVjcnlwdGVkRGF0YSA9IG5ldyBVaW50OEFycmF5KGRlY3J5cHRlZCk7XHJcblxyXG4gICAgICAgICAgICAvLyBsb2cubG9nKCdjcnlwdG8tZGVjcnlwdFJTQScsIGRlY3J5cHRlZERhdGEpO1xyXG4gICAgICAgICAgICByZXNvbHZlKGRlY3J5cHRlZERhdGEpO1xyXG5cclxuICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgLy8gbG9nLmxvZygnY3J5cHRvLWRlY3J5cHRSU0EnLCBlcnIpO1xyXG4gICAgICAgICAgICByZWplY3QoZXJyKTtcclxuICAgICAgICAgIH0pO1xyXG4gICAgICB9KTtcclxuXHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICogUGVyZm9ybXMgYSBSU0Egc2lnblxyXG4gICogQHBhcmFtICAge0FycmF5QnVmZmVyfSAgICB2YWx1ZSAgICB0aGUgcHJpdmF0ZSBrZXlcclxuICAqIEBwYXJhbSAgIHtCdWZmZXJTb3VyY2V9ICAgIHZhbHVlICAgIGRhdGEgdG8gYmUgc2lnbmVkXHJcbiAgKiBAcmV0dXJuICB7VWludDhBcnJheX0gICBkYXRhIHNpZ25hdHVyZVxyXG4gICovXHJcbiAgc2lnblJTQShwcml2S2V5LCBkYXRhKSB7XHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG5cclxuICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgX3RoaXMuX2ltcG9ydFJTQXNpZ25LZXkocHJpdktleSkudGhlbihmdW5jdGlvbihwcml2YXRlS2V5KSB7XHJcblxyXG4gICAgICAgIF90aGlzLl9jcnlwdG8uc3VidGxlLnNpZ24oXHJcbiAgICAgICAgICB7XHJcbiAgICAgICAgICAgIG5hbWU6ICdSU0FTU0EtUEtDUzEtdjFfNSdcclxuICAgICAgICAgIH0sXHJcbiAgICAgICAgICBwcml2YXRlS2V5LCAvL2Zyb20gZ2VuZXJhdGVLZXkgb3IgaW1wb3J0S2V5IGFib3ZlXHJcbiAgICAgICAgICBlbmNvZGVVVEY4KGRhdGEpIC8vQXJyYXlCdWZmZXIgb2YgZGF0YSB5b3Ugd2FudCB0byBzaWduXHJcbiAgICAgICAgKVxyXG4gICAgICAgICAgLnRoZW4oZnVuY3Rpb24oc2lnbmF0dXJlKSB7XHJcbiAgICAgICAgICAvL3JldHVybnMgYW4gQXJyYXlCdWZmZXIgY29udGFpbmluZyB0aGUgc2lnbmF0dXJlXHJcbiAgICAgICAgICAvLyBsb2cubG9nKCdjcnlwdG8tc2lnblJTQScsIG5ldyBVaW50OEFycmF5KHNpZ25hdHVyZSkpO1xyXG4gICAgICAgICAgICByZXNvbHZlKG5ldyBVaW50OEFycmF5KHNpZ25hdHVyZSkpO1xyXG5cclxuICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgLy8gbG9nLmxvZygnY3J5cHRvLXNpZ25SU0EnLCBlcnIpO1xyXG4gICAgICAgICAgICByZWplY3QoZXJyKTtcclxuICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgfSk7XHJcblxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAqIFBlcmZvcm1zIGEgUlNBIHNpZ25hdHVyZSB2ZXJpZmljYXRpb25cclxuICAqIEBwYXJhbSAgIHtBcnJheUJ1ZmZlcn0gICAgdmFsdWUgICAgdGhlIHB1YmxpYyBrZXlcclxuICAqIEBwYXJhbSAgIHtCdWZmZXJTb3VyY2V9ICAgIHZhbHVlICAgIGRhdGEgdG8gYmUgdmVyaWZpZWRcclxuICAqIEByZXR1cm4gIHtCb29sZWFufSAgIHJlc3VsdCBvZiB0aGUgc2lnbmF0dXJlIHZlcmlmaWNhdGlvblxyXG4gICovXHJcbiAgdmVyaWZ5UlNBKHB1YktleSwgZGF0YSwgc2lnbmF0dXJlKSB7XHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG5cclxuICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgX3RoaXMuX2ltcG9ydFJTQXZlcmlmeUtleShwdWJLZXkpLnRoZW4oZnVuY3Rpb24ocHVibGljS2V5KSB7XHJcblxyXG4gICAgICAgIF90aGlzLl9jcnlwdG8uc3VidGxlLnZlcmlmeShcclxuICAgICAgICAgIHtcclxuICAgICAgICAgICAgbmFtZTogJ1JTQVNTQS1QS0NTMS12MV81J1xyXG4gICAgICAgICAgfSxcclxuICAgICAgICAgIHB1YmxpY0tleSwgLy9mcm9tIGdlbmVyYXRlS2V5IG9yIGltcG9ydEtleSBhYm92ZVxyXG4gICAgICAgICAgc2lnbmF0dXJlLCAvL0FycmF5QnVmZmVyIG9mIHRoZSBzaWduYXR1cmVcclxuICAgICAgICAgIGVuY29kZVVURjgoZGF0YSkgLy9BcnJheUJ1ZmZlciBvZiB0aGUgZGF0YVxyXG4gICAgICAgIClcclxuICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKGlzdmFsaWQpIHtcclxuICAgICAgICAgIC8vcmV0dXJucyBhIGJvb2xlYW4gb24gd2hldGhlciB0aGUgc2lnbmF0dXJlIGlzIHRydWUgb3Igbm90XHJcbiAgICAgICAgICAvLyBsb2cubG9nKCdjcnlwdG8tdmVyaWZ5UlNBJywgaXN2YWxpZCk7XHJcbiAgICAgICAgICAgIHJlc29sdmUoaXN2YWxpZCk7XHJcblxyXG4gICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAvLyBsb2cubG9nKCdjcnlwdG8tdmVyaWZ5UlNBJywgZXJyKTtcclxuICAgICAgICAgICAgcmVqZWN0KGVycik7XHJcbiAgICAgICAgICB9KTtcclxuXHJcbiAgICAgIH0pO1xyXG5cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgKiBQZXJmb3JtcyBhIFJTQSBzaWduYXR1cmUgdmVyaWZpY2F0aW9uXHJcbiAgKiBAcGFyYW0gICB7QXJyYXlCdWZmZXJ9ICAgIHZhbHVlICAgIHRoZSBwdWJsaWMga2V5XHJcbiAgKiBAcGFyYW0gICB7QnVmZmVyU291cmNlfSAgICB2YWx1ZSAgICBkYXRhIHRvIGJlIHZlcmlmaWVkXHJcbiAgKiBAcmV0dXJuICB7Qm9vbGVhbn0gICByZXN1bHQgb2YgdGhlIHNpZ25hdHVyZSB2ZXJpZmljYXRpb25cclxuICAqL1xyXG4gIGVuY3J5cHRBRVMoa2V5LCBkYXRhLCBpdikge1xyXG4gICAgbG9nLmxvZygnZW5jcnlwdEFFUzprZXknLCBrZXkpO1xyXG4gICAgbG9nLmxvZygnZW5jcnlwdEFFUzpkYXRhJywgZGF0YSk7XHJcbiAgICBsb2cubG9nKCdlbmNyeXB0QUVTOml2JywgaXYpO1xyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuXHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgIF90aGlzLl9pbXBvcnRBRVNrZXkoa2V5KS50aGVuKGZ1bmN0aW9uKGFlc0tleSkge1xyXG5cclxuICAgICAgICBfdGhpcy5fY3J5cHRvLnN1YnRsZS5lbmNyeXB0KFxyXG4gICAgICAgICAge1xyXG4gICAgICAgICAgICBuYW1lOiAnQUVTLUNCQycsXHJcblxyXG4gICAgICAgICAgICAvL0Rvbid0IHJlLXVzZSBpbml0aWFsaXphdGlvbiB2ZWN0b3JzIVxyXG4gICAgICAgICAgICAvL0Fsd2F5cyBnZW5lcmF0ZSBhIG5ldyBpdiBldmVyeSB0aW1lIHlvdXIgZW5jcnlwdCFcclxuICAgICAgICAgICAgaXY6IGl2XHJcbiAgICAgICAgICB9LFxyXG4gICAgICAgICAgYWVzS2V5LCAvL2Zyb20gZ2VuZXJhdGVLZXkgb3IgaW1wb3J0S2V5IGFib3ZlXHJcbiAgICAgICAgICBlbmNvZGVVVEY4KGRhdGEpIC8vQXJyYXlCdWZmZXIgb2YgZGF0YSB5b3Ugd2FudCB0byBlbmNyeXB0XHJcbiAgICAgICAgKVxyXG4gICAgICAgICAgLnRoZW4oZnVuY3Rpb24oZW5jcnlwdGVkKSB7XHJcbiAgICAgICAgICAvL3JldHVybnMgYW4gQXJyYXlCdWZmZXIgY29udGFpbmluZyB0aGUgZW5jcnlwdGVkIGRhdGFcclxuICAgICAgICAgIC8vIGxvZy5sb2coJ2NyeXB0by1lbmNyeXB0QUVTJywgbmV3IFVpbnQ4QXJyYXkoZW5jcnlwdGVkKSk7XHJcbiAgICAgICAgICAgIHJlc29sdmUobmV3IFVpbnQ4QXJyYXkoZW5jcnlwdGVkKSk7XHJcblxyXG4gICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAvLyBsb2cubG9nKCdjcnlwdG8tZW5jcnlwdEFFUycsIGVycik7XHJcbiAgICAgICAgICAgIHJlamVjdChlcnIpO1xyXG4gICAgICAgICAgfSk7XHJcblxyXG4gICAgICB9KTtcclxuXHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIGRlY3J5cHRBRVMoa2V5LCBkYXRhLCBpdikge1xyXG4gICAgbG9nLmxvZygnZGVjcnlwdEFFUzprZXknLCBrZXkpO1xyXG4gICAgbG9nLmxvZygnZGVjcnlwdEFFUzpkYXRhJywgZGF0YSk7XHJcbiAgICBsb2cubG9nKCdkZWNyeXB0QUVTOml2JywgaXYpO1xyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuXHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgIF90aGlzLl9pbXBvcnRBRVNrZXkoa2V5KS50aGVuKGZ1bmN0aW9uKGFlc0tleSkge1xyXG5cclxuICAgICAgICBfdGhpcy5fY3J5cHRvLnN1YnRsZS5kZWNyeXB0KFxyXG4gICAgICAgICAge1xyXG4gICAgICAgICAgICBuYW1lOiAnQUVTLUNCQycsXHJcbiAgICAgICAgICAgIGl2OiBpdlxyXG4gICAgICAgICAgfSxcclxuICAgICAgICAgIGFlc0tleSwgLy9mcm9tIGdlbmVyYXRlS2V5IG9yIGltcG9ydEtleSBhYm92ZVxyXG4gICAgICAgICAgZGF0YSAvL0FycmF5QnVmZmVyIG9mIHRoZSBkYXRhXHJcbiAgICAgICAgKVxyXG4gICAgICAgICAgLnRoZW4oZnVuY3Rpb24oZGVjcnlwdGVkKSB7XHJcblxyXG4gICAgICAgICAgICBsZXQgZGVjb2RlZERhdGEgPSBkZWNvZGVVVEY4KG5ldyBVaW50OEFycmF5KGRlY3J5cHRlZCkpO1xyXG4gICAgICAgICAgICBsb2cubG9nKCdjcnlwdG8tZGVjcnlwdEFFUycsIGRlY29kZWREYXRhKTtcclxuICAgICAgICAgICAgcmVzb2x2ZShkZWNvZGVkRGF0YSk7XHJcblxyXG4gICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAvLyBsb2cubG9nKCdjcnlwdG8tZGVjcnlwdEFFUycsIGVycik7XHJcbiAgICAgICAgICAgIHJlamVjdChlcnIpO1xyXG4gICAgICAgICAgfSk7XHJcblxyXG4gICAgICB9KTtcclxuXHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICogY3JlYXRlcyBhIGhhc2ggdXNpbmcgdGhlIEhNQUMgYWxnb3JpdGhtXHJcbiAgKiBAcGFyYW0gIHtieXRlQXJyYXl9ICAgIGtleSAgICAgICBrZXkgdG8gYmUgdXNlZCBpbiB0aGUgaG1hY1xyXG4gICogQHBhcmFtICB7c3RyaW5nfSAgICAgIGRhdGEgICAgICAgaW5mb3JtYXRpb24gdG8gYmUgaGFzaGVkXHJcbiAgKiBAcmV0dXJuICB7Ynl0ZUFycmF5fSAgIHNpZ25hdHVyZSAgcmVzdWx0aW5nIGhhc2hcclxuICAqL1xyXG4gIGhhc2hITUFDKGtleSwgZGF0YSkge1xyXG4gICAgbG9nLmxvZygnaGFzaEhNQUM6a2V5Jywga2V5KTtcclxuICAgIGxvZy5sb2coJ2hhc2hITUFDOmRhdGEnLCBkYXRhKTtcclxuICAgIGxldCBfdGhpcyA9IHRoaXM7XHJcblxyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG5cclxuICAgICAgaWYgKHR5cGVvZiBkYXRhICE9ICdzdHJpbmcnKSB7XHJcbiAgICAgICAgZGF0YSA9IEpTT04uc3RyaW5naWZ5KGRhdGEpO1xyXG4gICAgICAgIGxvZy5sb2coJ0NvbnZlcnRpbmcgaGFzaEhNQUMgaW5wdXJlZCBEQVRBJyk7XHJcbiAgICAgICAgbG9nLmxvZygnSEhhc2hITUFDOicsIGRhdGEpO1xyXG4gICAgICB9XHJcblxyXG5cclxuICAgICAgX3RoaXMuX2ltcG9ydEhNQUNrZXkoa2V5KS50aGVuKGZ1bmN0aW9uKGhtYWNLZXkpIHtcclxuXHJcbiAgICAgICAgX3RoaXMuX2NyeXB0by5zdWJ0bGUuc2lnbihcclxuICAgICAgICAgIHtcclxuICAgICAgICAgICAgbmFtZTogJ0hNQUMnXHJcbiAgICAgICAgICB9LFxyXG4gICAgICAgICAgaG1hY0tleSwgLy9mcm9tIGdlbmVyYXRlS2V5IG9yIGltcG9ydEtleSBhYm92ZVxyXG4gICAgICAgICAgZW5jb2RlVVRGOChkYXRhKSAvL0FycmF5QnVmZmVyIG9mIGRhdGEgeW91IHdhbnQgdG8gc2lnblxyXG4gICAgICAgIClcclxuICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKHNpZ25hdHVyZSkge1xyXG4gICAgICAgICAgICBsb2cubG9nKCdIYXNoSE1BQyBzaWduYXR1cmU6JywgbmV3IFVpbnQ4QXJyYXkoc2lnbmF0dXJlKSk7XHJcblxyXG4gICAgICAgICAgICAvLyBsb2cubG9nKCdjcnlwdG8taGFzaEhNQUMnLCBzaWduYXR1cmUpO1xyXG4gICAgICAgICAgICAvL3JldHVybnMgYW4gQXJyYXlCdWZmZXIgY29udGFpbmluZyB0aGUgc2lnbmF0dXJlXHJcbiAgICAgICAgICAgIHJlc29sdmUobmV3IFVpbnQ4QXJyYXkoc2lnbmF0dXJlKSk7XHJcblxyXG4gICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgIC8vIGxvZy5sb2coJ2NyeXB0by1oYXNoSE1BQycsIGVycik7XHJcbiAgICAgICAgICAgIHJlamVjdChlcnIpO1xyXG4gICAgICAgICAgfSk7XHJcbiAgICAgIH0pO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAqIHZlcmlmaWVzIGFuIGhhc2ggdXNpbmcgdGhlIEhNQUMgYWxnb3JpdGhtXHJcbiAgKiBAcGFyYW0gIHtieXRlQXJyYXl9ICAgIGtleSAgICAgICBrZXkgdG8gYmUgdXNlZCBpbiB0aGUgaG1hY1xyXG4gICogQHBhcmFtICB7c3RyaW5nfSAgICAgIGRhdGEgICAgICAgaW5mb3JtYXRpb24gdG8gYmUgaGFzaGVkIHRvIGNvbXBhcmVcclxuICAqIEBwYXJhbSAge2J5dGVBcnJheX0gIHNpZ25hdHVyZSAgIGhhc2ggdG8gY29tcGFyZSB3aXRoIHRoZSByZWNlaXZlZCBkYXRhXHJcbiAgKiBAcmV0dXJuICB7Ym9vbGVhbn0gICBpc3ZhbGlkICAgICBib29sZWFuIHNheWluZyBpZiB0aGUgZGF0YSBjb3JyZXNwb25kcyB0byB0aGUgaGFzaCByZWNlaXZlZFxyXG4gICovXHJcbiAgdmVyaWZ5SE1BQyhrZXksIGRhdGEsIHNpZ25hdHVyZSkge1xyXG4gICAgbG9nLmxvZygndmVyaWZ5SE1BQzprZXknLCBrZXkpO1xyXG4gICAgbG9nLmxvZygndmVyaWZ5SE1BQzpkYXRhJywgZGF0YSk7XHJcbiAgICBsb2cubG9nKCd2ZXJpZnlITUFDOnNpZ25hdHVyZScsIHNpZ25hdHVyZSk7XHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG5cclxuICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuXHJcbiAgICAgIF90aGlzLl9pbXBvcnRITUFDa2V5KGtleSkudGhlbihmdW5jdGlvbihobWFjS2V5KSB7XHJcblxyXG4gICAgICAgIGlmICh0eXBlb2YgZGF0YSAhPSAnc3RyaW5nJykge1xyXG4gICAgICAgICAgZGF0YSA9IEpTT04uc3RyaW5naWZ5KGRhdGEpO1xyXG4gICAgICAgICAgbG9nLmxvZygnQ29udmVydGluZyB2ZXJpZnlITUFDIGlucHV0ZWQgREFUQTonLCBkYXRhKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIF90aGlzLl9jcnlwdG8uc3VidGxlLnZlcmlmeShcclxuICAgICAgICAgIHtcclxuICAgICAgICAgICAgbmFtZTogJ0hNQUMnXHJcbiAgICAgICAgICB9LFxyXG4gICAgICAgICAgaG1hY0tleSwgLy9mcm9tIGdlbmVyYXRlS2V5IG9yIGltcG9ydEtleSBhYm92ZVxyXG4gICAgICAgICAgc2lnbmF0dXJlLCAvL0FycmF5QnVmZmVyIG9mIHRoZSBzaWduYXR1cmVcclxuICAgICAgICAgIGVuY29kZVVURjgoZGF0YSkgLy9BcnJheUJ1ZmZlciBvZiB0aGUgZGF0YVxyXG4gICAgICAgIClcclxuICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKGlzdmFsaWQpIHtcclxuICAgICAgICAgIC8vcmV0dXJucyBhIGJvb2xlYW4gb24gd2hldGhlciB0aGUgc2lnbmF0dXJlIGlzIHRydWUgb3Igbm90XHJcbiAgICAgICAgICAvLyBsb2cubG9nKCdjcnlwdG8tdmVyaWZ5SE1BQycsIGlzdmFsaWQpO1xyXG4gICAgICAgICAgICBsb2cubG9nKCd2ZXJpZnlITUFDIHJlc3VsdCcsIGlzdmFsaWQpO1xyXG4gICAgICAgICAgICAoaXN2YWxpZCkgPyByZXNvbHZlKGlzdmFsaWQpIDogcmVqZWN0KGlzdmFsaWQpO1xyXG5cclxuICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgICBsb2cuZXJyb3IoJ2NyeXB0by12ZXJpZnlITUFDJywgZXJyKTtcclxuICAgICAgICAgICAgcmVqZWN0KGVycik7XHJcbiAgICAgICAgICB9KTtcclxuICAgICAgfSk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICogZ2VuZXJhdGVzIGEgUlNBIHB1YmxpYy9wcml2YXRlIGtleSBwYWlyIHdpdGggYSBtb2R1bHVzIGxlbmd0aCBvZiAyMDQ4IGJpdHNcclxuICAqIEByZXR1cm4gIHtKU09OfSAgIGtleVBhaXIgICAganNvbiBjb250YWluaW5nIHRoZSBwdWJsaWMgYW5kIHByaXZhdGUga2V5c1xyXG4gICovXHJcbiAgZ2VuZXJhdGVSU0FLZXlQYWlyKCkge1xyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuICAgIGxldCBrZXlQYWlyID0ge307XHJcblxyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICBfdGhpcy5fY3J5cHRvLnN1YnRsZS5nZW5lcmF0ZUtleShcclxuICAgICAgICB7XHJcbiAgICAgICAgICBuYW1lOiAnUlNBLVBTUycsXHJcbiAgICAgICAgICBtb2R1bHVzTGVuZ3RoOiAyMDQ4LCAvL2NhbiBiZSAxMDI0LCAyMDQ4LCBvciA0MDk2XHJcbiAgICAgICAgICBwdWJsaWNFeHBvbmVudDogbmV3IFVpbnQ4QXJyYXkoWzB4MDEsIDB4MDAsIDB4MDFdKSxcclxuICAgICAgICAgIGhhc2g6IHtuYW1lOiAnU0hBLTI1Nid9IC8vY2FuIGJlICdTSEEtMScsICdTSEEtMjU2JywgJ1NIQS0zODQnLCBvciAnU0hBLTUxMidcclxuICAgICAgICB9LFxyXG4gICAgICAgIHRydWUsIC8vd2hldGhlciB0aGUga2V5IGlzIGV4dHJhY3RhYmxlIChpLmUuIGNhbiBiZSB1c2VkIGluIGV4cG9ydEtleSlcclxuICAgICAgICBbJ3NpZ24nLCAndmVyaWZ5J10gLy9jYW4gYmUgYW55IGNvbWJpbmF0aW9uIG9mICdzaWduJyBhbmQgJ3ZlcmlmeSdcclxuXHJcbiAgICAgICkudGhlbihmdW5jdGlvbihrZXkpIHtcclxuICAgICAgICAvL3JldHVybnMgYSBrZXlwYWlyIG9iamVjdFxyXG4gICAgICAgIC8vIGxvZy5sb2coa2V5KTtcclxuXHJcbiAgICAgICAgX3RoaXMuX2NyeXB0by5zdWJ0bGUuZXhwb3J0S2V5KFxyXG4gICAgICAgICAgJ3Nwa2knLCAvL2NhbiBiZSAnandrJyAocHVibGljIG9yIHByaXZhdGUpLCAnc3BraScgKHB1YmxpYyBvbmx5KSwgb3IgJ3BrY3M4JyAocHJpdmF0ZSBvbmx5KVxyXG4gICAgICAgICAga2V5LnB1YmxpY0tleSAvL2NhbiBiZSBhIHB1YmxpY0tleSBvciBwcml2YXRlS2V5LCBhcyBsb25nIGFzIGV4dHJhY3RhYmxlIHdhcyB0cnVlXHJcbiAgICAgICAgKS50aGVuKGZ1bmN0aW9uKHB1YmxpY0tleSkge1xyXG4gICAgICAgICAgLy9yZXR1cm5zIHRoZSBleHBvcnRlZCBrZXkgZGF0YVxyXG4gICAgICAgICAga2V5UGFpci5wdWJsaWMgID0gbmV3IFVpbnQ4QXJyYXkocHVibGljS2V5KTtcclxuICAgICAgICAgIHJldHVybiBfdGhpcy5fY3J5cHRvLnN1YnRsZS5leHBvcnRLZXkoXHJcbiAgICAgICAgICAgICdwa2NzOCcsIC8vY2FuIGJlICdqd2snIChwdWJsaWMgb3IgcHJpdmF0ZSksICdzcGtpJyAocHVibGljIG9ubHkpLCBvciAncGtjczgnIChwcml2YXRlIG9ubHkpXHJcbiAgICAgICAgICAgIGtleS5wcml2YXRlS2V5IC8vY2FuIGJlIGEgcHVibGljS2V5IG9yIHByaXZhdGVLZXksIGFzIGxvbmcgYXMgZXh0cmFjdGFibGUgd2FzIHRydWVcclxuICAgICAgICAgICk7XHJcbiAgICAgICAgfSkudGhlbihmdW5jdGlvbihwcml2YXRlS2V5KSB7XHJcbiAgICAgICAgICBrZXlQYWlyLnByaXZhdGUgID0gbmV3IFVpbnQ4QXJyYXkocHJpdmF0ZUtleSk7XHJcblxyXG4gICAgICAgICAgLy8gbG9nLmxvZygnY3J5cHRvLWdlbmVyYXRlUlNBS2V5UGFpcicsIGtleVBhaXIpO1xyXG4gICAgICAgICAgcmVzb2x2ZShrZXlQYWlyKTtcclxuXHJcbiAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICBsb2cuZXJyb3IoZXJyKTtcclxuICAgICAgICAgIHJlamVjdChlcnIpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgfSkuY2F0Y2goZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgbG9nLmVycm9yKGVycik7XHJcbiAgICAgICAgcmVqZWN0KGVycik7XHJcbiAgICAgIH0pO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAqIEdlbmVyYXRlcyBhIDEyOCBiaXQgcmFuZG9tIHZhbHVlLlxyXG4gICogQHJldHVybiB7Ynl0ZUFycmF5fSAgYXJyYXkgICAgcmFuZG9tIHZhbHVlXHJcbiAgKi9cclxuICBnZW5lcmF0ZUlWKCkge1xyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuXHJcbiAgICBsZXQgYXJyYXkgPSBuZXcgIFVpbnQ4QXJyYXkoMTYpO1xyXG4gICAgX3RoaXMuX2NyeXB0by5nZXRSYW5kb21WYWx1ZXMoYXJyYXkpO1xyXG5cclxuICAgIHJldHVybiBhcnJheTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICogR2VuZXJhdGVzIGEgMjU2IGJpdCByYW5kb20gdmFsdWUuIDMyIGJpdHMgYXJlIGV4dHJhdGVkIGZyb20gdGhlIG1hY2hpbmUgdGltZSxcclxuICAqIHRoZSByZW1haW5pbmcgYXJlIGdlbmVyYXRlZCByYW5kb21seVxyXG4gICogQHJldHVybiB7Ynl0ZUFycmF5fSAgYXJyYXkgICAgcmFuZG9tIHZhbHVlXHJcbiAgKi9cclxuICBnZW5lcmF0ZVJhbmRvbSgpIHtcclxuICAgIGxldCBfdGhpcyA9IHRoaXM7XHJcblxyXG4gICAgbGV0IGFycmF5ID0gbmV3ICBVaW50OEFycmF5KDMyKTtcclxuICAgIF90aGlzLl9jcnlwdG8uZ2V0UmFuZG9tVmFsdWVzKGFycmF5KTtcclxuXHJcbiAgICBsZXQgZGF0ZSA9IERhdGUubm93KCk7XHJcblxyXG4gICAgbGV0IGRhdGVFbmNvZGVkID0gZW5jb2RlVVRGOChkYXRlLnRvU3RyaW5nKCkpO1xyXG5cclxuICAgIC8vZXh0cmFjdCB0aGUgbGVhc3Qgc2lnbmlmaWNhbnQgNCBieXRlcyBpbiB0aGUgZGF0ZVxyXG4gICAgbGV0IGZpbmFsRGF0ZSA9IGRhdGVFbmNvZGVkLnNsaWNlKGRhdGVFbmNvZGVkLmxlbmd0aCAtIDQsIGRhdGVFbmNvZGVkLmxlbmd0aCk7XHJcblxyXG4gICAgLy8gYWRkIGluIHRoZSBmaXJzdCA0IGJ5dGVzIG9mIHRoZSBhcnJheSB0aGUgYnl0ZXMgZXh0cmFjdGVkIHByZXZpb3VzbHk7XHJcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IDQ7IGkrKykgeyBhcnJheVtpXSA9IGZpbmFsRGF0ZVtpXTsgfVxyXG4gICAgcmV0dXJuIGFycmF5O1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgKiBnZW5lcmF0ZXMgYSBwcmVtYXN0ZXIgc2VjcmV0IChQTVMpIG9mIDQ4IGJ5dGVzICgzODQgYml0cykgcmFuZG9tbHlcclxuICAqIEByZXR1cm4ge2J5dGVBcnJheX0gIGFycmF5ICAgIHByZW1hc3RlciBzZWNyZXQga2V5XHJcbiAgKi9cclxuICBnZW5lcmF0ZVBNUygpIHtcclxuICAgIGxldCBfdGhpcyA9IHRoaXM7XHJcblxyXG4gICAgbGV0IGFycmF5ID0gbmV3IFVpbnQ4QXJyYXkoNDgpO1xyXG4gICAgX3RoaXMuX2NyeXB0by5nZXRSYW5kb21WYWx1ZXMoYXJyYXkpO1xyXG4gICAgcmV0dXJuIGFycmF5O1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgKiBnZW5lcmF0ZXMgYSBtYXN0ZXJLZXkgc2VjcmV0IChQTVMpIG9mIDQ4IGJ5dGVzICgzODQgYml0cykgdXNpbmcgdGhlIHByZW1hc3RlciBzZWNyZXQgYW5kXHJcbiAgKiB0d28gcmFuZG9tc1xyXG4gICogQHJldHVybiB7Ynl0ZUFycmF5fSAgYXJyYXkgICAgbWFzdGVyIHNlY3JldCBrZXkgd2l0aCA0OCBieXRlc1xyXG4gICovXHJcbiAgZ2VuZXJhdGVNYXN0ZXJTZWNyZXQoaG1hY0tleSwgZGF0YSkge1xyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuXHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgIGxldCBrZXkgPSBuZXcgVWludDhBcnJheSg0OCk7XHJcbiAgICAgIGxldCBzZWVkID0gZGF0YTtcclxuXHJcbiAgICAgIF90aGlzLl9kaWdlc3QoaG1hY0tleSkudGhlbigoZGlnZXN0ZWRLZXkpID0+IHtcclxuXHJcbiAgICAgICAgX3RoaXMuaGFzaEhNQUMoZGlnZXN0ZWRLZXksIHNlZWQpLnRoZW4oZnVuY3Rpb24oa2V5cGFydDApIHtcclxuXHJcbiAgICAgICAgICAvL2NvcHkgdGhlIGZpcnN0IDMyIGJ5dGVzIGludG8gdGhlIGtleVxyXG4gICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCAzMjsgaSsrKSB7IGtleVtpXSA9IGtleXBhcnQwW2ldOyB9XHJcbiAgICAgICAgICByZXR1cm4gX3RoaXMuaGFzaEhNQUMoZGlnZXN0ZWRLZXksIHNlZWQgKyBrZXlwYXJ0MCk7XHJcblxyXG4gICAgICAgIH0pLnRoZW4oZnVuY3Rpb24oa2V5cGFydDEpIHtcclxuXHJcbiAgICAgICAgICAvL2NvcHkgdGhlIGZpcnN0IDE2IGJ5dGVzIHRvIHRoZSBrZXkgcmVtYWluaW5nIDE2IGJ5dGVzXHJcbiAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IDE2OyBpKyspIHsga2V5W2kgKyAzMl0gPSBrZXlwYXJ0MVtpXTsgfVxyXG5cclxuICAgICAgICAgIC8vIGxvZy5sb2coJ2NyeXB0by1nZW5lcmF0ZU1hc3RlclNlY3JldCcsIGtleSk7XHJcbiAgICAgICAgICByZXNvbHZlKGtleSk7XHJcblxyXG4gICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgLy8gbG9nLmxvZygnY3J5cHRvLWdlbmVyYXRlTWFzdGVyU2VjcmV0JywgZXJyKTtcclxuICAgICAgICAgIHJlamVjdChlcnIpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICB9KTtcclxuXHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICogZ2VuZXJhdGVzIGJvdGggdXNlcnMgTUFDIGFuZCBlbmNyeXB0aW9uIGtleXMuIGdlbmVyYXRlIGFzIG91dHB1dCBhbiBhcnJheVxyXG4gICogd2l0aCA0IGJ5dGVBcnJheSBlYWNoIHdpdGggMzIgYnl0ZXNcclxuICAqIEBwYXJhbSAge2J5dGVBcnJheX0gICAgICAgIHNlY3JldCAgICAgICBzZWNyZXQgdG8gYmUgdXNlZCBpbiB0aGUgSE1BQyBmdW5jdGlvblxyXG4gICogQHBhcmFtICB7U3RyaW5nfSAgICAgICAgICAgZGF0YSAgICAgICAgIGluZm9ybWF0aW9uIHRvIGJlIHVzZWQgYXMgc2VlZFxyXG4gICogQHJldHVybiB7QXJyYXk8Ynl0ZUFycmF5Pn0ga2V5ICAgICAgICAgIGFycmF5IHdpdGggdGhlIGluZm9ybWF0aW9uIHRvIGdlbmVyYXRlIGtleXNcclxuICAqL1xyXG4gIGdlbmVyYXRlS2V5cyhobWFjS2V5LCBkYXRhKSB7XHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG5cclxuICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuXHJcbiAgICAgIGxldCBrZXkgPSBbXTtcclxuICAgICAgbGV0IHNlZWQgPSBkYXRhO1xyXG5cclxuICAgICAgLy8gaXRlcmF0ZSA0IHRpbWVzIHRvIG9idGFpbiBhIDEwMjQga2V5IHNpemVcclxuICAgICAgX3RoaXMuaGFzaEhNQUMoaG1hY0tleSwgc2VlZCkudGhlbihmdW5jdGlvbihrZXlwYXJ0MCkge1xyXG4gICAgICAgIGtleS5wdXNoKGtleXBhcnQwKTtcclxuICAgICAgICByZXR1cm4gX3RoaXMuaGFzaEhNQUMoaG1hY0tleSwgc2VlZCArIGtleXBhcnQwKTtcclxuXHJcbiAgICAgIH0pLnRoZW4oZnVuY3Rpb24oa2V5cGFydDEpIHtcclxuICAgICAgICBrZXkucHVzaChrZXlwYXJ0MSk7XHJcbiAgICAgICAgcmV0dXJuIF90aGlzLmhhc2hITUFDKGhtYWNLZXksIHNlZWQgKyBrZXlwYXJ0MSk7XHJcblxyXG4gICAgICB9KS50aGVuKGZ1bmN0aW9uKGtleXBhcnQyKSB7XHJcbiAgICAgICAga2V5LnB1c2goa2V5cGFydDIpO1xyXG4gICAgICAgIHJldHVybiBfdGhpcy5oYXNoSE1BQyhobWFjS2V5LCBzZWVkICsga2V5cGFydDIpO1xyXG5cclxuICAgICAgfSkudGhlbihmdW5jdGlvbihrZXlwYXJ0Mykge1xyXG4gICAgICAgIGtleS5wdXNoKGtleXBhcnQzKTtcclxuXHJcbiAgICAgICAgLy8gbG9nLmxvZygnY3J5cHRvLWdlbmVyYXRlS2V5cycsIGtleSk7XHJcbiAgICAgICAgcmVzb2x2ZShrZXkpO1xyXG5cclxuICAgICAgfSkuY2F0Y2goZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgLy8gbG9nLmxvZygnY3J5cHRvLWdlbmVyYXRlS2V5cycsIGVycik7XHJcbiAgICAgICAgcmVqZWN0KGVycik7XHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgLy8gbG9nLmxvZyhobWFjS2V5LCBkYXRhKTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgX2ltcG9ydFJTQXNpZ25LZXkocHJpdktleSkge1xyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuXHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgIF90aGlzLl9jcnlwdG8uc3VidGxlLmltcG9ydEtleShcclxuICAgICAgICAncGtjczgnLCAvL2NhbiBiZSAnandrJyAocHVibGljIG9yIHByaXZhdGUpLCAnc3BraScgKHB1YmxpYyBvbmx5KSwgb3IgJ3BrY3M4JyAocHJpdmF0ZSBvbmx5KVxyXG4gICAgICAgIHByaXZLZXksXHJcbiAgICAgICAgeyAgIC8vdGhlc2UgYXJlIHRoZSBhbGdvcml0aG0gb3B0aW9uc1xyXG4gICAgICAgICAgbmFtZTogJ1JTQVNTQS1QS0NTMS12MV81JyxcclxuICAgICAgICAgIGhhc2g6IHtuYW1lOiAnU0hBLTI1Nid9IC8vY2FuIGJlICdTSEEtMScsICdTSEEtMjU2JywgJ1NIQS0zODQnLCBvciAnU0hBLTUxMidcclxuICAgICAgICB9LFxyXG4gICAgICAgIHRydWUsIC8vd2hldGhlciB0aGUga2V5IGlzIGV4dHJhY3RhYmxlIChpLmUuIGNhbiBiZSB1c2VkIGluIGV4cG9ydEtleSlcclxuICAgICAgICBbJ3NpZ24nXSAvLyd2ZXJpZnknIGZvciBwdWJsaWMga2V5IGltcG9ydCwgJ3NpZ24nIGZvciBwcml2YXRlIGtleSBpbXBvcnRzXHJcbiAgICAgIClcclxuICAgICAgICAudGhlbihmdW5jdGlvbihwcml2YXRlS2V5KSB7XHJcbiAgICAgICAgLy9yZXR1cm5zIGEgcHVibGljS2V5IChvciBwcml2YXRlS2V5IGlmIHlvdSBhcmUgaW1wb3J0aW5nIGEgcHJpdmF0ZSBrZXkpXHJcbiAgICAgICAgLy8gbG9nLmxvZygnY3J5cHRvLV9pbXBvcnRSU0FzaWduS2V5JywgcHJpdmF0ZUtleSk7XHJcbiAgICAgICAgICByZXNvbHZlKHByaXZhdGVLZXkpO1xyXG5cclxuICAgICAgICB9KS5jYXRjaChmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgIGxvZy5lcnJvcignY3J5cHRvLV9pbXBvcnRSU0FzaWduS2V5JywgZXJyKTtcclxuICAgICAgICAgIHJlamVjdChlcnIpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBfaW1wb3J0UlNBdmVyaWZ5S2V5KHB1YktleSkge1xyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuXHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgIF90aGlzLl9jcnlwdG8uc3VidGxlLmltcG9ydEtleShcclxuICAgICAgICAnc3BraScsIC8vY2FuIGJlICdqd2snIChwdWJsaWMgb3IgcHJpdmF0ZSksICdzcGtpJyAocHVibGljIG9ubHkpLCBvciAncGtjczgnIChwcml2YXRlIG9ubHkpXHJcbiAgICAgICAgcHViS2V5LFxyXG4gICAgICAgIHsgICAvL3RoZXNlIGFyZSB0aGUgYWxnb3JpdGhtIG9wdGlvbnNcclxuICAgICAgICAgIG5hbWU6ICdSU0FTU0EtUEtDUzEtdjFfNScsXHJcbiAgICAgICAgICBoYXNoOiB7bmFtZTogJ1NIQS0yNTYnfSAvL2NhbiBiZSAnU0hBLTEnLCAnU0hBLTI1NicsICdTSEEtMzg0Jywgb3IgJ1NIQS01MTInXHJcbiAgICAgICAgfSxcclxuICAgICAgICB0cnVlLCAvL3doZXRoZXIgdGhlIGtleSBpcyBleHRyYWN0YWJsZSAoaS5lLiBjYW4gYmUgdXNlZCBpbiBleHBvcnRLZXkpXHJcbiAgICAgICAgWyd2ZXJpZnknXSAvLyd2ZXJpZnknIGZvciBwdWJsaWMga2V5IGltcG9ydCwgJ3NpZ24nIGZvciBwcml2YXRlIGtleSBpbXBvcnRzXHJcbiAgICAgIClcclxuICAgICAgICAudGhlbihmdW5jdGlvbihwdWJsaWNLZXkpIHtcclxuICAgICAgICAvL3JldHVybnMgYSBwdWJsaWNLZXkgKG9yIHByaXZhdGVLZXkgaWYgeW91IGFyZSBpbXBvcnRpbmcgYSBwcml2YXRlIGtleSlcclxuICAgICAgICAvLyBsb2cubG9nKCdjcnlwdG8tX2ltcG9ydFJTQXZlcmlmeUtleScsIHB1YmxpY0tleSk7XHJcbiAgICAgICAgICByZXNvbHZlKHB1YmxpY0tleSk7XHJcblxyXG4gICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgbG9nLmVycm9yKCdjcnlwdG8tX2ltcG9ydFJTQXZlcmlmeUtleScsIGVycik7XHJcbiAgICAgICAgICByZWplY3QoZXJyKTtcclxuICAgICAgICB9KTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgX2ltcG9ydFJTQWVuY3J5cHRLZXkocHViS2V5KSB7XHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG5cclxuICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgX3RoaXMuX2NyeXB0by5zdWJ0bGUuaW1wb3J0S2V5KFxyXG4gICAgICAgICdzcGtpJywgLy9jYW4gYmUgJ2p3aycgKHB1YmxpYyBvciBwcml2YXRlKSwgJ3Nwa2knIChwdWJsaWMgb25seSksIG9yICdwa2NzOCcgKHByaXZhdGUgb25seSlcclxuICAgICAgICBwdWJLZXksXHJcbiAgICAgICAgeyAgIC8vdGhlc2UgYXJlIHRoZSBhbGdvcml0aG0gb3B0aW9uc1xyXG4gICAgICAgICAgbmFtZTogJ1JTQS1PQUVQJyxcclxuICAgICAgICAgIGhhc2g6IHtuYW1lOiAnU0hBLTI1Nid9IC8vY2FuIGJlICdTSEEtMScsICdTSEEtMjU2JywgJ1NIQS0zODQnLCBvciAnU0hBLTUxMidcclxuICAgICAgICB9LFxyXG4gICAgICAgIHRydWUsIC8vd2hldGhlciB0aGUga2V5IGlzIGV4dHJhY3RhYmxlIChpLmUuIGNhbiBiZSB1c2VkIGluIGV4cG9ydEtleSlcclxuICAgICAgICBbJ2VuY3J5cHQnXSAvLydlbmNyeXB0JyBvciAnd3JhcEtleScgZm9yIHB1YmxpYyBrZXkgaW1wb3J0IG9yXHJcbiAgICAgICAgLy8nZGVjcnlwdCcgb3IgJ3Vud3JhcEtleScgZm9yIHByaXZhdGUga2V5IGltcG9ydHNcclxuICAgICAgKVxyXG4gICAgICAgIC50aGVuKGZ1bmN0aW9uKHB1YmxpY0tleSkge1xyXG4gICAgICAgIC8vcmV0dXJucyBhIHB1YmxpY0tleSAob3IgcHJpdmF0ZUtleSBpZiB5b3UgYXJlIGltcG9ydGluZyBhIHByaXZhdGUga2V5KVxyXG4gICAgICAgIC8vIGxvZy5sb2coJ2NyeXB0by1faW1wb3J0UlNBZW5jcnlwdEtleScsIHB1YmxpY0tleSk7XHJcbiAgICAgICAgICByZXNvbHZlKHB1YmxpY0tleSk7XHJcblxyXG4gICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgbG9nLmVycm9yKCdjcnlwdG8tX2ltcG9ydFJTQWVuY3J5cHRLZXknLCBlcnIubmFtZSk7XHJcbiAgICAgICAgICByZWplY3QoZXJyKTtcclxuICAgICAgICB9KTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgX2ltcG9ydFJTQWRlY3J5cHRLZXkocHJpdktleSkge1xyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuXHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgIF90aGlzLl9jcnlwdG8uc3VidGxlLmltcG9ydEtleShcclxuICAgICAgICAncGtjczgnLCAvL2NhbiBiZSAnandrJyAocHVibGljIG9yIHByaXZhdGUpLCAnc3BraScgKHB1YmxpYyBvbmx5KSwgb3IgJ3BrY3M4JyAocHJpdmF0ZSBvbmx5KVxyXG4gICAgICAgIHByaXZLZXksXHJcbiAgICAgICAgeyAgIC8vdGhlc2UgYXJlIHRoZSBhbGdvcml0aG0gb3B0aW9uc1xyXG4gICAgICAgICAgbmFtZTogJ1JTQS1PQUVQJyxcclxuICAgICAgICAgIGhhc2g6IHtuYW1lOiAnU0hBLTI1Nid9IC8vY2FuIGJlICdTSEEtMScsICdTSEEtMjU2JywgJ1NIQS0zODQnLCBvciAnU0hBLTUxMidcclxuICAgICAgICB9LFxyXG4gICAgICAgIHRydWUsIC8vd2hldGhlciB0aGUga2V5IGlzIGV4dHJhY3RhYmxlIChpLmUuIGNhbiBiZSB1c2VkIGluIGV4cG9ydEtleSlcclxuICAgICAgICBbJ2RlY3J5cHQnXSAvLydlbmNyeXB0JyBvciAnd3JhcEtleScgZm9yIHB1YmxpYyBrZXkgaW1wb3J0IG9yXHJcbiAgICAgICAgLy8nZGVjcnlwdCcgb3IgJ3Vud3JhcEtleScgZm9yIHByaXZhdGUga2V5IGltcG9ydHNcclxuICAgICAgKVxyXG4gICAgICAgIC50aGVuKGZ1bmN0aW9uKHByaXZhdGVLZXkpIHtcclxuICAgICAgICAvL3JldHVybnMgYSBwdWJsaWNLZXkgKG9yIHByaXZhdGVLZXkgaWYgeW91IGFyZSBpbXBvcnRpbmcgYSBwcml2YXRlIGtleSlcclxuICAgICAgICAvLyBsb2cubG9nKCdjcnlwdG8tX2ltcG9ydFJTQWRlY3J5cHRLZXknLCBwcml2YXRlS2V5KTtcclxuICAgICAgICAgIHJlc29sdmUocHJpdmF0ZUtleSk7XHJcblxyXG4gICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgbG9nLmVycm9yKCdjcnlwdG8tX2ltcG9ydFJTQWRlY3J5cHRLZXknLCBlcnIpO1xyXG4gICAgICAgICAgcmVqZWN0KGVycik7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIGNvbmNhdFBNU3dpdGhSYW5kb21zKHBtcywgdG9SYW5kb20sIGZyb21SYW5kb20pIHtcclxuXHJcbiAgICBsZXQgZmluYWxLZXkgPSBuZXcgVWludDhBcnJheShwbXMubGVuZ3RoICsgdG9SYW5kb20ubGVuZ3RoICsgZnJvbVJhbmRvbS5sZW5ndGgpO1xyXG5cclxuICAgIC8vIGFkZCBQcmVtYXN0ZXJLZXlcclxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcG1zLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgIGZpbmFsS2V5W2ldID0gcG1zW2ldO1xyXG4gICAgfVxyXG5cclxuICAgIC8vYWRkIHRvIHJhbmRvbVxyXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0b1JhbmRvbS5sZW5ndGg7IGkrKykge1xyXG4gICAgICBmaW5hbEtleVtpICsgcG1zLmxlbmd0aF0gPSBwbXNbaV07XHJcbiAgICB9XHJcblxyXG4gICAgLy9hZGQgZnJvbSByYW5kb21cclxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZnJvbVJhbmRvbS5sZW5ndGg7IGkrKykge1xyXG4gICAgICBmaW5hbEtleVtpICsgcG1zLmxlbmd0aCArIHRvUmFuZG9tLmxlbmd0aF0gPSBwbXNbaV07XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIGZpbmFsS2V5O1xyXG4gIH1cclxuXHJcbiAgX2dlbmVyYXRlMjU2Yml0S2V5KCkge1xyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuICAgIGxldCBhcnJheSA9IG5ldyAgVWludDhBcnJheSgzMik7XHJcbiAgICBfdGhpcy5fY3J5cHRvLmdldFJhbmRvbVZhbHVlcyhhcnJheSk7XHJcblxyXG4gICAgcmV0dXJuIGFycmF5O1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgKiBpbXBvcnRzIHRoZSBzZWNyZXQgdG8gdGhlIEhNQUMgZnVuY3Rpb25cclxuICAqIEBwYXJhbSAge2J5dGVBcnJheX0gICBhcnJheUJ1ZmZlciAgICAgYnl0ZXMgdG8gaW1wb3J0IGFzIGtleVxyXG4gICogQHJldHVybiB7SlNPTn0gICAgICAga2V5ICAgICAgICAgICAgICBrZXkgcmVhZHkgdG8gYmUgdXNlZCBpbiB0aGUgSE1BQyBjcnlwdG9ncmFwaGljIGZ1bmN0aW9uXHJcbiAgKi9cclxuICBfaW1wb3J0SE1BQ2tleShhcnJheUJ1ZmZlcikge1xyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuXHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcblxyXG4gICAgICBfdGhpcy5fZGlnZXN0KGFycmF5QnVmZmVyKS50aGVuKChrZXkpID0+IHtcclxuXHJcbiAgICAgICAgX3RoaXMuX2NyeXB0by5zdWJ0bGUuaW1wb3J0S2V5KFxyXG4gICAgICAgICAgJ3JhdycsIC8vY2FuIGJlICdqd2snIG9yICdyYXcnXHJcbiAgICAgICAgICBrZXksXHJcbiAgICAgICAgICB7ICAgLy90aGlzIGlzIHRoZSBhbGdvcml0aG0gb3B0aW9uc1xyXG4gICAgICAgICAgICBuYW1lOiAnSE1BQycsXHJcbiAgICAgICAgICAgIGhhc2g6IHtuYW1lOiAnU0hBLTI1Nid9LCAvL2NhbiBiZSAnU0hBLTEnLCAnU0hBLTI1NicsICdTSEEtMzg0Jywgb3IgJ1NIQS01MTInXHJcbiAgICAgICAgICAgIGxlbmd0aDogMjU2IC8vb3B0aW9uYWwsIGlmIHlvdSB3YW50IHlvdXIga2V5IGxlbmd0aCB0byBkaWZmZXIgZnJvbSB0aGUgaGFzaCBmdW5jdGlvbidzIGJsb2NrIGxlbmd0aFxyXG4gICAgICAgICAgfSxcclxuICAgICAgICAgIHRydWUsIC8vd2hldGhlciB0aGUga2V5IGlzIGV4dHJhY3RhYmxlIChpLmUuIGNhbiBiZSB1c2VkIGluIGV4cG9ydEtleSlcclxuICAgICAgICAgIFsnc2lnbicsICd2ZXJpZnknXSAvL2NhbiBiZSBhbnkgY29tYmluYXRpb24gb2YgJ3NpZ24nIGFuZCAndmVyaWZ5J1xyXG4gICAgICAgICkudGhlbihmdW5jdGlvbihrZXkpIHtcclxuICAgICAgICAgIC8vcmV0dXJucyB0aGUgc3ltbWV0cmljIGtleVxyXG4gICAgICAgICAgLy8gbG9nLmxvZygnY3J5cHRvLV9pbXBvcnRITUFDa2V5Jywga2V5KTtcclxuICAgICAgICAgIHJlc29sdmUoa2V5KTtcclxuICAgICAgICB9KVxyXG4gICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgICByZWplY3QoZXJyKTtcclxuICAgICAgICAgIH0pO1xyXG4gICAgICB9KTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgX2RpZ2VzdCh2YWx1ZSkge1xyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuXHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgIF90aGlzLl9jcnlwdG8uc3VidGxlLmRpZ2VzdChcclxuICAgICAgICB7XHJcbiAgICAgICAgICBuYW1lOiAnU0hBLTI1NidcclxuICAgICAgICB9LFxyXG4gICAgICAgIHZhbHVlIC8vVGhlIGRhdGEgeW91IHdhbnQgdG8gaGFzaCBhcyBhbiBBcnJheUJ1ZmZlclxyXG4gICAgICApXHJcbiAgICAgICAgLnRoZW4oZnVuY3Rpb24oaGFzaCkge1xyXG4gICAgICAgIC8vcmV0dXJucyB0aGUgaGFzaCBhcyBhbiBBcnJheUJ1ZmZlclxyXG4gICAgICAgIC8vIGxvZy5sb2coJ2NyeXB0by1kaWdlc3QnLCBuZXcgVWludDhBcnJheShoYXNoKSk7XHJcbiAgICAgICAgICByZXNvbHZlKG5ldyBVaW50OEFycmF5KGhhc2gpKTtcclxuICAgICAgICB9KVxyXG4gICAgICAgIC5jYXRjaChmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgIGxvZy5lcnJvcihlcnIpO1xyXG4gICAgICAgICAgcmVqZWN0KGVycik7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBfaW1wb3J0QUVTa2V5KGFycmF5QnVmZmVyKSB7XHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICBfdGhpcy5fY3J5cHRvLnN1YnRsZS5pbXBvcnRLZXkoXHJcbiAgICAgICAgJ3JhdycsIC8vY2FuIGJlICdqd2snIG9yICdyYXcnXHJcbiAgICAgICAgYXJyYXlCdWZmZXIsXHJcbiAgICAgICAgeyAgIC8vdGhpcyBpcyB0aGUgYWxnb3JpdGhtIG9wdGlvbnNcclxuICAgICAgICAgIG5hbWU6ICdBRVMtQ0JDJ1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgdHJ1ZSwgLy93aGV0aGVyIHRoZSBrZXkgaXMgZXh0cmFjdGFibGUgKGkuZS4gY2FuIGJlIHVzZWQgaW4gZXhwb3J0S2V5KVxyXG4gICAgICAgIFsnZW5jcnlwdCcsICdkZWNyeXB0J10gLy9jYW4gYmUgJ2VuY3J5cHQnLCAnZGVjcnlwdCcsICd3cmFwS2V5Jywgb3IgJ3Vud3JhcEtleSdcclxuICAgICAgKVxyXG4gICAgICAgIC50aGVuKGZ1bmN0aW9uKGtleSkge1xyXG4gICAgICAgIC8vcmV0dXJucyB0aGUgc3ltbWV0cmljIGtleVxyXG4gICAgICAgIC8vIGxvZy5sb2coJ2NyeXB0by1pbXBvcnRBRVNrZXknLCBrZXkpO1xyXG4gICAgICAgICAgcmVzb2x2ZShrZXkpO1xyXG4gICAgICAgIH0pXHJcbiAgICAgICAgLmNhdGNoKGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgbG9nLmVycm9yKCdjcnlwdG8taW1wb3J0QUVTa2V5JywgZXJyKTtcclxuICAgICAgICAgIHJlamVjdChlcnIpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBfc2hhMjU2KHN0cikge1xyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuICAgIGxldCBidWZmZXIgPSBuZXcgVGV4dEVuY29kZXIoJ3V0Zi04JykuZW5jb2RlKHN0cik7XHJcbiAgICByZXR1cm4gX3RoaXMuX2NyeXB0by5zdWJ0bGUuZGlnZXN0KCdTSEEtMjU2JywgYnVmZmVyKS50aGVuKGZ1bmN0aW9uKGhhc2gpIHtcclxuICAgICAgcmV0dXJuIF90aGlzLl9oZXgoaGFzaCk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIF9oZXgoYnVmZmVyKSB7XHJcbiAgICBsZXQgaGV4Q29kZXMgPSBbXTtcclxuICAgIGxldCB2aWV3ID0gbmV3IERhdGFWaWV3KGJ1ZmZlcik7XHJcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHZpZXcuYnl0ZUxlbmd0aDsgaSArPSA0KSB7XHJcbiAgICAgIC8vIFVzaW5nIGdldFVpbnQzMiByZWR1Y2VzIHRoZSBudW1iZXIgb2YgaXRlcmF0aW9ucyBuZWVkZWQgKHdlIHByb2Nlc3MgNCBieXRlcyBlYWNoIHRpbWUpXHJcbiAgICAgIGxldCB2YWx1ZSA9IHZpZXcuZ2V0VWludDMyKGkpXHJcblxyXG4gICAgICBsZXQgc3RyaW5nVmFsdWUgPSB2YWx1ZS50b1N0cmluZygxNilcclxuXHJcbiAgICAgIGxldCBwYWRkaW5nID0gJzAwMDAwMDAwJ1xyXG4gICAgICBsZXQgcGFkZGVkVmFsdWUgPSAocGFkZGluZyArIHN0cmluZ1ZhbHVlKS5zbGljZSgtcGFkZGluZy5sZW5ndGgpXHJcbiAgICAgIGhleENvZGVzLnB1c2gocGFkZGVkVmFsdWUpO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIEpvaW4gYWxsIHRoZSBoZXggc3RyaW5ncyBpbnRvIG9uZVxyXG4gICAgcmV0dXJuIGhleENvZGVzLmpvaW4oJycpO1xyXG4gIH1cclxuXHJcblxyXG59XHJcblxyXG5leHBvcnQgZGVmYXVsdCBDcnlwdG87XHJcbiIsIi8vIExvZyBTeXN0ZW1cclxuaW1wb3J0ICogYXMgbG9nZ2VyIGZyb20gJ2xvZ2xldmVsJztcclxubGV0IGxvZyA9IGxvZ2dlci5nZXRMb2dnZXIoJ0NyeXB0b01hbmFnZXInKTtcclxuXHJcbmltcG9ydCB7ZGl2aWRlVVJMLCBpc0RhdGFPYmplY3RVUkwsIGlzTGVnYWN5LCBjaGF0a2V5c1RvU3RyaW5nQ2xvbmVyLCBjaGF0a2V5c1RvQXJyYXlDbG9uZXIsIHBhcnNlTWVzc2FnZVVSTCxcclxuICBwYXJzZSwgc3RyaW5naWZ5LCBlbmNvZGUsIGRlY29kZSwgZGVjb2RlVG9VaW50OEFycmF5LCBwYXJzZVRvVWludDhBcnJheSwgZ2VuZXJhdGVHVUlEfSBmcm9tICcuLi91dGlscy91dGlscy5qcyc7XHJcbmltcG9ydCBDcnlwdG8gZnJvbSAnLi9DcnlwdG8nO1xyXG5cclxuLyoqXHJcbiogIFRoZSBDcnlwdG8gTWFuYWdlciBwcm92aWRlcyBtYW5hZ2VzIGNyeXB0b2dyYXBoaWMgZmVhdHVyZXMgZm9yIHRoZSBydW50aW1lIGluY2x1ZGluZzpcclxuKiAgLSBNdXR1YWwgQXV0aGVudGljYXRpb24gYmV0d2VlbiBwZWVyc1xyXG4qICAtIENyeXB0byBLZXlzXHJcbiogIC0gZTJlIGVuY3J5cHRpb24gYW5kIGRlY3JpcHRpb24gb2YgY29tbXVuaWNhdGlvbiBiZXR3ZWVuIEh5cGVydGllcyBhbmQgZHRhIG9iamVjdHNcclxuKlxyXG4qL1xyXG5jbGFzcyBDcnlwdG9NYW5hZ2VyIHtcclxuXHJcbiAgLyoqXHJcbiAgKiBUaGlzIGlzIHRoZSBjb25zdHJ1Y3RvciB0byBpbml0aWFsaXNlIHRoZSBDcnlwdG9NYW5hZ2VyLCBpdCBkb2VzIG5vdCByZXF1aXJlIGFueSBpbnB1dC5cclxuICAqIFRoZSBpbml0KCkgbXVzdCBjYWxsZWQgaW4gb3JkZXIgdG8gc2V0IG1hbmRhdG9yaWVzIGF0dHJpYnV0ZXNcclxuICAqL1xyXG5cclxuICBjb25zdHJ1Y3RvcihzdG9yYWdlTWFuYWdlcikge1xyXG4gICAgdGhpcy5zdG9yYWdlTWFuYWdlciA9IHN0b3JhZ2VNYW5hZ2VyO1xyXG4gICAgdGhpcy51c2VyRGVmYXVsdEtleVJlZiA9ICd1c2VyQXN5bW1ldHJpY0tleSc7XHJcbiAgfVxyXG5cclxuICBpbml0KHJ1bnRpbWVVUkwsIHJ1bnRpbWVDYXBhYmlsaXRpZXMsIHN0b3JhZ2VNYW5hZ2VyLCBkYXRhT2JqZWN0c1N0b3JhZ2UsIHJlZ2lzdHJ5LCBjb3JlRGlzY292ZXJ5LCBpZG0sIHJ1bnRpbWVGYWN0b3J5KSB7XHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG5cclxuICAgIGlmICghcnVudGltZVVSTCkgdGhyb3cgbmV3IEVycm9yKCdbXSBydW50aW1lVVJMIGlzIG1pc3NpbmcuJyk7XHJcbiAgICBpZiAoIXN0b3JhZ2VNYW5hZ2VyKSB0aHJvdyBuZXcgRXJyb3IoJ3N0b3JhZ2VNYW5hZ2VyIGlzIG1pc3NpbmcnKTtcclxuICAgIGlmICghcnVudGltZUZhY3RvcnkpIHRocm93IG5ldyBFcnJvcigncnVudGltZUZhY3RvcnkgaXMgbWlzc2luZycpO1xyXG5cclxuICAgIF90aGlzLl9ydW50aW1lVVJMID0gcnVudGltZVVSTDtcclxuICAgIF90aGlzLl9jcnlwdG9NYW5hZ2VyVVJMID0gX3RoaXMuX3J1bnRpbWVVUkwgKyAnL2NyeXB0b01hbmFnZXInO1xyXG5cclxuICAgIC8vX3RoaXMuX215VVJMID0gX3RoaXMuX3J1bnRpbWVVUkwgKyAnL2NyeXB0byc7XHJcbiAgICBfdGhpcy5zdG9yYWdlTWFuYWdlciA9IHN0b3JhZ2VNYW5hZ2VyO1xyXG4gICAgX3RoaXMuZGF0YU9iamVjdHNTdG9yYWdlID0gZGF0YU9iamVjdHNTdG9yYWdlO1xyXG4gICAgX3RoaXMucnVudGltZUNhcGFiaWxpdGllcyA9IHJ1bnRpbWVDYXBhYmlsaXRpZXM7XHJcblxyXG4gICAgX3RoaXMuX3J1bnRpbWVGYWN0b3J5ID0gcnVudGltZUZhY3Rvcnk7XHJcbiAgICBfdGhpcy5fZG9tYWluID0gZGl2aWRlVVJMKF90aGlzLl9ydW50aW1lVVJMKS5kb21haW47XHJcblxyXG4gICAgX3RoaXMuY3J5cHRvID0gbmV3IENyeXB0byhfdGhpcy5fcnVudGltZUZhY3RvcnkpO1xyXG5cclxuICAgIC8vIGhhc2hUYWJsZSB0byBzdG9yZSBhbGwgdGhlIGNyeXB0byBpbmZvcm1hdGlvbiBiZXR3ZWVuIHR3byBoeXBlcnRpZXNcclxuICAgIF90aGlzLmNoYXRLZXlzID0ge307XHJcblxyXG4gICAgLy8gaGFzaFRhYmxlIHRvIHN0b3JlIHRoZSBzeW1tZXRyaWMga2V5cyB0byBiZSB1c2VkIGluIHRoZSBjaGF0IGdyb3VwXHJcbiAgICBfdGhpcy5kYXRhT2JqZWN0U2Vzc2lvbktleXMgPSB7fTtcclxuXHJcbiAgICAvL2ZhaWxzYWZlIHRvIGVuYWJsZS9kaXNhYmxlIGFsbCB0aGUgY3JpcHRvZ3JhcGhpYyBmdW5jdGlvbnNcclxuICAgIF90aGlzLmlzVG9Vc2VFbmNyeXB0aW9uID0gdHJ1ZTtcclxuXHJcbiAgICBfdGhpcy5fcmVnaXN0cnkgPSByZWdpc3RyeTtcclxuICAgIF90aGlzLl9jb3JlRGlzY292ZXJ5ID0gY29yZURpc2NvdmVyeTtcclxuXHJcbiAgICBfdGhpcy5faWRtID0gaWRtO1xyXG5cclxuICB9XHJcblxyXG4gIC8vKioqKioqKioqKioqKioqKioqKiBHRVQgQU5EIFNFVCBNRVRIT0RTICoqKioqKioqKioqKioqKioqKipcclxuXHJcbiAgLyoqXHJcbiAgKiByZXR1cm4gdGhlIG1lc3NhZ2VCdXMgaW4gdGhpcyBSZWdpc3RyeVxyXG4gICogQHBhcmFtIHtNZXNzYWdlQnVzfSAgICAgICAgICAgbWVzc2FnZUJ1c1xyXG4gICovXHJcbiAgZ2V0IG1lc3NhZ2VCdXMoKSB7XHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG4gICAgcmV0dXJuIF90aGlzLl9tZXNzYWdlQnVzO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgKiBTZXQgdGhlIG1lc3NhZ2VCdXMgaW4gdGhpcyBSZWdpc3RyeVxyXG4gICogQHBhcmFtIHtNZXNzYWdlQnVzfSAgICAgICAgICAgbWVzc2FnZUJ1c1xyXG4gICovXHJcbiAgc2V0IG1lc3NhZ2VCdXMobWVzc2FnZUJ1cykge1xyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuICAgIF90aGlzLl9tZXNzYWdlQnVzID0gbWVzc2FnZUJ1cztcclxuXHJcbiAgICBfdGhpcy5hZGRDcnlwdG9HVUlMaXN0ZW5lcnMoKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICogcmV0dXJuIHRoZSBjb3JlRGlzY292ZXJ5IGNvbXBvbmVudFxyXG4gICovXHJcbiAgZ2V0IGNvcmVEaXNjb3ZlcnkoKSB7XHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG4gICAgcmV0dXJuIF90aGlzLl9jb3JlRGlzY292ZXJ5O1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgKiByZXR1cm4gdXNlcidzIHB1YmxpYyBrZXlcclxuICAqL1xyXG5cclxuICAvKiAgZ2V0TXlQdWJsaWNLZXkoKSB7XHJcbiAgICAvLyB0byBiZSBpbXBsZW1lbnRlZFxyXG5cclxuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSk9PiB7XHJcbiAgICAgIHJlc29sdmUoJ215cHVibGlja2V5Jyk7XHJcblxyXG4gICAgfSk7XHJcbiAgfVxyXG4qL1xyXG4gIC8qKlxyXG4gICogU2V0IHRoZSBjb3JlRGlzY292ZXJ5IGNvbXBvbmVudFxyXG4gICogQHBhcmFtIHtjb3JlRGlzY292ZXJ5fSBjb3JlRGlzY292ZXJ5XHJcbiAgKi9cclxuICBzZXQgY29yZURpc2NvdmVyeShjb3JlRGlzY292ZXJ5KSB7XHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG4gICAgX3RoaXMuX2NvcmVEaXNjb3ZlcnkgPSBjb3JlRGlzY292ZXJ5O1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgKiByZXR1cm4gdGhlIHJlZ2lzdHJ5IGluIHRoaXMgaWRNb2R1bGVcclxuICAqIEBwYXJhbSB7cmVnaXN0cnl9ICAgICAgICAgICByZWdpc3RyeVxyXG4gICovXHJcbiAgZ2V0IHJlZ2lzdHJ5KCkge1xyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuICAgIHJldHVybiBfdGhpcy5fcmVnaXN0cnk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAqIFNldCB0aGUgcmVnaXN0cnkgaW4gdGhpcyBpZE1vZHVsZVxyXG4gICogQHBhcmFtIHtyZWdpc3RyeX0gICAgIHJlZ1xyXG4gICovXHJcbiAgc2V0IHJlZ2lzdHJ5KHJlZ2lzdHJ5KSB7XHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG4gICAgX3RoaXMuX3JlZ2lzdHJ5ID0gcmVnaXN0cnk7XHJcbiAgfVxyXG5cclxuXHJcbiAgLy8gdG8gYmUgdXNlZCB0byBpbml0aWFsaXNlIElETSB3aXRoIFNlc3Npb25LZXlzIHVzZWQgaW4gcHJldmlvdXMgc2Vzc2lvblxyXG5cclxuICBsb2FkU2Vzc2lvbktleXMoKSB7XHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7XHJcblxyXG4gICAgICBfdGhpcy5zdG9yYWdlTWFuYWdlci5nZXQoJ2RhdGFPYmplY3RTZXNzaW9uS2V5cycpLnRoZW4oKHNlc3Npb25LZXlzKSA9PiB7XHJcbiAgICAgICAgaWYgKHNlc3Npb25LZXlzKSBfdGhpcy5kYXRhT2JqZWN0U2Vzc2lvbktleXMgPSBzZXNzaW9uS2V5cztcclxuICAgICAgICBlbHNlIF90aGlzLmRhdGFPYmplY3RTZXNzaW9uS2V5cyA9IHt9O1xyXG4gICAgICAgIHJlc29sdmUoKTtcclxuICAgICAgfSk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIF9pc0Zyb21SZW1vdGVTTShmcm9tKSB7XHJcbiAgICBsZXQgc3BsaXRGcm9tID0gZnJvbS5zcGxpdCgnOi8vJyk7XHJcbiAgICByZXR1cm4gc3BsaXRGcm9tWzBdID09PSAncnVudGltZScgJiYgZnJvbSAhPT0gdGhpcy5fcnVudGltZVVSTCArICcvc20nO1xyXG4gIH1cclxuXHJcbiAgYWRkQ3J5cHRvR1VJTGlzdGVuZXJzKCkge1xyXG4gICAgLy9UT0RPOiBDaGFuZ2UgdGhlIEdVSSBpbnZvY2F0aW9uIG9mIHRoaXMgbWV0aG9kXHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG5cclxuICAgIF90aGlzLl9tZXNzYWdlQnVzLmFkZExpc3RlbmVyKF90aGlzLl9jcnlwdG9NYW5hZ2VyVVJMLCAobXNnKSA9PiB7XHJcbiAgICAgIGxldCBmdW5jTmFtZSA9IG1zZy5ib2R5Lm1ldGhvZDtcclxuXHJcbiAgICAgIC8vbGV0IHJldHVybmVkVmFsdWU7XHJcbiAgICAgIGlmIChmdW5jTmFtZSA9PT0gJ2dlbmVyYXRlUlNBS2V5UGFpcicpIHtcclxuICAgICAgICBfdGhpcy5fY3J5cHRvLmdldE15UHVibGljS2V5KCkudGhlbigoa2V5KSA9PiB7XHJcbiAgICAgICAgICBsZXQgdmFsdWUgPSB7dHlwZTogJ2V4ZWN1dGUnLCB2YWx1ZToga2V5LCBjb2RlOiAyMDB9O1xyXG4gICAgICAgICAgbGV0IHJlcGx5TXNnID0ge2lkOiBtc2cuaWQsIHR5cGU6ICdyZXNwb25zZScsIHRvOiBtc2cuZnJvbSwgZnJvbTogbXNnLnRvLCBib2R5OiB2YWx1ZX07XHJcbiAgICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICBfdGhpcy5fbWVzc2FnZUJ1cy5wb3N0TWVzc2FnZShyZXBseU1zZyk7XHJcbiAgICAgICAgICB9IGNhdGNoIChlcnIpIHtcclxuICAgICAgICAgICAgbG9nLmVycm9yKCdPbiBhZGRHVUlMaXN0ZW5lcnMgZnJvbSBpZiBnZW5lcmF0ZVJTQUtleVBhaXIgbWV0aG9kIHBvc3RNZXNzYWdlIGVycm9yOiAnICsgZXJyKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgICByZXR1cm47XHJcbiAgICAgIH1cclxuXHJcbiAgICB9KTtcclxuICB9XHJcblxyXG5cclxuICAvLyoqKioqKioqKioqKioqKioqKiogRU5DUllQVElPTiBNRVRIT0RTICoqKioqKioqKioqKioqKioqKipcclxuICAvKipcclxuKiBJZGVudGlmaWVzIHRoZSBtZXNzYWdlcyB0byBiZSBlbmNyeXB0ZWRcclxuKiBAcGFyYW0ge01lc3NhZ2V9ICAgIG1lc3NhZ2VcclxuKiBAcmV0dXJucyB7Ym9vbGVhbn0gIHJldHVybnMgdHJ1ZSBpZiB0aGUgbWVzc2FnZSByZXF1aXJlcyBlbmNyeXB0aW9uXHJcbiovXHJcblxyXG4gIF9pc1RvRW5jcnlwdChtZXNzYWdlKSB7XHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG4gICAgbG9nLmxvZygnW0NyeXB0b01hbmFnZXIuX2lzVG9FbmNyeXB0XScsIG1lc3NhZ2UpO1xyXG4gICAgbGV0IGlzQ3JlYXRlID0gbWVzc2FnZS50eXBlID09PSAnY3JlYXRlJztcclxuICAgIGxldCBpc0Zyb21IeXBlcnR5ID0gbWVzc2FnZS5mcm9tLmluY2x1ZGVzKCdoeXBlcnR5Oi8vJyk7XHJcbiAgICBsZXQgaXNUb0h5cGVydHkgPSBtZXNzYWdlLnRvLmluY2x1ZGVzKCdoeXBlcnR5Oi8vJyk7XHJcbiAgICBsZXQgaXNUb0RhdGFPYmplY3QgPSBpc0RhdGFPYmplY3RVUkwobWVzc2FnZS50byk7XHJcbiAgICBsZXQgcmVwb3J0ZXIgPSBfdGhpcy5yZWdpc3RyeS5nZXREYXRhT2JqZWN0UmVwb3J0ZXIobWVzc2FnZS50byk7XHJcblxyXG4gICAgbGV0IGRvTXV0dWFsQXV0aGVudGljYXRpb24gPSBtZXNzYWdlLmhhc093blByb3BlcnR5KCdib2R5JykgJiYgbWVzc2FnZS5ib2R5Lmhhc093blByb3BlcnR5KCdtdXR1YWwnKSA/IG1lc3NhZ2UuYm9keS5tdXR1YWxcclxuICAgIDogIG1lc3NhZ2UuaGFzT3duUHJvcGVydHkoJ2JvZHknKSAmJiBtZXNzYWdlLmJvZHkuaGFzT3duUHJvcGVydHkoJ3ZhbHVlJykgJiYgbWVzc2FnZS5ib2R5LnZhbHVlLmhhc093blByb3BlcnR5KCdtdXR1YWwnKSA/IG1lc3NhZ2UuYm9keS52YWx1ZS5tdXR1YWwgIDogdHJ1ZTtcclxuXHJcbiAgICBpZiAoIWRvTXV0dWFsQXV0aGVudGljYXRpb24pIHJldHVybiBmYWxzZTtcclxuICAgIGlmIChyZXBvcnRlciAhPT0gbnVsbCAmJiBpc0xlZ2FjeShyZXBvcnRlcikpIHtcclxuICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG5cclxuICAgIC8vaWYgaXMgbm90IHRvIGFwcGx5IGVuY3J5cHRpb24sIHRoZW4gcmV0dXJucyByZXNvbHZlXHJcbiAgICBpZiAoIXRoaXMuaXNUb1VzZUVuY3J5cHRpb24gJiYgIShtZXNzYWdlLnR5cGUgPT09ICdoYW5kc2hha2UnKSkge1xyXG4gICAgICBsb2cuaW5mbygnbm90IGhhbmRzaGFrZTogZW5jcnlwdGlvbiBkaXNhYmxlZCcpO1xyXG4gICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKG1lc3NhZ2UudHlwZSA9PT0gJ3VwZGF0ZScpIHtcclxuICAgICAgbG9nLmluZm8oJ3VwZGF0ZTplbmNyeXB0aW9uIGRpc2FibGVkJyk7XHJcbiAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAobWVzc2FnZS50eXBlID09PSAnZm9yd2FyZCcpIHtcclxuICAgICAgbG9nLmluZm8oJ2ZvcndhcmQ6ZW5jcnlwdGlvbiBkaXNhYmxlZCcpO1xyXG4gICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKGlzTGVnYWN5KG1lc3NhZ2UudG8pKSByZXR1cm4gZmFsc2U7XHJcblxyXG4gICAgcmV0dXJuICgoaXNDcmVhdGUgJiYgaXNGcm9tSHlwZXJ0eSAmJiBpc1RvSHlwZXJ0eSkgfHwgKGlzQ3JlYXRlICYmIGlzRnJvbUh5cGVydHkgJiYgaXNUb0RhdGFPYmplY3QgJiYgZG9NdXR1YWxBdXRoZW50aWNhdGlvbikgfHwgbWVzc2FnZS50eXBlID09PSAnaGFuZHNoYWtlJyB8fCAobWVzc2FnZS50eXBlID09PSAndXBkYXRlJyAmJiBkb011dHVhbEF1dGhlbnRpY2F0aW9uKSk7XHJcbiAgfVxyXG5cclxuXHJcbiAgX2lzVG9EZWNyeXB0KG1lc3NhZ2UpIHtcclxuICAgIGxldCBfdGhpcyA9IHRoaXM7XHJcblxyXG5cclxuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XHJcbiAgICAgIC8vIEZvciBzeWJzY3JpYmUgbWVzc2FnZSBsZXQncyBzdGFydCB0aGUgbXV0dWFsQXV0aGVudGljYXRpb25cclxuICAgICAgbGV0IGlzU3Vic2NyaXB0aW9uID0gbWVzc2FnZS50eXBlID09PSAnc3Vic2NyaWJlJztcclxuICAgICAgbGV0IGlzRnJvbVJlbW90ZVNNID0gX3RoaXMuX2lzRnJvbVJlbW90ZVNNKG1lc3NhZ2UuZnJvbSk7XHJcbiAgICAgIGxldCBtdXR1YWwgPSBtZXNzYWdlLmJvZHkuaGFzT3duUHJvcGVydHkoJ3ZhbHVlJykgJiYgbWVzc2FnZS5ib2R5LnZhbHVlLmhhc093blByb3BlcnR5KCdtdXR1YWwnKSA/IG1lc3NhZ2UuYm9keS52YWx1ZS5tdXR1YWwgOiBcclxuICAgICAgbWVzc2FnZS5ib2R5Lmhhc093blByb3BlcnR5KCdtdXR1YWwnKSA/IG1lc3NhZ2UuYm9keS5tdXR1YWwgOiB0cnVlO1xyXG4gICAgICAvLyAgICAgIGxldCBtdXR1YWwgPSBtZXNzYWdlLmJvZHkuaGFzT3duUHJvcGVydHkoJ211dHVhbCcpID8gbWVzc2FnZS5ib2R5Lm11dHVhbCA6IGZhbHNlO1xyXG5cclxuaWYgKGlzU3Vic2NyaXB0aW9uICYmIGlzRnJvbVJlbW90ZVNNICYmIG11dHVhbCkge1xyXG4vLyAgaWYgKGlzU3Vic2NyaXB0aW9uICYmIGlzRnJvbVJlbW90ZVNNICkge1xyXG4gICAgbG9nLmxvZygnW0NyeXB0b01hbmFnZXIuX2lzVG9EZWNyeXB0XSBfZG9NdXR1YWxBdXRoZW50aWNhdGlvblBoYXNlMScpO1xyXG4gICAgICAgIGNvbnNvbGUubG9nKCdbQ3J5cHRvTWFuYWdlci5faXNUb0RlY3J5cHRdICcsIG1lc3NhZ2UpO1xyXG4gICAgICAgIGxldCByZXBvcnRlciA9IF90aGlzLnJlZ2lzdHJ5LmdldERhdGFPYmplY3RSZXBvcnRlcihtZXNzYWdlLnRvKTtcclxuICAgICAgICBpZiAocmVwb3J0ZXIgIT09IG51bGwgJiYgaXNMZWdhY3kocmVwb3J0ZXIpKSB7XHJcbiAgICAgICAgICByZXR1cm4gcmVzb2x2ZShmYWxzZSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBfdGhpcy5fZG9NdXR1YWxBdXRoZW50aWNhdGlvblBoYXNlMShtZXNzYWdlKS50aGVuKCgpID0+IHtcclxuICAgICAgICAgIHJlc29sdmUoZmFsc2UpO1xyXG4gICAgICAgIH0sIChlcnJvcikgPT4ge1xyXG4gICAgICAgICAgcmVqZWN0KGVycm9yKTtcclxuICAgICAgICB9KTtcclxuXHJcbi8vICAgICAgfSBlbHNlIGlmIChtZXNzYWdlLmhhc093blByb3BlcnR5KCdib2R5JykgJiYgbWVzc2FnZS5ib2R5Lmhhc093blByb3BlcnR5KCd2YWx1ZScpICYmIHR5cGVvZiBtZXNzYWdlLmJvZHkudmFsdWUgPT09ICdzdHJpbmcnKSB7XHJcbiAgICAgIH0gZWxzZSBpZiAobWVzc2FnZS5oYXNPd25Qcm9wZXJ0eSgnYm9keScpICYmIG1lc3NhZ2UuYm9keS5oYXNPd25Qcm9wZXJ0eSgndmFsdWUnKSAmJiB0eXBlb2YgbWVzc2FnZS5ib2R5LnZhbHVlID09PSAnc3RyaW5nJyAmJiBtdXR1YWwpIHtcclxuICAgICAgICBsb2cubG9nKCdbQ3J5cHRvTWFuYWdlci5faXNUb0RlY3J5cHRdIHRydWUnKTtcclxuICAgICAgICByZXNvbHZlKHRydWUpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGxvZy5sb2coJ1tDcnlwdG9NYW5hZ2VyLl9pc1RvRGVjcnlwdF0gZmFsc2UnKTtcclxuICAgICAgICByZXNvbHZlKGZhbHNlKTtcclxuICAgICAgfVxyXG5cclxuICAgIH0pLmNhdGNoKChlcnJvcikgPT4ge1xyXG4gICAgICBsb2cuZXJyb3IoJ1tDcnlwdG9NYW5hZ2VyLl9pc1RvRGVjcnlwdF0nLCBlcnJvcik7XHJcbiAgICB9KTtcclxuXHJcbiAgfVxyXG5cclxuICBlbmNyeXB0TWVzc2FnZShtZXNzYWdlKSB7XHJcbiAgICAvL2xvZy5pbmZvKCdlbmNyeXB0TWVzc2FnZTptZXNzYWdlJywgbWVzc2FnZSk7XHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG5cclxuICAgIGxvZy5sb2coJ2VuY3J5cHQgbWVzc2FnZSAnKTtcclxuXHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcblxyXG4gICAgICBsZXQgaXNIYW5kU2hha2VUeXBlID0gbWVzc2FnZS50eXBlID09PSAnaGFuZHNoYWtlJztcclxuXHJcbiAgICAgIC8vaWYgaXMgbm90IHRvIGFwcGx5IGVuY3J5cHRpb24sIHRoZW4gcmV0dXJucyByZXNvbHZlXHJcbiAgICAgIGlmICghX3RoaXMuX2lzVG9FbmNyeXB0KG1lc3NhZ2UpKSB7XHJcbiAgICAgICAgLy8gbG9nLmxvZygnZGVjcnlwdGlvbiBkaXNhYmxlZCcpO1xyXG4gICAgICAgIHJldHVybiByZXNvbHZlKG1lc3NhZ2UpO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBsZXQgZGF0YU9iamVjdFVSTCA9IHBhcnNlTWVzc2FnZVVSTChtZXNzYWdlLnRvKTtcclxuXHJcbiAgICAgIGxldCBpc1RvRGF0YU9iamVjdCA9IGlzRGF0YU9iamVjdFVSTChkYXRhT2JqZWN0VVJMKTtcclxuICAgICAgbGV0IGlzVG9MZWdhY3lJZGVudGl0eSA9IGlzTGVnYWN5KG1lc3NhZ2UudG8pO1xyXG4gICAgICBsZXQgaXNGcm9tSHlwZXJ0eSA9IGRpdmlkZVVSTChtZXNzYWdlLmZyb20pLnR5cGUgPT09ICdoeXBlcnR5JztcclxuICAgICAgbGV0IGlzVG9IeXBlcnR5ID0gZGl2aWRlVVJMKG1lc3NhZ2UudG8pLnR5cGUgPT09ICdoeXBlcnR5JztcclxuXHJcbiAgICAgIGlmIChtZXNzYWdlLnR5cGUgPT09ICd1cGRhdGUnKSB7XHJcbiAgICAgICAgbG9nLmxvZygnZW5jcnlwdCBtZXNzYWdlOiBtZXNzYWdlIHR5cGUgdXBkYXRlJyk7XHJcbiAgICAgICAgcmV0dXJuIHJlc29sdmUobWVzc2FnZSk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGlmIChpc1RvTGVnYWN5SWRlbnRpdHkpIHtcclxuICAgICAgICByZXNvbHZlKG1lc3NhZ2UpO1xyXG4gICAgICB9IGVsc2UgaWYgKGlzRnJvbUh5cGVydHkgJiYgaXNUb0h5cGVydHkpIHtcclxuICAgICAgICBsZXQgdXNlclVSTCA9IF90aGlzLl9yZWdpc3RyeS5nZXRIeXBlcnR5T3duZXIobWVzc2FnZS5mcm9tKTtcclxuICAgICAgICBpZiAodXNlclVSTCkge1xyXG5cclxuICAgICAgICAgIC8vIGNoZWNrIGlmIGV4aXN0cyBhbnkga2V5cyBiZXR3ZWVuIHR3byB1c2Vyc1xyXG4gICAgICAgICAgbGV0IGNoYXRLZXlzID0gX3RoaXMuY2hhdEtleXNbbWVzc2FnZS5mcm9tICsgJzwtPicgKyBtZXNzYWdlLnRvXTtcclxuICAgICAgICAgIGlmICghY2hhdEtleXMpIHtcclxuICAgICAgICAgICAgY2hhdEtleXMgPSBfdGhpcy5fbmV3Q2hhdENyeXB0byhtZXNzYWdlLCB1c2VyVVJMKTtcclxuXHJcbiAgICAgICAgICAgIC8vbG9nLmxvZygnY3JlYXRlQ2hhdEtleSBlbmNyeXB0JywgbWVzc2FnZS5mcm9tICsgbWVzc2FnZS50byk7XHJcbiAgICAgICAgICAgIF90aGlzLmNoYXRLZXlzW21lc3NhZ2UuZnJvbSArICc8LT4nICsgbWVzc2FnZS50b10gPSBjaGF0S2V5cztcclxuICAgICAgICAgICAgbWVzc2FnZS5ib2R5LmhhbmRzaGFrZVBoYXNlID0gJ3N0YXJ0SGFuZFNoYWtlJztcclxuICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICBpZiAoY2hhdEtleXMuYXV0aGVudGljYXRlZCAmJiAhaXNIYW5kU2hha2VUeXBlKSB7XHJcblxyXG4gICAgICAgICAgICBsZXQgaXYgPSBfdGhpcy5jcnlwdG8uZ2VuZXJhdGVJVigpO1xyXG4gICAgICAgICAgICBfdGhpcy5jcnlwdG8uZW5jcnlwdEFFUyhjaGF0S2V5cy5rZXlzLmh5cGVydHlGcm9tU2Vzc2lvbktleSwgc3RyaW5naWZ5KG1lc3NhZ2UuYm9keS52YWx1ZSksIGl2KS50aGVuKGVuY3J5cHRlZFZhbHVlID0+IHtcclxuXHJcbiAgICAgICAgICAgICAgbGV0IGZpbHRlcmVkTWVzc2FnZSA9IF90aGlzLl9maWx0ZXJNZXNzYWdlVG9IYXNoKG1lc3NhZ2UsIHN0cmluZ2lmeShtZXNzYWdlLmJvZHkudmFsdWUpICtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RyaW5naWZ5KGl2KSwgY2hhdEtleXMuaHlwZXJ0eUZyb20ubWVzc2FnZUluZm8pO1xyXG5cclxuICAgICAgICAgICAgICBfdGhpcy5jcnlwdG8uaGFzaEhNQUMoY2hhdEtleXMua2V5cy5oeXBlcnR5RnJvbUhhc2hLZXksIGZpbHRlcmVkTWVzc2FnZSkudGhlbihoYXNoID0+IHtcclxuICAgICAgICAgICAgICAgIC8vbG9nLmxvZygncmVzdWx0IG9mIGhhc2ggJywgaGFzaCk7XHJcbiAgICAgICAgICAgICAgICBsZXQgdmFsdWUgPSB7aXY6IGVuY29kZShpdiksIHZhbHVlOiBlbmNvZGUoZW5jcnlwdGVkVmFsdWUpLCBoYXNoOiBlbmNvZGUoaGFzaCl9O1xyXG4gICAgICAgICAgICAgICAgbWVzc2FnZS5ib2R5LnZhbHVlID0gZW5jb2RlKHZhbHVlKTtcclxuXHJcbiAgICAgICAgICAgICAgICByZXNvbHZlKG1lc3NhZ2UpO1xyXG4gICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIC8vIGlmIGlzIGEgaGFuZHNoYWtlIG1lc3NhZ2UsIGp1c3QgcmVzb2x2ZSBpdFxyXG4gICAgICAgICAgfSBlbHNlIGlmIChpc0hhbmRTaGFrZVR5cGUpIHtcclxuICAgICAgICAgICAgcmVzb2x2ZShtZXNzYWdlKTtcclxuXHJcbiAgICAgICAgICAgIC8vIGVsc2UsIHN0YXJ0cyBhIG5ldyBoYW5kc2hha2UgcHJvdG9jb2xcclxuICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIF90aGlzLl9kb0hhbmRTaGFrZVBoYXNlKG1lc3NhZ2UsIGNoYXRLZXlzKS50aGVuKGZ1bmN0aW9uKHZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgX3RoaXMuY2hhdEtleXNbbWVzc2FnZS5mcm9tICsgJzwtPicgKyBtZXNzYWdlLnRvXSA9IHZhbHVlLmNoYXRLZXlzO1xyXG5cclxuICAgICAgICAgICAgICBfdGhpcy5fbWVzc2FnZUJ1cy5wb3N0TWVzc2FnZSh2YWx1ZS5tZXNzYWdlKTtcclxuICAgICAgICAgICAgICByZWplY3QoJ2VuY3J5cHQgaGFuZHNoYWtlIHByb3RvY29sIHBoYXNlICcpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgcmVqZWN0KCdJbiBlbmNyeXB0TWVzc2FnZTogSHlwZXJ0eSBvd25lciBVUkwgd2FzIG5vdCBmb3VuZCcpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgIC8vaWYgZnJvbSBoeXBlcnR5IHRvIGEgZGF0YU9iamVjdFVSTFxyXG4gICAgICB9IGVsc2UgaWYgKGlzRnJvbUh5cGVydHkgJiYgaXNUb0RhdGFPYmplY3QpIHtcclxuXHJcbiAgICAgICAgLy9sb2cubG9nKCdkYXRhT2JqZWN0IHZhbHVlIHRvIGVuY3J5cHQ6ICcsIG1lc3NhZ2UuYm9keS52YWx1ZSk7XHJcbiAgICAgICAgLy9sb2cubG9nKCdJZGVudGl0eU1vZHVsZSAtIGVuY3J5cHQgZnJvbSBoeXBlcnR5IHRvIGRhdGFvYmplY3QgJywgbWVzc2FnZSk7XHJcblxyXG4gICAgICAgIF90aGlzLnN0b3JhZ2VNYW5hZ2VyLmdldCgnZGF0YU9iamVjdFNlc3Npb25LZXlzJykudGhlbigoc2Vzc2lvbktleXMpID0+IHtcclxuICAgICAgICAgIHNlc3Npb25LZXlzID0gY2hhdGtleXNUb0FycmF5Q2xvbmVyKHNlc3Npb25LZXlzIHx8IHt9KTtcclxuICAgICAgICAgIGxldCBkYXRhT2JqZWN0S2V5ID0gc2Vzc2lvbktleXMgPyBzZXNzaW9uS2V5c1tkYXRhT2JqZWN0VVJMXSA6IG51bGw7XHJcblxyXG4gICAgICAgICAgX3RoaXMuZGF0YU9iamVjdHNTdG9yYWdlLmdldERhdGFPYmplY3QoZGF0YU9iamVjdFVSTCkudGhlbigoaXNIeXBlcnR5UmVwb3J0ZXIpID0+IHtcclxuICAgICAgICAgICAgLy9pZiBubyBrZXkgZXhpc3RzLCBjcmVhdGUgYSBuZXcgb25lIGlmIGlzIHRoZSByZXBvcnRlciBvZiBkYXRhT2JqZWN0XHJcbiAgICAgICAgICAgIGlmICghZGF0YU9iamVjdEtleSkge1xyXG4gICAgICAgICAgICAgIC8vIGlmIHRoZSBoeXBlcnR5IGlzIHRoZSByZXBvcnRlciBvZiB0aGUgZGF0YU9iamVjdCB0aGVuIGdlbmVyYXRlcyBhIHNlc3Npb24ga2V5XHJcbiAgICAgICAgICAgICAgaWYgKGlzSHlwZXJ0eVJlcG9ydGVyLnJlcG9ydGVyICYmIGlzSHlwZXJ0eVJlcG9ydGVyLnJlcG9ydGVyID09PSBtZXNzYWdlLmZyb20pIHtcclxuXHJcbiAgICAgICAgICAgICAgICBsZXQgc2Vzc2lvbktleSA9IF90aGlzLmNyeXB0by5nZW5lcmF0ZVJhbmRvbSgpO1xyXG4gICAgICAgICAgICAgICAgX3RoaXMuZGF0YU9iamVjdFNlc3Npb25LZXlzW2RhdGFPYmplY3RVUkxdID0ge3Nlc3Npb25LZXk6IHNlc3Npb25LZXksIGlzVG9FbmNyeXB0OiB0cnVlfTtcclxuICAgICAgICAgICAgICAgIGxldCBkYXRhT2JqZWN0U2Vzc2lvbktleXNDbG9uZSA9IGNoYXRrZXlzVG9TdHJpbmdDbG9uZXIoX3RoaXMuZGF0YU9iamVjdFNlc3Npb25LZXlzKTtcclxuXHJcbiAgICAgICAgICAgICAgICAvL1RPRE86IGNoZWNrIGlmIHRoaXMgZG9lcyBub3QgbmVlZCB0byBiZSBzdG9yZWRcclxuICAgICAgICAgICAgICAgIF90aGlzLnN0b3JhZ2VNYW5hZ2VyLnNldCgnZGF0YU9iamVjdFNlc3Npb25LZXlzJywgMCwgZGF0YU9iamVjdFNlc3Npb25LZXlzQ2xvbmUpLmNhdGNoKGVyciA9PiB7XHJcbiAgICAgICAgICAgICAgICAgIHJlamVjdCgnT24gZW5jcnlwdE1lc3NhZ2UgZnJvbSBtZXRob2Qgc3RvcmFnZU1hbmFnZXIuc2V0IGVycm9yOiAnICsgZXJyKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgZGF0YU9iamVjdEtleSA9IF90aGlzLmRhdGFPYmplY3RTZXNzaW9uS2V5c1tkYXRhT2JqZWN0VVJMXTtcclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vY2hlY2sgaWYgdGhlcmUgaXMgYWxyZWFkeSBhIHNlc3Npb24ga2V5IGZvciB0aGUgY2hhdCByb29tXHJcbiAgICAgICAgICAgIGlmIChkYXRhT2JqZWN0S2V5KSB7XHJcblxyXG4gICAgICAgICAgICAgIC8vIGFuZCBpZiBpcyB0byBhcHBseSBlbmNyeXB0aW9uLCBlbmNyeXB0IHRoZSBtZXNzYWdlc1xyXG4gICAgICAgICAgICAgIGlmIChkYXRhT2JqZWN0S2V5LmlzVG9FbmNyeXB0KSB7XHJcbiAgICAgICAgICAgICAgICBsZXQgaXYgPSBfdGhpcy5jcnlwdG8uZ2VuZXJhdGVJVigpO1xyXG4gICAgICAgICAgICAgICAgbGV0IHN0cmluZ2lmaWVkSVYgPSBzdHJpbmdpZnkoaXYpO1xyXG4gICAgICAgICAgICAgICAgbGV0IHN0cmluZ2lmaWVkTWVzc2FnZUJvZHkgPSBzdHJpbmdpZnkobWVzc2FnZS5ib2R5LnZhbHVlKTtcclxuXHJcbiAgICAgICAgICAgICAgICBfdGhpcy5jcnlwdG8uZW5jcnlwdEFFUyhkYXRhT2JqZWN0S2V5LnNlc3Npb25LZXksIHN0cmluZ2lmaWVkTWVzc2FnZUJvZHksIGl2KS50aGVuKGVuY3J5cHRlZFZhbHVlID0+IHtcclxuICAgICAgICAgICAgICAgICAgZGVsZXRlIG1lc3NhZ2UuYm9keS5pZGVudGl0eS5hc3NlcnRpb247IC8vVE9ETzogQ2hlY2sgd2h5IGFzc2VydGlvbiBpcyBjb21taW5nIG9uIHRoZSBtZXNzYWdlIVxyXG4gICAgICAgICAgICAgICAgICBkZWxldGUgbWVzc2FnZS5ib2R5LmlkZW50aXR5LmV4cGlyZXM7IC8vVE9ETzogQ2hlY2sgd2h5IGV4cGlyZXMgaXMgY29tbWluZyBvbiB0aGUgbWVzc2FnZSFcclxuICAgICAgICAgICAgICAgICAgbGV0IGZpbHRlcmVkTWVzc2FnZSA9IF90aGlzLl9maWx0ZXJNZXNzYWdlVG9IYXNoKG1lc3NhZ2UsIHN0cmluZ2lmaWVkTWVzc2FnZUJvZHkgKyBzdHJpbmdpZmllZElWKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgIF90aGlzLmNyeXB0by5oYXNoSE1BQyhkYXRhT2JqZWN0S2V5LnNlc3Npb25LZXksIGZpbHRlcmVkTWVzc2FnZSkudGhlbihoYXNoID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAvLyBsb2cubG9nKCdoYXNoICcsIGhhc2gpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBsZXQgbmV3VmFsdWUgPSB7dmFsdWU6IGVuY29kZShlbmNyeXB0ZWRWYWx1ZSksIGl2OiBlbmNvZGUoaXYpLCBoYXNoOiBlbmNvZGUoaGFzaCl9O1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBtZXNzYWdlLmJvZHkudmFsdWUgPSBzdHJpbmdpZnkobmV3VmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgICAgIHJlc29sdmUobWVzc2FnZSk7XHJcbiAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgIC8vIGlmIG5vdCwganVzdCBzZW5kIHRoZSBtZXNzYWdlXHJcbiAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHJlc29sdmUobWVzc2FnZSk7XHJcbiAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAvLyBzdGFydCB0aGUgZ2VuZXJhdGlvbiBvZiBhIG5ldyBzZXNzaW9uIEtleVxyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgIHJlamVjdCgnRGF0YSBvYmplY3Qga2V5IGNvdWxkIG5vdCBiZSBkZWZpbmVkOiBGYWlsZWQgdG8gZGVjcnlwdCBtZXNzYWdlICcpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9KS5jYXRjaChlcnIgPT4geyByZWplY3QoJ09uIGVuY3J5cHRNZXNzYWdlIGZyb20gbWV0aG9kIGRhdGFPYmplY3RzU3RvcmFnZS5nZXREYXRhT2JqZWN0IGVycm9yOiAnICsgZXJyKTsgfSk7XHJcbiAgICAgICAgfSkuY2F0Y2goZXJyID0+IHsgcmVqZWN0KCdPbiBlbmNyeXB0TWVzc2FnZSBmcm9tIG1ldGhvZCBzdG9yYWdlTWFuYWdlci5nZXQgZXJyb3I6ICcgKyBlcnIpOyB9KTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBlbmNyeXB0RGF0YU9iamVjdChkYXRhT2JqZWN0LCBzZW5kZXIpIHtcclxuICAgIGxldCBfdGhpcyA9IHRoaXM7XHJcblxyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICBsb2cuaW5mbygnZGF0YU9iamVjdCB2YWx1ZSB0byBlbmNyeXB0OiAnLCBkYXRhT2JqZWN0KTtcclxuXHJcbiAgICAgIGxldCBkYXRhT2JqZWN0VVJMID0gcGFyc2VNZXNzYWdlVVJMKHNlbmRlcik7XHJcblxyXG4gICAgICBfdGhpcy5zdG9yYWdlTWFuYWdlci5nZXQoJ2RhdGFPYmplY3RTZXNzaW9uS2V5cycpLnRoZW4oKHNlc3Npb25LZXlzKSA9PiB7XHJcbiAgICAgICAgc2Vzc2lvbktleXMgPSBjaGF0a2V5c1RvQXJyYXlDbG9uZXIoc2Vzc2lvbktleXMgfHwge30pO1xyXG4gICAgICAgIGxldCBkYXRhT2JqZWN0S2V5ID0gc2Vzc2lvbktleXMgPyBzZXNzaW9uS2V5c1tkYXRhT2JqZWN0VVJMXSA6IG51bGw7XHJcblxyXG4gICAgICAgIC8vY2hlY2sgaWYgdGhlcmUgaXMgYWxyZWFkeSBhIHNlc3Npb24ga2V5IGZvciB0aGUgY2hhdCByb29tXHJcbiAgICAgICAgaWYgKGRhdGFPYmplY3RLZXkpIHtcclxuXHJcbiAgICAgICAgICAvLyBhbmQgaWYgaXMgdG8gYXBwbHkgZW5jcnlwdGlvbiwgZW5jcnlwdCB0aGUgbWVzc2FnZXNcclxuICAgICAgICAgIGlmIChkYXRhT2JqZWN0S2V5LmlzVG9FbmNyeXB0KSB7XHJcbiAgICAgICAgICAgIGxldCBpdiA9IF90aGlzLmNyeXB0by5nZW5lcmF0ZUlWKCk7XHJcblxyXG4gICAgICAgICAgICBfdGhpcy5jcnlwdG8uZW5jcnlwdEFFUyhkYXRhT2JqZWN0S2V5LnNlc3Npb25LZXksIHN0cmluZ2lmeShkYXRhT2JqZWN0KSwgaXYpLnRoZW4oZW5jcnlwdGVkVmFsdWUgPT4ge1xyXG4gICAgICAgICAgICAgIGxldCBuZXdWYWx1ZSA9IHsgdmFsdWU6IGVuY29kZShlbmNyeXB0ZWRWYWx1ZSksIGl2OiBlbmNvZGUoaXYpIH07XHJcblxyXG4gICAgICAgICAgICAgIC8vbG9nLmxvZygnZW5jcnlwdGVkIGRhdGFPYmplY3QnLCBuZXdWYWx1ZSk7XHJcbiAgICAgICAgICAgICAgcmV0dXJuIHJlc29sdmUobmV3VmFsdWUpO1xyXG4gICAgICAgICAgICB9KS5jYXRjaChlcnIgPT4geyByZWplY3QoJ09uIGVuY3J5cHREYXRhT2JqZWN0IGZyb20gbWV0aG9kIGVuY3J5cHRBRVMgZXJyb3I6ICcgKyBlcnIpOyB9KTtcclxuXHJcbiAgICAgICAgICAvLyBpZiBub3QsIGp1c3Qgc2VuZCB0aGUgbWVzc2FnZVxyXG4gICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgbG9nLmluZm8oJ1RoZSBkYXRhT2JqZWN0IGlzIG5vdCBlbmNyeXB0ZWQnKTtcclxuICAgICAgICAgICAgcmV0dXJuIHJlc29sdmUoZGF0YU9iamVjdCk7XHJcbiAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgLy8gc3RhcnQgdGhlIGdlbmVyYXRpb24gb2YgYSBuZXcgc2Vzc2lvbiBLZXlcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgcmV0dXJuIHJlamVjdCgnTm8gZGF0YU9iamVjdEtleSBmb3IgdGhpcyBkYXRhT2JqZWN0VVJMOicsIGRhdGFPYmplY3RVUkwpO1xyXG4gICAgICAgIH1cclxuICAgICAgfSkuY2F0Y2goZXJyID0+IHsgcmVqZWN0KCdPbiBlbmNyeXB0RGF0YU9iamVjdCBmcm9tIG1ldGhvZCBzdG9yYWdlTWFuYWdlci5nZXQgZXJyb3I6ICcgKyBlcnIpOyB9KTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgZGVjcnlwdE1lc3NhZ2UobWVzc2FnZSkge1xyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuXHJcbiAgICAvLyAgbG9nLmxvZygnZGVjcnlwdE1lc3NhZ2U6bWVzc2FnZScsIG1lc3NhZ2UpO1xyXG5cclxuICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgbGV0IGlzSGFuZFNoYWtlVHlwZSA9IG1lc3NhZ2UudHlwZSA9PT0gJ2hhbmRzaGFrZSc7XHJcblxyXG4gICAgICBfdGhpcy5faXNUb0RlY3J5cHQobWVzc2FnZSkudGhlbigoaXNUb0RlY3J5cHQpID0+IHtcclxuXHJcbiAgICAgICAgLy9pZiBpcyBub3QgdG8gYXBwbHkgZW5jcnlwdGlvbiwgdGhlbiByZXR1cm5zIHJlc29sdmVcclxuICAgICAgICBpZiAoIWlzVG9EZWNyeXB0KSByZXR1cm4gcmVzb2x2ZShtZXNzYWdlKTtcclxuXHJcbiAgICAgICAgbGV0IGRhdGFPYmplY3RVUkwgPSBwYXJzZU1lc3NhZ2VVUkwobWVzc2FnZS50byk7XHJcblxyXG4gICAgICAgIGxldCBpc1RvRGF0YU9iamVjdCA9IGlzRGF0YU9iamVjdFVSTChkYXRhT2JqZWN0VVJMKTtcclxuICAgICAgICBsZXQgaXNGcm9tSHlwZXJ0eSA9IGRpdmlkZVVSTChtZXNzYWdlLmZyb20pLnR5cGUgPT09ICdoeXBlcnR5JztcclxuICAgICAgICBsZXQgaXNUb0h5cGVydHkgPSBkaXZpZGVVUkwobWVzc2FnZS50bykudHlwZSA9PT0gJ2h5cGVydHknO1xyXG5cclxuICAgICAgICBpZiAobWVzc2FnZS50eXBlID09PSAndXBkYXRlJykge1xyXG4gICAgICAgICAgcmV0dXJuIHJlc29sdmUobWVzc2FnZSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvL2lzIGlzIGh5cGVydHkgdG8gaHlwZXJ0eSBjb21tdW5pY2F0aW9uXHJcbiAgICAgICAgaWYgKGlzRnJvbUh5cGVydHkgJiYgaXNUb0h5cGVydHkpIHtcclxuICAgICAgICAgIC8vIGxvZy5sb2coJ2RlY3J5cHQgaHlwZXJ0eSB0byBoeXBlcnR5Jyk7XHJcbiAgICAgICAgICBsZXQgdXNlclVSTCA9IF90aGlzLl9yZWdpc3RyeS5nZXRIeXBlcnR5T3duZXIobWVzc2FnZS50byk7XHJcbiAgICAgICAgICBpZiAodXNlclVSTCkge1xyXG5cclxuICAgICAgICAgICAgbGV0IGNoYXRLZXlzID0gX3RoaXMuY2hhdEtleXNbbWVzc2FnZS50byArICc8LT4nICsgbWVzc2FnZS5mcm9tXTtcclxuICAgICAgICAgICAgaWYgKCFjaGF0S2V5cykge1xyXG4gICAgICAgICAgICAgIGNoYXRLZXlzID0gX3RoaXMuX25ld0NoYXRDcnlwdG8obWVzc2FnZSwgdXNlclVSTCwgJ2RlY3J5cHQnKTtcclxuICAgICAgICAgICAgICBfdGhpcy5jaGF0S2V5c1ttZXNzYWdlLnRvICsgJzwtPicgKyBtZXNzYWdlLmZyb21dID0gY2hhdEtleXM7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmIChjaGF0S2V5cy5hdXRoZW50aWNhdGVkICYmICFpc0hhbmRTaGFrZVR5cGUpIHtcclxuICAgICAgICAgICAgICBsZXQgdmFsdWUgPSBkZWNvZGUobWVzc2FnZS5ib2R5LnZhbHVlKTtcclxuICAgICAgICAgICAgICBsZXQgaXYgPSBkZWNvZGVUb1VpbnQ4QXJyYXkodmFsdWUuaXYpO1xyXG4gICAgICAgICAgICAgIGxldCBkYXRhID0gZGVjb2RlVG9VaW50OEFycmF5KHZhbHVlLnZhbHVlKTtcclxuICAgICAgICAgICAgICBsZXQgaGFzaCA9IGRlY29kZVRvVWludDhBcnJheSh2YWx1ZS5oYXNoKTtcclxuICAgICAgICAgICAgICBfdGhpcy5jcnlwdG8uZGVjcnlwdEFFUyhjaGF0S2V5cy5rZXlzLmh5cGVydHlUb1Nlc3Npb25LZXksIGRhdGEsIGl2KS50aGVuKGRlY3J5cHRlZERhdGEgPT4ge1xyXG4gICAgICAgICAgICAgICAgLy8gbG9nLmxvZygnZGVjcnlwdGVkIHZhbHVlICcsIGRlY3J5cHRlZERhdGEpO1xyXG4gICAgICAgICAgICAgICAgbWVzc2FnZS5ib2R5LnZhbHVlID0gZGVjcnlwdGVkRGF0YTtcclxuXHJcbiAgICAgICAgICAgICAgICBsZXQgZmlsdGVyZWRNZXNzYWdlID0gX3RoaXMuX2ZpbHRlck1lc3NhZ2VUb0hhc2gobWVzc2FnZSwgZGVjcnlwdGVkRGF0YSArIGl2KTtcclxuXHJcbiAgICAgICAgICAgICAgICBfdGhpcy5jcnlwdG8udmVyaWZ5SE1BQyhjaGF0S2V5cy5rZXlzLmh5cGVydHlUb0hhc2hLZXksIGZpbHRlcmVkTWVzc2FnZSwgaGFzaCkudGhlbihyZXN1bHQgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAvL2xvZy5sb2coJ3Jlc3VsdCBvZiBoYXNoIHZlcmlmaWNhdGlvbiEgJywgcmVzdWx0KTtcclxuICAgICAgICAgICAgICAgICAgbWVzc2FnZS5ib2R5LmFzc2VydGVkSWRlbnRpdHkgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICByZXNvbHZlKG1lc3NhZ2UpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKGlzSGFuZFNoYWtlVHlwZSkge1xyXG4gICAgICAgICAgICAgIF90aGlzLl9kb0hhbmRTaGFrZVBoYXNlKG1lc3NhZ2UsIGNoYXRLZXlzKS50aGVuKGZ1bmN0aW9uKHZhbHVlKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgLy9pZiBpdCB3YXMgc3RhcnRlZCBieSBkb011dHVhbEF1dGhlbnRpY2F0aW9uIHRoZW4gZW5kcyB0aGUgcHJvdG9jb2xcclxuICAgICAgICAgICAgICAgIGlmICh2YWx1ZSA9PT0gJ2hhbmRTaGFrZUVuZCcpIHtcclxuICAgICAgICAgICAgICAgICAgLy9yZWplY3QoJ2RlY3J5cHQgaGFuZHNoYWtlIHByb3RvY29sIHBoYXNlJyk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAvLyBpZiB3YXMgc3RhcnRlZCBieSBhIG1lc3NhZ2UsIHRoZW4gcmVzZW5kIHRoYXQgbWVzc2FnZVxyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgX3RoaXMuY2hhdEtleXNbbWVzc2FnZS50byArICc8LT4nICsgbWVzc2FnZS5mcm9tXSA9IHZhbHVlLmNoYXRLZXlzO1xyXG4gICAgICAgICAgICAgICAgICBfdGhpcy5fbWVzc2FnZUJ1cy5wb3N0TWVzc2FnZSh2YWx1ZS5tZXNzYWdlKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgIC8vcmVqZWN0KCdkZWNyeXB0IGhhbmRzaGFrZSBwcm90b2NvbCBwaGFzZSAnKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICByZWplY3QoJ3dyb25nIG1lc3NhZ2UgZG8gZGVjcnlwdCcpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICByZWplY3QoJ2Vycm9yIG9uIGRlY3J5cHQgbWVzc2FnZScpO1xyXG4gICAgICAgICAgfVxyXG5cclxuICAgICAgICAgIC8vaWYgZnJvbSBoeXBlcnR5IHRvIGEgZGF0YU9iamVjdFVSTFxyXG4gICAgICAgIH0gZWxzZSBpZiAoaXNGcm9tSHlwZXJ0eSAmJiBpc1RvRGF0YU9iamVjdCkge1xyXG4gICAgICAgICAgLy8gbG9nLmxvZygnZGF0YU9iamVjdCB2YWx1ZSB0byBkZWNyeXB0OiAnLCBtZXNzYWdlLmJvZHkpO1xyXG5cclxuICAgICAgICAgIF90aGlzLnN0b3JhZ2VNYW5hZ2VyLmdldCgnZGF0YU9iamVjdFNlc3Npb25LZXlzJykudGhlbigoc2Vzc2lvbktleXMpID0+IHtcclxuICAgICAgICAgICAgc2Vzc2lvbktleXMgPSBjaGF0a2V5c1RvQXJyYXlDbG9uZXIoc2Vzc2lvbktleXMgfHwge30pO1xyXG4gICAgICAgICAgICBsZXQgZGF0YU9iamVjdEtleSA9IHNlc3Npb25LZXlzID8gc2Vzc2lvbktleXNbZGF0YU9iamVjdFVSTF0gOiBudWxsO1xyXG5cclxuICAgICAgICAgICAgaWYgKGRhdGFPYmplY3RLZXkpIHtcclxuXHJcbiAgICAgICAgICAgICAgLy9jaGVjayBpZiBpcyB0byBhcHBseSBlbmNyeXB0aW9uXHJcbiAgICAgICAgICAgICAgaWYgKGRhdGFPYmplY3RLZXkuaXNUb0VuY3J5cHQpIHtcclxuICAgICAgICAgICAgICAgIGxldCBwYXJzZWRWYWx1ZSA9IHBhcnNlKG1lc3NhZ2UuYm9keS52YWx1ZSk7XHJcbiAgICAgICAgICAgICAgICBsZXQgaXYgPSBkZWNvZGVUb1VpbnQ4QXJyYXkocGFyc2VkVmFsdWUuaXYpO1xyXG4gICAgICAgICAgICAgICAgbGV0IGVuY3J5cHRlZFZhbHVlID0gZGVjb2RlVG9VaW50OEFycmF5KHBhcnNlZFZhbHVlLnZhbHVlKTtcclxuICAgICAgICAgICAgICAgIGxldCBoYXNoID0gZGVjb2RlVG9VaW50OEFycmF5KHBhcnNlZFZhbHVlLmhhc2gpO1xyXG5cclxuICAgICAgICAgICAgICAgIF90aGlzLmNyeXB0by5kZWNyeXB0QUVTKGRhdGFPYmplY3RLZXkuc2Vzc2lvbktleSwgZW5jcnlwdGVkVmFsdWUsIGl2KS50aGVuKGRlY3J5cHRlZFZhbHVlID0+IHtcclxuICAgICAgICAgICAgICAgICAgbGV0IHBhcnNlZFZhbHVlID0gcGFyc2UoZGVjcnlwdGVkVmFsdWUpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgLy8gbG9nLmxvZygnZGVjcnlwdGVkIFZhbHVlLCcsIHBhcnNlZFZhbHVlKTtcclxuICAgICAgICAgICAgICAgICAgbWVzc2FnZS5ib2R5LnZhbHVlID0gcGFyc2VkVmFsdWU7XHJcblxyXG4gICAgICAgICAgICAgICAgICBsZXQgZmlsdGVyZWRNZXNzYWdlID0gX3RoaXMuX2ZpbHRlck1lc3NhZ2VUb0hhc2gobWVzc2FnZSwgc3RyaW5naWZ5KHBhcnNlZFZhbHVlKSArIHN0cmluZ2lmeShpdikpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgX3RoaXMuY3J5cHRvLnZlcmlmeUhNQUMoZGF0YU9iamVjdEtleS5zZXNzaW9uS2V5LCBmaWx0ZXJlZE1lc3NhZ2UsIGhhc2gpLnRoZW4ocmVzdWx0ID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBsb2cubG9nKCdSZWNlaXZlZCBtZXNzYWdlIEhNQUMgcmVzdWx0JywgcmVzdWx0KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZS5ib2R5LmFzc2VydGVkSWRlbnRpdHkgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgIHJlc29sdmUobWVzc2FnZSk7XHJcbiAgICAgICAgICAgICAgICAgIH0pLmNhdGNoKGVyciA9PiB7IHJlamVjdCgnTWVzc2FnZSBITUFDIGlzIGludmFsaWQ6ICcgKyBlcnIpOyB9KTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vaWYgbm90LCBqdXN0IHJldHVybiB0aGUgbWVzc2FnZVxyXG4gICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBtZXNzYWdlLmJvZHkuYXNzZXJ0ZWRJZGVudGl0eSA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICByZXNvbHZlKG1lc3NhZ2UpO1xyXG4gICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgbWVzc2FnZS5ib2R5LmFzc2VydGVkSWRlbnRpdHkgPSB0cnVlO1xyXG4gICAgICAgICAgICAgIHJlc29sdmUobWVzc2FnZSk7XHJcblxyXG4gICAgICAgICAgICAgIC8vcmVqZWN0KCdubyBzZXNzaW9uS2V5IGZvciBjaGF0IHJvb20gZm91bmQnKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICByZWplY3QoJ3dyb25nIG1lc3NhZ2UgdG8gZGVjcnlwdCcpO1xyXG4gICAgICAgIH1cclxuICAgICAgfSk7XHJcblxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBkZWNyeXB0RGF0YU9iamVjdChkYXRhT2JqZWN0LCBzZW5kZXIpIHtcclxuICAgIGxldCBfdGhpcyA9IHRoaXM7XHJcblxyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAvL2lmIGlzIG5vdCB0byBhcHBseSBlbmNyeXB0aW9uLCB0aGVuIHJldHVybnMgcmVzb2x2ZVxyXG4gICAgICBpZiAoIV90aGlzLmlzVG9Vc2VFbmNyeXB0aW9uKSB7XHJcbiAgICAgICAgLy8gbG9nLmxvZygnZGVjcnlwdGlvbiBkaXNhYmxlZCcpO1xyXG4gICAgICAgIHJldHVybiByZXNvbHZlKGRhdGFPYmplY3QpO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBsZXQgZGF0YU9iamVjdFVSTCA9IHBhcnNlTWVzc2FnZVVSTChzZW5kZXIpO1xyXG5cclxuICAgICAgLy8gbG9nLmxvZygnZGF0YU9iamVjdCB2YWx1ZSB0byBkZWNyeXB0OiAnLCBkYXRhT2JqZWN0KTtcclxuXHJcbiAgICAgIF90aGlzLnN0b3JhZ2VNYW5hZ2VyLmdldCgnZGF0YU9iamVjdFNlc3Npb25LZXlzJykudGhlbigoc2Vzc2lvbktleXMpID0+IHtcclxuICAgICAgICBzZXNzaW9uS2V5cyA9IGNoYXRrZXlzVG9BcnJheUNsb25lcihzZXNzaW9uS2V5cyk7XHJcbiAgICAgICAgbGV0IGRhdGFPYmplY3RLZXkgPSBzZXNzaW9uS2V5cyA/IHNlc3Npb25LZXlzW2RhdGFPYmplY3RVUkxdIDogbnVsbDtcclxuXHJcbiAgICAgICAgaWYgKGRhdGFPYmplY3RLZXkpIHtcclxuXHJcbiAgICAgICAgICAvL2NoZWNrIGlmIGlzIHRvIGFwcGx5IGVuY3J5cHRpb25cclxuICAgICAgICAgIGlmIChkYXRhT2JqZWN0S2V5LmlzVG9FbmNyeXB0KSB7XHJcbiAgICAgICAgICAgIGxldCBpdiA9IGRlY29kZVRvVWludDhBcnJheShkYXRhT2JqZWN0Lml2KTtcclxuICAgICAgICAgICAgbGV0IGVuY3J5cHRlZFZhbHVlID0gZGVjb2RlVG9VaW50OEFycmF5KGRhdGFPYmplY3QudmFsdWUpO1xyXG5cclxuICAgICAgICAgICAgX3RoaXMuY3J5cHRvLmRlY3J5cHRBRVMoZGF0YU9iamVjdEtleS5zZXNzaW9uS2V5LCBlbmNyeXB0ZWRWYWx1ZSwgaXYpLnRoZW4oZGVjcnlwdGVkVmFsdWUgPT4ge1xyXG4gICAgICAgICAgICAgIGxldCBwYXJzZWRWYWx1ZSA9IHBhcnNlKGRlY3J5cHRlZFZhbHVlKTtcclxuICAgICAgICAgICAgICBsZXQgbmV3VmFsdWUgPSB7IHZhbHVlOiBwYXJzZWRWYWx1ZSwgaXY6IGVuY29kZShpdikgfTtcclxuXHJcbiAgICAgICAgICAgICAgLy8gbG9nLmxvZygnZGVjcnlwdGVkIGRhdGFPYmplY3QsJywgbmV3VmFsdWUpO1xyXG5cclxuICAgICAgICAgICAgICByZXR1cm4gcmVzb2x2ZShuZXdWYWx1ZSk7XHJcbiAgICAgICAgICAgIH0pLmNhdGNoKGVyciA9PiB7IHJlamVjdCgnT24gZGVjcnlwdERhdGFPYmplY3QgZnJvbSBtZXRob2QgZW5jcnlwdEFFUyBlcnJvcjogJyArIGVycik7IH0pO1xyXG5cclxuICAgICAgICAgIC8vaWYgbm90LCBqdXN0IHJldHVybiB0aGUgZGF0YU9iamVjdFxyXG4gICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgLy8gbG9nLmxvZygnVGhlIGRhdGFPYmplY3QgaXMgbm90IGVuY3J5cHRlZCcpO1xyXG4gICAgICAgICAgICByZXR1cm4gcmVzb2x2ZShkYXRhT2JqZWN0KTtcclxuICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIHJldHVybiByZWplY3QoJ05vIGRhdGFPYmplY3RLZXkgZm9yIHRoaXMgZGF0YU9iamVjdFVSTDonLCBkYXRhT2JqZWN0VVJMKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBfZG9NdXR1YWxBdXRoZW50aWNhdGlvblBoYXNlMShtZXNzYWdlKSB7XHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICBsZXQgdG8gPSBtZXNzYWdlLnRvLnNwbGl0KCcvJyk7XHJcblxyXG4gICAgICAvL2xldCBzdWJzSW5kZXggPSB0by5pbmRleE9mKCdzdWJzY3JpcHRpb24nKTtcclxuICAgICAgLy9sZXQgaXNEYXRhT2JqZWN0U3Vic2NyaXB0aW9uID0gc3Vic0luZGV4ICE9PSAtMTtcclxuICAgICAgdG8ucG9wKCk7XHJcbiAgICAgIGxldCBkYXRhT2JqZWN0VVJMID0gdG9bMF0gKyAnLy8nICsgdG9bMl0gKyAnLycgKyB0b1szXTtcclxuICAgICAgX3RoaXMuX2RvTXV0dWFsQXV0aGVudGljYXRpb25QaGFzZTIoZGF0YU9iamVjdFVSTCwgbWVzc2FnZS5ib2R5LnN1YnNjcmliZXIpLnRoZW4oKCkgPT4ge1xyXG4gICAgICAgIF90aGlzLl9yZWdpc3RyeS5yZWdpc3RlclN1YnNjcmliZXIoZGF0YU9iamVjdFVSTCwgbWVzc2FnZS5ib2R5LnN1YnNjcmliZXIpO1xyXG4gICAgICAgIHJlc29sdmUoKTtcclxuICAgICAgfSwgKGVycm9yKSA9PiB7XHJcbiAgICAgICAgcmVqZWN0KGVycm9yKTtcclxuICAgICAgfSk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIF9kb011dHVhbEF1dGhlbnRpY2F0aW9uUGhhc2UyKHNlbmRlciwgcmVjZWl2ZXIpIHtcclxuICAgIGxvZy5pbmZvKCdkb011dHVhbEF1dGhlbnRpY2F0aW9uOnNlbmRlciAnLCBzZW5kZXIpO1xyXG4gICAgbG9nLmluZm8oJ2RvTXV0dWFsQXV0aGVudGljYXRpb246cmVjZWl2ZXIgJywgcmVjZWl2ZXIpO1xyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuXHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcblxyXG4gICAgICBsZXQgZGF0YU9iamVjdFVSTDtcclxuXHJcbiAgICAgIC8vIGNoZWNrIGlmIHRoZSBzZW5kZXIgaXMgYSBkYXRhT2JqZWN0IGFuZCBpZiBzbyBzdG9yZXMgdGhhdCB2YWx1ZVxyXG4gICAgICBsZXQgcmVwb3J0ZXJVUkwgPSBfdGhpcy5fcmVnaXN0cnkuZ2V0UmVwb3J0ZXJVUkxTeW5jaG9ub3VzKHNlbmRlcik7XHJcbiAgICAgIGlmIChyZXBvcnRlclVSTCkge1xyXG4gICAgICAgIGRhdGFPYmplY3RVUkwgPSBzZW5kZXI7XHJcbiAgICAgICAgc2VuZGVyID0gcmVwb3J0ZXJVUkw7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGxldCBtc2cgPSB7XHJcbiAgICAgICAgdG86IHJlY2VpdmVyLFxyXG4gICAgICAgIGZyb206IHNlbmRlcixcclxuICAgICAgICBjYWxsYmFjazogdW5kZWZpbmVkLFxyXG4gICAgICAgIGJvZHk6IHtoYW5kc2hha2VQaGFzZTogJ3N0YXJ0SGFuZFNoYWtlJywgaWdub3JlOiAnaWdub3JlTWVzc2FnZSd9XHJcbiAgICAgIH07XHJcblxyXG4gICAgICBpZiAoIXNlbmRlciB8fCAhcmVjZWl2ZXIpIHtcclxuICAgICAgICByZXR1cm4gcmVqZWN0KCdzZW5kZXIgb3IgcmVjZWl2ZXIgbWlzc2luZyBvbiBkb011dHVhbEF1dGhlbnRpY2F0aW9uJyk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGxldCBjaGF0S2V5cyA9IF90aGlzLmNoYXRLZXlzW3NlbmRlciArICc8LT4nICsgcmVjZWl2ZXJdO1xyXG4gICAgICBsZXQgdXNlclVSTCA9IF90aGlzLl9yZWdpc3RyeS5nZXRIeXBlcnR5T3duZXIoc2VuZGVyKTtcclxuXHJcbiAgICAgIGlmICh1c2VyVVJMKSB7XHJcblxyXG4gICAgICAgIGlmICghY2hhdEtleXMpIHtcclxuICAgICAgICAgIC8vIGNhbGxiYWNrIHRvIHJlc29sdmUgd2hlbiBmaW5pc2ggdGhlIG11dHVhbCBhdXRoZW50aWNhdGlvblxyXG4gICAgICAgICAgbGV0IHJlc29sdmVkID0gZnVuY3Rpb24odmFsdWUpIHtcclxuICAgICAgICAgICAgLy8gbG9nLmxvZygnY2FsbGJhY2sgdmFsdWU6JywgdmFsdWUpO1xyXG4gICAgICAgICAgICByZXNvbHZlKHZhbHVlKTtcclxuICAgICAgICAgIH07XHJcbiAgICAgICAgICBtc2cuY2FsbGJhY2sgPSByZXNvbHZlZDtcclxuICAgICAgICAgIG1zZy5kYXRhT2JqZWN0VVJMID0gZGF0YU9iamVjdFVSTDtcclxuXHJcbiAgICAgICAgICBjaGF0S2V5cyA9IF90aGlzLl9uZXdDaGF0Q3J5cHRvKG1zZywgdXNlclVSTCk7XHJcbiAgICAgICAgICBfdGhpcy5jaGF0S2V5c1tzZW5kZXIgKyAnPC0+JyArIHJlY2VpdmVyXSA9IGNoYXRLZXlzO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKGNoYXRLZXlzLmF1dGhlbnRpY2F0ZWQpIHtcclxuXHJcbiAgICAgICAgICBsZXQgc3RhcnRTZXNzaW9uS2V5RXhjaGFuZ2UgPSB7XHJcbiAgICAgICAgICAgIHRvOiBzZW5kZXIsXHJcbiAgICAgICAgICAgIGZyb206IHJlY2VpdmVyXHJcbiAgICAgICAgICB9O1xyXG4gICAgICAgICAgY2hhdEtleXMuZGF0YU9iamVjdFVSTCA9IGRhdGFPYmplY3RVUkw7XHJcbiAgICAgICAgICBfdGhpcy5fc2VuZFJlcG9ydGVyU2Vzc2lvbktleShzdGFydFNlc3Npb25LZXlFeGNoYW5nZSwgY2hhdEtleXMpLnRoZW4odmFsdWUgPT4ge1xyXG5cclxuICAgICAgICAgICAgX3RoaXMuX21lc3NhZ2VCdXMucG9zdE1lc3NhZ2UodmFsdWUubWVzc2FnZSk7XHJcbiAgICAgICAgICAgIHJlc29sdmUoJ2V4Y2hhbmdlIG9mIGNoYXQgc2Vzc2lvbktleSBpbml0aWF0ZWQnKTtcclxuICAgICAgICAgIH0pLmNhdGNoKGVyciA9PiB7IHJlamVjdCgnT24gZG9NdXR1YWxBdXRoZW50aWNhdGlvbiBmcm9tIG1ldGhvZCBfc2VuZFJlcG9ydGVyU2Vzc2lvbktleSBlcnJvcjogJyArIGVycik7IH0pO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICBfdGhpcy5fZG9IYW5kU2hha2VQaGFzZShtc2csIGNoYXRLZXlzKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgcmVqZWN0KCdNdXR1YWwgYXV0aGVudGljYXRpb24gZXJyb3I6IEh5cGVydHkgb3duZXIgY291bGQgbm90IGJlIHJlc29sdmVkJyk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG5cclxuICB9XHJcblxyXG5cclxuICAvKipcclxuICAqIHJldHVybnMgdGhlIHJlcG9ydGVyIGFzc29jaWF0ZWQgdG8gdGhlIGRhdGFPYmplY3QgVVJMXHJcbiAgKiBAcGFyYW0gICB7U3RyaW5nfSAgIGRhdGFPYmplY3RVUkwgICAgICAgICBkYXRhT2JqZWN0IHVybFxyXG4gICogQHJldHVybiAgIHtTdHJpbmd9ICByZXBvcnRlciAgICAgICAgICAgICAgZGF0YU9iamVjdCB1cmwgcmVwb3J0ZXJcclxuICAqL1xyXG4gIC8qICBfZ2V0SHlwZXJ0eUZyb21EYXRhT2JqZWN0KGRhdGFPYmplY3RVUkwpIHtcclxuICAgIGxvZy5pbmZvKCdfZ2V0SHlwZXJ0eUZyb21EYXRhT2JqZWN0OmRhdGFPYmplY3RVUkwnLCBkYXRhT2JqZWN0VVJMKTtcclxuICAgIGxldCBfdGhpcyA9IHRoaXM7XHJcblxyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG5cclxuICAgICAgbGV0IHNwbGl0ZWRVUkwgPSBkaXZpZGVVUkwoZGF0YU9iamVjdFVSTCk7XHJcbiAgICAgIGxldCBkb21haW4gPSBzcGxpdGVkVVJMLmRvbWFpbjtcclxuICAgICAgbGV0IGZpbmFsVVJMID0gX3RoaXMuX3BhcnNlTWVzc2FnZVVSTChkYXRhT2JqZWN0VVJMKTtcclxuXHJcbiAgICAgIC8vIGNoZWNrIGlmIGlzIHRoZSBjcmVhdG9yIG9mIHRoZSBoeXBlcnR5XHJcbiAgICAgIGxldCByZXBvcnRlclVSTCA9IF90aGlzLnJlZ2lzdHJ5LmdldFJlcG9ydGVyVVJMU3luY2hvbm91cyhmaW5hbFVSTCk7XHJcbiAgICAgIGxvZy5pbmZvKCdfZ2V0SHlwZXJ0eUZyb21EYXRhT2JqZWN0OnJlcG9ydGVyVVJMJywgcmVwb3J0ZXJVUkwpO1xyXG5cclxuICAgICAgaWYgKHJlcG9ydGVyVVJMKSB7XHJcbiAgICAgICAgcmVzb2x2ZShyZXBvcnRlclVSTCk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgLy8gY2hlY2sgaWYgdGhlcmUgaXMgYWxyZWFkeSBhbiBhc3NvY2lhdGlvbiBmcm9tIGFuIGh5cGVydHlVUkwgdG8gdGhlIGRhdGFPYmplY3RcclxuICAgICAgICBsZXQgc3RvcmVkUmVwb3J0ZXJVUkwgPSBfdGhpcy5kYXRhT2JqZWN0c0lkZW50aXR5W2ZpbmFsVVJMXTtcclxuICAgICAgICBsb2cuaW5mbygnX2dldEh5cGVydHlGcm9tRGF0YU9iamVjdDpzdG9yZWRSZXBvcnRlclVSTCcsIHN0b3JlZFJlcG9ydGVyVVJMKTtcclxuXHJcbiAgICAgICAgaWYgKHN0b3JlZFJlcG9ydGVyVVJMKSB7XHJcbiAgICAgICAgICByZXNvbHZlKHN0b3JlZFJlcG9ydGVyVVJMKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgLy8gY2hlY2sgaWYgdGhlcmUgaXMgYW55IGh5cGVydHkgdGhhdCBzdWJzY3JpYmVkIHRoZSBkYXRhT2JqZWN0VVJMXHJcbiAgICAgICAgICBsZXQgc3Vic2NyaWJlckh5cGVydHkgPSBfdGhpcy5yZWdpc3RyeS5nZXREYXRhT2JqZWN0U3Vic2NyaWJlckh5cGVydHkoZGF0YU9iamVjdFVSTCk7XHJcbiAgICAgICAgICBsb2cuaW5mbygnX2dldEh5cGVydHlGcm9tRGF0YU9iamVjdDpzdWJzY3JpYmVySHlwZXJ0eScsIHN1YnNjcmliZXJIeXBlcnR5KTtcclxuXHJcbiAgICAgICAgICBpZiAoc3Vic2NyaWJlckh5cGVydHkpIHtcclxuICAgICAgICAgICAgcmVzb2x2ZShzdWJzY3JpYmVySHlwZXJ0eSk7XHJcbiAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAvLyBzZWFyY2ggaW4gZG9tYWluIHJlZ2lzdHJ5IGZvciB0aGUgaHlwZXJ0eSBhc3NvY2lhdGVkIHRvIHRoZSBkYXRhT2JqZWN0XHJcbiAgICAgICAgICAgIC8vIHNlYXJjaCBpbiBjYXNlIGlzIGEgc3Vic2NyaWJlciB3aG8gd2FudHMgdG8ga25vdyB0aGUgcmVwb3J0ZXJcclxuICAgICAgICAgICAgX3RoaXMuX2NvcmVEaXNjb3ZlcnkuZGlzY292ZXJEYXRhT2JqZWN0UGVyVVJMKGZpbmFsVVJMLCBkb21haW4pLnRoZW4oZGF0YU9iamVjdCA9PiB7XHJcbiAgICAgICAgICAgICAgbG9nLmluZm8oJ19nZXRIeXBlcnR5RnJvbURhdGFPYmplY3Q6ZGF0YU9iamVjdCcsIGRhdGFPYmplY3QpO1xyXG4gICAgICAgICAgICAgIF90aGlzLmRhdGFPYmplY3RzSWRlbnRpdHlbZmluYWxVUkxdID0gZGF0YU9iamVjdC5yZXBvcnRlcjtcclxuICAgICAgICAgICAgICBsb2cuaW5mbygnX2dldEh5cGVydHlGcm9tRGF0YU9iamVjdDpkYXRhT2JqZWN0LnJlcG9ydGVyJywgZGF0YU9iamVjdC5yZXBvcnRlcik7XHJcbiAgICAgICAgICAgICAgcmVzb2x2ZShkYXRhT2JqZWN0LnJlcG9ydGVyKTtcclxuICAgICAgICAgICAgfSwgZXJyID0+IHtcclxuICAgICAgICAgICAgICByZWplY3QoZXJyKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9Ki9cclxuXHJcbiAgX3NlbmRSZXBvcnRlclNlc3Npb25LZXkobWVzc2FnZSwgY2hhdEtleXMpIHtcclxuICAgIGxldCBfdGhpcyA9IHRoaXM7XHJcblxyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG5cclxuICAgICAgbGV0IHNlc3Npb25LZXlCdW5kbGUgPSBfdGhpcy5kYXRhT2JqZWN0U2Vzc2lvbktleXNbY2hhdEtleXMuZGF0YU9iamVjdFVSTF07XHJcbiAgICAgIGxldCByZXBvcnRlclNlc3Npb25LZXlNc2c7XHJcbiAgICAgIGxldCB2YWx1ZVRvRW5jcnlwdDtcclxuICAgICAgbGV0IHNlc3Npb25LZXk7XHJcbiAgICAgIGxldCBpdjtcclxuICAgICAgbGV0IHZhbHVlID0ge307XHJcblxyXG4gICAgICAvL2lmIHRoZXJlIGlzIG5vdCB5ZXQgYSBzZXNzaW9uIEtleSwgZ2VuZXJhdGVzIGEgbmV3IG9uZVxyXG4gICAgICBpZiAoIXNlc3Npb25LZXlCdW5kbGUpIHtcclxuICAgICAgICBzZXNzaW9uS2V5ID0gX3RoaXMuY3J5cHRvLmdlbmVyYXRlUmFuZG9tKCk7XHJcbiAgICAgICAgX3RoaXMuZGF0YU9iamVjdFNlc3Npb25LZXlzW2NoYXRLZXlzLmRhdGFPYmplY3RVUkxdID0ge3Nlc3Npb25LZXk6IHNlc3Npb25LZXksIGlzVG9FbmNyeXB0OiB0cnVlfTtcclxuXHJcbiAgICAgICAgbGV0IGRhdGFPYmplY3RTZXNzaW9uS2V5c0Nsb25lID0gY2hhdGtleXNUb1N0cmluZ0Nsb25lcihfdGhpcy5kYXRhT2JqZWN0U2Vzc2lvbktleXMpO1xyXG5cclxuICAgICAgICBfdGhpcy5zdG9yYWdlTWFuYWdlci5zZXQoJ2RhdGFPYmplY3RTZXNzaW9uS2V5cycsIDAsIGRhdGFPYmplY3RTZXNzaW9uS2V5c0Nsb25lKS5jYXRjaChlcnIgPT4ge1xyXG4gICAgICAgICAgcmVqZWN0KCdPbiBfc2VuZFJlcG9ydGVyU2Vzc2lvbktleSBmcm9tIG1ldGhvZCBzdG9yYWdlTWFuYWdlci5zZXQoZGF0YU9iamVjdFNlc3Npb25LZXlzLi4uKSBlcnJvcjogJyArIGVycik7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHNlc3Npb25LZXkgPSBzZXNzaW9uS2V5QnVuZGxlLnNlc3Npb25LZXk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIHRyeSB7XHJcbiAgICAgICAgdmFsdWVUb0VuY3J5cHQgPSBlbmNvZGUoe3ZhbHVlOiBlbmNvZGUoc2Vzc2lvbktleSksIGRhdGFPYmplY3RVUkw6IGNoYXRLZXlzLmRhdGFPYmplY3RVUkx9KTtcclxuICAgICAgfSBjYXRjaCAoZXJyKSB7XHJcbiAgICAgICAgcmV0dXJuIHJlamVjdCgnT24gX3NlbmRSZXBvcnRlclNlc3Npb25LZXkgZnJvbSBtZXRob2Qgc3RvcmFnZU1hbmFnZXIuc2V0IGVycm9yIHZhbHVlVG9FbmNyeXB0OiAnICsgZXJyKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgaXYgPSBfdGhpcy5jcnlwdG8uZ2VuZXJhdGVJVigpO1xyXG4gICAgICB2YWx1ZS5pdiA9IGVuY29kZShpdik7XHJcbiAgICAgIF90aGlzLmNyeXB0by5lbmNyeXB0QUVTKGNoYXRLZXlzLmtleXMuaHlwZXJ0eUZyb21TZXNzaW9uS2V5LCB2YWx1ZVRvRW5jcnlwdCwgaXYpLnRoZW4oZW5jcnlwdGVkVmFsdWUgPT4ge1xyXG5cclxuICAgICAgICByZXBvcnRlclNlc3Npb25LZXlNc2cgPSB7XHJcbiAgICAgICAgICB0eXBlOiAnaGFuZHNoYWtlJyxcclxuICAgICAgICAgIHRvOiBtZXNzYWdlLmZyb20sXHJcbiAgICAgICAgICBmcm9tOiBtZXNzYWdlLnRvLFxyXG4gICAgICAgICAgYm9keToge1xyXG4gICAgICAgICAgICBoYW5kc2hha2VQaGFzZTogJ3JlcG9ydGVyU2Vzc2lvbktleScsXHJcbiAgICAgICAgICAgIHZhbHVlOiBlbmNvZGUoZW5jcnlwdGVkVmFsdWUpXHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgbGV0IGZpbHRlcmVkTWVzc2FnZSA9IF90aGlzLl9maWx0ZXJNZXNzYWdlVG9IYXNoKHJlcG9ydGVyU2Vzc2lvbktleU1zZywgdmFsdWVUb0VuY3J5cHQgKyBpdiwgY2hhdEtleXMuaHlwZXJ0eUZyb20ubWVzc2FnZUluZm8pO1xyXG5cclxuICAgICAgICByZXR1cm4gX3RoaXMuY3J5cHRvLmhhc2hITUFDKGNoYXRLZXlzLmtleXMuaHlwZXJ0eUZyb21IYXNoS2V5LCBmaWx0ZXJlZE1lc3NhZ2UpO1xyXG4gICAgICB9KS50aGVuKGhhc2hlZE1lc3NhZ2UgPT4ge1xyXG4gICAgICAgIGxldCB2YWx1ZVdpdGhIYXNoID0gZW5jb2RlKHt2YWx1ZTogcmVwb3J0ZXJTZXNzaW9uS2V5TXNnLmJvZHkudmFsdWUsIGhhc2g6IGVuY29kZShoYXNoZWRNZXNzYWdlKSwgaXY6IHZhbHVlLml2fSk7XHJcblxyXG4gICAgICAgIHJlcG9ydGVyU2Vzc2lvbktleU1zZy5ib2R5LnZhbHVlID0gdmFsdWVXaXRoSGFzaDtcclxuXHJcbiAgICAgICAgcmVzb2x2ZSh7bWVzc2FnZTogcmVwb3J0ZXJTZXNzaW9uS2V5TXNnLCBjaGF0S2V5czogY2hhdEtleXN9KTtcclxuICAgICAgfSkuY2F0Y2goZXJyID0+IHtcclxuICAgICAgICByZWplY3QoJ09uIF9zZW5kUmVwb3J0ZXJTZXNzaW9uS2V5IGZyb20gY2hhaW5lZCBwcm9taXNlcyBlbmNyeXB0QUVTIGVycm9yOiAnICsgZXJyKTtcclxuICAgICAgfSk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICogRnVuY3Rpb24gdGhhdCByZXNvbHZlIGFuZCBjcmVhdGUgdGhlIGRvbWFpblVSTCBpbiBjYXNlIGl0IGlzIHByb3ZpZGVkIG9uZS4gSWYgbm90LCByZXNvbHZlIHRoZSBkZWZhdWx0IGRvbWFpblVSTFxyXG4gICogQHBhcmFtIHtTdHJpbmd9ICAgICBpZHBEb21haW4gICAgIGlkcERvbWFpbiAoT3B0aW9uYWwpXHJcbiAgKi9cclxuICBfcmVzb2x2ZURvbWFpbihpZHBEb21haW4pIHtcclxuICAgIGlmICghaWRwRG9tYWluKSB7XHJcbiAgICAgIHJldHVybiAnZG9tYWluLWlkcDovL2dvb2dsZS5jb20nO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgcmV0dXJuICdkb21haW4taWRwOi8vJyArIGlkcERvbWFpbjtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIF9kb0hhbmRTaGFrZVBoYXNlKG1lc3NhZ2UsIGNoYXRLZXlzKSB7XHJcbiAgLy8gbG9nKCdfZG9IYW5kU2hha2VQaGFzZTpkYXRhT2JqZWN0JywgbWVzc2FnZSk7XHJcbiAgLy9cdGxvZygnX2RvSGFuZFNoYWtlUGhhc2U6Y2hhdEtleXMnLCBjaGF0S2V5cyk7XHJcblxyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuXHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcblxyXG4gICAgICBsZXQgaGFuZHNoYWtlVHlwZSA9IG1lc3NhZ2UuYm9keS5oYW5kc2hha2VQaGFzZTtcclxuICAgICAgbGV0IGl2O1xyXG4gICAgICBsZXQgaGFzaDtcclxuICAgICAgbGV0IHZhbHVlID0ge307XHJcbiAgICAgIGxldCBmaWx0ZXJlZE1lc3NhZ2U7XHJcbiAgICAgIGxldCBwcml2YXRlS2V5SG9sZGVyO1xyXG5cclxuICAgICAgbG9nLmluZm8oJ2hhbmRzaGFrZSBwaGFzZTogJywgaGFuZHNoYWtlVHlwZSk7XHJcblxyXG4gICAgICBzd2l0Y2ggKGhhbmRzaGFrZVR5cGUpIHtcclxuXHJcbiAgICAgICAgY2FzZSAnc3RhcnRIYW5kU2hha2UnOiB7XHJcbiAgICAgICAgICBjaGF0S2V5cy5rZXlzLmZyb21SYW5kb20gPSBfdGhpcy5jcnlwdG8uZ2VuZXJhdGVSYW5kb20oKTtcclxuICAgICAgICAgIGxldCBzdGFydEhhbmRTaGFrZU1zZyA9IHtcclxuICAgICAgICAgICAgdHlwZTogJ2hhbmRzaGFrZScsXHJcbiAgICAgICAgICAgIHRvOiBtZXNzYWdlLnRvLFxyXG4gICAgICAgICAgICBmcm9tOiBtZXNzYWdlLmZyb20sXHJcbiAgICAgICAgICAgIGJvZHk6IHtcclxuICAgICAgICAgICAgICBoYW5kc2hha2VQaGFzZTogJ3NlbmRlckhlbGxvJyxcclxuICAgICAgICAgICAgICB2YWx1ZTogZW5jb2RlKGNoYXRLZXlzLmtleXMuZnJvbVJhbmRvbSlcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfTtcclxuICAgICAgICAgIGNoYXRLZXlzLmhhbmRzaGFrZUhpc3Rvcnkuc2VuZGVySGVsbG8gPSBfdGhpcy5fZmlsdGVyTWVzc2FnZVRvSGFzaChzdGFydEhhbmRTaGFrZU1zZywgdW5kZWZpbmVkLCBjaGF0S2V5cy5oeXBlcnR5RnJvbS5tZXNzYWdlSW5mbyk7XHJcblxyXG4gICAgICAgICAgLy8gY2hlY2sgaWYgd2FzIHRoZSBlbmNyeXB0IGZ1bmN0aW9uIG9yIHRoZSBtdXR1YWwgYXV0aGVudGljYXRpb24gdGhhdCByZXF1ZXN0IHRoZVxyXG4gICAgICAgICAgLy8gc3RhcnQgb2YgdGhlIGhhbmRTaGFrZVBoYXNlLlxyXG5cclxuICAgICAgICAgIGlmIChjaGF0S2V5cy5pbml0aWFsTWVzc2FnZSkge1xyXG4gICAgICAgICAgICByZXNvbHZlKHttZXNzYWdlOiBzdGFydEhhbmRTaGFrZU1zZywgY2hhdEtleXM6IGNoYXRLZXlzfSk7XHJcbiAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBfdGhpcy5jaGF0S2V5c1ttZXNzYWdlLmZyb20gKyAnPC0+JyArIG1lc3NhZ2UudG9dID0gY2hhdEtleXM7XHJcbiAgICAgICAgICAgIF90aGlzLl9tZXNzYWdlQnVzLnBvc3RNZXNzYWdlKHN0YXJ0SGFuZFNoYWtlTXNnKTtcclxuICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNhc2UgJ3NlbmRlckhlbGxvJzoge1xyXG5cclxuICAgICAgICAgIGxvZy5sb2coJ3NlbmRlckhlbGxvJyk7XHJcbiAgICAgICAgICBjaGF0S2V5cy5oYW5kc2hha2VIaXN0b3J5LnNlbmRlckhlbGxvID0gX3RoaXMuX2ZpbHRlck1lc3NhZ2VUb0hhc2gobWVzc2FnZSk7XHJcbiAgICAgICAgICBjaGF0S2V5cy5rZXlzLmZyb21SYW5kb20gPSBkZWNvZGVUb1VpbnQ4QXJyYXkobWVzc2FnZS5ib2R5LnZhbHVlKTtcclxuICAgICAgICAgIGNoYXRLZXlzLmtleXMudG9SYW5kb20gPSBfdGhpcy5jcnlwdG8uZ2VuZXJhdGVSYW5kb20oKTtcclxuXHJcbiAgICAgICAgICBsZXQgc2VuZGVySGVsbG9Nc2cgPSB7XHJcbiAgICAgICAgICAgIHR5cGU6ICdoYW5kc2hha2UnLFxyXG4gICAgICAgICAgICB0bzogbWVzc2FnZS5mcm9tLFxyXG4gICAgICAgICAgICBmcm9tOiBtZXNzYWdlLnRvLFxyXG4gICAgICAgICAgICBib2R5OiB7XHJcbiAgICAgICAgICAgICAgaGFuZHNoYWtlUGhhc2U6ICdyZWNlaXZlckhlbGxvJyxcclxuICAgICAgICAgICAgICB2YWx1ZTogZW5jb2RlKGNoYXRLZXlzLmtleXMudG9SYW5kb20pXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH07XHJcbiAgICAgICAgICBjaGF0S2V5cy5oYW5kc2hha2VIaXN0b3J5LnJlY2VpdmVySGVsbG8gPSBfdGhpcy5fZmlsdGVyTWVzc2FnZVRvSGFzaChzZW5kZXJIZWxsb01zZywgdW5kZWZpbmVkLCBjaGF0S2V5cy5oeXBlcnR5RnJvbS5tZXNzYWdlSW5mbyk7XHJcbiAgICAgICAgICByZXNvbHZlKHttZXNzYWdlOiBzZW5kZXJIZWxsb01zZywgY2hhdEtleXM6IGNoYXRLZXlzfSk7XHJcblxyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNhc2UgJ3JlY2VpdmVySGVsbG8nOiB7XHJcblxyXG4gICAgICAgICAgbG9nLmxvZygncmVjZWl2ZXJIZWxsbycpO1xyXG4gICAgICAgICAgX3RoaXMuZ2V0TXlQcml2YXRlS2V5KCkudGhlbihwcml2YXRlS2V5ID0+e1xyXG4gICAgICAgICAgICBwcml2YXRlS2V5SG9sZGVyID0gcHJpdmF0ZUtleTtcclxuXHJcbiAgICAgICAgICAgIGNoYXRLZXlzLmhhbmRzaGFrZUhpc3RvcnkucmVjZWl2ZXJIZWxsbyA9IF90aGlzLl9maWx0ZXJNZXNzYWdlVG9IYXNoKG1lc3NhZ2UpO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIF90aGlzLl9pZG0udmFsaWRhdGVBc3NlcnRpb24obWVzc2FnZS5ib2R5LmlkZW50aXR5LmFzc2VydGlvbiwgdW5kZWZpbmVkLCBtZXNzYWdlLmJvZHkuaWRlbnRpdHkuaWRwLmRvbWFpbik7XHJcbiAgICAgICAgICB9KS50aGVuKCh2YWx1ZSkgPT4ge1xyXG5cclxuICAgICAgICAgICAgLy9UT0RPIHJlbW92ZSBsYXRlciB0aGlzIHZlcmlmaWNhdGlvbiBhcyBzb29uIGFzIGFsbCB0aGUgSWRQIHByb3h5IGFyZSB1cGRhdGVkIGluIHRoZSBleGFtcGxlXHJcbiAgICAgICAgICAgIGxldCBlbmNvZGVkcHVibGljS2V5ID0gKHR5cGVvZiB2YWx1ZS5jb250ZW50cyA9PT0gJ3N0cmluZycpID8gdmFsdWUuY29udGVudHMgOiB2YWx1ZS5jb250ZW50cy5ub25jZTtcclxuXHJcbiAgICAgICAgICAgIGxldCByZWNlaXZlclB1YmxpY0tleSA9IHBhcnNlVG9VaW50OEFycmF5KGVuY29kZWRwdWJsaWNLZXkpO1xyXG4gICAgICAgICAgICBsZXQgcHJlbWFzdGVyU2VjcmV0ID0gX3RoaXMuY3J5cHRvLmdlbmVyYXRlUE1TKCk7XHJcbiAgICAgICAgICAgIGxldCB0b1JhbmRvbSA9IG1lc3NhZ2UuYm9keS52YWx1ZTtcclxuICAgICAgICAgICAgY2hhdEtleXMuaHlwZXJ0eVRvLmFzc2VydGlvbiA9IG1lc3NhZ2UuYm9keS5pZGVudGl0eS5hc3NlcnRpb247XHJcbiAgICAgICAgICAgIGNoYXRLZXlzLmh5cGVydHlUby5wdWJsaWNLZXkgPSByZWNlaXZlclB1YmxpY0tleTtcclxuICAgICAgICAgICAgY2hhdEtleXMuaHlwZXJ0eVRvLnVzZXJJRCAgICA9IG1lc3NhZ2UuYm9keS5pZGVudGl0eS51c2VyUHJvZmlsZS51c2VyVVJMO1xyXG4gICAgICAgICAgICBjaGF0S2V5cy5rZXlzLnRvUmFuZG9tICA9IGRlY29kZVRvVWludDhBcnJheSh0b1JhbmRvbSk7XHJcbiAgICAgICAgICAgIGNoYXRLZXlzLmtleXMucHJlbWFzdGVyS2V5ID0gcHJlbWFzdGVyU2VjcmV0O1xyXG5cclxuICAgICAgICAgICAgbGV0IGNvbmNhdEtleSA9IF90aGlzLmNyeXB0by5jb25jYXRQTVN3aXRoUmFuZG9tcyhwcmVtYXN0ZXJTZWNyZXQsIGNoYXRLZXlzLmtleXMudG9SYW5kb20sIGNoYXRLZXlzLmtleXMuZnJvbVJhbmRvbSk7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gX3RoaXMuY3J5cHRvLmdlbmVyYXRlTWFzdGVyU2VjcmV0KGNvbmNhdEtleSwgJ21lc3NhZ2VIaXN0b3JpYycgKyBjaGF0S2V5cy5rZXlzLnRvUmFuZG9tICsgY2hhdEtleXMua2V5cy5mcm9tUmFuZG9tKTtcclxuXHJcbiAgICAgICAgICAgIC8vZ2VuZXJhdGUgdGhlIG1hc3RlciBrZXlcclxuICAgICAgICAgIH0pLnRoZW4oKG1hc3RlcktleSkgPT4ge1xyXG4gICAgICAgICAgICBjaGF0S2V5cy5rZXlzLm1hc3RlcktleSA9IG1hc3RlcktleTtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiBfdGhpcy5jcnlwdG8uZ2VuZXJhdGVLZXlzKG1hc3RlcktleSwgJ2tleSBleHBhbnNpb24nICsgY2hhdEtleXMua2V5cy50b1JhbmRvbSArIGNoYXRLZXlzLmtleXMuZnJvbVJhbmRvbSk7XHJcblxyXG4gICAgICAgICAgICAvL2dlbmVyYXRlIHRoZSBzeW1tZXRyaWMgYW5kIGhhc2gga2V5c1xyXG4gICAgICAgICAgfSkudGhlbigoa2V5cykgPT4ge1xyXG5cclxuICAgICAgICAgICAgY2hhdEtleXMua2V5cy5oeXBlcnR5VG9TZXNzaW9uS2V5ID0gbmV3IFVpbnQ4QXJyYXkoa2V5c1swXSk7XHJcbiAgICAgICAgICAgIGNoYXRLZXlzLmtleXMuaHlwZXJ0eUZyb21TZXNzaW9uS2V5ID0gbmV3IFVpbnQ4QXJyYXkoa2V5c1sxXSk7XHJcbiAgICAgICAgICAgIGNoYXRLZXlzLmtleXMuaHlwZXJ0eVRvSGFzaEtleSA9IG5ldyBVaW50OEFycmF5KGtleXNbMl0pO1xyXG4gICAgICAgICAgICBjaGF0S2V5cy5rZXlzLmh5cGVydHlGcm9tSGFzaEtleSA9IG5ldyBVaW50OEFycmF5KGtleXNbM10pO1xyXG4gICAgICAgICAgICBpdiA9IF90aGlzLmNyeXB0by5nZW5lcmF0ZUlWKCk7XHJcbiAgICAgICAgICAgIHZhbHVlLml2ID0gZW5jb2RlKGl2KTtcclxuXHJcbiAgICAgICAgICAgIGxldCBtZXNzYWdlU3RydWN0dXJlID0ge1xyXG4gICAgICAgICAgICAgIHR5cGU6ICdoYW5kc2hha2UnLFxyXG4gICAgICAgICAgICAgIHRvOiBtZXNzYWdlLmZyb20sXHJcbiAgICAgICAgICAgICAgZnJvbTogbWVzc2FnZS50byxcclxuICAgICAgICAgICAgICBib2R5OiB7XHJcbiAgICAgICAgICAgICAgICBoYW5kc2hha2VQaGFzZTogJ3NlbmRlckNlcnRpZmljYXRlJ1xyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgIC8vIGhhc2ggdGhlIHZhbHVlIGFuZCB0aGUgaXZcclxuICAgICAgICAgICAgZmlsdGVyZWRNZXNzYWdlID0gX3RoaXMuX2ZpbHRlck1lc3NhZ2VUb0hhc2gobWVzc2FnZVN0cnVjdHVyZSwgJ29rJyArIGl2LCBjaGF0S2V5cy5oeXBlcnR5RnJvbS5tZXNzYWdlSW5mbyk7XHJcbiAgICAgICAgICAgIHJldHVybiBfdGhpcy5jcnlwdG8uaGFzaEhNQUMoY2hhdEtleXMua2V5cy5oeXBlcnR5RnJvbUhhc2hLZXksIGZpbHRlcmVkTWVzc2FnZSk7XHJcbiAgICAgICAgICB9KS50aGVuKChoYXNoKSA9PiB7XHJcbiAgICAgICAgICAgIHZhbHVlLmhhc2ggPSBlbmNvZGUoaGFzaCk7XHJcblxyXG4gICAgICAgICAgICAvL2VuY3J5cHQgdGhlIGRhdGFcclxuICAgICAgICAgICAgcmV0dXJuIF90aGlzLmNyeXB0by5lbmNyeXB0QUVTKGNoYXRLZXlzLmtleXMuaHlwZXJ0eUZyb21TZXNzaW9uS2V5LCAnb2snLCBpdik7XHJcbiAgICAgICAgICB9KS50aGVuKChlbmNyeXB0ZWREYXRhKSA9PiB7XHJcbiAgICAgICAgICAgIHZhbHVlLnN5bWV0cmljRW5jcnlwdGlvbiA9IGVuY29kZShlbmNyeXB0ZWREYXRhKTtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiBfdGhpcy5jcnlwdG8uZW5jcnlwdFJTQShjaGF0S2V5cy5oeXBlcnR5VG8ucHVibGljS2V5LCBjaGF0S2V5cy5rZXlzLnByZW1hc3RlcktleSk7XHJcblxyXG4gICAgICAgICAgfSkudGhlbigoZW5jcnlwdGVkVmFsdWUpID0+IHtcclxuICAgICAgICAgICAgdmFsdWUuYXNzeW1ldHJpY0VuY3J5cHRpb24gPSBlbmNvZGUoZW5jcnlwdGVkVmFsdWUpO1xyXG5cclxuICAgICAgICAgICAgbGV0IG1lc3NhZ2VTdHJ1Y3R1cmUgPSB7XHJcbiAgICAgICAgICAgICAgdHlwZTogJ2hhbmRzaGFrZScsXHJcbiAgICAgICAgICAgICAgdG86IG1lc3NhZ2UuZnJvbSxcclxuICAgICAgICAgICAgICBmcm9tOiBtZXNzYWdlLnRvLFxyXG4gICAgICAgICAgICAgIGJvZHk6IHtcclxuICAgICAgICAgICAgICAgIGhhbmRzaGFrZVBoYXNlOiAnc2VuZGVyQ2VydGlmaWNhdGUnXHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgbGV0IG1lc3NhZ2VUb0hhc2ggPSBfdGhpcy5fZmlsdGVyTWVzc2FnZVRvSGFzaChtZXNzYWdlU3RydWN0dXJlLCBjaGF0S2V5cy5rZXlzLnByZW1hc3RlcktleSwgY2hhdEtleXMuaHlwZXJ0eUZyb20ubWVzc2FnZUluZm8pO1xyXG4gICAgICAgICAgICByZXR1cm4gX3RoaXMuY3J5cHRvLnNpZ25SU0EocHJpdmF0ZUtleUhvbGRlciwgZW5jb2RlKGNoYXRLZXlzLmhhbmRzaGFrZUhpc3RvcnkpICsgZW5jb2RlKG1lc3NhZ2VUb0hhc2gpKTtcclxuICAgICAgICAgIH0pLnRoZW4oc2lnbmF0dXJlID0+IHtcclxuXHJcbiAgICAgICAgICAgIHZhbHVlLnNpZ25hdHVyZSA9IGVuY29kZShzaWduYXR1cmUpO1xyXG5cclxuICAgICAgICAgICAgbGV0IHJlY2VpdmVySGVsbG9Nc2cgPSB7XHJcbiAgICAgICAgICAgICAgdHlwZTogJ2hhbmRzaGFrZScsXHJcbiAgICAgICAgICAgICAgdG86IG1lc3NhZ2UuZnJvbSxcclxuICAgICAgICAgICAgICBmcm9tOiBtZXNzYWdlLnRvLFxyXG4gICAgICAgICAgICAgIGJvZHk6IHtcclxuICAgICAgICAgICAgICAgIGhhbmRzaGFrZVBoYXNlOiAnc2VuZGVyQ2VydGlmaWNhdGUnLFxyXG4gICAgICAgICAgICAgICAgdmFsdWU6IGVuY29kZSh2YWx1ZSlcclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIGNoYXRLZXlzLmhhbmRzaGFrZUhpc3Rvcnkuc2VuZGVyQ2VydGlmaWNhdGUgPSBfdGhpcy5fZmlsdGVyTWVzc2FnZVRvSGFzaChyZWNlaXZlckhlbGxvTXNnLCAnb2snICsgaXYsIGNoYXRLZXlzLmh5cGVydHlGcm9tLm1lc3NhZ2VJbmZvKTtcclxuXHJcbiAgICAgICAgICAgIHJlc29sdmUoe21lc3NhZ2U6IHJlY2VpdmVySGVsbG9Nc2csIGNoYXRLZXlzOiBjaGF0S2V5c30pO1xyXG5cclxuICAgICAgICAgIH0sIGVycm9yID0+IHJlamVjdChlcnJvcikpO1xyXG5cclxuICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjYXNlICdzZW5kZXJDZXJ0aWZpY2F0ZSc6IHtcclxuXHJcbiAgICAgICAgICBsb2cubG9nKCdzZW5kZXJDZXJ0aWZpY2F0ZScpO1xyXG5cclxuICAgICAgICAgIGxldCByZWNlaXZlZFZhbHVlID0gZGVjb2RlKG1lc3NhZ2UuYm9keS52YWx1ZSk7XHJcblxyXG4gICAgICAgICAgX3RoaXMuZ2V0TXlQcml2YXRlS2V5KCkudGhlbihwcml2YXRlS2V5ID0+e1xyXG4gICAgICAgICAgICBwcml2YXRlS2V5SG9sZGVyID0gcHJpdmF0ZUtleTtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiBfdGhpcy5faWRtLnZhbGlkYXRlQXNzZXJ0aW9uKG1lc3NhZ2UuYm9keS5pZGVudGl0eS5hc3NlcnRpb24sIHVuZGVmaW5lZCwgbWVzc2FnZS5ib2R5LmlkZW50aXR5LmlkcC5kb21haW4pO1xyXG4gICAgICAgICAgfSkudGhlbigodmFsdWUpID0+IHtcclxuICAgICAgICAgICAgbGV0IGVuY3J5cHRlZFBNUyA9IGRlY29kZVRvVWludDhBcnJheShyZWNlaXZlZFZhbHVlLmFzc3ltZXRyaWNFbmNyeXB0aW9uKTtcclxuXHJcbiAgICAgICAgICAgIC8vVE9ETyByZW1vdmUgbGF0ZXIgdGhpcyB2ZXJpZmljYXRpb24gYXMgc29vbiBhcyBhbGwgdGhlIElkUCBwcm94eSBhcmUgdXBkYXRlZCBpbiB0aGUgZXhhbXBsZVxyXG4gICAgICAgICAgICBsZXQgZW5jb2RlZHB1YmxpY0tleSA9ICh0eXBlb2YgdmFsdWUuY29udGVudHMgPT09ICdzdHJpbmcnKSA/IHZhbHVlLmNvbnRlbnRzIDogdmFsdWUuY29udGVudHMubm9uY2U7XHJcblxyXG4gICAgICAgICAgICBsZXQgc2VuZGVyUHVibGljS2V5ID0gcGFyc2VUb1VpbnQ4QXJyYXkoZW5jb2RlZHB1YmxpY0tleSk7XHJcbiAgICAgICAgICAgIGNoYXRLZXlzLmh5cGVydHlUby5hc3NlcnRpb24gPSBtZXNzYWdlLmJvZHkuaWRlbnRpdHkuYXNzZXJ0aW9uO1xyXG4gICAgICAgICAgICBjaGF0S2V5cy5oeXBlcnR5VG8ucHVibGljS2V5ID0gc2VuZGVyUHVibGljS2V5O1xyXG4gICAgICAgICAgICBjaGF0S2V5cy5oeXBlcnR5VG8udXNlcklEICAgID0gbWVzc2FnZS5ib2R5LmlkZW50aXR5LnVzZXJQcm9maWxlLnVzZXJVUkw7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gX3RoaXMuY3J5cHRvLmRlY3J5cHRSU0EocHJpdmF0ZUtleUhvbGRlciwgZW5jcnlwdGVkUE1TKTtcclxuXHJcbiAgICAgICAgICB9LCAoZXJyb3IpID0+IHtcclxuICAgICAgICAgICAgLy8gbG9nLmxvZyhlcnJvcik7XHJcbiAgICAgICAgICAgIHJlamVjdCgnRXJyb3IgZHVyaW5nIGF1dGhlbnRpY2F0aW9uIG9mIGlkZW50aXR5OiAnLCBlcnJvci5tZXNzYWdlKTtcclxuXHJcbiAgICAgICAgICAgIC8vb2J0YWluIHRoZSBQcmVtYXN0ZXJLZXkgdXNpbmcgdGhlIHByaXZhdGUga2V5XHJcbiAgICAgICAgICB9KS50aGVuKHBtcyA9PiB7XHJcblxyXG4gICAgICAgICAgICBjaGF0S2V5cy5rZXlzLnByZW1hc3RlcktleSA9IG5ldyBVaW50OEFycmF5KHBtcyk7XHJcblxyXG4gICAgICAgICAgICBsZXQgc2lnbmF0dXJlID0gZGVjb2RlVG9VaW50OEFycmF5KHJlY2VpdmVkVmFsdWUuc2lnbmF0dXJlKTtcclxuXHJcbiAgICAgICAgICAgIGxldCByZWNlaXZlZG1zZ1RvSGFzaCA9IF90aGlzLl9maWx0ZXJNZXNzYWdlVG9IYXNoKG1lc3NhZ2UsIGNoYXRLZXlzLmtleXMucHJlbWFzdGVyS2V5KTtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiBfdGhpcy5jcnlwdG8udmVyaWZ5UlNBKGNoYXRLZXlzLmh5cGVydHlUby5wdWJsaWNLZXksIGVuY29kZShjaGF0S2V5cy5oYW5kc2hha2VIaXN0b3J5KSArIGVuY29kZShyZWNlaXZlZG1zZ1RvSGFzaCksIHNpZ25hdHVyZSk7XHJcblxyXG4gICAgICAgICAgICAvLyB2YWxpZGF0ZXMgdGhlIHNpZ25hdHVyZSByZWNlaXZlZFxyXG4gICAgICAgICAgfSkudGhlbihzaWduVmFsaWRhdGlvblJlc3VsdCA9PiB7XHJcblxyXG4gICAgICAgICAgICAvL2xvZy5sb2coJ1NlbmRlckNlcnRpZmljYXRlIC0gc2lnbmF0dXJlIHZhbGlkYXRpb24gcmVzdWx0ICcsIHNpZ25WYWxpZGF0aW9uUmVzdWx0KTtcclxuICAgICAgICAgICAgbGV0IGNvbmNhdEtleSA9IF90aGlzLmNyeXB0by5jb25jYXRQTVN3aXRoUmFuZG9tcyhjaGF0S2V5cy5rZXlzLnByZW1hc3RlcktleSwgY2hhdEtleXMua2V5cy50b1JhbmRvbSwgY2hhdEtleXMua2V5cy5mcm9tUmFuZG9tKTtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiBfdGhpcy5jcnlwdG8uZ2VuZXJhdGVNYXN0ZXJTZWNyZXQoY29uY2F0S2V5LCAnbWVzc2FnZUhpc3RvcmljJyArIGNoYXRLZXlzLmtleXMudG9SYW5kb20gKyBjaGF0S2V5cy5rZXlzLmZyb21SYW5kb20pO1xyXG5cclxuICAgICAgICAgICAgLy8gZ2VuZXJhdGVzIHRoZSBtYXN0ZXIga2V5cyBmcm9tIHRoZSBQcmVtYXN0ZXIga2V5IGFuZCB0aGUgcmFuZG9tc1xyXG4gICAgICAgICAgfSkudGhlbihtYXN0ZXJLZXkgPT4ge1xyXG4gICAgICAgICAgICBjaGF0S2V5cy5rZXlzLm1hc3RlcktleSA9IG1hc3RlcktleTtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiBfdGhpcy5jcnlwdG8uZ2VuZXJhdGVLZXlzKG1hc3RlcktleSwgJ2tleSBleHBhbnNpb24nICsgY2hhdEtleXMua2V5cy50b1JhbmRvbSArIGNoYXRLZXlzLmtleXMuZnJvbVJhbmRvbSk7XHJcblxyXG4gICAgICAgICAgICAvLyBnZW5lcmF0ZXMgdGhlIHN5bW1ldHJpYyBrZXlzIHRvIGJlIHVzZWQgaW4gdGhlIHN5bW1ldHJpYyBlbmNyeXB0aW9uXHJcbiAgICAgICAgICB9KS50aGVuKGtleXMgPT4ge1xyXG4gICAgICAgICAgICBjaGF0S2V5cy5rZXlzLmh5cGVydHlGcm9tU2Vzc2lvbktleSA9IG5ldyBVaW50OEFycmF5KGtleXNbMF0pO1xyXG4gICAgICAgICAgICBjaGF0S2V5cy5rZXlzLmh5cGVydHlUb1Nlc3Npb25LZXkgPSBuZXcgVWludDhBcnJheShrZXlzWzFdKTtcclxuICAgICAgICAgICAgY2hhdEtleXMua2V5cy5oeXBlcnR5RnJvbUhhc2hLZXkgPSBuZXcgVWludDhBcnJheShrZXlzWzJdKTtcclxuICAgICAgICAgICAgY2hhdEtleXMua2V5cy5oeXBlcnR5VG9IYXNoS2V5ID0gbmV3IFVpbnQ4QXJyYXkoa2V5c1szXSk7XHJcbiAgICAgICAgICAgIGl2ID0gZGVjb2RlVG9VaW50OEFycmF5KHJlY2VpdmVkVmFsdWUuaXYpO1xyXG4gICAgICAgICAgICBsZXQgZGF0YSA9IGRlY29kZVRvVWludDhBcnJheShyZWNlaXZlZFZhbHVlLnN5bWV0cmljRW5jcnlwdGlvbik7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gX3RoaXMuY3J5cHRvLmRlY3J5cHRBRVMoY2hhdEtleXMua2V5cy5oeXBlcnR5VG9TZXNzaW9uS2V5LCBkYXRhLCBpdik7XHJcblxyXG4gICAgICAgICAgfSkudGhlbihkZWNyeXB0ZWREYXRhID0+IHtcclxuICAgICAgICAgICAgLy8gbG9nLmxvZygnZGVjcnlwdGVkRGF0YScsIGRlY3J5cHRlZERhdGEpO1xyXG5cclxuICAgICAgICAgICAgY2hhdEtleXMuaGFuZHNoYWtlSGlzdG9yeS5zZW5kZXJDZXJ0aWZpY2F0ZSA9IF90aGlzLl9maWx0ZXJNZXNzYWdlVG9IYXNoKG1lc3NhZ2UsIGRlY3J5cHRlZERhdGEgKyBpdik7XHJcblxyXG4gICAgICAgICAgICBsZXQgaGFzaFJlY2VpdmVkID0gZGVjb2RlVG9VaW50OEFycmF5KHJlY2VpdmVkVmFsdWUuaGFzaCk7XHJcblxyXG4gICAgICAgICAgICBmaWx0ZXJlZE1lc3NhZ2UgPSBfdGhpcy5fZmlsdGVyTWVzc2FnZVRvSGFzaChtZXNzYWdlLCBkZWNyeXB0ZWREYXRhICsgaXYpO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIF90aGlzLmNyeXB0by52ZXJpZnlITUFDKGNoYXRLZXlzLmtleXMuaHlwZXJ0eVRvSGFzaEtleSwgZmlsdGVyZWRNZXNzYWdlLCBoYXNoUmVjZWl2ZWQpO1xyXG5cclxuICAgICAgICAgIH0pLnRoZW4odmVyaWZpZWRIYXNoICA9PiB7XHJcblxyXG4gICAgICAgICAgICAvLyBsb2cubG9nKCdyZXN1bHQgb2YgaGFzaCB2ZXJpZmljYXRpb24gJywgdmVyaWZpZWRIYXNoKTtcclxuICAgICAgICAgICAgbGV0IHJlY2VpdmVyRmluaXNoZWRNZXNzYWdlID0ge1xyXG4gICAgICAgICAgICAgIHR5cGU6ICdoYW5kc2hha2UnLFxyXG4gICAgICAgICAgICAgIHRvOiBtZXNzYWdlLmZyb20sXHJcbiAgICAgICAgICAgICAgZnJvbTogbWVzc2FnZS50byxcclxuICAgICAgICAgICAgICBib2R5OiB7XHJcbiAgICAgICAgICAgICAgICBoYW5kc2hha2VQaGFzZTogJ3JlY2VpdmVyRmluaXNoZWRNZXNzYWdlJ1xyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgaXYgPSBfdGhpcy5jcnlwdG8uZ2VuZXJhdGVJVigpO1xyXG4gICAgICAgICAgICB2YWx1ZS5pdiA9IGVuY29kZShpdik7XHJcblxyXG4gICAgICAgICAgICBmaWx0ZXJlZE1lc3NhZ2UgPSBfdGhpcy5fZmlsdGVyTWVzc2FnZVRvSGFzaChyZWNlaXZlckZpbmlzaGVkTWVzc2FnZSwgJ29rIScgKyBpdiwgY2hhdEtleXMuaHlwZXJ0eUZyb20ubWVzc2FnZUluZm8pO1xyXG5cclxuICAgICAgICAgICAgLy9sb2cubG9nKCdUSUFHTzogZG9IYW5kU2hha2VQaGFzZSB2ZXJpZmllZEhhc2gnKTtcclxuICAgICAgICAgICAgcmV0dXJuIF90aGlzLmNyeXB0by5oYXNoSE1BQyhjaGF0S2V5cy5rZXlzLmh5cGVydHlGcm9tSGFzaEtleSwgZmlsdGVyZWRNZXNzYWdlKTtcclxuICAgICAgICAgIH0pLnRoZW4oaGFzaCA9PiB7XHJcblxyXG4gICAgICAgICAgICB2YWx1ZS5oYXNoID0gZW5jb2RlKGhhc2gpO1xyXG4gICAgICAgICAgICByZXR1cm4gX3RoaXMuY3J5cHRvLmVuY3J5cHRBRVMoY2hhdEtleXMua2V5cy5oeXBlcnR5RnJvbVNlc3Npb25LZXksICdvayEnLCBpdik7XHJcblxyXG4gICAgICAgICAgfSkudGhlbihlbmNyeXB0ZWRWYWx1ZSA9PiB7XHJcbiAgICAgICAgICAgIHZhbHVlLnZhbHVlID0gZW5jb2RlKGVuY3J5cHRlZFZhbHVlKTtcclxuICAgICAgICAgICAgbGV0IHJlY2VpdmVyRmluaXNoZWRNZXNzYWdlID0ge1xyXG4gICAgICAgICAgICAgIHR5cGU6ICdoYW5kc2hha2UnLFxyXG4gICAgICAgICAgICAgIHRvOiBtZXNzYWdlLmZyb20sXHJcbiAgICAgICAgICAgICAgZnJvbTogbWVzc2FnZS50byxcclxuICAgICAgICAgICAgICBib2R5OiB7XHJcbiAgICAgICAgICAgICAgICBoYW5kc2hha2VQaGFzZTogJ3JlY2VpdmVyRmluaXNoZWRNZXNzYWdlJyxcclxuICAgICAgICAgICAgICAgIHZhbHVlOiBlbmNvZGUodmFsdWUpXHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgY2hhdEtleXMuaGFuZHNoYWtlSGlzdG9yeS5yZWNlaXZlckZpbmlzaGVkTWVzc2FnZSA9IF90aGlzLl9maWx0ZXJNZXNzYWdlVG9IYXNoKHJlY2VpdmVyRmluaXNoZWRNZXNzYWdlLCAnb2shJyArIGl2LCBjaGF0S2V5cy5oeXBlcnR5RnJvbS5tZXNzYWdlSW5mbyk7XHJcbiAgICAgICAgICAgIGNoYXRLZXlzLmF1dGhlbnRpY2F0ZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICByZXNvbHZlKHttZXNzYWdlOiByZWNlaXZlckZpbmlzaGVkTWVzc2FnZSwgY2hhdEtleXM6IGNoYXRLZXlzfSk7XHJcbiAgICAgICAgICB9KS5jYXRjaChlcnIgPT4ge1xyXG4gICAgICAgICAgICByZWplY3QoJ09uIF9kb0hhbmRTaGFrZVBoYXNlIGZyb20gc2VuZGVyQ2VydGlmaWNhdGUgZXJyb3I6ICcgKyBlcnIpO1xyXG4gICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNhc2UgJ3JlY2VpdmVyRmluaXNoZWRNZXNzYWdlJzoge1xyXG5cclxuICAgICAgICAgIGNoYXRLZXlzLmF1dGhlbnRpY2F0ZWQgPSB0cnVlO1xyXG5cclxuICAgICAgICAgIHZhbHVlID0gZGVjb2RlKG1lc3NhZ2UuYm9keS52YWx1ZSk7XHJcblxyXG4gICAgICAgICAgaXYgPSBkZWNvZGVUb1VpbnQ4QXJyYXkodmFsdWUuaXYpO1xyXG4gICAgICAgICAgbGV0IGRhdGEgPSBkZWNvZGVUb1VpbnQ4QXJyYXkodmFsdWUudmFsdWUpO1xyXG4gICAgICAgICAgaGFzaCA9IGRlY29kZVRvVWludDhBcnJheSh2YWx1ZS5oYXNoKTtcclxuXHJcbiAgICAgICAgICBfdGhpcy5jcnlwdG8uZGVjcnlwdEFFUyhjaGF0S2V5cy5rZXlzLmh5cGVydHlUb1Nlc3Npb25LZXksIGRhdGEsIGl2KS50aGVuKGRlY3J5cHRlZERhdGEgPT4ge1xyXG4gICAgICAgICAgICAvLyBsb2cubG9nKCdkZWNyeXB0ZWREYXRhJywgZGVjcnlwdGVkRGF0YSk7XHJcbiAgICAgICAgICAgIGNoYXRLZXlzLmhhbmRzaGFrZUhpc3RvcnkucmVjZWl2ZXJGaW5pc2hlZE1lc3NhZ2UgPSBfdGhpcy5fZmlsdGVyTWVzc2FnZVRvSGFzaChtZXNzYWdlLCBkZWNyeXB0ZWREYXRhICsgaXYpO1xyXG5cclxuICAgICAgICAgICAgbGV0IGZpbHRlcmVkTWVzc2FnZSA9IF90aGlzLl9maWx0ZXJNZXNzYWdlVG9IYXNoKG1lc3NhZ2UsIGRlY3J5cHRlZERhdGEgKyBpdik7XHJcbiAgICAgICAgICAgIF90aGlzLmNyeXB0by52ZXJpZnlITUFDKGNoYXRLZXlzLmtleXMuaHlwZXJ0eVRvSGFzaEtleSwgZmlsdGVyZWRNZXNzYWdlLCBoYXNoKS50aGVuKHJlc3VsdCA9PiB7XHJcblxyXG4gICAgICAgICAgICAgIC8vIGNoZWNrIGlmIHRoZXJlIHdhcyBhbiBpbml0aWFsIG1lc3NhZ2UgdGhhdCB3YXMgYmxvY2tlZCBhbmQgc2VuZCBpdFxyXG4gICAgICAgICAgICAgIGlmIChjaGF0S2V5cy5pbml0aWFsTWVzc2FnZSkge1xyXG5cclxuICAgICAgICAgICAgICAgIGxldCBpbml0aWFsTWVzc2FnZSA9IHtcclxuICAgICAgICAgICAgICAgICAgdHlwZTogJ2NyZWF0ZScsXHJcbiAgICAgICAgICAgICAgICAgIHRvOiBtZXNzYWdlLmZyb20sXHJcbiAgICAgICAgICAgICAgICAgIGZyb206IG1lc3NhZ2UudG8sXHJcbiAgICAgICAgICAgICAgICAgIGJvZHk6IHtcclxuICAgICAgICAgICAgICAgICAgICB2YWx1ZTogY2hhdEtleXMuaW5pdGlhbE1lc3NhZ2UuYm9keS52YWx1ZVxyXG4gICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgIHJlc29sdmUoe21lc3NhZ2U6IGluaXRpYWxNZXNzYWdlLCBjaGF0S2V5czogY2hhdEtleXN9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAvL3NlbmRzIHRoZSBzZXNzaW9uS2V5IHRvIHRoZSBzdWJzY3JpYmVyIGh5cGVydHlcclxuICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgX3RoaXMuX3NlbmRSZXBvcnRlclNlc3Npb25LZXkobWVzc2FnZSwgY2hhdEtleXMpLnRoZW4odmFsdWUgPT4ge1xyXG5cclxuICAgICAgICAgICAgICAgICAgcmVzb2x2ZSh2YWx1ZSk7XHJcbiAgICAgICAgICAgICAgICB9KS5jYXRjaChlcnIgPT4ge1xyXG4gICAgICAgICAgICAgICAgICByZWplY3QoJ09uIF9kb0hhbmRTaGFrZVBoYXNlIGZyb20gcmVjZWl2ZXJGaW5pc2hlZE1lc3NhZ2UgZXJyb3I6ICcgKyBlcnIpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY2FzZSAncmVwb3J0ZXJTZXNzaW9uS2V5Jzoge1xyXG5cclxuICAgICAgICAgIGxvZy5sb2coJ3JlcG9ydGVyU2Vzc2lvbktleScpO1xyXG5cclxuICAgICAgICAgIGxldCB2YWx1ZUlWYW5kSGFzaCA9IGRlY29kZShtZXNzYWdlLmJvZHkudmFsdWUpO1xyXG4gICAgICAgICAgaGFzaCA9IGRlY29kZVRvVWludDhBcnJheSh2YWx1ZUlWYW5kSGFzaC5oYXNoKTtcclxuICAgICAgICAgIGl2ID0gZGVjb2RlVG9VaW50OEFycmF5KHZhbHVlSVZhbmRIYXNoLml2KTtcclxuICAgICAgICAgIGxldCBlbmNyeXB0ZWRWYWx1ZSA9IGRlY29kZVRvVWludDhBcnJheSh2YWx1ZUlWYW5kSGFzaC52YWx1ZSk7XHJcbiAgICAgICAgICBsZXQgcGFyc2VkVmFsdWU7XHJcbiAgICAgICAgICBsZXQgc2Vzc2lvbktleTtcclxuICAgICAgICAgIGxldCBkYXRhT2JqZWN0VVJMO1xyXG4gICAgICAgICAgbGV0IHJlY2VpdmVyQWNrbm93bGVkZ2VNc2c7XHJcblxyXG4gICAgICAgICAgLy9sb2cubG9nKCdbSWRlbnRpdHlNb2R1bGUgcmVwb3J0ZXJTZXNzaW9uS2V5XSAtIGRlY3J5cHRBRVM6ICcsIGNoYXRLZXlzLmtleXMuaHlwZXJ0eVRvU2Vzc2lvbktleSwgZW5jcnlwdGVkVmFsdWUsIGl2KTtcclxuXHJcbiAgICAgICAgICBfdGhpcy5jcnlwdG8uZGVjcnlwdEFFUyhjaGF0S2V5cy5rZXlzLmh5cGVydHlUb1Nlc3Npb25LZXksIGVuY3J5cHRlZFZhbHVlLCBpdikudGhlbihkZWNyeXB0ZWRWYWx1ZSA9PiB7XHJcblxyXG4gICAgICAgICAgICBwYXJzZWRWYWx1ZSA9IGRlY29kZShkZWNyeXB0ZWRWYWx1ZSk7XHJcbiAgICAgICAgICAgIHNlc3Npb25LZXkgPSBkZWNvZGVUb1VpbnQ4QXJyYXkocGFyc2VkVmFsdWUudmFsdWUpO1xyXG4gICAgICAgICAgICBkYXRhT2JqZWN0VVJMID0gcGFyc2VkVmFsdWUuZGF0YU9iamVjdFVSTDtcclxuXHJcbiAgICAgICAgICAgIGxldCBtZXNzYWdlVG9IYXNoID0gX3RoaXMuX2ZpbHRlck1lc3NhZ2VUb0hhc2gobWVzc2FnZSwgZGVjcnlwdGVkVmFsdWUgKyBpdik7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gX3RoaXMuY3J5cHRvLnZlcmlmeUhNQUMoY2hhdEtleXMua2V5cy5oeXBlcnR5VG9IYXNoS2V5LCBtZXNzYWdlVG9IYXNoLCBoYXNoKTtcclxuXHJcbiAgICAgICAgICB9KS50aGVuKGhhc2hSZXN1bHQgPT4ge1xyXG5cclxuXHJcbiAgICAgICAgICAgIC8vIGxvZy5sb2coJ2hhc2ggc3VjY2Vzc2Z1bGx5IHZhbGlkYXRlZCAnLCBoYXNoUmVzdWx0KTtcclxuXHJcbiAgICAgICAgICAgIF90aGlzLmRhdGFPYmplY3RTZXNzaW9uS2V5c1tkYXRhT2JqZWN0VVJMXSA9ICB7c2Vzc2lvbktleTogc2Vzc2lvbktleSwgaXNUb0VuY3J5cHQ6IHRydWV9O1xyXG4gICAgICAgICAgICBsZXQgZGF0YU9iamVjdFNlc3Npb25LZXlzQ2xvbmUgPSBjaGF0a2V5c1RvU3RyaW5nQ2xvbmVyKF90aGlzLmRhdGFPYmplY3RTZXNzaW9uS2V5cyk7XHJcbiAgICAgICAgICAgIF90aGlzLnN0b3JhZ2VNYW5hZ2VyLnNldCgnZGF0YU9iamVjdFNlc3Npb25LZXlzJywgMCwgZGF0YU9iamVjdFNlc3Npb25LZXlzQ2xvbmUpLmNhdGNoKGVyciA9PiB7XHJcbiAgICAgICAgICAgICAgcmVqZWN0KCdPbiBfc2VuZFJlcG9ydGVyU2Vzc2lvbktleSBmcm9tIG1ldGhvZCByZXBvcnRlclNlc3Npb25LZXkgZXJyb3I6ICcgKyBlcnIpO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIGl2ID0gX3RoaXMuY3J5cHRvLmdlbmVyYXRlSVYoKTtcclxuICAgICAgICAgICAgdmFsdWUuaXYgPSBlbmNvZGUoaXYpO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIF90aGlzLmNyeXB0by5lbmNyeXB0QUVTKGNoYXRLZXlzLmtleXMuaHlwZXJ0eUZyb21TZXNzaW9uS2V5LCAnb2shIScsIGl2KTtcclxuICAgICAgICAgIH0pLnRoZW4oZW5jcnlwdGVkVmFsdWUgPT4ge1xyXG5cclxuICAgICAgICAgICAgcmVjZWl2ZXJBY2tub3dsZWRnZU1zZyA9IHtcclxuICAgICAgICAgICAgICB0eXBlOiAnaGFuZHNoYWtlJyxcclxuICAgICAgICAgICAgICB0bzogbWVzc2FnZS5mcm9tLFxyXG4gICAgICAgICAgICAgIGZyb206IG1lc3NhZ2UudG8sXHJcbiAgICAgICAgICAgICAgYm9keToge1xyXG4gICAgICAgICAgICAgICAgaGFuZHNoYWtlUGhhc2U6ICdyZWNlaXZlckFja25vd2xlZGdlJ1xyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgIHZhbHVlLnZhbHVlID0gZW5jb2RlKGVuY3J5cHRlZFZhbHVlKTtcclxuICAgICAgICAgICAgbGV0IG1lc3NhZ2VUb0hhc2ggPSBfdGhpcy5fZmlsdGVyTWVzc2FnZVRvSGFzaChyZWNlaXZlckFja25vd2xlZGdlTXNnLCAnb2shIScgKyBpdiwgY2hhdEtleXMuaHlwZXJ0eUZyb20ubWVzc2FnZUluZm8pO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIF90aGlzLmNyeXB0by5oYXNoSE1BQyhjaGF0S2V5cy5rZXlzLmh5cGVydHlGcm9tSGFzaEtleSwgbWVzc2FnZVRvSGFzaCk7XHJcbiAgICAgICAgICB9KS50aGVuKGhhc2hlZE1lc3NhZ2UgPT4ge1xyXG4gICAgICAgICAgICBsZXQgZmluYWxWYWx1ZSA9IGVuY29kZSh7dmFsdWU6IHZhbHVlLnZhbHVlLCBoYXNoOiBlbmNvZGUoaGFzaGVkTWVzc2FnZSksIGl2OiB2YWx1ZS5pdn0pO1xyXG5cclxuICAgICAgICAgICAgcmVjZWl2ZXJBY2tub3dsZWRnZU1zZy5ib2R5LnZhbHVlID0gZmluYWxWYWx1ZTtcclxuICAgICAgICAgICAgcmVzb2x2ZSh7bWVzc2FnZTogcmVjZWl2ZXJBY2tub3dsZWRnZU1zZywgY2hhdEtleXM6IGNoYXRLZXlzfSk7XHJcbiAgICAgICAgICB9KS5jYXRjaChlcnIgPT4ge1xyXG4gICAgICAgICAgICByZWplY3QoJ09uIF9kb0hhbmRTaGFrZVBoYXNlIGZyb20gcmVwb3J0ZXJTZXNzaW9uS2V5IGVycm9yOiAnICsgZXJyKTtcclxuICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY2FzZSAncmVjZWl2ZXJBY2tub3dsZWRnZSc6IHtcclxuXHJcbiAgICAgICAgICBsb2cubG9nKCdyZWNlaXZlckFja25vd2xlZGdlJyk7XHJcblxyXG4gICAgICAgICAgbGV0IHJlY2VpdmVkdmFsdWVJVmFuZEhhc2ggPSBkZWNvZGUobWVzc2FnZS5ib2R5LnZhbHVlKTtcclxuICAgICAgICAgIGxldCByZWNlaXZlZEhhc2ggPSBkZWNvZGVUb1VpbnQ4QXJyYXkocmVjZWl2ZWR2YWx1ZUlWYW5kSGFzaC5oYXNoKTtcclxuICAgICAgICAgIGl2ID0gZGVjb2RlVG9VaW50OEFycmF5KHJlY2VpdmVkdmFsdWVJVmFuZEhhc2guaXYpO1xyXG4gICAgICAgICAgbGV0IHJlY2VpdmVkRW5jcnlwdGVkVmFsdWUgPSBkZWNvZGVUb1VpbnQ4QXJyYXkocmVjZWl2ZWR2YWx1ZUlWYW5kSGFzaC52YWx1ZSk7XHJcblxyXG4gICAgICAgICAgX3RoaXMuY3J5cHRvLmRlY3J5cHRBRVMoY2hhdEtleXMua2V5cy5oeXBlcnR5VG9TZXNzaW9uS2V5LCByZWNlaXZlZEVuY3J5cHRlZFZhbHVlLCBpdikudGhlbihkZWNyeXB0ZWRWYWx1ZSA9PiB7XHJcblxyXG4gICAgICAgICAgICBsZXQgZmlsdGVyZWRNZXNzYWdlID0gX3RoaXMuX2ZpbHRlck1lc3NhZ2VUb0hhc2gobWVzc2FnZSwgZGVjcnlwdGVkVmFsdWUgKyBpdik7XHJcbiAgICAgICAgICAgIHJldHVybiBfdGhpcy5jcnlwdG8udmVyaWZ5SE1BQyhjaGF0S2V5cy5rZXlzLmh5cGVydHlUb0hhc2hLZXksIGZpbHRlcmVkTWVzc2FnZSwgcmVjZWl2ZWRIYXNoKTtcclxuICAgICAgICAgIH0pLnRoZW4oaGFzaFJlc3VsdCA9PiB7XHJcbiAgICAgICAgICAgIC8vIGxvZy5sb2coJ2hhc2hSZXN1bHQgJywgaGFzaFJlc3VsdCk7XHJcblxyXG4gICAgICAgICAgICBsZXQgY2FsbGJhY2sgPSBjaGF0S2V5cy5jYWxsYmFjaztcclxuXHJcbiAgICAgICAgICAgIGlmIChjYWxsYmFjaykge1xyXG4gICAgICAgICAgICAgIGNhbGxiYWNrKCdoYW5kU2hha2VFbmQnKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXNvbHZlKCdoYW5kU2hha2VFbmQnKTtcclxuICAgICAgICAgIH0pLmNhdGNoKGVyciA9PiB7XHJcbiAgICAgICAgICAgIHJlamVjdCgnT24gX2RvSGFuZFNoYWtlUGhhc2UgZnJvbSByZWNlaXZlckFja25vd2xlZGdlIGVycm9yOiAnICsgZXJyKTtcclxuICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgIHJlamVjdChtZXNzYWdlKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAqIGZpbHRlciB0aGUgbWVzc2FnZXMgdG8gaGFzaCwgYnkgcmVtb3Zpbmcgc29tZSBmaWVsZHMgbm90IGdlbmVyYXRlZCBieSB0aGUgcnVudGltZSBjb3JlXHJcbiAgKiBAcGFyYW0ge01lc3NhZ2V9ICBtZXNzYWdlICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZVxyXG4gICogQHBhcmFtIHtTdHJpbmd9ICBkZWNyeXB0ZWRWYWx1ZSAoT3B0aW9uYWwpICAgIHZhbHVlIGZyb20gYm9keS52YWx1ZSBpbiBjYXNlIGl0IG9yaWdpbmFsbHkgY29tZXMgZW5jcnlwdGVkXHJcbiAgKiBAcGFyYW0ge0pTT059ICBpZGVudGl0eShPcHRpb25hbCkgICAgYWRkIHRoZSBoeXBlcnR5IGlkZW50aXR5IGFzc29jaWF0ZWQgaW4gY2FzZSBpcyBub3QgYWRkZWQgdG8gdGhlIGluaXRpYWwgbWVzc2FnZVxyXG4gICogQHJldHVybiB7TWVzc2FnZX0gIG5ldyBtZXNzYWdlIGZpbHRlcmVkXHJcbiAgKi9cclxuICBfZmlsdGVyTWVzc2FnZVRvSGFzaChtZXNzYWdlLCBkZWNyeXB0ZWRWYWx1ZSwgaWRlbnRpdHkpIHtcclxuXHJcbiAgICByZXR1cm4ge1xyXG4gICAgICB0eXBlOiBtZXNzYWdlLnR5cGUsXHJcbiAgICAgIGZyb206IG1lc3NhZ2UuZnJvbSxcclxuICAgICAgdG86IG1lc3NhZ2UudG8sXHJcbiAgICAgIGJvZHk6IHtcclxuICAgICAgICBpZGVudGl0eTogaWRlbnRpdHkgfHwgbWVzc2FnZS5ib2R5LmlkZW50aXR5LFxyXG4gICAgICAgIHZhbHVlOiBkZWNyeXB0ZWRWYWx1ZSB8fCBtZXNzYWdlLmJvZHkudmFsdWUsXHJcbiAgICAgICAgaGFuZHNoYWtlUGhhc2U6IG1lc3NhZ2UuYm9keS5oYW5kc2hha2VQaGFzZVxyXG4gICAgICB9XHJcbiAgICB9O1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgKiBnZW5lcmF0ZXMgdGhlIGluaXRpYWwgc3RydWN0dXJlIGZvciB0aGUga2V5cyBiZXR3ZWVuIHR3byB1c2Vyc1xyXG4gICogQHBhcmFtIHtKU09OfSAgICBtZXNzYWdlICAgICAgICAgICAgICBpbml0aWFsIG1lc3NhZ2UgdGhhdCB0cmlnZ2VycyB0aGUgbXV0dWFsIGF1dGhlbnRpY2F0aW9uXHJcbiAgKiBAcGFyYW0ge1N0cmluZ30gIHVzZXJVUkwgICAgICAgICAgICAgIHVzZXJVUkxcclxuICAqIEBwYXJhbSB7Ym9vbGVhbn0gcmVjZWl2ZXIoT3B0aW9uYWwpICBpbmRpY2F0ZXMgaWYgaXMgdGhlIHNlbmRlciBvciB0aGUgcmVjZWl2ZXIgdGhhdCBjcmVhdGVzIGEgbmV3IGNoYXQgY3J5cHRvXHJcbiAgKiBAcmV0dXJuIHtKU09OfSBuZXdDaGF0Q3J5cHRvICBuZXcgSlNPTiBzdHJ1Y3R1cmUgZm9yIHRoZSBjaGF0IGNyeXB0b1xyXG4gICovXHJcbiAgX25ld0NoYXRDcnlwdG8obWVzc2FnZSwgdXNlclVSTCwgcmVjZWl2ZXIpIHtcclxuICAgIGxldCBfdGhpcyA9IHRoaXM7XHJcblxyXG4gICAgLy9jaGVjayB3aGV0aGVyIGlzIHRoZSBzZW5kZXIgb3IgdGhlIHJlY2VpdmVyIHRvIGNyZWF0ZSBhIG5ldyBjaGF0Q3J5cHRvXHJcbiAgICAvL3RvIG1hbnRhaW4gY29uc2lzdGVuY3kgb24gdGhlIGtleXMgaWYgdGhlIHJlY2VpdmVyIGNyZWF0ZSBhIG5ldyBjaGF0Q3J5cHRvLFxyXG4gICAgLy90aGVuIGludmVydCB0aGUgZmllbGRzXHJcbiAgICBsZXQgZnJvbSA9IChyZWNlaXZlcikgPyBtZXNzYWdlLnRvIDogbWVzc2FnZS5mcm9tO1xyXG4gICAgbGV0IHRvID0gKHJlY2VpdmVyKSA/IG1lc3NhZ2UuZnJvbSA6IG1lc3NhZ2UudG87XHJcblxyXG4gICAgbGV0IHVzZXJJbmZvID0gX3RoaXMuX2lkbS5nZXRJZGVudGl0eSh1c2VyVVJMKTtcclxuXHJcbiAgICBsZXQgbmV3Q2hhdENyeXB0byA9XHJcbiAgICAgIHtcclxuICAgICAgICBoeXBlcnR5RnJvbTpcclxuICAgICAgICB7XHJcbiAgICAgICAgICBoeXBlcnR5OiBmcm9tLFxyXG4gICAgICAgICAgdXNlcklEOiB1c2VySW5mby51c2VyUHJvZmlsZS51c2VyVVJMLFxyXG5cclxuICAgICAgICAgIC8vcHJpdmF0ZUtleTogXCJnZXRNeVB1YmxpY0tleVwiLFxyXG4gICAgICAgICAgLy9wdWJsaWNLZXk6IFwiZ2V0TXlQcml2YXRlS2V5XCIsXHJcbiAgICAgICAgICBhc3NlcnRpb246IHVzZXJJbmZvLmFzc2VydGlvbixcclxuICAgICAgICAgIG1lc3NhZ2VJbmZvOiB1c2VySW5mb1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgaHlwZXJ0eVRvOlxyXG4gICAgICAgIHtcclxuICAgICAgICAgIGh5cGVydHk6IHRvLFxyXG4gICAgICAgICAgdXNlcklEOiB1bmRlZmluZWQsXHJcbiAgICAgICAgICBwdWJsaWNLZXk6IHVuZGVmaW5lZCxcclxuICAgICAgICAgIGFzc2VydGlvbjogdW5kZWZpbmVkXHJcbiAgICAgICAgfSxcclxuICAgICAgICBrZXlzOlxyXG4gICAgICAgIHtcclxuICAgICAgICAgIGh5cGVydHlUb1Nlc3Npb25LZXk6IHVuZGVmaW5lZCxcclxuICAgICAgICAgIGh5cGVydHlGcm9tU2Vzc2lvbktleTogdW5kZWZpbmVkLFxyXG4gICAgICAgICAgaHlwZXJ0eVRvSGFzaEtleTogdW5kZWZpbmVkLFxyXG4gICAgICAgICAgaHlwZXJ0eUZyb21IYXNoS2V5OiB1bmRlZmluZWQsXHJcbiAgICAgICAgICB0b1JhbmRvbTogdW5kZWZpbmVkLFxyXG4gICAgICAgICAgZnJvbVJhbmRvbTogdW5kZWZpbmVkLFxyXG4gICAgICAgICAgcHJlbWFzdGVyS2V5OiB1bmRlZmluZWQsXHJcbiAgICAgICAgICBtYXN0ZXJLZXk6IHVuZGVmaW5lZFxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgaGFuZHNoYWtlSGlzdG9yeToge1xyXG4gICAgICAgICAgc2VuZGVySGVsbG86IHVuZGVmaW5lZCxcclxuICAgICAgICAgIHJlY2VpdmVySGVsbG86IHVuZGVmaW5lZCxcclxuICAgICAgICAgIHNlbmRlckNlcnRpZmljYXRlOiB1bmRlZmluZWQsXHJcbiAgICAgICAgICByZWNlaXZlckZpbmlzaGVkTWVzc2FnZTogdW5kZWZpbmVkXHJcbiAgICAgICAgfSxcclxuICAgICAgICBpbml0aWFsTWVzc2FnZTogKG1lc3NhZ2UuYm9keS5pZ25vcmUpID8gdW5kZWZpbmVkIDogbWVzc2FnZSxcclxuICAgICAgICBjYWxsYmFjazogbWVzc2FnZS5jYWxsYmFjayxcclxuICAgICAgICBhdXRoZW50aWNhdGVkOiBmYWxzZSxcclxuICAgICAgICBkYXRhT2JqZWN0VVJMOiBtZXNzYWdlLmRhdGFPYmplY3RVUkxcclxuICAgICAgfTtcclxuXHJcbiAgICByZXR1cm4gbmV3Q2hhdENyeXB0bztcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICogUmV0cmlldmVzIGEgcHVibGljIGtleXMgZ2l2ZW4gYSB1c2VyIHJlZnJlbmNlLiBJZiBubyBrZXkgaXMgZm91bmQsXHJcbiAgZ2VuZXJhdGVzIGEgbmV3IGtleSBhc3ltbWV0cmljIGtleSBhbmQgcmV0cmlldmVzIHRoZSBwdWJsaWMga2V5cy5cclxuICAqIEBwYXJhbSAgIHt1c2VyUmVmfSAgICBTdHJpbmcgICAgdXNlciByZWZlcmVuY2UgZm9yIHRoZSBrZXkgcGFpclxyXG4gICogQHJldHVybiAge0FycmF5fSAgIHB1YmxpYyBrZXlcclxuICAqL1xyXG4gIGdldE15UHVibGljS2V5KHVzZXJSZWYgPSB0aGlzLnVzZXJEZWZhdWx0S2V5UmVmKSB7XHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcclxuICAgICAgX3RoaXMuc3RvcmFnZU1hbmFnZXIuZ2V0KHVzZXJSZWYpLnRoZW4oc3RvcmVkS2V5UGFpciA9PiB7XHJcbiAgICAgICAgaWYgKHN0b3JlZEtleVBhaXIpIHtcclxuICAgICAgICAgIHJldHVybiByZXNvbHZlKHN0b3JlZEtleVBhaXIucHVibGljKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgX3RoaXMuX2dlbmVyYXRlQW5kU3RvcmVOZXdBc3ltZXRyaWNLZXkodXNlclJlZikudGhlbihnZW5lcmF0ZWRLZXlQYWlyID0+IHtcclxuICAgICAgICAgIHJlc29sdmUoZ2VuZXJhdGVkS2V5UGFpci5wdWJsaWMpO1xyXG4gICAgICAgIH0pLmNhdGNoKGVyciA9PiB7XHJcbiAgICAgICAgICBsb2cuZXJyb3IoJ1tnZXRNeVB1YmxpY0tleTpfZ2VuZXJhdGVBbmRTdG9yZU5ld0FzeW1ldHJpY0tleTplcnJdOiAnICsgZXJyLm1lc3NhZ2UpO1xyXG4gICAgICAgICAgcmVqZWN0KGVycik7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH0pLmNhdGNoKGVyciA9PiB7XHJcbiAgICAgICAgbG9nLmVycm9yKCdbZ2V0TXlQdWJsaWNLZXk6c3RvcmFnZU1hbmFnZXI6ZXJyXTogJyArIGVyci5tZXNzYWdlKTtcclxuICAgICAgICByZWplY3QoZXJyKTtcclxuICAgICAgfSk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICogUmV0cmlldmVzIGEgcHJpdmF0ZSBrZXlzIGdpdmVuIGEgdXNlciByZWZyZW5jZS4gSWYgbm8ga2V5IGlzIGZvdW5kLFxyXG4gIGdlbmVyYXRlcyBhIG5ldyBrZXkgYXN5bW1ldHJpYyBrZXkgYW5kIHJldHJpZXZlcyB0aGUgcHJpdmF0ZSBrZXkuXHJcbiAgKiBAcGFyYW0gICB7dXNlclJlZn0gICAgU3RyaW5nICAgIHVzZXIgcmVmZXJlbmNlIGZvciB0aGUga2V5IHBhaXJcclxuICAqIEByZXR1cm4gIHtBcnJheX0gICBwcml2YXRlIGtleVxyXG4gICoqL1xyXG4gIGdldE15UHJpdmF0ZUtleSh1c2VyUmVmID0gdGhpcy51c2VyRGVmYXVsdEtleVJlZikge1xyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XHJcbiAgICAgIF90aGlzLnN0b3JhZ2VNYW5hZ2VyLmdldCh1c2VyUmVmKS50aGVuKHN0b3JlZEtleVBhaXIgPT4ge1xyXG4gICAgICAgIGlmIChzdG9yZWRLZXlQYWlyKSB7XHJcbiAgICAgICAgICByZXR1cm4gcmVzb2x2ZShzdG9yZWRLZXlQYWlyLnByaXZhdGUpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBfdGhpcy5fZ2VuZXJhdGVBbmRTdG9yZU5ld0FzeW1ldHJpY0tleSh1c2VyUmVmKS50aGVuKGdlbmVyYXRlZEtleVBhaXIgPT4ge1xyXG4gICAgICAgICAgcmVzb2x2ZShnZW5lcmF0ZWRLZXlQYWlyLnByaXZhdGUpO1xyXG4gICAgICAgIH0pLmNhdGNoKGVyciA9PiB7XHJcbiAgICAgICAgICBsb2cuZXJyb3IoJ1tnZXRNeVByaXZhdGVLZXk6X2dlbmVyYXRlQW5kU3RvcmVOZXdBc3ltZXRyaWNLZXk6ZXJyXTogJyArIGVyci5tZXNzYWdlKTtcclxuICAgICAgICAgIHJlamVjdChlcnIpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICB9KS5jYXRjaChlcnIgPT4ge1xyXG4gICAgICAgIGxvZy5lcnJvcignW2dldE15UHJpdmF0ZUtleTpzdG9yYWdlTWFuYWdlcjplcnJdOiAnICsgZXJyLm1lc3NhZ2UpO1xyXG4gICAgICAgIHJlamVjdChlcnIpO1xyXG4gICAgICB9KTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcblxyXG4gIC8qKlxyXG4gICogR2VuZXJhdGVzIGEgbmV3IGtleSBwYWlyLCBzdG9yZXMgYW5kIHJldHJpdmVzIHRoZSBrZXkgcGFpci5cclxuICAqIEBwYXJhbSAgIHt1c2VyUmVmfSAgICBTdHJpbmcgICAgdXNlciByZWZlcmVuY2UgZm9yIHRoZSBrZXkgcGFpclxyXG4gICogQHJldHVybiAge0FycmF5fSAgIHByaXZhdGUga2V5XHJcbiAgKiovXHJcbiAgX2dlbmVyYXRlQW5kU3RvcmVOZXdBc3ltZXRyaWNLZXkodXNlclJlZikge1xyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuICAgIGxldCBrZXlQYWlyID0gdW5kZWZpbmVkO1xyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcclxuLy8gICAgICBfdGhpcy5jcnlwdG8uZ2VuZXJhdGVSU0FLZXlQYWlyKCkudGhlbihnZW5lcmF0ZWRLZXlQYWlyID0+IHtcclxuICAgICAgICBsZXQgZ2VuZXJhdGVkS2V5UGFpciA9IHt9O1xyXG4gICAgICAgIGdlbmVyYXRlZEtleVBhaXIucHJpdmF0ZSA9IGdlbmVyYXRlR1VJRCgpO1xyXG4gICAgICAgIGdlbmVyYXRlZEtleVBhaXIucHVibGljID0gZ2VuZXJhdGVHVUlEKCk7XHJcbiAgICAgICAgbG9nLmxvZygnX2dlbmVyYXRlQW5kU3RvcmVOZXdBc3ltZXRyaWNLZXk6dXNlckFzeW1tZXRyaWNLZXlHZW5lcmF0ZWQnLCBnZW5lcmF0ZWRLZXlQYWlyKTtcclxuICAgICAgICBrZXlQYWlyID0gZ2VuZXJhdGVkS2V5UGFpcjtcclxuICAgICAgICBfdGhpcy5zdG9yYWdlTWFuYWdlci5zZXQodXNlclJlZiwgMCwgZ2VuZXJhdGVkS2V5UGFpcik7XHJcbi8vICAgICAgfSkudGhlbihzdG9yZWRSZWZlcmVuY2UgPT4ge1xyXG4vLyAgICAgICAgbG9nLmxvZygnX2dlbmVyYXRlQW5kU3RvcmVOZXdBc3ltZXRyaWNLZXk6dXNlckFzeW1tZXRyaWNLZXlTdWNjZXNzJywgc3RvcmVkUmVmZXJlbmNlKTtcclxuICAgICAgICByZXNvbHZlKGtleVBhaXIpO1xyXG4gICAgICB9KS5jYXRjaChlcnIgPT4ge1xyXG4gICAgICAgIGxvZy5lcnJvcignW19nZW5lcmF0ZUFuZFN0b3JlTmV3QXN5bWV0cmljS2V5OmVycl06ICcgKyBlcnIubWVzc2FnZSk7XHJcbiAgICAgICAgcmVqZWN0KGVycik7XHJcbiAgICAgIH0pO1xyXG4vLyAgICB9KTtcclxuICB9XHJcblxyXG59XHJcblxyXG4vKlxyXG5jb25zdCBub2RlSlNLZXlQYWlyUG9wdWxhdGUgPSB7IHB1YmxpYzogWzQ4LCAxMzAsIDEsIDM0LCA0OCwgMTMsIDYsIDksIDQyLCAxMzQsIDcyLCAxMzQsIDI0NywgMTMsIDEsIDEsIDEsIDUsIDAsIDMsIDEzMCwgMSwgMTUsIDAsIDQ4LCAxMzAsIDEsIDEwLCAyLCAxMzAsIDEsIDEsIDAsIDIyOCwgNDMsIDEwMSwgMTIsIDEyMSwgNywgMTU3LCA3MSwgODEsIDU4LCAyMTksIDMyLCAxMCwgMTA4LCAxOTMsIDE3OSwgMjEyLCAxMTYsIDI1NSwgNTksIDIxNywgMzIsIDE2MSwgMjAxLCA1MywgMTcxLCAyMjYsIDE5OSwgMTM3LCAyMDIsIDE3MSwgNjAsIDgyLCA1MywgMTI1LCA2MiwgMTc3LCAxMjYsIDE2NSwgMjQsIDE0MSwgMzAsIDE1LCAyMjYsIDU5LCAxMDcsIDM0LCA3LCAxMywgMTQ5LCAxMTIsIDEyNSwgMTAsIDIzMCwgMTkxLCAxNTYsIDE2NCwgMTc3LCAxMCwgMTg1LCAxMywgNjYsIDMsIDIxNywgMTY2LCAyNDQsIDkwLCAxMTksIDExMSwgMjcsIDE0NSwgMTA0LCA3MSwgMTg5LCAxNjYsIDIyNiwgMjU1LCAxMzMsIDgzLCAxNTEsIDIzMSwgMTAxLCAxNTEsIDg5LCAyMiwgMTksIDY1LCAxNTQsIDEwLCA1MywgMjA4LCAyMTgsIDI1MiwgMjE5LCAzNywgNTAsIDIxMiwgODYsIDE0NSwgMTA3LCAxMzIsIDkwLCAyMzMsIDIwMiwgMjI3LCAxMDgsIDExNCwgMTQxLCAyOSwgNzMsIDE4NywgMzEsIDEzLCAyMzQsIDAsIDIzMiwgMjQsIDE5MSwgMzUsIDE0OSwgMTc5LCAxMzgsIDIxNCwgMTU5LCAyNDUsIDE2MiwgMTQ4LCAyMjEsIDExOCwgMTcsIDEwNSwgODksIDE1MSwgMTQ2LCAyMDksIDU1LCAyMzYsIDYxLCAxNDMsIDIzMywgMjI4LCAxMCwgMTE1LCA4LCA4MSwgMTk3LCA0NSwgMTIzLCAxODcsIDIyMywgMTc2LCAyNTQsIDE2NSwgNjksIDE0MywgMjksIDEwMCwgMTE0LCAxNywgMTMwLCAyMjYsIDIyMywgMzMsIDExLCAyNDAsIDgxLCA2MSwgMTcyLCAxOTEsIDE1NywgMjQ2LCAyMDIsIDg3LCAxMzEsIDIyMSwgODgsIDQ4LCAxMjcsIDE1OSwgMTE5LCAxNjAsIDE1MiwgMTE3LCA2MSwgMjUzLCAxNzQsIDY1LCAyMTQsIDIwMywgMjE4LCA2MywgNTAsIDc4LCAxNjAsIDE4MSwgMjIxLCAyMTEsIDEyOCwgNzAsIDE3OCwgMTkxLCAxNzAsIDAsIDEzLCAxMjIsIDE3MywgMTIsIDIwMywgMjUyLCA0LCAxODQsIDIyNSwgMjUyLCA3LCA2MiwgOTYsIDExNiwgMTUsIDIxNiwgMTU4LCA1NSwgODUsIDQ4LCAxNiwgOSwgMjA2LCAxMTksIDc0LCAxMTIsIDI0MywgMTM2LCA4NCwgMTg0LCAyMjMsIDI1NCwgMTAxLCA5MSwgNjEsIDEwLCA5MSwgODUsIDE5MiwgMTQ3LCAxNDQsIDU3LCAyOSwgNjYsIDIzOCwgMTk5LCAyNDQsIDE5MywgMTk0LCAxNTAsIDIzMiwgMjAwLCAxMDcsIDIsIDMsIDEsIDAsIDFdLFxyXG4gIHByaXZhdGU6IFs0OCwgMTMwLCA0LCAxOTEsIDIsIDEsIDAsIDQ4LCAxMywgNiwgOSwgNDIsIDEzNCwgNzIsIDEzNCwgMjQ3LCAxMywgMSwgMSwgMSwgNSwgMCwgNCwgMTMwLCA0LCAxNjksIDQ4LCAxMzAsIDQsIDE2NSwgMiwgMSwgMCwgMiwgMTMwLCAxLCAxLCAwLCAyMjgsIDQzLCAxMDEsIDEyLCAxMjEsIDcsIDE1NywgNzEsIDgxLCA1OCwgMjE5LCAzMiwgMTAsIDEwOCwgMTkzLCAxNzksIDIxMiwgMTE2LCAyNTUsIDU5LCAyMTcsIDMyLCAxNjEsIDIwMSwgNTMsIDE3MSwgMjI2LCAxOTksIDEzNywgMjAyLCAxNzEsIDYwLCA4MiwgNTMsIDEyNSwgNjIsIDE3NywgMTI2LCAxNjUsIDI0LCAxNDEsIDMwLCAxNSwgMjI2LCA1OSwgMTA3LCAzNCwgNywgMTMsIDE0OSwgMTEyLCAxMjUsIDEwLCAyMzAsIDE5MSwgMTU2LCAxNjQsIDE3NywgMTAsIDE4NSwgMTMsIDY2LCAzLCAyMTcsIDE2NiwgMjQ0LCA5MCwgMTE5LCAxMTEsIDI3LCAxNDUsIDEwNCwgNzEsIDE4OSwgMTY2LCAyMjYsIDI1NSwgMTMzLCA4MywgMTUxLCAyMzEsIDEwMSwgMTUxLCA4OSwgMjIsIDE5LCA2NSwgMTU0LCAxMCwgNTMsIDIwOCwgMjE4LCAyNTIsIDIxOSwgMzcsIDUwLCAyMTIsIDg2LCAxNDUsIDEwNywgMTMyLCA5MCwgMjMzLCAyMDIsIDIyNywgMTA4LCAxMTQsIDE0MSwgMjksIDczLCAxODcsIDMxLCAxMywgMjM0LCAwLCAyMzIsIDI0LCAxOTEsIDM1LCAxNDksIDE3OSwgMTM4LCAyMTQsIDE1OSwgMjQ1LCAxNjIsIDE0OCwgMjIxLCAxMTgsIDE3LCAxMDUsIDg5LCAxNTEsIDE0NiwgMjA5LCA1NSwgMjM2LCA2MSwgMTQzLCAyMzMsIDIyOCwgMTAsIDExNSwgOCwgODEsIDE5NywgNDUsIDEyMywgMTg3LCAyMjMsIDE3NiwgMjU0LCAxNjUsIDY5LCAxNDMsIDI5LCAxMDAsIDExNCwgMTcsIDEzMCwgMjI2LCAyMjMsIDMzLCAxMSwgMjQwLCA4MSwgNjEsIDE3MiwgMTkxLCAxNTcsIDI0NiwgMjAyLCA4NywgMTMxLCAyMjEsIDg4LCA0OCwgMTI3LCAxNTksIDExOSwgMTYwLCAxNTIsIDExNywgNjEsIDI1MywgMTc0LCA2NSwgMjE0LCAyMDMsIDIxOCwgNjMsIDUwLCA3OCwgMTYwLCAxODEsIDIyMSwgMjExLCAxMjgsIDcwLCAxNzgsIDE5MSwgMTcwLCAwLCAxMywgMTIyLCAxNzMsIDEyLCAyMDMsIDI1MiwgNCwgMTg0LCAyMjUsIDI1MiwgNywgNjIsIDk2LCAxMTYsIDE1LCAyMTYsIDE1OCwgNTUsIDg1LCA0OCwgMTYsIDksIDIwNiwgMTE5LCA3NCwgMTEyLCAyNDMsIDEzNiwgODQsIDE4NCwgMjIzLCAyNTQsIDEwMSwgOTEsIDYxLCAxMCwgOTEsIDg1LCAxOTIsIDE0NywgMTQ0LCA1NywgMjksIDY2LCAyMzgsIDE5OSwgMjQ0LCAxOTMsIDE5NCwgMTUwLCAyMzIsIDIwMCwgMTA3LCAyLCAzLCAxLCAwLCAxLCAyLCAxMzAsIDEsIDAsIDEwMywgMjQ0LCAxMzcsIDExOCwgMTE2LCA4MiwgMTQsIDIwMywgMTAyLCAxMDcsIDI1MywgODgsIDEyLCAxOTksIDIyMiwgNjAsIDI0MywgMTM2LCA4NiwgMTU3LCA3NCwgMjI0LCAxOTAsIDUzLCAxMTMsIDU3LCAxNTcsIDI1MCwgNDksIDEzMCwgOTYsIDMxLCAyNTIsIDEzNiwgMTUyLCA3MCwgMTQzLCAxNywgMjE1LCA5NiwgMTAzLCA1MSwgMTgsIDM1LCAxNDEsIDIxMiwgMjEwLCAyMDUsIDksIDIxNiwgODMsIDcwLCAyNDUsIDcxLCAxMzgsIDExOSwgMTEyLCAyMjksIDE2NCwgMTc2LCA5LCAzNywgODEsIDE2MSwgMTkzLCAxNTQsIDY4LCAyNDksIDExNSwgMTA2LCAyMDEsIDYsIDEyLCAyMjUsIDE0NCwgMTI2LCAxNDEsIDIxMCwgMTQxLCAyNDIsIDEyOCwgMTU5LCAyMjEsIDE2MywgMjIyLCAyMSwgMjMzLCAyMzAsIDE2NywgMjA2LCA1OSwgMjQsIDI1MCwgMjMzLCA4MSwgMTIyLCAxMDIsIDI2LCA2LCAyMzMsIDcyLCAxMzMsIDQ3LCA3NywgMTU1LCAyMzgsIDg2LCA2LCAxMzksIDI0LCAxMzEsIDE2MywgMTc5LCAxMTIsIDQ4LCAyNDcsIDE0MiwgNiwgMjA3LCAyMDQsIDE3MywgMjIzLCAxNDAsIDE5OSwgMTUwLCA5NSwgMTIzLCAxNTIsIDIwMiwgMTU1LCAxMzEsIDIzOCwgNjIsIDk2LCAxMzMsIDQsIDIxNywgNTEsIDEyMSwgMzAsIDM4LCAxNzgsIDE4OSwgMjE2LCA0NCwgMzUsIDI0MSwgOTMsIDcsIDYyLCA5MCwgMTExLCAyMTYsIDY2LCAyMDksIDI0MywgMTI4LCAyMzQsIDE0MSwgODQsIDEzNSwgMTgxLCAxMywgMzgsIDIyMCwgMTE0LCAyNDUsIDI0MCwgMTc4LCA5NSwgMjIwLCAyMDYsIDExLCAxODYsIDIzNCwgMjEzLCA2NiwgMTIxLCA4MywgNjgsIDg5LCA3NSwgNDYsIDE4MywgMTQ1LCAxODMsIDE0NywgMTYwLCAyMTUsIDExOCwgMTk4LCAxMjUsIDE4MSwgMTQ2LCAzMCwgMjUxLCA1OCwgODcsIDQ3LCAyMDksIDIzNywgOTcsIDI0LCA0NywgMTc5LCA2LCAxMTAsIDI0MiwgOTksIDE1MCwgMjI2LCAxNDgsIDE5OCwgMTc0LCAxNDYsIDEwMSwgMjEzLCA4NywgMTc4LCAxMCwgMjIzLCAxMDUsIDE4LCA1NiwgNTMsIDIyLCAyMTIsIDE1OCwgMTcwLCAxNzYsIDUxLCA4NiwgMTQ1LCAxMjUsIDEyNCwgNDQsIDksIDg1LCAxOSwgMTQ0LCAyNDYsIDE3MCwgNzgsIDEyNCwgMzAsIDMyLCAxMiwgMTY2LCAxNzQsIDEzOSwgNzcsIDYzLCAxNzMsIDgyLCAxMCwgMTUzLCAyLCAxMjksIDEyOSwgMCwgMjQ4LCAxOCwgMTQzLCAyNDYsIDEzNywgMTM2LCAxNDUsIDIxOSwgMTc4LCAzOSwgMjcsIDk0LCA2NCwgOTAsIDQ3LCAxNjMsIDExNCwgNjAsIDYzLCAxODcsIDEzMSwgMTQzLCAyNDQsIDE2LCA0MiwgMTI4LCAyMzEsIDExNywgOTIsIDk4LCAyMTksIDE1NSwgNjIsIDEwNywgMjUyLCAxNywgMjQ1LCA0NSwgMTYwLCAyMjUsIDEwMywgMTQyLCA3MiwgMzYsIDE5MywgMTUwLCAyMzUsIDIxNCwgMTc1LCA2MiwgMjEyLCA1NiwgNDUsIDksIDAsIDYwLCAxMTQsIDEwNywgMTM0LCAyMjgsIDIwNCwgMTMxLCAxMzEsIDIxNCwgOTQsIDIwMSwgMTQ4LCAxNTksIDk5LCAxMzksIDE4MSwgMTMsIDExOSwgMzgsIDMwLCAxMDcsIDE2NiwgMTY1LCAyMDMsIDQzLCAzNCwgMjAsIDIwNywgMTcxLCAzMiwgNTgsIDE2NywgNjIsIDE5NiwgMTUzLCAxMDMsIDIwNCwgMjEzLCAyNDcsIDQ4LCAxMTEsIDIyNywgNTksIDk1LCA5NywgMTk0LCAxODcsIDUzLCAxMCwgMjQ3LCAxMDgsIDU4LCA4NiwgMjgsIDI5LCAxMTMsIDgsIDExMCwgMTcxLCAyMjAsIDI0NSwgMTEsIDgyLCAyMzMsIDIyMywgOTEsIDY4LCAxNjYsIDExNywgMTc0LCAxODcsIDYyLCA3NywgMiwgMTI5LCAxMjksIDAsIDIzNSwgMTE4LCAyLCAxMDUsIDIzOSwgMjEyLCAzMCwgMTA0LCAxNTcsIDQxLCAxMDksIDExLCAyNDgsIDE1MiwgMjIsIDIzNiwgOTcsIDQwLCAxNTMsIDEzMSwgMjI4LCA1LCA4NiwgMTg3LCAxMTMsIDEyNiwgMTQ0LCA3NiwgMTQxLCA3OSwgMTEwLCAyNTAsIDE0NiwgMTUyLCA0OSwgNTgsIDE1NiwgMjAxLCAxNzYsIDkyLCAxODksIDIwOSwgMzAsIDExMiwgMTA4LCAxNzUsIDIwNCwgMjA0LCAyNDcsIDE2NCwgNDYsIDEyOSwgMjM5LCA5OCwgMTI3LCA0OSwgMTQ1LCAyMTgsIDYzLCAxOTMsIDEyNCwgMTc0LCAxOCwgOTgsIDIwMSwgOTksIDE1NCwgMTYyLCAxMzgsIDc4LCAxNTksIDI1MywgMywgMjQ4LCAzLCAyMDksIDM2LCAyMzksIDE5MywgMTU1LCAxOTMsIDUsIDE5LCAyMzYsIDM3LCA3OCwgMTE4LCAxMzUsIDI1MCwgMTk5LCA3LCAxNDEsIDI0OCwgMTIwLCAzNiwgMTM2LCA5MywgOTgsIDE3NCwgNjAsIDE4LCAyMTUsIDkzLCAxNzQsIDEwNywgMTQxLCAxMTYsIDE0NSwgMTY3LCAyMjEsIDIxMCwgMTY5LCAyNDcsIDY3LCAyNTQsIDIyMiwgMTYxLCAxMzQsIDYzLCAyMjEsIDkwLCA4NywgNDIsIDk5LCAyMjcsIDgxLCAxNzMsIDE1MSwgMiwgMTI5LCAxMjksIDAsIDEzMywgMjMsIDE2OCwgMTAzLCA4MywgMjMyLCAxNDYsIDE2MCwgMTgxLCAyMywgNDAsIDM4LCAyMDQsIDEzLCAyMTQsIDIwMywgNDksIDQxLCAxOTUsIDIyNywgMTg5LCAxODEsIDgsIDI0MywgMTE5LCAxMDYsIDc1LCA2NywgMjUwLCAyNTAsIDEwLCAyMzQsIDk4LCAxMTgsIDI2LCAyNTAsIDM1LCAxMjEsIDEzMiwgMTI0LCAxMCwgNzYsIDI2LCAxOTgsIDE2NSwgMTU0LCAxMDgsIDE5LCAxMTcsIDg4LCAyMywgMTcsIDE5MiwgMTQzLCAxODQsIDE3NywgMTgxLCAxNDEsIDE1NywgNCwgMTg1LCAyNDgsIDE5MywgNzcsIDIwNCwgMjQzLCA3LCAxNzAsIDI0MCwgNCwgMTExLCAxMTMsIDE4MywgMCwgMjcsIDEzNiwgMjAsIDE5LCAxNDksIDc0LCAzMywgMjQxLCAyMTgsIDEwOCwgMjM2LCA4MCwgMTcxLCAxNDgsIDE2LCAxMTYsIDk3LCAxMDksIDgzLCA3NCwgODgsIDE0NSwgOTQsIDIzOSwgMTAyLCAxOTIsIDE5LCAxMTQsIDIwNywgNSwgMTI4LCA1MSwgMTExLCAxNjQsIDIzNywgODYsIDE1NCwgOTksIDUyLCAxOTcsIDYyLCA1NywgMTgyLCA2LCAxNTIsIDI0NSwgNjEsIDEzNywgNTgsIDEwNSwgMTU5LCAyLCA4NCwgMTA5LCAyLCAxMjksIDEyOSwgMCwgMjI2LCA2NywgMTExLCAxMzIsIDk1LCA5MSwgMTAxLCAxNzcsIDYzLCAxODksIDQ0LCA1MywgMTkzLCAxODQsIDkyLCAyMzAsIDIyMywgOTgsIDEzMywgNzQsIDIwOSwgODYsIDUyLCA3LCA2NSwgMTk1LCAyMDYsIDEwMCwgODEsIDE3OCwgMTQ0LCA2NSwgMTY3LCAxNTEsIDQyLCA3OSwgODksIDE0OSwgMTgsIDE3MywgMTg4LCAyMSwgMjQ0LCAyNTEsIDQ5LCAyMzAsIDQxLCAxNTAsIDE1MywgNDYsIDM1LCAzOCwgMjMxLCA5OSwgMTc0LCA1NiwgMTE1LCAzMiwgMjE1LCAyNTMsIDg1LCAxNDcsIDEwOCwgMTk3LCAxNDcsIDM0LCAyMzYsIDIxNiwgMjIyLCAxNzcsIDU3LCA5MCwgMTM2LCAxMTQsIDIwNywgNDgsIDQ2LCAzMSwgOTAsIDIyMCwgMTgsIDU4LCAxNDMsIDIzOSwgMTExLCAyMTQsIDI3LCA5NSwgNiwgMzYsIDUzLCAyMjksIDYyLCAxMDgsIDQ1LCAzOSwgMSwgMzAsIDQ3LCAxNzgsIDU2LCAxNjQsIDIwNiwgNTYsIDQyLCAyMDgsIDQ2LCAxOTMsIDYxLCAzMSwgMTQ3LCA0NSwgMTQ3LCAyMywgMTg3LCAyMiwgNTAsIDI1NSwgMTExLCAyMjksIDEzMiwgMTk5LCAxNTIsIDc1LCAxNDIsIDEzNiwgMjA5LCAxNTEsIDIsIDEyOSwgMTI5LCAwLCAxNjUsIDU2LCAyMzIsIDc2LCA1NSwgNTcsIDI0MCwgMTU5LCA5MiwgMjA3LCAyMjAsIDE0MywgMTMwLCAzMCwgNTcsIDIzNCwgMjUxLCAxNzIsIDE3MSwgMTgwLCA1NCwgMTU5LCAyMjksIDk2LCAyNDYsIDczLCAxMTIsIDE0NiwgNzUsIDE1NywgMjQyLCAyMDEsIDE2MSwgMjE4LCAzNywgMTc2LCAzNSwgMTcwLCA1MCwgOTAsIDE0OCwgMTAyLCAxOTEsIDE5OSwgMjM5LCAxNzQsIDc4LCA3MiwgNjcsIDg1LCAxOTksIDQ1LCAxNDksIDE0NSwgMTMyLCAxNjEsIDIxMiwgMzMsIDE1NywgNzUsIDIxNiwgNzksIDM5LCAyMzMsIDE4LCAyMTAsIDI1NSwgMjYsIDcyLCAyMjksIDIzOSwgNDQsIDEyLCAxNDcsIDE1OCwgMTc2LCAxOTIsIDk1LCAxMjYsIDMyLCAxNzUsIDIzLCAyMjYsIDEzMSwgMTM5LCAxOTcsIDE3NSwgMTkzLCA2MiwgOCwgMTUxLCAyNTIsIDY4LCAxNTQsIDk0LCA4OSwgMTg5LCAxMjUsIDkwLCAzMCwgMzYsIDE3NSwgNzMsIDIzMCwgMTk0LCAxMywgMjMzLCAyNDcsIDEyMywgNjAsIDI0MSwgNDcsIDE3MSwgNTEsIDE4OSwgMTEyLCAxMTEsIDIxMywgMTQxLCA4OSwgNzAsIDI0OSwgMjM2LCA2MywgMjM2LCAxMTAsIDExNSwgMjA4XX07XHJcbiovXHJcblxyXG5leHBvcnQgZGVmYXVsdCBuZXcgQ3J5cHRvTWFuYWdlcigpO1xyXG4iLCIvLyBMb2cgU3lzdGVtXHJcbmltcG9ydCAqIGFzIGxvZ2dlciBmcm9tICdsb2dsZXZlbCc7XHJcbmxldCBsb2cgPSBsb2dnZXIuZ2V0TG9nZ2VyKCdMb2FkZXInKTtcclxuLy9pbXBvcnQgcGF0aCBmcm9tICdwYXRoJztcclxuLy9pbXBvcnQgU3lzdGVtIGZyb20gJ3N5c3RlbWpzL2Rpc3Qvc3lzdGVtJztcclxuXHJcbmltcG9ydCB7IGRpdmlkZVVSTCwgZW1wdHlPYmplY3QsIGdldENvbmZpZ3VyYXRpb25SZXNvdXJjZXMsIGJ1aWxkVVJMIH0gZnJvbSAnLi4vdXRpbHMvdXRpbHMnO1xyXG5pbXBvcnQgQWRkcmVzc0FsbG9jYXRpb24gZnJvbSAnLi4vYWxsb2NhdGlvbi9BZGRyZXNzQWxsb2NhdGlvbic7XHJcblxyXG5jbGFzcyBMb2FkZXIge1xyXG5cclxuICBjb25zdHJ1Y3RvcihydW50aW1lVVJMLCBydW50aW1lQ29uZmlndXJhdGlvbiwgcnVudGltZURlc2NyaXB0b3JzSW5zdGFuY2UpIHtcclxuICAgIGlmICghcnVudGltZUNvbmZpZ3VyYXRpb24pIHRocm93IEVycm9yKCdbUnVudGltZS5Mb2FkZXJdIFRoZSBkZXNjcmlwdG9yIG5lZWQgdG8ga25vdyB0aGUgcnVudGltZSBjb25maWd1cmF0aW9uJyk7XHJcbiAgICBpZiAoIXJ1bnRpbWVEZXNjcmlwdG9yc0luc3RhbmNlKSB0aHJvdyBFcnJvcignW1J1bnRpbWUuTG9hZGVyXSBUaGUgZGVzY3JpcHRvciBuZWVkIHRvIGtub3cgdGhlIHJ1bnRpbWUgRGVzY3JpcHRvciBpbnN0YW5jZScpO1xyXG5cclxuICAgIHRoaXMubG9nID0gbG9nO1xyXG5cclxuICAgIHRoaXMucnVudGltZUNvbmZpZ3VyYXRpb24gPSBydW50aW1lQ29uZmlndXJhdGlvbjtcclxuICAgIHRoaXMuZGVzY3JpcHRvcnMgPSBydW50aW1lRGVzY3JpcHRvcnNJbnN0YW5jZTtcclxuICAgIGNvbnNvbGUubG9nKFN5c3RlbSk7XHJcbiAgICBjb25zb2xlLmxvZyhBZGRyZXNzQWxsb2NhdGlvbik7XHJcbi8vICAgIFN5c3RlbS5ub0NvbmZsaWN0KCk7XHJcblxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogU2V0IHJ1bnRpbWUgdXJsXHJcbiAgICogQHBhcmFtICB7c3RyaW5nfSB2YWx1ZSBydW50aW1lVVJMXHJcbiAgICovXHJcbiAgc2V0IHJ1bnRpbWVVUkwodmFsdWUpIHtcclxuICAgIHRoaXMuX3J1bnRpbWVVUkwgPSB2YWx1ZTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEdldCBydW50aW1lIHVybFxyXG4gICAqIEByZXR1cm4ge3N0cmluZ30gdmFsdWUgcnVudGltZVVSTFxyXG4gICAqL1xyXG4gIGdldCBydW50aW1lVVJMKCkge1xyXG4gICAgcmV0dXJuIHRoaXMuX3J1bnRpbWVVUkw7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBTZXQgUmVnaXN0cnkgY29tcG9uZW50XHJcbiAgICogQHBhcmFtICB7UmVnaXN0cnl9IHZhbHVlIFJlZ2lzdHJ5IENvbXBvbmVudFxyXG4gICAqL1xyXG4gIHNldCByZWdpc3RyeSh2YWx1ZSkge1xyXG4gICAgdGhpcy5fcmVnaXN0cnkgPSB2YWx1ZTtcclxuXHJcbiAgICAvLyBJbnN0YWxsIEFkZHJlc3NBbGxvY2F0aW9uXHJcbiAgICBsZXQgYWRkcmVzc0FsbG9jYXRpb24gPSBBZGRyZXNzQWxsb2NhdGlvbi5pbnN0YW5jZTtcclxuICAgIHRoaXMuX2FkZHJlc3NBbGxvY2F0aW9uID0gYWRkcmVzc0FsbG9jYXRpb247XHJcblxyXG4gICAgbG9nLmxvZygnW0xvYWRlciAtIEFkZHJlc3NBbGxvY2F0aW9uXSAtICcsIGFkZHJlc3NBbGxvY2F0aW9uKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEdldCBSZWdpc3RyeSBjb21wb25lbnRcclxuICAgKiBAcmV0dXJuIHtSZWdpc3RyeX0gUmVnaXN0cnkgY29tcG9uZW50XHJcbiAgICovXHJcbiAgZ2V0IHJlZ2lzdHJ5KCkge1xyXG4gICAgcmV0dXJuIHRoaXMuX3JlZ2lzdHJ5O1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogU2V0IE1lc3NhZ2UgQnVzIGNvbXBvbmVudFxyXG4gICAqIEBwYXJhbSAge01lc3NhZ2VCdXN9IHZhbHVlIE1lc3NhZ2UgYnVzIGNvbXBvbmVudFxyXG4gICAqL1xyXG4gIHNldCBtZXNzYWdlQnVzKHZhbHVlKSB7XHJcbiAgICB0aGlzLl9tZXNzYWdlc0J1cyA9IHZhbHVlO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogR2V0IE1lc3NhZ2UgQnVzIGNvbXBvbmVudFxyXG4gICAqIEByZXR1cm4ge01lc3NhZ2VCdXN9IE1lc3NhZ2UgQnVzIGNvbXBvbmVudFxyXG4gICAqL1xyXG4gIGdldCBtZXNzYWdlQnVzKCkge1xyXG4gICAgcmV0dXJuIHRoaXMuX21lc3NhZ2VzQnVzO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogU2V0IFJ1bnRpbWUgRmFjdG9yeSBjb21wb25lbnRcclxuICAgKiBAcGFyYW0gIHtydW50aW1lRmFjdG9yeX0gdmFsdWUgRmFjdG9yeSBpbmNsdWRlcyB0aGUgc3BlY2lmaWMgaW1wbGVtZW50YXRpb25zIGZvciBlYWNoIGVudmlyb25tZW50XHJcbiAgICovXHJcbiAgc2V0IHJ1bnRpbWVGYWN0b3J5KHZhbHVlKSB7XHJcbiAgICB0aGlzLl9ydW50aW1lRmFjdG9yeSA9IHZhbHVlO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogR2V0IFJ1bnRpbWUgRmFjdG9yeSBjb21wb25lbnRcclxuICAgKiBAcmV0dXJuIHtydW50aW1lRmFjdG9yeX0gUnVudGltZSBGYWN0b3J5IGNvbXBvbmVudFxyXG4gICAqL1xyXG4gIGdldCBydW50aW1lRmFjdG9yeSgpIHtcclxuICAgIHJldHVybiB0aGlzLl9ydW50aW1lRmFjdG9yeTtcclxuICB9XHJcblxyXG5cclxuXHJcbiAgLyoqXHJcbiAgICogRGVwbG95IEh5cGVydHkgZnJvbSBDYXRhbG9ndWUgVVJMXHJcbiAgICpcclxuICAgKiBAc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9yZVRISU5LLXByb2plY3Qvc3BlY3MvdHJlZS9tYXN0ZXIvZGF0YW1vZGVsL2NvcmUvYWRkcmVzc1xyXG4gICAqXHJcbiAgICogQHBhcmFtIHtVUkwuSHlwZXJ0eUNhdGFsb2d1ZVVSTH0gaHlwZXJ0eUNhdGFsb2d1ZVVSTCAtIFRoZSBDYXRhbG9ndWUgVVJMIHVzZWQgdG8gaWRlbnRpZnkgZGVzY3JpcHRvcnMgaW4gdGhlIENhdGFsb2d1ZS5cclxuICAgKiBAcGFyYW0ge2Jvb2xlYW58VVJMLkh5cGVydHlVUkx9IFtyZXVzZVVSTD1mYWxzZV0gcmV1c2VVUkwgLSByZXVzZVVSTCBpcyB1c2VkIHRvIHJldXNlIHRoZSBoeXBlcnR5VVJMIHByZXZpb3VzbHkgcmVnaXN0cmVkLCBieSBkZWZhdWx0IHRoZSByZXVzZSBpcyBkaXNhYmxlZDtcclxuICAgKiBAcGFyYW0ge1VSTH0gYXBwVVJMIC0gdGhlIGFwcCB1cmwgb3JpZ2luIGFkZHJlc3M7XHJcbiAgICogQHBhcmFtIHtvYmplY3R9IElkcENvbnN0cmFpbnQgLSBjb25zdHJhaW50cyB0byBiZSB1c2VkIHdoZW4gc2VsZWN0aW5nIHRoZSBpZGVudGl0eSB0byBiZSBhc3NvY2lhdGVkIHdpdGggdGhlIEh5cGVydHkgaW5jbHVkaW5nIG9yaWdpbiwgaWRwLCBhbmQgaWRIaW50LlxyXG4gICAqIEByZXR1cm5zIHtQcm9taXNlPEJvb2xlYW4sIEVycm9yPn0gdGhpcyBpcyBQcm9taXNlIGFuZCByZXR1cm5zIHRydWUgaWYgYWxsIGNvbXBvbmVudHMgYXJlIGxvYWRlZCB3aXRoIHN1Y2Nlc3Mgb3IgYW4gZXJyb3IgaWYgc29tZW9uZSBmYWlscy5cclxuICAgKlxyXG4gICAqIEBtZW1iZXJPZiBMb2FkZXJcclxuICAgKi9cclxuICBsb2FkSHlwZXJ0eShoeXBlcnR5Q2xhc3MsIHJldXNlVVJMID0gZmFsc2UsIElkcENvbnN0cmFpbnQsIGFwcFVSTCkge1xyXG5cclxuICAgIGlmICghdGhpcy5fcmVhZHlUb1VzZSgpKSByZXR1cm4gZmFsc2U7XHJcbiAgICBpZiAoIWh5cGVydHlDbGFzcykgdGhyb3cgbmV3IEVycm9yKCdbUnVudGltZS5Mb2FkZXJdIGh5cGVydHlDbGFzcyBwYXJhbWV0ZXIgaXMgbmVlZGVkJyk7XHJcblxyXG5cclxuICAgIGxldCBfaHlwZXJ0eVVSTDtcclxuICAgIGxldCBfaHlwZXJ0eVNhbmRib3g7XHJcbiAgICBsZXQgX2h5cGVydHlTb3VyY2VQYWNrYWdlO1xyXG4gICAgbGV0IGhhdmVFcnJvciA9IGZhbHNlO1xyXG4gICAgbGV0IGluc3RhbmNlID0gbmV3IGh5cGVydHlDbGFzcygpO1xyXG4gICAgbGV0IGh5cGVydHkgPSBpbnN0YW5jZS5uYW1lO1xyXG5cclxuXHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xyXG5cclxuICAgICAgbGV0IGVycm9yUmVhc29uID0gKHJlYXNvbikgPT4ge1xyXG4gICAgICAgIGxvZy5pbmZvKCdbUnVudGltZS5Mb2FkZXJdIFNvbWV0aGluZyBmYWlsZWQgb24gdGhlIGRlcGxveSBoeXBlcnR5OiAnLCByZWFzb24pO1xyXG4gICAgICAgIHJlamVjdChyZWFzb24pO1xyXG4gICAgICB9O1xyXG4gIFxyXG4gICAgICBsZXQgaGFuZGxlRXJyb3IgPSAocmVhc29uKSA9PiB7XHJcbiAgICAgICAgaGF2ZUVycm9yID0gdHJ1ZTtcclxuICAgICAgICByZWplY3QocmVhc29uKTtcclxuICAgICAgfTtcclxuICBcclxuICAgICAgbG9nLmluZm8oJ1tSdW50aW1lLkxvYWRlci5sb2FkSHlwZXJ0eV0gJywgaHlwZXJ0eSk7XHJcbiAgICAgIGxldCBfaHlwZXJ0eURlc2NyaXB0b3IgPSBpbnN0YW5jZS5kZXNjcmlwdG9yO1xyXG5cclxuICAgICAgX2h5cGVydHlEZXNjcmlwdG9yLmRhdGFPYmplY3RzWzBdID0gX2h5cGVydHlEZXNjcmlwdG9yLmRhdGFPYmplY3RzWzBdLnJlcGxhY2UoJyVkb21haW4lJywgdGhpcy5fcmVnaXN0cnkuX2RvbWFpbik7XHJcblxyXG4gICAgICAvLyBhdCB0aGlzIHBvaW50LCB3ZSBoYXZlIGNvbXBsZXRlZCBcInN0ZXAgMiBhbmQgM1wiIGFzIHNob3duIGluIGh0dHBzOi8vZ2l0aHViLmNvbS9yZVRISU5LLXByb2plY3QvY29yZS1mcmFtZXdvcmsvYmxvYi9tYXN0ZXIvZG9jcy9zcGVjcy9ydW50aW1lL2R5bmFtaWMtdmlldy9iYXNpY3MvZGVwbG95LWh5cGVydHkubWRcclxuICAgICAgbG9nLmluZm8oJ1tSdW50aW1lLkxvYWRlcl0gMTogcmV0dXJuIGh5cGVydHkgZGVzY3JpcHRvcjogJywgX2h5cGVydHlEZXNjcmlwdG9yKTtcclxuXHJcblxyXG4gICAgICBfaHlwZXJ0eVNhbmRib3ggPSB0aGlzLnJlZ2lzdHJ5LmdldEFwcFNhbmRib3goKTtcclxuXHJcblxyXG5cclxuICAgICAgbGV0IG51bWJlck9mQWRkcmVzc2VzID0gMTtcclxuICAgICAgLy9kZWJ1Z2dlcjtcclxuICAgICAgdGhpcy5fYWRkcmVzc0FsbG9jYXRpb24uY3JlYXRlKHRoaXMuX3JlZ2lzdHJ5Ll9kb21haW4sIG51bWJlck9mQWRkcmVzc2VzLCBfaHlwZXJ0eURlc2NyaXB0b3IsICdoeXBlcnR5JywgcmV1c2VVUkwpXHJcbiAgICAgIC50aGVuKChhZGRyZXNzZXMpID0+IHtcclxuICAgICAgICBpZiAoaGF2ZUVycm9yKSByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgbG9nLmluZm8oJ1tSdW50aW1lLkxvYWRlcl0gNjogcmV0dXJuIHRoZSBhZGRyZXNzZXMgZm9yIHRoZSBoeXBlcnR5JywgYWRkcmVzc2VzKTtcclxuXHJcbiAgICAgICAgLy8gUmVnaXN0ZXIgaHlwZXJ0eVxyXG4gICAgICAgIHJldHVybiB0aGlzLnJlZ2lzdHJ5LnJlZ2lzdGVySHlwZXJ0eShfaHlwZXJ0eVNhbmRib3gsIGh5cGVydHksIF9oeXBlcnR5RGVzY3JpcHRvciwgYWRkcmVzc2VzLCBJZHBDb25zdHJhaW50KTtcclxuICAgICAgfSwgaGFuZGxlRXJyb3IpXHJcbiAgICAgIC50aGVuKChyZWdpc3RyYXRpb25SZXN1bHQpID0+IHtcclxuICAgICAgICBpZiAoaGF2ZUVycm9yKSByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgbG9nLmluZm8oJ1tSdW50aW1lLkxvYWRlcl0gNzogcmVnaXN0cmF0aW9uIHJlc3VsdCcsIHJlZ2lzdHJhdGlvblJlc3VsdCk7XHJcblxyXG4gICAgICAgIC8vIHdlIGhhdmUgY29tcGxldGVkIHN0ZXAgMTYgb2YgaHR0cHM6Ly9naXRodWIuY29tL3JlVEhJTkstcHJvamVjdC9jb3JlLWZyYW1ld29yay9ibG9iL21hc3Rlci9kb2NzL3NwZWNzL3J1bnRpbWUvZHluYW1pYy12aWV3L2Jhc2ljcy9kZXBsb3ktaHlwZXJ0eS5tZCByaWdodCBub3cuXHJcbiAgICAgICAgX2h5cGVydHlVUkwgPSByZWdpc3RyYXRpb25SZXN1bHQudXJsO1xyXG5cclxuICAgICAgICAvLyBFeHRlbmQgb3JpZ2luYWwgaHlwZXJ0eSBjb25maWd1cmF0aW9uO1xyXG4gICAgICAgIGxldCBjb25maWd1cmF0aW9uID0ge307XHJcbiAgICAgICAgaWYgKCFlbXB0eU9iamVjdChfaHlwZXJ0eURlc2NyaXB0b3IuY29uZmlndXJhdGlvbikpIHtcclxuICAgICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgIGNvbmZpZ3VyYXRpb24gPSBPYmplY3QuYXNzaWduKHt9LCBKU09OLnBhcnNlKF9oeXBlcnR5RGVzY3JpcHRvci5jb25maWd1cmF0aW9uKSk7XHJcbiAgICAgICAgICB9IGNhdGNoIChlKSB7XHJcbiAgICAgICAgICAgIGNvbmZpZ3VyYXRpb24gPSBfaHlwZXJ0eURlc2NyaXB0b3IuY29uZmlndXJhdGlvbjtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgY29uZmlndXJhdGlvbi5ydW50aW1lVVJMID0gdGhpcy5fcnVudGltZVVSTDtcclxuXHJcbiAgICAgICAgaWYgKHJlZ2lzdHJhdGlvblJlc3VsdC5wMnBIYW5kbGVyKSB7XHJcbiAgICAgICAgICBjb25maWd1cmF0aW9uLnAycEhhbmRsZXIgPSByZWdpc3RyYXRpb25SZXN1bHQucDJwSGFuZGxlcjtcclxuICAgICAgICAgIGNvbmZpZ3VyYXRpb24ucDJwUmVxdWVzdGVyID0gcmVnaXN0cmF0aW9uUmVzdWx0LnAycFJlcXVlc3RlcjtcclxuICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICAvLyBXZSB3aWxsIGRlcGxveSB0aGUgY29tcG9uZW50IC0gc3RlcCAxNyBvZiBodHRwczovL2dpdGh1Yi5jb20vcmVUSElOSy1wcm9qZWN0L2NvcmUtZnJhbWV3b3JrL2Jsb2IvbWFzdGVyL2RvY3Mvc3BlY3MvcnVudGltZS9keW5hbWljLXZpZXcvYmFzaWNzL2RlcGxveS1oeXBlcnR5Lm1kIHJpZ2h0IG5vdy5cclxuXHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgIC8vICAgICAgICAgICAgcmV0dXJuIF9oeXBlcnR5U2FuZGJveC5kZXBsb3lDb21wb25lbnQoX2h5cGVydHlTb3VyY2VQYWNrYWdlLnNvdXJjZUNvZGUsIF9oeXBlcnR5VVJMLCBjb25maWd1cmF0aW9uKTtcclxuICAgICAgICAgIHJldHVybiBfaHlwZXJ0eVNhbmRib3guZGVwbG95Q29tcG9uZW50KGluc3RhbmNlLCBfaHlwZXJ0eVVSTCwgY29uZmlndXJhdGlvbik7XHJcbiAgICAgICAgfSBjYXRjaCAoZSkge1xyXG4gICAgICAgICAgbG9nLmluZm8oJ1tSdW50aW1lLkxvYWRlcl0gRXJyb3Igb24gZGVwbG95IGNvbXBvbmVudDonLCBlKTtcclxuICAgICAgICAgIHJlamVjdChlKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0sIGhhbmRsZUVycm9yKVxyXG4gICAgICAudGhlbigoZGVwbG95Q29tcG9uZW50U3RhdHVzKSA9PiB7XHJcbiAgICAgICAgaWYgKGhhdmVFcnJvcikgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIGxvZy5pbmZvKCdbUnVudGltZS5Mb2FkZXJdIDg6IERlcGxveSBjb21wb25lbnQgc3RhdHVzIGZvciBoeXBlcnR5OiAnLCBkZXBsb3lDb21wb25lbnRTdGF0dXMpO1xyXG5cclxuICAgICAgICAvLyB3ZSBoYXZlIGNvbXBsZXRlZCBzdGVwIDE5IGh0dHBzOi8vZ2l0aHViLmNvbS9yZVRISU5LLXByb2plY3QvY29yZS1mcmFtZXdvcmsvYmxvYi9tYXN0ZXIvZG9jcy9zcGVjcy9ydW50aW1lL2R5bmFtaWMtdmlldy9iYXNpY3MvZGVwbG95LWh5cGVydHkubWQgcmlnaHQgbm93LlxyXG5cclxuICAgICAgICAvLyBBZGQgdGhlIG1lc3NhZ2UgYnVzIGxpc3RlbmVyIHRvIHRoZSBhcHBTYW5kYm94IG9yIGh5cGVydFNhbmRib3g7XHJcbiAgICAgICAgdGhpcy5tZXNzYWdlQnVzLmFkZExpc3RlbmVyKF9oeXBlcnR5VVJMLCAobXNnKSA9PiB7XHJcbiAgICAgICAgICBfaHlwZXJ0eVNhbmRib3gucG9zdE1lc3NhZ2UobXNnKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgLy8gQWRkIHRoZSBtZXNzYWdlIGJ1cyBsaXN0ZW5lciB0byB0aGUgYXBwU2FuZGJveCBvciBoeXBlcnRTYW5kYm94O1xyXG4gICAgICAgIHRoaXMubWVzc2FnZUJ1cy5hZGRMaXN0ZW5lcih0aGlzLnJ1bnRpbWVVUkwgKyAnL3N0YXR1cycsIChtc2cpID0+IHtcclxuICAgICAgICAgIF9oeXBlcnR5U2FuZGJveC5wb3N0TWVzc2FnZShtc2cpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICAvLyB3ZSBoYXZlIGNvbXBsZXRlZCBzdGVwIDIwIG9mIGh0dHBzOi8vZ2l0aHViLmNvbS9yZVRISU5LLXByb2plY3QvY29yZS1mcmFtZXdvcmsvYmxvYi9tYXN0ZXIvZG9jcy9zcGVjcy9ydW50aW1lL2R5bmFtaWMtdmlldy9iYXNpY3MvZGVwbG95LWh5cGVydHkubWQgcmlnaHQgbm93LlxyXG4gICAgICAgIGxldCBkZXBsb3llZCA9IHtcclxuICAgICAgICAgIHJ1bnRpbWVIeXBlcnR5VVJMOiBfaHlwZXJ0eVVSTCxcclxuICAgICAgICAgIHN0YXR1czogZGVwbG95Q29tcG9uZW50U3RhdHVzLFxyXG4gICAgICAgICAgbmFtZTogaHlwZXJ0eSxcclxuICAgICAgICAgIGluc3RhbmNlOiBpbnN0YW5jZVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGxvZy5pbmZvKCdbUnVudGltZS5Mb2FkZXJdIEh5cGVydHkgZGVwbG95ZWQ6ICcsIGRlcGxveWVkKTtcclxuICAgICAgICByZXNvbHZlKGluc3RhbmNlKTtcclxuXHJcbiAgICAgICAgLy8gd2UgaGF2ZSBjb21wbGV0ZWQgc3RlcCAyMSBodHRwczovL2dpdGh1Yi5jb20vcmVUSElOSy1wcm9qZWN0L2NvcmUtZnJhbWV3b3JrL2Jsb2IvbWFzdGVyL2RvY3Mvc3BlY3MvcnVudGltZS9keW5hbWljLXZpZXcvYmFzaWNzL2RlcGxveS1oeXBlcnR5Lm1kIHJpZ2h0IG5vdy5cclxuICAgICAgICBsb2cuaW5mbygnW1J1bnRpbWUuTG9hZGVyXSAtLS0tLS0tLS0tLS0tLS0tLS0gRU5EIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLScpO1xyXG4gICAgICB9LCBoYW5kbGVFcnJvcilcclxuICAgICAgLmNhdGNoKGVycm9yUmVhc29uKTtcclxuICAgICAgfSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAqIERlcGxveSBTdHViIGZyb20gQ2F0YWxvZ3VlIFVSTCBvciBkb21haW4gdXJsXHJcbiAgKiBAcGFyYW0gIHtVUkwuVVJMfSAgICAgcHJvdG9zdHViVVJMICAgIENhdGFsb2d1ZSBVUkwgZm9yIHRoZSBQcm90b1N0dWIgdG8gYmUgbG9hZGVkIG9yIHRoZSBkb21haW4gdG8gYmUgdGFyZ2V0IGJ5IHRoZSBwcm90b3N0dWJcclxuICAqIEBwYXJhbSAge09iamVjdH0gICAgICBwMnBDb25maWcgICAgICAgY29uZmlndXJhdGlvbiBvZiBwMnBcclxuICAqL1xyXG4gIGxvYWRTdHViKHByb3Rvc3R1YlVSTCwgcDJwQ29uZmlnKSB7XHJcblxyXG4gICAgaWYgKCF0aGlzLl9yZWFkeVRvVXNlKCkpIHJldHVybiBmYWxzZTtcclxuICAgIGlmICghcHJvdG9zdHViVVJMKSB0aHJvdyBuZXcgRXJyb3IoJ1tSdW50aW1lLkxvYWRlci5sb2FkU3R1Yl1Qcm90b1N0dWIgZGVzY3JpcHRvciB1cmwgcGFyYW1ldGVyIGlzIG5lZWRlZCcpO1xyXG5cclxuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XHJcblxyXG4gICAgICAvLyB0byBhbmFseXNlIGlmIGRvbWFpbiBmb3IgcDJwSGFuZGxlcnMgc2hvdWxkIGJlIHNvbWV0aGluZyBlbHNlIGFuZCBub3QgdGhlIGRlZmF1bHQgZG9tYWluIGl0c2VsZlxyXG5cclxuICAgICAgbGV0IGRvbWFpbiA9IGRpdmlkZVVSTChwcm90b3N0dWJVUkwpLmRvbWFpbjtcclxuXHJcbiAgICAgIGlmICghZG9tYWluKSB7XHJcbiAgICAgICAgZG9tYWluID0gcHJvdG9zdHViVVJMO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBsZXQgX3N0dWJTYW5kYm94O1xyXG4gICAgICBsZXQgX3N0dWJEZXNjcmlwdG9yO1xyXG4gICAgICBsZXQgX3J1bnRpbWVQcm90b1N0dWJVUkw7XHJcbiAgICAgIGxldCBfc3R1YlNvdXJjZVBhY2thZ2U7XHJcbiAgICAgIGxldCBoYXZlRXJyb3IgPSBmYWxzZTtcclxuICAgICAgbGV0IHN0dWJJZDtcclxuICAgICAgbGV0IHN0dWJJbnN0YW5jZTtcclxuXHJcbiAgICAgIGxldCBlcnJvclJlYXNvbiA9IChyZWFzb24pID0+IHtcclxuICAgICAgICBsb2cuaW5mbygnW1J1bnRpbWUuTG9hZGVyLmxvYWRTdHViXVNvbWV0aGluZyBmYWlsZWQgb24gdGhlIGRlcGxveSBvZiBwcm90b2NvbHN0dWI6ICcsIHJlYXNvbik7XHJcbiAgICAgICAgcmVqZWN0KHJlYXNvbik7XHJcbiAgICAgIH07XHJcblxyXG4gICAgICBsZXQgaGFuZGxlRXJyb3IgPSAocmVhc29uKSA9PiB7XHJcbiAgICAgICAgaGF2ZUVycm9yID0gdHJ1ZTtcclxuICAgICAgICByZWplY3QocmVhc29uKTtcclxuICAgICAgfTtcclxuXHJcbiAgICAgIC8vIERpc2NvdmVyIFByb3RvY29sIFN0dWJcclxuICAgICAgbGV0IGRpc2NvdmVyU3R1YjtcclxuICAgICAgbGV0IGlzUDJQSGFuZGxlciA9IGZhbHNlO1xyXG4gICAgICBsZXQgaXNQMlBSZXF1ZXN0ZXIgPSBmYWxzZTtcclxuICAgICAgbGV0IHN0dWJDYXBhYmlsaXRpZXMgPSB7fTtcclxuXHJcbiAgICAgIGxvZy5pbmZvKCdbUnVudGltZS5Mb2FkZXIubG9hZFN0dWJdIHN0YXJ0aW5nIGxvYWRpbmcgZm9yICcsIHByb3Rvc3R1YlVSTCwgJyB3aXRoIHAycGNvbmZpZyAnLCBwMnBDb25maWcpO1xyXG4gICAgICBsb2cuaW5mbygnW1J1bnRpbWUuTG9hZGVyLmxvYWRTdHViXURpc2NvdmVyIG9yIENyZWF0ZSBhIG5ldyBQcm90b1N0dWIgZm9yIGRvbWFpbjogJywgZG9tYWluKTtcclxuXHJcbiAgICAgIC8vIHN0ZXAgMiBodHRwczovL2dpdGh1Yi5jb20vcmVUSElOSy1wcm9qZWN0L2NvcmUtZnJhbWV3b3JrL2Jsb2IvbWFzdGVyL2RvY3Mvc3BlY3MvcnVudGltZS9keW5hbWljLXZpZXcvYmFzaWNzL2RlcGxveS1wcm90b3N0dWIubWRcclxuICAgICAgdHJ5IHtcclxuICAgICAgICBpZiAocDJwQ29uZmlnKSB7XHJcblxyXG4gICAgICAgICAgaWYgKHAycENvbmZpZy5oYXNPd25Qcm9wZXJ0eSgnaXNIYW5kbGVyU3R1YicpICYmIHAycENvbmZpZy5pc0hhbmRsZXJTdHViKSB7XHJcbiAgICAgICAgICAgIC8vIHN0ZXAgNiBodHRwczovL2dpdGh1Yi5jb20vcmVUSElOSy1wcm9qZWN0L2NvcmUtZnJhbWV3b3JrL2Jsb2IvbWFzdGVyL2RvY3Mvc3BlY3MvcnVudGltZS9keW5hbWljLXZpZXcvYmFzaWNzL2RlcGxveS1wcm90b3N0dWIubWRcclxuICAgICAgICAgICAgaXNQMlBIYW5kbGVyID0gdHJ1ZTtcclxuICAgICAgICAgICAgc3R1YklkID0gdGhpcy5ydW50aW1lVVJMO1xyXG4gICAgICAgICAgICBkaXNjb3ZlclN0dWIgPSB0aGlzLnJlZ2lzdHJ5LmRpc2NvdmVyUDJQU3R1YigpO1xyXG4gICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgaXNQMlBSZXF1ZXN0ZXIgPSB0cnVlO1xyXG4gICAgICAgICAgICBsZXQgcDJwSGFuZGxlclJ1bnRpbWVVUkwgPSBwMnBDb25maWcucmVtb3RlUnVudGltZVVSTDtcclxuICAgICAgICAgICAgc3R1YklkID0gcDJwSGFuZGxlclJ1bnRpbWVVUkw7XHJcblxyXG4gICAgICAgICAgICAvLyBzdGVwIDQgaHR0cHM6Ly9naXRodWIuY29tL3JlVEhJTkstcHJvamVjdC9jb3JlLWZyYW1ld29yay9ibG9iL21hc3Rlci9kb2NzL3NwZWNzL3J1bnRpbWUvZHluYW1pYy12aWV3L2Jhc2ljcy9kZXBsb3ktcHJvdG9zdHViLm1kXHJcblxyXG4gICAgICAgICAgICAvLyBzdGVwIDUgaHR0cHM6Ly9naXRodWIuY29tL3JlVEhJTkstcHJvamVjdC9jb3JlLWZyYW1ld29yay9ibG9iL21hc3Rlci9kb2NzL3NwZWNzL3J1bnRpbWUvZHluYW1pYy12aWV3L2Jhc2ljcy9kZXBsb3ktcHJvdG9zdHViLm1kXHJcbiAgICAgICAgICAgIGRpc2NvdmVyU3R1YiA9IHRoaXMucmVnaXN0cnkuZGlzY292ZXJQMlBTdHViKHAycEhhbmRsZXJSdW50aW1lVVJMKTtcclxuICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIC8vIHN0ZXAgMyBodHRwczovL2dpdGh1Yi5jb20vcmVUSElOSy1wcm9qZWN0L2NvcmUtZnJhbWV3b3JrL2Jsb2IvbWFzdGVyL2RvY3Mvc3BlY3MvcnVudGltZS9keW5hbWljLXZpZXcvYmFzaWNzL2RlcGxveS1wcm90b3N0dWIubWRcclxuICAgICAgICAgIHN0dWJJZCA9IGRvbWFpbjtcclxuICAgICAgICAgIGRpc2NvdmVyU3R1YiA9IHRoaXMucmVnaXN0cnkuZGlzY292ZXJQcm90b3N0dWIoZG9tYWluKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIElzIHJlZ2lzdGVkP1xyXG4gICAgICAgIGxvZy5pbmZvKCdbUnVudGltZS5Mb2FkZXIubG9hZFN0dWJdMS4gUHJvdG8gU3R1YiBEaXNjb3ZlcmVkIGZvciAnLCBwcm90b3N0dWJVUkwsICc6ICcsIGRpc2NvdmVyU3R1Yik7XHJcblxyXG4gICAgICAgIC8vIHN0ZXAgMjMgaHR0cHM6Ly9naXRodWIuY29tL3JlVEhJTkstcHJvamVjdC9jb3JlLWZyYW1ld29yay9ibG9iL21hc3Rlci9kb2NzL3NwZWNzL3J1bnRpbWUvZHluYW1pYy12aWV3L2Jhc2ljcy9kZXBsb3ktcHJvdG9zdHViLm1kXHJcbiAgICAgICAgcmVzb2x2ZShkaXNjb3ZlclN0dWIpO1xyXG4gICAgICAgIGxvZy5pbmZvKCcgW1J1bnRpbWUuTG9hZGVyXS0tLS0tLS0tLS0tLS0tLS0tLS0gRU5EIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxcbicpO1xyXG5cclxuICAgICAgfSBjYXRjaCAocmVhc29uKSB7XHJcblxyXG4gICAgICAgIC8vIGlzIG5vdCByZWdpc3RlZD9cclxuICAgICAgICBsb2cuaW5mbygnW1J1bnRpbWUuTG9hZGVyLmxvYWRTdHViXTEuIFByb3RvIFN0dWIgbm90IGZvdW5kICcgKyByZWFzb24pO1xyXG5cclxuICAgICAgICAvLyBzdGVwIDggaHR0cHM6Ly9naXRodWIuY29tL3JlVEhJTkstcHJvamVjdC9jb3JlLWZyYW1ld29yay9ibG9iL21hc3Rlci9kb2NzL3NwZWNzL3J1bnRpbWUvZHluYW1pYy12aWV3L2Jhc2ljcy9kZXBsb3ktcHJvdG9zdHViLm1kXHJcbiAgICAgICAgdGhpcy5fbG9hZCgncHJvdG9jb2xzdHViJywgcHJvdG9zdHViVVJMKVxyXG4vLyAgICAgICAgdGhpcy5kZXNjcmlwdG9ycy5nZXRTdHViRGVzY3JpcHRvcihwcm90b3N0dWJVUkwpXHJcblxyXG4gICAgICAgICAgLnRoZW4oKGluc3RhbmNlKSA9PiB7XHJcblxyXG5cclxuICAgICAgICAgICAgaWYgKGhhdmVFcnJvcikgcmV0dXJuIGZhbHNlO1xyXG5cclxuICAgICAgICAgICAgLy8gc3RlcCA5IGh0dHBzOi8vZ2l0aHViLmNvbS9yZVRISU5LLXByb2plY3QvY29yZS1mcmFtZXdvcmsvYmxvYi9tYXN0ZXIvZG9jcy9zcGVjcy9ydW50aW1lL2R5bmFtaWMtdmlldy9iYXNpY3MvZGVwbG95LXByb3Rvc3R1Yi5tZFxyXG4gICAgICAgICAgICBfc3R1YkRlc2NyaXB0b3IgPSBpbnN0YW5jZS5kZXNjcmlwdG9yO1xyXG4gICAgICAgICAgICBsb2cuaW5mbygnW1J1bnRpbWUuTG9hZGVyLmxvYWRTdHViXTIuIHJldHVybiB0aGUgUHJvdG9TdHViIGRlc2NyaXB0b3IgJywgX3N0dWJEZXNjcmlwdG9yKTtcclxuICAgICAgICAgICAgc3R1Ykluc3RhbmNlID0gaW5zdGFuY2U7XHJcblxyXG4vKiAgICAgICAgICAgIGxldCBzb3VyY2VQYWNrYWdlVVJMID0gc3R1YkRlc2NyaXB0b3Iuc291cmNlUGFja2FnZVVSTDtcclxuXHJcbiAgICAgICAgICAgIGlmIChzb3VyY2VQYWNrYWdlVVJMID09PSAnL3NvdXJjZVBhY2thZ2UnKSB7XHJcbiAgICAgICAgICAgICAgcmV0dXJuIHN0dWJEZXNjcmlwdG9yLnNvdXJjZVBhY2thZ2U7XHJcbiAgICAgICAgICAgIH0qL1xyXG5cclxuICAgICAgICAgICAgLy8gc3RlcCAxMCBodHRwczovL2dpdGh1Yi5jb20vcmVUSElOSy1wcm9qZWN0L2NvcmUtZnJhbWV3b3JrL2Jsb2IvbWFzdGVyL2RvY3Mvc3BlY3MvcnVudGltZS9keW5hbWljLXZpZXcvYmFzaWNzL2RlcGxveS1wcm90b3N0dWIubWRcclxuLy8gICAgICAgICAgICByZXR1cm4gdGhpcy5ydW50aW1lQ2F0YWxvZ3VlLmdldFNvdXJjZVBhY2thZ2VGcm9tVVJMKHNvdXJjZVBhY2thZ2VVUkwpO1xyXG5cclxuLyogICAgICAgICAgfSwgaGFuZGxlRXJyb3IpXHJcbiAgICAgICAgICAuY2F0Y2goZXJyb3JSZWFzb24pXHJcbiAgICAgICAgICAudGhlbigoc3R1YlNvdXJjZVBhY2thZ2UpID0+IHtcclxuICAgICAgICAgICAgaWYgKGhhdmVFcnJvcikgcmV0dXJuIGZhbHNlOyovXHJcblxyXG4gICAgICAgICAgICAvLyBBY2NvcmRpbmcgdG8gZGVidWcsIGl0IHNlZW1zIFJ1bnRpbWVDYXRhbG9ndWUgZG9lcyBub3Qgc3VwcG9ydCB5ZXQgY29uc3RyYWludHMuIEl0IGFwcGVhcnMgZW1wdHkhISEhXHJcblxyXG4gICAgICAgICAgICBpZiAoX3N0dWJEZXNjcmlwdG9yICYmIF9zdHViRGVzY3JpcHRvci5jb25zdHJhaW50cykge1xyXG4gICAgICAgICAgICAgIHN0dWJDYXBhYmlsaXRpZXMgPSBfc3R1YkRlc2NyaXB0b3IuY29uc3RyYWludHM7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIHN0ZXAgMTEgaHR0cHM6Ly9naXRodWIuY29tL3JlVEhJTkstcHJvamVjdC9jb3JlLWZyYW1ld29yay9ibG9iL21hc3Rlci9kb2NzL3NwZWNzL3J1bnRpbWUvZHluYW1pYy12aWV3L2Jhc2ljcy9kZXBsb3ktcHJvdG9zdHViLm1kXHJcbiAgICAgICAgICAgIGxvZy5pbmZvKCdbUnVudGltZS5Mb2FkZXIubG9hZFN0dWJdMy4gcmV0dXJuIHRoZSBQcm90b1N0dWIgU291cmNlIENvZGUnKTtcclxuLy8gICAgICAgICAgICBfc3R1YlNvdXJjZVBhY2thZ2UgPSBzdHViU291cmNlUGFja2FnZTtcclxuXHJcbiAgICAgICAgICAgIC8vIHRoaXMgd2lsbCByZXR1cm4gdGhlIHNhbmRib3ggb3Igb25lIHByb21pc2UgdG8gZ2V0U2FuZGJveDtcclxuICAgICAgICAgICAgLy8gc3RlcCAxMiBodHRwczovL2dpdGh1Yi5jb20vcmVUSElOSy1wcm9qZWN0L2NvcmUtZnJhbWV3b3JrL2Jsb2IvbWFzdGVyL2RvY3Mvc3BlY3MvcnVudGltZS9keW5hbWljLXZpZXcvYmFzaWNzL2RlcGxveS1wcm90b3N0dWIubWRcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMucmVnaXN0cnkuZ2V0U2FuZGJveChkb21haW4sIHN0dWJDYXBhYmlsaXRpZXMpO1xyXG4gICAgICAgICAgfSlcclxuICAgICAgICAgIC50aGVuKChzdHViU2FuZGJveCkgPT4ge1xyXG4gICAgICAgICAgICBpZiAoaGF2ZUVycm9yKSByZXR1cm4gZmFsc2U7XHJcblxyXG4gICAgICAgICAgICAvLyBzdGVwIDE1IGh0dHBzOi8vZ2l0aHViLmNvbS9yZVRISU5LLXByb2plY3QvY29yZS1mcmFtZXdvcmsvYmxvYi9tYXN0ZXIvZG9jcy9zcGVjcy9ydW50aW1lL2R5bmFtaWMtdmlldy9iYXNpY3MvZGVwbG95LXByb3Rvc3R1Yi5tZFxyXG4gICAgICAgICAgICBsb2cuaW5mbygnW1J1bnRpbWUuTG9hZGVyLmxvYWRTdHViXTQuIGlmIHRoZSBzYW5kYm94IGlzIHJlZ2lzdGVyZWQgdGhlbiByZXR1cm4gdGhlIHNhbmRib3ggJywgc3R1YlNhbmRib3gpO1xyXG5cclxuICAgICAgICAgICAgX3N0dWJTYW5kYm94ID0gc3R1YlNhbmRib3g7XHJcbiAgICAgICAgICAgIHJldHVybiBzdHViU2FuZGJveDtcclxuICAgICAgICAgIH0pXHJcbiAgICAgICAgICAuY2F0Y2goKHJlYXNvbikgPT4ge1xyXG4gICAgICAgICAgICBpZiAoaGF2ZUVycm9yKSByZXR1cm4gZmFsc2U7XHJcblxyXG4gICAgICAgICAgICAvLyBzdGVwIDEzIGh0dHBzOi8vZ2l0aHViLmNvbS9yZVRISU5LLXByb2plY3QvY29yZS1mcmFtZXdvcmsvYmxvYi9tYXN0ZXIvZG9jcy9zcGVjcy9ydW50aW1lL2R5bmFtaWMtdmlldy9iYXNpY3MvZGVwbG95LXByb3Rvc3R1Yi5tZFxyXG4gICAgICAgICAgICBsb2cuaW5mbygnW1J1bnRpbWUuTG9hZGVyLmxvYWRTdHViXTUuIFNhbmRib3ggd2FzIG5vdCBmb3VuZCwgY3JlYXRpbmcgYSBuZXcgb25lICcsIHJlYXNvbik7XHJcblxyXG4gICAgICAgICAgICAvLyBjaGVjayBpZiB0aGUgc2FuZGJveCBpcyByZWdpc3RlZCBmb3IgdGhpcyBzdHViIGRlc2NyaXB0b3IgdXJsO1xyXG5cclxuXHJcbiAgICAgICAgICAgIC8vIHN0ZXAgMTQgaHR0cHM6Ly9naXRodWIuY29tL3JlVEhJTkstcHJvamVjdC9jb3JlLWZyYW1ld29yay9ibG9iL21hc3Rlci9kb2NzL3NwZWNzL3J1bnRpbWUvZHluYW1pYy12aWV3L2Jhc2ljcy9kZXBsb3ktcHJvdG9zdHViLm1kXHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLl9ydW50aW1lRmFjdG9yeS5jcmVhdGVTYW5kYm94KHN0dWJDYXBhYmlsaXRpZXMpLnRoZW4oKHNhbmRib3gpID0+IHtcclxuICAgICAgICAgICAgICBzYW5kYm94LmFkZExpc3RlbmVyKCcqJywgKG1zZykgPT4ge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5tZXNzYWdlQnVzLnBvc3RNZXNzYWdlKG1zZyk7XHJcbiAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgIHJldHVybiBzYW5kYm94O1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICB9KVxyXG4gICAgICAgICAgLnRoZW4oKHNhbmRib3gpID0+IHtcclxuICAgICAgICAgICAgaWYgKGhhdmVFcnJvcikgcmV0dXJuIGZhbHNlO1xyXG5cclxuICAgICAgICAgICAgLy8gc3RlcCAxNiBodHRwczovL2dpdGh1Yi5jb20vcmVUSElOSy1wcm9qZWN0L2NvcmUtZnJhbWV3b3JrL2Jsb2IvbWFzdGVyL2RvY3Mvc3BlY3MvcnVudGltZS9keW5hbWljLXZpZXcvYmFzaWNzL2RlcGxveS1wcm90b3N0dWIubWRcclxuICAgICAgICAgICAgbG9nLmluZm8oJ1tSdW50aW1lLkxvYWRlci5sb2FkU3R1Yl02LiByZXR1cm4gdGhlIHNhbmRib3ggaW5zdGFuY2UgYW5kIHJlZ2lzdGVyJywgc2FuZGJveCwgJ3RvIGRvbWFpbiAnLCBkb21haW4pO1xyXG5cclxuICAgICAgICAgICAgX3N0dWJTYW5kYm94ID0gc2FuZGJveDtcclxuXHJcbiAgICAgICAgICAgIC8vIHdlIG5lZWQgcmVnaXN0ZXIgc3R1YiBvbiByZWdpc3RyeSAtIHN0ZXAgeHh4IGh0dHBzOi8vZ2l0aHViLmNvbS9yZVRISU5LLXByb2plY3QvY29yZS1mcmFtZXdvcmsvYmxvYi9tYXN0ZXIvZG9jcy9zcGVjcy9ydW50aW1lL2R5bmFtaWMtdmlldy9iYXNpY3MvZGVwbG95LXByb3Rvc3R1Yi5tZFxyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5yZWdpc3RyeS5yZWdpc3RlclN0dWIoX3N0dWJTYW5kYm94LCBzdHViSWQsIHAycENvbmZpZywgcHJvdG9zdHViVVJMLCBfc3R1YkRlc2NyaXB0b3IpO1xyXG4gICAgICAgICAgfSwgaGFuZGxlRXJyb3IpXHJcbiAgICAgICAgICAudGhlbigocnVudGltZVByb3RvU3R1YikgPT4ge1xyXG4gICAgICAgICAgICBpZiAoaGF2ZUVycm9yKSByZXR1cm4gZmFsc2U7XHJcblxyXG4gICAgICAgICAgICAvLyBzdGVwIDIzIGh0dHBzOi8vZ2l0aHViLmNvbS9yZVRISU5LLXByb2plY3QvY29yZS1mcmFtZXdvcmsvYmxvYi9tYXN0ZXIvZG9jcy9zcGVjcy9ydW50aW1lL2R5bmFtaWMtdmlldy9iYXNpY3MvZGVwbG95LXByb3Rvc3R1Yi5tZFxyXG4gICAgICAgICAgICBsb2cuaW5mbygnW1J1bnRpbWUuTG9hZGVyLmxvYWRTdHViXSA3LiByZXR1cm4gdGhlIHJ1bnRpbWUgcHJvdG9zdHViIHVybDogJywgcnVudGltZVByb3RvU3R1Yik7XHJcblxyXG4gICAgICAgICAgICBfcnVudGltZVByb3RvU3R1YlVSTCA9IHJ1bnRpbWVQcm90b1N0dWIudXJsO1xyXG5cclxuICAgICAgICAgICAgLy8gRXh0ZW5kIG9yaWdpbmFsIGh5cGVydHkgY29uZmlndXJhdGlvbjtcclxuICAgICAgICAgICAgbGV0IGNvbmZpZ3VyYXRpb24gPSB7fTtcclxuICAgICAgICAgICAgaWYgKCFlbXB0eU9iamVjdChfc3R1YkRlc2NyaXB0b3IuY29uZmlndXJhdGlvbikpIHtcclxuICAgICAgICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICAgICAgY29uZmlndXJhdGlvbiA9IE9iamVjdC5hc3NpZ24oe30sIEpTT04ucGFyc2UoX3N0dWJEZXNjcmlwdG9yLmNvbmZpZ3VyYXRpb24pKTtcclxuICAgICAgICAgICAgICB9IGNhdGNoIChlKSB7XHJcbiAgICAgICAgICAgICAgICBjb25maWd1cmF0aW9uID0gX3N0dWJEZXNjcmlwdG9yLmNvbmZpZ3VyYXRpb247XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAocDJwQ29uZmlnKSB7XHJcbiAgICAgICAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgICAgIGNvbmZpZ3VyYXRpb24gPSBPYmplY3QuYXNzaWduKGNvbmZpZ3VyYXRpb24sIEpTT04ucGFyc2UocDJwQ29uZmlnKSk7XHJcbiAgICAgICAgICAgICAgfSBjYXRjaCAoZSkge1xyXG4gICAgICAgICAgICAgICAgY29uZmlndXJhdGlvbiA9IE9iamVjdC5hc3NpZ24oY29uZmlndXJhdGlvbiwgcDJwQ29uZmlnKTtcclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIHJlcXVpcmVkIGZvciBwcm90b3N0dWIgc2Vzc2lvblxyXG5cclxuICAgICAgICAgICAgY29uZmlndXJhdGlvbi5ydW50aW1lVVJMID0gdGhpcy5fcnVudGltZVVSTDtcclxuXHJcbiAgICAgICAgICAgIC8vIHN0ZXAgMjQgaHR0cHM6Ly9naXRodWIuY29tL3JlVEhJTkstcHJvamVjdC9jb3JlLWZyYW1ld29yay9ibG9iL21hc3Rlci9kb2NzL3NwZWNzL3J1bnRpbWUvZHluYW1pYy12aWV3L2Jhc2ljcy9kZXBsb3ktcHJvdG9zdHViLm1kXHJcbiAgICAgICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgICAgLy8gc3RlcCAyNiBodHRwczovL2dpdGh1Yi5jb20vcmVUSElOSy1wcm9qZWN0L2NvcmUtZnJhbWV3b3JrL2Jsb2IvbWFzdGVyL2RvY3Mvc3BlY3MvcnVudGltZS9keW5hbWljLXZpZXcvYmFzaWNzL2RlcGxveS1wcm90b3N0dWIubWRcclxuICAgICAgICAgICAgICBsb2cuaW5mbygnW1J1bnRpbWUuTG9hZGVyLmxvYWRTdHViXSA4OiBhZGRpbmcgc2FuZGJveCBsaXN0ZW5lciB0byBwcm90b3N0dWJVUkwgOiAnLCBfcnVudGltZVByb3RvU3R1YlVSTCk7XHJcblxyXG4gICAgICAgICAgICAgIC8vIHN0ZXAgMjcgaHR0cHM6Ly9naXRodWIuY29tL3JlVEhJTkstcHJvamVjdC9jb3JlLWZyYW1ld29yay9ibG9iL21hc3Rlci9kb2NzL3NwZWNzL3J1bnRpbWUvZHluYW1pYy12aWV3L2Jhc2ljcy9kZXBsb3ktcHJvdG9zdHViLm1kXHJcbiAgICAgICAgICAgICAgLy8gQWRkIHRoZSBtZXNzYWdlIGJ1cyBsaXN0ZW5lclxyXG4gICAgICAgICAgICAgIHRoaXMubWVzc2FnZUJ1cy5hZGRMaXN0ZW5lcihfcnVudGltZVByb3RvU3R1YlVSTCwgKG1zZykgPT4ge1xyXG4gICAgICAgICAgICAgICAgX3N0dWJTYW5kYm94LnBvc3RNZXNzYWdlKG1zZyk7XHJcbiAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgIHJldHVybiBfc3R1YlNhbmRib3guZGVwbG95Q29tcG9uZW50KHN0dWJJbnN0YW5jZSwgX3J1bnRpbWVQcm90b1N0dWJVUkwsIGNvbmZpZ3VyYXRpb24pO1xyXG4gICAgICAgICAgICB9IGNhdGNoIChlKSB7XHJcbiAgICAgICAgICAgICAgbG9nLmVycm9yKCdbUnVudGltZS5Mb2FkZXIubG9hZFN0dWJdIEVycm9yIG9uIGRlcGxveSBjb21wb25lbnQ6JywgZSk7XHJcbiAgICAgICAgICAgICAgcmVqZWN0KGUpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9LCBoYW5kbGVFcnJvcilcclxuICAgICAgICAgIC50aGVuKCgpID0+IHtcclxuICAgICAgICAgICAgaWYgKGhhdmVFcnJvcikgcmV0dXJuIGZhbHNlO1xyXG5cclxuXHJcbiAgICAgICAgICAgIC8vIHN0ZXAgMjggaHR0cHM6Ly9naXRodWIuY29tL3JlVEhJTkstcHJvamVjdC9jb3JlLWZyYW1ld29yay9ibG9iL21hc3Rlci9kb2NzL3NwZWNzL3J1bnRpbWUvZHluYW1pYy12aWV3L2Jhc2ljcy9kZXBsb3ktcHJvdG9zdHViLm1kXHJcbiAgICAgICAgICAgIGxldCByZWdpc3RlcmVkU3R1YjtcclxuICAgICAgICAgICAgaWYgKHAycENvbmZpZykge1xyXG4gICAgICAgICAgICAgIGxvZy5sb2coJ1tSdW50aW1lLkxvYWRlci5sb2FkU3R1Yl0gcDJwQ29uZmlnOiAnLCBwMnBDb25maWcpO1xyXG5cclxuICAgICAgICAgICAgICBpZiAocDJwQ29uZmlnLmhhc093blByb3BlcnR5KCdpc0hhbmRsZXJTdHViJykpIHJlZ2lzdGVyZWRTdHViID0gdGhpcy5yZWdpc3RyeS5wMnBIYW5kbGVyU3R1Ylt0aGlzLl9ydW50aW1lVVJMXTtcclxuICAgICAgICAgICAgICBpZiAocDJwQ29uZmlnLmhhc093blByb3BlcnR5KCdwMnBSZXF1ZXN0ZXJTdHViJykpIHJlZ2lzdGVyZWRTdHViID0gdGhpcy5yZWdpc3RyeS5wMnBSZXF1ZXN0ZXJTdHViW3AycENvbmZpZy5yZW1vdGVSdW50aW1lVVJMXTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICByZWdpc3RlcmVkU3R1YiA9IHRoaXMucmVnaXN0cnkucHJvdG9zdHVic0xpc3RbZG9tYWluXTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgbG9nLmxvZygnW1J1bnRpbWUuTG9hZGVyLmxvYWRTdHViXSBTdHViOiAnLCByZWdpc3RlcmVkU3R1Yik7XHJcbiAgICAgICAgICAgIHJlc29sdmUocmVnaXN0ZXJlZFN0dWIpO1xyXG4gICAgICAgICAgICBsb2cuaW5mbygnW1J1bnRpbWUuTG9hZGVyLmxvYWRTdHViXS0tLS0tLS0tLS0tLS0tLS0tLS0gRU5EIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxcbicpO1xyXG4gICAgICAgICAgfSwgaGFuZGxlRXJyb3IpXHJcbiAgICAgICAgICAuY2F0Y2goZXJyb3JSZWFzb24pO1xyXG5cclxuICAgICAgfVxyXG5cclxuICAgIH0pO1xyXG5cclxuICB9XHJcblxyXG4gIF9sb2FkKHR5cGUsIHVybCkge1xyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcclxuXHJcbiAgICAgIGxldCBkb21haW47XHJcbiAgICAgIGxldCBzdHViO1xyXG5cclxuICAgICAgbGV0IG9yaWdpbkRpdmlkZWRVUkwgPSBkaXZpZGVVUkwodGhpcy5ydW50aW1lVVJMKTtcclxuICAgICAgbGV0IG9yaWdpbkRvbWFpbiA9IG9yaWdpbkRpdmlkZWRVUkwuZG9tYWluO1xyXG4gICAgICBsZXQgbG9hZGVyID0gbmV3IFN5c3RlbS5jb25zdHJ1Y3RvcigpO1xyXG4gICAgICBsZXQgZGl2aWRlZFVSTCA9IGRpdmlkZVVSTCh1cmwpO1xyXG4gICAgICBkb21haW4gPSBkaXZpZGVkVVJMLmRvbWFpbjtcclxuICAgICAgbGV0IHBhdGggPSBkaXZpZGVkVVJMLmlkZW50aXR5O1xyXG5cclxuLyogICAgICBsZXQgY29uc3RyYWludHMgPSB0aGlzLmNvbnN0cmFpbnRzO1xyXG5cclxuICAgICAgY29uc3RyYWludHMuY29uc3RyYWludHMub25seUFjY2Vzc1Rva2VuID0gdHJ1ZTtcclxuICAgICAgY29uc3RyYWludHMuY29uc3RyYWludHMub25seUlkQXNzZXJ0aW9uVmFsaWRhdGlvbiA9IHRydWU7XHJcbiAgICAgIGNvbnNvbGUubG9nKCdMT0cgSEVSRScsIGNvbnN0cmFpbnRzKTsqL1xyXG4gICAgICBpZiAodXJsLmluY2x1ZGVzKCc6Ly8nKSkge1xyXG4gICAgICAgIGRvbWFpbiA9IGRpdmlkZWRVUkwuZG9tYWluO1xyXG4gICAgICAgIGlmIChwYXRoKSB7XHJcbiAgICAgICAgICBzdHViID0gcGF0aC5zdWJzdHJpbmcocGF0aC5sYXN0SW5kZXhPZignLycpICsgMSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIHN0dWIgPSAnZGVmYXVsdCc7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgfSBlbHNlIGlmICh0eXBlID09PSAnaWRwLXByb3h5Jykge1xyXG4gICAgICAgIGRvbWFpbiA9IG9yaWdpbkRvbWFpbjtcclxuICAgICAgICBzdHViID0gdXJsO1xyXG4gICAgICB9IFxyXG4gICAgICBlbHNlIHtcclxuICAgICAgICBzdHViID0gJ2RlZmF1bHQnO1xyXG4gICAgICAgIGRvbWFpbiA9IHVybDtcclxuICAgICAgfVxyXG5cclxuICAgICAgbGV0IHJlc291cmNlID0gZ2V0Q29uZmlndXJhdGlvblJlc291cmNlcyh0aGlzLnJ1bnRpbWVDb25maWd1cmF0aW9uLCAnY2F0YWxvZ3VlVVJMcycsIHR5cGUpO1xyXG5cclxuICAgICAgbGV0IGV4dCA9IHR5cGUgPT09ICdpZHAtcHJveHknID8gJy5pZHAuanMnIDogJy5wcy5qcyc7XHJcblxyXG5cclxuICAgICAgbGV0IGxvYWRpbmdVcmwgPSByZXNvdXJjZS5wcmVmaXggKyBkb21haW4gKyByZXNvdXJjZS5zdWZmaXggKyBzdHViICsgZXh0O1xyXG4gICAgICBsb2cubG9nKCdbTG9hZGVyLl9sb2FkXSBmaXJzdCBpbXBvcnQgZm9yICcgKyB1cmwpO1xyXG5cclxuICAgICAgbG9hZGVyLmltcG9ydChsb2FkaW5nVXJsKS50aGVuKChyZXN1bHQpID0+IHtcclxuXHJcbiAgICAgICAgbGV0IGluc3RhbmNlID0gbmV3IHJlc3VsdC5kZWZhdWx0KCk7XHJcbiAgICAgICAgbG9nLmxvZygnW0xvYWRlci5fbG9hZF0gZmlyc3QgaW1wb3J0IHJlc3VsdCAnICsgaW5zdGFuY2UubmFtZSk7XHJcbiAgICAgICAgbG9hZGVyLmRlbGV0ZShsb2FkaW5nVXJsKTtcclxuICAgICAgICByZXNvbHZlKGluc3RhbmNlKTtcclxuXHJcbiAgICAgIH0pLmNhdGNoKCgpID0+IHtcclxuXHJcbi8qICAgICAgICBzdHViID0gZG9tYWluO1xyXG4gICAgICAgIGRvbWFpbiA9IG9yaWdpbkRvbWFpbjtcclxuXHJcbiAgICAgICAgbGV0IGxvYWRpbmdVcmwyID0gYnVpbGRVUkwodGhpcy5ydW50aW1lQ29uZmlndXJhdGlvbiwgJ2NhdGFsb2d1ZVVSTHMnLCB0eXBlLCBzdHViLCB0cnVlKTtcclxuXHJcbiAgICAgICAgbG9nLmxvZygnW0xvYWRlci5fbG9hZF0gMm5kIGltcG9ydCBmb3IgJyArIGxvYWRpbmdVcmwyKTtcclxuXHJcbiAgICAgICAgbG9hZGVyLmltcG9ydChsb2FkaW5nVXJsMikudGhlbigocmVzdWx0MikgPT4ge1xyXG5cclxuLy8gICAgICAgICAgbG9nLmxvZygnW0xvYWRlci5fbG9hZF0gMm5kIGltcG9ydCByZXN1bHQgJyArIHJlc3VsdDIpO1xyXG5cclxuICAgICAgICBsZXQgaW5zdGFuY2UyID0gbmV3IHJlc3VsdDIuZGVmYXVsdCgpO1xyXG5cclxuICAgICAgICBsb2cubG9nKCdbTG9hZGVyLl9sb2FkXSAybmQgaW1wb3J0IHJlc3VsdCAnICsgaW5zdGFuY2UyLm5hbWUpO1xyXG4gICAgICAgIGxvYWRlci5kZWxldGUobG9hZGluZ1VybDIpO1xyXG5cclxuICAgICAgICByZXNvbHZlKGluc3RhbmNlMik7XHJcbiAgICAgIH0pLmNhdGNoKChyZWFzb24pID0+IHsqL1xyXG4gICAgICAgIHJlamVjdChyZWFzb24pO1xyXG4gICAgICB9KTtcclxuICAgIH0pO1xyXG5cclxuLy8gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAqIERlcGxveSBpZHBQcm94eSBmcm9tIENhdGFsb2d1ZSBVUkwgb3IgZG9tYWluIHVybFxyXG4gICogQHBhcmFtICB7VVJMLlVSTH0gICAgIGRvbWFpbiAgICAgICAgICBkb21haW5cclxuICAqL1xyXG5cclxuICBsb2FkSWRwUHJveHkoaWRwUHJveHlVUkwpIHtcclxuXHJcbiAgICBpZiAoIXRoaXMuX3JlYWR5VG9Vc2UoKSkgcmV0dXJuIGZhbHNlO1xyXG4gICAgaWYgKCFpZHBQcm94eVVSTCkgdGhyb3cgbmV3IEVycm9yKCdbUnVudGltZS5Mb2FkZXJdIElkcFByb3h5IGRlc2NyaXB0b3IgdXJsIHBhcmFtZXRlciBpcyBuZWVkZWQnKTtcclxuXHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xyXG5cclxuICAgICAgbGV0IGRvbWFpbiA9IGRpdmlkZVVSTChpZHBQcm94eVVSTCkuZG9tYWluO1xyXG5cclxuICAgICAgaWYgKCFkb21haW4pIHtcclxuICAgICAgICBkb21haW4gPSBpZHBQcm94eVVSTDtcclxuICAgICAgfVxyXG5cclxuICAgICAgbGV0IF9wcm94eVNhbmRib3g7XHJcbiAgICAgIGxldCBfcHJveHlEZXNjcmlwdG9yO1xyXG4gICAgICBsZXQgX3J1bnRpbWVJZHBQcm94eVVSTDtcclxuICAgICAgbGV0IF9wcm94eVNvdXJjZVBhY2thZ2U7XHJcbiAgICAgIGxldCBoYXZlRXJyb3IgPSBmYWxzZTtcclxuICAgICAgbGV0IGlkcFByb3h5O1xyXG5cclxuICAgICAgbGV0IGVycm9yUmVhc29uID0gKHJlYXNvbikgPT4ge1xyXG4gICAgICAgIGxvZy5pbmZvKCdbUnVudGltZS5Mb2FkZXJdIFNvbWV0aGluZyBmYWlsZWQgb24gdGhlIGRlcGxveSBvZiBJZHBQcm94eTogJywgcmVhc29uKTtcclxuICAgICAgICByZWplY3QocmVhc29uKTtcclxuICAgICAgfTtcclxuXHJcbiAgICAgIGxldCBoYW5kbGVFcnJvciA9IChyZWFzb24pID0+IHtcclxuICAgICAgICBoYXZlRXJyb3IgPSB0cnVlO1xyXG4gICAgICAgIHJlamVjdChyZWFzb24pO1xyXG4gICAgICB9O1xyXG5cclxuICAgICAgLy8gRGlzY292ZXIgSURQUHJveHlcclxuICAgICAgbG9nLmluZm8oJ1tSdW50aW1lLkxvYWRlcl0gLS0tLS0tLS0tLS0tLS0tLS0tLSBJRFAgUHJveHkgRGVwbG95IC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxcbicpO1xyXG4gICAgICBsb2cuaW5mbygnW1J1bnRpbWUuTG9hZGVyXSBEaXNjb3ZlciBvciBDcmVhdGUgYSBuZXcgSWRwUHJveHkgZm9yIGRvbWFpbi9VUkw6ICcsIGRvbWFpbik7XHJcblxyXG4gICAgICB0cnkge1xyXG4gICAgICAgIGxldCBydW50aW1lSWRwUHJveHlVUkwgPSB0aGlzLnJlZ2lzdHJ5LmRpc2NvdmVySWRwUHJveHkoZG9tYWluKTtcclxuXHJcbiAgICAgICAgLy8gSXMgcmVnaXN0ZWQ/XHJcbiAgICAgICAgbG9nLmluZm8oJ1tSdW50aW1lLkxvYWRlcl0gMS4gSURQUHJveHkgRGlzY292ZXJlZDogJywgcnVudGltZUlkcFByb3h5VVJMKTtcclxuXHJcbiAgICAgICAgLy8gd2UgaGF2ZSBjb21wbGV0ZWQgc3RlcCAyIGh0dHBzOi8vZ2l0aHViLmNvbS9yZVRISU5LLXByb2plY3QvY29yZS1mcmFtZXdvcmsvYmxvYi9tYXN0ZXIvZG9jcy9zcGVjcy9ydW50aW1lL2R5bmFtaWMtdmlldy9iYXNpY3MvZGVwbG95LXByb3Rvc3R1Yi5tZFxyXG5cclxuICAgICAgICBsZXQgaWRwUHJveHkgPSB0aGlzLnJlZ2lzdHJ5LmlkcFByb3h5TGlzdFtkb21haW5dO1xyXG4gICAgICAgIGxvZy5sb2coJ0RlcGxveWVkOiAnLCBpZHBQcm94eSk7XHJcblxyXG4gICAgICAgIHJlc29sdmUoaWRwUHJveHkpO1xyXG4gICAgICAgIGxvZy5pbmZvKCdbUnVudGltZS5Mb2FkZXJdIC0tLS0tLS0tLS0tLS0tLS0tLS0gRU5EIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxcbicpO1xyXG4gICAgICB9IGNhdGNoIChyZWFzb24pIHtcclxuXHJcbiAgICAgICAgLy8gaXMgbm90IHJlZ2lzdGVkP1xyXG4gICAgICAgIGxvZy5pbmZvKCdbUnVudGltZS5Mb2FkZXJdIDEuIElkcFByb3h5IG5vdCBmb3VuZDonLCByZWFzb24pO1xyXG5cclxuICAgICAgICAvLyB3ZSBoYXZlIGNvbXBsZXRlZCBzdGVwIDMgaHR0cHM6Ly9naXRodWIuY29tL3JlVEhJTkstcHJvamVjdC9jb3JlLWZyYW1ld29yay9ibG9iL21hc3Rlci9kb2NzL3NwZWNzL3J1bnRpbWUvZHluYW1pYy12aWV3L2Jhc2ljcy9kZXBsb3ktcHJvdG9zdHViLm1kXHJcblxyXG4gICAgICAgIC8vIHdlIG5lZWQgdG8gZ2V0IFByb3RvU3R1YiBkZXNjcmlwdG9yIHN0ZXAgNCBodHRwczovL2dpdGh1Yi5jb20vcmVUSElOSy1wcm9qZWN0L2NvcmUtZnJhbWV3b3JrL2Jsb2IvbWFzdGVyL2RvY3Mvc3BlY3MvcnVudGltZS9keW5hbWljLXZpZXcvYmFzaWNzL2RlcGxveS1wcm90b3N0dWIubWRcclxuICAgICAgICAvLyB0aGlzLmRlc2NyaXB0b3JzLmdldElkcFByb3h5RGVzY3JpcHRvcihpZHBQcm94eVVSTClcclxuXHJcbiAgICAgICAgdGhpcy5fbG9hZCgnaWRwLXByb3h5JyxpZHBQcm94eVVSTClcclxuICAgICAgICAgIC50aGVuKChpbnN0YW5jZSkgPT4ge1xyXG5cclxuICAgICAgICAgICAgbG9nLmluZm8oJ1tSdW50aW1lLkxvYWRlcl0gMi4gUmV0dXJuIHRoZSBJRFBQcm94eSBkZXNjcmlwdG9yJyk7XHJcblxyXG4gICAgICAgICAgICAvLyB3ZSBoYXZlIGNvbXBsZXRlZCBzdGVwIDUgaHR0cHM6Ly9naXRodWIuY29tL3JlVEhJTkstcHJvamVjdC9jb3JlLWZyYW1ld29yay9ibG9iL21hc3Rlci9kb2NzL3NwZWNzL3J1bnRpbWUvZHluYW1pYy12aWV3L2Jhc2ljcy9kZXBsb3ktcHJvdG9zdHViLm1kXHJcbiAgICAgICAgICAgIF9wcm94eURlc2NyaXB0b3IgPSBpbnN0YW5jZS5kZXNjcmlwdG9yO1xyXG5cclxuICAgICAgICAgICAgaWRwUHJveHkgPSBpbnN0YW5jZTtcclxuXHJcbi8qICAgICAgICAgICAgbGV0IHNvdXJjZVBhY2thZ2VVUkwgPSBwcm94eURlc2NyaXB0b3Iuc291cmNlUGFja2FnZVVSTDtcclxuXHJcbiAgICAgICAgICAgIGlmIChzb3VyY2VQYWNrYWdlVVJMID09PSAnL3NvdXJjZVBhY2thZ2UnKSB7XHJcbiAgICAgICAgICAgICAgcmV0dXJuIHByb3h5RGVzY3JpcHRvci5zb3VyY2VQYWNrYWdlO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyB3ZSBuZWVkIHRvIGdldCBQcm90b1N0dWIgU291cmNlIGNvZGUgZnJvbSBkZXNjcmlwdG9yIC0gc3RlcCA2IGh0dHBzOi8vZ2l0aHViLmNvbS9yZVRISU5LLXByb2plY3QvY29yZS1mcmFtZXdvcmsvYmxvYi9tYXN0ZXIvZG9jcy9zcGVjcy9ydW50aW1lL2R5bmFtaWMtdmlldy9iYXNpY3MvZGVwbG95LXByb3Rvc3R1Yi5tZFxyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5ydW50aW1lQ2F0YWxvZ3VlLmdldFNvdXJjZVBhY2thZ2VGcm9tVVJMKHNvdXJjZVBhY2thZ2VVUkwpO1xyXG4gICAgICAgICAgfSwgaGFuZGxlRXJyb3IpXHJcbiAgICAgICAgICAudGhlbigoc291cmNlUGFja2FnZSkgPT4ge1xyXG4gICAgICAgICAgICBpZiAoaGF2ZUVycm9yKSByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgIGxvZy5pbmZvKCdbUnVudGltZS5Mb2FkZXJdIDMuIHJldHVybiB0aGUgSURQUHJveHkgc291cmNlIHBhY2thZ2UnKTtcclxuXHJcbiAgICAgICAgICAgIC8vIHdlIGhhdmUgY29tcGxldGVkIHN0ZXAgNyBodHRwczovL2dpdGh1Yi5jb20vcmVUSElOSy1wcm9qZWN0L2NvcmUtZnJhbWV3b3JrL2Jsb2IvbWFzdGVyL2RvY3Mvc3BlY3MvcnVudGltZS9keW5hbWljLXZpZXcvYmFzaWNzL2RlcGxveS1wcm90b3N0dWIubWRcclxuXHJcbiAgICAgICAgICAgIF9wcm94eVNvdXJjZVBhY2thZ2UgPSBzb3VyY2VQYWNrYWdlO1xyXG5cclxuICAgICAgICAgICAgLy8gVE9ETzogQ2hlY2sgb24gUEVQIChwb2xpY3kgRW5naW5lKSBpZiB3ZSBuZWVkIHRoZSBzYW5kYm94IGFuZCBjaGVjayBpZiB0aGUgU2FuZGJveCBGYWN0b3J5IGhhdmUgdGhlIGNvbnRleHQgc2FuZGJveDtcclxuICAgICAgICAgICAgbGV0IHBvbGljeSA9IHRydWU7XHJcbiAgICAgICAgICAgIHJldHVybiBwb2xpY3k7XHJcbiAgICAgICAgICB9LCBoYW5kbGVFcnJvcilcclxuICAgICAgICAgIC50aGVuKChwb2xpY3kpID0+IHtcclxuICAgICAgICAgICAgaWYgKGhhdmVFcnJvcikgcmV0dXJuIGZhbHNlOyovXHJcblxyXG4gICAgICAgICAgICAvLyB0aGlzIHdpbGwgcmV0dXJuIHRoZSBzYW5kYm94IG9yIG9uZSBwcm9taXNlIHRvIGdldFNhbmRib3g7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLnJlZ2lzdHJ5LmdldFNhbmRib3goZG9tYWluKTtcclxuICAgICAgICAgIH0pXHJcbiAgICAgICAgICAudGhlbigocHJveHlTYW5kYm94KSA9PiB7XHJcbiAgICAgICAgICAgIGlmIChoYXZlRXJyb3IpIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgbG9nLmluZm8oJ1tSdW50aW1lLkxvYWRlcl0gNC4gaWYgdGhlIHNhbmRib3ggaXMgcmVnaXN0ZXJlZCB0aGVuIHJldHVybiB0aGUgc2FuZGJveCcsIHByb3h5U2FuZGJveCk7XHJcblxyXG4gICAgICAgICAgICBfcHJveHlTYW5kYm94ID0gcHJveHlTYW5kYm94O1xyXG4gICAgICAgICAgICByZXR1cm4gcHJveHlTYW5kYm94O1xyXG4gICAgICAgICAgfSlcclxuICAgICAgICAgIC5jYXRjaCgocmVhc29uKSA9PiB7XHJcbiAgICAgICAgICAgIGlmIChoYXZlRXJyb3IpIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgbG9nLmluZm8oJ1tSdW50aW1lLkxvYWRlcl0gNS4gU2FuZGJveCB3YXMgbm90IGZvdW5kLCBjcmVhdGluZyBhIG5ldyBvbmUnLCByZWFzb24pO1xyXG5cclxuICAgICAgICAgICAgbGV0IHByb3h5Q2FwYWJpbGl0aWVzID0ge307XHJcbiAgICAgICAgICAgIGlmIChfcHJveHlEZXNjcmlwdG9yICYmIF9wcm94eURlc2NyaXB0b3IuaGFzT3duUHJvcGVydHkoJ2NhcGFiaWxpdGllcycpKSB7XHJcbiAgICAgICAgICAgICAgX3Byb3h5RGVzY3JpcHRvciA9IF9wcm94eURlc2NyaXB0b3Iuc3R1YkNhcGFiaWxpdGllcztcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3J1bnRpbWVGYWN0b3J5LmNyZWF0ZVNhbmRib3gocHJveHlDYXBhYmlsaXRpZXMpLnRoZW4oKHNhbmRib3gpID0+IHtcclxuXHJcbiAgICAgICAgICAgICAgc2FuZGJveC5hZGRMaXN0ZW5lcignKicsIChtc2cpID0+IHtcclxuICAgICAgICAgICAgICAgIHRoaXMubWVzc2FnZUJ1cy5wb3N0TWVzc2FnZShtc2cpO1xyXG4gICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICByZXR1cm4gc2FuZGJveDtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICB9KVxyXG4gICAgICAgICAgLnRoZW4oKHNhbmRib3gpID0+IHtcclxuICAgICAgICAgICAgaWYgKGhhdmVFcnJvcikgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICBsb2cuaW5mbygnW1J1bnRpbWUuTG9hZGVyXSA2LiByZXR1cm4gdGhlIHNhbmRib3ggaW5zdGFuY2UgYW5kIHJlZ2lzdGVyJywgc2FuZGJveCwgJ3RvIGRvbWFpbiAnLCBkb21haW4pO1xyXG5cclxuICAgICAgICAgICAgX3Byb3h5U2FuZGJveCA9IHNhbmRib3g7XHJcblxyXG4gICAgICAgICAgICAvLyB3ZSBuZWVkIHJlZ2lzdGVyIHN0dWIgb24gcmVnaXN0cnkgLSBzdGVwIHh4eCBodHRwczovL2dpdGh1Yi5jb20vcmVUSElOSy1wcm9qZWN0L2NvcmUtZnJhbWV3b3JrL2Jsb2IvbWFzdGVyL2RvY3Mvc3BlY3MvcnVudGltZS9keW5hbWljLXZpZXcvYmFzaWNzL2RlcGxveS1wcm90b3N0dWIubWRcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMucmVnaXN0cnkucmVnaXN0ZXJJZHBQcm94eShzYW5kYm94LCBkb21haW4pO1xyXG4gICAgICAgICAgfSwgaGFuZGxlRXJyb3IpXHJcbiAgICAgICAgICAudGhlbigocnVudGltZUlkcFByb3h5VVJMKSA9PiB7XHJcbiAgICAgICAgICAgIGlmIChoYXZlRXJyb3IpIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgbG9nLmluZm8oJ1tSdW50aW1lLkxvYWRlcl0gNy4gUmV0dXJuIHRoZSBydW50aW1lIElkcCBQcm94eSBVUkw6ICcsIHJ1bnRpbWVJZHBQcm94eVVSTCk7XHJcblxyXG4gICAgICAgICAgICAvLyB3ZSBoYXZlIGNvbXBsZXRlZCBzdGVwIHh4eCBodHRwczovL2dpdGh1Yi5jb20vcmVUSElOSy1wcm9qZWN0L2NvcmUtZnJhbWV3b3JrL2Jsb2IvbWFzdGVyL2RvY3Mvc3BlY3MvcnVudGltZS9keW5hbWljLXZpZXcvYmFzaWNzL2RlcGxveS1wcm90b3N0dWIubWRcclxuXHJcbiAgICAgICAgICAgIF9ydW50aW1lSWRwUHJveHlVUkwgPSBydW50aW1lSWRwUHJveHlVUkw7XHJcblxyXG4gICAgICAgICAgICAvLyBFeHRlbmQgb3JpZ2luYWwgaHlwZXJ0eSBjb25maWd1cmF0aW9uO1xyXG4gICAgICAgICAgICBsZXQgY29uZmlndXJhdGlvbiA9IHt9O1xyXG4gICAgICAgICAgICBpZiAoIWVtcHR5T2JqZWN0KF9wcm94eURlc2NyaXB0b3IuY29uZmlndXJhdGlvbikpIHtcclxuICAgICAgICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICAgICAgY29uZmlndXJhdGlvbiA9IE9iamVjdC5hc3NpZ24oe30sIEpTT04ucGFyc2UoX3Byb3h5RGVzY3JpcHRvci5jb25maWd1cmF0aW9uKSk7XHJcbiAgICAgICAgICAgICAgfSBjYXRjaCAoZSkge1xyXG4gICAgICAgICAgICAgICAgY29uZmlndXJhdGlvbiA9IF9wcm94eURlc2NyaXB0b3IuY29uZmlndXJhdGlvbjtcclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgY29uZmlndXJhdGlvbi5ydW50aW1lVVJMID0gdGhpcy5fcnVudGltZVVSTDtcclxuXHJcbiAgICAgICAgICAgIC8vIERlcGxveSBDb21wb25lbnQgc3RlcCB4eHhcclxuICAgICAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgICAvLyB3ZSBoYXZlIGNvbXBsZXRlZCBzdGVwIHh4eCBodHRwczovL2dpdGh1Yi5jb20vcmVUSElOSy1wcm9qZWN0L2NvcmUtZnJhbWV3b3JrL2Jsb2IvbWFzdGVyL2RvY3Mvc3BlY3MvcnVudGltZS9keW5hbWljLXZpZXcvYmFzaWNzL2RlcGxveS1wcm90b3N0dWIubWRcclxuXHJcbiAgICAgICAgICAgICAgLy8gQWRkIHRoZSBtZXNzYWdlIGJ1cyBsaXN0ZW5lclxyXG4gICAgICAgICAgICAgIHRoaXMubWVzc2FnZUJ1cy5hZGRMaXN0ZW5lcihfcnVudGltZUlkcFByb3h5VVJMLCAobXNnKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBfcHJveHlTYW5kYm94LnBvc3RNZXNzYWdlKG1zZyk7XHJcbiAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgIHJldHVybiBfcHJveHlTYW5kYm94LmRlcGxveUNvbXBvbmVudChpZHBQcm94eSwgcnVudGltZUlkcFByb3h5VVJMLCBjb25maWd1cmF0aW9uKTtcclxuICAgICAgICAgICAgfSBjYXRjaCAoZSkge1xyXG4gICAgICAgICAgICAgIGxvZy5pbmZvKCdbUnVudGltZS5Mb2FkZXJdIEVycm9yIG9uIGRlcGxveSBjb21wb25lbnQ6JywgZSk7XHJcbiAgICAgICAgICAgICAgcmVqZWN0KGUpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9LCBoYW5kbGVFcnJvcilcclxuICAgICAgICAgIC50aGVuKCgpID0+IHtcclxuICAgICAgICAgICAgaWYgKGhhdmVFcnJvcikgcmV0dXJuIGZhbHNlO1xyXG5cclxuXHJcbiAgICAgICAgICAgIC8vIHdlIGhhdmUgY29tcGxldGVkIHN0ZXAgeHh4IGh0dHBzOi8vZ2l0aHViLmNvbS9yZVRISU5LLXByb2plY3QvY29yZS1mcmFtZXdvcmsvYmxvYi9tYXN0ZXIvZG9jcy9zcGVjcy9ydW50aW1lL2R5bmFtaWMtdmlldy9iYXNpY3MvZGVwbG95LXByb3Rvc3R1Yi5tZFxyXG5cclxuICAgICAgICAgICAgLy8gTG9hZCBTdHViIGZ1bmN0aW9uIHJlc29sdmVkIHdpdGggc3VjY2VzcztcclxuICAgICAgICAgICAgLy8gbGV0IGlkcFByb3h5ID0ge1xyXG4gICAgICAgICAgICAvLyAgIHJ1bnRpbWVJZHBQcm94eVVSTDogX3J1bnRpbWVJZHBQcm94eVVSTCxcclxuICAgICAgICAgICAgLy8gICBzdGF0dXM6IGRlcGxveUNvbXBvbmVudFN0YXR1c1xyXG4gICAgICAgICAgICAvLyB9O1xyXG5cclxuICAgICAgICAgICAgLy90aGlzLnJlZ2lzdHJ5LmlkcFByb3h5TGlzdFtkb21haW5dLnN0YXR1cyA9ICdkZXBsb3llZCc7XHJcbiAgICAgICAgICAgIGxldCByZWdpc3RlcmVkSWRwUHJveHkgPSB0aGlzLnJlZ2lzdHJ5LmlkcFByb3h5TGlzdFtkb21haW5dO1xyXG5cclxuICAgICAgICAgICAgbG9nLmxvZygnW1J1bnRpbWUuTG9hZGVyLmxvYWRJZHBQcm94eV0gODogbG9hZGVkOiAnLCByZWdpc3RlcmVkSWRwUHJveHkpO1xyXG5cclxuICAgICAgICAgICAgcmVzb2x2ZShyZWdpc3RlcmVkSWRwUHJveHkpO1xyXG4gICAgICAgICAgICBsb2cuaW5mbygnW1J1bnRpbWUuTG9hZGVyLmxvYWRJZHBQcm94eV0gLS0tLS0tLS0tLS0tLS0tLS0tLSBFTkQgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXFxuJyk7XHJcblxyXG4gICAgICAgICAgfSwgaGFuZGxlRXJyb3IpXHJcbiAgICAgICAgICAuY2F0Y2goZXJyb3JSZWFzb24pO1xyXG4gICAgICB9XHJcblxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvLyBDaGVjayBpZiB0aGUgbG9hZGVyIGlzIHJlYWR5IHRvIGxvYWQgYWxsIGNvbXBvbmVudHNcclxuICBfcmVhZHlUb1VzZSgpIHtcclxuXHJcbiAgICBsZXQgc3RhdHVzID0gZmFsc2U7XHJcblxyXG4gICAgaWYgKCF0aGlzLl9ydW50aW1lVVJMKSB0aHJvdyBuZXcgRXJyb3IoJ1tSdW50aW1lLkxvYWRlcl0gVGhlIGxvYWRlciBuZWVkIHRoZSBydW50aW1lIHVybCBhZGRyZXNzJyk7XHJcbiAgICBpZiAoIXRoaXMuX21lc3NhZ2VzQnVzKSB0aHJvdyBuZXcgRXJyb3IoJ1tSdW50aW1lLkxvYWRlcl0gVGhlIGxvYWRlciBuZWVkIHRoZSBtZXNzYWdlQnVzIGNvbXBvbmVudCcpO1xyXG4gICAgaWYgKCF0aGlzLl9yZWdpc3RyeSkgdGhyb3cgbmV3IEVycm9yKCdbUnVudGltZS5Mb2FkZXJdIFRoZSBsb2FkZXIgbmVlZCB0aGUgcmVnaXN0cnkgY29tcG9uZW50Jyk7XHJcbiAgICBpZiAoIXRoaXMuX3J1bnRpbWVGYWN0b3J5KSB0aHJvdyBuZXcgRXJyb3IoJ1tSdW50aW1lLkxvYWRlcl0gVGhlIGxvYWRlciBuZWVkIHRoZSBydW50aW1lIGZhY3RvcnkgY29tcG9uZW50Jyk7XHJcblxyXG4gICAgc3RhdHVzID0gdHJ1ZTtcclxuICAgIHJldHVybiBzdGF0dXM7XHJcbiAgfVxyXG5cclxufVxyXG5cclxuZXhwb3J0IGRlZmF1bHQgTG9hZGVyO1xyXG4iLCJpbXBvcnQgeyBydW50aW1lQ29uZmlndXJhdGlvbiB9IGZyb20gJy4vcnVudGltZUNvbmZpZ3VyYXRpb24nO1xyXG5cclxubGV0IHN0b3JhZ2VzID0ge307XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gc3RvcmFnZShydW50aW1lRmFjdG9yeSwgcnVudGltZVN0YXR1c1VwZGF0ZSkge1xyXG4gIGlmICghcnVudGltZUZhY3RvcnkpIHRocm93IG5ldyBFcnJvcignVGhlIHJ1bnRpbWUgZmFjdG9yeSBpcyBhIG5lZWRlZCBwYXJhbWV0ZXInKTtcclxuXHJcbiAgY29uc29sZS5sb2coJ1tTdG9yYWdlLnN0b3JhZ2VdIHN0b3JhZ2VTY2hlbWFzICcsIHJ1bnRpbWVDb25maWd1cmF0aW9uLnN0b3JhZ2VTY2hlbWFzKTtcclxuXHJcbiAgT2JqZWN0LmtleXMocnVudGltZUNvbmZpZ3VyYXRpb24uc3RvcmFnZVNjaGVtYXMpLmZvckVhY2goKGtleSkgPT4ge1xyXG5cclxuICAgIGlmICghc3RvcmFnZXMuaGFzT3duUHJvcGVydHkoa2V5KSkge1xyXG4gICAgICBzdG9yYWdlc1trZXldID0gcnVudGltZUZhY3Rvcnkuc3RvcmFnZU1hbmFnZXIoa2V5LCBydW50aW1lQ29uZmlndXJhdGlvbi5zdG9yYWdlU2NoZW1hc1trZXldLCBydW50aW1lU3RhdHVzVXBkYXRlKTtcclxuICAgIH1cclxuXHJcbiAgfSk7XHJcblxyXG4gIHJldHVybiBzdG9yYWdlcztcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZVN5bmNEQihuYW1lLCBydW50aW1lRmFjdG9yeSwgdXJsID0gZmFsc2UpIHtcclxuICBpZiAoIW5hbWUpIHRocm93IG5ldyBFcnJvcignW1J1bnRpbWUuU3RvcmFnZS5jcmVhdGVTeW5jREJdIG5hbWUgaXMgYSBuZWVkZWQgcGFyYW1ldGVyJyk7XHJcbiAgaWYgKCFydW50aW1lRmFjdG9yeSkgdGhyb3cgbmV3IEVycm9yKCdbUnVudGltZS5TdG9yYWdlLmNyZWF0ZVN5bmNEQl0gVGhlIHJ1bnRpbWUgZmFjdG9yeSBpcyBhIG5lZWRlZCBwYXJhbWV0ZXInKTtcclxuXHJcbiAgbGV0IHJlbW90ZSA9IHVybCA/IHVybCA6IHJ1bnRpbWVDb25maWd1cmF0aW9uLnJlbW90ZVN0b3JhZ2U7XHJcblxyXG4gIHJldHVybiBydW50aW1lRmFjdG9yeS5zeW5jU3RvcmFnZU1hbmFnZXIoIG5hbWUsIHJlbW90ZSApO1xyXG5cclxufVxyXG4iLCJpbXBvcnQge2RpdmlkZVVSTCwgZ2V0Q29uZmlndXJhdGlvblJlc291cmNlcywgYnVpbGRVUkx9IGZyb20gJy4uL3V0aWxzL3V0aWxzJztcclxuaW1wb3J0IHsgcnVudGltZVV0aWxzIH0gZnJvbSAnLi9ydW50aW1lVXRpbHMnO1xyXG5cclxuaW1wb3J0ICogYXMgbG9nZ2VyIGZyb20gJ2xvZ2xldmVsJztcclxubGV0IGxvZyA9IGxvZ2dlci5nZXRMb2dnZXIoJ0Rlc2NyaXB0b3JzJyk7XHJcblxyXG5jbGFzcyBEZXNjcmlwdG9ycyB7XHJcblxyXG4gIGNvbnN0cnVjdG9yKHJ1bnRpbWVVUkwsIGNhdGFsb2d1ZSwgcnVudGltZUNvbmZpZ3VyYXRpb24pIHtcclxuICAgIGlmICghcnVudGltZVVSTCkgdGhyb3cgRXJyb3IoJ1RoZSBkZXNjcmlwdG9yIG5lZWQgdG8ga25vdyB0aGUgcnVudGltZSB1cmwgdG8gYmUgdXNlZCcpO1xyXG4gICAgaWYgKCFjYXRhbG9ndWUpIHRocm93IEVycm9yKCdUaGUgZGVzY3JpcHRvciBuZWVkcyB0aGUgY2F0YWxvZ3VlIGluc3RhbmNlJyk7XHJcbiAgICBpZiAoIXJ1bnRpbWVDb25maWd1cmF0aW9uKSB0aHJvdyBFcnJvcignVGhlIGRlc2NyaXB0b3IgbmVlZHMgdGhlIHJ1bnRpbWUgY29uZmlndXJhdGlvbicpO1xyXG5cclxuICAgIHRoaXMubG9nID0gbG9nO1xyXG5cclxuICAgIHRoaXMucnVudGltZUNvbmZpZ3VyYXRpb24gPSBydW50aW1lQ29uZmlndXJhdGlvbjtcclxuICAgIHRoaXMucnVudGltZVVSTCA9IHJ1bnRpbWVVUkw7XHJcbiAgICB0aGlzLmNhdGFsb2d1ZSA9IGNhdGFsb2d1ZTtcclxuXHJcbiAgICB0aGlzLmNvbnN0cmFpbnRzID0gcnVudGltZVV0aWxzLnJ1bnRpbWVDYXBhYmlsaXRpZXM7XHJcbiAgfVxyXG5cclxuICBnZXRIeXBlcnR5RGVzY3JpcHRvcihoeXBlcnR5VVJMKSB7XHJcbiAgICByZXR1cm4gdGhpcy5jYXRhbG9ndWUuZ2V0SHlwZXJ0eURlc2NyaXB0b3IoaHlwZXJ0eVVSTCwgdHJ1ZSwgdGhpcy5jb25zdHJhaW50cyk7XHJcbiAgfVxyXG5cclxuICBnZXRTdHViRGVzY3JpcHRvcihzdHViVVJMKSB7XHJcblxyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcclxuXHJcbiAgICAgIGxldCBkb21haW47XHJcbiAgICAgIGxldCBwcm90b3N0dWI7XHJcbiAgICAgIGxldCBwcm90b1N0dWJVUkw7XHJcblxyXG4gICAgICBsZXQgb3JpZ2luRGl2aWRlZFVSTCA9IGRpdmlkZVVSTCh0aGlzLnJ1bnRpbWVVUkwpO1xyXG4gICAgICBsZXQgb3JpZ2luRG9tYWluID0gb3JpZ2luRGl2aWRlZFVSTC5kb21haW47XHJcblxyXG4gICAgICBpZiAoc3R1YlVSTC5pbmNsdWRlcygnOi8vJykpIHtcclxuICAgICAgICBsZXQgZGl2aWRlZFVSTCA9IGRpdmlkZVVSTChzdHViVVJMKTtcclxuICAgICAgICBkb21haW4gPSBkaXZpZGVkVVJMLmRvbWFpbjtcclxuICAgICAgICBsZXQgcGF0aCA9IGRpdmlkZWRVUkwuaWRlbnRpdHk7XHJcblxyXG4gICAgICAgIGlmIChwYXRoKSB7XHJcbiAgICAgICAgICBwcm90b3N0dWIgPSBwYXRoLnN1YnN0cmluZyhwYXRoLmxhc3RJbmRleE9mKCcvJykgKyAxKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgcHJvdG9zdHViID0gJ2RlZmF1bHQnO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgcHJvdG9zdHViID0gJ2RlZmF1bHQnO1xyXG4gICAgICAgIGRvbWFpbiA9IHN0dWJVUkw7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIHByb3RvU3R1YlVSTCA9IGJ1aWxkVVJMKHRoaXMucnVudGltZUNvbmZpZ3VyYXRpb24sICdjYXRhbG9ndWVVUkxzJywgJ3Byb3RvY29sc3R1YicsIHByb3Rvc3R1Yik7XHJcbiAgICAgIGlmIChkb21haW4gIT09IHRoaXMucnVudGltZUNvbmZpZ3VyYXRpb24uZG9tYWluKSB7XHJcbiAgICAgICAgaWYgKCFzdHViVVJMLmluZGV4T2YoJ2h0dHBzJykgfHwgIXN0dWJVUkwuaW5kZXhPZignaHlwZXJ0eS1jYXRhbG9ndWUnKSkge1xyXG4gICAgICAgICAgcHJvdG9TdHViVVJMID0gc3R1YlVSTDtcclxuICAgICAgICB9IGVsc2Uge1xyXG5cclxuICAgICAgICAgIC8vIFRPRE86IGNoZWNrIGhvdyB0byBsb2FkIGZvcm0gZGlmZmVyZW50IGNvbmZpZ3VyYXRpb24gZG9tYWluXHJcbiAgICAgICAgICBsZXQgcmVzb3VyY2UgPSBnZXRDb25maWd1cmF0aW9uUmVzb3VyY2VzKHRoaXMucnVudGltZUNvbmZpZ3VyYXRpb24sICdjYXRhbG9ndWVVUkxzJywgJ3Byb3RvY29sc3R1YicpO1xyXG4gICAgICAgICAgcHJvdG9TdHViVVJMID0gcmVzb3VyY2UucHJlZml4ICsgZG9tYWluICsgcmVzb3VyY2Uuc3VmZml4ICsgcHJvdG9zdHViO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG5cclxuICAgICAgbG9nLmxvZygnTG9hZCBQcm90b2NvbFN0dWIgZm9yIGRvbWFpbiwgJyArIGRvbWFpbiArICcgOiAnLCBwcm90b1N0dWJVUkwpO1xyXG4gICAgICByZXR1cm4gdGhpcy5jYXRhbG9ndWUuZ2V0U3R1YkRlc2NyaXB0b3IocHJvdG9TdHViVVJMLCB0cnVlLCB0aGlzLmNvbnN0cmFpbnRzKS50aGVuKChyZXN1bHQpID0+IHtcclxuXHJcbiAgICAgICAgcmVzb2x2ZShyZXN1bHQpO1xyXG5cclxuICAgICAgfSkuY2F0Y2goKGVycm9yKSA9PiB7XHJcblxyXG4gICAgICAgIC8vIGxvZy5sb2coJ0Vycm9yOiAnLCBlcnJvcik7XHJcblxyXG4gICAgICAgIHByb3Rvc3R1YiA9IGRvbWFpbjtcclxuICAgICAgICBkb21haW4gPSBvcmlnaW5Eb21haW47XHJcblxyXG4gICAgICAgIGxldCByZXNvdXJjZSA9IGdldENvbmZpZ3VyYXRpb25SZXNvdXJjZXModGhpcy5ydW50aW1lQ29uZmlndXJhdGlvbiwgJ2NhdGFsb2d1ZVVSTHMnLCAncHJvdG9jb2xzdHViJyk7XHJcbiAgICAgICAgcHJvdG9TdHViVVJMID0gcmVzb3VyY2UucHJlZml4ICsgZG9tYWluICsgcmVzb3VyY2Uuc3VmZml4ICsgcHJvdG9zdHViO1xyXG5cclxuICAgICAgICAvLyBsb2cubG9nKCdGYWxsYmFjayAtPiBMb2FkIFByb3RvY29sc3R1YiBmb3IgZG9tYWluLCAnICsgZG9tYWluICsgJyA6ICcsIHByb3Rvc3R1Yik7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuY2F0YWxvZ3VlLmdldFN0dWJEZXNjcmlwdG9yKHByb3RvU3R1YlVSTCwgdHJ1ZSwgdGhpcy5jb25zdHJhaW50cyk7XHJcbiAgICAgIH0pLnRoZW4oKHJlc3VsdCkgPT4ge1xyXG4gICAgICAgIHJlc29sdmUocmVzdWx0KTtcclxuICAgICAgfSkuY2F0Y2goKHJlYXNvbikgPT4ge1xyXG4gICAgICAgIHJlamVjdChyZWFzb24pO1xyXG4gICAgICB9KTtcclxuXHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIGdldElkcFByb3h5RGVzY3JpcHRvcihpZHBQcm94eVVSTCkge1xyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcclxuXHJcbiAgICAgIGxldCBkb21haW47XHJcbiAgICAgIGxldCBpZHBwcm94eTtcclxuXHJcbiAgICAgIGxldCBvcmlnaW5EaXZpZGVkVVJMID0gZGl2aWRlVVJMKHRoaXMucnVudGltZVVSTCk7XHJcbiAgICAgIGxldCBvcmlnaW5Eb21haW4gPSBvcmlnaW5EaXZpZGVkVVJMLmRvbWFpbjtcclxuICAgICAgbGV0IGNvbnN0cmFpbnRzID0gdGhpcy5jb25zdHJhaW50cztcclxuXHJcbiAgICAgIGNvbnN0cmFpbnRzLmNvbnN0cmFpbnRzLm9ubHlBY2Nlc3NUb2tlbiA9IHRydWU7XHJcbiAgICAgIGNvbnN0cmFpbnRzLmNvbnN0cmFpbnRzLm9ubHlJZEFzc2VydGlvblZhbGlkYXRpb24gPSB0cnVlO1xyXG4gICAgICBjb25zb2xlLmxvZygnTE9HIEhFUkUnLCBjb25zdHJhaW50cyk7XHJcbiAgICAgIGlmIChpZHBQcm94eVVSTC5pbmNsdWRlcygnOi8vJykpIHtcclxuICAgICAgICBsZXQgZGl2aWRlZFVSTCA9IGRpdmlkZVVSTChpZHBQcm94eVVSTCk7XHJcbiAgICAgICAgZG9tYWluID0gZGl2aWRlZFVSTC5kb21haW47XHJcbiAgICAgICAgbGV0IHBhdGggPSBkaXZpZGVkVVJMLmlkZW50aXR5O1xyXG4gICAgICAgIGlmIChwYXRoKSB7XHJcbiAgICAgICAgICBpZHBwcm94eSA9IHBhdGguc3Vic3RyaW5nKHBhdGgubGFzdEluZGV4T2YoJy8nKSArIDEpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICBpZHBwcm94eSA9ICdkZWZhdWx0JztcclxuICAgICAgICB9XHJcblxyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGlkcHByb3h5ID0gJ2RlZmF1bHQnO1xyXG4gICAgICAgIGRvbWFpbiA9IGlkcFByb3h5VVJMO1xyXG4gICAgICB9XHJcblxyXG5cclxuICAgICAgbGV0IHJlc291cmNlID0gZ2V0Q29uZmlndXJhdGlvblJlc291cmNlcyh0aGlzLnJ1bnRpbWVDb25maWd1cmF0aW9uLCAnY2F0YWxvZ3VlVVJMcycsICdpZHBQcm94eScpO1xyXG5cclxuICAgICAgaWRwUHJveHlVUkwgPSByZXNvdXJjZS5wcmVmaXggKyBkb21haW4gKyByZXNvdXJjZS5zdWZmaXggKyBpZHBwcm94eTtcclxuICAgICAgLy8gbG9nLmxvZygnTG9hZCBJZHAgUHJveHkgZm9yIGRvbWFpbiwgJyArIGRvbWFpbiArICcgOiAnLCBpZHBQcm94eVVSTCk7XHJcbiAgICAgIHJldHVybiB0aGlzLmNhdGFsb2d1ZS5nZXRJZHBQcm94eURlc2NyaXB0b3IoaWRwUHJveHlVUkwsIHRydWUsIGNvbnN0cmFpbnRzKS50aGVuKChyZXN1bHQpID0+IHtcclxuXHJcbiAgICAgICAgcmVzb2x2ZShyZXN1bHQpO1xyXG5cclxuICAgICAgfSkuY2F0Y2goKCkgPT4ge1xyXG5cclxuICAgICAgICBpZHBwcm94eSA9IGRvbWFpbjtcclxuICAgICAgICBkb21haW4gPSBvcmlnaW5Eb21haW47XHJcblxyXG4gICAgICAgIGlkcFByb3h5VVJMID0gYnVpbGRVUkwodGhpcy5ydW50aW1lQ29uZmlndXJhdGlvbiwgJ2NhdGFsb2d1ZVVSTHMnLCAnaWRwUHJveHknLCBpZHBwcm94eSk7XHJcblxyXG4gICAgICAgIC8vIGxvZy5sb2coJ0xvYWQgSWRwIFByb3h5IGZvciBkb21haW4sICcgKyBkb21haW4gKyAnIDogJywgaWRwUHJveHlVUkwpO1xyXG4gICAgICAgIHJldHVybiB0aGlzLmNhdGFsb2d1ZS5nZXRJZHBQcm94eURlc2NyaXB0b3IoaWRwUHJveHlVUkwsIHRydWUsIGNvbnN0cmFpbnRzKTtcclxuICAgICAgfSkudGhlbigocmVzdWx0KSA9PiB7XHJcbiAgICAgICAgcmVzb2x2ZShyZXN1bHQpO1xyXG4gICAgICB9KS5jYXRjaCgocmVhc29uKSA9PiB7XHJcbiAgICAgICAgcmVqZWN0KHJlYXNvbik7XHJcbiAgICAgIH0pO1xyXG5cclxuICAgIH0pO1xyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGRlZmF1bHQgRGVzY3JpcHRvcnM7XHJcbiIsIi8qKlxyXG4qIENvcHlyaWdodCAyMDE2IFBUIElub3Zhw6fDo28gZSBTaXN0ZW1hcyBTQVxyXG4qIENvcHlyaWdodCAyMDE2IElORVNDLUlEXHJcbiogQ29weXJpZ2h0IDIwMTYgUVVPQklTIE5FVFdPUktTIFNMXHJcbiogQ29weXJpZ2h0IDIwMTYgRlJBVU5IT0ZFUi1HRVNFTExTQ0hBRlQgWlVSIEZPRVJERVJVTkcgREVSIEFOR0VXQU5EVEVOIEZPUlNDSFVORyBFLlZcclxuKiBDb3B5cmlnaHQgMjAxNiBPUkFOR0UgU0FcclxuKiBDb3B5cmlnaHQgMjAxNiBEZXV0c2NoZSBUZWxla29tIEFHXHJcbiogQ29weXJpZ2h0IDIwMTYgQXBpemVlXHJcbiogQ29weXJpZ2h0IDIwMTYgVEVDSE5JU0NIRSBVTklWRVJTSVRBVCBCRVJMSU5cclxuKlxyXG4qIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4qIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4qXHJcbiogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuKlxyXG4qIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4qIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4qKi9cclxuXHJcbi8vIExvZyBTeXN0ZW1cclxuaW1wb3J0ICogYXMgbG9nZ2VyIGZyb20gJ2xvZ2xldmVsJztcclxubGV0IGxvZyA9IGxvZ2dlci5nZXRMb2dnZXIoJ0NvcmVEaXNjb3ZlcnknKTtcclxuXHJcblxyXG5pbXBvcnQge2RpdmlkZVVSTH0gZnJvbSAnLi4vdXRpbHMvdXRpbHMnO1xyXG5cclxuLyoqXHJcbiogQ29yZSBEaXNjb3ZlcnkgaW50ZXJmYWNlXHJcbiogQ2xhc3MgdG8gYWxsb3cgYXBwbGljYXRpb25zIHRvIHNlYXJjaCBmb3IgaHlwZXJ0aWVzIGFuZCBEYXRhT2JqZWN0cyB1c2luZyB0aGUgbWVzc2FnZSBidXNcclxuKi9cclxuY2xhc3MgQ29yZURpc2NvdmVyeSB7XHJcblxyXG4gIC8qKlxyXG4gICogVG8gaW5pdGlhbGlzZSB0aGUgRGlzY292ZXJ5LCB3aGljaCB3aWxsIHByb3ZpZGUgdGhlIHN1cHBvcnQgZm9yIGh5cGVydGllcyB0b1xyXG4gICogcXVlcnkgdXNlcnMgcmVnaXN0ZXJlZCBpbiBvdXRzaWRlIHRoZSBpbnRlcm5hbCBjb3JlLlxyXG4gICogQHBhcmFtICB7TWVzc2FnZUJ1c30gICAgICAgICAgbXNnYnVzICAgICAgICAgICAgICAgIG1zZ2J1c1xyXG4gICogQHBhcmFtICB7UnVudGltZVVSTH0gICAgICAgICAgcnVudGltZVVSTCAgICAgICAgICAgIHJ1bnRpbWVVUkxcclxuICAqIEBwYXJhbSAge2dyYXBoQ29ubmVjdG9yfSAgICBncmFwaENvbm5lY3RvclxyXG4gICovXHJcbiAgY29uc3RydWN0b3IocnVudGltZVVSTCwgbXNnQnVzLCBncmFwaENvbm5lY3RvciwgcnVudGltZUZhY3RvcnksIHJlZ2lzdHJ5KSB7XHJcbiAgICBpZiAoIXJ1bnRpbWVGYWN0b3J5KSB0aHJvdyBFcnJvcignVGhlIGNhdGFsb2d1ZSBuZWVkcyB0aGUgcnVudGltZUZhY3RvcnknKTtcclxuXHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG4gICAgdGhpcy5fbWVzc2FnZUJ1cyA9IG1zZ0J1cztcclxuICAgIF90aGlzLmdyYXBoQ29ubmVjdG9yID0gZ3JhcGhDb25uZWN0b3I7XHJcbiAgICBfdGhpcy5odHRwUmVxdWVzdCA9IHJ1bnRpbWVGYWN0b3J5LmNyZWF0ZUh0dHBSZXF1ZXN0KCk7XHJcbiAgICBfdGhpcy5kb21haW4gPSBkaXZpZGVVUkwocnVudGltZVVSTCkuZG9tYWluO1xyXG4gICAgX3RoaXMuZGlzY292ZXJ5VVJMID0gcnVudGltZVVSTCArICcvZGlzY292ZXJ5Lyc7XHJcbiAgICBfdGhpcy5yZWdpc3RyeSA9IHJlZ2lzdHJ5O1xyXG5cclxuICAgIF90aGlzLm1lc3NhZ2VCdXMuYWRkTGlzdGVuZXIoX3RoaXMuZGlzY292ZXJ5VVJMLCAobXNnKSA9PiB7XHJcblxyXG4gICAgICBfdGhpcy5kaXNjb3ZlcnlNYW5hZ2VyKG1zZykudGhlbihyZXN1bHQgPT57XHJcblxyXG4gICAgICAgIC8vRkxPVy1PVVQ6IG1lc3NhZ2UgcmVzcG9uc2VcclxuICAgICAgICBfdGhpcy5tZXNzYWdlQnVzLnBvc3RNZXNzYWdlKHtcclxuICAgICAgICAgIGlkOiBtc2cuaWQsXHJcbiAgICAgICAgICB0eXBlOiAncmVzcG9uc2UnLFxyXG4gICAgICAgICAgZnJvbTogbXNnLnRvLFxyXG4gICAgICAgICAgdG86IG1zZy5mcm9tLFxyXG4gICAgICAgICAgYm9keToge1xyXG4gICAgICAgICAgICBjb2RlOiAyMDAsXHJcbiAgICAgICAgICAgIHZhbHVlOiByZXN1bHRcclxuICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgfSlcclxuICAgICAgICAuY2F0Y2goZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICBsZXQgZGVzY3JpcHRpb247XHJcbiAgICAgICAgICBsZXQgY29kZTtcclxuXHJcbiAgICAgICAgICBpZiAoZXJyID09PSAnR3JhcGhDb25uZWN0b3InKSB7XHJcbiAgICAgICAgICAgIGRlc2NyaXB0aW9uID0gJ1RoaXMgc2VhcmNoIGlzIG5vdCBhdmFpbGFibGUgYXQgdGhlIG1vbWVudC4gVHJ5IGxhdGVyLic7XHJcbiAgICAgICAgICAgIGNvZGUgPSA1MDA7XHJcbiAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBkZXNjcmlwdGlvbiA9ICdOb3QgRm91bmQnO1xyXG4gICAgICAgICAgICBjb2RlID0gNDA0O1xyXG4gICAgICAgICAgfVxyXG5cclxuICAgICAgICAgIC8vRkxPVy1PVVQ6IGVycm9yIG1lc3NhZ2UgcmVzcG9uc2VcclxuICAgICAgICAgIF90aGlzLm1lc3NhZ2VCdXMucG9zdE1lc3NhZ2Uoe1xyXG4gICAgICAgICAgICBpZDogbXNnLmlkLFxyXG4gICAgICAgICAgICB0eXBlOiAncmVzcG9uc2UnLFxyXG4gICAgICAgICAgICBmcm9tOiBtc2cudG8sXHJcbiAgICAgICAgICAgIHRvOiBtc2cuZnJvbSxcclxuICAgICAgICAgICAgYm9keToge1xyXG4gICAgICAgICAgICAgIGNvZGU6IGNvZGUsXHJcbiAgICAgICAgICAgICAgZGVzY3JpcHRpb246IGRlc2NyaXB0aW9uXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBSZXR1cm5zIHRoZSBNZXNzYWdlQnVzLlxyXG4gICAqL1xyXG4gIGdldCBtZXNzYWdlQnVzKCkge1xyXG4gICAgcmV0dXJuIHRoaXMuX21lc3NhZ2VCdXM7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBTZXRzIHRoZSBNZXNzYWdlQnVzLlxyXG4gICAqIEBwYXJhbSB7TWVzc2FnZUJ1c30gICAgICAgICAgIG1lc3NhZ2VCdXMgICAgVGhlIE1lc3NhZ2UgQnVzLlxyXG4gICAqL1xyXG4gIHNldCBtZXNzYWdlQnVzKG1lc3NhZ2VCdXMpIHtcclxuICAgIHRoaXMuX21lc3NhZ2VCdXMgPSBtZXNzYWdlQnVzO1xyXG4gIH1cclxuXHJcbiAgLyogZnVuY3Rpb24gdG8gZGVjaWRlIHdoYXQgZGlzY292ZXJ5IG1ldGhvZCB0byBjYWxsIGFuZCBsYXRlciByZXR1cm4gdGhlIHJlc3BvbnNlIG1zZyAgKi9cclxuICBkaXNjb3ZlcnlNYW5hZ2VyKG1zZykge1xyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuICAgIGxldCBkb21haW4gPSBkaXZpZGVVUkwobXNnLmZyb20pLmRvbWFpbjtcclxuICAgIGxldCBhdHJpYnV0ZXMgPSBtc2cuYm9keS5yZXNvdXJjZS5zcGxpdCgnLycpLmZpbHRlcihCb29sZWFuKTtcclxuICAgIGxldCByZXNvdXJjZXMgPSBbXTtcclxuICAgIGxldCBkYXRhU2NoZW1lcyA9IFtdO1xyXG5cclxuICAgIGxvZy5sb2coJ1tDb3JlRGlzY292ZXJ5LmRpc2NvdmVyeU1hbmFnZXJdIHJlY2VpdmVkOiAnLCBtc2cpO1xyXG5cclxuICAgIGlmIChtc2cuYm9keS5jcml0ZXJpYSkge1xyXG4gICAgICBpZiAobXNnLmJvZHkuY3JpdGVyaWEucmVzb3VyY2VzKSB7IHJlc291cmNlcyA9IG1zZy5ib2R5LmNyaXRlcmlhLnJlc291cmNlczsgfVxyXG4gICAgICBpZiAobXNnLmJvZHkuY3JpdGVyaWEuZGF0YVNjaGVtZXMpIHsgZGF0YVNjaGVtZXMgPSBtc2cuYm9keS5jcml0ZXJpYS5kYXRhU2NoZW1lczsgfVxyXG4gICAgfVxyXG5cclxuICAgIHN3aXRjaCAoYXRyaWJ1dGVzWzFdKSB7XHJcbiAgICAgIGNhc2UgJ3VzZXInOlxyXG4gICAgICAgIGlmIChhdHJpYnV0ZXNbMF0gPT0gJ2h5cGVydHknKSB7IHJldHVybiBfdGhpcy5kaXNjb3Zlckh5cGVydGllcyhtc2cuYm9keS5yZXNvdXJjZS5zcGxpdCgndXNlci8nKVsxXSwgZGF0YVNjaGVtZXMsIHJlc291cmNlcywgbXNnLmJvZHkuY3JpdGVyaWEuZG9tYWluKTsgfSBlbHNlIHsgcmV0dXJuIF90aGlzLmRpc2NvdmVyRGF0YU9iamVjdHMobXNnLmJvZHkucmVzb3VyY2Uuc3BsaXQoJ3VzZXIvJylbMV0sIGRhdGFTY2hlbWVzLCByZXNvdXJjZXMsIG1zZy5ib2R5LmNyaXRlcmlhLmRvbWFpbik7IH1cclxuICAgICAgICBicmVhaztcclxuXHJcbiAgICAgIGNhc2UgJ3VybCc6XHJcbiAgICAgICAgaWYgKGF0cmlidXRlc1swXSA9PSAnaHlwZXJ0eScpIHsgcmV0dXJuIF90aGlzLmRpc2NvdmVySHlwZXJ0eVBlclVSTChtc2cuYm9keS5yZXNvdXJjZS5zcGxpdCgndXJsLycpWzFdLCBtc2cuYm9keS5jcml0ZXJpYS5kb21haW4pOyB9IGVsc2UgeyByZXR1cm4gX3RoaXMuZGlzY292ZXJEYXRhT2JqZWN0UGVyVVJMKG1zZy5ib2R5LnJlc291cmNlLnNwbGl0KCd1cmwvJylbMV0sIG1zZy5ib2R5LmNyaXRlcmlhLmRvbWFpbik7IH1cclxuICAgICAgICBicmVhaztcclxuICAgICAgY2FzZSAnbmFtZSc6XHJcbiAgICAgICAgcmV0dXJuIF90aGlzLmRpc2NvdmVyRGF0YU9iamVjdHNQZXJOYW1lKG1zZy5ib2R5LnJlc291cmNlLnNwbGl0KCduYW1lLycpWzFdLCBkYXRhU2NoZW1lcywgcmVzb3VyY2VzLCBtc2cuYm9keS5jcml0ZXJpYS5kb21haW4pO1xyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgICBjYXNlICdyZXBvcnRlcic6XHJcbiAgICAgICAgcmV0dXJuIF90aGlzLmRpc2NvdmVyRGF0YU9iamVjdHNQZXJSZXBvcnRlcihtc2cuYm9keS5yZXNvdXJjZS5zcGxpdCgncmVwb3J0ZXIvJylbMV0sIGRhdGFTY2hlbWVzLCByZXNvdXJjZXMsIG1zZy5ib2R5LmNyaXRlcmlhLmRvbWFpbik7XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICAgIGNhc2UgJ2d1aWQnOlxyXG4gICAgICAgIGlmICh0eXBlb2YgX3RoaXMuZ3JhcGhDb25uZWN0b3IgIT09ICd1bmRlZmluZWQnICYmICBfdGhpcy5ncmFwaENvbm5lY3RvciAhPT0gbnVsbCkge1xyXG4gICAgICAgICAgaWYgKGF0cmlidXRlc1swXSA9PSAnaHlwZXJ0eScpIHsgcmV0dXJuIF90aGlzLmRpc2NvdmVySHlwZXJ0aWVzUGVyR1VJRChtc2cuYm9keS5yZXNvdXJjZS5zcGxpdCgndXNlci1ndWlkOi8vJylbMV0sIGRhdGFTY2hlbWVzLCByZXNvdXJjZXMpOyB9IGVsc2UgeyByZXR1cm4gX3RoaXMuZGlzY292ZXJEYXRhT2JqZWN0c1BlckdVSUQobXNnLmJvZHkucmVzb3VyY2Uuc3BsaXQoJ3VzZXItZ3VpZDovLycpWzFdLCBkYXRhU2NoZW1lcywgcmVzb3VyY2VzKTsgfVxyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdCgnR3JhcGhDb25uZWN0b3InKTtcclxuICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIH1cclxuICAgICAgY2FzZSAndXNlcnByb2ZpbGUnOlxyXG4gICAgICAgIGlmICh0eXBlb2YgX3RoaXMuZ3JhcGhDb25uZWN0b3IgIT09ICd1bmRlZmluZWQnICYmICBfdGhpcy5ncmFwaENvbm5lY3RvciAhPT0gbnVsbCkge1xyXG4gICAgICAgICAgaWYgKGF0cmlidXRlc1swXSA9PSAnaHlwZXJ0eScpIHsgcmV0dXJuIF90aGlzLmRpc2NvdmVySHlwZXJ0aWVzUGVyVXNlclByb2ZpbGVEYXRhKG1zZy5ib2R5LnJlc291cmNlLnNwbGl0KCd1c2VycHJvZmlsZS8nKVsxXSwgZGF0YVNjaGVtZXMsIHJlc291cmNlcyk7IH0gZWxzZSB7IHJldHVybiBfdGhpcy5kaXNjb3ZlckRhdGFPYmplY3RzUGVyVXNlclByb2ZpbGVEYXRhKG1zZy5ib2R5LnJlc291cmNlLnNwbGl0KCd1c2VycHJvZmlsZS8nKVsxXSwgZGF0YVNjaGVtZXMsIHJlc291cmNlcyk7IH1cclxuICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoJ0dyYXBoQ29ubmVjdG9yJyk7XHJcbiAgICAgICAgICBicmVhaztcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAqIEFkdmFuY2VkIFNlYXJjaCBmb3IgSHlwZXJ0aWVzIHJlZ2lzdGVyZWQgaW4gZG9tYWluIHJlZ2lzdHJ5IGFzc29jaWF0ZWQgd2l0aCBzb21lIHVzZXIgaWRlbnRpZmllciAoZWcgZW1haWwsIG5hbWUgLi4uKVxyXG4gICogQHBhcmFtICB7U3RyaW5nfSAgICAgICAgICAgdXNlcklkZW50aWZpZXJcclxuICAqIEBwYXJhbSAge0FycmF5PHN0cmluZz59ICAgIGRhdGFTY2hlbWVzIChPcHRpb25hbCkgICAgIHR5cGVzIG9mIGh5cGVydGllcyBzY2hlbWFzXHJcbiAgKiBAcGFyYW0gIHtBcnJheTxzdHJpbmc+fSAgICByZXNvdXJjZXMgKE9wdGlvbmFsKSAgdHlwZXMgb2YgaHlwZXJ0aWVzIHJlc291cmNlc1xyXG4gICovXHJcbiAgZGlzY292ZXJIeXBlcnRpZXNQZXJVc2VyUHJvZmlsZURhdGEodXNlcklkZW50aWZpZXIsIGRhdGFTY2hlbWVzLCByZXNvdXJjZXMpIHtcclxuICAgIGxldCBfdGhpcyA9IHRoaXM7XHJcblxyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG5cclxuICAgICAgLy90cmFuc2xhdGUgdXNlciBpZGVudGlmaWVyIChlLmcuIGVtYWlsLCBuYW1lLi4uKSBpbnRvIHRoZSBhc3NvY2lhdGVkIEdVSURzXHJcbiAgICAgIF90aGlzLmRpc2NvdmVyR1VJRFBlclVzZXJJZGVudGlmaWVyKHVzZXJJZGVudGlmaWVyKVxyXG4gICAgICAgIC50aGVuKGZ1bmN0aW9uKGd1aWRzKSB7XHJcblxyXG4gICAgICAgICAgbGV0IGh5cGVydGllc1Byb21pc2VzID0gZ3VpZHMubWFwKGZ1bmN0aW9uKGd1aWQpIHtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICAgICAgICBfdGhpcy5kaXNjb3Zlckh5cGVydGllc1BlckdVSUQoZ3VpZCwgZGF0YVNjaGVtZXMsIHJlc291cmNlcylcclxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKGh5cGVydGllcykge1xyXG4gICAgICAgICAgICAgICAgICByZXNvbHZlKGh5cGVydGllcyk7XHJcbiAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgICAgICAgICByZXNvbHZlKFtdKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgIFByb21pc2UuYWxsKGh5cGVydGllc1Byb21pc2VzKVxyXG4gICAgICAgICAgICAudGhlbihmdW5jdGlvbihoeXBlcnRpZXNSZXN1bHQpIHtcclxuXHJcbiAgICAgICAgICAgICAgbGV0IGh5cGVydGllcyA9IFtdLmNvbmNhdC5hcHBseShbXSwgaHlwZXJ0aWVzUmVzdWx0KTtcclxuXHJcbiAgICAgICAgICAgICAgaWYgKGh5cGVydGllcy5sZW5ndGggPT09IDApIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiByZWplY3QoJ05vIGh5cGVydGllcyB3ZXJlIGZvdW5kJyk7XHJcbiAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICByZXNvbHZlKGh5cGVydGllcyk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0pXHJcbiAgICAgICAgLmNhdGNoKGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgcmV0dXJuIHJlamVjdChlcnIpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAqIEFkdmFuY2VkIFNlYXJjaCBmb3IgRGF0YU9iamVjdHMgcmVnaXN0ZXJlZCBpbiBkb21haW4gcmVnaXN0cnkgYXNzb2NpYXRlZCB3aXRoIHNvbWUgdXNlciBpZGVudGlmaWVyIChlZyBlbWFpbCwgbmFtZSAuLi4pXHJcbiAgKiBAcGFyYW0gIHtTdHJpbmd9ICAgICAgICAgICB1c2VySWRlbnRpZmllclxyXG4gICogQHBhcmFtICB7QXJyYXk8c3RyaW5nPn0gICAgZGF0YVNjaGVtZXMgKE9wdGlvbmFsKSAgICAgdHlwZXMgb2YgaHlwZXJ0aWVzIHNjaGVtYXNcclxuICAqIEBwYXJhbSAge0FycmF5PHN0cmluZz59ICAgIHJlc291cmNlcyAoT3B0aW9uYWwpICB0eXBlcyBvZiBoeXBlcnRpZXMgcmVzb3VyY2VzXHJcbiAgKi9cclxuICBkaXNjb3ZlckRhdGFPYmplY3RzUGVyVXNlclByb2ZpbGVEYXRhKHVzZXJJZGVudGlmaWVyLCBkYXRhU2NoZW1lcywgcmVzb3VyY2VzKSB7XHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG5cclxuICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuXHJcbiAgICAgIC8vdHJhbnNsYXRlIHVzZXIgaWRlbnRpZmllciAoZS5nLiBlbWFpbCwgbmFtZS4uLikgaW50byB0aGUgYXNzb2NpYXRlZCBHVUlEc1xyXG4gICAgICBfdGhpcy5kaXNjb3ZlckdVSURQZXJVc2VySWRlbnRpZmllcih1c2VySWRlbnRpZmllcilcclxuICAgICAgICAudGhlbihmdW5jdGlvbihndWlkcykge1xyXG5cclxuICAgICAgICAgIGxldCBkYXRhT2JqZWN0c1Byb21pc2VzID0gZ3VpZHMubWFwKGZ1bmN0aW9uKGd1aWQpIHtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICAgICAgICBfdGhpcy5kaXNjb3ZlckRhdGFPYmplY3RzUGVyR1VJRChndWlkLCBkYXRhU2NoZW1lcywgcmVzb3VyY2VzKVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24oZGF0YU9iamVjdHMpIHtcclxuICAgICAgICAgICAgICAgICAgcmVzb2x2ZShkYXRhT2JqZWN0cyk7XHJcbiAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgICAgICAgICByZXNvbHZlKFtdKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgIFByb21pc2UuYWxsKGRhdGFPYmplY3RzUHJvbWlzZXMpXHJcbiAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKGRhdGFPYmplY3RzUmVzdWx0KSB7XHJcblxyXG4gICAgICAgICAgICAgIGxldCBkYXRhT2JqZWN0cyA9IFtdLmNvbmNhdC5hcHBseShbXSwgZGF0YU9iamVjdHNSZXN1bHQpO1xyXG5cclxuICAgICAgICAgICAgICBpZiAoZGF0YU9iamVjdHMubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVqZWN0KCdObyBkYXRhT2JqZWN0cyB3ZXJlIGZvdW5kJyk7XHJcbiAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICByZXNvbHZlKGRhdGFPYmplY3RzKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSlcclxuICAgICAgICAuY2F0Y2goZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICByZXR1cm4gcmVqZWN0KGVycik7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICogQWR2YW5jZWQgU2VhcmNoIGZvciBIeXBlcnRpZXMgcmVnaXN0ZXJlZCBpbiBkb21haW4gcmVnaXN0cnkgYXNzb2NpYXRlZCB3aXRoIHNvbWUgR1VJRFxyXG4gICogQHBhcmFtICB7U3RyaW5nfSAgICAgICAgICAgICBndWlkXHJcbiAgKiBAcGFyYW0gIHtBcnJheTxzdHJpbmc+fSAgICBkYXRhU2NoZW1lcyAoT3B0aW9uYWwpICAgICB0eXBlcyBvZiBoeXBlcnRpZXMgc2NoZW1hc1xyXG4gICogQHBhcmFtICB7QXJyYXk8c3RyaW5nPn0gICAgcmVzb3VyY2VzIChPcHRpb25hbCkgIHR5cGVzIG9mIGh5cGVydGllcyByZXNvdXJjZXNcclxuICAqL1xyXG4gIGRpc2NvdmVySHlwZXJ0aWVzUGVyR1VJRChndWlkLCBkYXRhU2NoZW1lcywgcmVzb3VyY2VzKSB7XHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG5cclxuICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuXHJcbiAgICAgIC8vdHJhbnNsYXRlIEdVSUQgaW50byB0aGUgdXNlciBJRHMgdG8gcXVlcnkgdGhlIGRvbWFpbiByZWdpc3RyeVxyXG4gICAgICBfdGhpcy5kaXNjb3ZlclVzZXJJZHNQZXJHVUlEKGd1aWQpXHJcbiAgICAgICAgLnRoZW4oZnVuY3Rpb24odWlkcykge1xyXG5cclxuICAgICAgICAvL3RyYW5zbGF0ZSB1c2VyIElEcyBpbnRvIHRoZSBhc3NvY2lhdGVkIGh5cGVydGllcyByZWdpc3RlcmVkIGluIHNvbWUgZG9tYWluXHJcbiAgICAgICAgICBsZXQgaHlwZXJ0aWVzUHJvbWlzZXMgPSB1aWRzLm1hcChmdW5jdGlvbih1aWQpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgICAgICAgIF90aGlzLmRpc2NvdmVySHlwZXJ0aWVzKHVpZC51SUQsIGRhdGFTY2hlbWVzLCByZXNvdXJjZXMsIHVpZC5kb21haW4pXHJcbiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbihoeXBlcnRpZXMpIHtcclxuICAgICAgICAgICAgICAgICAgcmVzb2x2ZShoeXBlcnRpZXMpO1xyXG4gICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgIC5jYXRjaChmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgcmVzb2x2ZShbXSk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICBQcm9taXNlLmFsbChoeXBlcnRpZXNQcm9taXNlcylcclxuICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24oaHlwZXJ0aWVzUmVzdWx0KSB7XHJcblxyXG4gICAgICAgICAgICAgIGxldCBoeXBlcnRpZXMgPSBbXS5jb25jYXQuYXBwbHkoW10sIGh5cGVydGllc1Jlc3VsdCk7XHJcblxyXG4gICAgICAgICAgICAgIGlmIChoeXBlcnRpZXMubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVqZWN0KCdObyBoeXBlcnRpZXMgd2VyZSBmb3VuZCcpO1xyXG4gICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgLy8gbG9nLmxvZygnSHlwZXJ0aWVzIDogJywgaHlwZXJ0aWVzKTtcclxuICAgICAgICAgICAgICByZXNvbHZlKGh5cGVydGllcyk7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICB9KVxyXG4gICAgICAgIC5jYXRjaChmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgIHJldHVybiByZWplY3QoZXJyKTtcclxuICAgICAgICB9KTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgKiBBZHZhbmNlZCBTZWFyY2ggZm9yIERhdGFPYmplY3RzIHJlZ2lzdGVyZWQgaW4gZG9tYWluIHJlZ2lzdHJ5IGFzc29jaWF0ZWQgd2l0aCBzb21lIEdVSURcclxuICAqIEBwYXJhbSAge1N0cmluZ30gICAgICAgICAgICAgZ3VpZFxyXG4gICogQHBhcmFtICB7QXJyYXk8c3RyaW5nPn0gICAgZGF0YVNjaGVtZXMgKE9wdGlvbmFsKSAgICAgdHlwZXMgb2YgaHlwZXJ0aWVzIHNjaGVtYXNcclxuICAqIEBwYXJhbSAge0FycmF5PHN0cmluZz59ICAgIHJlc291cmNlcyAoT3B0aW9uYWwpICB0eXBlcyBvZiBoeXBlcnRpZXMgcmVzb3VyY2VzXHJcbiAgKi9cclxuICBkaXNjb3ZlckRhdGFPYmplY3RzUGVyR1VJRChndWlkLCBkYXRhU2NoZW1lcywgcmVzb3VyY2VzKSB7XHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG5cclxuICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuXHJcbiAgICAgIC8vdHJhbnNsYXRlIEdVSUQgaW50byB0aGUgdXNlciBJRHMgdG8gcXVlcnkgdGhlIGRvbWFpbiByZWdpc3RyeVxyXG4gICAgICBfdGhpcy5kaXNjb3ZlclVzZXJJZHNQZXJHVUlEKGd1aWQpXHJcbiAgICAgICAgLnRoZW4oZnVuY3Rpb24odWlkcykge1xyXG5cclxuICAgICAgICAvL3RyYW5zbGF0ZSB1c2VyIElEcyBpbnRvIHRoZSBhc3NvY2lhdGVkIGRhdGFPYmplY3RzIHJlZ2lzdGVyZWQgaW4gc29tZSBkb21haW5cclxuICAgICAgICAgIGxldCBkYXRhT2JqZWN0UHJvbWlzZXMgPSB1aWRzLm1hcChmdW5jdGlvbih1aWQpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgICAgICAgIF90aGlzLmRpc2NvdmVyRGF0YU9iamVjdHModWlkLnVJRCwgZGF0YVNjaGVtZXMsIHJlc291cmNlcywgdWlkLmRvbWFpbilcclxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKGRhdGFPYmplY3RzKSB7XHJcbiAgICAgICAgICAgICAgICAgIHJlc29sdmUoZGF0YU9iamVjdHMpO1xyXG4gICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgIC5jYXRjaChmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgcmVzb2x2ZShbXSk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICBQcm9taXNlLmFsbChkYXRhT2JqZWN0UHJvbWlzZXMpXHJcbiAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKGRhdGFPYmplY3RzUmVzdWx0KSB7XHJcblxyXG4gICAgICAgICAgICAgIGxldCBkYXRhT2JqZWN0cyA9IFtdLmNvbmNhdC5hcHBseShbXSwgZGF0YU9iamVjdHNSZXN1bHQpO1xyXG5cclxuICAgICAgICAgICAgICBpZiAoZGF0YU9iamVjdHMubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVqZWN0KCdObyBkYXRhT2JqZWN0cyB3ZXJlIGZvdW5kJyk7XHJcbiAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAvLyBsb2cubG9nKCdEYXRhT2JqZWN0cyA6ICcsIGRhdGFPYmplY3RzKTtcclxuICAgICAgICAgICAgICByZXNvbHZlKGRhdGFPYmplY3RzKTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIH0pXHJcbiAgICAgICAgLmNhdGNoKGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgcmV0dXJuIHJlamVjdChlcnIpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvKiogQWR2YW5jZWQgU2VhcmNoIGZvciBIeXBlcnRpZXMgcmVnaXN0ZXJlZCBpbiBkb21haW4gcmVnaXN0cnkgYW5kIGFzc29jaWF0ZWQgd2l0aCBzb21lIHVzZXIgSURcclxuICAqIEBwYXJhbSAge1N0cmluZ30gICAgICAgICAgIHVzZXIgICAgICAgICAgICAgICAgICB1c2VyIGlkZW50aWZpZXIsIGVpdGhlciBpbiB1cmwgb3IgZW1haWwgZm9ybWF0XHJcbiAgKiBAcGFyYW0gIHtBcnJheTxzdHJpbmc+fSAgICBkYXRhU2NoZW1lcyAoT3B0aW9uYWwpICAgICB0eXBlcyBvZiBoeXBlcnRpZXMgc2NoZW1hc1xyXG4gICogQHBhcmFtICB7QXJyYXk8c3RyaW5nPn0gICAgcmVzb3VyY2VzIChPcHRpb25hbCkgIHR5cGVzIG9mIGh5cGVydGllcyByZXNvdXJjZXNcclxuICAqIEBwYXJhbSAge1N0cmluZ30gICAgICAgICAgIGRvbWFpbiAoT3B0aW9uYWwpICAgICBkb21haW4gb2YgdGhlIHJlZ2lzdHJ5IHRvIHNlYXJjaFxyXG4gICovXHJcbiAgZGlzY292ZXJIeXBlcnRpZXModXNlciwgZGF0YVNjaGVtZXMsIHJlc291cmNlcywgZG9tYWluKSB7XHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG4gICAgbGV0IGFjdGl2ZURvbWFpbjtcclxuXHJcbiAgICBhY3RpdmVEb21haW4gPSAoIWRvbWFpbikgPyBfdGhpcy5kb21haW4gOiBkb21haW47XHJcblxyXG4gICAgbGV0IG1zZyA9IHtcclxuICAgICAgdHlwZTogJ3JlYWQnLFxyXG4gICAgICBmcm9tOiBfdGhpcy5kaXNjb3ZlcnlVUkwsXHJcbiAgICAgIHRvOiAnZG9tYWluOi8vcmVnaXN0cnkuJyArIGFjdGl2ZURvbWFpbixcclxuICAgICAgYm9keToge1xyXG5cclxuICAgICAgfVxyXG4gICAgfTtcclxuXHJcbiAgICBpZiAodXNlci5pbmRleE9mKCd1c2VyOi8vJykgPiAtMSkgeyBtc2cuYm9keS5yZXNvdXJjZSA9IHVzZXI7IH0gZWxzZSB7IG1zZy5ib2R5LnJlc291cmNlID0gJy9oeXBlcnR5L2lkcC1pZGVudGlmaWVyLycgKyB1c2VyOyB9XHJcblxyXG4gICAgaWYgKGRhdGFTY2hlbWVzLmxlbmd0aCA+IDApIHtcclxuICAgICAgaWYgKCFtc2cuYm9keS5jcml0ZXJpYSkgeyBtc2cuYm9keS5jcml0ZXJpYSA9IHt9OyB9XHJcbiAgICAgIG1zZy5ib2R5LmNyaXRlcmlhLmRhdGFTY2hlbWVzID0gZGF0YVNjaGVtZXM7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKHJlc291cmNlcy5sZW5ndGggPiAwKSB7XHJcbiAgICAgIGlmICghbXNnLmJvZHkuY3JpdGVyaWEpIHsgbXNnLmJvZHkuY3JpdGVyaWEgPSB7fTsgfVxyXG4gICAgICBtc2cuYm9keS5jcml0ZXJpYS5yZXNvdXJjZXMgPSByZXNvdXJjZXM7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAvLyBsb2cubG9nKFwiW0NvcmVEaXNjb3ZlcnkuZGlzY292ZXJIeXBlcnRpZXNdIHNlbmRpbmcgbXNnIFwiLCBtc2cpO1xyXG5cclxuICAgICAgX3RoaXMubWVzc2FnZUJ1cy5wb3N0TWVzc2FnZShtc2csIChyZXBseSkgPT4ge1xyXG5cclxuICAgICAgICAvLyBsb2cubG9nKFwiW0NvcmVEaXNjb3ZlcnkuZGlzY292ZXJIeXBlcnRpZXNdIHJjdmVkIHJlcGx5IFwiLCByZXBseSk7XHJcblxyXG4gICAgICAgIGlmIChyZXBseS5ib2R5LmNvZGUgPT09IDIwMCB8fCByZXBseS5ib2R5LmNvZGUgPT09IDUwMCkge1xyXG4gICAgICAgICAgbGV0IGh5cGVydGllcyA9IHJlcGx5LmJvZHkudmFsdWU7XHJcblxyXG4gICAgICAgICAgbGV0IGZpbmFsSHlwZXJ0aWVzID0gW107XHJcbiAgICAgICAgICBmb3IgKHZhciBrZXkgaW4gaHlwZXJ0aWVzKSBmaW5hbEh5cGVydGllcy5wdXNoKGh5cGVydGllc1trZXldKTtcclxuXHJcbiAgICAgICAgICBpZiAoZmluYWxIeXBlcnRpZXMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICAvLyBsb2cubG9nKFwiW0NvcmVEaXNjb3ZlcnkuZGlzY292ZXJIeXBlcnRpZXNdIEh5cGVydGllcyBGb3VuZDogXCIsIGZpbmFsSHlwZXJ0aWVzKTtcclxuICAgICAgICAgICAgcmVzb2x2ZShmaW5hbEh5cGVydGllcyk7XHJcbiAgICAgICAgICB9IGVsc2UgeyByZXR1cm4gcmVqZWN0KCdObyBIeXBlcnR5IHdhcyBmb3VuZCcpOyB9XHJcbiAgICAgICAgfSBlbHNlIHsgcmV0dXJuIHJlamVjdCgnTm8gSHlwZXJ0eSB3YXMgZm91bmQnKTsgfVxyXG5cclxuICAgICAgICAvKl90aGlzLnJlZ2lzdHJ5LmlzTGVnYWN5KHVzZXIpLnRoZW4oKGxlZ2FjeSkgPT4ge1xyXG4gICAgICAgICAgICAgIGlmIChsZWdhY3kpIHJlc29sdmUoW3toeXBlcnR5SUQ6IHVzZXIgfV0pXHJcbiAgICAgICAgICAgICAgZWxzZSByZXR1cm4gcmVqZWN0KCdObyBIeXBlcnR5IHdhcyBmb3VuZCcpO1xyXG4gICAgICAgICAgfSk7Ki9cclxuICAgICAgfSk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8qKiBBZHZhbmNlZCBTZWFyY2ggZm9yIERhdGFPYmplY3RzIHJlZ2lzdGVyZWQgaW4gZG9tYWluIHJlZ2lzdHJ5IGFuZCBhc3NvY2lhdGVkIHdpdGggc29tZSB1c2VyIElEXHJcbiAgKiBAcGFyYW0gIHtTdHJpbmd9ICAgICAgICAgICB1c2VyICAgICAgICAgICAgICAgICAgdXNlciBpZGVudGlmaWVyLCBlaXRoZXIgaW4gdXJsIG9yIGVtYWlsIGZvcm1hdFxyXG4gICogQHBhcmFtICB7QXJyYXk8c3RyaW5nPn0gICAgZGF0YVNjaGVtZXMgKE9wdGlvbmFsKSAgICAgdHlwZXMgb2YgZGF0YU9iamVjdHMgc2NoZW1hc1xyXG4gICogQHBhcmFtICB7QXJyYXk8c3RyaW5nPn0gICAgcmVzb3VyY2VzIChPcHRpb25hbCkgIHR5cGVzIG9mIGRhdGFPYmplY3RzIHJlc291cmNlc1xyXG4gICogQHBhcmFtICB7U3RyaW5nfSAgICAgICAgICAgZG9tYWluIChPcHRpb25hbCkgICAgIGRvbWFpbiBvZiB0aGUgcmVnaXN0cnkgdG8gc2VhcmNoXHJcbiAgKi9cclxuICBkaXNjb3ZlckRhdGFPYmplY3RzKHVzZXIsIGRhdGFTY2hlbWVzLCByZXNvdXJjZXMsIGRvbWFpbikge1xyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuICAgIGxldCBhY3RpdmVEb21haW47XHJcbiAgICBsZXQgZGF0YU9iamVjdHNBcnJheSA9IFtdO1xyXG5cclxuICAgIGFjdGl2ZURvbWFpbiA9ICghZG9tYWluKSA/IF90aGlzLmRvbWFpbiA6IGRvbWFpbjtcclxuXHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcblxyXG4gICAgICAvL3RyYW5zbGF0ZSB1c2VyIGlkZW50aWZpZXIgKGUuZy4gZW1haWwsIG5hbWUuLi4pIGludG8gdGhlIGFzc29jaWF0ZWQgaHlwZXJ0aWVzXHJcbiAgICAgIF90aGlzLmRpc2NvdmVySHlwZXJ0aWVzKHVzZXIsIFtdLCBbXSwgYWN0aXZlRG9tYWluKVxyXG4gICAgICAgIC50aGVuKGZ1bmN0aW9uKGh5cGVydGllcykge1xyXG5cclxuICAgICAgICAgIGxldCBmaW5hbEh5cGVydGllcyA9IFtdO1xyXG4gICAgICAgICAgZm9yICh2YXIga2V5IGluIGh5cGVydGllcykgZmluYWxIeXBlcnRpZXMucHVzaChoeXBlcnRpZXNba2V5XSk7XHJcblxyXG4gICAgICAgICAgLy90cmFuc2xhdGUgaHlwZXJ0aWVzIFVSTHMgaW50byB0aGUgYXNzb2NpYXRlZCBkYXRhT2JqZWN0cyByZWdpc3RlcmVkIGluIHNvbWUgZG9tYWluXHJcbiAgICAgICAgICBsZXQgZGF0YU9iamVjdHNQcm9taXNlcyA9IGZpbmFsSHlwZXJ0aWVzLm1hcChmdW5jdGlvbihoeXBlcnR5KSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICAgICAgICBfdGhpcy5kaXNjb3ZlckRhdGFPYmplY3RzUGVyUmVwb3J0ZXIoaHlwZXJ0eS5oeXBlcnR5SUQsIGRhdGFTY2hlbWVzLCByZXNvdXJjZXMsIGFjdGl2ZURvbWFpbilcclxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKGRhdGFPYmplY3QpIHtcclxuICAgICAgICAgICAgICAgICAgcmVzb2x2ZShkYXRhT2JqZWN0KTtcclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgIHJlc29sdmUoW10pO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgUHJvbWlzZS5hbGwoZGF0YU9iamVjdHNQcm9taXNlcylcclxuICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24oZGF0YU9iamVjdHNSZXN1bHQpIHtcclxuXHJcbiAgICAgICAgICAgICAgbGV0IGRhdGFPYmplY3RzID0gW10uY29uY2F0LmFwcGx5KFtdLCBkYXRhT2JqZWN0c1Jlc3VsdCk7XHJcblxyXG4gICAgICAgICAgICAgIGRhdGFPYmplY3RzLmZvckVhY2goZnVuY3Rpb24oZGF0YU9iamVjdCkge1xyXG4gICAgICAgICAgICAgICAgZGF0YU9iamVjdHNBcnJheS5wdXNoKGRhdGFPYmplY3QpO1xyXG4gICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICBsZXQgZmluYWxEYXRhT2JqZWN0cyA9IFtdO1xyXG4gICAgICAgICAgICAgIGZvciAodmFyIGtleSBpbiBkYXRhT2JqZWN0c0FycmF5KSBmaW5hbERhdGFPYmplY3RzLnB1c2goZGF0YU9iamVjdHNBcnJheVtrZXldKTtcclxuXHJcbiAgICAgICAgICAgICAgaWYgKGZpbmFsRGF0YU9iamVjdHMubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVqZWN0KCdObyBkYXRhT2JqZWN0cyB3ZXJlIGZvdW5kJyk7XHJcbiAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAvLyBsb2cubG9nKCdEYXRhT2JqZWN0cyBGb3VuZDogJywgZmluYWxEYXRhT2JqZWN0cyk7XHJcbiAgICAgICAgICAgICAgcmVzb2x2ZShmaW5hbERhdGFPYmplY3RzKTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIH0pXHJcbiAgICAgICAgLmNhdGNoKGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgcmV0dXJuIHJlamVjdChlcnIpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAqIGZ1bmN0aW9uIHRvIHJlcXVlc3QgYWJvdXQgaHlwZXJ0aWVzIHJlZ2lzdGVyZWQgaW4gZG9tYWluIHJlZ2lzdHJ5LCBhbmRcclxuICAqIHJldHVybiB0aGUgaHlwZXJ0eSBpbmZvcm1hdGlvbiwgaWYgZm91bmQuXHJcbiAgKiBAcGFyYW0gIHtTdHJpbmd9ICAgICAgICAgICAgICB1cmwgIGRhdGFPYmplY3QgVVJMXHJcbiAgKiBAcGFyYW0gIHtTdHJpbmd9ICAgICAgICAgICAgZG9tYWluIChPcHRpb25hbClcclxuICAqIEByZXR1cm4ge1Byb21pc2V9ICAgICAgICAgIFByb21pc2VcclxuICAqL1xyXG4gIGRpc2NvdmVySHlwZXJ0eVBlclVSTCh1cmwsIGRvbWFpbikge1xyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuICAgIGxldCBhY3RpdmVEb21haW47XHJcblxyXG4gICAgYWN0aXZlRG9tYWluID0gKCFkb21haW4pID8gX3RoaXMuZG9tYWluIDogZG9tYWluO1xyXG5cclxuICAgIGxldCBtc2cgPSB7XHJcbiAgICAgIHR5cGU6ICdyZWFkJyxcclxuICAgICAgZnJvbTogX3RoaXMuZGlzY292ZXJ5VVJMLFxyXG4gICAgICB0bzogJ2RvbWFpbjovL3JlZ2lzdHJ5LicgKyBhY3RpdmVEb21haW4sXHJcbiAgICAgIGJvZHk6IHtcclxuICAgICAgICByZXNvdXJjZTogdXJsXHJcbiAgICAgIH1cclxuICAgIH07XHJcblxyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG5cclxuICAgICAgX3RoaXMubWVzc2FnZUJ1cy5wb3N0TWVzc2FnZShtc2csIChyZXBseSkgPT4ge1xyXG5cclxuICAgICAgICBpZiAocmVwbHkuYm9keS5jb2RlICE9PSAyMDAgJiYgcmVwbHkuYm9keS5jb2RlICE9PSA1MDApIHsgcmV0dXJuIHJlamVjdCgnTm8gSHlwZXJ0eSB3YXMgZm91bmQnKTsgfVxyXG5cclxuICAgICAgICBsZXQgaHlwZXJ0eSA9IHJlcGx5LmJvZHkudmFsdWU7XHJcblxyXG4gICAgICAgIGlmIChoeXBlcnR5KSB7XHJcbiAgICAgICAgICAvLyBsb2cubG9nKCdIeXBlcnR5IGZvdW5kOiAnLCBoeXBlcnR5KTtcclxuICAgICAgICAgIHJlc29sdmUoaHlwZXJ0eSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIHJldHVybiByZWplY3QoJ05vIEh5cGVydHkgd2FzIGZvdW5kJyk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgKiBmdW5jdGlvbiB0byByZXF1ZXN0IGFib3V0IGRhdGFPYmplY3QgcmVnaXN0ZXJlZCBpbiBkb21haW4gcmVnaXN0cnksIGFuZFxyXG4gICogcmV0dXJuIHRoZSBkYXRhT2JqZWN0IGluZm9ybWF0aW9uLCBpZiBmb3VuZC5cclxuICAqIEBwYXJhbSAge1N0cmluZ30gICAgICAgICAgICAgIHVybCAgZGF0YU9iamVjdCBVUkxcclxuICAqIEBwYXJhbSAge1N0cmluZ30gICAgICAgICAgICBkb21haW4gKE9wdGlvbmFsKVxyXG4gICogQHJldHVybiB7UHJvbWlzZX0gICAgICAgICAgUHJvbWlzZVxyXG4gICovXHJcbiAgZGlzY292ZXJEYXRhT2JqZWN0UGVyVVJMKHVybCwgZG9tYWluKSB7XHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG4gICAgbGV0IGFjdGl2ZURvbWFpbjtcclxuXHJcbiAgICBhY3RpdmVEb21haW4gPSAoIWRvbWFpbikgPyBfdGhpcy5kb21haW4gOiBkb21haW47XHJcblxyXG4gICAgbGV0IG1zZyA9IHtcclxuICAgICAgdHlwZTogJ3JlYWQnLFxyXG4gICAgICBmcm9tOiBfdGhpcy5kaXNjb3ZlcnlVUkwsXHJcbiAgICAgIHRvOiAnZG9tYWluOi8vcmVnaXN0cnkuJyArIGFjdGl2ZURvbWFpbixcclxuICAgICAgYm9keToge1xyXG4gICAgICAgIHJlc291cmNlOiB1cmxcclxuICAgICAgfVxyXG4gICAgfTtcclxuXHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcblxyXG4gICAgICBfdGhpcy5tZXNzYWdlQnVzLnBvc3RNZXNzYWdlKG1zZywgKHJlcGx5KSA9PiB7XHJcblxyXG4gICAgICAgIGxldCBkYXRhT2JqZWN0ID0gcmVwbHkuYm9keS52YWx1ZTtcclxuXHJcbiAgICAgICAgaWYgKGRhdGFPYmplY3QpIHtcclxuICAgICAgICAgIC8vIGxvZy5sb2coJ0RhdGFPYmplY3QgZm91bmQ6ICcsIGRhdGFPYmplY3QpO1xyXG4gICAgICAgICAgcmVzb2x2ZShkYXRhT2JqZWN0KTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgcmV0dXJuIHJlamVjdCgnRGF0YU9iamVjdCBub3QgZm91bmQnKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvKiogQWR2YW5jZWQgU2VhcmNoIGZvciBkYXRhT2JqZWN0cyByZWdpc3RlcmVkIGluIGRvbWFpbiByZWdpc3RyeVxyXG4gICogQHBhcmFtICB7U3RyaW5nfSAgICAgICAgICAgbmFtZSAgICAgICAgICAgICAgICAgIG5hbWUgb2YgdGhlIGRhdGFPYmplY3RcclxuICAqIEBwYXJhbSAge0FycmF5PHN0cmluZz59ICAgIGRhdGFTY2hlbWVzIChPcHRpb25hbCkgICAgIHR5cGVzIG9mIGRhdGFPYmplY3Qgc2NoZW1hc1xyXG4gICogQHBhcmFtICB7QXJyYXk8c3RyaW5nPn0gICAgcmVzb3VyY2VzIChPcHRpb25hbCkgIHR5cGVzIG9mIGRhdGFPYmplY3QgcmVzb3VyY2VzXHJcbiAgKiBAcGFyYW0gIHtTdHJpbmd9ICAgICAgICAgICBkb21haW4gKE9wdGlvbmFsKSAgICAgZG9tYWluIG9mIHRoZSByZWdpc3RyeSB0byBzZWFyY2hcclxuICAqL1xyXG4gIGRpc2NvdmVyRGF0YU9iamVjdHNQZXJOYW1lKG5hbWUsIGRhdGFTY2hlbWVzLCByZXNvdXJjZXMsIGRvbWFpbikge1xyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuICAgIGxldCBhY3RpdmVEb21haW47XHJcblxyXG4gICAgYWN0aXZlRG9tYWluID0gKCFkb21haW4pID8gX3RoaXMuZG9tYWluIDogZG9tYWluO1xyXG5cclxuICAgIGxldCBtc2cgPSB7XHJcbiAgICAgIHR5cGU6ICdyZWFkJyxcclxuICAgICAgZnJvbTogX3RoaXMuZGlzY292ZXJ5VVJMLFxyXG4gICAgICB0bzogJ2RvbWFpbjovL3JlZ2lzdHJ5LicgKyBhY3RpdmVEb21haW4sXHJcbiAgICAgIGJvZHk6IHtcclxuICAgICAgICByZXNvdXJjZTogbmFtZVxyXG4gICAgICB9XHJcbiAgICB9O1xyXG5cclxuICAgIGlmIChkYXRhU2NoZW1lcy5sZW5ndGggPiAwKSB7XHJcbiAgICAgIGlmICghbXNnLmJvZHkuY3JpdGVyaWEpIHsgbXNnLmJvZHkuY3JpdGVyaWEgPSB7fTsgfVxyXG4gICAgICBtc2cuYm9keS5jcml0ZXJpYS5kYXRhU2NoZW1lcyA9IGRhdGFTY2hlbWVzO1xyXG4gICAgfVxyXG5cclxuICAgIGlmIChyZXNvdXJjZXMubGVuZ3RoID4gMCkge1xyXG4gICAgICBpZiAoIW1zZy5ib2R5LmNyaXRlcmlhKSB7IG1zZy5ib2R5LmNyaXRlcmlhID0ge307IH1cclxuICAgICAgbXNnLmJvZHkuY3JpdGVyaWEucmVzb3VyY2VzID0gcmVzb3VyY2VzO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuXHJcbiAgICAgIF90aGlzLm1lc3NhZ2VCdXMucG9zdE1lc3NhZ2UobXNnLCAocmVwbHkpID0+IHtcclxuXHJcbiAgICAgICAgbGV0IGRhdGFPYmplY3RzID0gcmVwbHkuYm9keS52YWx1ZTtcclxuXHJcbiAgICAgICAgbGV0IGZpbmFsRGF0YU9iamVjdHMgPSBbXTtcclxuICAgICAgICBmb3IgKHZhciBrZXkgaW4gZGF0YU9iamVjdHMpIGZpbmFsRGF0YU9iamVjdHMucHVzaChkYXRhT2JqZWN0c1trZXldKTtcclxuXHJcbiAgICAgICAgaWYgKGZpbmFsRGF0YU9iamVjdHMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgLy8gbG9nLmxvZyhcIkRhdGFPYmplY3RzIEZvdW5kOiBcIiwgZmluYWxEYXRhT2JqZWN0cyk7XHJcbiAgICAgICAgICByZXNvbHZlKGZpbmFsRGF0YU9iamVjdHMpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICByZXR1cm4gcmVqZWN0KCdObyBEYXRhT2JqZWN0IHdhcyBmb3VuZCcpO1xyXG4gICAgICAgIH1cclxuICAgICAgfSk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICogZnVuY3Rpb24gdG8gcmVxdWVzdCBhYm91dCBzcGVjaWZpYyByZXBvcnRlciBkYXRhT2JqZWN0IHJlZ2lzdGVyZWQgaW4gZG9tYWluIHJlZ2lzdHJ5LCBhbmRcclxuICAqIHJldHVybiB0aGUgZGF0YU9iamVjdHMgZnJvbSB0aGF0IHJlcG9ydGVyLlxyXG4gICogQHBhcmFtICB7U3RyaW5nfSAgICAgICAgICAgcmVwb3J0ZXIgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YU9iamVjdCByZXBvcnRlclxyXG4gICogQHBhcmFtICB7QXJyYXk8c3RyaW5nPn0gICAgc2NkYXRhU2NoZW1lc2hlbWEgICAgICAgICAgICAgICAgKE9wdGlvbmFsKSAgICAgdHlwZXMgb2YgZGF0YU9iamVjdHMgc2NoZW1hc1xyXG4gICogQHBhcmFtICB7QXJyYXk8c3RyaW5nPn0gICAgcmVzb3VyY2VzICAgICAgICAgICAgICAgICAgICAgICAgKE9wdGlvbmFsKSAgdHlwZXMgb2YgZGF0YU9iamVjdHMgcmVzb3VyY2VzXHJcbiAgKiBAcGFyYW0gIHtTdHJpbmd9ICAgICAgICAgICBkb21haW4gICAgICAgICAgICAgICAgICAgICAgICAgICAoT3B0aW9uYWwpXHJcbiAgKi9cclxuICBkaXNjb3ZlckRhdGFPYmplY3RzUGVyUmVwb3J0ZXIocmVwb3J0ZXIsIGRhdGFTY2hlbWVzLCByZXNvdXJjZXMsIGRvbWFpbikge1xyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuICAgIGxldCBhY3RpdmVEb21haW47XHJcblxyXG4gICAgYWN0aXZlRG9tYWluID0gKCFkb21haW4pID8gX3RoaXMuZG9tYWluIDogZG9tYWluO1xyXG5cclxuICAgIGxldCBtc2cgPSB7XHJcbiAgICAgIHR5cGU6ICdyZWFkJyxcclxuICAgICAgZnJvbTogX3RoaXMuZGlzY292ZXJ5VVJMLFxyXG4gICAgICB0bzogJ2RvbWFpbjovL3JlZ2lzdHJ5LicgKyBhY3RpdmVEb21haW4sXHJcbiAgICAgIGJvZHk6IHtcclxuICAgICAgICByZXNvdXJjZTogJy9jb21tJyxcclxuICAgICAgICBjcml0ZXJpYToge1xyXG4gICAgICAgICAgcmVwb3J0ZXI6IHJlcG9ydGVyXHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9O1xyXG5cclxuICAgIGlmIChkYXRhU2NoZW1lcy5sZW5ndGggPiAwKSB7IG1zZy5ib2R5LmNyaXRlcmlhLmRhdGFTY2hlbWVzID0gZGF0YVNjaGVtZXM7IH1cclxuXHJcbiAgICBpZiAocmVzb3VyY2VzLmxlbmd0aCA+IDApIHsgbXNnLmJvZHkuY3JpdGVyaWEucmVzb3VyY2VzID0gcmVzb3VyY2VzOyB9XHJcblxyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG5cclxuICAgICAgX3RoaXMubWVzc2FnZUJ1cy5wb3N0TWVzc2FnZShtc2csIChyZXBseSkgPT4ge1xyXG5cclxuICAgICAgICBsZXQgZGF0YU9iamVjdHMgPSByZXBseS5ib2R5LnZhbHVlO1xyXG5cclxuICAgICAgICBsZXQgZmluYWxEYXRhT2JqZWN0cyA9IFtdO1xyXG4gICAgICAgIGZvciAodmFyIGtleSBpbiBkYXRhT2JqZWN0cykgZmluYWxEYXRhT2JqZWN0cy5wdXNoKGRhdGFPYmplY3RzW2tleV0pO1xyXG5cclxuICAgICAgICBpZiAoZmluYWxEYXRhT2JqZWN0cy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAvLyBsb2cubG9nKFwiRGF0YU9iamVjdHMgRm91bmQ6IFwiLCBmaW5hbERhdGFPYmplY3RzKTtcclxuICAgICAgICAgIHJlc29sdmUoZmluYWxEYXRhT2JqZWN0cyk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIHJldHVybiByZWplY3QoJ05vIERhdGFPYmplY3Qgd2FzIGZvdW5kJyk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgKiBmdW5jdGlvbiB0byByZXF1ZXN0IGdsb2JhbCByZWdpc3RyeSBhYm91dCB0aGUgdXNlciBJRHMgYXNzb2NpYXRlZCB3aXRoIHNvbWUgR1VJRFxyXG4gICogQHBhcmFtICB7U3RyaW5nfSAgICAgICAgICAgICAgZ3VpZFxyXG4gICogQHJldHVybiB7UHJvbWlzZX0gICAgICAgICAgUHJvbWlzZVxyXG4gICovXHJcbiAgZGlzY292ZXJVc2VySWRzUGVyR1VJRChndWlkKSB7XHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG5cclxuICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuXHJcbiAgICAgIC8vIGxvZy5sb2coXCJHTyBncmFwaENvbm5lY3RvcjpcIiwgZ3VpZCk7XHJcblxyXG4gICAgICBfdGhpcy5ncmFwaENvbm5lY3Rvci5xdWVyeUdsb2JhbFJlZ2lzdHJ5KGd1aWQpXHJcbiAgICAgICAgLnRoZW4oZnVuY3Rpb24oZ3JhcGhDb25uZWN0b3JDb250YWN0RGF0YSkge1xyXG5cclxuICAgICAgICAvLyBsb2cubG9nKCdJbmZvcm1hdGlvbiByZXR1cm5lZCBmcm9tIEdsb2JhbCBSZWdpc3RyeTogJywgZ3JhcGhDb25uZWN0b3JDb250YWN0RGF0YSk7XHJcblxyXG4gICAgICAgICAgaWYgKHR5cGVvZiBncmFwaENvbm5lY3RvckNvbnRhY3REYXRhID09PSAnc3RyaW5nJyB8fCAhZ3JhcGhDb25uZWN0b3JDb250YWN0RGF0YSkge1xyXG4gICAgICAgICAgICByZXR1cm4gcmVqZWN0KCdVbnN1Y2Nlc3NmdWwgZGlzY292ZXIgdXNlcklEcyBieSBHVUlEJyk7XHJcbiAgICAgICAgICB9IGVsc2Uge1xyXG5cclxuICAgICAgICAgICAgbGV0IHVzZXJpZHMgPSBncmFwaENvbm5lY3RvckNvbnRhY3REYXRhLnVzZXJJRHM7XHJcblxyXG4gICAgICAgICAgICBpZiAodXNlcmlkcy5sZW5ndGggPT09IDApIHsgcmV0dXJuIHJlamVjdCgnVXNlcklEcyBub3QgYXZhaWxhYmxlJyk7IH1cclxuXHJcbiAgICAgICAgICAgIHJlc29sdmUodXNlcmlkcyk7XHJcbiAgICAgICAgICB9XHJcblxyXG4gICAgICAgIH0pXHJcbiAgICAgICAgLmNhdGNoKGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgcmV0dXJuIHJlamVjdChlcnIpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgKiBmdW5jdGlvbiB0byByZXF1ZXN0IGRpc2NvdmVyeSBzZXJ2aWNlIGFib3V0IHRoZSBHVUlEIGFzc29jaWF0ZWQgd2l0aCBzb21lIHVzZXIgaWRlbnRpZmllciAoZWcgZW1haWwsIG5hbWUgLi4uKVxyXG4gICogQHBhcmFtICB7U3RyaW5nfSAgICAgICAgICAgIHVzZXJJZGVudGlmaWVyXHJcbiAgKiBAcmV0dXJuIHtQcm9taXNlfSAgICAgICAgICAgUHJvbWlzZVxyXG4gICovXHJcbiAgZGlzY292ZXJHVUlEUGVyVXNlcklkZW50aWZpZXIodXNlcklkZW50aWZpZXIpIHtcclxuICAgIGxldCBfdGhpcyA9IHRoaXM7XHJcblxyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG5cclxuICAgICAgbGV0IGxvb2t1cFVSTERpc2NvdmVyeVNlcnZpY2UgPSAnaHR0cHM6Ly9yZXRoaW5rLnRsYWJzY2xvdWQuY29tL2Rpc2NvdmVyeS9yZXN0L2Rpc2NvdmVyL2xvb2t1cD9zZWFyY2hxdWVyeT0nO1xyXG4gICAgICBfdGhpcy5odHRwUmVxdWVzdC5nZXQobG9va3VwVVJMRGlzY292ZXJ5U2VydmljZSArIHVzZXJJZGVudGlmaWVyKVxyXG4gICAgICAgIC50aGVuKGZ1bmN0aW9uKGpzb24pIHtcclxuICAgICAgICAvLyBsb2cubG9nKCdkaXNjb3ZlciBHVUlEIGJ5IHVzZXIgaWRlbnRpZmllcicsIGpzb24pO1xyXG5cclxuICAgICAgICAgIGxldCByZXNwb25zZSA9IEpTT04ucGFyc2UoanNvbik7XHJcbiAgICAgICAgICBsZXQgZmlsdGVyZWRHdWlkID0gcmVzcG9uc2UucmVzdWx0cy5maWx0ZXIoZnVuY3Rpb24oeCkge1xyXG4gICAgICAgICAgICByZXR1cm4geC5yZXRoaW5rSUQgIT0gdW5kZWZpbmVkO1xyXG4gICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgaWYgKGZpbHRlcmVkR3VpZC5sZW5ndGggPT09IDApIHsgcmV0dXJuIHJlamVjdCgnVW5zdWNjZXNzZnVsIGRpc2NvdmVyIEdVSUQgYnkgdXNlciBpZGVudGlmaWVyJyk7IH1cclxuXHJcbiAgICAgICAgICBsZXQgZ3VpZHMgPSBmaWx0ZXJlZEd1aWQubWFwKGZ1bmN0aW9uKHgpIHsgcmV0dXJuIHgucmV0aGlua0lEOyB9KTtcclxuXHJcbiAgICAgICAgICByZXR1cm4gcmVzb2x2ZShndWlkcyk7XHJcblxyXG4gICAgICAgIH0pXHJcbiAgICAgICAgLmNhdGNoKGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgIC8vIGxvZy5sb2coXCJIVFRQIFJlcXVlc3QgZXJyb3I6IFwiLCBlcnIpO1xyXG4gICAgICAgICAgcmV0dXJuIHJlamVjdChlcnIpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSk7XHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgZGVmYXVsdCBDb3JlRGlzY292ZXJ5O1xyXG4iLCIvLyBMb2cgU3lzdGVtXHJcbmltcG9ydCAqIGFzIGxvZ2dlciBmcm9tICdsb2dsZXZlbCc7XHJcbmxldCBsb2cgPSBsb2dnZXIuZ2V0TG9nZ2VyKCdEYXRhT2JqZWN0c1N0b3JhZ2UnKTtcclxuXHJcbmltcG9ydCB7IGFzc2lnbiwgZGVlcENsb25lLCBkaXZpZGVVUkwgfSBmcm9tICcuLi91dGlscy91dGlscyc7XHJcblxyXG5pbXBvcnQgeyBjcmVhdGVTeW5jREIgfSBmcm9tICcuLi9ydW50aW1lL1N0b3JhZ2UnO1xyXG5cclxuY2xhc3MgRGF0YU9iamVjdHNTdG9yYWdlIHtcclxuXHJcbiAgY29uc3RydWN0b3Ioc3RvcmFnZU1hbmFnZXIsIHN0b3JlZERhdGFPYmplY3RzID0ge30sIGZhY3RvcnksIHJ1bnRpbWVVcmwpIHtcclxuICAgIGlmICghc3RvcmFnZU1hbmFnZXIpIHRocm93IG5ldyBFcnJvcignW1N0b3JlIERhdGEgT2JqZWN0c10gLSBOZWVkcyB0aGUgc3RvcmFnZU1hbmFnZXIgY29tcG9uZW50Jyk7XHJcblxyXG4gICAgdGhpcy5fc3RvcmFnZU1hbmFnZXIgPSBzdG9yYWdlTWFuYWdlcjtcclxuXHJcbiAgICB0aGlzLl9zdG9yZURhdGFPYmplY3QgPSBzdG9yZWREYXRhT2JqZWN0cztcclxuXHJcbiAgICB0aGlzLl9jYWNoZSA9IHt9O1xyXG5cclxuICAgIHRoaXMuX2NyZWF0ZVN5bmNEQiA9IGNyZWF0ZVN5bmNEQjsgLy8gdG8gY3JlYXRlIERhdGEgT2JqZWN0cyB0byBiZSBzeW5jaGVkIHdpdGggcmVtb3RlIHN0b3JhZ2VzXHJcbiAgICB0aGlzLl9yZW1vdGVzID0ge307IC8vIExpc3Qgb2YgRE8gc3luY2hlZCB3aXRoIHJlbW90ZSBzdG9yYWdlc1xyXG4gICAgdGhpcy5fZmFjdG9yeSA9IGZhY3Rvcnk7XHJcbiAgICB0aGlzLl90YWJsZSA9ICdzeW5jaGVyTWFuYWdlcjpPYmplY3RVUkxzJztcclxuICAgIHRoaXMuX3JlbW90ZVN0b3JhZ2VUYWJsZSA9ICdkYXRhT2JqZWN0U3RvcmFnZSc7XHJcbiAgICB0aGlzLl9yZW1vdGVTY2hlbWEgPSAndXJsJztcclxuICAgIHRoaXMuX3J1bnRpbWVVcmwgPSBydW50aW1lVXJsO1xyXG4gIH1cclxuXHJcbiAgLy8gbG9hZCBEYXRhIE9iamVjdHMgc3luY2hlZCB3aXRoIHJlbW90ZSBTdG9yYWdlc1xyXG5cclxuICBsb2FkUmVtb3RlKHJlc3VtZSA9IGZhbHNlKSB7XHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcclxuICAgICAgbGV0IGxvYWRpbmcgPSBbXTtcclxuICAgICAgbGV0IHN5bmNoaW5nID0gW107XHJcblxyXG4gICAgICBfdGhpcy5fc3RvcmFnZU1hbmFnZXIuZ2V0KG51bGwsIG51bGwsICdyZW1vdGVzJykudGhlbigocmVtb3RlcykgPT4ge1xyXG5cclxuICAgICAgICAvLyBpbiBjYXNlIHdlIGRvbid0IGhhdmUgYW55IHJlbW90ZXMgbG9jYWxseSBzdG9yZWRcclxuICAgICAgICBsb2cubG9nKCdbU3RvcmVEYXRhT2JqZWN0cy5sb2FkUmVtb3RlXSByZW1vdGVzOiAnLCByZW1vdGVzKTtcclxuICAgICAgICBpZiAoIXJlbW90ZXMpIHJlc29sdmUoKTtcclxuXHJcbiAgICAgICAgaWYgKCFyZXN1bWUpIF90aGlzLl9yZW1vdGVzID0gcmVtb3RlcztcclxuXHJcbiAgICAgICAgbG9nLmxvZygnW1N0b3JlRGF0YU9iamVjdHMubG9hZFJlbW90ZV0gbG9hZGluZzogJywgX3RoaXMuX3JlbW90ZXMpO1xyXG5cclxuICAgICAgICBsZXQgcmVtb3RlT2JqZWN0cyA9IE9iamVjdC5rZXlzKHJlbW90ZXMpO1xyXG5cclxuICAgICAgICAvLyBpbiBjYXNlIHdlIGRvbid0IGhhdmUgYW55IHJlbW90ZXMgbG9jYWxseSBzdG9yZWRcclxuICAgICAgICBpZiAocmVtb3RlT2JqZWN0cy5sZW5ndGggPT09IDApIHJlc29sdmUoKTtcclxuXHJcbiAgICAgICAgcmVtb3RlT2JqZWN0cy5mb3JFYWNoKChkYikgPT4ge1xyXG4gICAgICAgICAgbGV0IHRhYmxlID0gJ2RvLScgKyBkYi5zcGxpdCgnLycpWzNdO1xyXG4gICAgICAgICAgX3RoaXMuX3JlbW90ZXNbZGJdID0gY3JlYXRlU3luY0RCKHRhYmxlLCB0aGlzLl9mYWN0b3J5KTtcclxuICAgICAgICAgIC8vICAgICAgICAgICAgX3RoaXMuX3JlbW90ZXNbcmVtb3RlXSA9IGNyZWF0ZVN5bmNEQihyZW1vdGUsIF90aGlzLl9mYWN0b3J5LCAncmVtb3RlRGF0YU9iamVjdFN0b3JhZ2UnICk7XHJcbiAgICAgICAgICBsb2FkaW5nLnB1c2goX3RoaXMuX3JlbW90ZXNbZGJdLmdldCgpKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgUHJvbWlzZS5hbGwobG9hZGluZykudGhlbigocmVtb3RlcykgPT4ge1xyXG4gICAgICAgICAgbG9nLmxvZygnW1N0b3JlRGF0YU9iamVjdHMubG9hZFJlbW90ZV0gbG9hZGVkOiAnLCByZW1vdGVzKTtcclxuICAgICAgICAgIC8vVE9ETzogaW5pdCB0aGlzLl9zdG9yZURhdGFPYmplY3Qgd2l0aCBsb2FkZWQgZGF0YSBvYmplY3RzXHJcbiAgICAgICAgICAvKiAgICAgICAgICBPYmplY3Qua2V5cyhyZW1vdGVzKS5mb3JFYWNoKChyZW1vdGUpID0+IHtcclxuICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgICAgICAgc3luY2hpbmcucHVzaChfdGhpcy5zeW5jKHJlbW90ZSkpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIFByb21pc2UuYWxsKHN5bmNoaW5nKS50aGVuKChkYXRhT2JqcykgPT4geyovXHJcblxyXG4gICAgICAgICAgbGV0IGRhdGFPYmpzID0gcmVtb3RlcztcclxuXHJcbiAgICAgICAgICBpZiAoZGF0YU9ianMubGVuZ3RoID09PSAwKSByZXNvbHZlKCk7XHJcblxyXG4gICAgICAgICAgZGF0YU9ianMuZm9yRWFjaCgoZE8pID0+IHtcclxuXHJcbiAgICAgICAgICAgIGxldCBkYXRhT2JqID0gX3RoaXMuX3JlbW90ZURvYzJkYXRhT2JqZWN0KGRPKTtcclxuICAgICAgICAgICAgLy8gICAgICAgICAgICAgIE9iamVjdC5rZXlzKGRPKS5mb3JFYWNoKChpKSA9PiB7XHJcblxyXG4gICAgICAgICAgICBsb2cubG9nKCdbU3RvcmVEYXRhT2JqZWN0cy5sb2FkUmVtb3RlXSBsb2FkZWQgcmVtb3RlICcsIGRhdGFPYmopO1xyXG4gICAgICAgICAgICAvLyAgICAgICAgICAgICAgaWYgKGRPW3JlbW90ZV0uaXNSZXBvcnRlcikge1xyXG4gICAgICAgICAgICBsZXQgdHlwZSA9IHRoaXMuX2dldFR5cGVPZk9iamVjdChkYXRhT2JqLmlzUmVwb3J0ZXIpO1xyXG5cclxuICAgICAgICAgICAgaWYgKCFfdGhpcy5fc3RvcmVEYXRhT2JqZWN0KSBfdGhpcy5fc3RvcmVEYXRhT2JqZWN0ID0ge307XHJcblxyXG4gICAgICAgICAgICBpZiAoIV90aGlzLl9zdG9yZURhdGFPYmplY3QuaGFzT3duUHJvcGVydHkodHlwZSkpIF90aGlzLl9zdG9yZURhdGFPYmplY3RbdHlwZV0gPSB7fTtcclxuXHJcbiAgICAgICAgICAgIF90aGlzLl9zdG9yZURhdGFPYmplY3RbdHlwZV1bZGF0YU9iai51cmxdID0gZGF0YU9iajtcclxuXHJcbiAgICAgICAgICAgIC8vICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAvLyAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICByZXNvbHZlKF90aGlzLl9zdG9yZURhdGFPYmplY3QpO1xyXG5cclxuICAgICAgICAgIH0sIChlcnJvcikgPT4geyByZWplY3QoZXJyb3IpIH0pO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICB9LCAoZXJyb3IpID0+IHtcclxuICAgICAgICByZWplY3QoZXJyb3IpO1xyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIHJlc29sdmUoKTtcclxuXHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8vIGRlbGV0ZSBEYXRhIE9iamVjdHMgc3luY2hlZCB3aXRoIHJlbW90ZSBTdG9yYWdlc1xyXG5cclxuICBkZWxldGVSZW1vdGVzKCkge1xyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XHJcbiAgICAgIGxldCBkZWxldGluZyA9IFtdO1xyXG4gICAgICBsZXQgZGlzY29ubmVjdGluZyA9IFtdO1xyXG5cclxuICAgICAgX3RoaXMuX3N0b3JhZ2VNYW5hZ2VyLmdldChudWxsLCBudWxsLCAncmVtb3RlcycpLnRoZW4oKHJlbW90ZXMpID0+IHtcclxuXHJcbiAgICAgICAgLy8gaW4gY2FzZSB3ZSBkb24ndCBoYXZlIGFueSByZW1vdGVzIGxvY2FsbHkgc3RvcmVkXHJcbiAgICAgICAgbG9nLmluZm8oJ1tTdG9yZURhdGFPYmplY3RzLmRlbGV0ZVJlbW90ZXNdIHJlbW90ZXM6ICcsIHJlbW90ZXMpO1xyXG4gICAgICAgIGlmICghcmVtb3RlcykgcmVzb2x2ZSgpO1xyXG5cclxuICAgICAgICBsZXQgcmVtb3RlT2JqZWN0cyA9IE9iamVjdC5rZXlzKF90aGlzLl9yZW1vdGVzKTtcclxuXHJcbiAgICAgICAgLy8gaW4gY2FzZSB3ZSBkb24ndCBoYXZlIGFueSByZW1vdGVzIGxvY2FsbHkgc3RvcmVkXHJcblxyXG4gICAgICAgIGlmIChyZW1vdGVPYmplY3RzLmxlbmd0aCA9PT0gMCkgcmVzb2x2ZSgpO1xyXG5cclxuICAgICAgICByZW1vdGVPYmplY3RzLmZvckVhY2goKGRiKSA9PiB7XHJcbiAgICAgICAgICBkZWxldGluZy5wdXNoKFxyXG4gICAgICAgICAgICBfdGhpcy5fcmVtb3Rlc1tkYl0uZGlzY29ubmVjdCgpXHJcbiAgICAgICAgICApO1xyXG4gICAgICAgICAgZGVsZXRpbmcucHVzaChcclxuICAgICAgICAgICAgX3RoaXMuX3JlbW90ZXNbZGJdLmRlbGV0ZSgpXHJcbiAgICAgICAgICApO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBQcm9taXNlLmFsbChkZWxldGluZykudGhlbigoKSA9PiB7XHJcbiAgICAgICAgICBsb2cubG9nKCdbU3RvcmVEYXRhT2JqZWN0cy5kZWxldGVSZW1vdGVzXSBkZWxldGVkLicpO1xyXG5cclxuICAgICAgICAgIHJlc29sdmUoKTtcclxuXHJcbiAgICAgICAgfSwgKGVycm9yKSA9PiB7IHJlc29sdmUoKTsgfSk7XHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgcmVzb2x2ZSgpO1xyXG5cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQGRlc2NyaXB0aW9uIHNob3VsZCBzZXQgdGhlIGluaXRpYWwgc3RhdGUgb2YgdGhlIGRhdGFPYmplY3RVUkwgdG8gYmUgcmVzdW1lZCBpZiBuZWNlc3Nhcnk7XHJcbiAgICpcclxuICAgKiBAcGFyYW0ge0RhdGFPYmplY3RVUkx9IHVybCAtIGRhdGFPYmplY3RVUkwgdG8gYmUgc2F2ZWQ7XHJcbiAgICogQHBhcmFtIHtCb29sZWFufSBpc1JlcG9ydGVyIC0gdGhlIG9iamVjdCB0byBiZSBzYXZlZCBpcyBhIHJlcG9ydGVyXHJcbiAgICogQHBhcmFtIHtTY2hlbWFVUkx9IHNjaGVtYSAtIHRoZSBzY2hlbWEgdXJsXHJcbiAgICogQHBhcmFtIHtTdHJpbmd9IHN0YXR1cyAtIHRoZSBzdGF0dXMgb2YgY3VycmVudCBkYXRhT2JqZWN0XHJcbiAgICogQHBhcmFtIHtIeXBlcnR5VVJMfSByZXBvcnRlciAtIHRoZSBSZXBvcnRlciBoeXBlcnR5VVJMXHJcbiAgICogQHBhcmFtIHtBcnJheTxIeXBlcnR5VVJMPn0gc3Vic2NyaXB0aW9uIC0gbGlzdCBvZiBzdWJzY3JpcHRpb25zXHJcbiAgICogQHBhcmFtIHtBcnJheTxEYXRhT2JqZWN0Q2hpbGQ+fSBjaGlsZHJlbiAtIGxpc3Qgb2YgY2hpbGRzIG9mIGRhdGFPYmplY3RVUkxcclxuICAgKiBAcGFyYW0ge0FycmF5PFN0cmluZz59IGNoaWxkcmVucyAtIGxpc3Qgb2YgY2hpbGRyZW5zLCBsaWtlLCAnY2hhdG1lc3NhZ2UnO1xyXG4gICAqIEBwYXJhbSB7QXJyYXk8VXNlclVSTH0gc3Vic2NyaWJlclVzZXIgLSBsaXN0IG9mIHN1YnNjcmliZWQgdXNlcnM7XHJcbiAgICovXHJcblxyXG4gIHNldChtZXRhZGF0YSkge1xyXG5cclxuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XHJcbiAgICAgIGxldCBzdG9yZURhdGFPYmplY3QgPSB0aGlzLl9zdG9yZURhdGFPYmplY3QgPyB0aGlzLl9zdG9yZURhdGFPYmplY3QgOiB7fTtcclxuICAgICAgbGV0IHR5cGUgPSB0aGlzLl9nZXRUeXBlT2ZPYmplY3QobWV0YWRhdGEuaXNSZXBvcnRlcik7XHJcblxyXG5cclxuICAgICAgaWYgKCFzdG9yZURhdGFPYmplY3QuaGFzT3duUHJvcGVydHkodHlwZSkpIHN0b3JlRGF0YU9iamVjdFt0eXBlXSA9IHt9O1xyXG5cclxuICAgICAgaWYgKCFzdG9yZURhdGFPYmplY3RbdHlwZV0uaGFzT3duUHJvcGVydHkobWV0YWRhdGEudXJsKSkge1xyXG4gICAgICAgIHN0b3JlRGF0YU9iamVjdFt0eXBlXVttZXRhZGF0YS51cmxdID0ge307XHJcbiAgICAgICAgc3RvcmVEYXRhT2JqZWN0W3R5cGVdW21ldGFkYXRhLnVybF0uc3Vic2NyaXB0aW9ucyA9IFtdOy8vIFRPRE86ZG8gd2UgbmVlZCB0aGlzP1xyXG4gICAgICAgIHN0b3JlRGF0YU9iamVjdFt0eXBlXVttZXRhZGF0YS51cmxdLnN1YnNjcmliZXJVc2VycyA9IFtdOy8vIFRPRE86ZG8gd2UgbmVlZCB0aGlzP1xyXG4gICAgICAgIHN0b3JlRGF0YU9iamVjdFt0eXBlXVttZXRhZGF0YS51cmxdLmNoaWxkcmVuT2JqZWN0cyA9IHt9O1xyXG4gICAgICAgIHN0b3JlRGF0YU9iamVjdFt0eXBlXVttZXRhZGF0YS51cmxdLmRhdGEgPSB7fTtcclxuICAgICAgfVxyXG5cclxuICAgICAgT2JqZWN0LmFzc2lnbihzdG9yZURhdGFPYmplY3RbdHlwZV1bbWV0YWRhdGEudXJsXSwgbWV0YWRhdGEpO1xyXG4gICAgICBkZWxldGUgc3RvcmVEYXRhT2JqZWN0W3R5cGVdW21ldGFkYXRhLnVybF0uc3Vic2NyaWJlclVzZXI7XHJcbiAgICAgIGRlbGV0ZSBzdG9yZURhdGFPYmplY3RbdHlwZV1bbWV0YWRhdGEudXJsXS5zdWJzY3JpYmVySHlwZXJ0eTtcclxuXHJcbiAgICAgIHN0b3JlRGF0YU9iamVjdFt0eXBlXVttZXRhZGF0YS51cmxdLmJhY2t1cCA9IG1ldGFkYXRhLmhhc093blByb3BlcnR5KCdiYWNrdXAnKSA/IG1ldGFkYXRhLmJhY2t1cCA6IGZhbHNlO1xyXG5cclxuICAgICAgLyppZiAoc2NoZW1hKSBzdG9yZURhdGFPYmplY3RbdHlwZV1bbWV0YWRhdGEudXJsXS5zY2hlbWEgPSBzY2hlbWE7XHJcbiAgICAgIGlmIChzdGF0dXMpIHN0b3JlRGF0YU9iamVjdFt0eXBlXVttZXRhZGF0YS51cmxdLnN0YXR1cyA9IHN0YXR1cztcclxuICAgICAgaWYgKGNoaWxkcmVuUmVzb3VyY2VzKSBzdG9yZURhdGFPYmplY3RbdHlwZV1bbWV0YWRhdGEudXJsXS5jaGlsZHJlblJlc291cmNlcyA9IGNoaWxkcmVuUmVzb3VyY2VzOyovXHJcblxyXG4gICAgICBpZiAobWV0YWRhdGEuc3Vic2NyaWJlckh5cGVydHkgJiYgIW1ldGFkYXRhLmlzUmVwb3J0ZXIpIHsgLy8gVE9ETzogZG8gd2UgbmVlZCB0aGlzP1xyXG4gICAgICAgIHRoaXMuX3VwZGF0ZVRvQXJyYXkoc3RvcmVEYXRhT2JqZWN0W3R5cGVdLCBtZXRhZGF0YS51cmwsICdzdWJzY3JpcHRpb25zJywgbWV0YWRhdGEuc3Vic2NyaWJlckh5cGVydHkpO1xyXG4gICAgICB9XHJcblxyXG4gICAgICAvL3N0b3JlRGF0YU9iamVjdFt0eXBlXVttZXRhZGF0YS51cmxdLm93bmVyID0gb3duZXI7XHJcblxyXG4gICAgICBpZiAobWV0YWRhdGEuc3Vic2NyaWJlclVzZXIpIHsgLy8gVE9ETzogZG8gd2UgbmVlZCB0aGlzP1xyXG4gICAgICAgIGlmIChzdG9yZURhdGFPYmplY3RbdHlwZV1bbWV0YWRhdGEudXJsXS5zdWJzY3JpYmVyVXNlcnMuaW5kZXhPZihtZXRhZGF0YS5zdWJzY3JpYmVyVXNlcikpIHtcclxuICAgICAgICAgIHRoaXMuX3VwZGF0ZVRvQXJyYXkoc3RvcmVEYXRhT2JqZWN0W3R5cGVdLCBtZXRhZGF0YS51cmwsICdzdWJzY3JpYmVyVXNlcnMnLCBtZXRhZGF0YS5zdWJzY3JpYmVyVXNlcik7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcblxyXG4gICAgICB0aGlzLl9zdG9yZURhdGFPYmplY3QgPSBzdG9yZURhdGFPYmplY3Q7XHJcblxyXG4gICAgICBsZXQgYmFja3VwID0gbWV0YWRhdGEuaGFzT3duUHJvcGVydHkoJ2JhY2t1cCcpID8gbWV0YWRhdGEuYmFja3VwIDogZmFsc2U7XHJcbiAgICAgIGxldCB0YWJsZSA9IGJhY2t1cCA/IG1ldGFkYXRhLnVybCA6IHRoaXMuX3RhYmxlO1xyXG4gICAgICAvLyAgICAgIGxldCBkYiA9IGJhY2t1cCA/IHRhYmxlLnNwbGl0KCc6Ly8nKVsxXSA6IHRoaXMuX3RhYmxlO1xyXG4gICAgICBsZXQgZGIgPSBiYWNrdXAgPyAnZG8tJyArIHRhYmxlLnNwbGl0KCcvJylbM10gOiB0aGlzLl90YWJsZTtcclxuICAgICAgaWYgKGJhY2t1cCAmJiAhdGhpcy5fcmVtb3Rlc1ttZXRhZGF0YS51cmxdKSB7XHJcbiAgICAgICAgbGV0IHNjaGVtYSA9IHt9O1xyXG4gICAgICAgIHNjaGVtYVt0YWJsZV0gPSB0aGlzLl9yZW1vdGVTY2hlbWE7XHJcbiAgICAgICAgdGhpcy5fcmVtb3Rlc1ttZXRhZGF0YS51cmxdID0gY3JlYXRlU3luY0RCKGRiLCB0aGlzLl9mYWN0b3J5KTtcclxuICAgICAgfVxyXG5cclxuICAgICAgLy8gU2F2ZSBEYXRhIE9iamVjdCBVUkwgYXQgcmVtb3RlcyB0YWJsZSB0byBzdXBwb3J0IHJlc3VtZXNcclxuXHJcbiAgICAgIGlmIChiYWNrdXApIHRoaXMuX3N0b3JhZ2VNYW5hZ2VyLnNldCh0YWJsZSwgMCwgZGIsICdyZW1vdGVzJyk7XHJcblxyXG4gICAgICBsZXQgc3RvcmFnZSA9IGJhY2t1cCA/IHRoaXMuX3JlbW90ZXNbdGFibGVdIDogdGhpcy5fc3RvcmFnZU1hbmFnZXI7XHJcblxyXG4gICAgICBpZiAoYmFja3VwKSB7XHJcbiAgICAgICAgLy8gbGV0cyBjb25uZWN0IHRvIHJlbW90ZSBzdG9yYWdlIHRvIGVuYWJsZSBzeW5jXHJcbiAgICAgICAgc3RvcmFnZS5zZXQodGFibGUsIHN0b3JlRGF0YU9iamVjdFt0eXBlXVttZXRhZGF0YS51cmxdKS50aGVuKCgpID0+IHtcclxuICAgICAgICAgIGlmIChtZXRhZGF0YS5pc1JlcG9ydGVyKSBzdG9yYWdlLmNvbm5lY3QoKTtcclxuICAgICAgICAgIHJlc29sdmUoc3RvcmVEYXRhT2JqZWN0W3R5cGVdW21ldGFkYXRhLnVybF0pO1xyXG4gICAgICAgIH0sIChlcnJvcikgPT4ge1xyXG4gICAgICAgICAgbG9nLmVycm9yKCdbRGF0YU9iamVjdFN0b3JhZ2Uuc2V0XSBmYWlsZWQgdG8gc2F2ZSBpbnRvIHJlbW90ZSBzdG9yYWdlOiAnLCBlcnJvcik7XHJcbiAgICAgICAgICByZWplY3QoZXJyb3IpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGNvbnNvbGUubG9nKCdbRGF0YU9iamVjdFN0b3JhZ2Uuc2V0XSBfc3RvcmVEYXRhT2JqZWN0IGJlZm9yZSBmaWx0ZXIgJywgdGhpcy5fc3RvcmVEYXRhT2JqZWN0KTtcclxuICAgICAgICBzdG9yYWdlLnNldChkYiwgMSwgdGhpcy5fZmlsdGVyUmVtb3Rlcyh0aGlzLl9zdG9yZURhdGFPYmplY3QpLCB0YWJsZSkudGhlbigoKSA9PiB7XHJcbiAgICAgICAgICByZXNvbHZlKHN0b3JlRGF0YU9iamVjdFt0eXBlXVttZXRhZGF0YS51cmxdKTtcclxuICAgICAgICB9KTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuXHJcbiAgLy8gdG8gZmlsdGVyIERhdGEgT2JqZWN0cyB0aGF0IGFyZSBzdG9yZWQgb3V0c2lkZSB0aGUgT2JqZWN0VVJMcyB0YWJsZVxyXG5cclxuICBfZmlsdGVyUmVtb3RlcyhzdG9yZURhdGFPYmplY3QpIHtcclxuICAgIGxldCByZW1vdGVzID0gT2JqZWN0LmtleXModGhpcy5fcmVtb3Rlcyk7XHJcblxyXG4gICAgbGV0IGZpbHRlcmVkID0gZGVlcENsb25lKHN0b3JlRGF0YU9iamVjdCk7XHJcblxyXG4gICAgY29uc29sZS5sb2coJ1tEYXRhT2JqZWN0U3RvcmFnZS5fZmlsdGVyUmVtb3Rlc10gc3RhcnRpbmcgZmlsdGVyaW5nICcsIGZpbHRlcmVkKTtcclxuXHJcbiAgICByZW1vdGVzLmZvckVhY2goKHJlbW90ZSkgPT4ge1xyXG4gICAgICBpZiAoZmlsdGVyZWRbJ3JlcG9ydGVycyddICYmIGZpbHRlcmVkWydyZXBvcnRlcnMnXVtyZW1vdGVdKSB7XHJcbiAgICAgICAgZGVsZXRlIGZpbHRlcmVkWydyZXBvcnRlcnMnXVtyZW1vdGVdO1xyXG4gICAgICAgIGNvbnNvbGUubG9nKCdbRGF0YU9iamVjdFN0b3JhZ2UuX2ZpbHRlclJlbW90ZXNdIGZpbHRlciB1cGRhdGVkICcsIGZpbHRlcmVkKTtcclxuICAgICAgfVxyXG4gICAgICBlbHNlIGRlbGV0ZSBmaWx0ZXJlZFsnb2JzZXJ2ZXJzJ11bcmVtb3RlXTtcclxuICAgIH0pO1xyXG5cclxuICAgIGNvbnNvbGUubG9nKCdbRGF0YU9iamVjdFN0b3JhZ2UuX2ZpbHRlclJlbW90ZXNdICcsIGZpbHRlcmVkKTtcclxuXHJcbiAgICByZXR1cm4gZmlsdGVyZWQ7XHJcbiAgfVxyXG5cclxuICAvLyBJbml0aWFsIFN5bmMgb2YgT2JzZXJ2ZXIgdG8gYXZvaWQgbGF0ZXIgbWlzbWF0Y2hlcyB3aXRoIHN5bmMgcmV2aXNpb25zXHJcbiAgLy8gT1V0ZGF0ZWQ6IG5vdCB1c2VkIGFueW1vcmVcclxuICAvKlxyXG4gICAgaW5pdGlhbE9ic2VydmVyU3luYyhyZXNvdXJjZSwgYmFja3VwUmV2aXNpb24pIHtcclxuICAgICAgLy8gdG8gYmUgY29tcGxldGVkXHJcbiAgICAgIGxldCB0YWJsZSA9IHJlc291cmNlLnNwbGl0KCcvJylbM107XHJcbiAgXHJcbiAgICAgIGxldCBfdGhpcyA9IHRoaXM7XHJcbiAgXHJcbiAgICAgIGxldCBvcHRpb25zID0ge3RhYmxlOiB0YWJsZSwgb2JzZXJ2ZXI6IHRydWUsIGJhc2VSZXZpc2lvbjogYmFja3VwUmV2aXNpb24sIHN5bmNlZFJldmlzaW9uOiBiYWNrdXBSZXZpc2lvbn07XHJcbiAgXHJcbiAgICAgIGNvbnNvbGUubG9nKCdbRGF0YU9iamVjdFN0b3JhZ2UuaW5pdGlhbE9ic2VydmVyU3luY10gb2JqZWN0OiAnLCByZXNvdXJjZSwgJyByZXZpc2lvbiAnLCBiYWNrdXBSZXZpc2lvbilcclxuICBcclxuICAgICAgX3RoaXMuX3JlbW90ZXNbcmVzb3VyY2Vdb3B0aW9ucykudGhlbigoKT0+IHtcclxuICBcclxuICAgICAgICBjb25zb2xlLmxvZygnW0RhdGFPYmplY3RTdG9yYWdlLmluaXRpYWxPYnNlcnZlclN5bmNdIGNvbm5lY3RlZCAnKTtcclxuICBcclxuICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgX3RoaXMuX3JlbW90ZXNbcmVzb3VyY2VdLmRpc2Nvbm5lY3QoKS50aGVuKCgpPT57XHJcbiAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdbRGF0YU9iamVjdFN0b3JhZ2UuaW5pdGlhbE9ic2VydmVyU3luY10gZGlzY29ubmVjdGVkICcpO1xyXG4gICAgICAgICAgICAgIH0sKGVycm9yKT0+IHtcclxuICAgICAgICAgICAgICAgIGxvZy5lcnJvcignW0RhdGFPYmplY3RTdG9yYWdlLmluaXRpYWxPYnNlcnZlclN5bmNdIEVycm9yIGRpc2Nvbm5lY3Rpbmcgd2l0aCByZW1vdGUgc3RvcmFnZScpO1xyXG4gICAgICAgICAgICAgICAgcmVqZWN0KGVycm9yKTtcclxuICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICB9LCAxNTAwMClcclxuICBcclxuICAgICAgfSwgKGVycm9yKSA9PiB7XHJcbiAgICAgICAgbG9nLmVycm9yKCdbRGF0YU9iamVjdFN0b3JhZ2UuaW5pdGlhbE9ic2VydmVyU3luY10gRXJyb3IgY29ubmVjdGluZyB0byByZW1vdGUgc3RvcmFnZScpO1xyXG4gICAgICAgIHJlamVjdChlcnJvcilcclxuICAgICAgfSk7XHJcbiAgXHJcbiAgICB9Ki9cclxuXHJcbiAgLyoqXHJcbiAgICogQGRlc2NyaXB0aW9uIHNob3VsZCBzYXZlIGFuZCB1cGRhdGUgdGhlIGN1cnJlbnQgZGF0YU9iamVjdCBkYXRhIGluZm9ybWF0aW9uXHJcbiAgICpcclxuICAgKiBAcGFyYW0ge0Jvb2xlYW59IGlzUmVwb3J0ZXIgLSB0aGUgb2JqZWN0IHRvIGJlIHNhdmVkIGlzIGEgcmVwb3J0ZXJcclxuICAgKiBAcGFyYW0ge0RhdGFPYmplY3RVUkx9IHJlc291cmNlIC0gZGF0YU9iamVjdFVSTCB0byBiZSBzYXZlZCBvciB1cGRhdGVkO1xyXG4gICAqIEBwYXJhbSB7U3RyaW5nfSBhdHRyaWJ1dGUgLSBhdHRyaWJ1dGUgaW5zaWRlIHRoZSBkYXRhIHdoaWNoIHdpbGwgYmUgc2F2ZWRcclxuICAgKiBAcGFyYW0ge2FueX0gZGF0YSAtIHZhbHVlIHdpbGwgYmUgc2F2ZWQgaW5zaWRlIHRoZSBhdHRyaWJ1dGU7XHJcbiAgICovXHJcbiAgc2F2ZURhdGEoaXNSZXBvcnRlciwgcmVzb3VyY2UsIGF0dHJpYnV0ZSwgdmFsdWUsIHVwZGF0ZVJ1bnRpbWVTdGF0dXMpIHtcclxuXHJcbiAgICBsZXQgc3RvcmVEYXRhT2JqZWN0ID0gdGhpcy5fc3RvcmVEYXRhT2JqZWN0O1xyXG4gICAgbGV0IHR5cGUgPSB0aGlzLl9nZXRUeXBlT2ZPYmplY3QoaXNSZXBvcnRlcik7XHJcblxyXG4gICAgaWYgKCFzdG9yZURhdGFPYmplY3QgfHwgIXN0b3JlRGF0YU9iamVjdFt0eXBlXSB8fCAhc3RvcmVEYXRhT2JqZWN0W3R5cGVdW3Jlc291cmNlXSkge1xyXG4gICAgICBsb2cubG9nKCdbU3RvcmVEYXRhT2JqZWN0cyAtIHNhdmUgZGF0YV0gLSBub3Qgc2F2ZWQnKTtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG5cclxuICAgIGxvZy5sb2coJ1tTdG9yZURhdGFPYmplY3RzIC0gc2F2ZURhdGFdIC0gJywgaXNSZXBvcnRlciwgdHlwZSwgcmVzb3VyY2UsIGF0dHJpYnV0ZSwgdmFsdWUpO1xyXG5cclxuICAgIGlmICghc3RvcmVEYXRhT2JqZWN0W3R5cGVdW3Jlc291cmNlXS5oYXNPd25Qcm9wZXJ0eSgnZGF0YScpKSB7XHJcbiAgICAgIHN0b3JlRGF0YU9iamVjdFt0eXBlXVtyZXNvdXJjZV0uZGF0YSA9IHt9O1xyXG4gICAgfVxyXG5cclxuICAgIGlmIChhdHRyaWJ1dGUpIHtcclxuICAgICAgbGV0IGRhdGE7XHJcbiAgICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICdvYmplY3QnKSBkYXRhID0gZGVlcENsb25lKHZhbHVlKTtcclxuICAgICAgZWxzZSBkYXRhID0gdmFsdWU7XHJcblxyXG4gICAgICBhc3NpZ24oc3RvcmVEYXRhT2JqZWN0W3R5cGVdW3Jlc291cmNlXS5kYXRhLCBhdHRyaWJ1dGUsIGRhdGEpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgc3RvcmVEYXRhT2JqZWN0W3R5cGVdW3Jlc291cmNlXS5kYXRhID0gZGVlcENsb25lKHZhbHVlKSB8fCB7fTtcclxuICAgIH1cclxuXHJcbiAgICB0aGlzLl9zdG9yZURhdGFPYmplY3QgPSBzdG9yZURhdGFPYmplY3Q7XHJcbiAgICBsZXQgZGIgPSBzdG9yZURhdGFPYmplY3RbdHlwZV1bcmVzb3VyY2VdLmJhY2t1cCA/IHN0b3JlRGF0YU9iamVjdFt0eXBlXVtyZXNvdXJjZV0udXJsIDogJ3N5bmNoZXJNYW5hZ2VyOk9iamVjdFVSTHMnO1xyXG4gICAgbGV0IHN0b3JhZ2UgPSBzdG9yZURhdGFPYmplY3RbdHlwZV1bcmVzb3VyY2VdLmJhY2t1cCA/IHRoaXMuX3JlbW90ZXNbZGJdIDogdGhpcy5fc3RvcmFnZU1hbmFnZXI7XHJcbiAgICAvLyAgICBsZXQgdGFibGUgPSBzdG9yZURhdGFPYmplY3RbdHlwZV1bcmVzb3VyY2VdLmJhY2t1cCA/IGRiLnNwbGl0KCcvJylbM10gOiB0aGlzLl90YWJsZTtcclxuXHJcbiAgICBpZiAoc3RvcmVEYXRhT2JqZWN0W3R5cGVdW3Jlc291cmNlXS5iYWNrdXApIHsvLyBzaG91bGQgd2UgcmVtb3ZlIGNoaWxkcmVucz9cclxuICAgICAgcmV0dXJuIHN0b3JhZ2Uuc2V0KGRiLCBzdG9yZURhdGFPYmplY3RbdHlwZV1bcmVzb3VyY2VdKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHJldHVybiBzdG9yYWdlLnNldCgnc3luY2hlck1hbmFnZXI6T2JqZWN0VVJMcycsIDEsIHRoaXMuX2ZpbHRlclJlbW90ZXMoc3RvcmVEYXRhT2JqZWN0KSwgdGhpcy5fdGFibGUsIHVwZGF0ZVJ1bnRpbWVTdGF0dXMpO1xyXG4gICAgfVxyXG5cclxuICB9XHJcblxyXG4gIHNhdmVDaGlsZHJlbnMoaXNSZXBvcnRlciwgcmVzb3VyY2UsIGF0dHJpYnV0ZSwgdmFsdWUpIHtcclxuICAgIGxldCBzdG9yZURhdGFPYmplY3QgPSB0aGlzLl9zdG9yZURhdGFPYmplY3Q7XHJcbiAgICBsZXQgdHlwZSA9IHRoaXMuX2dldFR5cGVPZk9iamVjdChpc1JlcG9ydGVyKTtcclxuXHJcbiAgICBpZiAoIXN0b3JlRGF0YU9iamVjdCB8fCAhc3RvcmVEYXRhT2JqZWN0W3R5cGVdIHx8ICFzdG9yZURhdGFPYmplY3RbdHlwZV1bcmVzb3VyY2VdKSB7XHJcbiAgICAgIGxvZy5sb2coJ1tTdG9yZURhdGFPYmplY3RzIC0gc2F2ZSBjaGlsZHJlbnNdIC0gbm90IHNhdmVkJyk7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuXHJcbiAgICBpZiAoIXN0b3JlRGF0YU9iamVjdFt0eXBlXVtyZXNvdXJjZV0uaGFzT3duUHJvcGVydHkoJ2NoaWxkcmVucycpKSB7XHJcbiAgICAgIHN0b3JlRGF0YU9iamVjdFt0eXBlXVtyZXNvdXJjZV0uY2hpbGRyZW5PYmplY3RzID0ge307XHJcbiAgICB9XHJcblxyXG4gICAgLyogICAgaWYgKCFzdG9yZURhdGFPYmplY3RbdHlwZV1bcmVzb3VyY2VdLmNoaWxkcmVuT2JqZWN0cy5oYXNPd25Qcm9wZXJ0eSgncmVzb3VyY2VzJykpIHtcclxuICAgICAgICAgIHN0b3JlRGF0YU9iamVjdFt0eXBlXVtyZXNvdXJjZV0uY2hpbGRyZW5PYmplY3RzLnJlc291cmNlcyA9IHt9O1xyXG4gICAgICAgIH0qL1xyXG5cclxuICAgIGlmIChhdHRyaWJ1dGUpIHtcclxuICAgICAgYXNzaWduKHN0b3JlRGF0YU9iamVjdFt0eXBlXVtyZXNvdXJjZV0uY2hpbGRyZW5PYmplY3RzLCBhdHRyaWJ1dGUsIGRlZXBDbG9uZSh2YWx1ZSkpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgc3RvcmVEYXRhT2JqZWN0W3R5cGVdW3Jlc291cmNlXS5jaGlsZHJlbk9iamVjdHMgPSBkZWVwQ2xvbmUodmFsdWUpIHx8IHt9O1xyXG4gICAgfVxyXG5cclxuICAgIHRoaXMuX3N0b3JlRGF0YU9iamVjdCA9IHN0b3JlRGF0YU9iamVjdDtcclxuICAgIGxldCBkYiA9IHN0b3JlRGF0YU9iamVjdFt0eXBlXVtyZXNvdXJjZV0uYmFja3VwID8gc3RvcmVEYXRhT2JqZWN0W3R5cGVdW3Jlc291cmNlXS51cmwgOiAnc3luY2hlck1hbmFnZXI6T2JqZWN0VVJMcyc7XHJcbiAgICBsZXQgc3RvcmFnZSA9IHN0b3JlRGF0YU9iamVjdFt0eXBlXVtyZXNvdXJjZV0uYmFja3VwID8gdGhpcy5fcmVtb3Rlc1tkYl0gOiB0aGlzLl9zdG9yYWdlTWFuYWdlcjtcclxuICAgIC8qICAgbGV0IHRhYmxlID0gc3RvcmVEYXRhT2JqZWN0W3R5cGVdW3Jlc291cmNlXS5iYWNrdXAgPyBkYi5zcGxpdCgnLycpWzNdIDogdGhpcy5fdGFibGU7XHJcbiAgICAgICBsZXQgZGF0YSA9IHN0b3JlRGF0YU9iamVjdFt0eXBlXVtyZXNvdXJjZV0uYmFja3VwID8gc3RvcmVEYXRhT2JqZWN0W3R5cGVdW3Jlc291cmNlXSA6IHRoaXMuX2ZpbHRlclJlbW90ZXMoc3RvcmVEYXRhT2JqZWN0KTtcclxuICAgICAgIHN0b3JhZ2Uuc2V0KGRiLCAxLCBkYXRhLCB0YWJsZSkudGhlbigoKSA9PiB7XHJcbiAgICAgICAgIHJldHVybiBzdG9yZURhdGFPYmplY3RbdHlwZV1bcmVzb3VyY2VdO1xyXG4gICAgICAgfSk7Ki9cclxuXHJcbiAgICBpZiAoc3RvcmVEYXRhT2JqZWN0W3R5cGVdW3Jlc291cmNlXS5iYWNrdXApIHtcclxuXHJcbiAgICAgIHJldHVybiBzdG9yYWdlLnNldChhdHRyaWJ1dGUsIHZhbHVlKS50aGVuKCgpID0+IHtcclxuICAgICAgICAvLyBiYWNrdXAgY2hpbGQgb2JqZWN0IGlmIHJlcG9ydGVyIGlzIGxvY2FsXHJcbiAgICAgICAgaWYgKHRoaXMuX3J1bnRpbWVVcmwgPT09IHZhbHVlLnZhbHVlLnJ1bnRpbWUpXHJcbiAgICAgICAgICBzdG9yYWdlLmJhY2t1cChhdHRyaWJ1dGUpO1xyXG5cclxuICAgICAgfSk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICByZXR1cm4gc3RvcmFnZS5zZXQoJ3N5bmNoZXJNYW5hZ2VyOk9iamVjdFVSTHMnLCAxLCB0aGlzLl9maWx0ZXJSZW1vdGVzKHN0b3JlRGF0YU9iamVjdCksIHRoaXMuX3RhYmxlLCB1cGRhdGVSdW50aW1lU3RhdHVzKTtcclxuICAgIH1cclxuXHJcblxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQGRlc2NyaXB0aW9uIHNob3VsZCBzYXZlIGFuZCB1cGRhdGUgdGhlIGN1cnJlbnQgZGF0YU9iamVjdCBpbmZvcm1hdGlvblxyXG4gICAqXHJcbiAgICogQHBhcmFtIHtCb29sZWFufSBpc1JlcG9ydGVyIC0gdGhlIG9iamVjdCB0byBiZSBzYXZlZCBpcyBhIHJlcG9ydGVyXHJcbiAgICogQHBhcmFtIHtEYXRhT2JqZWN0VVJMfSByZXNvdXJjZSAtIGRhdGFPYmplY3RVUkwgdG8gYmUgc2F2ZWQgb3IgdXBkYXRlZDtcclxuICAgKiBAcGFyYW0ge1N0cmluZ30gYXR0cmlidXRlIC0gYXR0cmlidXRlIGluc2lkZSB0aGUgZGF0YSB3aGljaCB3aWxsIGJlIHNhdmVkXHJcbiAgICogQHBhcmFtIHthbnl9IGRhdGEgLSB2YWx1ZSB3aWxsIGJlIHNhdmVkIGluc2lkZSB0aGUgYXR0cmlidXRlO1xyXG4gICAqL1xyXG4gIHVwZGF0ZShpc1JlcG9ydGVyLCByZXNvdXJjZSwgYXR0cmlidXRlLCB2YWx1ZSwgdXBkYXRlUnVudGltZVN0YXR1cykge1xyXG5cclxuICAgIGxldCBzdG9yZURhdGFPYmplY3QgPSB0aGlzLl9zdG9yZURhdGFPYmplY3Q7XHJcbiAgICBsZXQgdHlwZSA9IHRoaXMuX2dldFR5cGVPZk9iamVjdChpc1JlcG9ydGVyKTtcclxuXHJcbiAgICBpZiAoIXN0b3JlRGF0YU9iamVjdCB8fCAhc3RvcmVEYXRhT2JqZWN0W3R5cGVdIHx8ICFzdG9yZURhdGFPYmplY3RbdHlwZV1bcmVzb3VyY2VdKSB7XHJcbiAgICAgIGxvZy5sb2coJ1tTdG9yZURhdGFPYmplY3RzIC0gdXBkYXRlXSAtIG5vdCBzYXZlZCcpO1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcblxyXG4gICAgbG9nLmxvZygnW1N0b3JlRGF0YU9iamVjdHMgLSB1cGRhdGVdIC0gJywgaXNSZXBvcnRlciwgdHlwZSwgcmVzb3VyY2UsIGF0dHJpYnV0ZSwgdmFsdWUpO1xyXG5cclxuICAgIGlmIChzdG9yZURhdGFPYmplY3RbdHlwZV0gJiYgc3RvcmVEYXRhT2JqZWN0W3R5cGVdW3Jlc291cmNlXSAmJiByZXNvdXJjZSAmJiBhdHRyaWJ1dGUgJiYgdmFsdWUpIHtcclxuXHJcbiAgICAgIGlmIChhdHRyaWJ1dGUgPT09ICdzdWJzY3JpcHRpb25zJyB8fCBhdHRyaWJ1dGUgPT09ICdzdWJzY3JpYmVyVXNlcnMnKSB7XHJcbiAgICAgICAgbGV0IHVwZGF0ZSA9IHRydWU7XHJcblxyXG4gICAgICAgIGlmIChhdHRyaWJ1dGUgPT09ICdzdWJzY3JpcHRpb25zJykge1xyXG4gICAgICAgICAgdXBkYXRlID0gIXRoaXMuX2lzT3duZXIoc3RvcmVEYXRhT2JqZWN0W3R5cGVdW3Jlc291cmNlXSwgdmFsdWUpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKHVwZGF0ZSkgdGhpcy5fdXBkYXRlVG9BcnJheShzdG9yZURhdGFPYmplY3RbdHlwZV0sIHJlc291cmNlLCBhdHRyaWJ1dGUsIHZhbHVlKTtcclxuXHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgc3RvcmVEYXRhT2JqZWN0W3R5cGVdW3Jlc291cmNlXVthdHRyaWJ1dGVdID0gdmFsdWU7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIHRoaXMuX3N0b3JlRGF0YU9iamVjdCA9IHN0b3JlRGF0YU9iamVjdDtcclxuICAgICAgbGV0IGRiID0gc3RvcmVEYXRhT2JqZWN0W3R5cGVdW3Jlc291cmNlXS5iYWNrdXAgPyBzdG9yZURhdGFPYmplY3RbdHlwZV1bcmVzb3VyY2VdLnVybCA6ICdzeW5jaGVyTWFuYWdlcjpPYmplY3RVUkxzJztcclxuICAgICAgbGV0IHN0b3JhZ2UgPSBzdG9yZURhdGFPYmplY3RbdHlwZV1bcmVzb3VyY2VdLmJhY2t1cCA/IHRoaXMuX3JlbW90ZXNbZGJdIDogdGhpcy5fc3RvcmFnZU1hbmFnZXI7XHJcbiAgICAgIC8qICAgICAgbGV0IHRhYmxlID0gc3RvcmVEYXRhT2JqZWN0W3R5cGVdW3Jlc291cmNlXS5iYWNrdXAgPyBkYi5zcGxpdCgnLycpWzNdIDogdGhpcy5fdGFibGU7XHJcbiAgICAgICAgICAgIGxldCBkYXRhID0gc3RvcmVEYXRhT2JqZWN0W3R5cGVdW3Jlc291cmNlXS5iYWNrdXAgPyBzdG9yZURhdGFPYmplY3RbdHlwZV1bcmVzb3VyY2VdIDogdGhpcy5fZmlsdGVyUmVtb3RlcyhzdG9yZURhdGFPYmplY3QpO1xyXG4gICAgICAgICAgICBzdG9yYWdlLnNldChkYiwgMSwgZGF0YSwgdGFibGUsIHVwZGF0ZVJ1bnRpbWVTdGF0dXMpLnRoZW4oKCkgPT4ge1xyXG4gICAgICAgICAgICAgIHJldHVybiBzdG9yZURhdGFPYmplY3RbdHlwZV1bcmVzb3VyY2VdO1xyXG4gICAgICAgICAgICB9KTsqL1xyXG5cclxuICAgICAgaWYgKHN0b3JlRGF0YU9iamVjdFt0eXBlXVtyZXNvdXJjZV0uYmFja3VwKSB7Ly9qdXN0IHVwZGF0ZSB0aGUgYXR0cmlidXRlIHRoYXQgaXMgY2hhbmdpbmdcclxuICAgICAgICByZXR1cm4gc3RvcmFnZS5zZXQoZGIsIHN0b3JlRGF0YU9iamVjdFt0eXBlXVtyZXNvdXJjZV0pO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHJldHVybiBzdG9yYWdlLnNldCgnc3luY2hlck1hbmFnZXI6T2JqZWN0VVJMcycsIDEsIHRoaXMuX2ZpbHRlclJlbW90ZXMoc3RvcmVEYXRhT2JqZWN0KSwgdGhpcy5fdGFibGUsIHVwZGF0ZVJ1bnRpbWVTdGF0dXMpO1xyXG4gICAgICB9XHJcblxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQGRlc2NyaXB0aW9uIHNob3VsZCBkZWxldGUgc3RvcmVkIGluZm9ybWF0aW9uIGZyb20gdGhlIGRhdGFPYmplY3RcclxuICAgKlxyXG4gICAqIEBwYXJhbSB7Qm9vbGVhbn0gaXNSZXBvcnRlciAtIHRoZSBvYmplY3QgdG8gYmUgc2F2ZWQgaXMgYSByZXBvcnRlclxyXG4gICAqIEBwYXJhbSB7RGF0YU9iamVjdFVSTH0gcmVzb3VyY2UgLSBkYXRhT2JqZWN0VVJMIHRvIGJlIHNhdmVkIG9yIHVwZGF0ZWQ7XHJcbiAgICogQHBhcmFtIHtTdHJpbmd9IGF0dHJpYnV0ZSAtIGF0dHJpYnV0ZSBpbnNpZGUgdGhlIGRhdGEgd2hpY2ggd2lsbCBiZSBzYXZlZFxyXG4gICAqIEBwYXJhbSB7YW55fSBkYXRhIC0gdmFsdWUgd2lsbCBiZSBzYXZlZCBpbnNpZGUgdGhlIGF0dHJpYnV0ZTtcclxuICAgKi9cclxuICBkZWxldGUoaXNSZXBvcnRlciwgcmVzb3VyY2UsIGF0dHJpYnV0ZSwgdmFsdWUpIHtcclxuXHJcbiAgICBsZXQgc3RvcmVEYXRhT2JqZWN0ID0gdGhpcy5fc3RvcmVEYXRhT2JqZWN0O1xyXG4gICAgbGV0IHR5cGUgPSB0aGlzLl9nZXRUeXBlT2ZPYmplY3QoaXNSZXBvcnRlcik7XHJcblxyXG4gICAgaWYgKCFzdG9yZURhdGFPYmplY3QgfHwgIXN0b3JlRGF0YU9iamVjdFt0eXBlXSB8fCAhc3RvcmVEYXRhT2JqZWN0W3R5cGVdW3Jlc291cmNlXSkge1xyXG4gICAgICBsb2cubG9nKCdbU3RvcmVEYXRhT2JqZWN0cyAtIGRlbGV0ZV0gLSBub3Qgc2F2ZWQnKTtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG5cclxuICAgIGlmIChzdG9yZURhdGFPYmplY3RbdHlwZV0gJiYgc3RvcmVEYXRhT2JqZWN0W3R5cGVdW3Jlc291cmNlXSAmJiByZXNvdXJjZSAmJiBhdHRyaWJ1dGUgJiYgdmFsdWUpIHtcclxuXHJcbiAgICAgIGlmIChhdHRyaWJ1dGUgPT09ICdzdWJzY3JpcHRpb25zJyB8fCBhdHRyaWJ1dGUgPT09ICdzdWJzY3JpYmVyVXNlcnMnKSB7XHJcbiAgICAgICAgdGhpcy5fcmVtb3ZlRnJvbUFycmF5KHN0b3JlRGF0YU9iamVjdFt0eXBlXSwgcmVzb3VyY2UsIGF0dHJpYnV0ZSwgdmFsdWUpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGRlbGV0ZSBzdG9yZURhdGFPYmplY3RbdHlwZV1bcmVzb3VyY2VdW2F0dHJpYnV0ZV07XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIHRoaXMuX3N0b3JlRGF0YU9iamVjdCA9IHN0b3JlRGF0YU9iamVjdDtcclxuICAgICAgbGV0IGRiID0gc3RvcmVEYXRhT2JqZWN0W3R5cGVdW3Jlc291cmNlXS5iYWNrdXAgPyBzdG9yZURhdGFPYmplY3RbdHlwZV1bcmVzb3VyY2VdLnVybCA6ICdzeW5jaGVyTWFuYWdlcjpPYmplY3RVUkxzJztcclxuICAgICAgbGV0IHN0b3JhZ2UgPSBzdG9yZURhdGFPYmplY3RbdHlwZV1bcmVzb3VyY2VdLmJhY2t1cCA/IHRoaXMuX3JlbW90ZXNbZGJdIDogdGhpcy5fc3RvcmFnZU1hbmFnZXI7XHJcbiAgICAgIC8qICAgICBsZXQgdGFibGUgPSBzdG9yZURhdGFPYmplY3RbdHlwZV1bcmVzb3VyY2VdLmJhY2t1cCA/IGRiLnNwbGl0KCcvJylbM10gOiB0aGlzLl90YWJsZTtcclxuICAgICAgICAgICBsZXQgZGF0YSA9IHN0b3JlRGF0YU9iamVjdFt0eXBlXVtyZXNvdXJjZV0uYmFja3VwID8gc3RvcmVEYXRhT2JqZWN0W3R5cGVdW3Jlc291cmNlXSA6IHRoaXMuX2ZpbHRlclJlbW90ZXMoc3RvcmVEYXRhT2JqZWN0KTtcclxuICAgICAgICAgICBzdG9yYWdlLnNldChkYiwgMSwgZGF0YSwgdGFibGUpO1xyXG4gICAgIFxyXG4gICAgICAgICAgIHJldHVybiBzdG9yZURhdGFPYmplY3RbdHlwZV1bcmVzb3VyY2VdOyovXHJcblxyXG4gICAgICBpZiAoc3RvcmVEYXRhT2JqZWN0W3R5cGVdW3Jlc291cmNlXS5iYWNrdXApIHtcclxuICAgICAgICByZXR1cm4gc3RvcmFnZS5zZXQoZGIsIHN0b3JlRGF0YU9iamVjdFt0eXBlXVtyZXNvdXJjZV0pO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHJldHVybiBzdG9yYWdlLnNldChkYiwgMSwgdGhpcy5fZmlsdGVyUmVtb3RlcyhzdG9yZURhdGFPYmplY3QpLCB0aGlzLl90YWJsZSwgdXBkYXRlUnVudGltZVN0YXR1cyk7XHJcbiAgICAgIH1cclxuXHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBEZWxldGUgRGF0YSBPYmplY3QgZnJvbSB0aGUgc3RvcmFnZVxyXG4gICAqL1xyXG5cclxuICBkZWxldGVSZXNvdXJjZShyZXNvdXJjZSkge1xyXG5cclxuICAgIGxldCBfdGhpcyA9IHRoaXM7XHJcblxyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcclxuXHJcbiAgICAgIGlmIChyZXNvdXJjZSkge1xyXG4gICAgICAgIC8vICAgICAgICByZXR1cm4gdGhpcy5nZXRBbGwoKS50aGVuKChzdG9yZWREYXRhT2JqZWN0cykgPT4ge1xyXG4gICAgICAgIGxvZy5sb2coJ1tEYXRhT2JqZWN0U3RvcmFnZS5kZWxldGVSZXNvdXJjZV0gZGVsZXRpbmc6ICcsIHJlc291cmNlKTtcclxuXHJcbiAgICAgICAgLy8gICAgICAgICAgbGV0IHRoaXMuX3N0b3JlRGF0YU9iamVjdCA9IE9iamVjdC5hc3NpZ24odGhpcy5fc3RvcmVEYXRhT2JqZWN0IHx8IHt9KTtcclxuXHJcbiAgICAgICAgbGV0IGJhY2t1cDtcclxuICAgICAgICBsZXQgZGI7XHJcbiAgICAgICAgbGV0IHN0b3JhZ2U7XHJcblxyXG4gICAgICAgIGlmIChfdGhpcy5fc3RvcmVEYXRhT2JqZWN0Lmhhc093blByb3BlcnR5KCdvYnNlcnZlcnMnKSAmJiBfdGhpcy5fc3RvcmVEYXRhT2JqZWN0Lm9ic2VydmVycy5oYXNPd25Qcm9wZXJ0eShyZXNvdXJjZSkpIHtcclxuICAgICAgICAgIGJhY2t1cCA9IChfdGhpcy5fc3RvcmVEYXRhT2JqZWN0Lm9ic2VydmVyc1tyZXNvdXJjZV0uYmFja3VwKSA/IF90aGlzLl9zdG9yZURhdGFPYmplY3Qub2JzZXJ2ZXJzW3Jlc291cmNlXS5iYWNrdXAgOiBmYWxzZTtcclxuXHJcbiAgICAgICAgICBkYiA9IGJhY2t1cCA/IF90aGlzLl9zdG9yZURhdGFPYmplY3Qub2JzZXJ2ZXJzW3Jlc291cmNlXS51cmwgOiAnc3luY2hlck1hbmFnZXI6T2JqZWN0VVJMcyc7XHJcbiAgICAgICAgICBzdG9yYWdlID0gYmFja3VwID8gX3RoaXMuX3JlbW90ZXNbZGJdIDogX3RoaXMuX3N0b3JhZ2VNYW5hZ2VyO1xyXG4gICAgICAgICAgZGVsZXRlIF90aGlzLl9zdG9yZURhdGFPYmplY3Qub2JzZXJ2ZXJzW3Jlc291cmNlXTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmIChfdGhpcy5fc3RvcmVEYXRhT2JqZWN0Lmhhc093blByb3BlcnR5KCdyZXBvcnRlcnMnKSAmJiBfdGhpcy5fc3RvcmVEYXRhT2JqZWN0LnJlcG9ydGVycy5oYXNPd25Qcm9wZXJ0eShyZXNvdXJjZSkpIHtcclxuICAgICAgICAgIGJhY2t1cCA9IChfdGhpcy5fc3RvcmVEYXRhT2JqZWN0LnJlcG9ydGVyc1tyZXNvdXJjZV0uYmFja3VwKSA/IF90aGlzLl9zdG9yZURhdGFPYmplY3QucmVwb3J0ZXJzW3Jlc291cmNlXS5iYWNrdXAgOiBmYWxzZTtcclxuXHJcbiAgICAgICAgICBkYiA9IGJhY2t1cCA/IF90aGlzLl9zdG9yZURhdGFPYmplY3QucmVwb3J0ZXJzW3Jlc291cmNlXS51cmwgOiAnc3luY2hlck1hbmFnZXI6T2JqZWN0VVJMcyc7XHJcbiAgICAgICAgICBzdG9yYWdlID0gYmFja3VwID8gX3RoaXMuX3JlbW90ZXNbZGJdIDogX3RoaXMuX3N0b3JhZ2VNYW5hZ2VyO1xyXG4gICAgICAgICAgZGVsZXRlIF90aGlzLl9zdG9yZURhdGFPYmplY3QucmVwb3J0ZXJzW3Jlc291cmNlXTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vICAgICAgICAgIHRoaXMuX3N0b3JlRGF0YU9iamVjdCA9IHRoaXMuX3N0b3JlRGF0YU9iamVjdDtcclxuXHJcbiAgICAgICAgaWYgKGJhY2t1cCAmJiBzdG9yYWdlKSB7XHJcbiAgICAgICAgICBzdG9yYWdlLmRlbGV0ZSgpLnRoZW4oKCkgPT4ge1xyXG4gICAgICAgICAgICBsb2cubG9nKCdbRGF0YU9iamVjdFN0b3JhZ2UuZGVsZXRlUmVzb3VyY2VdIGRlbGV0aW5nIHN5bmMgZGIgJywgcmVzb3VyY2UpO1xyXG4gICAgICAgICAgICBkZWxldGUgX3RoaXMuX3JlbW90ZXNbZGJdO1xyXG4gICAgICAgICAgICBkZWxldGUgX3RoaXMuX2ZhY3RvcnkuZGF0YWJhc2VzWydkby0nICsgZGIuc3BsaXQoJy8nKVszXV07XHJcbiAgICAgICAgICAgIGRlbGV0ZSBfdGhpcy5fZmFjdG9yeS5zdG9yZU1hbmFnZXJbJ2RvLScgKyBkYi5zcGxpdCgnLycpWzNdXTtcclxuICAgICAgICAgICAgX3RoaXMuX3N0b3JhZ2VNYW5hZ2VyLmRlbGV0ZShyZXNvdXJjZSwgbnVsbCwgJ3JlbW90ZXMnKTtcclxuICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICBkZWxldGUgX3RoaXMuX2ZhY3RvcnkuZGF0YWJhc2VzW2RiXTtcclxuICAgICAgICAgIGRlbGV0ZSBfdGhpcy5fZmFjdG9yeS5zdG9yZU1hbmFnZXJbZGJdO1xyXG4gICAgICAgICAgc3RvcmFnZS5zZXQoZGIsIDEsIHRoaXMuX2ZpbHRlclJlbW90ZXMoX3RoaXMuX3N0b3JlRGF0YU9iamVjdCkpO1xyXG4gICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgIHJldHVybiByZXNvbHZlKCk7XHJcblxyXG4gICAgICAgIC8vICAgICAgICB9KTtcclxuXHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgcmVqZWN0KG5ldyBFcnJvcignW1N0b3JlRGF0YU9iamVjdHNdIC0gQ2FuXFwndCBkZWxldGUgdGhpcyAnICsgcmVzb3VyY2UpKTtcclxuICAgICAgfVxyXG5cclxuICAgIH0pO1xyXG5cclxuICB9XHJcblxyXG4gIC8qICBnZXRBbGwoKSB7XHJcbiAgXHJcbiAgICAgIGxldCBfdGhpcyA9IHRoaXM7XHJcbiAgXHJcbiAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XHJcbiAgICAgICAgX3RoaXMuX3N0b3JlRGF0YU9iamVjdCA9IHRoaXMuX3N0b3JhZ2VNYW5hZ2VyLmdldCgnc3luY2hlck1hbmFnZXI6T2JqZWN0VVJMcycpLnRoZW4oKG9iamVjdHMpID0+IHtcclxuICAgICAgICAgIF90aGlzLl9zdG9yZURhdGFPYmplY3QgPSBvYmplY3RzO1xyXG4gICAgICAgICAgX3RoaXMubG9hZFJlbW90ZSh0cnVlKS50aGVuKChzdG9yZWRPYmplY3RzKSA9PiB7XHJcbiAgICAgICAgICAgIHJlc29sdmUoX3RoaXMuX3N0b3JlRGF0YU9iamVjdCk7XHJcbiAgICAgICAgICB9KTtcclxuICBcclxuICAgICAgICB9KTtcclxuICBcclxuICAgICAgfSk7XHJcbiAgICAgIC8vICAgIHJldHVybiB0aGlzLl9zdG9yYWdlTWFuYWdlci5nZXQoJ3N5bmNoZXJNYW5hZ2VyOk9iamVjdFVSTHMnKTtcclxuICAgIH0qL1xyXG5cclxuICAvLyBUbyBzeW5jIGxvY2FsIHN0b3JhZ2Ugd2l0aCByZW1vdGUgc3RvcmFnZSBzZXJ2ZXJcclxuXHJcbiAgc3luYyhyZXNvdXJjZSkge1xyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuXHJcbiAgICBjb25zb2xlLmxvZygnW0RhdGFPYmplY3RTdG9yYWdlLl9zeW5jXSByZXNvdXJjZTogJywgcmVzb3VyY2UpO1xyXG5cclxuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XHJcblxyXG4gICAgICBpZiAoX3RoaXMuX3JlbW90ZXNbcmVzb3VyY2VdKSB7XHJcbiAgICAgICAgX3RoaXMuX3JlbW90ZXNbcmVzb3VyY2VdLmdldChyZXNvdXJjZSwgJ2lzUmVwb3J0ZXInKS50aGVuKChpc1JlcG9ydGVyKSA9PiB7XHJcbiAgICAgICAgICBfdGhpcy5fcmVtb3Rlc1tyZXNvdXJjZV0uZ2V0KHJlc291cmNlLCAnc3Vic2NyaXB0aW9ucycpLnRoZW4oKHN1YnNjcmlwdGlvbnMpID0+IHtcclxuICAgICAgICAgICAgX3RoaXMuX3JlbW90ZXNbcmVzb3VyY2VdLnN5bmMoKS50aGVuKCgpID0+IHtcclxuICAgICAgICAgICAgICBfdGhpcy5fcmVtb3Rlc1tyZXNvdXJjZV0uZ2V0KCkudGhlbigoZG9jKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAvLyAgICAgICAgICB0aGlzLl9yZW1vdGVzW3Jlc291cmNlXS5nZXQoKS50aGVuKChkYXRhT2JqZWN0KT0+e1xyXG4gICAgICAgICAgICAgICAgbG9nLmluZm8oJ1tEYXRhT2JqZWN0U3RvcmFnZS5zeW5jXSByZXR1cm5pbmcgc3luY2hlZCBETzogJywgZG9jKTtcclxuICBcclxuICAgICAgICAgICAgICAgIC8vICAgICAgICAgIGlmICghaXNSZXBvcnRlcikgX3RoaXMuX3JlbW90ZXNbcmVzb3VyY2VdLmRpc2Nvbm5lY3QoKTtcclxuICBcclxuICAgICAgICAgICAgICAgIC8vIHRvIGVuc3VyZSBsb2NhbCBkYXRhIG9iamVjdCBhcyB0aGUgcmlnaHQgdmFsdWUgZm9yIGlzUmVwb3J0ZXJcclxuICAgICAgICAgICAgICAgIC8vIHJlbW90ZSBkYXRhIG9iamVjdCBzaG91bGQgYWx3YXlzIGhhdmUgaXNSZXBvcnRlciA9IHRydWUuXHJcbiAgICAgICAgICAgICAgICAvL2RvY1swXS5pc1JlcG9ydGVyID0gaXNSZXBvcnRlcjtcclxuICAgICAgICAgICAgICAgIGxldCBkTyA9IF90aGlzLl9yZW1vdGVEb2MyZGF0YU9iamVjdChkb2MpO1xyXG4gIFxyXG4gICAgICAgICAgICAgICAgZE8uaXNSZXBvcnRlciA9IGlzUmVwb3J0ZXI7XHJcbiAgICAgICAgICAgICAgICBkTy5zdWJzY3JpcHRpb25zID0gc3Vic2NyaXB0aW9ucztcclxuICBcclxuICAgICAgICAgICAgICAgIGlmIChfdGhpcy5fc3RvcmVEYXRhT2JqZWN0Lmhhc093blByb3BlcnR5KCdvYnNlcnZlcnMnKSAmJiBfdGhpcy5fc3RvcmVEYXRhT2JqZWN0Lm9ic2VydmVycy5oYXNPd25Qcm9wZXJ0eShyZXNvdXJjZSkpIHtcclxuICAgICAgICAgICAgICAgICAgX3RoaXMuX3N0b3JlRGF0YU9iamVjdC5vYnNlcnZlcnNbcmVzb3VyY2VdID0gZE87XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgXHJcbiAgICAgICAgICAgICAgICBpZiAoX3RoaXMuX3N0b3JlRGF0YU9iamVjdC5oYXNPd25Qcm9wZXJ0eSgncmVwb3J0ZXJzJykgJiYgX3RoaXMuX3N0b3JlRGF0YU9iamVjdC5yZXBvcnRlcnMuaGFzT3duUHJvcGVydHkocmVzb3VyY2UpKSB7XHJcbiAgICAgICAgICAgICAgICAgIF90aGlzLl9zdG9yZURhdGFPYmplY3QucmVwb3J0ZXJzW3Jlc291cmNlXSA9IGRPO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgX3RoaXMuX3JlbW90ZXNbcmVzb3VyY2VdLnNldChyZXNvdXJjZSwgZE8pLnRoZW4oKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICByZXNvbHZlKGRPKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gIFxyXG4gICAgICAgICAgICAgIH0sIChlcnJvcikgPT4ge1xyXG4gICAgICAgICAgICAgICAgbG9nLmVycm9yKCdbRGF0YU9iamVjdFN0b3JhZ2Uuc3luY10gRXJyb3IgJywgZXJyb3IpO1xyXG4gICAgICAgICAgICAgICAgcmVqZWN0KGVycm9yKVxyXG4gICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9LCAoZXJyb3IpID0+IHtcclxuICAgICAgICAgICAgICBsb2cuZXJyb3IoJ1tEYXRhT2JqZWN0U3RvcmFnZS5zeW5jXSBFcnJvciAnLCBlcnJvcik7XHJcbiAgICAgICAgICAgICAgcmVqZWN0KGVycm9yKVxyXG4gICAgICAgICAgICB9KTtcclxuICBcclxuICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGxldCB3YXJuaW5nID0gcmVzb3VyY2UgKyAnIG5vdCBmb3VuZCBpbiBsb2NhbCBzdG9yYWdlLidcclxuICAgICAgICBsb2cud2FybignW0RhdGFPYmplY3RTdG9yYWdlLnN5bmNdIHdhcm5pbmcgJywgd2FybmluZyk7XHJcbiAgICAgICAgcmVqZWN0KHdhcm5pbmcpO1xyXG5cclxuICAgICAgfVxyXG5cclxuICBcclxuXHJcblxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBfcmVtb3RlRG9jMmRhdGFPYmplY3QoZG9jKSB7XHJcbiAgICBpZiAoZG9jLmxlbmd0aCA+IDEpIHsvL2hhcyBjaGlsZHJlbnNcclxuICAgICAgbGV0IGRhdGFPYmplY3QgPSBkb2NbZG9jLmxlbmd0aCAtIDFdO1xyXG5cclxuICAgICAgZGF0YU9iamVjdC5jaGlsZHJlbk9iamVjdHMgPSB7fTtcclxuXHJcbiAgICAgIGxldCBpO1xyXG5cclxuICAgICAgZm9yIChpID0gMDsgaSA8IGRvYy5sZW5ndGggLSAxOyBpKyspIHtcclxuICAgICAgICBkYXRhT2JqZWN0LmNoaWxkcmVuT2JqZWN0c1tkb2NbaV0uX2lkXSA9IGRvY1tpXTtcclxuICAgICAgfVxyXG5cclxuICAgICAgcmV0dXJuIGRhdGFPYmplY3Q7XHJcblxyXG4gICAgfSBlbHNlIHJldHVybiAoZG9jWzBdKTtcclxuXHJcbiAgfVxyXG5cclxuICBzdG9wU3luYyhyZXNvdXJjZSkge1xyXG5cclxuICAgIGlmICh0aGlzLl9yZW1vdGVzW3Jlc291cmNlXSkgdGhpcy5fcmVtb3Rlc1tyZXNvdXJjZV0uZGlzY29ubmVjdCgpO1xyXG5cclxuICB9XHJcblxyXG4gIC8qKlxyXG4qIEBkZXNjcmlwdGlvbiBzaG91bGQgbG9vayBmb3IgYSBzcGVjaWZpYyBkYXRhT2JqZWN0VVJMXHJcbipcclxuKiBAcGFyYW0ge0RhdGFPYmplY3RVUkx9IHJlc291cmNlIC0gdGhlIGRhdGFPYmplY3RVUkwgd2lsbCBiZSBzZWFyY2hlZFxyXG4qXHJcbiogQHJldHVybnMgUHJvbWlzZTxPYmplY3Q+IG9iamVjdCB3aXRoIHRoZSBkYXRhT2JqZWN0IGluZm9ybWF0aW9uO1xyXG4qL1xyXG4gIGdldERhdGFPYmplY3QocmVzb3VyY2UpIHtcclxuXHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xyXG5cclxuICAgICAgLyogICAgICB0aGlzLl9yZW1vdGVzW3Jlc291cmNlXS5nZXQoKS50aGVuKChkYXRhT2JqZWN0KT0+IHtcclxuICAgICAgICAgICAgICByZXR1cm4gcmVzb2x2ZShkYXRhT2JqZWN0KTtcclxuICAgICAgICAgICAgfSAsICgpID0+IHtcclxuICAgICAgICAgICAgICB0aGlzLl9zdG9yYWdlTWFuYWdlci5nZXQoJ3N5bmNoZXJNYW5hZ2VyOk9iamVjdFVSTHMnKS50aGVuKChzdG9yZWREYXRhT2JqZWN0KSA9PiB7Ki9cclxuXHJcbiAgICAgIGxldCBzdG9yZWREYXRhT2JqZWN0ID0gdGhpcy5fc3RvcmVEYXRhT2JqZWN0O1xyXG5cclxuICAgICAgbGV0IG9ic2VydmVycyA9IHN0b3JlZERhdGFPYmplY3QuaGFzT3duUHJvcGVydHkoJ29ic2VydmVycycpID8gc3RvcmVkRGF0YU9iamVjdC5vYnNlcnZlcnMgOiB7fTtcclxuICAgICAgbGV0IHJlcG9ydGVycyA9IHN0b3JlZERhdGFPYmplY3QuaGFzT3duUHJvcGVydHkoJ3JlcG9ydGVycycpID8gc3RvcmVkRGF0YU9iamVjdC5yZXBvcnRlcnMgOiB7fTtcclxuXHJcbiAgICAgIGxldCBjdXJyZW50UmVwb3J0ZXIgPSBPYmplY3Qua2V5cyhyZXBvcnRlcnMpLmZpbmQoKHZhbHVlKSA9PiB7IHJldHVybiB2YWx1ZSA9PT0gcmVzb3VyY2U7IH0pO1xyXG4gICAgICBsZXQgY3VycmVudE9ic2VydmVyID0gT2JqZWN0LmtleXMob2JzZXJ2ZXJzKS5maW5kKCh2YWx1ZSkgPT4geyByZXR1cm4gdmFsdWUgPT09IHJlc291cmNlOyB9KTtcclxuICAgICAgbGV0IGRhdGFPYmplY3Q7XHJcblxyXG4gICAgICBpZiAoY3VycmVudE9ic2VydmVyKSB7IGRhdGFPYmplY3QgPSBzdG9yZWREYXRhT2JqZWN0Lm9ic2VydmVyc1tjdXJyZW50T2JzZXJ2ZXJdOyB9XHJcbiAgICAgIGlmIChjdXJyZW50UmVwb3J0ZXIpIHsgZGF0YU9iamVjdCA9IHN0b3JlZERhdGFPYmplY3QucmVwb3J0ZXJzW2N1cnJlbnRSZXBvcnRlcl07IH1cclxuXHJcbiAgICAgIGxvZy5pbmZvKCdbU3RvcmVEYXRhT2JqZWN0cyAtIGdldERhdGFPYmplY3RdIC0gZm9yIG9ic2VydmVyOiAnLCBjdXJyZW50T2JzZXJ2ZXIpO1xyXG4gICAgICBsb2cuaW5mbygnW1N0b3JlRGF0YU9iamVjdHMgLSBnZXREYXRhT2JqZWN0XSAtIGZvciByZXBvcnRlcnM6ICcsIGN1cnJlbnRSZXBvcnRlcik7XHJcblxyXG4gICAgICBsb2cuaW5mbygnW1N0b3JlRGF0YU9iamVjdHMgLSBnZXREYXRhT2JqZWN0XSAtIHJlc29sdmU6ICcsIGRhdGFPYmplY3QpO1xyXG4gICAgICByZXR1cm4gZGF0YU9iamVjdCA/IHJlc29sdmUoZGF0YU9iamVjdCkgOiByZWplY3QoJ05vIGRhdGFPYmplY3Qgd2FzIGZvdW5kJyk7XHJcblxyXG4gICAgICAvLyAgICAgICAgfSk7XHJcblxyXG4gICAgICAvLyAgICAgIH0pO1xyXG4gICAgfSk7XHJcblxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQGRlc2NyaXB0aW9uIHNob3VsZCBnZXQgdGhlIGRhdGFPYmplY3QgaW5mb3JtYXRpb24gYnkgdGhlIG1lc3NhZ2VcclxuICAgKlxyXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBtc2cgLSBtZXNzYWdlIHdvdWxkIGJlIGFuYWxpc2VkIHRvIGdldCB0aGUgY3VycmVudCBkYXRhT2JqZWN0IGluZm9ybWF0aW9uXHJcbiAgICogQHBhcmFtIHtCb29sZWFufSBpc1JlcG9ydGVyIC0gdGhlIG9iamVjdCB0byBiZSBzYXZlZCBpcyBhIHJlcG9ydGVyXHJcbiAgICpcclxuICAgKiBAcmV0dXJucyBQcm9taXNlPG9iamVjdD4gc2hvdWxkIHJldHVuIGFuIG9iamVjdCB3aXRoIHRoZSBkYXRhT2JqZWN0IG9yIG51bGxcclxuICAgKi9cclxuICBnZXRSZXNvdXJjZXNCeUNyaXRlcmlhKG1zZywgaXNSZXBvcnRlcikge1xyXG5cclxuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4ge1xyXG5cclxuICAgICAgbGV0IHR5cGUgPSB0aGlzLl9nZXRUeXBlT2ZPYmplY3QoaXNSZXBvcnRlcik7XHJcblxyXG4gICAgICAvLyAgICAgIHRoaXMuZ2V0QWxsKGlzUmVwb3J0ZXIpLnRoZW4oKHN0b3JlZERhdGFPYmplY3RzKSA9PiB7XHJcbiAgICAgIGxldCBzdG9yZWREYXRhT2JqZWN0cyA9IHRoaXMuX3N0b3JlRGF0YU9iamVjdDtcclxuXHJcbiAgICAgIGlmICghc3RvcmVkRGF0YU9iamVjdHMpIHtcclxuICAgICAgICBsb2cubG9nKCdbRGF0YU9iamVjdHNTdG9yYWdlLmdldFJlc291cmNlc0J5Q3JpdGVyaWFdIGRvblxcJ3QgaGF2ZSBzdG9yZWQgZGF0YSBvYmplY3RzJyk7XHJcbiAgICAgICAgcmV0dXJuIHJlc29sdmUobnVsbCk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGlmIChtc2cuYm9keSAmJiBtc2cuYm9keS5oYXNPd25Qcm9wZXJ0eSgncmVzdW1lJykgJiYgIW1zZy5ib2R5LnJlc3VtZSkge1xyXG4gICAgICAgIHJldHVybiByZXNvbHZlKG51bGwpO1xyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyBjaGVjayBpZiB0aGUgbWVzc2FnZSBoYXZlIG90aGVyIGNyaXRlcmlhXHJcbiAgICAgIC8vIGlmIG5vdCBzZWFyY2ggZm9yIG9uIHRoZSAnZnJvbScgb2YgdGhlIG1lc3NhZ2UuXHJcbiAgICAgIGxldCByZXN1bHQgPSBbXTtcclxuICAgICAgbGV0IGhhc1N1YnNjcmlwdGlvbiA9IHRoaXMuX2hhc1N1YnNjcmlwdGlvbihzdG9yZWREYXRhT2JqZWN0c1t0eXBlXSwgbXNnLmZyb20pO1xyXG4gICAgICBsZXQgaXNPd25lciA9IHRoaXMuX3NlYXJjaE93bmVyKHN0b3JlZERhdGFPYmplY3RzW3R5cGVdLCBtc2cuZnJvbSk7XHJcbiAgICAgIGxldCBpc1RvUHJvdG9TdHViUmVzdW1lID0gdGhpcy5fY2hlY2tQcm90b3N0dWJSZXN1bWUoc3RvcmVkRGF0YU9iamVjdHMsIG1zZyk7XHJcbiAgICAgIGxvZy5sb2coJ1tTdG9yZWREYXRhT2JqZWN0cyAtIGdldFJlc291cmNlc0J5Q3JpdGVyaWFdOicsIHN0b3JlZERhdGFPYmplY3RzLCBtc2csIGhhc1N1YnNjcmlwdGlvbiwgaXNPd25lcik7XHJcbiAgICAgIGlmIChtc2cuaGFzT3duUHJvcGVydHkoJ2Zyb20nKSAmJiBoYXNTdWJzY3JpcHRpb24gfHwgaXNPd25lciB8fCBpc1RvUHJvdG9TdHViUmVzdW1lKSB7XHJcbiAgICAgICAgbGV0IHJlc291cmNlO1xyXG5cclxuICAgICAgICBpZiAoaXNPd25lcikge1xyXG4gICAgICAgICAgcmVzb3VyY2UgPSB0aGlzLl9nZXRSZXNvdXJjZXNCeU93bmVyKHN0b3JlZERhdGFPYmplY3RzW3R5cGVdLCBtc2cuZnJvbSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIHJlc291cmNlID0gdGhpcy5fZ2V0UmVzb3VyY2VzQnlTdWJzY3JpcHRpb24oc3RvcmVkRGF0YU9iamVjdHNbdHlwZV0sIG1zZy5mcm9tKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGxldCBpZGVudGl0eUZvdW5kRGF0YSA9IFtdO1xyXG4gICAgICAgIGlmIChtc2cuYm9keSAmJiBtc2cuYm9keS5pZGVudGl0eSkgaWRlbnRpdHlGb3VuZERhdGEgPSB0aGlzLl9nZXRSZXNvdXJjZXNCeUlkZW50aXR5KHN0b3JlZERhdGFPYmplY3RzW3R5cGVdLCBtc2cuYm9keS5pZGVudGl0eSk7XHJcblxyXG4gICAgICAgIC8vVE9ETzogcmVtb3ZlIHNjaGVtYSBzaW5jZSBtZXRhZGF0YSBhbHJlYWR5IGluY2x1ZGVzIHRoZSBzY2hlbWE/XHJcblxyXG4gICAgICAgIGxldCBzY2hlbWFGb3VuZERhdGEgPSBbXTtcclxuICAgICAgICBpZiAobXNnLmJvZHkgJiYgbXNnLmJvZHkuc2NoZW1hKSBzY2hlbWFGb3VuZERhdGEgPSB0aGlzLl9nZXRSZXNvdXJjZXNCeVNjaGVtYShzdG9yZWREYXRhT2JqZWN0c1t0eXBlXSwgbXNnLmJvZHkuc2NoZW1hKTtcclxuXHJcbiAgICAgICAgbGV0IG1ldGFkYXRhRm91bmQgPSBbXTtcclxuICAgICAgICBpZiAobXNnLmJvZHkgJiYgbXNnLmJvZHkudmFsdWUpIHtcclxuICAgICAgICAgIGxldCBtZXRhZGF0YSA9IG1zZy5ib2R5LnZhbHVlO1xyXG4gICAgICAgICAgZGVsZXRlIG1ldGFkYXRhLmRhdGE7XHJcbiAgICAgICAgICBtZXRhZGF0YUZvdW5kID0gdGhpcy5fZ2V0UmVzb3VyY2VzQnlNZXRhZGF0YShzdG9yZWREYXRhT2JqZWN0c1t0eXBlXSwgbWV0YWRhdGEpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgbGV0IGRhdGFGb3VuZCA9IFtdO1xyXG4gICAgICAgIGlmIChtc2cuYm9keSAmJiBtc2cuYm9keS52YWx1ZSAmJiBtc2cuYm9keS52YWx1ZS5kYXRhKSBkYXRhRm91bmQgPSB0aGlzLl9nZXRSZXNvdXJjZXNCeURhdGEoc3RvcmVkRGF0YU9iamVjdHNbdHlwZV0sIG1zZy5ib2R5LnZhbHVlLmRhdGEpO1xyXG5cclxuICAgICAgICAvLyB5b3UgY2FuIHBhc3MgYXMgYXJyYXlzIGFzIHlvdSB3YW50Li4gaXQgd2lsbCBiZSBtZXJnZWQgaW4gb24gcGxhY2VcclxuICAgICAgICAvLyByZW1vdmVkIGR1cGxpY2F0ZXM7XHJcbiAgICAgICAgcmVzdWx0ID0gdGhpcy5faW50ZXJzZWN0aW9uKHJlc291cmNlLCBpZGVudGl0eUZvdW5kRGF0YSwgc2NoZW1hRm91bmREYXRhLCBkYXRhRm91bmQsIG1ldGFkYXRhRm91bmQpO1xyXG5cclxuICAgICAgICBpZiAocmVzdWx0Lmxlbmd0aCA9PSAwICYmIGlzVG9Qcm90b1N0dWJSZXN1bWUgJiYgdHlwZSA9PSAnb2JzZXJ2ZXJzJyAmJiBtc2cuZnJvbS5zcGxpdCgncHJvdG9zdHViJykubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgbGV0IHN0b3JlZE9ic2VydmVycyA9IHN0b3JlZERhdGFPYmplY3RzW3R5cGVdO1xyXG4gICAgICAgICAgbGV0IGZyb21Eb21haW4gPSBkaXZpZGVVUkwobXNnLmZyb20pLmRvbWFpbjtcclxuICAgICAgICAgIGlmIChzdG9yZWRPYnNlcnZlcnMpIHtcclxuICAgICAgICAgICAgT2JqZWN0LmtleXMoc3RvcmVkT2JzZXJ2ZXJzKS5maWx0ZXIoKG9iamVjdFVSTCkgPT4ge1xyXG4gICAgICAgICAgICAgIGxldCBzdWJzY3JpcHRpb25zID0gc3RvcmVkT2JzZXJ2ZXJzW29iamVjdFVSTF0uc3Vic2NyaXB0aW9ucztcclxuICAgICAgICAgICAgICBsZXQgaGFzU3Vic2NyaXB0aW9uID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgc3Vic2NyaXB0aW9ucy5mb3JFYWNoKGZ1bmN0aW9uIChzdWJzY3JpcHRpb24pIHtcclxuICAgICAgICAgICAgICAgIGxldCBzdWJzY3JpcHRpb25Eb21haW4gPSBkaXZpZGVVUkwoc3Vic2NyaXB0aW9uKS5kb21haW47XHJcbiAgICAgICAgICAgICAgICBpZiAoc3Vic2NyaXB0aW9uRG9tYWluID09IGZyb21Eb21haW4pIHtcclxuICAgICAgICAgICAgICAgICAgcmVzdWx0LnB1c2gob2JqZWN0VVJMKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICB9XHJcblxyXG4gICAgICAgIH1cclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICByZXR1cm4gcmVzb2x2ZShudWxsKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgbGV0IGluaXQgPSB7fTtcclxuICAgICAgcmVzdWx0LmZvckVhY2goKGtleSkgPT4ge1xyXG4gICAgICAgIGxldCBjdXJyZW50SXNSZXBvcnRlciA9IHN0b3JlZERhdGFPYmplY3RzW3R5cGVdW2tleV07XHJcbiAgICAgICAgaW5pdFtrZXldID0gY3VycmVudElzUmVwb3J0ZXI7XHJcbiAgICAgICAgcmV0dXJuIGluaXQ7XHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgbG9nLmxvZygnW1N0b3JlIERhdGEgT2JqZWN0c10gLSAnLCBpbml0KTtcclxuXHJcbiAgICAgIHJlc29sdmUoaW5pdCk7XHJcbiAgICB9KTtcclxuXHJcbiAgICAvLyAgICB9KTtcclxuXHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBAcHJpdmF0ZVxyXG4gICAqIEB0b2RvIGRvY3VtZW50YXRpb25cclxuICAgKi9cclxuICBfZ2V0UmVzb3VyY2VzQnlJZGVudGl0eShzdG9yZWREYXRhLCB1c2VyVVJMKSB7XHJcbiAgICBpZiAoIXN0b3JlZERhdGEpIHJldHVybiBbXTtcclxuXHJcbiAgICByZXR1cm4gT2JqZWN0LmtleXMoc3RvcmVkRGF0YSkuZmlsdGVyKChvYmplY3RVUkwpID0+IHtcclxuICAgICAgcmV0dXJuIHN0b3JlZERhdGFbb2JqZWN0VVJMXS5zdWJzY3JpYmVyVXNlcnMuZmlsdGVyKChjdXJyZW50KSA9PiB7XHJcbiAgICAgICAgcmV0dXJuIGN1cnJlbnQgPT09IHVzZXJVUkw7XHJcbiAgICAgIH0pLmxlbmd0aDtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQHByaXZhdGVcclxuICAgKiBAdG9kbyBkb2N1bWVudGF0aW9uXHJcbiAgICovXHJcbiAgX2dldFJlc291cmNlc0J5T3duZXIoc3RvcmVkRGF0YSwgb3duZXIpIHtcclxuICAgIGlmICghc3RvcmVkRGF0YSkgcmV0dXJuIFtdO1xyXG4gICAgcmV0dXJuIE9iamVjdC5rZXlzKHN0b3JlZERhdGEpLmZpbHRlcigob2JqZWN0VVJMKSA9PiB7XHJcbiAgICAgIHJldHVybiBzdG9yZWREYXRhW29iamVjdFVSTF0ucmVwb3J0ZXIgPT09IG93bmVyO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBAcHJpdmF0ZVxyXG4gICAqIEB0b2RvIGRvY3VtZW50YXRpb25cclxuICAgKi9cclxuICBfZ2V0UmVzb3VyY2VzQnlTdWJzY3JpcHRpb24oc3RvcmVkRGF0YSwgc3Vic2NyaXB0aW9uKSB7XHJcbiAgICBpZiAoIXN0b3JlZERhdGEpIHJldHVybiBbXTtcclxuXHJcbiAgICByZXR1cm4gT2JqZWN0LmtleXMoc3RvcmVkRGF0YSkuZmlsdGVyKChvYmplY3RVUkwpID0+IHtcclxuICAgICAgcmV0dXJuIHN0b3JlZERhdGFbb2JqZWN0VVJMXS5zdWJzY3JpcHRpb25zLmZpbHRlcigoY3VycmVudCkgPT4ge1xyXG4gICAgICAgIHJldHVybiBjdXJyZW50ID09PSBzdWJzY3JpcHRpb247XHJcbiAgICAgIH0pLmxlbmd0aDtcclxuICAgIH0pO1xyXG5cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEBwcml2YXRlXHJcbiAgICogQHRvZG8gZG9jdW1lbnRhdGlvblxyXG4gICAqL1xyXG4gIF9nZXRSZXNvdXJjZXNCeVNjaGVtYShzdG9yZWREYXRhLCBzY2hlbWEpIHtcclxuICAgIHJldHVybiBPYmplY3Qua2V5cyhzdG9yZWREYXRhKS5maWx0ZXIoKG9iamVjdFVSTCkgPT4ge1xyXG4gICAgICBsZXQgY3VycmVudE9iamVjdCA9IHN0b3JlZERhdGFbb2JqZWN0VVJMXTtcclxuICAgICAgcmV0dXJuIE9iamVjdC5rZXlzKGN1cnJlbnRPYmplY3QpLmZpbHRlcigoa2V5KSA9PiB7XHJcbiAgICAgICAgcmV0dXJuIGtleSA9PT0gJ3NjaGVtYScgJiYgY3VycmVudE9iamVjdFtrZXldID09PSBzY2hlbWE7XHJcbiAgICAgIH0pLmxlbmd0aDtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQHByaXZhdGVcclxuICAgKiBAdG9kbyBkb2N1bWVudGF0aW9uXHJcbiAgICovXHJcbiAgX2dldFJlc291cmNlc0J5TWV0YWRhdGEoc3RvcmVkRGF0YSwgbWV0YWRhdGEpIHtcclxuICAgIGlmICghbWV0YWRhdGEpIHJldHVybiBbXTtcclxuXHJcbiAgICByZXR1cm4gT2JqZWN0LmtleXMoc3RvcmVkRGF0YSkuZmlsdGVyKChvYmplY3RVUkwpID0+IHtcclxuICAgICAgbGV0IGN1cnJlbnRPYmplY3QgPSBzdG9yZWREYXRhW29iamVjdFVSTF07XHJcbiAgICAgIHJldHVybiBPYmplY3Qua2V5cyhjdXJyZW50T2JqZWN0KS5maWx0ZXIoKGtleSkgPT4ge1xyXG4gICAgICAgIC8vIHNlYXJjaCBvbiBzdG9yZURhdGFPYmplY3RzIGZvciBzcGVjaWZpYyBrZXkgcHJvdmlkZWQgZnJvbSBkYXRhO1xyXG4gICAgICAgIHJldHVybiBPYmplY3Qua2V5cyhtZXRhZGF0YSkuZmlsdGVyKHNlYXJjaEZvciA9PiB7XHJcbiAgICAgICAgICByZXR1cm4ga2V5ID09PSBzZWFyY2hGb3IgJiYgY3VycmVudE9iamVjdFtrZXldID09PSBtZXRhZGF0YVtzZWFyY2hGb3JdO1xyXG4gICAgICAgIH0pLmxlbmd0aDtcclxuXHJcbiAgICAgIH0pLmxlbmd0aDtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQHByaXZhdGVcclxuICAgKiBAdG9kbyBkb2N1bWVudGF0aW9uXHJcbiAgICovXHJcbiAgX2dldFJlc291cmNlc0J5RGF0YShzdG9yZWREYXRhLCBkYXRhKSB7XHJcbiAgICBpZiAoIWRhdGEpIHJldHVybiBbXTtcclxuXHJcbiAgICByZXR1cm4gT2JqZWN0LmtleXMoc3RvcmVkRGF0YSkuZmlsdGVyKChvYmplY3RVUkwpID0+IHtcclxuICAgICAgbGV0IGN1cnJlbnRPYmplY3QgPSBzdG9yZWREYXRhW29iamVjdFVSTF0uaGFzT3duUHJvcGVydHkoJ2RhdGEnKSA/IHN0b3JlZERhdGFbb2JqZWN0VVJMXS5kYXRhIDoge307XHJcbiAgICAgIHJldHVybiBPYmplY3Qua2V5cyhjdXJyZW50T2JqZWN0KS5maWx0ZXIoKGtleSkgPT4ge1xyXG4gICAgICAgIC8vIHNlYXJjaCBvbiBzdG9yZURhdGFPYmplY3RzIGZvciBzcGVjaWZpYyBrZXkgcHJvdmlkZWQgZnJvbSBkYXRhO1xyXG4gICAgICAgIHJldHVybiBPYmplY3Qua2V5cyhkYXRhKS5maWx0ZXIoc2VhcmNoRm9yID0+IHtcclxuICAgICAgICAgIHJldHVybiBrZXkgPT09IHNlYXJjaEZvciAmJiBjdXJyZW50T2JqZWN0W2tleV0gPT09IGRhdGFbc2VhcmNoRm9yXTtcclxuICAgICAgICB9KS5sZW5ndGg7XHJcblxyXG4gICAgICB9KS5sZW5ndGg7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEBwcml2YXRlXHJcbiAgICogQHRvZG8gZG9jdW1lbnRhdGlvblxyXG4gICAqL1xyXG4gIF9oYXNTdWJzY3JpcHRpb24oc3RvcmVkRGF0YSwgc3Vic2NyaXB0aW9uKSB7XHJcbiAgICBpZiAoIXN0b3JlZERhdGEpIHJldHVybiBmYWxzZTtcclxuXHJcbiAgICByZXR1cm4gT2JqZWN0LmtleXMoc3RvcmVkRGF0YSkuZmlsdGVyKChvYmplY3RVUkwpID0+IHtcclxuICAgICAgcmV0dXJuIHN0b3JlZERhdGFbb2JqZWN0VVJMXS5zdWJzY3JpcHRpb25zLmZpbHRlcigoY3VycmVudCkgPT4ge1xyXG4gICAgICAgIHJldHVybiBjdXJyZW50ID09PSBzdWJzY3JpcHRpb247XHJcbiAgICAgIH0pLmxlbmd0aDtcclxuICAgIH0pLmxlbmd0aCA+IDAgPyB0cnVlIDogZmFsc2U7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBAcHJpdmF0ZVxyXG4gICAqIEB0b2RvIGRvY3VtZW50YXRpb25cclxuICAgKi9cclxuICBfc2VhcmNoT3duZXIoc3RvcmVkRGF0YSwgZnJvbSkge1xyXG4gICAgaWYgKCFzdG9yZWREYXRhKSByZXR1cm4gZmFsc2U7XHJcblxyXG4gICAgcmV0dXJuIE9iamVjdC5rZXlzKHN0b3JlZERhdGEpLmZpbHRlcigob2JqZWN0VVJMKSA9PiB7XHJcbiAgICAgIHJldHVybiBzdG9yZWREYXRhW29iamVjdFVSTF0ucmVwb3J0ZXIgPT09IGZyb207XHJcbiAgICB9KS5sZW5ndGggPiAwID8gdHJ1ZSA6IGZhbHNlO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQHByaXZhdGVcclxuICAgKiBAdG9kbyBkb2N1bWVudGF0aW9uXHJcbiAgICovXHJcbiAgX2NoZWNrUHJvdG9zdHViUmVzdW1lKHN0b3JlZERhdGFPYmplY3RzLCBtc2cpIHtcclxuXHJcbiAgICAvL3JldHVybiBtc2cuZnJvbS5pbmNsdWRlcygncHJvdG9zdHViJyk7XHJcblxyXG4gICAgICAgIGlmICghc3RvcmVkRGF0YU9iamVjdHMpIHJldHVybiBmYWxzZTtcclxuICAgIFxyXG4gICAgICAgIGlmIChtc2cuaGFzT3duUHJvcGVydHkoJ2JvZHknKSAmJiBtc2cuYm9keS5oYXNPd25Qcm9wZXJ0eSgndmFsdWUnKSAmJiBtc2cuYm9keS52YWx1ZS5oYXNPd25Qcm9wZXJ0eSgncmVwb3J0ZXInKSkge1xyXG4gICAgICAgICAgbGV0IHJlcG9ydGVyID0gbXNnLmJvZHkudmFsdWUucmVwb3J0ZXI7XHJcbiAgICAgICAgICBpZiAoc3RvcmVkRGF0YU9iamVjdHMuaGFzT3duUHJvcGVydHkoJ3JlcG9ydGVycycpKSB7XHJcbiAgICAgICAgICAgIGxldCByZXBvcnRlcnNTdG9yZWQgPSBzdG9yZWREYXRhT2JqZWN0cy5yZXBvcnRlcnM7XHJcbiAgICAgICAgICAgIHJldHVybiBPYmplY3Qua2V5cyhyZXBvcnRlcnNTdG9yZWQpLmZpbHRlcigob2JqZWN0VVJMKSA9PiB7XHJcbiAgICAgICAgICAgICAgcmV0dXJuIHJlcG9ydGVyc1N0b3JlZFtvYmplY3RVUkxdLnJlcG9ydGVyID09PSByZXBvcnRlcjtcclxuICAgICAgICAgICAgfSkubGVuZ3RoID4gMCA/IHRydWUgOiBmYWxzZTtcclxuICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9IGVsc2UgaWYgKHN0b3JlZERhdGFPYmplY3RzLmhhc093blByb3BlcnR5KCdvYnNlcnZlcnMnKSkge1xyXG4gICAgICAgICAgbGV0IHN0b3JlZE9ic2VydmVycyA9IHN0b3JlZERhdGFPYmplY3RzLm9ic2VydmVycztcclxuICAgICAgICAgIGxldCBmcm9tRG9tYWluID0gZGl2aWRlVVJMKG1zZy5mcm9tKS5kb21haW47XHJcbiAgICBcclxuICAgICAgICAgIHJldHVybiBPYmplY3Qua2V5cyhzdG9yZWRPYnNlcnZlcnMpLmZpbHRlcigob2JqZWN0VVJMKSA9PiB7XHJcbiAgICAgICAgICAgIGxldCBzdWJzY3JpcHRpb25zID0gc3RvcmVkT2JzZXJ2ZXJzW29iamVjdFVSTF0uc3Vic2NyaXB0aW9ucztcclxuICAgICAgICAgICAgbGV0IGhhc1N1YnNjcmlwdGlvbiA9IGZhbHNlO1xyXG4gICAgICAgICAgICBzdWJzY3JpcHRpb25zLmZvckVhY2goZnVuY3Rpb24gKHN1YnNjcmlwdGlvbikge1xyXG4gICAgICAgICAgICAgIGxldCBzdWJzY3JpcHRpb25Eb21haW4gPSBkaXZpZGVVUkwoc3Vic2NyaXB0aW9uKS5kb21haW47XHJcbiAgICAgICAgICAgICAgaWYgKHN1YnNjcmlwdGlvbkRvbWFpbiA9PSBmcm9tRG9tYWluKSB7XHJcbiAgICAgICAgICAgICAgICBoYXNTdWJzY3JpcHRpb24gPSB0cnVlO1xyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIGlmIChoYXNTdWJzY3JpcHRpb24pIHtcclxuICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfSkubGVuZ3RoID4gMCA/IHRydWUgOiBmYWxzZTtcclxuICAgICAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBAcHJpdmF0ZVxyXG4gICAqIEB0b2RvIGRvY3VtZW50YXRpb25cclxuICAgKi9cclxuICBfaXNPd25lcih2YWx1ZSwgdXJsKSB7XHJcbiAgICBpZiAoIXZhbHVlKSByZXR1cm4gZmFsc2U7XHJcbiAgICByZXR1cm4gdmFsdWUucmVwb3J0ZXIgPT09IHVybCA/IHRydWUgOiBmYWxzZTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEBwcml2YXRlXHJcbiAgICogQHRvZG8gZG9jdW1lbnRhdGlvblxyXG4gICAqL1xyXG4gIF9pbnRlcnNlY3Rpb24oKSB7XHJcbiAgICBsZXQgYXJncyA9IEFycmF5LmZyb20oYXJndW1lbnRzKTtcclxuXHJcbiAgICBsZXQgcmVzdWx0ID0gYXJncy5yZWR1Y2UoKGZpcnN0LCBzZWNvbmQpID0+IHtcclxuICAgICAgcmV0dXJuIGZpcnN0LmNvbmNhdChzZWNvbmQpO1xyXG4gICAgfSkuZmlsdGVyKCh2YWx1ZSwgaW5kZXgsIHNlbGYpID0+IHtcclxuICAgICAgcmV0dXJuIHNlbGYuaW5kZXhPZih2YWx1ZSkgPT09IGluZGV4O1xyXG4gICAgfSk7XHJcbiAgICBsb2cubG9nKCdEYXRhT2JqZWN0c1N0b3JhZ2UuX2ludGVyc2VjdGlvbl0gUmVzdWx0IGFuIHVuaXF1ZSBhcnJheSBvZiBzdHJpbmdzOiAnLCByZXN1bHQpO1xyXG4gICAgcmV0dXJuIHJlc3VsdDtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEBwcml2YXRlXHJcbiAgICogQHRvZG8gZG9jdW1lbnRhdGlvblxyXG4gICAqL1xyXG4gIF91cGRhdGVUb0FycmF5KHN0b3JlRGF0YU9iamVjdCwgcmVzb3VyY2UsIGtleSwgdmFsdWUpIHtcclxuICAgIGxvZy5sb2coJ1tEYXRhT2JqZWN0c1N0b3JhZ2VdIC0gX3VwZGF0ZVRvQXJyYXk6ICcsIHN0b3JlRGF0YU9iamVjdCwgcmVzb3VyY2UsIGtleSwgdmFsdWUpO1xyXG4gICAgaWYgKHN0b3JlRGF0YU9iamVjdFtyZXNvdXJjZV1ba2V5XS5pbmRleE9mKHZhbHVlKSA9PT0gLTEpIHN0b3JlRGF0YU9iamVjdFtyZXNvdXJjZV1ba2V5XS5wdXNoKHZhbHVlKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEBwcml2YXRlXHJcbiAgICogQHRvZG8gZG9jdW1lbnRhdGlvblxyXG4gICAqL1xyXG4gIF9yZW1vdmVGcm9tQXJyYXkoc3RvcmVEYXRhT2JqZWN0LCByZXNvdXJjZSwga2V5LCB2YWx1ZSkge1xyXG4gICAgbGV0IGluZGV4T2ZWYWx1ZSA9IHN0b3JlRGF0YU9iamVjdFtyZXNvdXJjZV1ba2V5XS5pbmRleE9mKHZhbHVlKTtcclxuICAgIGlmIChpbmRleE9mVmFsdWUgPT09IC0xKSBzdG9yZURhdGFPYmplY3RbcmVzb3VyY2VdW2tleV0uc3BsaWNlKGluZGV4T2ZWYWx1ZSwgMSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBAcHJpdmF0ZVxyXG4gICAqIEB0b2RvIGRvY3VtZW50YXRpb25cclxuICAgKi9cclxuICBfaGFzVmFsdWUob2JqLCBrZXksIHZhbHVlKSB7XHJcbiAgICByZXR1cm4gb2JqLmhhc093blByb3BlcnR5KGtleSkgJiYgb2JqW2tleV0gPT09IHZhbHVlO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQHByaXZhdGVcclxuICAgKiBAdG9kbyBkb2N1bWVudGF0aW9uXHJcbiAgICovXHJcbiAgX2dldFR5cGVPZk9iamVjdChpc1JlcG9ydGVyKSB7XHJcbiAgICByZXR1cm4gaXNSZXBvcnRlciA/ICdyZXBvcnRlcnMnIDogJ29ic2VydmVycyc7XHJcbiAgfVxyXG5cclxufVxyXG5cclxuZXhwb3J0IGRlZmF1bHQgRGF0YU9iamVjdHNTdG9yYWdlO1xyXG4iLCJjbGFzcyBQcm9taXNlUXVldWUge1xyXG5cclxuICAvLyBUT0RPOiBJbXByb3ZlIHRoaXMgUXVldWluZ1xyXG4gIGNvbnN0cnVjdG9yKGNvbmN1cnJlbmN5KSB7XHJcbiAgICB0aGlzLmZsdXNoaW5nID0gZmFsc2U7XHJcbiAgICB0aGlzLlByb21pc2UgPSBQcm9taXNlO1xyXG4gICAgdGhpcy5jb25jdXJyZW5jeSA9ICh0eXBlb2YgY29uY3VycmVuY3kgIT09ICdudW1iZXInKSA/IDEgOiBjb25jdXJyZW5jeTtcclxuICAgIHRoaXMucHJvbWlzZXMgPSBbXTtcclxuICAgIHRoaXMucXVldWUgPSBbXTtcclxuICAgIHRoaXMuaXNQcm9jZXNzaW5nID0gZmFsc2U7XHJcbiAgfVxyXG5cclxuICBkb25lKGNiKSB7XHJcbiAgICB0aGlzLmNhbGxiYWNrID0gY2I7XHJcbiAgfVxyXG5cclxuICBhZGQocHJvbWlzZSkge1xyXG4gICAgdGhpcy5xdWV1ZS5wdXNoKHByb21pc2UpO1xyXG5cclxuICAgIGlmICghdGhpcy5pc1Byb2Nlc3NpbmcpIHtcclxuICAgICAgcmV0dXJuIHRoaXMucXVldWUucmVkdWNlKChwcm9taXNlQ2hhaW4sIGN1cnJlbnRUYXNrKSA9PiB7XHJcbiAgICAgICAgcmV0dXJuIHByb21pc2VDaGFpbi50aGVuKGNoYWluUmVzdWx0cyA9PiBjdXJyZW50VGFzay50aGVuKGN1cnJlbnRSZXN1bHQgPT4gWy4uLmNoYWluUmVzdWx0cywgY3VycmVudFJlc3VsdF0pKTtcclxuICAgICAgfSwgUHJvbWlzZS5yZXNvbHZlKFtdKSkudGhlbihhcnJheU9mUmVzdWx0cyA9PiB7XHJcbiAgICAgICAgLy8gRG8gc29tZXRoaW5nIHdpdGggYWxsIHJlc3VsdHNcclxuICAgICAgICB0aGlzLmlzUHJvY2Vzc2luZyA9IGZhbHNlO1xyXG4gICAgICB9KTtcclxuXHJcbiAgICB9XHJcbiAgfVxyXG5cclxufVxyXG5cclxuZXhwb3J0IGRlZmF1bHQgUHJvbWlzZVF1ZXVlO1xyXG5cclxuIiwiLy8gTG9nIFN5c3RlbVxyXG5pbXBvcnQgKiBhcyBsb2dnZXIgZnJvbSAnbG9nbGV2ZWwnO1xyXG5sZXQgbG9nID0gbG9nZ2VyLmdldExvZ2dlcignSHlwZXJ0eVJlc291cmNlc1N0b3JhZ2UnKTtcclxuXHJcbmltcG9ydCB7IGdlbmVyYXRlR1VJRCwgZGVlcENsb25lLCBhdmFpbGFibGVTcGFjZSB9IGZyb20gJy4uL3V0aWxzL3V0aWxzJztcclxuXHJcbmltcG9ydCBQcm9taXNlUXVldWUgZnJvbSAnLi4vdXRpbHMvUHJvbWlzZVF1ZXVlJztcclxuXHJcbmNsYXNzIEh5cGVydHlSZXNvdXJjZXNTdG9yYWdlIHtcclxuXHJcbiAgY29uc3RydWN0b3IocnVudGltZVVSTCwgYnVzLCBzdG9yYWdlTWFuYWdlciwgaHlwZXJ0eVJlc291cmNlcykge1xyXG5cclxuICAgIGlmICghc3RvcmFnZU1hbmFnZXIpIHRocm93IG5ldyBFcnJvcignW0h5cGVydHlSZXNvdXJjZXNTdG9yYWdlIGNvbnN0cnVjdG9yXSBtYW5kYXRvcnkgc3RvcmFnZU1hbmFnZXIgcGFyYW1ldGVyIG1pc3NpbmcnKTtcclxuICAgIGlmICghcnVudGltZVVSTCkgdGhyb3cgbmV3IEVycm9yKCdbSHlwZXJ0eVJlc291cmNlc1N0b3JhZ2UgY29uc3RydWN0b3JdIG1hbmRhdG9yeSBydW50aW1lVVJMIHBhcmFtZXRlciBtaXNzaW5nJyk7XHJcbiAgICBpZiAoIWJ1cykgdGhyb3cgbmV3IEVycm9yKCdbSHlwZXJ0eVJlc291cmNlc1N0b3JhZ2UgY29uc3RydWN0b3JdIG1hbmRhdG9yeSBidXMgcGFyYW1ldGVyIG1pc3NpbmcnKTtcclxuXHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG5cclxuICAgIF90aGlzLl9idXMgPSBidXM7XHJcblxyXG4gICAgX3RoaXMuX3N0b3JhZ2VMaW1pdCA9IDAuOTsgLy8gdGhlIHNhdmUgc3RvcmFnZUxpbWl0O1xyXG5cclxuICAgIF90aGlzLl91cmwgPSBydW50aW1lVVJMICsgJy9zdG9yYWdlJztcclxuXHJcbiAgICBfdGhpcy5fc3RvcmFnZU1hbmFnZXIgPSBzdG9yYWdlTWFuYWdlcjtcclxuXHJcbiAgICBfdGhpcy5wcm9taXNlUXVldWUgPSBuZXcgUHJvbWlzZVF1ZXVlKCk7XHJcblxyXG4gICAgX3RoaXMuX2h5cGVydHlSZXNvdXJjZXMgPSBoeXBlcnR5UmVzb3VyY2VzO1xyXG5cclxuICAgIGJ1cy5hZGRMaXN0ZW5lcihfdGhpcy5fdXJsLCAobXNnKSA9PiB7XHJcbiAgICAgIGxvZy5pbmZvKCdbSHlwZXJ0eVJlc291cmNlc1N0b3JhZ2VdIE1lc3NhZ2UgUkNWOiAnLCBtc2cpO1xyXG4gICAgICBzd2l0Y2ggKG1zZy50eXBlKSB7XHJcbiAgICAgICAgY2FzZSAnY3JlYXRlJzogX3RoaXMuX29uQ3JlYXRlKG1zZyk7IGJyZWFrO1xyXG4gICAgICAgIGNhc2UgJ3JlYWQnOiBfdGhpcy5fb25SZWFkKG1zZyk7IGJyZWFrO1xyXG4gICAgICAgIGNhc2UgJ2RlbGV0ZSc6IF90aGlzLl9vbkRlbGV0ZShtc2cpOyBicmVhaztcclxuICAgICAgfVxyXG4gICAgfSk7XHJcblxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogY2hlY2sgdGhlIGF2YWlsYWJsZSBzdG9yYWdlIHF1b3RhXHJcbiAgICpcclxuICAgKiBAbWVtYmVyb2YgSHlwZXJ0eVJlc291cmNlc1N0b3JhZ2VcclxuICAgKi9cclxuICBjaGVja1N0b3JhZ2VRdW90YSgpIHtcclxuXHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xyXG5cclxuICAgICAgaWYgKHRoaXMuX2F2YWlsYWJsZVF1b3RhICYmIHRoaXMuX3VzYWdlKSB7XHJcbiAgICAgICAgcmV0dXJuIHJlc29sdmUoYXZhaWxhYmxlU3BhY2UodGhpcy5fdXNhZ2UsIHRoaXMuX2F2YWlsYWJsZVF1b3RhKSk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGlmIChuYXZpZ2F0b3IpIHtcclxuXHJcbiAgICAgICAgbmF2aWdhdG9yLnN0b3JhZ2UuZXN0aW1hdGUoKS50aGVuKChlc3RpbWF0ZSkgPT4ge1xyXG4gICAgICAgICAgdGhpcy5fYXZhaWxhYmxlUXVvdGEgPSBlc3RpbWF0ZS5xdW90YTtcclxuICAgICAgICAgIHRoaXMuX3VzYWdlID0gZXN0aW1hdGUudXNhZ2U7XHJcbiAgICAgICAgICByZXNvbHZlKGF2YWlsYWJsZVNwYWNlKHRoaXMuX3VzYWdlLCB0aGlzLl9hdmFpbGFibGVRdW90YSkpO1xyXG5cclxuICAgICAgICB9KS5jYXRjaCgocmVhc29uKSA9PiB7XHJcbiAgICAgICAgICBsb2cuZXJyb3IoJ1tIeXBlcnR5UmVzb3VyY2VzU3RvcmFnZV0gQ2hlY2tTdG9yYWdlUXVvdGEgZXJyb3I6ICcsIHJlYXNvbik7XHJcbiAgICAgICAgICByZWplY3QocmVhc29uKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgIH1cclxuXHJcbiAgICB9KTtcclxuXHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBAZGVzY3JpcHRpb24gc2hvdWxkIHNhdmUgYW4gSHlwZXJ0eVJlc291cmNlIGNvbnRhaW5lZCBpbiB0aGUgYm9keSBvZiBhIGNyZWF0ZSBtZXNzYWdlIHJlcXVlc3Q7XHJcbiAgICpcclxuICAgKiBAcGFyYW0ge3N0cmluZ30gbWVzc2FnZSAtIG1lc3NhZ2UgY29udGFpbmluZyB0aGUgaHlwZXJ0eSByZXNvdXJjZSB0byBiZSBzdG9yZWRcclxuICAgKi9cclxuXHJcbiAgX29uQ3JlYXRlKG1lc3NhZ2UpIHtcclxuXHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG5cclxuICAgIGlmICghbWVzc2FnZS5ib2R5IHx8ICFtZXNzYWdlLmJvZHkudmFsdWUpIHRocm93IG5ldyBFcnJvcignW0h5cGVydHlSZXNvdXJjZXNTdG9yYWdlLl9vbkNyZWF0ZV0gbWFuZGF0b3J5IG1lc3NhZ2UgYm9keSB2YWx1ZSBtaXNzaW5nOiAnLCBtZXNzYWdlKTtcclxuXHJcbiAgICBsZXQgY29udGVudCA9IG1lc3NhZ2UuYm9keS52YWx1ZTtcclxuICAgIGxldCBjb250ZW50VVJMID0gY29udGVudC5jb250ZW50VVJMO1xyXG4gICAgbGV0IHJlc291cmNlVVJMID0gJyc7XHJcblxyXG4gICAgaWYgKCFjb250ZW50VVJMKSB7XHJcblxyXG4gICAgICBjb250ZW50VVJMID0gW107XHJcbiAgICAgIHJlc291cmNlVVJMID0gX3RoaXMuX3VybCArICcvJyArIGdlbmVyYXRlR1VJRCgpO1xyXG5cclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGNvbnN0IGN1cnJlbnRVUkwgPSBjb250ZW50VVJMWzBdO1xyXG4gICAgICBjb25zdCByZXNvdXJjZSA9IGN1cnJlbnRVUkwuc3Vic3RyKGN1cnJlbnRVUkwubGFzdEluZGV4T2YoJy8nKSArIDEpO1xyXG4gICAgICByZXNvdXJjZVVSTCA9IF90aGlzLl91cmwgKyAnLycgKyByZXNvdXJjZTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAoIV90aGlzLl9oeXBlcnR5UmVzb3VyY2VzLmhhc093blByb3BlcnR5KHJlc291cmNlVVJMKSkge1xyXG5cclxuICAgICAgY29udGVudFVSTC5wdXNoKHJlc291cmNlVVJMKTtcclxuICAgICAgY29udGVudC5jb250ZW50VVJMID0gY29udGVudFVSTDtcclxuXHJcbiAgICB9XHJcblxyXG4gICAgdGhpcy5faHlwZXJ0eVJlc291cmNlc1tyZXNvdXJjZVVSTF0gPSBjb250ZW50O1xyXG5cclxuICAgIHRoaXMucHJvbWlzZVF1ZXVlLmFkZCh0aGlzLl90b1NhdmUocmVzb3VyY2VVUkwsIG1lc3NhZ2UsIGNvbnRlbnQpKTtcclxuXHJcbiAgfVxyXG5cclxuICBfdG9TYXZlKHJlc291cmNlVVJMLCBtZXNzYWdlLCBjb250ZW50KSB7XHJcblxyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcclxuXHJcbiAgICAgIGNvbnN0IGVycm9yID0gKHJlYXNvbikgPT4ge1xyXG4gICAgICAgIGxldCByZXNwb25zZSA9IHtcclxuICAgICAgICAgIGZyb206IG1lc3NhZ2UudG8sXHJcbiAgICAgICAgICB0bzogbWVzc2FnZS5mcm9tLFxyXG4gICAgICAgICAgaWQ6IG1lc3NhZ2UuaWQsXHJcbiAgICAgICAgICB0eXBlOiAncmVzcG9uc2UnLFxyXG4gICAgICAgICAgYm9keTogeyB2YWx1ZTogcmVzb3VyY2VVUkwsIGNvZGU6IDUwMCwgZGVzY3JpcHRpb246IHJlYXNvbiB9XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdGhpcy5fYnVzLnBvc3RNZXNzYWdlKHJlc3BvbnNlKTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHJlamVjdChyZWFzb24pO1xyXG4gICAgICB9O1xyXG5cclxuICAgICAgdGhpcy5jaGVja1N0b3JhZ2VRdW90YSgpLnRoZW4oKHJlc3VsdCkgPT4ge1xyXG5cclxuICAgICAgICBpZiAoY29udGVudC5zaXplID4gcmVzdWx0LnF1b3RhKSB7XHJcbiAgICAgICAgICBjb25zdCBtc2cgPSAnVGhlIHN0b3JhZ2UgZG8gbm90IGhhdmUgc3BhY2UgdG8gc3RvcmUgdGhhdCByZXNvdXJjZSc7XHJcbiAgICAgICAgICBlcnJvcihtc2cpO1xyXG4gICAgICAgICAgdGhyb3cgRXJyb3IobXNnKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IHNwYWNlQXZhaWxhYmxlID0gcmVzdWx0LnF1b3RhO1xyXG4gICAgICAgIGNvbnN0IGFsbG9jYXRlZCA9IHJlc3VsdC51c2FnZSArIGNvbnRlbnQuc2l6ZTtcclxuXHJcbiAgICAgICAgaWYgKHJlc3VsdC5wZXJjZW50ID49IHRoaXMuX3N0b3JhZ2VMaW1pdCB8fCBhbGxvY2F0ZWQgPiBzcGFjZUF2YWlsYWJsZSkge1xyXG4gICAgICAgICAgcmV0dXJuIHRoaXMuX2dldE9sZGVyUmVzb3VyY2VzKGNvbnRlbnQuc2l6ZSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgIH0pLnRoZW4oKCkgPT4ge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9zdG9yYWdlTWFuYWdlci5zZXQocmVzb3VyY2VVUkwsIDEsIGNvbnRlbnQpO1xyXG4gICAgICB9KS50aGVuKCgpID0+IHtcclxuXHJcbiAgICAgICAgbGV0IHJlc3BvbnNlID0ge1xyXG4gICAgICAgICAgZnJvbTogbWVzc2FnZS50byxcclxuICAgICAgICAgIHRvOiBtZXNzYWdlLmZyb20sXHJcbiAgICAgICAgICBpZDogbWVzc2FnZS5pZCxcclxuICAgICAgICAgIHR5cGU6ICdyZXNwb25zZScsXHJcbiAgICAgICAgICBib2R5OiB7IHZhbHVlOiByZXNvdXJjZVVSTCwgY29kZTogMjAwIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB0aGlzLl9idXMucG9zdE1lc3NhZ2UocmVzcG9uc2UpO1xyXG5cclxuICAgICAgICBsb2cubG9nKCdTdWNjZXNzJyk7XHJcblxyXG4gICAgICAgIHJldHVybiByZXNvbHZlKCk7XHJcblxyXG4gICAgICB9KS5jYXRjaChlcnJvcik7XHJcblxyXG4gICAgfSk7XHJcblxyXG4gIH1cclxuXHJcbiAgX2dldE9sZGVyUmVzb3VyY2VzKHNpemUpIHtcclxuXHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xyXG5cclxuICAgICAgdGhpcy5fc3RvcmFnZU1hbmFnZXIuZ2V0KCkudGhlbigocmVzdWx0KSA9PiB7XHJcblxyXG4gICAgICAgIGNvbnN0IHJlc291cmNlcyA9IE9iamVjdC5rZXlzKHJlc3VsdCk7XHJcblxyXG4gICAgICAgIGxldCB0b3RhbCA9IDA7XHJcbiAgICAgICAgY29uc3QgcmVkdWNlZCA9IHJlc291cmNlcy5zb3J0KChhLCBiKSA9PiByZXN1bHRbYV0uY3JlYXRlZCA8IHJlc3VsdFtiXS5jcmVhdGVkKVxyXG4gICAgICAgICAgLnJlZHVjZSgocHJldmlvdXNSZXNvdXJjZSwgY3VycmVudFJlc291cmNlKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IGN1cnJlbnQgPSB0aGlzLl9oeXBlcnR5UmVzb3VyY2VzW2N1cnJlbnRSZXNvdXJjZV07XHJcblxyXG4gICAgICAgICAgICBsb2cubG9nKCdbSHlwZXJ0eVJlc291cmNlc1N0b3JhZ2VdIF9nZXRPbGRlclJlc291cmNlczogJywgdG90YWwsIHNpemUsIGN1cnJlbnRSZXNvdXJjZSwgdGhpcy5fYXZhaWxhYmxlUXVvdGEpO1xyXG5cclxuICAgICAgICAgICAgaWYgKHRvdGFsIDw9IHNpemUpIHtcclxuICAgICAgICAgICAgICB0b3RhbCArPSBjdXJyZW50LnNpemU7XHJcbiAgICAgICAgICAgICAgcHJldmlvdXNSZXNvdXJjZS5wdXNoKGN1cnJlbnRSZXNvdXJjZSk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHJldHVybiBwcmV2aW91c1Jlc291cmNlO1xyXG5cclxuICAgICAgICAgIH0sIFtdKTtcclxuXHJcbiAgICAgICAgY29uc3QgZGVsZXRpbmcgPSByZWR1Y2VkLm1hcChrZXkgPT4gdGhpcy5fc3RvcmFnZU1hbmFnZXIuZGVsZXRlKGtleSkpO1xyXG5cclxuICAgICAgICBQcm9taXNlLmFsbChkZWxldGluZykudGhlbigoKSA9PiB7XHJcbiAgICAgICAgICByZXNvbHZlKHRydWUpO1xyXG4gICAgICAgIH0pLmNhdGNoKChyZWFzb24pID0+IHtcclxuICAgICAgICAgIHJlamVjdChyZWFzb24pO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgfSk7XHJcblxyXG4gICAgfSk7XHJcblxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQGRlc2NyaXB0aW9uIHNob3VsZCByZXR1cm4gYW4gSHlwZXJ0eVJlc291cmNlIHN0b3JlZCBpbiB0aGUgU3RvcmFnZSBNYW5hZ2VyIGlkZW50aWZpZWQgYnkgdGhlIGNvbnRlbnQgdXJsIGNvbnRhaW5lZCBpbiB0aGUgYm9keSBvZiBhIHJlYWQgbWVzc2FnZSByZXF1ZXN0O1xyXG4gICAqXHJcbiAgICogQHBhcmFtIHtzdHJpbmd9IG1lc3NhZ2UgLSBtZXNzYWdlIGNvbnRhaW5pbmcgdGhlIGh5cGVydHkgcmVzb3VyY2UgdG8gYmUgc3RvcmVkXHJcbiAgICovXHJcblxyXG4gIF9vblJlYWQobWVzc2FnZSkge1xyXG5cclxuICAgIGxldCBfdGhpcyA9IHRoaXM7XHJcblxyXG4gICAgaWYgKCFtZXNzYWdlLmJvZHkgfHwgIW1lc3NhZ2UuYm9keS5yZXNvdXJjZSkgdGhyb3cgbmV3IEVycm9yKCdbSHlwZXJ0eVJlc291cmNlc1N0b3JhZ2UuX29uUmVhZF0gbWFuZGF0b3J5IG1lc3NhZ2UgYm9keSByZXNvdXJjZSBtaXNzaW5nOiAnLCBtZXNzYWdlKTtcclxuXHJcbiAgICBsZXQgY29udGVudFVybCA9IG1lc3NhZ2UuYm9keS5yZXNvdXJjZTtcclxuXHJcbiAgICBsZXQgcmVzcG9uc2UgPSB7XHJcbiAgICAgIGZyb206IG1lc3NhZ2UudG8sXHJcbiAgICAgIHRvOiBtZXNzYWdlLmZyb20sXHJcbiAgICAgIGlkOiBtZXNzYWdlLmlkLFxyXG4gICAgICB0eXBlOiAncmVzcG9uc2UnLFxyXG4gICAgICBib2R5OiB7fVxyXG4gICAgfTtcclxuXHJcbiAgICAvLyBsZXQgY29udGVudCA9IF90aGlzLl9oeXBlcnR5UmVzb3VyY2VzW2NvbnRlbnRVcmxdO1xyXG5cclxuICAgIGxvZy5pbmZvKCdbSHlwZXJ0eVJlc291cmNlc1N0b3JhZ2UuX29uUmVhZF0gZ2V0IHJlc291cmNlVVJMOicsIGNvbnRlbnRVcmwpO1xyXG5cclxuICAgIHRoaXMuX3N0b3JhZ2VNYW5hZ2VyLmdldCgncmVzb3VyY2VVUkwnLCBjb250ZW50VXJsKS50aGVuKChjb250ZW50KSA9PiB7XHJcblxyXG4gICAgICBsb2cuaW5mbygnW0h5cGVydHlSZXNvdXJjZXNTdG9yYWdlLl9vblJlYWRdIGZvdW5kIGNvbnRlbnQ6JywgY29udGVudCk7XHJcblxyXG4gICAgICBpZiAoY29udGVudCkge1xyXG5cclxuICAgICAgICBpZiAoY29udGVudC5yZXNvdXJjZVR5cGUgPT09ICdmaWxlJykge1xyXG4gICAgICAgICAgX3RoaXMuX29uUmVhZEZpbGUocmVzcG9uc2UsIGNvbnRlbnQpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICByZXNwb25zZS5ib2R5LmNvZGUgPSAyMDA7XHJcbiAgICAgICAgICByZXNwb25zZS5ib2R5LnAycCA9IHRydWU7XHJcbiAgICAgICAgICByZXNwb25zZS5ib2R5LnZhbHVlID0gY29udGVudDtcclxuICAgICAgICAgIF90aGlzLl9idXMucG9zdE1lc3NhZ2UocmVzcG9uc2UpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgcmVzcG9uc2UuYm9keS5jb2RlID0gNDA0O1xyXG4gICAgICAgIHJlc3BvbnNlLmJvZHkuZGVzYyA9ICdDb250ZW50IE5vdCBGb3VuZCBmb3IgJyArIGNvbnRlbnRVcmw7XHJcbiAgICAgICAgX3RoaXMuX2J1cy5wb3N0TWVzc2FnZShyZXNwb25zZSk7XHJcblxyXG4gICAgICB9XHJcblxyXG4gICAgfSk7XHJcblxyXG4gICAgLy9yZXNwb25zZS5ib2R5LmNvZGUgPSA0MDQ7XHJcblxyXG4gICAgLy9fdGhpcy5faHlwZXJ0eVJlc291cmNlc1tjb250ZW50VXJsXSA9IG1lc3NhZ2UuYm9keS52YWx1ZTtcclxuXHJcblxyXG4gIH1cclxuXHJcbiAgX29uUmVhZEZpbGUocmVzcG9uc2UsIHJlc291cmNlKSB7XHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG5cclxuICAgIGxldCByZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpO1xyXG5cclxuICAgIHJlYWRlci5vbmxvYWQgPSBmdW5jdGlvbih0aGVGaWxlKSB7XHJcblxyXG4gICAgICBsb2cuaW5mbygnW0ZpbGVIeXBlcnR5UmVzb3VyY2UuaW5pdF0gZmlsZSBsb2FkZWQgJywgdGhlRmlsZSk7XHJcblxyXG4gICAgICByZXNwb25zZS5ib2R5LmNvZGUgPSAyMDA7XHJcbiAgICAgIHJlc3BvbnNlLmJvZHkucDJwID0gdHJ1ZTtcclxuICAgICAgcmVzcG9uc2UuYm9keS52YWx1ZSA9IGRlZXBDbG9uZShyZXNvdXJjZSk7XHJcbiAgICAgIHJlc3BvbnNlLmJvZHkudmFsdWUuY29udGVudCA9IHRoZUZpbGUudGFyZ2V0LnJlc3VsdDtcclxuICAgICAgX3RoaXMuX2J1cy5wb3N0TWVzc2FnZShyZXNwb25zZSk7XHJcbiAgICB9O1xyXG5cclxuICAgIGlmIChyZXNvdXJjZS5taW1ldHlwZS5pbmNsdWRlcygndGV4dC8nKSkge1xyXG4gICAgICByZWFkZXIucmVhZEFzVGV4dChyZXNvdXJjZS5jb250ZW50KTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGNvbnN0IGN1cnJlbnQgPSByZXNvdXJjZS5jb250ZW50O1xyXG5cclxuICAgICAgbGV0IGJsb2I7XHJcbiAgICAgIGlmIChBcnJheS5pc0FycmF5KGN1cnJlbnQpKSB7XHJcbiAgICAgICAgYmxvYiA9IG5ldyBCbG9iKGN1cnJlbnQsIHsgdHlwZTogcmVzb3VyY2UubWltZXR5cGV9KTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBibG9iID0gbmV3IEJsb2IoW2N1cnJlbnRdLCB7IHR5cGU6IHJlc291cmNlLm1pbWV0eXBlfSk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIHJlYWRlci5yZWFkQXNBcnJheUJ1ZmZlcihibG9iKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEBkZXNjcmlwdGlvbiBzaG91bGQgZGVsZXRlIGFuIEh5cGVydHlSZXNvdXJjZSBmcm9tIHRoZSBzdG9yYWdlO1xyXG4gICAqXHJcbiAgICogQHBhcmFtIHtzdHJpbmd9IG1lc3NhZ2UgLSBtZXNzYWdlIGNvbnRhaW5pbmcgdGhlIGNvbnRlbnQgVVJMIG9mIHRoZSBoeXBlcnR5IHJlc291cmNlIHRvIGJlIGRlbGV0ZWRcclxuICAgKi9cclxuXHJcbiAgX29uRGVsZXRlKG1lc3NhZ2UpIHtcclxuXHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG5cclxuICAgIGlmICghbWVzc2FnZS5ib2R5KSB0aHJvdyBuZXcgRXJyb3IoJ1tIeXBlcnR5UmVzb3VyY2VzU3RvcmFnZS5fb25EZWxldGVdIG1hbmRhdG9yeSBtZXNzYWdlIGJvZHkgbWlzc2luZzogJywgbWVzc2FnZSk7XHJcblxyXG4gICAgaWYgKG1lc3NhZ2UuYm9keS5yZXNvdXJjZSkge1xyXG4gICAgICBkZWxldGUgX3RoaXMuX2h5cGVydHlSZXNvdXJjZXNbbWVzc2FnZS5ib2R5LnJlc291cmNlXTtcclxuICAgIH0gZWxzZSBpZiAobWVzc2FnZS5ib2R5LnJlc291cmNlcykge1xyXG4gICAgICBtZXNzYWdlLmJvZHkucmVzb3VyY2VzLmZvckVhY2goKHJlc291cmNlKSA9PiB7XHJcbiAgICAgICAgZGVsZXRlIF90aGlzLl9oeXBlcnR5UmVzb3VyY2VzW3Jlc291cmNlXTtcclxuICAgICAgfSk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ1tIeXBlcnR5UmVzb3VyY2VzU3RvcmFnZS5fb25EZWxldGVdIG1hbmRhdG9yeSByZXNvdXJjZSBtaXNzaW5nOiAnLCBtZXNzYWdlKTtcclxuICAgIH1cclxuXHJcbiAgICBfdGhpcy5fc3RvcmFnZU1hbmFnZXIuZGVsZXRlKCdyZXNvdXJjZVVSTCcsIG1lc3NhZ2UuYm9keS5yZXNvdXJjZSkudGhlbigoKSA9PiB7XHJcbiAgICAgIGxldCByZXNwb25zZSA9IHtcclxuICAgICAgICBmcm9tOiBtZXNzYWdlLnRvLFxyXG4gICAgICAgIHRvOiBtZXNzYWdlLmZyb20sXHJcbiAgICAgICAgaWQ6IG1lc3NhZ2UuaWQsXHJcbiAgICAgICAgdHlwZTogJ3Jlc3BvbnNlJyxcclxuICAgICAgICBib2R5OiB7IGNvZGU6IDIwMCB9XHJcbiAgICAgIH07XHJcblxyXG4gICAgICBfdGhpcy5fYnVzLnBvc3RNZXNzYWdlKHJlc3BvbnNlKTtcclxuICAgIH0pLmNhdGNoKChyZWFzb24pID0+IHtcclxuICAgICAgbGV0IHJlc3BvbnNlID0ge1xyXG4gICAgICAgIGZyb206IG1lc3NhZ2UudG8sXHJcbiAgICAgICAgdG86IG1lc3NhZ2UuZnJvbSxcclxuICAgICAgICBpZDogbWVzc2FnZS5pZCxcclxuICAgICAgICB0eXBlOiAncmVzcG9uc2UnLFxyXG4gICAgICAgIGJvZHk6IHsgY29kZTogNDAwLCBkZXNjcmlwdGlvbjogcmVhc29uIH1cclxuICAgICAgfTtcclxuXHJcbiAgICAgIF90aGlzLl9idXMucG9zdE1lc3NhZ2UocmVzcG9uc2UpO1xyXG4gICAgfSk7XHJcblxyXG4gIH1cclxuXHJcbn1cclxuXHJcbmV4cG9ydCBkZWZhdWx0IEh5cGVydHlSZXNvdXJjZXNTdG9yYWdlO1xyXG4iLCIvLyBMb2cgU3lzdGVtXHJcbmltcG9ydCAqIGFzIGxvZ2dlciBmcm9tICdsb2dsZXZlbCc7XHJcbmxldCBsb2cgPSBsb2dnZXIuZ2V0TG9nZ2VyKCdTeW5TdWJzY3JpcHRpb24nKTtcclxuXHJcbmNsYXNzIFN1YnNjcmlwdGlvbiB7XHJcblxyXG4gIGNvbnN0cnVjdG9yKGJ1cywgb3duZXIsIHVybCwgaXNSZXBvcnRlcikge1xyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuICAgIGxldCBjaGlsZEJhc2VVUkwgPSB1cmwgKyAnL2NoaWxkcmVuLyc7XHJcbiAgICBsZXQgY2hhbmdlVVJMID0gdXJsICsgJy9jaGFuZ2VzJztcclxuXHJcbiAgICAvL3Byb2Nlc3MgZGVsZXRlIG1lc3NhZ2VcclxuICAgIF90aGlzLl9kZWxldGVMaXN0ZW5lciA9IGJ1cy5hZGRMaXN0ZW5lcihjaGFuZ2VVUkwsIChtc2cpID0+IHtcclxuICAgICAgaWYgKG1zZy50eXBlID09PSAnZGVsZXRlJykge1xyXG4gICAgICAgIGxvZy5sb2coJ1N1YnNjcmlwdGlvbi1ERUxFVEU6ICcsIG1zZyk7XHJcblxyXG4gICAgICAgIC8vRkxPVy1PVVQ6IG1lc3NhZ2Ugc2VudCB0byBhbGwgc3Vic2NyaWJlcnNcclxuICAgICAgICBsZXQgZGVsZXRlTWVzc2FnZVRvSHlwZXJ0eSA9IHtcclxuICAgICAgICAgIHR5cGU6ICdkZWxldGUnLCBmcm9tOiBtc2cuZnJvbSwgdG86IG93bmVyLFxyXG4gICAgICAgICAgYm9keTogeyBpZGVudGl0eTogbXNnLmJvZHkuaWRlbnRpdHksIHJlc291cmNlOiB1cmwgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIC8vc2VuZCBkZWxldGUgdG8gaHlwZXJ0eVxyXG4gICAgICAgIGJ1cy5wb3N0TWVzc2FnZShkZWxldGVNZXNzYWdlVG9IeXBlcnR5LCAocmVwbHkpID0+IHtcclxuICAgICAgICAgIGxvZy5sb2coJ1N1YnNjcmlwdGlvbi1ERUxFVEUtUkVQTFk6ICcsIHJlcGx5KTtcclxuICAgICAgICAgIGlmIChyZXBseS5ib2R5LmNvZGUgPT09IDIwMCkge1xyXG4gICAgICAgICAgICBfdGhpcy5fcmVsZWFzZUxpc3RlbmVycygpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuXHJcbiAgICAvL2FkZCBjaGFuZ2UgcHVibGlzaCBhZGRyZXNzIG9yIGZvcndhcmRcclxuICAgIGlmIChpc1JlcG9ydGVyKSB7XHJcbiAgICAgIF90aGlzLl9jaGFuZ2VMaXN0ZW5lciA9IGJ1cy5hZGRQdWJsaXNoKGNoYW5nZVVSTCk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBfdGhpcy5fY2hhbmdlTGlzdGVuZXIgPSBidXMuYWRkRm9yd2FyZChjaGFuZ2VVUkwsIG93bmVyKTtcclxuICAgIH1cclxuXHJcbiAgICBfdGhpcy5fY2hpbGRyZW5MaXN0ZW5lcnMgPSBbXTtcclxuLy8gICAgbG9nLmxvZygnW1N1YnNjcmlwdGlvbl0gLSBjaGlsZElEJywgY2hpbGRyZW5zKTtcclxuLy8gICAgY2hpbGRyZW5zLmZvckVhY2goKGNoaWxkKSA9PiB7XHJcbi8vICAgIGxldCBjaGlsZElkID0gY2hpbGRCYXNlVVJMICsgY2hpbGQ7XHJcblxyXG4vLyAgICAgIGxvZy5sb2coJ1tTdWJzY3JpcHRpb25dIC0gY2hpbGRJRCcsIGNoaWxkQmFzZVVSTCk7XHJcblxyXG4gICAgICAvL2FkZCBjaGlsZHJlbiBwdWJsaXNoIGFkZHJlc3NcclxuICAgICAgbGV0IGNoaWxkcmVuRm9yd2FyZCA9IGJ1cy5hZGRQdWJsaXNoKGNoaWxkQmFzZVVSTCk7XHJcbiAgICAgIF90aGlzLl9jaGlsZHJlbkxpc3RlbmVycy5wdXNoKGNoaWxkcmVuRm9yd2FyZCk7XHJcblxyXG4gICAgICAvL2FkZCBzZWxmIGZvcndhcmQgaWYgYW4gb2JzZXJ2ZXJcclxuICAgICAgaWYgKCFpc1JlcG9ydGVyKSB7XHJcbiAgICAgICAgbGV0IHNlbGZGb3J3YXJkID0gYnVzLmFkZEZvcndhcmQoY2hpbGRCYXNlVVJMLCBvd25lcik7XHJcbiAgICAgICAgX3RoaXMuX2NoaWxkcmVuTGlzdGVuZXJzLnB1c2goc2VsZkZvcndhcmQpO1xyXG4gICAgICB9XHJcbi8vICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgX3JlbGVhc2VMaXN0ZW5lcnMoKSB7XHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG5cclxuICAgIF90aGlzLl9kZWxldGVMaXN0ZW5lci5yZW1vdmUoKTtcclxuXHJcbiAgICBfdGhpcy5fY2hhbmdlTGlzdGVuZXIucmVtb3ZlKCk7XHJcblxyXG4gICAgX3RoaXMuX2NoaWxkcmVuTGlzdGVuZXJzLmZvckVhY2goKGZvcndhcmQpID0+IHtcclxuICAgICAgZm9yd2FyZC5yZW1vdmUoKTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbn1cclxuXHJcbmV4cG9ydCBkZWZhdWx0IFN1YnNjcmlwdGlvbjtcclxuIiwiLy8gTG9nIFN5c3RlbVxyXG5pbXBvcnQgKiBhcyBsb2dnZXIgZnJvbSAnbG9nbGV2ZWwnO1xyXG5sZXQgbG9nID0gbG9nZ2VyLmdldExvZ2dlcignUmVwb3J0ZXJPYmplY3QnKTtcclxuXHJcbmltcG9ydCB7IGRpdmlkZVVSTCwgc3BsaXRPYmplY3RVUkwgfSBmcm9tICcuLi91dGlscy91dGlscyc7XHJcbmltcG9ydCBTdWJzY3JpcHRpb24gZnJvbSAnLi9TdWJzY3JpcHRpb24nO1xyXG5pbXBvcnQgKiBhcyBjcnlwdG9NYW5hZ2VyIGZyb20gJy4uL2NyeXB0b01hbmFnZXIvQ3J5cHRvTWFuYWdlcic7XHJcblxyXG5jbGFzcyBSZXBvcnRlck9iamVjdCB7XHJcblxyXG4gIGNvbnN0cnVjdG9yKHBhcmVudCwgb3duZXIsIHVybCwgY2hpbGRyZW5zLCBvZmZsaW5lKSB7XHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG5cclxuICAgIF90aGlzLl9wYXJlbnQgPSBwYXJlbnQ7XHJcbiAgICBfdGhpcy5fb3duZXIgPSBvd25lcjtcclxuICAgIF90aGlzLl91cmwgPSB1cmw7XHJcblxyXG4gICAgX3RoaXMuX2J1cyA9IHBhcmVudC5fYnVzO1xyXG5cclxuICAgIF90aGlzLl9kb21haW4gPSBkaXZpZGVVUkwodXJsKS5kb21haW47XHJcbiAgICBfdGhpcy5fb2JqU3Vic2NyaXB0b3JVUkwgPSBfdGhpcy5fdXJsICsgJy9zdWJzY3JpcHRpb24nO1xyXG5cclxuICAgIF90aGlzLl9zdWJzY3JpcHRpb25zID0ge307XHJcbiAgICBfdGhpcy5fY2hpbGRyZW5zID0gY2hpbGRyZW5zO1xyXG4gICAgX3RoaXMuX2NoaWxkcmVuTGlzdGVuZXJzID0gW107XHJcblxyXG4gICAgX3RoaXMuX2ZvcndhcmRzID0ge307XHJcblxyXG4gICAgX3RoaXMuX2lzVG9TYXZlRGF0YSA9IGZhbHNlO1xyXG5cclxuICAgIF90aGlzLl9hbGxvY2F0ZUxpc3RlbmVycygpO1xyXG5cclxuICAgIF90aGlzLl9vZmZsaW5lID0gb2ZmbGluZSA/IG9mZmxpbmUgOiBmYWxzZTtcclxuICB9XHJcblxyXG4gIGdldCBvZmZsaW5lKCl7XHJcbiAgICByZXR1cm4gdGhpcy5fb2ZmbGluZTtcclxuICB9XHJcblxyXG4gIF9hbGxvY2F0ZUxpc3RlbmVycygpIHtcclxuICAgIGxldCBfdGhpcyA9IHRoaXM7XHJcblxyXG4gICAgLy9hZGQgc3Vic2NyaXB0aW9uIGxpc3RlbmVyLi4uXHJcbiAgICBfdGhpcy5fc3Vic2NyaXB0aW9uTGlzdGVuZXIgPSBfdGhpcy5fYnVzLmFkZExpc3RlbmVyKF90aGlzLl9vYmpTdWJzY3JpcHRvclVSTCwgKG1zZykgPT4ge1xyXG4gICAgICBsb2cuaW5mbygnW1N5bmNoZXJNYW5hZ2VyLlJlcG9ydGVyT2JqZWN0IHJlY2VpdmVkIF0nLCBtc2cpO1xyXG4gICAgICBzd2l0Y2ggKG1zZy50eXBlKSB7XHJcbiAgICAgICAgY2FzZSAnc3Vic2NyaWJlJzogX3RoaXMuX29uUmVtb3RlU3Vic2NyaWJlKG1zZyk7IGJyZWFrO1xyXG4gICAgICAgIGNhc2UgJ3Vuc3Vic2NyaWJlJzogX3RoaXMuX29uUmVtb3RlVW5TdWJzY3JpYmUobXNnKTsgYnJlYWs7XHJcbiAgICAgICAgY2FzZSAncmVzcG9uc2UnOiBfdGhpcy5fb25SZW1vdGVSZXNwb25zZShtc2cpOyBicmVhaztcclxuICAgICAgICBjYXNlICdmb3J3YXJkJzogX3RoaXMuX29uRm9yd2FyZGVkUmVtb3RlU3Vic2NyaWJlKG1zZyk7IGJyZWFrO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuXHJcbiAgICBsZXQgY2hhbmdlVVJMID0gX3RoaXMuX3VybCArICcvY2hhbmdlcyc7XHJcbiAgICBfdGhpcy5fY2hhbmdlTGlzdGVuZXIgPSBfdGhpcy5fYnVzLmFkZExpc3RlbmVyKGNoYW5nZVVSTCwgKG1zZykgPT4ge1xyXG5cclxuICAgICAgbG9nLmluZm8oJ1tTeW5jaGVyTWFuYWdlci5SZXBvcnRlck9iamVjdCBdIFN5bmNoZXJNYW5hZ2VyLScgKyBjaGFuZ2VVUkwgKyAnLVJDVjogJywgbXNnKTtcclxuXHJcbiAgICAgIC8vZG8gbm90IHNhdmUgY2hhbmdlcyB0byBiYWNrdXBSZXZpc2lvbiB0byBhdm9pZCBpbmZpbml0ZSBsb29wc1xyXG4gICAgICBpZiAodGhpcy5faXNUb1NhdmVEYXRhICYmIG1zZy5ib2R5LmF0dHJpYnV0ZSApIHtcclxuICAgICAgICBsZXQgdXBkYXRlUnVudGltZVN0YXR1cyA9IG1zZy5ib2R5LmF0dHJpYnV0ZSAhPT0gJ2JhY2t1cFJldmlzaW9uJyA/IHRydWUgOiBmYWxzZTtcclxuICAgICAgICBsb2cubG9nKCdbU3luY2hlck1hbmFnZXIuUmVwb3J0ZXJPYmplY3QgXSBTeW5jaGVyTWFuYWdlciAtIHNhdmUgZGF0YTogJywgbXNnKTtcclxuICAgICAgICBfdGhpcy5fcGFyZW50Ll9kYXRhT2JqZWN0c1N0b3JhZ2UudXBkYXRlKHRydWUsIF90aGlzLl91cmwsICd2ZXJzaW9uJywgbXNnLmJvZHkudmVyc2lvbiwgdXBkYXRlUnVudGltZVN0YXR1cyk7XHJcbiAgICAgICAgX3RoaXMuX3BhcmVudC5fZGF0YU9iamVjdHNTdG9yYWdlLnVwZGF0ZSh0cnVlLCBfdGhpcy5fdXJsLCAnbGFzdE1vZGlmaWVkJywgbXNnLmJvZHkubGFzdE1vZGlmaWVkLCB1cGRhdGVSdW50aW1lU3RhdHVzKTtcclxuICAgICAgICBfdGhpcy5fcGFyZW50Ll9kYXRhT2JqZWN0c1N0b3JhZ2Uuc2F2ZURhdGEodHJ1ZSwgX3RoaXMuX3VybCwgbXNnLmJvZHkuYXR0cmlidXRlLCBtc2cuYm9keS52YWx1ZSwgdXBkYXRlUnVudGltZVN0YXR1cyk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgc2V0IGlzVG9TYXZlRGF0YSh2YWx1ZSkge1xyXG4gICAgdGhpcy5faXNUb1NhdmVEYXRhID0gdmFsdWU7XHJcbiAgfVxyXG5cclxuICAvLyBUbyBoYW5kbGUgc3Vic2NyaXB0aW9ucyBzZW50IHdoaWxlIHRoZSByZXBvcnRlciB3YXMgb2ZmbGluZSBpZSBmb3J3YXJkZWQgYnkgYSBPZmZsaW5lIFN1YnNjcmlwdGlvbiBNYW5hZ2VyIHNlcnZpY2VcclxuXHJcbiAgX29uRm9yd2FyZGVkUmVtb3RlU3Vic2NyaWJlKG1zZykge1xyXG4gICAgdGhpcy5fb25SZW1vdGVTdWJzY3JpYmUobXNnLmJvZHkpO1xyXG4gIH1cclxuXHJcbiAgX3JlbGVhc2VMaXN0ZW5lcnMoKSB7XHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG5cclxuICAgIF90aGlzLl9zdWJzY3JpcHRpb25MaXN0ZW5lci5yZW1vdmUoKTtcclxuXHJcbiAgICBfdGhpcy5fY2hhbmdlTGlzdGVuZXIucmVtb3ZlKCk7XHJcblxyXG4gICAgX3RoaXMuX2NoaWxkcmVuTGlzdGVuZXJzLmZvckVhY2goKGNsKSA9PiB7XHJcbiAgICAgIGNsLnJlbW92ZSgpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgT2JqZWN0LmtleXMoX3RoaXMuX2ZvcndhcmRzKS5mb3JFYWNoKChrZXkpID0+IHtcclxuICAgICAgX3RoaXMuZm9yd2FyZFVuU3Vic2NyaWJlKGtleSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICAvL3JlbW92ZSBhbGwgc3Vic2NyaXB0aW9uc1xyXG4gICAgT2JqZWN0LmtleXMoX3RoaXMuX3N1YnNjcmlwdGlvbnMpLmZvckVhY2goKGtleSkgPT4ge1xyXG4gICAgICBfdGhpcy5fc3Vic2NyaXB0aW9uc1trZXldLl9yZWxlYXNlTGlzdGVuZXJzKCk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIHJlc3VtZVN1YnNjcmlwdGlvbnMoc3Vic2NyaXB0aW9ucykge1xyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuXHJcbiAgICBpZiAoIXN1YnNjcmlwdGlvbnMpXHJcbiAgICAgIHJldHVybjtcclxuXHJcbiAgICBPYmplY3Qua2V5cyhzdWJzY3JpcHRpb25zKS5mb3JFYWNoKChrZXkpID0+IHtcclxuICAgICAgbGV0IGh5cGVydHlVUkwgPSBzdWJzY3JpcHRpb25zW2tleV07XHJcblxyXG4gICAgICBsb2cubG9nKCdbU3luY2hlck1hbmFnZXIuUmVwb3J0ZXJPYmplY3RdIC0gcmVzdW1lIHN1YnNjcmlwdGlvbnMnLCBfdGhpcywgaHlwZXJ0eVVSTCwgX3RoaXMuX2NoaWxkcmVucyk7XHJcblxyXG4gICAgICBpZiAoIV90aGlzLl9zdWJzY3JpcHRpb25zW2h5cGVydHlVUkxdKSB7XHJcbiAgICAgICAgX3RoaXMuX3N1YnNjcmlwdGlvbnNbaHlwZXJ0eVVSTF0gPSBuZXcgU3Vic2NyaXB0aW9uKF90aGlzLl9idXMsIF90aGlzLl9vd25lciwgX3RoaXMuX3VybCwgdHJ1ZSk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG5cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFJlZ2lzdGVyIGEgbGlzdGVuZXIgaW4gdGhlIG1zZy1ub2RlIGFuZCBpbiB0aGUgbG9jYWwgTWVzc2FnZUJ1cywgc28gdGhhdCBtZXNzYWdlcyBvbiB0aGlzIGFkZHJlc3MgYXJlIGZvcndhcmRlZCB0byB0aGUgcmVwb3J0ZXIgb2JqZWN0XHJcbiAgICogQHBhcmFtICB7c3RyaW5nfSBhZGRyZXNzIC0gVVJMIHRvIHJlZ2lzdGVyIHRoZSBsaXN0ZW5lcnNcclxuICAgKiBAcmV0dXJuIHtQcm9taXNlfSBSZXR1cm4gUHJvbWlzZSBPSyBvciBlcnJvclxyXG4gICAqL1xyXG4gIGZvcndhcmRTdWJzY3JpYmUoYWRkcmVzc2VzKSB7XHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG5cclxuICAgIC8vRkxPVy1PVVQ6IG1lc3NhZ2Ugc2VudCB0byB0aGUgbXNnLW5vZGUgU3Vic2NyaXB0aW9uTWFuYWdlciBjb21wb25lbnRcclxuICAgIGxldCBub2RlU3Vic2NyaWJlTXNnID0ge1xyXG4gICAgICB0eXBlOiAnc3Vic2NyaWJlJywgZnJvbTogX3RoaXMuX3BhcmVudC5fdXJsLCB0bzogJ2RvbWFpbjovL21zZy1ub2RlLicgKyBfdGhpcy5fZG9tYWluICsgJy9zbScsXHJcbiAgICAgIGJvZHk6IHsgcmVzb3VyY2VzOiBhZGRyZXNzZXMsIHNvdXJjZTogX3RoaXMuX293bmVyIH1cclxuICAgIH07XHJcblxyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcclxuICAgICAgX3RoaXMuX2J1cy5wb3N0TWVzc2FnZVdpdGhSZXRyaWVzKG5vZGVTdWJzY3JpYmVNc2csIDEwLCAocmVwbHkpID0+IHtcclxuICAgICAgICBsb2cubG9nKCdbU3luY2hlck1hbmFnZXIuUmVwb3J0ZXJPYmplY3QgXWZvcndhcmQtc3Vic2NyaWJlLXJlc3BvbnNlKHJlcG9ydGVyKTogJywgcmVwbHkpO1xyXG4gICAgICAgIGlmIChyZXBseS5ib2R5LmNvZGUgPT09IDIwMCkge1xyXG4gICAgICAgICAgbGV0IG5ld0ZvcndhcmQgPSBfdGhpcy5fYnVzLmFkZEZvcndhcmQoX3RoaXMuX3VybCwgX3RoaXMuX293bmVyKTtcclxuICAgICAgICAgIF90aGlzLl9mb3J3YXJkc1thZGRyZXNzZXNbMF1dID0gbmV3Rm9yd2FyZDtcclxuICAgICAgICAgIHJlc29sdmUoKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgcmVqZWN0KCdFcnJvciBvbiBtc2ctbm9kZSBzdWJzY3JpcHRpb246ICcgKyByZXBseS5ib2R5LmRlc2MpO1xyXG4gICAgICAgIH1cclxuICAgICAgfSk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFVuUmVnaXN0ZXIgYSBsaXN0ZW5lciBpbiB0aGUgbXNnLW5vZGUgYW5kIGluIHRoZSBsb2NhbCBNZXNzYWdlQnVzLCBzbyB0aGF0IG1lc3NhZ2VzIG9uIHRoaXMgYWRkcmVzcyBhcmUgcmVtb3ZlZCBmcm9tIGZvcndhcmRcclxuICAgKiBAcGFyYW0gIHtzdHJpbmd9IGFkZHJlc3MgLSBVUkwgdG8gdW4tcmVnaXN0ZXIgdGhlIGxpc3RlbmVyc1xyXG4gICAqL1xyXG4gIGZvcndhcmRVblN1YnNjcmliZShhZGRyZXNzKSB7XHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG5cclxuICAgIF90aGlzLl9mb3J3YXJkc1thZGRyZXNzXS5yZW1vdmUoKTtcclxuICAgIGRlbGV0ZSBfdGhpcy5fZm9yd2FyZHNbYWRkcmVzc107XHJcblxyXG4gICAgLy9GTE9XLU9VVDogbWVzc2FnZSBzZW50IHRvIHRoZSBtc2ctbm9kZSBTdWJzY3JpcHRpb25NYW5hZ2VyIGNvbXBvbmVudFxyXG4gICAgbGV0IG5vZGVVblN1YnNjcmliZU1zZyA9IHtcclxuICAgICAgdHlwZTogJ3Vuc3Vic2NyaWJlJywgZnJvbTogX3RoaXMuX3BhcmVudC5fdXJsLCB0bzogJ2RvbWFpbjovL21zZy1ub2RlLicgKyBfdGhpcy5fZG9tYWluICsgJy9zbScsXHJcbiAgICAgIGJvZHk6IHsgcmVzb3VyY2VzOiBbYWRkcmVzc10sIHNvdXJjZTogX3RoaXMuX293bmVyIH1cclxuICAgIH07XHJcblxyXG4gICAgX3RoaXMuX2J1cy5wb3N0TWVzc2FnZShub2RlVW5TdWJzY3JpYmVNc2cpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogUmVnaXN0ZXIgbGlzdGVuZXJzIGZvciBhIGxpc3Qgb2YgY2hpbGRyZW5zLiBQdWJsaWMgY2hhbm5lbHMgdXNlZCB0byB0cmFuc21pdCBtZXNzYWdlcy5cclxuICAgKiBAcGFyYW0gIHtzdHJpbmdbXX0gY2hpbGRyZW5zIC0gY2hhbm5lbHMgdG8gcmVnaXN0ZXJcclxuICAgKiBAcmV0dXJuIHtQcm9taXNlfSBSZXR1cm4gUHJvbWlzZSBPSyBvciBlcnJvclxyXG4gICAqL1xyXG4gIGFkZENoaWxkcmVucygpIHtcclxuICAgIGxldCBfdGhpcyA9IHRoaXM7XHJcblxyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcclxuICAgICAgaWYgKF90aGlzLl9jaGlsZHJlbnMubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgICAgcmVzb2x2ZSgpO1xyXG4gICAgICAgIHJldHVybjtcclxuICAgIH1cclxuXHJcbiAgICAgIGxldCBjaGlsZEJhc2VVUkwgPSBfdGhpcy5fdXJsICsgJy9jaGlsZHJlbi8nO1xyXG4gICAgICBsb2cubG9nKCdbU3luY2hlck1hbmFnZXIuUmVwb3J0ZXJPYmplY3QgLSBhZGRDaGlsZHJlbnNdIC0gY2hpbGRyZW5zOiAnLCBjaGlsZEJhc2VVUkwpO1xyXG5cclxuICAvKiAgICBjaGlsZHJlbnMuZm9yRWFjaCgoY2hpbGQpID0+IHtcclxuICAgICAgICBfdGhpcy5fY2hpbGRyZW5zLnB1c2goY2hpbGQpO1xyXG4gICAgICB9KTsqL1xyXG5cclxuICAgICAgLypcclxuICAgICAgX3RoaXMuX2NoaWxkcmVucy5mb3JFYWNoKChjaGlsZCkgPT4ge1xyXG4gICAgICAgIGxldCBjaGlsZElkID0gY2hpbGRCYXNlVVJMICsgY2hpbGQ7XHJcblxyXG4gICAgICAgIGxldCBzZWxmRm9yd2FyZCA9IF90aGlzLl9idXMuYWRkRm9yd2FyZChjaGlsZElkLCBvd25lcik7XHJcbiAgICAgICAgX3RoaXMuX2NoaWxkcmVuTGlzdGVuZXJzLnB1c2goc2VsZkZvcndhcmQpO1xyXG4gICAgICB9KTsqL1xyXG5cclxuICAgICAgbGV0IHN1YnNjcmlwdGlvbnMgPSBbXTtcclxuLy8gICAgICBjaGlsZHJlbnMuZm9yRWFjaCgoY2hpbGQpID0+IHN1YnNjcmlwdGlvbnMucHVzaChjaGlsZEJhc2VVUkwgKyBjaGlsZCkpO1xyXG4gICAgICBzdWJzY3JpcHRpb25zLnB1c2goY2hpbGRCYXNlVVJMICk7XHJcblxyXG4gICAgICAvL190aGlzLl9zdG9yYWdlU3Vic2NyaXB0aW9uc1tfdGhpcy5fb2JqU3Vic2NyaXB0b3JVUkxdID0ge3VybDogX3RoaXMuX3VybCwgb3duZXI6IF90aGlzLl9vd25lciwgY2hpbGRyZW5zOiBfdGhpcy5fY2hpbGRyZW5zfTtcclxuXHJcbiAgICAgIC8vRkxPVy1PVVQ6IG1lc3NhZ2Ugc2VudCB0byB0aGUgbXNnLW5vZGUgU3Vic2NyaXB0aW9uTWFuYWdlciBjb21wb25lbnRcclxuICAgICAgbGV0IG5vZGVTdWJzY3JpYmVNc2cgPSB7XHJcbiAgICAgICAgdHlwZTogJ3N1YnNjcmliZScsIGZyb206IF90aGlzLl9wYXJlbnQuX3VybCwgdG86ICdkb21haW46Ly9tc2ctbm9kZS4nICsgX3RoaXMuX2RvbWFpbiArICcvc20nLFxyXG4gICAgICAgIGJvZHk6IHsgcmVzb3VyY2VzOiBzdWJzY3JpcHRpb25zLCBzb3VyY2U6IF90aGlzLl9vd25lciB9XHJcbiAgICAgIH07XHJcblxyXG4gICAgICBfdGhpcy5fYnVzLnBvc3RNZXNzYWdlKG5vZGVTdWJzY3JpYmVNc2csIChyZXBseSkgPT4ge1xyXG4gICAgICAgIGxvZy5sb2coJ1tTeW5jaGVyTWFuYWdlci5SZXBvcnRlck9iamVjdCBdbm9kZS1zdWJzY3JpYmUtcmVzcG9uc2UocmVwb3J0ZXIpOicsIHJlcGx5KTtcclxuICAgICAgICBpZiAocmVwbHkuYm9keS5jb2RlID09PSAyMDApIHtcclxuXHJcbiAgICAgICAgICAvL2FkZCBjaGlsZHJlbiBsaXN0ZW5lcnMgb24gbG9jYWwgLi4uXHJcbiAgICAgICAgICBzdWJzY3JpcHRpb25zLmZvckVhY2goKGNoaWxkVVJMKSA9PiB7XHJcbiAgICAgICAgICAgIGxldCBjaGlsZExpc3RlbmVyID0gX3RoaXMuX2J1cy5hZGRMaXN0ZW5lcihjaGlsZFVSTCwgKG1zZykgPT4ge1xyXG4gICAgICAgICAgICAgIC8vVE9ETzogd2hhdCB0b2RvIGhlcmU/IFNhdmUgY2hpbGRyZW5zP1xyXG4gICAgICAgICAgICAgIGxvZy5sb2coJ1tTeW5jaGVyTWFuYWdlci5SZXBvcnRlck9iamVjdCByZWNlaXZlZF0nLCBtc2cpO1xyXG5cclxuXHJcbiAgICAgICAgICAgICAgaWYgKG1zZy50eXBlID09PSAnY3JlYXRlJyAmJiBtc2cudG8uaW5jbHVkZXMoJ2NoaWxkcmVuJykgJiYgdGhpcy5faXNUb1NhdmVEYXRhKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gaWYgdGhlIHZhbHVlIGlzIG5vdCBlbmNyeXB0ZWQgbGV0cyBlbmNyeXB0IGl0XHJcbiAgICAgICAgICAgICAgICAvLyB0b2RvOiBzaG91bGQgYmUgc3ViamVjdCB0byBzb21lIHBvbGljeVxyXG4gICAgICAgICAgICAgICAgbGV0IHNwbGl0ZWRSZXBvcnRlclVSTCA9IHNwbGl0T2JqZWN0VVJMKG1zZy50byk7XHJcblxyXG4gICAgICAgICAgICAgICAgbGV0IHVybCA9IHNwbGl0ZWRSZXBvcnRlclVSTC51cmw7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKCFtc2cuYm9keS5oYXNPd25Qcm9wZXJ0eSgnbXV0dWFsJykpIG1zZy5ib2R5Lm11dHVhbCA9IHRydWU7XHJcblxyXG4gICAgICAgICAgICAgICAgLy9yZW1vdmUgZmFsc2Ugd2hlbiBtdXR1YWxBdXRoZW50aWNhdGlvbiBpcyBlbmFibGVkXHJcbiAgICAgICAgICAgICAgICBpZiAoISh0eXBlb2YgbXNnLmJvZHkudmFsdWUgPT09ICdzdHJpbmcnKSAmJiBtc2cuYm9keS5tdXR1YWwpIHtcclxuXHJcbiAgICAgICAgICAgICAgICAgIGxvZy5sb2coJ1tTeW5jaGVyTWFuYWdlci5SZXBvcnRlck9iamVjdF0gZW5jcnlwdGluZyByZWNlaXZlZCBkYXRhICcsIG1zZy5ib2R5LnZhbHVlKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgIGNyeXB0b01hbmFnZXIuZGVmYXVsdC5lbmNyeXB0RGF0YU9iamVjdChtc2cuYm9keS52YWx1ZSwgdXJsKS50aGVuKChlbmNyeXB0ZWRWYWx1ZSk9PntcclxuICAgICAgICAgICAgICAgICAgICBsb2cubG9nKCdbU3luY2hlck1hbmFnZXIuUmVwb3J0ZXJPYmplY3RdIGVuY3J5cHRlZCBkYXRhICcsICBlbmNyeXB0ZWRWYWx1ZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIF90aGlzLl9zdG9yZUNoaWxkT2JqZWN0KG1zZywgSlNPTi5zdHJpbmdpZnkoZW5jcnlwdGVkVmFsdWUpKTtcclxuICAgICAgICAgICAgICAgICAgfSkuY2F0Y2goKHJlYXNvbikgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGxvZy53YXJuKCdbU3luY2hlck1hbmFnZXIuX2RlY3J5cHRDaGlsZHJlbnNdIGZhaWxlZCA6ICcsIHJlYXNvbiwgJyBTdG9yaW5nIHVuZW5jcnlwdGVkJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgX3RoaXMuX3N0b3JlQ2hpbGRPYmplY3QobXNnLCBtc2cuYm9keS52YWx1ZSk7XHJcbiAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgX3RoaXMuX3N0b3JlQ2hpbGRPYmplY3QobXNnLCBtc2cuYm9keS52YWx1ZSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIF90aGlzLl9jaGlsZHJlbkxpc3RlbmVycy5wdXNoKGNoaWxkTGlzdGVuZXIpO1xyXG5cclxuICAgICAgICAgICAgbGV0IHNlbGZGb3J3YXJkID0gX3RoaXMuX2J1cy5hZGRGb3J3YXJkKGNoaWxkVVJMLCBfdGhpcy5fb3duZXIpO1xyXG4gICAgICAgICAgICBfdGhpcy5fY2hpbGRyZW5MaXN0ZW5lcnMucHVzaChzZWxmRm9yd2FyZCk7XHJcbiAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICByZXNvbHZlKCk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIHJlamVjdCgnRXJyb3Igb24gbXNnLW5vZGUgc3Vic2NyaXB0aW9uOiAnICsgcmVwbHkuYm9keS5kZXNjKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvLyBzdG9yZSBjaGlsZE9iamVjdFxyXG5cclxuICBfc3RvcmVDaGlsZE9iamVjdChtc2csIGRhdGEpIHtcclxuICAgIGxldCBfdGhpcyA9IHRoaXM7XHJcblxyXG4gICAgbGV0IHNwbGl0ZWRSZXBvcnRlclVSTCA9IHNwbGl0T2JqZWN0VVJMKG1zZy50byk7XHJcblxyXG4gICAgbGV0IHVybCA9IHNwbGl0ZWRSZXBvcnRlclVSTC51cmw7XHJcblxyXG4gICAgbGV0IHJlc291cmNlID0gc3BsaXRlZFJlcG9ydGVyVVJMLnJlc291cmNlO1xyXG4gICAgbGV0IHZhbHVlO1xyXG4gICAgXHJcblxyXG4vKiAgICBpZiAobXNnLmJvZHkuaWRlbnRpdHkpIHtcclxuICAgICAgdmFsdWUuaWRlbnRpdHkgPSBtc2cuYm9keS5pZGVudGl0eTtcclxuICAgICAgZGVsZXRlIHZhbHVlLmlkZW50aXR5LmFzc2VydGlvbjtcclxuICAgICAgZGVsZXRlIHZhbHVlLmlkZW50aXR5LmV4cGlyZXM7XHJcbiAgICB9Ki9cclxuXHJcbiAgICBsZXQgb2JqZWN0VVJMUmVzb3VyY2UgPSBtc2cuYm9keS5yZXNvdXJjZTtcclxuICAgIGxldCBhdHRyaWJ1dGUgPSByZXNvdXJjZTtcclxuXHJcbiAgICBpZiAob2JqZWN0VVJMUmVzb3VyY2UgPT09ICdoZWFydGJlYXQnICkgdmFsdWUgPSBkYXRhO1xyXG4gICAgZWxzZSB2YWx1ZSA9IHtcclxuICAgICAgaWRlbnRpdHk6IG1zZy5ib2R5LmlkZW50aXR5LFxyXG4gICAgICB2YWx1ZTogZGF0YVxyXG4gICAgfTtcclxuXHJcbi8vICAgIGlmIChvYmplY3RVUkxSZXNvdXJjZSkgYXR0cmlidXRlICs9ICcuJyArIG9iamVjdFVSTFJlc291cmNlO1xyXG4gICAgaWYgKG9iamVjdFVSTFJlc291cmNlKSBhdHRyaWJ1dGUgPSBvYmplY3RVUkxSZXNvdXJjZTtcclxuXHJcbiAgICAvLyB0aGlzIGlkZW50aXR5IGRhdGEgaXMgbm90IG5lZWRlZCB0byBiZSBzdG9yZWRcclxuXHJcblxyXG4gICAgY29uc29sZS5sb2coJ1tTeW5jaGVyTWFuYWdlci5SZXBvcnRlck9iamVjdC5fc3RvcmVDaGlsZE9iamVjdF0gOiAnLCB1cmwsIGF0dHJpYnV0ZSwgdmFsdWUpO1xyXG5cclxuICAgIF90aGlzLl9wYXJlbnQuX2RhdGFPYmplY3RzU3RvcmFnZS5zYXZlQ2hpbGRyZW5zKHRydWUsIHVybCwgYXR0cmlidXRlLCB2YWx1ZSk7XHJcbiAgfVxyXG5cclxuICBkZWxldGUoKSB7XHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG4gICAgbGV0IGRvbWFpbiA9IGRpdmlkZVVSTChfdGhpcy5fb3duZXIpLmRvbWFpbjtcclxuXHJcbiAgICAvL0ZMT1ctT1VUOiBtZXNzYWdlIHNlbnQgZGlyZWN0bHkgdG8gYWxsIHN1YnNjcmliZXJzIG9mIHRoZSByZXBvcnRlclxyXG4gICAgX3RoaXMuX2J1cy5wb3N0TWVzc2FnZSh7XHJcbiAgICAgIHR5cGU6ICdkZWxldGUnLCBmcm9tOiBfdGhpcy5fb2JqU3Vic2NyaXB0b3JVUkwsIHRvOiBfdGhpcy5fdXJsICsgJy9jaGFuZ2VzJ1xyXG4gICAgfSk7XHJcblxyXG4gICAgLy9GTE9XLU9VVDogbWVzc2FnZSBzZW50IHRvIHRoZSBtc2ctbm9kZSBPYmplY3RBbGxvY2F0aW9uTWFuYWdlciBjb21wb25lbnRcclxuICAgIF90aGlzLl9idXMucG9zdE1lc3NhZ2Uoe1xyXG4gICAgICB0eXBlOiAnZGVsZXRlJywgZnJvbTogX3RoaXMuX3BhcmVudC5fdXJsLCB0bzogJ2RvbWFpbjovL21zZy1ub2RlLicgKyBkb21haW4gKyAnL29iamVjdC1hZGRyZXNzLWFsbG9jYXRpb24nLFxyXG4gICAgICBib2R5OiB7IHJlc291cmNlOiBfdGhpcy5fdXJsLCBjaGlsZHJlblJlc291cmNlczogX3RoaXMuX2NoaWxkcmVucyB9XHJcbiAgICB9KTtcclxuXHJcbiAgICBfdGhpcy5fcmVsZWFzZUxpc3RlbmVycygpO1xyXG4gICAgZGVsZXRlIF90aGlzLl9wYXJlbnQuX3JlcG9ydGVyc1tfdGhpcy5fdXJsXTtcclxuICB9XHJcblxyXG4gIF9vblJlbW90ZVJlc3BvbnNlKG1zZykge1xyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuXHJcbiAgICBfdGhpcy5fYnVzLnBvc3RNZXNzYWdlKHtcclxuICAgICAgaWQ6IG1zZy5pZCwgdHlwZTogJ3Jlc3BvbnNlJywgZnJvbTogbXNnLnRvLCB0bzogX3RoaXMuX3VybCxcclxuICAgICAgYm9keTogeyBjb2RlOiBtc2cuYm9keS5jb2RlLCBpZGVudGl0eTogbXNnLmJvZHkuaWRlbnRpdHksIHNvdXJjZTogbXNnLmZyb20gfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvL0ZMT1ctSU46IG1lc3NhZ2UgcmVjZWl2ZWQgZnJvbSBTeW5jaGVyIC0+IHN1YnNjcmliZVxyXG4gIF9vblJlbW90ZVN1YnNjcmliZShtc2cpIHtcclxuICAgIGxldCBfdGhpcyA9IHRoaXM7XHJcbiAgICBsZXQgaHlwZXJ0eVVSTCA9IG1zZy5ib2R5LnN1YnNjcmliZXI7XHJcblxyXG4gICAgLy92YWxpZGF0ZSBpZiBzdWJzY3JpcHRpb24gYWxyZWFkeSBleGlzdHM/XHJcbiAgICBpZiAoX3RoaXMuX3N1YnNjcmlwdGlvbnNbaHlwZXJ0eVVSTF0pIHtcclxuICAgICAgLy8gbGV0IGVycm9yTXNnID0ge1xyXG4gICAgICAvLyAgIGlkOiBtc2cuaWQsIHR5cGU6ICdyZXNwb25zZScsIGZyb206IG1zZy50bywgdG86IGh5cGVydHlVUkwsXHJcbiAgICAgIC8vICAgYm9keTogeyBjb2RlOiA1MDAsIGRlc2M6ICdTdWJzY3JpcHRpb24gZm9yICgnICsgX3RoaXMuX3VybCArICcgOiAnICsgIGh5cGVydHlVUkwgKyAnKSBhbHJlYWR5IGV4aXN0cyEnIH1cclxuICAgICAgLy8gfTtcclxuICAgICAgLy9cclxuICAgICAgLy8gX3RoaXMuX2J1cy5wb3N0TWVzc2FnZShlcnJvck1zZyk7XHJcbiAgICAgIC8vIHJldHVybjtcclxuXHJcbiAgICAgIC8vIG5ldyB2ZXJzaW9uIGJlY2F1c2Ugb2YgcmV1c2FnZVxyXG4gICAgICBfdGhpcy5fc3Vic2NyaXB0aW9uc1toeXBlcnR5VVJMXS5fcmVsZWFzZUxpc3RlbmVycygpO1xyXG4gICAgfVxyXG5cclxuICAgIC8vYXNrIHRvIHN1YnNjcmliZSB0byBTeW5jaGVyPyAoZGVwZW5kcyBvbiB0aGUgb3BlcmF0aW9uIG1vZGUpXHJcbiAgICAvL1RPRE86IGdldCBtb2RlIGZyb20gb2JqZWN0IVxyXG4gICAgbGV0IG1vZGUgPSAnc3ViL3B1Yic7XHJcblxyXG4gICAgaWYgKG1vZGUgPT09ICdzdWIvcHViJykge1xyXG4gICAgICAvL0ZMT1ctT1VUOiBtZXNzYWdlIHNlbnQgdG8gbG9jYWwgaHlwZXJ0eSBhZGRyZXNzIFN5bmNoZXIgLT4gX29uRm9yd2FyZFxyXG4gICAgICBsZXQgZm9yd2FyZE1zZyA9IHtcclxuICAgICAgICB0eXBlOiAnZm9yd2FyZCcsIGZyb206IF90aGlzLl91cmwsIHRvOiBfdGhpcy5fb3duZXIsXHJcbiAgICAgICAgYm9keTogeyB0eXBlOiBtc2cudHlwZSwgZnJvbTogaHlwZXJ0eVVSTCwgdG86IF90aGlzLl91cmwsIGlkZW50aXR5OiBtc2cuYm9keS5pZGVudGl0eSB9XHJcbiAgICAgIH07XHJcblxyXG4gICAgICAvL1RPRE86IEZvciBGdXJ0aGVyIFN0dWR5XHJcbiAgICAgIGlmIChtc2cuYm9keS5oYXNPd25Qcm9wZXJ0eSgnbXV0dWFsJykpIGZvcndhcmRNc2cuYm9keS5tdXR1YWwgPSBtc2cuYm9keS5tdXR1YWw7XHJcblxyXG4gICAgICBfdGhpcy5fYnVzLnBvc3RNZXNzYWdlKGZvcndhcmRNc2csIChyZXBseSkgPT4ge1xyXG4gICAgICAgIGxvZy5sb2coJ1tTeW5jaGVyTWFuYWdlci5SZXBvcnRlck9iamVjdCBdZm9yd2FyZC1yZXBseTogJywgcmVwbHkpO1xyXG4gICAgICAgIGlmIChyZXBseS5ib2R5LmNvZGUgPT09IDIwMCkge1xyXG4gICAgICAgICAgaWYgKCFfdGhpcy5fc3Vic2NyaXB0aW9uc1toeXBlcnR5VVJMXSkge1xyXG4gICAgICAgICAgICBsb2cubG9nKCdbU3luY2hlck1hbmFnZXIuUmVwb3J0ZXJPYmplY3RdIC0gX29uUmVtb3RlU3Vic2NyaWJlOicsIF90aGlzLl9jaGlsZHJlbnMpO1xyXG4gICAgICAgICAgICBfdGhpcy5fc3Vic2NyaXB0aW9uc1toeXBlcnR5VVJMXSA9IG5ldyBTdWJzY3JpcHRpb24oX3RoaXMuX2J1cywgX3RoaXMuX293bmVyLCBfdGhpcy5fdXJsLCB0cnVlKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICAvLyBTdG9yZSBmb3IgZWFjaCByZXBvcnRlciBoeXBlcnR5IHRoZSBkYXRhT2JqZWN0XHJcbiAgICAgICAgbGV0IHVzZXJVUkw7XHJcbiAgICAgICAgaWYgKG1zZy5ib2R5LmlkZW50aXR5ICYmIG1zZy5ib2R5LmlkZW50aXR5LnVzZXJQcm9maWxlLnVzZXJVUkwpIHtcclxuICAgICAgICAgIHVzZXJVUkwgPSBtc2cuYm9keS5pZGVudGl0eS51c2VyUHJvZmlsZS51c2VyVVJMO1xyXG4gICAgICAgICAgX3RoaXMuX3BhcmVudC5fZGF0YU9iamVjdHNTdG9yYWdlLnVwZGF0ZSh0cnVlLCBfdGhpcy5fdXJsLCAnc3Vic2NyaWJlclVzZXJzJywgdXNlclVSTCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvL1RPRE86IG11dHVhbCBhbmQgc2Vzc2lvbmtleXMgdXBkYXRlcyB3ZXJlIHJlbW92ZWQuIEZGU1xyXG5cclxuICAgICAgICAvKiAgICAgICAgaWYgKG1zZy5ib2R5Lmhhc093blByb3BlcnR5KCdtdXR1YWwnKSkge1xyXG4vLyAgICAgICAgICBfdGhpcy5fcGFyZW50Ll9pZGVudGl0eU1vZHVsZS51cGRhdGVJc1RvRW5jcnlwdEZvckRhdGFPYmplY3RTZXNzaW9uS2V5KF90aGlzLl91cmwsIG1zZy5ib2R5Lm11dHVhbCkudGhlbigoKT0+e1xyXG4gICAgICAgICAgICBfdGhpcy5fcGFyZW50Ll9kYXRhT2JqZWN0c1N0b3JhZ2UudXBkYXRlKHRydWUsIF90aGlzLl91cmwsICdtdXR1YWwnLCBtc2cuYm9keS5tdXR1YWwpO1xyXG4vLyAgICAgICAgICB9KTtcclxuICAgICAgICB9Ki9cclxuXHJcbiAgICAgICAgX3RoaXMuX3BhcmVudC5fZGF0YU9iamVjdHNTdG9yYWdlLnVwZGF0ZSh0cnVlLCBfdGhpcy5fdXJsLCAnc3Vic2NyaXB0aW9ucycsIGh5cGVydHlVUkwpO1xyXG5cclxuICAgICAgICByZXBseS5ib2R5Lm93bmVyID0gX3RoaXMuX293bmVyO1xyXG5cclxuICAgICAgICAvL0ZMT1ctT1VUOiBzdWJzY3JpcHRpb24gcmVzcG9uc2Ugc2VudCAoZm9yd2FyZCBmcm9tIGludGVybmFsIEh5cGVydHkpXHJcbiAgICAgICAgX3RoaXMuX2J1cy5wb3N0TWVzc2FnZSh7XHJcbiAgICAgICAgICBpZDogbXNnLmlkLCB0eXBlOiAncmVzcG9uc2UnLCBmcm9tOiBtc2cudG8sIHRvOiBtc2cuZnJvbSxcclxuICAgICAgICAgIGJvZHk6IHJlcGx5LmJvZHlcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICB9XHJcblxyXG4gIC8vRkxPVy1JTjogbWVzc2FnZSByZWNlaXZlZCBmcm9tIHJlbW90ZSBPYnNlcnZlck9iamVjdCAtPiByZW1vdmVTdWJzY3JpcHRpb25cclxuICBfb25SZW1vdGVVblN1YnNjcmliZShtc2cpIHtcclxuICAgIGxldCBfdGhpcyA9IHRoaXM7XHJcbiAgICBsZXQgdW5zdWJzY3JpYmVyID0gbXNnLmJvZHkuc291cmNlO1xyXG5cclxuICAgIGxldCBzdWJzY3JpcHRpb24gPSBfdGhpcy5fc3Vic2NyaXB0aW9uc1t1bnN1YnNjcmliZXJdO1xyXG4gICAgaWYgKHN1YnNjcmlwdGlvbikge1xyXG4gICAgICBzdWJzY3JpcHRpb24uX3JlbGVhc2VMaXN0ZW5lcnMoKTtcclxuICAgICAgZGVsZXRlIF90aGlzLl9zdWJzY3JpcHRpb25zW3Vuc3Vic2NyaWJlcl07XHJcblxyXG4gICAgICBsZXQgZm9yd2FyZE1zZyA9IHtcclxuICAgICAgICB0eXBlOiAnZm9yd2FyZCcsIGZyb206IF90aGlzLl91cmwsIHRvOiBfdGhpcy5fb3duZXIsXHJcbiAgICAgICAgYm9keTogeyB0eXBlOiBtc2cudHlwZSwgZnJvbTogdW5zdWJzY3JpYmVyLCB0bzogX3RoaXMuX3VybCwgaWRlbnRpdHk6IG1zZy5ib2R5LmlkZW50aXR5IH1cclxuICAgICAgfTtcclxuXHJcblxyXG4gICAgICBfdGhpcy5fYnVzLnBvc3RNZXNzYWdlKGZvcndhcmRNc2cpO1xyXG4gICAgfVxyXG5cclxuICB9XHJcblxyXG59XHJcblxyXG5leHBvcnQgZGVmYXVsdCBSZXBvcnRlck9iamVjdDtcclxuIiwiLy8gTG9nIFN5c3RlbVxyXG5pbXBvcnQgKiBhcyBsb2dnZXIgZnJvbSAnbG9nbGV2ZWwnO1xyXG5sZXQgbG9nID0gbG9nZ2VyLmdldExvZ2dlcignT2JzZXJ2ZXJPYmplY3QnKTtcclxuXHJcbmltcG9ydCB7IGRpdmlkZVVSTCwgc3BsaXRPYmplY3RVUkwsIGRlZXBDbG9uZSB9IGZyb20gJy4uL3V0aWxzL3V0aWxzJztcclxuaW1wb3J0IFN1YnNjcmlwdGlvbiBmcm9tICcuL1N1YnNjcmlwdGlvbic7XHJcbmltcG9ydCAqIGFzIGNyeXB0b01hbmFnZXIgZnJvbSAnLi4vY3J5cHRvTWFuYWdlci9DcnlwdG9NYW5hZ2VyJztcclxuXHJcbmNsYXNzIE9ic2VydmVyT2JqZWN0IHtcclxuXHJcbiAgY29uc3RydWN0b3IocGFyZW50LCB1cmwsIGNoaWxkcmVucykge1xyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuXHJcbiAgICBfdGhpcy5fcGFyZW50ID0gcGFyZW50O1xyXG4gICAgX3RoaXMuX3VybCA9IHVybDtcclxuICAgIF90aGlzLl9jaGlsZHJlbnMgPSBjaGlsZHJlbnM7XHJcblxyXG4gICAgX3RoaXMuX2J1cyA9IHBhcmVudC5fYnVzO1xyXG5cclxuICAgIF90aGlzLl9zdWJzY3JpcHRpb25zID0ge307XHJcbiAgICBfdGhpcy5fc3RvcmFnZVN1YnNjcmlwdGlvbnMgPSB7fTtcclxuICAgIF90aGlzLl9jaGlsZHJlbkxpc3RlbmVycyA9IFtdO1xyXG5cclxuICAgIHRoaXMuX2lzVG9TYXZlRGF0YSA9IGZhbHNlO1xyXG5cclxuICAgIGxldCBjaGFuZ2VVUkwgPSBfdGhpcy5fdXJsICsgJy9jaGFuZ2VzJztcclxuICAgIF90aGlzLl9jaGFuZ2VMaXN0ZW5lciA9IF90aGlzLl9idXMuYWRkTGlzdGVuZXIoY2hhbmdlVVJMLCAobXNnKSA9PiB7XHJcblxyXG4gICAgICBsb2cubG9nKCdbU3luY2hlck1hbmFnZXIuT2JzZXJ2ZXJPYmplY3QgXSBTeW5jaGVyTWFuYWdlci0nICsgY2hhbmdlVVJMICsgJy1SQ1Y6ICcsIG1zZyk7XHJcblxyXG4gICAgICAvL1RPRE86IHdoYXQgdG9kbyBoZXJlPyBTYXZlIGNoYW5nZXM/XHJcbiAgICAgIGlmICh0aGlzLl9pc1RvU2F2ZURhdGEgJiYgbXNnLmJvZHkuYXR0cmlidXRlKSB7XHJcbiAgICAgICAgbG9nLmxvZygnW1N5bmNoZXJNYW5hZ2VyLk9ic2VydmVyT2JqZWN0IF0gU3luY2hlck1hbmFnZXIgLSBzYXZlIGRhdGE6ICcsIG1zZyk7XHJcbiAgICAgICAgX3RoaXMuX3BhcmVudC5fZGF0YU9iamVjdHNTdG9yYWdlLnVwZGF0ZShmYWxzZSwgX3RoaXMuX3VybCwgJ3ZlcnNpb24nLCBtc2cuYm9keS52ZXJzaW9uKTtcclxuICAgICAgICBfdGhpcy5fcGFyZW50Ll9kYXRhT2JqZWN0c1N0b3JhZ2UudXBkYXRlKGZhbHNlLCBfdGhpcy5fdXJsLCAnbGFzdE1vZGlmaWVkJywgbXNnLmJvZHkubGFzdE1vZGlmaWVkKTtcclxuICAgICAgICBfdGhpcy5fcGFyZW50Ll9kYXRhT2JqZWN0c1N0b3JhZ2Uuc2F2ZURhdGEoZmFsc2UsIF90aGlzLl91cmwsIG1zZy5ib2R5LmF0dHJpYnV0ZSwgbXNnLmJvZHkudmFsdWUpO1xyXG4gICAgICB9XHJcblxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBzZXQgaXNUb1NhdmVEYXRhKHZhbHVlKSB7XHJcbiAgICB0aGlzLl9pc1RvU2F2ZURhdGEgPSB2YWx1ZTtcclxuICB9XHJcblxyXG4gIF9uZXdTdWJzY3JpcHRpb24oaHlwZXJ0eSkge1xyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuXHJcbiAgICBsZXQgc3Vic2NyaXB0aW9uID0gX3RoaXMuX3N1YnNjcmlwdGlvbnNbaHlwZXJ0eV07XHJcbiAgICBsb2cubG9nKCdbT2JzZXJ2ZXIgT2JqZWN0IC0gbmV3IHN1YnNjcmlwdGlvbl0gLSAnLCAgX3RoaXMuX3N1YnNjcmlwdGlvbnMsIGh5cGVydHksIF90aGlzLl9zdWJzY3JpcHRpb25zLmhhc093blByb3BlcnR5KGh5cGVydHkpKTtcclxuICAgIGlmICghc3Vic2NyaXB0aW9uKSB7XHJcbiAgICAgIF90aGlzLl9zdWJzY3JpcHRpb25zW2h5cGVydHldID0gbmV3IFN1YnNjcmlwdGlvbihfdGhpcy5fYnVzLCBoeXBlcnR5LCBfdGhpcy5fdXJsLCBmYWxzZSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBhZGRTdWJzY3JpcHRpb24oaHlwZXJ0eSkge1xyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuXHJcbiAgICBfdGhpcy5fbmV3U3Vic2NyaXB0aW9uKGh5cGVydHkpO1xyXG4gIH1cclxuXHJcbiAgYWRkQ2hpbGRyZW5zKCkge1xyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuXHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHtcclxuICAgICAgaWYgKF90aGlzLl9jaGlsZHJlbnMubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgICAgcmVzb2x2ZSgpO1xyXG4gICAgICAgIHJldHVybjtcclxuICAgIH1cclxuXHJcbiAgICAgIGxldCBjaGlsZEJhc2VVUkwgPSBfdGhpcy5fdXJsICsgJy9jaGlsZHJlbi8nO1xyXG4gICAgICBsb2cubG9nKCdbU3luY2hlck1hbmFnZXIuT2JzZXJ2ZXJPYmplY3QgLSBhZGRDaGlsZHJlbnNdIC0gY2hpbGRyZW5zOiAnLCBjaGlsZEJhc2VVUkwpO1xyXG5cclxuLy8gICAgICBjaGlsZHJlbnMuZm9yRWFjaCgoY2hpbGQpID0+IHtcclxuXHJcbiAgICAgICAgbGV0IGNoaWxkTGlzdGVuZXIgPSBfdGhpcy5fYnVzLmFkZExpc3RlbmVyKGNoaWxkQmFzZVVSTCwgKG1zZykgPT4ge1xyXG4gICAgICAgICAgLy9UT0RPOiB3aGF0IHRvZG8gaGVyZT8gU2F2ZSBjaGlsZHJlbnM/XHJcbiAgICAgICAgICBsb2cubG9nKCdbU3luY2hlck1hbmFnZXIuT2JzZXJ2ZXJPYmplY3QgcmVjZWl2ZWRdJywgbXNnKTtcclxuXHJcbiAgICAgICAgICBpZiAobXNnLnR5cGUgPT09ICdjcmVhdGUnICYmIG1zZy50by5pbmNsdWRlcygnY2hpbGRyZW4nKSAmJiB0aGlzLl9pc1RvU2F2ZURhdGEpIHtcclxuICAgICAgICAgICAgbGV0IHNwbGl0ZWRSZXBvcnRlclVSTCA9IHNwbGl0T2JqZWN0VVJMKG1zZy50byk7XHJcblxyXG4gICAgICAgICAgICBsZXQgdXJsID0gc3BsaXRlZFJlcG9ydGVyVVJMLnVybDtcclxuXHJcbiAgICAgICAgICAgIGlmICghbXNnLmJvZHkuaGFzT3duUHJvcGVydHkoJ211dHVhbCcpKSBtc2cuYm9keS5tdXR1YWwgPSB0cnVlO1xyXG5cclxuICAgICAgICAgICAgLy9yZW1vdmUgZmFsc2Ugd2hlbiBtdXR1YWxBdXRoZW50aWNhdGlvbiBpcyBlbmFibGVkXHJcbiAgICAgICAgICAgIGlmICghKHR5cGVvZiBtc2cuYm9keS52YWx1ZSA9PT0gJ3N0cmluZycpICYmIG1zZy5ib2R5Lm11dHVhbCkge1xyXG5cclxuICAgICAgICAgICAgICBsb2cubG9nKCdbU3luY2hlck1hbmFnZXIuT2JzZXJ2ZXJPYmplY3RdIGVuY3J5cHRpbmcgcmVjZWl2ZWQgZGF0YSAnLCBtc2cuYm9keS52YWx1ZSk7XHJcblxyXG4gICAgICAgICAgICAgIGNyeXB0b01hbmFnZXIuZGVmYXVsdC5lbmNyeXB0RGF0YU9iamVjdChtc2cuYm9keS52YWx1ZSwgdXJsKS50aGVuKChlbmNyeXB0ZWRWYWx1ZSk9PntcclxuICAgICAgICAgICAgICAgIGxvZy5sb2coJ1tTeW5jaGVyTWFuYWdlci5PYnNlcnZlck9iamVjdF0gZW5jcnlwdGVkIGRhdGEgJywgIGVuY3J5cHRlZFZhbHVlKTtcclxuXHJcbiAgICAgICAgICAgICAgICBfdGhpcy5fc3RvcmVDaGlsZE9iamVjdChtc2csIEpTT04uc3RyaW5naWZ5KGVuY3J5cHRlZFZhbHVlKSk7XHJcbiAgICAgICAgICAgICAgfSkuY2F0Y2goKHJlYXNvbikgPT4ge1xyXG4gICAgICAgICAgICAgICAgbG9nLndhcm4oJ1tTeW5jaGVyTWFuYWdlci5PYnNlcnZlck9iamVjdC5fZW5jcnlwdENoaWxkXSBmYWlsZWQsIHN0b3JpbmcgdW5lbmNyeXB0ZWQgJywgcmVhc29uKTtcclxuICAgICAgICAgICAgICAgIF90aGlzLl9zdG9yZUNoaWxkT2JqZWN0KG1zZywgbXNnLmJvZHkudmFsdWUpO1xyXG4gICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgIF90aGlzLl9zdG9yZUNoaWxkT2JqZWN0KG1zZywgbXNnLmJvZHkudmFsdWUpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgbG9nLmxvZygnW1N5bmNoZXJNYW5hZ2VyLk9ic2VydmVyT2JqZWN0IGNoaWxkcmVuIExpc3RlbmVyc10nLCBfdGhpcy5fY2hpbGRyZW5MaXN0ZW5lcnMsIGNoaWxkTGlzdGVuZXIpO1xyXG4gICAgICAgICAgaWYgKF90aGlzLl9jaGlsZHJlbkxpc3RlbmVycy5pbmRleE9mKGNoaWxkTGlzdGVuZXIpID09PSAtMSkge1xyXG4gICAgICAgICAgICBfdGhpcy5fY2hpbGRyZW5MaXN0ZW5lcnMucHVzaChjaGlsZExpc3RlbmVyKTtcclxuICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICB9KTtcclxuXHJcbi8vICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLy8gc3RvcmUgY2hpbGRPYmplY3RcclxuXHJcbiAgX3N0b3JlQ2hpbGRPYmplY3QobXNnLCBkYXRhKSB7XHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG5cclxuICAgIGxldCBzcGxpdGVkUmVwb3J0ZXJVUkwgPSBzcGxpdE9iamVjdFVSTChtc2cudG8pO1xyXG5cclxuICAgIGxldCB1cmwgPSBzcGxpdGVkUmVwb3J0ZXJVUkwudXJsO1xyXG5cclxuICAgIGxldCByZXNvdXJjZSA9IHNwbGl0ZWRSZXBvcnRlclVSTC5yZXNvdXJjZTtcclxuICAgIGxldCB2YWx1ZSA9IHt9O1xyXG5cclxuLyogICAgbGV0IHZhbHVlID0ge1xyXG4gICAgICBpZGVudGl0eTogbXNnLmJvZHkuaWRlbnRpdHksXHJcbiAgICAgIHZhbHVlOiBkYXRhXHJcbiAgICB9OyovXHJcblxyXG4gICAgLy8gdGhpcyBpZGVudGl0eSBkYXRhIGlzIG5vdCBuZWVkZWQgdG8gYmUgc3RvcmVkXHJcbi8qICAgIGRlbGV0ZSB2YWx1ZS5pZGVudGl0eS5hc3NlcnRpb247XHJcbiAgICBkZWxldGUgdmFsdWUuaWRlbnRpdHkuZXhwaXJlczsqL1xyXG5cclxuICAgIGxldCBvYmplY3RVUkxSZXNvdXJjZSA9IG1zZy5ib2R5LnJlc291cmNlO1xyXG4gICAgbGV0IGF0dHJpYnV0ZSA9IHJlc291cmNlO1xyXG5cclxuICAgIGlmIChvYmplY3RVUkxSZXNvdXJjZSA9PT0gJ2hlYXJ0YmVhdCcpIHtcclxuICAgICAgdmFsdWUgPSBkYXRhO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdmFsdWUuaWRlbnRpdHk9IG1zZy5ib2R5LmlkZW50aXR5O1xyXG4gICAgICB2YWx1ZS52YWx1ZSA9IGRhdGE7XHJcbiAgICB9IFxyXG5cclxuLy8gICAgaWYgKG9iamVjdFVSTFJlc291cmNlKSBhdHRyaWJ1dGUgKz0gJy4nICsgb2JqZWN0VVJMUmVzb3VyY2U7XHJcbiAgICBpZiAob2JqZWN0VVJMUmVzb3VyY2UpIGF0dHJpYnV0ZSA9IG9iamVjdFVSTFJlc291cmNlO1xyXG5cclxuICAgIGxvZy5sb2coJ1tTeW5jaGVyTWFuYWdlci5PYnNlcnZlck9iamVjdC5fc3RvcmVDaGlsZE9iamVjdF0gOiAnLCB1cmwsIGF0dHJpYnV0ZSwgdmFsdWUpO1xyXG5cclxuICAgIF90aGlzLl9wYXJlbnQuX2RhdGFPYmplY3RzU3RvcmFnZS5zYXZlQ2hpbGRyZW5zKGZhbHNlLCB1cmwsIGF0dHJpYnV0ZSwgdmFsdWUpO1xyXG4gIH1cclxuXHJcbiAgcmVtb3ZlU3Vic2NyaXB0aW9uKG1zZykge1xyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuXHJcbiAgICBsZXQgaHlwZXJ0eSA9IG1zZy5mcm9tO1xyXG5cclxuICAgIGxldCBkb21haW4gPSBkaXZpZGVVUkwoaHlwZXJ0eSkuZG9tYWluO1xyXG4gICAgbGV0IG9ialVSTFN1YnNjcmlwdGlvbiA9IF90aGlzLl91cmwgKyAnL3N1YnNjcmlwdGlvbic7XHJcblxyXG4gICAgbGV0IHN1YnNjcmlwdGlvbiA9IF90aGlzLl9zdWJzY3JpcHRpb25zW2h5cGVydHldO1xyXG4gICAgaWYgKHN1YnNjcmlwdGlvbikge1xyXG4gICAgICAvL0ZMT1ctT1VUOiBtZXNzYWdlIHNlbnQgdG8gcmVtb3RlIFJlcG9ydGVyT2JqZWN0IC0+IF9vblJlbW90ZVVuU3Vic2NyaWJlXHJcbiAgICAgIF90aGlzLl9idXMucG9zdE1lc3NhZ2Uoe1xyXG4gICAgICAgIHR5cGU6ICd1bnN1YnNjcmliZScsIGZyb206IF90aGlzLl9wYXJlbnQuX3VybCwgdG86IG9ialVSTFN1YnNjcmlwdGlvbixcclxuICAgICAgICBib2R5OiB7IHNvdXJjZTogaHlwZXJ0eSwgaWRlbnRpdHk6IG1zZy5ib2R5LmlkZW50aXR5IH1cclxuICAgICAgfSk7XHJcblxyXG4gICAgICAvL1RPRE86IHNob3VsZCBJIHdhaXQgZm9yIHJlc3BvbnNlIGJlZm9yZSB1bnN1YnNjcmliZSBvbiBtc2ctbm9kZVxyXG4gICAgICAvL0ZMT1ctT1VUOiBtZXNzYWdlIHNlbnQgdG8gbXNnLW5vZGUgU3Vic2NyaXB0aW9uTWFuYWdlciBjb21wb25lbnRcclxuICAgICAgX3RoaXMuX2J1cy5wb3N0TWVzc2FnZSh7XHJcbiAgICAgICAgdHlwZTogJ3Vuc3Vic2NyaWJlJywgZnJvbTogX3RoaXMuX3BhcmVudC5fdXJsLCB0bzogJ2RvbWFpbjovL21zZy1ub2RlLicgKyBkb21haW4gKyAnL3NtJyxcclxuICAgICAgICBib2R5OiB7IHJlc291cmNlOiBfdGhpcy5fdXJsLCByZXNvdXJjZXM6IFtfdGhpcy5fdXJsICsgJy9jaGlsZHJlbi8nXSB9XHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgc3Vic2NyaXB0aW9uLl9yZWxlYXNlTGlzdGVuZXJzKCk7XHJcbiAgICAgIGRlbGV0ZSBfdGhpcy5fc3Vic2NyaXB0aW9uc1toeXBlcnR5XTtcclxuICAgIH1cclxuICB9XHJcblxyXG59XHJcblxyXG5leHBvcnQgZGVmYXVsdCBPYnNlcnZlck9iamVjdDtcclxuIiwiLyoqXHJcbiogQ29weXJpZ2h0IDIwMTYgUFQgSW5vdmHDp8OjbyBlIFNpc3RlbWFzIFNBXHJcbiogQ29weXJpZ2h0IDIwMTYgSU5FU0MtSURcclxuKiBDb3B5cmlnaHQgMjAxNiBRVU9CSVMgTkVUV09SS1MgU0xcclxuKiBDb3B5cmlnaHQgMjAxNiBGUkFVTkhPRkVSLUdFU0VMTFNDSEFGVCBaVVIgRk9FUkRFUlVORyBERVIgQU5HRVdBTkRURU4gRk9SU0NIVU5HIEUuVlxyXG4qIENvcHlyaWdodCAyMDE2IE9SQU5HRSBTQVxyXG4qIENvcHlyaWdodCAyMDE2IERldXRzY2hlIFRlbGVrb20gQUdcclxuKiBDb3B5cmlnaHQgMjAxNiBBcGl6ZWVcclxuKiBDb3B5cmlnaHQgMjAxNiBURUNITklTQ0hFIFVOSVZFUlNJVEFUIEJFUkxJTlxyXG4qXHJcbiogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbipcclxuKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4qXHJcbiogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4qIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbioqL1xyXG5cclxuLy8gTG9nIFN5c3RlbVxyXG5pbXBvcnQgKiBhcyBsb2dnZXIgZnJvbSAnbG9nbGV2ZWwnO1xyXG5sZXQgbG9nID0gbG9nZ2VyLmdldExvZ2dlcignU3luY2hlck1hbmFnZXInKTtcclxuXHJcbmltcG9ydCB7IGRpdmlkZVVSTCwgZGVlcENsb25lIH0gZnJvbSAnLi4vdXRpbHMvdXRpbHMnO1xyXG4vL2ltcG9ydCB7IHNjaGVtYVZhbGlkYXRpb24gfSBmcm9tICcuLi91dGlscy9zY2hlbWFWYWxpZGF0aW9uJztcclxuXHJcbmltcG9ydCBBZGRyZXNzQWxsb2NhdGlvbiBmcm9tICcuLi9hbGxvY2F0aW9uL0FkZHJlc3NBbGxvY2F0aW9uJztcclxuaW1wb3J0IFJlcG9ydGVyT2JqZWN0IGZyb20gJy4vUmVwb3J0ZXJPYmplY3QnO1xyXG5pbXBvcnQgT2JzZXJ2ZXJPYmplY3QgZnJvbSAnLi9PYnNlcnZlck9iamVjdCc7XHJcbmltcG9ydCAqIGFzIGNyeXB0b01hbmFnZXIgZnJvbSAnLi4vY3J5cHRvTWFuYWdlci9DcnlwdG9NYW5hZ2VyJztcclxuXHJcbi8qKlxyXG4gKiBAYXV0aG9yIG1pY2FlbHBlZHJvc2FAZ21haWwuY29tXHJcbiAqIENvcmUgU3luY3Jvbml6YXRpb24gc3lzdGVtLlxyXG4gKi9cclxuY2xhc3MgU3luY2hlck1hbmFnZXIge1xyXG4gIC8qIHByaXZhdGVcclxuICBfdXJsOiBVUkxcclxuICBfYnVzOiBNaW5pQnVzXHJcbiAgX3JlZ2lzdHJ5OiBSZWdpc3RyeVxyXG4gIF9hbGxvY2F0b3I6IEFkZHJlc3NBbGxvY2F0aW9uXHJcblxyXG4gIF9yZXBvcnRlcnM6IHsgT2JqZWN0VVJMOiBSZXBvcnRlck9iamVjdCB9XHJcbiAgX29ic2VydmVyczogeyBPYmplY3RVUkw6IE9ic2VydmVyT2JqZWN0IH1cclxuICAqL1xyXG5cclxuICBjb25zdHJ1Y3RvcihydW50aW1lVVJMLCBidXMsIHJlZ2lzdHJ5LCBjYXRhbG9nLCBzdG9yYWdlTWFuYWdlciwgYWxsb2NhdG9yLCBzdG9yZURhdGFPYmplY3RzLCBpZGVudGl0eU1vZHVsZSkge1xyXG4gICAgaWYgKCFydW50aW1lVVJMKSB0aHJvdyBuZXcgRXJyb3IoJ1tTeW5jaGVyIE1hbmFnZXJdIC0gbmVlZHMgdGhlIHJ1bnRpbWVVUkwgcGFyYW1ldGVyJyk7XHJcbiAgICBpZiAoIWJ1cykgdGhyb3cgbmV3IEVycm9yKCdbU3luY2hlciBNYW5hZ2VyXSAtIG5lZWRzIHRoZSBNZXNzYWdlQnVzIGluc3RhbmNlJyk7XHJcbiAgICBpZiAoIXJlZ2lzdHJ5KSB0aHJvdyBuZXcgRXJyb3IoJ1tTeW5jaGVyIE1hbmFnZXJdIC0gbmVlZHMgdGhlIFJlZ2lzdHJ5IGluc3RhbmNlJyk7XHJcbiAgICBpZiAoIWNhdGFsb2cpIHRocm93IG5ldyBFcnJvcignW1N5bmNoZXIgTWFuYWdlcl0gLSBuZWVkcyB0aGUgUnVudGltZUNhdGFsb2d1ZSBpbnN0YW5jZScpO1xyXG4gICAgaWYgKCFzdG9yYWdlTWFuYWdlcikgdGhyb3cgbmV3IEVycm9yKCdbU3luY2hlciBNYW5hZ2VyXSAtIG5lZWQgdGhlIHN0b3JhZ2VNYW5hZ2VyIGluc3RhbmNlJyk7XHJcblxyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuXHJcbiAgICBfdGhpcy5fYnVzID0gYnVzO1xyXG4gICAgX3RoaXMuX3JlZ2lzdHJ5ID0gcmVnaXN0cnk7XHJcbiAgICBfdGhpcy5fY2F0YWxvZyA9IGNhdGFsb2c7XHJcbiAgICBfdGhpcy5fc3RvcmFnZU1hbmFnZXIgPSBzdG9yYWdlTWFuYWdlcjtcclxuICAgIF90aGlzLl9pZGVudGl0eU1vZHVsZSA9IGlkZW50aXR5TW9kdWxlO1xyXG5cclxuICAgIC8vVE9ETzogdGhlc2Ugc2hvdWxkIGJlIHNhdmVkIGluIHBlcnNpc3RlbmNlIGVuZ2luZT9cclxuICAgIF90aGlzLnJ1bnRpbWVVUkwgPSBydW50aW1lVVJMO1xyXG4gICAgX3RoaXMuX3VybCA9IHJ1bnRpbWVVUkwgKyAnL3NtJztcclxuICAgIF90aGlzLl9vYmplY3RVUkwgPSBydW50aW1lVVJMICsgJy9vYmplY3QtYWxsb2NhdGlvbic7XHJcblxyXG4gICAgX3RoaXMuX3JlcG9ydGVycyA9IHt9O1xyXG4gICAgX3RoaXMuX29ic2VydmVycyA9IHt9O1xyXG5cclxuICAgIF90aGlzLl9kYXRhT2JqZWN0c1N0b3JhZ2UgPSBzdG9yZURhdGFPYmplY3RzO1xyXG4gICAgY29uc29sZS5sb2coJ1tOT1RTQVZJTkddIHN0b3JlRGF0YU9iamVjdHMnLCBzdG9yZURhdGFPYmplY3RzKTtcclxuICAgIC8vVE9ETzogdGhpcyBzaG91bGQgbm90IGJlIGhhcmRjb2RlZCFcclxuICAgIF90aGlzLl9kb21haW4gPSBkaXZpZGVVUkwocnVudGltZVVSTCkuZG9tYWluO1xyXG5cclxuICAgIGlmIChhbGxvY2F0b3IpIHtcclxuICAgICAgX3RoaXMuX2FsbG9jYXRvciA9IGFsbG9jYXRvcjtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIF90aGlzLl9hbGxvY2F0b3IgPSBBZGRyZXNzQWxsb2NhdGlvbi5pbnN0YW5jZTtcclxuICAgIH1cclxuXHJcbiAgICBsb2cubG9nKCdbU3luY2hlck1hbmFnZXIgLSBBZGRyZXNzQWxsb2NhdGlvbl0gLSAnLCBfdGhpcy5fYWxsb2NhdG9yKTtcclxuXHJcbiAgICBidXMuYWRkTGlzdGVuZXIoX3RoaXMuX3VybCwgKG1zZykgPT4ge1xyXG4gICAgICBsb2cuaW5mbygnW1N5bmNoZXJNYW5hZ2VyXSBSQ1Y6ICcsIG1zZyk7XHJcbiAgICAgIHN3aXRjaCAobXNnLnR5cGUpIHtcclxuICAgICAgICBjYXNlICdjcmVhdGUnOiBfdGhpcy5fb25DcmVhdGUobXNnKTsgYnJlYWs7XHJcbiAgICAgICAgY2FzZSAnZGVsZXRlJzogX3RoaXMuX29uRGVsZXRlKG1zZyk7IGJyZWFrO1xyXG4gICAgICAgIGNhc2UgJ3N1YnNjcmliZSc6IF90aGlzLl9vbkxvY2FsU3Vic2NyaWJlKG1zZyk7IGJyZWFrO1xyXG4gICAgICAgIGNhc2UgJ3Vuc3Vic2NyaWJlJzogX3RoaXMuX29uTG9jYWxVblN1YnNjcmliZShtc2cpOyBicmVhaztcclxuICAgICAgICBjYXNlICdyZWFkJzogX3RoaXMuX29uUmVhZChtc2cpOyBicmVhaztcclxuICAgICAgICBjYXNlICdleGVjdXRlJzogX3RoaXMuX29uRXhlY3V0ZShtc2cpOyBicmVhaztcclxuICAgICAgfVxyXG4gICAgfSk7XHJcblxyXG4gIH1cclxuXHJcbiAgZ2V0IHVybCgpIHsgcmV0dXJuIHRoaXMuX3VybDsgfVxyXG5cclxuICAgICAgLy9GTE9XLUlOOiBtZXNzYWdlIHJlY2VpdmVkIGZyb20gU3luY2hlciAtPiByZWFkXHJcbiAgICAgIF9vbkV4ZWN1dGUobXNnKSB7XHJcblxyXG4gICAgICAgIGxldCBfdGhpcyA9IHRoaXM7XHJcblxyXG4gICAgICAgIGxldCByZXBseSA9IHtcclxuICAgICAgICAgIHR5cGU6ICdyZXNwb25zZScsXHJcbiAgICAgICAgICBmcm9tOiBtc2cudG8sXHJcbiAgICAgICAgICB0bzogbXNnLmZyb20sXHJcbiAgICAgICAgICBpZDogbXNnLmlkXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBsb2cuaW5mbygnW1N5bmNoZXJNYW5hZ2VyLm9uRXhlY3V0ZV0gbmV3IG1lc3NhZ2UnLCBtc2cpO1xyXG5cclxuICAgICAgICBpZiAobXNnLmhhc093blByb3BlcnR5KCdib2R5JykgJiYgbXNnLmJvZHkuaGFzT3duUHJvcGVydHkoJ21ldGhvZCcpICYmIG1zZy5ib2R5Lmhhc093blByb3BlcnR5KCdwYXJhbXMnKSkge1xyXG5cclxuICAgICAgICBzd2l0Y2ggKG1zZy5ib2R5Lm1ldGhvZCkge1xyXG4gICAgICAgICAgY2FzZSAnc3luYyc6IF90aGlzLl9kYXRhT2JqZWN0c1N0b3JhZ2Uuc3luYyhtc2cuYm9keS5wYXJhbXNbMF0sIG1zZy5ib2R5LnBhcmFtc1sxXSwgZmFsc2UpO1xyXG4gICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgY2FzZSAnc3RvcFN5bmMnOiBfdGhpcy5fZGF0YU9iamVjdHNTdG9yYWdlLnN0b3BTeW5jKG1zZy5ib2R5LnBhcmFtc1swXSk7XHJcbiAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgcmVwbHkuYm9keSA9IHtcclxuICAgICAgICAgICAgICBjb2RlOiAyMDBcclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgIF90aGlzLl9idXMucG9zdE1lc3NhZ2UocmVwbHkpO1xyXG4gICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIHJlcGx5LmJvZHkgPSB7XHJcbiAgICAgICAgICAgIGNvZGU6IDQwMCxcclxuICAgICAgICAgICAgZGVzYzogJ21pc3NpbmcgYm9keSBvciBib2R5IG1ldGhvZCAvIHBhcmFtcyBtYW5kYXRvcnkgZmllbGRzJ1xyXG4gICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICBsb2cuZXJyb3IoJ1tTeW5jaGVyTWFuYWdlci5vbkV4ZWN1dGVdIGVycm9yLiBNaXNzaW5nIGJvZHkgb3IgYm9keSBtZXRob2QgLyBwYXJhbXMgbWFuZGF0b3J5IGZpZWxkcycsIG1zZyk7XHJcblxyXG4gICAgICAgICAgX3RoaXMuX2J1cy5wb3N0TWVzc2FnZShyZXBseSk7XHJcblxyXG5cclxuICAgICAgICB9XHJcblxyXG4gICAgICB9XHJcblxyXG4gICAgLy9GTE9XLUlOOiBtZXNzYWdlIHJlY2VpdmVkIGZyb20gU3luY2hlciAtPiByZWFkXHJcbiAgICBfb25SZWFkKG1zZykge1xyXG5cclxuICAgICAgbGV0IF90aGlzID0gdGhpcztcclxuXHJcbiAgICAgIGxldCByZXBseSA9IHtcclxuICAgICAgICB0eXBlOiAncmVzcG9uc2UnLFxyXG4gICAgICAgIGZyb206IG1zZy50byxcclxuICAgICAgICB0bzogbXNnLmZyb20sXHJcbiAgICAgICAgaWQ6IG1zZy5pZFxyXG4gICAgICB9XHJcbiAgICAgIGxvZy5pbmZvKCdbU3luY2hlck1hbmFnZXIub25SZWFkXSBuZXcgbWVzc2FnZScsIG1zZyk7XHJcblxyXG4gICAgICBpZiAobXNnLmhhc093blByb3BlcnR5KCdib2R5JykgJiYgbXNnLmJvZHkuaGFzT3duUHJvcGVydHkoJ3Jlc291cmNlJykpIHtcclxuICAgICAgICBfdGhpcy5fZGF0YU9iamVjdHNTdG9yYWdlLnN5bmMobXNnLmJvZHkucmVzb3VyY2UsIHRydWUpLnRoZW4oKGRhdGFPYmplY3QpPT57XHJcbiAgICAgICAgICByZXBseS5ib2R5ID0ge1xyXG4gICAgICAgICAgICBjb2RlOiAyMDAsXHJcbiAgICAgICAgICAgIHZhbHVlOiBkYXRhT2JqZWN0XHJcbiAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgIGxvZy5pbmZvKCdbU3luY2hlck1hbmFnZXIub25SZWFkXSBmb3VuZCBvYmplY3Q6ICcsIGRhdGFPYmplY3QpO1xyXG5cclxuICAgICAgICAgIF90aGlzLl9idXMucG9zdE1lc3NhZ2UocmVwbHkpO1xyXG4gICAgICAgIH0sIChlcnJvcik9PntcclxuICAgICAgICAgIHJlcGx5LmJvZHkgPSB7XHJcbiAgICAgICAgICAgIGNvZGU6IDQwNCxcclxuICAgICAgICAgICAgZGVzYzogZXJyb3JcclxuICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgbG9nLndhcm4oJ1tTeW5jaGVyTWFuYWdlci5vblJlYWRdIHdhcm5pbmc6ICcsIGVycm9yKTtcclxuXHJcbiAgICAgICAgICBfdGhpcy5fYnVzLnBvc3RNZXNzYWdlKHJlcGx5KTtcclxuXHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHJlcGx5LmJvZHkgPSB7XHJcbiAgICAgICAgICBjb2RlOiA0MDAsXHJcbiAgICAgICAgICBkZXNjOiAnbWlzc2luZyBib2R5IG9yIGJvZHkgcmVzb3VyY2UgbWFuZGF0b3J5IGZpZWxkcydcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBsb2cuZXJyb3IoJ1tTeW5jaGVyTWFuYWdlci5vblJlYWRdIGVycm9yLiBNaXNzaW5nIGJvZHkgb3IgYm9keSByZXNvdXJjZSBtYW5kYXRvcnkgZmllbGRzJywgbXNnKTtcclxuXHJcbiAgICAgICAgX3RoaXMuX2J1cy5wb3N0TWVzc2FnZShyZXBseSk7XHJcblxyXG5cclxuICAgICAgfVxyXG5cclxuICAgIH1cclxuXHJcbiAgLy9GTE9XLUlOOiBtZXNzYWdlIHJlY2VpdmVkIGZyb20gU3luY2hlciAtPiBjcmVhdGVcclxuICBfb25DcmVhdGUobXNnKSB7XHJcblxyXG4gICAgbGV0IGZyb20gPSBtc2cuZnJvbTtcclxuICAgIGxldCB0byA9IG1zZy50bztcclxuICAgIGxldCBfdGhpcyA9IHRoaXM7XHJcblxyXG4gICAgLy8gY2hlY2sgaWYgbWVzc2FnZSBpcyB0byBzYXZlIG5ldyBjaGlsZHJlbk9iamVjdHMgaW4gdGhlIGxvY2FsIHN0b3JhZ2VcclxuICAgIC8vIFRPRE86IGNoZWNrIGlmIG1lc3NhZ2UgaXMgdG8gc3RvcmUgbmV3IGNoaWxkIGluIHRoZSBsb2NhbCBzdG9yYWdlIGFuZCBjYWxsIHN0b3JlQ2hpbGQuIEhvdyB0byBkaXN0aW5ndWlzaCBmcm9tIG90aGVycz9cclxuXHJcbiAgICAvL2RlYnVnZ2VyO1xyXG4gICAgaWYgKG1zZy5ib2R5LmF0dHJpYnV0ZSkgeyB0aGlzLl9zdG9yZUNoaWxkcmVucyhtc2cpOyB9IGVsc2Uge1xyXG5cclxuICAgICAgaWYgKCFtc2cuYm9keS5oYXNPd25Qcm9wZXJ0eSgncmVzdW1lJykgfHwgKG1zZy5ib2R5Lmhhc093blByb3BlcnR5KCdyZXN1bWUnKSAmJiAhbXNnLmJvZHkucmVzdW1lKSkge1xyXG5cclxuICAgICAgICAvLyBjaGVjayBpZiB0aGlzIGlzIGFuIGludml0YXRpb24gbWVzc2FnZVxyXG4gICAgICAgIGlmIChtc2cuYm9keS5hdXRob3Jpc2UpIHtcclxuICAgICAgICAgIHRoaXMuX2F1dGhvcmlzZShtc2cpO1xyXG4gICAgICAgICAgbG9nLmluZm8oJ1tTeW5jaGVyTWFuYWdlci5vbkNyZWF0ZSAtIGludml0ZSBvYnNlcnZlcnNdJywgbXNnKTtcclxuICAgICAgICB9IGVsc2UgeyAvLyB0aGlzIGlzIHRvIGNyZWF0ZSBhIG5ldyBkYXRhIG9iamVjdFxyXG4gICAgICAgICAgbG9nLmluZm8oJ1tTeW5jaGVyTWFuYWdlci5vbkNyZWF0ZSAtIENyZWF0ZSBOZXcgT2JqZWN0XScsIG1zZyk7XHJcbiAgICAgICAgICB0aGlzLl9uZXdDcmVhdGUobXNnKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICB9IGVsc2Uge1xyXG5cclxuICAgICAgICAvLyBJZiBmcm9tIHRoZSBoeXBlcnR5IHNpZGUsIGNhbGwgdGhlIHJlc3VtZVJlcG9ydGVyIHdlIHdpbGwgaGF2ZSByZXN1bWUgPSB0cnVlJ1xyXG4gICAgICAgIC8vIHNvIHdlIHdpbGwgY3JlYXRlIGFuIHJlc3VtZWQgb2JqZWN0IGFuZCB3aWxsIHRyeSB0byByZXN1bWUgdGhlIG9iamVjdCBwcmV2aW91c2x5IHNhdmVkO1xyXG4gICAgICAgIHRoaXMuX2RhdGFPYmplY3RzU3RvcmFnZS5nZXRSZXNvdXJjZXNCeUNyaXRlcmlhKG1zZywgdHJ1ZSkudGhlbigocmVzdWx0KSA9PiB7XHJcblxyXG4gICAgICAgICAgbG9nLmluZm8oJ1tTeW5jaGVyTWFuYWdlciAtIENyZWF0ZSBSZXN1bWVkXSAtIFJlc291cmNlc0J5Q3JpdGVyaWEgfCBNZXNzYWdlOiAnLCBtc2csICcgcmVzdWx0OiAnLCByZXN1bHQpO1xyXG5cclxuICAgICAgICAgIGlmIChyZXN1bHQgJiYgT2JqZWN0LmtleXMocmVzdWx0KS5sZW5ndGggPiAwKSB7XHJcblxyXG4gICAgICAgICAgICBsZXQgbGlzdE9mUmVwb3J0ZXJzID0gW107XHJcblxyXG4gICAgICAgICAgICBPYmplY3Qua2V5cyhyZXN1bHQpLmZvckVhY2goKG9ialVSTCkgPT4ge1xyXG5cclxuICAgICAgICAgICAgICBsaXN0T2ZSZXBvcnRlcnMucHVzaChcclxuICAgICAgICAgICAgICAgICAgX3RoaXMuX3Jlc3VtZUNyZWF0ZShtc2csIHJlc3VsdFtvYmpVUkxdKVxyXG4gICAgICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICBQcm9taXNlLmFsbChsaXN0T2ZSZXBvcnRlcnMpLnRoZW4oKHJlc3VtZWRSZXBvcnRlcnMpID0+IHtcclxuICAgICAgICAgICAgICBsb2cubG9nKCdbU3luY2hlck1hbmFnZXIgLSBDcmVhdGUgUmVzdW1lZF0nLCByZXN1bWVkUmVwb3J0ZXJzKTtcclxuXHJcbiAgICAgICAgICAgICAgLy8gVE9ETzogc2hvdWQgc2VuZCB0aGUgaW5mb3JtYXRpb24gaWYgc29tZSBvYmplY3Qgd2FzIGZhaWxpbmc7XHJcbiAgICAgICAgICAgICAgbGV0IHN1Y2Nlc3NmdWxseVJlc3VtZWQgPSBPYmplY3QudmFsdWVzKHJlc3VtZWRSZXBvcnRlcnMpLmZpbHRlcigocmVwb3J0ZXIpID0+IHtcclxuICAgICAgICAgICAgICAgIHJldHVybiByZXBvcnRlciAhPT0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgIGxvZy5pbmZvKCdbU3luY2hlck1hbmFnZXIub25DcmVhdGVdIHJldHVybmluZyByZXN1bWVkIG9iamVjdHMgOiAnLCBzdWNjZXNzZnVsbHlSZXN1bWVkKTtcclxuXHJcbiAgICAgICAgICAgICAgLy9GTE9XLU9VVDogbWVzc2FnZSByZXNwb25zZSB0byBTeW5jaGVyIC0+IGNyZWF0ZSByZXN1bWVcclxuICAgICAgICAgICAgICB0aGlzLl9idXMucG9zdE1lc3NhZ2Uoe1xyXG4gICAgICAgICAgICAgICAgaWQ6IG1zZy5pZCwgdHlwZTogJ3Jlc3BvbnNlJywgZnJvbTogdG8sIHRvOiBmcm9tLFxyXG4gICAgICAgICAgICAgICAgYm9keTogeyBjb2RlOiAyMDAsIHZhbHVlOiBkZWVwQ2xvbmUoc3VjY2Vzc2Z1bGx5UmVzdW1lZCkgfVxyXG4gICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAvKnN1Y2Nlc3NmdWxseVJlc3VtZWQuZm9yRWFjaCgocmVwb3J0ZXIpID0+IHtcclxuICAgICAgICAgICAgICAgIGlmIChyZXBvcnRlci5iYWNrdXApIHtcclxuICAgICAgICAgICAgICAgICAgdGhpcy5fZGF0YU9iamVjdHNTdG9yYWdlLnN5bmMocmVwb3J0ZXIudXJsKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICB9KTsqL1xyXG5cclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgLy9mb3J3YXJkIHRvIGh5cGVydHk6XHJcbiAgICAgICAgICAgIGxldCByZXBseSA9IHt9O1xyXG4gICAgICAgICAgICByZXBseS5pZCA9IG1zZy5pZDtcclxuICAgICAgICAgICAgcmVwbHkuZnJvbSA9IG1zZy50bztcclxuICAgICAgICAgICAgcmVwbHkudG8gPSBtc2cuZnJvbTtcclxuICAgICAgICAgICAgcmVwbHkudHlwZSA9ICdyZXNwb25zZSc7XHJcbiAgICAgICAgICAgIHJlcGx5LmJvZHkgPSB7XHJcbiAgICAgICAgICAgICAgY29kZTogNDA0LFxyXG4gICAgICAgICAgICAgIGRlc2M6ICdObyBkYXRhIG9iamVjdHMgcmVwb3J0ZXJzIHRvIGJlIHJlc3VtZWQnXHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIHRoaXMuX2J1cy5wb3N0TWVzc2FnZShyZXBseSk7XHJcbiAgICAgICAgICB9XHJcblxyXG4gICAgICAgIH0pO1xyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gIH1cclxuXHJcbiAgX3N0b3JlQ2hpbGRyZW5zKG1zZykge1xyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuXHJcbiAgICBsZXQgcmVzb3VyY2UgPSBtc2cuYm9keS5yZXNvdXJjZTtcclxuICAgIGxldCBhdHRyaWJ1dGUgPSBtc2cuYm9keS5hdHRyaWJ1dGU7XHJcblxyXG4gICAgaWYgKGF0dHJpYnV0ZSA9PT0gJ2NoaWxkcmVuT2JqZWN0cycpIHtcclxuICAgICAgX3RoaXMuX2RhdGFPYmplY3RzU3RvcmFnZS5zYXZlQ2hpbGRyZW5zKGZhbHNlLCByZXNvdXJjZSwgdW5kZWZpbmVkLCBtc2cuYm9keS52YWx1ZSk7XHJcbiAgICB9IGVsc2UgeyBfdGhpcy5fZGF0YU9iamVjdHNTdG9yYWdlLnNhdmVDaGlsZHJlbnModHJ1ZSwgcmVzb3VyY2UsIGF0dHJpYnV0ZSwgbXNnLmJvZHkudmFsdWUpO1xyXG4gICAgICAgfVxyXG5cclxuICB9XHJcblxyXG4gIF9uZXdDcmVhdGUobXNnKSB7XHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG5cclxuICAgIGxldCBvd25lciA9IG1zZy5mcm9tO1xyXG4gICAgbGV0IGRvbWFpbiA9IGRpdmlkZVVSTChtc2cuZnJvbSkuZG9tYWluO1xyXG5cclxuICAgIC8vIGlmIHJlcG9ydGVyIGlzIGluIGEgSW50ZXJ3b3JraW5nIFByb3Rvc3R1YiB0aGUgcnVudGltZSBkb21haW4gYmFja2VuZCBzZXJ2aWNlcyB3aWxsIGJlIHVzZWRcclxuICAgIGlmIChfdGhpcy5fcmVnaXN0cnkuaXNJbnRlcndvcmtpbmdQcm90b1N0dWIobXNnLmZyb20pKSB7XHJcbiAgICAgIGRvbWFpbiA9IGRpdmlkZVVSTChfdGhpcy5ydW50aW1lVVJMKS5kb21haW47XHJcbiAgICB9XHJcblxyXG4vLyAgICBsZXQgZG9tYWluUmVnaXN0cmF0aW9uID0gbXNnLmJvZHkudmFsdWUuaGFzT3duUHJvcGVydHkoJ2RvbWFpbl9yZWdpc3RyYXRpb24nKSA/IG1zZy5ib2R5LnZhbHVlLmRvbWFpbl9yZWdpc3RyYXRpb24gOiB0cnVlO1xyXG4gICAgbGV0IGRvbWFpblJvdXRpbmcgPSBtc2cuYm9keS52YWx1ZS5oYXNPd25Qcm9wZXJ0eSgnZG9tYWluX3JvdXRpbmcnKSA/IG1zZy5ib2R5LnZhbHVlLmRvbWFpbl9yb3V0aW5nIDogdHJ1ZTtcclxuXHJcbiAgICAvLyBQcm9jZXNzIGludml0YXRpb24gbWVzc2FnZSB0byBvYnNlcnZlcnNcclxuXHJcbiAgICAvKmlmIChtc2cuYm9keS5hdXRob3Jpc2UpIHtcclxuICAgICAgX3RoaXMuX2F1dGhvcmlzZShtc2cpO1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9Ki9cclxuXHJcbiAgICAvL2dldCBzY2hlbWEgZnJvbSBjYXRhbG9ndWUgYW5kIHBhcnNlIC0+IChzY2hlbWUsIGNoaWxkcmVuKVxyXG4gICAgX3RoaXMuX2NhdGFsb2cuZ2V0RGF0YVNjaGVtYURlc2NyaXB0b3IobXNnLmJvZHkuc2NoZW1hKS50aGVuKChkZXNjcmlwdG9yKSA9PiB7XHJcblxyXG5cclxuXHJcblxyXG4gICAgICBsZXQgcHJvcGVydGllcyA9IGRlc2NyaXB0b3Iuc291cmNlUGFja2FnZS5zb3VyY2VDb2RlLnByb3BlcnRpZXM7XHJcbiAgICAgIGxldCBzY2hlbWUgPSBwcm9wZXJ0aWVzLnNjaGVtZSA/IHByb3BlcnRpZXMuc2NoZW1lIDogJ3Jlc291cmNlJztcclxuICAgICAgbGV0IGNoaWxkcmVucyA9IHByb3BlcnRpZXMuY2hpbGRyZW5zID8gcHJvcGVydGllcy5jaGlsZHJlbnMgOiBbXTtcclxuXHJcbiAgICAgIC8vIERvIHNjaGVtYSB2YWxpZGF0aW9uXHJcbiAgICAgIC8vIFRPRE86IGNoZWNrIGlmIGlzIG5lZWQgdG8gaGFuZGxlIHdpdGggdGhlIHJlc3VsdCBvZiB2YWxpZGF0aW9uXHJcbiAgICAgIC8vICAgICAgc2NoZW1hVmFsaWRhdGlvbihzY2hlbWUsIGRlc2NyaXB0b3IsIG1zZy5ib2R5LnZhbHVlKTtcclxuXHJcbiAgICAgIGxldCBvYmplY3RJbmZvID0ge1xyXG4gICAgICAgIG5hbWU6IG1zZy5ib2R5LnZhbHVlLm5hbWUsXHJcbiAgICAgICAgc2NoZW1hOiBtc2cuYm9keS52YWx1ZS5zY2hlbWEsXHJcbiAgICAgICAgcmVwb3J0ZXI6IG1zZy5ib2R5LnZhbHVlLnJlcG9ydGVyLFxyXG4gICAgICAgIHJlc291cmNlczogbXNnLmJvZHkudmFsdWUucmVzb3VyY2VzXHJcbiAgICAgIH07XHJcblxyXG4gICAgICAvLyBzaG91bGQgcmVzdXNlIGRhdGEgb2JqZWN0IHVybCBpZiBpdCBwYXNzZWRcclxuICAgICAgbGV0IHJldXNlRGF0YU9iamVjdCA9IG1zZy5ib2R5LnZhbHVlLnJlc291cmNlO1xyXG4gICAgICBsZXQgbnVtT2ZBZGRyZXNzID0gMTtcclxuXHJcbiAgICAgIC8vZGVidWdnZXI7XHJcbiAgICAgIC8vcmVxdWVzdCBhZGRyZXNzIGFsbG9jYXRpb24gb2YgYSBuZXcgb2JqZWN0IGZyb20gdGhlIG1zZy1ub2RlXHJcbiAgICAgIC8vX3RoaXMuX2FsbG9jYXRvci5jcmVhdGUoZG9tYWluLCBudW1PZkFkZHJlc3MsIG9iamVjdEluZm8sIHNjaGVtZSwgcmV1c2VEYXRhT2JqZWN0KS50aGVuKChhbGxvY2F0ZWQpID0+IHtcclxuICAgICAgX3RoaXMuX2FsbG9jYXRvci5jcmVhdGUoZG9tYWluLCBudW1PZkFkZHJlc3MsIG9iamVjdEluZm8sIHNjaGVtZSwgcmV1c2VEYXRhT2JqZWN0KS50aGVuKChhbGxvY2F0ZWQpID0+IHtcclxuXHJcbiAgICAgICAgbGV0IG9iamVjdFJlZ2lzdHJhdGlvbiA9IGRlZXBDbG9uZShtc2cuYm9keS52YWx1ZSk7XHJcbiAgICAgICAgb2JqZWN0UmVnaXN0cmF0aW9uLnVybCA9IGFsbG9jYXRlZC5hZGRyZXNzWzBdO1xyXG4gICAgICAgIG9iamVjdFJlZ2lzdHJhdGlvbi5hdXRob3Jpc2UgPSBtc2cuYm9keS5hdXRob3Jpc2U7XHJcbiAgICAgICAgb2JqZWN0UmVnaXN0cmF0aW9uLmNoaWxkcmVucyA9IGNoaWxkcmVucztcclxuXHJcbiAgICAgICAgLy9vYmplY3RSZWdpc3RyYXRpb24uZXhwaXJlcyA9IDMwOy8vVE9ETzogZ2V0IGl0IGZyb20gZGF0YSBvYmplY3QgY29uZmlndXJhdGlvbiBkZXNjcmlwdGlvbiB3aGVuIHByZXNlbnRcclxuXHJcbiAgICAgICAgZGVsZXRlIG9iamVjdFJlZ2lzdHJhdGlvbi5kYXRhO1xyXG5cclxuICAgICAgICBsb2cubG9nKCdbU3luY2hlck1hbmFnZXIuX25ld0NyZWF0ZV0gQUxMT0NBVE9SIENSRUFURTonLCBhbGxvY2F0ZWQpO1xyXG5cclxuICAgICAgICBsZXQgc3Vic2NyaXB0aW9uVVJMID0gb2JqZWN0UmVnaXN0cmF0aW9uLnVybCArICcvc3Vic2NyaXB0aW9uJztcclxuXHJcbiAgICAgICAgbG9nLmxvZygnW1N5bmNoZXJNYW5hZ2VyLl9uZXdDcmVhdGVdIFN1YnNjcmlwdGlvbiBVUkwnLCBzdWJzY3JpcHRpb25VUkwpO1xyXG5cclxuICAgICAgICAvL1RvIHJlZ2lzdGVyIHRoZSBkYXRhT2JqZWN0IGluIHRoZSBydW50aW1lUmVnaXN0cnlcclxuICAgICAgICBsb2cuaW5mbygnW1N5bmNoZXJNYW5hZ2VyLl9uZXdDcmVhdGVdIFJlZ2lzdGVyIE9iamVjdDogJywgb2JqZWN0UmVnaXN0cmF0aW9uKTtcclxuXHJcbiAgICAgICAgLy9fdGhpcy5fcmVnaXN0cnkucmVnaXN0ZXJEYXRhT2JqZWN0KG1zZy5ib2R5LnZhbHVlLm5hbWUsIG1zZy5ib2R5LnZhbHVlLnNjaGVtYSwgb2JqVVJMLCBtc2cuYm9keS52YWx1ZS5yZXBvcnRlciwgbXNnLmJvZHkudmFsdWUucmVzb3VyY2VzLCBhbGxvY2F0ZWQsIG1zZy5ib2R5LmF1dGhvcmlzZSkudGhlbigocmVzb2x2ZSkgPT4ge1xyXG4gICAgICAgIF90aGlzLl9yZWdpc3RyeS5yZWdpc3RlckRhdGFPYmplY3Qob2JqZWN0UmVnaXN0cmF0aW9uKS50aGVuKChyZWdpc3RlcmVkT2JqZWN0KSA9PiB7XHJcbiAgICAgICAgICBsb2cubG9nKCdbU3luY2hlck1hbmFnZXIuX25ld0NyZWF0ZV0gRGF0YU9iamVjdCBzdWNjZXNzZnVsbHkgcmVnaXN0ZXJlZCcsIHJlZ2lzdGVyZWRPYmplY3QpO1xyXG5cclxuICAgICAgICAgIC8vYWxsIE9LIC0+IGNyZWF0ZSByZXBvcnRlciBhbmQgcmVnaXN0ZXIgbGlzdGVuZXJzXHJcbiAgICAgICAgICBsZXQgcmVwb3J0ZXI7XHJcblxyXG5cclxuICAgICAgICAgIGlmICghdGhpcy5fcmVwb3J0ZXJzW29iamVjdFJlZ2lzdHJhdGlvbi51cmxdKSB7XHJcbiAgICAgICAgICAgIGxldCBvZmZsaW5lID0gb2JqZWN0UmVnaXN0cmF0aW9uLm9mZmxpbmUgPyBvYmplY3RSZWdpc3RyYXRpb24ub2ZmbGluZSA6IGZhbHNlO1xyXG4gICAgICAgICAgICByZXBvcnRlciA9IG5ldyBSZXBvcnRlck9iamVjdChfdGhpcywgb3duZXIsIG9iamVjdFJlZ2lzdHJhdGlvbi51cmwsIGNoaWxkcmVucywgb2ZmbGluZSk7XHJcbiAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICByZXBvcnRlciA9IHRoaXMuX3JlcG9ydGVyc1tvYmplY3RSZWdpc3RyYXRpb24udXJsXTtcclxuICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICBsb2cubG9nKCdbU3luY2hlck1hbmFnZXIgLSBuZXcgQ3JlYXRlXSAtICcsIG1zZyk7XHJcblxyXG4gICAgICAgICAgLy8gU3RvcmUgZm9yIGVhY2ggcmVwb3J0ZXIgaHlwZXJ0eSB0aGUgZGF0YU9iamVjdFxyXG4gICAgICAgICAgbGV0IHVzZXJVUkw7XHJcbiAgICAgICAgICAvLyBsZXQgaW50ZXJ3b3JraW5nID0gZmFsc2U7XHJcblxyXG4gICAgICAgICAgaWYgKG1zZy5ib2R5Lmhhc093blByb3BlcnR5KCdpZGVudGl0eScpICYmIG1zZy5ib2R5LmlkZW50aXR5LnVzZXJQcm9maWxlICYmIG1zZy5ib2R5LmlkZW50aXR5LnVzZXJQcm9maWxlLnVzZXJVUkwpIHtcclxuICAgICAgICAgICAgdXNlclVSTCA9IG1zZy5ib2R5LmlkZW50aXR5LnVzZXJQcm9maWxlLnVzZXJVUkw7XHJcblxyXG4gICAgICAgICAgICAvLyBpZiAoIXVzZXJVUkwuaW5jbHVkZXMoJ3VzZXI6Ly8nKSkge1xyXG4gICAgICAgICAgICAvLyAgIGludGVyd29ya2luZyA9IHRydWU7XHJcbiAgICAgICAgICAgIC8vIH1cclxuICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHVzZXJVUkwgPSBfdGhpcy5fcmVnaXN0cnkuZ2V0SHlwZXJ0eU93bmVyKG1zZy5mcm9tKTtcclxuXHJcbiAgICAgICAgICAgIC8vIGlmICghdXNlclVSTCkge1xyXG4gICAgICAgICAgICAvLyAgIGludGVyd29ya2luZyA9IHRydWU7XHJcbiAgICAgICAgICAgIC8vIH1cclxuICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAvLyBzaG91bGQgd2UgdXNlIHRoZSBtc2cuYm9keS52YWx1ZSBpbnN0ZWFkP1xyXG5cclxuICAgICAgICAgIGxldCBtZXRhZGF0YSA9IGRlZXBDbG9uZShvYmplY3RSZWdpc3RyYXRpb24pO1xyXG4gICAgICAgICAgbWV0YWRhdGEuc3Vic2NyaWJlclVzZXIgPSB1c2VyVVJMO1xyXG4gICAgICAgICAgbWV0YWRhdGEuaXNSZXBvcnRlciA9IHRydWU7XHJcblxyXG4gICAgICAgICAgLy8gU3RvcmUgdGhlIGRhdGFPYmplY3QgaW5mb3JtYXRpb25cclxuXHJcbiAgICAgICAgICAvL2lmICghaW50ZXJ3b3JraW5nKSB7XHJcblxyXG4gICAgICAgICAgaWYgKG1zZy5ib2R5Lmhhc093blByb3BlcnR5KCdzdG9yZScpICYmIG1zZy5ib2R5LnN0b3JlKSB7XHJcbiAgICAgICAgICAgIHJlcG9ydGVyLmlzVG9TYXZlRGF0YSA9IHRydWU7XHJcbiAgICAgICAgICAgIG1ldGFkYXRhLmlzVG9TYXZlRGF0YSA9IHRydWU7XHJcbiAgICAgICAgICAgIGlmIChtc2cuYm9keS52YWx1ZS5kYXRhKSB7XHJcbiAgICAgICAgICAgICAgbWV0YWRhdGEuZGF0YSA9IGRlZXBDbG9uZShtc2cuYm9keS52YWx1ZS5kYXRhKTtcclxuLy8gICAgICAgICAgICAgIF90aGlzLl9kYXRhT2JqZWN0c1N0b3JhZ2Uuc2F2ZURhdGEodHJ1ZSwgb2JqZWN0UmVnaXN0cmF0aW9uLnVybCwgbnVsbCwgbXNnLmJvZHkudmFsdWUuZGF0YSk7IH1cclxuLy8gICAgICAgICAgICBfdGhpcy5fZGF0YU9iamVjdHNTdG9yYWdlLnVwZGF0ZSh0cnVlLCBvYmplY3RSZWdpc3RyYXRpb24udXJsLCAnaXNUb1NhdmVEYXRhJywgdHJ1ZSk7XHJcblxyXG4vLyAgICAgICAgICAgIGlmIChtc2cuYm9keS52YWx1ZS5kYXRhKSB7IF90aGlzLl9kYXRhT2JqZWN0c1N0b3JhZ2Uuc2F2ZURhdGEodHJ1ZSwgb2JqZWN0UmVnaXN0cmF0aW9uLnVybCwgbnVsbCwgbXNnLmJvZHkudmFsdWUuZGF0YSk7IH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgX3RoaXMuX2RhdGFPYmplY3RzU3RvcmFnZS5zZXQobWV0YWRhdGEpLnRoZW4oKHN0b3JlT2JqZWN0KSA9PiB7XHJcblxyXG4gICAgICAgICAgICBpZiAobWV0YWRhdGEub2ZmbGluZSkgeyAvL3JlZ2lzdGVyIG5ldyBEYXRhT2JqZWN0IGF0IE9mZmxpbmUgU3Vic2NyaXB0aW9uIE1hbmFnZXJcclxuICAgICAgICAgICAgICBtc2cuYm9keS5pZGVudGl0eS5ndWlkID0gX3RoaXMuX2lkZW50aXR5TW9kdWxlLl9pZGVudGl0aWVzLmd1aWQ7XHJcbiAgICAgICAgICAgICAgbGV0IGZvcndhcmQgPSB7XHJcbiAgICAgICAgICAgICAgICBmcm9tOiBtc2cudG8sXHJcbiAgICAgICAgICAgICAgICB0bzogbWV0YWRhdGEub2ZmbGluZSArICcvcmVnaXN0ZXInLFxyXG4gICAgICAgICAgICAgICAgdHlwZTogJ2ZvcndhcmQnLFxyXG4gICAgICAgICAgICAgICAgYm9keTogbXNnXHJcbiAgICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICAgZm9yd2FyZC5ib2R5LmJvZHkucmVzb3VyY2UgPSBvYmplY3RSZWdpc3RyYXRpb24udXJsO1xyXG5cclxuICAgICAgICAgICAgICBmb3J3YXJkLmJvZHkuYm9keS52YWx1ZSA9IG1ldGFkYXRhO1xyXG5cclxuICAgICAgICAgICAgICBsb2cubG9nKCdbU3luY2hlck1hbmFnZXIubmV3Q3JlYXRlXSByZWdpc3RlcmluZyBuZXcgb2JqZWN0IGF0IG9mZmxpbmUgbWFuYWdlciAnLCBmb3J3YXJkKTtcclxuXHJcbiAgICAgICAgICAgICAgX3RoaXMuX2J1cy5wb3N0TWVzc2FnZShmb3J3YXJkKTtcclxuXHJcblxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAvL31cclxuICAgICAgICAgIGxldCByZXNwb25zZU1zZyA9IHtcclxuICAgICAgICAgICAgaWQ6IG1zZy5pZCwgdHlwZTogJ3Jlc3BvbnNlJywgZnJvbTogbXNnLnRvLCB0bzogb3duZXIsXHJcbiAgICAgICAgICAgIGJvZHk6IHsgY29kZTogMjAwLCByZXNvdXJjZTogb2JqZWN0UmVnaXN0cmF0aW9uLnVybCwgY2hpbGRyZW5SZXNvdXJjZXM6IGNoaWxkcmVucyB9XHJcbiAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgIC8vIGFkZGluZyBsaXN0ZW5lcnMgdG8gZm9yd2FyZCB0byByZXBvcnRlclxyXG5cclxuICAgICAgICAgIGlmIChkb21haW5Sb3V0aW5nKSB7XHJcblxyXG4gICAgICAgICAgICByZXBvcnRlci5mb3J3YXJkU3Vic2NyaWJlKFtvYmplY3RSZWdpc3RyYXRpb24udXJsLCBzdWJzY3JpcHRpb25VUkxdKS50aGVuKCgpID0+IHtcclxuICAgICAgICAgICAgICByZXBvcnRlci5hZGRDaGlsZHJlbnMoKS50aGVuKCgpID0+IHtcclxuICAgICAgICAgICAgICAgIF90aGlzLl9yZXBvcnRlcnNbb2JqZWN0UmVnaXN0cmF0aW9uLnVybF0gPSByZXBvcnRlcjtcclxuXHJcblxyXG4gICAgICAgICAgICAgICAgLy9GTE9XLU9VVDogbWVzc2FnZSByZXNwb25zZSB0byBTeW5jaGVyIC0+IGNyZWF0ZVxyXG4gICAgICAgICAgICAgICAgX3RoaXMuX2J1cy5wb3N0TWVzc2FnZShyZXNwb25zZU1zZyk7XHJcblxyXG4gICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHJlcG9ydGVyLmFkZENoaWxkcmVucygpLnRoZW4oKCkgPT4ge1xyXG4gICAgICAgICAgICAgIF90aGlzLl9yZXBvcnRlcnNbb2JqZWN0UmVnaXN0cmF0aW9uLnVybF0gPSByZXBvcnRlcjtcclxuXHJcblxyXG4gICAgICAgICAgICAgIC8vRkxPVy1PVVQ6IG1lc3NhZ2UgcmVzcG9uc2UgdG8gU3luY2hlciAtPiBjcmVhdGVcclxuICAgICAgICAgICAgICBfdGhpcy5fYnVzLnBvc3RNZXNzYWdlKHJlc3BvbnNlTXNnKTtcclxuXHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgIH1cclxuICAgICAgICAgIH0sIChlcnJvcik9PiB7XHJcbiAgICAgICAgICAgIGxvZy5lcnJvcihlcnJvcik7XHJcbiAgICAgICAgICB9KTtcclxuXHJcblxyXG4gICAgICAgIH0sIGZ1bmN0aW9uIChlcnJvcikge1xyXG4gICAgICAgICAgbG9nLmVycm9yKGVycm9yKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgIH0pO1xyXG4gICAgfSkuY2F0Y2goKHJlYXNvbikgPT4ge1xyXG4gICAgICAvL0ZMT1ctT1VUOiBlcnJvciBtZXNzYWdlIHJlc3BvbnNlIHRvIFN5bmNoZXIgLT4gY3JlYXRlXHJcbiAgICAgIGxldCByZXNwb25zZU1zZyA9IHtcclxuICAgICAgICBpZDogbXNnLmlkLCB0eXBlOiAncmVzcG9uc2UnLCBmcm9tOiBtc2cudG8sIHRvOiBvd25lcixcclxuICAgICAgICBib2R5OiB7IGNvZGU6IDUwMCwgZGVzYzogcmVhc29uIH1cclxuICAgICAgfTtcclxuXHJcbiAgICAgIF90aGlzLl9idXMucG9zdE1lc3NhZ2UocmVzcG9uc2VNc2cpO1xyXG4gICAgfSk7XHJcblxyXG4gIH1cclxuXHJcbiAgX3Jlc3VtZUNyZWF0ZShtc2csIHN0b3JlZE9iamVjdCkge1xyXG5cclxuICAgIGxldCBfdGhpcyA9IHRoaXM7XHJcblxyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7XHJcblxyXG4gICAgICBsZXQgb3duZXIgPSBtc2cuZnJvbTtcclxuICAgICAgbGV0IHNjaGVtYSA9IHN0b3JlZE9iamVjdC5zY2hlbWE7XHJcbiAgICAgIGxldCByZXNvdXJjZSA9IHN0b3JlZE9iamVjdC51cmw7XHJcbiAgICAgIGxldCBkb21haW5SZWdpc3RyYXRpb24gPSBzdG9yZWRPYmplY3QuaGFzT3duUHJvcGVydHkoJ2RvbWFpbl9yZWdpc3RyYXRpb24nKSA/IHN0b3JlZE9iamVjdC5kb21haW5fcmVnaXN0cmF0aW9uIDogdHJ1ZTtcclxuICAgICAgbGV0IGluaXRpYWxEYXRhID0gc3RvcmVkT2JqZWN0LmRhdGE7XHJcblxyXG4gICAgICBsb2cubG9nKCdbU3luY2hlck1hbmFnZXJdIC0gcmVzdW1lIGNyZWF0ZScsIG1zZywgc3RvcmVkT2JqZWN0KTtcclxuXHJcbiAgICAgIC8vZ2V0IHNjaGVtYSBmcm9tIGNhdGFsb2d1ZSBhbmQgcGFyc2UgLT4gKHNjaGVtZSwgY2hpbGRyZW4pXHJcbiAgICAgIF90aGlzLl9jYXRhbG9nLmdldERhdGFTY2hlbWFEZXNjcmlwdG9yKHNjaGVtYSkudGhlbigoZGVzY3JpcHRvcikgPT4ge1xyXG5cclxuICAgICAgICBsZXQgcHJvcGVydGllcyA9IGRlc2NyaXB0b3Iuc291cmNlUGFja2FnZS5zb3VyY2VDb2RlLnByb3BlcnRpZXM7XHJcbiAgICAgICAgbGV0IHNjaGVtZSA9IHByb3BlcnRpZXMuc2NoZW1lID8gcHJvcGVydGllcy5zY2hlbWUuY29uc3RhbnQgOiAncmVzb3VyY2UnO1xyXG4gICAgICAgIGxldCBjaGlsZHJlbnMgPSBwcm9wZXJ0aWVzLmNoaWxkcmVucyA/IHByb3BlcnRpZXMuY2hpbGRyZW5zIDogW107XHJcblxyXG4gICAgICAgIGxvZy5sb2coJ1tTeW5jaGVyTWFuYWdlcl0gLSBnZXREYXRhU2NoZW1hRGVzY3JpcHRvcjogJywgZGVzY3JpcHRvciwgY2hpbGRyZW5zKTtcclxuXHJcbiAgICAgICAgLy8gRG8gc2NoZW1hIHZhbGlkYXRpb25cclxuICAgICAgICAvLyBUT0RPOiBjaGVjayBpZiBpcyBuZWVkIHRvIGhhbmRsZSB3aXRoIHRoZSByZXN1bHQgb2YgdmFsaWRhdGlvblxyXG4gICAgICAgIC8vICAgICAgICBzY2hlbWFWYWxpZGF0aW9uKHNjaGVtZSwgZGVzY3JpcHRvciwgaW5pdGlhbERhdGEpO1xyXG5cclxuXHJcbiAgICAgICAgLy9hbGwgT0sgLT4gY3JlYXRlIHJlcG9ydGVyIGFuZCByZWdpc3RlciBsaXN0ZW5lcnNcclxuICAgICAgICBsZXQgcmVwb3J0ZXI7XHJcbiAgICAgICAgbGV0IG9mZmxpbmU7XHJcblxyXG4gICAgICAgIGlmICghdGhpcy5fcmVwb3J0ZXJzW3Jlc291cmNlXSkge1xyXG4gICAgICAgICAgb2ZmbGluZSA9IHN0b3JlZE9iamVjdC5vZmZsaW5lID8gc3RvcmVkT2JqZWN0Lm9mZmxpbmUgOiBmYWxzZTtcclxuICAgICAgICAgIHJlcG9ydGVyID0gbmV3IFJlcG9ydGVyT2JqZWN0KF90aGlzLCBvd25lciwgcmVzb3VyY2UsIGNoaWxkcmVucywgb2ZmbGluZSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIHJlcG9ydGVyID0gdGhpcy5fcmVwb3J0ZXJzW3Jlc291cmNlXTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJlcG9ydGVyLmlzVG9TYXZlRGF0YSA9IHN0b3JlZE9iamVjdC5pc1RvU2F2ZURhdGE7XHJcblxyXG4gICAgICAgIGlmIChvZmZsaW5lKSB7IC8vdXBkYXRlIG5ldyBEYXRhT2JqZWN0IGF0IE9mZmxpbmUgU3Vic2NyaXB0aW9uIE1hbmFnZXJcclxuICAgICAgICAgIGxldCBtc2cgPSB7XHJcbiAgICAgICAgICAgIGZyb206IF90aGlzLl91cmwsXHJcbiAgICAgICAgICAgIHRvOiBvZmZsaW5lICsgJy9yZWdpc3RlcicsXHJcbiAgICAgICAgICAgIHR5cGU6ICd1cGRhdGUnLFxyXG4gICAgICAgICAgICBib2R5OiB7fVxyXG4gICAgICAgICAgfTtcclxuICBcclxuICAgICAgICAgIGxvZy5sb2coJ1tTeW5jaGVyTWFuYWdlci5fcmVzdW1lQ3JlYXRlXSB1cGRhdGUgb2JqZWN0IGF0IG9mZmxpbmUgbWFuYWdlciAnLCBtc2cpO1xyXG4gIFxyXG4gICAgICAgICAgX3RoaXMuX2J1cy5wb3N0TWVzc2FnZShtc2cpO1xyXG4gIFxyXG4gIFxyXG4gICAgICAgIH1cclxuICBcclxuXHJcbiAgICAgICAgaWYgKGRvbWFpblJlZ2lzdHJhdGlvbikge1xyXG4gICAgICAgICAgcmVwb3J0ZXIuZm9yd2FyZFN1YnNjcmliZShbc3RvcmVkT2JqZWN0LnVybF0pLnRoZW4oKCkgPT4ge1xyXG4gICAgICAgICAgICBsb2cubG9nKCdbU3luY2hlck1hbmFnZXIuX3Jlc3VtZUNyZWF0ZV0gcmVzdW1pbmdSZXBvcnRlclN1YnNjcmlwdGlvbiAnLCBzdG9yZWRPYmplY3QpO1xyXG4gICAgICAgICAgICBfdGhpcy5fcmVzdW1lUmVwb3J0ZXJTdWJzY3JpcHRpb25zKG1zZywgc3RvcmVkT2JqZWN0LCByZXBvcnRlciwgY2hpbGRyZW5zLCBkb21haW5SZWdpc3RyYXRpb24pLnRoZW4oKHJlc3VtZU9iamVjdCk9PntcclxuICAgICAgICAgICAgICBsb2cubG9nKCdbU3luY2hlck1hbmFnZXIuX3Jlc3VtZUNyZWF0ZV0gcmVzb2x2ZWQgcmVzdW1lZCBvYmplY3QgJywgcmVzdW1lT2JqZWN0KTtcclxuICAgICAgICAgICAgICByZXNvbHZlKHJlc3VtZU9iamVjdCk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICB9IGVsc2UgcmVzb2x2ZShfdGhpcy5fcmVzdW1lUmVwb3J0ZXJTdWJzY3JpcHRpb25zKG1zZywgc3RvcmVkT2JqZWN0LCByZXBvcnRlciwgY2hpbGRyZW5zLCBkb21haW5SZWdpc3RyYXRpb24pKTtcclxuXHJcbiAgICAgICAgLy8gIHJlc29sdmUoKTtcclxuICAgICAgfSkuY2F0Y2goKHJlYXNvbikgPT4ge1xyXG4gICAgICAgIGxvZy5lcnJvcignW1N5bmNoZXJNYW5hZ2VyIC0gcmVzdW1lIGNyZWF0ZV0gLSBmYWlsIG9uIGdldERhdGFTY2hlbWFEZXNjcmlwdG9yOiAnLCByZWFzb24pO1xyXG4gICAgICAgIHJlc29sdmUoZmFsc2UpO1xyXG4gICAgICB9KTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgX3Jlc3VtZVJlcG9ydGVyU3Vic2NyaXB0aW9ucyhtc2csIHN0b3JlZE9iamVjdCwgcmVwb3J0ZXIsIGNoaWxkcmVucywgZG9tYWluUmVnaXN0cmF0aW9uKXtcclxuICAgIGxldCBfdGhpcyA9IHRoaXM7XHJcbiAgICBsZXQgcmVzb3VyY2UgPSBzdG9yZWRPYmplY3QudXJsO1xyXG4gICAgbGV0IG9iamVjdFJlZ2lzdHJhdGlvbiA9IGRlZXBDbG9uZShtc2cuYm9keS52YWx1ZSk7XHJcbiAgICBvYmplY3RSZWdpc3RyYXRpb24udXJsID0gc3RvcmVkT2JqZWN0LnVybDtcclxuICAgIG9iamVjdFJlZ2lzdHJhdGlvbi5leHBpcmVzID0gc3RvcmVkT2JqZWN0LmV4cGlyZXM7XHJcbiAgICBvYmplY3RSZWdpc3RyYXRpb24uZG9tYWluX3JlZ2lzdHJhdGlvbiA9IGRvbWFpblJlZ2lzdHJhdGlvbjtcclxuXHJcbiAgICBkZWxldGUgb2JqZWN0UmVnaXN0cmF0aW9uLmRhdGE7XHJcblxyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7XHJcblxyXG5cclxuICAgIHJlcG9ydGVyLmFkZENoaWxkcmVucygpLnRoZW4oKCkgPT4ge1xyXG5cclxuICAgICAgcmVwb3J0ZXIucmVzdW1lU3Vic2NyaXB0aW9ucyhzdG9yZWRPYmplY3Quc3Vic2NyaXB0aW9ucyk7XHJcblxyXG4gICAgICBfdGhpcy5fcmVwb3J0ZXJzW3Jlc291cmNlXSA9IHJlcG9ydGVyO1xyXG5cclxuICAgICAgbG9nLmluZm8oJ1tTeW5jaGVyTWFuYWdlciAtIHJlc3VtZSBjcmVhdGVdIC0gcmVzb2x2ZWQgcmVzdW1lZDogJywgc3RvcmVkT2JqZWN0KTtcclxuXHJcbiAgICAgIHJldHVybiBfdGhpcy5fZGVjcnlwdENoaWxkcmVucyhzdG9yZWRPYmplY3QsIGNoaWxkcmVucyk7XHJcbiAgICB9KS50aGVuKChkZWNyeXB0ZWRPYmplY3QpID0+IHtcclxuXHJcbiAgICAgIGxvZy5pbmZvKCdbU3luY2hlck1hbmFnZXIuX3Jlc3VtZVJlcG9ydGVyU3Vic2NyaXB0aW9uc10gUmVnaXN0ZXIgT2JqZWN0OiAnLCBvYmplY3RSZWdpc3RyYXRpb24pO1xyXG4gICAgICBfdGhpcy5fcmVnaXN0cnkucmVnaXN0ZXJEYXRhT2JqZWN0KG9iamVjdFJlZ2lzdHJhdGlvbikudGhlbigocmVnaXN0ZXJlZCkgPT4ge1xyXG4gICAgICAgIGxvZy5sb2coJ1tTeW5jaGVyTWFuYWdlci5fcmVzdW1lUmVwb3J0ZXJTdWJzY3JpcHRpb25zXSBEYXRhT2JqZWN0IHJlZ2lzdHJhdGlvbiBzdWNjZXNzZnVsbHkgdXBkYXRlZCcsIHJlZ2lzdGVyZWQpO1xyXG4gICAgICAgIGxvZy5sb2coJ1tTeW5jaGVyTWFuYWdlci5fcmVzdW1lUmVwb3J0ZXJTdWJzY3JpcHRpb25zXSByZXNvbHZpbmcgb2JqZWN0JywgZGVjcnlwdGVkT2JqZWN0KTtcclxuICAgICAgICByZXNvbHZlKGRlY3J5cHRlZE9iamVjdCk7XHJcblxyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIC8vIGxvZy5sb2coJ3Jlc3VsdCBvZiBwcmV2aW91cyBwcm9taXNlJyk7XHJcbiAgICB9KS5jYXRjaCgocmVhc29uKSA9PiB7XHJcbiAgICAgIGxvZy5lcnJvcignW1N5bmNoZXJNYW5hZ2VyIC0gcmVzdW1lIGNyZWF0ZV0gLSBmYWlsIG9uIGFkZENoaWxkcmVuczogJywgcmVhc29uKTtcclxuICAgICAgcmVzb2x2ZShmYWxzZSk7XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgfVxyXG5cclxuICAvLyB0byBkZWNyeXB0IERhdGFDaGlsZE9iamVjdHMgaWYgdGhleSBhcmUgZW5jcnlwdGVkXHJcblxyXG4gIF9kZWNyeXB0Q2hpbGRyZW5zKGVuY3J5cHRlZE9iamVjdCwgY2hpbGRyZW5zKSB7XHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG5cclxuICAgIGxldCBzdG9yZWRPYmplY3QgPSBkZWVwQ2xvbmUoZW5jcnlwdGVkT2JqZWN0KTtcclxuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4ge1xyXG5cclxuICAgICAgaWYgKCFjaGlsZHJlbnMpIHsgcmVzb2x2ZShzdG9yZWRPYmplY3QpOyB9IGVsc2Uge1xyXG4gICAgICAgIGxldCBjaGlsZHJlbnNPYmogPSBPYmplY3Qua2V5cyhzdG9yZWRPYmplY3QuY2hpbGRyZW5PYmplY3RzKTtcclxuXHJcbiAgICAgICAgaWYgKGNoaWxkcmVuc09iai5sZW5ndGggPT09IDApIHtcclxuICAgICAgICAgIHJlc29sdmUoc3RvcmVkT2JqZWN0KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNoaWxkcmVucy5mb3JFYWNoKChjaGlsZHJlbikgPT4ge1xyXG5cclxuLy8gICAgICAgICAgbGV0IGNoaWxkT2JqZWN0cyA9IHN0b3JlZE9iamVjdC5jaGlsZHJlbk9iamVjdHNbY2hpbGRyZW5dO1xyXG4gICAgICAgICAgbGV0IGNoaWxkT2JqZWN0cyA9IHN0b3JlZE9iamVjdC5jaGlsZHJlbk9iamVjdHM7XHJcblxyXG4gICAgICAgICAgbG9nLmxvZygnW1N5bmNoZXJNYW5hZ2VyLl9kZWNyeXB0Q2hpbGRyZW5zXSBkYXRhT2JqZWN0Q2hpbGRzIHRvIGRlY3J5cHQgJywgY2hpbGRPYmplY3RzKTtcclxuXHJcbiAgICAgICAgICBsZXQgbGlzdE9mRGVjcnlwdGVkT2JqZWN0cyA9IFtdO1xyXG5cclxuICAgICAgICAgIE9iamVjdC5rZXlzKGNoaWxkT2JqZWN0cykuZm9yRWFjaCgoY2hpbGRJZCkgPT4ge1xyXG4gICAgICAgICAgICBsZXQgY2hpbGQgPSBjaGlsZE9iamVjdHNbY2hpbGRJZF07XHJcbiAgICAgICAgICAgIGxldCBvd25lciA9IGNoaWxkSWQuc3BsaXQoJyMnKVswXTtcclxuXHJcbiAgICAgICAgICAgIGlmICh0eXBlb2YgY2hpbGQudmFsdWUgPT09ICdzdHJpbmcnKSB7XHJcblxyXG4gICAgICAgICAgICAgIGxvZy5sb2coJ1tTeW5jaGVyTWFuYWdlci5fZGVjcnlwdENoaWxkcmVuc10gY3JlYXRlZEJ5ICcsIG93bmVyLCAnIG9iamVjdDogJywgY2hpbGQudmFsdWUpO1xyXG5cclxuICAgICAgICAgICAgICBsZXQgZGVjcnlwdGVkID0gY3J5cHRvTWFuYWdlci5kZWZhdWx0LmRlY3J5cHREYXRhT2JqZWN0KEpTT04ucGFyc2UoY2hpbGQudmFsdWUpLCBzdG9yZWRPYmplY3QudXJsKTtcclxuXHJcbiAgICAgICAgICAgICAgbGlzdE9mRGVjcnlwdGVkT2JqZWN0cy5wdXNoKGRlY3J5cHRlZCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgIFByb21pc2UuYWxsKGxpc3RPZkRlY3J5cHRlZE9iamVjdHMpLnRoZW4oKGRlY3J5cHRlZE9iamVjdHMpID0+IHtcclxuXHJcbiAgICAgICAgICAgIGxvZy5sb2coJ1tTeW5jaGVyTWFuYWdlci5fZGVjcnlwdENoaWxkcmVuc10gcmV0dXJuaW5nIGRlY3J5cHRlZCAnLCBkZWNyeXB0ZWRPYmplY3RzKTtcclxuXHJcbiAgICAgICAgICAgIGRlY3J5cHRlZE9iamVjdHMuZm9yRWFjaCgoZGVjcnlwdGVkT2JqZWN0KSA9PiB7XHJcbiAgICAgICAgICAgICAgY29uc3QgY2hpbGRJZCA9IGRlY3J5cHRlZE9iamVjdC52YWx1ZS51cmw7XHJcbiAgICAgICAgICAgICAgc3RvcmVkT2JqZWN0LmNoaWxkcmVuT2JqZWN0c1tjaGlsZElkXS52YWx1ZSA9IGRlY3J5cHRlZE9iamVjdC52YWx1ZTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICBsb2cubG9nKCdbU3luY2hlck1hbmFnZXIuX2RlY3J5cHRDaGlsZHJlbnNdIHN0b3JlZE9iamVjdCAnLCBzdG9yZWRPYmplY3QpO1xyXG5cclxuICAgICAgICAgICAgcmVzb2x2ZShzdG9yZWRPYmplY3QpO1xyXG5cclxuICAgICAgICAgIH0pLmNhdGNoKChyZWFzb24pID0+IHtcclxuICAgICAgICAgICAgbG9nLndhcm4oJ1tTeW5jaGVyTWFuYWdlci5fZGVjcnlwdENoaWxkcmVuc10gZmFpbGVkIDogJywgcmVhc29uKTtcclxuICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8vIFByb2Nlc3MgaW52aXRhdGlvbnMgdG8gb2JzZXJ2ZXJzXHJcblxyXG4gIF9hdXRob3Jpc2UobXNnKSB7XHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG5cclxuICAgIGlmICghbXNnLmJvZHkucmVzb3VyY2UpIHtcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKCdbU3luY2hlck1hbmFnZXIuX2F1dGhvcmlzZV0gaW52aXRhdGlvbiByZXF1ZXN0IHdpdGhvdXQgZGF0YSBvYmplY3QgdXJsOicsIG1zZyk7XHJcbiAgICB9XHJcblxyXG4gICAgbGV0IG9ialN1YnNjcmlwdG9yVVJMID0gbXNnLmJvZHkucmVzb3VyY2UgKyAnL3N1YnNjcmlwdGlvbic7XHJcbiAgICBsZXQgcDJwID0gbXNnLmJvZHkucDJwID8gbXNnLmJvZHkucDJwIDogZmFsc2U7XHJcblxyXG4gICAgbG9nLmxvZygnW1N5bmNoZXJNYW5hZ2VyIC0gIGF1dGhvcmlzZV0gLSAnLCBtc2cpO1xyXG5cclxuICAgIGlmIChtc2cuYm9keS5hdXRob3Jpc2UpIHtcclxuICAgICAgbXNnLmJvZHkuYXV0aG9yaXNlLmZvckVhY2goKGh5cGVydHlVUkwpID0+IHtcclxuICAgICAgICAvL0ZMT1ctT1VUOiBzZW5kIGludml0ZXMgdG8gbGlzdCBvZiByZW1vdGUgU3luY2hlciAtPiBfb25SZW1vdGVDcmVhdGUgLT4gb25Ob3RpZmljYXRpb25cclxuXHJcbiAgICAgICAgX3RoaXMuX2J1cy5wb3N0TWVzc2FnZSh7XHJcbiAgICAgICAgICB0eXBlOiAnY3JlYXRlJywgZnJvbTogb2JqU3Vic2NyaXB0b3JVUkwsIHRvOiBoeXBlcnR5VVJMLFxyXG4gICAgICAgICAgYm9keTogeyBwMnA6IHAycCwgaWRlbnRpdHk6IG1zZy5ib2R5LmlkZW50aXR5LCBzb3VyY2U6IG1zZy5mcm9tLCB2YWx1ZTogbXNnLmJvZHkudmFsdWUsIHNjaGVtYTogbXNnLmJvZHkuc2NoZW1hIH1cclxuICAgICAgICB9LCAocmVwbHkpID0+IHsgLy8gbGV0cyBmb3J3YXJkIHRoZSBpbnZpdGF0aW9uIHJlc3BvbnNlXHJcbiAgICAgICAgICBsZXQgcmVzcG9uc2UgPSB7XHJcbiAgICAgICAgICAgIGZyb206IG1zZy50byxcclxuICAgICAgICAgICAgdG86IG1zZy5mcm9tLFxyXG4gICAgICAgICAgICBpZDogbXNnLmlkLFxyXG4gICAgICAgICAgICB0eXBlOiByZXBseS50eXBlLFxyXG4gICAgICAgICAgICBib2R5OiByZXBseS5ib2R5XHJcbiAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgIF90aGlzLl9idXMucG9zdE1lc3NhZ2UocmVzcG9uc2UpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICB9KTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8vRkxPVy1JTjogbWVzc2FnZSByZWNlaXZlZCBmcm9tIERhdGFPYmplY3RSZXBvcnRlciAtPiBkZWxldGVcclxuICBfb25EZWxldGUobXNnKSB7XHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG5cclxuICAgIGxldCBvYmpVUkwgPSBtc2cuYm9keS5yZXNvdXJjZTtcclxuXHJcbiAgICBsZXQgb2JqZWN0ID0gX3RoaXMuX3JlcG9ydGVyc1tvYmpVUkxdO1xyXG4gICAgaWYgKG9iamVjdCkge1xyXG4gICAgICAvL1RPRE86IGlzIHRoZXJlIGFueSBwb2xpY3kgdmVyaWZpY2F0aW9uIGJlZm9yZSBkZWxldGU/XHJcblxyXG4gICAgICBpZiAob2JqZWN0Lm9mZmxpbmUpIHsgLy9yZWdpc3RlciBuZXcgRGF0YU9iamVjdCBhdCBPZmZsaW5lIFN1YnNjcmlwdGlvbiBNYW5hZ2VyXHJcbiAgICAgICAgbGV0IGZvcndhcmQgPSB7XHJcbiAgICAgICAgICBmcm9tOiBtc2cudG8sXHJcbiAgICAgICAgICB0bzogb2JqZWN0Lm9mZmxpbmUgKyAnL3JlZ2lzdGVyJyxcclxuICAgICAgICAgIHR5cGU6ICdmb3J3YXJkJyxcclxuICAgICAgICAgIGJvZHk6IG1zZ1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGxvZy5sb2coJ1tTeW5jaGVyTWFuYWdlci5fb25EZWxldGVdIHVucmVnaXN0ZXJpbmcgb2JqZWN0IGZyb20gb2ZmbGluZSBtYW5hZ2VyICcsIGZvcndhcmQpO1xyXG5cclxuICAgICAgICBfdGhpcy5fYnVzLnBvc3RNZXNzYWdlKGZvcndhcmQpO1xyXG5cclxuXHJcbiAgICAgIH1cclxuXHJcbiAgICAgIG9iamVjdC5kZWxldGUoKTtcclxuXHJcbiAgICAgIHRoaXMuX2RhdGFPYmplY3RzU3RvcmFnZS5kZWxldGVSZXNvdXJjZShvYmpVUkwpLnRoZW4oKHJlc3VsdCkgPT4ge1xyXG5cclxuXHJcbiAgICAgICAgbG9nLmxvZygnW1N5bmNoZXJNYW5hZ2VyIC0gb25EZWxldGVdIC0gZGVsZXRlUmVzb3VyY2U6ICcsIHJlc3VsdCk7XHJcblxyXG4gICAgICAgIF90aGlzLl9yZWdpc3RyeS51bnJlZ2lzdGVyRGF0YU9iamVjdChvYmpVUkwpO1xyXG5cclxuXHJcbiAgICAgICAgLy9UT0RPOiB1bnJlZ2lzdGVyIG9iamVjdD9cclxuICAgICAgICBfdGhpcy5fYnVzLnBvc3RNZXNzYWdlKHtcclxuICAgICAgICAgIGlkOiBtc2cuaWQsIHR5cGU6ICdyZXNwb25zZScsIGZyb206IG1zZy50bywgdG86IG1zZy5mcm9tLFxyXG4gICAgICAgICAgYm9keTogeyBjb2RlOiAyMDAgfVxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgfSk7XHJcblxyXG4gICAgfVxyXG4gIH1cclxuXHJcblxyXG4gIC8vRkxPVy1JTjogbWVzc2FnZSByZWNlaXZlZCBmcm9tIGxvY2FsIFN5bmNoZXIgLT4gc3Vic2NyaWJlXHJcbiAgX29uTG9jYWxTdWJzY3JpYmUobXNnKSB7XHJcbiAgICAvL2RlYnVnZ2VyO1xyXG5cclxuICAgIGlmIChtc2cuYm9keS5oYXNPd25Qcm9wZXJ0eSgncmVzdW1lJykgJiYgKG1zZy5ib2R5LnJlc3VtZSApKSB7XHJcbiAgICAgIHRoaXMuX2RhdGFPYmplY3RzU3RvcmFnZS5nZXRSZXNvdXJjZXNCeUNyaXRlcmlhKG1zZywgZmFsc2UpLnRoZW4oKHJlc3VsdCkgPT4ge1xyXG5cclxuICAgICAgICBsb2cuaW5mbygnW1N5bmNoZXJNYW5hZ2VyLm9uTG9jYWxTdWJzY3JpYmUuIHJlc3VtZV06ICcsIG1zZywgJyByZXN1bHQ6ICcsIHJlc3VsdCk7XHJcbiAgXHJcbiAgICAgICAgaWYgKHJlc3VsdCAmJiBPYmplY3Qua2V5cyhyZXN1bHQpLmxlbmd0aCA+IDApIHtcclxuICBcclxuICAgICAgICAgIGxldCBsaXN0T2ZPYnNlcnZlcnMgPSBbXTtcclxuICBcclxuICAgICAgICAgIC8vIFRPRE86IHNob3VsZCByZXVzZSB0aGUgc3RvcmVkIGluZm9ybWF0aW9uXHJcbiAgICAgICAgICBPYmplY3Qua2V5cyhyZXN1bHQpLmZvckVhY2goKG9ialVSTCkgPT4ge1xyXG4gICAgICAgICAgICBsb2cubG9nKCdbU3luY2hlck1hbmFnZXIgLSByZXN1bWUgU3Vic2NyaWJlXSAtIHJldXNlIGN1cnJlbnQgb2JqZWN0IHVybDogJywgcmVzdWx0W29ialVSTF0pO1xyXG4gICAgICAgICAgICBsaXN0T2ZPYnNlcnZlcnMucHVzaCh0aGlzLl9yZXN1bWVTdWJzY3JpcHRpb24obXNnLCByZXN1bHRbb2JqVVJMXSkpO1xyXG4gICAgICAgICAgfSk7XHJcbiAgXHJcbiAgICAgICAgICBQcm9taXNlLmFsbChsaXN0T2ZPYnNlcnZlcnMpLnRoZW4oKHJlc3VtZWRPYnNlcnZlcnMpID0+IHtcclxuICAgICAgICAgICAgbG9nLmxvZygnW1N5bmNoZXJNYW5hZ2VyIC0gT2JzZXJ2ZXJzIFJlc3VtZWRdJywgcmVzdW1lZE9ic2VydmVycyk7XHJcbiAgXHJcbiAgICAgICAgICAgIC8vIFRPRE86IHNob3VkIHNlbmQgdGhlIGluZm9ybWF0aW9uIGlmIHNvbWUgb2JqZWN0IGlzIGZhaWxpbmc7XHJcbiAgICAgICAgICAgIGxldCBzdWNjZXNzZnVsbHlSZXN1bWVkID0gT2JqZWN0LnZhbHVlcyhyZXN1bWVkT2JzZXJ2ZXJzKS5maWx0ZXIoKG9ic2VydmVyKSA9PiB7XHJcbiAgICAgICAgICAgICAgcmV0dXJuIG9ic2VydmVyICE9PSBmYWxzZTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgXHJcbiAgICAgICAgICAgIGxldCByZXNwb25zZSA9IHtcclxuICAgICAgICAgICAgICBpZDogbXNnLmlkLCB0eXBlOiAncmVzcG9uc2UnLCBmcm9tOiBtc2cudG8sIHRvOiBtc2cuZnJvbSxcclxuICAgICAgICAgICAgICBib2R5OiB7IGNvZGU6IDIwMCwgdmFsdWU6IHN1Y2Nlc3NmdWxseVJlc3VtZWQgfVxyXG4gICAgICAgICAgICB9O1xyXG4gIFxyXG4gICAgICAgICAgICBsb2cubG9nKCdbU3luY2hlck1hbmFnZXIgLSBPYnNlcnZlcnMgUmVzdW1lZF0gcmVwbHlpbmcgJywgcmVzcG9uc2UpO1xyXG4gIFxyXG4gICAgICAgICAgICAvL0ZMT1ctT1VUOiBtZXNzYWdlIHJlc3BvbnNlIHRvIFN5bmNoZXIgLT4gY3JlYXRlXHJcbiAgICAgICAgICAgIHRoaXMuX2J1cy5wb3N0TWVzc2FnZShyZXNwb25zZSk7XHJcbiAgXHJcbiAgICAgICAgICB9KTtcclxuICBcclxuICAgICAgIFxyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAvL2ZvcndhcmQgdG8gaHlwZXJ0eTpcclxuICAgICAgICAgIGxldCByZXBseSA9IHt9O1xyXG4gICAgICAgICAgcmVwbHkuaWQgPSBtc2cuaWQ7XHJcbiAgICAgICAgICByZXBseS5mcm9tID0gbXNnLnRvO1xyXG4gICAgICAgICAgcmVwbHkudG8gPSBtc2cuZnJvbTtcclxuICAgICAgICAgIHJlcGx5LnR5cGUgPSAncmVzcG9uc2UnO1xyXG4gICAgICAgICAgcmVwbHkuYm9keSA9IHtcclxuICAgICAgICAgICAgY29kZTogNDA0LFxyXG4gICAgICAgICAgICBkZXNjOiAnTm8gZGF0YSBvYmplY3RzIG9ic2VydmVycyB0byBiZSByZXN1bWVkJ1xyXG4gICAgICAgICAgfTtcclxuICAgICAgICAgIHRoaXMuX2J1cy5wb3N0TWVzc2FnZShyZXBseSk7XHJcbiAgICAgICAgfVxyXG4gIFxyXG4gICAgICB9KTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGxvZy5sb2coJ1tTeW5jaGVyTWFuYWdlci5vbkxvY2FsU3Vic2NyaWJlIC0gbmV3IFN1YnNjcmliZV0gLSAnLCBtc2cuYm9keS5zY2hlbWEsIG1zZy5ib2R5LnJlc291cmNlKTtcclxuICAgICAgdGhpcy5fbmV3U3Vic2NyaXB0aW9uKG1zZyk7XHJcbiAgICB9XHJcbiBcclxuXHJcbiAgfVxyXG5cclxuICBfbmV3U3Vic2NyaXB0aW9uKG1zZykge1xyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuXHJcbiAgICBsZXQgb2JqVVJMID0gbXNnLmJvZHkucmVzb3VyY2U7XHJcblxyXG4gICAgbGV0IGh5cGVydHlVUkwgPSBtc2cuZnJvbTtcclxuICAgIGxldCBkb21haW4gPSBkaXZpZGVVUkwob2JqVVJMKS5kb21haW47XHJcbiAgICBsZXQgZG9tYWluU3Vic2NyaXB0aW9uID0gbXNnLmJvZHkuaGFzT3duUHJvcGVydHkoJ2RvbWFpbl9zdWJzY3JpcHRpb24nKSA/IG1zZy5ib2R5LmRvbWFpbl9zdWJzY3JpcHRpb24gOiB0cnVlO1xyXG5cclxuICAgIGxldCBjaGlsZEJhc2VVUkwgPSBvYmpVUkwgKyAnL2NoaWxkcmVuLyc7XHJcblxyXG4gICAgLy9nZXQgc2NoZW1hIGZyb20gY2F0YWxvZ3VlIGFuZCBwYXJzZSAtPiAoY2hpbGRyZW4pXHJcbiAgICBfdGhpcy5fY2F0YWxvZy5nZXREYXRhU2NoZW1hRGVzY3JpcHRvcihtc2cuYm9keS5zY2hlbWEpLnRoZW4oKGRlc2NyaXB0b3IpID0+IHtcclxuICAgICAgbGV0IHByb3BlcnRpZXMgPSBkZXNjcmlwdG9yLnNvdXJjZVBhY2thZ2Uuc291cmNlQ29kZS5wcm9wZXJ0aWVzO1xyXG4gICAgICBsZXQgY2hpbGRyZW5zID0gcHJvcGVydGllcy5jaGlsZHJlbnMgPyBwcm9wZXJ0aWVzLmNoaWxkcmVucyA6IFtdO1xyXG5cclxuICAgICAgbGV0IHN1YnNjcmlwdGlvbnMgPSBbXTtcclxuICAgICAgc3Vic2NyaXB0aW9ucy5wdXNoKG9ialVSTCArICcvY2hhbmdlcycpO1xyXG5cclxuLy8gICAgICBjaGlsZHJlbnMuZm9yRWFjaCgoY2hpbGQpID0+IHN1YnNjcmlwdGlvbnMucHVzaChjaGlsZEJhc2VVUkwgKyBjaGlsZCkpO1xyXG4gICAgICBzdWJzY3JpcHRpb25zLnB1c2goY2hpbGRCYXNlVVJMKTtcclxuXHJcbiAgICAgIC8vY2hpbGRyZW4gYWRkcmVzc2VzXHJcblxyXG4gICAgICBpZiAoZG9tYWluU3Vic2NyaXB0aW9uKSB7ICAvL0ZMT1ctT1VUOiBzdWJzY3JpYmUgbWVzc2FnZSB0byB0aGUgbXNnLW5vZGUsIHJlZ2lzdGVyaW5nIGxpc3RlbmVycyBvbiB0aGUgYnJva2VyXHJcbiAgICAgIGxldCBub2RlU3Vic2NyaWJlTXNnID0ge1xyXG4gICAgICAgIHR5cGU6ICdzdWJzY3JpYmUnLCBmcm9tOiBfdGhpcy5fdXJsLCB0bzogJ2RvbWFpbjovL21zZy1ub2RlLicgKyBkb21haW4gKyAnL3NtJyxcclxuICAgICAgICBib2R5OiB7IGlkZW50aXR5OiBtc2cuYm9keS5pZGVudGl0eSwgcmVzb3VyY2VzOiBzdWJzY3JpcHRpb25zLCBzb3VyY2U6IGh5cGVydHlVUkwgfVxyXG4gICAgICB9O1xyXG5cclxuICAgICAgLy9zdWJzY3JpYmUgaW4gbXNnLW5vZGVcclxuICAgICAgX3RoaXMuX2J1cy5wb3N0TWVzc2FnZShub2RlU3Vic2NyaWJlTXNnLCAocmVwbHkpID0+IHtcclxuICAgICAgICBsb2cubG9nKCdub2RlLXN1YnNjcmliZS1yZXNwb25zZShvYnNlcnZlcik6ICcsIHJlcGx5KTtcclxuICAgICAgICBjb25zb2xlLmxvZygnUkVVU0VURVNUIFN5bmNoZXJNYW5hZ2VyIC0gbm9kZS1zdWJzY3JpYmUtcmVzcG9uc2Uob2JzZXJ2ZXIpOiAnLCByZXBseSk7XHJcbiAgICAgICAgaWYgKHJlcGx5LmJvZHkuY29kZSA9PT0gMjAwKSB7XHJcbiAgICAgICAgICBfdGhpcy5fbmV3UmVwb3J0ZXJTdWJzY3JpYmUobXNnLCBoeXBlcnR5VVJMLCBvYmpVUkwsIGNoaWxkcmVucyk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIC8vbGlzdGVuZXIgcmVqZWN0ZWRcclxuICAgICAgICAgIF90aGlzLl9idXMucG9zdE1lc3NhZ2Uoe1xyXG4gICAgICAgICAgICBpZDogbXNnLmlkLCB0eXBlOiAncmVzcG9uc2UnLCBmcm9tOiBtc2cudG8sIHRvOiBoeXBlcnR5VVJMLFxyXG4gICAgICAgICAgICBib2R5OiByZXBseS5ib2R5XHJcbiAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG4gICAgfSBlbHNlIF90aGlzLl9uZXdSZXBvcnRlclN1YnNjcmliZShtc2csIGh5cGVydHlVUkwsIG9ialVSTCwgY2hpbGRyZW5zKTtcclxuXHJcblxyXG4gICAgfSk7XHJcblxyXG4gIH1cclxuXHJcbiAgX25ld1JlcG9ydGVyU3Vic2NyaWJlKG1zZywgaHlwZXJ0eVVSTCwgb2JqVVJMLCBjaGlsZHJlbnMpe1xyXG5cclxuICAgIGxldCBfdGhpcyA9IHRoaXM7XHJcblxyXG4gICAgbGV0IG9ialVSTFN1YnNjcmlwdGlvbiA9IG9ialVSTCArICcvc3Vic2NyaXB0aW9uJztcclxuXHJcbiAgICAgICAgICAvL0ZMT1ctT1VUOiByZXBseSB3aXRoIHByb3Zpc2lvbmFsIHJlc3BvbnNlXHJcbiAgICAgICAgICBfdGhpcy5fYnVzLnBvc3RNZXNzYWdlKHtcclxuICAgICAgICAgICAgaWQ6IG1zZy5pZCwgdHlwZTogJ3Jlc3BvbnNlJywgZnJvbTogbXNnLnRvLCB0bzogaHlwZXJ0eVVSTCxcclxuICAgICAgICAgICAgYm9keTogeyBjb2RlOiAxMDAsIGNoaWxkcmVuUmVzb3VyY2VzOiBjaGlsZHJlbnMsIHNjaGVtYTogbXNnLmJvZHkuc2NoZW1hLCByZXNvdXJjZTogbXNnLmJvZHkucmVzb3VyY2UgfVxyXG4gICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgLy9GTE9XLU9VVDogc3Vic2NyaWJlIG1lc3NhZ2UgdG8gcmVtb3RlIFJlcG9ydGVyT2JqZWN0IC0+IF9vblJlbW90ZVN1YnNjcmliZVxyXG4gICAgICAgICAgbGV0IG9ialN1YnNjcmliZU1zZyA9IHtcclxuICAgICAgICAgICAgdHlwZTogJ3N1YnNjcmliZScsIGZyb206IF90aGlzLl91cmwsIHRvOiBvYmpVUkxTdWJzY3JpcHRpb24sXHJcbiAgICAgICAgICAgIGJvZHk6IHsgaWRlbnRpdHk6IG1zZy5ib2R5LmlkZW50aXR5LCBzdWJzY3JpYmVyOiBoeXBlcnR5VVJMIH1cclxuICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgLy9UT0RPOiBGb3IgRnVydGhlciBTdHVkeVxyXG4gICAgICAgICAgaWYgKG1zZy5ib2R5Lmhhc093blByb3BlcnR5KCdtdXR1YWwnKSkgb2JqU3Vic2NyaWJlTXNnLmJvZHkubXV0dWFsID0gbXNnLmJvZHkubXV0dWFsO1xyXG4gICAgICAgICAgbG9nLmxvZygnW1N5bmNoZXJNYW5hZ2VyLl9uZXdTdWJzY3JpcHRpb25dJywgb2JqU3Vic2NyaWJlTXNnLCBtc2cpO1xyXG4gICAgICAgICAgY29uc29sZS5sb2coJ1JFVVNFVEVTVCBTeW5jaGVyTWFuYWdlciAtIFtTeW5jaGVyTWFuYWdlci5fbmV3U3Vic2NyaXB0aW9uXScsIG9ialN1YnNjcmliZU1zZywgbXNnKTtcclxuICAgICAgICAgIC8vc3Vic2NyaWJlIHRvIHJlcG9ydGVyIFNNXHJcbiAgICAgICAgICBfdGhpcy5fYnVzLnBvc3RNZXNzYWdlKG9ialN1YnNjcmliZU1zZywgKHJlcGx5KSA9PiB7XHJcbiAgICAgICAgICAgIGxvZy5sb2coJ3JlcG9ydGVyLXN1YnNjcmliZS1yZXNwb25zZS1uZXc6ICcsIHJlcGx5KTtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coJ1JFVVNFVEVTVCBTeW5jaGVyTWFuYWdlciAtIHJlcG9ydGVyLXN1YnNjcmliZS1yZXNwb25zZS1uZXc6ICcsIHJlcGx5KTtcclxuICAgICAgICAgICAgaWYgKHJlcGx5LmJvZHkuY29kZSA9PT0gMjAwKSBfdGhpcy5fcHJvY2Vzc1N1Y2Nlc3NmdWxsU3Vic2NyaXB0aW9uKHJlcGx5LCBoeXBlcnR5VVJMLCBvYmpVUkwsIGNoaWxkcmVucywgbXNnKTtcclxuICAgICAgICAgICAgZWxzZSBpZiAobXNnLmJvZHkub2ZmbGluZSkgX3RoaXMuX3Byb2Nlc3NPZmZsaW5lU3Vic2NyaXB0aW9uKG9ialN1YnNjcmliZU1zZywgbXNnLmJvZHkub2ZmbGluZSwgaHlwZXJ0eVVSTCwgb2JqVVJMLCBjaGlsZHJlbnMsIG1zZyk7XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgIC8vVE9ETzogc2VuZCByZXNwb25zZSBiYWNrIHRvIEh5cGVydHkgd2l0aCBlcnJvciBtZXNzYWdlIHJlY2VpdmVkIGluIHRoZSByZXBseVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9KTtcclxuICB9XHJcblxyXG4gIF9wcm9jZXNzT2ZmbGluZVN1YnNjcmlwdGlvbihzdWJzY3JpcHRpb24sIHJlZGlyZWN0VG8sIGh5cGVydHlVUkwsIG9ialVSTCwgY2hpbGRyZW5zLCBtc2cpIHtcclxuICAgIGxldCBfdGhpcyA9IHRoaXM7XHJcblxyXG4gICAgbGV0IGZvcndhcmQgPSB7XHJcbiAgICAgIGZyb206IHN1YnNjcmlwdGlvbi5mcm9tLFxyXG4gICAgICB0eXBlOiAnZm9yd2FyZCcsXHJcbiAgICAgIHRvOiByZWRpcmVjdFRvLFxyXG4gICAgICBib2R5OiBzdWJzY3JpcHRpb25cclxuICAgIH07XHJcblxyXG4gICAgY29uc29sZS5sb2coJ1tTeW5jaGVyTWFuYWdlci5fcHJvY2Vzc09mZmxpbmVTdWJzY3JpcHRpb25dIGZvcndhZGluZyAnLCBmb3J3YXJkKTtcclxuXHJcbiAgICBfdGhpcy5fYnVzLnBvc3RNZXNzYWdlKGZvcndhcmQsIChyZXBseSkgPT4ge1xyXG4gICAgICBsb2cubG9nKCdbU3luY2hlck1hbmFnZXIuX3Byb2Nlc3NPZmZsaW5lU3Vic2NyaXB0aW9uXSByZXBseSAnLCByZXBseSk7XHJcbiAgICAgIGlmIChyZXBseS5ib2R5LmNvZGUgPT09IDIwMCkgX3RoaXMuX3Byb2Nlc3NTdWNjZXNzZnVsbFN1YnNjcmlwdGlvbihyZXBseSwgaHlwZXJ0eVVSTCwgb2JqVVJMLCBjaGlsZHJlbnMsIG1zZyk7XHJcbiAgICAgIGVsc2Uge1xyXG4gICAgICAgIC8vVE9ETzogc2VuZCByZXNwb25zZSBiYWNrIHRvIEh5cGVydHkgd2l0aCBlcnJvciBtZXNzYWdlIHJlY2VpdmVkIGluIHRoZSByZXBseVxyXG4gICAgICB9XHJcbiAgICB9KTtcclxuXHJcblxyXG4gIH1cclxuXHJcbiAgX3Byb2Nlc3NTdWNjZXNzZnVsbFN1YnNjcmlwdGlvbihyZXBseSwgaHlwZXJ0eVVSTCwgb2JqVVJMLCBjaGlsZHJlbnMsIG1zZykge1xyXG5cclxuICAgIGxldCBfdGhpcyA9IHRoaXM7XHJcblxyXG4gICAgbG9nLmxvZygnW1N5bmNoZXJNYW5hZ2VyLl9uZXdTdWJzY3JpcHRpb25dIC0gb2JzZXJ2ZXJzOiAnLCBfdGhpcy5fb2JzZXJ2ZXJzLCBvYmpVUkwsIF90aGlzLl9vYnNlcnZlcnNbb2JqVVJMXSk7XHJcbiAgICBjb25zb2xlLmxvZygnUkVVU0VURVNUIFN5bmNoZXJNYW5hZ2VyIC0gMjAwIGNvZGVbU3luY2hlck1hbmFnZXIuX25ld1N1YnNjcmlwdGlvbl0gLSBvYnNlcnZlcnM6ICcsIF90aGlzLl9vYnNlcnZlcnMsIG9ialVSTCwgX3RoaXMuX29ic2VydmVyc1tvYmpVUkxdKTtcclxuICAgIGxldCBvYnNlcnZlciA9IF90aGlzLl9vYnNlcnZlcnNbb2JqVVJMXTtcclxuICAgIGlmICghb2JzZXJ2ZXIpIHtcclxuICAgICAgb2JzZXJ2ZXIgPSBuZXcgT2JzZXJ2ZXJPYmplY3QoX3RoaXMsIG9ialVSTCwgY2hpbGRyZW5zKTtcclxuICAgICAgbG9nLmxvZygnW1N5bmNoZXJNYW5hZ2VyLl9uZXdTdWJzY3JpcHRpb25dIC0gb2JzZXJ2ZXJzOiBjcmVhdGUgbmV3IE9ic2VydmVyT2JqZWN0OiAnLCBvYnNlcnZlcik7XHJcbiAgICAgIF90aGlzLl9vYnNlcnZlcnNbb2JqVVJMXSA9IG9ic2VydmVyO1xyXG5cclxuICAgICAgLy8gcmVnaXN0ZXIgbmV3IGh5cGVydHkgc3Vic2NyaXB0aW9uXHJcbiAgICAgIG9ic2VydmVyLmFkZFN1YnNjcmlwdGlvbihoeXBlcnR5VVJMKTtcclxuXHJcbiAgICAgIC8vIGFkZCBjaGlsZHJlbnMgYW5kIGxpc3RlbmVycyB0byBzYXZlIGRhdGEgaWYgbmVjZXNzYXJ5XHJcbiAgICAgIG9ic2VydmVyLmFkZENoaWxkcmVucygpO1xyXG4gICAgfVxyXG5cclxuICAgIGxldCBpbnRlcndvcmtpbmcgPSBmYWxzZTtcclxuXHJcbiAgICAvL2RlYnVnZ2VyO1xyXG5cclxuICAgIC8vIFN0b3JlIGZvciBlYWNoIHJlcG9ydGVyIGh5cGVydHkgdGhlIGRhdGFPYmplY3RcclxuICAgIGxldCB1c2VyVVJMO1xyXG4gICAgaWYgKG1zZy5ib2R5Lmhhc093blByb3BlcnR5KCdpZGVudGl0eScpICYmIG1zZy5ib2R5LmlkZW50aXR5LnVzZXJQcm9maWxlICYmIG1zZy5ib2R5LmlkZW50aXR5LnVzZXJQcm9maWxlLnVzZXJVUkwpIHtcclxuICAgICAgdXNlclVSTCA9IG1zZy5ib2R5LmlkZW50aXR5LnVzZXJQcm9maWxlLnVzZXJVUkw7XHJcbiAgICAgIGlmICghdXNlclVSTC5pbmNsdWRlcygndXNlcjovLycpKSB7XHJcbiAgICAgICAgaW50ZXJ3b3JraW5nID0gdHJ1ZTtcclxuICAgICAgfVxyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdXNlclVSTCA9IF90aGlzLl9yZWdpc3RyeS5nZXRIeXBlcnR5T3duZXIobXNnLmZyb20pO1xyXG4gICAgICBpZiAoIXVzZXJVUkwpIGludGVyd29ya2luZyA9IHRydWU7XHJcbiAgICB9XHJcblxyXG4gICAgbGV0IG1ldGFkYXRhID0gZGVlcENsb25lKHJlcGx5LmJvZHkudmFsdWUpO1xyXG5cclxuICAgIC8vIGxldCBjaGlsZHJlbk9iamVjdHMgPSBtZXRhZGF0YS5jaGlsZHJlbk9iamVjdHMgfHwge307XHJcblxyXG4gICAgZGVsZXRlIG1ldGFkYXRhLmRhdGE7XHJcbiAgICBkZWxldGUgbWV0YWRhdGEuY2hpbGRyZW5PYmplY3RzO1xyXG5cclxuICAgIG1ldGFkYXRhLmNoaWxkcmVucyA9IGNoaWxkcmVucztcclxuICAgIG1ldGFkYXRhLnN1YnNjcmliZXJVc2VyID0gdXNlclVSTDtcclxuICAgIG1ldGFkYXRhLmlzUmVwb3J0ZXIgPSBmYWxzZTtcclxuICAgIG1ldGFkYXRhLnN1YnNjcmliZXJIeXBlcnR5ID0gaHlwZXJ0eVVSTDtcclxuXHJcbiAgICBpZiAoIWludGVyd29ya2luZykge1xyXG4gICAgICAvL190aGlzLl9kYXRhT2JqZWN0c1N0b3JhZ2Uuc2V0KG9ialVSTCwgZmFsc2UsIG1zZy5ib2R5LnNjaGVtYSwgJ29uJywgcmVwbHkuYm9keS5vd25lciwgaHlwZXJ0eVVSTCwgY2hpbGRyZW5zLCB1c2VyVVJMKTtcclxuICAgICAgX3RoaXMuX2RhdGFPYmplY3RzU3RvcmFnZS5zZXQobWV0YWRhdGEpO1xyXG4gICAgICBpZiAoKG1ldGFkYXRhLmhhc093blByb3BlcnR5KCdzdG9yZScpICYmIG1ldGFkYXRhLnN0b3JlKSB8fCAobWV0YWRhdGEuaGFzT3duUHJvcGVydHkoJ2lzVG9TYXZlRGF0YScpICYmIG1ldGFkYXRhLmlzVG9TYXZlRGF0YSkpIHtcclxuICAgICAgICBvYnNlcnZlci5pc1RvU2F2ZURhdGEgPSB0cnVlO1xyXG4gICAgICAgIF90aGlzLl9kYXRhT2JqZWN0c1N0b3JhZ2UudXBkYXRlKGZhbHNlLCBvYmpVUkwsICdpc1RvU2F2ZURhdGEnLCB0cnVlKTtcclxuICAgICAgICBfdGhpcy5fZGF0YU9iamVjdHNTdG9yYWdlLnNhdmVEYXRhKGZhbHNlLCBvYmpVUkwsIG51bGwsIHJlcGx5LmJvZHkudmFsdWUuZGF0YSk7XHJcbi8vICAgICAgICAgICAgICAgICAgaWYgKGNoaWxkcmVucykgX3RoaXMuX2RhdGFPYmplY3RzU3RvcmFnZS5pbml0aWFsT2JzZXJ2ZXJTeW5jKG9ialVSTCwgcmVwbHkuYm9keS52YWx1ZS5kYXRhLmJhY2t1cFJldmlzaW9uKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8vZm9yd2FyZCB0byBoeXBlcnR5OlxyXG4gICAgcmVwbHkuaWQgPSBtc2cuaWQ7XHJcbiAgICByZXBseS5mcm9tID0gX3RoaXMuX3VybDtcclxuICAgIHJlcGx5LnRvID0gaHlwZXJ0eVVSTDtcclxuICAgIHJlcGx5LmJvZHkuc2NoZW1hID0gbXNnLmJvZHkuc2NoZW1hO1xyXG4gICAgcmVwbHkuYm9keS5yZXNvdXJjZSA9IG1zZy5ib2R5LnJlc291cmNlO1xyXG5cclxuICAgIC8vVE9ETzogRm9yIEZ1cnRoZXIgU3R1ZHlcclxuICAgIGlmIChtc2cuYm9keS5oYXNPd25Qcm9wZXJ0eSgnbXV0dWFsJykpIHJlcGx5LmJvZHkubXV0dWFsID0gbXNnLmJvZHkubXV0dWFsO1xyXG4gICAgbG9nLmxvZygnW3N1YnNjcmliZV0gLSBuZXcgc3Vic2NyaXB0aW9uOiAnLCBtc2csIHJlcGx5LCBvYnNlcnZlcik7XHJcblxyXG4gICAgdGhpcy5fYnVzLnBvc3RNZXNzYWdlKHJlcGx5KTtcclxuXHJcbiAgfVxyXG5cclxuICBfcmVzdW1lU3Vic2NyaXB0aW9uKG1zZywgc3RvcmVkT2JqZWN0KSB7XHJcblxyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7XHJcblxyXG4gICAgICBsZXQgb2JqVVJMID0gc3RvcmVkT2JqZWN0LnVybDtcclxuICAgICAgbGV0IHNjaGVtYSA9IHN0b3JlZE9iamVjdC5zY2hlbWE7XHJcblxyXG4gICAgICBsZXQgaHlwZXJ0eVVSTCA9IG1zZy5mcm9tO1xyXG5cclxuICAgICAgLy8gbGV0IG9ialVSTFN1YnNjcmlwdGlvbiA9IG9ialVSTCArICcvc3Vic2NyaXB0aW9uJztcclxuXHJcbiAgICAgIGxldCBjaGlsZEJhc2VVUkwgPSBvYmpVUkwgKyAnL2NoaWxkcmVuLyc7XHJcblxyXG4gICAgICBsb2cubG9nKCdbU3luY2hlck1hbmFnZXIgLSBSZXVzZVN1YnNjcmlwdGlvbl0gLSBvYmpVUkw6ICcsIG9ialVSTCwgJyAtIHNjaGVtYTonLCBzY2hlbWEpO1xyXG5cclxuICAgICAgLy9nZXQgc2NoZW1hIGZyb20gY2F0YWxvZ3VlIGFuZCBwYXJzZSAtPiAoY2hpbGRyZW4pXHJcbiAgICAgIC8vIFRPRE86IHJlbW92ZSB0aGlzIHNpbmNlIGNoaWxkcmVuIHJlc291cmNlcyBzaG91bGQgYmUgYXZhaWxhYmxlIGluIHRoZSBEYXRhT2JqZWN0c1N0b3JhZ2VcclxuICAgICAgdGhpcy5fY2F0YWxvZy5nZXREYXRhU2NoZW1hRGVzY3JpcHRvcihzY2hlbWEpLnRoZW4oKGRlc2NyaXB0b3IpID0+IHtcclxuICAgICAgICBsZXQgcHJvcGVydGllcyA9IGRlc2NyaXB0b3Iuc291cmNlUGFja2FnZS5zb3VyY2VDb2RlLnByb3BlcnRpZXM7XHJcbiAgICAgICAgbGV0IGNoaWxkcmVucyA9IHByb3BlcnRpZXMuY2hpbGRyZW5zID8gcHJvcGVydGllcy5jaGlsZHJlbnMgOiBbXTtcclxuXHJcbiAgICAgICAgLy9jaGlsZHJlbiBhZGRyZXNzZXNcclxuICAgICAgICBsZXQgc3Vic2NyaXB0aW9ucyA9IFtdO1xyXG4gICAgICAgIHN1YnNjcmlwdGlvbnMucHVzaChvYmpVUkwgKyAnL2NoYW5nZXMnKTtcclxuLy8gICAgICAgIGNoaWxkcmVucy5mb3JFYWNoKChjaGlsZCkgPT4gc3Vic2NyaXB0aW9ucy5wdXNoKGNoaWxkQmFzZVVSTCArIGNoaWxkKSk7XHJcbiAgICAgICAgc3Vic2NyaXB0aW9ucy5wdXNoKGNoaWxkQmFzZVVSTCk7XHJcblxyXG4gICAgICAgIC8vRkxPVy1PVVQ6IHJlcGx5IHdpdGggcHJvdmlzaW9uYWwgcmVzcG9uc2VcclxuICAgICAgICB0aGlzLl9idXMucG9zdE1lc3NhZ2Uoe1xyXG4gICAgICAgICAgaWQ6IG1zZy5pZCwgdHlwZTogJ3Jlc3BvbnNlJywgZnJvbTogbXNnLnRvLCB0bzogaHlwZXJ0eVVSTCxcclxuICAgICAgICAgIGJvZHk6IHsgY29kZTogMTAwLCBjaGlsZHJlblJlc291cmNlczogY2hpbGRyZW5zLCBzY2hlbWE6IHNjaGVtYSwgcmVzb3VyY2U6IG9ialVSTCB9XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIC8vRkxPVy1PVVQ6IHN1YnNjcmliZSBtZXNzYWdlIHRvIHJlbW90ZSBSZXBvcnRlck9iamVjdCAtPiBfb25SZW1vdGVTdWJzY3JpYmVcclxuICAgICAgICAvKmxldCBvYmpTdWJzY3JpYmVNc2cgPSB7XHJcbiAgICAgICAgICB0eXBlOiAnc3Vic2NyaWJlJywgZnJvbTogdGhpcy5fdXJsLCB0bzogb2JqVVJMU3Vic2NyaXB0aW9uLFxyXG4gICAgICAgICAgYm9keTogeyBzdWJzY3JpYmVyOiBoeXBlcnR5VVJMLCBpZGVudGl0eTogbXNnLmJvZHkuaWRlbnRpdHkgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIC8vc3Vic2NyaWJlIHRvIHJlcG9ydGVyIFNNXHJcbiAgICAgICAgdGhpcy5fYnVzLnBvc3RNZXNzYWdlKG9ialN1YnNjcmliZU1zZywgKHJlcGx5KSA9PiB7Ki9cclxuXHJcbiAgICAgICAgbGV0IG9ic2VydmVyID0gdGhpcy5fb2JzZXJ2ZXJzW29ialVSTF07XHJcbiAgICAgICAgaWYgKCFvYnNlcnZlcikge1xyXG4gICAgICAgICAgb2JzZXJ2ZXIgPSBuZXcgT2JzZXJ2ZXJPYmplY3QodGhpcywgb2JqVVJMLCBjaGlsZHJlbnMpO1xyXG4gICAgICAgICAgb2JzZXJ2ZXIuaXNUb1NhdmVEYXRhID0gc3RvcmVkT2JqZWN0LmlzVG9TYXZlRGF0YTtcclxuICAgICAgICAgIHRoaXMuX29ic2VydmVyc1tvYmpVUkxdID0gb2JzZXJ2ZXI7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvL3JlZ2lzdGVyIG5ldyBoeXBlcnR5IHN1YnNjcmlwdGlvblxyXG4gICAgICAgIG9ic2VydmVyLmFkZFN1YnNjcmlwdGlvbihoeXBlcnR5VVJMKTtcclxuICAgICAgICBvYnNlcnZlci5hZGRDaGlsZHJlbnMoKTtcclxuXHJcbiAgICAgICAgLy8gT2JqZWN0LmFzc2lnbihzdG9yZWRPYmplY3QuZGF0YSwgcmVwbHkuYm9keS52YWx1ZS5kYXRhKTtcclxuICAgICAgICAvLyBPYmplY3QuYXNzaWduKHN0b3JlZE9iamVjdC5jaGlsZHJlbnMsIHJlcGx5LmJvZHkudmFsdWUuY2hpbGRyZW5zKTtcclxuXHJcbiAgICAgICAgLy9sb2cubG9nKCdbc3Vic2NyaWJlXSAtIHJlc3VtZSBzdWJzY3JpcHRpb246ICcsIG1zZywgcmVwbHksIHN0b3JlZE9iamVjdCwgb2JzZXJ2ZXIpO1xyXG5cclxuICAgICAgICByZXR1cm4gdGhpcy5fZGVjcnlwdENoaWxkcmVucyhzdG9yZWRPYmplY3QsIGNoaWxkcmVucyk7XHJcbiAgICAgIH0pLnRoZW4oKGRlY3J5cHRlZE9iamVjdCkgPT4ge1xyXG4gICAgICAgIC8vIGxvZy5sb2coJ3Jlc3VsdCBvZiBwcmV2aW91cyBwcm9taXNlJyk7XHJcbiAgICAgICAgcmVzb2x2ZShkZWNyeXB0ZWRPYmplY3QpO1xyXG4gICAgICB9KS5jYXRjaCgocmVhc29uKSA9PiB7XHJcbiAgICAgICAgbG9nLmVycm9yKCdbU3luY2hlck1hbmFnZXIgLSByZXN1bWUgc3Vic2NyaXB0aW9uXSAtIGZhaWwgb24gZ2V0RGF0YVNjaGVtYURlc2NyaXB0b3I6ICcsIHJlYXNvbik7XHJcbiAgICAgICAgcmVzb2x2ZShmYWxzZSk7XHJcbiAgICAgIH0pO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvL0ZMT1ctSU46IG1lc3NhZ2UgcmVjZWl2ZWQgZnJvbSBsb2NhbCBEYXRhT2JqZWN0T2JzZXJ2ZXIgLT4gdW5zdWJzY3JpYmVcclxuICBfb25Mb2NhbFVuU3Vic2NyaWJlKG1zZykge1xyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuXHJcbiAgICBsZXQgaHlwZXJ0eVVSTCA9IG1zZy5mcm9tO1xyXG4gICAgbGV0IG9ialVSTCA9IG1zZy5ib2R5LnJlc291cmNlO1xyXG5cclxuICAgIGxldCBvYnNlcnZlciA9IF90aGlzLl9vYnNlcnZlcnNbb2JqVVJMXTtcclxuICAgIGlmIChvYnNlcnZlcikge1xyXG4gICAgICAvL1RPRE86IGlzIHRoZXJlIGFueSBwb2xpY3kgdmVyaWZpY2F0aW9uIGJlZm9yZSBkZWxldGU/XHJcbiAgICAgIG9ic2VydmVyLnJlbW92ZVN1YnNjcmlwdGlvbihtc2cpO1xyXG5cclxuICAgICAgLy9UT0RPOiBkZXN0cm95IG9iamVjdCBpbiB0aGUgcmVnaXN0cnk/XHJcbiAgICAgIF90aGlzLl9idXMucG9zdE1lc3NhZ2Uoe1xyXG4gICAgICAgIGlkOiBtc2cuaWQsIHR5cGU6ICdyZXNwb25zZScsIGZyb206IG1zZy50bywgdG86IG1zZy5mcm9tLFxyXG4gICAgICAgIGJvZHk6IHsgY29kZTogMjAwIH1cclxuICAgICAgfSk7XHJcblxyXG4gICAgICB0aGlzLl9kYXRhT2JqZWN0c1N0b3JhZ2UuZGVsZXRlUmVzb3VyY2Uob2JqVVJMKTtcclxuXHJcbiAgICAgIC8vVE9ETzogcmVtb3ZlIE9iamVjdCBpZiBubyBtb3JlIHN1YnNjcmlwdGlvbj9cclxuICAgICAgZGVsZXRlIF90aGlzLl9vYnNlcnZlcnNbb2JqVVJMXTtcclxuICAgIH1cclxuICB9XHJcblxyXG59XHJcblxyXG5leHBvcnQgZGVmYXVsdCBTeW5jaGVyTWFuYWdlcjtcclxuIiwiLy8gTG9nIFN5c3RlbVxyXG5pbXBvcnQgKiBhcyBsb2dnZXIgZnJvbSAnbG9nbGV2ZWwnO1xyXG5sZXQgbG9nID0gbG9nZ2VyLmdldExvZ2dlcignU3Vic2NyaXB0aW9uJyk7XHJcblxyXG5jbGFzcyBTdWJzY3JpcHRpb24ge1xyXG5cclxuICBjb25zdHJ1Y3RvcihidXMsIHN1YnNjcmliZXIsIHJlc291cmNlKSB7XHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG4gICAgX3RoaXMuX3N1YnNjcmliZXIgPSBzdWJzY3JpYmVyO1xyXG4gICAgX3RoaXMucmVzb3VyY2UgPSByZXNvdXJjZTtcclxuXHJcbiAgICBsb2cubG9nKCdbU3Vic2NyaXB0aW9uTWFuYWdlci5TdWJzY3JpcHRpb25dIG5ldzogJywgc3Vic2NyaWJlciwgcmVzb3VyY2UpXHJcblxyXG4gICAgLy9hZGQgZm9yd2FyZFxyXG4gICAgX3RoaXMuX2xpc3RlbmVyID0gYnVzLmFkZEZvcndhcmQocmVzb3VyY2UsIHN1YnNjcmliZXIpO1xyXG5cclxuICB9XHJcblxyXG4gIF9yZWxlYXNlTGlzdGVuZXJzKCkge1xyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuXHJcbiAgICBfdGhpcy5fbGlzdGVuZXIucmVtb3ZlKCk7XHJcblxyXG4gIH1cclxuXHJcbn1cclxuXHJcbmV4cG9ydCBkZWZhdWx0IFN1YnNjcmlwdGlvbjtcclxuIiwiLyoqXHJcbiogQ29weXJpZ2h0IDIwMTYgUFQgSW5vdmHDp8OjbyBlIFNpc3RlbWFzIFNBXHJcbiogQ29weXJpZ2h0IDIwMTYgSU5FU0MtSURcclxuKiBDb3B5cmlnaHQgMjAxNiBRVU9CSVMgTkVUV09SS1MgU0xcclxuKiBDb3B5cmlnaHQgMjAxNiBGUkFVTkhPRkVSLUdFU0VMTFNDSEFGVCBaVVIgRk9FUkRFUlVORyBERVIgQU5HRVdBTkRURU4gRk9SU0NIVU5HIEUuVlxyXG4qIENvcHlyaWdodCAyMDE2IE9SQU5HRSBTQVxyXG4qIENvcHlyaWdodCAyMDE2IERldXRzY2hlIFRlbGVrb20gQUdcclxuKiBDb3B5cmlnaHQgMjAxNiBBcGl6ZWVcclxuKiBDb3B5cmlnaHQgMjAxNiBURUNITklTQ0hFIFVOSVZFUlNJVEFUIEJFUkxJTlxyXG4qXHJcbiogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbipcclxuKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4qXHJcbiogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4qIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbioqL1xyXG5cclxuLy8gTG9nIFN5c3RlbVxyXG5pbXBvcnQgKiBhcyBsb2dnZXIgZnJvbSAnbG9nbGV2ZWwnO1xyXG5sZXQgbG9nID0gbG9nZ2VyLmdldExvZ2dlcignU3Vic2NyaXB0aW9uTWFuYWdlcicpO1xyXG5cclxuaW1wb3J0IHsgZGl2aWRlVVJMIH0gZnJvbSAnLi4vdXRpbHMvdXRpbHMnO1xyXG5pbXBvcnQgU3Vic2NyaXB0aW9uIGZyb20gJy4vU3Vic2NyaXB0aW9uJztcclxuXHJcblxyXG4vKipcclxuICogQGF1dGhvciBwYXVsby1nLWNoYWluaG9AYWx0aWNlbGFicy5jb21cclxuICogU3Vic2NyaXB0aW9uIE1hbmFnZXIgdXNlZCB0byBtYW5hZ2Ugcm91dGluZyBwYXRocyBhdCB0aGUgcnVudGltZS5cclxuICovXHJcblxyXG5jbGFzcyBTdWJzY3JpcHRpb25NYW5hZ2VyIHtcclxuXHJcbiAgY29uc3RydWN0b3IocnVudGltZVVSTCwgYnVzLCBzdG9yYWdlKSB7XHJcbiAgICBpZiAoIXJ1bnRpbWVVUkwpIHRocm93IG5ldyBFcnJvcignW1N1YnNjcmlwdGlvbk1hbmFnZXJdIC0gbmVlZHMgdGhlIHJ1bnRpbWVVUkwgcGFyYW1ldGVyJyk7XHJcbiAgICBpZiAoIWJ1cykgdGhyb3cgbmV3IEVycm9yKCdbU3Vic2NyaXB0aW9uTWFuYWdlcl0gLSBuZWVkcyB0aGUgTWVzc2FnZUJ1cyBpbnN0YW5jZScpO1xyXG5cclxuICAgIGxldCBfdGhpcyA9IHRoaXM7XHJcblxyXG4gICAgX3RoaXMuX2J1cyA9IGJ1cztcclxuICAgIF90aGlzLl9zdG9yYWdlID0gc3RvcmFnZTtcclxuXHJcbiAgICBfdGhpcy5fc3Vic2NyaXB0aW9ucyA9IHt9O1xyXG5cclxuICAgIF90aGlzLl9zdWJzY3JpcHRpb25zU3RvcmFnZSA9IHt9O1xyXG5cclxuICAgIC8vVE9ETzogdGhlc2Ugc2hvdWxkIGJlIHNhdmVkIGluIHBlcnNpc3RlbmNlIGVuZ2luZT9cclxuICAgIF90aGlzLnJ1bnRpbWVVUkwgPSBydW50aW1lVVJMO1xyXG4gICAgX3RoaXMuX3VybCA9IHJ1bnRpbWVVUkwgKyAnL3N1YnNjcmlwdGlvbnMnO1xyXG5cclxuICAgIC8vVE9ETzogdGhpcyBzaG91bGQgbm90IGJlIGhhcmRjb2RlZCFcclxuICAgIF90aGlzLl9kb21haW4gPSBkaXZpZGVVUkwocnVudGltZVVSTCkuZG9tYWluO1xyXG5cclxuICAgIGJ1cy5hZGRMaXN0ZW5lcihfdGhpcy5fdXJsLCAobXNnKSA9PiB7XHJcbiAgICAgIGxvZy5pbmZvKCdbU3Vic2NyaXB0aW9uTWFuYWdlcl0gUkNWOiAnLCBtc2cpO1xyXG4gICAgICBzd2l0Y2ggKG1zZy50eXBlKSB7XHJcbiAgICAgICAgY2FzZSAnc3Vic2NyaWJlJzogX3RoaXMuX29uU3Vic2NyaWJlKG1zZyk7IGJyZWFrO1xyXG4gICAgICAgIGNhc2UgJ3Vuc3Vic2NyaWJlJzogX3RoaXMuX29uVW5TdWJzY3JpYmUobXNnKTsgYnJlYWs7XHJcbiAgICAgICAgY2FzZSAncmVhZCc6IF90aGlzLl9vblJlYWQobXNnKTsgYnJlYWs7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG5cclxuICB9XHJcblxyXG4gIGluaXQoKSB7XHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG5cclxuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4ge1xyXG5cclxuICAgICAgX3RoaXMuX3N0b3JhZ2UuZ2V0KCdzdWJzY3JpcHRpb25zJykudGhlbigoc3Vic2NyaXB0aW9ucykgPT4ge1xyXG4gICAgICAgIGxvZy5sb2coJ1tTdWJzY3JpcHRpb25NYW5hZ2VyLmluaXRdIHJlc3VtZSBzdWJzY3JpcHRpb25zOiAnLCBzdWJzY3JpcHRpb25zKTtcclxuICAgICAgICBpZiAoc3Vic2NyaXB0aW9ucykge1xyXG5cclxuICAgICAgICAgIF90aGlzLl9zdWJzY3JpcHRpb25zU3RvcmFnZSA9IHN1YnNjcmlwdGlvbnM7XHJcblxyXG4gICAgICAgICAgT2JqZWN0LnZhbHVlcyhzdWJzY3JpcHRpb25zKS5mb3JFYWNoKChzdWJzY3JpcHRpb24pPT57XHJcbiAgICAgICAgICAgIF90aGlzLmNyZWF0ZVN1YnNjcmlwdGlvbihzdWJzY3JpcHRpb24uZG9tYWluLCBzdWJzY3JpcHRpb24ucmVzb3VyY2VzLCBzdWJzY3JpcHRpb24uc3Vic2NyaWJlciwgc3Vic2NyaXB0aW9uLmlkZW50aXR5KTtcclxuXHJcbiAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJlc29sdmUoKTtcclxuICAgICAgfSk7XHJcblxyXG4gICAgfSk7XHJcblxyXG5cclxuICB9XHJcblxyXG4gIGdldCB1cmwoKSB7IHJldHVybiB0aGlzLl91cmw7IH1cclxuXHJcblxyXG4gIC8vbWVzc2FnZSByZWNlaXZlZCB0byBzZXQgYSByb3V0aW5nIHBhdGhcclxuICBfb25TdWJzY3JpYmUobXNnKSB7XHJcblxyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuXHJcbiAgICBsZXQgcmVzb3VyY2VzID0gbXNnLmJvZHkucmVzb3VyY2VzO1xyXG5cclxuICAgIGxldCBzdWJzY3JpYmVyID0gbXNnLmZyb207XHJcbiAgICBsZXQgZG9tYWluID0gZGl2aWRlVVJMKHJlc291cmNlc1swXSkuZG9tYWluOyAvL3dlIGFyZSBhc3N1bWluZyByZXNvdXJjZXMgYXJlIGFsbCBmcm9tIHRoZSBzYW1lIGRvbWFpblxyXG5cclxuICAgIGxldCBpZGVudGl0eSA9IG1zZy5ib2R5LmlkZW50aXR5O1xyXG5cclxuICAgIF90aGlzLmNyZWF0ZVN1YnNjcmlwdGlvbihkb21haW4sIHJlc291cmNlcywgc3Vic2NyaWJlciwgaWRlbnRpdHkpLnRoZW4oKHJlcGx5KT0+e1xyXG4gICAgICAvL2ZvcndhcmQgdG8gaHlwZXJ0eTpcclxuICAgICAgcmVwbHkuaWQgPSBtc2cuaWQ7XHJcbiAgICAgIHJlcGx5LmZyb20gPSBfdGhpcy5fdXJsO1xyXG4gICAgICByZXBseS50byA9IHN1YnNjcmliZXI7XHJcbiAgICAgIHJlcGx5LmJvZHkgPSBtc2cuYm9keTtcclxuICAgICAgcmVwbHkuYm9keS5jb2RlID0gMjAwO1xyXG5cclxuICAgICAgbG9nLmxvZygnW1N1YnNjcmlwdGlvbk1hbmFnZXJdIC0gY3JhZXRlU3Vic2NyaXB0aW9uOiAnLCBtc2csIHJlcGx5LCBzdWJzY3JpYmVyKTtcclxuXHJcbiAgICAgIF90aGlzLl9idXMucG9zdE1lc3NhZ2UocmVwbHkpO1xyXG5cclxuXHJcbiAgICAgIGlmICghX3RoaXMuX3N1YnNjcmlwdGlvbnNTdG9yYWdlW3N1YnNjcmliZXJdKSB7XHJcblxyXG5cclxuICAgICAgICBfdGhpcy5fc3Vic2NyaXB0aW9uc1N0b3JhZ2Vbc3Vic2NyaWJlcl0gPSB7XHJcbiAgICAgICAgICBkb21haW46IGRvbWFpbixcclxuICAgICAgICAgIHJlc291cmNlczogcmVzb3VyY2VzLFxyXG4gICAgICAgICAgc3Vic2NyaWJlcjogc3Vic2NyaWJlcixcclxuICAgICAgICAgIGlkZW50aXR5OiBpZGVudGl0eVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHJlc291cmNlcy5mb3JFYWNoKChyZXNvdXJjZSkgPT4ge1xyXG4gICAgICAgICAgaWYgKCEoX3RoaXMuX3N1YnNjcmlwdGlvbnNTdG9yYWdlW3N1YnNjcmliZXJdLnJlc291cmNlcy5pbmNsdWRlcyhyZXNvdXJjZSkpKSB7XHJcbiAgICAgICAgICAgIF90aGlzLl9zdWJzY3JpcHRpb25zU3RvcmFnZVtzdWJzY3JpYmVyXS5yZXNvdXJjZXMucHVzaChyZXNvdXJjZSk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIF90aGlzLl9zdG9yYWdlLnNldCgnc3Vic2NyaXB0aW9ucycsIDEsIF90aGlzLl9zdWJzY3JpcHRpb25zU3RvcmFnZSk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIGNyZWF0ZVN1YnNjcmlwdGlvbihkb21haW4sIHJlc291cmNlcywgc3Vic2NyaWJlciwgaWRlbnRpdHkpIHtcclxuXHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG4gICAgLy9kZWJ1Z2dlcjtcclxuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4ge1xyXG4gICAgICAvL0ZMT1ctT1VUOiBzdWJzY3JpYmUgbWVzc2FnZSB0byB0aGUgbXNnLW5vZGUsIHJlZ2lzdGVyaW5nIGxpc3RlbmVycyBvbiB0aGUgYnJva2VyXHJcblxyXG4gICAgICBsZXQgbm9kZVN1YnNjcmliZU1zZyA9IHtcclxuICAgICAgICB0eXBlOiAnc3Vic2NyaWJlJywgZnJvbTogX3RoaXMuX3VybCwgdG86ICdkb21haW46Ly9tc2ctbm9kZS4nICsgZG9tYWluICsgJy9zbScsXHJcbiAgICAgICAgYm9keTogeyBpZGVudGl0eTogaWRlbnRpdHksIHJlc291cmNlczogcmVzb3VyY2VzLCBzb3VyY2U6IHN1YnNjcmliZXIgfVxyXG4gICAgICB9O1xyXG5cclxuICAgICAgLy9zdWJzY3JpYmUgaW4gbXNnLW5vZGVcclxuICAgICAgX3RoaXMuX2J1cy5wb3N0TWVzc2FnZShub2RlU3Vic2NyaWJlTXNnLCAocmVwbHkpID0+IHtcclxuICAgICAgICBsb2cubG9nKCdbU3Vic2NyaXB0aW9uTWFuYWdlcl0gbm9kZS1zdWJzY3JpYmUtcmVzcG9uc2U6ICcsIHJlcGx5KTtcclxuXHJcbiAgICAgICAgLy9pZiAocmVwbHkuYm9keS5jb2RlID09PSAyMDApIHsvL1RPRE86IHVuY29tbWVudCB3aGVuICBNTiByZXBsaWVzIHdpdGggY29ycmVjdCByZXNwb25zZSBib2R5IGNvZGVcclxuXHJcbiAgICAgICAgLy9UT0RPOiBzdXBwb3J0IG11bHRpcGxlIHJvdXRlcyBmb3IgbXVsdGlwbGUgcmVzb3VyY2VzXHJcblxyXG4gICAgICAgIGxldCBzdWJzY3JpcHRpb24gPSBfdGhpcy5fc3Vic2NyaXB0aW9uc1tzdWJzY3JpYmVyXTtcclxuICAgICAgICBsb2cubG9nKCdbU3Vic2NyaXB0aW9uTWFuYWdlcl0gLSAnLCAgX3RoaXMuX3N1YnNjcmlwdGlvbnMsIHJlc291cmNlcywgX3RoaXMuX3N1YnNjcmlwdGlvbnMuaGFzT3duUHJvcGVydHkoc3Vic2NyaWJlcikpO1xyXG4gICAgICAgIGlmICghc3Vic2NyaXB0aW9uKSB7XHJcbiAgICAgICAgICBfdGhpcy5fc3Vic2NyaXB0aW9uc1tzdWJzY3JpYmVyXSA9IHt9O1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmVzb3VyY2VzLmZvckVhY2goKHJlc291cmNlKT0+e1xyXG4gICAgICAgICAgX3RoaXMuX3N1YnNjcmlwdGlvbnNbc3Vic2NyaWJlcl1bcmVzb3VyY2VdID0gbmV3IFN1YnNjcmlwdGlvbihfdGhpcy5fYnVzLCBzdWJzY3JpYmVyLCByZXNvdXJjZSk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHJlc29sdmUocmVwbHkpO1xyXG5cclxuICAgICAgfSk7XHJcblxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuXHJcbiAgLy8gbWVzc2FnZSByZWNlaXZlZCB0byByZW1vdmUgcm91dGluZyBwYXRoXHJcbiAgX29uVW5TdWJzY3JpYmUobXNnKSB7XHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG5cclxuICAgIGxldCB1bnN1YnNjcmliZXIgPSBtc2cuZnJvbTtcclxuICAgIGxldCByZXNvdXJjZSA9IG1zZy5ib2R5LnJlc291cmNlO1xyXG5cclxuICAgIGlmIChfdGhpcy5fc3Vic2NyaXB0aW9uc1t1bnN1YnNjcmliZXJdICYmIF90aGlzLl9zdWJzY3JpcHRpb25zW3Vuc3Vic2NyaWJlcl1bcmVzb3VyY2VdKSB7XHJcbiAgICAgIGxldCBkb21haW4gPSBkaXZpZGVVUkwocmVzb3VyY2UpLmRvbWFpbjtcclxuICAgICAgbGV0IHN1YnNjcmlwdGlvbiA9IF90aGlzLl9zdWJzY3JpcHRpb25zW3Vuc3Vic2NyaWJlcl1bcmVzb3VyY2VdO1xyXG5cclxuICAgICAgLy9GTE9XLU9VVDogbWVzc2FnZSBzZW50IHRvIG1zZy1ub2RlIFN1YnNjcmlwdGlvbk1hbmFnZXIgY29tcG9uZW50XHJcbiAgICAgIF90aGlzLl9idXMucG9zdE1lc3NhZ2Uoe1xyXG4gICAgICAgIHR5cGU6ICd1bnN1YnNjcmliZScsIGZyb206IF90aGlzLl91cmwsIHRvOiAnZG9tYWluOi8vbXNnLW5vZGUuJyArIGRvbWFpbiArICcvc20nLFxyXG4gICAgICAgIGJvZHk6IHsgcmVzb3VyY2VzOiBbcmVzb3VyY2VdLCBzb3VyY2U6IHVuc3Vic2NyaWJlciB9XHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgc3Vic2NyaXB0aW9uLl9yZWxlYXNlTGlzdGVuZXJzKCk7XHJcbiAgICAgIGRlbGV0ZSBfdGhpcy5fc3Vic2NyaXB0aW9uc1t1bnN1YnNjcmliZXJdW3Jlc291cmNlXTtcclxuXHJcbiAgICAgIGlmIChfdGhpcy5fc3Vic2NyaXB0aW9uc1N0b3JhZ2VbdW5zdWJzY3JpYmVyXSkge1xyXG4gICAgICAgIGxldCBpID0gX3RoaXMuX3N1YnNjcmlwdGlvbnNTdG9yYWdlW3Vuc3Vic2NyaWJlcl0ucmVzb3VyY2VzLmluZGV4T2YocmVzb3VyY2UpO1xyXG4gICAgICAgIGlmIChpICE9IC0xKSB7XHJcbiAgICAgICAgICBfdGhpcy5fc3Vic2NyaXB0aW9uc1N0b3JhZ2VbdW5zdWJzY3JpYmVyXS5yZXNvdXJjZXMuc3BsaWNlKGksIDEpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBfdGhpcy5fc3RvcmFnZS5zZXQoJ3N1YnNjcmlwdGlvbnMnLCAxLCBfdGhpcy5fc3Vic2NyaXB0aW9uc1N0b3JhZ2UpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgX3RoaXMuX2J1cy5wb3N0TWVzc2FnZSh7XHJcbiAgICAgIGlkOiBtc2cuaWQsIHR5cGU6ICdyZXNwb25zZScsIGZyb206IG1zZy50bywgdG86IG1zZy5mcm9tLFxyXG4gICAgICBib2R5OiB7IGNvZGU6IDIwMCB9XHJcbiAgICB9KTtcclxuXHJcbiAgfVxyXG5cclxuICAvL21lc3NhZ2UgcmVjZWl2ZWQgdG8gcmVhZCBleGlzdGluZyByb3V0aW5nIHBhdGhzLiBBdCB0aGlzIHBvaW50IGxpbWl0ZWQgdG8gcmVhZCBhbGwgZXhpc3Rpbmcgcm91dGluZyBwYXRocyBzZXQgZm9yIG9uZSBsaXN0ZW5lclxyXG4gIF9vblJlYWQobXNnKSB7XHJcblxyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuXHJcbiAgICBsZXQgbGlzdGVuZXJBZGRyZXNzID0gbXNnLmJvZHkucmVzb3VyY2U7XHJcbiAgICBsZXQgcmVwbHk7XHJcblxyXG4gICAgbG9nLmxvZygnW1N1YnNjcmlwdGlvbk1hbmFnZXJdIC0gcmVxdWVzdCB0byByZWFkIFN1YnNjcmlwdGlvbnM6ICcsIG1zZyk7XHJcblxyXG4gICAgX3RoaXMuX3N0b3JhZ2UuZ2V0KCdzdWJzY3JpcHRpb25zJykudGhlbigoc3Vic2NyaXB0aW9ucyk9PntcclxuICAgICAgaWYgKHN1YnNjcmlwdGlvbnMgJiYgc3Vic2NyaXB0aW9uc1tsaXN0ZW5lckFkZHJlc3NdKSB7XHJcbiAgICAgICAgbGV0IHJlc291cmNlcyA9IHN1YnNjcmlwdGlvbnNbbGlzdGVuZXJBZGRyZXNzXS5yZXNvdXJjZXM7XHJcblxyXG4gICAgICAgIHJlcGx5ID0ge1xyXG4gICAgICAgICAgaWQ6IG1zZy5pZCwgdHlwZTogJ3Jlc3BvbnNlJywgZnJvbTogbXNnLnRvLCB0bzogbXNnLmZyb20sXHJcbiAgICAgICAgICBib2R5OiB7IGNvZGU6IDIwMCwgdmFsdWU6IHJlc291cmNlcyB9XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgcmVwbHkgPSB7XHJcbiAgICAgICAgICBpZDogbXNnLmlkLCB0eXBlOiAncmVzcG9uc2UnLCBmcm9tOiBtc2cudG8sIHRvOiBtc2cuZnJvbSxcclxuICAgICAgICAgIGJvZHk6IHsgY29kZTogNDA0LCBkZXNjcmlwdGlvbjogJ05vdCBGb3VuZCcgfVxyXG4gICAgICAgIH07XHJcbiAgICAgIH1cclxuICAgICAgX3RoaXMuX2J1cy5wb3N0TWVzc2FnZShyZXBseSk7XHJcbiAgICB9KTtcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBkZWZhdWx0IFN1YnNjcmlwdGlvbk1hbmFnZXI7XHJcbiIsImltcG9ydCB7ZGl2aWRlRW1haWwsIGRpdmlkZVVSTCwgaXNEYXRhT2JqZWN0VVJMfSBmcm9tICcuLi91dGlscy91dGlscyc7XHJcblxyXG5jbGFzcyBSZVRoaW5rQ3R4IHtcclxuXHJcbiAgY29uc3RydWN0b3IoKSB7XHJcbiAgICB0aGlzLmRlZmF1bHRCZWhhdmlvdXIgPSB0cnVlO1xyXG4gICAgdGhpcy5ncm91cHMgPSB7fTtcclxuICB9XHJcblxyXG4gIGdldCBzY2hlbWUoKSB7XHJcbiAgICByZXR1cm4gdGhpcy5fc2NoZW1lO1xyXG4gIH1cclxuXHJcbiAgZ2V0IGRhdGUoKSB7XHJcbiAgICByZXR1cm4gdGhpcy5fZGF0ZTtcclxuICB9XHJcblxyXG4gIGdldCBkb21haW4oKSB7XHJcbiAgICByZXR1cm4gdGhpcy5fZG9tYWluO1xyXG4gIH1cclxuXHJcbiAgZ2V0IHR5cGUoKSB7XHJcbiAgICByZXR1cm4gdGhpcy5fdHlwZTtcclxuICB9XHJcblxyXG4gIGdldCBzb3VyY2UoKSB7XHJcbiAgICByZXR1cm4gdGhpcy5fc291cmNlO1xyXG4gIH1cclxuXHJcbiAgZ2V0IHRpbWUoKSB7XHJcbiAgICByZXR1cm4gdGhpcy5fdGltZTtcclxuICB9XHJcblxyXG4gIGdldCB3ZWVrZGF5KCkge1xyXG4gICAgcmV0dXJuIHRoaXMuX3dlZWtkYXk7XHJcbiAgfVxyXG5cclxuICBzZXQgc2NoZW1lKHBhcmFtcykge1xyXG4gICAgbGV0IGZyb20gPSBwYXJhbXMubWVzc2FnZS5mcm9tO1xyXG4gICAgaWYgKGlzRGF0YU9iamVjdFVSTChmcm9tKSkge1xyXG4gICAgICB0aGlzLl9zY2hlbWUgPSBkaXZpZGVVUkwoZnJvbSkudHlwZTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRoaXMuX3NjaGVtZSA9IHVuZGVmaW5lZDtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHNldCBkYXRlKG5vdykge1xyXG4gICAgbGV0IGRhdGUgPSBuZXcgRGF0ZSgpO1xyXG4gICAgbGV0IGRheSA9IFN0cmluZyhkYXRlLmdldERhdGUoKSk7XHJcbiAgICBpZiAoZGF5Lmxlbmd0aCA9PT0gMSkge1xyXG4gICAgICBkYXkgPSAnMCcgKyBkYXk7XHJcbiAgICB9XHJcbiAgICBsZXQgbW9udGggPSBTdHJpbmcoZGF0ZS5nZXRNb250aCgpICsgMSk7XHJcbiAgICBpZiAobW9udGgubGVuZ3RoID09PSAxKSB7XHJcbiAgICAgIG1vbnRoID0gJzAnICsgbW9udGg7XHJcbiAgICB9XHJcbiAgICB0aGlzLl9kYXRlID0gZGF5ICsgJy8nICsgbW9udGggKyAnLycgKyBkYXRlLmdldEZ1bGxZZWFyKCk7XHJcbiAgfVxyXG5cclxuICBzZXQgZG9tYWluKHBhcmFtcykge1xyXG4gICAgaWYgKHBhcmFtcy5tZXNzYWdlLmJvZHkuaWRlbnRpdHkgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICB0aGlzLl9kb21haW4gPSBkaXZpZGVFbWFpbChwYXJhbXMubWVzc2FnZS5ib2R5LmlkZW50aXR5LnVzZXJQcm9maWxlLnVzZXJuYW1lKS5kb21haW47XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBzZXQgdHlwZShwYXJhbXMpIHtcclxuICAgIGxldCBtZXNzYWdlID0gcGFyYW1zLm1lc3NhZ2U7XHJcbiAgICBpZiAobWVzc2FnZS5ib2R5LnZhbHVlICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgdGhpcy5fdHlwZSA9IG1lc3NhZ2UuYm9keS52YWx1ZS5yZXNvdXJjZVR5cGU7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBzZXQgc291cmNlKHBhcmFtcykge1xyXG4gICAgaWYgKHBhcmFtcy5tZXNzYWdlLmJvZHkuaWRlbnRpdHkgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICB0aGlzLl9zb3VyY2UgPSBwYXJhbXMubWVzc2FnZS5ib2R5LmlkZW50aXR5LnVzZXJQcm9maWxlLnVzZXJuYW1lO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgc2V0IHRpbWUobm93KSB7XHJcbiAgICBub3cgPSBuZXcgRGF0ZSgpO1xyXG4gICAgbGV0IG1pbnV0ZXMgPSBTdHJpbmcobm93LmdldE1pbnV0ZXMoKSk7XHJcbiAgICBpZiAobWludXRlcy5sZW5ndGggPT09IDEpIHtcclxuICAgICAgbWludXRlcyA9ICcwJyArIG1pbnV0ZXM7XHJcbiAgICB9XHJcbiAgICB0aGlzLl90aW1lID0gcGFyc2VJbnQoU3RyaW5nKG5vdy5nZXRIb3VycygpKSArIG1pbnV0ZXMpO1xyXG4gIH1cclxuXHJcbiAgc2V0IHdlZWtkYXkobm93KSB7XHJcbiAgICB0aGlzLl93ZWVrZGF5ID0gU3RyaW5nKG5ldyBEYXRlKCkuZ2V0RGF5KCkpO1xyXG4gIH1cclxuXHJcbn1cclxuXHJcbmV4cG9ydCBkZWZhdWx0IFJlVGhpbmtDdHg7XHJcbiIsImltcG9ydCAqIGFzIGxvZ2dlciBmcm9tICdsb2dsZXZlbCc7XHJcbmxldCBsb2cgPSBsb2dnZXIuZ2V0TG9nZ2VyKCdQRVAnKTtcclxuXHJcbmltcG9ydCBBbGxvd092ZXJyaWRlcyBmcm9tICcuLi9jb21iaW5pbmdBbGdvcml0aG1zL0FsbG93T3ZlcnJpZGVzJztcclxuaW1wb3J0IEJsb2NrT3ZlcnJpZGVzIGZyb20gJy4uL2NvbWJpbmluZ0FsZ29yaXRobXMvQmxvY2tPdmVycmlkZXMnO1xyXG5pbXBvcnQge2RpdmlkZVVSTCwgZ2V0VXNlckVtYWlsRnJvbVVSTCwgaXNEYXRhT2JqZWN0VVJMfSBmcm9tICcuLi8uLi91dGlscy91dGlscyc7XHJcbmltcG9ydCBGaXJzdEFwcGxpY2FibGUgZnJvbSAnLi4vY29tYmluaW5nQWxnb3JpdGhtcy9GaXJzdEFwcGxpY2FibGUnO1xyXG5pbXBvcnQgUmVUaGlua0N0eCBmcm9tICcuLi9SZVRoaW5rQ3R4JztcclxuXHJcbmNsYXNzIFJ1bnRpbWVDb3JlQ3R4IGV4dGVuZHMgUmVUaGlua0N0eCB7XHJcblxyXG4gIGNvbnN0cnVjdG9yKHJ1bnRpbWVVUkwsIGlkTW9kdWxlLCBydW50aW1lUmVnaXN0cnksIHN0b3JhZ2VNYW5hZ2VyLCBydW50aW1lQ2FwYWJpbGl0aWVzKSB7XHJcbiAgICBzdXBlcigpO1xyXG4gICAgdGhpcy5fcnVudGltZVVSTCA9IHJ1bnRpbWVVUkw7XHJcbiAgICB0aGlzLl9wZXBVUkwgPSB0aGlzLl9ydW50aW1lVVJMICsgJy9wZXAnO1xyXG4gICAgdGhpcy5fZ3VpVVJMID0gdGhpcy5fcnVudGltZVVSTCArICcvcG9saWN5LWd1aSc7XHJcbiAgICB0aGlzLmlkTW9kdWxlID0gaWRNb2R1bGU7XHJcbiAgICB0aGlzLnJ1bnRpbWVSZWdpc3RyeSA9IHJ1bnRpbWVSZWdpc3RyeTtcclxuICAgIHRoaXMuYWN0aXZlVXNlclBvbGljeSA9IHVuZGVmaW5lZDtcclxuICAgIHRoaXMuc2VydmljZVByb3ZpZGVyUG9saWN5ID0ge307XHJcbiAgICB0aGlzLnVzZXJQb2xpY2llcyA9IHt9O1xyXG4gICAgdGhpcy5zdG9yYWdlTWFuYWdlciA9IHN0b3JhZ2VNYW5hZ2VyO1xyXG4gICAgdGhpcy5ydW50aW1lQ2FwYWJpbGl0aWVzID0gcnVudGltZUNhcGFiaWxpdGllcztcclxuICB9XHJcblxyXG4gIGdldCBwZXBVUkwoKSB7XHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG4gICAgcmV0dXJuIF90aGlzLl9wZXBVUkw7XHJcbiAgfVxyXG5cclxuICBnZXQgZ3VpVVJMKCkge1xyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuICAgIHJldHVybiBfdGhpcy5fZ3VpVVJMO1xyXG4gIH1cclxuXHJcbiAgZ2V0IHJ1bnRpbWVVUkwoKSB7XHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG4gICAgcmV0dXJuIF90aGlzLl9ydW50aW1lVVJMO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgKiByZXR1cm4gdGhlIG1lc3NhZ2VCdXMgaW4gdGhpcyBSZWdpc3RyeVxyXG4gICogQHBhcmFtIHtNZXNzYWdlQnVzfSAgICAgICAgICAgbWVzc2FnZUJ1c1xyXG4gICovXHJcbiAgZ2V0IG1lc3NhZ2VCdXMoKSB7XHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG4gICAgcmV0dXJuIF90aGlzLl9tZXNzYWdlQnVzO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgKiBTZXQgdGhlIG1lc3NhZ2VCdXMgaW4gdGhpcyBSZWdpc3RyeVxyXG4gICogQHBhcmFtIHtNZXNzYWdlQnVzfSAgICAgICAgICAgbWVzc2FnZUJ1c1xyXG4gICovXHJcbiAgc2V0IG1lc3NhZ2VCdXMobWVzc2FnZUJ1cykge1xyXG4gICAgbGV0IF90aGlzID0gdGhpcztcclxuICAgIF90aGlzLl9tZXNzYWdlQnVzID0gbWVzc2FnZUJ1cztcclxuICB9XHJcblxyXG4gIGdldCBzdWJzY3JpcHRpb24oKSB7XHJcbiAgICByZXR1cm4gdGhpcy5fc3Vic2NyaXB0aW9uO1xyXG4gIH1cclxuXHJcbiAgc2V0IHN1YnNjcmlwdGlvbihwYXJhbXMpIHtcclxuICAgIHRoaXMuX3N1YnNjcmlwdGlvbiA9IHBhcmFtcy5tZXNzYWdlLmJvZHkuc3Vic2NyaWJlcjtcclxuICB9XHJcblxyXG4gIGxvYWRDb25maWd1cmF0aW9ucygpIHtcclxuICAgIGxldCBfdGhpcyA9IHRoaXM7XHJcblxyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcclxuXHJcbiAgICAgIGNvbnNvbGUubG9nKF90aGlzLnN0b3JhZ2VNYW5hZ2VyKTtcclxuXHJcbiAgICAgIF90aGlzLnN0b3JhZ2VNYW5hZ2VyLmdldCgncmV0aGluazphY3RpdmVQb2xpY3knKS50aGVuKCh2YWx1ZSkgPT4ge1xyXG4gICAgICAgIF90aGlzLmFjdGl2ZVVzZXJQb2xpY3kgPSB2YWx1ZTtcclxuXHJcbiAgICAgICAgcmV0dXJuIF90aGlzLnN0b3JhZ2VNYW5hZ2VyLmdldCgncmV0aGluazpncm91cHMnKTtcclxuICAgICAgfSkudGhlbigoZ3JvdXBJbmZvKSA9PiB7XHJcbiAgICAgICAgbGV0IGdyb3VwcyA9IGdyb3VwSW5mbztcclxuICAgICAgICBfdGhpcy5ncm91cHMgPSAoZ3JvdXBzID09PSB1bmRlZmluZWQpID8ge30gOiBncm91cHM7XHJcblxyXG4gICAgICAgIHJldHVybiBfdGhpcy5zdG9yYWdlTWFuYWdlci5nZXQoJ3JldGhpbms6c3BQb2xpY2llcycpO1xyXG4gICAgICB9KS50aGVuKChwb2xpY2llc0luZm8pID0+IHtcclxuICAgICAgICBsZXQgc3BQb2xpY2llcyA9IHBvbGljaWVzSW5mbztcclxuICAgICAgICBfdGhpcy5zZXJ2aWNlUHJvdmlkZXJQb2xpY3kgPSAoc3BQb2xpY2llcyA9PT0gdW5kZWZpbmVkKSA/IHt9IDogc3BQb2xpY2llcztcclxuXHJcbiAgICAgICAgX3RoaXMuX2xvYWRVc2VyUG9saWNpZXMoKS50aGVuKCgpID0+IHtcclxuICAgICAgICAgIHJlc29sdmUoKTtcclxuICAgICAgICB9KTtcclxuICAgICAgfSk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG5cclxuICBnZXRQb2xpY2llcyhtZXNzYWdlLCBpc0luY29taW5nTWVzc2FnZSkge1xyXG4gICAgbGV0IHBvbGljaWVzID0ge307XHJcblxyXG4gICAgaWYgKHRoaXMuYWN0aXZlVXNlclBvbGljeSAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgIHBvbGljaWVzLnVzZXJQb2xpY3kgPSB0aGlzLnVzZXJQb2xpY2llc1t0aGlzLmFjdGl2ZVVzZXJQb2xpY3ldO1xyXG4gICAgfVxyXG5cclxuICAgIHBvbGljaWVzLnNlcnZpY2VQcm92aWRlclBvbGljeSA9IHRoaXMuZ2V0U2VydmljZVByb3ZpZGVyUG9saWN5KG1lc3NhZ2UsIGlzSW5jb21pbmdNZXNzYWdlKTtcclxuXHJcbiAgICByZXR1cm4gcG9saWNpZXM7XHJcbiAgfVxyXG5cclxuICBfaXNWYWxpZFVwZGF0ZShtZXNzYWdlKSB7XHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcclxuICAgICAgaWYgKG1lc3NhZ2UuZnJvbS5zcGxpdCgnOi8vJykubGVuZ3RoID4gMSkge1xyXG4gICAgICAgIF90aGlzLmlkTW9kdWxlLl9nZXRIeXBlcnR5RnJvbURhdGFPYmplY3QobWVzc2FnZS5mcm9tKS50aGVuKGh5cGVydHlVUkwgPT4ge1xyXG4gICAgICAgICAgaWYgKGh5cGVydHlVUkwgPT09IG1lc3NhZ2UuYm9keS5zb3VyY2UpIHtcclxuICAgICAgICAgICAgcmVzb2x2ZShtZXNzYWdlKTtcclxuICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHJlamVjdCgnVGhlIHNvdXJjZSBvZiB0aGUgbWVzc2FnZSBpcyBub3QgdmFsaWQuJyk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSwgKGVycm9yKSA9PiB7XHJcbiAgICAgICAgICByZWplY3QoZXJyb3IpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHJlc29sdmUobWVzc2FnZSk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcblxyXG5cclxuICBnZXRNeUVtYWlscygpIHtcclxuICAgIGxldCBpZGVudGl0aWVzID0gdGhpcy5pZE1vZHVsZS5nZXRJZGVudGl0aWVzKCk7XHJcbiAgICBsZXQgZW1haWxzID0gW107XHJcblxyXG4gICAgZm9yIChsZXQgaSBpbiBpZGVudGl0aWVzKSB7XHJcbiAgICAgIGVtYWlscy5wdXNoKGdldFVzZXJFbWFpbEZyb21VUkwoaWRlbnRpdGllc1tpXS5pZGVudGl0eSkpO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBlbWFpbHM7XHJcbiAgfVxyXG5cclxuICBnZXRNeUh5cGVydGllcygpIHtcclxuICAgIGxldCBoeXBlcnRpZXMgPSB0aGlzLnJ1bnRpbWVSZWdpc3RyeS5oeXBlcnRpZXNMaXN0O1xyXG4gICAgbGV0IGh5cGVydGllc05hbWVzID0gW107XHJcblxyXG4gICAgZm9yIChsZXQgaSBpbiBoeXBlcnRpZXMpIHtcclxuICAgICAgbGV0IGh5cGVydHlOYW1lID0gaHlwZXJ0aWVzW2ldLm9iamVjdE5hbWU7XHJcbiAgICAgIGlmIChoeXBlcnRpZXNOYW1lcy5pbmRleE9mKGh5cGVydHlOYW1lKSA9PT0gLTEpIHtcclxuICAgICAgICBoeXBlcnRpZXNOYW1lcy5wdXNoKGh5cGVydHlOYW1lKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBoeXBlcnRpZXNOYW1lcztcclxuICB9XHJcblxyXG4gIGdldFNlcnZpY2VQcm92aWRlclBvbGljeShtZXNzYWdlLCBpc0luY29taW5nKSB7XHJcbiAgICBsZXQgcG9saWN5O1xyXG5cclxuICAgIGlmIChpc0luY29taW5nKSB7XHJcbiAgICAgIGxldCB0b0h5cGVydHkgPSB0aGlzLnJ1bnRpbWVSZWdpc3RyeS5nZXRIeXBlcnR5TmFtZShtZXNzYWdlLnRvKTtcclxuICAgICAgcG9saWN5ID0gdGhpcy5zZXJ2aWNlUHJvdmlkZXJQb2xpY3lbdG9IeXBlcnR5XTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGxldCBmcm9tSHlwZXJ0eSA9IHRoaXMucnVudGltZVJlZ2lzdHJ5LmdldEh5cGVydHlOYW1lKG1lc3NhZ2UuZnJvbSk7XHJcbiAgICAgIHBvbGljeSA9IHRoaXMuc2VydmljZVByb3ZpZGVyUG9saWN5W2Zyb21IeXBlcnR5XTtcclxuICAgIH1cclxuICAgIHJldHVybiBwb2xpY3k7XHJcbiAgfVxyXG5cclxuXHJcbiAgZ2V0VVJMKHVybCkge1xyXG4gICAgbGV0IHNwbGl0VVJMID0gdXJsLnNwbGl0KCcvJyk7XHJcbiAgICByZXR1cm4gc3BsaXRVUkxbMF0gKyAnLy8nICsgc3BsaXRVUkxbMl0gKyAnLycgKyBzcGxpdFVSTFszXTtcclxuICB9XHJcblxyXG5cclxuICAvKipcclxuICAqIENyZWF0ZXMgYSBncm91cCB3aXRoIHRoZSBnaXZlbiBuYW1lLlxyXG4gICogQHBhcmFtICB7U3RyaW5nfSAgZ3JvdXBOYW1lXHJcbiAgKi9cclxuICBfbG9hZFVzZXJQb2xpY2llcygpIHtcclxuICAgIGxldCBfdGhpcyA9IHRoaXM7XHJcblxyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcclxuXHJcbiAgICAgIF90aGlzLnN0b3JhZ2VNYW5hZ2VyLmdldCgncmV0aGluazp1c2VyUG9saWNpZXMnKS50aGVuKCh2YWx1ZSkgPT4ge1xyXG4gICAgICAgIGxldCBwb2xpY2llcyA9IHZhbHVlO1xyXG4gICAgICAgIGlmIChwb2xpY2llcyAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICBmb3IgKGxldCBpIGluIHBvbGljaWVzKSB7XHJcbiAgICAgICAgICAgIHRoaXMucGVwLmFkZFBvbGljeSgnVVNFUicsIGksIHBvbGljaWVzW2ldKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcmVzb2x2ZSgpO1xyXG4gICAgICB9KTtcclxuICAgIH0pO1xyXG5cclxuICB9XHJcblxyXG4gIF9nZXRMYXN0Q29tcG9uZW50T2ZVUkwodXJsKSB7XHJcbiAgICBsZXQgc3BsaXQgPSB1cmwuc3BsaXQoJy8nKTtcclxuICAgIHJldHVybiBzcGxpdFtzcGxpdC5sZW5ndGggLSAxXTtcclxuICB9XHJcblxyXG4gIF9nZXRQb2xpY2llc0pTT04ocG9saWNpZXMpIHtcclxuICAgIGZvciAobGV0IGkgaW4gcG9saWNpZXMpIHtcclxuICAgICAgbGV0IGNvbWJpbmluZ0FsZ29yaXRobSA9IHBvbGljaWVzW2ldLmNvbWJpbmluZ0FsZ29yaXRobTtcclxuICAgICAgaWYgKGNvbWJpbmluZ0FsZ29yaXRobSBpbnN0YW5jZW9mIEJsb2NrT3ZlcnJpZGVzKSB7XHJcbiAgICAgICAgcG9saWNpZXNbaV0uY29tYmluaW5nQWxnb3JpdGhtID0gJ2Jsb2NrT3ZlcnJpZGVzJztcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBpZiAoY29tYmluaW5nQWxnb3JpdGhtIGluc3RhbmNlb2YgQWxsb3dPdmVycmlkZXMpIHtcclxuICAgICAgICAgIHBvbGljaWVzW2ldLmNvbWJpbmluZ0FsZ29yaXRobSA9ICdhbGxvd092ZXJyaWRlcyc7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIGlmIChjb21iaW5pbmdBbGdvcml0aG0gaW5zdGFuY2VvZiBGaXJzdEFwcGxpY2FibGUpIHtcclxuICAgICAgICAgICAgcG9saWNpZXNbaV0uY29tYmluaW5nQWxnb3JpdGhtID0gJ2ZpcnN0QXBwbGljYWJsZSc7XHJcbiAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBwb2xpY2llc1tpXS5jb21iaW5pbmdBbGdvcml0aG0gPSB1bmRlZmluZWQ7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHBvbGljaWVzO1xyXG4gIH1cclxuXHJcbiAgc2F2ZUFjdGl2ZVBvbGljeSgpIHtcclxuICAgIGxldCBfdGhpcyA9IHRoaXM7XHJcblxyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcclxuICAgICAgX3RoaXMuc3RvcmFnZU1hbmFnZXIuc2V0KCdyZXRoaW5rOmFjdGl2ZVBvbGljeScsIDAsIHRoaXMuYWN0aXZlVXNlclBvbGljeSkudGhlbigoKSA9PiB7XHJcbiAgICAgICAgcmVzb2x2ZSgpO1xyXG4gICAgICB9KTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgc2F2ZUdyb3VwcygpIHtcclxuICAgIGxldCBfdGhpcyA9IHRoaXM7XHJcblxyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcclxuICAgICAgX3RoaXMuc3RvcmFnZU1hbmFnZXIuc2V0KCdyZXRoaW5rOmdyb3VwcycsIDAsIHRoaXMuZ3JvdXBzKS50aGVuKCgpID0+IHtcclxuICAgICAgICByZXNvbHZlKCk7XHJcbiAgICAgIH0pO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBzYXZlUG9saWNpZXMoc291cmNlLCBwb2xpY3ksIGtleSkge1xyXG4gICAgbGV0IHBvbGljaWVzSnNvbjtcclxuXHJcbiAgICBzd2l0Y2ggKHNvdXJjZSkge1xyXG4gICAgICBjYXNlICdVU0VSJzpcclxuICAgICAgICBwb2xpY2llc0pzb24gPSBKU09OLnN0cmluZ2lmeSh0aGlzLnVzZXJQb2xpY2llcyk7XHJcbiAgICAgICAgcG9saWNpZXNKc29uID0gdGhpcy5fZ2V0UG9saWNpZXNKU09OKEpTT04ucGFyc2UocG9saWNpZXNKc29uKSk7XHJcbiAgICAgICAgdGhpcy5zdG9yYWdlTWFuYWdlci5zZXQoJ3JldGhpbms6dXNlclBvbGljaWVzJywgMCwgcG9saWNpZXNKc29uKTtcclxuICAgICAgICBicmVhaztcclxuICAgICAgY2FzZSAnU0VSVklDRV9QUk9WSURFUic6XHJcbiAgICAgICAgaWYgKHBvbGljeSAhPT0gdW5kZWZpbmVkICYga2V5ICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgIHRoaXMuc2VydmljZVByb3ZpZGVyUG9saWN5W2tleV0gPSBwb2xpY3k7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHBvbGljaWVzSnNvbiA9IEpTT04uc3RyaW5naWZ5KHRoaXMuc2VydmljZVByb3ZpZGVyUG9saWN5KTtcclxuICAgICAgICBwb2xpY2llc0pzb24gPSB0aGlzLl9nZXRQb2xpY2llc0pTT04oSlNPTi5wYXJzZShwb2xpY2llc0pzb24pKTtcclxuICAgICAgICB0aGlzLnN0b3JhZ2VNYW5hZ2VyLnNldCgncmV0aGluazpzcFBvbGljaWVzJywgMCwgcG9saWNpZXNKc29uKTtcclxuICAgICAgICBicmVhaztcclxuICAgICAgZGVmYXVsdDpcclxuICAgICAgICB0aHJvdyBFcnJvcignVW5rbm93biBwb2xpY3kgc291cmNlOiAnICsgc291cmNlKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIGdldEdyb3Vwc05hbWVzKCkge1xyXG4gICAgbGV0IG15R3JvdXBzID0gdGhpcy5ncm91cHM7XHJcbiAgICBsZXQgZ3JvdXBzTmFtZXMgPSBbXTtcclxuICAgIGlmIChteUdyb3VwcyAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgIGZvciAobGV0IGdyb3VwTmFtZSBpbiBteUdyb3Vwcykge1xyXG4gICAgICAgIGdyb3Vwc05hbWVzLnB1c2goZ3JvdXBOYW1lKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgcmV0dXJuIGdyb3Vwc05hbWVzO1xyXG4gIH1cclxuXHJcbiAgZ2V0R3JvdXAoZ3JvdXBOYW1lLCBkZXN0aW5hdGlvbikge1xyXG4gICAgbGV0IG1lbWJlcnMgPSBbXTtcclxuXHJcbiAgICBpZiAoZ3JvdXBOYW1lID09PSAncHJlYXV0aG9yaXNlZCcpIHtcclxuICAgICAgbGV0IGRhdGFPYmplY3RVUkwgPSBkZXN0aW5hdGlvbi5zcGxpdCgnLycpO1xyXG4gICAgICBkYXRhT2JqZWN0VVJMLnBvcCgpO1xyXG4gICAgICBkYXRhT2JqZWN0VVJMID0gZGF0YU9iamVjdFVSTFswXSArICcvLycgKyBkYXRhT2JqZWN0VVJMWzJdO1xyXG4gICAgICBtZW1iZXJzID0gdGhpcy5ydW50aW1lUmVnaXN0cnkuZ2V0UHJlQXV0aFN1YnNjcmliZXJzKGRhdGFPYmplY3RVUkwpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgaWYgKHRoaXMuZ3JvdXBzW2dyb3VwTmFtZV0gIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgIG1lbWJlcnMgPSB0aGlzLmdyb3Vwc1tncm91cE5hbWVdO1xyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIG1lbWJlcnM7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAqIENyZWF0ZXMgYSBncm91cCB3aXRoIHRoZSBnaXZlbiBuYW1lLlxyXG4gICogQHBhcmFtICB7U3RyaW5nfSAgZ3JvdXBOYW1lXHJcbiAgKi9cclxuICBjcmVhdGVHcm91cChncm91cE5hbWUpIHtcclxuICAgIHRoaXMuZ3JvdXBzW2dyb3VwTmFtZV0gPSBbXTtcclxuICAgIHRoaXMuc2F2ZUdyb3VwcygpO1xyXG4gIH1cclxuXHJcbiAgZGVsZXRlR3JvdXAoZ3JvdXBOYW1lKSB7XHJcbiAgICBkZWxldGUgdGhpcy5ncm91cHNbZ3JvdXBOYW1lXTtcclxuICAgIHRoaXMuc2F2ZUdyb3VwcygpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgKiBBZGRzIHRoZSBnaXZlbiB1c2VyIGVtYWlsIHRvIHRoZSBncm91cCB3aXRoIHRoZSBnaXZlbiBuYW1lLlxyXG4gICogQHBhcmFtICB7U3RyaW5nfSAgdXNlckVtYWlsXHJcbiAgKiBAcGFyYW0gIHtTdHJpbmd9ICBncm91cE5hbWVcclxuICAqL1xyXG4gIGFkZFRvR3JvdXAoZ3JvdXBOYW1lLCB1c2VyRW1haWwpIHtcclxuICAgIGxldCBteUdyb3VwcyA9IHRoaXMuZ3JvdXBzO1xyXG4gICAgaWYgKG15R3JvdXBzW2dyb3VwTmFtZV0gIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICBpZiAobXlHcm91cHNbZ3JvdXBOYW1lXS5pbmRleE9mKHVzZXJFbWFpbCkgPT09IC0xKSB7XHJcbiAgICAgICAgbXlHcm91cHNbZ3JvdXBOYW1lXS5wdXNoKHVzZXJFbWFpbCk7XHJcbiAgICAgICAgdGhpcy5zYXZlR3JvdXBzKCk7XHJcbiAgICAgIH1cclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRocm93IEVycm9yKCdHcm91cCBcIicgKyBncm91cE5hbWUgKyAnXCIgZG9lcyBub3QgZXhpc3QhJyk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICByZW1vdmVGcm9tR3JvdXAoZ3JvdXBOYW1lLCB1c2VyRW1haWwpIHtcclxuICAgIGxldCBncm91cCA9IHRoaXMuZ3JvdXBzW2dyb3VwTmFtZV07XHJcblxyXG4gICAgZ3JvdXAuc3BsaWNlKGdyb3VwLmluZGV4T2YodXNlckVtYWlsKSwgMSk7XHJcbiAgICB0aGlzLnNhdmVHcm91cHMoKTtcclxuICB9XHJcblxyXG59XHJcblxyXG5leHBvcnQgZGVmYXVsdCBSdW50aW1lQ29yZUN0eDtcclxuIiwiLyoqXHJcbiAqIENvcHlyaWdodCAyMDE2IFBUIElub3Zhw6fDo28gZSBTaXN0ZW1hcyBTQVxyXG4gKiBDb3B5cmlnaHQgMjAxNiBJTkVTQy1JRFxyXG4gKiBDb3B5cmlnaHQgMjAxNiBRVU9CSVMgTkVUV09SS1MgU0xcclxuICogQ29weXJpZ2h0IDIwMTYgRlJBVU5IT0ZFUi1HRVNFTExTQ0hBRlQgWlVSIEZPRVJERVJVTkcgREVSIEFOR0VXQU5EVEVOIEZPUlNDSFVORyBFLlZcclxuICogQ29weXJpZ2h0IDIwMTYgT1JBTkdFIFNBXHJcbiAqIENvcHlyaWdodCAyMDE2IERldXRzY2hlIFRlbGVrb20gQUdcclxuICogQ29weXJpZ2h0IDIwMTYgQXBpemVlXHJcbiAqIENvcHlyaWdodCAyMDE2IFRFQ0hOSVNDSEUgVU5JVkVSU0lUQVQgQkVSTElOXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbiAqXHJcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuICoqL1xyXG5pbXBvcnQgdHY0IGZyb20gXCJ0djRcIjtcclxuXHJcbmV4cG9ydCBjbGFzcyBSZXRoaW5rT2JqZWN0IHtcclxuXHJcbiAgICAvKipcclxuICAgICAqIFZhbGlkYXRlcyB0aGlzIFJldGhpbmtPYmplY3QgYWdhaW5zdCB0aGUgcHJvdmlkZWQgc2NoZW1hLlxyXG4gICAgICpcclxuICAgICAqIExJTUlUQVRJT05TOiBUaGUgcHJvdmlkZWQgc2NoZW1hIGNhbm5vdCBjb250YWluIHJlZmVyZW5jZXMgdG8gb3RoZXIgc2NoZW1hcywgc2luY2UgdGhleSBjYW4ndCBiZSByZXNvbHZlZC5cclxuICAgICAqIEBwYXJhbSBzY2hlbWEgLSBzY2hlbWEgdG8gdmFsaWRhdGUgYWdhaW5zdFxyXG4gICAgICogQHJldHVybnMge2Jvb2xlYW59IHRydWUgaWYgdmFsaWQsIGZhbHNlIG90aGVyd2lzZVxyXG4gICAgICovXHJcbiAgICB2YWxpZGF0ZShzY2hlbWEpIHtcclxuICAgICAgICAvLyBhZGQgc2NoZW1hIGl0c2VsZiBzbyBsb2NhbCByZWZlcmVuY2VzIHdvcmtcclxuICAgICAgICB0djQuYWRkU2NoZW1hKHNjaGVtYS5pZCwgc2NoZW1hKTtcclxuXHJcbiAgICAgICAgLy8gSlNPTiBzdHJpbmdpZnkgLT4gcGFyc2UgbmVlZGVkIHRvIGhhdmUgcHJvcGVyIHZhbGlkYXRpb25cclxuICAgICAgICBsZXQgcmVzdWx0ID0gdHY0LnZhbGlkYXRlTXVsdGlwbGUoSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeSh0aGlzKSksIHNjaGVtYSk7XHJcblxyXG4gICAgICAgIC8vIGRlbGV0ZSBlcnJvciBzdGFja3MgdG8gaW1wcm92ZSBsb2dnaW5nXHJcbiAgICAgICAgcmVzdWx0LmVycm9ycy5mb3JFYWNoKChlcnJvcikgPT4ge1xyXG4gICAgICAgICAgICBkZWxldGUgZXJyb3Iuc3RhY2s7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIC8vIHByaW50IG1vcmUgZGV0YWlscyBhYm91dCB2YWxpZGF0aW9uIGlmIGl0IGZhaWxzIG9yIHNjaGVtYSBjb250YWlucyAkcmVmc1xyXG4gICAgICAgIGlmICghcmVzdWx0LnZhbGlkIHx8IChyZXN1bHQubWlzc2luZy5sZW5ndGggPiAwKSkge1xyXG4gICAgICAgICAgICBjb25zb2xlLndhcm4oXCJPYmplY3QgdmFsaWRhdGlvbiBcIiArIChyZXN1bHQudmFsaWQgPyBcInN1Y2NlZWRlZCwgYnV0IHNjaGVtYSBjb250YWluZWQgcmVmZXJlbmNlczpcIiA6IFwiZmFpbGVkOlwiKSwgSlNPTi5zdHJpbmdpZnkocmVzdWx0LCBudWxsLCAyKSk7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiT2JqZWN0OlwiLCBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCAyKSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiByZXN1bHQudmFsaWQ7XHJcbiAgICB9XHJcbn1cclxuXHJcblxyXG5leHBvcnQgZGVmYXVsdCBSZXRoaW5rT2JqZWN0O1xyXG5cclxuIiwiLyoqXHJcbiAqIENvcHlyaWdodCAyMDE2IFBUIElub3Zhw6fDo28gZSBTaXN0ZW1hcyBTQVxyXG4gKiBDb3B5cmlnaHQgMjAxNiBJTkVTQy1JRFxyXG4gKiBDb3B5cmlnaHQgMjAxNiBRVU9CSVMgTkVUV09SS1MgU0xcclxuICogQ29weXJpZ2h0IDIwMTYgRlJBVU5IT0ZFUi1HRVNFTExTQ0hBRlQgWlVSIEZPRVJERVJVTkcgREVSIEFOR0VXQU5EVEVOIEZPUlNDSFVORyBFLlZcclxuICogQ29weXJpZ2h0IDIwMTYgT1JBTkdFIFNBXHJcbiAqIENvcHlyaWdodCAyMDE2IERldXRzY2hlIFRlbGVrb20gQUdcclxuICogQ29weXJpZ2h0IDIwMTYgQXBpemVlXHJcbiAqIENvcHlyaWdodCAyMDE2IFRFQ0hOSVNDSEUgVU5JVkVSU0lUQVQgQkVSTElOXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbiAqXHJcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuICoqL1xyXG5pbXBvcnQgUmV0aGlua09iamVjdCBmcm9tIFwiLi9SZXRoaW5rT2JqZWN0XCI7XHJcblxyXG4vKipcclxuICogQGF1dGhvciBhbGljZS5jaGVhbWJlW2F0XWZva3VzLmZyYXVuaG9mZXIuZGVcclxuICogVGhlIENhdGFsb2d1ZURhdGFPYmplY3QgY2xhc3MgaXMgdGhlIHJlcHJlc2VudGF0aW9uIG9mIHRoZSByZVRISU5LIENhdGFsb2d1ZSBEYXRhIE1vZGVsXHJcbiAqL1xyXG5jbGFzcyBDYXRhbG9ndWVEYXRhT2JqZWN0IGV4dGVuZHMgUmV0aGlua09iamVjdCB7XHJcbiAgICAvKipcclxuICAgICAqIENyZWF0ZXMgdGhlIENhdGFsb2d1ZSBEYXRhIE9iamVjdFxyXG4gICAgICogQHBhcmFtIGd1aWQgLSBHbG9iYWwgVW5pcXVlIGlkZW50aWZpZXIgb2YgdGhlIENhdGFsb2d1ZSBPYmplY3QgKGUuZy4gSHlwZXJ0eSBkZXNjcmlwdG9yLCBQcm90b2NvbFN0dWIgZGVzY3JpcHRvcixcclxuICAgICAqIGV0YykgZW5hYmxpbmcgdGhlIHNhbWUgb2JqZWN0IHRvIGJlIHN0b3JlZCBhbmQgZGlzY292ZXJlZCBpbiBkaWZmZXJlbnQgQ2F0YWxvZ3Vlcy4gVGhhdCBtZWFucywgZ3VpZCBjb3JyZXNwb25kcyB0b1xyXG4gICAgICogW3Jlc291cmNlLXR5cGUtaWRdIHBlciBCTkYgb2YgUmVzb3VyY2UgUGF0aC4gQ291bGRuJ3Qgd2UgaGF2ZSBwcm9ibGVtcyB3aXRoIHRvbyBsb25nIFVSTCBwYXRocz9cclxuICAgICAqIEBwYXJhbSB0eXBlIC0gaW5kaWNhdGVzIHRoZSB0eXBlIG9mIENhdGFsb2d1ZSBEYXRhIE9iamVjdCBlLmcuIEh5cGVydHksIFByb3RvY29sU3R1YiwgZXRjXHJcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gdmVyc2lvbiAtIEluZGljYXRlcyB0aGUgdmVyc2lvbiBvZiBDYXRhbG9ndWUgRGF0YVxyXG4gICAgICogQHBhcmFtIG9iamVjdE5hbWUgLSBodW1hbi11bmRlcnN0YW5kYWJsZSBuYW1lIG9mIHRoZSBjYXRhbG9ndWUgb2JqZWN0IGUuZy4gXCJNeSBBd2Vzb21lIEh5cGVydHlcIlxyXG4gICAgICogQHBhcmFtIGRlc2NyaXB0aW9uIC0gZGVzY3JpcHRpb24gb2YgdGhlIHNvdXJjZSBwYWNrYWdlXHJcbiAgICAgKiBAcGFyYW0gbGFuZ3VhZ2UgLSB0aGUgcHJvZ3JhbW1pbmcgbGFuZ3VhZ2UgdXNlZCBpbiB0aGUgU291cmNlUGFja2FnZS5Tb3VyY2VDb2RlXHJcbiAgICAgKiBAcGFyYW0gc291cmNlUGFja2FnZVVSTCAtIEEgc3RyaW5nIGNvbnRhaW5pbmcgdGhlIFVSTCBmcm9tIHdoZXJlIHRoZSBzb3VyY2UgY29kZSBwYWNrYWdlIG9mIHRoZSBjb3JyZXNwb25kaW5nXHJcbiAgICAgKiBjYXRhbG9ndWUgb2JqZWN0LCBlLmcuIGRlcGxveWFibGUgcGFja2FnZXMgY29udGFpbmluZyBleGVjdXRhYmxlIGNvZGUgZm9yIEh5cGVydGllcyBvciBQcm90b1N0dWJzLCBjYW4gYmUgZG93bmxvYWRlZFxyXG4gICAgICovXHJcbiAgICBjb25zdHJ1Y3RvcihndWlkLCB0eXBlLCB2ZXJzaW9uLCBvYmplY3ROYW1lLCBkZXNjcmlwdGlvbiwgbGFuZ3VhZ2UsIHNvdXJjZVBhY2thZ2VVUkwpIHtcclxuICAgICAgICBzdXBlcigpO1xyXG4gICAgICAgIHRoaXMuX2d1aWQgPSBndWlkO1xyXG4gICAgICAgIHRoaXMuX3R5cGUgPSB0eXBlO1xyXG4gICAgICAgIHRoaXMuX3ZlcnNpb24gPSB2ZXJzaW9uO1xyXG4gICAgICAgIHRoaXMuX29iamVjdE5hbWUgPSBvYmplY3ROYW1lO1xyXG4gICAgICAgIHRoaXMuX2Rlc2NyaXB0aW9uID0gZGVzY3JpcHRpb247XHJcbiAgICAgICAgdGhpcy5fbGFuZ3VhZ2UgPSBsYW5ndWFnZTtcclxuICAgICAgICB0aGlzLl9zb3VyY2VQYWNrYWdlVVJMID0gc291cmNlUGFja2FnZVVSTDtcclxuXHJcbiAgICAgICAgdGhpcy5fc2lnbmF0dXJlID0gbnVsbDtcclxuICAgICAgICB0aGlzLl9zb3VyY2VQYWNrYWdlID0gbnVsbDtcclxuICAgIH1cclxuXHJcbiAgICAvLyBHZXR0ZXJzXHJcbiAgICBnZXQgZ3VpZCgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fZ3VpZDtcclxuICAgIH1cclxuXHJcbiAgICBnZXQgdHlwZSgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fdHlwZTtcclxuICAgIH1cclxuXHJcbiAgICBnZXQgdmVyc2lvbigpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fdmVyc2lvbjtcclxuICAgIH1cclxuXHJcbiAgICBnZXQgb2JqZWN0TmFtZSgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fb2JqZWN0TmFtZTtcclxuICAgIH1cclxuXHJcbiAgICBnZXQgZGVzY3JpcHRpb24oKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2Rlc2NyaXB0aW9uO1xyXG4gICAgfVxyXG5cclxuICAgIGdldCBsYW5ndWFnZSgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fbGFuZ3VhZ2U7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0IHNpZ25hdHVyZSgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fc2lnbmF0dXJlO1xyXG4gICAgfVxyXG5cclxuICAgIGdldCBzb3VyY2VQYWNrYWdlKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9zb3VyY2VQYWNrYWdlO1xyXG4gICAgfVxyXG5cclxuICAgIGdldCBzb3VyY2VQYWNrYWdlVVJMKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9zb3VyY2VQYWNrYWdlVVJMO1xyXG4gICAgfVxyXG5cclxuXHJcbiAgICAvLyBTZXR0ZXJzXHJcbiAgICAvKipcclxuICAgICAqIFNldCB0aGUgc2lnbmF0dXJlIHRvIGVuYWJsZXMgaW50ZWdyaXR5IGFuZCBhdXRoZW50aWNpdHkgdmVyaWZpY2F0aW9uXHJcbiAgICAgKiBAcGFyYW0gc2lnbmF0dXJlXHJcbiAgICAgKi9cclxuICAgIHNldCBzaWduYXR1cmUoc2lnbmF0dXJlKSB7XHJcbiAgICAgICAgaWYgKHNpZ25hdHVyZSlcclxuICAgICAgICAgICAgdGhpcy5fc2lnbmF0dXJlID0gc2lnbmF0dXJlO1xyXG4gICAgfVxyXG5cclxuICAgIHNldCBzb3VyY2VQYWNrYWdlKHNvdXJjZVBhY2thZ2UpIHtcclxuICAgICAgICBpZiAoc291cmNlUGFja2FnZSlcclxuICAgICAgICAgICAgdGhpcy5fc291cmNlUGFja2FnZSA9IHNvdXJjZVBhY2thZ2U7XHJcbiAgICB9XHJcblxyXG4gICAgc2V0IGd1aWQoZ3VpZCkge1xyXG4gICAgICAgIGlmIChndWlkKVxyXG4gICAgICAgICAgICB0aGlzLl9ndWlkID0gZ3VpZDtcclxuICAgIH1cclxuXHJcbiAgICBzZXQgdHlwZSh0eXBlKSB7XHJcbiAgICAgICAgaWYgKHR5cGUpXHJcbiAgICAgICAgICAgIHRoaXMuX3R5cGUgPSB0eXBlO1xyXG4gICAgfVxyXG5cclxuICAgIHNldCB2ZXJzaW9uKHZlcnNpb24pIHtcclxuICAgICAgICBpZiAodmVyc2lvbikge1xyXG4gICAgICAgICAgICB0aGlzLl92ZXJzaW9uID0gdmVyc2lvbjtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgc2V0IG9iamVjdE5hbWUob2JqZWN0TmFtZSkge1xyXG4gICAgICAgIGlmIChvYmplY3ROYW1lKVxyXG4gICAgICAgICAgICB0aGlzLl9vYmplY3ROYW1lID0gb2JqZWN0TmFtZTtcclxuICAgIH1cclxuXHJcbiAgICBzZXQgZGVzY3JpcHRpb24oZGVzY3JpcHRpb24pIHtcclxuICAgICAgICBpZiAoZGVzY3JpcHRpb24pXHJcbiAgICAgICAgICAgIHRoaXMuX2Rlc2NyaXB0aW9uID0gZGVzY3JpcHRpb247XHJcbiAgICB9XHJcblxyXG4gICAgc2V0IGxhbmd1YWdlKGxhbmd1YWdlKSB7XHJcbiAgICAgICAgaWYgKGxhbmd1YWdlKVxyXG4gICAgICAgICAgICB0aGlzLl9sYW5ndWFnZSA9IGxhbmd1YWdlO1xyXG4gICAgfVxyXG5cclxuICAgIHNldCBzb3VyY2VQYWNrYWdlVVJMKHNvdXJjZVBhY2thZ2VVUkwpIHtcclxuICAgICAgICBpZiAoc291cmNlUGFja2FnZVVSTClcclxuICAgICAgICAgICAgdGhpcy5fc291cmNlUGFja2FnZVVSTCA9IHNvdXJjZVBhY2thZ2VVUkw7XHJcbiAgICB9XHJcbn1cclxuLy9BbGljZTogcmVtb3ZlZCBQT0xJQ1lfRU5GT1JDRVI6ICdwb2xpY3lfZW5mb3JjZXInLCBEQVRBX1NDSEVNQTogJ2RhdGFfc2NoZW1hJyBmcm9tIHRoZSBsaXN0XHJcbi8vd3J0OiBodHRwczovL2dpdGh1Yi5jb20vcmVUSElOSy1wcm9qZWN0L2Rldi1zZXJ2aWNlLWZyYW1ld29yay9ibG9iL2RldmVsb3AvZG9jcy9kYXRhbW9kZWwvY29yZS9oeXBlcnR5LWNhdGFsb2d1ZS9yZWFkbWUubWQjZGF0YS1vYmplY3Qtc2NoZW1hXHJcbmV4cG9ydCBjb25zdCBDYXRhbG9ndWVPYmplY3RUeXBlID0ge1xyXG4gICAgSFlQRVJUWTogJ2h5cGVydHknLCBQUk9UT1NUVUI6ICdwcm90b3N0dWInLCBIWVBFUlRZX1JVTlRJTUU6ICdoeXBlcnR5X3J1bnRpbWUnLFxyXG4gICAgSFlQRVJUWV9JTlRFUkNFUFRPUjogJ2h5cGVydHlfaW5zcGVjdG9yJywgSFlQRVJUWV9EQVRBX09CSkVDVDogJ2h5cGVydHlfZGF0YV9vYmplY3QnXHJcbn07XHJcbmV4cG9ydCBjb25zdCBEYXRhT2JqZWN0U291cmNlTGFuZ3VhZ2UgPSB7XHJcbiAgICBKQVZBU0NSSVBUX0VDTUE2OiAnamF2YXNjcmlwdF9lY21hNicsIEpBVkFTQ1JJUFRfRUNNQTU6ICdqYXZhc2NyaXB0X2VjbWE1JyxcclxuICAgIEpTT05fU0NIRU1BX1Y0OiAnanNvbl9zY2hlbWFfdjQnLCBQWVRIT046ICdweXRob24nLCBUWVBFU0NSSVBUOiAndHlwZXNjcmlwdCdcclxufTtcclxuZXhwb3J0IGRlZmF1bHQgQ2F0YWxvZ3VlRGF0YU9iamVjdDsiLCIvKipcclxuKiBDb3B5cmlnaHQgMjAxNiBQVCBJbm92YcOnw6NvIGUgU2lzdGVtYXMgU0FcclxuKiBDb3B5cmlnaHQgMjAxNiBJTkVTQy1JRFxyXG4qIENvcHlyaWdodCAyMDE2IFFVT0JJUyBORVRXT1JLUyBTTFxyXG4qIENvcHlyaWdodCAyMDE2IEZSQVVOSE9GRVItR0VTRUxMU0NIQUZUIFpVUiBGT0VSREVSVU5HIERFUiBBTkdFV0FORFRFTiBGT1JTQ0hVTkcgRS5WXHJcbiogQ29weXJpZ2h0IDIwMTYgT1JBTkdFIFNBXHJcbiogQ29weXJpZ2h0IDIwMTYgRGV1dHNjaGUgVGVsZWtvbSBBR1xyXG4qIENvcHlyaWdodCAyMDE2IEFwaXplZVxyXG4qIENvcHlyaWdodCAyMDE2IFRFQ0hOSVNDSEUgVU5JVkVSU0lUQVQgQkVSTElOXHJcbipcclxuKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4qIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuKlxyXG4qICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbipcclxuKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4qIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4qIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuKiovXHJcblxyXG4vKipcclxuICogQ3JlYXRlZCBieSBhbW8gb24gMTQvMTEvMjAxNS5cclxuICovXHJcbmNsYXNzIFNvdXJjZVBhY2thZ2Uge1xyXG4gICAgY29uc3RydWN0b3Ioc291cmNlQ29kZUNsYXNzbmFtZSwgc291cmNlQ29kZSkge1xyXG4gICAgICAgIHRoaXMuX3NvdXJjZUNvZGUgPSBzb3VyY2VDb2RlO1xyXG4gICAgICAgIHRoaXMuX3NvdXJjZUNvZGVDbGFzc25hbWUgPSBzb3VyY2VDb2RlQ2xhc3NuYW1lO1xyXG5cclxuICAgICAgICB0aGlzLl9lbmNvZGluZyA9IG51bGw7XHJcbiAgICAgICAgdGhpcy5fc2lnbmF0dXJlID0gbnVsbDtcclxuICAgIH1cclxuXHJcbiAgICBnZXQgc291cmNlQ29kZSgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fc291cmNlQ29kZTtcclxuICAgIH1cclxuXHJcbiAgICBnZXQgc291cmNlQ29kZUNsYXNzbmFtZSgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fc291cmNlQ29kZUNsYXNzbmFtZTtcclxuICAgIH1cclxuXHJcbiAgICBnZXQgZW5jb2RpbmcoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2VuY29kaW5nO1xyXG4gICAgfVxyXG5cclxuICAgIGdldCBzaWduYXR1cmUoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX3NpZ25hdHVyZTtcclxuICAgIH1cclxuXHJcbiAgICBzZXQgZW5jb2RpbmcoZW5jb2RpbmcpIHtcclxuICAgICAgICBpZiAoZW5jb2RpbmcpXHJcbiAgICAgICAgICAgIHRoaXMuX2VuY29kaW5nID0gZW5jb2Rpbmc7XHJcbiAgICB9XHJcblxyXG4gICAgc2V0IHNpZ25hdHVyZShzaWduKSB7XHJcbiAgICAgICAgaWYgKHNpZ24pXHJcbiAgICAgICAgICAgIHRoaXMuX3NpZ25hdHVyZSA9IHNpZ247XHJcbiAgICB9XHJcblxyXG4gICAgc2V0IHNvdXJjZUNvZGUoc291cmNlQ29kZSkge1xyXG4gICAgICAgIGlmIChzb3VyY2VDb2RlKVxyXG4gICAgICAgICAgICB0aGlzLl9zb3VyY2VDb2RlID0gc291cmNlQ29kZTtcclxuICAgIH1cclxuXHJcbiAgICBzZXQgc291cmNlQ29kZUNsYXNzbmFtZShzb3VyY2VDb2RlQ2xhc3NuYW1lKSB7XHJcbiAgICAgICAgaWYgKHNvdXJjZUNvZGVDbGFzc25hbWUpXHJcbiAgICAgICAgICAgIHRoaXMuX3NvdXJjZUNvZGVDbGFzc25hbWUgPSBzb3VyY2VDb2RlQ2xhc3NuYW1lO1xyXG4gICAgfVxyXG59XHJcblxyXG5leHBvcnQgZGVmYXVsdCBTb3VyY2VQYWNrYWdlO1xyXG4iLCIvKipcclxuKiBDb3B5cmlnaHQgMjAxNiBQVCBJbm92YcOnw6NvIGUgU2lzdGVtYXMgU0FcclxuKiBDb3B5cmlnaHQgMjAxNiBJTkVTQy1JRFxyXG4qIENvcHlyaWdodCAyMDE2IFFVT0JJUyBORVRXT1JLUyBTTFxyXG4qIENvcHlyaWdodCAyMDE2IEZSQVVOSE9GRVItR0VTRUxMU0NIQUZUIFpVUiBGT0VSREVSVU5HIERFUiBBTkdFV0FORFRFTiBGT1JTQ0hVTkcgRS5WXHJcbiogQ29weXJpZ2h0IDIwMTYgT1JBTkdFIFNBXHJcbiogQ29weXJpZ2h0IDIwMTYgRGV1dHNjaGUgVGVsZWtvbSBBR1xyXG4qIENvcHlyaWdodCAyMDE2IEFwaXplZVxyXG4qIENvcHlyaWdodCAyMDE2IFRFQ0hOSVNDSEUgVU5JVkVSU0lUQVQgQkVSTElOXHJcbipcclxuKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4qIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuKlxyXG4qICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbipcclxuKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4qIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4qIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuKiovXHJcblxyXG4vKipcclxuICogQ3JlYXRlZCBieSBhbW8gb24gMTQvMTEvMjAxNS5cclxuICovXHJcbmltcG9ydCBDYXRhbG9ndWVEYXRhT2JqZWN0IGZyb20gJy4vQ2F0YWxvZ3VlRGF0YU9iamVjdCc7XHJcblxyXG5jbGFzcyBIeXBlcnR5RGVzY3JpcHRvciBleHRlbmRzIENhdGFsb2d1ZURhdGFPYmplY3Qge1xyXG5cclxuICAgIC8qKlxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBndWlkIC0gQ2F0YWxvZ3VlIEdsb2JhbCBVbmlxdWUgaWRlbnRpZmllciBvZiB0aGUgQ2F0YWxvZ3VlIE9iamVjdCBlbmFibGluZyB0aGUgc2FtZSBvYmplY3QgdG8gYmVcclxuICAgICAqIHN0b3JlZCBhbmQgZGlzY292ZXJlZCBpbiBkaWZmZXJlbnQgQ2F0YWxvZ3Vlcy4gR3VpZCBjb3JyZXNwb25kcyB0byA8cmVzb3VyY2UtdHlwZS1pZD4gcGVyIEJORiBvZiBSZXNvdXJjZSBQYXRoLlxyXG4gICAgICogQHBhcmFtIHtDYXRhbG9ndWVPYmplY3RUeXBlfSBjYXRhbG9ndWVUeXBlIC0gXHRJbmRpY2F0ZXMgdGhlIHR5cGUgb2YgQ2F0YWxvZ3VlIERhdGEgT2JqZWN0XHJcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gdmVyc2lvblxyXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IG9iamVjdE5hbWVcclxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBkZXNjcmlwdGlvblxyXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IGxhbmd1YWdlXHJcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gc291cmNlUGFja2FnZVVSTFxyXG4gICAgICogQHBhcmFtIHtIeXBlcnR5UmVzb3VyY2VUeXBlW119IGh5cGVydHlUeXBlIEEgdGFnIHRoYXQgaWRlbnRpZmllcyB3aGF0IHR5cGUgb2YgaHlwZXJ0eSBpcyBkZXNjcmliZWQgaW4gdGhlIG9iamVjdC5cclxuICAgICAqIEBwYXJhbSB7VVJMLkh5cGVydHlDYXRhbG9ndWVVUkxMaXN0fSBkYXRhT2JqZWN0VXJscyAtIEl0IGRlZmluZXMgdGhlIERhdGEgT2JqZWN0IFNjaGVtYXMgc3VwcG9ydGVkIGJ5IHRoZSBIeXBlcnR5XHJcbiAgICAgKiB0aHJvdWdoIGEgbGlzdCBvZiBDYXRhbG9ndWUgVVJMcyBmcm9tIHdoZXJlIHRoZXNlIHNjaGVtYXMgY2FuIGJlIHJlYWNoZWRcclxuICAgICAqL1xyXG4gICAgY29uc3RydWN0b3IoZ3VpZCwgY2F0YWxvZ3VlVHlwZSwgdmVyc2lvbiwgb2JqZWN0TmFtZSwgZGVzY3JpcHRpb24sIGxhbmd1YWdlLCBzb3VyY2VQYWNrYWdlVVJMLCBoeXBlcnR5VHlwZSwgZGF0YU9iamVjdFVybHMpIHtcclxuICAgICAgICBzdXBlcihndWlkLCBjYXRhbG9ndWVUeXBlLCB2ZXJzaW9uLCBvYmplY3ROYW1lLCBkZXNjcmlwdGlvbiwgbGFuZ3VhZ2UsIHNvdXJjZVBhY2thZ2VVUkwpO1xyXG5cclxuICAgICAgICB0aGlzLl9jb25maWd1cmF0aW9uID0ge307XHJcbiAgICAgICAgdGhpcy5fY29uc3RyYWludHMgPSB7fTtcclxuICAgICAgICB0aGlzLl9wb2xpY2llcyA9IHt9O1xyXG4gICAgICAgIHRoaXMuX21lc3NhZ2VTY2hlbWEgPSBudWxsO1xyXG5cclxuICAgICAgICB0aGlzLl9oeXBlcnR5VHlwZSA9IGh5cGVydHlUeXBlO1xyXG4gICAgICAgIHRoaXMuX2RhdGFPYmplY3RzID0gZGF0YU9iamVjdFVybHM7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0IGh5cGVydHlUeXBlKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9oeXBlcnR5VHlwZTtcclxuICAgIH1cclxuXHJcbiAgICBnZXQgZGF0YU9iamVjdHMoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2RhdGFPYmplY3RzO1xyXG4gICAgfVxyXG5cclxuICAgIGdldCBjb25maWd1cmF0aW9uKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9jb25maWd1cmF0aW9uO1xyXG4gICAgfVxyXG5cclxuICAgIGdldCBjb25zdHJhaW50cygpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fY29uc3RyYWludHM7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0IG1lc3NhZ2VTY2hlbWEoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX21lc3NhZ2VTY2hlbWE7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0IHBvbGljaWVzKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9wb2xpY2llcztcclxuICAgIH1cclxuXHJcbiAgICBzZXQgaHlwZXJ0eVR5cGUoaFR5cGUpIHtcclxuICAgICAgICBpZiAoaFR5cGUpXHJcbiAgICAgICAgICAgIHRoaXMuX2h5cGVydHlUeXBlID0gaFR5cGU7XHJcbiAgICB9XHJcblxyXG4gICAgc2V0IGRhdGFPYmplY3RzKGRhdGFPYmplY3RzKSB7XHJcbiAgICAgICAgaWYgKGRhdGFPYmplY3RzKVxyXG4gICAgICAgICAgICB0aGlzLl9kYXRhT2JqZWN0cyA9IGRhdGFPYmplY3RzO1xyXG4gICAgfVxyXG5cclxuICAgIHNldCBjb25maWd1cmF0aW9uKGNvbmZpZ3VyYXRpb24pIHtcclxuICAgICAgICBpZiAoY29uZmlndXJhdGlvbilcclxuICAgICAgICAgICAgdGhpcy5fY29uZmlndXJhdGlvbiA9IGNvbmZpZ3VyYXRpb247XHJcbiAgICB9XHJcblxyXG4gICAgc2V0IGNvbnN0cmFpbnRzKGNvbnN0cmFpbnRzKSB7XHJcbiAgICAgICAgaWYgKGNvbnN0cmFpbnRzKVxyXG4gICAgICAgICAgICB0aGlzLl9jb25zdHJhaW50cyA9IGNvbnN0cmFpbnRzO1xyXG4gICAgfVxyXG5cclxuICAgIHNldCBtZXNzYWdlU2NoZW1hKG1lc3NhZ2VTY2hlbWEpIHtcclxuICAgICAgICBpZiAobWVzc2FnZVNjaGVtYSlcclxuICAgICAgICAgICAgdGhpcy5fbWVzc2FnZVNjaGVtYSA9IG1lc3NhZ2VTY2hlbWE7XHJcbiAgICB9XHJcblxyXG4gICAgc2V0IHBvbGljaWVzKHBvbGljaWVzKSB7XHJcbiAgICAgICAgaWYgKHBvbGljaWVzKVxyXG4gICAgICAgICAgICB0aGlzLl9wb2xpY2llcyA9IHBvbGljaWVzO1xyXG4gICAgfVxyXG5cclxufVxyXG5cclxuXHJcbmV4cG9ydCBjb25zdCBSdW50aW1lSHlwZXJ0eUNhcGFiaWxpdHlUeXBlID0ge307XHJcbmV4cG9ydCBjb25zdCBIeXBlcnR5VHlwZSA9IHtDT01NVU5JQ0FUT1I6ICdjb21tdW5pY2F0b3InLCBJREVOVElUWTogJ2lkZW50aXR5JywgQ09OVEVYVDogJ2NvbnRleHQnfTtcclxuZXhwb3J0IGNvbnN0IEh5cGVydHlSZXNvdXJjZVR5cGUgPSB7Y2hhdDogJ0NIQVQnLCBhdWRpbzogJ0F1ZGlvJywgdmlkZW86ICdWaWRlbycsIGF2OiAnQVYnLCBzY3JlZW46J1NDUkVFTicsXHJcbiAgICBmaWxlOiAnRklMZScsIG1pZGk6J01JREknfTtcclxuZXhwb3J0IGRlZmF1bHQgSHlwZXJ0eURlc2NyaXB0b3I7IiwiLyoqXHJcbiAqIENvcHlyaWdodCAyMDE2IFBUIElub3Zhw6fDo28gZSBTaXN0ZW1hcyBTQVxyXG4gKiBDb3B5cmlnaHQgMjAxNiBJTkVTQy1JRFxyXG4gKiBDb3B5cmlnaHQgMjAxNiBRVU9CSVMgTkVUV09SS1MgU0xcclxuICogQ29weXJpZ2h0IDIwMTYgRlJBVU5IT0ZFUi1HRVNFTExTQ0hBRlQgWlVSIEZPRVJERVJVTkcgREVSIEFOR0VXQU5EVEVOIEZPUlNDSFVORyBFLlZcclxuICogQ29weXJpZ2h0IDIwMTYgT1JBTkdFIFNBXHJcbiAqIENvcHlyaWdodCAyMDE2IERldXRzY2hlIFRlbGVrb20gQUdcclxuICogQ29weXJpZ2h0IDIwMTYgQXBpemVlXHJcbiAqIENvcHlyaWdodCAyMDE2IFRFQ0hOSVNDSEUgVU5JVkVSU0lUQVQgQkVSTElOXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbiAqXHJcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuICoqL1xyXG5cclxuLyoqXHJcbiAqIENyZWF0ZWQgYnkgYW1vIG9uIDE0LzExLzIwMTUuXHJcbiAqL1xyXG5cclxuaW1wb3J0IENhdGFsb2d1ZURhdGFPYmplY3QgZnJvbSBcIi4vQ2F0YWxvZ3VlRGF0YU9iamVjdFwiO1xyXG5cclxuY2xhc3MgUHJvdG9jb2xTdHViRGVzY3JpcHRvciBleHRlbmRzIENhdGFsb2d1ZURhdGFPYmplY3Qge1xyXG4gICAgY29uc3RydWN0b3IoZ3VpZCwgdHlwZSwgdmVyc2lvbiwgb2JqZWN0TmFtZSwgZGVzY3JpcHRpb24sIGxhbmd1YWdlLCBzb3VyY2VQYWNrYWdlVVJMLCBtZXNzYWdlU2NoZW1hcywgY29uZmlndXJhdGlvbixcclxuICAgICAgICAgICAgICAgIGNvbnN0cmFpbnRzLCBoeXBlcnR5VHlwZSwgZGF0YU9iamVjdHMsIGludGVyd29ya2luZywgaWRwUHJveHksIG11dHVhbEF1dGhlbnRpY2F0aW9uKSB7XHJcbiAgICAgICAgc3VwZXIoZ3VpZCwgdHlwZSwgdmVyc2lvbiwgb2JqZWN0TmFtZSwgZGVzY3JpcHRpb24sIGxhbmd1YWdlLCBzb3VyY2VQYWNrYWdlVVJMKTtcclxuXHJcbiAgICAgICAgdGhpcy5fbWVzc2FnZVNjaGVtYXMgPSBtZXNzYWdlU2NoZW1hcztcclxuXHJcbiAgICAgICAgaWYgKGNvbmZpZ3VyYXRpb24pXHJcbiAgICAgICAgICAgIHRoaXMuX2NvbmZpZ3VyYXRpb24gPSBjb25maWd1cmF0aW9uO1xyXG4gICAgICAgIGVsc2VcclxuICAgICAgICAgICAgdGhpcy5fY29uZmlndXJhdGlvbiA9IHt9O1xyXG5cclxuICAgICAgICBpZiAoY29uc3RyYWludHMpXHJcbiAgICAgICAgICAgIHRoaXMuX2NvbnN0cmFpbnRzID0gY29uc3RyYWludHM7XHJcbiAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICB0aGlzLl9jb25zdHJhaW50cyA9IHt9O1xyXG5cclxuICAgICAgICB0aGlzLl9oeXBlcnR5VHlwZSA9IGh5cGVydHlUeXBlO1xyXG5cclxuICAgICAgICBpZiAoZGF0YU9iamVjdHMpXHJcbiAgICAgICAgICAgIHRoaXMuX2RhdGFPYmplY3RzID0gZGF0YU9iamVjdHM7XHJcbiAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICB0aGlzLl9kYXRhT2JqZWN0cyA9IFtdO1xyXG4gICAgICAgIFxyXG4gICAgICAgIHRoaXMuX2ludGVyd29ya2luZyA9IGludGVyd29ya2luZztcclxuICAgICAgICB0aGlzLl9pZHBQcm94eSA9IGlkcFByb3h5O1xyXG4gICAgICAgIHRoaXMuX211dHVhbEF1dGhlbnRpY2F0aW9uID0gbXV0dWFsQXV0aGVudGljYXRpb247XHJcblxyXG4gICAgfVxyXG5cclxuICAgIGdldCBtZXNzYWdlU2NoZW1hcygpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fbWVzc2FnZVNjaGVtYXM7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0IGNvbnN0cmFpbnRzKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9jb25zdHJhaW50cztcclxuICAgIH1cclxuXHJcbiAgICBnZXQgY29uZmlndXJhdGlvbigpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fY29uZmlndXJhdGlvbjtcclxuICAgIH1cclxuXHJcbiAgICBzZXQgbWVzc2FnZVNjaGVtYXMobWVzc2FnZVNjaGVtYXMpIHtcclxuICAgICAgICBpZiAobWVzc2FnZVNjaGVtYXMpXHJcbiAgICAgICAgICAgIHRoaXMuX21lc3NhZ2VTY2hlbWFzID0gbWVzc2FnZVNjaGVtYXM7XHJcbiAgICB9XHJcblxyXG4gICAgc2V0IGNvbnN0cmFpbnRzKGNvbnN0cmFpbnRzKSB7XHJcbiAgICAgICAgaWYgKGNvbnN0cmFpbnRzKVxyXG4gICAgICAgICAgICB0aGlzLl9jb25zdHJhaW50cyA9IGNvbnN0cmFpbnRzO1xyXG4gICAgfVxyXG5cclxuICAgIHNldCBjb25maWd1cmF0aW9uKGNvbmZpZ3VyYXRpb24pIHtcclxuICAgICAgICBpZiAoY29uZmlndXJhdGlvbilcclxuICAgICAgICAgICAgdGhpcy5fY29uZmlndXJhdGlvbiA9IGNvbmZpZ3VyYXRpb247XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0IGh5cGVydHlUeXBlKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9oeXBlcnR5VHlwZTtcclxuICAgIH1cclxuXHJcbiAgICBzZXQgaHlwZXJ0eVR5cGUodmFsdWUpIHtcclxuICAgICAgICB0aGlzLl9oeXBlcnR5VHlwZSA9IHZhbHVlO1xyXG4gICAgfVxyXG5cclxuICAgIGdldCBkYXRhT2JqZWN0cygpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fZGF0YU9iamVjdHM7XHJcbiAgICB9XHJcblxyXG4gICAgc2V0IGRhdGFPYmplY3RzKHZhbHVlKSB7XHJcbiAgICAgICAgdGhpcy5fZGF0YU9iamVjdHMgPSB2YWx1ZTtcclxuICAgIH1cclxuXHJcbiAgICBnZXQgaW50ZXJ3b3JraW5nKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9pbnRlcndvcmtpbmc7XHJcbiAgICB9XHJcblxyXG4gICAgc2V0IGludGVyd29ya2luZyh2YWx1ZSkge1xyXG4gICAgICAgIHRoaXMuX2ludGVyd29ya2luZyA9IHZhbHVlO1xyXG4gICAgfVxyXG5cclxuICAgIGdldCBpZHBQcm94eSgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5faWRwUHJveHk7XHJcbiAgICB9XHJcblxyXG4gICAgc2V0IGlkcFByb3h5KHZhbHVlKSB7XHJcbiAgICAgICAgdGhpcy5faWRwUHJveHkgPSB2YWx1ZTtcclxuICAgIH1cclxuXHJcbiAgICBnZXQgbXV0dWFsQXV0aGVudGljYXRpb24oKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX211dHVhbEF1dGhlbnRpY2F0aW9uO1xyXG4gICAgfVxyXG5cclxuICAgIHNldCBtdXR1YWxBdXRoZW50aWNhdGlvbih2YWx1ZSkge1xyXG4gICAgICAgIHRoaXMuX211dHVhbEF1dGhlbnRpY2F0aW9uID0gdmFsdWU7XHJcbiAgICB9XHJcbn1cclxuXHJcbmV4cG9ydCBkZWZhdWx0IFByb3RvY29sU3R1YkRlc2NyaXB0b3I7IiwiLyoqXHJcbiAqIENvcHlyaWdodCAyMDE2IFBUIElub3Zhw6fDo28gZSBTaXN0ZW1hcyBTQVxyXG4gKiBDb3B5cmlnaHQgMjAxNiBJTkVTQy1JRFxyXG4gKiBDb3B5cmlnaHQgMjAxNiBRVU9CSVMgTkVUV09SS1MgU0xcclxuICogQ29weXJpZ2h0IDIwMTYgRlJBVU5IT0ZFUi1HRVNFTExTQ0hBRlQgWlVSIEZPRVJERVJVTkcgREVSIEFOR0VXQU5EVEVOIEZPUlNDSFVORyBFLlZcclxuICogQ29weXJpZ2h0IDIwMTYgT1JBTkdFIFNBXHJcbiAqIENvcHlyaWdodCAyMDE2IERldXRzY2hlIFRlbGVrb20gQUdcclxuICogQ29weXJpZ2h0IDIwMTYgQXBpemVlXHJcbiAqIENvcHlyaWdodCAyMDE2IFRFQ0hOSVNDSEUgVU5JVkVSU0lUQVQgQkVSTElOXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbiAqXHJcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuICoqL1xyXG5cclxuLyoqXHJcbiAqIENyZWF0ZWQgYnkgYW1vIG9uIDE0LzExLzIwMTUuXHJcbiAqL1xyXG5cclxuaW1wb3J0IENhdGFsb2d1ZURhdGFPYmplY3QgZnJvbSBcIi4vQ2F0YWxvZ3VlRGF0YU9iamVjdFwiO1xyXG5cclxuY2xhc3MgSHlwZXJ0eVJ1bnRpbWVEZXNjcmlwdG9yIGV4dGVuZHMgQ2F0YWxvZ3VlRGF0YU9iamVjdCB7XHJcblxyXG4gICAgY29uc3RydWN0b3IoZ3VpZCwgY2F0YWxvZ3VlVHlwZSwgdmVyc2lvbiwgb2JqZWN0TmFtZSwgZGVzY3JpcHRpb24sIGxhbmd1YWdlLCBzb3VyY2VQYWNrYWdlVVJMLCBydW50aW1lVHlwZSxcclxuICAgICAgICAgICAgICAgIGh5cGVydHlDYXBhYmlsaXRpZXMsIHByb3RvY29sQ2FwYWJpbGl0aWVzLCBwMnBIYW5kbGVyU3R1YiwgcDJwUmVxdWVzdGVyU3R1Yikge1xyXG4gICAgICAgIHN1cGVyKGd1aWQsIGNhdGFsb2d1ZVR5cGUsIHZlcnNpb24sIG9iamVjdE5hbWUsIGRlc2NyaXB0aW9uLCBsYW5ndWFnZSwgc291cmNlUGFja2FnZVVSTCk7XHJcblxyXG4gICAgICAgIHRoaXMuX3J1bnRpbWVUeXBlID0gcnVudGltZVR5cGU7XHJcblxyXG4gICAgICAgIGlmIChoeXBlcnR5Q2FwYWJpbGl0aWVzKVxyXG4gICAgICAgICAgICB0aGlzLl9oeXBlcnR5Q2FwYWJpbGl0aWVzID0gaHlwZXJ0eUNhcGFiaWxpdGllcztcclxuICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgIHRoaXMuX2h5cGVydHlDYXBhYmlsaXRpZXMgPSBuZXcgUnVudGltZUh5cGVydHlDYXBhYmlsaXR5KHRydWUsIGZhbHNlLCBmYWxzZSwgZmFsc2UsIGZhbHNlKTtcclxuICAgICAgICBpZiAocHJvdG9jb2xDYXBhYmlsaXRpZXMpXHJcbiAgICAgICAgICAgIHRoaXMuX3Byb3RvY29sQ2FwYWJpbGl0aWVzID0gcHJvdG9jb2xDYXBhYmlsaXRpZXM7XHJcbiAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICB0aGlzLl9wcm90b2NvbENhcGFiaWxpdGllcyA9IG5ldyBSdW50aW1lUHJvdG9jb2xDYXBhYmlsaXR5KHRydWUsIGZhbHNlLCB0cnVlLCBmYWxzZSwgZmFsc2UsIGZhbHNlKTtcclxuXHJcbiAgICAgICAgdGhpcy5fcDJwSGFuZGxlclN0dWIgPSBwMnBIYW5kbGVyU3R1YjtcclxuICAgICAgICB0aGlzLl9wMnBSZXF1ZXN0ZXJTdHViID0gcDJwUmVxdWVzdGVyU3R1YjtcclxuICAgIH1cclxuXHJcbiAgICBnZXQgcnVudGltZVR5cGUoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX3J1bnRpbWVUeXBlO1xyXG4gICAgfVxyXG5cclxuICAgIGdldCBoeXBlcnR5Q2FwYWJpbGl0aWVzKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9oeXBlcnR5Q2FwYWJpbGl0aWVzO1xyXG4gICAgfVxyXG5cclxuICAgIGdldCBwcm90b2NvbENhcGFiaWxpdGllcygpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5faHlwZXJ0eUNhcGFiaWxpdGllcztcclxuICAgIH1cclxuXHJcbiAgICBzZXQgcnVudGltZVR5cGUocnVudGltZVR5cGUpIHtcclxuICAgICAgICBpZiAocnVudGltZVR5cGUpXHJcbiAgICAgICAgICAgIHRoaXMuX3J1bnRpbWVUeXBlID0gcnVudGltZVR5cGU7XHJcbiAgICB9XHJcblxyXG4gICAgc2V0IGh5cGVydHlDYXBhYmlsaXRpZXMoaHlwZXJ0eUNhcGFiaWxpdGllcykge1xyXG4gICAgICAgIGlmIChoeXBlcnR5Q2FwYWJpbGl0aWVzKVxyXG4gICAgICAgICAgICB0aGlzLl9oeXBlcnR5Q2FwYWJpbGl0aWVzID0gaHlwZXJ0eUNhcGFiaWxpdGllcztcclxuICAgIH1cclxuXHJcbiAgICBzZXQgcHJvdG9jb2xDYXBhYmlsaXRpZXMocHJvdG9jb2xDYXBhYmlsaXRpZXMpIHtcclxuICAgICAgICBpZiAocHJvdG9jb2xDYXBhYmlsaXRpZXMpXHJcbiAgICAgICAgICAgIHRoaXMuX3Byb3RvY29sQ2FwYWJpbGl0aWVzID0gcHJvdG9jb2xDYXBhYmlsaXRpZXM7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0IHAycEhhbmRsZXJTdHViKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9wMnBIYW5kbGVyU3R1YjtcclxuICAgIH1cclxuXHJcbiAgICBzZXQgcDJwSGFuZGxlclN0dWIodmFsdWUpIHtcclxuICAgICAgICB0aGlzLl9wMnBIYW5kbGVyU3R1YiA9IHZhbHVlO1xyXG4gICAgfVxyXG5cclxuICAgIGdldCBwMnBSZXF1ZXN0ZXJTdHViKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9wMnBSZXF1ZXN0ZXJTdHViO1xyXG4gICAgfVxyXG5cclxuICAgIHNldCBwMnBSZXF1ZXN0ZXJTdHViKHZhbHVlKSB7XHJcbiAgICAgICAgdGhpcy5fcDJwUmVxdWVzdGVyU3R1YiA9IHZhbHVlO1xyXG4gICAgfVxyXG59XHJcblxyXG4vKipcclxuICogQSBjbGFzcyByZXByZXNlbnRhdGlvbiBvZiB0aGUgY2FwYWJpbGl0eSBzZXQgb2YgdGhlIFJ1bnRpbWUgSHlwZXJ0eVxyXG4gKi9cclxuZXhwb3J0IGNsYXNzIFJ1bnRpbWVIeXBlcnR5Q2FwYWJpbGl0eSB7XHJcbiAgICAvKipcclxuICAgICAqIENyZWF0ZXMgYW4gb2JqZWN0IG9mIHRoZSBSdW50aW1lIEh5cGVydHkgY2FwYWJpbGl0eSBzZXRcclxuICAgICAqIEBwYXJhbSB7Ym9vbGVhbn0gaXNXZWJSVENTdXBwb3J0ZWRcclxuICAgICAqIEBwYXJhbSB7Ym9vbGVhbn0gaXNNaWNTdXBwb3J0ZWRcclxuICAgICAqIEBwYXJhbSB7Ym9vbGVhbn0gaXNDYW1lcmFTdXBwb3J0ZWRcclxuICAgICAqIEBwYXJhbSB7Ym9vbGVhbn0gaXNTZW5zb3JTdXBwb3J0ZWRcclxuICAgICAqIEBwYXJhbSB7Ym9vbGVhbn0gaXNPUlRDU3VwcG9ydGVkXHJcbiAgICAgKi9cclxuICAgIGNvbnN0cnVjdG9yKGlzV2ViUlRDU3VwcG9ydGVkLCBpc01pY1N1cHBvcnRlZCwgaXNDYW1lcmFTdXBwb3J0ZWQsIGlzU2Vuc29yU3VwcG9ydGVkLCBpc09SVENTdXBwb3J0ZWQpIHtcclxuICAgICAgICB0aGlzLl9pc1dlYlJUQyA9IGlzV2ViUlRDU3VwcG9ydGVkO1xyXG4gICAgICAgIHRoaXMuX2lzTWljID0gaXNNaWNTdXBwb3J0ZWQ7XHJcbiAgICAgICAgdGhpcy5faXNDYW1lcmEgPSBpc0NhbWVyYVN1cHBvcnRlZDtcclxuICAgICAgICB0aGlzLl9pc1NlbnNvciA9IGlzU2Vuc29yU3VwcG9ydGVkO1xyXG4gICAgICAgIHRoaXMuX2lzT1JUQyA9IGlzT1JUQ1N1cHBvcnRlZDtcclxuICAgIH1cclxuXHJcbiAgICBnZXQgaXNNaWMoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2lzTWljO1xyXG4gICAgfVxyXG5cclxuICAgIGdldCBpc0NhbWVyYSgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5faXNDYW1lcmE7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0IGlzU2Vuc29yKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9pc1NlbnNvcjtcclxuICAgIH1cclxuXHJcbiAgICBnZXQgaXNXZWJSVEMoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2lzV2ViUlRDO1xyXG4gICAgfVxyXG5cclxuICAgIGdldCBpc09SVENTKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9pc09SVEM7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0Q2FwYWJpbGl0eVNldCgpIHtcclxuICAgICAgICByZXR1cm4gSlNPTi5zdHJpbmdpZnkodGhpcyk7XHJcbiAgICB9XHJcbn1cclxuXHJcblxyXG4vKipcclxuICogQSBjbGFzcyByZXByZXNlbnRhdGlvbiBvZiB0aGUgcHJvdG9jb2wgY2FwYWJpbGl0eSBzZXQgb2YgdGhlIFJ1bnRpbWUgSHlwZXJ0eVxyXG4gKi9cclxuZXhwb3J0IGNsYXNzIFJ1bnRpbWVQcm90b2NvbENhcGFiaWxpdHkge1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogQ3JlYXRlcyBhbiBvYmplY3Qgb2YgdGhlIHJ1bnRpbWUgcHJvdG9jb2wgY2FwYWJpbGl0eVxyXG4gICAgICogQHBhcmFtIHtib29sZWFufSBpc0h0dHBcclxuICAgICAqIEBwYXJhbSB7Ym9vbGVhbn0gaXNIdHRwc1xyXG4gICAgICogQHBhcmFtIHtib29sZWFufSBpc1dTXHJcbiAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IGlzV1NTXHJcbiAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IGlzQ29hcFxyXG4gICAgICogQHBhcmFtIHtib29sZWFufSBpc0RhdGFDaGFubmVsXHJcbiAgICAgKi9cclxuICAgIGNvbnN0cnVjdG9yKGlzSHR0cCwgaXNIdHRwcywgaXNXUywgaXNXU1MsIGlzQ29hcCwgaXNEYXRhQ2hhbm5lbCkge1xyXG4gICAgICAgIHRoaXMuX2lzSHR0cCA9IGlzSHR0cDtcclxuICAgICAgICB0aGlzLl9pc0h0dHBzID0gaXNIdHRwcztcclxuICAgICAgICB0aGlzLl9pc1dTID0gaXNXUztcclxuICAgICAgICB0aGlzLl9pc1dTUyA9IGlzV1NTO1xyXG4gICAgICAgIHRoaXMuX2lzQ29hcCA9IGlzQ29hcDtcclxuICAgICAgICB0aGlzLl9pc0RhdGFDaGFubmVsID0gaXNEYXRhQ2hhbm5lbDtcclxuICAgIH1cclxuXHJcbiAgICBpc0h0dHAoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2lzSHR0cDtcclxuICAgIH1cclxuXHJcbiAgICBpc0h0dHBzKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9pc0h0dHBzO1xyXG4gICAgfVxyXG5cclxuICAgIGlzV1MoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2lzV1M7XHJcbiAgICB9XHJcblxyXG4gICAgaXNTZW5zb3JTdXBwb3J0ZWQoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2lzU2Vuc29yO1xyXG4gICAgfVxyXG5cclxuICAgIGlzV1NTKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9pc1dTUztcclxuICAgIH1cclxuXHJcbiAgICBpc0NvYXAoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2lzQ29hcDtcclxuICAgIH1cclxuXHJcbiAgICBpc0RhdGFDaGFubmVsKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9pc0RhdGFDaGFubmVsO1xyXG4gICAgfVxyXG5cclxuXHJcbiAgICBnZXRDYXBhYmlsaXR5U2V0KCkge1xyXG4gICAgICAgIHJldHVybiBKU09OLnN0cmluZ2lmeSh0aGlzKTtcclxuICAgIH1cclxufVxyXG5cclxuZXhwb3J0IGNvbnN0IFJ1bnRpbWVUeXBlID0ge0JST1dTRVI6ICdicm93c2VyJywgU1RBTkRBTE9ORTogJ3N0YW5kYWxvbmUnLCBTRVJWRVI6ICdzZXJ2ZXInLCBHQVRFV0FZOiAnZ2F0ZXdheSd9O1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgSHlwZXJ0eVJ1bnRpbWVEZXNjcmlwdG9yO1xyXG4iLCIvKipcclxuKiBDb3B5cmlnaHQgMjAxNiBQVCBJbm92YcOnw6NvIGUgU2lzdGVtYXMgU0FcclxuKiBDb3B5cmlnaHQgMjAxNiBJTkVTQy1JRFxyXG4qIENvcHlyaWdodCAyMDE2IFFVT0JJUyBORVRXT1JLUyBTTFxyXG4qIENvcHlyaWdodCAyMDE2IEZSQVVOSE9GRVItR0VTRUxMU0NIQUZUIFpVUiBGT0VSREVSVU5HIERFUiBBTkdFV0FORFRFTiBGT1JTQ0hVTkcgRS5WXHJcbiogQ29weXJpZ2h0IDIwMTYgT1JBTkdFIFNBXHJcbiogQ29weXJpZ2h0IDIwMTYgRGV1dHNjaGUgVGVsZWtvbSBBR1xyXG4qIENvcHlyaWdodCAyMDE2IEFwaXplZVxyXG4qIENvcHlyaWdodCAyMDE2IFRFQ0hOSVNDSEUgVU5JVkVSU0lUQVQgQkVSTElOXHJcbipcclxuKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4qIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuKlxyXG4qICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbipcclxuKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4qIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4qIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuKiovXHJcblxyXG4vKipcclxuICogQ3JlYXRlZCBieSBwenUgb24gMTkuMTEuMTUuXHJcbiAqL1xyXG5pbXBvcnQgQ2F0YWxvZ3VlRGF0YU9iamVjdCBmcm9tICcuL0NhdGFsb2d1ZURhdGFPYmplY3QnO1xyXG5cclxuY2xhc3MgUG9saWN5RW5mb3JjZXJEZXNjcmlwdG9yIGV4dGVuZHMgQ2F0YWxvZ3VlRGF0YU9iamVjdCB7XHJcbiAgICBjb25zdHJ1Y3RvcihndWlkLCB0eXBlLCB2ZXJzaW9uLCBvYmplY3ROYW1lLCBkZXNjcmlwdGlvbiwgbGFuZ3VhZ2UsIHNvdXJjZVBhY2thZ2VVUkwsIGNvbmZpZ3VyYXRpb24sIHBvbGljaWVzKSB7XHJcbiAgICAgICAgc3VwZXIoZ3VpZCwgdHlwZSwgdmVyc2lvbiwgb2JqZWN0TmFtZSwgZGVzY3JpcHRpb24sIGxhbmd1YWdlLCBzb3VyY2VQYWNrYWdlVVJMKTtcclxuXHJcbiAgICAgICAgdGhpcy5fY29uZmlndXJhdGlvbiA9IGNvbmZpZ3VyYXRpb247XHJcbiAgICAgICAgdGhpcy5fcG9saWNpZXMgPSBwb2xpY2llcztcclxuICAgIH1cclxuXHJcbiAgICBnZXQgY29uZmlndXJhdGlvbigpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fY29uZmlndXJhdGlvbjtcclxuICAgIH1cclxuXHJcbiAgICBnZXQgcG9saWNpZXMoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX3BvbGljaWVzO1xyXG4gICAgfVxyXG5cclxuICAgIHNldCBwb2xpY2llcyhwb2xpY2llcykge1xyXG4gICAgICAgIHRoaXMuX3BvbGljaWVzID0gcG9saWNpZXM7XHJcbiAgICB9XHJcblxyXG4gICAgc2V0IGNvbmZpZ3VyYXRpb24oY29uZmlndXJhdGlvbikge1xyXG4gICAgICAgIHRoaXMuX2NvbmZpZ3VyYXRpb24gPSBjb25maWd1cmF0aW9uO1xyXG4gICAgfVxyXG59XHJcblxyXG5leHBvcnQgZGVmYXVsdCBQb2xpY3lFbmZvcmNlckRlc2NyaXB0b3I7IiwiLyoqXHJcbiogQ29weXJpZ2h0IDIwMTYgUFQgSW5vdmHDp8OjbyBlIFNpc3RlbWFzIFNBXHJcbiogQ29weXJpZ2h0IDIwMTYgSU5FU0MtSURcclxuKiBDb3B5cmlnaHQgMjAxNiBRVU9CSVMgTkVUV09SS1MgU0xcclxuKiBDb3B5cmlnaHQgMjAxNiBGUkFVTkhPRkVSLUdFU0VMTFNDSEFGVCBaVVIgRk9FUkRFUlVORyBERVIgQU5HRVdBTkRURU4gRk9SU0NIVU5HIEUuVlxyXG4qIENvcHlyaWdodCAyMDE2IE9SQU5HRSBTQVxyXG4qIENvcHlyaWdodCAyMDE2IERldXRzY2hlIFRlbGVrb20gQUdcclxuKiBDb3B5cmlnaHQgMjAxNiBBcGl6ZWVcclxuKiBDb3B5cmlnaHQgMjAxNiBURUNITklTQ0hFIFVOSVZFUlNJVEFUIEJFUkxJTlxyXG4qXHJcbiogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbipcclxuKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4qXHJcbiogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4qIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbioqL1xyXG5cclxuLyoqXHJcbiAqIENyZWF0ZWQgYnkgcHp1IG9uIDE5LjExLjE1LlxyXG4gKi9cclxuXHJcbmltcG9ydCBDYXRhbG9ndWVEYXRhT2JqZWN0IGZyb20gJy4vQ2F0YWxvZ3VlRGF0YU9iamVjdCc7XHJcblxyXG5leHBvcnQgY2xhc3MgRGF0YU9iamVjdFNjaGVtYSBleHRlbmRzIENhdGFsb2d1ZURhdGFPYmplY3Qge1xyXG4gICAgY29uc3RydWN0b3IoZ3VpZCwgdHlwZSwgdmVyc2lvbiwgb2JqZWN0TmFtZSwgZGVzY3JpcHRpb24sIGxhbmd1YWdlLCBzb3VyY2VQYWNrYWdlVVJMKSB7XHJcbiAgICAgICAgc3VwZXIoZ3VpZCwgdHlwZSwgdmVyc2lvbiwgb2JqZWN0TmFtZSwgZGVzY3JpcHRpb24sIGxhbmd1YWdlLCBzb3VyY2VQYWNrYWdlVVJMKTtcclxuICAgIH1cclxuXHJcbn1cclxuXHJcblxyXG4vL0NoaWxkcmVuXHJcbmV4cG9ydCBjbGFzcyBNZXNzYWdlRGF0YU9iamVjdFNjaGVtYSBleHRlbmRzIERhdGFPYmplY3RTY2hlbWEge1xyXG4gICAgY29uc3RydWN0b3IoZ3VpZCwgdHlwZSwgdmVyc2lvbiwgb2JqZWN0TmFtZSwgZGVzY3JpcHRpb24sIGxhbmd1YWdlLCBzb3VyY2VQYWNrYWdlVVJMKSB7XHJcbiAgICAgICAgc3VwZXIoZ3VpZCwgdHlwZSwgdmVyc2lvbiwgb2JqZWN0TmFtZSwgZGVzY3JpcHRpb24sIGxhbmd1YWdlLCBzb3VyY2VQYWNrYWdlVVJMKTtcclxuICAgIH1cclxufVxyXG5cclxuZXhwb3J0IGNsYXNzIEh5cGVydHlEYXRhT2JqZWN0U2NoZW1hIGV4dGVuZHMgRGF0YU9iamVjdFNjaGVtYSB7XHJcbiAgICBjb25zdHJ1Y3RvcihndWlkLCB0eXBlLCB2ZXJzaW9uLCBvYmplY3ROYW1lLCBkZXNjcmlwdGlvbiwgbGFuZ3VhZ2UsIHNvdXJjZVBhY2thZ2VVUkwsIGFjY2Vzc0NvbnRyb2xQb2xpY3ksIGRhdGFVcmxTY2hlbWUpIHtcclxuICAgICAgICBzdXBlcihndWlkLCB0eXBlLCB2ZXJzaW9uLCBvYmplY3ROYW1lLCBkZXNjcmlwdGlvbiwgbGFuZ3VhZ2UsIHNvdXJjZVBhY2thZ2VVUkwpO1xyXG4gICAgICAgIHRoaXMuX2FjY2Vzc0NvbnRyb2xQb2xpY3kgPSBhY2Nlc3NDb250cm9sUG9saWN5O1xyXG4gICAgICAgIHRoaXMuX3NjaGVtZSA9IGRhdGFVcmxTY2hlbWU7XHJcbiAgICB9XHJcbn1cclxuXHJcbi8vQ2hpbGRyZW5cclxuZXhwb3J0IGNsYXNzIENvbW11bmljYXRpb25EYXRhT2JqZWN0U2NoZW1hIGV4dGVuZHMgSHlwZXJ0eURhdGFPYmplY3RTY2hlbWEge1xyXG4gICAgY29uc3RydWN0b3IoZ3VpZCwgdHlwZSwgdmVyc2lvbiwgb2JqZWN0TmFtZSwgZGVzY3JpcHRpb24sIGxhbmd1YWdlLCBzb3VyY2VQYWNrYWdlVVJMLCBhY2Nlc3NDb250cm9sUG9saWN5KSB7XHJcbiAgICAgICAgc3VwZXIoZ3VpZCwgdHlwZSwgdmVyc2lvbiwgb2JqZWN0TmFtZSwgZGVzY3JpcHRpb24sIGxhbmd1YWdlLCBzb3VyY2VQYWNrYWdlVVJMLCBhY2Nlc3NDb250cm9sUG9saWN5KTtcclxuICAgIH1cclxufVxyXG5cclxuZXhwb3J0IGNsYXNzIENvbm5lY3Rpb25EYXRhT2JqZWN0U2NoZW1hIGV4dGVuZHMgSHlwZXJ0eURhdGFPYmplY3RTY2hlbWEge1xyXG4gICAgY29uc3RydWN0b3IoZ3VpZCwgdHlwZSwgdmVyc2lvbiwgb2JqZWN0TmFtZSwgZGVzY3JpcHRpb24sIGxhbmd1YWdlLCBzb3VyY2VQYWNrYWdlVVJMLCBhY2Nlc3NDb250cm9sUG9saWN5KSB7XHJcbiAgICAgICAgc3VwZXIoZ3VpZCwgdHlwZSwgdmVyc2lvbiwgb2JqZWN0TmFtZSwgZGVzY3JpcHRpb24sIGxhbmd1YWdlLCBzb3VyY2VQYWNrYWdlVVJMLCBhY2Nlc3NDb250cm9sUG9saWN5KTtcclxuICAgIH1cclxufVxyXG5cclxuZXhwb3J0IGNsYXNzIElkZW50aXR5RGF0YU9iamVjdFNjaGVtYSBleHRlbmRzIEh5cGVydHlEYXRhT2JqZWN0U2NoZW1hIHtcclxuICAgIGNvbnN0cnVjdG9yKGd1aWQsIHR5cGUsIHZlcnNpb24sIG9iamVjdE5hbWUsIGRlc2NyaXB0aW9uLCBsYW5ndWFnZSwgc291cmNlUGFja2FnZVVSTCwgYWNjZXNzQ29udHJvbFBvbGljeSkge1xyXG4gICAgICAgIHN1cGVyKGd1aWQsIHR5cGUsIHZlcnNpb24sIG9iamVjdE5hbWUsIGRlc2NyaXB0aW9uLCBsYW5ndWFnZSwgc291cmNlUGFja2FnZVVSTCwgYWNjZXNzQ29udHJvbFBvbGljeSk7XHJcbiAgICB9XHJcbn1cclxuXHJcbmV4cG9ydCBjbGFzcyBDb250ZXh0RGF0YU9iamVjdFNjaGVtYSBleHRlbmRzIEh5cGVydHlEYXRhT2JqZWN0U2NoZW1hIHtcclxuICAgIGNvbnN0cnVjdG9yKGd1aWQsIHR5cGUsIHZlcnNpb24sIG9iamVjdE5hbWUsIGRlc2NyaXB0aW9uLCBsYW5ndWFnZSwgc291cmNlUGFja2FnZVVSTCwgYWNjZXNzQ29udHJvbFBvbGljeSkge1xyXG4gICAgICAgIHN1cGVyKGd1aWQsIHR5cGUsIHZlcnNpb24sIG9iamVjdE5hbWUsIGRlc2NyaXB0aW9uLCBsYW5ndWFnZSwgc291cmNlUGFja2FnZVVSTCwgYWNjZXNzQ29udHJvbFBvbGljeSk7XHJcbiAgICB9XHJcbn1cclxuXHJcbmV4cG9ydCBjb25zdCBEYXRhVXJsU2NoZW1lID0ge1xyXG4gICAgQ09NTTogJ0NPTU0nLCBDT05ORUNUSU9OOiAnQ09OTkVDVElPTicsIENUWFQ6ICdDVFhUJywgSURFTlRJVFk6ICdJREVOVElUWSdcclxufTtcclxuXHJcbmV4cG9ydCBkZWZhdWx0IERhdGFPYmplY3RTY2hlbWE7IiwiLyoqXHJcbiAqIENvcHlyaWdodCAyMDE2IFBUIElub3Zhw6fDo28gZSBTaXN0ZW1hcyBTQVxyXG4gKiBDb3B5cmlnaHQgMjAxNiBJTkVTQy1JRFxyXG4gKiBDb3B5cmlnaHQgMjAxNiBRVU9CSVMgTkVUV09SS1MgU0xcclxuICogQ29weXJpZ2h0IDIwMTYgRlJBVU5IT0ZFUi1HRVNFTExTQ0hBRlQgWlVSIEZPRVJERVJVTkcgREVSIEFOR0VXQU5EVEVOIEZPUlNDSFVORyBFLlZcclxuICogQ29weXJpZ2h0IDIwMTYgT1JBTkdFIFNBXHJcbiAqIENvcHlyaWdodCAyMDE2IERldXRzY2hlIFRlbGVrb20gQUdcclxuICogQ29weXJpZ2h0IDIwMTYgQXBpemVlXHJcbiAqIENvcHlyaWdodCAyMDE2IFRFQ0hOSVNDSEUgVU5JVkVSU0lUQVQgQkVSTElOXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbiAqXHJcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuICoqL1xyXG5cclxuaW1wb3J0IENhdGFsb2d1ZURhdGFPYmplY3QsIHtDYXRhbG9ndWVPYmplY3RUeXBlLCBEYXRhT2JqZWN0U291cmNlTGFuZ3VhZ2V9IGZyb20gXCIuL0NhdGFsb2d1ZURhdGFPYmplY3RcIjtcclxuaW1wb3J0IFNvdXJjZVBhY2thZ2UgZnJvbSBcIi4vU291cmNlUGFja2FnZVwiO1xyXG5pbXBvcnQgSHlwZXJ0eURlc2NyaXB0b3IgZnJvbSBcIi4vSHlwZXJ0eURlc2NyaXB0b3JcIjtcclxuaW1wb3J0IFByb3RvY29sU3R1YkRlc2NyaXB0b3IgZnJvbSBcIi4vUHJvdG9jb2xTdHViRGVzY3JpcHRvclwiO1xyXG5pbXBvcnQgSHlwZXJ0eVJ1bnRpbWVEZXNjcmlwdG9yLCB7UnVudGltZVR5cGV9IGZyb20gXCIuL0h5cGVydHlSdW50aW1lRGVzY3JpcHRvclwiO1xyXG5pbXBvcnQgSHlwZXJ0eUludGVyY2VwdG9yRGVzY3JpcHRvciBmcm9tIFwiLi9IeXBlcnR5SW50ZXJjZXB0b3JEZXNjcmlwdG9yXCI7XHJcbmltcG9ydCB7XHJcbiAgICBEYXRhT2JqZWN0U2NoZW1hLFxyXG4gICAgRGF0YVVybFNjaGVtZSxcclxuICAgIENvbW11bmljYXRpb25EYXRhT2JqZWN0U2NoZW1hLFxyXG4gICAgQ29ubmVjdGlvbkRhdGFPYmplY3RTY2hlbWEsXHJcbiAgICBDb250ZXh0RGF0YU9iamVjdFNjaGVtYSxcclxuICAgIElkZW50aXR5RGF0YU9iamVjdFNjaGVtYVxyXG59IGZyb20gXCIuL0RhdGFPYmplY3RTY2hlbWFcIjtcclxuXHJcbmNsYXNzIENhdGFsb2d1ZURhdGFPYmplY3RGYWN0b3J5IHtcclxuXHJcbiAgICAvKipcclxuICAgICAqIENyZWF0ZSBDYXRhbG9ndWVEYXRhT2JqZWN0XHJcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gZ3VpZCAtIENhdGFsb2d1ZSBHbG9iYWwgVW5pcXVlIGlkZW50aWZpZXIgb2YgdGhlIENhdGFsb2d1ZSBPYmplY3RcclxuICAgICAqIEBwYXJhbSB7Q2F0YWxvZ3VlT2JqZWN0VHlwZX0gdHlwZSAtIEluZGljYXRlcyB0aGUgdHlwZSBvZiBDYXRhbG9ndWUgRGF0YSBPYmplY3RcclxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSB2ZXJzaW9uIC0gSW5kaWNhdGVzIHRoZSB2ZXJzaW9uIG9mIENhdGFsb2d1ZSBEYXRhXHJcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gb2JqZWN0TmFtZSAtIEh1bWFuLXVuZGVyc3RhbmRhYmxlIG5hbWUgb2YgdGhlIGNhdGFsb2d1ZSBvYmplY3RcclxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBkZXNjcmlwdGlvblxyXG4gICAgICogQHBhcmFtIHtEYXRhT2JqZWN0U291cmNlTGFuZ3VhZ2V9IGxhbmd1YWdlIC0gUHJvZ3JhbW1pbmcgbGFuZ3VhZ2UgdXNlZCBpbiB0aGUgU291cmNlUGFja2FnZVxyXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IHNvdXJjZVBhY2thZ2VVUkwgLSBVUkwgZnJvbSB3aGVyZSB0aGUgc291cmNlIGNvZGUgcGFja2FnZSBvZiB0aGUgY29ycmVzcG9uZGluZyBjYXRhbG9ndWUgb2JqZWN0IGNhbiBiZSBkb3dubG9hZGVkLlxyXG4gICAgICogQHJldHVybnMge0NhdGFsb2d1ZURhdGFPYmplY3R9XHJcbiAgICAgKi9cclxuICAgIGNyZWF0ZUNhdGFsb2d1ZURhdGFPYmplY3QoZ3VpZCwgdHlwZSwgdmVyc2lvbiwgb2JqZWN0TmFtZSwgZGVzY3JpcHRpb24sIGxhbmd1YWdlLCBzb3VyY2VQYWNrYWdlVVJMKSB7XHJcbiAgICAgICAgaWYgKFxyXG4gICAgICAgICAgICB0eXBlb2YgZ3VpZCA9PT0gXCJ1bmRlZmluZWRcIlxyXG4gICAgICAgICAgICB8fCB0eXBlb2YgdHlwZSA9PT0gXCJ1bmRlZmluZWRcIlxyXG4gICAgICAgICAgICB8fCB0eXBlb2YgdmVyc2lvbiA9PT0gXCJ1bmRlZmluZWRcIlxyXG4gICAgICAgICAgICB8fCB0eXBlb2Ygb2JqZWN0TmFtZSA9PT0gXCJ1bmRlZmluZWRcIlxyXG4gICAgICAgICAgICB8fCB0eXBlb2YgZGVzY3JpcHRpb24gPT09IFwidW5kZWZpbmVkXCJcclxuICAgICAgICAgICAgfHwgdHlwZW9mIGxhbmd1YWdlID09PSBcInVuZGVmaW5lZFwiXHJcbiAgICAgICAgICAgIHx8IHR5cGVvZiBzb3VyY2VQYWNrYWdlVVJMID09PSBcInVuZGVmaW5lZFwiXHJcbiAgICAgICAgKVxyXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJJbnZhbGlkIHBhcmFtZXRlcnMhXCIpO1xyXG4gICAgICAgIHJldHVybiBuZXcgQ2F0YWxvZ3VlRGF0YU9iamVjdChndWlkLCB0eXBlLCB2ZXJzaW9uLCBvYmplY3ROYW1lLCBkZXNjcmlwdGlvbiwgbGFuZ3VhZ2UsIHNvdXJjZVBhY2thZ2VVUkwpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogQ3JlYXRlIEh5cGVydHlEZXNjcmlwdG9yXHJcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gZ3VpZCAtIENhdGFsb2d1ZSBHbG9iYWwgVW5pcXVlIGlkZW50aWZpZXIgb2YgdGhlIENhdGFsb2d1ZSBPYmplY3RcclxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSB2ZXJzaW9uIC0gSW5kaWNhdGVzIHRoZSB2ZXJzaW9uIG9mIENhdGFsb2d1ZSBEYXRhXHJcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gb2JqZWN0TmFtZSAtIEh1bWFuLXVuZGVyc3RhbmRhYmxlIG5hbWUgb2YgdGhlIGNhdGFsb2d1ZSBvYmplY3RcclxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBkZXNjcmlwdGlvblxyXG4gICAgICogQHBhcmFtIHtEYXRhT2JqZWN0U291cmNlTGFuZ3VhZ2V9IGxhbmd1YWdlIC0gUHJvZ3JhbW1pbmcgbGFuZ3VhZ2UgdXNlZCBpbiB0aGUgU291cmNlUGFja2FnZVxyXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IHNvdXJjZVBhY2thZ2VVUkwgLSBVUkwgZnJvbSB3aGVyZSB0aGUgc291cmNlIGNvZGUgcGFja2FnZSBvZiB0aGUgY29ycmVzcG9uZGluZyBjYXRhbG9ndWUgb2JqZWN0XHJcbiAgICAgKiBjYW4gYmUgZG93bmxvYWRlZC5cclxuICAgICAqIEBwYXJhbSB7SHlwZXJ0eVJlc291cmNlVHlwZVtdfSBoeXBlcnR5VHlwZSAtIEFuIGFycmF5IG9mIEh5cGVydHlSZXNvdXJjZVR5cGUgdGhhdCBpZGVudGlmaWVzIHdoYXQgdHlwZSBvZiBoeXBlcnR5XHJcbiAgICAgKiByZXNvdXJjZXMgYXJlIGhhbmRsZWQgYnkgdGhlIG9iamVjdC5cclxuICAgICAqIEBwYXJhbSB7VVJMLlVSTExpc3R9IGRhdGFPYmplY3RzIC0gRGVmaW5lcyB0aGUgRGF0YSBPYmplY3QgU2NoZW1hcyBzdXBwb3J0ZWQgYnkgdGhlIEh5cGVydHkgdGhyb3VnaCBhIGxpc3Qgb2YgQ2F0YWxvZ3VlIFVSTHMgZnJvbSB3aGVyZSB0aGVzZSBzY2hlbWFzIGNhbiBiZSByZWFjaGVkLlxyXG4gICAgICogQHJldHVybnMge0h5cGVydHlEZXNjcmlwdG9yfVxyXG4gICAgICovXHJcbiAgICBjcmVhdGVIeXBlcnR5RGVzY3JpcHRvck9iamVjdChndWlkLCB2ZXJzaW9uLCBvYmplY3ROYW1lLCBkZXNjcmlwdGlvbiwgbGFuZ3VhZ2UsIHNvdXJjZVBhY2thZ2VVUkwsIGh5cGVydHlUeXBlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YU9iamVjdHMpIHtcclxuICAgICAgICBpZiAoXHJcbiAgICAgICAgICAgIHR5cGVvZiBndWlkID09PSBcInVuZGVmaW5lZFwiXHJcbiAgICAgICAgICAgIHx8IHR5cGVvZiB2ZXJzaW9uID09PSBcInVuZGVmaW5lZFwiXHJcbiAgICAgICAgICAgIHx8IHR5cGVvZiBvYmplY3ROYW1lID09PSBcInVuZGVmaW5lZFwiXHJcbiAgICAgICAgICAgIHx8IHR5cGVvZiBkZXNjcmlwdGlvbiA9PT0gXCJ1bmRlZmluZWRcIlxyXG4gICAgICAgICAgICB8fCB0eXBlb2YgbGFuZ3VhZ2UgPT09IFwidW5kZWZpbmVkXCJcclxuICAgICAgICAgICAgfHwgdHlwZW9mIHNvdXJjZVBhY2thZ2VVUkwgPT09IFwidW5kZWZpbmVkXCJcclxuICAgICAgICAgICAgfHwgdHlwZW9mIGh5cGVydHlUeXBlID09PSBcInVuZGVmaW5lZFwiXHJcbiAgICAgICAgICAgIHx8IHR5cGVvZiBkYXRhT2JqZWN0cyA9PT0gXCJ1bmRlZmluZWRcIlxyXG4gICAgICAgIClcclxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiSW52YWxpZCBwYXJhbWV0ZXJzIVwiKTtcclxuICAgICAgICByZXR1cm4gbmV3IEh5cGVydHlEZXNjcmlwdG9yKGd1aWQsIENhdGFsb2d1ZU9iamVjdFR5cGUuSFlQRVJUWSwgdmVyc2lvbiwgb2JqZWN0TmFtZSwgZGVzY3JpcHRpb24sXHJcbiAgICAgICAgICAgIGxhbmd1YWdlLCBzb3VyY2VQYWNrYWdlVVJMLCBoeXBlcnR5VHlwZSwgZGF0YU9iamVjdHMpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogQ3JlYXRlIFByb3RvY29sU3R1YkRlc2NyaXB0b3JcclxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBndWlkIC0gQ2F0YWxvZ3VlIEdsb2JhbCBVbmlxdWUgaWRlbnRpZmllciBvZiB0aGUgQ2F0YWxvZ3VlIE9iamVjdFxyXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IHZlcnNpb24gLSBJbmRpY2F0ZXMgdGhlIHZlcnNpb24gb2YgQ2F0YWxvZ3VlIERhdGFcclxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBvYmplY3ROYW1lIC0gSHVtYW4tdW5kZXJzdGFuZGFibGUgbmFtZSBvZiB0aGUgY2F0YWxvZ3VlIG9iamVjdFxyXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IGRlc2NyaXB0aW9uXHJcbiAgICAgKiBAcGFyYW0ge0RhdGFPYmplY3RTb3VyY2VMYW5ndWFnZX0gbGFuZ3VhZ2UgLSBQcm9ncmFtbWluZyBsYW5ndWFnZSB1c2VkIGluIHRoZSBTb3VyY2VQYWNrYWdlXHJcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gc291cmNlUGFja2FnZVVSTCAtIFVSTCBmcm9tIHdoZXJlIHRoZSBzb3VyY2UgY29kZSBwYWNrYWdlIG9mIHRoZSBjb3JyZXNwb25kaW5nIGNhdGFsb2d1ZSBvYmplY3QgY2FuIGJlIGRvd25sb2FkZWQuXHJcbiAgICAgKiBAcGFyYW0ge1VSTC5VUkx9IG1lc3NhZ2VTY2hlbWFzIC0gRGVmaW5lcyB0aGUgU2NoZW1hIGRlc2NyaWJpbmcgdGhlIE1lc3NhZ2UgRGF0YSBNb2RlbCB1c2VkIGJ5IHRoZSBIeXBlcnR5IHRocm91Z2ggdGhlIENhdGFsb2d1ZSBVUkwgZnJvbSB3aGVyZSB0aGUgTWVzc2FnZSBzY2hlbWEgY2FuIGJlIHJlYWNoZWQuIElmIG5vdCBkZWZpbmVkLCBieSBkZWZhdWx0IGl0IGlzIGFzc3VtZWQgdGhlIHN0YW5kYXJkIE1lc3NhZ2UgTW9kZWwgaXMgdXNlZC5cclxuICAgICAqIEBwYXJhbSBjb25maWd1cmF0aW9uIC0gRGF0YSByZXF1aXJlZCB0byBjb25maWd1cmUgdGhlIFByb3RvY29sU3R1YlxyXG4gICAgICogQHBhcmFtIGNvbnN0cmFpbnRzIC0gRGVzY3JpYmVzIGNhcGFiaWxpdGllcyByZXF1aXJlZCBmcm9tIHRoZSBIeXBlcnR5IFJ1bnRpbWUgaW4gb3JkZXIgdG8gYmUgYWJsZSB0byBleGVjdXRlIHRoZSBQcm90b2NvbFN0dWJcclxuICAgICAqIEBwYXJhbSBoeXBlcnR5VHlwZVxyXG4gICAgICogQHBhcmFtIGRhdGFPYmplY3RzXHJcbiAgICAgKiBAcGFyYW0gaW50ZXJ3b3JraW5nXHJcbiAgICAgKiBAcGFyYW0gaWRwUHJveHlcclxuICAgICAqIEBwYXJhbSBtdXR1YWxBdXRoZW50aWNhdGlvblxyXG4gICAgICogQHJldHVybnMge1Byb3RvY29sU3R1YkRlc2NyaXB0b3J9XHJcbiAgICAgKi9cclxuICAgIGNyZWF0ZVByb3RvU3R1YkRlc2NyaXB0b3JPYmplY3QoZ3VpZCwgdmVyc2lvbiwgb2JqZWN0TmFtZSwgZGVzY3JpcHRpb24sIGxhbmd1YWdlLCBzb3VyY2VQYWNrYWdlVVJMLCBtZXNzYWdlU2NoZW1hcyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uZmlndXJhdGlvbiwgY29uc3RyYWludHMsIGh5cGVydHlUeXBlLCBkYXRhT2JqZWN0cywgaW50ZXJ3b3JraW5nLCBpZHBQcm94eSwgbXV0dWFsQXV0aGVudGljYXRpb24pIHtcclxuICAgICAgICBpZiAoXHJcbiAgICAgICAgICAgIHR5cGVvZiBndWlkID09PSBcInVuZGVmaW5lZFwiXHJcbiAgICAgICAgICAgIHx8IHR5cGVvZiB2ZXJzaW9uID09PSBcInVuZGVmaW5lZFwiXHJcbiAgICAgICAgICAgIHx8IHR5cGVvZiBvYmplY3ROYW1lID09PSBcInVuZGVmaW5lZFwiXHJcbiAgICAgICAgICAgIHx8IHR5cGVvZiBkZXNjcmlwdGlvbiA9PT0gXCJ1bmRlZmluZWRcIlxyXG4gICAgICAgICAgICB8fCB0eXBlb2YgbGFuZ3VhZ2UgPT09IFwidW5kZWZpbmVkXCJcclxuICAgICAgICAgICAgfHwgdHlwZW9mIHNvdXJjZVBhY2thZ2VVUkwgPT09IFwidW5kZWZpbmVkXCJcclxuICAgICAgICAgICAgfHwgdHlwZW9mIG1lc3NhZ2VTY2hlbWFzID09PSBcInVuZGVmaW5lZFwiXHJcbiAgICAgICAgICAgIHx8IHR5cGVvZiBjb25maWd1cmF0aW9uID09PSBcInVuZGVmaW5lZFwiXHJcbiAgICAgICAgICAgIHx8IHR5cGVvZiBjb25zdHJhaW50cyA9PT0gXCJ1bmRlZmluZWRcIlxyXG4gICAgICAgIClcclxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiSW52YWxpZCBwYXJhbWV0ZXJzIVwiKTtcclxuICAgICAgICByZXR1cm4gbmV3IFByb3RvY29sU3R1YkRlc2NyaXB0b3IoZ3VpZCwgQ2F0YWxvZ3VlT2JqZWN0VHlwZS5QUk9UT1NUVUIsIHZlcnNpb24sIG9iamVjdE5hbWUsIGRlc2NyaXB0aW9uLFxyXG4gICAgICAgICAgICBsYW5ndWFnZSwgc291cmNlUGFja2FnZVVSTCwgbWVzc2FnZVNjaGVtYXMsIGNvbmZpZ3VyYXRpb24sIGNvbnN0cmFpbnRzLCBoeXBlcnR5VHlwZSwgZGF0YU9iamVjdHMsIGludGVyd29ya2luZywgaWRwUHJveHksIG11dHVhbEF1dGhlbnRpY2F0aW9uKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIENyZWF0ZSBIeXBlcnR5UnVudGltZURlc2NyaXB0b3JcclxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBndWlkIC0gQ2F0YWxvZ3VlIEdsb2JhbCBVbmlxdWUgaWRlbnRpZmllciBvZiB0aGUgQ2F0YWxvZ3VlIE9iamVjdFxyXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IHZlcnNpb24gLSBJbmRpY2F0ZXMgdGhlIHZlcnNpb24gb2YgQ2F0YWxvZ3VlIERhdGFcclxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBvYmplY3ROYW1lIC0gSHVtYW4tdW5kZXJzdGFuZGFibGUgbmFtZSBvZiB0aGUgY2F0YWxvZ3VlIG9iamVjdFxyXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IGRlc2NyaXB0aW9uXHJcbiAgICAgKiBAcGFyYW0ge0RhdGFPYmplY3RTb3VyY2VMYW5ndWFnZX0gbGFuZ3VhZ2UgLSBQcm9ncmFtbWluZyBsYW5ndWFnZSB1c2VkIGluIHRoZSBTb3VyY2VQYWNrYWdlXHJcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gc291cmNlUGFja2FnZVVSTCAtIFVSTCBmcm9tIHdoZXJlIHRoZSBzb3VyY2UgY29kZSBwYWNrYWdlIG9mIHRoZSBjb3JyZXNwb25kaW5nIGNhdGFsb2d1ZSBvYmplY3QgY2FuIGJlIGRvd25sb2FkZWQuXHJcbiAgICAgKiBAcGFyYW0ge1J1bnRpbWVUeXBlfXJ1bnRpbWVUeXBlXHJcbiAgICAgKiBAcGFyYW0ge1J1bnRpbWVIeXBlcnR5Q2FwYWJpbGl0aWVzfSBoeXBlcnR5Q2FwYWJpbGl0aWVzIC0gU3VwcG9ydGVkIGNhcGFiaWxpdGllcyB0byBleGVjdXRlIEh5cGVydGllc1xyXG4gICAgICogQHBhcmFtIHtSdW50aW1lUHJvdG9jb2xDYXBhYmlsaXRpZXN9IHByb3RvY29sQ2FwYWJpbGl0aWVzIC0gU3VwcG9ydGVkIGNhcGFiaWxpdGllcyB0byBleGVjdXRlIFByb3RvY29sIFN0dWJzXHJcbiAgICAgKiBAcGFyYW0gcDJwSGFuZGxlclN0dWJcclxuICAgICAqIEBwYXJhbSBwMnBSZXF1ZXN0ZXJTdHViXHJcbiAgICAgKiBAcmV0dXJucyB7SHlwZXJ0eVJ1bnRpbWVEZXNjcmlwdG9yfSB0aGUgZGF0YSBvYmplY3Qgb2YgdGhlIEh5cGVydHkgUnVudGltZSBEZXNjcmlwdG9yXHJcbiAgICAgKi9cclxuICAgIGNyZWF0ZUh5cGVydHlSdW50aW1lRGVzY3JpcHRvck9iamVjdChndWlkLCB2ZXJzaW9uLCBvYmplY3ROYW1lLCBkZXNjcmlwdGlvbiwgbGFuZ3VhZ2UsIHNvdXJjZVBhY2thZ2VVUkwsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcnVudGltZVR5cGUsIGh5cGVydHlDYXBhYmlsaXRpZXMsIHByb3RvY29sQ2FwYWJpbGl0aWVzLCBwMnBIYW5kbGVyU3R1YiwgcDJwUmVxdWVzdGVyU3R1Yikge1xyXG4gICAgICAgIGlmIChcclxuICAgICAgICAgICAgdHlwZW9mIGd1aWQgPT09IFwidW5kZWZpbmVkXCJcclxuICAgICAgICAgICAgfHwgdHlwZW9mIHZlcnNpb24gPT09IFwidW5kZWZpbmVkXCJcclxuICAgICAgICAgICAgfHwgdHlwZW9mIG9iamVjdE5hbWUgPT09IFwidW5kZWZpbmVkXCJcclxuICAgICAgICAgICAgfHwgdHlwZW9mIGRlc2NyaXB0aW9uID09PSBcInVuZGVmaW5lZFwiXHJcbiAgICAgICAgICAgIHx8IHR5cGVvZiBsYW5ndWFnZSA9PT0gXCJ1bmRlZmluZWRcIlxyXG4gICAgICAgICAgICB8fCB0eXBlb2Ygc291cmNlUGFja2FnZVVSTCA9PT0gXCJ1bmRlZmluZWRcIlxyXG4gICAgICAgICAgICB8fCB0eXBlb2YgcnVudGltZVR5cGUgPT09IFwidW5kZWZpbmVkXCJcclxuICAgICAgICApXHJcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkludmFsaWQgcGFyYW1ldGVycyFcIik7XHJcblxyXG4gICAgICAgIHJldHVybiBuZXcgSHlwZXJ0eVJ1bnRpbWVEZXNjcmlwdG9yKGd1aWQsIENhdGFsb2d1ZU9iamVjdFR5cGUuSFlQRVJUWV9SVU5USU1FLCB2ZXJzaW9uLCBvYmplY3ROYW1lLFxyXG4gICAgICAgICAgICBkZXNjcmlwdGlvbiwgbGFuZ3VhZ2UsIHNvdXJjZVBhY2thZ2VVUkwsIHJ1bnRpbWVUeXBlLCBoeXBlcnR5Q2FwYWJpbGl0aWVzLCBwcm90b2NvbENhcGFiaWxpdGllcywgcDJwSGFuZGxlclN0dWIsIHAycFJlcXVlc3RlclN0dWIpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogQ3JlYXRlIEh5cGVydHkgSW50ZXJjZXB0b3IgRGVzY3JpcHRvclxyXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IGd1aWQgLSBDYXRhbG9ndWUgR2xvYmFsIFVuaXF1ZSBpZGVudGlmaWVyIG9mIHRoZSBDYXRhbG9ndWUgT2JqZWN0XHJcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gdmVyc2lvbiAtIEluZGljYXRlcyB0aGUgdmVyc2lvbiBvZiBDYXRhbG9ndWUgRGF0YVxyXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IG9iamVjdE5hbWUgLSBIdW1hbi11bmRlcnN0YW5kYWJsZSBuYW1lIG9mIHRoZSBjYXRhbG9ndWUgb2JqZWN0XHJcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gZGVzY3JpcHRpb25cclxuICAgICAqIEBwYXJhbSB7RGF0YU9iamVjdFNvdXJjZUxhbmd1YWdlfSBsYW5ndWFnZSAtIFByb2dyYW1taW5nIGxhbmd1YWdlIHVzZWQgaW4gdGhlIFNvdXJjZVBhY2thZ2VcclxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBzb3VyY2VQYWNrYWdlVVJMIC0gVVJMIGZyb20gd2hlcmUgdGhlIHNvdXJjZSBjb2RlIHBhY2thZ2Ugb2YgdGhlIGNvcnJlc3BvbmRpbmcgY2F0YWxvZ3VlIG9iamVjdCBjYW4gYmUgZG93bmxvYWRlZC5cclxuICAgICAqIEBwYXJhbSBjb25maWd1cmF0aW9uXHJcbiAgICAgKiBAcGFyYW0gcG9saWNpZXNcclxuICAgICAqIEByZXR1cm5zIHtQb2xpY3lFbmZvcmNlckRlc2NyaXB0b3J9XHJcbiAgICAgKi9cclxuICAgIGNyZWF0ZUh5cGVydHlJbnRlcmNlcHRvckRlc2NyaXB0b3JPYmplY3QoZ3VpZCwgdmVyc2lvbiwgb2JqZWN0TmFtZSwgZGVzY3JpcHRpb24sIGxhbmd1YWdlLCBzb3VyY2VQYWNrYWdlVVJMLCBjb25maWd1cmF0aW9uLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb2xpY2llcykge1xyXG4gICAgICAgIGlmIChcclxuICAgICAgICAgICAgdHlwZW9mIGd1aWQgPT09IFwidW5kZWZpbmVkXCJcclxuICAgICAgICAgICAgfHwgdHlwZW9mIHZlcnNpb24gPT09IFwidW5kZWZpbmVkXCJcclxuICAgICAgICAgICAgfHwgdHlwZW9mIG9iamVjdE5hbWUgPT09IFwidW5kZWZpbmVkXCJcclxuICAgICAgICAgICAgfHwgdHlwZW9mIGRlc2NyaXB0aW9uID09PSBcInVuZGVmaW5lZFwiXHJcbiAgICAgICAgICAgIHx8IHR5cGVvZiBsYW5ndWFnZSA9PT0gXCJ1bmRlZmluZWRcIlxyXG4gICAgICAgICAgICB8fCB0eXBlb2Ygc291cmNlUGFja2FnZVVSTCA9PT0gXCJ1bmRlZmluZWRcIlxyXG4gICAgICAgIClcclxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiSW52YWxpZCBwYXJhbWV0ZXJzIVwiKTtcclxuXHJcbiAgICAgICAgcmV0dXJuIG5ldyBIeXBlcnR5SW50ZXJjZXB0b3JEZXNjcmlwdG9yKGd1aWQsIENhdGFsb2d1ZU9iamVjdFR5cGUuSFlQRVJUWV9JTlRFUkNFUFRPUiwgdmVyc2lvbiwgb2JqZWN0TmFtZSxcclxuICAgICAgICAgICAgZGVzY3JpcHRpb24sIGxhbmd1YWdlLCBzb3VyY2VQYWNrYWdlVVJMLCBjb25maWd1cmF0aW9uLCBwb2xpY2llcyk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBDcmVhdGUgRGF0YU9iamVjdFNjaGVtYSB3aGljaCBpbiBlZmZlY3QgaXMgdGhlIE1lc3NhZ2VEYXRhT2JqZWN0U2NoZW1hXHJcbiAgICAgKiBAZGVwcmVjYXRlZCBVc2UgZWl0aGVyIGNyZWF0ZU1lc3NhZ2VEYXRhT2JqZWN0U2NoZW1hIG9yIGNyZWF0ZUh5cGVydHlEYXRhT2JqZWN0U2NoZW1hIGluc3RlYWRcclxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBndWlkIC0gQ2F0YWxvZ3VlIEdsb2JhbCBVbmlxdWUgaWRlbnRpZmllciBvZiB0aGUgQ2F0YWxvZ3VlIE9iamVjdFxyXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IHZlcnNpb24gLSBJbmRpY2F0ZXMgdGhlIHZlcnNpb24gb2YgQ2F0YWxvZ3VlIERhdGFcclxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBvYmplY3ROYW1lIC0gSHVtYW4tdW5kZXJzdGFuZGFibGUgbmFtZSBvZiB0aGUgY2F0YWxvZ3VlIG9iamVjdFxyXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IGRlc2NyaXB0aW9uXHJcbiAgICAgKiBAcGFyYW0ge0RhdGFPYmplY3RTb3VyY2VMYW5ndWFnZX0gbGFuZ3VhZ2UgLSBQcm9ncmFtbWluZyBsYW5ndWFnZSB1c2VkIGluIHRoZSBTb3VyY2VQYWNrYWdlXHJcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gc291cmNlUGFja2FnZVVSTCAtIFVSTCBmcm9tIHdoZXJlIHRoZSBzb3VyY2UgY29kZSBwYWNrYWdlIG9mIHRoZSBjb3JyZXNwb25kaW5nIGNhdGFsb2d1ZSBvYmplY3QgY2FuIGJlIGRvd25sb2FkZWQuXHJcbiAgICAgKiBAcmV0dXJucyB7RGF0YU9iamVjdFNjaGVtYX1cclxuICAgICAqL1xyXG4gICAgY3JlYXRlRGF0YU9iamVjdFNjaGVtYShndWlkLCB2ZXJzaW9uLCBvYmplY3ROYW1lLCBkZXNjcmlwdGlvbiwgbGFuZ3VhZ2UsIHNvdXJjZVBhY2thZ2VVUkwpIHtcclxuICAgICAgICBpZiAoXHJcbiAgICAgICAgICAgIHR5cGVvZiBndWlkID09PSBcInVuZGVmaW5lZFwiXHJcbiAgICAgICAgICAgIHx8IHR5cGVvZiB2ZXJzaW9uID09PSBcInVuZGVmaW5lZFwiXHJcbiAgICAgICAgICAgIHx8IHR5cGVvZiBvYmplY3ROYW1lID09PSBcInVuZGVmaW5lZFwiXHJcbiAgICAgICAgICAgIHx8IHR5cGVvZiBkZXNjcmlwdGlvbiA9PT0gXCJ1bmRlZmluZWRcIlxyXG4gICAgICAgICAgICB8fCB0eXBlb2YgbGFuZ3VhZ2UgPT09IFwidW5kZWZpbmVkXCJcclxuICAgICAgICAgICAgfHwgdHlwZW9mIHNvdXJjZVBhY2thZ2VVUkwgPT09IFwidW5kZWZpbmVkXCJcclxuICAgICAgICApXHJcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkludmFsaWQgcGFyYW1ldGVycyFcIik7XHJcblxyXG4gICAgICAgIHJldHVybiBuZXcgRGF0YU9iamVjdFNjaGVtYShndWlkLCBDYXRhbG9ndWVPYmplY3RUeXBlLkhZUEVSVFlfREFUQV9PQkpFQ1QsIHZlcnNpb24sIG9iamVjdE5hbWUsIGRlc2NyaXB0aW9uLCBsYW5ndWFnZSxcclxuICAgICAgICAgICAgc291cmNlUGFja2FnZVVSTCk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBDcmVhdGUgRGF0YU9iamVjdFNjaGVtYSB3aGljaCBpbiBlZmZlY3QgaXMgdGhlIE1lc3NhZ2VEYXRhT2JqZWN0U2NoZW1hXHJcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gZ3VpZCAtIENhdGFsb2d1ZSBHbG9iYWwgVW5pcXVlIGlkZW50aWZpZXIgb2YgdGhlIENhdGFsb2d1ZSBPYmplY3RcclxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSB2ZXJzaW9uIC0gSW5kaWNhdGVzIHRoZSB2ZXJzaW9uIG9mIENhdGFsb2d1ZSBEYXRhXHJcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gb2JqZWN0TmFtZSAtIEh1bWFuLXVuZGVyc3RhbmRhYmxlIG5hbWUgb2YgdGhlIGNhdGFsb2d1ZSBvYmplY3RcclxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBkZXNjcmlwdGlvblxyXG4gICAgICogQHBhcmFtIHtEYXRhT2JqZWN0U291cmNlTGFuZ3VhZ2V9IGxhbmd1YWdlIC0gUHJvZ3JhbW1pbmcgbGFuZ3VhZ2UgdXNlZCBpbiB0aGUgU291cmNlUGFja2FnZVxyXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IHNvdXJjZVBhY2thZ2VVUkwgLSBVUkwgZnJvbSB3aGVyZSB0aGUgc291cmNlIGNvZGUgcGFja2FnZSBvZiB0aGUgY29ycmVzcG9uZGluZyBjYXRhbG9ndWUgb2JqZWN0IGNhbiBiZSBkb3dubG9hZGVkLlxyXG4gICAgICogQHJldHVybnMge0RhdGFPYmplY3RTY2hlbWF9XHJcbiAgICAgKi9cclxuICAgIGNyZWF0ZU1lc3NhZ2VEYXRhT2JqZWN0U2NoZW1hKGd1aWQsIHZlcnNpb24sIG9iamVjdE5hbWUsIGRlc2NyaXB0aW9uLCBsYW5ndWFnZSwgc291cmNlUGFja2FnZVVSTCkge1xyXG4gICAgICAgIGlmIChcclxuICAgICAgICAgICAgdHlwZW9mIGd1aWQgPT09IFwidW5kZWZpbmVkXCJcclxuICAgICAgICAgICAgfHwgdHlwZW9mIHZlcnNpb24gPT09IFwidW5kZWZpbmVkXCJcclxuICAgICAgICAgICAgfHwgdHlwZW9mIG9iamVjdE5hbWUgPT09IFwidW5kZWZpbmVkXCJcclxuICAgICAgICAgICAgfHwgdHlwZW9mIGRlc2NyaXB0aW9uID09PSBcInVuZGVmaW5lZFwiXHJcbiAgICAgICAgICAgIHx8IHR5cGVvZiBsYW5ndWFnZSA9PT0gXCJ1bmRlZmluZWRcIlxyXG4gICAgICAgICAgICB8fCB0eXBlb2Ygc291cmNlUGFja2FnZVVSTCA9PT0gXCJ1bmRlZmluZWRcIlxyXG4gICAgICAgIClcclxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiSW52YWxpZCBwYXJhbWV0ZXJzIVwiKTtcclxuXHJcbiAgICAgICAgcmV0dXJuIG5ldyBEYXRhT2JqZWN0U2NoZW1hKGd1aWQsIENhdGFsb2d1ZU9iamVjdFR5cGUuSFlQRVJUWV9EQVRBX09CSkVDVCwgdmVyc2lvbiwgb2JqZWN0TmFtZSwgZGVzY3JpcHRpb24sIGxhbmd1YWdlLFxyXG4gICAgICAgICAgICBzb3VyY2VQYWNrYWdlVVJMKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIENyZWF0ZSBIeXBlcnR5RGF0YU9iamVjdFNjaGVtYVxyXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IGd1aWQgLSBDYXRhbG9ndWUgR2xvYmFsIFVuaXF1ZSBpZGVudGlmaWVyIG9mIHRoZSBDYXRhbG9ndWUgT2JqZWN0XHJcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gdmVyc2lvbiAtIEluZGljYXRlcyB0aGUgdmVyc2lvbiBvZiBDYXRhbG9ndWUgRGF0YVxyXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IG9iamVjdE5hbWUgLSBIdW1hbi11bmRlcnN0YW5kYWJsZSBuYW1lIG9mIHRoZSBjYXRhbG9ndWUgb2JqZWN0XHJcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gZGVzY3JpcHRpb25cclxuICAgICAqIEBwYXJhbSB7RGF0YU9iamVjdFNvdXJjZUxhbmd1YWdlfSBsYW5ndWFnZSAtIFByb2dyYW1taW5nIGxhbmd1YWdlIHVzZWQgaW4gdGhlIFNvdXJjZVBhY2thZ2VcclxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBzb3VyY2VQYWNrYWdlVVJMIC0gVVJMIGZyb20gd2hlcmUgdGhlIHNvdXJjZSBjb2RlIHBhY2thZ2Ugb2YgdGhlIGNvcnJlc3BvbmRpbmcgY2F0YWxvZ3VlIG9iamVjdCBjYW4gYmUgZG93bmxvYWRlZC5cclxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBhY2Nlc3NDb250cm9sUG9saWN5IC0gcG9saWN5IHJ1bGUgdG8gYWNjZXNzIG9iamVjdCAoc2VlIFJlcG9ydGVyLU9ic2VydmVyIENvbW0gcGF0dGVybilcclxuICAgICAqIEBwYXJhbSB7RGF0YVVybFNjaGVtZX0gc2NoZW1lIC0gaWRlbnRpZmllcyB0aGUgZGF0YSBzY2hlbWUgKENPTU0sIENPTk5FQ1RJT04sIENUWFQgb3IgSURFTlRJVFkpXHJcbiAgICAgKiBAcmV0dXJucyB7RGF0YU9iamVjdFNjaGVtYX1cclxuICAgICAqL1xyXG4gICAgY3JlYXRlSHlwZXJ0eURhdGFPYmplY3RTY2hlbWEoZ3VpZCwgdmVyc2lvbiwgb2JqZWN0TmFtZSwgZGVzY3JpcHRpb24sIGxhbmd1YWdlLCBzb3VyY2VQYWNrYWdlVVJMLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWNjZXNzQ29udHJvbFBvbGljeSwgc2NoZW1lKSB7XHJcbiAgICAgICAgaWYgKFxyXG4gICAgICAgICAgICB0eXBlb2YgZ3VpZCA9PT0gXCJ1bmRlZmluZWRcIlxyXG4gICAgICAgICAgICB8fCB0eXBlb2YgdmVyc2lvbiA9PT0gXCJ1bmRlZmluZWRcIlxyXG4gICAgICAgICAgICB8fCB0eXBlb2Ygb2JqZWN0TmFtZSA9PT0gXCJ1bmRlZmluZWRcIlxyXG4gICAgICAgICAgICB8fCB0eXBlb2YgZGVzY3JpcHRpb24gPT09IFwidW5kZWZpbmVkXCJcclxuICAgICAgICAgICAgfHwgdHlwZW9mIGxhbmd1YWdlID09PSBcInVuZGVmaW5lZFwiXHJcbiAgICAgICAgICAgIHx8IHR5cGVvZiBzb3VyY2VQYWNrYWdlVVJMID09PSBcInVuZGVmaW5lZFwiXHJcbiAgICAgICAgICAgIHx8IHR5cGVvZiBzY2hlbWUgPT09IFwidW5kZWZpbmVkXCJcclxuICAgICAgICAgICAgfHwgdHlwZW9mIGFjY2Vzc0NvbnRyb2xQb2xpY3kgPT09IFwidW5kZWZpbmVkXCJcclxuICAgICAgICApXHJcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkludmFsaWQgcGFyYW1ldGVycyFcIik7XHJcblxyXG4gICAgICAgIGlmIChzY2hlbWUgPT09IERhdGFVcmxTY2hlbWUuQ09NTSlcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBDb21tdW5pY2F0aW9uRGF0YU9iamVjdFNjaGVtYShndWlkLCBDYXRhbG9ndWVPYmplY3RUeXBlLkhZUEVSVFlfREFUQV9PQkpFQ1QsIHZlcnNpb24sIG9iamVjdE5hbWUsIGRlc2NyaXB0aW9uLFxyXG4gICAgICAgICAgICAgICAgbGFuZ3VhZ2UsIHNvdXJjZVBhY2thZ2VVUkwsIHNjaGVtZSwgYWNjZXNzQ29udHJvbFBvbGljeSk7XHJcbiAgICAgICAgZWxzZSBpZiAoc2NoZW1lID09PSBEYXRhVXJsU2NoZW1lLkNPTk5FQ1RJT04pXHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgQ29ubmVjdGlvbkRhdGFPYmplY3RTY2hlbWEoZ3VpZCwgQ2F0YWxvZ3VlT2JqZWN0VHlwZS5IWVBFUlRZX0RBVEFfT0JKRUNULCB2ZXJzaW9uLCBvYmplY3ROYW1lLCBkZXNjcmlwdGlvbixcclxuICAgICAgICAgICAgICAgIGxhbmd1YWdlLCBzb3VyY2VQYWNrYWdlVVJMLCBzY2hlbWUsIGFjY2Vzc0NvbnRyb2xQb2xpY3kpO1xyXG4gICAgICAgIGVsc2UgaWYgKHNjaGVtZSA9PT0gRGF0YVVybFNjaGVtZS5DVFhUKVxyXG4gICAgICAgICAgICByZXR1cm4gbmV3IENvbnRleHREYXRhT2JqZWN0U2NoZW1hKGd1aWQsIENhdGFsb2d1ZU9iamVjdFR5cGUuSFlQRVJUWV9EQVRBX09CSkVDVCwgdmVyc2lvbiwgb2JqZWN0TmFtZSwgZGVzY3JpcHRpb24sXHJcbiAgICAgICAgICAgICAgICBsYW5ndWFnZSwgc291cmNlUGFja2FnZVVSTCwgc2NoZW1lLCBhY2Nlc3NDb250cm9sUG9saWN5KTtcclxuICAgICAgICBlbHNlIGlmIChzY2hlbWUgPT09IERhdGFVcmxTY2hlbWUuSURFTlRJVFkpXHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgSWRlbnRpdHlEYXRhT2JqZWN0U2NoZW1hKGd1aWQsIENhdGFsb2d1ZU9iamVjdFR5cGUuSFlQRVJUWV9EQVRBX09CSkVDVCwgdmVyc2lvbiwgb2JqZWN0TmFtZSwgZGVzY3JpcHRpb24sXHJcbiAgICAgICAgICAgICAgICBsYW5ndWFnZSwgc291cmNlUGFja2FnZVVSTCwgc2NoZW1lLCBhY2Nlc3NDb250cm9sUG9saWN5KTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIENyZWF0ZSBTb3VyY2VQYWNrYWdlXHJcbiAgICAgKiBAcGFyYW0gc291cmNlQ29kZUNsYXNzbmFtZSAtIFRoZSBDbGFzcy1uYW1lIG9mIHRoZSBTb3VyY2VDb2RlXHJcbiAgICAgKiBAcGFyYW0gc291cmNlQ29kZSAtIFRoZSBzb3VyY2UgY29kZSBvZiB0aGUgY2F0YWxvZ3VlIG9iamVjdFxyXG4gICAgICogQHJldHVybnMge1NvdXJjZVBhY2thZ2V9XHJcbiAgICAgKi9cclxuICAgIGNyZWF0ZVNvdXJjZVBhY2thZ2Uoc291cmNlQ29kZUNsYXNzbmFtZSwgc291cmNlQ29kZSkge1xyXG4gICAgICAgIGlmIChcclxuICAgICAgICAgICAgdHlwZW9mIHNvdXJjZUNvZGUgPT09IFwidW5kZWZpbmVkXCJcclxuICAgICAgICAgICAgfHwgdHlwZW9mIHNvdXJjZUNvZGVDbGFzc25hbWUgPT09IFwidW5kZWZpbmVkXCJcclxuICAgICAgICApXHJcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkludmFsaWQgcGFyYW1ldGVycyFcIik7XHJcblxyXG4gICAgICAgIHJldHVybiBuZXcgU291cmNlUGFja2FnZShzb3VyY2VDb2RlQ2xhc3NuYW1lLCBzb3VyY2VDb2RlKTtcclxuXHJcbiAgICB9XHJcbn1cclxuZXhwb3J0IGRlZmF1bHQgQ2F0YWxvZ3VlRGF0YU9iamVjdEZhY3Rvcnk7XHJcbiIsIi8vIExvZyBTeXN0ZW1cclxuaW1wb3J0ICogYXMgbG9nZ2VyIGZyb20gJ2xvZ2xldmVsJztcclxubGV0IGxvZyA9IGxvZ2dlci5nZXRMb2dnZXIoJ1J1bnRpbWVDYXRhbG9ndWUnKTtcclxuXHJcbmltcG9ydCBDYXRhbG9ndWVGYWN0b3J5IGZyb20gJy4vQ2F0YWxvZ3VlRGF0YU9iamVjdEZhY3RvcnknO1xyXG5cclxuY2xhc3MgUnVudGltZUNhdGFsb2d1ZSB7XHJcblxyXG4gIGNvbnN0cnVjdG9yKHJ1bnRpbWVGYWN0b3J5LCBuYW1lLCBzY2hlbWEpIHtcclxuICAgIGlmICghcnVudGltZUZhY3RvcnkpIHRocm93IEVycm9yKCdUaGUgY2F0YWxvZ3VlIG5lZWRzIHRoZSBydW50aW1lRmFjdG9yeScpO1xyXG5cclxuICAgIHRoaXMuX3J1bnRpbWVGYWN0b3J5ID0gcnVudGltZUZhY3Rvcnk7XHJcblxyXG4gICAgdGhpcy5fZmFjdG9yeSA9IG5ldyBDYXRhbG9ndWVGYWN0b3J5KCk7XHJcbiAgICB0aGlzLmh0dHBSZXF1ZXN0ID0gcnVudGltZUZhY3RvcnkuY3JlYXRlSHR0cFJlcXVlc3QoKTtcclxuICAgIHRoaXMuYXRvYiA9IHJ1bnRpbWVGYWN0b3J5LmF0b2IgPyBydW50aW1lRmFjdG9yeS5hdG9iIDogYXRvYjtcclxuXHJcbiAgICBjb25zdCBzdG9yYWdlTmFtZSA9IG5hbWUgPyBuYW1lIDogJ3J1bnRpbWVDYXRhbG9ndWUnO1xyXG4gICAgY29uc3Qgc3RvcmFnZVNjaGVtYSA9IHNjaGVtYSA/IHNjaGVtYSA6ICcmY2d1aWQsIGFjY2Vzc0NvbnRyb2xQb2xpY3ksIGNvbnN0cmFpbnRzLCBkYXRhT2JqZWN0cywgdHlwZSwgb2JqZWN0TmFtZSwgc291cmNlUGFja2FnZSwgdmVyc2lvbiwgdXJsJztcclxuXHJcbiAgICBjb25zdCBzY2hlbWFzID0ge307XHJcbiAgICBzY2hlbWFzW3N0b3JhZ2VOYW1lXSA9IHN0b3JhZ2VTY2hlbWE7XHJcblxyXG4gICAgdGhpcy5zdG9yYWdlTWFuYWdlciA9IHJ1bnRpbWVGYWN0b3J5LnN0b3JhZ2VNYW5hZ2VyKHN0b3JhZ2VOYW1lLCBzY2hlbWFzKTtcclxuXHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgICAqIEdldCBhIENhdGFsb2d1ZSBEYXRhIE9iamVjdCAoRGVzY3JpcHRvcikgZnJvbSBhIFVSTCwgYW5kIGNvbnN0cnVjdCBpdCB1c2luZyB0aGUgcHJvdmlkZWQgZnVuY3Rpb25cclxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSBkZXNjcmlwdG9yVVJMIC0gZS5nLiBteWRvbWFpbi5jb20vLndlbGwta25vd24vaHlwZXJ0eS9NeUh5cGVydHlcclxuICAgICAqIEBwYXJhbSB7ZnVuY3Rpb259IGNyZWF0ZUZ1bmMgLSBlLmcuIGNyZWF0ZUh5cGVydHlcclxuICAgICAqIEBwYXJhbSB7Ym9vbGVhbn0gW2dldEZ1bGxdIC0gd2hldGhlciBvciBub3QgdG8gZ2V0IGRlc2NyaXB0b3Igd2l0aCBzb3VyY2VQYWNrYWdlLCBvciBvbmx5IHRoZSBkZXNjcmlwdG9yIHBhcnRcclxuICAgICAqIEBwYXJhbSB7SlNPTn0gY29uc3RyYWludHMgLSBjb25zdHJhaW50cyBvYmplY3RcclxuICAgICAqIEByZXR1cm5zIHtQcm9taXNlfSAtIFByb21pc2UgdGhhdCBmdWxmaWxscyB3aXRoIHRoZSByZXF1ZXN0ZWQgZGVzY3JpcHRvciBpbiB0aGUgYXBwcm9wcmlhdGUgdHlwZS5cclxuICAgICAqIElmIGNvbnN0cmFpbnRzIHdlcmUgcHJvdmlkZWQsIGEgZGVzY3JpcHRvciBpcyBvbmx5IHJldHVybmVkIGlmIGl0IG1lZXRzIHRoZSBjb25zdHJhaW50cywgb3RoZXJ3aXNlIHRoZSBwcm9taXNlIHdpbGwgYmUgcmVqZWN0ZWQuXHJcbiAgICAgKi9cclxuICAgIGdldERlc2NyaXB0b3IoZGVzY3JpcHRvclVSTCwgY3JlYXRlRnVuYywgZ2V0RnVsbCA9IHRydWUsIGNvbnN0cmFpbnRzKSB7XHJcbiAgICAgIGxvZy5pbmZvKCdbUnVudGltZUNhdGFsb2d1ZV0gLSBnZXR0aW5nIGRlc2NyaXB0b3IgZnJvbTogJywgZGVzY3JpcHRvclVSTCwgJyB3aXRoIGNvbnN0cmFpbnRzOiAnLCBjb25zdHJhaW50cyk7XHJcblxyXG4gICAgICByZXR1cm4gbmV3IFByb21pc2UgKChyZXNvbHZlLCByZWplY3QpPT57XHJcbiAgICAgICAgaWYgKHRoaXMuX3J1bnRpbWVGYWN0b3J5LmlzT25saW5lKCkgKSB7XHJcbiAgICAgICAgICAgIHJlc29sdmUoIHRoaXMuX2dldERlc2NyaXB0b3IoZGVzY3JpcHRvclVSTCwgY3JlYXRlRnVuYywgZ2V0RnVsbCwgY29uc3RyYWludHMpKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgdGhpcy5zdG9yYWdlTWFuYWdlci5nZXQoJ3VybCcsIGRlc2NyaXB0b3JVUkwpLnRoZW4oKGRlc2NyaXB0b3IpID0+IHtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coJ1tSdW50aW1lQ2F0YWxvZ3VlXSBzYXZlZCBvZmZsaW5lIGRlc2NyaXB0b3IgJywgZGVzY3JpcHRvcik7XHJcblxyXG4gICAgICAgICAgICBpZiAoZGVzY3JpcHRvcikgcmVzb2x2ZShjcmVhdGVGdW5jLmFwcGx5KHRoaXMsIFtkZXNjcmlwdG9yLCBjb25zdHJhaW50c10pKTtcclxuICAgICAgICAgICAgZWxzZSByZXNvbHZlKCB0aGlzLl9nZXREZXNjcmlwdG9yKGRlc2NyaXB0b3JVUkwsIGNyZWF0ZUZ1bmMsIGdldEZ1bGwsIGNvbnN0cmFpbnRzKSk7XHJcblxyXG4gICAgICAgICAgfSk7XHJcbiAgICAgICAgfSBcclxuICBcclxuICAgICAgfSk7XHJcblxyXG4gICAgfVxyXG5cclxuICAgIF9nZXREZXNjcmlwdG9yKGRlc2NyaXB0b3JVUkwsIGNyZWF0ZUZ1bmMsIGdldEZ1bGwgPSB0cnVlLCBjb25zdHJhaW50cykge1xyXG5cclxuICAgIC8vIHNvbWUgZmxhZ3MgZm9yIG9wdGltaXphdGlvblxyXG4gICAgLy8gKGxhdGVyIHRoZSBkZXNjcmlwdG9yIHdpbGwgbm90IGJlIHNhdmVkIGluIGNhc2UgYm90aCBvZiB0aGVzZSBib29sZWFucyBhcmUgdHJ1ZSlcclxuICAgIGxldCBpc1NhdmVkRGVzY3JpcHRvciA9IGZhbHNlO1xyXG4gICAgbGV0IGlzQ29tcGxldGVEZXNjcmlwdG9yID0gZmFsc2U7XHJcblxyXG4gICAgLy8gZ2V0IHJhdyBkZXNjcmlwdG9yXHJcbiAgICAvLyBmaXJzdCBjaGVja3MgaWYgZGVzY3JpcHRvciBpcyBhbHJlYWR5IGluIGxvY2FsU3RvcmFnZSAoYmFzZWQgb24gY2d1aWQgYW5kIHZlcnNpb24pXHJcbiAgICBsZXQgZGVzY3JpcHRvclByb21pc2U7XHJcbiAgICBpZiAoY29uc3RyYWludHMgIT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgIGRlc2NyaXB0b3JQcm9taXNlID0gUHJvbWlzZS5hbGwoW3RoaXMuaHR0cFJlcXVlc3QucG9zdChkZXNjcmlwdG9yVVJMICsgJy92ZXJzaW9uJywge2JvZHk6IEpTT04uc3RyaW5naWZ5KGNvbnN0cmFpbnRzKX0pLCB0aGlzLmh0dHBSZXF1ZXN0LnBvc3QoZGVzY3JpcHRvclVSTCArICcvY2d1aWQnLCB7Ym9keTogSlNPTi5zdHJpbmdpZnkoY29uc3RyYWludHMpfSldKVxyXG4gICAgfSBlbHNlIHtcclxuICAgICAgZGVzY3JpcHRvclByb21pc2UgPSBQcm9taXNlLmFsbChbdGhpcy5odHRwUmVxdWVzdC5nZXQoZGVzY3JpcHRvclVSTCArICcvdmVyc2lvbicpLCB0aGlzLmh0dHBSZXF1ZXN0LmdldChkZXNjcmlwdG9yVVJMICsgJy9jZ3VpZCcpXSlcclxuICAgIH1cclxuICAgIGRlc2NyaXB0b3JQcm9taXNlID0gZGVzY3JpcHRvclByb21pc2UudGhlbigoW3ZlcnNpb24sIGNndWlkXSkgPT4ge1xyXG4gICAgICBsb2cubG9nKCdbUnVudGltZUNhdGFsb2d1ZS5nZXREZXNjcmlwdG9yXSAtIGdvdCB2ZXJzaW9uICgnICsgdmVyc2lvbiArICcpIGFuZCBjZ3VpZCAoJyArIGNndWlkICsgJykgZm9yIGRlc2NyaXB0b3IgJyArIGRlc2NyaXB0b3JVUkwpO1xyXG5cclxuICAgICAgLy8gY2hlY2sgaWYgc2FtZSB2ZXJzaW9uIGlzIGNvbnRhaW5lZCBpbiBsb2NhbFN0b3JhZ2VcclxuICAgICAgcmV0dXJuIHRoaXMuc3RvcmFnZU1hbmFnZXIuZ2V0VmVyc2lvbignY2d1aWQnLCBjZ3VpZCkudGhlbigoZGJWZXJzaW9uKSA9PiB7XHJcbiAgICAgICAgaWYgKGRiVmVyc2lvbiA+PSB2ZXJzaW9uKSB7XHJcbiAgICAgICAgICBsb2cubG9nKCdbUnVudGltZUNhdGFsb2d1ZS5nZXREZXNjcmlwdG9yXSBsb2NhbCB2ZXJzaW9uIGlzIHVwZGF0ZWQgZm9yICcsIGRlc2NyaXB0b3JVUkwpO1xyXG4gICAgICAgICAgaXNTYXZlZERlc2NyaXB0b3IgPSB0cnVlO1xyXG4gICAgICAgICAgcmV0dXJuIHRoaXMuc3RvcmFnZU1hbmFnZXIuZ2V0KCdjZ3VpZCcsIGNndWlkKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgbG9nLmxvZygnW1J1bnRpbWVDYXRhbG9ndWUuZ2V0RGVzY3JpcHRvcl0gbG9jYWwgdmVyc2lvbiBub3QgdXBkYXRlZCBmb3IgJywgZGVzY3JpcHRvclVSTCwgJyByZXRyaWV2aW5nIGZyb20gcmVtb3RlIGNhdGFsb2d1ZSAuLi4nKTtcclxuXHJcbiAgICAgICAgICAvLyBubyBzYXZlZCBjb3B5LCBwcm9jZWVkIHdpdGggcmV0cmlldmluZyBkZXNjcmlwdG9yXHJcbiAgICAgICAgICBsZXQgcmV0cmlldmVQcm9taXNlID0gY29uc3RyYWludHMgIT0gdW5kZWZpbmVkID8gdGhpcy5odHRwUmVxdWVzdC5wb3N0KGRlc2NyaXB0b3JVUkwsIHtib2R5OiBKU09OLnN0cmluZ2lmeShjb25zdHJhaW50cyl9KSA6IHRoaXMuaHR0cFJlcXVlc3QuZ2V0KGRlc2NyaXB0b3JVUkwpO1xyXG4gICAgICAgICAgcmV0dXJuIHJldHJpZXZlUHJvbWlzZS50aGVuKChkZXNjcmlwdG9yKSA9PiB7XHJcbiAgICAgICAgICAgIGRlc2NyaXB0b3IgPSBKU09OLnBhcnNlKGRlc2NyaXB0b3IpO1xyXG5cclxuICAgICAgICAgICAgLy9sb2cubG9nKFwiZ290IGRlc2NyaXB0b3I6XCIsIEpTT04uc3RyaW5naWZ5KGRlc2NyaXB0b3IsIG51bGwsIDIpKTtcclxuICAgICAgICAgICAgaWYgKGRlc2NyaXB0b3JbJ0VSUk9SJ10pIHtcclxuICAgICAgICAgICAgICAvLyBUT0RPIGhhbmRsZSBlcnJvciBwcm9wZXJseVxyXG4gICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihkZXNjcmlwdG9yKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICByZXR1cm4gZGVzY3JpcHRvcjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KVxyXG4gICAgfSkuY2F0Y2goKGVycm9yKSA9PiB7XHJcbiAgICAgIGxldCBlcnJvclN0cmluZyA9ICdVbmFibGUgdG8gZ2V0IGRlc2NyaXB0b3IgZm9yICcgKyBkZXNjcmlwdG9yVVJMICsgKGNvbnN0cmFpbnRzICE9IHVuZGVmaW5lZCA/ICcgd2l0aCBjb25zdHJhaW50cyAnICsgY29uc3RyYWludHMgOiAnJykgKyAnOiAnICsgZXJyb3I7XHJcbiAgICAgIGxvZy5lcnJvcihlcnJvclN0cmluZyk7XHJcbiAgICAgIHRocm93IG5ldyBFcnJvcihlcnJvclN0cmluZyk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBsZXQgcmV0dXJuUHJvbWlzZSA9IGRlc2NyaXB0b3JQcm9taXNlO1xyXG5cclxuICAgIC8vIGlmIGdldEZ1bGwsIGF0dGFjaCBzb3VyY2VQYWNrYWdlXHJcbiAgICBpZiAoZ2V0RnVsbCkge1xyXG4gICAgICBsb2cubG9nKCdhZGRpbmcgcHJvbWlzZSB0byBhdHRhY2ggc291cmNlUGFja2FnZScpO1xyXG4gICAgICByZXR1cm5Qcm9taXNlID0gZGVzY3JpcHRvclByb21pc2UudGhlbigoZGVzY3JpcHRvcikgPT4ge1xyXG4gICAgICAgIGlmIChkZXNjcmlwdG9yLnNvdXJjZVBhY2thZ2UpIHtcclxuICAgICAgICAgIGlzQ29tcGxldGVEZXNjcmlwdG9yID0gdHJ1ZTtcclxuICAgICAgICAgIHJldHVybiBkZXNjcmlwdG9yO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICBpc0NvbXBsZXRlRGVzY3JpcHRvciA9IGZhbHNlO1xyXG4gICAgICAgICAgcmV0dXJuIHRoaXMuYXR0YWNoUmF3U291cmNlUGFja2FnZShkZXNjcmlwdG9yKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0pXHJcbiAgICB9XHJcblxyXG4gICAgLy8gZmluYWxseSBjcmVhdGUgb2JqZWN0XHJcbiAgICByZXR1cm5Qcm9taXNlID0gcmV0dXJuUHJvbWlzZS50aGVuKChkZXNjcmlwdG9yKSA9PiB7XHJcbiAgICAgIC8vIHN0b3JlIGlmIG5vdCBzYXZlZCBiZWZvcmUsIG9yIGlmIGZ1bGwgZGVzY3JpcHRvciB3YXMgcmVxdWVzdGVkIGFuZCBvbmx5IHBhcnRpYWwgZGVzY3JpcHRvciB3YXMgc3RvcmVkLlxyXG4gICAgICBpZiAoIWlzU2F2ZWREZXNjcmlwdG9yIHx8IChpc1NhdmVkRGVzY3JpcHRvciAmJiAhaXNDb21wbGV0ZURlc2NyaXB0b3IgJiYgZ2V0RnVsbCkpIHtcclxuICAgICAgICBkZXNjcmlwdG9yLnVybCA9IGRlc2NyaXB0b3JVUkw7XHJcbiAgICAgICAgdGhpcy5zdG9yYWdlTWFuYWdlci5zZXQoZGVzY3JpcHRvci5jZ3VpZCwgZGVzY3JpcHRvci52ZXJzaW9uLCBkZXNjcmlwdG9yKTtcclxuICAgICAgfVxyXG4gICAgICByZXR1cm4gY3JlYXRlRnVuYy5hcHBseSh0aGlzLCBbZGVzY3JpcHRvciwgY29uc3RyYWludHNdKTtcclxuICAgIH0pO1xyXG5cclxuICAgIHJldHVybiByZXR1cm5Qcm9taXNlO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICAgKiBVc2VzIHRoZSBzb3VyY2VQYWNrYWdlVVJMIGZyb20gdGhlIGRlc2NyaXB0b3IsIHJlcXVlc3RzIHRoZSBzb3VyY2VQYWNrYWdlIGFuZCBhdHRhY2hlcyBpdCB0byB0aGUgZGVzY3JpcHRvci5cclxuICAgICAqIEBwYXJhbSB7Q2F0YWxvZ3VlRGF0YU9iamVjdH0gZGVzY3JpcHRvclxyXG4gICAgICogQHBhcmFtIHtKU09OfSBjb25zdHJhaW50cyAtIGNvbnN0cmFpbnRzIG9iamVjdFxyXG4gICAgICogQHJldHVybnMge1Byb21pc2V9IC0gZnVsZmlsbHMgd2l0aCBjb21wbGV0ZSBkZXNjcmlwdG9yXHJcbiAgICAgKi9cclxuICBhdHRhY2hSYXdTb3VyY2VQYWNrYWdlKGRlc2NyaXB0b3IsIGNvbnN0cmFpbnRzKSB7XHJcbiAgICBsb2cubG9nKCdhdHRhY2hpbmcgcmF3IHNvdXJjZVBhY2thZ2UgZnJvbTonLCBkZXNjcmlwdG9yLnNvdXJjZVBhY2thZ2VVUkwpO1xyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcclxuICAgICAgbGV0IHJldHJpZXZlUHJvbWlzZSA9IGNvbnN0cmFpbnRzICE9IHVuZGVmaW5lZCA/IHRoaXMuaHR0cFJlcXVlc3QucG9zdChkZXNjcmlwdG9yLnNvdXJjZVBhY2thZ2VVUkwsIHtib2R5OiBKU09OLnN0cmluZ2lmeShjb25zdHJhaW50cyl9KSA6IHRoaXMuaHR0cFJlcXVlc3QuZ2V0KGRlc2NyaXB0b3Iuc291cmNlUGFja2FnZVVSTCk7XHJcbiAgICAgIHJldHJpZXZlUHJvbWlzZS50aGVuKChzb3VyY2VQYWNrYWdlKSA9PiB7XHJcbiAgICAgICAgc291cmNlUGFja2FnZSA9IEpTT04ucGFyc2Uoc291cmNlUGFja2FnZSk7XHJcblxyXG4gICAgICAgIC8vZGVsZXRlIGRlc2NyaXB0b3Iuc291cmNlUGFja2FnZVVSTDtcclxuICAgICAgICAvL2xvZy5sb2coXCJhdHRhY2hpbmcgc291cmNlUGFja2FnZTpcIiwgc291cmNlUGFja2FnZSk7XHJcbiAgICAgICAgZGVzY3JpcHRvci5zb3VyY2VQYWNrYWdlID0gc291cmNlUGFja2FnZTtcclxuICAgICAgICByZXNvbHZlKGRlc2NyaXB0b3IpO1xyXG4gICAgICB9KS5jYXRjaCgocmVhc29uKSA9PiB7XHJcbiAgICAgICAgcmVqZWN0KHJlYXNvbik7XHJcbiAgICAgIH0pO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgICAqIEdldCBIeXBlcnR5RGVzY3JpcHRvclxyXG4gICAgICogQHBhcmFtIGh5cGVydHlVUkwgLSBlLmcuIG15ZG9tYWluLmNvbS8ud2VsbC1rbm93bi9oeXBlcnR5L015SHlwZXJ0eVxyXG4gICAgICogQHBhcmFtIHtib29sZWFufSBbZ2V0RnVsbF0gLSBib29sZWFuIHRvIGRlY2lkZSB0byBnZXQgdGhlIGRlc2NyaXB0b3Igd2l0aCB0aGUgc291cmNlUGFja2FnZSBvciAocG90ZW50aWFsbHkpIHdpdGhvdXRcclxuICAgICAqIEBwYXJhbSB7SlNPTn0gY29uc3RyYWludHMgLSBjb25zdHJhaW50cyBvYmplY3RcclxuICAgICAqIEByZXR1cm5zIHtQcm9taXNlfVxyXG4gICAgICovXHJcbiAgZ2V0SHlwZXJ0eURlc2NyaXB0b3IoaHlwZXJ0eVVSTCwgZ2V0RnVsbCA9IHRydWUsIGNvbnN0cmFpbnRzKSB7XHJcbiAgICByZXR1cm4gdGhpcy5nZXREZXNjcmlwdG9yKGh5cGVydHlVUkwsIHRoaXMuY3JlYXRlSHlwZXJ0eSwgZ2V0RnVsbCwgY29uc3RyYWludHMpXHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgICAqIEdldCBTdHViRGVzY3JpcHRvclxyXG4gICAgICogQHBhcmFtIHN0dWJVUkwgLSBlLmcuIG15ZG9tYWluLmNvbS8ud2VsbC1rbm93bi9wcm90b3N0dWIvTXlQcm90b3N0dWJcclxuICAgICAqIEBwYXJhbSB7Ym9vbGVhbn0gW2dldEZ1bGxdIC0gYm9vbGVhbiB0byBkZWNpZGUgdG8gZ2V0IHRoZSBkZXNjcmlwdG9yIHdpdGggdGhlIHNvdXJjZVBhY2thZ2Ugb3IgKHBvdGVudGlhbGx5KSB3aXRob3V0XHJcbiAgICAgKiBAcGFyYW0ge0pTT059IGNvbnN0cmFpbnRzIC0gY29uc3RyYWludHMgb2JqZWN0XHJcbiAgICAgKiBAcmV0dXJucyB7UHJvbWlzZX1cclxuICAgICAqL1xyXG4gIGdldFN0dWJEZXNjcmlwdG9yKHN0dWJVUkwsIGdldEZ1bGwgPSB0cnVlLCBjb25zdHJhaW50cykge1xyXG4gICAgcmV0dXJuIHRoaXMuZ2V0RGVzY3JpcHRvcihzdHViVVJMLCB0aGlzLmNyZWF0ZVN0dWIsIGdldEZ1bGwsIGNvbnN0cmFpbnRzKVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICAgKiBHZXQgUnVudGltZURlc2NyaXB0b3JcclxuICAgICAqIEBwYXJhbSBydW50aW1lVVJMIC0gZS5nLiBteWRvbWFpbi5jb20vLndlbGwta25vd24vcnVudGltZS9NeVJ1bnRpbWVcclxuICAgICAqIEBwYXJhbSB7Ym9vbGVhbn0gW2dldEZ1bGxdIC0gYm9vbGVhbiB0byBkZWNpZGUgdG8gZ2V0IHRoZSBkZXNjcmlwdG9yIHdpdGggdGhlIHNvdXJjZVBhY2thZ2Ugb3IgKHBvdGVudGlhbGx5KSB3aXRob3V0XHJcbiAgICAgKiBAcGFyYW0ge0pTT059IGNvbnN0cmFpbnRzIC0gY29uc3RyYWludHMgb2JqZWN0XHJcbiAgICAgKiBAcmV0dXJucyB7UHJvbWlzZX1cclxuICAgICAqL1xyXG4gIGdldFJ1bnRpbWVEZXNjcmlwdG9yKHJ1bnRpbWVVUkwsIGdldEZ1bGwgPSB0cnVlLCBjb25zdHJhaW50cykge1xyXG4gICAgcmV0dXJuIHRoaXMuZ2V0RGVzY3JpcHRvcihydW50aW1lVVJMLCB0aGlzLmNyZWF0ZVJ1bnRpbWVEZXNjcmlwdG9yLCBnZXRGdWxsLCBjb25zdHJhaW50cylcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAgICogR2V0IERhdGFTY2hlbWFEZXNjcmlwdG9yXHJcbiAgICAgKiBAcGFyYW0gZGF0YVNjaGVtYVVSTCAtIGUuZy4gbXlkb21haW4uY29tLy53ZWxsLWtub3duL2RhdGFzY2hlbWEvTXlEYXRhU2NoZW1hXHJcbiAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IFtnZXRGdWxsXSAtIGJvb2xlYW4gdG8gZGVjaWRlIHRvIGdldCB0aGUgZGVzY3JpcHRvciB3aXRoIHRoZSBzb3VyY2VQYWNrYWdlIG9yIChwb3RlbnRpYWxseSkgd2l0aG91dFxyXG4gICAgICogQHBhcmFtIHtKU09OfSBjb25zdHJhaW50cyAtIGNvbnN0cmFpbnRzIG9iamVjdFxyXG4gICAgICogQHJldHVybnMge1Byb21pc2V9XHJcbiAgICAgKi9cclxuICBnZXREYXRhU2NoZW1hRGVzY3JpcHRvcihkYXRhU2NoZW1hVVJMLCBnZXRGdWxsID0gdHJ1ZSwgY29uc3RyYWludHMpIHtcclxuXHJcbiAgICAvLyAgICByZXR1cm4gdGhpcy5nZXREZXNjcmlwdG9yKGRhdGFTY2hlbWFVUkwsIHRoaXMuY3JlYXRlRGF0YVNjaGVtYSwgZ2V0RnVsbCwgY29uc3RyYWludHMpXHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUpPT4ge1xyXG4gICAgICBsZXQgc2NoZW1hID0gZGF0YVNjaGVtYVVSTC5zcGxpdCgnL2RhdGFzY2hlbWEvJylbMV07XHJcbiAgICAgIGxvZy5sb2coJ1tSdW50aW1lQ2F0YWxvZ3VlLmdldERhdGFTY2hlbWFEZXNjcmlwdG9yXSBzY2hlbWEgJywgc2NoZW1hKTtcclxuICAgICAgbGV0IGRlc2NyaXB0b3IgPSB7XHJcbiAgICAgICAgc291cmNlUGFja2FnZToge1xyXG4gICAgICAgICAgc291cmNlQ29kZToge1xyXG4gICAgICAgICAgICBwcm9wZXJ0aWVzOiB7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgfVxyXG4gICAgICB9O1xyXG4gICAgLy8gICAgICBsZXQgc2NoZW1lID0gcHJvcGVydGllcy5zY2hlbWUgPyBwcm9wZXJ0aWVzLnNjaGVtZS5jbyA6IFtdO1xyXG4gIFxyXG4gICAgICBzd2l0Y2ggKHNjaGVtYSkge1xyXG4gICAgICAgIGNhc2UgJ0NvbnRleHQnOlxyXG4gICAgICAgIGNhc2UgJ0NvbnRleHRSZXBvcnRlcic6XHJcbiAgICAgICAgY2FzZSAnQ29udGV4dE9ic2VydmVyJzpcclxuICAgICAgICAgIGRlc2NyaXB0b3Iuc291cmNlUGFja2FnZS5zb3VyY2VDb2RlLnByb3BlcnRpZXMuc2NoZW1lID0gJ2NvbnRleHQnO1xyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSAnQ29ubmVjdGlvbic6XHJcbiAgICAgICAgICBkZXNjcmlwdG9yLnNvdXJjZVBhY2thZ2Uuc291cmNlQ29kZS5wcm9wZXJ0aWVzLnNjaGVtZSA9ICdjb25uZWN0aW9uJztcclxuICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgJ1dhbGxldERhdGEnOlxyXG4gICAgICAgICAgZGVzY3JpcHRvci5zb3VyY2VQYWNrYWdlLnNvdXJjZUNvZGUucHJvcGVydGllcy5zY2hlbWUgPSAnd2FsbGV0RGF0YSc7XHJcbiAgICAgICAgICBicmVhaztcclxuICAgICAgICBjYXNlICdDb21tdW5pY2F0aW9uJzpcclxuICAgICAgICAgIGRlc2NyaXB0b3Iuc291cmNlUGFja2FnZS5zb3VyY2VDb2RlLnByb3BlcnRpZXMuc2NoZW1lID0gJ2NvbW0nO1xyXG4gICAgICAgICAgZGVzY3JpcHRvci5zb3VyY2VQYWNrYWdlLnNvdXJjZUNvZGUucHJvcGVydGllcy5jaGlsZHJlbnMgPSBbJ3Jlc291cmNlcyddO1xyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSAnSGVsbG9Xb3JsZERhdGFTY2hlbWEnOlxyXG4gICAgICAgICAgZGVzY3JpcHRvci5zb3VyY2VQYWNrYWdlLnNvdXJjZUNvZGUucHJvcGVydGllcy5zY2hlbWUgPSAnaGVsbG8nO1xyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgIGRlc2NyaXB0b3Iuc291cmNlUGFja2FnZS5zb3VyY2VDb2RlLnByb3BlcnRpZXMuc2NoZW1lID0gJ3Jlc291cmNlJztcclxuICAgICAgICAgIGRlc2NyaXB0b3Iuc291cmNlUGFja2FnZS5zb3VyY2VDb2RlLnByb3BlcnRpZXMuY2hpbGRyZW5zID0gW107XHJcbiAgICAgICAgICBicmVhaztcclxuICAgICAgfVxyXG4gICAgICByZXNvbHZlKGRlc2NyaXB0b3IpO1xyXG5cclxuICAgIH0pO1xyXG5cclxuXHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgICAqIEdldCBJRFBQcm94eURlc2NyaXB0b3JcclxuICAgICAqIEBwYXJhbSBpZHBQcm94eVVSTCAtIGUuZy4gbXlkb21haW4uY29tLy53ZWxsLWtub3duL2lkcC1wcm94eS9NeVByb3h5XHJcbiAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IFtnZXRGdWxsXSAtIGJvb2xlYW4gdG8gZGVjaWRlIHRvIGdldCB0aGUgZGVzY3JpcHRvciB3aXRoIHRoZSBzb3VyY2VQYWNrYWdlIG9yIChwb3RlbnRpYWxseSkgd2l0aG91dFxyXG4gICAgICogQHBhcmFtIHtKU09OfSBjb25zdHJhaW50cyAtIGNvbnN0cmFpbnRzIG9iamVjdFxyXG4gICAgICogQHJldHVybnMge1Byb21pc2V9XHJcbiAgICAgKi9cclxuICBnZXRJZHBQcm94eURlc2NyaXB0b3IoaWRwUHJveHlVUkwsIGdldEZ1bGwgPSB0cnVlLCBjb25zdHJhaW50cykge1xyXG4gICAgcmV0dXJuIHRoaXMuZ2V0RGVzY3JpcHRvcihpZHBQcm94eVVSTCwgdGhpcy5jcmVhdGVJZHBQcm94eSwgZ2V0RnVsbCwgY29uc3RyYWludHMpXHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgICAqIENyZWF0ZSBIeXBlcnR5RGVzY3JpcHRvciBiYXNlZCBvbiByYXcgb2JqZWN0IHRoYXQgY29udGFpbnMgaXRzIGF0dHJpYnV0ZXNcclxuICAgICAqIEBwYXJhbSB7SlNPTn0gcmF3SHlwZXJ0eVxyXG4gICAgICogQHJldHVybnMge0h5cGVydHlEZXNjcmlwdG9yfVxyXG4gICAgICovXHJcbiAgY3JlYXRlSHlwZXJ0eShyYXdIeXBlcnR5KSB7XHJcbiAgICAvL2xvZy5sb2coXCJjcmVhdGVIeXBlcnR5OlwiLCByYXdIeXBlcnR5KTtcclxuICAgIC8vIGNyZWF0ZSB0aGUgZGVzY3JpcHRvclxyXG4gICAgbGV0IGh5cGVydHkgPSB0aGlzLl9mYWN0b3J5LmNyZWF0ZUh5cGVydHlEZXNjcmlwdG9yT2JqZWN0KFxyXG4gICAgICByYXdIeXBlcnR5WydjZ3VpZCddLFxyXG4gICAgICByYXdIeXBlcnR5Wyd2ZXJzaW9uJ10sXHJcbiAgICAgIHJhd0h5cGVydHlbJ29iamVjdE5hbWUnXSxcclxuICAgICAgcmF3SHlwZXJ0eVsnZGVzY3JpcHRpb24nXSxcclxuICAgICAgcmF3SHlwZXJ0eVsnbGFuZ3VhZ2UnXSxcclxuICAgICAgcmF3SHlwZXJ0eVsnc291cmNlUGFja2FnZVVSTCddLFxyXG4gICAgICByYXdIeXBlcnR5Wyd0eXBlJ10gfHwgcmF3SHlwZXJ0eVsnaHlwZXJ0eVR5cGUnXSxcclxuICAgICAgcmF3SHlwZXJ0eVsnZGF0YU9iamVjdHMnXVxyXG4gICAgKTtcclxuXHJcbiAgICAvL2xvZy5sb2coXCJmYWN0b3J5IHJldHVybmVkOlwiLCBoeXBlcnR5KTtcclxuXHJcbiAgICAvLyBvcHRpb25hbCBmaWVsZHNcclxuICAgIGh5cGVydHkuY29uZmlndXJhdGlvbiA9IHJhd0h5cGVydHlbJ2NvbmZpZ3VyYXRpb24nXTtcclxuICAgIGh5cGVydHkuY29uc3RyYWludHMgPSByYXdIeXBlcnR5Wydjb25zdHJhaW50cyddO1xyXG4gICAgaHlwZXJ0eS5tZXNzYWdlU2NoZW1hID0gcmF3SHlwZXJ0eVsnbWVzc2FnZVNjaGVtYSddO1xyXG4gICAgaHlwZXJ0eS5wb2xpY2llcyA9IHJhd0h5cGVydHlbJ3BvbGljaWVzJ107XHJcbiAgICBoeXBlcnR5LnNpZ25hdHVyZSA9IHJhd0h5cGVydHlbJ3NpZ25hdHVyZSddO1xyXG5cclxuICAgIC8vIHBhcnNlIGFuZCBhdHRhY2ggc291cmNlUGFja2FnZVxyXG4gICAgbGV0IHNvdXJjZVBhY2thZ2UgPSByYXdIeXBlcnR5Wydzb3VyY2VQYWNrYWdlJ107XHJcbiAgICBpZiAoc291cmNlUGFja2FnZSkge1xyXG4gICAgICBoeXBlcnR5LnNvdXJjZVBhY2thZ2UgPSB0aGlzLmNyZWF0ZVNvdXJjZVBhY2thZ2Uoc291cmNlUGFja2FnZSk7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIGh5cGVydHk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgICAqIENyZWF0ZSBQcm90b2NvbFN0dWJEZXNjcmlwdG9yIGJhc2VkIG9uIHJhdyBvYmplY3QgdGhhdCBjb250YWlucyBpdHMgYXR0cmlidXRlc1xyXG4gICAgICogQHBhcmFtIHJhd1N0dWJcclxuICAgICAqIEByZXR1cm5zIHtQcm90b2NvbFN0dWJEZXNjcmlwdG9yfVxyXG4gICAgICovXHJcbiAgY3JlYXRlU3R1YihyYXdTdHViKSB7XHJcbiAgICAvLyBsb2cubG9nKFwiY3JlYXRpbmcgc3R1YiBkZXNjcmlwdG9yIGJhc2VkIG9uOiBcIiwgcmF3U3R1Yik7XHJcblxyXG4gICAgLy8gY3JlYXRlIHRoZSBkZXNjcmlwdG9yXHJcbiAgICBsZXQgc3R1YiA9IHRoaXMuX2ZhY3RvcnkuY3JlYXRlUHJvdG9TdHViRGVzY3JpcHRvck9iamVjdChcclxuICAgICAgcmF3U3R1YlsnY2d1aWQnXSxcclxuICAgICAgcmF3U3R1YlsndmVyc2lvbiddLFxyXG4gICAgICByYXdTdHViWydvYmplY3ROYW1lJ10sXHJcbiAgICAgIHJhd1N0dWJbJ2Rlc2NyaXB0aW9uJ10sXHJcbiAgICAgIHJhd1N0dWJbJ2xhbmd1YWdlJ10sXHJcbiAgICAgIHJhd1N0dWJbJ3NvdXJjZVBhY2thZ2VVUkwnXSxcclxuICAgICAgcmF3U3R1YlsnbWVzc2FnZVNjaGVtYXMnXSxcclxuICAgICAgcmF3U3R1YlsnY29uZmlndXJhdGlvbiddLFxyXG4gICAgICByYXdTdHViWydjb25zdHJhaW50cyddLFxyXG4gICAgICByYXdTdHViWydoeXBlcnR5VHlwZSddLFxyXG4gICAgICByYXdTdHViWydkYXRhT2JqZWN0cyddLFxyXG4gICAgICByYXdTdHViWydpbnRlcndvcmtpbmcnXSxcclxuICAgICAgcmF3U3R1YlsnaWRwUHJveHknXSxcclxuICAgICAgcmF3U3R1YlsnbXV0dWFsQXV0aGVudGljYXRpb24nXVxyXG4gICAgKTtcclxuXHJcbiAgICAvLyBvcHRpb25hbCBmaWVsZHNcclxuICAgIHN0dWIuc2lnbmF0dXJlID0gcmF3U3R1Ylsnc2lnbmF0dXJlJ107XHJcblxyXG4gICAgLy8gcGFyc2UgYW5kIGF0dGFjaCB0aGUgc291cmNlUGFja2FnZVxyXG4gICAgbGV0IHNvdXJjZVBhY2thZ2UgPSByYXdTdHViWydzb3VyY2VQYWNrYWdlJ107XHJcbiAgICBpZiAoc291cmNlUGFja2FnZSkge1xyXG4gICAgICBzdHViLnNvdXJjZVBhY2thZ2UgPSB0aGlzLmNyZWF0ZVNvdXJjZVBhY2thZ2Uoc291cmNlUGFja2FnZSk7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHN0dWI7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgICAqIENyZWF0ZSBIeXBlcnR5UnVudGltZURlc2NyaXB0b3IgYmFzZWQgb24gcmF3IG9iamVjdCB0aGF0IGNvbnRhaW5zIGl0cyBhdHRyaWJ1dGVzXHJcbiAgICAgKiBAcGFyYW0gcmF3UnVudGltZVxyXG4gICAgICogQHJldHVybnMge0h5cGVydHlSdW50aW1lRGVzY3JpcHRvcn1cclxuICAgICAqL1xyXG4gIGNyZWF0ZVJ1bnRpbWVEZXNjcmlwdG9yKHJhd1J1bnRpbWUpIHtcclxuICAgIC8vIHBhcnNlIGNhcGFiaWxpdGllcyBmaXJzdFxyXG4gICAgdHJ5IHtcclxuICAgICAgcmF3UnVudGltZVsnaHlwZXJ0eUNhcGFiaWxpdGllcyddID0gSlNPTi5wYXJzZShyYXdSdW50aW1lWydoeXBlcnR5Q2FwYWJpbGl0aWVzJ10pO1xyXG4gICAgICByYXdSdW50aW1lWydwcm90b2NvbENhcGFiaWxpdGllcyddID0gSlNPTi5wYXJzZShyYXdSdW50aW1lWydwcm90b2NvbENhcGFiaWxpdGllcyddKTtcclxuICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgLy8gYWxyZWFkeSBqc29uIG9iamVjdFxyXG4gICAgfVxyXG5cclxuICAgIC8vbG9nLmxvZyhcImNyZWF0aW5nIHJ1bnRpbWUgZGVzY3JpcHRvciBiYXNlZCBvbjogXCIsIHJhd1J1bnRpbWUpO1xyXG5cclxuXHJcbiAgICAvLyBjcmVhdGUgdGhlIGRlc2NyaXB0b3JcclxuICAgIGxldCBydW50aW1lID0gdGhpcy5fZmFjdG9yeS5jcmVhdGVIeXBlcnR5UnVudGltZURlc2NyaXB0b3JPYmplY3QoXHJcbiAgICAgIHJhd1J1bnRpbWVbJ2NndWlkJ10sXHJcbiAgICAgIHJhd1J1bnRpbWVbJ3ZlcnNpb24nXSxcclxuICAgICAgcmF3UnVudGltZVsnb2JqZWN0TmFtZSddLFxyXG4gICAgICByYXdSdW50aW1lWydkZXNjcmlwdGlvbiddLFxyXG4gICAgICByYXdSdW50aW1lWydsYW5ndWFnZSddLFxyXG4gICAgICByYXdSdW50aW1lWydzb3VyY2VQYWNrYWdlVVJMJ10sXHJcbiAgICAgIHJhd1J1bnRpbWVbJ3R5cGUnXSB8fCByYXdSdW50aW1lWydydW50aW1lVHlwZSddLFxyXG4gICAgICByYXdSdW50aW1lWydoeXBlcnR5Q2FwYWJpbGl0aWVzJ10sXHJcbiAgICAgIHJhd1J1bnRpbWVbJ3Byb3RvY29sQ2FwYWJpbGl0aWVzJ10sXHJcbiAgICAgIHJhd1J1bnRpbWVbJ3AycEhhbmRsZXJTdHViJ10sXHJcbiAgICAgIHJhd1J1bnRpbWVbJ3AycFJlcXVlc3RlclN0dWInXVxyXG4gICAgKTtcclxuXHJcbiAgICAvLyBvcHRpb25hbCBmaWVsZHNcclxuICAgIHJ1bnRpbWUuc2lnbmF0dXJlID0gcmF3UnVudGltZVsnc2lnbmF0dXJlJ107XHJcblxyXG4gICAgLy8gcGFyc2UgYW5kIGF0dGFjaCBzb3VyY2VQYWNrYWdlXHJcbiAgICBsZXQgc291cmNlUGFja2FnZSA9IHJhd1J1bnRpbWVbJ3NvdXJjZVBhY2thZ2UnXTtcclxuICAgIGlmIChzb3VyY2VQYWNrYWdlKSB7XHJcbiAgICAgIC8vIGxvZy5sb2coXCJydW50aW1lIGhhcyBzb3VyY2VQYWNrYWdlOlwiLCBzb3VyY2VQYWNrYWdlKTtcclxuICAgICAgcnVudGltZS5zb3VyY2VQYWNrYWdlID0gdGhpcy5jcmVhdGVTb3VyY2VQYWNrYWdlKHNvdXJjZVBhY2thZ2UpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHJ1bnRpbWU7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgICAqIENyZWF0ZSBEYXRhT2JqZWN0U2NoZW1hIGJhc2VkIG9uIHJhdyBvYmplY3QgdGhhdCBjb250YWlucyBpdHMgYXR0cmlidXRlc1xyXG4gICAgICogQHBhcmFtIHJhd1NjaGVtYVxyXG4gICAgICogQHJldHVybnMge0RhdGFPYmplY3RTY2hlbWF9XHJcbiAgICAgKi9cclxuICBjcmVhdGVEYXRhU2NoZW1hKHJhd1NjaGVtYSkge1xyXG4gICAgLy9sb2cubG9nKFwiY3JlYXRpbmcgZGF0YVNjaGVtYSBiYXNlZCBvbjogXCIsIHJhd1NjaGVtYSk7XHJcblxyXG4gICAgbGV0IGRhdGFTY2hlbWE7XHJcblxyXG4gICAgLy9sb2cubG9nKCcxLiBjcmVhdGVNZXNzYWdlRGF0YU9iamVjdFNjaGVtYTogJywgcmF3U2NoZW1hW1wiYWNjZXNzQ29udHJvbFBvbGljeVwiXSk7XHJcbiAgICAvL2xvZy5sb2coJzIuIGNyZWF0ZU1lc3NhZ2VEYXRhT2JqZWN0U2NoZW1hOiAnLCByYXdTY2hlbWFbXCJzY2hlbWVcIl0pO1xyXG4gICAgaWYgKHJhd1NjaGVtYVsnYWNjZXNzQ29udHJvbFBvbGljeSddICYmIHJhd1NjaGVtYVsnc2NoZW1lJ10pIHtcclxuICAgICAgZGF0YVNjaGVtYSA9IHRoaXMuX2ZhY3RvcnkuY3JlYXRlSHlwZXJ0eURhdGFPYmplY3RTY2hlbWEoXHJcbiAgICAgICAgcmF3U2NoZW1hWydjZ3VpZCddLFxyXG4gICAgICAgIHJhd1NjaGVtYVsndmVyc2lvbiddLFxyXG4gICAgICAgIHJhd1NjaGVtYVsnb2JqZWN0TmFtZSddLFxyXG4gICAgICAgIHJhd1NjaGVtYVsnZGVzY3JpcHRpb24nXSxcclxuICAgICAgICByYXdTY2hlbWFbJ2xhbmd1YWdlJ10sXHJcbiAgICAgICAgcmF3U2NoZW1hWydzb3VyY2VQYWNrYWdlVVJMJ10sXHJcbiAgICAgICAgcmF3U2NoZW1hWydhY2Nlc3NDb250cm9sUG9saWN5J10sXHJcbiAgICAgICAgcmF3U2NoZW1hWydzY2hlbWUnXVxyXG4gICAgICApXHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAvL2xvZy5sb2coJzMuIGNyZWF0ZU1lc3NhZ2VEYXRhT2JqZWN0U2NoZW1hOiAnLCByYXdTY2hlbWEpO1xyXG4gICAgICBkYXRhU2NoZW1hID0gdGhpcy5fZmFjdG9yeS5jcmVhdGVNZXNzYWdlRGF0YU9iamVjdFNjaGVtYShcclxuICAgICAgICByYXdTY2hlbWFbJ2NndWlkJ10sXHJcbiAgICAgICAgcmF3U2NoZW1hWyd2ZXJzaW9uJ10sXHJcbiAgICAgICAgcmF3U2NoZW1hWydvYmplY3ROYW1lJ10sXHJcbiAgICAgICAgcmF3U2NoZW1hWydkZXNjcmlwdGlvbiddLFxyXG4gICAgICAgIHJhd1NjaGVtYVsnbGFuZ3VhZ2UnXSxcclxuICAgICAgICByYXdTY2hlbWFbJ3NvdXJjZVBhY2thZ2VVUkwnXVxyXG4gICAgICApXHJcbiAgICB9XHJcblxyXG4gICAgLy8gb3B0aW9uYWwgZmllbGRzXHJcbiAgICBkYXRhU2NoZW1hLnNpZ25hdHVyZSA9IHJhd1NjaGVtYVsnc2lnbmF0dXJlJ107XHJcblxyXG4gICAgLy8gcGFyc2UgYW5kIGF0dGFjaCBzb3VyY2VQYWNrYWdlXHJcbiAgICBsZXQgc291cmNlUGFja2FnZSA9IHJhd1NjaGVtYVsnc291cmNlUGFja2FnZSddO1xyXG4gICAgaWYgKHNvdXJjZVBhY2thZ2UpIHtcclxuICAgICAgLy9sb2cubG9nKFwiZGF0YVNjaGVtYSBoYXMgc291cmNlUGFja2FnZTpcIiwgc291cmNlUGFja2FnZSk7XHJcbiAgICAgIGRhdGFTY2hlbWEuc291cmNlUGFja2FnZSA9IHRoaXMuY3JlYXRlU291cmNlUGFja2FnZShzb3VyY2VQYWNrYWdlKTtcclxuXHJcbiAgICAgIHRyeSB7XHJcbiAgICAgICAgZGF0YVNjaGVtYS5zb3VyY2VQYWNrYWdlLnNvdXJjZUNvZGUgPSBKU09OLnBhcnNlKGRhdGFTY2hlbWEuc291cmNlUGFja2FnZS5zb3VyY2VDb2RlKTtcclxuICAgICAgfSBjYXRjaCAoZSkge1xyXG4gICAgICAgIGxvZy5sb2coJ0RhdGFTY2hlbWEgU291cmNlIGNvZGUgaXMgYWxyZWFkeSBwYXJzZWQnKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgcmV0dXJuIGRhdGFTY2hlbWE7XHJcblxyXG4gICAgfVxyXG5cclxuICAgIC8vbG9nLmxvZyhcImNyZWF0ZWQgZGF0YVNjaGVtYSBkZXNjcmlwdG9yIG9iamVjdDpcIiwgZGF0YVNjaGVtYSk7XHJcbiAgICByZXR1cm4gZGF0YVNjaGVtYTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAgICogQ3JlYXRlIFByb3RvY29sU3R1YkRlc2NyaXB0b3IgYmFzZWQgb24gcmF3IG9iamVjdCB0aGF0IGNvbnRhaW5zIGl0cyBhdHRyaWJ1dGVzXHJcbiAgICAgKiBAcGFyYW0gcmF3UHJveHlcclxuICAgICAqIEByZXR1cm5zIHtQcm90b2NvbFN0dWJEZXNjcmlwdG9yfVxyXG4gICAgICovXHJcbiAgY3JlYXRlSWRwUHJveHkocmF3UHJveHkpIHtcclxuICAgIC8vIGxvZy5sb2coXCJjcmVhdGluZyBpZHBwcm94eSBkZXNjcmlwdG9yIGJhc2VkIG9uOiBcIiwgcmF3UHJveHkpO1xyXG5cclxuICAgIC8vIGNyZWF0ZSB0aGUgZGVzY3JpcHRvclxyXG4gICAgbGV0IGlkcHByb3h5ID0gdGhpcy5fZmFjdG9yeS5jcmVhdGVQcm90b1N0dWJEZXNjcmlwdG9yT2JqZWN0KFxyXG4gICAgICByYXdQcm94eVsnY2d1aWQnXSxcclxuICAgICAgcmF3UHJveHlbJ3ZlcnNpb24nXSxcclxuICAgICAgcmF3UHJveHlbJ29iamVjdE5hbWUnXSxcclxuICAgICAgcmF3UHJveHlbJ2Rlc2NyaXB0aW9uJ10sXHJcbiAgICAgIHJhd1Byb3h5WydsYW5ndWFnZSddLFxyXG4gICAgICByYXdQcm94eVsnc291cmNlUGFja2FnZVVSTCddLFxyXG4gICAgICByYXdQcm94eVsnbWVzc2FnZVNjaGVtYXMnXSxcclxuICAgICAgcmF3UHJveHlbJ2NvbmZpZ3VyYXRpb24nXSxcclxuICAgICAgcmF3UHJveHlbJ2NvbnN0cmFpbnRzJ10sXHJcbiAgICAgIHJhd1Byb3h5WydoeXBlcnR5VHlwZSddLFxyXG4gICAgICByYXdQcm94eVsnZGF0YU9iamVjdHMnXSxcclxuICAgICAgcmF3UHJveHlbJ2ludGVyd29ya2luZyddLFxyXG4gICAgICByYXdQcm94eVsnaWRwUHJveHknXSxcclxuICAgICAgcmF3UHJveHlbJ211dHVhbEF1dGhlbnRpY2F0aW9uJ11cclxuICAgICk7XHJcblxyXG4gICAgLy8gb3B0aW9uYWwgZmllbGRzXHJcbiAgICBpZHBwcm94eS5zaWduYXR1cmUgPSByYXdQcm94eVsnc2lnbmF0dXJlJ107XHJcblxyXG4gICAgLy8gcGFyc2UgYW5kIGF0dGFjaCB0aGUgc291cmNlUGFja2FnZVxyXG4gICAgbGV0IHNvdXJjZVBhY2thZ2UgPSByYXdQcm94eVsnc291cmNlUGFja2FnZSddO1xyXG4gICAgaWYgKHNvdXJjZVBhY2thZ2UpIHtcclxuICAgICAgc291cmNlUGFja2FnZSA9IHRoaXMuY3JlYXRlU291cmNlUGFja2FnZShzb3VyY2VQYWNrYWdlKTtcclxuICAgICAgaWRwcHJveHkuc291cmNlUGFja2FnZSA9IHNvdXJjZVBhY2thZ2U7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIGlkcHByb3h5O1xyXG4gIH1cclxuXHJcbiAgY3JlYXRlU291cmNlUGFja2FnZShzcCkge1xyXG4gICAgLy9sb2cubG9nKFwiY3JlYXRlU291cmNlUGFja2FnZTpcIiwgc3ApO1xyXG5cclxuICAgIC8vIGNoZWNrIGVuY29kaW5nXHJcbiAgICBpZiAoc3BbJ2VuY29kaW5nJ10gPT09ICdiYXNlNjQnKSB7XHJcbiAgICAgIHNwWydzb3VyY2VDb2RlJ10gPSB0aGlzLmF0b2Ioc3BbJ3NvdXJjZUNvZGUnXSk7XHJcbiAgICAgIHNwWydlbmNvZGluZyddID0gJ3V0Zi04JztcclxuICAgIH1cclxuXHJcbiAgICBsZXQgc291cmNlUGFja2FnZSA9IHRoaXMuX2ZhY3RvcnkuY3JlYXRlU291cmNlUGFja2FnZShzcFsnc291cmNlQ29kZUNsYXNzbmFtZSddLCBzcFsnc291cmNlQ29kZSddKTtcclxuICAgIGlmIChzcFsnZW5jb2RpbmcnXSlcclxuICAgICAgc291cmNlUGFja2FnZS5lbmNvZGluZyA9IHNwWydlbmNvZGluZyddO1xyXG5cclxuICAgIGlmIChzcFsnc2lnbmF0dXJlJ10pXHJcbiAgICAgIHNvdXJjZVBhY2thZ2Uuc2lnbmF0dXJlID0gc3BbJ3NpZ25hdHVyZSddO1xyXG5cclxuICAgIHJldHVybiBzb3VyY2VQYWNrYWdlO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICAgKiBHZXQgc291cmNlIFBhY2thZ2UgZnJvbSBhIFVSTFxyXG4gICAgICogQHBhcmFtIHNvdXJjZVBhY2thZ2VVUkwgLSBlLmcuIG15ZG9tYWluLmNvbS8ud2VsbC1rbm93bi9oeXBlcnR5L015SHlwZXJ0eS9zb3VyY2VQYWNrYWdlXHJcbiAgICAgKiBAcmV0dXJucyB7UHJvbWlzZX1cclxuICAgICAqL1xyXG4gIGdldFNvdXJjZVBhY2thZ2VGcm9tVVJMKHNvdXJjZVBhY2thZ2VVUkwpIHtcclxuICAgIGxvZy5sb2coJ2dldHRpbmcgc291cmNlUGFja2FnZSBmcm9tOicsIHNvdXJjZVBhY2thZ2VVUkwpO1xyXG5cclxuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XHJcbiAgICAgIHRoaXMuaHR0cFJlcXVlc3QuZ2V0KHNvdXJjZVBhY2thZ2VVUkwpLnRoZW4oKHJlc3VsdCkgPT4ge1xyXG4gICAgICAgIC8vbG9nLmxvZyhcImdvdCByYXcgc291cmNlUGFja2FnZTpcIiwgcmVzdWx0KTtcclxuICAgICAgICBpZiAocmVzdWx0WydFUlJPUiddKSB7XHJcbiAgICAgICAgICAvLyBUT0RPIGhhbmRsZSBlcnJvciBwcm9wZXJseVxyXG4gICAgICAgICAgcmVqZWN0KHJlc3VsdCk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIHJlc3VsdCA9IEpTT04ucGFyc2UocmVzdWx0KTtcclxuICAgICAgICAgIGxldCBzb3VyY2VQYWNrYWdlID0gdGhpcy5jcmVhdGVTb3VyY2VQYWNrYWdlKHJlc3VsdCk7XHJcbiAgICAgICAgICByZXNvbHZlKHNvdXJjZVBhY2thZ2UpO1xyXG4gICAgICAgIH1cclxuICAgICAgfSkuY2F0Y2goKHJlYXNvbikgPT4ge1xyXG4gICAgICAgIHJlamVjdChyZWFzb24pO1xyXG4gICAgICB9KTtcclxuXHJcbiAgICB9KTtcclxuXHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgICAqIFJldHVybnMgdGhlIHNvdXJjZUNvZGUgb2YgYSBnaXZlbiBkZXNjcmlwdG9yXHJcbiAgICAgKiBAcGFyYW0ge0NhdGFsb2d1ZURhdGFPYmplY3R9IGRlc2NyaXB0b3IgLSBDYXRhbG9ndWUgT2JqZWN0IHRoYXQgd2FzIHJldHJpZXZlZCB1c2luZyBlLmcuIGdldEh5cGVydHlEZXNjcmlwdG9yKClcclxuICAgICAqIEByZXR1cm5zIHtQcm9taXNlfVxyXG4gICAgICovXHJcbiAgZ2V0U291cmNlQ29kZUZyb21EZXNjcmlwdG9yKGRlc2NyaXB0b3IpIHtcclxuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XHJcbiAgICAgIGlmIChkZXNjcmlwdG9yLnNvdXJjZVBhY2thZ2UpIHtcclxuICAgICAgICAvL2xvZy5sb2coXCJkZXNjcmlwdG9yIGhhcyBzb3VyY2VQYWNrYWdlXCIpO1xyXG4gICAgICAgIC8vbG9nLmxvZyhcInJldHVybmluZyBzb3VyY2VDb2RlOlwiLCBkZXNjcmlwdG9yLnNvdXJjZVBhY2thZ2Uuc291cmNlQ29kZSk7XHJcbiAgICAgICAgcmVzb2x2ZShkZXNjcmlwdG9yLnNvdXJjZVBhY2thZ2Uuc291cmNlQ29kZSk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgdGhpcy5zdG9yYWdlTWFuYWdlci5nZXRWZXJzaW9uKGRlc2NyaXB0b3Iuc291cmNlUGFja2FnZVVSTCArICcvc291cmNlQ29kZScpLnRoZW4oKGRiVmVyc2lvbikgPT4ge1xyXG4gICAgICAgICAgaWYgKGRiVmVyc2lvbiA+PSBkZXNjcmlwdG9yLnZlcnNpb24pIHtcclxuICAgICAgICAgICAgbG9nLmxvZygncmV0dXJuaW5nIGNhY2hlZCB2ZXJzaW9uIGZyb20gc3RvcmFnZU1hbmFnZXInKTtcclxuICAgICAgICAgICAgdGhpcy5zdG9yYWdlTWFuYWdlci5nZXQoZGVzY3JpcHRvci5zb3VyY2VQYWNrYWdlVVJMICsgJy9zb3VyY2VDb2RlJykudGhlbigoc291cmNlQ29kZSkgPT4ge1xyXG4gICAgICAgICAgICAgIHJlc29sdmUoc291cmNlQ29kZSk7XHJcbiAgICAgICAgICAgIH0pLmNhdGNoKChyZWFzb24pID0+IHtcclxuICAgICAgICAgICAgICByZWplY3QocmVhc29uKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLmh0dHBSZXF1ZXN0LmdldChkZXNjcmlwdG9yLnNvdXJjZVBhY2thZ2VVUkwgKyAnL3NvdXJjZUNvZGUnKS50aGVuKChzb3VyY2VDb2RlKSA9PiB7XHJcbiAgICAgICAgICAgICAgaWYgKHNvdXJjZUNvZGVbJ0VSUk9SJ10pIHtcclxuICAgICAgICAgICAgICAgIC8vIFRPRE8gaGFuZGxlIGVycm9yIHByb3Blcmx5XHJcbiAgICAgICAgICAgICAgICByZWplY3Qoc291cmNlQ29kZSk7XHJcbiAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuc3RvcmFnZU1hbmFnZXIuc2V0KGRlc2NyaXB0b3Iuc291cmNlUGFja2FnZVVSTCArICcvc291cmNlQ29kZScsIGRlc2NyaXB0b3IudmVyc2lvbiwgc291cmNlQ29kZSk7XHJcbiAgICAgICAgICAgICAgICByZXNvbHZlKHNvdXJjZUNvZGUpO1xyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSkuY2F0Y2goKHJlYXNvbikgPT4ge1xyXG4gICAgICAgICAgICAgIHJlamVjdChyZWFzb24pO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9KS5jYXRjaCgocmVhc29uKSA9PiB7XHJcbiAgICAgICAgICByZWplY3QocmVhc29uKTtcclxuICAgICAgICB9KTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgICAqIFJldHVybnMgdGhlIGxpc3Qgb2YgYXZhaWxhYmxlIGNhdGFsb2d1ZSBvYmplY3RzIGZvciB0aGUgZ2l2ZW4gXCJ0eXBlIFVSTFwiLFxyXG4gICAgICogaS5lLiBhIGNhdGFsb2d1ZSBVUkwgdGhhdCBzcGVjaWZpZXMgYSB0eXBlLCBidXQgbm8gY2F0YWxvZ3VlIG9iamVjdCBuYW1lLlxyXG4gICAgICogQHBhcmFtIHR5cGVVUkwgLSBVUkwgcG9pbnRpbmcgdG8gdGhlIGNhdGFsb2d1ZSBvYmplY3QgdHlwZSB5b3Ugd2FudCBhIGxpc3Qgb2YgYXZhaWxhYmxlIG9iamVjdHMgZm9yLFxyXG4gICAgICogZS5nLiBoeXBlcnR5LWNhdGFsb2d1ZTovL2NhdGFsb2d1ZS5mb2t1cy5mcmF1bmhvZmVyLmRlLy53ZWxsLWtub3duL2lkcC1wcm94eVxyXG4gICAgICogQHBhcmFtIHtKU09OfSBjb25zdHJhaW50cyAtIGNvbnN0cmFpbnRzIG9iamVjdFxyXG4gICAgICogQHJldHVybnMge1Byb21pc2V9IHR5cGVMaXN0UHJvbWlzZSAtIFByb21pc2UgdGhhdCBmdWxmaWxscyB3aXRoIHRoZSBsaXN0IG9mIGF2YWlsYWJsZSBjYXRhbG9ndWUgb2JqZWN0IG5hbWVzIGZvciB0aGUgcmVxdWVzdGVkIHR5cGUsXHJcbiAgICAgKiByZWplY3RzIG9uIEhUVFAgZXJyb3Igb3IgaWYgdGhlIEhUVFAgcmVzcG9uc2UgaXMgbm90IGluIEpTT04uXHJcbiAgICAgKiBJZiBjb25zdHJhaW50cyB3ZXJlIHByb3ZpZGVkLCB0aGVuIHRoZSBsaXN0IG9ubHkgY29udGFpbnMgdGhvc2Ugb2JqZWN0cyB0aGF0IG1lZXQgdGhlIGNvbnN0cmFpbnRzXHJcbiAgICAgKi9cclxuICBnZXRUeXBlTGlzdCh0eXBlVVJMLCBjb25zdHJhaW50cykge1xyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcclxuICAgICAgbGV0IHJlcXVlc3RQcm9taXNlID0gY29uc3RyYWludHMgIT0gdW5kZWZpbmVkID8gdGhpcy5odHRwUmVxdWVzdC5wb3N0KHR5cGVVUkwsIHtib2R5OiBKU09OLnN0cmluZ2lmeShjb25zdHJhaW50cyl9KSA6IHRoaXMuaHR0cFJlcXVlc3QuZ2V0KHR5cGVVUkwpO1xyXG4gICAgICByZXF1ZXN0UHJvbWlzZS50aGVuKCh0eXBlTGlzdCkgPT4ge1xyXG4gICAgICAgIHR5cGVMaXN0ID0gSlNPTi5wYXJzZSh0eXBlTGlzdCk7XHJcbiAgICAgICAgcmVzb2x2ZSh0eXBlTGlzdCk7XHJcbiAgICAgIH0pLmNhdGNoKChyZWFzb24pID0+IHtcclxuICAgICAgICByZWplY3QocmVhc29uKTtcclxuICAgICAgfSk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIHNldCBydW50aW1lVVJMKHJ1bnRpbWVVUkwpIHtcclxuICAgIHRoaXMuX3J1bnRpbWVVUkwgPSBydW50aW1lVVJMO1xyXG4gIH1cclxuXHJcbiAgZ2V0IHJ1bnRpbWVVUkwoKSB7XHJcbiAgICByZXR1cm4gdGhpcy5fcnVudGltZVVSTDtcclxuICB9XHJcblxyXG4gIGRlbGV0ZUZyb21QTSh1cmwpIHtcclxuICAgIHJldHVybiB0aGlzLnN0b3JhZ2VNYW5hZ2VyLmRlbGV0ZSh1cmwpO1xyXG4gIH1cclxuXHJcbn1cclxuXHJcbmV4cG9ydCBkZWZhdWx0IFJ1bnRpbWVDYXRhbG9ndWU7XHJcbiIsIi8qKlxyXG4qIENvcHlyaWdodCAyMDE2IFBUIElub3Zhw6fDo28gZSBTaXN0ZW1hcyBTQVxyXG4qIENvcHlyaWdodCAyMDE2IElORVNDLUlEXHJcbiogQ29weXJpZ2h0IDIwMTYgUVVPQklTIE5FVFdPUktTIFNMXHJcbiogQ29weXJpZ2h0IDIwMTYgRlJBVU5IT0ZFUi1HRVNFTExTQ0hBRlQgWlVSIEZPRVJERVJVTkcgREVSIEFOR0VXQU5EVEVOIEZPUlNDSFVORyBFLlZcclxuKiBDb3B5cmlnaHQgMjAxNiBPUkFOR0UgU0FcclxuKiBDb3B5cmlnaHQgMjAxNiBEZXV0c2NoZSBUZWxla29tIEFHXHJcbiogQ29weXJpZ2h0IDIwMTYgQXBpemVlXHJcbiogQ29weXJpZ2h0IDIwMTYgVEVDSE5JU0NIRSBVTklWRVJTSVRBVCBCRVJMSU5cclxuKlxyXG4qIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4qIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4qXHJcbiogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuKlxyXG4qIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4qIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4qKi9cclxuXHJcblxyXG5pbXBvcnQgeyBsb2cgYXMgbG9nTGV2ZWxzIH0gZnJvbSAnLi4vbG9nTGV2ZWxzJztcclxuXHJcbi8vIExvZyBTeXN0ZW1cclxuaW1wb3J0ICogYXMgbG9nZ2VyIGZyb20gJ2xvZ2xldmVsJztcclxubGV0IGxvZyA9IGxvZ2dlci5nZXRMb2dnZXIoJ1J1bnRpbWVVQScpO1xyXG5cclxuLy9NYWluIGRlcGVuZGVjaWVzXHJcbmltcG9ydCBSZWdpc3RyeSBmcm9tICcuLi9yZWdpc3RyeS9SZWdpc3RyeSc7XHJcbmltcG9ydCBJZGVudGl0eU1vZHVsZSBmcm9tICcuLi9pZGVudGl0eS9JZGVudGl0eU1vZHVsZSc7XHJcbmltcG9ydCBJZGVudGl0eUhhbmRsZXIgZnJvbSAnLi4vaWRlbnRpdHkvSWRlbnRpdHlIYW5kbGVyJztcclxuaW1wb3J0IFBFUCBmcm9tICcuLi9wb2xpY3kvUEVQJztcclxuaW1wb3J0IE1lc3NhZ2VCdXMgZnJvbSAnLi4vYnVzL01lc3NhZ2VCdXMnO1xyXG5pbXBvcnQgeyBnZW5lcmF0ZUdVSUQgfSBmcm9tICcuLi91dGlscy91dGlscyc7XHJcbmltcG9ydCBBZGRyZXNzQWxsb2NhdGlvbiBmcm9tICcuLi9hbGxvY2F0aW9uL0FkZHJlc3NBbGxvY2F0aW9uJztcclxuaW1wb3J0IGNyeXB0b01hbmFnZXIgZnJvbSAnLi4vY3J5cHRvTWFuYWdlci9DcnlwdG9NYW5hZ2VyJztcclxuXHJcbmltcG9ydCBMb2FkZXIgZnJvbSAnLi9Mb2FkZXInO1xyXG5pbXBvcnQgeyBzdG9yYWdlIH0gZnJvbSAnLi9TdG9yYWdlJztcclxuaW1wb3J0IERlc2NyaXB0b3JzIGZyb20gJy4vRGVzY3JpcHRvcnMnO1xyXG5cclxuaW1wb3J0IHsgcnVudGltZUNvbmZpZ3VyYXRpb24gfSBmcm9tICcuL3J1bnRpbWVDb25maWd1cmF0aW9uJztcclxuaW1wb3J0IE1zZ0J1c0hhbmRsZXJzIGZyb20gJy4vTXNnQnVzSGFuZGxlcnMnO1xyXG5pbXBvcnQgeyBydW50aW1lVXRpbHMgfSBmcm9tICcuL3J1bnRpbWVVdGlscyc7XHJcblxyXG4vL2ltcG9ydCBHcmFwaENvbm5lY3RvciBmcm9tICcuLi9ncmFwaGNvbm5lY3Rvci9HcmFwaENvbm5lY3Rvcic7XHJcblxyXG5pbXBvcnQgQ29yZURpc2NvdmVyeSBmcm9tICcuLi9kaXNjb3ZlcnkvQ29yZURpc2NvdmVyeSc7XHJcblxyXG5pbXBvcnQgRGF0YU9iamVjdHNTdG9yYWdlIGZyb20gJy4uL3N0b3JlLW9iamVjdHMvRGF0YU9iamVjdHNTdG9yYWdlJztcclxuaW1wb3J0IEh5cGVydHlSZXNvdXJjZXNTdG9yYWdlIGZyb20gJy4uL2h5cGVydHktcmVzb3VyY2UvSHlwZXJ0eVJlc291cmNlc1N0b3JhZ2UnO1xyXG5pbXBvcnQgU3luY2hlck1hbmFnZXIgZnJvbSAnLi4vc3luY2hlci9TeW5jaGVyTWFuYWdlcic7XHJcbmltcG9ydCBTdWJzY3JpcHRpb25NYW5hZ2VyIGZyb20gJy4uL3N1YnNjcmlwdGlvbk1hbmFnZXIvU3Vic2NyaXB0aW9uTWFuYWdlcic7XHJcbmltcG9ydCBSdW50aW1lQ29yZUN0eCBmcm9tICcuLi9wb2xpY3kvY29udGV4dC9SdW50aW1lQ29yZUN0eCc7XHJcbmltcG9ydCBSdW50aW1lQ2F0YWxvZ3VlIGZyb20gJy4uL3J1bnRpbWUtY2F0YWxvZ3VlL1J1bnRpbWVDYXRhbG9ndWUnO1xyXG5cclxuLyoqXHJcbiAqIFJ1bnRpbWUgVXNlciBBZ2VudCBJbnRlcmZhY2Ugd2lsbCBwcm9jZXNzIGFsbCB0aGUgZGVwZW5kZWNpZXMgb2YgdGhlIGNvcmUgcnVudGltZTtcclxuICogQGF1dGhvciBWaXRvciBTaWx2YSBbdml0b3ItdC1zaWx2YUB0ZWxlY29tLnB0XVxyXG4gKiBAdmVyc2lvbiAwLjQuMFxyXG4gKlxyXG4gKiBAcHJvcGVydHkge3J1bnRpbWVGYWN0b3J5fSBydW50aW1lRmFjdG9yeSAtIFNwZWNpZmljIGltcGxlbWVudGF0aW9uIGZvciBhbGwgZW52aXJvbm1lbnRzO1xyXG4gKiBAcHJvcGVydHkge1J1bnRpbWVDYXRhbG9ndWV9IHJ1bnRpbWVDYXRhbG9ndWUgLSBDYXRhbG9ndWUgb2YgY29tcG9uZW50cyBjYW4gYmUgaW5zdGFsbGVkO1xyXG4gKiBAcHJvcGVydHkge3J1bnRpbWVVUkx9IHJ1bnRpbWVVUkwgLSBUaGlzIGlkZW50aWZ5IHRoZSBjb3JlIHJ1bnRpbWUsIHNob3VsZCBiZSB1bmlxdWU7XHJcbiAqIEBwcm9wZXJ0eSB7SWRlbnRpdHlNb2R1bGV9IGlkZW50aXR5TW9kdWxlIC0gSWRlbnRpdHkgTW9kdWxlO1xyXG4gKiBAcHJvcGVydHkge1BFUH0gcG9saWN5RW5naW5lIC0gUG9saWN5IEVuZ2luZSBNb2R1bGU7XHJcbiAqIEBwcm9wZXJ0eSB7UmVnaXN0cnl9IHJlZ2lzdHJ5IC0gUmVnaXN0cnkgTW9kdWxlO1xyXG4gKiBAcHJvcGVydHkge01lc3NhZ2VCdXN9IG1lc3NhZ2VCdXMgLSBNZXNzYWdlIEJ1cyBpcyB1c2VkIGxpa2UgYSByb3V0ZXIgdG8gcmVkaXJlY3QgdGhlIG1lc3NhZ2VzIGZyb20gb25lIGNvbXBvbmVudCB0byBvdGhlcihzKVxyXG4gKiBAcHJvcGVydHkge0dyYXBoQ29ubmVjdG9yfSBncmFwaENvbm5lY3RvciAtIEdyYXBoIENvbm5lY3RvciBoYW5kbGluZyBHVUlEIGFuZCBjb250YWN0c1xyXG4gKiBAcHJvcGVydHkge0NvcmVEaXNjb3Zlcnl9IGNvcmVEaXNjb3ZlcnkgLSBEaXNjb3ZlcnkgZm9yIGRpc2NvdmVyeSBoeXBlcnRpZXMvZGF0YU9iamVjdHNcclxuICovXHJcbmNsYXNzIFJ1bnRpbWVVQSB7XHJcblxyXG4gIC8qKlxyXG4gICAqIENyZWF0ZSBhIG5ldyBpbnN0YW5jZSBvZiBSdW50aW1lIFVzZXIgQWdlbnRcclxuICAgKiBAcGFyYW0ge2Rlc2NyaXB0b3J9IHJ1bnRpbWVEZXNjcmlwdG9yIC0gcGFzcyBhbGwgdGhlIGh5cGVydHkgcnVudGltZSBkZXNjcmlwdG9yXHJcbiAgICogQHBhcmFtIHtydW50aW1lRmFjdG9yeX0gcnVudGltZUZhY3RvcnkgLSBTcGVjaWZpYyBpbXBsZW1lbnRhdGlvbiBmb3IgdGhlIGVudmlyb25tZW50IHdoZXJlIHRoZSBjb3JlIHJ1bnRpbWUgd2lsbCBydW47XHJcbiAgICogQHBhcmFtIHtkb21haW59IGRvbWFpblVSTCAtIHNwZWNpZnkgdGhlIGRvbWFpbiBiYXNlIGZvciB0aGUgcnVudGltZTtcclxuICAgKi9cclxuICBjb25zdHJ1Y3RvcihydW50aW1lRGVzY3JpcHRvciwgcnVudGltZUZhY3RvcnksIGRvbWFpbikge1xyXG4gICAgaWYgKCFydW50aW1lRGVzY3JpcHRvcikgdGhyb3cgbmV3IEVycm9yKCdUaGUgcnVudGltZSBkZXNjcmlwdG9yIGlzIGEgbmVlZGVkIHBhcmFtZXRlcicpO1xyXG4gICAgaWYgKCFydW50aW1lRmFjdG9yeSkgdGhyb3cgbmV3IEVycm9yKCdUaGUgc2FuZGJveCBmYWN0b3J5IGlzIGEgbmVlZGVkIHBhcmFtZXRlcicpO1xyXG4gICAgaWYgKCFkb21haW4pIHRocm93IG5ldyBFcnJvcignWW91IG5lZWQgdGhlIGRvbWFpbiBvZiBydW50aW1lJyk7XHJcblxyXG4gICAgLy8gQ29uZmlndXJhdGlvbiBvYmplY3Qgd2l0aCBpbmZvcm1hdGlvbiByZWxhdGVkIHdpdGggc2VydmVyc1xyXG4gICAgdGhpcy5ydW50aW1lQ29uZmlndXJhdGlvbiA9IE9iamVjdC5hc3NpZ24oeyBkb21haW46IGRvbWFpbiB9LCBydW50aW1lQ29uZmlndXJhdGlvbik7XHJcbiAgICB0aGlzLnJ1bnRpbWVGYWN0b3J5ID0gcnVudGltZUZhY3Rvcnk7XHJcblxyXG4gICAgdGhpcy5sb2cgPSBsb2c7XHJcbiAgICB0aGlzLmxvZ0xldmVscyA9IGxvZ0xldmVscztcclxuXHJcbiAgICBpZiAocnVudGltZURlc2NyaXB0b3IucDJwSGFuZGxlclN0dWIgJiYgdHlwZW9mIHJ1bnRpbWVEZXNjcmlwdG9yLnAycEhhbmRsZXJTdHViID09PSAnc3RyaW5nJyAmJiBydW50aW1lRGVzY3JpcHRvci5wMnBIYW5kbGVyU3R1Yi5pbmNsdWRlcygnOi8vJykpIHtcclxuICAgICAgdGhpcy5wMnAgPSB0cnVlO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdGhpcy5wMnAgPSBmYWxzZTtcclxuICAgIH1cclxuXHJcbiAgICBydW50aW1lVXRpbHMucnVudGltZURlc2NyaXB0b3IgPSBydW50aW1lRGVzY3JpcHRvcjtcclxuICAgIHRoaXMucnVudGltZVV0aWxzID0gcnVudGltZVV0aWxzO1xyXG5cclxuICAgIHRoaXMuc3RvcmFnZXMgPSB7fTtcclxuXHJcbi8qICAgIGlmICh0eXBlb2YgcnVudGltZUZhY3RvcnkuY3JlYXRlUnVudGltZUNhdGFsb2d1ZSA9PT0gJ2Z1bmN0aW9uJykge1xyXG4gICAgICB0aGlzLnJ1bnRpbWVDYXRhbG9ndWUgPSBydW50aW1lRmFjdG9yeS5jcmVhdGVSdW50aW1lQ2F0YWxvZ3VlKCk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ0NoZWNrIHlvdXIgUnVudGltZSBGYWN0b3J5IGJlY2F1c2UgaXQgbmVlZHMgdGhlIFJ1bnRpbWUgQ2F0YWxvZ3VlIGltcGxlbWVudGF0aW9uJyk7XHJcbiAgICB9Ki9cclxuXHJcbiAgICB0aGlzLnJ1bnRpbWVDYXRhbG9ndWUgPSBuZXcgUnVudGltZUNhdGFsb2d1ZShydW50aW1lRmFjdG9yeSk7XHJcblxyXG5cclxuXHJcbi8qICAgIGlmICh0eXBlb2YgcnVudGltZUZhY3RvcnkucGVyc2lzdGVuY2VNYW5hZ2VyID09PSAnZnVuY3Rpb24nKSB7XHJcbiAgICAgIHRoaXMucGVyc2lzdGVuY2VNYW5hZ2VyID0gcnVudGltZUZhY3RvcnkucGVyc2lzdGVuY2VNYW5hZ2VyKCk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ0NoZWNrIHlvdXIgUnVudGltZSBGYWN0b3J5IGJlY2F1c2UgaXQgbmVlZHMgdGhlIFBlcnNpc3RlbmNlIE1hbmFnZXIgaW1wbGVtZW50YXRpb24nKTtcclxuICAgIH0qL1xyXG5cclxuICAgIGlmICh0eXBlb2YgcnVudGltZUZhY3Rvcnkuc3RvcmFnZU1hbmFnZXIgPT09ICdmdW5jdGlvbicpIHtcclxuXHJcbiAgICAgIHRoaXMuc3RvcmFnZXMgPSBzdG9yYWdlKHJ1bnRpbWVGYWN0b3J5LCB0aGlzKTtcclxuXHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ0NoZWNrIHlvdXIgUnVudGltZSBGYWN0b3J5IGJlY2F1c2UgaXQgbmVlZHMgdGhlIFN0b3JhZ2UgTWFuYWdlciBpbXBsZW1lbnRhdGlvbicpO1xyXG4gICAgfVxyXG5cclxuICAgIGlmICh0eXBlb2YgcnVudGltZUZhY3RvcnkucnVudGltZUNhcGFiaWxpdGllcyA9PT0gJ2Z1bmN0aW9uJykge1xyXG4gICAgICB0aGlzLnJ1bnRpbWVDYXBhYmlsaXRpZXMgPSBydW50aW1lRmFjdG9yeS5ydW50aW1lQ2FwYWJpbGl0aWVzKHRoaXMuc3RvcmFnZXMuY2FwYWJpbGl0aWVzKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGxvZy5pbmZvKCdDaGVjayB5b3VyIFJ1bnRpbWVGYWN0b3J5IGJlY2F1c2UgaXQgbmVlZHMgdGhlIFJ1bnRpbWUgQ2FwYWJpbGl0aWVzIGltcGxlbWVudGF0aW9uJyk7XHJcbiAgICB9XHJcblxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogSW50aWFsaXplIHRoZSBpbnN0YWxsYXRpb24gb2YgcnVudGltZVxyXG4gICAqXHJcbiAgICogQGFjY2VzcyBwdWJsaWNcclxuICAgKiBAcmV0dXJuIHtQcm9taXNlPEJvb2xlYW4sIEVycm9yPn0gdGhpcyBpcyBQcm9taXNlIGFuZCBpZiB0aGUgaW5zdGFsbGF0aW9uIHByb2Nlc3MgaGFwcGVuZWQgd2l0aG91dCBhbnkgcHJvYmxlbXMgcmV0dXJucyB0cnVlIG90aGVyd2lzZSB0aGUgZXJyb3IuXHJcbiAgICpcclxuICAgKiBAbWVtYmVyT2YgUnVudGltZVVBXHJcbiAgICovXHJcbiAgaW5pdChndWlkKSB7XHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xyXG5cclxuICAgICAgdGhpcy5kb21haW4gPSB0aGlzLnJ1bnRpbWVDb25maWd1cmF0aW9uLmRvbWFpbjtcclxuXHJcblxyXG4gICAgICBsb2cuaW5mbygnW1J1bnRpbWVVQSAtIGluaXRdIFN0YXJ0aW5nICcpO1xyXG5cclxuICAgICAgdHJ5IHtcclxuICAgICAgICBsZXQgZ2V0Q2FwYWJpbGl0aWVzID0gdGhpcy5ydW50aW1lQ2FwYWJpbGl0aWVzLmdldFJ1bnRpbWVDYXBhYmlsaXRpZXMoKTtcclxuICAgICAgICBsZXQgZ2V0UnVudGltZVVSTCA9IHRoaXMuc3RvcmFnZXMucnVudGltZS5nZXQoJ3J1bnRpbWU6VVJMJyk7XHJcbiAgICAgICAgbGV0IGdldFN0b3JlZERhdGFPYmplY3RzID0gdGhpcy5zdG9yYWdlcy5zeW5jaGVyTWFuYWdlci5nZXQoJ3N5bmNoZXJNYW5hZ2VyOk9iamVjdFVSTHMnKTtcclxuICAgICAgICBsZXQgZ2V0SHlwZXJ0eVN0b3JhZ2VPYmplY3RzID0gdGhpcy5zdG9yYWdlcy5oeXBlcnR5UmVzb3VyY2VzLmdldCgpO1xyXG4gICAgICAgIGxldCBnZXRQMlBIYW5kbGVyVVJMID0gdGhpcy5zdG9yYWdlcy5ydW50aW1lLmdldCgncDJwSGFuZGxlcjpVUkwnKTtcclxuLy8gICAgICAgIGxldCBnZXRSZW1vdGVzID0gdGhpcy5zdG9yYWdlcy5zeW5jaGVyTWFuYWdlci5nZXQoJ3JlbW90ZXMnKTtcclxuXHJcbiAgICAgICAgUHJvbWlzZS5hbGwoW2dldFJ1bnRpbWVVUkwsIGdldENhcGFiaWxpdGllcywgZ2V0U3RvcmVkRGF0YU9iamVjdHMsIGdldEh5cGVydHlTdG9yYWdlT2JqZWN0cywgZ2V0UDJQSGFuZGxlclVSTF0pLnRoZW4oKHJlc3VsdHMpID0+IHtcclxuXHJcbiAgICAgICAgICB0aGlzLnJ1bnRpbWVVUkwgPSByZXN1bHRzWzBdID8gcmVzdWx0c1swXS5ydW50aW1lVVJMIDogcmVzdWx0c1swXTtcclxuICAgICAgICAgIGlmICghdGhpcy5ydW50aW1lVVJMKSB7XHJcbiAgICAgICAgICAgIHRoaXMucnVudGltZVVSTCA9ICdydW50aW1lOi8vJyArIHRoaXMuZG9tYWluICsgJy8nICsgZ2VuZXJhdGVHVUlEKCk7XHJcbiAgICAgICAgICAgIHRoaXMuc3RvcmFnZXMucnVudGltZS5zZXQoJ3J1bnRpbWU6VVJMJywgMSwgeyBydW50aW1lVVJMOiB0aGlzLnJ1bnRpbWVVUkwgfSk7XHJcbiAgICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICAgIHRoaXMuY2FwYWJpbGl0aWVzID0gcmVzdWx0c1sxXTtcclxuICAgICAgICAgIE9iamVjdC5hc3NpZ24ocnVudGltZVV0aWxzLnJ1bnRpbWVDYXBhYmlsaXRpZXMuY29uc3RyYWludHMsIHJlc3VsdHNbMV0pO1xyXG5cclxuICAgICAgICAgIHRoaXMuX2RhdGFPYmplY3RzU3RvcmFnZSA9IG5ldyBEYXRhT2JqZWN0c1N0b3JhZ2UodGhpcy5zdG9yYWdlcy5zeW5jaGVyTWFuYWdlciwgcmVzdWx0c1syXSB8fCB7fSwgdGhpcy5ydW50aW1lRmFjdG9yeSwgdGhpcy5ydW50aW1lVVJMICk7XHJcblxyXG4gICAgICAgICAgdGhpcy5faHlwZXJ0eVJlc291cmNlcyA9IHJlc3VsdHNbM10gfHwge307XHJcblxyXG4gICAgICAgICAgdGhpcy5wMnBIYW5kbGVyVVJMID0gcmVzdWx0c1s0XSA/IHJlc3VsdHNbNF0ucDJwSGFuZGxlclVSTCA6IHJlc3VsdHNbNF07XHJcbiAgICAgICAgICBpZiAoIXRoaXMucDJwSGFuZGxlclVSTCkge1xyXG4gICAgICAgICAgICB0aGlzLnAycEhhbmRsZXJVUkwgPSB0aGlzLnJ1bnRpbWVVUkwgKyAnL3AycGhhbmRsZXIvJyArIGdlbmVyYXRlR1VJRCgpO1xyXG4gICAgICAgICAgICBsb2cuaW5mbygnW1J1bnRpbWVVQSAtIGluaXRdIFAyUEhhbmRsZXJVUkw6ICcsIHRoaXMucDJwSGFuZGxlclVSTCk7XHJcblxyXG4gICAgICAgICAgICB0aGlzLnN0b3JhZ2VzLnJ1bnRpbWUuc2V0KCdwMnBIYW5kbGVyOlVSTCcsIDEsIHsgcDJwSGFuZGxlclVSTDogdGhpcy5wMnBIYW5kbGVyVVJMIH0pO1xyXG4gICAgICAgICAgfVxyXG5cclxuLyogICAgICAgICAgbG9nLmluZm8oJ1tSdW50aW1lVUEgLSBpbml0XSBkYXRhT2JqZWN0c1N0b3JhZ2UgcmVtb3RlIGxvYWQgc3RhcnRpbmcnKTtcclxuICAgICAgICAgIHRoaXMuX2RhdGFPYmplY3RzU3RvcmFnZS5sb2FkUmVtb3RlKCkudGhlbigoKT0+IHtcclxuICAgICAgICAgICAgbG9nLmluZm8oJ1tSdW50aW1lVUEgLSBpbml0XSBkYXRhT2JqZWN0c1N0b3JhZ2UgcmVtb3RlIGxvYWQgY29uY2x1ZGVkJyk7Ki9cclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2xvYWRDb21wb25lbnRzKGd1aWQpO1xyXG5cclxuLy8gICAgICAgICAgfSk7XHJcblxyXG5cclxuICAgICAgICB9KS50aGVuKChzdGF0dXMpID0+IHtcclxuICAgICAgICAgIHRoaXMuX3NldE5ldHdvcmtTdGF0dXNMaXN0ZW5lcnMoKTtcclxuXHJcbiAgICAgICAgICB0aGlzLl9oeXBlcnR5UmVzb3VyY2VzU3RvcmFnZSA9IG5ldyBIeXBlcnR5UmVzb3VyY2VzU3RvcmFnZSh0aGlzLnJ1bnRpbWVVUkwsIHRoaXMubWVzc2FnZUJ1cywgdGhpcy5zdG9yYWdlcy5oeXBlcnR5UmVzb3VyY2VzLCB0aGlzLl9oeXBlcnR5UmVzb3VyY2VzKTtcclxuXHJcbiAgICAgICAgICBpZiAodGhpcy5wMnApIHtcclxuICAgICAgICAgICAgbG9nLmluZm8oJ1tSdW50aW1lVUEgLSBpbml0XSBsb2FkIHAycEhhbmRsZXI6ICcsIHN0YXR1cyk7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLl9sb2FkUDJQSGFuZGxlcigpO1xyXG4gICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgbG9nLmluZm8oJ1tSdW50aW1lVUEgLSBpbml0XSBQMlAgbm90IHN1cHBvcnRlZCcpO1xyXG4gICAgICAgICAgICByZXR1cm4gKCdQMlAgTm90IFN1cHBvcnRlZCcpO1xyXG4gICAgICAgICAgfVxyXG5cclxuICAgICAgICB9KS50aGVuKChyZXN1bHQpID0+IHtcclxuICAgICAgICAgIGxvZy5pbmZvKCdbcnVudGltZSB1YSAtIGluaXRdIC0gc3RhdHVzOiAnLCByZXN1bHQpO1xyXG4gICAgICAgICAgcmVzb2x2ZSh0cnVlKTtcclxuICAgICAgICB9LCAocmVhc29uKSA9PiB7XHJcbiAgICAgICAgICBsb2cuZXJyb3IoJ0VSUk9SOiAnLCByZWFzb24pO1xyXG4gICAgICAgICAgcmVzb2x2ZSh0cnVlKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgICByZWplY3QoZSk7XHJcbiAgICAgIH1cclxuXHJcbiAgICB9KTtcclxuXHJcbiAgfVxyXG5cclxuICBfc2V0TmV0d29ya1N0YXR1c0xpc3RlbmVycygpIHtcclxuXHJcbiAgICB0aGlzLnJ1bnRpbWVGYWN0b3J5Lmxpc3Rlbk9ubGluZSggdGhpcy5fdXBkYXRlUnVudGltZVN0YXR1cygnb25saW5lJykgKTtcclxuICAgIHRoaXMucnVudGltZUZhY3RvcnkubGlzdGVuT2ZmbGluZSggdGhpcy5fdXBkYXRlUnVudGltZVN0YXR1cygnb2ZmbGluZScpICk7XHJcblxyXG4gIH1cclxuXHJcbiAgX3VwZGF0ZVJ1bnRpbWVTdGF0dXMoZXZlbnQpIHtcclxuXHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG5cclxuICAgIF90aGlzLm1lc3NhZ2VCdXMucG9zdE1lc3NhZ2Uoe1xyXG4gICAgICBmcm9tOiB0aGlzLnJ1bnRpbWVVUkwsXHJcbiAgICAgIHRvOiB0aGlzLnJ1bnRpbWVVUkwrJy9zdGF0dXMnLFxyXG4gICAgICB0eXBlOiAndXBkYXRlJyxcclxuICAgICAgYm9keTogZXZlbnRcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgX2xvYWRQMlBIYW5kbGVyKCkge1xyXG5cclxuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4ge1xyXG5cclxuICAgICAgbGV0IHJ1bnRpbWVEZXNjcmlwdG9yID0gcnVudGltZVV0aWxzLnJ1bnRpbWVEZXNjcmlwdG9yO1xyXG4gICAgICBsZXQgcDJwU3R1YkhhbmRsZXIgPSBydW50aW1lRGVzY3JpcHRvci5wMnBIYW5kbGVyU3R1YjtcclxuXHJcbiAgICAgIGxldCBwMnBDb25maWcgPSB7XHJcbiAgICAgICAgaXNIYW5kbGVyU3R1YjogdHJ1ZSxcclxuICAgICAgICBydW50aW1lVVJMOiB0aGlzLnJ1bnRpbWVVUkxcclxuICAgICAgfTtcclxuXHJcbiAgICAgIGxvZy5sb2coJ1tSdW50aW1lVUEgbG9hZFAyUEhhbmRsZXJdIFAyUFN0dWJIYW5kbGVyOiAnLCBwMnBTdHViSGFuZGxlcik7XHJcblxyXG4gICAgICB0aGlzLmxvYWRlci5sb2FkU3R1YihwMnBTdHViSGFuZGxlciwgcDJwQ29uZmlnKS50aGVuKChyZXN1bHQpID0+IHtcclxuXHJcbiAgICAgICAgbGV0IHJ1bnRpbWVVQVVSTCA9IHRoaXMucnVudGltZVVSTCArICcvdWEnO1xyXG4gICAgICAgIGxldCBtc2cgPSB7XHJcbiAgICAgICAgICB0eXBlOiAnc3Vic2NyaWJlJyxcclxuICAgICAgICAgIGZyb206IHJ1bnRpbWVVQVVSTCxcclxuICAgICAgICAgIHRvOiAnZG9tYWluOi8vbXNnLW5vZGUuJyArIHRoaXMuZG9tYWluICsgJy9zbScsXHJcbiAgICAgICAgICBib2R5OiB7XHJcbiAgICAgICAgICAgIHN1YnNjcmliZTogW3Jlc3VsdC51cmxdLFxyXG4gICAgICAgICAgICBzb3VyY2U6IHRoaXMucnVudGltZVVSTFxyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHRoaXMubWVzc2FnZUJ1cy5hZGRMaXN0ZW5lcihydW50aW1lVUFVUkwsIChtc2cpID0+IHtcclxuICAgICAgICAgIGxvZy5sb2coJ1tydW50aW1lIHVhIC0gbGlzdGVuZXJdIC0gcmVjZWl2ZSBtc2c6ICcsIG1zZyk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHRoaXMubWVzc2FnZUJ1cy5wb3N0TWVzc2FnZShtc2csIChyZXBseSkgPT4ge1xyXG4gICAgICAgICAgbG9nLmxvZygnW3J1bnRpbWUgdWEgLSBwb3N0TWVzc2FnZV0gLSByZXBseTogJywgcmVwbHkpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBsb2cuaW5mbygnW3J1bnRpbWUgdWEgLSBwMnAgaW5zdGFsbGF0aW9uXSAtIHN1Y2Nlc3M6ICcsIHJlc3VsdCk7XHJcbiAgICAgICAgcmVzb2x2ZSh0cnVlKTtcclxuICAgICAgfSkuY2F0Y2goKHJlYXNvbikgPT4ge1xyXG4gICAgICAgIGxvZy5pbmZvKCdbcnVudGltZSB1YSAtIHAycCBpbnN0YWxsYXRpb25dIC0gZmFpbDogJywgcmVhc29uKTtcclxuICAgICAgICByZXNvbHZlKGZhbHNlKTtcclxuICAgICAgfSk7XHJcblxyXG4gICAgfSk7XHJcblxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICpcclxuICAgKiBAYWNjZXNzIHByaXZhdGVcclxuICAgKiBAcmV0dXJuIHtQcm9taXNlPEJvb2xlYW4sIEVycm9yPn0gdGhpcyBpcyBQcm9taXNlIGFuZCByZXR1cm5zIHRydWUgaWYgYWxsIGNvbXBvbmVudHMgYXJlIGxvYWRlZCB3aXRoIHN1Y2Nlc3Mgb3IgYW4gZXJyb3IgaWYgc29tZW9uZSBmYWlscy5cclxuICAgKlxyXG4gICAqIEBtZW1iZXJPZiBSdW50aW1lVUFcclxuICAgKi9cclxuICBfbG9hZENvbXBvbmVudHMoZ3VpZCkge1xyXG5cclxuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XHJcblxyXG4gICAgICB0cnkge1xyXG5cclxuICAgICAgICAvLyBQcmVwYXJlIHRoZSBvbiBpbnN0YW5jZSB0byBoYW5kbGUgd2l0aCB0aGUgZmFsbGJhY2tzIGFuZCBydW50aW1lQ2F0YWxvZ3VlO1xyXG4gICAgICAgIHRoaXMuZGVzY3JpcHRvckluc3RhbmNlID0gbmV3IERlc2NyaXB0b3JzKHRoaXMucnVudGltZVVSTCwgdGhpcy5ydW50aW1lQ2F0YWxvZ3VlLCB0aGlzLnJ1bnRpbWVDb25maWd1cmF0aW9uKTtcclxuXHJcbiAgICAgICAgLy8gUHJlcGFyZSB0aGUgbG9hZGVyIHRvIGxvYWQgdGhlIGh5cGVydGllcywgcHJvdG9zdHVicyBhbmQgaWRwcHJveHk7XHJcbiAgICAgICAgdGhpcy5sb2FkZXIgPSBuZXcgTG9hZGVyKHRoaXMucnVudGltZVVSTCwgdGhpcy5ydW50aW1lQ29uZmlndXJhdGlvbiwgdGhpcy5kZXNjcmlwdG9ySW5zdGFuY2UpO1xyXG5cclxuICAgICAgICAvLyBJbnN0YW50aWF0ZSB0aGUgaWRlbnRpdHkgTW9kdWxlXHJcbiAgICAgICAgdGhpcy5pZGVudGl0eU1vZHVsZSA9IG5ldyBJZGVudGl0eU1vZHVsZSh0aGlzLnJ1bnRpbWVVUkwsIHRoaXMucnVudGltZUNhcGFiaWxpdGllcywgdGhpcy5zdG9yYWdlcy5pZGVudGl0eSwgdGhpcy5fZGF0YU9iamVjdHNTdG9yYWdlLCBjcnlwdG9NYW5hZ2VyLCB0aGlzLnJ1bnRpbWVDYXRhbG9ndWUpO1xyXG5cclxuICAgICAgICAvLyBVc2UgdGhlIHNhbmRib3ggZmFjdG9yeSB0byBjcmVhdGUgYW4gQXBwU2FuZGJveDtcclxuICAgICAgICAvLyBJbiB0aGUgZnV0dXJlIGNhbiBiZSBkZWNpZGVkIGJ5IHBvbGljeUVuZ2luZSBpZiB3ZSBuZWVkXHJcbiAgICAgICAgLy8gY3JlYXRlIGEgQXBwU2FuZGJveCBvciBub3Q7XHJcbiAgICAgICAgbGV0IGFwcFNhbmRib3ggPSB0aGlzLnJ1bnRpbWVGYWN0b3J5LmNyZWF0ZUFwcFNhbmRib3goKTtcclxuXHJcbiAgICAgICAgLy8gSW5zdGFudGlhdGUgdGhlIFJlZ2lzdHJ5IE1vZHVsZVxyXG4gICAgICAgIHRoaXMucmVnaXN0cnkgPSBuZXcgUmVnaXN0cnkodGhpcy5ydW50aW1lVVJMLCBhcHBTYW5kYm94LCB0aGlzLmlkZW50aXR5TW9kdWxlLCB0aGlzLnJ1bnRpbWVDYXRhbG9ndWUsIHRoaXMucnVudGltZUNhcGFiaWxpdGllcywgdGhpcy5zdG9yYWdlcy5yZWdpc3RyeSwgdGhpcy5wMnBIYW5kbGVyVVJMKTtcclxuXHJcbiAgICAgICAgLy8gU2V0IHRoZSBsb2FkZXIgdG8gbG9hZCBIeXBlcnRpZXMsIFN0dWJzIGFuZCBJZHBQcm94aWVzXHJcbiAgICAgICAgdGhpcy5yZWdpc3RyeS5sb2FkZXIgPSB0aGlzLmxvYWRlcjtcclxuXHJcbiAgICAgICAgLy8gSW5zdGFudGlhdGUgdGhlIE1lc3NhZ2UgQnVzXHJcbiAgICAgICAgdGhpcy5tZXNzYWdlQnVzID0gbmV3IE1lc3NhZ2VCdXModGhpcy5yZWdpc3RyeSwgdGhpcy5ydW50aW1lVVJMKTtcclxuXHJcbiAgICAgICAgLy8gSW5zdGFuY2lhdGUgdGhlIFN1YnNjcmlwdGlvbk1hbmFnZXI7XHJcbiAgICAgICAgdGhpcy5zdWJzY3JpcHRpb25NYW5hZ2VyID0gbmV3IFN1YnNjcmlwdGlvbk1hbmFnZXIodGhpcy5ydW50aW1lVVJMLCB0aGlzLm1lc3NhZ2VCdXMsIHRoaXMuc3RvcmFnZXMuc3Vic2NyaXB0aW9ucyk7XHJcblxyXG4gICAgICAgIC8vIFByZXBhcmUgdGhlIGFkZHJlc3MgYWxsb2NhdGlvbiBpbnN0YW5jZTtcclxuICAgICAgICB0aGlzLmFkZHJlc3NBbGxvY2F0aW9uID0gbmV3IEFkZHJlc3NBbGxvY2F0aW9uKHRoaXMucnVudGltZVVSTCwgdGhpcy5tZXNzYWdlQnVzLCB0aGlzLnJlZ2lzdHJ5LCB0aGlzLnN1YnNjcmlwdGlvbk1hbmFnZXIpO1xyXG5cclxuICAgICAgICAvLyBJbnN0YW50aWF0ZSB0aGUgUG9saWN5IEVuZ2luZVxyXG4gICAgICAgIHRoaXMucG9saWN5RW5naW5lID0gbmV3IFBFUChuZXcgUnVudGltZUNvcmVDdHgodGhpcy5ydW50aW1lVVJMLCB0aGlzLmlkZW50aXR5TW9kdWxlLCB0aGlzLnJlZ2lzdHJ5LCB0aGlzLnN0b3JhZ2VzLnBvbGljeSwgdGhpcy5ydW50aW1lQ2FwYWJpbGl0aWVzKSk7XHJcblxyXG4gICAgICAgIC8vIEluc3RhbnRpYXRlIERpc2NvdmVyeVxyXG4gICAgICAgIHRoaXMuY29yZURpc2NvdmVyeSA9IG5ldyBDb3JlRGlzY292ZXJ5KHRoaXMucnVudGltZVVSTCwgdGhpcy5tZXNzYWdlQnVzLCB0aGlzLmdyYXBoQ29ubmVjdG9yLCB0aGlzLnJ1bnRpbWVGYWN0b3J5LCB0aGlzLnJlZ2lzdHJ5KTtcclxuXHJcbiAgICAgICAgLy8gSW5zdGFudGlhdGUgdGhlIGlkZW50aXR5SGFuZGxlclxyXG4gICAgICAgIHRoaXMuaWRlbnRpdHlIYW5kbGVyID0gbmV3IElkZW50aXR5SGFuZGxlcih0aGlzLmlkZW50aXR5TW9kdWxlKTtcclxuXHJcbiAgICAgICAgLy8gaW5pdGlhbGlzZSB0aGUgQ3J5cHRvTWFuYWdlclxyXG4gICAgICAgIGNyeXB0b01hbmFnZXIuaW5pdCh0aGlzLnJ1bnRpbWVVUkwsIHRoaXMucnVudGltZUNhcGFiaWxpdGllcywgdGhpcy5zdG9yYWdlcy5jcnlwdG9NYW5hZ2VyLCB0aGlzLl9kYXRhT2JqZWN0c1N0b3JhZ2UsIHRoaXMucmVnaXN0cnksIHRoaXMuY29yZURpc2NvdmVyeSwgdGhpcy5pZGVudGl0eU1vZHVsZSwgdGhpcy5ydW50aW1lRmFjdG9yeSk7XHJcblxyXG4gICAgICAgIC8vIEluc3RhbnRpYXRlIHRoZSBHcmFwaCBDb25uZWN0b3JcclxuLy8gICAgICAgIHRoaXMuZ3JhcGhDb25uZWN0b3IgPSBwcm9jZXNzLmVudi5NT0RFICE9PSAnbGlnaHQnID8gbmV3IEdyYXBoQ29ubmVjdG9yKHRoaXMucnVudGltZVVSTCwgdGhpcy5tZXNzYWdlQnVzLCB0aGlzLnN0b3JhZ2VNYW5hZ2VyKSA6IG51bGw7XHJcblxyXG4gICAgICAgIHRoaXMuaGFuZGxlcnMgPSBuZXcgTXNnQnVzSGFuZGxlcnModGhpcy5wb2xpY3lFbmdpbmUsIHRoaXMuaWRlbnRpdHlIYW5kbGVyLCBjcnlwdG9NYW5hZ2VyKTtcclxuXHJcbiAgICAgICAgLy8gKHVuKWNvbW1lbnQgYmVsbG93IHRvIG5vdCBlbmNyeXB0IG1lc3NhZ2VzXHJcblxyXG4gICAgICAgIHRoaXMubWVzc2FnZUJ1cy5waXBlbGluZU91dC5oYW5kbGVycyA9IFt0aGlzLmhhbmRsZXJzLmlkbUhhbmRsZXIsIHRoaXMuaGFuZGxlcnMucGVwT3V0SGFuZGxlcl07XHJcbiAgICAgICAgdGhpcy5tZXNzYWdlQnVzLnBpcGVsaW5lSW4uaGFuZGxlcnMgPSBbIHRoaXMuaGFuZGxlcnMucGVwSW5IYW5kbGVyXTtcclxuXHJcbiAgICAgICAgLy8gKHVuKWNvbW1lbnQgYmVsbG93IHRvIGVuY3J5cHQgbWVzc2FnZXNcclxuXHJcbi8vICAgICAgdGhpcy5tZXNzYWdlQnVzLnBpcGVsaW5lT3V0LmhhbmRsZXJzID0gW3RoaXMuaGFuZGxlcnMuaWRtSGFuZGxlciwgdGhpcy5oYW5kbGVycy5wZXBPdXRIYW5kbGVyLCB0aGlzLmhhbmRsZXJzLmVuY3J5cHRIYW5kbGVyXTtcclxuLy8gICAgICB0aGlzLm1lc3NhZ2VCdXMucGlwZWxpbmVJbi5oYW5kbGVycyA9IFt0aGlzLmhhbmRsZXJzLmRlY3J5cHRIYW5kbGVyLCB0aGlzLmhhbmRsZXJzLnBlcEluSGFuZGxlcl07XHJcblxyXG4gICAgICAgIC8vIEFkZCB0byBBcHAgU2FuZGJveCB0aGUgbGlzdGVuZXI7XHJcbiAgICAgICAgYXBwU2FuZGJveC5hZGRMaXN0ZW5lcignKicsIChtc2cpID0+IHtcclxuICAgICAgICAgIHRoaXMubWVzc2FnZUJ1cy5wb3N0TWVzc2FnZShtc2cpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBjcnlwdG9NYW5hZ2VyLm1lc3NhZ2VCdXMgPSB0aGlzLm1lc3NhZ2VCdXM7XHJcblxyXG4gICAgICAgIC8vIFJlZ2lzdGVyIG1lc3NhZ2VCdXMgb24gUmVnaXN0cnlcclxuICAgICAgICB0aGlzLnJlZ2lzdHJ5Lm1lc3NhZ2VCdXMgPSB0aGlzLm1lc3NhZ2VCdXM7XHJcblxyXG4gICAgICAgIC8vIFBvbGljeSBFbmdpbmVcclxuICAgICAgICB0aGlzLnBvbGljeUVuZ2luZS5tZXNzYWdlQnVzID0gdGhpcy5tZXNzYWdlQnVzO1xyXG5cclxuICAgICAgICAvLyBSZWdpc3RlciBtZXNzYWdlQnVzIG9uIElETVxyXG4gICAgICAgIHRoaXMuaWRlbnRpdHlNb2R1bGUubWVzc2FnZUJ1cyA9IHRoaXMubWVzc2FnZUJ1cztcclxuXHJcbiAgICAgICAgLy8gUmVnaXN0ZXIgcmVnaXN0cnkgb24gSWRlbnRpdHlNb2R1bGVcclxuICAgICAgICB0aGlzLmlkZW50aXR5TW9kdWxlLnJlZ2lzdHJ5ID0gdGhpcy5yZWdpc3RyeTtcclxuXHJcbiAgICAgICAgLy8gUmVnaXN0ZXIgY29yZURpc2NvdmVyeSBvbiBJZGVudGl0eU1vZHVsZVxyXG4gICAgICAgIHRoaXMuaWRlbnRpdHlNb2R1bGUuY29yZURpc2NvdmVyeSA9IHRoaXMuY29yZURpc2NvdmVyeTtcclxuXHJcbiAgICAgICAgLy8gVXNlIHNhbmRib3ggZmFjdG9yeSB0byB1c2Ugc3BlY2lmaWMgbWV0aG9kc1xyXG4gICAgICAgIC8vIGFuZCBzZXQgdGhlIG1lc3NhZ2UgYnVzIHRvIHRoZSBmYWN0b3J5XHJcbiAgICAgICAgdGhpcy5ydW50aW1lRmFjdG9yeS5tZXNzYWdlQnVzID0gdGhpcy5tZXNzYWdlQnVzO1xyXG5cclxuICAgICAgICAvLyBJbnN0YW5jaWF0ZSB0aGUgU3luY2hlck1hbmFnZXI7XHJcbiAgICAgICAgdGhpcy5zeW5jaGVyTWFuYWdlciA9IG5ldyBTeW5jaGVyTWFuYWdlcih0aGlzLnJ1bnRpbWVVUkwsIHRoaXMubWVzc2FnZUJ1cywgdGhpcy5yZWdpc3RyeSwgdGhpcy5ydW50aW1lQ2F0YWxvZ3VlLCB0aGlzLnN0b3JhZ2VzLnN5bmNoZXJNYW5hZ2VyLCBudWxsLCB0aGlzLl9kYXRhT2JqZWN0c1N0b3JhZ2UsIHRoaXMuaWRlbnRpdHlNb2R1bGUpO1xyXG5cclxuXHJcbiAgICAgICAgLy8gU2V0IGludG8gbG9hZGVyIHRoZSBuZWVkZWQgY29tcG9uZW50cztcclxuICAgICAgICB0aGlzLmxvYWRlci5ydW50aW1lVVJMID0gdGhpcy5ydW50aW1lVVJMO1xyXG4gICAgICAgIHRoaXMubG9hZGVyLm1lc3NhZ2VCdXMgPSB0aGlzLm1lc3NhZ2VCdXM7XHJcbiAgICAgICAgdGhpcy5sb2FkZXIucmVnaXN0cnkgPSB0aGlzLnJlZ2lzdHJ5O1xyXG4gICAgICAgIHRoaXMubG9hZGVyLnJ1bnRpbWVDYXRhbG9ndWUgPSB0aGlzLnJ1bnRpbWVDYXRhbG9ndWU7XHJcbiAgICAgICAgdGhpcy5sb2FkZXIucnVudGltZUZhY3RvcnkgPSB0aGlzLnJ1bnRpbWVGYWN0b3J5O1xyXG5cclxuICAgICAgICAvL0luc3RhbnRpYXRlIERpc2NvdmVyeSBMaWIgZm9yIG5vdGlmaWNhdGlvbiB0ZXN0aW5nXHJcbiAgICAgICAgLy8gdGhpcy5kaXNjb3ZlcnkgPSBuZXcgRGlzY292ZXJ5KFwiaHlwZXJ0eTovL2xvY2FsaG9zdC90ZXN0XCIsIHRoaXMucnVudGltZVVSTCwgdGhpcy5tZXNzYWdlQnVzKTtcclxuICAgICAgICAvLyB0aGlzLmxvYWRTdHViKFwibG9jYWxob3N0XCIpO1xyXG4gICAgICAgIC8vIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgIC8vICAgdGhpcy5kaXNjb3ZlcnkuZGlzY292ZXJIeXBlcnRpZXNETyhcInVzZXI6Ly9nb29nbGUuY29tL29wZW5pZHRlc3QyMEBnbWFpbC5jb21cIilcclxuICAgICAgICAvLyAgIC50aGVuKGh5cGVydGllcyA9PiB7XHJcbiAgICAgICAgLy8gICAgIGh5cGVydGllcy5mb3JFYWNoKGh5cGVydHkgPT57XHJcbiAgICAgICAgLy8gICAgICAgaHlwZXJ0eS5vbkxpdmUoKCkgPT4gbG9nLmxvZyhgTm90aWZpY2F0aW9uIGZyb20gJHtoeXBlcnR5LmRhdGEuaHlwZXJ0eUlEfSBjaGFuZ2VkIHRvIGxpdmVgKSk7XHJcbiAgICAgICAgLy8gICAgICAgaHlwZXJ0eS5vbkRpc2Nvbm5lY3RlZCgoKSA9PiBsb2cubG9nKGBOb3RpZmljYXRpb24gZnJvbSAke2h5cGVydHkuZGF0YS5oeXBlcnR5SUR9IGNoYW5nZWQgdG8gZGlzY29ubmVjdGVkYCkpO1xyXG4gICAgICAgIC8vICAgICB9KTtcclxuICAgICAgICAvLyAgIH0pO1xyXG4gICAgICAgIC8vIH0sIDIwMDApO1xyXG5cclxuXHJcbiAgICAgICAgLy8gdGhpcy5zdWJzY3JpcHRpb25NYW5hZ2VyLmluaXQoKS50aGVuKCgpPT57XHJcbiAgICAgICAgLy8gICByZXNvbHZlKHRydWUpO1xyXG4gICAgICAgIC8vIH0pO1xyXG5cclxuICAgICAgICBjb25zdCBwcmVwYXJlQ29tcG9uZW50cyA9IFtdO1xyXG4gICAgICAgIHByZXBhcmVDb21wb25lbnRzLnB1c2godGhpcy5zdWJzY3JpcHRpb25NYW5hZ2VyLmluaXQoKSk7XHJcbiAgICAgICAgcHJlcGFyZUNvbXBvbmVudHMucHVzaCh0aGlzLmlkZW50aXR5TW9kdWxlLmluaXQoZ3VpZCkpO1xyXG4gICAgICAgIHByZXBhcmVDb21wb25lbnRzLnB1c2goY3J5cHRvTWFuYWdlci5sb2FkU2Vzc2lvbktleXMoKSk7XHJcbiAgICAgICAgcHJlcGFyZUNvbXBvbmVudHMucHVzaCh0aGlzLnJlZ2lzdHJ5LmxvYWRSZWdpc3RyeSgpKTtcclxuICAgICAgICBwcmVwYXJlQ29tcG9uZW50cy5wdXNoKHRoaXMuX2RhdGFPYmplY3RzU3RvcmFnZS5sb2FkUmVtb3RlKCkpO1xyXG5cclxuICAgICAgICBQcm9taXNlLmFsbChwcmVwYXJlQ29tcG9uZW50cykudGhlbigocmVzdWx0KSA9PiB7XHJcbiAgICAgICAgICBpZiAocmVzdWx0Lmxlbmd0aCA9PT0gNSkge1xyXG4gICAgICAgICAgICByZXNvbHZlKHRydWUpO1xyXG4gICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgcmVqZWN0KCdbUnVudGltZVVBLl9sb2FkQ29tcG9uZW50c10gRXJyb3IgXSAnLCByZXN1bHQpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0pLmNhdGNoKChyZWFzb24pID0+IHtcclxuICAgICAgICAgIHRocm93IEVycm9yKHJlYXNvbik7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICB9IGNhdGNoIChlKSB7XHJcbiAgICAgICAgcmVqZWN0KGUpO1xyXG4gICAgICB9XHJcblxyXG4gICAgfSk7XHJcblxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogRGVwbG95IEh5cGVydHkgZnJvbSBDYXRhbG9ndWUgVVJMXHJcbiAgICpcclxuICAgKiBAc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9yZVRISU5LLXByb2plY3Qvc3BlY3MvdHJlZS9tYXN0ZXIvZGF0YW1vZGVsL2NvcmUvYWRkcmVzc1xyXG4gICAqXHJcbiAgICogQHBhcmFtIHtVUkwuSHlwZXJ0eUNhdGFsb2d1ZVVSTH0gaHlwZXJ0eUNhdGFsb2d1ZVVSTCAtIFRoZSBDYXRhbG9ndWUgVVJMIHVzZWQgdG8gaWRlbnRpZnkgZGVzY3JpcHRvcnMgaW4gdGhlIENhdGFsb2d1ZS5cclxuICAgKiBAcGFyYW0ge2Jvb2xlYW58VVJMLkh5cGVydHlVUkx9IFtyZXVzZVVSTD1mYWxzZV0gcmV1c2VVUkwgLSByZXVzZVVSTCBpcyB1c2VkIHRvIHJldXNlIHRoZSBoeXBlcnR5VVJMIHByZXZpb3VzbHkgcmVnaXN0cmVkLCBieSBkZWZhdWx0IHRoZSByZXVzZSBpcyBkaXNhYmxlZDtcclxuICAgKiBAcGFyYW0ge1VSTH0gYXBwVVJMIC0gdGhlIGFwcCB1cmwgYWRkcmVzczsgLy8gVE9ETzogaW1wcm92ZSB0aGlzIGRlc2NyaXB0aW9uO1xyXG4gICAqIEByZXR1cm5zIHtQcm9taXNlPEJvb2xlYW4sIEVycm9yPn0gdGhpcyBpcyBQcm9taXNlIGFuZCByZXR1cm5zIHRydWUgaWYgYWxsIGNvbXBvbmVudHMgYXJlIGxvYWRlZCB3aXRoIHN1Y2Nlc3Mgb3IgYW4gZXJyb3IgaWYgc29tZW9uZSBmYWlscy5cclxuICAgKlxyXG4gICAqIEBtZW1iZXJPZiBSdW50aW1lVUFcclxuICAgKi9cclxuICBsb2FkSHlwZXJ0eShoeXBlcnR5Q2F0YWxvZ3VlVVJMLCByZXVzZVVSTCA9IGZhbHNlLCBhcHBVUkwpIHtcclxuXHJcbiAgICBpZiAoIWh5cGVydHlDYXRhbG9ndWVVUkwpIHRocm93IG5ldyBFcnJvcignSHlwZXJ0eSBkZXNjcmlwdG9yIHVybCBwYXJhbWV0ZXIgaXMgbmVlZGVkJyk7XHJcbiAgICByZXR1cm4gdGhpcy5sb2FkZXIubG9hZEh5cGVydHkoaHlwZXJ0eUNhdGFsb2d1ZVVSTCwgcmV1c2VVUkwsIGFwcFVSTCk7XHJcblxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgKiBEZXBsb3kgU3R1YiBmcm9tIENhdGFsb2d1ZSBVUkwgb3IgZG9tYWluIHVybFxyXG4gICogQHBhcmFtICB7VVJMLlVSTH0gICAgIGRvbWFpbiAgICAgICAgICBkb21haW5cclxuICAqL1xyXG4gIGxvYWRTdHViKHByb3RvY29sc3R1YkNhdGFsb2d1ZVVSTCkge1xyXG5cclxuICAgIGlmICghcHJvdG9jb2xzdHViQ2F0YWxvZ3VlVVJMKSB0aHJvdyBuZXcgRXJyb3IoJ1Byb3RvU3R1YiBkZXNjcmlwdG9yIHVybCBwYXJhbWV0ZXIgaXMgbmVlZGVkJyk7XHJcbiAgICByZXR1cm4gdGhpcy5sb2FkZXIubG9hZFN0dWIocHJvdG9jb2xzdHViQ2F0YWxvZ3VlVVJMKTtcclxuXHJcbiAgfVxyXG5cclxuICAvKipcclxuICAqIERlcGxveSBpZHBQcm94eSBmcm9tIENhdGFsb2d1ZSBVUkwgb3IgZG9tYWluIHVybFxyXG4gICogQHBhcmFtICB7VVJMLlVSTH0gICAgIGRvbWFpbiAgICAgICAgICBkb21haW5cclxuICAqL1xyXG4gIGxvYWRJZHBQcm94eShpcGRQcm94eUNhdGFsb2d1ZVVSTCkge1xyXG4gICAgbG9nLmxvZygnaXBkUHJveHlDYXRhbG9ndWVVUkwnLCBpcGRQcm94eUNhdGFsb2d1ZVVSTCk7XHJcblxyXG4gICAgaWYgKCFpcGRQcm94eUNhdGFsb2d1ZVVSTCkgdGhyb3cgbmV3IEVycm9yKCdUaGUgSURQIFByb3h5IFVSTCBpcyBhIG5lZWRlZCBwYXJhbWV0ZXIsIGNvdWxkIGJlIGEgRE9NQUlOIG9yIGEgVVJMJyk7XHJcbiAgICByZXR1cm4gdGhpcy5sb2FkZXIubG9hZElkcFByb3h5KGlwZFByb3h5Q2F0YWxvZ3VlVVJMKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFVzZWQgdG8gY2xvc2UgYWxsIHRoZSBydW50aW1lOyBVbnJlZ2lzdGVyIGFsbCBoeXBlcnRpZXM7XHJcbiAgICogQHJldHVybiB7UHJvbWlzZTxCb29sZWFuPn0gcmVzdWx0IG9mIHRoZSBjbG9zZSBtZXRob2QsIHdpdGggdHJ1ZSBvciBmYWxzZSB0byB0aGUgb3BlcmF0aW9uIHN1Y2Nlc3M7XHJcbiAgICovXHJcbiAgY2xvc2UobG9nT3V0KSB7XHJcbiAgICBjb25zb2xlLmxvZygnUnVudGltZSBjb3JlIGxvZ291dDogJywgbG9nT3V0KTtcclxuICAgIGxldCBfdGhpcyA9IHRoaXM7XHJcbiAgICBpZiAobG9nT3V0ID09PSB0cnVlKSB7XHJcbiAgICAgIHRoaXMuaWRlbnRpdHlIYW5kbGVyLnJlc2V0KCk7XHJcbiAgICB9XHJcblxyXG4gICAgbG9nLmluZm8oJ1VucmVnaXN0ZXIgYWxsIGh5cGVydGllcycpO1xyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcclxuXHJcbiAgICAgIF90aGlzLnJlZ2lzdHJ5LnVucmVnaXN0ZXJBbGxIeXBlcnRpZXMoKS50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHtcclxuICAgICAgICBsb2cuaW5mbygnQWxsIHRoZSBoeXBlcnRpZXMgYXJlIHVucmVnaXN0ZWQgd2l0aCBTdWNjZXNzOicsIHJlc3VsdCk7XHJcbiAgICAgICAgcmVzb2x2ZSh0cnVlKTtcclxuICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKHJlYXNvbikge1xyXG4gICAgICAgIGxvZy5lcnJvcignRmFpbGVkIHRvIHVucmVnaXN0ZXIgdGhlIGh5cGVydGllcycsIHJlYXNvbik7XHJcbiAgICAgICAgcmVqZWN0KGZhbHNlKTtcclxuICAgICAgfSk7XHJcblxyXG4gICAgfSk7XHJcblxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogVXNlZCB0byByZXNldCB0aGUgcnVudGltZSBieSBkZWxldGluZyBhbGwgZGF0YSBmcm9tIHRoZSBzdG9yYWdlIG1hbmFnZXI7XHJcbiAgICogQHJldHVybiB7UHJvbWlzZTxCb29sZWFuPn0gcmVzdWx0IG9mIHRoZSByZXNldCBtZXRob2QsIHdpdGggdHJ1ZSBvciBmYWxzZSB0byB0aGUgb3BlcmF0aW9uIHN1Y2Nlc3M7XHJcbiAgICovXHJcbiAgcmVzZXQoKSB7XHJcbiAgICBjb25zb2xlLmxvZygnUnVudGltZVVBLlJ1bnRpbWUgY29yZSByZXNldDogJyk7XHJcblxyXG4gICAgbGV0IHJlc2V0aW5nID0gW107XHJcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG5cclxuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XHJcbiAgICAgIC8vVE9ETzogZGVsZWdhdGUgZGIgcmVzZXQgb3BlcmF0aW9uIHRvIGVhY2ggY29tcG9uZW50XHJcbiAgICAgIC8vICAgIHRoaXMuaWRlbnRpdHlNYW5hZ2VyLnJlc2V0KCk7XHJcblxyXG4gICAgICB0aGlzLl9kYXRhT2JqZWN0c1N0b3JhZ2UuZGVsZXRlUmVtb3RlcygpLnRoZW4oKCk9PntcclxuICAgICAgICByZXR1cm47XHJcbiAgICAgIH0pLlxyXG4gICAgICB0aGVuKCgpID0+IHtcclxuICAgICAgICB0aGlzLnN0b3JhZ2VzLmlkZW50aXR5LmdldChmYWxzZSwgZmFsc2UsICdpZGVudGl0aWVzJykudGhlbigoaWRlbnRpdGllcykgPT4ge1xyXG4gICAgICAgICAgbGV0IGlkZW50aXRpZXNLZXlzID0gT2JqZWN0LmtleXMoaWRlbnRpdGllcyk7XHJcbiAgXHJcbiAgICAgICAgICBpZGVudGl0aWVzS2V5cy5mb3JFYWNoKChrZXkpID0+IHtcclxuICAgICAgICAgICAgcmVzZXRpbmcucHVzaCh0aGlzLnN0b3JhZ2VzLmlkZW50aXR5LmRlbGV0ZShrZXksIGZhbHNlLCAnaWRlbnRpdGllcycpKTtcclxuICBcclxuICAgICAgICAgIH0pO1xyXG4gIFxyXG4gICAgICAgICAgcmVzZXRpbmcucHVzaCh0aGlzLnN0b3JhZ2VzLmNhcGFiaWxpdGllcy5kZWxldGUoJ2NhcGFiaWxpdGllcycpKTtcclxuICAgICAgICAgIHJlc2V0aW5nLnB1c2godGhpcy5zdG9yYWdlcy5jcnlwdG9NYW5hZ2VyLmRlbGV0ZSgndXNlckFzeW1tZXRyaWNLZXknKSk7XHJcbiAgICAgICAgICByZXNldGluZy5wdXNoKHRoaXMuc3RvcmFnZXMuaHlwZXJ0eVJlc291cmNlcy5kZWxldGUoJ2h5cGVydHlSZXNvdXJjZXMnKSk7XHJcbiAgICAgICAgICByZXNldGluZy5wdXNoKHRoaXMuc3RvcmFnZXMuaWRlbnRpdHkuZGVsZXRlKCdhY2Nlc3NUb2tlbnMnKSk7XHJcbiAgICAgICAgICByZXNldGluZy5wdXNoKHRoaXMuc3RvcmFnZXMucmVnaXN0cnkuZGVsZXRlKCdyZWdpc3RyeTpEYXRhT2JqZWN0VVJMcycpKTtcclxuICAgICAgICAgIHJlc2V0aW5nLnB1c2godGhpcy5zdG9yYWdlcy5yZWdpc3RyeS5kZWxldGUoJ3JlZ2lzdHJ5Okh5cGVydHlVUkxzJykpO1xyXG4gICAgICAgICAgcmVzZXRpbmcucHVzaCh0aGlzLnN0b3JhZ2VzLnJ1bnRpbWUuZGVsZXRlKCdwMnBIYW5kbGVyOlVSTCcpKTtcclxuICAgICAgICAgIHJlc2V0aW5nLnB1c2godGhpcy5zdG9yYWdlcy5ydW50aW1lLmRlbGV0ZSgncnVudGltZTpVUkwnKSk7XHJcbiAgICAgICAgICAvLyAgICByZXNldGluZy5wdXNoKHRoaXMuc3RvcmFnZXMucnVudGltZUNhdGFsb2d1ZS5kZWxldGUoJ3J1bnRpbWVDYXRhbG9ndWUnKSk7XHJcbiAgICAgICAgICByZXNldGluZy5wdXNoKHRoaXMuc3RvcmFnZXMuc3Vic2NyaXB0aW9ucy5kZWxldGUoJ3N1YnNjcmlwdGlvbnMnKSk7XHJcbiAgICAgICAgICByZXNldGluZy5wdXNoKHRoaXMuc3RvcmFnZXMuc3luY2hlck1hbmFnZXIuZGVsZXRlKCdzeW5jaGVyTWFuYWdlcjpPYmplY3RVUkxzJykpO1xyXG4gICAgICAgICAgcmVzZXRpbmcucHVzaCh0aGlzLnN0b3JhZ2VzLnN5bmNoZXJNYW5hZ2VyLmRlbGV0ZSgncmVtb3RlcycpKTtcclxuICBcclxuICAgICAgICAgIFByb21pc2UuYWxsKHJlc2V0aW5nKS50aGVuKChyZXN1bHQpID0+IHtcclxuICBcclxuICAgICAgICAgICAgbG9nLmluZm8oJ1tSdW50aW1lVUEucmVzZXRdIHJlc2V0IHdpdGggU3VjY2VzczonLCByZXN1bHQpO1xyXG4gICAgICAgICAgICByZXR1cm4gcmVzb2x2ZSh0cnVlKTtcclxuICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChyZWFzb24pIHtcclxuICAgICAgICAgICAgbG9nLmVycm9yKCdGYWlsZWQgdG8gcmVzZXQgYWxsIERCcycsIHJlYXNvbik7XHJcbiAgICAgICAgICAgIHJlc29sdmUoZmFsc2UpO1xyXG4gICAgICAgICAgfSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH0pXHJcblxyXG4gICAgfSk7XHJcblxyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGRlZmF1bHQgUnVudGltZVVBO1xyXG4iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUMvSEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUNMQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7O0FDNWtCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUMvSEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUN0VUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUM3UUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQ3RKQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FDcExBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FDM0RBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FDM3pCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQ2hqQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FDaFdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUN6R0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FDbDFCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FDcElBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQ2hIQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FDM05BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQzVFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FDditCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUNuSEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUNyREE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FDN1NBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQ3hMQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUNuQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUN2QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FDdkRBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQzNMQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FDenFCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUNuQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FDalZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FDL3NCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUMzVUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FDdEhBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUN6SkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FDOVVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUN4RUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUMxSEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUN0T0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQ3JFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FDMUZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQzlYQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQ3JWQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQ2pFQTtBQUNBO0FBQ0E7OztBQ0ZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQ3puREE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FDakdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FDaGFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQzFEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FDM3FEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQ3JHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUNoSEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FDcEdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUM3Q0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FDM0NBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUNoREE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQ2hEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FDN0NBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQ25FQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQzNEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FDbEVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FDdEZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQy9IQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQzFOQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUNoS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FDMVBBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FDakVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQzV1QkE7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FDbDZDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUNsdkJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQzVCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FDbkpBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQzlzQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUMvK0JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUNqQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FDMVZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUN4RUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQ3ZhQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQ3pMQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FDcGtDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FDM0JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FDeFBBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUM3RkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7QUMxVUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUN4REE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzNKQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FDeEVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3JIQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQy9IQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUN2TUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3JEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNqRkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQVFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUM1U0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUNqbEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///311\n")}]))}}});